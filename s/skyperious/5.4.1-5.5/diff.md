# Comparing `tmp/skyperious-5.4.1-py2.py3-none-any.whl.zip` & `tmp/skyperious-5.5-py2.py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,34 +1,34 @@
-Zip file size: 4706623 bytes, number of entries: 32
+Zip file size: 4707128 bytes, number of entries: 32
 -rw-rw-rw-  2.0 fat       76 b- defN 22-Sep-17 08:21 skyperious/__init__.py
 -rw-rw-rw-  2.0 fat       94 b- defN 22-Sep-17 08:21 skyperious/__main__.py
--rw-rw-rw-  2.0 fat    17002 b- defN 23-Jan-02 11:50 skyperious/conf.py
+-rw-rw-rw-  2.0 fat    17124 b- defN 23-Jul-18 11:11 skyperious/conf.py
 -rw-rw-rw-  2.0 fat    91712 b- defN 22-Sep-17 08:21 skyperious/emoticons.py
--rw-rw-rw-  2.0 fat    31739 b- defN 22-Dec-13 16:27 skyperious/export.py
--rw-rw-rw-  2.0 fat   494860 b- defN 22-Dec-13 16:27 skyperious/gui.py
+-rw-rw-rw-  2.0 fat    32002 b- defN 23-Jul-18 11:11 skyperious/export.py
+-rw-rw-rw-  2.0 fat   495354 b- defN 23-Jul-18 11:11 skyperious/gui.py
 -rw-rw-rw-  2.0 fat    12401 b- defN 22-Sep-17 08:21 skyperious/guibase.py
 -rw-rw-rw-  2.0 fat   186899 b- defN 22-Dec-13 16:27 skyperious/images.py
--rw-rw-rw-  2.0 fat    86498 b- defN 22-Dec-13 16:27 skyperious/live.py
+-rw-rw-rw-  2.0 fat    88736 b- defN 23-Jul-18 11:11 skyperious/live.py
 -rw-rw-rw-  2.0 fat    67173 b- defN 23-Jan-02 11:47 skyperious/main.py
 -rw-rw-rw-  2.0 fat    19373 b- defN 22-Dec-13 16:27 skyperious/searchparser.py
--rw-rw-rw-  2.0 fat   178820 b- defN 22-Dec-13 16:27 skyperious/skypedata.py
--rw-rw-rw-  2.0 fat      533 b- defN 23-Jan-02 11:44 skyperious/skyperious.ini
--rw-rw-rw-  2.0 fat    18792 b- defN 22-Sep-17 08:21 skyperious/support.py
+-rw-rw-rw-  2.0 fat   178820 b- defN 23-Jun-03 08:51 skyperious/skypedata.py
+-rw-rw-rw-  2.0 fat      533 b- defN 23-Jul-18 10:06 skyperious/skyperious.ini
+-rw-rw-rw-  2.0 fat    18834 b- defN 23-Jul-18 11:11 skyperious/support.py
 -rw-rw-rw-  2.0 fat   155393 b- defN 22-Dec-13 16:27 skyperious/templates.py
 -rw-rw-rw-  2.0 fat    43196 b- defN 22-Dec-13 16:27 skyperious/workers.py
 -rw-rw-rw-  2.0 fat        0 b- defN 22-Sep-17 08:21 skyperious/lib/__init__.py
 -rw-rw-rw-  2.0 fat   211677 b- defN 22-Dec-13 16:27 skyperious/lib/controls.py
 -rw-rw-rw-  2.0 fat    27613 b- defN 22-Dec-13 16:27 skyperious/lib/util.py
 -rw-rw-rw-  2.0 fat    16676 b- defN 22-Sep-17 08:21 skyperious/lib/wordcloud.py
--rw-rw-rw-  2.0 fat    17033 b- defN 22-Sep-17 08:21 skyperious/lib/wx_accel.py
+-rw-rw-rw-  2.0 fat    16629 b- defN 23-Jul-18 11:11 skyperious/lib/wx_accel.py
 -rw-rw-rw-  2.0 fat        0 b- defN 22-Sep-17 08:21 skyperious/lib/vendor/__init__.py
 -rw-rw-rw-  2.0 fat     7639 b- defN 22-Sep-17 08:21 skyperious/lib/vendor/step.py
 -rw-rw-rw-  2.0 fat   635996 b- defN 22-Apr-02 20:17 skyperious/res/Carlito.ttf
 -rw-rw-rw-  2.0 fat   690516 b- defN 22-Apr-02 20:17 skyperious/res/CarlitoBold.ttf
 -rw-rw-rw-  2.0 fat  3696407 b- defN 22-Sep-17 08:21 skyperious/res/emoticons.zip
--rw-rw-rw-  2.0 fat    13002 b- defN 23-Jan-02 12:16 skyperious-5.4.1.dist-info/LICENSE.md
--rw-rw-rw-  2.0 fat     9651 b- defN 23-Jan-02 12:16 skyperious-5.4.1.dist-info/METADATA
--rw-rw-rw-  2.0 fat      116 b- defN 23-Jan-02 12:16 skyperious-5.4.1.dist-info/WHEEL
--rw-rw-rw-  2.0 fat       48 b- defN 23-Jan-02 12:16 skyperious-5.4.1.dist-info/entry_points.txt
--rw-rw-rw-  2.0 fat       11 b- defN 23-Jan-02 12:16 skyperious-5.4.1.dist-info/top_level.txt
-?rw-rw-r--  2.0 fat     2615 b- defN 23-Jan-02 12:16 skyperious-5.4.1.dist-info/RECORD
-32 files, 6733561 bytes uncompressed, 4702507 bytes compressed:  30.2%
+-rw-rw-rw-  2.0 fat    13002 b- defN 23-Jul-18 11:12 skyperious-5.5.dist-info/LICENSE.md
+-rw-rw-rw-  2.0 fat     9578 b- defN 23-Jul-18 11:12 skyperious-5.5.dist-info/METADATA
+-rw-rw-rw-  2.0 fat      110 b- defN 23-Jul-18 11:12 skyperious-5.5.dist-info/WHEEL
+-rw-rw-rw-  2.0 fat       47 b- defN 23-Jul-18 11:12 skyperious-5.5.dist-info/entry_points.txt
+-rw-rw-rw-  2.0 fat       11 b- defN 23-Jul-18 11:12 skyperious-5.5.dist-info/top_level.txt
+-rw-rw-r--  2.0 fat     2603 b- defN 23-Jul-18 11:12 skyperious-5.5.dist-info/RECORD
+32 files, 6736224 bytes uncompressed, 4703036 bytes compressed:  30.2%
```

## zipnote {}

```diff
@@ -72,26 +72,26 @@
 
 Filename: skyperious/res/CarlitoBold.ttf
 Comment: 
 
 Filename: skyperious/res/emoticons.zip
 Comment: 
 
-Filename: skyperious-5.4.1.dist-info/LICENSE.md
+Filename: skyperious-5.5.dist-info/LICENSE.md
 Comment: 
 
-Filename: skyperious-5.4.1.dist-info/METADATA
+Filename: skyperious-5.5.dist-info/METADATA
 Comment: 
 
-Filename: skyperious-5.4.1.dist-info/WHEEL
+Filename: skyperious-5.5.dist-info/WHEEL
 Comment: 
 
-Filename: skyperious-5.4.1.dist-info/entry_points.txt
+Filename: skyperious-5.5.dist-info/entry_points.txt
 Comment: 
 
-Filename: skyperious-5.4.1.dist-info/top_level.txt
+Filename: skyperious-5.5.dist-info/top_level.txt
 Comment: 
 
-Filename: skyperious-5.4.1.dist-info/RECORD
+Filename: skyperious-5.5.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## skyperious/conf.py

```diff
@@ -6,30 +6,30 @@
 
 ------------------------------------------------------------------------------
 This file is part of Skyperious - Skype chat history tool.
 Released under the MIT License.
 
 @author      Erki Suurjaak
 @created     26.11.2011
-@modified    02.01.2023
+@modified    18.07.2023
 ------------------------------------------------------------------------------
 """
 try: from ConfigParser import RawConfigParser                 # Py2
 except ImportError: from configparser import RawConfigParser  # Py3
 import datetime
 import json
 import os
 import sys
 
 import appdirs
 
 """Program title, version number and version date."""
 Title = "Skyperious"
-Version = "5.4.1"
-VersionDate = "02.01.2023"
+Version = "5.5"
+VersionDate = "18.07.2023"
 
 if getattr(sys, "frozen", False):
     # Running as a pyinstaller executable
     ApplicationDirectory = os.path.dirname(sys.executable)
     ResourceDirectory = os.path.join(getattr(sys, "_MEIPASS", ""), "res")
 else:
     ApplicationDirectory = os.path.abspath(os.path.dirname(__file__))
@@ -145,17 +145,20 @@
 
 """Database export filename template, format can use Skype.Accounts data."""
 ExportDbTemplate = u"Export from %(name)s"
 
 """Whether the program tray icon is used."""
 TrayIconEnabled = True
 
-"""Whether the program checks for updates every UpdateCheckInterval."""
+"""Whether the program checks for updates every UpdateCheckInterval if UpdateCheckEnabled."""
 UpdateCheckAutomatic = True
 
+"""Whether the program supports automatic update check and download."""
+UpdateCheckEnabled = True
+
 """Whether the program has been minimized and hidden."""
 WindowIconized = False
 
 """Main window position, (x, y)."""
 WindowPosition = None
 
 """Main window size in pixels, [w, h] or [-1, -1] for maximized."""
```

## skyperious/export.py

```diff
@@ -4,15 +4,15 @@
 
 ------------------------------------------------------------------------------
 This file is part of Skyperious - Skype chat history tool.
 Released under the MIT License.
 
 @author      Erki Suurjaak
 @created     13.01.2012
-@modified    20.09.2022
+@modified    17.07.2023
 ------------------------------------------------------------------------------
 """
 import codecs
 import collections
 import csv
 import datetime
 import itertools
@@ -554,17 +554,17 @@
                   "hidden", "boldhidden", "timestamp"]:
             f = getattr(self, "FMT_%s" % t.upper(), self.FMT_DEFAULT)
             self._formats[t] = self._workbook.add_format(f)
 
         # For calculating column widths
         self._fonts = collections.defaultdict(lambda: FONT_XLSX)
         self._fonts["bold"] = FONT_XLSX_BOLD
-        unit_width_default = self._fonts[None].getsize("0")[0]
+        unit_width_default = get_extent(self._fonts[None], "0")[0]
         self._unit_widths = collections.defaultdict(lambda: unit_width_default)
-        self._unit_widths["bold"] = self._fonts["bold"].getsize("0")[0]
+        self._unit_widths["bold"] = get_extent(self._fonts["bold"], "0")[0]
 
         if sheetname: # Create default sheet
             self.add_sheet(sheetname)
 
 
     def add_sheet(self, name=None):
         """Adds a new worksheet. Name will be changed if invalid/existing."""
@@ -641,15 +641,15 @@
                 continue # continue for c, v in enumerate(Values)
 
             # Calculate and update maximum written column width
             strval = (v.encode("latin1", "replace").decode("latin1")
                       if isinstance(v, six.text_type)
                       else v.strftime("%Y-%m-%d %H:%M") if isinstance(v, datetime.datetime)
                       else v if isinstance(v, six.string_types) else str(v))
-            pixels = max(self._fonts[fmt_name].getsize(x)[0]
+            pixels = max(get_extent(self._fonts[fmt_name], x)[0]
                          for x in strval.split("\n"))
             width = float(pixels) / self._unit_widths[fmt_name] + 1
             if not merge_cols and width > self._col_widths[self._sheet.name][c]:
                 self._col_widths[self._sheet.name][c] = width
         self._row += 1
 
 
@@ -663,7 +663,13 @@
                 w = min(w, self.COL_MAXWIDTH)
                 sheet.set_column(c, c, w, self._formats[None])
             sheet.set_column(c + 1, 50, cell_format=self._formats[None])
         self._workbook.set_properties({"comments": "Exported with %s on %s." %
             (conf.Title, datetime.datetime.now().strftime("%d.%m.%Y %H:%M")),
             "author": "%s %s" % (conf.Title, conf.Version)})
         self._workbook.close()
+
+
+def get_extent(font, text):
+    """Returns (width, height) for specified font and text."""
+    if hasattr(font, "getsize"): return font.getsize(text)     # <  PIL v10
+    if hasattr(font, "getbbox"): return font.getbbox(text)[2:] # >= PIL v10
```

## skyperious/gui.py

```diff
@@ -16,15 +16,15 @@
 000000f0: 7279 2074 6f6f 6c2e 0d0a 5265 6c65 6173  ry tool...Releas
 00000100: 6564 2075 6e64 6572 2074 6865 204d 4954  ed under the MIT
 00000110: 204c 6963 656e 7365 2e0d 0a0d 0a40 6175   License.....@au
 00000120: 7468 6f72 2020 2020 2020 4572 6b69 2053  thor      Erki S
 00000130: 7575 726a 6161 6b0d 0a40 6372 6561 7465  uurjaak..@create
 00000140: 6420 2020 2020 3236 2e31 312e 3230 3131  d     26.11.2011
 00000150: 0d0a 406d 6f64 6966 6965 6420 2020 2031  ..@modified    1
-00000160: 332e 3130 2e32 3032 320d 0a2d 2d2d 2d2d  3.10.2022..-----
+00000160: 372e 3037 2e32 3032 330d 0a2d 2d2d 2d2d  7.07.2023..-----
 00000170: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00000180: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 00000190: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 000001a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 000001b0: 2d2d 2d2d 2d2d 2d2d 2d0d 0a22 2222 0d0a  ---------.."""..
 000001c0: 696d 706f 7274 2061 7374 0d0a 696d 706f  import ast..impo
 000001d0: 7274 2063 616c 656e 6461 720d 0a69 6d70  rt calendar..imp
@@ -1599,29331 +1599,29362 @@
 000063e0: 6f6e 2e49 7341 7661 696c 6162 6c65 2829  on.IsAvailable()
 000063f0: 3a0d 0a20 2020 2020 2020 2020 2020 206d  :..            m
 00006400: 656e 755f 7472 6179 2e43 6865 636b 2863  enu_tray.Check(c
 00006410: 6f6e 662e 5472 6179 4963 6f6e 456e 6162  onf.TrayIconEnab
 00006420: 6c65 6429 0d0a 2020 2020 2020 2020 6d65  led)..        me
 00006430: 6e75 5f61 7574 6f75 7064 6174 655f 6368  nu_autoupdate_ch
 00006440: 6563 6b2e 4368 6563 6b28 636f 6e66 2e55  eck.Check(conf.U
-00006450: 7064 6174 6543 6865 636b 4175 746f 6d61  pdateCheckAutoma
-00006460: 7469 6329 0d0a 0d0a 2020 2020 2020 2020  tic)....        
-00006470: 7365 6c66 2e42 696e 6428 7778 2e45 5654  self.Bind(wx.EVT
-00006480: 5f4d 454e 552c 2073 656c 662e 6f6e 5f6e  _MENU, self.on_n
-00006490: 6577 5f62 6c61 6e6b 2c20 2020 2020 2020  ew_blank,       
-000064a0: 2020 2020 2020 2020 6d65 6e75 5f6e 6577          menu_new
-000064b0: 5f62 6c61 6e6b 290d 0a20 2020 2020 2020  _blank)..       
-000064c0: 2069 6620 6d65 6e75 5f6e 6577 5f6c 6976   if menu_new_liv
-000064d0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-000064e0: 7365 6c66 2e42 696e 6428 7778 2e45 5654  self.Bind(wx.EVT
-000064f0: 5f4d 454e 552c 2073 656c 662e 6f6e 5f6e  _MENU, self.on_n
-00006500: 6577 5f6c 6976 652c 2020 2020 2020 2020  ew_live,        
-00006510: 2020 2020 6d65 6e75 5f6e 6577 5f6c 6976      menu_new_liv
-00006520: 6529 0d0a 2020 2020 2020 2020 6966 206d  e)..        if m
-00006530: 656e 755f 6e65 775f 6578 706f 7274 3a0d  enu_new_export:.
-00006540: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00006550: 662e 4269 6e64 2877 782e 4556 545f 4d45  f.Bind(wx.EVT_ME
-00006560: 4e55 2c20 7365 6c66 2e6f 6e5f 6e65 775f  NU, self.on_new_
-00006570: 6578 706f 7274 2c20 2020 2020 2020 2020  export,         
-00006580: 206d 656e 755f 6e65 775f 6578 706f 7274   menu_new_export
-00006590: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-000065a0: 4269 6e64 2877 782e 4556 545f 4d45 4e55  Bind(wx.EVT_MENU
-000065b0: 2c20 7365 6c66 2e6f 6e5f 6f70 656e 5f64  , self.on_open_d
-000065c0: 6174 6162 6173 652c 2020 2020 2020 2020  atabase,        
-000065d0: 2020 206d 656e 755f 6f70 656e 5f64 6174     menu_open_dat
-000065e0: 6162 6173 6529 0d0a 2020 2020 2020 2020  abase)..        
-000065f0: 7365 6c66 2e42 696e 6428 7778 2e45 5654  self.Bind(wx.EVT
-00006600: 5f4d 454e 552c 2073 656c 662e 6f6e 5f6f  _MENU, self.on_o
-00006610: 7065 6e5f 6f70 7469 6f6e 732c 2020 2020  pen_options,    
-00006620: 2020 2020 2020 2020 6d65 6e75 5f6f 7074          menu_opt
-00006630: 696f 6e73 290d 0a20 2020 2020 2020 2073  ions)..        s
-00006640: 656c 662e 4269 6e64 2877 782e 4556 545f  elf.Bind(wx.EVT_
-00006650: 4d45 4e55 2c20 7365 6c66 2e6f 6e5f 6578  MENU, self.on_ex
-00006660: 6974 2c20 2020 2020 2020 2020 2020 2020  it,             
-00006670: 2020 2020 2020 206d 656e 755f 6578 6974         menu_exit
-00006680: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00006690: 4269 6e64 2877 782e 4556 545f 4d45 4e55  Bind(wx.EVT_MENU
-000066a0: 2c20 7365 6c66 2e6f 6e5f 6368 6563 6b5f  , self.on_check_
-000066b0: 7570 6461 7465 2c20 2020 2020 2020 2020  update,         
-000066c0: 2020 206d 656e 755f 7570 6461 7465 290d     menu_update).
-000066d0: 0a20 2020 2020 2020 2073 656c 662e 4269  .        self.Bi
-000066e0: 6e64 2877 782e 4556 545f 4d45 4e55 2c20  nd(wx.EVT_MENU, 
-000066f0: 7365 6c66 2e6f 6e5f 6f70 656e 5f66 6565  self.on_open_fee
-00006700: 6462 6163 6b2c 2020 2020 2020 2020 2020  dback,          
-00006710: 206d 656e 755f 6665 6564 6261 636b 290d   menu_feedback).
-00006720: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-00006730: 2e74 7261 7969 636f 6e2e 4973 4176 6169  .trayicon.IsAvai
-00006740: 6c61 626c 6528 293a 0d0a 2020 2020 2020  lable():..      
-00006750: 2020 2020 2020 7365 6c66 2e42 696e 6428        self.Bind(
-00006760: 7778 2e45 5654 5f4d 454e 552c 2073 656c  wx.EVT_MENU, sel
-00006770: 662e 6f6e 5f74 6f67 676c 655f 6963 6f6e  f.on_toggle_icon
-00006780: 697a 652c 2020 2020 2020 6d65 6e75 5f69  ize,      menu_i
-00006790: 636f 6e69 7a65 290d 0a20 2020 2020 2020  conize)..       
-000067a0: 2020 2020 2073 656c 662e 4269 6e64 2877       self.Bind(w
-000067b0: 782e 4556 545f 4d45 4e55 2c20 7365 6c66  x.EVT_MENU, self
-000067c0: 2e6f 6e5f 746f 6767 6c65 5f74 7261 7969  .on_toggle_trayi
-000067d0: 636f 6e2c 2020 2020 206d 656e 755f 7472  con,     menu_tr
-000067e0: 6179 290d 0a20 2020 2020 2020 2073 656c  ay)..        sel
-000067f0: 662e 4269 6e64 2877 782e 4556 545f 4d45  f.Bind(wx.EVT_ME
-00006800: 4e55 2c20 7365 6c66 2e6f 6e5f 6d65 6e75  NU, self.on_menu
-00006810: 5f68 6f6d 6570 6167 652c 2020 2020 2020  _homepage,      
-00006820: 2020 2020 206d 656e 755f 686f 6d65 7061       menu_homepa
-00006830: 6765 290d 0a20 2020 2020 2020 2073 656c  ge)..        sel
-00006840: 662e 4269 6e64 2877 782e 4556 545f 4d45  f.Bind(wx.EVT_ME
-00006850: 4e55 2c20 7365 6c66 2e6f 6e5f 7368 6f77  NU, self.on_show
-00006860: 6869 6465 5f6c 6f67 2c20 2020 2020 2020  hide_log,       
-00006870: 2020 2020 206d 656e 755f 6c6f 6729 0d0a       menu_log)..
-00006880: 2020 2020 2020 2020 7365 6c66 2e42 696e          self.Bin
-00006890: 6428 7778 2e45 5654 5f4d 454e 552c 2073  d(wx.EVT_MENU, s
-000068a0: 656c 662e 6f6e 5f73 686f 7768 6964 655f  elf.on_showhide_
-000068b0: 636f 6e73 6f6c 652c 2020 2020 2020 2020  console,        
-000068c0: 6d65 6e75 5f63 6f6e 736f 6c65 290d 0a20  menu_console).. 
-000068d0: 2020 2020 2020 2073 656c 662e 4269 6e64         self.Bind
-000068e0: 2877 782e 4556 545f 4d45 4e55 2c20 7365  (wx.EVT_MENU, se
-000068f0: 6c66 2e6f 6e5f 746f 6767 6c65 5f61 7574  lf.on_toggle_aut
-00006900: 6f75 7064 6174 655f 6368 6563 6b2c 206d  oupdate_check, m
-00006910: 656e 755f 6175 746f 7570 6461 7465 5f63  enu_autoupdate_c
-00006920: 6865 636b 290d 0a20 2020 2020 2020 2073  heck)..        s
-00006930: 656c 662e 4269 6e64 2877 782e 4556 545f  elf.Bind(wx.EVT_
-00006940: 4d45 4e55 2c20 7365 6c66 2e6f 6e5f 6162  MENU, self.on_ab
-00006950: 6f75 742c 2020 2020 2020 2020 2020 2020  out,            
-00006960: 2020 2020 2020 206d 656e 755f 6162 6f75         menu_abou
-00006970: 7429 0d0a 0d0a 0d0a 2020 2020 6465 6620  t)......    def 
-00006980: 7570 6461 7465 5f63 6865 636b 2873 656c  update_check(sel
-00006990: 6629 3a0d 0a20 2020 2020 2020 2022 2222  f):..        """
-000069a0: 0d0a 2020 2020 2020 2020 4368 6563 6b73  ..        Checks
-000069b0: 2066 6f72 2061 6e20 7570 6461 7465 6420   for an updated 
-000069c0: 536b 7970 6572 696f 7573 2076 6572 7369  Skyperious versi
-000069d0: 6f6e 2069 6620 7375 6666 6963 6965 6e74  on if sufficient
-000069e0: 2074 696d 650d 0a20 2020 2020 2020 2066   time..        f
-000069f0: 726f 6d20 6c61 7374 2063 6865 636b 2068  rom last check h
-00006a00: 6173 2070 6173 7365 642c 2061 6e64 206f  as passed, and o
-00006a10: 7065 6e73 2061 2064 6961 6c6f 6720 666f  pens a dialog fo
-00006a20: 7220 7570 6772 6164 696e 670d 0a20 2020  r upgrading..   
-00006a30: 2020 2020 2069 6620 6e65 7720 7665 7273       if new vers
-00006a40: 696f 6e20 6176 6169 6c61 626c 652e 2053  ion available. S
-00006a50: 6368 6564 756c 6573 2061 206e 6577 2063  chedules a new c
-00006a60: 6865 636b 206f 6e20 6475 6520 6461 7465  heck on due date
-00006a70: 2e0d 0a20 2020 2020 2020 2022 2222 0d0a  ...        """..
-00006a80: 2020 2020 2020 2020 6966 2073 656c 6620          if self 
-00006a90: 6f72 206e 6f74 2063 6f6e 662e 5570 6461  or not conf.Upda
-00006aa0: 7465 4368 6563 6b41 7574 6f6d 6174 6963  teCheckAutomatic
-00006ab0: 3a20 7265 7475 726e 0d0a 0d0a 2020 2020  : return....    
-00006ac0: 2020 2020 696e 7465 7276 616c 203d 2064      interval = d
-00006ad0: 6174 6574 696d 652e 7469 6d65 6465 6c74  atetime.timedelt
-00006ae0: 6128 6461 7973 3d63 6f6e 662e 5570 6461  a(days=conf.Upda
-00006af0: 7465 4368 6563 6b49 6e74 6572 7661 6c29  teCheckInterval)
-00006b00: 0d0a 2020 2020 2020 2020 6475 655f 6461  ..        due_da
-00006b10: 7465 203d 2064 6174 6574 696d 652e 6461  te = datetime.da
-00006b20: 7465 7469 6d65 2e6e 6f77 2829 202d 2069  tetime.now() - i
-00006b30: 6e74 6572 7661 6c0d 0a20 2020 2020 2020  nterval..       
-00006b40: 2069 6620 6e6f 7420 2863 6f6e 662e 5769   if not (conf.Wi
-00006b50: 6e64 6f77 4963 6f6e 697a 6564 206f 7220  ndowIconized or 
-00006b60: 7375 7070 6f72 742e 7570 6461 7465 5f77  support.update_w
-00006b70: 696e 646f 7729 205c 0d0a 2020 2020 2020  indow) \..      
-00006b80: 2020 616e 6420 636f 6e66 2e4c 6173 7455    and conf.LastU
-00006b90: 7064 6174 6543 6865 636b 203c 2064 7565  pdateCheck < due
-00006ba0: 5f64 6174 652e 7374 7266 7469 6d65 2822  _date.strftime("
-00006bb0: 2559 256d 2564 2229 3a0d 0a20 2020 2020  %Y%m%d"):..     
-00006bc0: 2020 2020 2020 2063 616c 6c62 6163 6b20         callback 
-00006bd0: 3d20 6c61 6d62 6461 2072 6573 703a 2073  = lambda resp: s
-00006be0: 656c 662e 6f6e 5f63 6865 636b 5f75 7064  elf.on_check_upd
-00006bf0: 6174 655f 6361 6c6c 6261 636b 2872 6573  ate_callback(res
-00006c00: 702c 2046 616c 7365 290d 0a20 2020 2020  p, False)..     
-00006c10: 2020 2020 2020 2073 7570 706f 7274 2e63         support.c
-00006c20: 6865 636b 5f6e 6577 6573 745f 7665 7273  heck_newest_vers
-00006c30: 696f 6e28 6361 6c6c 6261 636b 290d 0a20  ion(callback).. 
-00006c40: 2020 2020 2020 2065 6c69 6620 6e6f 7420         elif not 
-00006c50: 7375 7070 6f72 742e 7570 6461 7465 5f77  support.update_w
-00006c60: 696e 646f 773a 0d0a 2020 2020 2020 2020  indow:..        
-00006c70: 2020 2020 7472 793a 0d0a 2020 2020 2020      try:..      
-00006c80: 2020 2020 2020 2020 2020 6474 203d 2064            dt = d
-00006c90: 6174 6574 696d 652e 6461 7465 7469 6d65  atetime.datetime
-00006ca0: 2e73 7472 7074 696d 6528 636f 6e66 2e4c  .strptime(conf.L
-00006cb0: 6173 7455 7064 6174 6543 6865 636b 2c20  astUpdateCheck, 
-00006cc0: 2225 5925 6d25 6422 290d 0a20 2020 2020  "%Y%m%d")..     
-00006cd0: 2020 2020 2020 2020 2020 2069 6e74 6572             inter
-00006ce0: 7661 6c20 3d20 2864 7420 2b20 696e 7465  val = (dt + inte
-00006cf0: 7276 616c 2920 2d20 6461 7465 7469 6d65  rval) - datetime
-00006d00: 2e64 6174 6574 696d 652e 6e6f 7728 290d  .datetime.now().
-00006d10: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
-00006d20: 6570 7420 2854 7970 6545 7272 6f72 2c20  ept (TypeError, 
-00006d30: 5661 6c75 6545 7272 6f72 293a 2070 6173  ValueError): pas
-00006d40: 730d 0a0d 0a20 2020 2020 2020 2023 2053  s....        # S
-00006d50: 6368 6564 756c 6520 6120 6368 6563 6b20  chedule a check 
-00006d60: 666f 7220 6e65 7874 2064 7565 2064 6174  for next due dat
-00006d70: 652c 2073 686f 756c 6420 7468 6520 7072  e, should the pr
-00006d80: 6f67 7261 6d20 7275 6e20 7468 6174 206c  ogram run that l
-00006d90: 6f6e 672e 0d0a 2020 2020 2020 2020 6d69  ong...        mi
-00006da0: 6c6c 6973 203d 206d 696e 2873 7973 2e6d  llis = min(sys.m
-00006db0: 6178 7369 7a65 2c20 7574 696c 2e74 696d  axsize, util.tim
-00006dc0: 6564 656c 7461 5f73 6563 6f6e 6473 2869  edelta_seconds(i
-00006dd0: 6e74 6572 7661 6c29 202a 2031 3030 3029  nterval) * 1000)
-00006de0: 0d0a 2020 2020 2020 2020 7778 2e43 616c  ..        wx.Cal
-00006df0: 6c4c 6174 6572 286d 696c 6c69 732c 2073  lLater(millis, s
-00006e00: 656c 662e 7570 6461 7465 5f63 6865 636b  elf.update_check
-00006e10: 290d 0a0d 0a0d 0a20 2020 2064 6566 206f  )......    def o
-00006e20: 6e5f 7472 6179 5f73 6561 7263 6828 7365  n_tray_search(se
-00006e30: 6c66 2c20 6576 656e 7429 3a0d 0a20 2020  lf, event):..   
-00006e40: 2020 2020 2022 2222 4861 6e64 6c65 7220       """Handler 
-00006e50: 666f 7220 7365 6172 6368 696e 6720 6672  for searching fr
-00006e60: 6f6d 2074 7261 7920 6469 616c 6f67 2c20  om tray dialog, 
-00006e70: 6c61 756e 6368 6573 2073 6561 7263 682e  launches search.
-00006e80: 2222 220d 0a20 2020 2020 2020 2069 6620  """..        if 
-00006e90: 7365 6c66 2e64 6961 6c6f 675f 7365 6172  self.dialog_sear
-00006ea0: 6368 2e56 616c 7565 2e73 7472 6970 2829  ch.Value.strip()
-00006eb0: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
-00006ec0: 656c 662e 6469 616c 6f67 5f73 6561 7263  elf.dialog_searc
-00006ed0: 682e 4869 6465 2829 0d0a 2020 2020 2020  h.Hide()..      
-00006ee0: 2020 2020 2020 6966 2073 656c 662e 4973        if self.Is
-00006ef0: 4963 6f6e 697a 6564 2829 2061 6e64 206e  Iconized() and n
-00006f00: 6f74 2073 656c 662e 5368 6f77 6e3a 0d0a  ot self.Shown:..
-00006f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006f20: 7365 6c66 2e6f 6e5f 746f 6767 6c65 5f69  self.on_toggle_i
-00006f30: 636f 6e69 7a65 2829 0d0a 2020 2020 2020  conize()..      
-00006f40: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-00006f50: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00006f60: 662e 4963 6f6e 697a 6528 4661 6c73 6529  f.Iconize(False)
-00006f70: 2c20 7365 6c66 2e53 686f 7728 292c 2073  , self.Show(), s
-00006f80: 656c 662e 5261 6973 6528 290d 0a20 2020  elf.Raise()..   
-00006f90: 2020 2020 2020 2020 2070 6167 6520 3d20           page = 
-00006fa0: 7365 6c66 2e70 6167 655f 6462 5f6c 6174  self.page_db_lat
-00006fb0: 6573 740d 0a20 2020 2020 2020 2020 2020  est..           
-00006fc0: 2069 6620 6e6f 7420 7061 6765 3a0d 0a20   if not page:.. 
-00006fd0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00006fe0: 696c 656e 616d 6520 3d20 7365 6c66 2e64  ilename = self.d
-00006ff0: 625f 6669 6c65 6e61 6d65 206e 6f74 2069  b_filename not i
-00007000: 6e20 7365 6c66 2e77 6f72 6b65 7273 5f69  n self.workers_i
-00007010: 6d70 6f72 7420 616e 6420 7365 6c66 2e64  mport and self.d
-00007020: 625f 6669 6c65 6e61 6d65 0d0a 2020 2020  b_filename..    
-00007030: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-00007040: 6f74 2066 696c 656e 616d 653a 2066 696c  ot filename: fil
-00007050: 656e 616d 6520 3d20 6e65 7874 2828 7820  ename = next((x 
-00007060: 666f 7220 7820 696e 206c 6973 7428 7365  for x in list(se
-00007070: 6c66 2e64 6273 2920 2b20 636f 6e66 2e52  lf.dbs) + conf.R
-00007080: 6563 656e 7446 696c 6573 0d0a 2020 2020  ecentFiles..    
-00007090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000070a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000070b0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-000070c0: 2078 206e 6f74 2069 6e20 7365 6c66 2e77   x not in self.w
-000070d0: 6f72 6b65 7273 5f69 6d70 6f72 7429 2c20  orkers_import), 
-000070e0: 4e6f 6e65 290d 0a20 2020 2020 2020 2020  None)..         
-000070f0: 2020 2020 2020 2069 6620 6669 6c65 6e61         if filena
-00007100: 6d65 3a20 7061 6765 203d 2073 656c 662e  me: page = self.
-00007110: 6c6f 6164 5f64 6174 6162 6173 655f 7061  load_database_pa
-00007120: 6765 2866 696c 656e 616d 6529 0d0a 2020  ge(filename)..  
-00007130: 2020 2020 2020 2020 2020 6966 2070 6167            if pag
-00007140: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00007150: 2020 2020 7061 6765 2e65 6469 745f 7365      page.edit_se
-00007160: 6172 6368 616c 6c2e 5661 6c75 6520 3d20  archall.Value = 
-00007170: 7365 6c66 2e64 6961 6c6f 675f 7365 6172  self.dialog_sear
-00007180: 6368 2e56 616c 7565 0d0a 2020 2020 2020  ch.Value..      
-00007190: 2020 2020 2020 2020 2020 7061 6765 2e6f            page.o
-000071a0: 6e5f 7365 6172 6368 616c 6c28 4e6f 6e65  n_searchall(None
-000071b0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-000071c0: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
-000071d0: 6528 7365 6c66 2e6e 6f74 6562 6f6f 6b2e  e(self.notebook.
-000071e0: 4765 7450 6167 6543 6f75 6e74 2829 293a  GetPageCount()):
-000071f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00007200: 2020 2020 2020 6966 2073 656c 662e 6e6f        if self.no
-00007210: 7465 626f 6f6b 2e47 6574 5061 6765 2869  tebook.GetPage(i
-00007220: 2920 3d3d 2070 6167 653a 0d0a 2020 2020  ) == page:..    
-00007230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007240: 2020 2020 6966 2073 656c 662e 6e6f 7465      if self.note
-00007250: 626f 6f6b 2e47 6574 5365 6c65 6374 696f  book.GetSelectio
-00007260: 6e28 2920 213d 2069 3a0d 0a20 2020 2020  n() != i:..     
-00007270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007280: 2020 2020 2020 2073 656c 662e 6e6f 7465         self.note
-00007290: 626f 6f6b 2e53 6574 5365 6c65 6374 696f  book.SetSelectio
-000072a0: 6e28 6929 0d0a 2020 2020 2020 2020 2020  n(i)..          
-000072b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000072c0: 2020 7365 6c66 2e75 7064 6174 655f 6e6f    self.update_no
-000072d0: 7465 626f 6f6b 5f68 6561 6465 7228 290d  tebook_header().
+00006450: 7064 6174 6543 6865 636b 456e 6162 6c65  pdateCheckEnable
+00006460: 6420 616e 6420 636f 6e66 2e55 7064 6174  d and conf.Updat
+00006470: 6543 6865 636b 4175 746f 6d61 7469 6329  eCheckAutomatic)
+00006480: 0d0a 2020 2020 2020 2020 6d65 6e75 5f61  ..        menu_a
+00006490: 7574 6f75 7064 6174 655f 6368 6563 6b2e  utoupdate_check.
+000064a0: 456e 6162 6c65 2863 6f6e 662e 5570 6461  Enable(conf.Upda
+000064b0: 7465 4368 6563 6b45 6e61 626c 6564 290d  teCheckEnabled).
+000064c0: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
+000064d0: 4269 6e64 2877 782e 4556 545f 4d45 4e55  Bind(wx.EVT_MENU
+000064e0: 2c20 7365 6c66 2e6f 6e5f 6e65 775f 626c  , self.on_new_bl
+000064f0: 616e 6b2c 2020 2020 2020 2020 2020 2020  ank,            
+00006500: 2020 206d 656e 755f 6e65 775f 626c 616e     menu_new_blan
+00006510: 6b29 0d0a 2020 2020 2020 2020 6966 206d  k)..        if m
+00006520: 656e 755f 6e65 775f 6c69 7665 3a0d 0a20  enu_new_live:.. 
+00006530: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00006540: 4269 6e64 2877 782e 4556 545f 4d45 4e55  Bind(wx.EVT_MENU
+00006550: 2c20 7365 6c66 2e6f 6e5f 6e65 775f 6c69  , self.on_new_li
+00006560: 7665 2c20 2020 2020 2020 2020 2020 206d  ve,            m
+00006570: 656e 755f 6e65 775f 6c69 7665 290d 0a20  enu_new_live).. 
+00006580: 2020 2020 2020 2069 6620 6d65 6e75 5f6e         if menu_n
+00006590: 6577 5f65 7870 6f72 743a 0d0a 2020 2020  ew_export:..    
+000065a0: 2020 2020 2020 2020 7365 6c66 2e42 696e          self.Bin
+000065b0: 6428 7778 2e45 5654 5f4d 454e 552c 2073  d(wx.EVT_MENU, s
+000065c0: 656c 662e 6f6e 5f6e 6577 5f65 7870 6f72  elf.on_new_expor
+000065d0: 742c 2020 2020 2020 2020 2020 6d65 6e75  t,          menu
+000065e0: 5f6e 6577 5f65 7870 6f72 7429 0d0a 2020  _new_export)..  
+000065f0: 2020 2020 2020 7365 6c66 2e42 696e 6428        self.Bind(
+00006600: 7778 2e45 5654 5f4d 454e 552c 2073 656c  wx.EVT_MENU, sel
+00006610: 662e 6f6e 5f6f 7065 6e5f 6461 7461 6261  f.on_open_databa
+00006620: 7365 2c20 2020 2020 2020 2020 2020 6d65  se,           me
+00006630: 6e75 5f6f 7065 6e5f 6461 7461 6261 7365  nu_open_database
+00006640: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00006650: 4269 6e64 2877 782e 4556 545f 4d45 4e55  Bind(wx.EVT_MENU
+00006660: 2c20 7365 6c66 2e6f 6e5f 6f70 656e 5f6f  , self.on_open_o
+00006670: 7074 696f 6e73 2c20 2020 2020 2020 2020  ptions,         
+00006680: 2020 206d 656e 755f 6f70 7469 6f6e 7329     menu_options)
+00006690: 0d0a 2020 2020 2020 2020 7365 6c66 2e42  ..        self.B
+000066a0: 696e 6428 7778 2e45 5654 5f4d 454e 552c  ind(wx.EVT_MENU,
+000066b0: 2073 656c 662e 6f6e 5f65 7869 742c 2020   self.on_exit,  
+000066c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000066d0: 2020 6d65 6e75 5f65 7869 7429 0d0a 2020    menu_exit)..  
+000066e0: 2020 2020 2020 7365 6c66 2e42 696e 6428        self.Bind(
+000066f0: 7778 2e45 5654 5f4d 454e 552c 2073 656c  wx.EVT_MENU, sel
+00006700: 662e 6f6e 5f63 6865 636b 5f75 7064 6174  f.on_check_updat
+00006710: 652c 2020 2020 2020 2020 2020 2020 6d65  e,            me
+00006720: 6e75 5f75 7064 6174 6529 0d0a 2020 2020  nu_update)..    
+00006730: 2020 2020 7365 6c66 2e42 696e 6428 7778      self.Bind(wx
+00006740: 2e45 5654 5f4d 454e 552c 2073 656c 662e  .EVT_MENU, self.
+00006750: 6f6e 5f6f 7065 6e5f 6665 6564 6261 636b  on_open_feedback
+00006760: 2c20 2020 2020 2020 2020 2020 6d65 6e75  ,           menu
+00006770: 5f66 6565 6462 6163 6b29 0d0a 2020 2020  _feedback)..    
+00006780: 2020 2020 6966 2073 656c 662e 7472 6179      if self.tray
+00006790: 6963 6f6e 2e49 7341 7661 696c 6162 6c65  icon.IsAvailable
+000067a0: 2829 3a0d 0a20 2020 2020 2020 2020 2020  ():..           
+000067b0: 2073 656c 662e 4269 6e64 2877 782e 4556   self.Bind(wx.EV
+000067c0: 545f 4d45 4e55 2c20 7365 6c66 2e6f 6e5f  T_MENU, self.on_
+000067d0: 746f 6767 6c65 5f69 636f 6e69 7a65 2c20  toggle_iconize, 
+000067e0: 2020 2020 206d 656e 755f 6963 6f6e 697a       menu_iconiz
+000067f0: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+00006800: 7365 6c66 2e42 696e 6428 7778 2e45 5654  self.Bind(wx.EVT
+00006810: 5f4d 454e 552c 2073 656c 662e 6f6e 5f74  _MENU, self.on_t
+00006820: 6f67 676c 655f 7472 6179 6963 6f6e 2c20  oggle_trayicon, 
+00006830: 2020 2020 6d65 6e75 5f74 7261 7929 0d0a      menu_tray)..
+00006840: 2020 2020 2020 2020 7365 6c66 2e42 696e          self.Bin
+00006850: 6428 7778 2e45 5654 5f4d 454e 552c 2073  d(wx.EVT_MENU, s
+00006860: 656c 662e 6f6e 5f6d 656e 755f 686f 6d65  elf.on_menu_home
+00006870: 7061 6765 2c20 2020 2020 2020 2020 2020  page,           
+00006880: 6d65 6e75 5f68 6f6d 6570 6167 6529 0d0a  menu_homepage)..
+00006890: 2020 2020 2020 2020 7365 6c66 2e42 696e          self.Bin
+000068a0: 6428 7778 2e45 5654 5f4d 454e 552c 2073  d(wx.EVT_MENU, s
+000068b0: 656c 662e 6f6e 5f73 686f 7768 6964 655f  elf.on_showhide_
+000068c0: 6c6f 672c 2020 2020 2020 2020 2020 2020  log,            
+000068d0: 6d65 6e75 5f6c 6f67 290d 0a20 2020 2020  menu_log)..     
+000068e0: 2020 2073 656c 662e 4269 6e64 2877 782e     self.Bind(wx.
+000068f0: 4556 545f 4d45 4e55 2c20 7365 6c66 2e6f  EVT_MENU, self.o
+00006900: 6e5f 7368 6f77 6869 6465 5f63 6f6e 736f  n_showhide_conso
+00006910: 6c65 2c20 2020 2020 2020 206d 656e 755f  le,        menu_
+00006920: 636f 6e73 6f6c 6529 0d0a 2020 2020 2020  console)..      
+00006930: 2020 7365 6c66 2e42 696e 6428 7778 2e45    self.Bind(wx.E
+00006940: 5654 5f4d 454e 552c 2073 656c 662e 6f6e  VT_MENU, self.on
+00006950: 5f74 6f67 676c 655f 6175 746f 7570 6461  _toggle_autoupda
+00006960: 7465 5f63 6865 636b 2c20 6d65 6e75 5f61  te_check, menu_a
+00006970: 7574 6f75 7064 6174 655f 6368 6563 6b29  utoupdate_check)
+00006980: 0d0a 2020 2020 2020 2020 7365 6c66 2e42  ..        self.B
+00006990: 696e 6428 7778 2e45 5654 5f4d 454e 552c  ind(wx.EVT_MENU,
+000069a0: 2073 656c 662e 6f6e 5f61 626f 7574 2c20   self.on_about, 
+000069b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000069c0: 2020 6d65 6e75 5f61 626f 7574 290d 0a0d    menu_about)...
+000069d0: 0a0d 0a20 2020 2064 6566 2075 7064 6174  ...    def updat
+000069e0: 655f 6368 6563 6b28 7365 6c66 293a 0d0a  e_check(self):..
+000069f0: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
+00006a00: 2020 2020 2043 6865 636b 7320 666f 7220       Checks for 
+00006a10: 616e 2075 7064 6174 6564 2053 6b79 7065  an updated Skype
+00006a20: 7269 6f75 7320 7665 7273 696f 6e20 6966  rious version if
+00006a30: 2073 7566 6669 6369 656e 7420 7469 6d65   sufficient time
+00006a40: 0d0a 2020 2020 2020 2020 6672 6f6d 206c  ..        from l
+00006a50: 6173 7420 6368 6563 6b20 6861 7320 7061  ast check has pa
+00006a60: 7373 6564 2c20 616e 6420 6f70 656e 7320  ssed, and opens 
+00006a70: 6120 6469 616c 6f67 2066 6f72 2075 7067  a dialog for upg
+00006a80: 7261 6469 6e67 0d0a 2020 2020 2020 2020  rading..        
+00006a90: 6966 206e 6577 2076 6572 7369 6f6e 2061  if new version a
+00006aa0: 7661 696c 6162 6c65 2e20 5363 6865 6475  vailable. Schedu
+00006ab0: 6c65 7320 6120 6e65 7720 6368 6563 6b20  les a new check 
+00006ac0: 6f6e 2064 7565 2064 6174 652e 0d0a 2020  on due date...  
+00006ad0: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
+00006ae0: 2020 2069 6620 6e6f 7420 7365 6c66 206f     if not self o
+00006af0: 7220 6e6f 7420 636f 6e66 2e55 7064 6174  r not conf.Updat
+00006b00: 6543 6865 636b 456e 6162 6c65 6420 6f72  eCheckEnabled or
+00006b10: 206e 6f74 2063 6f6e 662e 5570 6461 7465   not conf.Update
+00006b20: 4368 6563 6b41 7574 6f6d 6174 6963 3a20  CheckAutomatic: 
+00006b30: 7265 7475 726e 0d0a 0d0a 2020 2020 2020  return....      
+00006b40: 2020 696e 7465 7276 616c 203d 2064 6174    interval = dat
+00006b50: 6574 696d 652e 7469 6d65 6465 6c74 6128  etime.timedelta(
+00006b60: 6461 7973 3d63 6f6e 662e 5570 6461 7465  days=conf.Update
+00006b70: 4368 6563 6b49 6e74 6572 7661 6c29 0d0a  CheckInterval)..
+00006b80: 2020 2020 2020 2020 6475 655f 6461 7465          due_date
+00006b90: 203d 2064 6174 6574 696d 652e 6461 7465   = datetime.date
+00006ba0: 7469 6d65 2e6e 6f77 2829 202d 2069 6e74  time.now() - int
+00006bb0: 6572 7661 6c0d 0a20 2020 2020 2020 2069  erval..        i
+00006bc0: 6620 6e6f 7420 2863 6f6e 662e 5769 6e64  f not (conf.Wind
+00006bd0: 6f77 4963 6f6e 697a 6564 206f 7220 7375  owIconized or su
+00006be0: 7070 6f72 742e 7570 6461 7465 5f77 696e  pport.update_win
+00006bf0: 646f 7729 205c 0d0a 2020 2020 2020 2020  dow) \..        
+00006c00: 616e 6420 286e 6f74 2063 6f6e 662e 4c61  and (not conf.La
+00006c10: 7374 5570 6461 7465 4368 6563 6b20 6f72  stUpdateCheck or
+00006c20: 2063 6f6e 662e 4c61 7374 5570 6461 7465   conf.LastUpdate
+00006c30: 4368 6563 6b20 3c20 6475 655f 6461 7465  Check < due_date
+00006c40: 2e73 7472 6674 696d 6528 2225 5925 6d25  .strftime("%Y%m%
+00006c50: 6422 2929 3a0d 0a20 2020 2020 2020 2020  d")):..         
+00006c60: 2020 2063 616c 6c62 6163 6b20 3d20 6c61     callback = la
+00006c70: 6d62 6461 2072 6573 703a 2073 656c 662e  mbda resp: self.
+00006c80: 6f6e 5f63 6865 636b 5f75 7064 6174 655f  on_check_update_
+00006c90: 6361 6c6c 6261 636b 2872 6573 702c 2046  callback(resp, F
+00006ca0: 616c 7365 290d 0a20 2020 2020 2020 2020  alse)..         
+00006cb0: 2020 2073 7570 706f 7274 2e63 6865 636b     support.check
+00006cc0: 5f6e 6577 6573 745f 7665 7273 696f 6e28  _newest_version(
+00006cd0: 6361 6c6c 6261 636b 290d 0a20 2020 2020  callback)..     
+00006ce0: 2020 2065 6c69 6620 6e6f 7420 7375 7070     elif not supp
+00006cf0: 6f72 742e 7570 6461 7465 5f77 696e 646f  ort.update_windo
+00006d00: 7720 616e 6420 636f 6e66 2e4c 6173 7455  w and conf.LastU
+00006d10: 7064 6174 6543 6865 636b 3a0d 0a20 2020  pdateCheck:..   
+00006d20: 2020 2020 2020 2020 2074 7279 3a0d 0a20           try:.. 
+00006d30: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00006d40: 7420 3d20 6461 7465 7469 6d65 2e64 6174  t = datetime.dat
+00006d50: 6574 696d 652e 7374 7270 7469 6d65 2863  etime.strptime(c
+00006d60: 6f6e 662e 4c61 7374 5570 6461 7465 4368  onf.LastUpdateCh
+00006d70: 6563 6b2c 2022 2559 256d 2564 2229 0d0a  eck, "%Y%m%d")..
+00006d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006d90: 696e 7465 7276 616c 203d 2028 6474 202b  interval = (dt +
+00006da0: 2069 6e74 6572 7661 6c29 202d 2064 6174   interval) - dat
+00006db0: 6574 696d 652e 6461 7465 7469 6d65 2e6e  etime.datetime.n
+00006dc0: 6f77 2829 0d0a 2020 2020 2020 2020 2020  ow()..          
+00006dd0: 2020 6578 6365 7074 2028 5479 7065 4572    except (TypeEr
+00006de0: 726f 722c 2056 616c 7565 4572 726f 7229  ror, ValueError)
+00006df0: 3a20 7061 7373 0d0a 0d0a 2020 2020 2020  : pass....      
+00006e00: 2020 2320 5363 6865 6475 6c65 2061 2063    # Schedule a c
+00006e10: 6865 636b 2066 6f72 206e 6578 7420 6475  heck for next du
+00006e20: 6520 6461 7465 2c20 7368 6f75 6c64 2074  e date, should t
+00006e30: 6865 2070 726f 6772 616d 2072 756e 2074  he program run t
+00006e40: 6861 7420 6c6f 6e67 2e0d 0a20 2020 2020  hat long...     
+00006e50: 2020 206d 696c 6c69 7320 3d20 6d69 6e28     millis = min(
+00006e60: 7379 732e 6d61 7873 697a 652c 2075 7469  sys.maxsize, uti
+00006e70: 6c2e 7469 6d65 6465 6c74 615f 7365 636f  l.timedelta_seco
+00006e80: 6e64 7328 696e 7465 7276 616c 2920 2a20  nds(interval) * 
+00006e90: 3130 3030 290d 0a20 2020 2020 2020 2077  1000)..        w
+00006ea0: 782e 4361 6c6c 4c61 7465 7228 6d69 6c6c  x.CallLater(mill
+00006eb0: 6973 2c20 7365 6c66 2e75 7064 6174 655f  is, self.update_
+00006ec0: 6368 6563 6b29 0d0a 0d0a 0d0a 2020 2020  check)......    
+00006ed0: 6465 6620 6f6e 5f74 7261 795f 7365 6172  def on_tray_sear
+00006ee0: 6368 2873 656c 662c 2065 7665 6e74 293a  ch(self, event):
+00006ef0: 0d0a 2020 2020 2020 2020 2222 2248 616e  ..        """Han
+00006f00: 646c 6572 2066 6f72 2073 6561 7263 6869  dler for searchi
+00006f10: 6e67 2066 726f 6d20 7472 6179 2064 6961  ng from tray dia
+00006f20: 6c6f 672c 206c 6175 6e63 6865 7320 7365  log, launches se
+00006f30: 6172 6368 2e22 2222 0d0a 2020 2020 2020  arch."""..      
+00006f40: 2020 6966 2073 656c 662e 6469 616c 6f67    if self.dialog
+00006f50: 5f73 6561 7263 682e 5661 6c75 652e 7374  _search.Value.st
+00006f60: 7269 7028 293a 0d0a 2020 2020 2020 2020  rip():..        
+00006f70: 2020 2020 7365 6c66 2e64 6961 6c6f 675f      self.dialog_
+00006f80: 7365 6172 6368 2e48 6964 6528 290d 0a20  search.Hide().. 
+00006f90: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+00006fa0: 6c66 2e49 7349 636f 6e69 7a65 6428 2920  lf.IsIconized() 
+00006fb0: 616e 6420 6e6f 7420 7365 6c66 2e53 686f  and not self.Sho
+00006fc0: 776e 3a0d 0a20 2020 2020 2020 2020 2020  wn:..           
+00006fd0: 2020 2020 2073 656c 662e 6f6e 5f74 6f67       self.on_tog
+00006fe0: 676c 655f 6963 6f6e 697a 6528 290d 0a20  gle_iconize().. 
+00006ff0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00007000: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00007010: 2020 7365 6c66 2e49 636f 6e69 7a65 2846    self.Iconize(F
+00007020: 616c 7365 292c 2073 656c 662e 5368 6f77  alse), self.Show
+00007030: 2829 2c20 7365 6c66 2e52 6169 7365 2829  (), self.Raise()
+00007040: 0d0a 2020 2020 2020 2020 2020 2020 7061  ..            pa
+00007050: 6765 203d 2073 656c 662e 7061 6765 5f64  ge = self.page_d
+00007060: 625f 6c61 7465 7374 0d0a 2020 2020 2020  b_latest..      
+00007070: 2020 2020 2020 6966 206e 6f74 2070 6167        if not pag
+00007080: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00007090: 2020 2020 6669 6c65 6e61 6d65 203d 2073      filename = s
+000070a0: 656c 662e 6462 5f66 696c 656e 616d 6520  elf.db_filename 
+000070b0: 6e6f 7420 696e 2073 656c 662e 776f 726b  not in self.work
+000070c0: 6572 735f 696d 706f 7274 2061 6e64 2073  ers_import and s
+000070d0: 656c 662e 6462 5f66 696c 656e 616d 650d  elf.db_filename.
+000070e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000070f0: 2069 6620 6e6f 7420 6669 6c65 6e61 6d65   if not filename
+00007100: 3a20 6669 6c65 6e61 6d65 203d 206e 6578  : filename = nex
+00007110: 7428 2878 2066 6f72 2078 2069 6e20 6c69  t((x for x in li
+00007120: 7374 2873 656c 662e 6462 7329 202b 2063  st(self.dbs) + c
+00007130: 6f6e 662e 5265 6365 6e74 4669 6c65 730d  onf.RecentFiles.
+00007140: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007170: 2020 2069 6620 7820 6e6f 7420 696e 2073     if x not in s
+00007180: 656c 662e 776f 726b 6572 735f 696d 706f  elf.workers_impo
+00007190: 7274 292c 204e 6f6e 6529 0d0a 2020 2020  rt), None)..    
+000071a0: 2020 2020 2020 2020 2020 2020 6966 2066              if f
+000071b0: 696c 656e 616d 653a 2070 6167 6520 3d20  ilename: page = 
+000071c0: 7365 6c66 2e6c 6f61 645f 6461 7461 6261  self.load_databa
+000071d0: 7365 5f70 6167 6528 6669 6c65 6e61 6d65  se_page(filename
+000071e0: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
+000071f0: 6620 7061 6765 3a0d 0a20 2020 2020 2020  f page:..       
+00007200: 2020 2020 2020 2020 2070 6167 652e 6564           page.ed
+00007210: 6974 5f73 6561 7263 6861 6c6c 2e56 616c  it_searchall.Val
+00007220: 7565 203d 2073 656c 662e 6469 616c 6f67  ue = self.dialog
+00007230: 5f73 6561 7263 682e 5661 6c75 650d 0a20  _search.Value.. 
+00007240: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00007250: 6167 652e 6f6e 5f73 6561 7263 6861 6c6c  age.on_searchall
+00007260: 284e 6f6e 6529 0d0a 2020 2020 2020 2020  (None)..        
+00007270: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
+00007280: 2072 616e 6765 2873 656c 662e 6e6f 7465   range(self.note
+00007290: 626f 6f6b 2e47 6574 5061 6765 436f 756e  book.GetPageCoun
+000072a0: 7428 2929 3a0d 0a20 2020 2020 2020 2020  t()):..         
+000072b0: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+000072c0: 6c66 2e6e 6f74 6562 6f6f 6b2e 4765 7450  lf.notebook.GetP
+000072d0: 6167 6528 6929 203d 3d20 7061 6765 3a0d  age(i) == page:.
 000072e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000072f0: 2020 2020 2020 2020 2062 7265 616b 2023           break #
-00007300: 2066 6f72 2069 0d0a 2020 2020 2020 2020   for i..        
-00007310: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-00007320: 2020 2020 2020 2020 2020 2077 782e 4d65             wx.Me
-00007330: 7373 6167 6542 6f78 2822 4e6f 2064 6174  ssageBox("No dat
-00007340: 6162 6173 6520 746f 2073 6561 7263 6820  abase to search 
-00007350: 6672 6f6d 2e22 2c20 636f 6e66 2e54 6974  from.", conf.Tit
-00007360: 6c65 290d 0a0d 0a0d 0a20 2020 2064 6566  le)......    def
-00007370: 206f 6e5f 746f 6767 6c65 5f69 636f 6e69   on_toggle_iconi
-00007380: 7a65 2873 656c 662c 2065 7665 6e74 3d4e  ze(self, event=N
-00007390: 6f6e 6529 3a0d 0a20 2020 2020 2020 2022  one):..        "
-000073a0: 2222 4861 6e64 6c65 7220 666f 7220 746f  ""Handler for to
-000073b0: 6767 6c69 6e67 206d 6169 6e20 7769 6e64  ggling main wind
-000073c0: 6f77 2074 6f20 7472 6179 2061 6e64 2062  ow to tray and b
-000073d0: 6163 6b2e 2222 220d 0a20 2020 2020 2020  ack."""..       
-000073e0: 2073 656c 662e 6469 616c 6f67 5f73 6561   self.dialog_sea
-000073f0: 7263 682e 4869 6465 2829 0d0a 2020 2020  rch.Hide()..    
-00007400: 2020 2020 636f 6e66 2e57 696e 646f 7749      conf.WindowI
-00007410: 636f 6e69 7a65 6420 3d20 6e6f 7420 636f  conized = not co
-00007420: 6e66 2e57 696e 646f 7749 636f 6e69 7a65  nf.WindowIconize
-00007430: 640d 0a20 2020 2020 2020 2069 6620 636f  d..        if co
-00007440: 6e66 2e57 696e 646f 7749 636f 6e69 7a65  nf.WindowIconize
-00007450: 643a 0d0a 2020 2020 2020 2020 2020 2020  d:..            
-00007460: 7365 6c66 2e49 636f 6e69 7a65 2829 2c20  self.Iconize(), 
-00007470: 7365 6c66 2e48 6964 6528 290d 0a20 2020  self.Hide()..   
-00007480: 2020 2020 2020 2020 2063 6f6e 662e 5769           conf.Wi
-00007490: 6e64 6f77 506f 7369 7469 6f6e 203d 2073  ndowPosition = s
-000074a0: 656c 662e 506f 7369 7469 6f6e 5b3a 5d0d  elf.Position[:].
-000074b0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000074c0: 6e6f 7420 636f 6e66 2e54 7261 7949 636f  not conf.TrayIco
-000074d0: 6e45 6e61 626c 6564 3a0d 0a20 2020 2020  nEnabled:..     
-000074e0: 2020 2020 2020 2020 2020 2063 6f6e 662e             conf.
-000074f0: 5472 6179 4963 6f6e 456e 6162 6c65 6420  TrayIconEnabled 
-00007500: 3d20 5472 7565 0d0a 2020 2020 2020 2020  = True..        
-00007510: 2020 2020 2020 2020 7365 6c66 2e74 7261          self.tra
-00007520: 7969 636f 6e2e 5365 7449 636f 6e28 7365  yicon.SetIcon(se
-00007530: 6c66 2e54 5241 595f 4943 4f4e 2e49 636f  lf.TRAY_ICON.Ico
-00007540: 6e2c 2063 6f6e 662e 5469 746c 6529 0d0a  n, conf.Title)..
-00007550: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-00007560: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00007570: 4963 6f6e 697a 6528 4661 6c73 6529 2c20  Iconize(False), 
-00007580: 7365 6c66 2e53 686f 7728 292c 2073 656c  self.Show(), sel
-00007590: 662e 5261 6973 6528 290d 0a0d 0a0d 0a20  f.Raise()...... 
-000075a0: 2020 2064 6566 206f 6e5f 746f 6767 6c65     def on_toggle
-000075b0: 5f74 7261 7969 636f 6e28 7365 6c66 2c20  _trayicon(self, 
-000075c0: 6576 656e 743d 4e6f 6e65 293a 0d0a 2020  event=None):..  
-000075d0: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
-000075e0: 2020 2048 616e 646c 6572 2066 6f72 2074     Handler for t
-000075f0: 6f67 676c 696e 6720 7472 6179 2069 636f  oggling tray ico
-00007600: 6e2c 2072 656d 6f76 6573 206f 7220 6164  n, removes or ad
-00007610: 6473 2069 7420 746f 2074 6865 2074 7261  ds it to the tra
-00007620: 7920 6172 6561 2e0d 0a0d 0a20 2020 2020  y area.....     
-00007630: 2020 2040 7061 7261 6d20 2020 6576 656e     @param   even
-00007640: 7420 2069 6620 6e6f 7420 6769 7665 6e20  t  if not given 
-00007650: 6f72 2066 616c 7365 2c20 7472 6179 2069  or false, tray i
-00007660: 636f 6e20 6973 2074 6f67 676c 6564 206f  con is toggled o
-00007670: 6e0d 0a20 2020 2020 2020 2022 2222 0d0a  n..        """..
-00007680: 2020 2020 2020 2020 636f 6e66 2e54 7261          conf.Tra
-00007690: 7949 636f 6e45 6e61 626c 6564 203d 2065  yIconEnabled = e
-000076a0: 7665 6e74 2e49 7343 6865 636b 6564 2829  vent.IsChecked()
-000076b0: 2069 6620 6576 656e 7420 656c 7365 2054   if event else T
-000076c0: 7275 650d 0a20 2020 2020 2020 2073 656c  rue..        sel
-000076d0: 662e 6d65 6e75 5f74 7261 792e 4368 6563  f.menu_tray.Chec
-000076e0: 6b28 636f 6e66 2e54 7261 7949 636f 6e45  k(conf.TrayIconE
-000076f0: 6e61 626c 6564 290d 0a20 2020 2020 2020  nabled)..       
-00007700: 2069 6620 636f 6e66 2e54 7261 7949 636f   if conf.TrayIco
-00007710: 6e45 6e61 626c 6564 3a0d 0a20 2020 2020  nEnabled:..     
-00007720: 2020 2020 2020 2073 656c 662e 7472 6179         self.tray
-00007730: 6963 6f6e 2e53 6574 4963 6f6e 2873 656c  icon.SetIcon(sel
-00007740: 662e 5452 4159 5f49 434f 4e2e 4963 6f6e  f.TRAY_ICON.Icon
-00007750: 2c20 636f 6e66 2e54 6974 6c65 290d 0a20  , conf.Title).. 
-00007760: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-00007770: 2020 2020 2020 2020 2020 7365 6c66 2e74            self.t
-00007780: 7261 7969 636f 6e2e 5265 6d6f 7665 4963  rayicon.RemoveIc
-00007790: 6f6e 2829 0d0a 2020 2020 2020 2020 6966  on()..        if
-000077a0: 2063 6f6e 662e 5769 6e64 6f77 4963 6f6e   conf.WindowIcon
-000077b0: 697a 6564 3a0d 0a20 2020 2020 2020 2020  ized:..         
-000077c0: 2020 2073 656c 662e 6f6e 5f74 6f67 676c     self.on_toggl
-000077d0: 655f 6963 6f6e 697a 6528 290d 0a0d 0a0d  e_iconize().....
-000077e0: 0a20 2020 2064 6566 206f 6e5f 6f70 656e  .    def on_open
-000077f0: 5f74 7261 795f 7365 6172 6368 2873 656c  _tray_search(sel
-00007800: 662c 2065 7665 6e74 293a 0d0a 2020 2020  f, event):..    
-00007810: 2020 2020 2222 224f 7065 6e73 2074 6865      """Opens the
-00007820: 2073 6561 7263 6820 656e 7472 7920 6469   search entry di
-00007830: 616c 6f67 2e22 2222 0d0a 2020 2020 2020  alog."""..      
-00007840: 2020 7365 6c66 2e64 6961 6c6f 675f 7365    self.dialog_se
-00007850: 6172 6368 2e53 686f 7728 6e6f 7420 7365  arch.Show(not se
-00007860: 6c66 2e64 6961 6c6f 675f 7365 6172 6368  lf.dialog_search
-00007870: 2e53 686f 776e 290d 0a0d 0a0d 0a20 2020  .Shown)......   
-00007880: 2064 6566 206f 6e5f 6f70 656e 5f74 7261   def on_open_tra
-00007890: 795f 6d65 6e75 2873 656c 662c 2065 7665  y_menu(self, eve
-000078a0: 6e74 293a 0d0a 2020 2020 2020 2020 2222  nt):..        ""
-000078b0: 2243 7265 6174 6573 2061 6e64 206f 7065  "Creates and ope
-000078c0: 6e73 2061 2070 6f70 7570 206d 656e 7520  ns a popup menu 
-000078d0: 666f 7220 7468 6520 7472 6179 2069 636f  for the tray ico
-000078e0: 6e2e 2222 220d 0a20 2020 2020 2020 206d  n."""..        m
-000078f0: 656e 7520 3d20 7778 2e4d 656e 7528 290d  enu = wx.Menu().
-00007900: 0a20 2020 2020 2020 2069 7465 6d5f 7365  .        item_se
-00007910: 6172 6368 203d 2077 782e 4d65 6e75 4974  arch = wx.MenuIt
-00007920: 656d 286d 656e 752c 202d 312c 2022 2653  em(menu, -1, "&S
-00007930: 6561 7263 6820 666f 722e 2e22 290d 0a20  earch for..").. 
-00007940: 2020 2020 2020 2066 6f6e 7420 3d20 6974         font = it
-00007950: 656d 5f73 6561 7263 682e 466f 6e74 0d0a  em_search.Font..
-00007960: 2020 2020 2020 2020 666f 6e74 2e53 6574          font.Set
-00007970: 5765 6967 6874 2877 782e 464f 4e54 5745  Weight(wx.FONTWE
-00007980: 4947 4854 5f42 4f4c 4429 0d0a 2020 2020  IGHT_BOLD)..    
-00007990: 2020 2020 666f 6e74 2e53 6574 4661 6365      font.SetFace
-000079a0: 4e61 6d65 2873 656c 662e 466f 6e74 2e46  Name(self.Font.F
-000079b0: 6163 654e 616d 6529 0d0a 2020 2020 2020  aceName)..      
-000079c0: 2020 666f 6e74 2e53 6574 506f 696e 7453    font.SetPointS
-000079d0: 697a 6528 7365 6c66 2e46 6f6e 742e 506f  ize(self.Font.Po
-000079e0: 696e 7453 697a 6529 0d0a 2020 2020 2020  intSize)..      
-000079f0: 2020 6974 656d 5f73 6561 7263 682e 466f    item_search.Fo
-00007a00: 6e74 203d 2066 6f6e 740d 0a20 2020 2020  nt = font..     
-00007a10: 2020 206c 6162 656c 203d 205b 224d 696e     label = ["Min
-00007a20: 696d 697a 6520 746f 222c 2022 5265 7374  imize to", "Rest
-00007a30: 6f72 6520 6672 6f6d 225d 5b63 6f6e 662e  ore from"][conf.
-00007a40: 5769 6e64 6f77 4963 6f6e 697a 6564 5d20  WindowIconized] 
-00007a50: 2b20 2220 2674 7261 7922 0d0a 2020 2020  + " &tray"..    
-00007a60: 2020 2020 6974 656d 5f74 6f67 676c 6520      item_toggle 
-00007a70: 3d20 7778 2e4d 656e 7549 7465 6d28 6d65  = wx.MenuItem(me
-00007a80: 6e75 2c20 2d31 2c20 6c61 6265 6c29 0d0a  nu, -1, label)..
-00007a90: 2020 2020 2020 2020 6974 656d 5f69 636f          item_ico
-00007aa0: 6e20 3d20 7778 2e4d 656e 7549 7465 6d28  n = wx.MenuItem(
-00007ab0: 6d65 6e75 2c20 2d31 2c20 6b69 6e64 3d77  menu, -1, kind=w
-00007ac0: 782e 4954 454d 5f43 4845 434b 2c0d 0a20  x.ITEM_CHECK,.. 
-00007ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007ae0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-00007af0: 6578 743d 2253 686f 7720 2669 636f 6e20  ext="Show &icon 
-00007b00: 696e 206e 6f74 6966 6963 6174 696f 6e20  in notification 
-00007b10: 6172 6561 2229 0d0a 2020 2020 2020 2020  area")..        
-00007b20: 6974 656d 5f63 6f6e 736f 6c65 203d 2077  item_console = w
-00007b30: 782e 4d65 6e75 4974 656d 286d 656e 752c  x.MenuItem(menu,
-00007b40: 202d 312c 206b 696e 643d 7778 2e49 5445   -1, kind=wx.ITE
-00007b50: 4d5f 4348 4543 4b2c 0d0a 2020 2020 2020  M_CHECK,..      
-00007b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007b70: 2020 2020 2020 2020 2020 2020 2074 6578               tex
-00007b80: 743d 2253 686f 7720 5079 7468 6f6e 2026  t="Show Python &
-00007b90: 636f 6e73 6f6c 6522 290d 0a20 2020 2020  console")..     
-00007ba0: 2020 2069 7465 6d5f 6578 6974 203d 2077     item_exit = w
-00007bb0: 782e 4d65 6e75 4974 656d 286d 656e 752c  x.MenuItem(menu,
-00007bc0: 202d 312c 2022 4526 7869 7420 2573 2220   -1, "E&xit %s" 
-00007bd0: 2520 636f 6e66 2e54 6974 6c65 290d 0a0d  % conf.Title)...
-00007be0: 0a20 2020 2020 2020 206d 656e 752e 4170  .        menu.Ap
-00007bf0: 7065 6e64 2869 7465 6d5f 7365 6172 6368  pend(item_search
-00007c00: 290d 0a20 2020 2020 2020 206d 656e 752e  )..        menu.
-00007c10: 4170 7065 6e64 2869 7465 6d5f 746f 6767  Append(item_togg
-00007c20: 6c65 290d 0a20 2020 2020 2020 206d 656e  le)..        men
-00007c30: 752e 4170 7065 6e64 5365 7061 7261 746f  u.AppendSeparato
-00007c40: 7228 290d 0a20 2020 2020 2020 206d 656e  r()..        men
-00007c50: 752e 4170 7065 6e64 2869 7465 6d5f 6963  u.Append(item_ic
-00007c60: 6f6e 290d 0a20 2020 2020 2020 206d 656e  on)..        men
-00007c70: 752e 4170 7065 6e64 2869 7465 6d5f 636f  u.Append(item_co
-00007c80: 6e73 6f6c 6529 0d0a 2020 2020 2020 2020  nsole)..        
-00007c90: 6d65 6e75 2e41 7070 656e 6453 6570 6172  menu.AppendSepar
-00007ca0: 6174 6f72 2829 0d0a 2020 2020 2020 2020  ator()..        
-00007cb0: 6d65 6e75 2e41 7070 656e 6428 6974 656d  menu.Append(item
-00007cc0: 5f65 7869 7429 0d0a 2020 2020 2020 2020  _exit)..        
-00007cd0: 6974 656d 5f69 636f 6e2e 4368 6563 6b28  item_icon.Check(
-00007ce0: 5472 7565 290d 0a20 2020 2020 2020 2069  True)..        i
-00007cf0: 7465 6d5f 636f 6e73 6f6c 652e 4368 6563  tem_console.Chec
-00007d00: 6b28 7365 6c66 2e66 7261 6d65 5f63 6f6e  k(self.frame_con
-00007d10: 736f 6c65 2e53 686f 776e 290d 0a0d 0a20  sole.Shown).... 
-00007d20: 2020 2020 2020 206d 656e 752e 4269 6e64         menu.Bind
-00007d30: 2877 782e 4556 545f 4d45 4e55 2c20 7365  (wx.EVT_MENU, se
-00007d40: 6c66 2e6f 6e5f 6f70 656e 5f74 7261 795f  lf.on_open_tray_
-00007d50: 7365 6172 6368 2c20 6964 3d69 7465 6d5f  search, id=item_
-00007d60: 7365 6172 6368 2e47 6574 4964 2829 290d  search.GetId()).
-00007d70: 0a20 2020 2020 2020 206d 656e 752e 4269  .        menu.Bi
-00007d80: 6e64 2877 782e 4556 545f 4d45 4e55 2c20  nd(wx.EVT_MENU, 
-00007d90: 7365 6c66 2e6f 6e5f 746f 6767 6c65 5f69  self.on_toggle_i
-00007da0: 636f 6e69 7a65 2c20 6964 3d69 7465 6d5f  conize, id=item_
-00007db0: 746f 6767 6c65 2e47 6574 4964 2829 290d  toggle.GetId()).
-00007dc0: 0a20 2020 2020 2020 206d 656e 752e 4269  .        menu.Bi
-00007dd0: 6e64 2877 782e 4556 545f 4d45 4e55 2c20  nd(wx.EVT_MENU, 
-00007de0: 7365 6c66 2e6f 6e5f 746f 6767 6c65 5f74  self.on_toggle_t
-00007df0: 7261 7969 636f 6e2c 2069 643d 6974 656d  rayicon, id=item
-00007e00: 5f69 636f 6e2e 4765 7449 6428 2929 0d0a  _icon.GetId())..
-00007e10: 2020 2020 2020 2020 6d65 6e75 2e42 696e          menu.Bin
-00007e20: 6428 7778 2e45 5654 5f4d 454e 552c 2073  d(wx.EVT_MENU, s
-00007e30: 656c 662e 6f6e 5f73 686f 7768 6964 655f  elf.on_showhide_
-00007e40: 636f 6e73 6f6c 652c 2069 643d 6974 656d  console, id=item
-00007e50: 5f63 6f6e 736f 6c65 2e47 6574 4964 2829  _console.GetId()
-00007e60: 290d 0a20 2020 2020 2020 206d 656e 752e  )..        menu.
-00007e70: 4269 6e64 2877 782e 4556 545f 4d45 4e55  Bind(wx.EVT_MENU
-00007e80: 2c20 7365 6c66 2e6f 6e5f 6578 6974 2c20  , self.on_exit, 
-00007e90: 6964 3d69 7465 6d5f 6578 6974 2e47 6574  id=item_exit.Get
-00007ea0: 4964 2829 290d 0a20 2020 2020 2020 2073  Id())..        s
-00007eb0: 656c 662e 7472 6179 6963 6f6e 2e50 6f70  elf.trayicon.Pop
-00007ec0: 7570 4d65 6e75 286d 656e 7529 0d0a 0d0a  upMenu(menu)....
-00007ed0: 0d0a 2020 2020 6465 6620 6f6e 5f63 6861  ..    def on_cha
-00007ee0: 6e67 655f 7061 6765 2873 656c 662c 2065  nge_page(self, e
-00007ef0: 7665 6e74 293a 0d0a 2020 2020 2020 2020  vent):..        
-00007f00: 2222 220d 0a20 2020 2020 2020 2048 616e  """..        Han
-00007f10: 646c 6572 2066 6f72 2063 6861 6e67 696e  dler for changin
-00007f20: 6720 6120 7061 6765 2069 6e20 7468 6520  g a page in the 
-00007f30: 6d61 696e 204e 6f74 6562 6f6f 6b2c 2072  main Notebook, r
-00007f40: 656d 656d 6265 7273 2074 6865 2076 6973  emembers the vis
-00007f50: 6974 2e0d 0a20 2020 2020 2020 2022 2222  it...        """
-00007f60: 0d0a 2020 2020 2020 2020 7020 3d20 7365  ..        p = se
-00007f70: 6c66 2e6e 6f74 6562 6f6f 6b2e 4765 7450  lf.notebook.GetP
-00007f80: 6167 6528 7365 6c66 2e6e 6f74 6562 6f6f  age(self.noteboo
-00007f90: 6b2e 4765 7453 656c 6563 7469 6f6e 2829  k.GetSelection()
-00007fa0: 290d 0a20 2020 2020 2020 2069 6620 6e6f  )..        if no
-00007fb0: 7420 7365 6c66 2e70 6167 6573 5f76 6973  t self.pages_vis
-00007fc0: 6974 6564 206f 7220 7365 6c66 2e70 6167  ited or self.pag
-00007fd0: 6573 5f76 6973 6974 6564 5b2d 315d 2021  es_visited[-1] !
-00007fe0: 3d20 703a 0d0a 2020 2020 2020 2020 2020  = p:..          
-00007ff0: 2020 7365 6c66 2e70 6167 6573 5f76 6973    self.pages_vis
-00008000: 6974 6564 2e61 7070 656e 6428 7029 0d0a  ited.append(p)..
-00008010: 2020 2020 2020 2020 7365 6c66 2e54 6974          self.Tit
-00008020: 6c65 203d 2063 6f6e 662e 5469 746c 650d  le = conf.Title.
-00008030: 0a20 2020 2020 2020 2069 6620 6861 7361  .        if hasa
-00008040: 7474 7228 702c 2022 7469 746c 6522 293a  ttr(p, "title"):
-00008050: 0d0a 2020 2020 2020 2020 2020 2020 7375  ..            su
-00008060: 6274 6974 6c65 203d 2070 2e74 6974 6c65  btitle = p.title
-00008070: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00008080: 2069 7369 6e73 7461 6e63 6528 702c 2044   isinstance(p, D
-00008090: 6174 6162 6173 6550 6167 6529 3a20 2320  atabasePage): # 
-000080a0: 5573 6520 7061 7265 6e74 2f66 696c 652e  Use parent/file.
-000080b0: 6462 206f 7220 433a 2f66 696c 652e 6462  db or C:/file.db
-000080c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000080d0: 2020 7061 7468 2c20 6669 6c65 203d 206f    path, file = o
-000080e0: 732e 7061 7468 2e73 706c 6974 2870 2e64  s.path.split(p.d
-000080f0: 622e 6669 6c65 6e61 6d65 290d 0a20 2020  b.filename)..   
-00008100: 2020 2020 2020 2020 2020 2020 2073 7562               sub
-00008110: 7469 746c 6520 3d20 6f73 2e70 6174 682e  title = os.path.
-00008120: 6a6f 696e 286f 732e 7061 7468 2e73 706c  join(os.path.spl
-00008130: 6974 2870 6174 6829 5b2d 315d 206f 7220  it(path)[-1] or 
-00008140: 7061 7468 2c20 6669 6c65 290d 0a20 2020  path, file)..   
-00008150: 2020 2020 2020 2020 2073 656c 662e 5469           self.Ti
-00008160: 746c 6520 2b3d 2022 202d 2022 202b 2073  tle += " - " + s
-00008170: 7562 7469 746c 650d 0a20 2020 2020 2020  ubtitle..       
-00008180: 2073 656c 662e 7570 6461 7465 5f6e 6f74   self.update_not
-00008190: 6562 6f6f 6b5f 6865 6164 6572 2829 0d0a  ebook_header()..
-000081a0: 2020 2020 2020 2020 6966 2065 7665 6e74          if event
-000081b0: 3a20 6576 656e 742e 536b 6970 2829 2023  : event.Skip() #
-000081c0: 2050 6173 7320 6576 656e 7420 616c 6f6e   Pass event alon
-000081d0: 6720 746f 206e 6578 7420 6861 6e64 6c65  g to next handle
-000081e0: 720d 0a0d 0a0d 0a20 2020 2064 6566 206f  r......    def o
-000081f0: 6e5f 7369 7a65 2873 656c 662c 2065 7665  n_size(self, eve
-00008200: 6e74 293a 0d0a 2020 2020 2020 2020 2222  nt):..        ""
-00008210: 2248 616e 646c 6572 2066 6f72 2077 696e  "Handler for win
-00008220: 646f 7720 7369 7a65 2065 7665 6e74 2c20  dow size event, 
-00008230: 7477 6561 6b73 2063 6f6e 7472 6f6c 7320  tweaks controls 
-00008240: 616e 6420 7361 7665 7320 7369 7a65 2e22  and saves size."
-00008250: 2222 0d0a 2020 2020 2020 2020 6576 656e  ""..        even
-00008260: 742e 536b 6970 2829 0d0a 2020 2020 2020  t.Skip()..      
-00008270: 2020 636f 6e66 2e57 696e 646f 7753 697a    conf.WindowSiz
-00008280: 6520 3d20 5b2d 312c 202d 315d 2069 6620  e = [-1, -1] if 
-00008290: 7365 6c66 2e49 734d 6178 696d 697a 6564  self.IsMaximized
-000082a0: 2829 2065 6c73 6520 7365 6c66 2e53 697a  () else self.Siz
-000082b0: 655b 3a5d 0d0a 2020 2020 2020 2020 7574  e[:]..        ut
-000082c0: 696c 2e72 756e 5f6f 6e63 6528 636f 6e66  il.run_once(conf
-000082d0: 2e73 6176 6529 0d0a 2020 2020 2020 2020  .save)..        
-000082e0: 7365 6c66 2e6c 6973 745f 6462 2e53 656e  self.list_db.Sen
-000082f0: 6453 697a 6545 7665 6e74 2829 0d0a 0d0a  dSizeEvent()....
-00008300: 0d0a 2020 2020 6465 6620 6f6e 5f6d 6f76  ..    def on_mov
-00008310: 6528 7365 6c66 2c20 6576 656e 7429 3a0d  e(self, event):.
-00008320: 0a20 2020 2020 2020 2022 2222 4861 6e64  .        """Hand
-00008330: 6c65 7220 666f 7220 7769 6e64 6f77 206d  ler for window m
-00008340: 6f76 6520 6576 656e 742c 2073 6176 6573  ove event, saves
-00008350: 2070 6f73 6974 696f 6e2e 2222 220d 0a20   position.""".. 
-00008360: 2020 2020 2020 2065 7665 6e74 2e53 6b69         event.Ski
-00008370: 7028 290d 0a20 2020 2020 2020 2069 6620  p()..        if 
-00008380: 6e6f 7420 7365 6c66 2e49 7349 636f 6e69  not self.IsIconi
-00008390: 7a65 6428 293a 0d0a 2020 2020 2020 2020  zed():..        
-000083a0: 2020 2020 636f 6e66 2e57 696e 646f 7750      conf.WindowP
-000083b0: 6f73 6974 696f 6e20 3d20 6576 656e 742e  osition = event.
-000083c0: 506f 7369 7469 6f6e 5b3a 5d0d 0a20 2020  Position[:]..   
-000083d0: 2020 2020 2020 2020 2075 7469 6c2e 7275           util.ru
-000083e0: 6e5f 6f6e 6365 2863 6f6e 662e 7361 7665  n_once(conf.save
-000083f0: 290d 0a0d 0a0d 0a20 2020 2064 6566 206f  )......    def o
-00008400: 6e5f 7379 735f 636f 6c6f 7572 5f63 6861  n_sys_colour_cha
-00008410: 6e67 6528 7365 6c66 2c20 6576 656e 7429  nge(self, event)
-00008420: 3a0d 0a20 2020 2020 2020 2022 2222 4861  :..        """Ha
-00008430: 6e64 6c65 7220 666f 7220 7379 7374 656d  ndler for system
-00008440: 2063 6f6c 6f75 7220 6368 616e 6765 2c20   colour change, 
-00008450: 7570 6461 7465 7320 6669 6c65 7379 7374  updates filesyst
-00008460: 656d 2069 6d61 6765 732e 2222 220d 0a20  em images.""".. 
-00008470: 2020 2020 2020 2065 7665 6e74 2e53 6b69         event.Ski
-00008480: 7028 290d 0a20 2020 2020 2020 2073 656c  p()..        sel
-00008490: 662e 6164 6170 745f 636f 6c6f 7572 7328  f.adapt_colours(
-000084a0: 290d 0a20 2020 2020 2020 2064 6566 2061  )..        def a
-000084b0: 6674 6572 2829 3a0d 0a20 2020 2020 2020  fter():..       
-000084c0: 2020 2020 2073 656c 662e 6c6f 6164 5f66       self.load_f
-000084d0: 735f 696d 6167 6573 2829 0d0a 2020 2020  s_images()..    
-000084e0: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
-000084f0: 2072 616e 6765 2873 656c 662e 6c69 7374   range(self.list
-00008500: 5f64 622e 4765 7449 7465 6d43 6f75 6e74  _db.GetItemCount
-00008510: 2829 293a 0d0a 2020 2020 2020 2020 2020  ()):..          
-00008520: 2020 2020 2020 7365 6c66 2e6c 6973 745f        self.list_
-00008530: 6462 2e53 6574 4974 656d 5465 7874 436f  db.SetItemTextCo
-00008540: 6c6f 7572 2869 2c20 2020 2020 2020 7365  lour(i,       se
-00008550: 6c66 2e6c 6973 745f 6462 2e46 6f72 6567  lf.list_db.Foreg
-00008560: 726f 756e 6443 6f6c 6f75 7229 0d0a 2020  roundColour)..  
-00008570: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00008580: 6c66 2e6c 6973 745f 6462 2e53 6574 4974  lf.list_db.SetIt
-00008590: 656d 4261 636b 6772 6f75 6e64 436f 6c6f  emBackgroundColo
-000085a0: 7572 2869 2c20 7365 6c66 2e6c 6973 745f  ur(i, self.list_
-000085b0: 6462 2e42 6163 6b67 726f 756e 6443 6f6c  db.BackgroundCol
-000085c0: 6f75 7229 0d0a 2020 2020 2020 2020 7778  our)..        wx
-000085d0: 2e43 616c 6c41 6674 6572 2861 6674 6572  .CallAfter(after
-000085e0: 2920 2320 506f 7374 706f 6e65 2074 6f20  ) # Postpone to 
-000085f0: 616c 6c6f 7720 636f 6e66 2075 7064 6174  allow conf updat
-00008600: 650d 0a0d 0a0d 0a20 2020 2064 6566 2061  e......    def a
-00008610: 6461 7074 5f63 6f6c 6f75 7273 2873 656c  dapt_colours(sel
-00008620: 6629 3a0d 0a20 2020 2020 2020 2022 2222  f):..        """
-00008630: 4164 6170 7473 2063 6f6e 6669 6775 7261  Adapts configura
-00008640: 7469 6f6e 2063 6f6c 6f75 7273 2074 6f20  tion colours to 
-00008650: 6265 7474 6572 2066 6974 2063 7572 7265  better fit curre
-00008660: 6e74 2074 6865 6d65 2e22 2222 0d0a 2020  nt theme."""..  
-00008670: 2020 2020 2020 434f 4c4f 5552 5320 3d20        COLOURS = 
-00008680: 5b22 4772 6964 526f 7749 6e73 6572 7465  ["GridRowInserte
-00008690: 6443 6f6c 6f75 7222 2c20 2247 7269 6452  dColour", "GridR
-000086a0: 6f77 4368 616e 6765 6443 6f6c 6f75 7222  owChangedColour"
-000086b0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-000086c0: 2020 2020 2020 2247 7269 6443 656c 6c43        "GridCellC
-000086d0: 6861 6e67 6564 436f 6c6f 7572 225d 0d0a  hangedColour"]..
-000086e0: 2020 2020 2020 2020 6672 6762 203d 2074          frgb = t
-000086f0: 7570 6c65 2843 6f6c 6f75 724d 616e 6167  uple(ColourManag
-00008700: 6572 2e47 6574 436f 6c6f 7572 2877 782e  er.GetColour(wx.
-00008710: 5359 535f 434f 4c4f 5552 5f42 544e 5445  SYS_COLOUR_BTNTE
-00008720: 5854 2929 5b3a 335d 0d0a 2020 2020 2020  XT))[:3]..      
-00008730: 2020 6272 6762 203d 2074 7570 6c65 2843    brgb = tuple(C
-00008740: 6f6c 6f75 724d 616e 6167 6572 2e47 6574  olourManager.Get
-00008750: 436f 6c6f 7572 2877 782e 5359 535f 434f  Colour(wx.SYS_CO
-00008760: 4c4f 5552 5f57 494e 444f 5720 2929 5b3a  LOUR_WINDOW ))[:
-00008770: 335d 0d0a 2020 2020 2020 2020 666f 7220  3]..        for 
-00008780: 6e20 696e 2043 4f4c 4f55 5253 3a0d 0a20  n in COLOURS:.. 
-00008790: 2020 2020 2020 2020 2020 2072 6762 203d             rgb =
-000087a0: 2074 7570 6c65 2877 782e 436f 6c6f 7572   tuple(wx.Colour
-000087b0: 2863 6f6e 662e 4465 6661 756c 7473 2e67  (conf.Defaults.g
-000087c0: 6574 286e 2929 295b 3a33 5d0d 0a20 2020  et(n)))[:3]..   
-000087d0: 2020 2020 2020 2020 2064 656c 7461 203d           delta =
-000087e0: 2074 7570 6c65 2832 3535 202d 2078 2066   tuple(255 - x f
-000087f0: 6f72 2078 2069 6e20 7267 6229 0d0a 2020  or x in rgb)..  
-00008800: 2020 2020 2020 2020 2020 6469 7265 6374            direct
-00008810: 696f 6e20 3d20 3120 6966 2028 7375 6d28  ion = 1 if (sum(
-00008820: 6672 6762 2920 3e20 7375 6d28 6272 6762  frgb) > sum(brgb
-00008830: 2929 2065 6c73 6520 2d31 0d0a 2020 2020  )) else -1..    
-00008840: 2020 2020 2020 2020 7267 6232 203d 2074          rgb2 = t
-00008850: 7570 6c65 2861 202b 2069 6e74 2862 202a  uple(a + int(b *
-00008860: 2064 6972 6563 7469 6f6e 2920 666f 7220   direction) for 
-00008870: 612c 2062 2069 6e20 7a69 7028 6272 6762  a, b in zip(brgb
-00008880: 2c20 6465 6c74 6129 290d 0a20 2020 2020  , delta))..     
-00008890: 2020 2020 2020 2072 6762 3220 3d20 7475         rgb2 = tu
-000088a0: 706c 6528 6d69 6e28 3235 352c 206d 6178  ple(min(255, max
-000088b0: 2830 2c20 7829 2920 666f 7220 7820 696e  (0, x)) for x in
-000088c0: 2072 6762 3229 0d0a 2020 2020 2020 2020   rgb2)..        
-000088d0: 2020 2020 7365 7461 7474 7228 636f 6e66      setattr(conf
-000088e0: 2c20 6e2c 2077 782e 436f 6c6f 7572 2872  , n, wx.Colour(r
-000088f0: 6762 3229 2e47 6574 4173 5374 7269 6e67  gb2).GetAsString
-00008900: 2877 782e 4332 535f 4854 4d4c 5f53 594e  (wx.C2S_HTML_SYN
-00008910: 5441 5829 290d 0a0d 0a0d 0a20 2020 2064  TAX))......    d
-00008920: 6566 206c 6f61 645f 6673 5f69 6d61 6765  ef load_fs_image
-00008930: 7328 7365 6c66 293a 0d0a 2020 2020 2020  s(self):..      
-00008940: 2020 2222 224c 6f61 6473 2063 6f6e 7465    """Loads conte
-00008950: 6e74 2074 6f20 4d65 6d6f 7279 4653 2e22  nt to MemoryFS."
-00008960: 2222 0d0a 2020 2020 2020 2020 6966 206e  ""..        if n
-00008970: 6f74 2073 656c 663a 2072 6574 7572 6e0d  ot self: return.
-00008980: 0a20 2020 2020 2020 2061 626f 7574 6963  .        aboutic
-00008990: 6f6e 203d 2022 2573 2e70 6e67 2220 2520  on = "%s.png" % 
-000089a0: 636f 6e66 2e54 6974 6c65 2e6c 6f77 6572  conf.Title.lower
-000089b0: 2829 2023 2050 726f 6772 616d 2069 636f  () # Program ico
-000089c0: 6e20 7368 6f77 6e20 696e 2041 626f 7574  n shown in About
-000089d0: 2077 696e 646f 770d 0a20 2020 2020 2020   window..       
-000089e0: 2069 6d67 203d 2069 6d61 6765 732e 4963   img = images.Ic
-000089f0: 6f6e 3438 7834 385f 3332 6269 742e 496d  on48x48_32bit.Im
-00008a00: 6167 650d 0a20 2020 2020 2020 2069 6620  age..        if 
-00008a10: 6162 6f75 7469 636f 6e20 696e 2073 656c  abouticon in sel
-00008a20: 662e 6d65 6d6f 7279 6673 5b22 6669 6c65  f.memoryfs["file
-00008a30: 7322 5d3a 0d0a 2020 2020 2020 2020 2020  s"]:..          
-00008a40: 2020 7365 6c66 2e6d 656d 6f72 7966 735b    self.memoryfs[
-00008a50: 2268 616e 646c 6572 225d 2e52 656d 6f76  "handler"].Remov
-00008a60: 6546 696c 6528 6162 6f75 7469 636f 6e29  eFile(abouticon)
-00008a70: 0d0a 2020 2020 2020 2020 7365 6c66 2e6d  ..        self.m
-00008a80: 656d 6f72 7966 735b 2268 616e 646c 6572  emoryfs["handler
-00008a90: 225d 2e41 6464 4669 6c65 2861 626f 7574  "].AddFile(about
-00008aa0: 6963 6f6e 2c20 696d 672c 2077 782e 4249  icon, img, wx.BI
-00008ab0: 544d 4150 5f54 5950 455f 504e 4729 0d0a  TMAP_TYPE_PNG)..
-00008ac0: 2020 2020 2020 2020 7365 6c66 2e6d 656d          self.mem
-00008ad0: 6f72 7966 735b 2266 696c 6573 225d 5b61  oryfs["files"][a
-00008ae0: 626f 7574 6963 6f6e 5d20 3d20 310d 0a0d  bouticon] = 1...
-00008af0: 0a20 2020 2020 2020 2066 6e20 3d20 2262  .        fn = "b
-00008b00: 6c61 6e6b 2e67 6966 220d 0a20 2020 2020  lank.gif"..     
-00008b10: 2020 2069 6620 666e 206e 6f74 2069 6e20     if fn not in 
-00008b20: 7365 6c66 2e6d 656d 6f72 7966 735b 2266  self.memoryfs["f
-00008b30: 696c 6573 225d 3a0d 0a20 2020 2020 2020  iles"]:..       
-00008b40: 2020 2020 2069 6d67 203d 2069 6d61 6765       img = image
-00008b50: 732e 5472 616e 7370 6172 656e 7450 6978  s.TransparentPix
-00008b60: 656c 2e49 6d61 6765 0d0a 2020 2020 2020  el.Image..      
-00008b70: 2020 2020 2020 7365 6c66 2e6d 656d 6f72        self.memor
-00008b80: 7966 735b 2268 616e 646c 6572 225d 2e41  yfs["handler"].A
-00008b90: 6464 4669 6c65 2866 6e2c 2069 6d67 2c20  ddFile(fn, img, 
-00008ba0: 7778 2e42 4954 4d41 505f 5459 5045 5f47  wx.BITMAP_TYPE_G
-00008bb0: 4946 290d 0a20 2020 2020 2020 2020 2020  IF)..           
-00008bc0: 2073 656c 662e 6d65 6d6f 7279 6673 5b22   self.memoryfs["
-00008bd0: 6669 6c65 7322 5d5b 666e 5d20 3d20 310d  files"][fn] = 1.
-00008be0: 0a0d 0a20 2020 2020 2020 2023 2053 6372  ...        # Scr
-00008bf0: 6565 6e73 686f 7473 206c 6f6f 6b20 6265  eenshots look be
-00008c00: 7474 6572 2077 6974 6820 636f 6c6f 7572  tter with colour
-00008c10: 696e 6720 6966 2073 7973 7465 6d20 6861  ing if system ha
-00008c20: 7320 6f66 662d 7768 6974 6520 636f 6c6f  s off-white colo
-00008c30: 7572 0d0a 2020 2020 2020 2020 7469 6e74  ur..        tint
-00008c40: 5f63 6f6c 6f75 7220 3d20 7778 2e43 6f6c  _colour = wx.Col
-00008c50: 6f75 7228 636f 6e66 2e42 6743 6f6c 6f75  our(conf.BgColou
-00008c60: 7229 0d0a 2020 2020 2020 2020 7469 6e74  r)..        tint
-00008c70: 5f66 6163 746f 7220 3d20 5b28 2834 202a  _factor = [((4 *
-00008c80: 2078 2920 2520 3235 3629 202f 2032 3535   x) % 256) / 255
-00008c90: 2e20 666f 7220 7820 696e 2074 696e 745f  . for x in tint_
-00008ca0: 636f 6c6f 7572 5d0d 0a20 2020 2020 2020  colour]..       
-00008cb0: 2023 2049 6d61 6765 7320 7368 6f77 6e20   # Images shown 
-00008cc0: 6f6e 2074 6865 2064 6566 6175 6c74 2073  on the default s
-00008cd0: 6561 7263 6820 636f 6e74 656e 7420 7061  earch content pa
-00008ce0: 6765 0d0a 2020 2020 2020 2020 666f 7220  ge..        for 
-00008cf0: 6e61 6d65 2069 6e20 5b22 4865 6c70 5365  name in ["HelpSe
-00008d00: 6172 6368 222c 2022 4865 6c70 4368 6174  arch", "HelpChat
-00008d10: 7322 2c20 2248 656c 7043 6f6e 7461 6374  s", "HelpContact
-00008d20: 7322 2c20 2248 656c 7049 6e66 6f22 2c20  s", "HelpInfo", 
-00008d30: 2248 656c 7054 6162 6c65 7322 2c0d 0a20  "HelpTables",.. 
-00008d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008d50: 2020 2020 2248 656c 7053 514c 222c 2022      "HelpSQL", "
-00008d60: 4865 6c70 4f6e 6c69 6e65 225d 3a0d 0a20  HelpOnline"]:.. 
-00008d70: 2020 2020 2020 2020 2020 2065 6d62 6564             embed
-00008d80: 6465 6420 3d20 6765 7461 7474 7228 696d  ded = getattr(im
-00008d90: 6167 6573 2c20 6e61 6d65 2c20 4e6f 6e65  ages, name, None
-00008da0: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
-00008db0: 6620 6e6f 7420 656d 6265 6464 6564 3a20  f not embedded: 
-00008dc0: 636f 6e74 696e 7565 2023 2066 6f72 206e  continue # for n
-00008dd0: 616d 650d 0a20 2020 2020 2020 2020 2020  ame..           
-00008de0: 2069 6d67 203d 2065 6d62 6564 6465 642e   img = embedded.
-00008df0: 496d 6167 652e 4164 6a75 7374 4368 616e  Image.AdjustChan
-00008e00: 6e65 6c73 282a 7469 6e74 5f66 6163 746f  nels(*tint_facto
-00008e10: 7229 0d0a 2020 2020 2020 2020 2020 2020  r)..            
-00008e20: 6669 6c65 6e61 6d65 203d 2022 2573 2e70  filename = "%s.p
-00008e30: 6e67 2220 2520 6e61 6d65 0d0a 2020 2020  ng" % name..    
-00008e40: 2020 2020 2020 2020 6966 2066 696c 656e          if filen
-00008e50: 616d 6520 696e 2073 656c 662e 6d65 6d6f  ame in self.memo
-00008e60: 7279 6673 5b22 6669 6c65 7322 5d3a 0d0a  ryfs["files"]:..
-00008e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008e80: 7365 6c66 2e6d 656d 6f72 7966 735b 2268  self.memoryfs["h
-00008e90: 616e 646c 6572 225d 2e52 656d 6f76 6546  andler"].RemoveF
-00008ea0: 696c 6528 6669 6c65 6e61 6d65 290d 0a20  ile(filename).. 
-00008eb0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00008ec0: 6d65 6d6f 7279 6673 5b22 6861 6e64 6c65  memoryfs["handle
-00008ed0: 7222 5d2e 4164 6446 696c 6528 6669 6c65  r"].AddFile(file
-00008ee0: 6e61 6d65 2c20 696d 672c 2077 782e 4249  name, img, wx.BI
-00008ef0: 544d 4150 5f54 5950 455f 504e 4729 0d0a  TMAP_TYPE_PNG)..
-00008f00: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000072f0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+00007300: 2e6e 6f74 6562 6f6f 6b2e 4765 7453 656c  .notebook.GetSel
+00007310: 6563 7469 6f6e 2829 2021 3d20 693a 0d0a  ection() != i:..
+00007320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007330: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00007340: 2e6e 6f74 6562 6f6f 6b2e 5365 7453 656c  .notebook.SetSel
+00007350: 6563 7469 6f6e 2869 290d 0a20 2020 2020  ection(i)..     
+00007360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007370: 2020 2020 2020 2073 656c 662e 7570 6461         self.upda
+00007380: 7465 5f6e 6f74 6562 6f6f 6b5f 6865 6164  te_notebook_head
+00007390: 6572 2829 0d0a 2020 2020 2020 2020 2020  er()..          
+000073a0: 2020 2020 2020 2020 2020 2020 2020 6272                br
+000073b0: 6561 6b20 2320 666f 7220 690d 0a20 2020  eak # for i..   
+000073c0: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
+000073d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000073e0: 7778 2e4d 6573 7361 6765 426f 7828 224e  wx.MessageBox("N
+000073f0: 6f20 6461 7461 6261 7365 2074 6f20 7365  o database to se
+00007400: 6172 6368 2066 726f 6d2e 222c 2063 6f6e  arch from.", con
+00007410: 662e 5469 746c 6529 0d0a 0d0a 0d0a 2020  f.Title)......  
+00007420: 2020 6465 6620 6f6e 5f74 6f67 676c 655f    def on_toggle_
+00007430: 6963 6f6e 697a 6528 7365 6c66 2c20 6576  iconize(self, ev
+00007440: 656e 743d 4e6f 6e65 293a 0d0a 2020 2020  ent=None):..    
+00007450: 2020 2020 2222 2248 616e 646c 6572 2066      """Handler f
+00007460: 6f72 2074 6f67 676c 696e 6720 6d61 696e  or toggling main
+00007470: 2077 696e 646f 7720 746f 2074 7261 7920   window to tray 
+00007480: 616e 6420 6261 636b 2e22 2222 0d0a 2020  and back."""..  
+00007490: 2020 2020 2020 7365 6c66 2e64 6961 6c6f        self.dialo
+000074a0: 675f 7365 6172 6368 2e48 6964 6528 290d  g_search.Hide().
+000074b0: 0a20 2020 2020 2020 2063 6f6e 662e 5769  .        conf.Wi
+000074c0: 6e64 6f77 4963 6f6e 697a 6564 203d 206e  ndowIconized = n
+000074d0: 6f74 2063 6f6e 662e 5769 6e64 6f77 4963  ot conf.WindowIc
+000074e0: 6f6e 697a 6564 0d0a 2020 2020 2020 2020  onized..        
+000074f0: 6966 2063 6f6e 662e 5769 6e64 6f77 4963  if conf.WindowIc
+00007500: 6f6e 697a 6564 3a0d 0a20 2020 2020 2020  onized:..       
+00007510: 2020 2020 2073 656c 662e 4963 6f6e 697a       self.Iconiz
+00007520: 6528 292c 2073 656c 662e 4869 6465 2829  e(), self.Hide()
+00007530: 0d0a 2020 2020 2020 2020 2020 2020 636f  ..            co
+00007540: 6e66 2e57 696e 646f 7750 6f73 6974 696f  nf.WindowPositio
+00007550: 6e20 3d20 7365 6c66 2e50 6f73 6974 696f  n = self.Positio
+00007560: 6e5b 3a5d 0d0a 2020 2020 2020 2020 2020  n[:]..          
+00007570: 2020 6966 206e 6f74 2063 6f6e 662e 5472    if not conf.Tr
+00007580: 6179 4963 6f6e 456e 6162 6c65 643a 0d0a  ayIconEnabled:..
+00007590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000075a0: 636f 6e66 2e54 7261 7949 636f 6e45 6e61  conf.TrayIconEna
+000075b0: 626c 6564 203d 2054 7275 650d 0a20 2020  bled = True..   
+000075c0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+000075d0: 662e 7472 6179 6963 6f6e 2e53 6574 4963  f.trayicon.SetIc
+000075e0: 6f6e 2873 656c 662e 5452 4159 5f49 434f  on(self.TRAY_ICO
+000075f0: 4e2e 4963 6f6e 2c20 636f 6e66 2e54 6974  N.Icon, conf.Tit
+00007600: 6c65 290d 0a20 2020 2020 2020 2065 6c73  le)..        els
+00007610: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00007620: 7365 6c66 2e49 636f 6e69 7a65 2846 616c  self.Iconize(Fal
+00007630: 7365 292c 2073 656c 662e 5368 6f77 2829  se), self.Show()
+00007640: 2c20 7365 6c66 2e52 6169 7365 2829 0d0a  , self.Raise()..
+00007650: 0d0a 0d0a 2020 2020 6465 6620 6f6e 5f74  ....    def on_t
+00007660: 6f67 676c 655f 7472 6179 6963 6f6e 2873  oggle_trayicon(s
+00007670: 656c 662c 2065 7665 6e74 3d4e 6f6e 6529  elf, event=None)
+00007680: 3a0d 0a20 2020 2020 2020 2022 2222 0d0a  :..        """..
+00007690: 2020 2020 2020 2020 4861 6e64 6c65 7220          Handler 
+000076a0: 666f 7220 746f 6767 6c69 6e67 2074 7261  for toggling tra
+000076b0: 7920 6963 6f6e 2c20 7265 6d6f 7665 7320  y icon, removes 
+000076c0: 6f72 2061 6464 7320 6974 2074 6f20 7468  or adds it to th
+000076d0: 6520 7472 6179 2061 7265 612e 0d0a 0d0a  e tray area.....
+000076e0: 2020 2020 2020 2020 4070 6172 616d 2020          @param  
+000076f0: 2065 7665 6e74 2020 6966 206e 6f74 2067   event  if not g
+00007700: 6976 656e 206f 7220 6661 6c73 652c 2074  iven or false, t
+00007710: 7261 7920 6963 6f6e 2069 7320 746f 6767  ray icon is togg
+00007720: 6c65 6420 6f6e 0d0a 2020 2020 2020 2020  led on..        
+00007730: 2222 220d 0a20 2020 2020 2020 2063 6f6e  """..        con
+00007740: 662e 5472 6179 4963 6f6e 456e 6162 6c65  f.TrayIconEnable
+00007750: 6420 3d20 6576 656e 742e 4973 4368 6563  d = event.IsChec
+00007760: 6b65 6428 2920 6966 2065 7665 6e74 2065  ked() if event e
+00007770: 6c73 6520 5472 7565 0d0a 2020 2020 2020  lse True..      
+00007780: 2020 7365 6c66 2e6d 656e 755f 7472 6179    self.menu_tray
+00007790: 2e43 6865 636b 2863 6f6e 662e 5472 6179  .Check(conf.Tray
+000077a0: 4963 6f6e 456e 6162 6c65 6429 0d0a 2020  IconEnabled)..  
+000077b0: 2020 2020 2020 6966 2063 6f6e 662e 5472        if conf.Tr
+000077c0: 6179 4963 6f6e 456e 6162 6c65 643a 0d0a  ayIconEnabled:..
+000077d0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000077e0: 2e74 7261 7969 636f 6e2e 5365 7449 636f  .trayicon.SetIco
+000077f0: 6e28 7365 6c66 2e54 5241 595f 4943 4f4e  n(self.TRAY_ICON
+00007800: 2e49 636f 6e2c 2063 6f6e 662e 5469 746c  .Icon, conf.Titl
+00007810: 6529 0d0a 2020 2020 2020 2020 656c 7365  e)..        else
+00007820: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+00007830: 656c 662e 7472 6179 6963 6f6e 2e52 656d  elf.trayicon.Rem
+00007840: 6f76 6549 636f 6e28 290d 0a20 2020 2020  oveIcon()..     
+00007850: 2020 2069 6620 636f 6e66 2e57 696e 646f     if conf.Windo
+00007860: 7749 636f 6e69 7a65 643a 0d0a 2020 2020  wIconized:..    
+00007870: 2020 2020 2020 2020 7365 6c66 2e6f 6e5f          self.on_
+00007880: 746f 6767 6c65 5f69 636f 6e69 7a65 2829  toggle_iconize()
+00007890: 0d0a 0d0a 0d0a 2020 2020 6465 6620 6f6e  ......    def on
+000078a0: 5f6f 7065 6e5f 7472 6179 5f73 6561 7263  _open_tray_searc
+000078b0: 6828 7365 6c66 2c20 6576 656e 7429 3a0d  h(self, event):.
+000078c0: 0a20 2020 2020 2020 2022 2222 4f70 656e  .        """Open
+000078d0: 7320 7468 6520 7365 6172 6368 2065 6e74  s the search ent
+000078e0: 7279 2064 6961 6c6f 672e 2222 220d 0a20  ry dialog.""".. 
+000078f0: 2020 2020 2020 2073 656c 662e 6469 616c         self.dial
+00007900: 6f67 5f73 6561 7263 682e 5368 6f77 286e  og_search.Show(n
+00007910: 6f74 2073 656c 662e 6469 616c 6f67 5f73  ot self.dialog_s
+00007920: 6561 7263 682e 5368 6f77 6e29 0d0a 0d0a  earch.Shown)....
+00007930: 0d0a 2020 2020 6465 6620 6f6e 5f6f 7065  ..    def on_ope
+00007940: 6e5f 7472 6179 5f6d 656e 7528 7365 6c66  n_tray_menu(self
+00007950: 2c20 6576 656e 7429 3a0d 0a20 2020 2020  , event):..     
+00007960: 2020 2022 2222 4372 6561 7465 7320 616e     """Creates an
+00007970: 6420 6f70 656e 7320 6120 706f 7075 7020  d opens a popup 
+00007980: 6d65 6e75 2066 6f72 2074 6865 2074 7261  menu for the tra
+00007990: 7920 6963 6f6e 2e22 2222 0d0a 2020 2020  y icon."""..    
+000079a0: 2020 2020 6d65 6e75 203d 2077 782e 4d65      menu = wx.Me
+000079b0: 6e75 2829 0d0a 2020 2020 2020 2020 6974  nu()..        it
+000079c0: 656d 5f73 6561 7263 6820 3d20 7778 2e4d  em_search = wx.M
+000079d0: 656e 7549 7465 6d28 6d65 6e75 2c20 2d31  enuItem(menu, -1
+000079e0: 2c20 2226 5365 6172 6368 2066 6f72 2e2e  , "&Search for..
+000079f0: 2229 0d0a 2020 2020 2020 2020 666f 6e74  ")..        font
+00007a00: 203d 2069 7465 6d5f 7365 6172 6368 2e46   = item_search.F
+00007a10: 6f6e 740d 0a20 2020 2020 2020 2066 6f6e  ont..        fon
+00007a20: 742e 5365 7457 6569 6768 7428 7778 2e46  t.SetWeight(wx.F
+00007a30: 4f4e 5457 4549 4748 545f 424f 4c44 290d  ONTWEIGHT_BOLD).
+00007a40: 0a20 2020 2020 2020 2066 6f6e 742e 5365  .        font.Se
+00007a50: 7446 6163 654e 616d 6528 7365 6c66 2e46  tFaceName(self.F
+00007a60: 6f6e 742e 4661 6365 4e61 6d65 290d 0a20  ont.FaceName).. 
+00007a70: 2020 2020 2020 2066 6f6e 742e 5365 7450         font.SetP
+00007a80: 6f69 6e74 5369 7a65 2873 656c 662e 466f  ointSize(self.Fo
+00007a90: 6e74 2e50 6f69 6e74 5369 7a65 290d 0a20  nt.PointSize).. 
+00007aa0: 2020 2020 2020 2069 7465 6d5f 7365 6172         item_sear
+00007ab0: 6368 2e46 6f6e 7420 3d20 666f 6e74 0d0a  ch.Font = font..
+00007ac0: 2020 2020 2020 2020 6c61 6265 6c20 3d20          label = 
+00007ad0: 5b22 4d69 6e69 6d69 7a65 2074 6f22 2c20  ["Minimize to", 
+00007ae0: 2252 6573 746f 7265 2066 726f 6d22 5d5b  "Restore from"][
+00007af0: 636f 6e66 2e57 696e 646f 7749 636f 6e69  conf.WindowIconi
+00007b00: 7a65 645d 202b 2022 2026 7472 6179 220d  zed] + " &tray".
+00007b10: 0a20 2020 2020 2020 2069 7465 6d5f 746f  .        item_to
+00007b20: 6767 6c65 203d 2077 782e 4d65 6e75 4974  ggle = wx.MenuIt
+00007b30: 656d 286d 656e 752c 202d 312c 206c 6162  em(menu, -1, lab
+00007b40: 656c 290d 0a20 2020 2020 2020 2069 7465  el)..        ite
+00007b50: 6d5f 6963 6f6e 203d 2077 782e 4d65 6e75  m_icon = wx.Menu
+00007b60: 4974 656d 286d 656e 752c 202d 312c 206b  Item(menu, -1, k
+00007b70: 696e 643d 7778 2e49 5445 4d5f 4348 4543  ind=wx.ITEM_CHEC
+00007b80: 4b2c 0d0a 2020 2020 2020 2020 2020 2020  K,..            
+00007b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007ba0: 2020 2020 7465 7874 3d22 5368 6f77 2026      text="Show &
+00007bb0: 6963 6f6e 2069 6e20 6e6f 7469 6669 6361  icon in notifica
+00007bc0: 7469 6f6e 2061 7265 6122 290d 0a20 2020  tion area")..   
+00007bd0: 2020 2020 2069 7465 6d5f 636f 6e73 6f6c       item_consol
+00007be0: 6520 3d20 7778 2e4d 656e 7549 7465 6d28  e = wx.MenuItem(
+00007bf0: 6d65 6e75 2c20 2d31 2c20 6b69 6e64 3d77  menu, -1, kind=w
+00007c00: 782e 4954 454d 5f43 4845 434b 2c0d 0a20  x.ITEM_CHECK,.. 
+00007c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007c30: 2020 7465 7874 3d22 5368 6f77 2050 7974    text="Show Pyt
+00007c40: 686f 6e20 2663 6f6e 736f 6c65 2229 0d0a  hon &console")..
+00007c50: 2020 2020 2020 2020 6974 656d 5f65 7869          item_exi
+00007c60: 7420 3d20 7778 2e4d 656e 7549 7465 6d28  t = wx.MenuItem(
+00007c70: 6d65 6e75 2c20 2d31 2c20 2245 2678 6974  menu, -1, "E&xit
+00007c80: 2025 7322 2025 2063 6f6e 662e 5469 746c   %s" % conf.Titl
+00007c90: 6529 0d0a 0d0a 2020 2020 2020 2020 6d65  e)....        me
+00007ca0: 6e75 2e41 7070 656e 6428 6974 656d 5f73  nu.Append(item_s
+00007cb0: 6561 7263 6829 0d0a 2020 2020 2020 2020  earch)..        
+00007cc0: 6d65 6e75 2e41 7070 656e 6428 6974 656d  menu.Append(item
+00007cd0: 5f74 6f67 676c 6529 0d0a 2020 2020 2020  _toggle)..      
+00007ce0: 2020 6d65 6e75 2e41 7070 656e 6453 6570    menu.AppendSep
+00007cf0: 6172 6174 6f72 2829 0d0a 2020 2020 2020  arator()..      
+00007d00: 2020 6d65 6e75 2e41 7070 656e 6428 6974    menu.Append(it
+00007d10: 656d 5f69 636f 6e29 0d0a 2020 2020 2020  em_icon)..      
+00007d20: 2020 6d65 6e75 2e41 7070 656e 6428 6974    menu.Append(it
+00007d30: 656d 5f63 6f6e 736f 6c65 290d 0a20 2020  em_console)..   
+00007d40: 2020 2020 206d 656e 752e 4170 7065 6e64       menu.Append
+00007d50: 5365 7061 7261 746f 7228 290d 0a20 2020  Separator()..   
+00007d60: 2020 2020 206d 656e 752e 4170 7065 6e64       menu.Append
+00007d70: 2869 7465 6d5f 6578 6974 290d 0a20 2020  (item_exit)..   
+00007d80: 2020 2020 2069 7465 6d5f 6963 6f6e 2e43       item_icon.C
+00007d90: 6865 636b 2854 7275 6529 0d0a 2020 2020  heck(True)..    
+00007da0: 2020 2020 6974 656d 5f63 6f6e 736f 6c65      item_console
+00007db0: 2e43 6865 636b 2873 656c 662e 6672 616d  .Check(self.fram
+00007dc0: 655f 636f 6e73 6f6c 652e 5368 6f77 6e29  e_console.Shown)
+00007dd0: 0d0a 0d0a 2020 2020 2020 2020 6d65 6e75  ....        menu
+00007de0: 2e42 696e 6428 7778 2e45 5654 5f4d 454e  .Bind(wx.EVT_MEN
+00007df0: 552c 2073 656c 662e 6f6e 5f6f 7065 6e5f  U, self.on_open_
+00007e00: 7472 6179 5f73 6561 7263 682c 2069 643d  tray_search, id=
+00007e10: 6974 656d 5f73 6561 7263 682e 4765 7449  item_search.GetI
+00007e20: 6428 2929 0d0a 2020 2020 2020 2020 6d65  d())..        me
+00007e30: 6e75 2e42 696e 6428 7778 2e45 5654 5f4d  nu.Bind(wx.EVT_M
+00007e40: 454e 552c 2073 656c 662e 6f6e 5f74 6f67  ENU, self.on_tog
+00007e50: 676c 655f 6963 6f6e 697a 652c 2069 643d  gle_iconize, id=
+00007e60: 6974 656d 5f74 6f67 676c 652e 4765 7449  item_toggle.GetI
+00007e70: 6428 2929 0d0a 2020 2020 2020 2020 6d65  d())..        me
+00007e80: 6e75 2e42 696e 6428 7778 2e45 5654 5f4d  nu.Bind(wx.EVT_M
+00007e90: 454e 552c 2073 656c 662e 6f6e 5f74 6f67  ENU, self.on_tog
+00007ea0: 676c 655f 7472 6179 6963 6f6e 2c20 6964  gle_trayicon, id
+00007eb0: 3d69 7465 6d5f 6963 6f6e 2e47 6574 4964  =item_icon.GetId
+00007ec0: 2829 290d 0a20 2020 2020 2020 206d 656e  ())..        men
+00007ed0: 752e 4269 6e64 2877 782e 4556 545f 4d45  u.Bind(wx.EVT_ME
+00007ee0: 4e55 2c20 7365 6c66 2e6f 6e5f 7368 6f77  NU, self.on_show
+00007ef0: 6869 6465 5f63 6f6e 736f 6c65 2c20 6964  hide_console, id
+00007f00: 3d69 7465 6d5f 636f 6e73 6f6c 652e 4765  =item_console.Ge
+00007f10: 7449 6428 2929 0d0a 2020 2020 2020 2020  tId())..        
+00007f20: 6d65 6e75 2e42 696e 6428 7778 2e45 5654  menu.Bind(wx.EVT
+00007f30: 5f4d 454e 552c 2073 656c 662e 6f6e 5f65  _MENU, self.on_e
+00007f40: 7869 742c 2069 643d 6974 656d 5f65 7869  xit, id=item_exi
+00007f50: 742e 4765 7449 6428 2929 0d0a 2020 2020  t.GetId())..    
+00007f60: 2020 2020 7365 6c66 2e74 7261 7969 636f      self.trayico
+00007f70: 6e2e 506f 7075 704d 656e 7528 6d65 6e75  n.PopupMenu(menu
+00007f80: 290d 0a0d 0a0d 0a20 2020 2064 6566 206f  )......    def o
+00007f90: 6e5f 6368 616e 6765 5f70 6167 6528 7365  n_change_page(se
+00007fa0: 6c66 2c20 6576 656e 7429 3a0d 0a20 2020  lf, event):..   
+00007fb0: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
+00007fc0: 2020 4861 6e64 6c65 7220 666f 7220 6368    Handler for ch
+00007fd0: 616e 6769 6e67 2061 2070 6167 6520 696e  anging a page in
+00007fe0: 2074 6865 206d 6169 6e20 4e6f 7465 626f   the main Notebo
+00007ff0: 6f6b 2c20 7265 6d65 6d62 6572 7320 7468  ok, remembers th
+00008000: 6520 7669 7369 742e 0d0a 2020 2020 2020  e visit...      
+00008010: 2020 2222 220d 0a20 2020 2020 2020 2070    """..        p
+00008020: 203d 2073 656c 662e 6e6f 7465 626f 6f6b   = self.notebook
+00008030: 2e47 6574 5061 6765 2873 656c 662e 6e6f  .GetPage(self.no
+00008040: 7465 626f 6f6b 2e47 6574 5365 6c65 6374  tebook.GetSelect
+00008050: 696f 6e28 2929 0d0a 2020 2020 2020 2020  ion())..        
+00008060: 6966 206e 6f74 2073 656c 662e 7061 6765  if not self.page
+00008070: 735f 7669 7369 7465 6420 6f72 2073 656c  s_visited or sel
+00008080: 662e 7061 6765 735f 7669 7369 7465 645b  f.pages_visited[
+00008090: 2d31 5d20 213d 2070 3a0d 0a20 2020 2020  -1] != p:..     
+000080a0: 2020 2020 2020 2073 656c 662e 7061 6765         self.page
+000080b0: 735f 7669 7369 7465 642e 6170 7065 6e64  s_visited.append
+000080c0: 2870 290d 0a20 2020 2020 2020 2073 656c  (p)..        sel
+000080d0: 662e 5469 746c 6520 3d20 636f 6e66 2e54  f.Title = conf.T
+000080e0: 6974 6c65 0d0a 2020 2020 2020 2020 6966  itle..        if
+000080f0: 2068 6173 6174 7472 2870 2c20 2274 6974   hasattr(p, "tit
+00008100: 6c65 2229 3a0d 0a20 2020 2020 2020 2020  le"):..         
+00008110: 2020 2073 7562 7469 746c 6520 3d20 702e     subtitle = p.
+00008120: 7469 746c 650d 0a20 2020 2020 2020 2020  title..         
+00008130: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+00008140: 2870 2c20 4461 7461 6261 7365 5061 6765  (p, DatabasePage
+00008150: 293a 2023 2055 7365 2070 6172 656e 742f  ): # Use parent/
+00008160: 6669 6c65 2e64 6220 6f72 2043 3a2f 6669  file.db or C:/fi
+00008170: 6c65 2e64 620d 0a20 2020 2020 2020 2020  le.db..         
+00008180: 2020 2020 2020 2070 6174 682c 2066 696c         path, fil
+00008190: 6520 3d20 6f73 2e70 6174 682e 7370 6c69  e = os.path.spli
+000081a0: 7428 702e 6462 2e66 696c 656e 616d 6529  t(p.db.filename)
+000081b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000081c0: 2020 7375 6274 6974 6c65 203d 206f 732e    subtitle = os.
+000081d0: 7061 7468 2e6a 6f69 6e28 6f73 2e70 6174  path.join(os.pat
+000081e0: 682e 7370 6c69 7428 7061 7468 295b 2d31  h.split(path)[-1
+000081f0: 5d20 6f72 2070 6174 682c 2066 696c 6529  ] or path, file)
+00008200: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00008210: 6c66 2e54 6974 6c65 202b 3d20 2220 2d20  lf.Title += " - 
+00008220: 2220 2b20 7375 6274 6974 6c65 0d0a 2020  " + subtitle..  
+00008230: 2020 2020 2020 7365 6c66 2e75 7064 6174        self.updat
+00008240: 655f 6e6f 7465 626f 6f6b 5f68 6561 6465  e_notebook_heade
+00008250: 7228 290d 0a20 2020 2020 2020 2069 6620  r()..        if 
+00008260: 6576 656e 743a 2065 7665 6e74 2e53 6b69  event: event.Ski
+00008270: 7028 2920 2320 5061 7373 2065 7665 6e74  p() # Pass event
+00008280: 2061 6c6f 6e67 2074 6f20 6e65 7874 2068   along to next h
+00008290: 616e 646c 6572 0d0a 0d0a 0d0a 2020 2020  andler......    
+000082a0: 6465 6620 6f6e 5f73 697a 6528 7365 6c66  def on_size(self
+000082b0: 2c20 6576 656e 7429 3a0d 0a20 2020 2020  , event):..     
+000082c0: 2020 2022 2222 4861 6e64 6c65 7220 666f     """Handler fo
+000082d0: 7220 7769 6e64 6f77 2073 697a 6520 6576  r window size ev
+000082e0: 656e 742c 2074 7765 616b 7320 636f 6e74  ent, tweaks cont
+000082f0: 726f 6c73 2061 6e64 2073 6176 6573 2073  rols and saves s
+00008300: 697a 652e 2222 220d 0a20 2020 2020 2020  ize."""..       
+00008310: 2065 7665 6e74 2e53 6b69 7028 290d 0a20   event.Skip().. 
+00008320: 2020 2020 2020 2063 6f6e 662e 5769 6e64         conf.Wind
+00008330: 6f77 5369 7a65 203d 205b 2d31 2c20 2d31  owSize = [-1, -1
+00008340: 5d20 6966 2073 656c 662e 4973 4d61 7869  ] if self.IsMaxi
+00008350: 6d69 7a65 6428 2920 656c 7365 2073 656c  mized() else sel
+00008360: 662e 5369 7a65 5b3a 5d0d 0a20 2020 2020  f.Size[:]..     
+00008370: 2020 2075 7469 6c2e 7275 6e5f 6f6e 6365     util.run_once
+00008380: 2863 6f6e 662e 7361 7665 290d 0a20 2020  (conf.save)..   
+00008390: 2020 2020 2073 656c 662e 6c69 7374 5f64       self.list_d
+000083a0: 622e 5365 6e64 5369 7a65 4576 656e 7428  b.SendSizeEvent(
+000083b0: 290d 0a0d 0a0d 0a20 2020 2064 6566 206f  )......    def o
+000083c0: 6e5f 6d6f 7665 2873 656c 662c 2065 7665  n_move(self, eve
+000083d0: 6e74 293a 0d0a 2020 2020 2020 2020 2222  nt):..        ""
+000083e0: 2248 616e 646c 6572 2066 6f72 2077 696e  "Handler for win
+000083f0: 646f 7720 6d6f 7665 2065 7665 6e74 2c20  dow move event, 
+00008400: 7361 7665 7320 706f 7369 7469 6f6e 2e22  saves position."
+00008410: 2222 0d0a 2020 2020 2020 2020 6576 656e  ""..        even
+00008420: 742e 536b 6970 2829 0d0a 2020 2020 2020  t.Skip()..      
+00008430: 2020 6966 206e 6f74 2073 656c 662e 4973    if not self.Is
+00008440: 4963 6f6e 697a 6564 2829 3a0d 0a20 2020  Iconized():..   
+00008450: 2020 2020 2020 2020 2063 6f6e 662e 5769           conf.Wi
+00008460: 6e64 6f77 506f 7369 7469 6f6e 203d 2065  ndowPosition = e
+00008470: 7665 6e74 2e50 6f73 6974 696f 6e5b 3a5d  vent.Position[:]
+00008480: 0d0a 2020 2020 2020 2020 2020 2020 7574  ..            ut
+00008490: 696c 2e72 756e 5f6f 6e63 6528 636f 6e66  il.run_once(conf
+000084a0: 2e73 6176 6529 0d0a 0d0a 0d0a 2020 2020  .save)......    
+000084b0: 6465 6620 6f6e 5f73 7973 5f63 6f6c 6f75  def on_sys_colou
+000084c0: 725f 6368 616e 6765 2873 656c 662c 2065  r_change(self, e
+000084d0: 7665 6e74 293a 0d0a 2020 2020 2020 2020  vent):..        
+000084e0: 2222 2248 616e 646c 6572 2066 6f72 2073  """Handler for s
+000084f0: 7973 7465 6d20 636f 6c6f 7572 2063 6861  ystem colour cha
+00008500: 6e67 652c 2075 7064 6174 6573 2066 696c  nge, updates fil
+00008510: 6573 7973 7465 6d20 696d 6167 6573 2e22  esystem images."
+00008520: 2222 0d0a 2020 2020 2020 2020 6576 656e  ""..        even
+00008530: 742e 536b 6970 2829 0d0a 2020 2020 2020  t.Skip()..      
+00008540: 2020 7365 6c66 2e61 6461 7074 5f63 6f6c    self.adapt_col
+00008550: 6f75 7273 2829 0d0a 2020 2020 2020 2020  ours()..        
+00008560: 6465 6620 6166 7465 7228 293a 0d0a 2020  def after():..  
+00008570: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
+00008580: 6f61 645f 6673 5f69 6d61 6765 7328 290d  oad_fs_images().
+00008590: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+000085a0: 2069 2069 6e20 7261 6e67 6528 7365 6c66   i in range(self
+000085b0: 2e6c 6973 745f 6462 2e47 6574 4974 656d  .list_db.GetItem
+000085c0: 436f 756e 7428 2929 3a0d 0a20 2020 2020  Count()):..     
+000085d0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000085e0: 6c69 7374 5f64 622e 5365 7449 7465 6d54  list_db.SetItemT
+000085f0: 6578 7443 6f6c 6f75 7228 692c 2020 2020  extColour(i,    
+00008600: 2020 2073 656c 662e 6c69 7374 5f64 622e     self.list_db.
+00008610: 466f 7265 6772 6f75 6e64 436f 6c6f 7572  ForegroundColour
+00008620: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00008630: 2020 2073 656c 662e 6c69 7374 5f64 622e     self.list_db.
+00008640: 5365 7449 7465 6d42 6163 6b67 726f 756e  SetItemBackgroun
+00008650: 6443 6f6c 6f75 7228 692c 2073 656c 662e  dColour(i, self.
+00008660: 6c69 7374 5f64 622e 4261 636b 6772 6f75  list_db.Backgrou
+00008670: 6e64 436f 6c6f 7572 290d 0a20 2020 2020  ndColour)..     
+00008680: 2020 2077 782e 4361 6c6c 4166 7465 7228     wx.CallAfter(
+00008690: 6166 7465 7229 2023 2050 6f73 7470 6f6e  after) # Postpon
+000086a0: 6520 746f 2061 6c6c 6f77 2063 6f6e 6620  e to allow conf 
+000086b0: 7570 6461 7465 0d0a 0d0a 0d0a 2020 2020  update......    
+000086c0: 6465 6620 6164 6170 745f 636f 6c6f 7572  def adapt_colour
+000086d0: 7328 7365 6c66 293a 0d0a 2020 2020 2020  s(self):..      
+000086e0: 2020 2222 2241 6461 7074 7320 636f 6e66    """Adapts conf
+000086f0: 6967 7572 6174 696f 6e20 636f 6c6f 7572  iguration colour
+00008700: 7320 746f 2062 6574 7465 7220 6669 7420  s to better fit 
+00008710: 6375 7272 656e 7420 7468 656d 652e 2222  current theme.""
+00008720: 220d 0a20 2020 2020 2020 2043 4f4c 4f55  "..        COLOU
+00008730: 5253 203d 205b 2247 7269 6452 6f77 496e  RS = ["GridRowIn
+00008740: 7365 7274 6564 436f 6c6f 7572 222c 2022  sertedColour", "
+00008750: 4772 6964 526f 7743 6861 6e67 6564 436f  GridRowChangedCo
+00008760: 6c6f 7572 222c 0d0a 2020 2020 2020 2020  lour",..        
+00008770: 2020 2020 2020 2020 2020 2022 4772 6964             "Grid
+00008780: 4365 6c6c 4368 616e 6765 6443 6f6c 6f75  CellChangedColou
+00008790: 7222 5d0d 0a20 2020 2020 2020 2066 7267  r"]..        frg
+000087a0: 6220 3d20 7475 706c 6528 436f 6c6f 7572  b = tuple(Colour
+000087b0: 4d61 6e61 6765 722e 4765 7443 6f6c 6f75  Manager.GetColou
+000087c0: 7228 7778 2e53 5953 5f43 4f4c 4f55 525f  r(wx.SYS_COLOUR_
+000087d0: 4254 4e54 4558 5429 295b 3a33 5d0d 0a20  BTNTEXT))[:3].. 
+000087e0: 2020 2020 2020 2062 7267 6220 3d20 7475         brgb = tu
+000087f0: 706c 6528 436f 6c6f 7572 4d61 6e61 6765  ple(ColourManage
+00008800: 722e 4765 7443 6f6c 6f75 7228 7778 2e53  r.GetColour(wx.S
+00008810: 5953 5f43 4f4c 4f55 525f 5749 4e44 4f57  YS_COLOUR_WINDOW
+00008820: 2029 295b 3a33 5d0d 0a20 2020 2020 2020   ))[:3]..       
+00008830: 2066 6f72 206e 2069 6e20 434f 4c4f 5552   for n in COLOUR
+00008840: 533a 0d0a 2020 2020 2020 2020 2020 2020  S:..            
+00008850: 7267 6220 3d20 7475 706c 6528 7778 2e43  rgb = tuple(wx.C
+00008860: 6f6c 6f75 7228 636f 6e66 2e44 6566 6175  olour(conf.Defau
+00008870: 6c74 732e 6765 7428 6e29 2929 5b3a 335d  lts.get(n)))[:3]
+00008880: 0d0a 2020 2020 2020 2020 2020 2020 6465  ..            de
+00008890: 6c74 6120 3d20 7475 706c 6528 3235 3520  lta = tuple(255 
+000088a0: 2d20 7820 666f 7220 7820 696e 2072 6762  - x for x in rgb
+000088b0: 290d 0a20 2020 2020 2020 2020 2020 2064  )..            d
+000088c0: 6972 6563 7469 6f6e 203d 2031 2069 6620  irection = 1 if 
+000088d0: 2873 756d 2866 7267 6229 203e 2073 756d  (sum(frgb) > sum
+000088e0: 2862 7267 6229 2920 656c 7365 202d 310d  (brgb)) else -1.
+000088f0: 0a20 2020 2020 2020 2020 2020 2072 6762  .            rgb
+00008900: 3220 3d20 7475 706c 6528 6120 2b20 696e  2 = tuple(a + in
+00008910: 7428 6220 2a20 6469 7265 6374 696f 6e29  t(b * direction)
+00008920: 2066 6f72 2061 2c20 6220 696e 207a 6970   for a, b in zip
+00008930: 2862 7267 622c 2064 656c 7461 2929 0d0a  (brgb, delta))..
+00008940: 2020 2020 2020 2020 2020 2020 7267 6232              rgb2
+00008950: 203d 2074 7570 6c65 286d 696e 2832 3535   = tuple(min(255
+00008960: 2c20 6d61 7828 302c 2078 2929 2066 6f72  , max(0, x)) for
+00008970: 2078 2069 6e20 7267 6232 290d 0a20 2020   x in rgb2)..   
+00008980: 2020 2020 2020 2020 2073 6574 6174 7472           setattr
+00008990: 2863 6f6e 662c 206e 2c20 7778 2e43 6f6c  (conf, n, wx.Col
+000089a0: 6f75 7228 7267 6232 292e 4765 7441 7353  our(rgb2).GetAsS
+000089b0: 7472 696e 6728 7778 2e43 3253 5f48 544d  tring(wx.C2S_HTM
+000089c0: 4c5f 5359 4e54 4158 2929 0d0a 0d0a 0d0a  L_SYNTAX))......
+000089d0: 2020 2020 6465 6620 6c6f 6164 5f66 735f      def load_fs_
+000089e0: 696d 6167 6573 2873 656c 6629 3a0d 0a20  images(self):.. 
+000089f0: 2020 2020 2020 2022 2222 4c6f 6164 7320         """Loads 
+00008a00: 636f 6e74 656e 7420 746f 204d 656d 6f72  content to Memor
+00008a10: 7946 532e 2222 220d 0a20 2020 2020 2020  yFS."""..       
+00008a20: 2069 6620 6e6f 7420 7365 6c66 3a20 7265   if not self: re
+00008a30: 7475 726e 0d0a 2020 2020 2020 2020 6162  turn..        ab
+00008a40: 6f75 7469 636f 6e20 3d20 2225 732e 706e  outicon = "%s.pn
+00008a50: 6722 2025 2063 6f6e 662e 5469 746c 652e  g" % conf.Title.
+00008a60: 6c6f 7765 7228 2920 2320 5072 6f67 7261  lower() # Progra
+00008a70: 6d20 6963 6f6e 2073 686f 776e 2069 6e20  m icon shown in 
+00008a80: 4162 6f75 7420 7769 6e64 6f77 0d0a 2020  About window..  
+00008a90: 2020 2020 2020 696d 6720 3d20 696d 6167        img = imag
+00008aa0: 6573 2e49 636f 6e34 3878 3438 5f33 3262  es.Icon48x48_32b
+00008ab0: 6974 2e49 6d61 6765 0d0a 2020 2020 2020  it.Image..      
+00008ac0: 2020 6966 2061 626f 7574 6963 6f6e 2069    if abouticon i
+00008ad0: 6e20 7365 6c66 2e6d 656d 6f72 7966 735b  n self.memoryfs[
+00008ae0: 2266 696c 6573 225d 3a0d 0a20 2020 2020  "files"]:..     
+00008af0: 2020 2020 2020 2073 656c 662e 6d65 6d6f         self.memo
+00008b00: 7279 6673 5b22 6861 6e64 6c65 7222 5d2e  ryfs["handler"].
+00008b10: 5265 6d6f 7665 4669 6c65 2861 626f 7574  RemoveFile(about
+00008b20: 6963 6f6e 290d 0a20 2020 2020 2020 2073  icon)..        s
+00008b30: 656c 662e 6d65 6d6f 7279 6673 5b22 6861  elf.memoryfs["ha
+00008b40: 6e64 6c65 7222 5d2e 4164 6446 696c 6528  ndler"].AddFile(
+00008b50: 6162 6f75 7469 636f 6e2c 2069 6d67 2c20  abouticon, img, 
+00008b60: 7778 2e42 4954 4d41 505f 5459 5045 5f50  wx.BITMAP_TYPE_P
+00008b70: 4e47 290d 0a20 2020 2020 2020 2073 656c  NG)..        sel
+00008b80: 662e 6d65 6d6f 7279 6673 5b22 6669 6c65  f.memoryfs["file
+00008b90: 7322 5d5b 6162 6f75 7469 636f 6e5d 203d  s"][abouticon] =
+00008ba0: 2031 0d0a 0d0a 2020 2020 2020 2020 666e   1....        fn
+00008bb0: 203d 2022 626c 616e 6b2e 6769 6622 0d0a   = "blank.gif"..
+00008bc0: 2020 2020 2020 2020 6966 2066 6e20 6e6f          if fn no
+00008bd0: 7420 696e 2073 656c 662e 6d65 6d6f 7279  t in self.memory
+00008be0: 6673 5b22 6669 6c65 7322 5d3a 0d0a 2020  fs["files"]:..  
+00008bf0: 2020 2020 2020 2020 2020 696d 6720 3d20            img = 
+00008c00: 696d 6167 6573 2e54 7261 6e73 7061 7265  images.Transpare
+00008c10: 6e74 5069 7865 6c2e 496d 6167 650d 0a20  ntPixel.Image.. 
+00008c20: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00008c30: 6d65 6d6f 7279 6673 5b22 6861 6e64 6c65  memoryfs["handle
+00008c40: 7222 5d2e 4164 6446 696c 6528 666e 2c20  r"].AddFile(fn, 
+00008c50: 696d 672c 2077 782e 4249 544d 4150 5f54  img, wx.BITMAP_T
+00008c60: 5950 455f 4749 4629 0d0a 2020 2020 2020  YPE_GIF)..      
+00008c70: 2020 2020 2020 7365 6c66 2e6d 656d 6f72        self.memor
+00008c80: 7966 735b 2266 696c 6573 225d 5b66 6e5d  yfs["files"][fn]
+00008c90: 203d 2031 0d0a 0d0a 2020 2020 2020 2020   = 1....        
+00008ca0: 2320 5363 7265 656e 7368 6f74 7320 6c6f  # Screenshots lo
+00008cb0: 6f6b 2062 6574 7465 7220 7769 7468 2063  ok better with c
+00008cc0: 6f6c 6f75 7269 6e67 2069 6620 7379 7374  olouring if syst
+00008cd0: 656d 2068 6173 206f 6666 2d77 6869 7465  em has off-white
+00008ce0: 2063 6f6c 6f75 720d 0a20 2020 2020 2020   colour..       
+00008cf0: 2074 696e 745f 636f 6c6f 7572 203d 2077   tint_colour = w
+00008d00: 782e 436f 6c6f 7572 2863 6f6e 662e 4267  x.Colour(conf.Bg
+00008d10: 436f 6c6f 7572 290d 0a20 2020 2020 2020  Colour)..       
+00008d20: 2074 696e 745f 6661 6374 6f72 203d 205b   tint_factor = [
+00008d30: 2828 3420 2a20 7829 2025 2032 3536 2920  ((4 * x) % 256) 
+00008d40: 2f20 3235 352e 2066 6f72 2078 2069 6e20  / 255. for x in 
+00008d50: 7469 6e74 5f63 6f6c 6f75 725d 0d0a 2020  tint_colour]..  
+00008d60: 2020 2020 2020 2320 496d 6167 6573 2073        # Images s
+00008d70: 686f 776e 206f 6e20 7468 6520 6465 6661  hown on the defa
+00008d80: 756c 7420 7365 6172 6368 2063 6f6e 7465  ult search conte
+00008d90: 6e74 2070 6167 650d 0a20 2020 2020 2020  nt page..       
+00008da0: 2066 6f72 206e 616d 6520 696e 205b 2248   for name in ["H
+00008db0: 656c 7053 6561 7263 6822 2c20 2248 656c  elpSearch", "Hel
+00008dc0: 7043 6861 7473 222c 2022 4865 6c70 436f  pChats", "HelpCo
+00008dd0: 6e74 6163 7473 222c 2022 4865 6c70 496e  ntacts", "HelpIn
+00008de0: 666f 222c 2022 4865 6c70 5461 626c 6573  fo", "HelpTables
+00008df0: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
+00008e00: 2020 2020 2020 2020 2022 4865 6c70 5351           "HelpSQ
+00008e10: 4c22 2c20 2248 656c 704f 6e6c 696e 6522  L", "HelpOnline"
+00008e20: 5d3a 0d0a 2020 2020 2020 2020 2020 2020  ]:..            
+00008e30: 656d 6265 6464 6564 203d 2067 6574 6174  embedded = getat
+00008e40: 7472 2869 6d61 6765 732c 206e 616d 652c  tr(images, name,
+00008e50: 204e 6f6e 6529 0d0a 2020 2020 2020 2020   None)..        
+00008e60: 2020 2020 6966 206e 6f74 2065 6d62 6564      if not embed
+00008e70: 6465 643a 2063 6f6e 7469 6e75 6520 2320  ded: continue # 
+00008e80: 666f 7220 6e61 6d65 0d0a 2020 2020 2020  for name..      
+00008e90: 2020 2020 2020 696d 6720 3d20 656d 6265        img = embe
+00008ea0: 6464 6564 2e49 6d61 6765 2e41 646a 7573  dded.Image.Adjus
+00008eb0: 7443 6861 6e6e 656c 7328 2a74 696e 745f  tChannels(*tint_
+00008ec0: 6661 6374 6f72 290d 0a20 2020 2020 2020  factor)..       
+00008ed0: 2020 2020 2066 696c 656e 616d 6520 3d20       filename = 
+00008ee0: 2225 732e 706e 6722 2025 206e 616d 650d  "%s.png" % name.
+00008ef0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00008f00: 6669 6c65 6e61 6d65 2069 6e20 7365 6c66  filename in self
 00008f10: 2e6d 656d 6f72 7966 735b 2266 696c 6573  .memoryfs["files
-00008f20: 225d 5b66 696c 656e 616d 655d 203d 2031  "][filename] = 1
-00008f30: 0d0a 0d0a 0d0a 2020 2020 6465 6620 7570  ......    def up
-00008f40: 6461 7465 5f6e 6f74 6562 6f6f 6b5f 6865  date_notebook_he
-00008f50: 6164 6572 2873 656c 6629 3a0d 0a20 2020  ader(self):..   
-00008f60: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-00008f70: 2020 5265 6d6f 7665 7320 6f72 2061 6464    Removes or add
-00008f80: 7320 5820 746f 206e 6f74 6562 6f6f 6b20  s X to notebook 
-00008f90: 7461 6220 7374 796c 652c 2064 6570 656e  tab style, depen
-00008fa0: 6469 6e67 206f 6e20 7768 6574 6865 7220  ding on whether 
-00008fb0: 6375 7272 656e 740d 0a20 2020 2020 2020  current..       
-00008fc0: 2070 6167 6520 6361 6e20 6265 2063 6c6f   page can be clo
-00008fd0: 7365 642e 0d0a 2020 2020 2020 2020 2222  sed...        ""
-00008fe0: 220d 0a20 2020 2020 2020 2069 6620 6e6f  "..        if no
-00008ff0: 7420 7365 6c66 3a0d 0a20 2020 2020 2020  t self:..       
-00009000: 2020 2020 2072 6574 7572 6e0d 0a20 2020       return..   
-00009010: 2020 2020 2070 203d 2073 656c 662e 6e6f       p = self.no
-00009020: 7465 626f 6f6b 2e47 6574 5061 6765 2873  tebook.GetPage(s
-00009030: 656c 662e 6e6f 7465 626f 6f6b 2e47 6574  elf.notebook.Get
-00009040: 5365 6c65 6374 696f 6e28 2929 0d0a 2020  Selection())..  
-00009050: 2020 2020 2020 7374 796c 6520 3d20 7365        style = se
-00009060: 6c66 2e6e 6f74 6562 6f6f 6b2e 4765 7441  lf.notebook.GetA
-00009070: 4757 5769 6e64 6f77 5374 796c 6546 6c61  GWWindowStyleFla
-00009080: 6728 290d 0a20 2020 2020 2020 2069 6620  g()..        if 
-00009090: 6973 696e 7374 616e 6365 2870 2c20 2844  isinstance(p, (D
-000090a0: 6174 6162 6173 6550 6167 652c 204d 6572  atabasePage, Mer
-000090b0: 6765 7250 6167 6529 293a 0d0a 2020 2020  gerPage)):..    
-000090c0: 2020 2020 2020 2020 6966 2070 2e72 6561          if p.rea
-000090d0: 6479 5f74 6f5f 636c 6f73 6520 5c0d 0a20  dy_to_close \.. 
-000090e0: 2020 2020 2020 2020 2020 2061 6e64 206e             and n
-000090f0: 6f74 2028 7374 796c 6520 2620 7778 2e6c  ot (style & wx.l
-00009100: 6962 2e61 6777 2e66 6c61 746e 6f74 6562  ib.agw.flatnoteb
-00009110: 6f6f 6b2e 464e 425f 585f 4f4e 5f54 4142  ook.FNB_X_ON_TAB
-00009120: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00009130: 2020 2020 7374 796c 6520 7c3d 2077 782e      style |= wx.
-00009140: 6c69 622e 6167 772e 666c 6174 6e6f 7465  lib.agw.flatnote
-00009150: 626f 6f6b 2e46 4e42 5f58 5f4f 4e5f 5441  book.FNB_X_ON_TA
-00009160: 420d 0a20 2020 2020 2020 2020 2020 2065  B..            e
-00009170: 6c69 6620 6e6f 7420 702e 7265 6164 795f  lif not p.ready_
-00009180: 746f 5f63 6c6f 7365 205c 0d0a 2020 2020  to_close \..    
-00009190: 2020 2020 2020 2020 616e 6420 2873 7479          and (sty
-000091a0: 6c65 2026 2077 782e 6c69 622e 6167 772e  le & wx.lib.agw.
-000091b0: 666c 6174 6e6f 7465 626f 6f6b 2e46 4e42  flatnotebook.FNB
-000091c0: 5f58 5f4f 4e5f 5441 4229 3a0d 0a20 2020  _X_ON_TAB):..   
-000091d0: 2020 2020 2020 2020 2020 2020 2073 7479               sty
-000091e0: 6c65 205e 3d20 7778 2e6c 6962 2e61 6777  le ^= wx.lib.agw
-000091f0: 2e66 6c61 746e 6f74 6562 6f6f 6b2e 464e  .flatnotebook.FN
-00009200: 425f 585f 4f4e 5f54 4142 0d0a 2020 2020  B_X_ON_TAB..    
-00009210: 2020 2020 656c 6966 2073 656c 662e 7061      elif self.pa
-00009220: 6765 5f6c 6f67 203d 3d20 703a 0d0a 2020  ge_log == p:..  
-00009230: 2020 2020 2020 2020 2020 7374 796c 6520            style 
-00009240: 7c3d 2077 782e 6c69 622e 6167 772e 666c  |= wx.lib.agw.fl
-00009250: 6174 6e6f 7465 626f 6f6b 2e46 4e42 5f58  atnotebook.FNB_X
-00009260: 5f4f 4e5f 5441 420d 0a20 2020 2020 2020  _ON_TAB..       
-00009270: 2065 6c69 6620 7374 796c 6520 2620 7778   elif style & wx
-00009280: 2e6c 6962 2e61 6777 2e66 6c61 746e 6f74  .lib.agw.flatnot
-00009290: 6562 6f6f 6b2e 464e 425f 585f 4f4e 5f54  ebook.FNB_X_ON_T
-000092a0: 4142 3a20 2320 4869 6465 2063 6c6f 7365  AB: # Hide close
-000092b0: 2062 6f78 0d0a 2020 2020 2020 2020 2020   box..          
-000092c0: 2020 7374 796c 6520 5e3d 2077 782e 6c69    style ^= wx.li
-000092d0: 622e 6167 772e 666c 6174 6e6f 7465 626f  b.agw.flatnotebo
-000092e0: 6f6b 2e46 4e42 5f58 5f4f 4e5f 5441 4220  ok.FNB_X_ON_TAB 
-000092f0: 2023 206f 6e20 6d61 696e 2070 6167 650d   # on main page.
-00009300: 0a20 2020 2020 2020 2069 6620 7374 796c  .        if styl
-00009310: 6520 213d 2073 656c 662e 6e6f 7465 626f  e != self.notebo
-00009320: 6f6b 2e47 6574 4147 5757 696e 646f 7753  ok.GetAGWWindowS
-00009330: 7479 6c65 466c 6167 2829 3a0d 0a20 2020  tyleFlag():..   
-00009340: 2020 2020 2020 2020 2073 656c 662e 6e6f           self.no
-00009350: 7465 626f 6f6b 2e53 6574 4147 5757 696e  tebook.SetAGWWin
-00009360: 646f 7753 7479 6c65 466c 6167 2873 7479  dowStyleFlag(sty
-00009370: 6c65 290d 0a0d 0a0d 0a20 2020 2064 6566  le)......    def
-00009380: 206f 6e5f 746f 6767 6c65 5f61 7574 6f75   on_toggle_autou
-00009390: 7064 6174 655f 6368 6563 6b28 7365 6c66  pdate_check(self
-000093a0: 2c20 6576 656e 7429 3a0d 0a20 2020 2020  , event):..     
-000093b0: 2020 2022 2222 4861 6e64 6c65 7220 666f     """Handler fo
-000093c0: 7220 746f 6767 6c69 6e67 2061 7574 6f6d  r toggling autom
-000093d0: 6174 6963 2075 7064 6174 6520 6368 6563  atic update chec
-000093e0: 6b69 6e67 2c20 6368 616e 6765 7320 636f  king, changes co
-000093f0: 6e66 2e22 2222 0d0a 2020 2020 2020 2020  nf."""..        
-00009400: 636f 6e66 2e55 7064 6174 6543 6865 636b  conf.UpdateCheck
-00009410: 4175 746f 6d61 7469 6320 3d20 6576 656e  Automatic = even
-00009420: 742e 4973 4368 6563 6b65 6428 290d 0a20  t.IsChecked().. 
-00009430: 2020 2020 2020 2075 7469 6c2e 7275 6e5f         util.run_
-00009440: 6f6e 6365 2863 6f6e 662e 7361 7665 290d  once(conf.save).
-00009450: 0a0d 0a0d 0a20 2020 2064 6566 206f 6e5f  .....    def on_
-00009460: 6c69 7374 5f64 625f 6b65 7928 7365 6c66  list_db_key(self
-00009470: 2c20 6576 656e 7429 3a0d 0a20 2020 2020  , event):..     
-00009480: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
-00009490: 4861 6e64 6c65 7220 666f 7220 7072 6573  Handler for pres
-000094a0: 7369 6e67 2061 206b 6579 2069 6e20 6462  sing a key in db
-000094b0: 6c69 7374 2c20 6c6f 6164 7320 7365 6c65  list, loads sele
-000094c0: 6374 6564 2064 6174 6162 6173 6520 6f6e  cted database on
-000094d0: 2045 6e74 6572 0d0a 2020 2020 2020 2020   Enter..        
-000094e0: 7265 6d6f 7665 7320 6672 6f6d 206c 6973  removes from lis
-000094f0: 7420 6f6e 2044 656c 6574 652c 2072 6566  t on Delete, ref
-00009500: 7265 7368 6573 2063 6f6c 756d 6e73 206f  reshes columns o
-00009510: 6e20 4635 2c0d 0a20 2020 2020 2020 2061  n F5,..        a
-00009520: 6e64 2066 6f63 7573 6573 2066 696c 7465  nd focuses filte
-00009530: 7220 6f6e 2043 7472 6c2d 462e 0d0a 2020  r on Ctrl-F...  
-00009540: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
-00009550: 2020 2069 6620 6576 656e 742e 4b65 7943     if event.KeyC
-00009560: 6f64 6520 696e 205b 7778 2e57 584b 5f46  ode in [wx.WXK_F
-00009570: 355d 3a0d 0a20 2020 2020 2020 2020 2020  5]:..           
-00009580: 2069 7465 6d73 2c20 7365 6c65 6374 6564   items, selected
-00009590: 5f66 696c 6573 2c20 7365 6c65 6374 6564  _files, selected
-000095a0: 5f68 6f6d 6520 3d20 5b5d 2c20 5b5d 2c20  _home = [], [], 
-000095b0: 4661 6c73 650d 0a20 2020 2020 2020 2020  False..         
-000095c0: 2020 2073 656c 6563 7465 6420 3d20 7365     selected = se
-000095d0: 6c66 2e6c 6973 745f 6462 2e47 6574 4669  lf.list_db.GetFi
-000095e0: 7273 7453 656c 6563 7465 6428 290d 0a20  rstSelected().. 
-000095f0: 2020 2020 2020 2020 2020 2077 6869 6c65             while
-00009600: 2073 656c 6563 7465 6420 3e3d 2030 3a0d   selected >= 0:.
-00009610: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009620: 2069 6620 7365 6c65 6374 6564 3a0d 0a20   if selected:.. 
-00009630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009640: 2020 2073 656c 6563 7465 645f 6669 6c65     selected_file
-00009650: 732e 6170 7065 6e64 2873 656c 662e 6c69  s.append(self.li
-00009660: 7374 5f64 622e 4765 7449 7465 6d54 6578  st_db.GetItemTex
-00009670: 7428 7365 6c65 6374 6564 2929 0d0a 2020  t(selected))..  
-00009680: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00009690: 7365 3a20 7365 6c65 6374 6564 5f68 6f6d  se: selected_hom
-000096a0: 6520 3d20 5472 7565 0d0a 2020 2020 2020  e = True..      
-000096b0: 2020 2020 2020 2020 2020 7365 6c65 6374            select
-000096c0: 6564 203d 2073 656c 662e 6c69 7374 5f64  ed = self.list_d
-000096d0: 622e 4765 744e 6578 7453 656c 6563 7465  b.GetNextSelecte
-000096e0: 6428 7365 6c65 6374 6564 290d 0a0d 0a20  d(selected).... 
-000096f0: 2020 2020 2020 2020 2020 2066 6f72 2066             for f
-00009700: 696c 656e 616d 6520 696e 2063 6f6e 662e  ilename in conf.
-00009710: 4442 4669 6c65 733a 0d0a 2020 2020 2020  DBFiles:..      
-00009720: 2020 2020 2020 2020 2020 6461 7461 203d            data =
-00009730: 2063 6f6c 6c65 6374 696f 6e73 2e64 6566   collections.def
-00009740: 6175 6c74 6469 6374 286c 616d 6264 613a  aultdict(lambda:
-00009750: 204e 6f6e 652c 206e 616d 653d 6669 6c65   None, name=file
-00009760: 6e61 6d65 290d 0a20 2020 2020 2020 2020  name)..         
-00009770: 2020 2020 2020 2069 6620 6f73 2e70 6174         if os.pat
-00009780: 682e 6578 6973 7473 2866 696c 656e 616d  h.exists(filenam
-00009790: 6529 3a0d 0a20 2020 2020 2020 2020 2020  e):..           
-000097a0: 2020 2020 2020 2020 2069 6620 6669 6c65           if file
-000097b0: 6e61 6d65 2069 6e20 7365 6c66 2e64 6273  name in self.dbs
-000097c0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-000097d0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000097e0: 6462 735b 6669 6c65 6e61 6d65 5d2e 7570  dbs[filename].up
-000097f0: 6461 7465 5f66 696c 6569 6e66 6f28 290d  date_fileinfo().
-00009800: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009810: 2020 2020 2020 2020 2064 6174 615b 2273           data["s
-00009820: 697a 6522 5d20 3d20 7365 6c66 2e64 6273  ize"] = self.dbs
-00009830: 5b66 696c 656e 616d 655d 2e66 696c 6573  [filename].files
-00009840: 697a 650d 0a20 2020 2020 2020 2020 2020  ize..           
-00009850: 2020 2020 2020 2020 2020 2020 2064 6174               dat
-00009860: 615b 226c 6173 745f 6d6f 6469 6669 6564  a["last_modified
-00009870: 225d 203d 2073 656c 662e 6462 735b 6669  "] = self.dbs[fi
-00009880: 6c65 6e61 6d65 5d2e 6c61 7374 5f6d 6f64  lename].last_mod
-00009890: 6966 6965 640d 0a20 2020 2020 2020 2020  ified..         
-000098a0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-000098b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000098c0: 2020 2020 2020 2020 2020 6461 7461 5b22            data["
-000098d0: 7369 7a65 225d 203d 206f 732e 7061 7468  size"] = os.path
-000098e0: 2e67 6574 7369 7a65 2866 696c 656e 616d  .getsize(filenam
-000098f0: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
-00009900: 2020 2020 2020 2020 2020 2020 6461 7461              data
-00009910: 5b22 6c61 7374 5f6d 6f64 6966 6965 6422  ["last_modified"
-00009920: 5d20 3d20 6461 7465 7469 6d65 2e64 6174  ] = datetime.dat
-00009930: 6574 696d 652e 6672 6f6d 7469 6d65 7374  etime.fromtimest
-00009940: 616d 7028 0d0a 2020 2020 2020 2020 2020  amp(..          
+00008f20: 225d 3a0d 0a20 2020 2020 2020 2020 2020  "]:..           
+00008f30: 2020 2020 2073 656c 662e 6d65 6d6f 7279       self.memory
+00008f40: 6673 5b22 6861 6e64 6c65 7222 5d2e 5265  fs["handler"].Re
+00008f50: 6d6f 7665 4669 6c65 2866 696c 656e 616d  moveFile(filenam
+00008f60: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+00008f70: 7365 6c66 2e6d 656d 6f72 7966 735b 2268  self.memoryfs["h
+00008f80: 616e 646c 6572 225d 2e41 6464 4669 6c65  andler"].AddFile
+00008f90: 2866 696c 656e 616d 652c 2069 6d67 2c20  (filename, img, 
+00008fa0: 7778 2e42 4954 4d41 505f 5459 5045 5f50  wx.BITMAP_TYPE_P
+00008fb0: 4e47 290d 0a20 2020 2020 2020 2020 2020  NG)..           
+00008fc0: 2073 656c 662e 6d65 6d6f 7279 6673 5b22   self.memoryfs["
+00008fd0: 6669 6c65 7322 5d5b 6669 6c65 6e61 6d65  files"][filename
+00008fe0: 5d20 3d20 310d 0a0d 0a0d 0a20 2020 2064  ] = 1......    d
+00008ff0: 6566 2075 7064 6174 655f 6e6f 7465 626f  ef update_notebo
+00009000: 6f6b 5f68 6561 6465 7228 7365 6c66 293a  ok_header(self):
+00009010: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
+00009020: 2020 2020 2020 2052 656d 6f76 6573 206f         Removes o
+00009030: 7220 6164 6473 2058 2074 6f20 6e6f 7465  r adds X to note
+00009040: 626f 6f6b 2074 6162 2073 7479 6c65 2c20  book tab style, 
+00009050: 6465 7065 6e64 696e 6720 6f6e 2077 6865  depending on whe
+00009060: 7468 6572 2063 7572 7265 6e74 0d0a 2020  ther current..  
+00009070: 2020 2020 2020 7061 6765 2063 616e 2062        page can b
+00009080: 6520 636c 6f73 6564 2e0d 0a20 2020 2020  e closed...     
+00009090: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
+000090a0: 6966 206e 6f74 2073 656c 663a 0d0a 2020  if not self:..  
+000090b0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+000090c0: 0d0a 2020 2020 2020 2020 7020 3d20 7365  ..        p = se
+000090d0: 6c66 2e6e 6f74 6562 6f6f 6b2e 4765 7450  lf.notebook.GetP
+000090e0: 6167 6528 7365 6c66 2e6e 6f74 6562 6f6f  age(self.noteboo
+000090f0: 6b2e 4765 7453 656c 6563 7469 6f6e 2829  k.GetSelection()
+00009100: 290d 0a20 2020 2020 2020 2073 7479 6c65  )..        style
+00009110: 203d 2073 656c 662e 6e6f 7465 626f 6f6b   = self.notebook
+00009120: 2e47 6574 4147 5757 696e 646f 7753 7479  .GetAGWWindowSty
+00009130: 6c65 466c 6167 2829 0d0a 2020 2020 2020  leFlag()..      
+00009140: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+00009150: 702c 2028 4461 7461 6261 7365 5061 6765  p, (DatabasePage
+00009160: 2c20 4d65 7267 6572 5061 6765 2929 3a0d  , MergerPage)):.
+00009170: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00009180: 702e 7265 6164 795f 746f 5f63 6c6f 7365  p.ready_to_close
+00009190: 205c 0d0a 2020 2020 2020 2020 2020 2020   \..            
+000091a0: 616e 6420 6e6f 7420 2873 7479 6c65 2026  and not (style &
+000091b0: 2077 782e 6c69 622e 6167 772e 666c 6174   wx.lib.agw.flat
+000091c0: 6e6f 7465 626f 6f6b 2e46 4e42 5f58 5f4f  notebook.FNB_X_O
+000091d0: 4e5f 5441 4229 3a0d 0a20 2020 2020 2020  N_TAB):..       
+000091e0: 2020 2020 2020 2020 2073 7479 6c65 207c           style |
+000091f0: 3d20 7778 2e6c 6962 2e61 6777 2e66 6c61  = wx.lib.agw.fla
+00009200: 746e 6f74 6562 6f6f 6b2e 464e 425f 585f  tnotebook.FNB_X_
+00009210: 4f4e 5f54 4142 0d0a 2020 2020 2020 2020  ON_TAB..        
+00009220: 2020 2020 656c 6966 206e 6f74 2070 2e72      elif not p.r
+00009230: 6561 6479 5f74 6f5f 636c 6f73 6520 5c0d  eady_to_close \.
+00009240: 0a20 2020 2020 2020 2020 2020 2061 6e64  .            and
+00009250: 2028 7374 796c 6520 2620 7778 2e6c 6962   (style & wx.lib
+00009260: 2e61 6777 2e66 6c61 746e 6f74 6562 6f6f  .agw.flatnoteboo
+00009270: 6b2e 464e 425f 585f 4f4e 5f54 4142 293a  k.FNB_X_ON_TAB):
+00009280: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00009290: 2020 7374 796c 6520 5e3d 2077 782e 6c69    style ^= wx.li
+000092a0: 622e 6167 772e 666c 6174 6e6f 7465 626f  b.agw.flatnotebo
+000092b0: 6f6b 2e46 4e42 5f58 5f4f 4e5f 5441 420d  ok.FNB_X_ON_TAB.
+000092c0: 0a20 2020 2020 2020 2065 6c69 6620 7365  .        elif se
+000092d0: 6c66 2e70 6167 655f 6c6f 6720 3d3d 2070  lf.page_log == p
+000092e0: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+000092f0: 7479 6c65 207c 3d20 7778 2e6c 6962 2e61  tyle |= wx.lib.a
+00009300: 6777 2e66 6c61 746e 6f74 6562 6f6f 6b2e  gw.flatnotebook.
+00009310: 464e 425f 585f 4f4e 5f54 4142 0d0a 2020  FNB_X_ON_TAB..  
+00009320: 2020 2020 2020 656c 6966 2073 7479 6c65        elif style
+00009330: 2026 2077 782e 6c69 622e 6167 772e 666c   & wx.lib.agw.fl
+00009340: 6174 6e6f 7465 626f 6f6b 2e46 4e42 5f58  atnotebook.FNB_X
+00009350: 5f4f 4e5f 5441 423a 2023 2048 6964 6520  _ON_TAB: # Hide 
+00009360: 636c 6f73 6520 626f 780d 0a20 2020 2020  close box..     
+00009370: 2020 2020 2020 2073 7479 6c65 205e 3d20         style ^= 
+00009380: 7778 2e6c 6962 2e61 6777 2e66 6c61 746e  wx.lib.agw.flatn
+00009390: 6f74 6562 6f6f 6b2e 464e 425f 585f 4f4e  otebook.FNB_X_ON
+000093a0: 5f54 4142 2020 2320 6f6e 206d 6169 6e20  _TAB  # on main 
+000093b0: 7061 6765 0d0a 2020 2020 2020 2020 6966  page..        if
+000093c0: 2073 7479 6c65 2021 3d20 7365 6c66 2e6e   style != self.n
+000093d0: 6f74 6562 6f6f 6b2e 4765 7441 4757 5769  otebook.GetAGWWi
+000093e0: 6e64 6f77 5374 796c 6546 6c61 6728 293a  ndowStyleFlag():
+000093f0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00009400: 6c66 2e6e 6f74 6562 6f6f 6b2e 5365 7441  lf.notebook.SetA
+00009410: 4757 5769 6e64 6f77 5374 796c 6546 6c61  GWWindowStyleFla
+00009420: 6728 7374 796c 6529 0d0a 0d0a 0d0a 2020  g(style)......  
+00009430: 2020 6465 6620 6f6e 5f74 6f67 676c 655f    def on_toggle_
+00009440: 6175 746f 7570 6461 7465 5f63 6865 636b  autoupdate_check
+00009450: 2873 656c 662c 2065 7665 6e74 293a 0d0a  (self, event):..
+00009460: 2020 2020 2020 2020 2222 2248 616e 646c          """Handl
+00009470: 6572 2066 6f72 2074 6f67 676c 696e 6720  er for toggling 
+00009480: 6175 746f 6d61 7469 6320 7570 6461 7465  automatic update
+00009490: 2063 6865 636b 696e 672c 2063 6861 6e67   checking, chang
+000094a0: 6573 2063 6f6e 662e 2222 220d 0a20 2020  es conf."""..   
+000094b0: 2020 2020 2063 6f6e 662e 5570 6461 7465       conf.Update
+000094c0: 4368 6563 6b41 7574 6f6d 6174 6963 203d  CheckAutomatic =
+000094d0: 2065 7665 6e74 2e49 7343 6865 636b 6564   event.IsChecked
+000094e0: 2829 0d0a 2020 2020 2020 2020 7574 696c  ()..        util
+000094f0: 2e72 756e 5f6f 6e63 6528 636f 6e66 2e73  .run_once(conf.s
+00009500: 6176 6529 0d0a 0d0a 0d0a 2020 2020 6465  ave)......    de
+00009510: 6620 6f6e 5f6c 6973 745f 6462 5f6b 6579  f on_list_db_key
+00009520: 2873 656c 662c 2065 7665 6e74 293a 0d0a  (self, event):..
+00009530: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
+00009540: 2020 2020 2048 616e 646c 6572 2066 6f72       Handler for
+00009550: 2070 7265 7373 696e 6720 6120 6b65 7920   pressing a key 
+00009560: 696e 2064 626c 6973 742c 206c 6f61 6473  in dblist, loads
+00009570: 2073 656c 6563 7465 6420 6461 7461 6261   selected databa
+00009580: 7365 206f 6e20 456e 7465 720d 0a20 2020  se on Enter..   
+00009590: 2020 2020 2072 656d 6f76 6573 2066 726f       removes fro
+000095a0: 6d20 6c69 7374 206f 6e20 4465 6c65 7465  m list on Delete
+000095b0: 2c20 7265 6672 6573 6865 7320 636f 6c75  , refreshes colu
+000095c0: 6d6e 7320 6f6e 2046 352c 0d0a 2020 2020  mns on F5,..    
+000095d0: 2020 2020 616e 6420 666f 6375 7365 7320      and focuses 
+000095e0: 6669 6c74 6572 206f 6e20 4374 726c 2d46  filter on Ctrl-F
+000095f0: 2e0d 0a20 2020 2020 2020 2022 2222 0d0a  ...        """..
+00009600: 2020 2020 2020 2020 6966 2065 7665 6e74          if event
+00009610: 2e4b 6579 436f 6465 2069 6e20 5b77 782e  .KeyCode in [wx.
+00009620: 5758 4b5f 4635 5d3a 0d0a 2020 2020 2020  WXK_F5]:..      
+00009630: 2020 2020 2020 6974 656d 732c 2073 656c        items, sel
+00009640: 6563 7465 645f 6669 6c65 732c 2073 656c  ected_files, sel
+00009650: 6563 7465 645f 686f 6d65 203d 205b 5d2c  ected_home = [],
+00009660: 205b 5d2c 2046 616c 7365 0d0a 2020 2020   [], False..    
+00009670: 2020 2020 2020 2020 7365 6c65 6374 6564          selected
+00009680: 203d 2073 656c 662e 6c69 7374 5f64 622e   = self.list_db.
+00009690: 4765 7446 6972 7374 5365 6c65 6374 6564  GetFirstSelected
+000096a0: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+000096b0: 7768 696c 6520 7365 6c65 6374 6564 203e  while selected >
+000096c0: 3d20 303a 0d0a 2020 2020 2020 2020 2020  = 0:..          
+000096d0: 2020 2020 2020 6966 2073 656c 6563 7465        if selecte
+000096e0: 643a 0d0a 2020 2020 2020 2020 2020 2020  d:..            
+000096f0: 2020 2020 2020 2020 7365 6c65 6374 6564          selected
+00009700: 5f66 696c 6573 2e61 7070 656e 6428 7365  _files.append(se
+00009710: 6c66 2e6c 6973 745f 6462 2e47 6574 4974  lf.list_db.GetIt
+00009720: 656d 5465 7874 2873 656c 6563 7465 6429  emText(selected)
+00009730: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00009740: 2020 2065 6c73 653a 2073 656c 6563 7465     else: selecte
+00009750: 645f 686f 6d65 203d 2054 7275 650d 0a20  d_home = True.. 
+00009760: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00009770: 656c 6563 7465 6420 3d20 7365 6c66 2e6c  elected = self.l
+00009780: 6973 745f 6462 2e47 6574 4e65 7874 5365  ist_db.GetNextSe
+00009790: 6c65 6374 6564 2873 656c 6563 7465 6429  lected(selected)
+000097a0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+000097b0: 666f 7220 6669 6c65 6e61 6d65 2069 6e20  for filename in 
+000097c0: 636f 6e66 2e44 4246 696c 6573 3a0d 0a20  conf.DBFiles:.. 
+000097d0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+000097e0: 6174 6120 3d20 636f 6c6c 6563 7469 6f6e  ata = collection
+000097f0: 732e 6465 6661 756c 7464 6963 7428 6c61  s.defaultdict(la
+00009800: 6d62 6461 3a20 4e6f 6e65 2c20 6e61 6d65  mbda: None, name
+00009810: 3d66 696c 656e 616d 6529 0d0a 2020 2020  =filename)..    
+00009820: 2020 2020 2020 2020 2020 2020 6966 206f              if o
+00009830: 732e 7061 7468 2e65 7869 7374 7328 6669  s.path.exists(fi
+00009840: 6c65 6e61 6d65 293a 0d0a 2020 2020 2020  lename):..      
+00009850: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00009860: 2066 696c 656e 616d 6520 696e 2073 656c   filename in sel
+00009870: 662e 6462 733a 0d0a 2020 2020 2020 2020  f.dbs:..        
+00009880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009890: 7365 6c66 2e64 6273 5b66 696c 656e 616d  self.dbs[filenam
+000098a0: 655d 2e75 7064 6174 655f 6669 6c65 696e  e].update_filein
+000098b0: 666f 2829 0d0a 2020 2020 2020 2020 2020  fo()..          
+000098c0: 2020 2020 2020 2020 2020 2020 2020 6461                da
+000098d0: 7461 5b22 7369 7a65 225d 203d 2073 656c  ta["size"] = sel
+000098e0: 662e 6462 735b 6669 6c65 6e61 6d65 5d2e  f.dbs[filename].
+000098f0: 6669 6c65 7369 7a65 0d0a 2020 2020 2020  filesize..      
+00009900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009910: 2020 6461 7461 5b22 6c61 7374 5f6d 6f64    data["last_mod
+00009920: 6966 6965 6422 5d20 3d20 7365 6c66 2e64  ified"] = self.d
+00009930: 6273 5b66 696c 656e 616d 655d 2e6c 6173  bs[filename].las
+00009940: 745f 6d6f 6469 6669 6564 0d0a 2020 2020  t_modified..    
 00009950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009970: 2020 2020 2020 6f73 2e70 6174 682e 6765        os.path.ge
-00009980: 746d 7469 6d65 2866 696c 656e 616d 6529  tmtime(filename)
-00009990: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-000099a0: 2020 2073 656c 662e 6462 5f66 696c 656e     self.db_filen
-000099b0: 616d 6573 5b66 696c 656e 616d 655d 2e75  ames[filename].u
-000099c0: 7064 6174 6528 6461 7461 290d 0a20 2020  pdate(data)..   
-000099d0: 2020 2020 2020 2020 2020 2020 2069 7465               ite
-000099e0: 6d73 2e61 7070 656e 6428 6461 7461 290d  ms.append(data).
-000099f0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00009a00: 662e 6c69 7374 5f64 622e 506f 7075 6c61  f.list_db.Popula
-00009a10: 7465 2869 7465 6d73 2c20 5b31 5d29 0d0a  te(items, [1])..
-00009a20: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-00009a30: 656c 6563 7465 645f 686f 6d65 3a20 7365  elected_home: se
-00009a40: 6c66 2e6c 6973 745f 6462 2e53 656c 6563  lf.list_db.Selec
-00009a50: 7428 3029 0d0a 2020 2020 2020 2020 2020  t(0)..          
-00009a60: 2020 6966 2073 656c 6563 7465 645f 6669    if selected_fi
-00009a70: 6c65 733a 0d0a 2020 2020 2020 2020 2020  les:..          
-00009a80: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
-00009a90: 616e 6765 2831 2c20 7365 6c66 2e6c 6973  ange(1, self.lis
-00009aa0: 745f 6462 2e47 6574 4974 656d 436f 756e  t_db.GetItemCoun
-00009ab0: 7428 2929 3a0d 0a20 2020 2020 2020 2020  t()):..         
-00009ac0: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-00009ad0: 6c66 2e6c 6973 745f 6462 2e47 6574 4974  lf.list_db.GetIt
-00009ae0: 656d 5465 7874 2869 2920 696e 2073 656c  emText(i) in sel
-00009af0: 6563 7465 645f 6669 6c65 733a 0d0a 2020  ected_files:..  
-00009b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009b10: 2020 2020 2020 7365 6c66 2e6c 6973 745f        self.list_
-00009b20: 6462 2e53 656c 6563 7428 6929 0d0a 2020  db.Select(i)..  
-00009b30: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00009b40: 6c66 2e75 7064 6174 655f 6461 7461 6261  lf.update_databa
-00009b50: 7365 5f64 6574 6169 6c28 290d 0a20 2020  se_detail()..   
-00009b60: 2020 2020 2065 6c69 6620 6576 656e 742e       elif event.
-00009b70: 4b65 7943 6f64 6520 696e 205b 6f72 6428  KeyCode in [ord(
-00009b80: 2246 2229 5d20 616e 6420 6576 656e 742e  "F")] and event.
-00009b90: 436d 6444 6f77 6e28 293a 0d0a 2020 2020  CmdDown():..    
-00009ba0: 2020 2020 2020 2020 7365 6c66 2e65 6469          self.edi
-00009bb0: 745f 6669 6c74 6572 2e53 6574 466f 6375  t_filter.SetFocu
-00009bc0: 7328 290d 0a20 2020 2020 2020 2069 6620  s()..        if 
-00009bd0: 7365 6c66 2e6c 6973 745f 6462 2e47 6574  self.list_db.Get
-00009be0: 4669 7273 7453 656c 6563 7465 6428 2920  FirstSelected() 
-00009bf0: 3e20 3020 616e 6420 6e6f 7420 6576 656e  > 0 and not even
-00009c00: 742e 416c 7444 6f77 6e28 2920 5c0d 0a20  t.AltDown() \.. 
-00009c10: 2020 2020 2020 2061 6e64 2065 7665 6e74         and event
-00009c20: 2e4b 6579 436f 6465 2069 6e20 5b77 782e  .KeyCode in [wx.
-00009c30: 5758 4b5f 5245 5455 524e 2c20 7778 2e57  WXK_RETURN, wx.W
-00009c40: 584b 5f4e 554d 5041 445f 454e 5445 525d  XK_NUMPAD_ENTER]
-00009c50: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
-00009c60: 656c 662e 6c6f 6164 5f64 6174 6162 6173  elf.load_databas
-00009c70: 655f 7061 6765 2873 656c 662e 6462 5f66  e_page(self.db_f
-00009c80: 696c 656e 616d 6529 0d0a 2020 2020 2020  ilename)..      
-00009c90: 2020 656c 6966 2065 7665 6e74 2e4b 6579    elif event.Key
-00009ca0: 436f 6465 2069 6e20 5b77 782e 5758 4b5f  Code in [wx.WXK_
-00009cb0: 4445 4c45 5445 5d20 616e 6420 7365 6c66  DELETE] and self
-00009cc0: 2e64 625f 6669 6c65 6e61 6d65 3a0d 0a20  .db_filename:.. 
-00009cd0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00009ce0: 6f6e 5f72 656d 6f76 655f 6461 7461 6261  on_remove_databa
-00009cf0: 7365 284e 6f6e 6529 0d0a 2020 2020 2020  se(None)..      
-00009d00: 2020 6576 656e 742e 536b 6970 2829 0d0a    event.Skip()..
-00009d10: 0d0a 0d0a 2020 2020 6465 6620 6f6e 5f73  ....    def on_s
-00009d20: 6f72 745f 6c69 7374 5f64 6228 7365 6c66  ort_list_db(self
-00009d30: 2c20 6576 656e 7429 3a0d 0a20 2020 2020  , event):..     
-00009d40: 2020 2022 2222 4861 6e64 6c65 7220 666f     """Handler fo
-00009d50: 7220 736f 7274 696e 6720 6462 6c69 7374  r sorting dblist
-00009d60: 2c20 7361 7665 7320 736f 7274 2073 7461  , saves sort sta
-00009d70: 7465 2e22 2222 0d0a 2020 2020 2020 2020  te."""..        
-00009d80: 6576 656e 742e 536b 6970 2829 0d0a 2020  event.Skip()..  
-00009d90: 2020 2020 2020 6465 6620 7361 7665 5f73        def save_s
-00009da0: 6f72 745f 7374 6174 6528 293a 0d0a 2020  ort_state():..  
-00009db0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-00009dc0: 2073 656c 663a 2072 6574 7572 6e0d 0a20   self: return.. 
-00009dd0: 2020 2020 2020 2020 2020 2063 6f6e 662e             conf.
-00009de0: 4442 536f 7274 203d 2073 656c 662e 6c69  DBSort = self.li
-00009df0: 7374 5f64 622e 4765 7453 6f72 7453 7461  st_db.GetSortSta
-00009e00: 7465 2829 0d0a 2020 2020 2020 2020 2020  te()..          
-00009e10: 2020 7574 696c 2e72 756e 5f6f 6e63 6528    util.run_once(
-00009e20: 636f 6e66 2e73 6176 6529 0d0a 2020 2020  conf.save)..    
-00009e30: 2020 2020 7778 2e43 616c 6c41 6674 6572      wx.CallAfter
-00009e40: 2873 6176 655f 736f 7274 5f73 7461 7465  (save_sort_state
-00009e50: 2920 2320 416c 6c6f 7720 6c69 7374 2074  ) # Allow list t
-00009e60: 6f20 7570 6461 7465 2073 6f72 7420 7374  o update sort st
-00009e70: 6174 650d 0a0d 0a0d 0a20 2020 2064 6566  ate......    def
-00009e80: 206f 6e5f 6472 6167 5f6c 6973 745f 6462   on_drag_list_db
-00009e90: 2873 656c 662c 2065 7665 6e74 293a 0d0a  (self, event):..
-00009ea0: 2020 2020 2020 2020 2222 2248 616e 646c          """Handl
-00009eb0: 6572 2066 6f72 2064 7261 6767 696e 6720  er for dragging 
-00009ec0: 6974 656d 7320 6172 6f75 6e64 2069 6e20  items around in 
-00009ed0: 6462 6c69 7374 2c20 7361 7665 7320 6669  dblist, saves fi
-00009ee0: 6c65 206f 7264 6572 2e22 2222 0d0a 2020  le order."""..  
-00009ef0: 2020 2020 2020 6576 656e 742e 536b 6970        event.Skip
-00009f00: 2829 0d0a 2020 2020 2020 2020 6465 6620  ()..        def 
-00009f10: 7361 7665 5f6c 6973 745f 6f72 6465 7228  save_list_order(
-00009f20: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00009f30: 636f 6e66 2e44 4246 696c 6573 203d 205b  conf.DBFiles = [
-00009f40: 7365 6c66 2e6c 6973 745f 6462 2e47 6574  self.list_db.Get
-00009f50: 4974 656d 5465 7874 2869 290d 0a20 2020  ItemText(i)..   
-00009f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009f70: 2020 2020 2020 2020 2066 6f72 2069 2069           for i i
-00009f80: 6e20 7261 6e67 6528 312c 2073 656c 662e  n range(1, self.
-00009f90: 6c69 7374 5f64 622e 4765 7449 7465 6d43  list_db.GetItemC
-00009fa0: 6f75 6e74 4675 6c6c 2829 295d 0d0a 2020  ountFull())]..  
-00009fb0: 2020 2020 2020 2020 2020 7574 696c 2e72            util.r
-00009fc0: 756e 5f6f 6e63 6528 636f 6e66 2e73 6176  un_once(conf.sav
-00009fd0: 6529 0d0a 2020 2020 2020 2020 7778 2e43  e)..        wx.C
-00009fe0: 616c 6c41 6674 6572 2873 6176 655f 6c69  allAfter(save_li
-00009ff0: 7374 5f6f 7264 6572 2920 2320 416c 6c6f  st_order) # Allo
-0000a000: 7720 6c69 7374 2074 6f20 7570 6461 7465  w list to update
-0000a010: 2069 7465 6d73 0d0a 0d0a 0d0a 2020 2020   items......    
-0000a020: 6465 6620 6f6e 5f66 696c 7465 725f 6c69  def on_filter_li
-0000a030: 7374 5f64 6228 7365 6c66 2c20 6576 656e  st_db(self, even
-0000a040: 7429 3a0d 0a20 2020 2020 2020 2022 2222  t):..        """
-0000a050: 4861 6e64 6c65 7220 666f 7220 6669 6c74  Handler for filt
-0000a060: 6572 696e 6720 6462 6c69 7374 2c20 6170  ering dblist, ap
-0000a070: 706c 6965 7320 7365 6172 6368 2066 696c  plies search fil
-0000a080: 7465 7220 6166 7465 7220 7469 6d65 6f75  ter after timeou
-0000a090: 742e 2222 220d 0a20 2020 2020 2020 2065  t."""..        e
-0000a0a0: 7665 6e74 2e53 6b69 7028 290d 0a20 2020  vent.Skip()..   
-0000a0b0: 2020 2020 2073 6561 7263 6820 3d20 6576       search = ev
-0000a0c0: 656e 742e 5374 7269 6e67 2e73 7472 6970  ent.String.strip
-0000a0d0: 2829 0d0a 2020 2020 2020 2020 6966 2073  ()..        if s
-0000a0e0: 6561 7263 6820 3d3d 2073 656c 662e 6462  earch == self.db
-0000a0f0: 5f66 696c 7465 723a 2072 6574 7572 6e0d  _filter: return.
-0000a100: 0a0d 0a20 2020 2020 2020 2064 6566 2064  ...        def d
-0000a110: 6f5f 6669 6c74 6572 2873 6561 7263 6829  o_filter(search)
-0000a120: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
-0000a130: 6620 6e6f 7420 7365 6c66 3a20 7265 7475  f not self: retu
-0000a140: 726e 0d0a 2020 2020 2020 2020 2020 2020  rn..            
-0000a150: 7365 6c66 2e64 625f 6669 6c74 6572 5f74  self.db_filter_t
-0000a160: 696d 6572 203d 204e 6f6e 650d 0a20 2020  imer = None..   
-0000a170: 2020 2020 2020 2020 2069 6620 7365 6172           if sear
-0000a180: 6368 2021 3d20 7365 6c66 2e64 625f 6669  ch != self.db_fi
-0000a190: 6c74 6572 3a20 7265 7475 726e 0d0a 2020  lter: return..  
-0000a1a0: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
-0000a1b0: 6973 745f 6462 2e53 6574 4669 6c74 6572  ist_db.SetFilter
-0000a1c0: 2873 6561 7263 6829 0d0a 2020 2020 2020  (search)..      
-0000a1d0: 2020 2020 2020 7365 6c66 2e75 7064 6174        self.updat
-0000a1e0: 655f 6461 7461 6261 7365 5f6c 6973 7428  e_database_list(
-0000a1f0: 290d 0a0d 0a20 2020 2020 2020 2069 6620  )....        if 
-0000a200: 7365 6c66 2e64 625f 6669 6c74 6572 5f74  self.db_filter_t
-0000a210: 696d 6572 3a20 7365 6c66 2e64 625f 6669  imer: self.db_fi
-0000a220: 6c74 6572 5f74 696d 6572 2e53 746f 7028  lter_timer.Stop(
-0000a230: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-0000a240: 6462 5f66 696c 7465 7220 3d20 7365 6172  db_filter = sear
-0000a250: 6368 0d0a 2020 2020 2020 2020 6966 2073  ch..        if s
-0000a260: 6561 7263 683a 2073 656c 662e 6462 5f66  earch: self.db_f
-0000a270: 696c 7465 725f 7469 6d65 7220 3d20 7778  ilter_timer = wx
-0000a280: 2e43 616c 6c4c 6174 6572 2832 3030 2c20  .CallLater(200, 
-0000a290: 646f 5f66 696c 7465 722c 2073 6561 7263  do_filter, searc
-0000a2a0: 6829 0d0a 2020 2020 2020 2020 656c 7365  h)..        else
-0000a2b0: 3a20 646f 5f66 696c 7465 7228 7365 6172  : do_filter(sear
-0000a2c0: 6368 290d 0a0d 0a0d 0a20 2020 2064 6566  ch)......    def
-0000a2d0: 206f 6e5f 6f70 656e 5f66 6565 6462 6163   on_open_feedbac
-0000a2e0: 6b28 7365 6c66 2c20 6576 656e 743d 4e6f  k(self, event=No
-0000a2f0: 6e65 293a 0d0a 2020 2020 2020 2020 2222  ne):..        ""
-0000a300: 2248 616e 646c 6572 2066 6f72 2063 6c69  "Handler for cli
-0000a310: 636b 696e 6720 746f 2073 656e 6420 6665  cking to send fe
-0000a320: 6564 6261 636b 2c20 6f70 656e 7320 7468  edback, opens th
-0000a330: 6520 6665 6564 6261 636b 2066 6f72 6d2e  e feedback form.
-0000a340: 2222 220d 0a20 2020 2020 2020 2069 6620  """..        if 
-0000a350: 6e6f 7420 7365 6c66 3a20 7265 7475 726e  not self: return
-0000a360: 0d0a 0d0a 2020 2020 2020 2020 6966 2073  ....        if s
-0000a370: 7570 706f 7274 2e66 6565 6462 6163 6b5f  upport.feedback_
-0000a380: 7769 6e64 6f77 3a0d 0a20 2020 2020 2020  window:..       
-0000a390: 2020 2020 2069 6620 6e6f 7420 7375 7070       if not supp
-0000a3a0: 6f72 742e 6665 6564 6261 636b 5f77 696e  ort.feedback_win
-0000a3b0: 646f 772e 5368 6f77 6e3a 0d0a 2020 2020  dow.Shown:..    
-0000a3c0: 2020 2020 2020 2020 2020 2020 7375 7070              supp
-0000a3d0: 6f72 742e 6665 6564 6261 636b 5f77 696e  ort.feedback_win
-0000a3e0: 646f 772e 5368 6f77 2829 0d0a 2020 2020  dow.Show()..    
-0000a3f0: 2020 2020 2020 2020 7375 7070 6f72 742e          support.
-0000a400: 6665 6564 6261 636b 5f77 696e 646f 772e  feedback_window.
-0000a410: 5261 6973 6528 290d 0a20 2020 2020 2020  Raise()..       
-0000a420: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-0000a430: 2020 2020 7375 7070 6f72 742e 6665 6564      support.feed
-0000a440: 6261 636b 5f77 696e 646f 7720 3d20 7375  back_window = su
-0000a450: 7070 6f72 742e 4665 6564 6261 636b 4469  pport.FeedbackDi
-0000a460: 616c 6f67 2873 656c 6629 0d0a 0d0a 0d0a  alog(self)......
-0000a470: 2020 2020 6465 6620 6f6e 5f6d 656e 755f      def on_menu_
-0000a480: 686f 6d65 7061 6765 2873 656c 662c 2065  homepage(self, e
-0000a490: 7665 6e74 293a 0d0a 2020 2020 2020 2020  vent):..        
-0000a4a0: 2222 2248 616e 646c 6572 2066 6f72 206f  """Handler for o
-0000a4b0: 7065 6e69 6e67 2053 6b79 7065 7269 6f75  pening Skyperiou
-0000a4c0: 7320 7765 6270 6167 6520 6672 6f6d 206d  s webpage from m
-0000a4d0: 656e 752c 2222 220d 0a20 2020 2020 2020  enu,"""..       
-0000a4e0: 2077 6562 6272 6f77 7365 722e 6f70 656e   webbrowser.open
-0000a4f0: 2863 6f6e 662e 486f 6d65 5572 6c29 0d0a  (conf.HomeUrl)..
-0000a500: 0d0a 0d0a 2020 2020 6465 6620 6f6e 5f61  ....    def on_a
-0000a510: 626f 7574 2873 656c 662c 2065 7665 6e74  bout(self, event
-0000a520: 293a 0d0a 2020 2020 2020 2020 2222 220d  ):..        """.
-0000a530: 0a20 2020 2020 2020 2048 616e 646c 6572  .        Handler
-0000a540: 2066 6f72 2063 6c69 636b 696e 6720 2241   for clicking "A
-0000a550: 626f 7574 2053 6b79 7065 7269 6f75 7322  bout Skyperious"
-0000a560: 206d 656e 752c 206f 7065 6e73 2061 2073   menu, opens a s
-0000a570: 6d61 6c6c 2069 6e66 6f20 6672 616d 652e  mall info frame.
-0000a580: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
-0000a590: 2020 2020 2020 206d 616b 6574 6578 7420         maketext 
-0000a5a0: 3d20 6c61 6d62 6461 3a20 7374 6570 2e54  = lambda: step.T
-0000a5b0: 656d 706c 6174 6528 7465 6d70 6c61 7465  emplate(template
-0000a5c0: 732e 4142 4f55 545f 5445 5854 292e 6578  s.ABOUT_TEXT).ex
-0000a5d0: 7061 6e64 2829 0d0a 2020 2020 2020 2020  pand()..        
-0000a5e0: 4162 6f75 7444 6961 6c6f 6728 7365 6c66  AboutDialog(self
-0000a5f0: 2c20 6d61 6b65 7465 7874 292e 5368 6f77  , maketext).Show
-0000a600: 4d6f 6461 6c28 290d 0a0d 0a0d 0a20 2020  Modal()......   
-0000a610: 2064 6566 206f 6e5f 6368 6563 6b5f 7570   def on_check_up
-0000a620: 6461 7465 2873 656c 662c 2065 7665 6e74  date(self, event
-0000a630: 293a 0d0a 2020 2020 2020 2020 2222 220d  ):..        """.
-0000a640: 0a20 2020 2020 2020 2048 616e 646c 6572  .        Handler
-0000a650: 2066 6f72 2063 6865 636b 696e 6720 666f   for checking fo
-0000a660: 7220 7570 6461 7465 732c 2073 7461 7274  r updates, start
-0000a670: 7320 6120 6261 636b 6772 6f75 6e64 2070  s a background p
-0000a680: 726f 6365 7373 2066 6f72 0d0a 2020 2020  rocess for..    
-0000a690: 2020 2020 6368 6563 6b69 6e67 2066 6f72      checking for
-0000a6a0: 2061 6e64 2064 6f77 6e6c 6f61 6469 6e67   and downloading
-0000a6b0: 2074 6865 206e 6577 6573 7420 7665 7273   the newest vers
-0000a6c0: 696f 6e2e 0d0a 2020 2020 2020 2020 2222  ion...        ""
-0000a6d0: 220d 0a20 2020 2020 2020 2069 6620 6e6f  "..        if no
-0000a6e0: 7420 7375 7070 6f72 742e 7570 6461 7465  t support.update
-0000a6f0: 5f77 696e 646f 773a 0d0a 2020 2020 2020  _window:..      
-0000a700: 2020 2020 2020 6775 6962 6173 652e 7374        guibase.st
-0000a710: 6174 7573 2822 4368 6563 6b69 6e67 2066  atus("Checking f
-0000a720: 6f72 206e 6577 2076 6572 7369 6f6e 206f  or new version o
-0000a730: 6620 2573 2e22 2c20 636f 6e66 2e54 6974  f %s.", conf.Tit
-0000a740: 6c65 290d 0a20 2020 2020 2020 2020 2020  le)..           
-0000a750: 2077 782e 4361 6c6c 4166 7465 7228 7375   wx.CallAfter(su
-0000a760: 7070 6f72 742e 6368 6563 6b5f 6e65 7765  pport.check_newe
-0000a770: 7374 5f76 6572 7369 6f6e 2c0d 0a20 2020  st_version,..   
-0000a780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a790: 2020 2020 2020 7365 6c66 2e6f 6e5f 6368        self.on_ch
-0000a7a0: 6563 6b5f 7570 6461 7465 5f63 616c 6c62  eck_update_callb
-0000a7b0: 6163 6b29 0d0a 2020 2020 2020 2020 656c  ack)..        el
-0000a7c0: 6966 2068 6173 6174 7472 2873 7570 706f  if hasattr(suppo
-0000a7d0: 7274 2e75 7064 6174 655f 7769 6e64 6f77  rt.update_window
-0000a7e0: 2c20 2252 6169 7365 2229 3a0d 0a20 2020  , "Raise"):..   
-0000a7f0: 2020 2020 2020 2020 2073 7570 706f 7274           support
-0000a800: 2e75 7064 6174 655f 7769 6e64 6f77 2e52  .update_window.R
-0000a810: 6169 7365 2829 0d0a 0d0a 0d0a 2020 2020  aise()......    
-0000a820: 6465 6620 6f6e 5f63 6865 636b 5f75 7064  def on_check_upd
-0000a830: 6174 655f 6361 6c6c 6261 636b 2873 656c  ate_callback(sel
-0000a840: 662c 2063 6865 636b 5f72 6573 756c 742c  f, check_result,
-0000a850: 2066 756c 6c5f 7265 7370 6f6e 7365 3d54   full_response=T
-0000a860: 7275 6529 3a0d 0a20 2020 2020 2020 2022  rue):..        "
-0000a870: 2222 0d0a 2020 2020 2020 2020 4361 6c6c  ""..        Call
-0000a880: 6261 636b 2066 756e 6374 696f 6e20 666f  back function fo
-0000a890: 7220 7072 6f63 6573 7369 6e67 2075 7064  r processing upd
-0000a8a0: 6174 6520 6368 6563 6b20 7265 7375 6c74  ate check result
-0000a8b0: 2c20 6f66 6665 7273 206e 6577 0d0a 2020  , offers new..  
-0000a8c0: 2020 2020 2020 7665 7273 696f 6e20 666f        version fo
-0000a8d0: 7220 646f 776e 6c6f 6164 2069 6620 6176  r download if av
-0000a8e0: 6169 6c61 626c 652e 0d0a 0d0a 2020 2020  ailable.....    
-0000a8f0: 2020 2020 4070 6172 616d 2020 2066 756c      @param   ful
-0000a900: 6c5f 7265 7370 6f6e 7365 2020 6966 2046  l_response  if F
-0000a910: 616c 7365 2c20 7368 6f77 206d 6573 7361  alse, show messa
-0000a920: 6765 206f 6e6c 7920 6966 2075 7064 6174  ge only if updat
-0000a930: 6520 6176 6169 6c61 626c 650d 0a20 2020  e available..   
-0000a940: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-0000a950: 2020 6966 206e 6f74 2073 656c 663a 2072    if not self: r
-0000a960: 6574 7572 6e0d 0a0d 0a20 2020 2020 2020  eturn....       
-0000a970: 2073 7570 706f 7274 2e75 7064 6174 655f   support.update_
-0000a980: 7769 6e64 6f77 203d 2054 7275 650d 0a20  window = True.. 
-0000a990: 2020 2020 2020 2067 7569 6261 7365 2e73         guibase.s
-0000a9a0: 7461 7475 7328 290d 0a20 2020 2020 2020  tatus()..       
-0000a9b0: 2069 6620 6368 6563 6b5f 7265 7375 6c74   if check_result
-0000a9c0: 3a0d 0a20 2020 2020 2020 2020 2020 2076  :..            v
-0000a9d0: 6572 7369 6f6e 2c20 7572 6c2c 2063 6861  ersion, url, cha
-0000a9e0: 6e67 6573 203d 2063 6865 636b 5f72 6573  nges = check_res
-0000a9f0: 756c 740d 0a20 2020 2020 2020 2020 2020  ult..           
-0000aa00: 204d 4158 203d 2031 3030 300d 0a20 2020   MAX = 1000..   
-0000aa10: 2020 2020 2020 2020 2063 6861 6e67 6573           changes
-0000aa20: 203d 2063 6861 6e67 6573 5b3a 4d41 585d   = changes[:MAX]
-0000aa30: 202b 2022 2e2e 2220 6966 206c 656e 2863   + ".." if len(c
-0000aa40: 6861 6e67 6573 2920 3e20 4d41 5820 656c  hanges) > MAX el
-0000aa50: 7365 2063 6861 6e67 6573 0d0a 2020 2020  se changes..    
-0000aa60: 2020 2020 2020 2020 6775 6962 6173 652e          guibase.
-0000aa70: 7374 6174 7573 2822 4e65 7720 2573 2076  status("New %s v
-0000aa80: 6572 7369 6f6e 2025 7320 6176 6169 6c61  ersion %s availa
-0000aa90: 626c 652e 222c 2063 6f6e 662e 5469 746c  ble.", conf.Titl
-0000aaa0: 652c 2076 6572 7369 6f6e 290d 0a20 2020  e, version)..   
-0000aab0: 2020 2020 2020 2020 2069 6620 7778 2e4f           if wx.O
-0000aac0: 4b20 3d3d 2077 782e 4d65 7373 6167 6542  K == wx.MessageB
-0000aad0: 6f78 280d 0a20 2020 2020 2020 2020 2020  ox(..           
-0000aae0: 2020 2020 2022 4e65 7765 7220 7665 7273       "Newer vers
-0000aaf0: 696f 6e20 2825 7329 2061 7661 696c 6162  ion (%s) availab
-0000ab00: 6c65 2e20 596f 7520 6172 6520 6375 7272  le. You are curr
-0000ab10: 656e 746c 7920 6f6e 2022 0d0a 2020 2020  ently on "..    
-0000ab20: 2020 2020 2020 2020 2020 2020 2276 6572              "ver
-0000ab30: 7369 6f6e 2025 732e 2573 5c6e 446f 776e  sion %s.%s\nDown
-0000ab40: 6c6f 6164 2061 6e64 2069 6e73 7461 6c6c  load and install
-0000ab50: 2025 7320 2573 3f22 2025 0d0a 2020 2020   %s %s?" %..    
-0000ab60: 2020 2020 2020 2020 2020 2020 2876 6572              (ver
-0000ab70: 7369 6f6e 2c20 636f 6e66 2e56 6572 7369  sion, conf.Versi
-0000ab80: 6f6e 2c20 225c 6e5c 6e25 735c 6e22 2025  on, "\n\n%s\n" %
-0000ab90: 2063 6861 6e67 6573 2c0d 0a20 2020 2020   changes,..     
-0000aba0: 2020 2020 2020 2020 2020 2020 636f 6e66              conf
-0000abb0: 2e54 6974 6c65 2c20 7665 7273 696f 6e29  .Title, version)
-0000abc0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0000abd0: 2020 2022 5570 6461 7465 2069 6e66 6f72     "Update infor
-0000abe0: 6d61 7469 6f6e 222c 2077 782e 4f4b 207c  mation", wx.OK |
-0000abf0: 2077 782e 4341 4e43 454c 207c 2077 782e   wx.CANCEL | wx.
-0000ac00: 4943 4f4e 5f49 4e46 4f52 4d41 5449 4f4e  ICON_INFORMATION
-0000ac10: 0d0a 2020 2020 2020 2020 2020 2020 293a  ..            ):
-0000ac20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000ac30: 2020 7778 2e43 616c 6c41 6674 6572 2873    wx.CallAfter(s
-0000ac40: 7570 706f 7274 2e64 6f77 6e6c 6f61 645f  upport.download_
-0000ac50: 616e 645f 696e 7374 616c 6c2c 2075 726c  and_install, url
-0000ac60: 290d 0a20 2020 2020 2020 2065 6c69 6620  )..        elif 
-0000ac70: 6675 6c6c 5f72 6573 706f 6e73 6520 616e  full_response an
-0000ac80: 6420 6368 6563 6b5f 7265 7375 6c74 2069  d check_result i
-0000ac90: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
-0000aca0: 2020 2020 2020 2020 2077 782e 4d65 7373           wx.Mess
-0000acb0: 6167 6542 6f78 2822 596f 7520 6172 6520  ageBox("You are 
-0000acc0: 7573 696e 6720 7468 6520 6c61 7465 7374  using the latest
-0000acd0: 2076 6572 7369 6f6e 206f 6620 2573 2c20   version of %s, 
-0000ace0: 2573 2e5c 6e5c 6e20 2220 250d 0a20 2020  %s.\n\n " %..   
-0000acf0: 2020 2020 2020 2020 2020 2020 2028 636f               (co
-0000ad00: 6e66 2e54 6974 6c65 2c20 636f 6e66 2e56  nf.Title, conf.V
-0000ad10: 6572 7369 6f6e 292c 2022 5570 6461 7465  ersion), "Update
-0000ad20: 2069 6e66 6f72 6d61 7469 6f6e 222c 0d0a   information",..
-0000ad30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ad40: 7778 2e4f 4b20 7c20 7778 2e49 434f 4e5f  wx.OK | wx.ICON_
-0000ad50: 494e 464f 524d 4154 494f 4e29 0d0a 2020  INFORMATION)..  
-0000ad60: 2020 2020 2020 656c 6966 2066 756c 6c5f        elif full_
-0000ad70: 7265 7370 6f6e 7365 3a0d 0a20 2020 2020  response:..     
-0000ad80: 2020 2020 2020 2077 782e 4d65 7373 6167         wx.Messag
-0000ad90: 6542 6f78 2822 436f 756c 6420 6e6f 7420  eBox("Could not 
-0000ada0: 636f 6e74 6163 7420 646f 776e 6c6f 6164  contact download
-0000adb0: 2073 6572 7665 722e 222c 0d0a 2020 2020   server.",..    
-0000adc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000add0: 2020 2020 2020 2255 7064 6174 6520 696e        "Update in
-0000ade0: 666f 726d 6174 696f 6e22 2c20 7778 2e4f  formation", wx.O
-0000adf0: 4b20 7c20 7778 2e49 434f 4e5f 5741 524e  K | wx.ICON_WARN
-0000ae00: 494e 4729 0d0a 2020 2020 2020 2020 6966  ING)..        if
-0000ae10: 2063 6865 636b 5f72 6573 756c 7420 6973   check_result is
-0000ae20: 206e 6f74 204e 6f6e 653a 0d0a 2020 2020   not None:..    
-0000ae30: 2020 2020 2020 2020 636f 6e66 2e4c 6173          conf.Las
-0000ae40: 7455 7064 6174 6543 6865 636b 203d 2064  tUpdateCheck = d
-0000ae50: 6174 6574 696d 652e 6461 7465 2e74 6f64  atetime.date.tod
-0000ae60: 6179 2829 2e73 7472 6674 696d 6528 2225  ay().strftime("%
-0000ae70: 5925 6d25 6422 290d 0a20 2020 2020 2020  Y%m%d")..       
-0000ae80: 2020 2020 2075 7469 6c2e 7275 6e5f 6f6e       util.run_on
-0000ae90: 6365 2863 6f6e 662e 7361 7665 290d 0a20  ce(conf.save).. 
-0000aea0: 2020 2020 2020 2073 7570 706f 7274 2e75         support.u
-0000aeb0: 7064 6174 655f 7769 6e64 6f77 203d 204e  pdate_window = N
-0000aec0: 6f6e 650d 0a0d 0a0d 0a20 2020 2064 6566  one......    def
-0000aed0: 206f 6e5f 6465 7465 6374 5f64 6174 6162   on_detect_datab
-0000aee0: 6173 6573 2873 656c 662c 2065 7665 6e74  ases(self, event
-0000aef0: 293a 0d0a 2020 2020 2020 2020 2222 220d  ):..        """.
-0000af00: 0a20 2020 2020 2020 2048 616e 646c 6572  .        Handler
-0000af10: 2066 6f72 2063 6c69 636b 696e 6720 746f   for clicking to
-0000af20: 2061 7574 6f2d 6465 7465 6374 2064 6174   auto-detect dat
-0000af30: 6162 6173 6573 2c20 7374 6172 7473 206f  abases, starts o
-0000af40: 7220 7374 6f70 7320 7468 650d 0a20 2020  r stops the..   
-0000af50: 2020 2020 2064 6574 6563 7469 6f6e 2069       detection i
-0000af60: 6e20 6120 6261 636b 6772 6f75 6e64 2074  n a background t
-0000af70: 6872 6561 642e 0d0a 2020 2020 2020 2020  hread...        
-0000af80: 2222 220d 0a20 2020 2020 2020 2069 6620  """..        if 
-0000af90: 7365 6c66 2e77 6f72 6b65 725f 6465 7465  self.worker_dete
-0000afa0: 6374 696f 6e2e 6973 5f77 6f72 6b69 6e67  ction.is_working
-0000afb0: 2829 3a0d 0a20 2020 2020 2020 2020 2020  ():..           
-0000afc0: 2073 656c 662e 776f 726b 6572 5f64 6574   self.worker_det
-0000afd0: 6563 7469 6f6e 2e73 746f 705f 776f 726b  ection.stop_work
-0000afe0: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
-0000aff0: 7365 6c66 2e62 7574 746f 6e5f 6465 7465  self.button_dete
-0000b000: 6374 2e4c 6162 656c 203d 2022 4465 7465  ct.Label = "Dete
-0000b010: 6374 2064 6174 6162 6173 6573 220d 0a20  ct databases".. 
-0000b020: 2020 2020 2020 2020 2020 2067 7569 6261             guiba
-0000b030: 7365 2e73 7461 7475 7328 2253 746f 7070  se.status("Stopp
-0000b040: 6564 2064 6574 6563 7469 6e67 2064 6174  ed detecting dat
-0000b050: 6162 6173 6573 2e22 2c20 6c6f 673d 5472  abases.", log=Tr
-0000b060: 7565 290d 0a20 2020 2020 2020 2065 6c73  ue)..        els
-0000b070: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-0000b080: 6775 6962 6173 652e 7374 6174 7573 2822  guibase.status("
-0000b090: 5365 6172 6368 696e 6720 6c6f 6361 6c20  Searching local 
-0000b0a0: 636f 6d70 7574 6572 2066 6f72 2053 6b79  computer for Sky
-0000b0b0: 7065 2064 6174 6162 6173 6573 2e2e 222c  pe databases..",
-0000b0c0: 206c 6f67 3d54 7275 6529 0d0a 2020 2020   log=True)..    
-0000b0d0: 2020 2020 2020 2020 7365 6c66 2e62 7574          self.but
-0000b0e0: 746f 6e5f 6465 7465 6374 2e4c 6162 656c  ton_detect.Label
-0000b0f0: 203d 2022 5374 6f70 2064 6574 6563 7469   = "Stop detecti
-0000b100: 6e67 2064 6174 6162 6173 6573 220d 0a20  ng databases".. 
-0000b110: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000b120: 776f 726b 6572 5f64 6574 6563 7469 6f6e  worker_detection
-0000b130: 2e77 6f72 6b28 5472 7565 290d 0a0d 0a0d  .work(True).....
-0000b140: 0a20 2020 2064 6566 206f 6e5f 6465 7465  .    def on_dete
-0000b150: 6374 5f64 6174 6162 6173 6573 5f63 616c  ct_databases_cal
-0000b160: 6c62 6163 6b28 7365 6c66 2c20 7265 7375  lback(self, resu
-0000b170: 6c74 293a 0d0a 2020 2020 2020 2020 2222  lt):..        ""
-0000b180: 2243 616c 6c62 6163 6b20 666f 7220 4465  "Callback for De
-0000b190: 7465 6374 4461 7461 6261 7365 5468 7265  tectDatabaseThre
-0000b1a0: 6164 2c20 706f 7374 7320 7468 6520 6461  ad, posts the da
-0000b1b0: 7461 2074 6f20 7365 6c66 2e22 2222 0d0a  ta to self."""..
-0000b1c0: 2020 2020 2020 2020 6966 2073 656c 663a          if self:
-0000b1d0: 2023 2043 6865 636b 2069 6620 696e 7374   # Check if inst
-0000b1e0: 616e 6365 2069 7320 7374 696c 6c20 7661  ance is still va
-0000b1f0: 6c69 6420 2869 2e65 2e20 6e6f 7420 6465  lid (i.e. not de
-0000b200: 7374 726f 7965 6420 6279 2077 7829 0d0a  stroyed by wx)..
-0000b210: 2020 2020 2020 2020 2020 2020 7778 2e50              wx.P
-0000b220: 6f73 7445 7665 6e74 2873 656c 662c 2044  ostEvent(self, D
-0000b230: 6574 6563 7469 6f6e 576f 726b 6572 4576  etectionWorkerEv
-0000b240: 656e 7428 7265 7375 6c74 3d72 6573 756c  ent(result=resul
-0000b250: 7429 290d 0a0d 0a0d 0a20 2020 2064 6566  t))......    def
-0000b260: 206f 6e5f 6465 7465 6374 5f64 6174 6162   on_detect_datab
-0000b270: 6173 6573 5f72 6573 756c 7428 7365 6c66  ases_result(self
-0000b280: 2c20 6576 656e 7429 3a0d 0a20 2020 2020  , event):..     
-0000b290: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
-0000b2a0: 4861 6e64 6c65 7220 666f 7220 6765 7474  Handler for gett
-0000b2b0: 696e 6720 7265 7375 6c74 7320 6672 6f6d  ing results from
-0000b2c0: 2064 6174 6162 6173 6520 6465 7465 6374   database detect
-0000b2d0: 696f 6e20 7468 7265 6164 2c20 6164 6473  ion thread, adds
-0000b2e0: 2074 6865 0d0a 2020 2020 2020 2020 7265   the..        re
-0000b2f0: 7375 6c74 7320 746f 2074 6865 2064 6174  sults to the dat
-0000b300: 6162 6173 6520 6c69 7374 2e0d 0a20 2020  abase list...   
-0000b310: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-0000b320: 2020 7265 7375 6c74 203d 2065 7665 6e74    result = event
-0000b330: 2e72 6573 756c 740d 0a20 2020 2020 2020  .result..       
-0000b340: 2069 6620 2266 696c 656e 616d 6573 2220   if "filenames" 
-0000b350: 696e 2072 6573 756c 743a 0d0a 2020 2020  in result:..    
-0000b360: 2020 2020 2020 2020 666f 7220 6620 696e          for f in
-0000b370: 2072 6573 756c 745b 2266 696c 656e 616d   result["filenam
-0000b380: 6573 225d 3a0d 0a20 2020 2020 2020 2020  es"]:..         
-0000b390: 2020 2020 2020 2069 6620 7365 6c66 2e75         if self.u
-0000b3a0: 7064 6174 655f 6461 7461 6261 7365 5f6c  pdate_database_l
-0000b3b0: 6973 7428 6629 3a0d 0a20 2020 2020 2020  ist(f):..       
-0000b3c0: 2020 2020 2020 2020 2020 2020 206c 6f67               log
-0000b3d0: 6765 722e 696e 666f 2822 4465 7465 6374  ger.info("Detect
-0000b3e0: 6564 2064 6174 6162 6173 6520 2573 2e22  ed database %s."
-0000b3f0: 2c20 6629 0d0a 2020 2020 2020 2020 6966  , f)..        if
-0000b400: 2022 636f 756e 7422 2069 6e20 7265 7375   "count" in resu
-0000b410: 6c74 3a0d 0a20 2020 2020 2020 2020 2020  lt:..           
-0000b420: 206e 616d 6520 3d20 2822 2220 6966 2072   name = ("" if r
-0000b430: 6573 756c 745b 2263 6f75 6e74 225d 2065  esult["count"] e
-0000b440: 6c73 6520 2261 6464 6974 696f 6e61 6c20  lse "additional 
-0000b450: 2229 202b 2022 6461 7461 6261 7365 220d  ") + "database".
-0000b460: 0a20 2020 2020 2020 2020 2020 2067 7569  .            gui
-0000b470: 6261 7365 2e73 7461 7475 7328 2244 6574  base.status("Det
-0000b480: 6563 7465 6420 2573 2e22 2c20 7574 696c  ected %s.", util
-0000b490: 2e70 6c75 7261 6c28 6e61 6d65 2c20 7265  .plural(name, re
-0000b4a0: 7375 6c74 5b22 636f 756e 7422 5d29 2c20  sult["count"]), 
-0000b4b0: 6c6f 673d 5472 7565 290d 0a20 2020 2020  log=True)..     
-0000b4c0: 2020 2069 6620 7265 7375 6c74 2e67 6574     if result.get
-0000b4d0: 2822 646f 6e65 222c 2046 616c 7365 293a  ("done", False):
-0000b4e0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-0000b4f0: 6c66 2e62 7574 746f 6e5f 6465 7465 6374  lf.button_detect
-0000b500: 2e4c 6162 656c 203d 2022 4465 7465 6374  .Label = "Detect
-0000b510: 2064 6174 6162 6173 6573 220d 0a20 2020   databases"..   
-0000b520: 2020 2020 2020 2020 2073 656c 662e 6c69           self.li
-0000b530: 7374 5f64 622e 5365 6e64 5369 7a65 4576  st_db.SendSizeEv
-0000b540: 656e 7428 290d 0a20 2020 2020 2020 2020  ent()..         
-0000b550: 2020 2077 782e 4265 6c6c 2829 0d0a 0d0a     wx.Bell()....
-0000b560: 0d0a 2020 2020 6465 6620 706f 7075 6c61  ..    def popula
-0000b570: 7465 5f64 6174 6162 6173 655f 6c69 7374  te_database_list
-0000b580: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
-0000b590: 2022 2222 496e 7365 7274 7320 616c 6c20   """Inserts all 
-0000b5a0: 6461 7461 6261 7365 7320 696e 746f 2074  databases into t
-0000b5b0: 6865 206c 6973 742c 2075 7064 6174 6573  he list, updates
-0000b5c0: 2055 4920 6275 7474 6f6e 732e 2222 220d   UI buttons.""".
-0000b5d0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-0000b5e0: 7365 6c66 3a20 7265 7475 726e 0d0a 2020  self: return..  
-0000b5f0: 2020 2020 2020 6974 656d 732c 2073 656c        items, sel
-0000b600: 6563 7465 645f 6669 6c65 7320 3d20 5b5d  ected_files = []
-0000b610: 2c20 5b5d 0d0a 2020 2020 2020 2020 666f  , []..        fo
-0000b620: 7220 6669 6c65 6e61 6d65 2069 6e20 636f  r filename in co
-0000b630: 6e66 2e44 4246 696c 6573 3a0d 0a20 2020  nf.DBFiles:..   
-0000b640: 2020 2020 2020 2020 2066 696c 656e 616d           filenam
-0000b650: 6520 3d20 7574 696c 2e74 6f5f 756e 6963  e = util.to_unic
-0000b660: 6f64 6528 6669 6c65 6e61 6d65 290d 0a20  ode(filename).. 
-0000b670: 2020 2020 2020 2020 2020 2064 6174 6120             data 
-0000b680: 3d20 636f 6c6c 6563 7469 6f6e 732e 6465  = collections.de
-0000b690: 6661 756c 7464 6963 7428 6c61 6d62 6461  faultdict(lambda
-0000b6a0: 3a20 4e6f 6e65 2c20 6e61 6d65 3d66 696c  : None, name=fil
-0000b6b0: 656e 616d 6529 0d0a 2020 2020 2020 2020  ename)..        
-0000b6c0: 2020 2020 6966 206f 732e 7061 7468 2e65      if os.path.e
-0000b6d0: 7869 7374 7328 6669 6c65 6e61 6d65 293a  xists(filename):
-0000b6e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000b6f0: 2020 6461 7461 5b22 7369 7a65 225d 203d    data["size"] =
-0000b700: 206f 732e 7061 7468 2e67 6574 7369 7a65   os.path.getsize
-0000b710: 2866 696c 656e 616d 6529 0d0a 2020 2020  (filename)..    
-0000b720: 2020 2020 2020 2020 2020 2020 6461 7461              data
-0000b730: 5b22 6c61 7374 5f6d 6f64 6966 6965 6422  ["last_modified"
-0000b740: 5d20 3d20 6461 7465 7469 6d65 2e64 6174  ] = datetime.dat
-0000b750: 6574 696d 652e 6672 6f6d 7469 6d65 7374  etime.fromtimest
-0000b760: 616d 7028 0d0a 2020 2020 2020 2020 2020  amp(..          
-0000b770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b780: 2020 2020 2020 2020 2020 2020 2020 6f73                os
-0000b790: 2e70 6174 682e 6765 746d 7469 6d65 2866  .path.getmtime(f
-0000b7a0: 696c 656e 616d 6529 290d 0a20 2020 2020  ilename))..     
-0000b7b0: 2020 2020 2020 2073 656c 662e 6462 5f66         self.db_f
-0000b7c0: 696c 656e 616d 6573 5b66 696c 656e 616d  ilenames[filenam
-0000b7d0: 655d 203d 2064 6174 610d 0a20 2020 2020  e] = data..     
-0000b7e0: 2020 2020 2020 2069 7465 6d73 2e61 7070         items.app
-0000b7f0: 656e 6428 6461 7461 290d 0a20 2020 2020  end(data)..     
-0000b800: 2020 2020 2020 2069 6620 6669 6c65 6e61         if filena
-0000b810: 6d65 2069 6e20 636f 6e66 2e4c 6173 7453  me in conf.LastS
-0000b820: 656c 6563 7465 6446 696c 6573 3a20 7365  electedFiles: se
-0000b830: 6c65 6374 6564 5f66 696c 6573 202b 3d20  lected_files += 
-0000b840: 5b66 696c 656e 616d 655d 0d0a 0d0a 2020  [filename]....  
-0000b850: 2020 2020 2020 7365 6c66 2e6c 6973 745f        self.list_
-0000b860: 6462 2e50 6f70 756c 6174 6528 6974 656d  db.Populate(item
-0000b870: 732c 205b 315d 290d 0a20 2020 2020 2020  s, [1])..       
-0000b880: 2069 6620 636f 6e66 2e44 4253 6f72 7420   if conf.DBSort 
-0000b890: 616e 6420 636f 6e66 2e44 4253 6f72 745b  and conf.DBSort[
-0000b8a0: 305d 203e 3d20 303a 0d0a 2020 2020 2020  0] >= 0:..      
-0000b8b0: 2020 2020 2020 7365 6c66 2e6c 6973 745f        self.list_
-0000b8c0: 6462 2e53 6f72 744c 6973 7449 7465 6d73  db.SortListItems
-0000b8d0: 282a 636f 6e66 2e44 4253 6f72 7429 0d0a  (*conf.DBSort)..
-0000b8e0: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
-0000b8f0: 6563 7465 645f 6669 6c65 733a 0d0a 2020  ected_files:..  
-0000b900: 2020 2020 2020 2020 2020 6964 7820 3d20            idx = 
-0000b910: 2d31 0d0a 2020 2020 2020 2020 2020 2020  -1..            
-0000b920: 666f 7220 6920 696e 2072 616e 6765 2831  for i in range(1
-0000b930: 2c20 7365 6c66 2e6c 6973 745f 6462 2e47  , self.list_db.G
-0000b940: 6574 4974 656d 436f 756e 7428 2929 3a0d  etItemCount()):.
-0000b950: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b960: 2069 6620 7365 6c66 2e6c 6973 745f 6462   if self.list_db
-0000b970: 2e47 6574 4974 656d 5465 7874 2869 2920  .GetItemText(i) 
-0000b980: 696e 2073 656c 6563 7465 645f 6669 6c65  in selected_file
-0000b990: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
-0000b9a0: 2020 2020 2020 2020 6966 2069 6478 203c          if idx <
-0000b9b0: 2030 3a20 6964 7820 3d20 690d 0a20 2020   0: idx = i..   
-0000b9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b9d0: 2073 656c 662e 6c69 7374 5f64 622e 5365   self.list_db.Se
-0000b9e0: 6c65 6374 2869 290d 0a20 2020 2020 2020  lect(i)..       
-0000b9f0: 2020 2020 2073 656c 662e 6c69 7374 5f64       self.list_d
-0000ba00: 622e 456e 7375 7265 5669 7369 626c 6528  b.EnsureVisible(
-0000ba10: 6964 7829 0d0a 2020 2020 2020 2020 2020  idx)..          
-0000ba20: 2020 7365 6c66 2e6c 6973 745f 6462 2e53    self.list_db.S
-0000ba30: 6574 466f 6375 7328 290d 0a20 2020 2020  etFocus()..     
-0000ba40: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-0000ba50: 2020 2020 2020 7365 6c66 2e6c 6973 745f        self.list_
-0000ba60: 6462 2e53 656c 6563 7428 3029 0d0a 0d0a  db.Select(0)....
-0000ba70: 2020 2020 2020 2020 7365 6c66 2e62 7574          self.but
-0000ba80: 746f 6e5f 636c 6561 722e 5368 6f77 2862  ton_clear.Show(b
-0000ba90: 6f6f 6c28 6974 656d 7329 290d 0a20 2020  ool(items))..   
-0000baa0: 2020 2020 2073 656c 662e 7061 6e65 6c5f       self.panel_
-0000bab0: 6462 5f6d 6169 6e2e 4c61 796f 7574 2829  db_main.Layout()
-0000bac0: 0d0a 2020 2020 2020 2020 7365 6c66 2e75  ..        self.u
-0000bad0: 7064 6174 655f 6461 7461 6261 7365 5f63  pdate_database_c
-0000bae0: 6f75 6e74 2829 0d0a 2020 2020 2020 2020  ount()..        
-0000baf0: 6966 2073 656c 6563 7465 645f 6669 6c65  if selected_file
-0000bb00: 733a 2077 782e 4361 6c6c 4c61 7465 7228  s: wx.CallLater(
-0000bb10: 3130 302c 2073 656c 662e 7570 6461 7465  100, self.update
-0000bb20: 5f64 6174 6162 6173 655f 6465 7461 696c  _database_detail
-0000bb30: 290d 0a0d 0a0d 0a20 2020 2064 6566 2075  )......    def u
-0000bb40: 7064 6174 655f 6461 7461 6261 7365 5f6c  pdate_database_l
-0000bb50: 6973 7428 7365 6c66 2c20 6669 6c65 6e61  ist(self, filena
-0000bb60: 6d65 3d22 2229 3a0d 0a20 2020 2020 2020  me=""):..       
-0000bb70: 2022 2222 0d0a 2020 2020 2020 2020 496e   """..        In
-0000bb80: 7365 7274 7320 7468 6520 6461 7461 6261  serts the databa
-0000bb90: 7365 2069 6e74 6f20 7468 6520 6c69 7374  se into the list
-0000bba0: 2c20 6966 206e 6f74 2074 6865 7265 2061  , if not there a
-0000bbb0: 6c72 6561 6479 2c20 616e 6420 7570 6461  lready, and upda
-0000bbc0: 7465 730d 0a20 2020 2020 2020 2055 4920  tes..        UI 
-0000bbd0: 6275 7474 6f6e 732e 0d0a 0d0a 2020 2020  buttons.....    
-0000bbe0: 2020 2020 4070 6172 616d 2020 2066 696c      @param   fil
-0000bbf0: 656e 616d 6520 2070 6f73 7369 626c 7920  ename  possibly 
-0000bc00: 6e65 7720 6669 6c65 6e61 6d65 2c20 6966  new filename, if
-0000bc10: 2061 6e79 0d0a 2020 2020 2020 2020 4072   any..        @r
-0000bc20: 6574 7572 6e20 2020 2020 2020 2020 2020  eturn           
-0000bc30: 2054 7275 6520 6966 2077 6173 2066 696c   True if was fil
-0000bc40: 6520 7761 7320 6e65 7720 6f72 2063 6861  e was new or cha
-0000bc50: 6e67 6564 2c20 4661 6c73 6520 6f74 6865  nged, False othe
-0000bc60: 7277 6973 650d 0a20 2020 2020 2020 2022  rwise..        "
-0000bc70: 2222 0d0a 2020 2020 2020 2020 7265 7375  ""..        resu
-0000bc80: 6c74 203d 2046 616c 7365 0d0a 2020 2020  lt = False..    
-0000bc90: 2020 2020 2320 496e 7365 7274 2069 6e74      # Insert int
-0000bca0: 6f20 6461 7461 6261 7365 206c 6973 7473  o database lists
-0000bcb0: 2c20 6966 206e 6f74 2061 6c72 6561 6479  , if not already
-0000bcc0: 2074 6865 7265 0d0a 2020 2020 2020 2020   there..        
-0000bcd0: 6966 2066 696c 656e 616d 653a 0d0a 2020  if filename:..  
-0000bce0: 2020 2020 2020 2020 2020 6669 6c65 6e61            filena
-0000bcf0: 6d65 203d 2075 7469 6c2e 746f 5f75 6e69  me = util.to_uni
-0000bd00: 636f 6465 2866 696c 656e 616d 6529 0d0a  code(filename)..
-0000bd10: 2020 2020 2020 2020 2020 2020 6966 2066              if f
-0000bd20: 696c 656e 616d 6520 6e6f 7420 696e 2063  ilename not in c
-0000bd30: 6f6e 662e 4442 4669 6c65 733a 0d0a 2020  onf.DBFiles:..  
-0000bd40: 2020 2020 2020 2020 2020 2020 2020 636f                co
-0000bd50: 6e66 2e44 4246 696c 6573 2e61 7070 656e  nf.DBFiles.appen
-0000bd60: 6428 6669 6c65 6e61 6d65 290d 0a20 2020  d(filename)..   
-0000bd70: 2020 2020 2020 2020 2020 2020 2075 7469               uti
-0000bd80: 6c2e 7275 6e5f 6f6e 6365 2863 6f6e 662e  l.run_once(conf.
-0000bd90: 7361 7665 290d 0a20 2020 2020 2020 2020  save)..         
-0000bda0: 2020 2064 6174 6120 3d20 636f 6c6c 6563     data = collec
-0000bdb0: 7469 6f6e 732e 6465 6661 756c 7464 6963  tions.defaultdic
-0000bdc0: 7428 6c61 6d62 6461 3a20 4e6f 6e65 2c20  t(lambda: None, 
-0000bdd0: 6e61 6d65 3d66 696c 656e 616d 6529 0d0a  name=filename)..
-0000bde0: 2020 2020 2020 2020 2020 2020 6966 206f              if o
-0000bdf0: 732e 7061 7468 2e65 7869 7374 7328 6669  s.path.exists(fi
-0000be00: 6c65 6e61 6d65 293a 0d0a 2020 2020 2020  lename):..      
-0000be10: 2020 2020 2020 2020 2020 6461 7461 5b22            data["
-0000be20: 7369 7a65 225d 203d 206f 732e 7061 7468  size"] = os.path
-0000be30: 2e67 6574 7369 7a65 2866 696c 656e 616d  .getsize(filenam
-0000be40: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
-0000be50: 2020 2020 6461 7461 5b22 6c61 7374 5f6d      data["last_m
-0000be60: 6f64 6966 6965 6422 5d20 3d20 6461 7465  odified"] = date
-0000be70: 7469 6d65 2e64 6174 6574 696d 652e 6672  time.datetime.fr
-0000be80: 6f6d 7469 6d65 7374 616d 7028 0d0a 2020  omtimestamp(..  
-0000be90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000beb0: 2020 2020 2020 6f73 2e70 6174 682e 6765        os.path.ge
-0000bec0: 746d 7469 6d65 2866 696c 656e 616d 6529  tmtime(filename)
-0000bed0: 290d 0a20 2020 2020 2020 2020 2020 2064  )..            d
-0000bee0: 6174 615f 6f6c 6420 3d20 7365 6c66 2e64  ata_old = self.d
-0000bef0: 625f 6669 6c65 6e61 6d65 732e 6765 7428  b_filenames.get(
-0000bf00: 6669 6c65 6e61 6d65 290d 0a20 2020 2020  filename)..     
-0000bf10: 2020 2020 2020 2069 6620 6e6f 7420 6461         if not da
-0000bf20: 7461 5f6f 6c64 206f 7220 6461 7461 5f6f  ta_old or data_o
-0000bf30: 6c64 5b22 7369 7a65 225d 2021 3d20 6461  ld["size"] != da
-0000bf40: 7461 5b22 7369 7a65 225d 205c 0d0a 2020  ta["size"] \..  
-0000bf50: 2020 2020 2020 2020 2020 6f72 2064 6174            or dat
-0000bf60: 615f 6f6c 645b 226c 6173 745f 6d6f 6469  a_old["last_modi
-0000bf70: 6669 6564 225d 2021 3d20 6461 7461 5b22  fied"] != data["
-0000bf80: 6c61 7374 5f6d 6f64 6966 6965 6422 5d3a  last_modified"]:
-0000bf90: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000bfa0: 2020 7365 6c66 2e64 625f 6669 6c65 6e61    self.db_filena
-0000bfb0: 6d65 732e 7365 7464 6566 6175 6c74 2866  mes.setdefault(f
-0000bfc0: 696c 656e 616d 652c 2064 6174 6129 2e75  ilename, data).u
-0000bfd0: 7064 6174 6528 6461 7461 290d 0a20 2020  pdate(data)..   
-0000bfe0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0000bff0: 6e6f 7420 6461 7461 5f6f 6c64 3a20 7365  not data_old: se
-0000c000: 6c66 2e6c 6973 745f 6462 2e41 7070 656e  lf.list_db.Appen
-0000c010: 6452 6f77 2864 6174 612c 205b 315d 290d  dRow(data, [1]).
-0000c020: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c030: 2072 6573 756c 7420 3d20 5472 7565 0d0a   result = True..
-0000c040: 0d0a 2020 2020 2020 2020 6861 735f 6974  ..        has_it
-0000c050: 656d 7320 3d20 7365 6c66 2e6c 6973 745f  ems = self.list_
-0000c060: 6462 2e47 6574 4974 656d 436f 756e 7428  db.GetItemCount(
-0000c070: 2920 3e20 310d 0a20 2020 2020 2020 2069  ) > 1..        i
-0000c080: 6620 7365 6c66 2e62 7574 746f 6e5f 636c  f self.button_cl
-0000c090: 6561 722e 5368 6f77 6e20 213d 2068 6173  ear.Shown != has
-0000c0a0: 5f69 7465 6d73 3a0d 0a20 2020 2020 2020  _items:..       
-0000c0b0: 2020 2020 2073 656c 662e 6275 7474 6f6e       self.button
-0000c0c0: 5f63 6c65 6172 2e53 686f 7728 6861 735f  _clear.Show(has_
-0000c0d0: 6974 656d 7329 0d0a 2020 2020 2020 2020  items)..        
-0000c0e0: 2020 2020 7365 6c66 2e70 616e 656c 5f64      self.panel_d
-0000c0f0: 625f 6d61 696e 2e4c 6179 6f75 7428 290d  b_main.Layout().
-0000c100: 0a20 2020 2020 2020 2073 656c 662e 7570  .        self.up
-0000c110: 6461 7465 5f64 6174 6162 6173 655f 636f  date_database_co
-0000c120: 756e 7428 290d 0a20 2020 2020 2020 2072  unt()..        r
-0000c130: 6574 7572 6e20 7265 7375 6c74 0d0a 0d0a  eturn result....
-0000c140: 0d0a 2020 2020 6465 6620 7570 6461 7465  ..    def update
-0000c150: 5f64 6174 6162 6173 655f 636f 756e 7428  _database_count(
-0000c160: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
-0000c170: 2222 2255 7064 6174 6573 2064 6174 6162  """Updates datab
-0000c180: 6173 6520 636f 756e 7420 6c61 6265 6c2e  ase count label.
-0000c190: 2222 220d 0a20 2020 2020 2020 2063 6f75  """..        cou
-0000c1a0: 6e74 203d 2073 656c 662e 6c69 7374 5f64  nt = self.list_d
-0000c1b0: 622e 4765 7449 7465 6d43 6f75 6e74 2829  b.GetItemCount()
-0000c1c0: 202d 2031 0d0a 2020 2020 2020 2020 746f   - 1..        to
-0000c1d0: 7461 6c20 3d20 7365 6c66 2e6c 6973 745f  tal = self.list_
-0000c1e0: 6462 2e47 6574 4974 656d 436f 756e 7446  db.GetItemCountF
-0000c1f0: 756c 6c28 2920 2d20 310d 0a20 2020 2020  ull() - 1..     
-0000c200: 2020 2074 6578 7420 3d20 2222 0d0a 2020     text = ""..  
-0000c210: 2020 2020 2020 6966 2074 6f74 616c 3a20        if total: 
-0000c220: 7465 7874 203d 2075 7469 6c2e 706c 7572  text = util.plur
-0000c230: 616c 2822 6669 6c65 222c 2063 6f75 6e74  al("file", count
-0000c240: 290d 0a20 2020 2020 2020 2069 6620 636f  )..        if co
-0000c250: 756e 7420 213d 2074 6f74 616c 3a20 7465  unt != total: te
-0000c260: 7874 202b 3d20 2220 7669 7369 626c 6520  xt += " visible 
-0000c270: 2825 7320 696e 2074 6f74 616c 2922 2025  (%s in total)" %
-0000c280: 2074 6f74 616c 0d0a 2020 2020 2020 2020   total..        
-0000c290: 7365 6c66 2e6c 6162 656c 5f63 6f75 6e74  self.label_count
-0000c2a0: 2e4c 6162 656c 203d 2074 6578 740d 0a0d  .Label = text...
-0000c2b0: 0a0d 0a20 2020 2064 6566 206f 6e5f 7265  ...    def on_re
-0000c2c0: 6d6f 7665 5f64 6174 6162 6173 6573 2873  move_databases(s
-0000c2d0: 656c 662c 2065 7665 6e74 293a 0d0a 2020  elf, event):..  
-0000c2e0: 2020 2020 2020 2222 2248 616e 646c 6572        """Handler
-0000c2f0: 2066 6f72 2063 6c69 636b 696e 6720 746f   for clicking to
-0000c300: 2072 656d 6f76 6520 6461 7461 6261 7365   remove database
-0000c310: 732c 206f 7065 6e73 2070 6f70 7570 206d  s, opens popup m
-0000c320: 656e 752e 2222 220d 0a20 2020 2020 2020  enu."""..       
-0000c330: 206d 656e 7520 3d20 7778 2e6c 6962 2e61   menu = wx.lib.a
-0000c340: 6777 2e66 6c61 746d 656e 752e 466c 6174  gw.flatmenu.Flat
-0000c350: 4d65 6e75 2829 0d0a 2020 2020 2020 2020  Menu()..        
-0000c360: 6974 656d 5f6d 6973 7369 6e67 2020 3d20  item_missing  = 
-0000c370: 6d65 6e75 2e41 7070 656e 6449 7465 6d28  menu.AppendItem(
-0000c380: 7778 2e6c 6962 2e61 6777 2e66 6c61 746d  wx.lib.agw.flatm
-0000c390: 656e 752e 466c 6174 4d65 6e75 4974 656d  enu.FlatMenuItem
-0000c3a0: 286d 656e 752c 2077 782e 4944 5f41 4e59  (menu, wx.ID_ANY
-0000c3b0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0000c3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c3d0: 2020 2020 2020 2020 2020 2252 656d 6f76            "Remov
-0000c3e0: 6520 266d 6973 7369 6e67 2066 696c 6573  e &missing files
-0000c3f0: 2229 290d 0a20 2020 2020 2020 2069 7465  "))..        ite
-0000c400: 6d5f 736b 7970 6520 2020 203d 206d 656e  m_skype    = men
-0000c410: 752e 4170 7065 6e64 4974 656d 2877 782e  u.AppendItem(wx.
-0000c420: 6c69 622e 6167 772e 666c 6174 6d65 6e75  lib.agw.flatmenu
-0000c430: 2e46 6c61 744d 656e 7549 7465 6d28 6d65  .FlatMenuItem(me
-0000c440: 6e75 2c20 7778 2e49 445f 414e 592c 0d0a  nu, wx.ID_ANY,..
-0000c450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c470: 2020 2020 2020 2022 5265 6d6f 7665 2026         "Remove &
-0000c480: 536b 7970 6520 6461 7461 6261 7365 7322  Skype databases"
-0000c490: 2929 0d0a 2020 2020 2020 2020 6974 656d  ))..        item
-0000c4a0: 5f6e 6f6e 736b 7970 6520 3d20 6d65 6e75  _nonskype = menu
-0000c4b0: 2e41 7070 656e 6449 7465 6d28 7778 2e6c  .AppendItem(wx.l
-0000c4c0: 6962 2e61 6777 2e66 6c61 746d 656e 752e  ib.agw.flatmenu.
-0000c4d0: 466c 6174 4d65 6e75 4974 656d 286d 656e  FlatMenuItem(men
-0000c4e0: 752c 2077 782e 4944 5f41 4e59 2c0d 0a20  u, wx.ID_ANY,.. 
-0000c4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c510: 2020 2020 2020 2252 656d 6f76 6520 266e        "Remove &n
-0000c520: 6f6e 2d53 6b79 7065 2064 6174 6162 6173  on-Skype databas
-0000c530: 6573 2229 290d 0a20 2020 2020 2020 2069  es"))..        i
-0000c540: 7465 6d5f 636c 6561 7220 2020 3d20 6d65  tem_clear   = me
-0000c550: 6e75 2e41 7070 656e 6449 7465 6d28 7778  nu.AppendItem(wx
-0000c560: 2e6c 6962 2e61 6777 2e66 6c61 746d 656e  .lib.agw.flatmen
-0000c570: 752e 466c 6174 4d65 6e75 4974 656d 286d  u.FlatMenuItem(m
-0000c580: 656e 752c 2077 782e 4944 5f41 4e59 2c0d  enu, wx.ID_ANY,.
-0000c590: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009960: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+00009970: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00009980: 6174 615b 2273 697a 6522 5d20 3d20 6f73  ata["size"] = os
+00009990: 2e70 6174 682e 6765 7473 697a 6528 6669  .path.getsize(fi
+000099a0: 6c65 6e61 6d65 290d 0a20 2020 2020 2020  lename)..       
+000099b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000099c0: 2064 6174 615b 226c 6173 745f 6d6f 6469   data["last_modi
+000099d0: 6669 6564 225d 203d 2064 6174 6574 696d  fied"] = datetim
+000099e0: 652e 6461 7465 7469 6d65 2e66 726f 6d74  e.datetime.fromt
+000099f0: 696d 6573 7461 6d70 280d 0a20 2020 2020  imestamp(..     
+00009a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009a20: 2020 2020 2020 2020 2020 206f 732e 7061             os.pa
+00009a30: 7468 2e67 6574 6d74 696d 6528 6669 6c65  th.getmtime(file
+00009a40: 6e61 6d65 2929 0d0a 2020 2020 2020 2020  name))..        
+00009a50: 2020 2020 2020 2020 7365 6c66 2e64 625f          self.db_
+00009a60: 6669 6c65 6e61 6d65 735b 6669 6c65 6e61  filenames[filena
+00009a70: 6d65 5d2e 7570 6461 7465 2864 6174 6129  me].update(data)
+00009a80: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00009a90: 2020 6974 656d 732e 6170 7065 6e64 2864    items.append(d
+00009aa0: 6174 6129 0d0a 2020 2020 2020 2020 2020  ata)..          
+00009ab0: 2020 7365 6c66 2e6c 6973 745f 6462 2e50    self.list_db.P
+00009ac0: 6f70 756c 6174 6528 6974 656d 732c 205b  opulate(items, [
+00009ad0: 315d 290d 0a20 2020 2020 2020 2020 2020  1])..           
+00009ae0: 2069 6620 7365 6c65 6374 6564 5f68 6f6d   if selected_hom
+00009af0: 653a 2073 656c 662e 6c69 7374 5f64 622e  e: self.list_db.
+00009b00: 5365 6c65 6374 2830 290d 0a20 2020 2020  Select(0)..     
+00009b10: 2020 2020 2020 2069 6620 7365 6c65 6374         if select
+00009b20: 6564 5f66 696c 6573 3a0d 0a20 2020 2020  ed_files:..     
+00009b30: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
+00009b40: 2069 6e20 7261 6e67 6528 312c 2073 656c   in range(1, sel
+00009b50: 662e 6c69 7374 5f64 622e 4765 7449 7465  f.list_db.GetIte
+00009b60: 6d43 6f75 6e74 2829 293a 0d0a 2020 2020  mCount()):..    
+00009b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009b80: 6966 2073 656c 662e 6c69 7374 5f64 622e  if self.list_db.
+00009b90: 4765 7449 7465 6d54 6578 7428 6929 2069  GetItemText(i) i
+00009ba0: 6e20 7365 6c65 6374 6564 5f66 696c 6573  n selected_files
+00009bb0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00009bc0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00009bd0: 6c69 7374 5f64 622e 5365 6c65 6374 2869  list_db.Select(i
+00009be0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00009bf0: 2020 2073 656c 662e 7570 6461 7465 5f64     self.update_d
+00009c00: 6174 6162 6173 655f 6465 7461 696c 2829  atabase_detail()
+00009c10: 0d0a 2020 2020 2020 2020 656c 6966 2065  ..        elif e
+00009c20: 7665 6e74 2e4b 6579 436f 6465 2069 6e20  vent.KeyCode in 
+00009c30: 5b6f 7264 2822 4622 295d 2061 6e64 2065  [ord("F")] and e
+00009c40: 7665 6e74 2e43 6d64 446f 776e 2829 3a0d  vent.CmdDown():.
+00009c50: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00009c60: 662e 6564 6974 5f66 696c 7465 722e 5365  f.edit_filter.Se
+00009c70: 7446 6f63 7573 2829 0d0a 2020 2020 2020  tFocus()..      
+00009c80: 2020 6966 2073 656c 662e 6c69 7374 5f64    if self.list_d
+00009c90: 622e 4765 7446 6972 7374 5365 6c65 6374  b.GetFirstSelect
+00009ca0: 6564 2829 203e 2030 2061 6e64 206e 6f74  ed() > 0 and not
+00009cb0: 2065 7665 6e74 2e41 6c74 446f 776e 2829   event.AltDown()
+00009cc0: 205c 0d0a 2020 2020 2020 2020 616e 6420   \..        and 
+00009cd0: 6576 656e 742e 4b65 7943 6f64 6520 696e  event.KeyCode in
+00009ce0: 205b 7778 2e57 584b 5f52 4554 5552 4e2c   [wx.WXK_RETURN,
+00009cf0: 2077 782e 5758 4b5f 4e55 4d50 4144 5f45   wx.WXK_NUMPAD_E
+00009d00: 4e54 4552 5d3a 0d0a 2020 2020 2020 2020  NTER]:..        
+00009d10: 2020 2020 7365 6c66 2e6c 6f61 645f 6461      self.load_da
+00009d20: 7461 6261 7365 5f70 6167 6528 7365 6c66  tabase_page(self
+00009d30: 2e64 625f 6669 6c65 6e61 6d65 290d 0a20  .db_filename).. 
+00009d40: 2020 2020 2020 2065 6c69 6620 6576 656e         elif even
+00009d50: 742e 4b65 7943 6f64 6520 696e 205b 7778  t.KeyCode in [wx
+00009d60: 2e57 584b 5f44 454c 4554 455d 2061 6e64  .WXK_DELETE] and
+00009d70: 2073 656c 662e 6462 5f66 696c 656e 616d   self.db_filenam
+00009d80: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00009d90: 7365 6c66 2e6f 6e5f 7265 6d6f 7665 5f64  self.on_remove_d
+00009da0: 6174 6162 6173 6528 4e6f 6e65 290d 0a20  atabase(None).. 
+00009db0: 2020 2020 2020 2065 7665 6e74 2e53 6b69         event.Ski
+00009dc0: 7028 290d 0a0d 0a0d 0a20 2020 2064 6566  p()......    def
+00009dd0: 206f 6e5f 736f 7274 5f6c 6973 745f 6462   on_sort_list_db
+00009de0: 2873 656c 662c 2065 7665 6e74 293a 0d0a  (self, event):..
+00009df0: 2020 2020 2020 2020 2222 2248 616e 646c          """Handl
+00009e00: 6572 2066 6f72 2073 6f72 7469 6e67 2064  er for sorting d
+00009e10: 626c 6973 742c 2073 6176 6573 2073 6f72  blist, saves sor
+00009e20: 7420 7374 6174 652e 2222 220d 0a20 2020  t state."""..   
+00009e30: 2020 2020 2065 7665 6e74 2e53 6b69 7028       event.Skip(
+00009e40: 290d 0a20 2020 2020 2020 2064 6566 2073  )..        def s
+00009e50: 6176 655f 736f 7274 5f73 7461 7465 2829  ave_sort_state()
+00009e60: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
+00009e70: 6620 6e6f 7420 7365 6c66 3a20 7265 7475  f not self: retu
+00009e80: 726e 0d0a 2020 2020 2020 2020 2020 2020  rn..            
+00009e90: 636f 6e66 2e44 4253 6f72 7420 3d20 7365  conf.DBSort = se
+00009ea0: 6c66 2e6c 6973 745f 6462 2e47 6574 536f  lf.list_db.GetSo
+00009eb0: 7274 5374 6174 6528 290d 0a20 2020 2020  rtState()..     
+00009ec0: 2020 2020 2020 2075 7469 6c2e 7275 6e5f         util.run_
+00009ed0: 6f6e 6365 2863 6f6e 662e 7361 7665 290d  once(conf.save).
+00009ee0: 0a20 2020 2020 2020 2077 782e 4361 6c6c  .        wx.Call
+00009ef0: 4166 7465 7228 7361 7665 5f73 6f72 745f  After(save_sort_
+00009f00: 7374 6174 6529 2023 2041 6c6c 6f77 206c  state) # Allow l
+00009f10: 6973 7420 746f 2075 7064 6174 6520 736f  ist to update so
+00009f20: 7274 2073 7461 7465 0d0a 0d0a 0d0a 2020  rt state......  
+00009f30: 2020 6465 6620 6f6e 5f64 7261 675f 6c69    def on_drag_li
+00009f40: 7374 5f64 6228 7365 6c66 2c20 6576 656e  st_db(self, even
+00009f50: 7429 3a0d 0a20 2020 2020 2020 2022 2222  t):..        """
+00009f60: 4861 6e64 6c65 7220 666f 7220 6472 6167  Handler for drag
+00009f70: 6769 6e67 2069 7465 6d73 2061 726f 756e  ging items aroun
+00009f80: 6420 696e 2064 626c 6973 742c 2073 6176  d in dblist, sav
+00009f90: 6573 2066 696c 6520 6f72 6465 722e 2222  es file order.""
+00009fa0: 220d 0a20 2020 2020 2020 2065 7665 6e74  "..        event
+00009fb0: 2e53 6b69 7028 290d 0a20 2020 2020 2020  .Skip()..       
+00009fc0: 2064 6566 2073 6176 655f 6c69 7374 5f6f   def save_list_o
+00009fd0: 7264 6572 2829 3a0d 0a20 2020 2020 2020  rder():..       
+00009fe0: 2020 2020 2063 6f6e 662e 4442 4669 6c65       conf.DBFile
+00009ff0: 7320 3d20 5b73 656c 662e 6c69 7374 5f64  s = [self.list_d
+0000a000: 622e 4765 7449 7465 6d54 6578 7428 6929  b.GetItemText(i)
+0000a010: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000a020: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+0000a030: 7220 6920 696e 2072 616e 6765 2831 2c20  r i in range(1, 
+0000a040: 7365 6c66 2e6c 6973 745f 6462 2e47 6574  self.list_db.Get
+0000a050: 4974 656d 436f 756e 7446 756c 6c28 2929  ItemCountFull())
+0000a060: 5d0d 0a20 2020 2020 2020 2020 2020 2075  ]..            u
+0000a070: 7469 6c2e 7275 6e5f 6f6e 6365 2863 6f6e  til.run_once(con
+0000a080: 662e 7361 7665 290d 0a20 2020 2020 2020  f.save)..       
+0000a090: 2077 782e 4361 6c6c 4166 7465 7228 7361   wx.CallAfter(sa
+0000a0a0: 7665 5f6c 6973 745f 6f72 6465 7229 2023  ve_list_order) #
+0000a0b0: 2041 6c6c 6f77 206c 6973 7420 746f 2075   Allow list to u
+0000a0c0: 7064 6174 6520 6974 656d 730d 0a0d 0a0d  pdate items.....
+0000a0d0: 0a20 2020 2064 6566 206f 6e5f 6669 6c74  .    def on_filt
+0000a0e0: 6572 5f6c 6973 745f 6462 2873 656c 662c  er_list_db(self,
+0000a0f0: 2065 7665 6e74 293a 0d0a 2020 2020 2020   event):..      
+0000a100: 2020 2222 2248 616e 646c 6572 2066 6f72    """Handler for
+0000a110: 2066 696c 7465 7269 6e67 2064 626c 6973   filtering dblis
+0000a120: 742c 2061 7070 6c69 6573 2073 6561 7263  t, applies searc
+0000a130: 6820 6669 6c74 6572 2061 6674 6572 2074  h filter after t
+0000a140: 696d 656f 7574 2e22 2222 0d0a 2020 2020  imeout."""..    
+0000a150: 2020 2020 6576 656e 742e 536b 6970 2829      event.Skip()
+0000a160: 0d0a 2020 2020 2020 2020 7365 6172 6368  ..        search
+0000a170: 203d 2065 7665 6e74 2e53 7472 696e 672e   = event.String.
+0000a180: 7374 7269 7028 290d 0a20 2020 2020 2020  strip()..       
+0000a190: 2069 6620 7365 6172 6368 203d 3d20 7365   if search == se
+0000a1a0: 6c66 2e64 625f 6669 6c74 6572 3a20 7265  lf.db_filter: re
+0000a1b0: 7475 726e 0d0a 0d0a 2020 2020 2020 2020  turn....        
+0000a1c0: 6465 6620 646f 5f66 696c 7465 7228 7365  def do_filter(se
+0000a1d0: 6172 6368 293a 0d0a 2020 2020 2020 2020  arch):..        
+0000a1e0: 2020 2020 6966 206e 6f74 2073 656c 663a      if not self:
+0000a1f0: 2072 6574 7572 6e0d 0a20 2020 2020 2020   return..       
+0000a200: 2020 2020 2073 656c 662e 6462 5f66 696c       self.db_fil
+0000a210: 7465 725f 7469 6d65 7220 3d20 4e6f 6e65  ter_timer = None
+0000a220: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+0000a230: 2073 6561 7263 6820 213d 2073 656c 662e   search != self.
+0000a240: 6462 5f66 696c 7465 723a 2072 6574 7572  db_filter: retur
+0000a250: 6e0d 0a20 2020 2020 2020 2020 2020 2073  n..            s
+0000a260: 656c 662e 6c69 7374 5f64 622e 5365 7446  elf.list_db.SetF
+0000a270: 696c 7465 7228 7365 6172 6368 290d 0a20  ilter(search).. 
+0000a280: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000a290: 7570 6461 7465 5f64 6174 6162 6173 655f  update_database_
+0000a2a0: 6c69 7374 2829 0d0a 0d0a 2020 2020 2020  list()....      
+0000a2b0: 2020 6966 2073 656c 662e 6462 5f66 696c    if self.db_fil
+0000a2c0: 7465 725f 7469 6d65 723a 2073 656c 662e  ter_timer: self.
+0000a2d0: 6462 5f66 696c 7465 725f 7469 6d65 722e  db_filter_timer.
+0000a2e0: 5374 6f70 2829 0d0a 2020 2020 2020 2020  Stop()..        
+0000a2f0: 7365 6c66 2e64 625f 6669 6c74 6572 203d  self.db_filter =
+0000a300: 2073 6561 7263 680d 0a20 2020 2020 2020   search..       
+0000a310: 2069 6620 7365 6172 6368 3a20 7365 6c66   if search: self
+0000a320: 2e64 625f 6669 6c74 6572 5f74 696d 6572  .db_filter_timer
+0000a330: 203d 2077 782e 4361 6c6c 4c61 7465 7228   = wx.CallLater(
+0000a340: 3230 302c 2064 6f5f 6669 6c74 6572 2c20  200, do_filter, 
+0000a350: 7365 6172 6368 290d 0a20 2020 2020 2020  search)..       
+0000a360: 2065 6c73 653a 2064 6f5f 6669 6c74 6572   else: do_filter
+0000a370: 2873 6561 7263 6829 0d0a 0d0a 0d0a 2020  (search)......  
+0000a380: 2020 6465 6620 6f6e 5f6f 7065 6e5f 6665    def on_open_fe
+0000a390: 6564 6261 636b 2873 656c 662c 2065 7665  edback(self, eve
+0000a3a0: 6e74 3d4e 6f6e 6529 3a0d 0a20 2020 2020  nt=None):..     
+0000a3b0: 2020 2022 2222 4861 6e64 6c65 7220 666f     """Handler fo
+0000a3c0: 7220 636c 6963 6b69 6e67 2074 6f20 7365  r clicking to se
+0000a3d0: 6e64 2066 6565 6462 6163 6b2c 206f 7065  nd feedback, ope
+0000a3e0: 6e73 2074 6865 2066 6565 6462 6163 6b20  ns the feedback 
+0000a3f0: 666f 726d 2e22 2222 0d0a 2020 2020 2020  form."""..      
+0000a400: 2020 6966 206e 6f74 2073 656c 663a 2072    if not self: r
+0000a410: 6574 7572 6e0d 0a0d 0a20 2020 2020 2020  eturn....       
+0000a420: 2069 6620 7375 7070 6f72 742e 6665 6564   if support.feed
+0000a430: 6261 636b 5f77 696e 646f 773a 0d0a 2020  back_window:..  
+0000a440: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+0000a450: 2073 7570 706f 7274 2e66 6565 6462 6163   support.feedbac
+0000a460: 6b5f 7769 6e64 6f77 2e53 686f 776e 3a0d  k_window.Shown:.
+0000a470: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a480: 2073 7570 706f 7274 2e66 6565 6462 6163   support.feedbac
+0000a490: 6b5f 7769 6e64 6f77 2e53 686f 7728 290d  k_window.Show().
+0000a4a0: 0a20 2020 2020 2020 2020 2020 2073 7570  .            sup
+0000a4b0: 706f 7274 2e66 6565 6462 6163 6b5f 7769  port.feedback_wi
+0000a4c0: 6e64 6f77 2e52 6169 7365 2829 0d0a 2020  ndow.Raise()..  
+0000a4d0: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+0000a4e0: 2020 2020 2020 2020 2073 7570 706f 7274           support
+0000a4f0: 2e66 6565 6462 6163 6b5f 7769 6e64 6f77  .feedback_window
+0000a500: 203d 2073 7570 706f 7274 2e46 6565 6462   = support.Feedb
+0000a510: 6163 6b44 6961 6c6f 6728 7365 6c66 290d  ackDialog(self).
+0000a520: 0a0d 0a0d 0a20 2020 2064 6566 206f 6e5f  .....    def on_
+0000a530: 6d65 6e75 5f68 6f6d 6570 6167 6528 7365  menu_homepage(se
+0000a540: 6c66 2c20 6576 656e 7429 3a0d 0a20 2020  lf, event):..   
+0000a550: 2020 2020 2022 2222 4861 6e64 6c65 7220       """Handler 
+0000a560: 666f 7220 6f70 656e 696e 6720 536b 7970  for opening Skyp
+0000a570: 6572 696f 7573 2077 6562 7061 6765 2066  erious webpage f
+0000a580: 726f 6d20 6d65 6e75 2c22 2222 0d0a 2020  rom menu,"""..  
+0000a590: 2020 2020 2020 7765 6262 726f 7773 6572        webbrowser
+0000a5a0: 2e6f 7065 6e28 636f 6e66 2e48 6f6d 6555  .open(conf.HomeU
+0000a5b0: 726c 290d 0a0d 0a0d 0a20 2020 2064 6566  rl)......    def
+0000a5c0: 206f 6e5f 6162 6f75 7428 7365 6c66 2c20   on_about(self, 
+0000a5d0: 6576 656e 7429 3a0d 0a20 2020 2020 2020  event):..       
+0000a5e0: 2022 2222 0d0a 2020 2020 2020 2020 4861   """..        Ha
+0000a5f0: 6e64 6c65 7220 666f 7220 636c 6963 6b69  ndler for clicki
+0000a600: 6e67 2022 4162 6f75 7420 536b 7970 6572  ng "About Skyper
+0000a610: 696f 7573 2220 6d65 6e75 2c20 6f70 656e  ious" menu, open
+0000a620: 7320 6120 736d 616c 6c20 696e 666f 2066  s a small info f
+0000a630: 7261 6d65 2e0d 0a20 2020 2020 2020 2022  rame...        "
+0000a640: 2222 0d0a 2020 2020 2020 2020 6d61 6b65  ""..        make
+0000a650: 7465 7874 203d 206c 616d 6264 613a 2073  text = lambda: s
+0000a660: 7465 702e 5465 6d70 6c61 7465 2874 656d  tep.Template(tem
+0000a670: 706c 6174 6573 2e41 424f 5554 5f54 4558  plates.ABOUT_TEX
+0000a680: 5429 2e65 7870 616e 6428 290d 0a20 2020  T).expand()..   
+0000a690: 2020 2020 2041 626f 7574 4469 616c 6f67       AboutDialog
+0000a6a0: 2873 656c 662c 206d 616b 6574 6578 7429  (self, maketext)
+0000a6b0: 2e53 686f 774d 6f64 616c 2829 0d0a 0d0a  .ShowModal()....
+0000a6c0: 0d0a 2020 2020 6465 6620 6f6e 5f63 6865  ..    def on_che
+0000a6d0: 636b 5f75 7064 6174 6528 7365 6c66 2c20  ck_update(self, 
+0000a6e0: 6576 656e 7429 3a0d 0a20 2020 2020 2020  event):..       
+0000a6f0: 2022 2222 0d0a 2020 2020 2020 2020 4861   """..        Ha
+0000a700: 6e64 6c65 7220 666f 7220 6368 6563 6b69  ndler for checki
+0000a710: 6e67 2066 6f72 2075 7064 6174 6573 2c20  ng for updates, 
+0000a720: 7374 6172 7473 2061 2062 6163 6b67 726f  starts a backgro
+0000a730: 756e 6420 7072 6f63 6573 7320 666f 720d  und process for.
+0000a740: 0a20 2020 2020 2020 2063 6865 636b 696e  .        checkin
+0000a750: 6720 666f 7220 616e 6420 646f 776e 6c6f  g for and downlo
+0000a760: 6164 696e 6720 7468 6520 6e65 7765 7374  ading the newest
+0000a770: 2076 6572 7369 6f6e 2e0d 0a20 2020 2020   version...     
+0000a780: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
+0000a790: 6966 206e 6f74 2073 7570 706f 7274 2e75  if not support.u
+0000a7a0: 7064 6174 655f 7769 6e64 6f77 3a0d 0a20  pdate_window:.. 
+0000a7b0: 2020 2020 2020 2020 2020 2067 7569 6261             guiba
+0000a7c0: 7365 2e73 7461 7475 7328 2243 6865 636b  se.status("Check
+0000a7d0: 696e 6720 666f 7220 6e65 7720 7665 7273  ing for new vers
+0000a7e0: 696f 6e20 6f66 2025 732e 222c 2063 6f6e  ion of %s.", con
+0000a7f0: 662e 5469 746c 6529 0d0a 2020 2020 2020  f.Title)..      
+0000a800: 2020 2020 2020 7778 2e43 616c 6c41 6674        wx.CallAft
+0000a810: 6572 2873 7570 706f 7274 2e63 6865 636b  er(support.check
+0000a820: 5f6e 6577 6573 745f 7665 7273 696f 6e2c  _newest_version,
+0000a830: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000a840: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000a850: 6f6e 5f63 6865 636b 5f75 7064 6174 655f  on_check_update_
+0000a860: 6361 6c6c 6261 636b 290d 0a20 2020 2020  callback)..     
+0000a870: 2020 2065 6c69 6620 6861 7361 7474 7228     elif hasattr(
+0000a880: 7375 7070 6f72 742e 7570 6461 7465 5f77  support.update_w
+0000a890: 696e 646f 772c 2022 5261 6973 6522 293a  indow, "Raise"):
+0000a8a0: 0d0a 2020 2020 2020 2020 2020 2020 7375  ..            su
+0000a8b0: 7070 6f72 742e 7570 6461 7465 5f77 696e  pport.update_win
+0000a8c0: 646f 772e 5261 6973 6528 290d 0a0d 0a0d  dow.Raise().....
+0000a8d0: 0a20 2020 2064 6566 206f 6e5f 6368 6563  .    def on_chec
+0000a8e0: 6b5f 7570 6461 7465 5f63 616c 6c62 6163  k_update_callbac
+0000a8f0: 6b28 7365 6c66 2c20 6368 6563 6b5f 7265  k(self, check_re
+0000a900: 7375 6c74 2c20 6675 6c6c 5f72 6573 706f  sult, full_respo
+0000a910: 6e73 653d 5472 7565 293a 0d0a 2020 2020  nse=True):..    
+0000a920: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
+0000a930: 2043 616c 6c62 6163 6b20 6675 6e63 7469   Callback functi
+0000a940: 6f6e 2066 6f72 2070 726f 6365 7373 696e  on for processin
+0000a950: 6720 7570 6461 7465 2063 6865 636b 2072  g update check r
+0000a960: 6573 756c 742c 206f 6666 6572 7320 6e65  esult, offers ne
+0000a970: 770d 0a20 2020 2020 2020 2076 6572 7369  w..        versi
+0000a980: 6f6e 2066 6f72 2064 6f77 6e6c 6f61 6420  on for download 
+0000a990: 6966 2061 7661 696c 6162 6c65 2e0d 0a0d  if available....
+0000a9a0: 0a20 2020 2020 2020 2040 7061 7261 6d20  .        @param 
+0000a9b0: 2020 6675 6c6c 5f72 6573 706f 6e73 6520    full_response 
+0000a9c0: 2069 6620 4661 6c73 652c 2073 686f 7720   if False, show 
+0000a9d0: 6d65 7373 6167 6520 6f6e 6c79 2069 6620  message only if 
+0000a9e0: 7570 6461 7465 2061 7661 696c 6162 6c65  update available
+0000a9f0: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
+0000aa00: 2020 2020 2020 2069 6620 6e6f 7420 7365         if not se
+0000aa10: 6c66 3a20 7265 7475 726e 0d0a 0d0a 2020  lf: return....  
+0000aa20: 2020 2020 2020 7375 7070 6f72 742e 7570        support.up
+0000aa30: 6461 7465 5f77 696e 646f 7720 3d20 5472  date_window = Tr
+0000aa40: 7565 0d0a 2020 2020 2020 2020 6775 6962  ue..        guib
+0000aa50: 6173 652e 7374 6174 7573 2829 0d0a 2020  ase.status()..  
+0000aa60: 2020 2020 2020 6966 2063 6865 636b 5f72        if check_r
+0000aa70: 6573 756c 743a 0d0a 2020 2020 2020 2020  esult:..        
+0000aa80: 2020 2020 7665 7273 696f 6e2c 2075 726c      version, url
+0000aa90: 2c20 6368 616e 6765 7320 3d20 6368 6563  , changes = chec
+0000aaa0: 6b5f 7265 7375 6c74 0d0a 2020 2020 2020  k_result..      
+0000aab0: 2020 2020 2020 4d41 5820 3d20 3130 3030        MAX = 1000
+0000aac0: 0d0a 2020 2020 2020 2020 2020 2020 6368  ..            ch
+0000aad0: 616e 6765 7320 3d20 6368 616e 6765 735b  anges = changes[
+0000aae0: 3a4d 4158 5d20 2b20 222e 2e22 2069 6620  :MAX] + ".." if 
+0000aaf0: 6c65 6e28 6368 616e 6765 7329 203e 204d  len(changes) > M
+0000ab00: 4158 2065 6c73 6520 6368 616e 6765 730d  AX else changes.
+0000ab10: 0a20 2020 2020 2020 2020 2020 2067 7569  .            gui
+0000ab20: 6261 7365 2e73 7461 7475 7328 224e 6577  base.status("New
+0000ab30: 2025 7320 7665 7273 696f 6e20 2573 2061   %s version %s a
+0000ab40: 7661 696c 6162 6c65 2e22 2c20 636f 6e66  vailable.", conf
+0000ab50: 2e54 6974 6c65 2c20 7665 7273 696f 6e29  .Title, version)
+0000ab60: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+0000ab70: 206e 6f74 2063 6f6e 662e 5570 6461 7465   not conf.Update
+0000ab80: 4368 6563 6b45 6e61 626c 6564 3a20 7778  CheckEnabled: wx
+0000ab90: 2e4d 6573 7361 6765 426f 7828 0d0a 2020  .MessageBox(..  
+0000aba0: 2020 2020 2020 2020 2020 2020 2020 224e                "N
+0000abb0: 6577 6572 2076 6572 7369 6f6e 2028 2573  ewer version (%s
+0000abc0: 2920 6176 6169 6c61 626c 652e 2059 6f75  ) available. You
+0000abd0: 2061 7265 2063 7572 7265 6e74 6c79 206f   are currently o
+0000abe0: 6e20 7665 7273 696f 6e20 2573 2e25 7322  n version %s.%s"
+0000abf0: 2025 0d0a 2020 2020 2020 2020 2020 2020   %..            
+0000ac00: 2020 2020 2876 6572 7369 6f6e 2c20 636f      (version, co
+0000ac10: 6e66 2e56 6572 7369 6f6e 2c20 225c 6e5c  nf.Version, "\n\
+0000ac20: 6e25 735c 6e22 2025 2063 6861 6e67 6573  n%s\n" % changes
+0000ac30: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
+0000ac40: 2020 2020 2255 7064 6174 6520 696e 666f      "Update info
+0000ac50: 726d 6174 696f 6e22 2c20 7778 2e4f 4b20  rmation", wx.OK 
+0000ac60: 7c20 7778 2e49 434f 4e5f 494e 464f 524d  | wx.ICON_INFORM
+0000ac70: 4154 494f 4e0d 0a20 2020 2020 2020 2020  ATION..         
+0000ac80: 2020 2029 0d0a 2020 2020 2020 2020 2020     )..          
+0000ac90: 2020 656c 6966 2077 782e 4f4b 203d 3d20    elif wx.OK == 
+0000aca0: 7778 2e4d 6573 7361 6765 426f 7828 0d0a  wx.MessageBox(..
+0000acb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000acc0: 224e 6577 6572 2076 6572 7369 6f6e 2028  "Newer version (
+0000acd0: 2573 2920 6176 6169 6c61 626c 652e 2059  %s) available. Y
+0000ace0: 6f75 2061 7265 2063 7572 7265 6e74 6c79  ou are currently
+0000acf0: 206f 6e20 220d 0a20 2020 2020 2020 2020   on "..         
+0000ad00: 2020 2020 2020 2022 7665 7273 696f 6e20         "version 
+0000ad10: 2573 2e25 735c 6e44 6f77 6e6c 6f61 6420  %s.%s\nDownload 
+0000ad20: 616e 6420 696e 7374 616c 6c20 2573 2025  and install %s %
+0000ad30: 733f 2220 250d 0a20 2020 2020 2020 2020  s?" %..         
+0000ad40: 2020 2020 2020 2028 7665 7273 696f 6e2c         (version,
+0000ad50: 2063 6f6e 662e 5665 7273 696f 6e2c 2022   conf.Version, "
+0000ad60: 5c6e 5c6e 2573 5c6e 2220 2520 6368 616e  \n\n%s\n" % chan
+0000ad70: 6765 732c 0d0a 2020 2020 2020 2020 2020  ges,..          
+0000ad80: 2020 2020 2020 2063 6f6e 662e 5469 746c         conf.Titl
+0000ad90: 652c 2076 6572 7369 6f6e 292c 0d0a 2020  e, version),..  
+0000ada0: 2020 2020 2020 2020 2020 2020 2020 2255                "U
+0000adb0: 7064 6174 6520 696e 666f 726d 6174 696f  pdate informatio
+0000adc0: 6e22 2c20 7778 2e4f 4b20 7c20 7778 2e43  n", wx.OK | wx.C
+0000add0: 414e 4345 4c20 7c20 7778 2e49 434f 4e5f  ANCEL | wx.ICON_
+0000ade0: 494e 464f 524d 4154 494f 4e0d 0a20 2020  INFORMATION..   
+0000adf0: 2020 2020 2020 2020 2029 3a0d 0a20 2020           ):..   
+0000ae00: 2020 2020 2020 2020 2020 2020 2077 782e               wx.
+0000ae10: 4361 6c6c 4166 7465 7228 7375 7070 6f72  CallAfter(suppor
+0000ae20: 742e 646f 776e 6c6f 6164 5f61 6e64 5f69  t.download_and_i
+0000ae30: 6e73 7461 6c6c 2c20 7572 6c29 0d0a 2020  nstall, url)..  
+0000ae40: 2020 2020 2020 656c 6966 2066 756c 6c5f        elif full_
+0000ae50: 7265 7370 6f6e 7365 2061 6e64 2063 6865  response and che
+0000ae60: 636b 5f72 6573 756c 7420 6973 206e 6f74  ck_result is not
+0000ae70: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+0000ae80: 2020 2020 7778 2e4d 6573 7361 6765 426f      wx.MessageBo
+0000ae90: 7828 2259 6f75 2061 7265 2075 7369 6e67  x("You are using
+0000aea0: 2074 6865 206c 6174 6573 7420 7665 7273   the latest vers
+0000aeb0: 696f 6e20 6f66 2025 732c 2025 732e 5c6e  ion of %s, %s.\n
+0000aec0: 5c6e 2022 2025 0d0a 2020 2020 2020 2020  \n " %..        
+0000aed0: 2020 2020 2020 2020 2863 6f6e 662e 5469          (conf.Ti
+0000aee0: 746c 652c 2063 6f6e 662e 5665 7273 696f  tle, conf.Versio
+0000aef0: 6e29 2c20 2255 7064 6174 6520 696e 666f  n), "Update info
+0000af00: 726d 6174 696f 6e22 2c0d 0a20 2020 2020  rmation",..     
+0000af10: 2020 2020 2020 2020 2020 2077 782e 4f4b             wx.OK
+0000af20: 207c 2077 782e 4943 4f4e 5f49 4e46 4f52   | wx.ICON_INFOR
+0000af30: 4d41 5449 4f4e 290d 0a20 2020 2020 2020  MATION)..       
+0000af40: 2065 6c69 6620 6675 6c6c 5f72 6573 706f   elif full_respo
+0000af50: 6e73 653a 0d0a 2020 2020 2020 2020 2020  nse:..          
+0000af60: 2020 7778 2e4d 6573 7361 6765 426f 7828    wx.MessageBox(
+0000af70: 2243 6f75 6c64 206e 6f74 2063 6f6e 7461  "Could not conta
+0000af80: 6374 2064 6f77 6e6c 6f61 6420 7365 7276  ct download serv
+0000af90: 6572 2e22 2c0d 0a20 2020 2020 2020 2020  er.",..         
+0000afa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000afb0: 2022 5570 6461 7465 2069 6e66 6f72 6d61   "Update informa
+0000afc0: 7469 6f6e 222c 2077 782e 4f4b 207c 2077  tion", wx.OK | w
+0000afd0: 782e 4943 4f4e 5f57 4152 4e49 4e47 290d  x.ICON_WARNING).
+0000afe0: 0a20 2020 2020 2020 2069 6620 6368 6563  .        if chec
+0000aff0: 6b5f 7265 7375 6c74 2069 7320 6e6f 7420  k_result is not 
+0000b000: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+0000b010: 2020 2063 6f6e 662e 4c61 7374 5570 6461     conf.LastUpda
+0000b020: 7465 4368 6563 6b20 3d20 6461 7465 7469  teCheck = dateti
+0000b030: 6d65 2e64 6174 652e 746f 6461 7928 292e  me.date.today().
+0000b040: 7374 7266 7469 6d65 2822 2559 256d 2564  strftime("%Y%m%d
+0000b050: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
+0000b060: 7574 696c 2e72 756e 5f6f 6e63 6528 636f  util.run_once(co
+0000b070: 6e66 2e73 6176 6529 0d0a 2020 2020 2020  nf.save)..      
+0000b080: 2020 7375 7070 6f72 742e 7570 6461 7465    support.update
+0000b090: 5f77 696e 646f 7720 3d20 4e6f 6e65 0d0a  _window = None..
+0000b0a0: 0d0a 0d0a 2020 2020 6465 6620 6f6e 5f64  ....    def on_d
+0000b0b0: 6574 6563 745f 6461 7461 6261 7365 7328  etect_databases(
+0000b0c0: 7365 6c66 2c20 6576 656e 7429 3a0d 0a20  self, event):.. 
+0000b0d0: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
+0000b0e0: 2020 2020 4861 6e64 6c65 7220 666f 7220      Handler for 
+0000b0f0: 636c 6963 6b69 6e67 2074 6f20 6175 746f  clicking to auto
+0000b100: 2d64 6574 6563 7420 6461 7461 6261 7365  -detect database
+0000b110: 732c 2073 7461 7274 7320 6f72 2073 746f  s, starts or sto
+0000b120: 7073 2074 6865 0d0a 2020 2020 2020 2020  ps the..        
+0000b130: 6465 7465 6374 696f 6e20 696e 2061 2062  detection in a b
+0000b140: 6163 6b67 726f 756e 6420 7468 7265 6164  ackground thread
+0000b150: 2e0d 0a20 2020 2020 2020 2022 2222 0d0a  ...        """..
+0000b160: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0000b170: 776f 726b 6572 5f64 6574 6563 7469 6f6e  worker_detection
+0000b180: 2e69 735f 776f 726b 696e 6728 293a 0d0a  .is_working():..
+0000b190: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000b1a0: 2e77 6f72 6b65 725f 6465 7465 6374 696f  .worker_detectio
+0000b1b0: 6e2e 7374 6f70 5f77 6f72 6b28 290d 0a20  n.stop_work().. 
+0000b1c0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000b1d0: 6275 7474 6f6e 5f64 6574 6563 742e 4c61  button_detect.La
+0000b1e0: 6265 6c20 3d20 2244 6574 6563 7420 6461  bel = "Detect da
+0000b1f0: 7461 6261 7365 7322 0d0a 2020 2020 2020  tabases"..      
+0000b200: 2020 2020 2020 6775 6962 6173 652e 7374        guibase.st
+0000b210: 6174 7573 2822 5374 6f70 7065 6420 6465  atus("Stopped de
+0000b220: 7465 6374 696e 6720 6461 7461 6261 7365  tecting database
+0000b230: 732e 222c 206c 6f67 3d54 7275 6529 0d0a  s.", log=True)..
+0000b240: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+0000b250: 2020 2020 2020 2020 2020 2067 7569 6261             guiba
+0000b260: 7365 2e73 7461 7475 7328 2253 6561 7263  se.status("Searc
+0000b270: 6869 6e67 206c 6f63 616c 2063 6f6d 7075  hing local compu
+0000b280: 7465 7220 666f 7220 536b 7970 6520 6461  ter for Skype da
+0000b290: 7461 6261 7365 732e 2e22 2c20 6c6f 673d  tabases..", log=
+0000b2a0: 5472 7565 290d 0a20 2020 2020 2020 2020  True)..         
+0000b2b0: 2020 2073 656c 662e 6275 7474 6f6e 5f64     self.button_d
+0000b2c0: 6574 6563 742e 4c61 6265 6c20 3d20 2253  etect.Label = "S
+0000b2d0: 746f 7020 6465 7465 6374 696e 6720 6461  top detecting da
+0000b2e0: 7461 6261 7365 7322 0d0a 2020 2020 2020  tabases"..      
+0000b2f0: 2020 2020 2020 7365 6c66 2e77 6f72 6b65        self.worke
+0000b300: 725f 6465 7465 6374 696f 6e2e 776f 726b  r_detection.work
+0000b310: 2854 7275 6529 0d0a 0d0a 0d0a 2020 2020  (True)......    
+0000b320: 6465 6620 6f6e 5f64 6574 6563 745f 6461  def on_detect_da
+0000b330: 7461 6261 7365 735f 6361 6c6c 6261 636b  tabases_callback
+0000b340: 2873 656c 662c 2072 6573 756c 7429 3a0d  (self, result):.
+0000b350: 0a20 2020 2020 2020 2022 2222 4361 6c6c  .        """Call
+0000b360: 6261 636b 2066 6f72 2044 6574 6563 7444  back for DetectD
+0000b370: 6174 6162 6173 6554 6872 6561 642c 2070  atabaseThread, p
+0000b380: 6f73 7473 2074 6865 2064 6174 6120 746f  osts the data to
+0000b390: 2073 656c 662e 2222 220d 0a20 2020 2020   self."""..     
+0000b3a0: 2020 2069 6620 7365 6c66 3a20 2320 4368     if self: # Ch
+0000b3b0: 6563 6b20 6966 2069 6e73 7461 6e63 6520  eck if instance 
+0000b3c0: 6973 2073 7469 6c6c 2076 616c 6964 2028  is still valid (
+0000b3d0: 692e 652e 206e 6f74 2064 6573 7472 6f79  i.e. not destroy
+0000b3e0: 6564 2062 7920 7778 290d 0a20 2020 2020  ed by wx)..     
+0000b3f0: 2020 2020 2020 2077 782e 506f 7374 4576         wx.PostEv
+0000b400: 656e 7428 7365 6c66 2c20 4465 7465 6374  ent(self, Detect
+0000b410: 696f 6e57 6f72 6b65 7245 7665 6e74 2872  ionWorkerEvent(r
+0000b420: 6573 756c 743d 7265 7375 6c74 2929 0d0a  esult=result))..
+0000b430: 0d0a 0d0a 2020 2020 6465 6620 6f6e 5f64  ....    def on_d
+0000b440: 6574 6563 745f 6461 7461 6261 7365 735f  etect_databases_
+0000b450: 7265 7375 6c74 2873 656c 662c 2065 7665  result(self, eve
+0000b460: 6e74 293a 0d0a 2020 2020 2020 2020 2222  nt):..        ""
+0000b470: 220d 0a20 2020 2020 2020 2048 616e 646c  "..        Handl
+0000b480: 6572 2066 6f72 2067 6574 7469 6e67 2072  er for getting r
+0000b490: 6573 756c 7473 2066 726f 6d20 6461 7461  esults from data
+0000b4a0: 6261 7365 2064 6574 6563 7469 6f6e 2074  base detection t
+0000b4b0: 6872 6561 642c 2061 6464 7320 7468 650d  hread, adds the.
+0000b4c0: 0a20 2020 2020 2020 2072 6573 756c 7473  .        results
+0000b4d0: 2074 6f20 7468 6520 6461 7461 6261 7365   to the database
+0000b4e0: 206c 6973 742e 0d0a 2020 2020 2020 2020   list...        
+0000b4f0: 2222 220d 0a20 2020 2020 2020 2072 6573  """..        res
+0000b500: 756c 7420 3d20 6576 656e 742e 7265 7375  ult = event.resu
+0000b510: 6c74 0d0a 2020 2020 2020 2020 6966 2022  lt..        if "
+0000b520: 6669 6c65 6e61 6d65 7322 2069 6e20 7265  filenames" in re
+0000b530: 7375 6c74 3a0d 0a20 2020 2020 2020 2020  sult:..         
+0000b540: 2020 2066 6f72 2066 2069 6e20 7265 7375     for f in resu
+0000b550: 6c74 5b22 6669 6c65 6e61 6d65 7322 5d3a  lt["filenames"]:
+0000b560: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000b570: 2020 6966 2073 656c 662e 7570 6461 7465    if self.update
+0000b580: 5f64 6174 6162 6173 655f 6c69 7374 2866  _database_list(f
+0000b590: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+0000b5a0: 2020 2020 2020 2020 6c6f 6767 6572 2e69          logger.i
+0000b5b0: 6e66 6f28 2244 6574 6563 7465 6420 6461  nfo("Detected da
+0000b5c0: 7461 6261 7365 2025 732e 222c 2066 290d  tabase %s.", f).
+0000b5d0: 0a20 2020 2020 2020 2069 6620 2263 6f75  .        if "cou
+0000b5e0: 6e74 2220 696e 2072 6573 756c 743a 0d0a  nt" in result:..
+0000b5f0: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
+0000b600: 203d 2028 2222 2069 6620 7265 7375 6c74   = ("" if result
+0000b610: 5b22 636f 756e 7422 5d20 656c 7365 2022  ["count"] else "
+0000b620: 6164 6469 7469 6f6e 616c 2022 2920 2b20  additional ") + 
+0000b630: 2264 6174 6162 6173 6522 0d0a 2020 2020  "database"..    
+0000b640: 2020 2020 2020 2020 6775 6962 6173 652e          guibase.
+0000b650: 7374 6174 7573 2822 4465 7465 6374 6564  status("Detected
+0000b660: 2025 732e 222c 2075 7469 6c2e 706c 7572   %s.", util.plur
+0000b670: 616c 286e 616d 652c 2072 6573 756c 745b  al(name, result[
+0000b680: 2263 6f75 6e74 225d 292c 206c 6f67 3d54  "count"]), log=T
+0000b690: 7275 6529 0d0a 2020 2020 2020 2020 6966  rue)..        if
+0000b6a0: 2072 6573 756c 742e 6765 7428 2264 6f6e   result.get("don
+0000b6b0: 6522 2c20 4661 6c73 6529 3a0d 0a20 2020  e", False):..   
+0000b6c0: 2020 2020 2020 2020 2073 656c 662e 6275           self.bu
+0000b6d0: 7474 6f6e 5f64 6574 6563 742e 4c61 6265  tton_detect.Labe
+0000b6e0: 6c20 3d20 2244 6574 6563 7420 6461 7461  l = "Detect data
+0000b6f0: 6261 7365 7322 0d0a 2020 2020 2020 2020  bases"..        
+0000b700: 2020 2020 7365 6c66 2e6c 6973 745f 6462      self.list_db
+0000b710: 2e53 656e 6453 697a 6545 7665 6e74 2829  .SendSizeEvent()
+0000b720: 0d0a 2020 2020 2020 2020 2020 2020 7778  ..            wx
+0000b730: 2e42 656c 6c28 290d 0a0d 0a0d 0a20 2020  .Bell()......   
+0000b740: 2064 6566 2070 6f70 756c 6174 655f 6461   def populate_da
+0000b750: 7461 6261 7365 5f6c 6973 7428 7365 6c66  tabase_list(self
+0000b760: 293a 0d0a 2020 2020 2020 2020 2222 2249  ):..        """I
+0000b770: 6e73 6572 7473 2061 6c6c 2064 6174 6162  nserts all datab
+0000b780: 6173 6573 2069 6e74 6f20 7468 6520 6c69  ases into the li
+0000b790: 7374 2c20 7570 6461 7465 7320 5549 2062  st, updates UI b
+0000b7a0: 7574 746f 6e73 2e22 2222 0d0a 2020 2020  uttons."""..    
+0000b7b0: 2020 2020 6966 206e 6f74 2073 656c 663a      if not self:
+0000b7c0: 2072 6574 7572 6e0d 0a20 2020 2020 2020   return..       
+0000b7d0: 2069 7465 6d73 2c20 7365 6c65 6374 6564   items, selected
+0000b7e0: 5f66 696c 6573 203d 205b 5d2c 205b 5d0d  _files = [], [].
+0000b7f0: 0a20 2020 2020 2020 2066 6f72 2066 696c  .        for fil
+0000b800: 656e 616d 6520 696e 2063 6f6e 662e 4442  ename in conf.DB
+0000b810: 4669 6c65 733a 0d0a 2020 2020 2020 2020  Files:..        
+0000b820: 2020 2020 6669 6c65 6e61 6d65 203d 2075      filename = u
+0000b830: 7469 6c2e 746f 5f75 6e69 636f 6465 2866  til.to_unicode(f
+0000b840: 696c 656e 616d 6529 0d0a 2020 2020 2020  ilename)..      
+0000b850: 2020 2020 2020 6461 7461 203d 2063 6f6c        data = col
+0000b860: 6c65 6374 696f 6e73 2e64 6566 6175 6c74  lections.default
+0000b870: 6469 6374 286c 616d 6264 613a 204e 6f6e  dict(lambda: Non
+0000b880: 652c 206e 616d 653d 6669 6c65 6e61 6d65  e, name=filename
+0000b890: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
+0000b8a0: 6620 6f73 2e70 6174 682e 6578 6973 7473  f os.path.exists
+0000b8b0: 2866 696c 656e 616d 6529 3a0d 0a20 2020  (filename):..   
+0000b8c0: 2020 2020 2020 2020 2020 2020 2064 6174               dat
+0000b8d0: 615b 2273 697a 6522 5d20 3d20 6f73 2e70  a["size"] = os.p
+0000b8e0: 6174 682e 6765 7473 697a 6528 6669 6c65  ath.getsize(file
+0000b8f0: 6e61 6d65 290d 0a20 2020 2020 2020 2020  name)..         
+0000b900: 2020 2020 2020 2064 6174 615b 226c 6173         data["las
+0000b910: 745f 6d6f 6469 6669 6564 225d 203d 2064  t_modified"] = d
+0000b920: 6174 6574 696d 652e 6461 7465 7469 6d65  atetime.datetime
+0000b930: 2e66 726f 6d74 696d 6573 7461 6d70 280d  .fromtimestamp(.
+0000b940: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b960: 2020 2020 2020 2020 206f 732e 7061 7468           os.path
+0000b970: 2e67 6574 6d74 696d 6528 6669 6c65 6e61  .getmtime(filena
+0000b980: 6d65 2929 0d0a 2020 2020 2020 2020 2020  me))..          
+0000b990: 2020 7365 6c66 2e64 625f 6669 6c65 6e61    self.db_filena
+0000b9a0: 6d65 735b 6669 6c65 6e61 6d65 5d20 3d20  mes[filename] = 
+0000b9b0: 6461 7461 0d0a 2020 2020 2020 2020 2020  data..          
+0000b9c0: 2020 6974 656d 732e 6170 7065 6e64 2864    items.append(d
+0000b9d0: 6174 6129 0d0a 2020 2020 2020 2020 2020  ata)..          
+0000b9e0: 2020 6966 2066 696c 656e 616d 6520 696e    if filename in
+0000b9f0: 2063 6f6e 662e 4c61 7374 5365 6c65 6374   conf.LastSelect
+0000ba00: 6564 4669 6c65 733a 2073 656c 6563 7465  edFiles: selecte
+0000ba10: 645f 6669 6c65 7320 2b3d 205b 6669 6c65  d_files += [file
+0000ba20: 6e61 6d65 5d0d 0a0d 0a20 2020 2020 2020  name]....       
+0000ba30: 2073 656c 662e 6c69 7374 5f64 622e 506f   self.list_db.Po
+0000ba40: 7075 6c61 7465 2869 7465 6d73 2c20 5b31  pulate(items, [1
+0000ba50: 5d29 0d0a 2020 2020 2020 2020 6966 2063  ])..        if c
+0000ba60: 6f6e 662e 4442 536f 7274 2061 6e64 2063  onf.DBSort and c
+0000ba70: 6f6e 662e 4442 536f 7274 5b30 5d20 3e3d  onf.DBSort[0] >=
+0000ba80: 2030 3a0d 0a20 2020 2020 2020 2020 2020   0:..           
+0000ba90: 2073 656c 662e 6c69 7374 5f64 622e 536f   self.list_db.So
+0000baa0: 7274 4c69 7374 4974 656d 7328 2a63 6f6e  rtListItems(*con
+0000bab0: 662e 4442 536f 7274 290d 0a0d 0a20 2020  f.DBSort)....   
+0000bac0: 2020 2020 2069 6620 7365 6c65 6374 6564       if selected
+0000bad0: 5f66 696c 6573 3a0d 0a20 2020 2020 2020  _files:..       
+0000bae0: 2020 2020 2069 6478 203d 202d 310d 0a20       idx = -1.. 
+0000baf0: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
+0000bb00: 2069 6e20 7261 6e67 6528 312c 2073 656c   in range(1, sel
+0000bb10: 662e 6c69 7374 5f64 622e 4765 7449 7465  f.list_db.GetIte
+0000bb20: 6d43 6f75 6e74 2829 293a 0d0a 2020 2020  mCount()):..    
+0000bb30: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+0000bb40: 656c 662e 6c69 7374 5f64 622e 4765 7449  elf.list_db.GetI
+0000bb50: 7465 6d54 6578 7428 6929 2069 6e20 7365  temText(i) in se
+0000bb60: 6c65 6374 6564 5f66 696c 6573 3a0d 0a20  lected_files:.. 
+0000bb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bb80: 2020 2069 6620 6964 7820 3c20 303a 2069     if idx < 0: i
+0000bb90: 6478 203d 2069 0d0a 2020 2020 2020 2020  dx = i..        
+0000bba0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000bbb0: 2e6c 6973 745f 6462 2e53 656c 6563 7428  .list_db.Select(
+0000bbc0: 6929 0d0a 2020 2020 2020 2020 2020 2020  i)..            
+0000bbd0: 7365 6c66 2e6c 6973 745f 6462 2e45 6e73  self.list_db.Ens
+0000bbe0: 7572 6556 6973 6962 6c65 2869 6478 290d  ureVisible(idx).
+0000bbf0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000bc00: 662e 6c69 7374 5f64 622e 5365 7446 6f63  f.list_db.SetFoc
+0000bc10: 7573 2829 0d0a 2020 2020 2020 2020 656c  us()..        el
+0000bc20: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+0000bc30: 2073 656c 662e 6c69 7374 5f64 622e 5365   self.list_db.Se
+0000bc40: 6c65 6374 2830 290d 0a0d 0a20 2020 2020  lect(0)....     
+0000bc50: 2020 2073 656c 662e 6275 7474 6f6e 5f63     self.button_c
+0000bc60: 6c65 6172 2e53 686f 7728 626f 6f6c 2869  lear.Show(bool(i
+0000bc70: 7465 6d73 2929 0d0a 2020 2020 2020 2020  tems))..        
+0000bc80: 7365 6c66 2e70 616e 656c 5f64 625f 6d61  self.panel_db_ma
+0000bc90: 696e 2e4c 6179 6f75 7428 290d 0a20 2020  in.Layout()..   
+0000bca0: 2020 2020 2073 656c 662e 7570 6461 7465       self.update
+0000bcb0: 5f64 6174 6162 6173 655f 636f 756e 7428  _database_count(
+0000bcc0: 290d 0a20 2020 2020 2020 2069 6620 7365  )..        if se
+0000bcd0: 6c65 6374 6564 5f66 696c 6573 3a20 7778  lected_files: wx
+0000bce0: 2e43 616c 6c4c 6174 6572 2831 3030 2c20  .CallLater(100, 
+0000bcf0: 7365 6c66 2e75 7064 6174 655f 6461 7461  self.update_data
+0000bd00: 6261 7365 5f64 6574 6169 6c29 0d0a 0d0a  base_detail)....
+0000bd10: 0d0a 2020 2020 6465 6620 7570 6461 7465  ..    def update
+0000bd20: 5f64 6174 6162 6173 655f 6c69 7374 2873  _database_list(s
+0000bd30: 656c 662c 2066 696c 656e 616d 653d 2222  elf, filename=""
+0000bd40: 293a 0d0a 2020 2020 2020 2020 2222 220d  ):..        """.
+0000bd50: 0a20 2020 2020 2020 2049 6e73 6572 7473  .        Inserts
+0000bd60: 2074 6865 2064 6174 6162 6173 6520 696e   the database in
+0000bd70: 746f 2074 6865 206c 6973 742c 2069 6620  to the list, if 
+0000bd80: 6e6f 7420 7468 6572 6520 616c 7265 6164  not there alread
+0000bd90: 792c 2061 6e64 2075 7064 6174 6573 0d0a  y, and updates..
+0000bda0: 2020 2020 2020 2020 5549 2062 7574 746f          UI butto
+0000bdb0: 6e73 2e0d 0a0d 0a20 2020 2020 2020 2040  ns.....        @
+0000bdc0: 7061 7261 6d20 2020 6669 6c65 6e61 6d65  param   filename
+0000bdd0: 2020 706f 7373 6962 6c79 206e 6577 2066    possibly new f
+0000bde0: 696c 656e 616d 652c 2069 6620 616e 790d  ilename, if any.
+0000bdf0: 0a20 2020 2020 2020 2040 7265 7475 726e  .        @return
+0000be00: 2020 2020 2020 2020 2020 2020 5472 7565              True
+0000be10: 2069 6620 7761 7320 6669 6c65 2077 6173   if was file was
+0000be20: 206e 6577 206f 7220 6368 616e 6765 642c   new or changed,
+0000be30: 2046 616c 7365 206f 7468 6572 7769 7365   False otherwise
+0000be40: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
+0000be50: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
+0000be60: 4661 6c73 650d 0a20 2020 2020 2020 2023  False..        #
+0000be70: 2049 6e73 6572 7420 696e 746f 2064 6174   Insert into dat
+0000be80: 6162 6173 6520 6c69 7374 732c 2069 6620  abase lists, if 
+0000be90: 6e6f 7420 616c 7265 6164 7920 7468 6572  not already ther
+0000bea0: 650d 0a20 2020 2020 2020 2069 6620 6669  e..        if fi
+0000beb0: 6c65 6e61 6d65 3a0d 0a20 2020 2020 2020  lename:..       
+0000bec0: 2020 2020 2066 696c 656e 616d 6520 3d20       filename = 
+0000bed0: 7574 696c 2e74 6f5f 756e 6963 6f64 6528  util.to_unicode(
+0000bee0: 6669 6c65 6e61 6d65 290d 0a20 2020 2020  filename)..     
+0000bef0: 2020 2020 2020 2069 6620 6669 6c65 6e61         if filena
+0000bf00: 6d65 206e 6f74 2069 6e20 636f 6e66 2e44  me not in conf.D
+0000bf10: 4246 696c 6573 3a0d 0a20 2020 2020 2020  BFiles:..       
+0000bf20: 2020 2020 2020 2020 2063 6f6e 662e 4442           conf.DB
+0000bf30: 4669 6c65 732e 6170 7065 6e64 2866 696c  Files.append(fil
+0000bf40: 656e 616d 6529 0d0a 2020 2020 2020 2020  ename)..        
+0000bf50: 2020 2020 2020 2020 7574 696c 2e72 756e          util.run
+0000bf60: 5f6f 6e63 6528 636f 6e66 2e73 6176 6529  _once(conf.save)
+0000bf70: 0d0a 2020 2020 2020 2020 2020 2020 6461  ..            da
+0000bf80: 7461 203d 2063 6f6c 6c65 6374 696f 6e73  ta = collections
+0000bf90: 2e64 6566 6175 6c74 6469 6374 286c 616d  .defaultdict(lam
+0000bfa0: 6264 613a 204e 6f6e 652c 206e 616d 653d  bda: None, name=
+0000bfb0: 6669 6c65 6e61 6d65 290d 0a20 2020 2020  filename)..     
+0000bfc0: 2020 2020 2020 2069 6620 6f73 2e70 6174         if os.pat
+0000bfd0: 682e 6578 6973 7473 2866 696c 656e 616d  h.exists(filenam
+0000bfe0: 6529 3a0d 0a20 2020 2020 2020 2020 2020  e):..           
+0000bff0: 2020 2020 2064 6174 615b 2273 697a 6522       data["size"
+0000c000: 5d20 3d20 6f73 2e70 6174 682e 6765 7473  ] = os.path.gets
+0000c010: 697a 6528 6669 6c65 6e61 6d65 290d 0a20  ize(filename).. 
+0000c020: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0000c030: 6174 615b 226c 6173 745f 6d6f 6469 6669  ata["last_modifi
+0000c040: 6564 225d 203d 2064 6174 6574 696d 652e  ed"] = datetime.
+0000c050: 6461 7465 7469 6d65 2e66 726f 6d74 696d  datetime.fromtim
+0000c060: 6573 7461 6d70 280d 0a20 2020 2020 2020  estamp(..       
+0000c070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c090: 206f 732e 7061 7468 2e67 6574 6d74 696d   os.path.getmtim
+0000c0a0: 6528 6669 6c65 6e61 6d65 2929 0d0a 2020  e(filename))..  
+0000c0b0: 2020 2020 2020 2020 2020 6461 7461 5f6f            data_o
+0000c0c0: 6c64 203d 2073 656c 662e 6462 5f66 696c  ld = self.db_fil
+0000c0d0: 656e 616d 6573 2e67 6574 2866 696c 656e  enames.get(filen
+0000c0e0: 616d 6529 0d0a 2020 2020 2020 2020 2020  ame)..          
+0000c0f0: 2020 6966 206e 6f74 2064 6174 615f 6f6c    if not data_ol
+0000c100: 6420 6f72 2064 6174 615f 6f6c 645b 2273  d or data_old["s
+0000c110: 697a 6522 5d20 213d 2064 6174 615b 2273  ize"] != data["s
+0000c120: 697a 6522 5d20 5c0d 0a20 2020 2020 2020  ize"] \..       
+0000c130: 2020 2020 206f 7220 6461 7461 5f6f 6c64       or data_old
+0000c140: 5b22 6c61 7374 5f6d 6f64 6966 6965 6422  ["last_modified"
+0000c150: 5d20 213d 2064 6174 615b 226c 6173 745f  ] != data["last_
+0000c160: 6d6f 6469 6669 6564 225d 3a0d 0a20 2020  modified"]:..   
+0000c170: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0000c180: 662e 6462 5f66 696c 656e 616d 6573 2e73  f.db_filenames.s
+0000c190: 6574 6465 6661 756c 7428 6669 6c65 6e61  etdefault(filena
+0000c1a0: 6d65 2c20 6461 7461 292e 7570 6461 7465  me, data).update
+0000c1b0: 2864 6174 6129 0d0a 2020 2020 2020 2020  (data)..        
+0000c1c0: 2020 2020 2020 2020 6966 206e 6f74 2064          if not d
+0000c1d0: 6174 615f 6f6c 643a 2073 656c 662e 6c69  ata_old: self.li
+0000c1e0: 7374 5f64 622e 4170 7065 6e64 526f 7728  st_db.AppendRow(
+0000c1f0: 6461 7461 2c20 5b31 5d29 0d0a 2020 2020  data, [1])..    
+0000c200: 2020 2020 2020 2020 2020 2020 7265 7375              resu
+0000c210: 6c74 203d 2054 7275 650d 0a0d 0a20 2020  lt = True....   
+0000c220: 2020 2020 2068 6173 5f69 7465 6d73 203d       has_items =
+0000c230: 2073 656c 662e 6c69 7374 5f64 622e 4765   self.list_db.Ge
+0000c240: 7449 7465 6d43 6f75 6e74 2829 203e 2031  tItemCount() > 1
+0000c250: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
+0000c260: 662e 6275 7474 6f6e 5f63 6c65 6172 2e53  f.button_clear.S
+0000c270: 686f 776e 2021 3d20 6861 735f 6974 656d  hown != has_item
+0000c280: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
+0000c290: 7365 6c66 2e62 7574 746f 6e5f 636c 6561  self.button_clea
+0000c2a0: 722e 5368 6f77 2868 6173 5f69 7465 6d73  r.Show(has_items
+0000c2b0: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
+0000c2c0: 656c 662e 7061 6e65 6c5f 6462 5f6d 6169  elf.panel_db_mai
+0000c2d0: 6e2e 4c61 796f 7574 2829 0d0a 2020 2020  n.Layout()..    
+0000c2e0: 2020 2020 7365 6c66 2e75 7064 6174 655f      self.update_
+0000c2f0: 6461 7461 6261 7365 5f63 6f75 6e74 2829  database_count()
+0000c300: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+0000c310: 2072 6573 756c 740d 0a0d 0a0d 0a20 2020   result......   
+0000c320: 2064 6566 2075 7064 6174 655f 6461 7461   def update_data
+0000c330: 6261 7365 5f63 6f75 6e74 2873 656c 6629  base_count(self)
+0000c340: 3a0d 0a20 2020 2020 2020 2022 2222 5570  :..        """Up
+0000c350: 6461 7465 7320 6461 7461 6261 7365 2063  dates database c
+0000c360: 6f75 6e74 206c 6162 656c 2e22 2222 0d0a  ount label."""..
+0000c370: 2020 2020 2020 2020 636f 756e 7420 3d20          count = 
+0000c380: 7365 6c66 2e6c 6973 745f 6462 2e47 6574  self.list_db.Get
+0000c390: 4974 656d 436f 756e 7428 2920 2d20 310d  ItemCount() - 1.
+0000c3a0: 0a20 2020 2020 2020 2074 6f74 616c 203d  .        total =
+0000c3b0: 2073 656c 662e 6c69 7374 5f64 622e 4765   self.list_db.Ge
+0000c3c0: 7449 7465 6d43 6f75 6e74 4675 6c6c 2829  tItemCountFull()
+0000c3d0: 202d 2031 0d0a 2020 2020 2020 2020 7465   - 1..        te
+0000c3e0: 7874 203d 2022 220d 0a20 2020 2020 2020  xt = ""..       
+0000c3f0: 2069 6620 746f 7461 6c3a 2074 6578 7420   if total: text 
+0000c400: 3d20 7574 696c 2e70 6c75 7261 6c28 2266  = util.plural("f
+0000c410: 696c 6522 2c20 636f 756e 7429 0d0a 2020  ile", count)..  
+0000c420: 2020 2020 2020 6966 2063 6f75 6e74 2021        if count !
+0000c430: 3d20 746f 7461 6c3a 2074 6578 7420 2b3d  = total: text +=
+0000c440: 2022 2076 6973 6962 6c65 2028 2573 2069   " visible (%s i
+0000c450: 6e20 746f 7461 6c29 2220 2520 746f 7461  n total)" % tota
+0000c460: 6c0d 0a20 2020 2020 2020 2073 656c 662e  l..        self.
+0000c470: 6c61 6265 6c5f 636f 756e 742e 4c61 6265  label_count.Labe
+0000c480: 6c20 3d20 7465 7874 0d0a 0d0a 0d0a 2020  l = text......  
+0000c490: 2020 6465 6620 6f6e 5f72 656d 6f76 655f    def on_remove_
+0000c4a0: 6461 7461 6261 7365 7328 7365 6c66 2c20  databases(self, 
+0000c4b0: 6576 656e 7429 3a0d 0a20 2020 2020 2020  event):..       
+0000c4c0: 2022 2222 4861 6e64 6c65 7220 666f 7220   """Handler for 
+0000c4d0: 636c 6963 6b69 6e67 2074 6f20 7265 6d6f  clicking to remo
+0000c4e0: 7665 2064 6174 6162 6173 6573 2c20 6f70  ve databases, op
+0000c4f0: 656e 7320 706f 7075 7020 6d65 6e75 2e22  ens popup menu."
+0000c500: 2222 0d0a 2020 2020 2020 2020 6d65 6e75  ""..        menu
+0000c510: 203d 2077 782e 6c69 622e 6167 772e 666c   = wx.lib.agw.fl
+0000c520: 6174 6d65 6e75 2e46 6c61 744d 656e 7528  atmenu.FlatMenu(
+0000c530: 290d 0a20 2020 2020 2020 2069 7465 6d5f  )..        item_
+0000c540: 6d69 7373 696e 6720 203d 206d 656e 752e  missing  = menu.
+0000c550: 4170 7065 6e64 4974 656d 2877 782e 6c69  AppendItem(wx.li
+0000c560: 622e 6167 772e 666c 6174 6d65 6e75 2e46  b.agw.flatmenu.F
+0000c570: 6c61 744d 656e 7549 7465 6d28 6d65 6e75  latMenuItem(menu
+0000c580: 2c20 7778 2e49 445f 414e 592c 0d0a 2020  , wx.ID_ANY,..  
+0000c590: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000c5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c5b0: 2020 2020 2020 2020 2252 656d 6f76 6520          "Remove 
-0000c5c0: 2661 6c6c 2229 290d 0a0d 0a20 2020 2020  &all"))....     
-0000c5d0: 2020 2073 656c 662e 4269 6e64 2877 782e     self.Bind(wx.
-0000c5e0: 4556 545f 4d45 4e55 2c20 7365 6c66 2e6f  EVT_MENU, self.o
-0000c5f0: 6e5f 7265 6d6f 7665 5f6d 6973 7369 6e67  n_remove_missing
-0000c600: 2c20 2069 7465 6d5f 6d69 7373 696e 6729  ,  item_missing)
-0000c610: 0d0a 2020 2020 2020 2020 7365 6c66 2e42  ..        self.B
-0000c620: 696e 6428 7778 2e45 5654 5f4d 454e 552c  ind(wx.EVT_MENU,
-0000c630: 2066 756e 6374 6f6f 6c73 2e70 6172 7469   functools.parti
-0000c640: 616c 2873 656c 662e 6f6e 5f72 656d 6f76  al(self.on_remov
-0000c650: 655f 7479 7065 2c20 6f74 6865 723d 4661  e_type, other=Fa
-0000c660: 6c73 6529 2c20 6974 656d 5f73 6b79 7065  lse), item_skype
-0000c670: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-0000c680: 4269 6e64 2877 782e 4556 545f 4d45 4e55  Bind(wx.EVT_MENU
-0000c690: 2c20 7365 6c66 2e6f 6e5f 7265 6d6f 7665  , self.on_remove
-0000c6a0: 5f74 7970 652c 2020 2020 2069 7465 6d5f  _type,     item_
-0000c6b0: 6e6f 6e73 6b79 7065 290d 0a20 2020 2020  nonskype)..     
-0000c6c0: 2020 2073 656c 662e 4269 6e64 2877 782e     self.Bind(wx.
-0000c6d0: 4556 545f 4d45 4e55 2c20 7365 6c66 2e6f  EVT_MENU, self.o
-0000c6e0: 6e5f 636c 6561 725f 6461 7461 6261 7365  n_clear_database
-0000c6f0: 732c 2069 7465 6d5f 636c 6561 7229 0d0a  s, item_clear)..
-0000c700: 0d0a 2020 2020 2020 2020 6274 6e20 3d20  ..        btn = 
-0000c710: 7365 6c66 2e62 7574 746f 6e5f 636c 6561  self.button_clea
-0000c720: 720d 0a20 2020 2020 2020 2073 7a5f 6274  r..        sz_bt
-0000c730: 6e2c 2070 745f 6274 6e20 3d20 6274 6e2e  n, pt_btn = btn.
-0000c740: 5369 7a65 2c20 6274 6e2e 506f 7369 7469  Size, btn.Positi
-0000c750: 6f6e 0d0a 2020 2020 2020 2020 7074 5f62  on..        pt_b
-0000c760: 746e 203d 2062 746e 2e50 6172 656e 742e  tn = btn.Parent.
-0000c770: 436c 6965 6e74 546f 5363 7265 656e 2870  ClientToScreen(p
-0000c780: 745f 6274 6e29 0d0a 2020 2020 2020 2020  t_btn)..        
-0000c790: 6d65 6e75 2e53 6574 4f77 6e65 7248 6569  menu.SetOwnerHei
-0000c7a0: 6768 7428 737a 5f62 746e 2e79 290d 0a20  ght(sz_btn.y).. 
-0000c7b0: 2020 2020 2020 2069 6620 6d65 6e75 2e53         if menu.S
-0000c7c0: 697a 652e 7769 6474 6820 3c20 737a 5f62  ize.width < sz_b
-0000c7d0: 746e 2e77 6964 7468 3a0d 0a20 2020 2020  tn.width:..     
-0000c7e0: 2020 2020 2020 206d 656e 752e 5369 7a65         menu.Size
-0000c7f0: 203d 2073 7a5f 6274 6e2e 7769 6474 682c   = sz_btn.width,
-0000c800: 206d 656e 752e 5369 7a65 2e68 6569 6768   menu.Size.heigh
-0000c810: 740d 0a20 2020 2020 2020 206d 656e 752e  t..        menu.
-0000c820: 506f 7075 7028 2870 745f 6274 6e29 2c20  Popup((pt_btn), 
-0000c830: 7365 6c66 290d 0a0d 0a0d 0a20 2020 2064  self)......    d
-0000c840: 6566 206f 6e5f 636c 6561 725f 6461 7461  ef on_clear_data
-0000c850: 6261 7365 7328 7365 6c66 2c20 6576 656e  bases(self, even
-0000c860: 7429 3a0d 0a20 2020 2020 2020 2022 2222  t):..        """
-0000c870: 4861 6e64 6c65 7220 666f 7220 636c 6963  Handler for clic
-0000c880: 6b69 6e67 2074 6f20 636c 6561 7220 7468  king to clear th
-0000c890: 6520 6461 7461 6261 7365 206c 6973 742e  e database list.
-0000c8a0: 2222 220d 0a20 2020 2020 2020 2069 735f  """..        is_
-0000c8b0: 6675 6c6c 203d 2073 656c 662e 6c69 7374  full = self.list
-0000c8c0: 5f64 622e 4765 7449 7465 6d43 6f75 6e74  _db.GetItemCount
-0000c8d0: 2829 203d 3d20 7365 6c66 2e6c 6973 745f  () == self.list_
-0000c8e0: 6462 2e47 6574 4974 656d 436f 756e 7446  db.GetItemCountF
-0000c8f0: 756c 6c28 290d 0a20 2020 2020 2020 2069  ull()..        i
-0000c900: 6620 7365 6c66 2e6c 6973 745f 6462 2e47  f self.list_db.G
-0000c910: 6574 4974 656d 436f 756e 7428 2920 3c20  etItemCount() < 
-0000c920: 3220 6f72 2077 782e 4f4b 2021 3d20 7778  2 or wx.OK != wx
-0000c930: 2e4d 6573 7361 6765 426f 7828 0d0a 2020  .MessageBox(..  
-0000c940: 2020 2020 2020 2020 2020 2241 7265 2079            "Are y
-0000c950: 6f75 2073 7572 6520 796f 7520 7761 6e74  ou sure you want
-0000c960: 2074 6f20 636c 6561 7220 7468 6520 6c69   to clear the li
-0000c970: 7374 206f 6620 616c 6c25 7320 6461 7461  st of all%s data
-0000c980: 6261 7365 733f 2220 250d 0a20 2020 2020  bases?" %..     
-0000c990: 2020 2020 2020 2028 2222 2069 6620 6973         ("" if is
-0000c9a0: 5f66 756c 6c20 656c 7365 2022 2063 7572  _full else " cur
-0000c9b0: 7265 6e74 6c79 2073 686f 776e 2229 2c0d  rently shown"),.
-0000c9c0: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
-0000c9d0: 662e 5469 746c 652c 2077 782e 4f4b 207c  f.Title, wx.OK |
-0000c9e0: 2077 782e 4341 4e43 454c 207c 2077 782e   wx.CANCEL | wx.
-0000c9f0: 4943 4f4e 5f51 5545 5354 494f 4e0d 0a20  ICON_QUESTION.. 
-0000ca00: 2020 2020 2020 2029 3a20 7265 7475 726e         ): return
-0000ca10: 0d0a 0d0a 2020 2020 2020 2020 636f 756e  ....        coun
-0000ca20: 7420 3d20 7365 6c66 2e6c 6973 745f 6462  t = self.list_db
-0000ca30: 2e47 6574 4974 656d 436f 756e 7428 2920  .GetItemCount() 
-0000ca40: 2d20 310d 0a20 2020 2020 2020 2069 6620  - 1..        if 
-0000ca50: 6973 5f66 756c 6c3a 0d0a 2020 2020 2020  is_full:..      
-0000ca60: 2020 2020 2020 7365 6c66 2e6c 6973 745f        self.list_
-0000ca70: 6462 2e50 6f70 756c 6174 6528 5b5d 290d  db.Populate([]).
-0000ca80: 0a20 2020 2020 2020 2020 2020 2064 656c  .            del
-0000ca90: 2063 6f6e 662e 4442 4669 6c65 735b 3a5d   conf.DBFiles[:]
-0000caa0: 0d0a 2020 2020 2020 2020 2020 2020 6465  ..            de
-0000cab0: 6c20 636f 6e66 2e4c 6173 7453 656c 6563  l conf.LastSelec
-0000cac0: 7465 6446 696c 6573 5b3a 5d0d 0a20 2020  tedFiles[:]..   
-0000cad0: 2020 2020 2020 2020 2064 656c 2063 6f6e           del con
-0000cae0: 662e 5265 6365 6e74 4669 6c65 735b 3a5d  f.RecentFiles[:]
-0000caf0: 0d0a 2020 2020 2020 2020 2020 2020 636f  ..            co
-0000cb00: 6e66 2e4c 6173 7453 6561 7263 6852 6573  nf.LastSearchRes
-0000cb10: 756c 7473 2e63 6c65 6172 2829 0d0a 2020  ults.clear()..  
-0000cb20: 2020 2020 2020 2020 2020 7768 696c 6520            while 
-0000cb30: 7365 6c66 2e68 6973 746f 7279 5f66 696c  self.history_fil
-0000cb40: 652e 436f 756e 743a 0d0a 2020 2020 2020  e.Count:..      
-0000cb50: 2020 2020 2020 2020 2020 7365 6c66 2e68            self.h
-0000cb60: 6973 746f 7279 5f66 696c 652e 5265 6d6f  istory_file.Remo
-0000cb70: 7665 4669 6c65 4672 6f6d 4869 7374 6f72  veFileFromHistor
-0000cb80: 7928 3029 0d0a 2020 2020 2020 2020 2020  y(0)..          
-0000cb90: 2020 7365 6c66 2e64 625f 6669 6c65 6e61    self.db_filena
-0000cba0: 6d65 732e 636c 6561 7228 290d 0a20 2020  mes.clear()..   
-0000cbb0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-0000cbc0: 2020 2020 2020 2020 7365 6c65 6374 6564          selected
-0000cbd0: 7320 3d20 7261 6e67 6528 312c 2073 656c  s = range(1, sel
-0000cbe0: 662e 6c69 7374 5f64 622e 4765 7449 7465  f.list_db.GetIte
-0000cbf0: 6d43 6f75 6e74 2829 290d 0a20 2020 2020  mCount())..     
-0000cc00: 2020 2020 2020 2066 696c 656e 616d 6573         filenames
-0000cc10: 203d 206c 6973 7428 6d61 7028 7365 6c66   = list(map(self
-0000cc20: 2e6c 6973 745f 6462 2e47 6574 4974 656d  .list_db.GetItem
-0000cc30: 5465 7874 2c20 7365 6c65 6374 6564 7329  Text, selecteds)
-0000cc40: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
-0000cc50: 656c 662e 7265 6d6f 7665 5f64 6174 6162  elf.remove_datab
-0000cc60: 6173 6573 2866 696c 656e 616d 6573 290d  ases(filenames).
-0000cc70: 0a0d 0a20 2020 2020 2020 2075 7469 6c2e  ...        util.
-0000cc80: 7275 6e5f 6f6e 6365 2863 6f6e 662e 7361  run_once(conf.sa
-0000cc90: 7665 290d 0a20 2020 2020 2020 2073 656c  ve)..        sel
-0000cca0: 662e 7570 6461 7465 5f64 6174 6162 6173  f.update_databas
-0000ccb0: 655f 6c69 7374 2829 0d0a 2020 2020 2020  e_list()..      
-0000ccc0: 2020 6775 6962 6173 652e 7374 6174 7573    guibase.status
-0000ccd0: 2822 5265 6d6f 7665 6420 2573 2066 726f  ("Removed %s fro
-0000cce0: 6d20 6461 7461 6261 7365 206c 6973 742e  m database list.
-0000ccf0: 222c 2075 7469 6c2e 706c 7572 616c 2822  ", util.plural("
-0000cd00: 6461 7461 6261 7365 222c 2063 6f75 6e74  database", count
-0000cd10: 2929 0d0a 0d0a 0d0a 2020 2020 6465 6620  ))......    def 
-0000cd20: 6f6e 5f72 656d 6f76 655f 6461 7461 6261  on_remove_databa
-0000cd30: 7365 2873 656c 662c 2065 7665 6e74 293a  se(self, event):
-0000cd40: 0d0a 2020 2020 2020 2020 2222 2248 616e  ..        """Han
-0000cd50: 646c 6572 2066 6f72 2063 6c69 636b 696e  dler for clickin
-0000cd60: 6720 746f 2072 656d 6f76 6520 616e 2069  g to remove an i
-0000cd70: 7465 6d20 6672 6f6d 2074 6865 2064 6174  tem from the dat
-0000cd80: 6162 6173 6520 6c69 7374 2e22 2222 0d0a  abase list."""..
-0000cd90: 2020 2020 2020 2020 6669 6c65 6e61 6d65          filename
-0000cda0: 203d 2073 656c 662e 6462 5f66 696c 656e   = self.db_filen
-0000cdb0: 616d 650d 0a20 2020 2020 2020 2069 6620  ame..        if 
-0000cdc0: 6e6f 7420 6669 6c65 6e61 6d65 206f 7220  not filename or 
-0000cdd0: 7778 2e4f 4b20 213d 2077 782e 4d65 7373  wx.OK != wx.Mess
-0000cde0: 6167 6542 6f78 280d 0a20 2020 2020 2020  ageBox(..       
-0000cdf0: 2020 2020 2022 5265 6d6f 7665 2025 7320       "Remove %s 
-0000ce00: 6672 6f6d 2064 6174 6162 6173 6520 6c69  from database li
-0000ce10: 7374 3f22 2025 2066 696c 656e 616d 652c  st?" % filename,
-0000ce20: 0d0a 2020 2020 2020 2020 2020 2020 636f  ..            co
-0000ce30: 6e66 2e54 6974 6c65 2c20 7778 2e4f 4b20  nf.Title, wx.OK 
-0000ce40: 7c20 7778 2e43 414e 4345 4c20 7c20 7778  | wx.CANCEL | wx
-0000ce50: 2e49 434f 4e5f 5155 4553 5449 4f4e 0d0a  .ICON_QUESTION..
-0000ce60: 2020 2020 2020 2020 293a 2072 6574 7572          ): retur
-0000ce70: 6e0d 0a0d 0a20 2020 2020 2020 2073 656c  n....        sel
-0000ce80: 662e 7265 6d6f 7665 5f64 6174 6162 6173  f.remove_databas
-0000ce90: 6573 285b 6669 6c65 6e61 6d65 5d29 0d0a  es([filename])..
-0000cea0: 2020 2020 2020 2020 7365 6c66 2e64 625f          self.db_
-0000ceb0: 6669 6c65 6e61 6d65 203d 204e 6f6e 650d  filename = None.
-0000cec0: 0a20 2020 2020 2020 2073 656c 662e 6c69  .        self.li
-0000ced0: 7374 5f64 622e 5365 6c65 6374 2830 290d  st_db.Select(0).
-0000cee0: 0a20 2020 2020 2020 2073 656c 662e 7061  .        self.pa
-0000cef0: 6e65 6c5f 6462 5f6d 6169 6e2e 4c61 796f  nel_db_main.Layo
-0000cf00: 7574 2829 0d0a 2020 2020 2020 2020 7574  ut()..        ut
-0000cf10: 696c 2e72 756e 5f6f 6e63 6528 636f 6e66  il.run_once(conf
-0000cf20: 2e73 6176 6529 0d0a 0d0a 0d0a 2020 2020  .save)......    
-0000cf30: 6465 6620 6f6e 5f72 656d 6f76 655f 6d69  def on_remove_mi
-0000cf40: 7373 696e 6728 7365 6c66 2c20 6576 656e  ssing(self, even
-0000cf50: 7429 3a0d 0a20 2020 2020 2020 2022 2222  t):..        """
-0000cf60: 4861 6e64 6c65 7220 746f 2072 656d 6f76  Handler to remov
-0000cf70: 6520 6e6f 6e65 7869 7374 656e 7420 6669  e nonexistent fi
-0000cf80: 6c65 7320 6672 6f6d 2074 6865 2064 6174  les from the dat
-0000cf90: 6162 6173 6520 6c69 7374 2e22 2222 0d0a  abase list."""..
-0000cfa0: 2020 2020 2020 2020 7365 6c65 6374 6564          selected
-0000cfb0: 7320 3d20 7261 6e67 6528 312c 2073 656c  s = range(1, sel
-0000cfc0: 662e 6c69 7374 5f64 622e 4765 7449 7465  f.list_db.GetIte
-0000cfd0: 6d43 6f75 6e74 2829 290d 0a20 2020 2020  mCount())..     
-0000cfe0: 2020 2066 696c 7465 725f 6675 6e63 203d     filter_func =
-0000cff0: 206c 616d 6264 6120 693a 206e 6f74 206f   lambda i: not o
-0000d000: 732e 7061 7468 2e65 7869 7374 7328 7365  s.path.exists(se
-0000d010: 6c66 2e6c 6973 745f 6462 2e47 6574 4974  lf.list_db.GetIt
-0000d020: 656d 5465 7874 2869 2929 0d0a 2020 2020  emText(i))..    
-0000d030: 2020 2020 7365 6c65 6374 6564 7320 3d20      selecteds = 
-0000d040: 6c69 7374 2866 696c 7465 7228 6669 6c74  list(filter(filt
-0000d050: 6572 5f66 756e 632c 2073 656c 6563 7465  er_func, selecte
-0000d060: 6473 2929 0d0a 2020 2020 2020 2020 6669  ds))..        fi
-0000d070: 6c65 6e61 6d65 7320 3d20 6c69 7374 286d  lenames = list(m
-0000d080: 6170 2873 656c 662e 6c69 7374 5f64 622e  ap(self.list_db.
-0000d090: 4765 7449 7465 6d54 6578 742c 2073 656c  GetItemText, sel
-0000d0a0: 6563 7465 6473 2929 0d0a 2020 2020 2020  ecteds))..      
-0000d0b0: 2020 6966 206e 6f74 2066 696c 656e 616d    if not filenam
-0000d0c0: 6573 3a20 7265 7475 726e 0d0a 0d0a 2020  es: return....  
-0000d0d0: 2020 2020 2020 7365 6c66 2e72 656d 6f76        self.remov
-0000d0e0: 655f 6461 7461 6261 7365 7328 6669 6c65  e_databases(file
-0000d0f0: 6e61 6d65 7329 0d0a 2020 2020 2020 2020  names)..        
-0000d100: 7574 696c 2e72 756e 5f6f 6e63 6528 636f  util.run_once(co
-0000d110: 6e66 2e73 6176 6529 0d0a 2020 2020 2020  nf.save)..      
-0000d120: 2020 6775 6962 6173 652e 7374 6174 7573    guibase.status
-0000d130: 2822 5265 6d6f 7665 6420 2573 2066 726f  ("Removed %s fro
-0000d140: 6d20 6461 7461 6261 7365 206c 6973 742e  m database list.
-0000d150: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
-0000d160: 2020 2020 2020 2020 2020 2075 7469 6c2e             util.
-0000d170: 706c 7572 616c 2822 6e6f 6e2d 6578 6973  plural("non-exis
-0000d180: 7469 6e67 2066 696c 6522 2c20 6669 6c65  ting file", file
-0000d190: 6e61 6d65 7329 290d 0a0d 0a0d 0a20 2020  names))......   
-0000d1a0: 2064 6566 206f 6e5f 7265 6d6f 7665 5f74   def on_remove_t
-0000d1b0: 7970 6528 7365 6c66 2c20 6576 656e 742c  ype(self, event,
-0000d1c0: 206f 7468 6572 3d54 7275 6529 3a0d 0a20   other=True):.. 
-0000d1d0: 2020 2020 2020 2022 2222 4861 6e64 6c65         """Handle
-0000d1e0: 7220 666f 7220 7479 7065 2073 656c 6563  r for type selec
-0000d1f0: 7469 6f6e 2074 6f20 7265 6d6f 7665 2066  tion to remove f
-0000d200: 696c 6573 2066 726f 6d20 7468 6520 6461  iles from the da
-0000d210: 7461 6261 7365 206c 6973 742e 2222 220d  tabase list.""".
-0000d220: 0a20 2020 2020 2020 2073 656c 6563 7465  .        selecte
-0000d230: 6473 203d 2072 616e 6765 2831 2c20 7365  ds = range(1, se
-0000d240: 6c66 2e6c 6973 745f 6462 2e47 6574 4974  lf.list_db.GetIt
-0000d250: 656d 436f 756e 7428 2929 0d0a 2020 2020  emCount())..    
-0000d260: 2020 2020 6669 6c74 6572 5f66 756e 6320      filter_func 
-0000d270: 3d20 6c61 6d62 6461 2069 3a20 280d 0a20  = lambda i: (.. 
-0000d280: 2020 2020 2020 2020 206f 7468 6572 205e           other ^
-0000d290: 2073 6b79 7065 6461 7461 2e69 735f 736b   skypedata.is_sk
-0000d2a0: 7970 655f 6461 7461 6261 7365 2873 656c  ype_database(sel
-0000d2b0: 662e 6c69 7374 5f64 622e 4765 7449 7465  f.list_db.GetIte
-0000d2c0: 6d54 6578 7428 6929 2c20 6c6f 675f 6572  mText(i), log_er
-0000d2d0: 726f 723d 4661 6c73 6529 290d 0a20 2020  ror=False))..   
-0000d2e0: 2020 2020 2073 656c 6563 7465 6473 203d       selecteds =
-0000d2f0: 206c 6973 7428 6669 6c74 6572 2866 696c   list(filter(fil
-0000d300: 7465 725f 6675 6e63 2c20 7365 6c65 6374  ter_func, select
-0000d310: 6564 7329 290d 0a20 2020 2020 2020 2066  eds))..        f
-0000d320: 696c 656e 616d 6573 203d 206c 6973 7428  ilenames = list(
-0000d330: 6d61 7028 7365 6c66 2e6c 6973 745f 6462  map(self.list_db
-0000d340: 2e47 6574 4974 656d 5465 7874 2c20 7365  .GetItemText, se
-0000d350: 6c65 6374 6564 7329 290d 0a20 2020 2020  lecteds))..     
-0000d360: 2020 2069 6620 6e6f 7420 6669 6c65 6e61     if not filena
-0000d370: 6d65 733a 2072 6574 7572 6e0d 0a0d 0a20  mes: return.... 
-0000d380: 2020 2020 2020 2073 656c 662e 7265 6d6f         self.remo
-0000d390: 7665 5f64 6174 6162 6173 6573 2866 696c  ve_databases(fil
-0000d3a0: 656e 616d 6573 290d 0a20 2020 2020 2020  enames)..       
-0000d3b0: 2075 7469 6c2e 7275 6e5f 6f6e 6365 2863   util.run_once(c
-0000d3c0: 6f6e 662e 7361 7665 290d 0a20 2020 2020  onf.save)..     
-0000d3d0: 2020 2074 203d 2075 7469 6c2e 706c 7572     t = util.plur
-0000d3e0: 616c 2822 2573 536b 7970 6520 6461 7461  al("%sSkype data
-0000d3f0: 6261 7365 2220 2520 2822 6e6f 6e2d 2220  base" % ("non-" 
-0000d400: 6966 206f 7468 6572 2065 6c73 6520 2222  if other else ""
-0000d410: 292c 2066 696c 656e 616d 6573 290d 0a20  ), filenames).. 
-0000d420: 2020 2020 2020 2067 7569 6261 7365 2e73         guibase.s
-0000d430: 7461 7475 7328 2252 656d 6f76 6564 2025  tatus("Removed %
-0000d440: 7320 6672 6f6d 2064 6174 6162 6173 6520  s from database 
-0000d450: 6c69 7374 2e22 2c20 7429 0d0a 0d0a 0d0a  list.", t)......
-0000d460: 2020 2020 6465 6620 6f6e 5f64 656c 6574      def on_delet
-0000d470: 655f 6461 7461 6261 7365 2873 656c 662c  e_database(self,
-0000d480: 2065 7665 6e74 293a 0d0a 2020 2020 2020   event):..      
-0000d490: 2020 2222 2248 616e 646c 6572 2066 6f72    """Handler for
-0000d4a0: 2063 6c69 636b 696e 6720 746f 2064 656c   clicking to del
-0000d4b0: 6574 6520 6120 6461 7461 6261 7365 2e22  ete a database."
-0000d4c0: 2222 0d0a 2020 2020 2020 2020 6669 6c65  ""..        file
-0000d4d0: 6e61 6d65 203d 2073 656c 662e 6462 5f66  name = self.db_f
-0000d4e0: 696c 656e 616d 650d 0a20 2020 2020 2020  ilename..       
-0000d4f0: 2069 6620 6e6f 7420 6669 6c65 6e61 6d65   if not filename
-0000d500: 206f 7220 7778 2e4f 4b20 213d 2077 782e   or wx.OK != wx.
-0000d510: 4d65 7373 6167 6542 6f78 280d 0a20 2020  MessageBox(..   
-0000d520: 2020 2020 2020 2020 2022 4465 6c65 7465           "Delete
-0000d530: 2025 7320 6672 6f6d 2064 6973 6b3f 2220   %s from disk?" 
-0000d540: 2520 6669 6c65 6e61 6d65 2c0d 0a20 2020  % filename,..   
-0000d550: 2020 2020 2020 2020 2063 6f6e 662e 5469           conf.Ti
-0000d560: 746c 652c 2077 782e 4f4b 207c 2077 782e  tle, wx.OK | wx.
-0000d570: 4341 4e43 454c 207c 2077 782e 4943 4f4e  CANCEL | wx.ICON
-0000d580: 5f51 5545 5354 494f 4e0d 0a20 2020 2020  _QUESTION..     
-0000d590: 2020 2029 3a20 7265 7475 726e 0d0a 0d0a     ): return....
-0000d5a0: 2020 2020 2020 2020 6966 2066 696c 656e          if filen
-0000d5b0: 616d 6520 696e 2073 656c 662e 6462 733a  ame in self.dbs:
-0000d5c0: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-0000d5d0: 7475 726e 2077 782e 4d65 7373 6167 6542  turn wx.MessageB
-0000d5e0: 6f78 2822 2573 2069 7320 6375 7272 656e  ox("%s is curren
-0000d5f0: 746c 7920 6f70 656e 2069 6e20 2573 2c20  tly open in %s, 
-0000d600: 6361 6e6e 6f74 2064 656c 6574 652e 2220  cannot delete." 
-0000d610: 250d 0a20 2020 2020 2020 2020 2020 2020  %..             
-0000d620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d630: 2020 2020 2866 696c 656e 616d 652c 2063      (filename, c
-0000d640: 6f6e 662e 5469 746c 6529 2c20 636f 6e66  onf.Title), conf
-0000d650: 2e54 6974 6c65 2c20 7778 2e4f 4b29 0d0a  .Title, wx.OK)..
-0000d660: 2020 2020 2020 2020 6966 2066 696c 656e          if filen
-0000d670: 616d 6520 696e 2073 656c 662e 776f 726b  ame in self.work
-0000d680: 6572 735f 696d 706f 7274 3a0d 0a20 2020  ers_import:..   
-0000d690: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0000d6a0: 7778 2e4d 6573 7361 6765 426f 7828 2225  wx.MessageBox("%
-0000d6b0: 7320 6973 2063 7572 7265 6e74 6c79 2062  s is currently b
-0000d6c0: 6569 6e67 2069 6d70 6f72 7465 6420 746f  eing imported to
-0000d6d0: 2c20 6361 6e6e 6f74 2064 656c 6574 652e  , cannot delete.
-0000d6e0: 2220 250d 0a20 2020 2020 2020 2020 2020  " %..           
-0000d6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d700: 2020 2020 2020 6669 6c65 6e61 6d65 2c20        filename, 
-0000d710: 636f 6e66 2e54 6974 6c65 2c20 7778 2e4f  conf.Title, wx.O
-0000d720: 4b20 7c20 7778 2e49 434f 4e5f 5741 524e  K | wx.ICON_WARN
-0000d730: 494e 4729 0d0a 0d0a 2020 2020 2020 2020  ING)....        
-0000d740: 7472 793a 206f 732e 756e 6c69 6e6b 2866  try: os.unlink(f
-0000d750: 696c 656e 616d 6529 0d0a 2020 2020 2020  ilename)..      
-0000d760: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
-0000d770: 6f6e 2061 7320 653a 0d0a 2020 2020 2020  on as e:..      
-0000d780: 2020 2020 2020 6c6f 6767 6572 2e65 7863        logger.exc
-0000d790: 6570 7469 6f6e 2822 4572 726f 7220 6465  eption("Error de
-0000d7a0: 6c65 7469 6e67 2025 732e 222c 2066 696c  leting %s.", fil
-0000d7b0: 656e 616d 6529 0d0a 2020 2020 2020 2020  ename)..        
-0000d7c0: 2020 2020 7265 7475 726e 2077 782e 4d65      return wx.Me
-0000d7d0: 7373 6167 6542 6f78 2822 4661 696c 6564  ssageBox("Failed
-0000d7e0: 2074 6f20 6465 6c65 7465 2025 733a 5c6e   to delete %s:\n
-0000d7f0: 5c6e 2573 2220 250d 0a20 2020 2020 2020  \n%s" %..       
-0000d800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d810: 2020 2020 2020 2020 2020 2866 696c 656e            (filen
-0000d820: 616d 652c 2075 7469 6c2e 666f 726d 6174  ame, util.format
-0000d830: 5f65 7863 2865 2929 2c0d 0a20 2020 2020  _exc(e)),..     
-0000d840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d850: 2020 2020 2020 2020 2020 2020 636f 6e66              conf
-0000d860: 2e54 6974 6c65 2c20 7778 2e4f 4b20 7c20  .Title, wx.OK | 
-0000d870: 7778 2e49 434f 4e5f 4552 524f 5229 0d0a  wx.ICON_ERROR)..
-0000d880: 2020 2020 2020 2020 7365 6c66 2e72 656d          self.rem
-0000d890: 6f76 655f 6461 7461 6261 7365 7328 5b66  ove_databases([f
-0000d8a0: 696c 656e 616d 655d 290d 0a20 2020 2020  ilename])..     
-0000d8b0: 2020 2073 656c 662e 6462 5f66 696c 656e     self.db_filen
-0000d8c0: 616d 6520 3d20 4e6f 6e65 0d0a 2020 2020  ame = None..    
-0000d8d0: 2020 2020 7365 6c66 2e6c 6973 745f 6462      self.list_db
-0000d8e0: 2e53 656c 6563 7428 3029 0d0a 2020 2020  .Select(0)..    
-0000d8f0: 2020 2020 7365 6c66 2e70 616e 656c 5f64      self.panel_d
-0000d900: 625f 6d61 696e 2e4c 6179 6f75 7428 290d  b_main.Layout().
-0000d910: 0a20 2020 2020 2020 2075 7469 6c2e 7275  .        util.ru
-0000d920: 6e5f 6f6e 6365 2863 6f6e 662e 7361 7665  n_once(conf.save
-0000d930: 290d 0a0d 0a0d 0a20 2020 2064 6566 2072  )......    def r
-0000d940: 656d 6f76 655f 6461 7461 6261 7365 7328  emove_databases(
-0000d950: 7365 6c66 2c20 6669 6c65 6e61 6d65 7329  self, filenames)
-0000d960: 3a0d 0a20 2020 2020 2020 2022 2222 5265  :..        """Re
-0000d970: 6d6f 7665 7320 6769 7665 6e20 6669 6c65  moves given file
-0000d980: 2066 726f 6d20 6461 7461 6261 7365 206c   from database l
-0000d990: 6973 7420 616e 6420 616c 6c20 6461 7461  ist and all data
-0000d9a0: 2073 7472 7563 7475 7265 732e 2222 220d   structures.""".
-0000d9b0: 0a20 2020 2020 2020 2066 6f72 2066 696c  .        for fil
-0000d9c0: 656e 616d 6520 696e 2066 696c 656e 616d  ename in filenam
-0000d9d0: 6573 3a0d 0a20 2020 2020 2020 2020 2020  es:..           
-0000d9e0: 2069 6478 203d 2073 656c 662e 6c69 7374   idx = self.list
-0000d9f0: 5f64 622e 4669 6e64 4974 656d 2866 696c  _db.FindItem(fil
-0000da00: 656e 616d 6529 0d0a 2020 2020 2020 2020  ename)..        
-0000da10: 2020 2020 6966 2069 6478 203e 2030 3a20      if idx > 0: 
-0000da20: 7365 6c66 2e6c 6973 745f 6462 2e44 656c  self.list_db.Del
-0000da30: 6574 6549 7465 6d28 6964 7829 0d0a 2020  eteItem(idx)..  
-0000da40: 2020 2020 2020 2020 2020 666f 7220 6c73            for ls
-0000da50: 7420 696e 2063 6f6e 662e 4442 4669 6c65  t in conf.DBFile
-0000da60: 732c 2063 6f6e 662e 5265 6365 6e74 4669  s, conf.RecentFi
-0000da70: 6c65 732c 2063 6f6e 662e 4c61 7374 5365  les, conf.LastSe
-0000da80: 6c65 6374 6564 4669 6c65 733a 0d0a 2020  lectedFiles:..  
-0000da90: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0000daa0: 2066 696c 656e 616d 6520 696e 206c 7374   filename in lst
-0000dab0: 3a20 6c73 742e 7265 6d6f 7665 2866 696c  : lst.remove(fil
-0000dac0: 656e 616d 6529 0d0a 2020 2020 2020 2020  ename)..        
-0000dad0: 2020 2020 666f 7220 6463 7420 696e 2063      for dct in c
-0000dae0: 6f6e 662e 4c61 7374 5365 6172 6368 5265  onf.LastSearchRe
-0000daf0: 7375 6c74 732c 2073 656c 662e 6462 5f66  sults, self.db_f
-0000db00: 696c 656e 616d 6573 3a0d 0a20 2020 2020  ilenames:..     
-0000db10: 2020 2020 2020 2020 2020 2064 6374 2e70             dct.p
-0000db20: 6f70 2866 696c 656e 616d 652c 204e 6f6e  op(filename, Non
-0000db30: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
-0000db40: 636f 6e66 2e4c 6f67 696e 2e70 6f70 2866  conf.Login.pop(f
-0000db50: 696c 656e 616d 652c 204e 6f6e 6529 0d0a  ilename, None)..
-0000db60: 0d0a 2020 2020 2020 2020 2320 5265 6d6f  ..        # Remo
-0000db70: 7665 2066 726f 6d20 7265 6365 6e74 2066  ve from recent f
-0000db80: 696c 6520 6869 7374 6f72 790d 0a20 2020  ile history..   
-0000db90: 2020 2020 2068 6973 746f 7279 6669 6c65       historyfile
-0000dba0: 7320 3d20 5b28 692c 2073 656c 662e 6869  s = [(i, self.hi
-0000dbb0: 7374 6f72 795f 6669 6c65 2e47 6574 4869  story_file.GetHi
-0000dbc0: 7374 6f72 7946 696c 6528 6929 290d 0a20  storyFile(i)).. 
-0000dbd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dbe0: 2020 2020 2020 2066 6f72 2069 2069 6e20         for i in 
-0000dbf0: 7261 6e67 6528 7365 6c66 2e68 6973 746f  range(self.histo
-0000dc00: 7279 5f66 696c 652e 436f 756e 7429 5d0d  ry_file.Count)].
-0000dc10: 0a20 2020 2020 2020 2066 6f72 2069 2c20  .        for i, 
-0000dc20: 6620 696e 2068 6973 746f 7279 6669 6c65  f in historyfile
-0000dc30: 735b 3a3a 2d31 5d3a 2023 2057 6f72 6b20  s[::-1]: # Work 
-0000dc40: 7570 7761 7264 7320 746f 2068 6176 6520  upwards to have 
-0000dc50: 756e 6368 616e 6765 6420 696e 6465 780d  unchanged index.
-0000dc60: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000dc70: 6620 696e 2066 696c 656e 616d 6573 3a20  f in filenames: 
-0000dc80: 7365 6c66 2e68 6973 746f 7279 5f66 696c  self.history_fil
-0000dc90: 652e 5265 6d6f 7665 4669 6c65 4672 6f6d  e.RemoveFileFrom
-0000dca0: 4869 7374 6f72 7928 6929 0d0a 2020 2020  History(i)..    
-0000dcb0: 2020 2020 7365 6c66 2e75 7064 6174 655f      self.update_
-0000dcc0: 6461 7461 6261 7365 5f6c 6973 7428 290d  database_list().
-0000dcd0: 0a0d 0a0d 0a20 2020 2064 6566 206f 6e5f  .....    def on_
-0000dce0: 7361 7665 5f64 6174 6162 6173 655f 6173  save_database_as
-0000dcf0: 2873 656c 662c 2065 7665 6e74 293a 0d0a  (self, event):..
-0000dd00: 2020 2020 2020 2020 2222 2248 616e 646c          """Handl
-0000dd10: 6572 2066 6f72 2063 6c69 636b 696e 6720  er for clicking 
-0000dd20: 746f 2073 6176 6520 6120 636f 7079 206f  to save a copy o
-0000dd30: 6620 6120 6461 7461 6261 7365 2069 6e20  f a database in 
-0000dd40: 7468 6520 6c69 7374 2e22 2222 0d0a 2020  the list."""..  
-0000dd50: 2020 2020 2020 6f72 6967 696e 616c 203d        original =
-0000dd60: 2073 656c 662e 6462 5f66 696c 656e 616d   self.db_filenam
-0000dd70: 650d 0a20 2020 2020 2020 2069 6620 6e6f  e..        if no
-0000dd80: 7420 6f73 2e70 6174 682e 6578 6973 7473  t os.path.exists
-0000dd90: 286f 7269 6769 6e61 6c29 3a0d 0a20 2020  (original):..   
-0000dda0: 2020 2020 2020 2020 2077 782e 4d65 7373           wx.Mess
-0000ddb0: 6167 6542 6f78 280d 0a20 2020 2020 2020  ageBox(..       
-0000ddc0: 2020 2020 2020 2020 2027 5468 6520 6669           'The fi
-0000ddd0: 6c65 2022 2573 2220 646f 6573 206e 6f74  le "%s" does not
-0000dde0: 2065 7869 7374 206f 6e20 7468 6973 2063   exist on this c
-0000ddf0: 6f6d 7075 7465 722e 2720 2520 6f72 6967  omputer.' % orig
-0000de00: 696e 616c 2c0d 0a20 2020 2020 2020 2020  inal,..         
-0000de10: 2020 2020 2020 2063 6f6e 662e 5469 746c         conf.Titl
-0000de20: 652c 2077 782e 4f4b 207c 2077 782e 4943  e, wx.OK | wx.IC
-0000de30: 4f4e 5f49 4e46 4f52 4d41 5449 4f4e 0d0a  ON_INFORMATION..
-0000de40: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
-0000de50: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0000de60: 6e0d 0a0d 0a20 2020 2020 2020 2069 6620  n....        if 
-0000de70: 6f72 6967 696e 616c 2069 6e20 7365 6c66  original in self
-0000de80: 2e77 6f72 6b65 7273 5f69 6d70 6f72 743a  .workers_import:
-0000de90: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-0000dea0: 7475 726e 2077 782e 4d65 7373 6167 6542  turn wx.MessageB
-0000deb0: 6f78 2822 2573 2069 7320 6375 7272 656e  ox("%s is curren
-0000dec0: 746c 7920 6265 696e 6720 696d 706f 7274  tly being import
-0000ded0: 6564 2074 6f2c 2063 616e 6e6f 7420 7361  ed to, cannot sa
-0000dee0: 7665 2e22 2025 0d0a 2020 2020 2020 2020  ve." %..        
-0000def0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000df00: 2020 2020 2020 2020 206f 7269 6769 6e61           origina
-0000df10: 6c2c 2063 6f6e 662e 5469 746c 652c 2077  l, conf.Title, w
-0000df20: 782e 4f4b 207c 2077 782e 4943 4f4e 5f57  x.OK | wx.ICON_W
-0000df30: 4152 4e49 4e47 290d 0a0d 0a20 2020 2020  ARNING)....     
-0000df40: 2020 2064 6961 6c6f 6720 3d20 7778 2e46     dialog = wx.F
-0000df50: 696c 6544 6961 6c6f 6728 7061 7265 6e74  ileDialog(parent
-0000df60: 3d73 656c 662c 206d 6573 7361 6765 3d22  =self, message="
-0000df70: 5361 7665 2061 2063 6f70 792e 2e22 2c0d  Save a copy..",.
-0000df80: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
-0000df90: 6175 6c74 4469 723d 6f73 2e70 6174 682e  aultDir=os.path.
-0000dfa0: 6469 726e 616d 6528 6f72 6967 696e 616c  dirname(original
-0000dfb0: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
-0000dfc0: 6465 6661 756c 7446 696c 653d 6f73 2e70  defaultFile=os.p
-0000dfd0: 6174 682e 6261 7365 6e61 6d65 286f 7269  ath.basename(ori
-0000dfe0: 6769 6e61 6c29 2c0d 0a20 2020 2020 2020  ginal),..       
-0000dff0: 2020 2020 2077 696c 6463 6172 643d 2253       wildcard="S
-0000e000: 514c 6974 6520 6461 7461 6261 7365 2028  QLite database (
-0000e010: 2a2e 6462 297c 2a2e 6462 7c41 6c6c 2066  *.db)|*.db|All f
-0000e020: 696c 6573 7c2a 2e2a 222c 0d0a 2020 2020  iles|*.*",..    
-0000e030: 2020 2020 2020 2020 7374 796c 653d 7778          style=wx
-0000e040: 2e46 445f 4f56 4552 5752 4954 455f 5052  .FD_OVERWRITE_PR
-0000e050: 4f4d 5054 207c 2077 782e 4644 5f53 4156  OMPT | wx.FD_SAV
-0000e060: 4520 7c20 7778 2e52 4553 495a 455f 424f  E | wx.RESIZE_BO
-0000e070: 5244 4552 0d0a 2020 2020 2020 2020 290d  RDER..        ).
-0000e080: 0a20 2020 2020 2020 2069 6620 7778 2e49  .        if wx.I
-0000e090: 445f 4f4b 2021 3d20 6469 616c 6f67 2e53  D_OK != dialog.S
-0000e0a0: 686f 774d 6f64 616c 2829 3a20 7265 7475  howModal(): retu
-0000e0b0: 726e 0d0a 0d0a 2020 2020 2020 2020 7778  rn....        wx
-0000e0c0: 2e59 6965 6c64 4966 4e65 6564 6564 2829  .YieldIfNeeded()
-0000e0d0: 2023 2041 6c6c 6f77 2055 4920 746f 2072   # Allow UI to r
-0000e0e0: 6566 7265 7368 0d0a 2020 2020 2020 2020  efresh..        
-0000e0f0: 6e65 7770 6174 6820 3d20 636f 6e74 726f  newpath = contro
-0000e100: 6c73 2e67 6574 5f64 6961 6c6f 675f 7061  ls.get_dialog_pa
-0000e110: 7468 2864 6961 6c6f 6729 0d0a 2020 2020  th(dialog)..    
-0000e120: 2020 2020 7375 6363 6573 7320 3d20 4661      success = Fa
-0000e130: 6c73 650d 0a20 2020 2020 2020 2074 7279  lse..        try
-0000e140: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
-0000e150: 6875 7469 6c2e 636f 7079 6669 6c65 286f  hutil.copyfile(o
-0000e160: 7269 6769 6e61 6c2c 206e 6577 7061 7468  riginal, newpath
-0000e170: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
-0000e180: 7563 6365 7373 203d 2054 7275 650d 0a20  uccess = True.. 
-0000e190: 2020 2020 2020 2065 7863 6570 7420 4578         except Ex
-0000e1a0: 6365 7074 696f 6e20 6173 2065 3a0d 0a20  ception as e:.. 
-0000e1b0: 2020 2020 2020 2020 2020 2067 7569 6261             guiba
-0000e1c0: 7365 2e73 7461 7475 7328 2245 7272 6f72  se.status("Error
-0000e1d0: 2074 7279 696e 6720 746f 2063 6f70 7920   trying to copy 
-0000e1e0: 2573 2074 6f20 2573 3a20 2573 222c 0d0a  %s to %s: %s",..
-0000e1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e200: 2020 2020 2020 2020 2020 206f 7269 6769             origi
-0000e210: 6e61 6c2c 206e 6577 7061 7468 2c20 7574  nal, newpath, ut
-0000e220: 696c 2e66 6f72 6d61 745f 6578 6328 6529  il.format_exc(e)
-0000e230: 290d 0a20 2020 2020 2020 2020 2020 206c  )..            l
-0000e240: 6f67 6765 722e 6578 6365 7074 696f 6e28  ogger.exception(
-0000e250: 2245 7272 6f72 2074 7279 696e 6720 746f  "Error trying to
-0000e260: 2063 6f70 7920 2573 2074 6f20 2573 2e22   copy %s to %s."
-0000e270: 2c20 6f72 6967 696e 616c 2c20 6e65 7770  , original, newp
-0000e280: 6174 6829 0d0a 2020 2020 2020 2020 2020  ath)..          
-0000e290: 2020 7778 2e4d 6573 7361 6765 426f 7828    wx.MessageBox(
-0000e2a0: 2746 6169 6c65 6420 746f 2063 6f70 7920  'Failed to copy 
-0000e2b0: 2225 7322 2074 6f20 2225 7322 2e27 2025  "%s" to "%s".' %
-0000e2c0: 2028 6f72 6967 696e 616c 2c20 6e65 7770   (original, newp
-0000e2d0: 6174 6829 2c0d 0a20 2020 2020 2020 2020  ath),..         
-0000e2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e2f0: 2063 6f6e 662e 5469 746c 652c 2077 782e   conf.Title, wx.
-0000e300: 4f4b 207c 2077 782e 4943 4f4e 5f57 4152  OK | wx.ICON_WAR
-0000e310: 4e49 4e47 290d 0a20 2020 2020 2020 2069  NING)..        i
-0000e320: 6620 7375 6363 6573 733a 0d0a 2020 2020  f success:..    
-0000e330: 2020 2020 2020 2020 6775 6962 6173 652e          guibase.
-0000e340: 7374 6174 7573 2822 5361 7665 6420 6120  status("Saved a 
-0000e350: 636f 7079 206f 6620 2573 2061 7320 2573  copy of %s as %s
-0000e360: 2e22 2c20 6f72 6967 696e 616c 2c20 6e65  .", original, ne
-0000e370: 7770 6174 682c 206c 6f67 3d54 7275 6529  wpath, log=True)
-0000e380: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-0000e390: 6c66 2e75 7064 6174 655f 6461 7461 6261  lf.update_databa
-0000e3a0: 7365 5f6c 6973 7428 6e65 7770 6174 6829  se_list(newpath)
-0000e3b0: 0d0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
-0000e3c0: 7220 6b20 696e 2028 224c 6173 7441 6374  r k in ("LastAct
-0000e3d0: 6976 6550 6167 6522 2c20 224c 6173 7453  ivePage", "LastS
-0000e3e0: 6561 7263 6852 6573 756c 7473 222c 2022  earchResults", "
-0000e3f0: 4c6f 6769 6e22 2c20 2253 514c 5769 6e64  Login", "SQLWind
-0000e400: 6f77 5465 7874 7322 293a 0d0a 2020 2020  owTexts"):..    
-0000e410: 2020 2020 2020 2020 2020 2020 6463 7420              dct 
-0000e420: 3d20 6765 7461 7474 7228 636f 6e66 2c20  = getattr(conf, 
-0000e430: 6b2c 207b 7d29 0d0a 2020 2020 2020 2020  k, {})..        
-0000e440: 2020 2020 2020 2020 6966 2064 6374 2e67          if dct.g
-0000e450: 6574 286f 7269 6769 6e61 6c29 3a20 6463  et(original): dc
-0000e460: 745b 6e65 7770 6174 685d 203d 2063 6f70  t[newpath] = cop
-0000e470: 792e 6465 6570 636f 7079 2864 6374 5b6f  y.deepcopy(dct[o
-0000e480: 7269 6769 6e61 6c5d 290d 0a20 2020 2020  riginal])..     
-0000e490: 2020 2020 2020 2069 6478 203d 2073 656c         idx = sel
-0000e4a0: 662e 6c69 7374 5f64 622e 4669 6e64 4974  f.list_db.FindIt
-0000e4b0: 656d 286e 6577 7061 7468 290d 0a20 2020  em(newpath)..   
-0000e4c0: 2020 2020 2020 2020 2069 6620 6964 7820           if idx 
-0000e4d0: 3e20 303a 2073 656c 662e 6c69 7374 5f64  > 0: self.list_d
-0000e4e0: 622e 5365 6c65 6374 2869 6478 290d 0a20  b.Select(idx).. 
-0000e4f0: 2020 2020 2020 2020 2020 2075 7469 6c2e             util.
-0000e500: 7275 6e5f 6f6e 6365 2863 6f6e 662e 7361  run_once(conf.sa
-0000e510: 7665 290d 0a0d 0a0d 0a20 2020 2064 6566  ve)......    def
-0000e520: 206f 6e5f 7368 6f77 6869 6465 5f6c 6f67   on_showhide_log
-0000e530: 2873 656c 662c 2065 7665 6e74 293a 0d0a  (self, event):..
-0000e540: 2020 2020 2020 2020 2222 2248 616e 646c          """Handl
-0000e550: 6572 2066 6f72 2063 6c69 636b 696e 6720  er for clicking 
-0000e560: 746f 2073 686f 772f 6869 6465 2074 6865  to show/hide the
-0000e570: 206c 6f67 2077 696e 646f 772e 2222 220d   log window.""".
-0000e580: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-0000e590: 2e6e 6f74 6562 6f6f 6b2e 4765 7450 6167  .notebook.GetPag
-0000e5a0: 6549 6e64 6578 2873 656c 662e 7061 6765  eIndex(self.page
-0000e5b0: 5f6c 6f67 2920 3c20 303a 0d0a 2020 2020  _log) < 0:..    
-0000e5c0: 2020 2020 2020 2020 7365 6c66 2e6e 6f74          self.not
-0000e5d0: 6562 6f6f 6b2e 4164 6450 6167 6528 7365  ebook.AddPage(se
-0000e5e0: 6c66 2e70 6167 655f 6c6f 672c 2022 4c6f  lf.page_log, "Lo
-0000e5f0: 6722 290d 0a20 2020 2020 2020 2020 2020  g")..           
-0000e600: 2073 656c 662e 7061 6765 5f6c 6f67 2e69   self.page_log.i
-0000e610: 735f 6869 6464 656e 203d 2046 616c 7365  s_hidden = False
-0000e620: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-0000e630: 6c66 2e70 6167 655f 6c6f 672e 5368 6f77  lf.page_log.Show
-0000e640: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
-0000e650: 7365 6c66 2e6e 6f74 6562 6f6f 6b2e 5365  self.notebook.Se
-0000e660: 7453 656c 6563 7469 6f6e 2873 656c 662e  tSelection(self.
-0000e670: 6e6f 7465 626f 6f6b 2e47 6574 5061 6765  notebook.GetPage
-0000e680: 436f 756e 7428 2920 2d20 3129 0d0a 2020  Count() - 1)..  
-0000e690: 2020 2020 2020 2020 2020 7365 6c66 2e6f            self.o
-0000e6a0: 6e5f 6368 616e 6765 5f70 6167 6528 4e6f  n_change_page(No
-0000e6b0: 6e65 290d 0a20 2020 2020 2020 2020 2020  ne)..           
-0000e6c0: 2073 656c 662e 6d65 6e75 5f6c 6f67 2e43   self.menu_log.C
-0000e6d0: 6865 636b 2854 7275 6529 0d0a 2020 2020  heck(True)..    
-0000e6e0: 2020 2020 656c 6966 2065 7665 6e74 2061      elif event a
-0000e6f0: 6e64 2073 656c 662e 6e6f 7465 626f 6f6b  nd self.notebook
-0000e700: 2e47 6574 5061 6765 496e 6465 7828 7365  .GetPageIndex(se
-0000e710: 6c66 2e70 6167 655f 6c6f 6729 2021 3d20  lf.page_log) != 
-0000e720: 7365 6c66 2e6e 6f74 6562 6f6f 6b2e 4765  self.notebook.Ge
-0000e730: 7453 656c 6563 7469 6f6e 2829 3a0d 0a20  tSelection():.. 
-0000e740: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000e750: 6e6f 7465 626f 6f6b 2e53 6574 5365 6c65  notebook.SetSele
-0000e760: 6374 696f 6e28 7365 6c66 2e6e 6f74 6562  ction(self.noteb
-0000e770: 6f6f 6b2e 4765 7450 6167 6543 6f75 6e74  ook.GetPageCount
-0000e780: 2829 202d 2031 290d 0a20 2020 2020 2020  () - 1)..       
-0000e790: 2020 2020 2073 656c 662e 6f6e 5f63 6861       self.on_cha
-0000e7a0: 6e67 655f 7061 6765 284e 6f6e 6529 0d0a  nge_page(None)..
-0000e7b0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000e7c0: 2e6d 656e 755f 6c6f 672e 4368 6563 6b28  .menu_log.Check(
-0000e7d0: 5472 7565 290d 0a20 2020 2020 2020 2065  True)..        e
-0000e7e0: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-0000e7f0: 2020 7365 6c66 2e70 6167 655f 6c6f 672e    self.page_log.
-0000e800: 6973 5f68 6964 6465 6e20 3d20 5472 7565  is_hidden = True
-0000e810: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-0000e820: 6c66 2e6e 6f74 6562 6f6f 6b2e 5265 6d6f  lf.notebook.Remo
-0000e830: 7665 5061 6765 2873 656c 662e 6e6f 7465  vePage(self.note
-0000e840: 626f 6f6b 2e47 6574 5061 6765 496e 6465  book.GetPageInde
-0000e850: 7828 7365 6c66 2e70 6167 655f 6c6f 6729  x(self.page_log)
-0000e860: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
-0000e870: 656c 662e 6d65 6e75 5f6c 6f67 2e43 6865  elf.menu_log.Che
-0000e880: 636b 2846 616c 7365 290d 0a0d 0a0d 0a20  ck(False)...... 
-0000e890: 2020 2064 6566 206f 6e5f 6578 706f 7274     def on_export
-0000e8a0: 5f64 6174 6162 6173 655f 6d65 6e75 2873  _database_menu(s
-0000e8b0: 656c 662c 2065 7665 6e74 293a 0d0a 2020  elf, event):..  
-0000e8c0: 2020 2020 2020 6966 206e 6f74 2065 7870        if not exp
-0000e8d0: 6f72 742e 786c 7378 7772 6974 6572 3a0d  ort.xlsxwriter:.
-0000e8e0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0000e8f0: 7572 6e20 7365 6c66 2e6f 6e5f 6578 706f  urn self.on_expo
-0000e900: 7274 5f64 6174 6162 6173 6528 4e6f 6e65  rt_database(None
-0000e910: 290d 0a0d 0a20 2020 2020 2020 206d 656e  )....        men
-0000e920: 7520 3d20 7778 2e6c 6962 2e61 6777 2e66  u = wx.lib.agw.f
-0000e930: 6c61 746d 656e 752e 466c 6174 4d65 6e75  latmenu.FlatMenu
-0000e940: 2829 0d0a 2020 2020 2020 2020 6974 656d  ()..        item
-0000e950: 5f73 656c 203d 2077 782e 6c69 622e 6167  _sel = wx.lib.ag
-0000e960: 772e 666c 6174 6d65 6e75 2e46 6c61 744d  w.flatmenu.FlatM
-0000e970: 656e 7549 7465 6d28 6d65 6e75 2c20 7778  enuItem(menu, wx
-0000e980: 2e49 445f 414e 592c 2022 4578 706f 7274  .ID_ANY, "Export
-0000e990: 2022 0d0a 2020 2020 2020 2020 2020 2020   "..            
-0000e9a0: 2269 6e74 6f20 7365 7061 7261 7465 2026  "into separate &
-0000e9b0: 6669 6c65 7320 696e 206f 6e65 2066 6f6c  files in one fol
-0000e9c0: 6465 7220 2848 544d 4c2c 2074 6578 742c  der (HTML, text,
-0000e9d0: 2045 7863 656c 2c20 6f72 2043 5356 2922   Excel, or CSV)"
-0000e9e0: 290d 0a20 2020 2020 2020 206d 656e 752e  )..        menu.
-0000e9f0: 4170 7065 6e64 4974 656d 2869 7465 6d5f  AppendItem(item_
-0000ea00: 7365 6c29 0d0a 2020 2020 2020 2020 6974  sel)..        it
-0000ea10: 656d 5f61 6c6c 203d 2077 782e 6c69 622e  em_all = wx.lib.
-0000ea20: 6167 772e 666c 6174 6d65 6e75 2e46 6c61  agw.flatmenu.Fla
-0000ea30: 744d 656e 7549 7465 6d28 6d65 6e75 2c20  tMenuItem(menu, 
-0000ea40: 7778 2e49 445f 414e 592c 0d0a 2020 2020  wx.ID_ANY,..    
-0000ea50: 2020 2020 2020 2020 6c61 6265 6c3d 2245          label="E
-0000ea60: 7870 6f72 7420 696e 746f 2061 2073 696e  xport into a sin
-0000ea70: 676c 6520 2645 7863 656c 2077 6f72 6b62  gle &Excel workb
-0000ea80: 6f6f 6b2c 2077 6974 6820 7365 7061 7261  ook, with separa
-0000ea90: 7465 2073 6865 6574 7322 290d 0a20 2020  te sheets")..   
-0000eaa0: 2020 2020 206d 656e 752e 4170 7065 6e64       menu.Append
-0000eab0: 4974 656d 2869 7465 6d5f 616c 6c29 0d0a  Item(item_all)..
-0000eac0: 2020 2020 2020 2020 666f 7220 6974 656d          for item
-0000ead0: 2069 6e20 6d65 6e75 2e47 6574 4d65 6e75   in menu.GetMenu
-0000eae0: 4974 656d 7328 293a 0d0a 2020 2020 2020  Items():..      
-0000eaf0: 2020 2020 2020 7365 6c66 2e42 696e 6428        self.Bind(
-0000eb00: 7778 2e45 5654 5f4d 454e 552c 2073 656c  wx.EVT_MENU, sel
-0000eb10: 662e 6f6e 5f65 7870 6f72 745f 6461 7461  f.on_export_data
-0000eb20: 6261 7365 2c20 6974 656d 290d 0a0d 0a20  base, item).... 
-0000eb30: 2020 2020 2020 2062 746e 203d 2073 656c         btn = sel
-0000eb40: 662e 6275 7474 6f6e 5f65 7870 6f72 740d  f.button_export.
-0000eb50: 0a20 2020 2020 2020 2073 7a5f 6274 6e2c  .        sz_btn,
-0000eb60: 2070 745f 6274 6e20 3d20 6274 6e2e 5369   pt_btn = btn.Si
-0000eb70: 7a65 2c20 6274 6e2e 506f 7369 7469 6f6e  ze, btn.Position
-0000eb80: 0d0a 2020 2020 2020 2020 7074 5f62 746e  ..        pt_btn
-0000eb90: 203d 2062 746e 2e50 6172 656e 742e 436c   = btn.Parent.Cl
-0000eba0: 6965 6e74 546f 5363 7265 656e 2870 745f  ientToScreen(pt_
-0000ebb0: 6274 6e29 0d0a 2020 2020 2020 2020 6d65  btn)..        me
-0000ebc0: 6e75 2e53 6574 4f77 6e65 7248 6569 6768  nu.SetOwnerHeigh
-0000ebd0: 7428 737a 5f62 746e 2e79 290d 0a20 2020  t(sz_btn.y)..   
-0000ebe0: 2020 2020 2069 6620 6d65 6e75 2e53 697a       if menu.Siz
-0000ebf0: 652e 7769 6474 6820 3c20 737a 5f62 746e  e.width < sz_btn
-0000ec00: 2e77 6964 7468 3a0d 0a20 2020 2020 2020  .width:..       
-0000ec10: 2020 2020 206d 656e 752e 5369 7a65 203d       menu.Size =
-0000ec20: 2073 7a5f 6274 6e2e 7769 6474 682c 206d   sz_btn.width, m
-0000ec30: 656e 752e 5369 7a65 2e68 6569 6768 740d  enu.Size.height.
-0000ec40: 0a20 2020 2020 2020 206d 656e 752e 506f  .        menu.Po
-0000ec50: 7075 7028 7074 5f62 746e 2c20 7365 6c66  pup(pt_btn, self
-0000ec60: 290d 0a0d 0a0d 0a20 2020 2064 6566 206f  )......    def o
-0000ec70: 6e5f 6578 706f 7274 5f64 6174 6162 6173  n_export_databas
-0000ec80: 6528 7365 6c66 2c20 6576 656e 7429 3a0d  e(self, event):.
-0000ec90: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
-0000eca0: 2020 2020 2020 4861 6e64 6c65 7220 666f        Handler fo
-0000ecb0: 7220 636c 6963 6b69 6e67 2074 6f20 6578  r clicking to ex
-0000ecc0: 706f 7274 2061 2077 686f 6c65 2064 6174  port a whole dat
-0000ecd0: 6162 6173 652c 206c 6574 7320 7468 6520  abase, lets the 
-0000ece0: 7573 6572 0d0a 2020 2020 2020 2020 7370  user..        sp
-0000ecf0: 6563 6966 7920 6120 6469 7265 6374 6f72  ecify a director
-0000ed00: 7920 7768 6572 6520 746f 2073 6176 6520  y where to save 
-0000ed10: 6368 6174 2066 696c 6573 2061 6e64 2065  chat files and e
-0000ed20: 7870 6f72 7473 2061 6c6c 2063 6861 7473  xports all chats
-0000ed30: 2e0d 0a20 2020 2020 2020 2022 2222 0d0a  ...        """..
-0000ed40: 2020 2020 2020 2020 646f 5f73 696e 676c          do_singl
-0000ed50: 6566 696c 6520 3d20 4661 6c73 650d 0a20  efile = False.. 
-0000ed60: 2020 2020 2020 2069 6620 6576 656e 743a         if event:
-0000ed70: 0d0a 2020 2020 2020 2020 2020 2020 6e69  ..            ni
-0000ed80: 7465 6d73 203d 2065 6e75 6d65 7261 7465  tems = enumerate
-0000ed90: 2865 7665 6e74 2e45 7665 6e74 4f62 6a65  (event.EventObje
-0000eda0: 6374 2e47 6574 4d65 6e75 4974 656d 7328  ct.GetMenuItems(
-0000edb0: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
-0000edc0: 696e 6465 7820 3d20 6e65 7874 2828 6920  index = next((i 
-0000edd0: 666f 7220 692c 206d 2069 6e20 6e69 7465  for i, m in nite
-0000ede0: 6d73 2069 6620 6d2e 4765 7449 6428 2920  ms if m.GetId() 
-0000edf0: 3d3d 2065 7665 6e74 2e49 6429 2c20 4e6f  == event.Id), No
-0000ee00: 6e65 290d 0a20 2020 2020 2020 2020 2020  ne)..           
-0000ee10: 2064 6f5f 7369 6e67 6c65 6669 6c65 203d   do_singlefile =
-0000ee20: 2069 6e64 6578 203e 2030 0d0a 0d0a 2020   index > 0....  
-0000ee30: 2020 2020 2020 6966 2073 656c 662e 6462        if self.db
-0000ee40: 5f66 696c 656e 616d 6520 696e 2073 656c  _filename in sel
-0000ee50: 662e 776f 726b 6572 735f 696d 706f 7274  f.workers_import
-0000ee60: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
-0000ee70: 6574 7572 6e20 7778 2e4d 6573 7361 6765  eturn wx.Message
-0000ee80: 426f 7828 2225 7320 6973 2063 7572 7265  Box("%s is curre
-0000ee90: 6e74 6c79 2062 6569 6e67 2069 6d70 6f72  ntly being impor
-0000eea0: 7465 6420 746f 2c20 6361 6e6e 6f74 2065  ted to, cannot e
-0000eeb0: 7870 6f72 742e 2220 250d 0a20 2020 2020  xport." %..     
-0000eec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eed0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000eee0: 2e64 625f 6669 6c65 6e61 6d65 2c20 636f  .db_filename, co
-0000eef0: 6e66 2e54 6974 6c65 2c20 7778 2e4f 4b20  nf.Title, wx.OK 
-0000ef00: 7c20 7778 2e49 434f 4e5f 5741 524e 494e  | wx.ICON_WARNIN
-0000ef10: 4729 0d0a 0d0a 2020 2020 2020 2020 666f  G)....        fo
-0000ef20: 6375 7365 645f 636f 6e74 726f 6c20 3d20  cused_control = 
-0000ef30: 7365 6c66 2e46 696e 6446 6f63 7573 2829  self.FindFocus()
-0000ef40: 0d0a 2020 2020 2020 2020 7365 6c66 2e62  ..        self.b
-0000ef50: 7574 746f 6e5f 6578 706f 7274 2e45 6e61  utton_export.Ena
-0000ef60: 626c 6564 203d 2046 616c 7365 0d0a 0d0a  bled = False....
-0000ef70: 2020 2020 2020 2020 6469 616c 6f67 203d          dialog =
-0000ef80: 2073 656c 662e 6469 616c 6f67 5f73 6176   self.dialog_sav
-0000ef90: 6566 696c 6520 6966 2064 6f5f 7369 6e67  efile if do_sing
-0000efa0: 6c65 6669 6c65 2065 6c73 6520 7365 6c66  lefile else self
-0000efb0: 2e64 6961 6c6f 675f 7361 7665 6669 6c65  .dialog_savefile
-0000efc0: 5f6f 770d 0a20 2020 2020 2020 2064 6961  _ow..        dia
-0000efd0: 6c6f 672e 4d65 7373 6167 6520 3d20 2243  log.Message = "C
-0000efe0: 686f 6f73 6520 666f 6c64 6572 2077 6865  hoose folder whe
-0000eff0: 7265 2074 6f20 7361 7665 2063 6861 7420  re to save chat 
-0000f000: 6669 6c65 7322 0d0a 2020 2020 2020 2020  files"..        
-0000f010: 6469 616c 6f67 2e46 696c 656e 616d 6520  dialog.Filename 
-0000f020: 3d20 2246 696c 656e 616d 6520 7769 6c6c  = "Filename will
-0000f030: 2062 6520 6967 6e6f 7265 6422 0d0a 2020   be ignored"..  
-0000f040: 2020 2020 2020 6469 616c 6f67 2e57 696c        dialog.Wil
-0000f050: 6463 6172 6420 3d20 6578 706f 7274 2e43  dcard = export.C
-0000f060: 4841 545f 5749 4c44 4341 5244 0d0a 2020  HAT_WILDCARD..  
-0000f070: 2020 2020 2020 6469 616c 6f67 2e46 696c        dialog.Fil
-0000f080: 7465 7249 6e64 6578 203d 2065 7870 6f72  terIndex = expor
-0000f090: 742e 4348 4154 5f45 5854 532e 696e 6465  t.CHAT_EXTS.inde
-0000f0a0: 7828 2268 746d 6c22 290d 0a20 2020 2020  x("html")..     
-0000f0b0: 2020 2069 6620 646f 5f73 696e 676c 6566     if do_singlef
-0000f0c0: 696c 653a 0d0a 2020 2020 2020 2020 2020  ile:..          
-0000f0d0: 2020 6462 203d 2073 656c 662e 6c6f 6164    db = self.load
-0000f0e0: 5f64 6174 6162 6173 6528 7365 6c66 2e64  _database(self.d
-0000f0f0: 625f 6669 6c65 6e61 6d65 290d 0a20 2020  b_filename)..   
-0000f100: 2020 2020 2020 2020 2066 6f72 6d61 7461           formata
-0000f110: 7267 7320 3d20 636f 6c6c 6563 7469 6f6e  rgs = collection
-0000f120: 732e 6465 6661 756c 7464 6963 7428 7374  s.defaultdict(st
-0000f130: 7229 0d0a 2020 2020 2020 2020 2020 2020  r)..            
-0000f140: 666f 726d 6174 6172 6773 5b22 736b 7970  formatargs["skyp
-0000f150: 656e 616d 6522 5d20 3d20 6f73 2e70 6174  ename"] = os.pat
-0000f160: 682e 6261 7365 6e61 6d65 2873 656c 662e  h.basename(self.
-0000f170: 6462 5f66 696c 656e 616d 6529 0d0a 2020  db_filename)..  
-0000f180: 2020 2020 2020 2020 2020 6966 2064 6220            if db 
-0000f190: 616e 6420 6462 2e61 6363 6f75 6e74 3a20  and db.account: 
-0000f1a0: 666f 726d 6174 6172 6773 2e75 7064 6174  formatargs.updat
-0000f1b0: 6528 6462 2e61 6363 6f75 6e74 290d 0a20  e(db.account).. 
-0000f1c0: 2020 2020 2020 2020 2020 2064 6566 6175             defau
-0000f1d0: 6c74 203d 2075 7469 6c2e 7361 6665 5f66  lt = util.safe_f
-0000f1e0: 696c 656e 616d 6528 636f 6e66 2e45 7870  ilename(conf.Exp
-0000f1f0: 6f72 7444 6254 656d 706c 6174 6520 2520  ortDbTemplate % 
-0000f200: 666f 726d 6174 6172 6773 290d 0a20 2020  formatargs)..   
-0000f210: 2020 2020 2020 2020 2064 6961 6c6f 672e           dialog.
-0000f220: 4669 6c65 6e61 6d65 203d 2064 6566 6175  Filename = defau
-0000f230: 6c74 0d0a 2020 2020 2020 2020 2020 2020  lt..            
-0000f240: 6469 616c 6f67 2e4d 6573 7361 6765 203d  dialog.Message =
-0000f250: 2022 5361 7665 2063 6861 7473 2066 696c   "Save chats fil
-0000f260: 6522 0d0a 2020 2020 2020 2020 2020 2020  e"..            
-0000f270: 6469 616c 6f67 2e57 696c 6463 6172 6420  dialog.Wildcard 
-0000f280: 3d20 6578 706f 7274 2e43 4841 545f 5749  = export.CHAT_WI
-0000f290: 4c44 4341 5244 5f53 494e 474c 4546 494c  LDCARD_SINGLEFIL
-0000f2a0: 450d 0a0d 0a20 2020 2020 2020 2069 6620  E....        if 
-0000f2b0: 7778 2e49 445f 4f4b 2021 3d20 6469 616c  wx.ID_OK != dial
-0000f2c0: 6f67 2e53 686f 774d 6f64 616c 2829 3a0d  og.ShowModal():.
-0000f2d0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0000f2e0: 662e 6275 7474 6f6e 5f65 7870 6f72 742e  f.button_export.
-0000f2f0: 456e 6162 6c65 6420 3d20 5472 7565 0d0a  Enabled = True..
-0000f300: 2020 2020 2020 2020 2020 2020 6966 2066              if f
-0000f310: 6f63 7573 6564 5f63 6f6e 7472 6f6c 3a20  ocused_control: 
-0000f320: 666f 6375 7365 645f 636f 6e74 726f 6c2e  focused_control.
-0000f330: 5365 7446 6f63 7573 2829 0d0a 2020 2020  SetFocus()..    
-0000f340: 2020 2020 2020 2020 7265 7475 726e 0d0a          return..
-0000f350: 0d0a 2020 2020 2020 2020 6462 2c20 6669  ..        db, fi
-0000f360: 6c65 732c 2063 6f75 6e74 2c20 6d65 7373  les, count, mess
-0000f370: 6167 655f 636f 756e 742c 206d 6564 6961  age_count, media
-0000f380: 5f66 6f6c 6465 7220 3d20 4e6f 6e65 2c20  _folder = None, 
-0000f390: 5b5d 2c20 302c 2030 2c20 4661 6c73 650d  [], 0, 0, False.
-0000f3a0: 0a20 2020 2020 2020 2065 7272 6f72 2c20  .        error, 
-0000f3b0: 6572 726f 726d 7367 2c20 6572 726f 726d  errormsg, errorm
-0000f3c0: 7367 5f73 686f 7274 203d 2046 616c 7365  sg_short = False
-0000f3d0: 2c20 4e6f 6e65 2c20 4e6f 6e65 0d0a 0d0a  , None, None....
-0000f3e0: 2020 2020 2020 2020 6462 203d 2073 656c          db = sel
-0000f3f0: 662e 6c6f 6164 5f64 6174 6162 6173 6528  f.load_database(
-0000f400: 7365 6c66 2e64 625f 6669 6c65 6e61 6d65  self.db_filename
-0000f410: 290d 0a20 2020 2020 2020 2070 6174 6820  )..        path 
-0000f420: 3d20 636f 6e74 726f 6c73 2e67 6574 5f64  = controls.get_d
-0000f430: 6961 6c6f 675f 7061 7468 2864 6961 6c6f  ialog_path(dialo
-0000f440: 6729 0d0a 2020 2020 2020 2020 6966 206e  g)..        if n
-0000f450: 6f74 2064 623a 0d0a 2020 2020 2020 2020  ot db:..        
-0000f460: 2020 2020 6572 726f 7220 3d20 5472 7565      error = True
-0000f470: 0d0a 2020 2020 2020 2020 656c 6966 2022  ..        elif "
-0000f480: 636f 6e76 6572 7361 7469 6f6e 7322 206e  conversations" n
-0000f490: 6f74 2069 6e20 6462 2e74 6162 6c65 733a  ot in db.tables:
-0000f4a0: 0d0a 2020 2020 2020 2020 2020 2020 6572  ..            er
-0000f4b0: 726f 7220 3d20 5472 7565 0d0a 2020 2020  ror = True..    
-0000f4c0: 2020 2020 2020 2020 6572 726f 726d 7367          errormsg
-0000f4d0: 203d 2022 4361 6e6e 6f74 2065 7870 6f72   = "Cannot expor
-0000f4e0: 7420 2573 2e20 4e6f 7420 6120 7661 6c69  t %s. Not a vali
-0000f4f0: 6420 536b 7970 6520 6461 7461 6261 7365  d Skype database
-0000f500: 3f22 2025 2064 620d 0a20 2020 2020 2020  ?" % db..       
-0000f510: 2069 6620 6e6f 7420 6572 726f 7220 616e   if not error an
-0000f520: 6420 6e6f 7420 646f 5f73 696e 676c 6566  d not do_singlef
-0000f530: 696c 653a 0d0a 2020 2020 2020 2020 2020  ile:..          
-0000f540: 2020 666f 726d 6174 203d 2065 7870 6f72    format = expor
-0000f550: 742e 4348 4154 5f45 5854 535b 6469 616c  t.CHAT_EXTS[dial
-0000f560: 6f67 2e46 696c 7465 7249 6e64 6578 5d0d  og.FilterIndex].
-0000f570: 0a20 2020 2020 2020 2020 2020 206d 6564  .            med
-0000f580: 6961 5f66 6f6c 6465 7220 3d20 2268 746d  ia_folder = "htm
-0000f590: 6c22 203d 3d20 666f 726d 6174 2061 6e64  l" == format and
-0000f5a0: 205c 0d0a 2020 2020 2020 2020 2020 2020   \..            
-0000f5b0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0000f5c0: 6961 6c6f 672e 4669 6c74 6572 496e 6465  ialog.FilterInde
-0000f5d0: 7820 213d 2065 7870 6f72 742e 4348 4154  x != export.CHAT
-0000f5e0: 5f45 5854 532e 696e 6465 7828 2268 746d  _EXTS.index("htm
-0000f5f0: 6c22 290d 0a20 2020 2020 2020 2020 2020  l")..           
-0000f600: 2069 6620 6d65 6469 615f 666f 6c64 6572   if media_folder
-0000f610: 2061 6e64 206e 6f74 2063 6865 636b 5f6d   and not check_m
-0000f620: 6564 6961 5f65 7870 6f72 745f 6c6f 6769  edia_export_logi
-0000f630: 6e28 6462 293a 0d0a 2020 2020 2020 2020  n(db):..        
-0000f640: 2020 2020 2020 2020 7365 6c66 2e62 7574          self.but
-0000f650: 746f 6e5f 6578 706f 7274 2e45 6e61 626c  ton_export.Enabl
-0000f660: 6564 203d 2054 7275 650d 0a20 2020 2020  ed = True..     
-0000f670: 2020 2020 2020 2020 2020 2069 6620 666f             if fo
-0000f680: 6375 7365 645f 636f 6e74 726f 6c3a 2066  cused_control: f
-0000f690: 6f63 7573 6564 5f63 6f6e 7472 6f6c 2e53  ocused_control.S
-0000f6a0: 6574 466f 6375 7328 290d 0a20 2020 2020  etFocus()..     
-0000f6b0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0000f6c0: 6e0d 0a0d 0a20 2020 2020 2020 2020 2020  n....           
-0000f6d0: 2066 6f72 6d61 7461 7267 7320 3d20 636f   formatargs = co
-0000f6e0: 6c6c 6563 7469 6f6e 732e 6465 6661 756c  llections.defaul
-0000f6f0: 7464 6963 7428 7374 7229 0d0a 2020 2020  tdict(str)..    
-0000f700: 2020 2020 2020 2020 666f 726d 6174 6172          formatar
-0000f710: 6773 5b22 736b 7970 656e 616d 6522 5d20  gs["skypename"] 
-0000f720: 3d20 6f73 2e70 6174 682e 6261 7365 6e61  = os.path.basena
-0000f730: 6d65 2873 656c 662e 6462 5f66 696c 656e  me(self.db_filen
-0000f740: 616d 6529 0d0a 2020 2020 2020 2020 2020  ame)..          
-0000f750: 2020 6966 2064 622e 6163 636f 756e 743a    if db.account:
-0000f760: 2066 6f72 6d61 7461 7267 732e 7570 6461   formatargs.upda
-0000f770: 7465 2864 622e 6163 636f 756e 7429 0d0a  te(db.account)..
-0000f780: 2020 2020 2020 2020 2020 2020 666f 6c64              fold
-0000f790: 6572 203d 2075 7469 6c2e 7361 6665 5f66  er = util.safe_f
-0000f7a0: 696c 656e 616d 6528 636f 6e66 2e45 7870  ilename(conf.Exp
-0000f7b0: 6f72 7444 6254 656d 706c 6174 6520 2520  ortDbTemplate % 
-0000f7c0: 666f 726d 6174 6172 6773 290d 0a20 2020  formatargs)..   
-0000f7d0: 2020 2020 2020 2020 2070 6174 6820 3d20           path = 
-0000f7e0: 7574 696c 2e75 6e69 7175 655f 7061 7468  util.unique_path
-0000f7f0: 286f 732e 7061 7468 2e6a 6f69 6e28 6f73  (os.path.join(os
-0000f800: 2e70 6174 682e 6469 726e 616d 6528 7061  .path.dirname(pa
-0000f810: 7468 292c 2066 6f6c 6465 7229 290d 0a20  th), folder)).. 
-0000f820: 2020 2020 2020 2020 2020 2074 7279 3a0d             try:.
-0000f830: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f840: 206f 732e 6d6b 6469 7228 7061 7468 290d   os.mkdir(path).
-0000f850: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
-0000f860: 6570 7420 4578 6365 7074 696f 6e20 6173  ept Exception as
-0000f870: 2065 3a0d 0a20 2020 2020 2020 2020 2020   e:..           
-0000f880: 2020 2020 2065 7272 6f72 6d73 675f 7368       errormsg_sh
-0000f890: 6f72 7420 3d20 2246 6169 6c65 6420 746f  ort = "Failed to
-0000f8a0: 2063 7265 6174 6520 6469 7265 6374 6f72   create director
-0000f8b0: 7920 2573 3a20 2573 2220 2520 280d 0a20  y %s: %s" % (.. 
-0000f8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f8e0: 7061 7468 2c20 7574 696c 2e66 6f72 6d61  path, util.forma
-0000f8f0: 745f 6578 6328 6529 290d 0a20 2020 2020  t_exc(e))..     
-0000f900: 2020 2020 2020 2020 2020 2065 7272 6f72             error
-0000f910: 6d73 6720 3d20 2246 6169 6c65 6420 746f  msg = "Failed to
-0000f920: 2063 7265 6174 6520 6469 7265 6374 6f72   create director
-0000f930: 7920 2573 3a5c 6e5c 6e25 7322 2025 205c  y %s:\n\n%s" % \
-0000f940: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000f950: 2020 2020 2020 2020 2020 2020 2028 7061               (pa
-0000f960: 7468 2c20 7472 6163 6562 6163 6b2e 666f  th, traceback.fo
-0000f970: 726d 6174 5f65 7863 2829 290d 0a20 2020  rmat_exc())..   
-0000f980: 2020 2020 2020 2020 2020 2020 2065 7272               err
-0000f990: 6f72 203d 2054 7275 650d 0a20 2020 2020  or = True..     
-0000f9a0: 2020 2065 6c69 6620 6e6f 7420 6572 726f     elif not erro
-0000f9b0: 723a 0d0a 2020 2020 2020 2020 2020 2020  r:..            
-0000f9c0: 666f 726d 6174 203d 2065 7870 6f72 742e  format = export.
-0000f9d0: 4348 4154 5f45 5854 535f 5349 4e47 4c45  CHAT_EXTS_SINGLE
-0000f9e0: 4649 4c45 5b64 6961 6c6f 672e 4669 6c74  FILE[dialog.Filt
-0000f9f0: 6572 496e 6465 785d 0d0a 0d0a 0d0a 2020  erIndex]......  
-0000fa00: 2020 2020 2020 6966 206e 6f74 2065 7272        if not err
-0000fa10: 6f72 3a0d 0a20 2020 2020 2020 2020 2020  or:..           
-0000fa20: 2063 6861 7473 203d 2064 622e 6765 745f   chats = db.get_
-0000fa30: 636f 6e76 6572 7361 7469 6f6e 7328 290d  conversations().
-0000fa40: 0a20 2020 2020 2020 2020 2020 2062 7573  .            bus
-0000fa50: 7920 3d20 636f 6e74 726f 6c73 2e42 7573  y = controls.Bus
-0000fa60: 7950 616e 656c 280d 0a20 2020 2020 2020  yPanel(..       
-0000fa70: 2020 2020 2020 2020 2073 656c 662c 2027           self, '
-0000fa80: 4578 706f 7274 696e 6720 616c 6c20 6368  Exporting all ch
-0000fa90: 6174 7320 6672 6f6d 2022 2573 225c 6e61  ats from "%s"\na
-0000faa0: 7320 2573 2075 6e64 6572 2025 732e 2720  s %s under %s.' 
-0000fab0: 250d 0a20 2020 2020 2020 2020 2020 2020  %..             
-0000fac0: 2020 2028 6462 2e66 696c 656e 616d 652c     (db.filename,
-0000fad0: 2066 6f72 6d61 742e 7570 7065 7228 292c   format.upper(),
-0000fae0: 2070 6174 6829 290d 0a20 2020 2020 2020   path))..       
-0000faf0: 2020 2020 2077 782e 5361 6665 5969 656c       wx.SafeYiel
-0000fb00: 6428 2920 2320 416c 6c6f 7720 5549 2074  d() # Allow UI t
-0000fb10: 6f20 7265 6672 6573 680d 0a20 2020 2020  o refresh..     
-0000fb20: 2020 2020 2020 2074 7279 3a0d 0a20 2020         try:..   
-0000fb30: 2020 2020 2020 2020 2020 2020 2064 622e               db.
-0000fb40: 6765 745f 636f 6e76 6572 7361 7469 6f6e  get_conversation
-0000fb50: 735f 7374 6174 7328 6368 6174 7329 0d0a  s_stats(chats)..
-0000fb60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fb70: 7072 6f67 7265 7373 6675 6e63 203d 206c  progressfunc = l
-0000fb80: 616d 6264 6120 2a61 7267 733a 2077 782e  ambda *args: wx.
-0000fb90: 5361 6665 5969 656c 6428 290d 0a20 2020  SafeYield()..   
-0000fba0: 2020 2020 2020 2020 2020 2020 206f 7074               opt
-0000fbb0: 7320 3d20 6469 6374 286d 756c 7469 3d6e  s = dict(multi=n
-0000fbc0: 6f74 2064 6f5f 7369 6e67 6c65 6669 6c65  ot do_singlefile
-0000fbd0: 2c20 7072 6f67 7265 7373 3d70 726f 6772  , progress=progr
-0000fbe0: 6573 7366 756e 6329 0d0a 2020 2020 2020  essfunc)..      
-0000fbf0: 2020 2020 2020 2020 2020 6966 206d 6564            if med
-0000fc00: 6961 5f66 6f6c 6465 723a 206f 7074 735b  ia_folder: opts[
-0000fc10: 226d 6564 6961 5f66 6f6c 6465 7222 5d20  "media_folder"] 
-0000fc20: 3d20 5472 7565 0d0a 2020 2020 2020 2020  = True..        
-0000fc30: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
-0000fc40: 2065 7870 6f72 742e 6578 706f 7274 5f63   export.export_c
-0000fc50: 6861 7473 2863 6861 7473 2c20 7061 7468  hats(chats, path
-0000fc60: 2c20 666f 726d 6174 2c20 6462 2c20 6f70  , format, db, op
-0000fc70: 7473 290d 0a20 2020 2020 2020 2020 2020  ts)..           
-0000fc80: 2020 2020 2066 696c 6573 2c20 636f 756e       files, coun
-0000fc90: 742c 206d 6573 7361 6765 5f63 6f75 6e74  t, message_count
-0000fca0: 203d 2072 6573 756c 740d 0a20 2020 2020   = result..     
-0000fcb0: 2020 2020 2020 2020 2020 2070 6167 6520             page 
-0000fcc0: 3d20 6e65 7874 2828 6b20 666f 7220 6b2c  = next((k for k,
-0000fcd0: 2076 2069 6e20 7365 6c66 2e64 625f 7061   v in self.db_pa
-0000fce0: 6765 732e 6974 656d 7328 2920 6966 2076  ges.items() if v
-0000fcf0: 2069 7320 6462 292c 204e 6f6e 6529 0d0a   is db), None)..
-0000fd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fd10: 6966 2070 6167 653a 2077 782e 4361 6c6c  if page: wx.Call
-0000fd20: 4166 7465 7228 7061 6765 2e75 7064 6174  After(page.updat
-0000fd30: 655f 6c69 7665 696e 666f 290d 0a20 2020  e_liveinfo)..   
-0000fd40: 2020 2020 2020 2020 2065 7863 6570 7420           except 
-0000fd50: 4578 6365 7074 696f 6e20 6173 2065 3a0d  Exception as e:.
-0000fd60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000fd70: 2065 7272 6f72 6d73 675f 7368 6f72 7420   errormsg_short 
-0000fd80: 3d20 2245 7272 6f72 2065 7870 6f72 7469  = "Error exporti
-0000fd90: 6e67 2063 6861 7473 3a20 2573 2220 2520  ng chats: %s" % 
-0000fda0: 7574 696c 2e66 6f72 6d61 745f 6578 6328  util.format_exc(
-0000fdb0: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
-0000fdc0: 2020 2020 6572 726f 726d 7367 203d 2022      errormsg = "
-0000fdd0: 4572 726f 7220 6578 706f 7274 696e 6720  Error exporting 
-0000fde0: 6368 6174 733a 5c6e 5c6e 2573 2220 2520  chats:\n\n%s" % 
-0000fdf0: 7472 6163 6562 6163 6b2e 666f 726d 6174  traceback.format
-0000fe00: 5f65 7863 2829 0d0a 2020 2020 2020 2020  _exc()..        
-0000fe10: 2020 2020 2020 2020 6572 726f 7220 3d20          error = 
-0000fe20: 5472 7565 0d0a 2020 2020 2020 2020 2020  True..          
-0000fe30: 2020 6275 7379 2e43 6c6f 7365 2829 0d0a    busy.Close()..
-0000fe40: 2020 2020 2020 2020 6966 206e 6f74 2065          if not e
-0000fe50: 7272 6f72 3a0d 0a20 2020 2020 2020 2020  rror:..         
-0000fe60: 2020 2067 7569 6261 7365 2e73 7461 7475     guibase.statu
-0000fe70: 7328 2245 7870 6f72 7465 6420 2573 2061  s("Exported %s a
-0000fe80: 6e64 2025 7320 6672 6f6d 2025 7320 6173  nd %s from %s as
-0000fe90: 2025 7320 756e 6465 7220 2573 2e22 2c0d   %s under %s.",.
-0000fea0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000feb0: 2020 2020 2020 2020 2020 2020 7574 696c              util
-0000fec0: 2e70 6c75 7261 6c28 2263 6861 7422 2c20  .plural("chat", 
-0000fed0: 636f 756e 742c 2073 6570 3d22 2c22 292c  count, sep=","),
-0000fee0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000fef0: 2020 2020 2020 2020 2020 2020 2075 7469               uti
-0000ff00: 6c2e 706c 7572 616c 2822 6d65 7373 6167  l.plural("messag
-0000ff10: 6522 2c20 6d65 7373 6167 655f 636f 756e  e", message_coun
-0000ff20: 742c 2073 6570 3d22 2c22 292c 0d0a 2020  t, sep=","),..  
-0000ff30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ff40: 2020 2020 2020 2020 2064 622e 6669 6c65           db.file
-0000ff50: 6e61 6d65 2c20 666f 726d 6174 2e75 7070  name, format.upp
-0000ff60: 6572 2829 2c20 7061 7468 2c20 6c6f 673d  er(), path, log=
-0000ff70: 5472 7565 290d 0a20 2020 2020 2020 2065  True)..        e
-0000ff80: 6c69 6620 6572 726f 726d 7367 3a0d 0a20  lif errormsg:.. 
-0000ff90: 2020 2020 2020 2020 2020 2067 7569 6261             guiba
-0000ffa0: 7365 2e73 7461 7475 7328 6572 726f 726d  se.status(errorm
-0000ffb0: 7367 5f73 686f 7274 206f 7220 6572 726f  sg_short or erro
-0000ffc0: 726d 7367 2c20 6c6f 673d 5472 7565 290d  rmsg, log=True).
-0000ffd0: 0a20 2020 2020 2020 2020 2020 2077 782e  .            wx.
-0000ffe0: 4d65 7373 6167 6542 6f78 2865 7272 6f72  MessageBox(error
-0000fff0: 6d73 672c 2063 6f6e 662e 5469 746c 652c  msg, conf.Title,
-00010000: 2077 782e 4f4b 207c 2077 782e 4943 4f4e   wx.OK | wx.ICON
-00010010: 5f57 4152 4e49 4e47 290d 0a20 2020 2020  _WARNING)..     
-00010020: 2020 2069 6620 6462 2061 6e64 206e 6f74     if db and not
-00010030: 2064 622e 6861 735f 636f 6e73 756d 6572   db.has_consumer
-00010040: 7328 293a 0d0a 2020 2020 2020 2020 2020  s():..          
-00010050: 2020 7365 6c66 2e64 6273 2e70 6f70 2864    self.dbs.pop(d
-00010060: 622e 6669 6c65 6e61 6d65 2c20 4e6f 6e65  b.filename, None
-00010070: 290d 0a20 2020 2020 2020 2020 2020 2064  )..            d
-00010080: 622e 636c 6f73 6528 290d 0a20 2020 2020  b.close()..     
-00010090: 2020 2069 6620 6462 2061 6e64 206e 6f74     if db and not
-000100a0: 2065 7272 6f72 3a0d 0a20 2020 2020 2020   error:..       
-000100b0: 2020 2020 2069 6620 636f 6e66 2e45 7870       if conf.Exp
-000100c0: 6f72 7446 696c 6541 7574 6f4f 7065 6e3a  ortFileAutoOpen:
-000100d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000100e0: 2020 7574 696c 2e73 7461 7274 5f66 696c    util.start_fil
-000100f0: 6528 6669 6c65 735b 305d 2069 6620 646f  e(files[0] if do
-00010100: 5f73 696e 676c 6566 696c 6520 656c 7365  _singlefile else
-00010110: 2070 6174 6829 0d0a 2020 2020 2020 2020   path)..        
-00010120: 7365 6c66 2e62 7574 746f 6e5f 6578 706f  self.button_expo
-00010130: 7274 2e45 6e61 626c 6564 203d 2054 7275  rt.Enabled = Tru
-00010140: 650d 0a20 2020 2020 2020 2069 6620 666f  e..        if fo
-00010150: 6375 7365 645f 636f 6e74 726f 6c3a 2066  cused_control: f
-00010160: 6f63 7573 6564 5f63 6f6e 7472 6f6c 2e53  ocused_control.S
-00010170: 6574 466f 6375 7328 290d 0a0d 0a0d 0a20  etFocus()...... 
-00010180: 2020 2064 6566 206f 6e5f 636f 6d70 6172     def on_compar
-00010190: 655f 6d65 6e75 2873 656c 662c 2065 7665  e_menu(self, eve
-000101a0: 6e74 293a 0d0a 2020 2020 2020 2020 2222  nt):..        ""
-000101b0: 220d 0a20 2020 2020 2020 2048 616e 646c  "..        Handl
-000101c0: 6572 2066 6f72 2063 686f 6f73 696e 6720  er for choosing 
-000101d0: 6120 6669 6c65 2066 726f 6d20 7468 6520  a file from the 
-000101e0: 636f 6d70 6172 6520 706f 7075 7020 6d65  compare popup me
-000101f0: 6e75 2c20 6c6f 6164 7320 626f 7468 0d0a  nu, loads both..
-00010200: 2020 2020 2020 2020 6461 7461 6261 7365          database
-00010210: 7320 616e 6420 6f70 656e 7320 7468 6520  s and opens the 
-00010220: 6d65 7267 6572 2070 6167 652e 0d0a 2020  merger page...  
-00010230: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
-00010240: 2020 2066 696c 656e 616d 6531 2c20 6669     filename1, fi
-00010250: 6c65 6e61 6d65 3220 3d20 7365 6c66 2e64  lename2 = self.d
-00010260: 625f 6669 6c65 6e61 6d65 2c20 4e6f 6e65  b_filename, None
-00010270: 0d0a 2020 2020 2020 2020 2320 4669 6e64  ..        # Find
-00010280: 206d 656e 7569 7465 6d20 696e 6465 7820   menuitem index 
-00010290: 616e 6420 6c61 6265 6c20 6672 6f6d 206f  and label from o
-000102a0: 7269 6769 6e61 6c20 6d65 6e75 2062 7920  riginal menu by 
-000102b0: 6576 656e 7420 4944 0d0a 2020 2020 2020  event ID..      
-000102c0: 2020 6e69 7465 6d73 203d 2065 6e75 6d65    nitems = enume
-000102d0: 7261 7465 2865 7665 6e74 2e45 7665 6e74  rate(event.Event
-000102e0: 4f62 6a65 6374 2e47 6574 4d65 6e75 4974  Object.GetMenuIt
-000102f0: 656d 7328 2929 0d0a 2020 2020 2020 2020  ems())..        
-00010300: 696e 6465 7869 7465 6d20 3d20 5b28 692c  indexitem = [(i,
-00010310: 206d 2920 666f 7220 692c 206d 2069 6e20   m) for i, m in 
-00010320: 6e69 7465 6d73 2069 6620 6d2e 4765 7449  nitems if m.GetI
-00010330: 6428 2920 3d3d 2065 7665 6e74 2e49 645d  d() == event.Id]
-00010340: 0d0a 2020 2020 2020 2020 692c 2069 7465  ..        i, ite
-00010350: 6d20 3d20 696e 6465 7869 7465 6d5b 305d  m = indexitem[0]
-00010360: 2069 6620 696e 6465 7869 7465 6d20 656c   if indexitem el
-00010370: 7365 2028 2d31 2c20 4e6f 6e65 290d 0a20  se (-1, None).. 
-00010380: 2020 2020 2020 2068 6173 5f65 7870 6f72         has_expor
-00010390: 7420 3d20 626f 6f6c 286c 6976 652e 696a  t = bool(live.ij
-000103a0: 736f 6e29 0d0a 2020 2020 2020 2020 6973  son)..        is
-000103b0: 5f65 7870 6f72 7420 3d20 6861 735f 6578  _export = has_ex
-000103c0: 706f 7274 2061 6e64 2028 6920 3d3d 2031  port and (i == 1
-000103d0: 290d 0a20 2020 2020 2020 2069 6620 6920  )..        if i 
-000103e0: 3e20 6861 735f 6578 706f 7274 2061 6e64  > has_export and
-000103f0: 2069 7465 6d3a 0d0a 2020 2020 2020 2020   item:..        
-00010400: 2020 2020 6669 6c65 6e61 6d65 3220 3d20      filename2 = 
-00010410: 6974 656d 2e47 6574 4c61 6265 6c28 292e  item.GetLabel().
-00010420: 7370 6c69 7428 2220 222c 2031 292e 706f  split(" ", 1).po
-00010430: 7028 290d 0a20 2020 2020 2020 2065 6c69  p()..        eli
-00010440: 6620 6973 5f65 7870 6f72 743a 2023 2053  f is_export: # S
-00010450: 6563 6f6e 6420 6d65 6e75 2069 7465 6d3a  econd menu item:
-00010460: 206f 7065 6e20 6120 536b 7970 6520 6578   open a Skype ex
-00010470: 706f 7274 2061 7263 6869 7665 2066 726f  port archive fro
-00010480: 6d20 636f 6d70 7574 6572 0d0a 2020 2020  m computer..    
-00010490: 2020 2020 2020 2020 6966 2077 782e 4944          if wx.ID
-000104a0: 5f4f 4b20 3d3d 2073 656c 662e 6469 616c  _OK == self.dial
-000104b0: 6f67 5f6f 7065 6e65 7870 6f72 742e 5368  og_openexport.Sh
-000104c0: 6f77 4d6f 6461 6c28 293a 0d0a 2020 2020  owModal():..    
-000104d0: 2020 2020 2020 2020 2020 2020 6669 6c65              file
-000104e0: 6e61 6d65 3220 3d20 7365 6c66 2e64 6961  name2 = self.dia
-000104f0: 6c6f 675f 6f70 656e 6578 706f 7274 2e47  log_openexport.G
-00010500: 6574 5061 7468 2829 0d0a 2020 2020 2020  etPath()..      
-00010510: 2020 656c 7365 3a20 2320 4669 7273 7420    else: # First 
-00010520: 6d65 6e75 2069 7465 6d3a 206f 7065 6e20  menu item: open 
-00010530: 6120 6669 6c65 2066 726f 6d20 636f 6d70  a file from comp
-00010540: 7574 6572 0d0a 2020 2020 2020 2020 2020  uter..          
-00010550: 2020 6966 2077 782e 4944 5f4f 4b20 3d3d    if wx.ID_OK ==
-00010560: 2073 656c 662e 6469 616c 6f67 5f6f 7065   self.dialog_ope
-00010570: 6e66 696c 652e 5368 6f77 4d6f 6461 6c28  nfile.ShowModal(
-00010580: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00010590: 2020 2020 6669 6c65 6e61 6d65 3220 3d20      filename2 = 
-000105a0: 7365 6c66 2e64 6961 6c6f 675f 6f70 656e  self.dialog_open
-000105b0: 6669 6c65 2e47 6574 5061 7468 2829 0d0a  file.GetPath()..
-000105c0: 2020 2020 2020 2020 6966 2066 696c 656e          if filen
-000105d0: 616d 6531 203d 3d20 6669 6c65 6e61 6d65  ame1 == filename
-000105e0: 323a 0d0a 2020 2020 2020 2020 2020 2020  2:..            
-000105f0: 7778 2e4d 6573 7361 6765 426f 7828 2243  wx.MessageBox("C
-00010600: 616e 6e6f 7420 636f 6d70 6172 6520 2573  annot compare %s
-00010610: 2077 6974 6820 6974 7365 6c66 2e22 2025   with itself." %
-00010620: 2028 6669 6c65 6e61 6d65 3129 2c0d 0a20   (filename1),.. 
-00010630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010640: 2020 2020 2020 2020 2063 6f6e 662e 5469           conf.Ti
-00010650: 746c 652c 2077 782e 4f4b 207c 2077 782e  tle, wx.OK | wx.
-00010660: 4943 4f4e 5f57 4152 4e49 4e47 290d 0a20  ICON_WARNING).. 
-00010670: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-00010680: 2020 2020 2020 2020 2020 7365 6c66 2e63            self.c
-00010690: 6f6d 7061 7265 5f64 6174 6162 6173 6573  ompare_databases
-000106a0: 2866 696c 656e 616d 6531 2c20 6669 6c65  (filename1, file
-000106b0: 6e61 6d65 322c 2069 735f 6578 706f 7274  name2, is_export
-000106c0: 290d 0a0d 0a0d 0a20 2020 2064 6566 2063  )......    def c
-000106d0: 6f6d 7061 7265 5f64 6174 6162 6173 6573  ompare_databases
-000106e0: 2873 656c 662c 2066 696c 656e 616d 6531  (self, filename1
-000106f0: 2c20 6669 6c65 6e61 6d65 322c 2069 735f  , filename2, is_
-00010700: 6578 706f 7274 3d46 616c 7365 293a 0d0a  export=False):..
-00010710: 2020 2020 2020 2020 2222 224f 7065 6e73          """Opens
-00010720: 2074 6865 2074 776f 2064 6174 6162 6173   the two databas
-00010730: 6573 2066 6f72 2063 6f6d 7061 7269 736f  es for compariso
-00010740: 6e2c 2069 6620 706f 7373 6962 6c65 2e22  n, if possible."
-00010750: 2222 0d0a 2020 2020 2020 2020 6966 206e  ""..        if n
-00010760: 6f74 2066 696c 656e 616d 6531 206f 7220  ot filename1 or 
-00010770: 6e6f 7420 6669 6c65 6e61 6d65 323a 2072  not filename2: r
-00010780: 6574 7572 6e0d 0a0d 0a20 2020 2020 2020  eturn....       
-00010790: 2069 6620 6669 6c65 6e61 6d65 3120 696e   if filename1 in
-000107a0: 2073 656c 662e 776f 726b 6572 735f 696d   self.workers_im
-000107b0: 706f 7274 3a0d 0a20 2020 2020 2020 2020  port:..         
-000107c0: 2020 2072 6574 7572 6e20 7778 2e4d 6573     return wx.Mes
-000107d0: 7361 6765 426f 7828 2225 7320 6973 2063  sageBox("%s is c
-000107e0: 7572 7265 6e74 6c79 2062 6569 6e67 2069  urrently being i
-000107f0: 6d70 6f72 7465 6420 746f 2c20 6361 6e6e  mported to, cann
-00010800: 6f74 206f 7065 6e2e 2220 250d 0a20 2020  ot open." %..   
+0000c5b0: 2020 2020 2022 5265 6d6f 7665 2026 6d69       "Remove &mi
+0000c5c0: 7373 696e 6720 6669 6c65 7322 2929 0d0a  ssing files"))..
+0000c5d0: 2020 2020 2020 2020 6974 656d 5f73 6b79          item_sky
+0000c5e0: 7065 2020 2020 3d20 6d65 6e75 2e41 7070  pe    = menu.App
+0000c5f0: 656e 6449 7465 6d28 7778 2e6c 6962 2e61  endItem(wx.lib.a
+0000c600: 6777 2e66 6c61 746d 656e 752e 466c 6174  gw.flatmenu.Flat
+0000c610: 4d65 6e75 4974 656d 286d 656e 752c 2077  MenuItem(menu, w
+0000c620: 782e 4944 5f41 4e59 2c0d 0a20 2020 2020  x.ID_ANY,..     
+0000c630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c650: 2020 2252 656d 6f76 6520 2653 6b79 7065    "Remove &Skype
+0000c660: 2064 6174 6162 6173 6573 2229 290d 0a20   databases")).. 
+0000c670: 2020 2020 2020 2069 7465 6d5f 6e6f 6e73         item_nons
+0000c680: 6b79 7065 203d 206d 656e 752e 4170 7065  kype = menu.Appe
+0000c690: 6e64 4974 656d 2877 782e 6c69 622e 6167  ndItem(wx.lib.ag
+0000c6a0: 772e 666c 6174 6d65 6e75 2e46 6c61 744d  w.flatmenu.FlatM
+0000c6b0: 656e 7549 7465 6d28 6d65 6e75 2c20 7778  enuItem(menu, wx
+0000c6c0: 2e49 445f 414e 592c 0d0a 2020 2020 2020  .ID_ANY,..      
+0000c6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c6f0: 2022 5265 6d6f 7665 2026 6e6f 6e2d 536b   "Remove &non-Sk
+0000c700: 7970 6520 6461 7461 6261 7365 7322 2929  ype databases"))
+0000c710: 0d0a 2020 2020 2020 2020 6974 656d 5f63  ..        item_c
+0000c720: 6c65 6172 2020 203d 206d 656e 752e 4170  lear   = menu.Ap
+0000c730: 7065 6e64 4974 656d 2877 782e 6c69 622e  pendItem(wx.lib.
+0000c740: 6167 772e 666c 6174 6d65 6e75 2e46 6c61  agw.flatmenu.Fla
+0000c750: 744d 656e 7549 7465 6d28 6d65 6e75 2c20  tMenuItem(menu, 
+0000c760: 7778 2e49 445f 414e 592c 0d0a 2020 2020  wx.ID_ANY,..    
+0000c770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c790: 2020 2022 5265 6d6f 7665 2026 616c 6c22     "Remove &all"
+0000c7a0: 2929 0d0a 0d0a 2020 2020 2020 2020 7365  ))....        se
+0000c7b0: 6c66 2e42 696e 6428 7778 2e45 5654 5f4d  lf.Bind(wx.EVT_M
+0000c7c0: 454e 552c 2073 656c 662e 6f6e 5f72 656d  ENU, self.on_rem
+0000c7d0: 6f76 655f 6d69 7373 696e 672c 2020 6974  ove_missing,  it
+0000c7e0: 656d 5f6d 6973 7369 6e67 290d 0a20 2020  em_missing)..   
+0000c7f0: 2020 2020 2073 656c 662e 4269 6e64 2877       self.Bind(w
+0000c800: 782e 4556 545f 4d45 4e55 2c20 6675 6e63  x.EVT_MENU, func
+0000c810: 746f 6f6c 732e 7061 7274 6961 6c28 7365  tools.partial(se
+0000c820: 6c66 2e6f 6e5f 7265 6d6f 7665 5f74 7970  lf.on_remove_typ
+0000c830: 652c 206f 7468 6572 3d46 616c 7365 292c  e, other=False),
+0000c840: 2069 7465 6d5f 736b 7970 6529 0d0a 2020   item_skype)..  
+0000c850: 2020 2020 2020 7365 6c66 2e42 696e 6428        self.Bind(
+0000c860: 7778 2e45 5654 5f4d 454e 552c 2073 656c  wx.EVT_MENU, sel
+0000c870: 662e 6f6e 5f72 656d 6f76 655f 7479 7065  f.on_remove_type
+0000c880: 2c20 2020 2020 6974 656d 5f6e 6f6e 736b  ,     item_nonsk
+0000c890: 7970 6529 0d0a 2020 2020 2020 2020 7365  ype)..        se
+0000c8a0: 6c66 2e42 696e 6428 7778 2e45 5654 5f4d  lf.Bind(wx.EVT_M
+0000c8b0: 454e 552c 2073 656c 662e 6f6e 5f63 6c65  ENU, self.on_cle
+0000c8c0: 6172 5f64 6174 6162 6173 6573 2c20 6974  ar_databases, it
+0000c8d0: 656d 5f63 6c65 6172 290d 0a0d 0a20 2020  em_clear)....   
+0000c8e0: 2020 2020 2062 746e 203d 2073 656c 662e       btn = self.
+0000c8f0: 6275 7474 6f6e 5f63 6c65 6172 0d0a 2020  button_clear..  
+0000c900: 2020 2020 2020 737a 5f62 746e 2c20 7074        sz_btn, pt
+0000c910: 5f62 746e 203d 2062 746e 2e53 697a 652c  _btn = btn.Size,
+0000c920: 2062 746e 2e50 6f73 6974 696f 6e0d 0a20   btn.Position.. 
+0000c930: 2020 2020 2020 2070 745f 6274 6e20 3d20         pt_btn = 
+0000c940: 6274 6e2e 5061 7265 6e74 2e43 6c69 656e  btn.Parent.Clien
+0000c950: 7454 6f53 6372 6565 6e28 7074 5f62 746e  tToScreen(pt_btn
+0000c960: 290d 0a20 2020 2020 2020 206d 656e 752e  )..        menu.
+0000c970: 5365 744f 776e 6572 4865 6967 6874 2873  SetOwnerHeight(s
+0000c980: 7a5f 6274 6e2e 7929 0d0a 2020 2020 2020  z_btn.y)..      
+0000c990: 2020 6966 206d 656e 752e 5369 7a65 2e77    if menu.Size.w
+0000c9a0: 6964 7468 203c 2073 7a5f 6274 6e2e 7769  idth < sz_btn.wi
+0000c9b0: 6474 683a 0d0a 2020 2020 2020 2020 2020  dth:..          
+0000c9c0: 2020 6d65 6e75 2e53 697a 6520 3d20 737a    menu.Size = sz
+0000c9d0: 5f62 746e 2e77 6964 7468 2c20 6d65 6e75  _btn.width, menu
+0000c9e0: 2e53 697a 652e 6865 6967 6874 0d0a 2020  .Size.height..  
+0000c9f0: 2020 2020 2020 6d65 6e75 2e50 6f70 7570        menu.Popup
+0000ca00: 2828 7074 5f62 746e 292c 2073 656c 6629  ((pt_btn), self)
+0000ca10: 0d0a 0d0a 0d0a 2020 2020 6465 6620 6f6e  ......    def on
+0000ca20: 5f63 6c65 6172 5f64 6174 6162 6173 6573  _clear_databases
+0000ca30: 2873 656c 662c 2065 7665 6e74 293a 0d0a  (self, event):..
+0000ca40: 2020 2020 2020 2020 2222 2248 616e 646c          """Handl
+0000ca50: 6572 2066 6f72 2063 6c69 636b 696e 6720  er for clicking 
+0000ca60: 746f 2063 6c65 6172 2074 6865 2064 6174  to clear the dat
+0000ca70: 6162 6173 6520 6c69 7374 2e22 2222 0d0a  abase list."""..
+0000ca80: 2020 2020 2020 2020 6973 5f66 756c 6c20          is_full 
+0000ca90: 3d20 7365 6c66 2e6c 6973 745f 6462 2e47  = self.list_db.G
+0000caa0: 6574 4974 656d 436f 756e 7428 2920 3d3d  etItemCount() ==
+0000cab0: 2073 656c 662e 6c69 7374 5f64 622e 4765   self.list_db.Ge
+0000cac0: 7449 7465 6d43 6f75 6e74 4675 6c6c 2829  tItemCountFull()
+0000cad0: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
+0000cae0: 662e 6c69 7374 5f64 622e 4765 7449 7465  f.list_db.GetIte
+0000caf0: 6d43 6f75 6e74 2829 203c 2032 206f 7220  mCount() < 2 or 
+0000cb00: 7778 2e4f 4b20 213d 2077 782e 4d65 7373  wx.OK != wx.Mess
+0000cb10: 6167 6542 6f78 280d 0a20 2020 2020 2020  ageBox(..       
+0000cb20: 2020 2020 2022 4172 6520 796f 7520 7375       "Are you su
+0000cb30: 7265 2079 6f75 2077 616e 7420 746f 2063  re you want to c
+0000cb40: 6c65 6172 2074 6865 206c 6973 7420 6f66  lear the list of
+0000cb50: 2061 6c6c 2573 2064 6174 6162 6173 6573   all%s databases
+0000cb60: 3f22 2025 0d0a 2020 2020 2020 2020 2020  ?" %..          
+0000cb70: 2020 2822 2220 6966 2069 735f 6675 6c6c    ("" if is_full
+0000cb80: 2065 6c73 6520 2220 6375 7272 656e 746c   else " currentl
+0000cb90: 7920 7368 6f77 6e22 292c 0d0a 2020 2020  y shown"),..    
+0000cba0: 2020 2020 2020 2020 636f 6e66 2e54 6974          conf.Tit
+0000cbb0: 6c65 2c20 7778 2e4f 4b20 7c20 7778 2e43  le, wx.OK | wx.C
+0000cbc0: 414e 4345 4c20 7c20 7778 2e49 434f 4e5f  ANCEL | wx.ICON_
+0000cbd0: 5155 4553 5449 4f4e 0d0a 2020 2020 2020  QUESTION..      
+0000cbe0: 2020 293a 2072 6574 7572 6e0d 0a0d 0a20    ): return.... 
+0000cbf0: 2020 2020 2020 2063 6f75 6e74 203d 2073         count = s
+0000cc00: 656c 662e 6c69 7374 5f64 622e 4765 7449  elf.list_db.GetI
+0000cc10: 7465 6d43 6f75 6e74 2829 202d 2031 0d0a  temCount() - 1..
+0000cc20: 2020 2020 2020 2020 6966 2069 735f 6675          if is_fu
+0000cc30: 6c6c 3a0d 0a20 2020 2020 2020 2020 2020  ll:..           
+0000cc40: 2073 656c 662e 6c69 7374 5f64 622e 506f   self.list_db.Po
+0000cc50: 7075 6c61 7465 285b 5d29 0d0a 2020 2020  pulate([])..    
+0000cc60: 2020 2020 2020 2020 6465 6c20 636f 6e66          del conf
+0000cc70: 2e44 4246 696c 6573 5b3a 5d0d 0a20 2020  .DBFiles[:]..   
+0000cc80: 2020 2020 2020 2020 2064 656c 2063 6f6e           del con
+0000cc90: 662e 4c61 7374 5365 6c65 6374 6564 4669  f.LastSelectedFi
+0000cca0: 6c65 735b 3a5d 0d0a 2020 2020 2020 2020  les[:]..        
+0000ccb0: 2020 2020 6465 6c20 636f 6e66 2e52 6563      del conf.Rec
+0000ccc0: 656e 7446 696c 6573 5b3a 5d0d 0a20 2020  entFiles[:]..   
+0000ccd0: 2020 2020 2020 2020 2063 6f6e 662e 4c61           conf.La
+0000cce0: 7374 5365 6172 6368 5265 7375 6c74 732e  stSearchResults.
+0000ccf0: 636c 6561 7228 290d 0a20 2020 2020 2020  clear()..       
+0000cd00: 2020 2020 2077 6869 6c65 2073 656c 662e       while self.
+0000cd10: 6869 7374 6f72 795f 6669 6c65 2e43 6f75  history_file.Cou
+0000cd20: 6e74 3a0d 0a20 2020 2020 2020 2020 2020  nt:..           
+0000cd30: 2020 2020 2073 656c 662e 6869 7374 6f72       self.histor
+0000cd40: 795f 6669 6c65 2e52 656d 6f76 6546 696c  y_file.RemoveFil
+0000cd50: 6546 726f 6d48 6973 746f 7279 2830 290d  eFromHistory(0).
+0000cd60: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000cd70: 662e 6462 5f66 696c 656e 616d 6573 2e63  f.db_filenames.c
+0000cd80: 6c65 6172 2829 0d0a 2020 2020 2020 2020  lear()..        
+0000cd90: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+0000cda0: 2020 2073 656c 6563 7465 6473 203d 2072     selecteds = r
+0000cdb0: 616e 6765 2831 2c20 7365 6c66 2e6c 6973  ange(1, self.lis
+0000cdc0: 745f 6462 2e47 6574 4974 656d 436f 756e  t_db.GetItemCoun
+0000cdd0: 7428 2929 0d0a 2020 2020 2020 2020 2020  t())..          
+0000cde0: 2020 6669 6c65 6e61 6d65 7320 3d20 6c69    filenames = li
+0000cdf0: 7374 286d 6170 2873 656c 662e 6c69 7374  st(map(self.list
+0000ce00: 5f64 622e 4765 7449 7465 6d54 6578 742c  _db.GetItemText,
+0000ce10: 2073 656c 6563 7465 6473 2929 0d0a 2020   selecteds))..  
+0000ce20: 2020 2020 2020 2020 2020 7365 6c66 2e72            self.r
+0000ce30: 656d 6f76 655f 6461 7461 6261 7365 7328  emove_databases(
+0000ce40: 6669 6c65 6e61 6d65 7329 0d0a 0d0a 2020  filenames)....  
+0000ce50: 2020 2020 2020 7574 696c 2e72 756e 5f6f        util.run_o
+0000ce60: 6e63 6528 636f 6e66 2e73 6176 6529 0d0a  nce(conf.save)..
+0000ce70: 2020 2020 2020 2020 7365 6c66 2e75 7064          self.upd
+0000ce80: 6174 655f 6461 7461 6261 7365 5f6c 6973  ate_database_lis
+0000ce90: 7428 290d 0a20 2020 2020 2020 2067 7569  t()..        gui
+0000cea0: 6261 7365 2e73 7461 7475 7328 2252 656d  base.status("Rem
+0000ceb0: 6f76 6564 2025 7320 6672 6f6d 2064 6174  oved %s from dat
+0000cec0: 6162 6173 6520 6c69 7374 2e22 2c20 7574  abase list.", ut
+0000ced0: 696c 2e70 6c75 7261 6c28 2264 6174 6162  il.plural("datab
+0000cee0: 6173 6522 2c20 636f 756e 7429 290d 0a0d  ase", count))...
+0000cef0: 0a0d 0a20 2020 2064 6566 206f 6e5f 7265  ...    def on_re
+0000cf00: 6d6f 7665 5f64 6174 6162 6173 6528 7365  move_database(se
+0000cf10: 6c66 2c20 6576 656e 7429 3a0d 0a20 2020  lf, event):..   
+0000cf20: 2020 2020 2022 2222 4861 6e64 6c65 7220       """Handler 
+0000cf30: 666f 7220 636c 6963 6b69 6e67 2074 6f20  for clicking to 
+0000cf40: 7265 6d6f 7665 2061 6e20 6974 656d 2066  remove an item f
+0000cf50: 726f 6d20 7468 6520 6461 7461 6261 7365  rom the database
+0000cf60: 206c 6973 742e 2222 220d 0a20 2020 2020   list."""..     
+0000cf70: 2020 2066 696c 656e 616d 6520 3d20 7365     filename = se
+0000cf80: 6c66 2e64 625f 6669 6c65 6e61 6d65 0d0a  lf.db_filename..
+0000cf90: 2020 2020 2020 2020 6966 206e 6f74 2066          if not f
+0000cfa0: 696c 656e 616d 6520 6f72 2077 782e 4f4b  ilename or wx.OK
+0000cfb0: 2021 3d20 7778 2e4d 6573 7361 6765 426f   != wx.MessageBo
+0000cfc0: 7828 0d0a 2020 2020 2020 2020 2020 2020  x(..            
+0000cfd0: 2252 656d 6f76 6520 2573 2066 726f 6d20  "Remove %s from 
+0000cfe0: 6461 7461 6261 7365 206c 6973 743f 2220  database list?" 
+0000cff0: 2520 6669 6c65 6e61 6d65 2c0d 0a20 2020  % filename,..   
+0000d000: 2020 2020 2020 2020 2063 6f6e 662e 5469           conf.Ti
+0000d010: 746c 652c 2077 782e 4f4b 207c 2077 782e  tle, wx.OK | wx.
+0000d020: 4341 4e43 454c 207c 2077 782e 4943 4f4e  CANCEL | wx.ICON
+0000d030: 5f51 5545 5354 494f 4e0d 0a20 2020 2020  _QUESTION..     
+0000d040: 2020 2029 3a20 7265 7475 726e 0d0a 0d0a     ): return....
+0000d050: 2020 2020 2020 2020 7365 6c66 2e72 656d          self.rem
+0000d060: 6f76 655f 6461 7461 6261 7365 7328 5b66  ove_databases([f
+0000d070: 696c 656e 616d 655d 290d 0a20 2020 2020  ilename])..     
+0000d080: 2020 2073 656c 662e 6462 5f66 696c 656e     self.db_filen
+0000d090: 616d 6520 3d20 4e6f 6e65 0d0a 2020 2020  ame = None..    
+0000d0a0: 2020 2020 7365 6c66 2e6c 6973 745f 6462      self.list_db
+0000d0b0: 2e53 656c 6563 7428 3029 0d0a 2020 2020  .Select(0)..    
+0000d0c0: 2020 2020 7365 6c66 2e70 616e 656c 5f64      self.panel_d
+0000d0d0: 625f 6d61 696e 2e4c 6179 6f75 7428 290d  b_main.Layout().
+0000d0e0: 0a20 2020 2020 2020 2075 7469 6c2e 7275  .        util.ru
+0000d0f0: 6e5f 6f6e 6365 2863 6f6e 662e 7361 7665  n_once(conf.save
+0000d100: 290d 0a0d 0a0d 0a20 2020 2064 6566 206f  )......    def o
+0000d110: 6e5f 7265 6d6f 7665 5f6d 6973 7369 6e67  n_remove_missing
+0000d120: 2873 656c 662c 2065 7665 6e74 293a 0d0a  (self, event):..
+0000d130: 2020 2020 2020 2020 2222 2248 616e 646c          """Handl
+0000d140: 6572 2074 6f20 7265 6d6f 7665 206e 6f6e  er to remove non
+0000d150: 6578 6973 7465 6e74 2066 696c 6573 2066  existent files f
+0000d160: 726f 6d20 7468 6520 6461 7461 6261 7365  rom the database
+0000d170: 206c 6973 742e 2222 220d 0a20 2020 2020   list."""..     
+0000d180: 2020 2073 656c 6563 7465 6473 203d 2072     selecteds = r
+0000d190: 616e 6765 2831 2c20 7365 6c66 2e6c 6973  ange(1, self.lis
+0000d1a0: 745f 6462 2e47 6574 4974 656d 436f 756e  t_db.GetItemCoun
+0000d1b0: 7428 2929 0d0a 2020 2020 2020 2020 6669  t())..        fi
+0000d1c0: 6c74 6572 5f66 756e 6320 3d20 6c61 6d62  lter_func = lamb
+0000d1d0: 6461 2069 3a20 6e6f 7420 6f73 2e70 6174  da i: not os.pat
+0000d1e0: 682e 6578 6973 7473 2873 656c 662e 6c69  h.exists(self.li
+0000d1f0: 7374 5f64 622e 4765 7449 7465 6d54 6578  st_db.GetItemTex
+0000d200: 7428 6929 290d 0a20 2020 2020 2020 2073  t(i))..        s
+0000d210: 656c 6563 7465 6473 203d 206c 6973 7428  electeds = list(
+0000d220: 6669 6c74 6572 2866 696c 7465 725f 6675  filter(filter_fu
+0000d230: 6e63 2c20 7365 6c65 6374 6564 7329 290d  nc, selecteds)).
+0000d240: 0a20 2020 2020 2020 2066 696c 656e 616d  .        filenam
+0000d250: 6573 203d 206c 6973 7428 6d61 7028 7365  es = list(map(se
+0000d260: 6c66 2e6c 6973 745f 6462 2e47 6574 4974  lf.list_db.GetIt
+0000d270: 656d 5465 7874 2c20 7365 6c65 6374 6564  emText, selected
+0000d280: 7329 290d 0a20 2020 2020 2020 2069 6620  s))..        if 
+0000d290: 6e6f 7420 6669 6c65 6e61 6d65 733a 2072  not filenames: r
+0000d2a0: 6574 7572 6e0d 0a0d 0a20 2020 2020 2020  eturn....       
+0000d2b0: 2073 656c 662e 7265 6d6f 7665 5f64 6174   self.remove_dat
+0000d2c0: 6162 6173 6573 2866 696c 656e 616d 6573  abases(filenames
+0000d2d0: 290d 0a20 2020 2020 2020 2075 7469 6c2e  )..        util.
+0000d2e0: 7275 6e5f 6f6e 6365 2863 6f6e 662e 7361  run_once(conf.sa
+0000d2f0: 7665 290d 0a20 2020 2020 2020 2067 7569  ve)..        gui
+0000d300: 6261 7365 2e73 7461 7475 7328 2252 656d  base.status("Rem
+0000d310: 6f76 6564 2025 7320 6672 6f6d 2064 6174  oved %s from dat
+0000d320: 6162 6173 6520 6c69 7374 2e22 2c0d 0a20  abase list.",.. 
+0000d330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d340: 2020 2020 2020 7574 696c 2e70 6c75 7261        util.plura
+0000d350: 6c28 226e 6f6e 2d65 7869 7374 696e 6720  l("non-existing 
+0000d360: 6669 6c65 222c 2066 696c 656e 616d 6573  file", filenames
+0000d370: 2929 0d0a 0d0a 0d0a 2020 2020 6465 6620  ))......    def 
+0000d380: 6f6e 5f72 656d 6f76 655f 7479 7065 2873  on_remove_type(s
+0000d390: 656c 662c 2065 7665 6e74 2c20 6f74 6865  elf, event, othe
+0000d3a0: 723d 5472 7565 293a 0d0a 2020 2020 2020  r=True):..      
+0000d3b0: 2020 2222 2248 616e 646c 6572 2066 6f72    """Handler for
+0000d3c0: 2074 7970 6520 7365 6c65 6374 696f 6e20   type selection 
+0000d3d0: 746f 2072 656d 6f76 6520 6669 6c65 7320  to remove files 
+0000d3e0: 6672 6f6d 2074 6865 2064 6174 6162 6173  from the databas
+0000d3f0: 6520 6c69 7374 2e22 2222 0d0a 2020 2020  e list."""..    
+0000d400: 2020 2020 7365 6c65 6374 6564 7320 3d20      selecteds = 
+0000d410: 7261 6e67 6528 312c 2073 656c 662e 6c69  range(1, self.li
+0000d420: 7374 5f64 622e 4765 7449 7465 6d43 6f75  st_db.GetItemCou
+0000d430: 6e74 2829 290d 0a20 2020 2020 2020 2066  nt())..        f
+0000d440: 696c 7465 725f 6675 6e63 203d 206c 616d  ilter_func = lam
+0000d450: 6264 6120 693a 2028 0d0a 2020 2020 2020  bda i: (..      
+0000d460: 2020 2020 6f74 6865 7220 5e20 736b 7970      other ^ skyp
+0000d470: 6564 6174 612e 6973 5f73 6b79 7065 5f64  edata.is_skype_d
+0000d480: 6174 6162 6173 6528 7365 6c66 2e6c 6973  atabase(self.lis
+0000d490: 745f 6462 2e47 6574 4974 656d 5465 7874  t_db.GetItemText
+0000d4a0: 2869 292c 206c 6f67 5f65 7272 6f72 3d46  (i), log_error=F
+0000d4b0: 616c 7365 2929 0d0a 2020 2020 2020 2020  alse))..        
+0000d4c0: 7365 6c65 6374 6564 7320 3d20 6c69 7374  selecteds = list
+0000d4d0: 2866 696c 7465 7228 6669 6c74 6572 5f66  (filter(filter_f
+0000d4e0: 756e 632c 2073 656c 6563 7465 6473 2929  unc, selecteds))
+0000d4f0: 0d0a 2020 2020 2020 2020 6669 6c65 6e61  ..        filena
+0000d500: 6d65 7320 3d20 6c69 7374 286d 6170 2873  mes = list(map(s
+0000d510: 656c 662e 6c69 7374 5f64 622e 4765 7449  elf.list_db.GetI
+0000d520: 7465 6d54 6578 742c 2073 656c 6563 7465  temText, selecte
+0000d530: 6473 2929 0d0a 2020 2020 2020 2020 6966  ds))..        if
+0000d540: 206e 6f74 2066 696c 656e 616d 6573 3a20   not filenames: 
+0000d550: 7265 7475 726e 0d0a 0d0a 2020 2020 2020  return....      
+0000d560: 2020 7365 6c66 2e72 656d 6f76 655f 6461    self.remove_da
+0000d570: 7461 6261 7365 7328 6669 6c65 6e61 6d65  tabases(filename
+0000d580: 7329 0d0a 2020 2020 2020 2020 7574 696c  s)..        util
+0000d590: 2e72 756e 5f6f 6e63 6528 636f 6e66 2e73  .run_once(conf.s
+0000d5a0: 6176 6529 0d0a 2020 2020 2020 2020 7420  ave)..        t 
+0000d5b0: 3d20 7574 696c 2e70 6c75 7261 6c28 2225  = util.plural("%
+0000d5c0: 7353 6b79 7065 2064 6174 6162 6173 6522  sSkype database"
+0000d5d0: 2025 2028 226e 6f6e 2d22 2069 6620 6f74   % ("non-" if ot
+0000d5e0: 6865 7220 656c 7365 2022 2229 2c20 6669  her else ""), fi
+0000d5f0: 6c65 6e61 6d65 7329 0d0a 2020 2020 2020  lenames)..      
+0000d600: 2020 6775 6962 6173 652e 7374 6174 7573    guibase.status
+0000d610: 2822 5265 6d6f 7665 6420 2573 2066 726f  ("Removed %s fro
+0000d620: 6d20 6461 7461 6261 7365 206c 6973 742e  m database list.
+0000d630: 222c 2074 290d 0a0d 0a0d 0a20 2020 2064  ", t)......    d
+0000d640: 6566 206f 6e5f 6465 6c65 7465 5f64 6174  ef on_delete_dat
+0000d650: 6162 6173 6528 7365 6c66 2c20 6576 656e  abase(self, even
+0000d660: 7429 3a0d 0a20 2020 2020 2020 2022 2222  t):..        """
+0000d670: 4861 6e64 6c65 7220 666f 7220 636c 6963  Handler for clic
+0000d680: 6b69 6e67 2074 6f20 6465 6c65 7465 2061  king to delete a
+0000d690: 2064 6174 6162 6173 652e 2222 220d 0a20   database.""".. 
+0000d6a0: 2020 2020 2020 2066 696c 656e 616d 6520         filename 
+0000d6b0: 3d20 7365 6c66 2e64 625f 6669 6c65 6e61  = self.db_filena
+0000d6c0: 6d65 0d0a 2020 2020 2020 2020 6966 206e  me..        if n
+0000d6d0: 6f74 2066 696c 656e 616d 6520 6f72 2077  ot filename or w
+0000d6e0: 782e 4f4b 2021 3d20 7778 2e4d 6573 7361  x.OK != wx.Messa
+0000d6f0: 6765 426f 7828 0d0a 2020 2020 2020 2020  geBox(..        
+0000d700: 2020 2020 2244 656c 6574 6520 2573 2066      "Delete %s f
+0000d710: 726f 6d20 6469 736b 3f22 2025 2066 696c  rom disk?" % fil
+0000d720: 656e 616d 652c 0d0a 2020 2020 2020 2020  ename,..        
+0000d730: 2020 2020 636f 6e66 2e54 6974 6c65 2c20      conf.Title, 
+0000d740: 7778 2e4f 4b20 7c20 7778 2e43 414e 4345  wx.OK | wx.CANCE
+0000d750: 4c20 7c20 7778 2e49 434f 4e5f 5155 4553  L | wx.ICON_QUES
+0000d760: 5449 4f4e 0d0a 2020 2020 2020 2020 293a  TION..        ):
+0000d770: 2072 6574 7572 6e0d 0a0d 0a20 2020 2020   return....     
+0000d780: 2020 2069 6620 6669 6c65 6e61 6d65 2069     if filename i
+0000d790: 6e20 7365 6c66 2e64 6273 3a0d 0a20 2020  n self.dbs:..   
+0000d7a0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0000d7b0: 7778 2e4d 6573 7361 6765 426f 7828 2225  wx.MessageBox("%
+0000d7c0: 7320 6973 2063 7572 7265 6e74 6c79 206f  s is currently o
+0000d7d0: 7065 6e20 696e 2025 732c 2063 616e 6e6f  pen in %s, canno
+0000d7e0: 7420 6465 6c65 7465 2e22 2025 0d0a 2020  t delete." %..  
+0000d7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d800: 2020 2020 2020 2020 2020 2020 2020 2028                 (
+0000d810: 6669 6c65 6e61 6d65 2c20 636f 6e66 2e54  filename, conf.T
+0000d820: 6974 6c65 292c 2063 6f6e 662e 5469 746c  itle), conf.Titl
+0000d830: 652c 2077 782e 4f4b 290d 0a20 2020 2020  e, wx.OK)..     
+0000d840: 2020 2069 6620 6669 6c65 6e61 6d65 2069     if filename i
+0000d850: 6e20 7365 6c66 2e77 6f72 6b65 7273 5f69  n self.workers_i
+0000d860: 6d70 6f72 743a 0d0a 2020 2020 2020 2020  mport:..        
+0000d870: 2020 2020 7265 7475 726e 2077 782e 4d65      return wx.Me
+0000d880: 7373 6167 6542 6f78 2822 2573 2069 7320  ssageBox("%s is 
+0000d890: 6375 7272 656e 746c 7920 6265 696e 6720  currently being 
+0000d8a0: 696d 706f 7274 6564 2074 6f2c 2063 616e  imported to, can
+0000d8b0: 6e6f 7420 6465 6c65 7465 2e22 2025 0d0a  not delete." %..
+0000d8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d8e0: 2066 696c 656e 616d 652c 2063 6f6e 662e   filename, conf.
+0000d8f0: 5469 746c 652c 2077 782e 4f4b 207c 2077  Title, wx.OK | w
+0000d900: 782e 4943 4f4e 5f57 4152 4e49 4e47 290d  x.ICON_WARNING).
+0000d910: 0a0d 0a20 2020 2020 2020 2074 7279 3a20  ...        try: 
+0000d920: 6f73 2e75 6e6c 696e 6b28 6669 6c65 6e61  os.unlink(filena
+0000d930: 6d65 290d 0a20 2020 2020 2020 2065 7863  me)..        exc
+0000d940: 6570 7420 4578 6365 7074 696f 6e20 6173  ept Exception as
+0000d950: 2065 3a0d 0a20 2020 2020 2020 2020 2020   e:..           
+0000d960: 206c 6f67 6765 722e 6578 6365 7074 696f   logger.exceptio
+0000d970: 6e28 2245 7272 6f72 2064 656c 6574 696e  n("Error deletin
+0000d980: 6720 2573 2e22 2c20 6669 6c65 6e61 6d65  g %s.", filename
+0000d990: 290d 0a20 2020 2020 2020 2020 2020 2072  )..            r
+0000d9a0: 6574 7572 6e20 7778 2e4d 6573 7361 6765  eturn wx.Message
+0000d9b0: 426f 7828 2246 6169 6c65 6420 746f 2064  Box("Failed to d
+0000d9c0: 656c 6574 6520 2573 3a5c 6e5c 6e25 7322  elete %s:\n\n%s"
+0000d9d0: 2025 0d0a 2020 2020 2020 2020 2020 2020   %..            
+0000d9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d9f0: 2020 2020 2028 6669 6c65 6e61 6d65 2c20       (filename, 
+0000da00: 7574 696c 2e66 6f72 6d61 745f 6578 6328  util.format_exc(
+0000da10: 6529 292c 0d0a 2020 2020 2020 2020 2020  e)),..          
+0000da20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000da30: 2020 2020 2020 2063 6f6e 662e 5469 746c         conf.Titl
+0000da40: 652c 2077 782e 4f4b 207c 2077 782e 4943  e, wx.OK | wx.IC
+0000da50: 4f4e 5f45 5252 4f52 290d 0a20 2020 2020  ON_ERROR)..     
+0000da60: 2020 2073 656c 662e 7265 6d6f 7665 5f64     self.remove_d
+0000da70: 6174 6162 6173 6573 285b 6669 6c65 6e61  atabases([filena
+0000da80: 6d65 5d29 0d0a 2020 2020 2020 2020 7365  me])..        se
+0000da90: 6c66 2e64 625f 6669 6c65 6e61 6d65 203d  lf.db_filename =
+0000daa0: 204e 6f6e 650d 0a20 2020 2020 2020 2073   None..        s
+0000dab0: 656c 662e 6c69 7374 5f64 622e 5365 6c65  elf.list_db.Sele
+0000dac0: 6374 2830 290d 0a20 2020 2020 2020 2073  ct(0)..        s
+0000dad0: 656c 662e 7061 6e65 6c5f 6462 5f6d 6169  elf.panel_db_mai
+0000dae0: 6e2e 4c61 796f 7574 2829 0d0a 2020 2020  n.Layout()..    
+0000daf0: 2020 2020 7574 696c 2e72 756e 5f6f 6e63      util.run_onc
+0000db00: 6528 636f 6e66 2e73 6176 6529 0d0a 0d0a  e(conf.save)....
+0000db10: 0d0a 2020 2020 6465 6620 7265 6d6f 7665  ..    def remove
+0000db20: 5f64 6174 6162 6173 6573 2873 656c 662c  _databases(self,
+0000db30: 2066 696c 656e 616d 6573 293a 0d0a 2020   filenames):..  
+0000db40: 2020 2020 2020 2222 2252 656d 6f76 6573        """Removes
+0000db50: 2067 6976 656e 2066 696c 6520 6672 6f6d   given file from
+0000db60: 2064 6174 6162 6173 6520 6c69 7374 2061   database list a
+0000db70: 6e64 2061 6c6c 2064 6174 6120 7374 7275  nd all data stru
+0000db80: 6374 7572 6573 2e22 2222 0d0a 2020 2020  ctures."""..    
+0000db90: 2020 2020 666f 7220 6669 6c65 6e61 6d65      for filename
+0000dba0: 2069 6e20 6669 6c65 6e61 6d65 733a 0d0a   in filenames:..
+0000dbb0: 2020 2020 2020 2020 2020 2020 6964 7820              idx 
+0000dbc0: 3d20 7365 6c66 2e6c 6973 745f 6462 2e46  = self.list_db.F
+0000dbd0: 696e 6449 7465 6d28 6669 6c65 6e61 6d65  indItem(filename
+0000dbe0: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
+0000dbf0: 6620 6964 7820 3e20 303a 2073 656c 662e  f idx > 0: self.
+0000dc00: 6c69 7374 5f64 622e 4465 6c65 7465 4974  list_db.DeleteIt
+0000dc10: 656d 2869 6478 290d 0a20 2020 2020 2020  em(idx)..       
+0000dc20: 2020 2020 2066 6f72 206c 7374 2069 6e20       for lst in 
+0000dc30: 636f 6e66 2e44 4246 696c 6573 2c20 636f  conf.DBFiles, co
+0000dc40: 6e66 2e52 6563 656e 7446 696c 6573 2c20  nf.RecentFiles, 
+0000dc50: 636f 6e66 2e4c 6173 7453 656c 6563 7465  conf.LastSelecte
+0000dc60: 6446 696c 6573 3a0d 0a20 2020 2020 2020  dFiles:..       
+0000dc70: 2020 2020 2020 2020 2069 6620 6669 6c65           if file
+0000dc80: 6e61 6d65 2069 6e20 6c73 743a 206c 7374  name in lst: lst
+0000dc90: 2e72 656d 6f76 6528 6669 6c65 6e61 6d65  .remove(filename
+0000dca0: 290d 0a20 2020 2020 2020 2020 2020 2066  )..            f
+0000dcb0: 6f72 2064 6374 2069 6e20 636f 6e66 2e4c  or dct in conf.L
+0000dcc0: 6173 7453 6561 7263 6852 6573 756c 7473  astSearchResults
+0000dcd0: 2c20 7365 6c66 2e64 625f 6669 6c65 6e61  , self.db_filena
+0000dce0: 6d65 733a 0d0a 2020 2020 2020 2020 2020  mes:..          
+0000dcf0: 2020 2020 2020 6463 742e 706f 7028 6669        dct.pop(fi
+0000dd00: 6c65 6e61 6d65 2c20 4e6f 6e65 290d 0a20  lename, None).. 
+0000dd10: 2020 2020 2020 2020 2020 2063 6f6e 662e             conf.
+0000dd20: 4c6f 6769 6e2e 706f 7028 6669 6c65 6e61  Login.pop(filena
+0000dd30: 6d65 2c20 4e6f 6e65 290d 0a0d 0a20 2020  me, None)....   
+0000dd40: 2020 2020 2023 2052 656d 6f76 6520 6672       # Remove fr
+0000dd50: 6f6d 2072 6563 656e 7420 6669 6c65 2068  om recent file h
+0000dd60: 6973 746f 7279 0d0a 2020 2020 2020 2020  istory..        
+0000dd70: 6869 7374 6f72 7966 696c 6573 203d 205b  historyfiles = [
+0000dd80: 2869 2c20 7365 6c66 2e68 6973 746f 7279  (i, self.history
+0000dd90: 5f66 696c 652e 4765 7448 6973 746f 7279  _file.GetHistory
+0000dda0: 4669 6c65 2869 2929 0d0a 2020 2020 2020  File(i))..      
+0000ddb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ddc0: 2020 666f 7220 6920 696e 2072 616e 6765    for i in range
+0000ddd0: 2873 656c 662e 6869 7374 6f72 795f 6669  (self.history_fi
+0000dde0: 6c65 2e43 6f75 6e74 295d 0d0a 2020 2020  le.Count)]..    
+0000ddf0: 2020 2020 666f 7220 692c 2066 2069 6e20      for i, f in 
+0000de00: 6869 7374 6f72 7966 696c 6573 5b3a 3a2d  historyfiles[::-
+0000de10: 315d 3a20 2320 576f 726b 2075 7077 6172  1]: # Work upwar
+0000de20: 6473 2074 6f20 6861 7665 2075 6e63 6861  ds to have uncha
+0000de30: 6e67 6564 2069 6e64 6578 0d0a 2020 2020  nged index..    
+0000de40: 2020 2020 2020 2020 6966 2066 2069 6e20          if f in 
+0000de50: 6669 6c65 6e61 6d65 733a 2073 656c 662e  filenames: self.
+0000de60: 6869 7374 6f72 795f 6669 6c65 2e52 656d  history_file.Rem
+0000de70: 6f76 6546 696c 6546 726f 6d48 6973 746f  oveFileFromHisto
+0000de80: 7279 2869 290d 0a20 2020 2020 2020 2073  ry(i)..        s
+0000de90: 656c 662e 7570 6461 7465 5f64 6174 6162  elf.update_datab
+0000dea0: 6173 655f 6c69 7374 2829 0d0a 0d0a 0d0a  ase_list()......
+0000deb0: 2020 2020 6465 6620 6f6e 5f73 6176 655f      def on_save_
+0000dec0: 6461 7461 6261 7365 5f61 7328 7365 6c66  database_as(self
+0000ded0: 2c20 6576 656e 7429 3a0d 0a20 2020 2020  , event):..     
+0000dee0: 2020 2022 2222 4861 6e64 6c65 7220 666f     """Handler fo
+0000def0: 7220 636c 6963 6b69 6e67 2074 6f20 7361  r clicking to sa
+0000df00: 7665 2061 2063 6f70 7920 6f66 2061 2064  ve a copy of a d
+0000df10: 6174 6162 6173 6520 696e 2074 6865 206c  atabase in the l
+0000df20: 6973 742e 2222 220d 0a20 2020 2020 2020  ist."""..       
+0000df30: 206f 7269 6769 6e61 6c20 3d20 7365 6c66   original = self
+0000df40: 2e64 625f 6669 6c65 6e61 6d65 0d0a 2020  .db_filename..  
+0000df50: 2020 2020 2020 6966 206e 6f74 206f 732e        if not os.
+0000df60: 7061 7468 2e65 7869 7374 7328 6f72 6967  path.exists(orig
+0000df70: 696e 616c 293a 0d0a 2020 2020 2020 2020  inal):..        
+0000df80: 2020 2020 7778 2e4d 6573 7361 6765 426f      wx.MessageBo
+0000df90: 7828 0d0a 2020 2020 2020 2020 2020 2020  x(..            
+0000dfa0: 2020 2020 2754 6865 2066 696c 6520 2225      'The file "%
+0000dfb0: 7322 2064 6f65 7320 6e6f 7420 6578 6973  s" does not exis
+0000dfc0: 7420 6f6e 2074 6869 7320 636f 6d70 7574  t on this comput
+0000dfd0: 6572 2e27 2025 206f 7269 6769 6e61 6c2c  er.' % original,
+0000dfe0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000dff0: 2020 636f 6e66 2e54 6974 6c65 2c20 7778    conf.Title, wx
+0000e000: 2e4f 4b20 7c20 7778 2e49 434f 4e5f 494e  .OK | wx.ICON_IN
+0000e010: 464f 524d 4154 494f 4e0d 0a20 2020 2020  FORMATION..     
+0000e020: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
+0000e030: 2020 2020 2020 7265 7475 726e 0d0a 0d0a        return....
+0000e040: 2020 2020 2020 2020 6966 206f 7269 6769          if origi
+0000e050: 6e61 6c20 696e 2073 656c 662e 776f 726b  nal in self.work
+0000e060: 6572 735f 696d 706f 7274 3a0d 0a20 2020  ers_import:..   
+0000e070: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0000e080: 7778 2e4d 6573 7361 6765 426f 7828 2225  wx.MessageBox("%
+0000e090: 7320 6973 2063 7572 7265 6e74 6c79 2062  s is currently b
+0000e0a0: 6569 6e67 2069 6d70 6f72 7465 6420 746f  eing imported to
+0000e0b0: 2c20 6361 6e6e 6f74 2073 6176 652e 2220  , cannot save." 
+0000e0c0: 250d 0a20 2020 2020 2020 2020 2020 2020  %..             
+0000e0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e0e0: 2020 2020 6f72 6967 696e 616c 2c20 636f      original, co
+0000e0f0: 6e66 2e54 6974 6c65 2c20 7778 2e4f 4b20  nf.Title, wx.OK 
+0000e100: 7c20 7778 2e49 434f 4e5f 5741 524e 494e  | wx.ICON_WARNIN
+0000e110: 4729 0d0a 0d0a 2020 2020 2020 2020 6469  G)....        di
+0000e120: 616c 6f67 203d 2077 782e 4669 6c65 4469  alog = wx.FileDi
+0000e130: 616c 6f67 2870 6172 656e 743d 7365 6c66  alog(parent=self
+0000e140: 2c20 6d65 7373 6167 653d 2253 6176 6520  , message="Save 
+0000e150: 6120 636f 7079 2e2e 222c 0d0a 2020 2020  a copy..",..    
+0000e160: 2020 2020 2020 2020 6465 6661 756c 7444          defaultD
+0000e170: 6972 3d6f 732e 7061 7468 2e64 6972 6e61  ir=os.path.dirna
+0000e180: 6d65 286f 7269 6769 6e61 6c29 2c0d 0a20  me(original),.. 
+0000e190: 2020 2020 2020 2020 2020 2064 6566 6175             defau
+0000e1a0: 6c74 4669 6c65 3d6f 732e 7061 7468 2e62  ltFile=os.path.b
+0000e1b0: 6173 656e 616d 6528 6f72 6967 696e 616c  asename(original
+0000e1c0: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
+0000e1d0: 7769 6c64 6361 7264 3d22 5351 4c69 7465  wildcard="SQLite
+0000e1e0: 2064 6174 6162 6173 6520 282a 2e64 6229   database (*.db)
+0000e1f0: 7c2a 2e64 627c 416c 6c20 6669 6c65 737c  |*.db|All files|
+0000e200: 2a2e 2a22 2c0d 0a20 2020 2020 2020 2020  *.*",..         
+0000e210: 2020 2073 7479 6c65 3d77 782e 4644 5f4f     style=wx.FD_O
+0000e220: 5645 5257 5249 5445 5f50 524f 4d50 5420  VERWRITE_PROMPT 
+0000e230: 7c20 7778 2e46 445f 5341 5645 207c 2077  | wx.FD_SAVE | w
+0000e240: 782e 5245 5349 5a45 5f42 4f52 4445 520d  x.RESIZE_BORDER.
+0000e250: 0a20 2020 2020 2020 2029 0d0a 2020 2020  .        )..    
+0000e260: 2020 2020 6966 2077 782e 4944 5f4f 4b20      if wx.ID_OK 
+0000e270: 213d 2064 6961 6c6f 672e 5368 6f77 4d6f  != dialog.ShowMo
+0000e280: 6461 6c28 293a 2072 6574 7572 6e0d 0a0d  dal(): return...
+0000e290: 0a20 2020 2020 2020 2077 782e 5969 656c  .        wx.Yiel
+0000e2a0: 6449 664e 6565 6465 6428 2920 2320 416c  dIfNeeded() # Al
+0000e2b0: 6c6f 7720 5549 2074 6f20 7265 6672 6573  low UI to refres
+0000e2c0: 680d 0a20 2020 2020 2020 206e 6577 7061  h..        newpa
+0000e2d0: 7468 203d 2063 6f6e 7472 6f6c 732e 6765  th = controls.ge
+0000e2e0: 745f 6469 616c 6f67 5f70 6174 6828 6469  t_dialog_path(di
+0000e2f0: 616c 6f67 290d 0a20 2020 2020 2020 2073  alog)..        s
+0000e300: 7563 6365 7373 203d 2046 616c 7365 0d0a  uccess = False..
+0000e310: 2020 2020 2020 2020 7472 793a 0d0a 2020          try:..  
+0000e320: 2020 2020 2020 2020 2020 7368 7574 696c            shutil
+0000e330: 2e63 6f70 7966 696c 6528 6f72 6967 696e  .copyfile(origin
+0000e340: 616c 2c20 6e65 7770 6174 6829 0d0a 2020  al, newpath)..  
+0000e350: 2020 2020 2020 2020 2020 7375 6363 6573            succes
+0000e360: 7320 3d20 5472 7565 0d0a 2020 2020 2020  s = True..      
+0000e370: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
+0000e380: 6f6e 2061 7320 653a 0d0a 2020 2020 2020  on as e:..      
+0000e390: 2020 2020 2020 6775 6962 6173 652e 7374        guibase.st
+0000e3a0: 6174 7573 2822 4572 726f 7220 7472 7969  atus("Error tryi
+0000e3b0: 6e67 2074 6f20 636f 7079 2025 7320 746f  ng to copy %s to
+0000e3c0: 2025 733a 2025 7322 2c0d 0a20 2020 2020   %s: %s",..     
+0000e3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e3e0: 2020 2020 2020 6f72 6967 696e 616c 2c20        original, 
+0000e3f0: 6e65 7770 6174 682c 2075 7469 6c2e 666f  newpath, util.fo
+0000e400: 726d 6174 5f65 7863 2865 2929 0d0a 2020  rmat_exc(e))..  
+0000e410: 2020 2020 2020 2020 2020 6c6f 6767 6572            logger
+0000e420: 2e65 7863 6570 7469 6f6e 2822 4572 726f  .exception("Erro
+0000e430: 7220 7472 7969 6e67 2074 6f20 636f 7079  r trying to copy
+0000e440: 2025 7320 746f 2025 732e 222c 206f 7269   %s to %s.", ori
+0000e450: 6769 6e61 6c2c 206e 6577 7061 7468 290d  ginal, newpath).
+0000e460: 0a20 2020 2020 2020 2020 2020 2077 782e  .            wx.
+0000e470: 4d65 7373 6167 6542 6f78 2827 4661 696c  MessageBox('Fail
+0000e480: 6564 2074 6f20 636f 7079 2022 2573 2220  ed to copy "%s" 
+0000e490: 746f 2022 2573 222e 2720 2520 286f 7269  to "%s".' % (ori
+0000e4a0: 6769 6e61 6c2c 206e 6577 7061 7468 292c  ginal, newpath),
+0000e4b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000e4c0: 2020 2020 2020 2020 2020 2020 636f 6e66              conf
+0000e4d0: 2e54 6974 6c65 2c20 7778 2e4f 4b20 7c20  .Title, wx.OK | 
+0000e4e0: 7778 2e49 434f 4e5f 5741 524e 494e 4729  wx.ICON_WARNING)
+0000e4f0: 0d0a 2020 2020 2020 2020 6966 2073 7563  ..        if suc
+0000e500: 6365 7373 3a0d 0a20 2020 2020 2020 2020  cess:..         
+0000e510: 2020 2067 7569 6261 7365 2e73 7461 7475     guibase.statu
+0000e520: 7328 2253 6176 6564 2061 2063 6f70 7920  s("Saved a copy 
+0000e530: 6f66 2025 7320 6173 2025 732e 222c 206f  of %s as %s.", o
+0000e540: 7269 6769 6e61 6c2c 206e 6577 7061 7468  riginal, newpath
+0000e550: 2c20 6c6f 673d 5472 7565 290d 0a20 2020  , log=True)..   
+0000e560: 2020 2020 2020 2020 2073 656c 662e 7570           self.up
+0000e570: 6461 7465 5f64 6174 6162 6173 655f 6c69  date_database_li
+0000e580: 7374 286e 6577 7061 7468 290d 0a20 2020  st(newpath)..   
+0000e590: 2020 2020 2020 2020 2066 6f72 206b 2069           for k i
+0000e5a0: 6e20 2822 4c61 7374 4163 7469 7665 5061  n ("LastActivePa
+0000e5b0: 6765 222c 2022 4c61 7374 5365 6172 6368  ge", "LastSearch
+0000e5c0: 5265 7375 6c74 7322 2c20 224c 6f67 696e  Results", "Login
+0000e5d0: 222c 2022 5351 4c57 696e 646f 7754 6578  ", "SQLWindowTex
+0000e5e0: 7473 2229 3a0d 0a20 2020 2020 2020 2020  ts"):..         
+0000e5f0: 2020 2020 2020 2064 6374 203d 2067 6574         dct = get
+0000e600: 6174 7472 2863 6f6e 662c 206b 2c20 7b7d  attr(conf, k, {}
+0000e610: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0000e620: 2020 2069 6620 6463 742e 6765 7428 6f72     if dct.get(or
+0000e630: 6967 696e 616c 293a 2064 6374 5b6e 6577  iginal): dct[new
+0000e640: 7061 7468 5d20 3d20 636f 7079 2e64 6565  path] = copy.dee
+0000e650: 7063 6f70 7928 6463 745b 6f72 6967 696e  pcopy(dct[origin
+0000e660: 616c 5d29 0d0a 2020 2020 2020 2020 2020  al])..          
+0000e670: 2020 6964 7820 3d20 7365 6c66 2e6c 6973    idx = self.lis
+0000e680: 745f 6462 2e46 696e 6449 7465 6d28 6e65  t_db.FindItem(ne
+0000e690: 7770 6174 6829 0d0a 2020 2020 2020 2020  wpath)..        
+0000e6a0: 2020 2020 6966 2069 6478 203e 2030 3a20      if idx > 0: 
+0000e6b0: 7365 6c66 2e6c 6973 745f 6462 2e53 656c  self.list_db.Sel
+0000e6c0: 6563 7428 6964 7829 0d0a 2020 2020 2020  ect(idx)..      
+0000e6d0: 2020 2020 2020 7574 696c 2e72 756e 5f6f        util.run_o
+0000e6e0: 6e63 6528 636f 6e66 2e73 6176 6529 0d0a  nce(conf.save)..
+0000e6f0: 0d0a 0d0a 2020 2020 6465 6620 6f6e 5f73  ....    def on_s
+0000e700: 686f 7768 6964 655f 6c6f 6728 7365 6c66  howhide_log(self
+0000e710: 2c20 6576 656e 7429 3a0d 0a20 2020 2020  , event):..     
+0000e720: 2020 2022 2222 4861 6e64 6c65 7220 666f     """Handler fo
+0000e730: 7220 636c 6963 6b69 6e67 2074 6f20 7368  r clicking to sh
+0000e740: 6f77 2f68 6964 6520 7468 6520 6c6f 6720  ow/hide the log 
+0000e750: 7769 6e64 6f77 2e22 2222 0d0a 2020 2020  window."""..    
+0000e760: 2020 2020 6966 2073 656c 662e 6e6f 7465      if self.note
+0000e770: 626f 6f6b 2e47 6574 5061 6765 496e 6465  book.GetPageInde
+0000e780: 7828 7365 6c66 2e70 6167 655f 6c6f 6729  x(self.page_log)
+0000e790: 203c 2030 3a0d 0a20 2020 2020 2020 2020   < 0:..         
+0000e7a0: 2020 2073 656c 662e 6e6f 7465 626f 6f6b     self.notebook
+0000e7b0: 2e41 6464 5061 6765 2873 656c 662e 7061  .AddPage(self.pa
+0000e7c0: 6765 5f6c 6f67 2c20 224c 6f67 2229 0d0a  ge_log, "Log")..
+0000e7d0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000e7e0: 2e70 6167 655f 6c6f 672e 6973 5f68 6964  .page_log.is_hid
+0000e7f0: 6465 6e20 3d20 4661 6c73 650d 0a20 2020  den = False..   
+0000e800: 2020 2020 2020 2020 2073 656c 662e 7061           self.pa
+0000e810: 6765 5f6c 6f67 2e53 686f 7728 290d 0a20  ge_log.Show().. 
+0000e820: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000e830: 6e6f 7465 626f 6f6b 2e53 6574 5365 6c65  notebook.SetSele
+0000e840: 6374 696f 6e28 7365 6c66 2e6e 6f74 6562  ction(self.noteb
+0000e850: 6f6f 6b2e 4765 7450 6167 6543 6f75 6e74  ook.GetPageCount
+0000e860: 2829 202d 2031 290d 0a20 2020 2020 2020  () - 1)..       
+0000e870: 2020 2020 2073 656c 662e 6f6e 5f63 6861       self.on_cha
+0000e880: 6e67 655f 7061 6765 284e 6f6e 6529 0d0a  nge_page(None)..
+0000e890: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000e8a0: 2e6d 656e 755f 6c6f 672e 4368 6563 6b28  .menu_log.Check(
+0000e8b0: 5472 7565 290d 0a20 2020 2020 2020 2065  True)..        e
+0000e8c0: 6c69 6620 6576 656e 7420 616e 6420 7365  lif event and se
+0000e8d0: 6c66 2e6e 6f74 6562 6f6f 6b2e 4765 7450  lf.notebook.GetP
+0000e8e0: 6167 6549 6e64 6578 2873 656c 662e 7061  ageIndex(self.pa
+0000e8f0: 6765 5f6c 6f67 2920 213d 2073 656c 662e  ge_log) != self.
+0000e900: 6e6f 7465 626f 6f6b 2e47 6574 5365 6c65  notebook.GetSele
+0000e910: 6374 696f 6e28 293a 0d0a 2020 2020 2020  ction():..      
+0000e920: 2020 2020 2020 7365 6c66 2e6e 6f74 6562        self.noteb
+0000e930: 6f6f 6b2e 5365 7453 656c 6563 7469 6f6e  ook.SetSelection
+0000e940: 2873 656c 662e 6e6f 7465 626f 6f6b 2e47  (self.notebook.G
+0000e950: 6574 5061 6765 436f 756e 7428 2920 2d20  etPageCount() - 
+0000e960: 3129 0d0a 2020 2020 2020 2020 2020 2020  1)..            
+0000e970: 7365 6c66 2e6f 6e5f 6368 616e 6765 5f70  self.on_change_p
+0000e980: 6167 6528 4e6f 6e65 290d 0a20 2020 2020  age(None)..     
+0000e990: 2020 2020 2020 2073 656c 662e 6d65 6e75         self.menu
+0000e9a0: 5f6c 6f67 2e43 6865 636b 2854 7275 6529  _log.Check(True)
+0000e9b0: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
+0000e9c0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000e9d0: 662e 7061 6765 5f6c 6f67 2e69 735f 6869  f.page_log.is_hi
+0000e9e0: 6464 656e 203d 2054 7275 650d 0a20 2020  dden = True..   
+0000e9f0: 2020 2020 2020 2020 2073 656c 662e 6e6f           self.no
+0000ea00: 7465 626f 6f6b 2e52 656d 6f76 6550 6167  tebook.RemovePag
+0000ea10: 6528 7365 6c66 2e6e 6f74 6562 6f6f 6b2e  e(self.notebook.
+0000ea20: 4765 7450 6167 6549 6e64 6578 2873 656c  GetPageIndex(sel
+0000ea30: 662e 7061 6765 5f6c 6f67 2929 0d0a 2020  f.page_log))..  
+0000ea40: 2020 2020 2020 2020 2020 7365 6c66 2e6d            self.m
+0000ea50: 656e 755f 6c6f 672e 4368 6563 6b28 4661  enu_log.Check(Fa
+0000ea60: 6c73 6529 0d0a 0d0a 0d0a 2020 2020 6465  lse)......    de
+0000ea70: 6620 6f6e 5f65 7870 6f72 745f 6461 7461  f on_export_data
+0000ea80: 6261 7365 5f6d 656e 7528 7365 6c66 2c20  base_menu(self, 
+0000ea90: 6576 656e 7429 3a0d 0a20 2020 2020 2020  event):..       
+0000eaa0: 2069 6620 6e6f 7420 6578 706f 7274 2e78   if not export.x
+0000eab0: 6c73 7877 7269 7465 723a 0d0a 2020 2020  lsxwriter:..    
+0000eac0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0000ead0: 656c 662e 6f6e 5f65 7870 6f72 745f 6461  elf.on_export_da
+0000eae0: 7461 6261 7365 284e 6f6e 6529 0d0a 0d0a  tabase(None)....
+0000eaf0: 2020 2020 2020 2020 6d65 6e75 203d 2077          menu = w
+0000eb00: 782e 6c69 622e 6167 772e 666c 6174 6d65  x.lib.agw.flatme
+0000eb10: 6e75 2e46 6c61 744d 656e 7528 290d 0a20  nu.FlatMenu().. 
+0000eb20: 2020 2020 2020 2069 7465 6d5f 7365 6c20         item_sel 
+0000eb30: 3d20 7778 2e6c 6962 2e61 6777 2e66 6c61  = wx.lib.agw.fla
+0000eb40: 746d 656e 752e 466c 6174 4d65 6e75 4974  tmenu.FlatMenuIt
+0000eb50: 656d 286d 656e 752c 2077 782e 4944 5f41  em(menu, wx.ID_A
+0000eb60: 4e59 2c20 2245 7870 6f72 7420 220d 0a20  NY, "Export ".. 
+0000eb70: 2020 2020 2020 2020 2020 2022 696e 746f             "into
+0000eb80: 2073 6570 6172 6174 6520 2666 696c 6573   separate &files
+0000eb90: 2069 6e20 6f6e 6520 666f 6c64 6572 2028   in one folder (
+0000eba0: 4854 4d4c 2c20 7465 7874 2c20 4578 6365  HTML, text, Exce
+0000ebb0: 6c2c 206f 7220 4353 5629 2229 0d0a 2020  l, or CSV)")..  
+0000ebc0: 2020 2020 2020 6d65 6e75 2e41 7070 656e        menu.Appen
+0000ebd0: 6449 7465 6d28 6974 656d 5f73 656c 290d  dItem(item_sel).
+0000ebe0: 0a20 2020 2020 2020 2069 7465 6d5f 616c  .        item_al
+0000ebf0: 6c20 3d20 7778 2e6c 6962 2e61 6777 2e66  l = wx.lib.agw.f
+0000ec00: 6c61 746d 656e 752e 466c 6174 4d65 6e75  latmenu.FlatMenu
+0000ec10: 4974 656d 286d 656e 752c 2077 782e 4944  Item(menu, wx.ID
+0000ec20: 5f41 4e59 2c0d 0a20 2020 2020 2020 2020  _ANY,..         
+0000ec30: 2020 206c 6162 656c 3d22 4578 706f 7274     label="Export
+0000ec40: 2069 6e74 6f20 6120 7369 6e67 6c65 2026   into a single &
+0000ec50: 4578 6365 6c20 776f 726b 626f 6f6b 2c20  Excel workbook, 
+0000ec60: 7769 7468 2073 6570 6172 6174 6520 7368  with separate sh
+0000ec70: 6565 7473 2229 0d0a 2020 2020 2020 2020  eets")..        
+0000ec80: 6d65 6e75 2e41 7070 656e 6449 7465 6d28  menu.AppendItem(
+0000ec90: 6974 656d 5f61 6c6c 290d 0a20 2020 2020  item_all)..     
+0000eca0: 2020 2066 6f72 2069 7465 6d20 696e 206d     for item in m
+0000ecb0: 656e 752e 4765 744d 656e 7549 7465 6d73  enu.GetMenuItems
+0000ecc0: 2829 3a0d 0a20 2020 2020 2020 2020 2020  ():..           
+0000ecd0: 2073 656c 662e 4269 6e64 2877 782e 4556   self.Bind(wx.EV
+0000ece0: 545f 4d45 4e55 2c20 7365 6c66 2e6f 6e5f  T_MENU, self.on_
+0000ecf0: 6578 706f 7274 5f64 6174 6162 6173 652c  export_database,
+0000ed00: 2069 7465 6d29 0d0a 0d0a 2020 2020 2020   item)....      
+0000ed10: 2020 6274 6e20 3d20 7365 6c66 2e62 7574    btn = self.but
+0000ed20: 746f 6e5f 6578 706f 7274 0d0a 2020 2020  ton_export..    
+0000ed30: 2020 2020 737a 5f62 746e 2c20 7074 5f62      sz_btn, pt_b
+0000ed40: 746e 203d 2062 746e 2e53 697a 652c 2062  tn = btn.Size, b
+0000ed50: 746e 2e50 6f73 6974 696f 6e0d 0a20 2020  tn.Position..   
+0000ed60: 2020 2020 2070 745f 6274 6e20 3d20 6274       pt_btn = bt
+0000ed70: 6e2e 5061 7265 6e74 2e43 6c69 656e 7454  n.Parent.ClientT
+0000ed80: 6f53 6372 6565 6e28 7074 5f62 746e 290d  oScreen(pt_btn).
+0000ed90: 0a20 2020 2020 2020 206d 656e 752e 5365  .        menu.Se
+0000eda0: 744f 776e 6572 4865 6967 6874 2873 7a5f  tOwnerHeight(sz_
+0000edb0: 6274 6e2e 7929 0d0a 2020 2020 2020 2020  btn.y)..        
+0000edc0: 6966 206d 656e 752e 5369 7a65 2e77 6964  if menu.Size.wid
+0000edd0: 7468 203c 2073 7a5f 6274 6e2e 7769 6474  th < sz_btn.widt
+0000ede0: 683a 0d0a 2020 2020 2020 2020 2020 2020  h:..            
+0000edf0: 6d65 6e75 2e53 697a 6520 3d20 737a 5f62  menu.Size = sz_b
+0000ee00: 746e 2e77 6964 7468 2c20 6d65 6e75 2e53  tn.width, menu.S
+0000ee10: 697a 652e 6865 6967 6874 0d0a 2020 2020  ize.height..    
+0000ee20: 2020 2020 6d65 6e75 2e50 6f70 7570 2870      menu.Popup(p
+0000ee30: 745f 6274 6e2c 2073 656c 6629 0d0a 0d0a  t_btn, self)....
+0000ee40: 0d0a 2020 2020 6465 6620 6f6e 5f65 7870  ..    def on_exp
+0000ee50: 6f72 745f 6461 7461 6261 7365 2873 656c  ort_database(sel
+0000ee60: 662c 2065 7665 6e74 293a 0d0a 2020 2020  f, event):..    
+0000ee70: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
+0000ee80: 2048 616e 646c 6572 2066 6f72 2063 6c69   Handler for cli
+0000ee90: 636b 696e 6720 746f 2065 7870 6f72 7420  cking to export 
+0000eea0: 6120 7768 6f6c 6520 6461 7461 6261 7365  a whole database
+0000eeb0: 2c20 6c65 7473 2074 6865 2075 7365 720d  , lets the user.
+0000eec0: 0a20 2020 2020 2020 2073 7065 6369 6679  .        specify
+0000eed0: 2061 2064 6972 6563 746f 7279 2077 6865   a directory whe
+0000eee0: 7265 2074 6f20 7361 7665 2063 6861 7420  re to save chat 
+0000eef0: 6669 6c65 7320 616e 6420 6578 706f 7274  files and export
+0000ef00: 7320 616c 6c20 6368 6174 732e 0d0a 2020  s all chats...  
+0000ef10: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
+0000ef20: 2020 2064 6f5f 7369 6e67 6c65 6669 6c65     do_singlefile
+0000ef30: 203d 2046 616c 7365 0d0a 2020 2020 2020   = False..      
+0000ef40: 2020 6966 2065 7665 6e74 3a0d 0a20 2020    if event:..   
+0000ef50: 2020 2020 2020 2020 206e 6974 656d 7320           nitems 
+0000ef60: 3d20 656e 756d 6572 6174 6528 6576 656e  = enumerate(even
+0000ef70: 742e 4576 656e 744f 626a 6563 742e 4765  t.EventObject.Ge
+0000ef80: 744d 656e 7549 7465 6d73 2829 290d 0a20  tMenuItems()).. 
+0000ef90: 2020 2020 2020 2020 2020 2069 6e64 6578             index
+0000efa0: 203d 206e 6578 7428 2869 2066 6f72 2069   = next((i for i
+0000efb0: 2c20 6d20 696e 206e 6974 656d 7320 6966  , m in nitems if
+0000efc0: 206d 2e47 6574 4964 2829 203d 3d20 6576   m.GetId() == ev
+0000efd0: 656e 742e 4964 292c 204e 6f6e 6529 0d0a  ent.Id), None)..
+0000efe0: 2020 2020 2020 2020 2020 2020 646f 5f73              do_s
+0000eff0: 696e 676c 6566 696c 6520 3d20 696e 6465  inglefile = inde
+0000f000: 7820 3e20 300d 0a0d 0a20 2020 2020 2020  x > 0....       
+0000f010: 2069 6620 7365 6c66 2e64 625f 6669 6c65   if self.db_file
+0000f020: 6e61 6d65 2069 6e20 7365 6c66 2e77 6f72  name in self.wor
+0000f030: 6b65 7273 5f69 6d70 6f72 743a 0d0a 2020  kers_import:..  
+0000f040: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0000f050: 2077 782e 4d65 7373 6167 6542 6f78 2822   wx.MessageBox("
+0000f060: 2573 2069 7320 6375 7272 656e 746c 7920  %s is currently 
+0000f070: 6265 696e 6720 696d 706f 7274 6564 2074  being imported t
+0000f080: 6f2c 2063 616e 6e6f 7420 6578 706f 7274  o, cannot export
+0000f090: 2e22 2025 0d0a 2020 2020 2020 2020 2020  ." %..          
+0000f0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f0b0: 2020 2020 2020 2073 656c 662e 6462 5f66         self.db_f
+0000f0c0: 696c 656e 616d 652c 2063 6f6e 662e 5469  ilename, conf.Ti
+0000f0d0: 746c 652c 2077 782e 4f4b 207c 2077 782e  tle, wx.OK | wx.
+0000f0e0: 4943 4f4e 5f57 4152 4e49 4e47 290d 0a0d  ICON_WARNING)...
+0000f0f0: 0a20 2020 2020 2020 2066 6f63 7573 6564  .        focused
+0000f100: 5f63 6f6e 7472 6f6c 203d 2073 656c 662e  _control = self.
+0000f110: 4669 6e64 466f 6375 7328 290d 0a20 2020  FindFocus()..   
+0000f120: 2020 2020 2073 656c 662e 6275 7474 6f6e       self.button
+0000f130: 5f65 7870 6f72 742e 456e 6162 6c65 6420  _export.Enabled 
+0000f140: 3d20 4661 6c73 650d 0a0d 0a20 2020 2020  = False....     
+0000f150: 2020 2064 6961 6c6f 6720 3d20 7365 6c66     dialog = self
+0000f160: 2e64 6961 6c6f 675f 7361 7665 6669 6c65  .dialog_savefile
+0000f170: 2069 6620 646f 5f73 696e 676c 6566 696c   if do_singlefil
+0000f180: 6520 656c 7365 2073 656c 662e 6469 616c  e else self.dial
+0000f190: 6f67 5f73 6176 6566 696c 655f 6f77 0d0a  og_savefile_ow..
+0000f1a0: 2020 2020 2020 2020 6469 616c 6f67 2e4d          dialog.M
+0000f1b0: 6573 7361 6765 203d 2022 4368 6f6f 7365  essage = "Choose
+0000f1c0: 2066 6f6c 6465 7220 7768 6572 6520 746f   folder where to
+0000f1d0: 2073 6176 6520 6368 6174 2066 696c 6573   save chat files
+0000f1e0: 220d 0a20 2020 2020 2020 2064 6961 6c6f  "..        dialo
+0000f1f0: 672e 4669 6c65 6e61 6d65 203d 2022 4669  g.Filename = "Fi
+0000f200: 6c65 6e61 6d65 2077 696c 6c20 6265 2069  lename will be i
+0000f210: 676e 6f72 6564 220d 0a20 2020 2020 2020  gnored"..       
+0000f220: 2064 6961 6c6f 672e 5769 6c64 6361 7264   dialog.Wildcard
+0000f230: 203d 2065 7870 6f72 742e 4348 4154 5f57   = export.CHAT_W
+0000f240: 494c 4443 4152 440d 0a20 2020 2020 2020  ILDCARD..       
+0000f250: 2064 6961 6c6f 672e 4669 6c74 6572 496e   dialog.FilterIn
+0000f260: 6465 7820 3d20 6578 706f 7274 2e43 4841  dex = export.CHA
+0000f270: 545f 4558 5453 2e69 6e64 6578 2822 6874  T_EXTS.index("ht
+0000f280: 6d6c 2229 0d0a 2020 2020 2020 2020 6966  ml")..        if
+0000f290: 2064 6f5f 7369 6e67 6c65 6669 6c65 3a0d   do_singlefile:.
+0000f2a0: 0a20 2020 2020 2020 2020 2020 2064 6220  .            db 
+0000f2b0: 3d20 7365 6c66 2e6c 6f61 645f 6461 7461  = self.load_data
+0000f2c0: 6261 7365 2873 656c 662e 6462 5f66 696c  base(self.db_fil
+0000f2d0: 656e 616d 6529 0d0a 2020 2020 2020 2020  ename)..        
+0000f2e0: 2020 2020 666f 726d 6174 6172 6773 203d      formatargs =
+0000f2f0: 2063 6f6c 6c65 6374 696f 6e73 2e64 6566   collections.def
+0000f300: 6175 6c74 6469 6374 2873 7472 290d 0a20  aultdict(str).. 
+0000f310: 2020 2020 2020 2020 2020 2066 6f72 6d61             forma
+0000f320: 7461 7267 735b 2273 6b79 7065 6e61 6d65  targs["skypename
+0000f330: 225d 203d 206f 732e 7061 7468 2e62 6173  "] = os.path.bas
+0000f340: 656e 616d 6528 7365 6c66 2e64 625f 6669  ename(self.db_fi
+0000f350: 6c65 6e61 6d65 290d 0a20 2020 2020 2020  lename)..       
+0000f360: 2020 2020 2069 6620 6462 2061 6e64 2064       if db and d
+0000f370: 622e 6163 636f 756e 743a 2066 6f72 6d61  b.account: forma
+0000f380: 7461 7267 732e 7570 6461 7465 2864 622e  targs.update(db.
+0000f390: 6163 636f 756e 7429 0d0a 2020 2020 2020  account)..      
+0000f3a0: 2020 2020 2020 6465 6661 756c 7420 3d20        default = 
+0000f3b0: 7574 696c 2e73 6166 655f 6669 6c65 6e61  util.safe_filena
+0000f3c0: 6d65 2863 6f6e 662e 4578 706f 7274 4462  me(conf.ExportDb
+0000f3d0: 5465 6d70 6c61 7465 2025 2066 6f72 6d61  Template % forma
+0000f3e0: 7461 7267 7329 0d0a 2020 2020 2020 2020  targs)..        
+0000f3f0: 2020 2020 6469 616c 6f67 2e46 696c 656e      dialog.Filen
+0000f400: 616d 6520 3d20 6465 6661 756c 740d 0a20  ame = default.. 
+0000f410: 2020 2020 2020 2020 2020 2064 6961 6c6f             dialo
+0000f420: 672e 4d65 7373 6167 6520 3d20 2253 6176  g.Message = "Sav
+0000f430: 6520 6368 6174 7320 6669 6c65 220d 0a20  e chats file".. 
+0000f440: 2020 2020 2020 2020 2020 2064 6961 6c6f             dialo
+0000f450: 672e 5769 6c64 6361 7264 203d 2065 7870  g.Wildcard = exp
+0000f460: 6f72 742e 4348 4154 5f57 494c 4443 4152  ort.CHAT_WILDCAR
+0000f470: 445f 5349 4e47 4c45 4649 4c45 0d0a 0d0a  D_SINGLEFILE....
+0000f480: 2020 2020 2020 2020 6966 2077 782e 4944          if wx.ID
+0000f490: 5f4f 4b20 213d 2064 6961 6c6f 672e 5368  _OK != dialog.Sh
+0000f4a0: 6f77 4d6f 6461 6c28 293a 0d0a 2020 2020  owModal():..    
+0000f4b0: 2020 2020 2020 2020 7365 6c66 2e62 7574          self.but
+0000f4c0: 746f 6e5f 6578 706f 7274 2e45 6e61 626c  ton_export.Enabl
+0000f4d0: 6564 203d 2054 7275 650d 0a20 2020 2020  ed = True..     
+0000f4e0: 2020 2020 2020 2069 6620 666f 6375 7365         if focuse
+0000f4f0: 645f 636f 6e74 726f 6c3a 2066 6f63 7573  d_control: focus
+0000f500: 6564 5f63 6f6e 7472 6f6c 2e53 6574 466f  ed_control.SetFo
+0000f510: 6375 7328 290d 0a20 2020 2020 2020 2020  cus()..         
+0000f520: 2020 2072 6574 7572 6e0d 0a0d 0a20 2020     return....   
+0000f530: 2020 2020 2064 622c 2066 696c 6573 2c20       db, files, 
+0000f540: 636f 756e 742c 206d 6573 7361 6765 5f63  count, message_c
+0000f550: 6f75 6e74 2c20 6d65 6469 615f 666f 6c64  ount, media_fold
+0000f560: 6572 203d 204e 6f6e 652c 205b 5d2c 2030  er = None, [], 0
+0000f570: 2c20 302c 2046 616c 7365 0d0a 2020 2020  , 0, False..    
+0000f580: 2020 2020 6572 726f 722c 2065 7272 6f72      error, error
+0000f590: 6d73 672c 2065 7272 6f72 6d73 675f 7368  msg, errormsg_sh
+0000f5a0: 6f72 7420 3d20 4661 6c73 652c 204e 6f6e  ort = False, Non
+0000f5b0: 652c 204e 6f6e 650d 0a0d 0a20 2020 2020  e, None....     
+0000f5c0: 2020 2064 6220 3d20 7365 6c66 2e6c 6f61     db = self.loa
+0000f5d0: 645f 6461 7461 6261 7365 2873 656c 662e  d_database(self.
+0000f5e0: 6462 5f66 696c 656e 616d 6529 0d0a 2020  db_filename)..  
+0000f5f0: 2020 2020 2020 7061 7468 203d 2063 6f6e        path = con
+0000f600: 7472 6f6c 732e 6765 745f 6469 616c 6f67  trols.get_dialog
+0000f610: 5f70 6174 6828 6469 616c 6f67 290d 0a20  _path(dialog).. 
+0000f620: 2020 2020 2020 2069 6620 6e6f 7420 6462         if not db
+0000f630: 3a0d 0a20 2020 2020 2020 2020 2020 2065  :..            e
+0000f640: 7272 6f72 203d 2054 7275 650d 0a20 2020  rror = True..   
+0000f650: 2020 2020 2065 6c69 6620 2263 6f6e 7665       elif "conve
+0000f660: 7273 6174 696f 6e73 2220 6e6f 7420 696e  rsations" not in
+0000f670: 2064 622e 7461 626c 6573 3a0d 0a20 2020   db.tables:..   
+0000f680: 2020 2020 2020 2020 2065 7272 6f72 203d           error =
+0000f690: 2054 7275 650d 0a20 2020 2020 2020 2020   True..         
+0000f6a0: 2020 2065 7272 6f72 6d73 6720 3d20 2243     errormsg = "C
+0000f6b0: 616e 6e6f 7420 6578 706f 7274 2025 732e  annot export %s.
+0000f6c0: 204e 6f74 2061 2076 616c 6964 2053 6b79   Not a valid Sky
+0000f6d0: 7065 2064 6174 6162 6173 653f 2220 2520  pe database?" % 
+0000f6e0: 6462 0d0a 2020 2020 2020 2020 6966 206e  db..        if n
+0000f6f0: 6f74 2065 7272 6f72 2061 6e64 206e 6f74  ot error and not
+0000f700: 2064 6f5f 7369 6e67 6c65 6669 6c65 3a0d   do_singlefile:.
+0000f710: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+0000f720: 6d61 7420 3d20 6578 706f 7274 2e43 4841  mat = export.CHA
+0000f730: 545f 4558 5453 5b64 6961 6c6f 672e 4669  T_EXTS[dialog.Fi
+0000f740: 6c74 6572 496e 6465 785d 0d0a 2020 2020  lterIndex]..    
+0000f750: 2020 2020 2020 2020 6d65 6469 615f 666f          media_fo
+0000f760: 6c64 6572 203d 2022 6874 6d6c 2220 3d3d  lder = "html" ==
+0000f770: 2066 6f72 6d61 7420 616e 6420 5c0d 0a20   format and \.. 
+0000f780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f790: 2020 2020 2020 2020 2020 6469 616c 6f67            dialog
+0000f7a0: 2e46 696c 7465 7249 6e64 6578 2021 3d20  .FilterIndex != 
+0000f7b0: 6578 706f 7274 2e43 4841 545f 4558 5453  export.CHAT_EXTS
+0000f7c0: 2e69 6e64 6578 2822 6874 6d6c 2229 0d0a  .index("html")..
+0000f7d0: 2020 2020 2020 2020 2020 2020 6966 206d              if m
+0000f7e0: 6564 6961 5f66 6f6c 6465 7220 616e 6420  edia_folder and 
+0000f7f0: 6e6f 7420 6368 6563 6b5f 6d65 6469 615f  not check_media_
+0000f800: 6578 706f 7274 5f6c 6f67 696e 2864 6229  export_login(db)
+0000f810: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0000f820: 2020 2073 656c 662e 6275 7474 6f6e 5f65     self.button_e
+0000f830: 7870 6f72 742e 456e 6162 6c65 6420 3d20  xport.Enabled = 
+0000f840: 5472 7565 0d0a 2020 2020 2020 2020 2020  True..          
+0000f850: 2020 2020 2020 6966 2066 6f63 7573 6564        if focused
+0000f860: 5f63 6f6e 7472 6f6c 3a20 666f 6375 7365  _control: focuse
+0000f870: 645f 636f 6e74 726f 6c2e 5365 7446 6f63  d_control.SetFoc
+0000f880: 7573 2829 0d0a 2020 2020 2020 2020 2020  us()..          
+0000f890: 2020 2020 2020 7265 7475 726e 0d0a 0d0a        return....
+0000f8a0: 2020 2020 2020 2020 2020 2020 666f 726d              form
+0000f8b0: 6174 6172 6773 203d 2063 6f6c 6c65 6374  atargs = collect
+0000f8c0: 696f 6e73 2e64 6566 6175 6c74 6469 6374  ions.defaultdict
+0000f8d0: 2873 7472 290d 0a20 2020 2020 2020 2020  (str)..         
+0000f8e0: 2020 2066 6f72 6d61 7461 7267 735b 2273     formatargs["s
+0000f8f0: 6b79 7065 6e61 6d65 225d 203d 206f 732e  kypename"] = os.
+0000f900: 7061 7468 2e62 6173 656e 616d 6528 7365  path.basename(se
+0000f910: 6c66 2e64 625f 6669 6c65 6e61 6d65 290d  lf.db_filename).
+0000f920: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000f930: 6462 2e61 6363 6f75 6e74 3a20 666f 726d  db.account: form
+0000f940: 6174 6172 6773 2e75 7064 6174 6528 6462  atargs.update(db
+0000f950: 2e61 6363 6f75 6e74 290d 0a20 2020 2020  .account)..     
+0000f960: 2020 2020 2020 2066 6f6c 6465 7220 3d20         folder = 
+0000f970: 7574 696c 2e73 6166 655f 6669 6c65 6e61  util.safe_filena
+0000f980: 6d65 2863 6f6e 662e 4578 706f 7274 4462  me(conf.ExportDb
+0000f990: 5465 6d70 6c61 7465 2025 2066 6f72 6d61  Template % forma
+0000f9a0: 7461 7267 7329 0d0a 2020 2020 2020 2020  targs)..        
+0000f9b0: 2020 2020 7061 7468 203d 2075 7469 6c2e      path = util.
+0000f9c0: 756e 6971 7565 5f70 6174 6828 6f73 2e70  unique_path(os.p
+0000f9d0: 6174 682e 6a6f 696e 286f 732e 7061 7468  ath.join(os.path
+0000f9e0: 2e64 6972 6e61 6d65 2870 6174 6829 2c20  .dirname(path), 
+0000f9f0: 666f 6c64 6572 2929 0d0a 2020 2020 2020  folder))..      
+0000fa00: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
+0000fa10: 2020 2020 2020 2020 2020 2020 6f73 2e6d              os.m
+0000fa20: 6b64 6972 2870 6174 6829 0d0a 2020 2020  kdir(path)..    
+0000fa30: 2020 2020 2020 2020 6578 6365 7074 2045          except E
+0000fa40: 7863 6570 7469 6f6e 2061 7320 653a 0d0a  xception as e:..
+0000fa50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fa60: 6572 726f 726d 7367 5f73 686f 7274 203d  errormsg_short =
+0000fa70: 2022 4661 696c 6564 2074 6f20 6372 6561   "Failed to crea
+0000fa80: 7465 2064 6972 6563 746f 7279 2025 733a  te directory %s:
+0000fa90: 2025 7322 2025 2028 0d0a 2020 2020 2020   %s" % (..      
+0000faa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fab0: 2020 2020 2020 2020 2020 2070 6174 682c             path,
+0000fac0: 2075 7469 6c2e 666f 726d 6174 5f65 7863   util.format_exc
+0000fad0: 2865 2929 0d0a 2020 2020 2020 2020 2020  (e))..          
+0000fae0: 2020 2020 2020 6572 726f 726d 7367 203d        errormsg =
+0000faf0: 2022 4661 696c 6564 2074 6f20 6372 6561   "Failed to crea
+0000fb00: 7465 2064 6972 6563 746f 7279 2025 733a  te directory %s:
+0000fb10: 5c6e 5c6e 2573 2220 2520 5c0d 0a20 2020  \n\n%s" % \..   
+0000fb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fb30: 2020 2020 2020 2020 2870 6174 682c 2074          (path, t
+0000fb40: 7261 6365 6261 636b 2e66 6f72 6d61 745f  raceback.format_
+0000fb50: 6578 6328 2929 0d0a 2020 2020 2020 2020  exc())..        
+0000fb60: 2020 2020 2020 2020 6572 726f 7220 3d20          error = 
+0000fb70: 5472 7565 0d0a 2020 2020 2020 2020 656c  True..        el
+0000fb80: 6966 206e 6f74 2065 7272 6f72 3a0d 0a20  if not error:.. 
+0000fb90: 2020 2020 2020 2020 2020 2066 6f72 6d61             forma
+0000fba0: 7420 3d20 6578 706f 7274 2e43 4841 545f  t = export.CHAT_
+0000fbb0: 4558 5453 5f53 494e 474c 4546 494c 455b  EXTS_SINGLEFILE[
+0000fbc0: 6469 616c 6f67 2e46 696c 7465 7249 6e64  dialog.FilterInd
+0000fbd0: 6578 5d0d 0a0d 0a0d 0a20 2020 2020 2020  ex]......       
+0000fbe0: 2069 6620 6e6f 7420 6572 726f 723a 0d0a   if not error:..
+0000fbf0: 2020 2020 2020 2020 2020 2020 6368 6174              chat
+0000fc00: 7320 3d20 6462 2e67 6574 5f63 6f6e 7665  s = db.get_conve
+0000fc10: 7273 6174 696f 6e73 2829 0d0a 2020 2020  rsations()..    
+0000fc20: 2020 2020 2020 2020 6275 7379 203d 2063          busy = c
+0000fc30: 6f6e 7472 6f6c 732e 4275 7379 5061 6e65  ontrols.BusyPane
+0000fc40: 6c28 0d0a 2020 2020 2020 2020 2020 2020  l(..            
+0000fc50: 2020 2020 7365 6c66 2c20 2745 7870 6f72      self, 'Expor
+0000fc60: 7469 6e67 2061 6c6c 2063 6861 7473 2066  ting all chats f
+0000fc70: 726f 6d20 2225 7322 5c6e 6173 2025 7320  rom "%s"\nas %s 
+0000fc80: 756e 6465 7220 2573 2e27 2025 0d0a 2020  under %s.' %..  
+0000fc90: 2020 2020 2020 2020 2020 2020 2020 2864                (d
+0000fca0: 622e 6669 6c65 6e61 6d65 2c20 666f 726d  b.filename, form
+0000fcb0: 6174 2e75 7070 6572 2829 2c20 7061 7468  at.upper(), path
+0000fcc0: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
+0000fcd0: 7778 2e53 6166 6559 6965 6c64 2829 2023  wx.SafeYield() #
+0000fce0: 2041 6c6c 6f77 2055 4920 746f 2072 6566   Allow UI to ref
+0000fcf0: 7265 7368 0d0a 2020 2020 2020 2020 2020  resh..          
+0000fd00: 2020 7472 793a 0d0a 2020 2020 2020 2020    try:..        
+0000fd10: 2020 2020 2020 2020 6462 2e67 6574 5f63          db.get_c
+0000fd20: 6f6e 7665 7273 6174 696f 6e73 5f73 7461  onversations_sta
+0000fd30: 7473 2863 6861 7473 290d 0a20 2020 2020  ts(chats)..     
+0000fd40: 2020 2020 2020 2020 2020 2070 726f 6772             progr
+0000fd50: 6573 7366 756e 6320 3d20 6c61 6d62 6461  essfunc = lambda
+0000fd60: 202a 6172 6773 3a20 7778 2e53 6166 6559   *args: wx.SafeY
+0000fd70: 6965 6c64 2829 0d0a 2020 2020 2020 2020  ield()..        
+0000fd80: 2020 2020 2020 2020 6f70 7473 203d 2064          opts = d
+0000fd90: 6963 7428 6d75 6c74 693d 6e6f 7420 646f  ict(multi=not do
+0000fda0: 5f73 696e 676c 6566 696c 652c 2070 726f  _singlefile, pro
+0000fdb0: 6772 6573 733d 7072 6f67 7265 7373 6675  gress=progressfu
+0000fdc0: 6e63 290d 0a20 2020 2020 2020 2020 2020  nc)..           
+0000fdd0: 2020 2020 2069 6620 6d65 6469 615f 666f       if media_fo
+0000fde0: 6c64 6572 3a20 6f70 7473 5b22 6d65 6469  lder: opts["medi
+0000fdf0: 615f 666f 6c64 6572 225d 203d 2054 7275  a_folder"] = Tru
+0000fe00: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
+0000fe10: 2020 2072 6573 756c 7420 3d20 6578 706f     result = expo
+0000fe20: 7274 2e65 7870 6f72 745f 6368 6174 7328  rt.export_chats(
+0000fe30: 6368 6174 732c 2070 6174 682c 2066 6f72  chats, path, for
+0000fe40: 6d61 742c 2064 622c 206f 7074 7329 0d0a  mat, db, opts)..
+0000fe50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fe60: 6669 6c65 732c 2063 6f75 6e74 2c20 6d65  files, count, me
+0000fe70: 7373 6167 655f 636f 756e 7420 3d20 7265  ssage_count = re
+0000fe80: 7375 6c74 0d0a 2020 2020 2020 2020 2020  sult..          
+0000fe90: 2020 2020 2020 7061 6765 203d 206e 6578        page = nex
+0000fea0: 7428 286b 2066 6f72 206b 2c20 7620 696e  t((k for k, v in
+0000feb0: 2073 656c 662e 6462 5f70 6167 6573 2e69   self.db_pages.i
+0000fec0: 7465 6d73 2829 2069 6620 7620 6973 2064  tems() if v is d
+0000fed0: 6229 2c20 4e6f 6e65 290d 0a20 2020 2020  b), None)..     
+0000fee0: 2020 2020 2020 2020 2020 2069 6620 7061             if pa
+0000fef0: 6765 3a20 7778 2e43 616c 6c41 6674 6572  ge: wx.CallAfter
+0000ff00: 2870 6167 652e 7570 6461 7465 5f6c 6976  (page.update_liv
+0000ff10: 6569 6e66 6f29 0d0a 2020 2020 2020 2020  einfo)..        
+0000ff20: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
+0000ff30: 7469 6f6e 2061 7320 653a 0d0a 2020 2020  tion as e:..    
+0000ff40: 2020 2020 2020 2020 2020 2020 6572 726f              erro
+0000ff50: 726d 7367 5f73 686f 7274 203d 2022 4572  rmsg_short = "Er
+0000ff60: 726f 7220 6578 706f 7274 696e 6720 6368  ror exporting ch
+0000ff70: 6174 733a 2025 7322 2025 2075 7469 6c2e  ats: %s" % util.
+0000ff80: 666f 726d 6174 5f65 7863 2865 290d 0a20  format_exc(e).. 
+0000ff90: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000ffa0: 7272 6f72 6d73 6720 3d20 2245 7272 6f72  rrormsg = "Error
+0000ffb0: 2065 7870 6f72 7469 6e67 2063 6861 7473   exporting chats
+0000ffc0: 3a5c 6e5c 6e25 7322 2025 2074 7261 6365  :\n\n%s" % trace
+0000ffd0: 6261 636b 2e66 6f72 6d61 745f 6578 6328  back.format_exc(
+0000ffe0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0000fff0: 2020 2065 7272 6f72 203d 2054 7275 650d     error = True.
+00010000: 0a20 2020 2020 2020 2020 2020 2062 7573  .            bus
+00010010: 792e 436c 6f73 6528 290d 0a20 2020 2020  y.Close()..     
+00010020: 2020 2069 6620 6e6f 7420 6572 726f 723a     if not error:
+00010030: 0d0a 2020 2020 2020 2020 2020 2020 6775  ..            gu
+00010040: 6962 6173 652e 7374 6174 7573 2822 4578  ibase.status("Ex
+00010050: 706f 7274 6564 2025 7320 616e 6420 2573  ported %s and %s
+00010060: 2066 726f 6d20 2573 2061 7320 2573 2075   from %s as %s u
+00010070: 6e64 6572 2025 732e 222c 0d0a 2020 2020  nder %s.",..    
+00010080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010090: 2020 2020 2020 2075 7469 6c2e 706c 7572         util.plur
+000100a0: 616c 2822 6368 6174 222c 2063 6f75 6e74  al("chat", count
+000100b0: 2c20 7365 703d 222c 2229 2c0d 0a20 2020  , sep=","),..   
+000100c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000100d0: 2020 2020 2020 2020 7574 696c 2e70 6c75          util.plu
+000100e0: 7261 6c28 226d 6573 7361 6765 222c 206d  ral("message", m
+000100f0: 6573 7361 6765 5f63 6f75 6e74 2c20 7365  essage_count, se
+00010100: 703d 222c 2229 2c0d 0a20 2020 2020 2020  p=","),..       
+00010110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010120: 2020 2020 6462 2e66 696c 656e 616d 652c      db.filename,
+00010130: 2066 6f72 6d61 742e 7570 7065 7228 292c   format.upper(),
+00010140: 2070 6174 682c 206c 6f67 3d54 7275 6529   path, log=True)
+00010150: 0d0a 2020 2020 2020 2020 656c 6966 2065  ..        elif e
+00010160: 7272 6f72 6d73 673a 0d0a 2020 2020 2020  rrormsg:..      
+00010170: 2020 2020 2020 6775 6962 6173 652e 7374        guibase.st
+00010180: 6174 7573 2865 7272 6f72 6d73 675f 7368  atus(errormsg_sh
+00010190: 6f72 7420 6f72 2065 7272 6f72 6d73 672c  ort or errormsg,
+000101a0: 206c 6f67 3d54 7275 6529 0d0a 2020 2020   log=True)..    
+000101b0: 2020 2020 2020 2020 7778 2e4d 6573 7361          wx.Messa
+000101c0: 6765 426f 7828 6572 726f 726d 7367 2c20  geBox(errormsg, 
+000101d0: 636f 6e66 2e54 6974 6c65 2c20 7778 2e4f  conf.Title, wx.O
+000101e0: 4b20 7c20 7778 2e49 434f 4e5f 5741 524e  K | wx.ICON_WARN
+000101f0: 494e 4729 0d0a 2020 2020 2020 2020 6966  ING)..        if
+00010200: 2064 6220 616e 6420 6e6f 7420 6462 2e68   db and not db.h
+00010210: 6173 5f63 6f6e 7375 6d65 7273 2829 3a0d  as_consumers():.
+00010220: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00010230: 662e 6462 732e 706f 7028 6462 2e66 696c  f.dbs.pop(db.fil
+00010240: 656e 616d 652c 204e 6f6e 6529 0d0a 2020  ename, None)..  
+00010250: 2020 2020 2020 2020 2020 6462 2e63 6c6f            db.clo
+00010260: 7365 2829 0d0a 2020 2020 2020 2020 6966  se()..        if
+00010270: 2064 6220 616e 6420 6e6f 7420 6572 726f   db and not erro
+00010280: 723a 0d0a 2020 2020 2020 2020 2020 2020  r:..            
+00010290: 6966 2063 6f6e 662e 4578 706f 7274 4669  if conf.ExportFi
+000102a0: 6c65 4175 746f 4f70 656e 3a0d 0a20 2020  leAutoOpen:..   
+000102b0: 2020 2020 2020 2020 2020 2020 2075 7469               uti
+000102c0: 6c2e 7374 6172 745f 6669 6c65 2866 696c  l.start_file(fil
+000102d0: 6573 5b30 5d20 6966 2064 6f5f 7369 6e67  es[0] if do_sing
+000102e0: 6c65 6669 6c65 2065 6c73 6520 7061 7468  lefile else path
+000102f0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00010300: 6275 7474 6f6e 5f65 7870 6f72 742e 456e  button_export.En
+00010310: 6162 6c65 6420 3d20 5472 7565 0d0a 2020  abled = True..  
+00010320: 2020 2020 2020 6966 2066 6f63 7573 6564        if focused
+00010330: 5f63 6f6e 7472 6f6c 3a20 666f 6375 7365  _control: focuse
+00010340: 645f 636f 6e74 726f 6c2e 5365 7446 6f63  d_control.SetFoc
+00010350: 7573 2829 0d0a 0d0a 0d0a 2020 2020 6465  us()......    de
+00010360: 6620 6f6e 5f63 6f6d 7061 7265 5f6d 656e  f on_compare_men
+00010370: 7528 7365 6c66 2c20 6576 656e 7429 3a0d  u(self, event):.
+00010380: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
+00010390: 2020 2020 2020 4861 6e64 6c65 7220 666f        Handler fo
+000103a0: 7220 6368 6f6f 7369 6e67 2061 2066 696c  r choosing a fil
+000103b0: 6520 6672 6f6d 2074 6865 2063 6f6d 7061  e from the compa
+000103c0: 7265 2070 6f70 7570 206d 656e 752c 206c  re popup menu, l
+000103d0: 6f61 6473 2062 6f74 680d 0a20 2020 2020  oads both..     
+000103e0: 2020 2064 6174 6162 6173 6573 2061 6e64     databases and
+000103f0: 206f 7065 6e73 2074 6865 206d 6572 6765   opens the merge
+00010400: 7220 7061 6765 2e0d 0a20 2020 2020 2020  r page...       
+00010410: 2022 2222 0d0a 2020 2020 2020 2020 6669   """..        fi
+00010420: 6c65 6e61 6d65 312c 2066 696c 656e 616d  lename1, filenam
+00010430: 6532 203d 2073 656c 662e 6462 5f66 696c  e2 = self.db_fil
+00010440: 656e 616d 652c 204e 6f6e 650d 0a20 2020  ename, None..   
+00010450: 2020 2020 2023 2046 696e 6420 6d65 6e75       # Find menu
+00010460: 6974 656d 2069 6e64 6578 2061 6e64 206c  item index and l
+00010470: 6162 656c 2066 726f 6d20 6f72 6967 696e  abel from origin
+00010480: 616c 206d 656e 7520 6279 2065 7665 6e74  al menu by event
+00010490: 2049 440d 0a20 2020 2020 2020 206e 6974   ID..        nit
+000104a0: 656d 7320 3d20 656e 756d 6572 6174 6528  ems = enumerate(
+000104b0: 6576 656e 742e 4576 656e 744f 626a 6563  event.EventObjec
+000104c0: 742e 4765 744d 656e 7549 7465 6d73 2829  t.GetMenuItems()
+000104d0: 290d 0a20 2020 2020 2020 2069 6e64 6578  )..        index
+000104e0: 6974 656d 203d 205b 2869 2c20 6d29 2066  item = [(i, m) f
+000104f0: 6f72 2069 2c20 6d20 696e 206e 6974 656d  or i, m in nitem
+00010500: 7320 6966 206d 2e47 6574 4964 2829 203d  s if m.GetId() =
+00010510: 3d20 6576 656e 742e 4964 5d0d 0a20 2020  = event.Id]..   
+00010520: 2020 2020 2069 2c20 6974 656d 203d 2069       i, item = i
+00010530: 6e64 6578 6974 656d 5b30 5d20 6966 2069  ndexitem[0] if i
+00010540: 6e64 6578 6974 656d 2065 6c73 6520 282d  ndexitem else (-
+00010550: 312c 204e 6f6e 6529 0d0a 2020 2020 2020  1, None)..      
+00010560: 2020 6861 735f 6578 706f 7274 203d 2062    has_export = b
+00010570: 6f6f 6c28 6c69 7665 2e69 6a73 6f6e 290d  ool(live.ijson).
+00010580: 0a20 2020 2020 2020 2069 735f 6578 706f  .        is_expo
+00010590: 7274 203d 2068 6173 5f65 7870 6f72 7420  rt = has_export 
+000105a0: 616e 6420 2869 203d 3d20 3129 0d0a 2020  and (i == 1)..  
+000105b0: 2020 2020 2020 6966 2069 203e 2068 6173        if i > has
+000105c0: 5f65 7870 6f72 7420 616e 6420 6974 656d  _export and item
+000105d0: 3a0d 0a20 2020 2020 2020 2020 2020 2066  :..            f
+000105e0: 696c 656e 616d 6532 203d 2069 7465 6d2e  ilename2 = item.
+000105f0: 4765 744c 6162 656c 2829 2e73 706c 6974  GetLabel().split
+00010600: 2822 2022 2c20 3129 2e70 6f70 2829 0d0a  (" ", 1).pop()..
+00010610: 2020 2020 2020 2020 656c 6966 2069 735f          elif is_
+00010620: 6578 706f 7274 3a20 2320 5365 636f 6e64  export: # Second
+00010630: 206d 656e 7520 6974 656d 3a20 6f70 656e   menu item: open
+00010640: 2061 2053 6b79 7065 2065 7870 6f72 7420   a Skype export 
+00010650: 6172 6368 6976 6520 6672 6f6d 2063 6f6d  archive from com
+00010660: 7075 7465 720d 0a20 2020 2020 2020 2020  puter..         
+00010670: 2020 2069 6620 7778 2e49 445f 4f4b 203d     if wx.ID_OK =
+00010680: 3d20 7365 6c66 2e64 6961 6c6f 675f 6f70  = self.dialog_op
+00010690: 656e 6578 706f 7274 2e53 686f 774d 6f64  enexport.ShowMod
+000106a0: 616c 2829 3a0d 0a20 2020 2020 2020 2020  al():..         
+000106b0: 2020 2020 2020 2066 696c 656e 616d 6532         filename2
+000106c0: 203d 2073 656c 662e 6469 616c 6f67 5f6f   = self.dialog_o
+000106d0: 7065 6e65 7870 6f72 742e 4765 7450 6174  penexport.GetPat
+000106e0: 6828 290d 0a20 2020 2020 2020 2065 6c73  h()..        els
+000106f0: 653a 2023 2046 6972 7374 206d 656e 7520  e: # First menu 
+00010700: 6974 656d 3a20 6f70 656e 2061 2066 696c  item: open a fil
+00010710: 6520 6672 6f6d 2063 6f6d 7075 7465 720d  e from computer.
+00010720: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00010730: 7778 2e49 445f 4f4b 203d 3d20 7365 6c66  wx.ID_OK == self
+00010740: 2e64 6961 6c6f 675f 6f70 656e 6669 6c65  .dialog_openfile
+00010750: 2e53 686f 774d 6f64 616c 2829 3a0d 0a20  .ShowModal():.. 
+00010760: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00010770: 696c 656e 616d 6532 203d 2073 656c 662e  ilename2 = self.
+00010780: 6469 616c 6f67 5f6f 7065 6e66 696c 652e  dialog_openfile.
+00010790: 4765 7450 6174 6828 290d 0a20 2020 2020  GetPath()..     
+000107a0: 2020 2069 6620 6669 6c65 6e61 6d65 3120     if filename1 
+000107b0: 3d3d 2066 696c 656e 616d 6532 3a0d 0a20  == filename2:.. 
+000107c0: 2020 2020 2020 2020 2020 2077 782e 4d65             wx.Me
+000107d0: 7373 6167 6542 6f78 2822 4361 6e6e 6f74  ssageBox("Cannot
+000107e0: 2063 6f6d 7061 7265 2025 7320 7769 7468   compare %s with
+000107f0: 2069 7473 656c 662e 2220 2520 2866 696c   itself." % (fil
+00010800: 656e 616d 6531 292c 0d0a 2020 2020 2020  ename1),..      
 00010810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010820: 2020 2020 2020 2020 2020 2020 2020 6669                fi
-00010830: 6c65 6e61 6d65 312c 2063 6f6e 662e 5469  lename1, conf.Ti
-00010840: 746c 652c 2077 782e 4f4b 207c 2077 782e  tle, wx.OK | wx.
-00010850: 4943 4f4e 5f57 4152 4e49 4e47 290d 0a20  ICON_WARNING).. 
-00010860: 2020 2020 2020 2069 6620 6669 6c65 6e61         if filena
-00010870: 6d65 3220 696e 2073 656c 662e 776f 726b  me2 in self.work
-00010880: 6572 735f 696d 706f 7274 3a0d 0a20 2020  ers_import:..   
-00010890: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-000108a0: 7778 2e4d 6573 7361 6765 426f 7828 2225  wx.MessageBox("%
-000108b0: 7320 6973 2063 7572 7265 6e74 6c79 2062  s is currently b
-000108c0: 6569 6e67 2069 6d70 6f72 7465 6420 746f  eing imported to
-000108d0: 2c20 6361 6e6e 6f74 206f 7065 6e2e 2220  , cannot open." 
-000108e0: 250d 0a20 2020 2020 2020 2020 2020 2020  %..             
-000108f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010900: 2020 2020 6669 6c65 6e61 6d65 322c 2063      filename2, c
-00010910: 6f6e 662e 5469 746c 652c 2077 782e 4f4b  onf.Title, wx.OK
-00010920: 207c 2077 782e 4943 4f4e 5f57 4152 4e49   | wx.ICON_WARNI
-00010930: 4e47 290d 0a0d 0a20 2020 2020 2020 2074  NG)....        t
-00010940: 6974 6c65 203d 2022 4461 7461 6261 7365  itle = "Database
-00010950: 2063 6f6d 7061 7269 736f 6e22 0d0a 2020   comparison"..  
-00010960: 2020 2020 2020 6462 312c 2064 6232 2c20        db1, db2, 
-00010970: 7061 6765 203d 204e 6f6e 652c 204e 6f6e  page = None, Non
-00010980: 652c 204e 6f6e 650d 0a20 2020 2020 2020  e, None..       
-00010990: 2069 6620 6973 5f65 7870 6f72 743a 0d0a   if is_export:..
-000109a0: 2020 2020 2020 2020 2020 2020 6462 3220              db2 
-000109b0: 3d20 6c69 7665 2e53 6b79 7065 4578 706f  = live.SkypeExpo
-000109c0: 7274 2866 696c 656e 616d 6532 290d 0a20  rt(filename2).. 
-000109d0: 2020 2020 2020 2020 2020 2064 6231 203d             db1 =
-000109e0: 2073 656c 662e 6c6f 6164 5f64 6174 6162   self.load_datab
-000109f0: 6173 6528 6669 6c65 6e61 6d65 3129 0d0a  ase(filename1)..
-00010a00: 2020 2020 2020 2020 2020 2020 7469 746c              titl
-00010a10: 6520 3d20 224d 6572 6765 2066 726f 6d20  e = "Merge from 
-00010a20: 536b 7970 6520 6578 706f 7274 220d 0a20  Skype export".. 
-00010a30: 2020 2020 2020 2069 6620 6e6f 7420 6462         if not db
-00010a40: 3120 616e 6420 6e6f 7420 6973 5f65 7870  1 and not is_exp
-00010a50: 6f72 743a 0d0a 2020 2020 2020 2020 2020  ort:..          
-00010a60: 2020 6462 3120 3d20 7365 6c66 2e6c 6f61    db1 = self.loa
-00010a70: 645f 6461 7461 6261 7365 2866 696c 656e  d_database(filen
-00010a80: 616d 6531 290d 0a20 2020 2020 2020 2069  ame1)..        i
-00010a90: 6620 6462 3120 616e 6420 6e6f 7420 6462  f db1 and not db
-00010aa0: 323a 0d0a 2020 2020 2020 2020 2020 2020  2:..            
-00010ab0: 6462 3220 3d20 7365 6c66 2e6c 6f61 645f  db2 = self.load_
-00010ac0: 6461 7461 6261 7365 2866 696c 656e 616d  database(filenam
-00010ad0: 6532 290d 0a20 2020 2020 2020 2069 6620  e2)..        if 
-00010ae0: 6462 3120 616e 6420 6462 323a 0d0a 2020  db1 and db2:..  
-00010af0: 2020 2020 2020 2020 2020 6462 7365 7420            dbset 
-00010b00: 3d20 7365 7428 6d61 7028 7374 722c 2028  = set(map(str, (
-00010b10: 6462 312c 2064 6232 2929 290d 0a20 2020  db1, db2)))..   
-00010b20: 2020 2020 2020 2020 2070 6167 6520 3d20           page = 
-00010b30: 6e65 7874 2828 7820 666f 7220 7820 696e  next((x for x in
-00010b40: 2073 656c 662e 6d65 7267 6572 5f70 6167   self.merger_pag
-00010b50: 6573 0d0a 2020 2020 2020 2020 2020 2020  es..            
-00010b60: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00010b70: 7820 616e 6420 7365 7428 6d61 7028 7374  x and set(map(st
-00010b80: 722c 2028 782e 6462 312c 2078 2e64 6232  r, (x.db1, x.db2
-00010b90: 2929 2920 3d3d 2064 6273 6574 292c 204e  ))) == dbset), N
-00010ba0: 6f6e 6529 0d0a 2020 2020 2020 2020 2020  one)..          
-00010bb0: 2020 6966 206e 6f74 2070 6167 653a 0d0a    if not page:..
-00010bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010bd0: 6c6f 6767 6572 2e69 6e66 6f28 224d 6572  logger.info("Mer
-00010be0: 6765 2070 6167 6520 666f 7220 2573 2061  ge page for %s a
-00010bf0: 6e64 2025 732e 222c 2064 6231 2c20 6462  nd %s.", db1, db
-00010c00: 3229 0d0a 2020 2020 2020 2020 2020 2020  2)..            
-00010c10: 2020 2020 7061 6765 203d 204d 6572 6765      page = Merge
-00010c20: 7250 6167 6528 7365 6c66 2e6e 6f74 6562  rPage(self.noteb
-00010c30: 6f6f 6b2c 2064 6232 2c20 6462 312c 0d0a  ook, db2, db1,..
-00010c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010c50: 2020 2020 2020 2073 656c 662e 6765 745f         self.get_
-00010c60: 756e 6971 7565 5f74 6162 5f74 6974 6c65  unique_tab_title
-00010c70: 2874 6974 6c65 2929 0d0a 2020 2020 2020  (title))..      
-00010c80: 2020 2020 2020 2020 2020 7365 6c66 2e6d            self.m
-00010c90: 6572 6765 725f 7061 6765 735b 7061 6765  erger_pages[page
-00010ca0: 5d20 3d20 2864 6231 2c20 6462 3229 0d0a  ] = (db1, db2)..
-00010cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010cc0: 7365 6c66 2e55 7064 6174 6541 6363 656c  self.UpdateAccel
-00010cd0: 6572 6174 6f72 7328 290d 0a20 2020 2020  erators()..     
-00010ce0: 2020 2020 2020 2020 2020 2075 7469 6c2e             util.
-00010cf0: 7275 6e5f 6f6e 6365 2863 6f6e 662e 7361  run_once(conf.sa
-00010d00: 7665 290d 0a20 2020 2020 2020 2065 6c69  ve)..        eli
-00010d10: 6620 6462 3120 6f72 2064 6232 3a0d 0a20  f db1 or db2:.. 
-00010d20: 2020 2020 2020 2020 2020 2023 2043 6c6f             # Clo
-00010d30: 7365 2044 4220 7769 7468 206e 6f20 6f77  se DB with no ow
-00010d40: 6e65 720d 0a20 2020 2020 2020 2020 2020  ner..           
-00010d50: 2066 6f72 2064 6220 696e 2066 696c 7465   for db in filte
-00010d60: 7228 626f 6f6c 2c20 5b64 6231 2c20 6462  r(bool, [db1, db
-00010d70: 325d 293a 0d0a 2020 2020 2020 2020 2020  2]):..          
-00010d80: 2020 2020 2020 6966 206e 6f74 2064 622e        if not db.
-00010d90: 6861 735f 636f 6e73 756d 6572 7328 293a  has_consumers():
-00010da0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00010db0: 2020 2020 2020 6c6f 6767 6572 2e69 6e66        logger.inf
-00010dc0: 6f28 2243 6c6f 7365 6420 6461 7461 6261  o("Closed databa
-00010dd0: 7365 2025 732e 222c 2064 622e 6669 6c65  se %s.", db.file
-00010de0: 6e61 6d65 290d 0a20 2020 2020 2020 2020  name)..         
-00010df0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00010e00: 6462 732e 706f 7028 6462 2e66 696c 656e  dbs.pop(db.filen
-00010e10: 616d 652c 204e 6f6e 6529 0d0a 2020 2020  ame, None)..    
+00010820: 2020 2020 636f 6e66 2e54 6974 6c65 2c20      conf.Title, 
+00010830: 7778 2e4f 4b20 7c20 7778 2e49 434f 4e5f  wx.OK | wx.ICON_
+00010840: 5741 524e 494e 4729 0d0a 2020 2020 2020  WARNING)..      
+00010850: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+00010860: 2020 2020 2073 656c 662e 636f 6d70 6172       self.compar
+00010870: 655f 6461 7461 6261 7365 7328 6669 6c65  e_databases(file
+00010880: 6e61 6d65 312c 2066 696c 656e 616d 6532  name1, filename2
+00010890: 2c20 6973 5f65 7870 6f72 7429 0d0a 0d0a  , is_export)....
+000108a0: 0d0a 2020 2020 6465 6620 636f 6d70 6172  ..    def compar
+000108b0: 655f 6461 7461 6261 7365 7328 7365 6c66  e_databases(self
+000108c0: 2c20 6669 6c65 6e61 6d65 312c 2066 696c  , filename1, fil
+000108d0: 656e 616d 6532 2c20 6973 5f65 7870 6f72  ename2, is_expor
+000108e0: 743d 4661 6c73 6529 3a0d 0a20 2020 2020  t=False):..     
+000108f0: 2020 2022 2222 4f70 656e 7320 7468 6520     """Opens the 
+00010900: 7477 6f20 6461 7461 6261 7365 7320 666f  two databases fo
+00010910: 7220 636f 6d70 6172 6973 6f6e 2c20 6966  r comparison, if
+00010920: 2070 6f73 7369 626c 652e 2222 220d 0a20   possible.""".. 
+00010930: 2020 2020 2020 2069 6620 6e6f 7420 6669         if not fi
+00010940: 6c65 6e61 6d65 3120 6f72 206e 6f74 2066  lename1 or not f
+00010950: 696c 656e 616d 6532 3a20 7265 7475 726e  ilename2: return
+00010960: 0d0a 0d0a 2020 2020 2020 2020 6966 2066  ....        if f
+00010970: 696c 656e 616d 6531 2069 6e20 7365 6c66  ilename1 in self
+00010980: 2e77 6f72 6b65 7273 5f69 6d70 6f72 743a  .workers_import:
+00010990: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+000109a0: 7475 726e 2077 782e 4d65 7373 6167 6542  turn wx.MessageB
+000109b0: 6f78 2822 2573 2069 7320 6375 7272 656e  ox("%s is curren
+000109c0: 746c 7920 6265 696e 6720 696d 706f 7274  tly being import
+000109d0: 6564 2074 6f2c 2063 616e 6e6f 7420 6f70  ed to, cannot op
+000109e0: 656e 2e22 2025 0d0a 2020 2020 2020 2020  en." %..        
+000109f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010a00: 2020 2020 2020 2020 2066 696c 656e 616d           filenam
+00010a10: 6531 2c20 636f 6e66 2e54 6974 6c65 2c20  e1, conf.Title, 
+00010a20: 7778 2e4f 4b20 7c20 7778 2e49 434f 4e5f  wx.OK | wx.ICON_
+00010a30: 5741 524e 494e 4729 0d0a 2020 2020 2020  WARNING)..      
+00010a40: 2020 6966 2066 696c 656e 616d 6532 2069    if filename2 i
+00010a50: 6e20 7365 6c66 2e77 6f72 6b65 7273 5f69  n self.workers_i
+00010a60: 6d70 6f72 743a 0d0a 2020 2020 2020 2020  mport:..        
+00010a70: 2020 2020 7265 7475 726e 2077 782e 4d65      return wx.Me
+00010a80: 7373 6167 6542 6f78 2822 2573 2069 7320  ssageBox("%s is 
+00010a90: 6375 7272 656e 746c 7920 6265 696e 6720  currently being 
+00010aa0: 696d 706f 7274 6564 2074 6f2c 2063 616e  imported to, can
+00010ab0: 6e6f 7420 6f70 656e 2e22 2025 0d0a 2020  not open." %..  
+00010ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010ad0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00010ae0: 696c 656e 616d 6532 2c20 636f 6e66 2e54  ilename2, conf.T
+00010af0: 6974 6c65 2c20 7778 2e4f 4b20 7c20 7778  itle, wx.OK | wx
+00010b00: 2e49 434f 4e5f 5741 524e 494e 4729 0d0a  .ICON_WARNING)..
+00010b10: 0d0a 2020 2020 2020 2020 7469 746c 6520  ..        title 
+00010b20: 3d20 2244 6174 6162 6173 6520 636f 6d70  = "Database comp
+00010b30: 6172 6973 6f6e 220d 0a20 2020 2020 2020  arison"..       
+00010b40: 2064 6231 2c20 6462 322c 2070 6167 6520   db1, db2, page 
+00010b50: 3d20 4e6f 6e65 2c20 4e6f 6e65 2c20 4e6f  = None, None, No
+00010b60: 6e65 0d0a 2020 2020 2020 2020 6966 2069  ne..        if i
+00010b70: 735f 6578 706f 7274 3a0d 0a20 2020 2020  s_export:..     
+00010b80: 2020 2020 2020 2064 6232 203d 206c 6976         db2 = liv
+00010b90: 652e 536b 7970 6545 7870 6f72 7428 6669  e.SkypeExport(fi
+00010ba0: 6c65 6e61 6d65 3229 0d0a 2020 2020 2020  lename2)..      
+00010bb0: 2020 2020 2020 6462 3120 3d20 7365 6c66        db1 = self
+00010bc0: 2e6c 6f61 645f 6461 7461 6261 7365 2866  .load_database(f
+00010bd0: 696c 656e 616d 6531 290d 0a20 2020 2020  ilename1)..     
+00010be0: 2020 2020 2020 2074 6974 6c65 203d 2022         title = "
+00010bf0: 4d65 7267 6520 6672 6f6d 2053 6b79 7065  Merge from Skype
+00010c00: 2065 7870 6f72 7422 0d0a 2020 2020 2020   export"..      
+00010c10: 2020 6966 206e 6f74 2064 6231 2061 6e64    if not db1 and
+00010c20: 206e 6f74 2069 735f 6578 706f 7274 3a0d   not is_export:.
+00010c30: 0a20 2020 2020 2020 2020 2020 2064 6231  .            db1
+00010c40: 203d 2073 656c 662e 6c6f 6164 5f64 6174   = self.load_dat
+00010c50: 6162 6173 6528 6669 6c65 6e61 6d65 3129  abase(filename1)
+00010c60: 0d0a 2020 2020 2020 2020 6966 2064 6231  ..        if db1
+00010c70: 2061 6e64 206e 6f74 2064 6232 3a0d 0a20   and not db2:.. 
+00010c80: 2020 2020 2020 2020 2020 2064 6232 203d             db2 =
+00010c90: 2073 656c 662e 6c6f 6164 5f64 6174 6162   self.load_datab
+00010ca0: 6173 6528 6669 6c65 6e61 6d65 3229 0d0a  ase(filename2)..
+00010cb0: 2020 2020 2020 2020 6966 2064 6231 2061          if db1 a
+00010cc0: 6e64 2064 6232 3a0d 0a20 2020 2020 2020  nd db2:..       
+00010cd0: 2020 2020 2064 6273 6574 203d 2073 6574       dbset = set
+00010ce0: 286d 6170 2873 7472 2c20 2864 6231 2c20  (map(str, (db1, 
+00010cf0: 6462 3229 2929 0d0a 2020 2020 2020 2020  db2)))..        
+00010d00: 2020 2020 7061 6765 203d 206e 6578 7428      page = next(
+00010d10: 2878 2066 6f72 2078 2069 6e20 7365 6c66  (x for x in self
+00010d20: 2e6d 6572 6765 725f 7061 6765 730d 0a20  .merger_pages.. 
+00010d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010d40: 2020 2020 2020 2020 6966 2078 2061 6e64          if x and
+00010d50: 2073 6574 286d 6170 2873 7472 2c20 2878   set(map(str, (x
+00010d60: 2e64 6231 2c20 782e 6462 3229 2929 203d  .db1, x.db2))) =
+00010d70: 3d20 6462 7365 7429 2c20 4e6f 6e65 290d  = dbset), None).
+00010d80: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00010d90: 6e6f 7420 7061 6765 3a0d 0a20 2020 2020  not page:..     
+00010da0: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
+00010db0: 722e 696e 666f 2822 4d65 7267 6520 7061  r.info("Merge pa
+00010dc0: 6765 2066 6f72 2025 7320 616e 6420 2573  ge for %s and %s
+00010dd0: 2e22 2c20 6462 312c 2064 6232 290d 0a20  .", db1, db2).. 
+00010de0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00010df0: 6167 6520 3d20 4d65 7267 6572 5061 6765  age = MergerPage
+00010e00: 2873 656c 662e 6e6f 7465 626f 6f6b 2c20  (self.notebook, 
+00010e10: 6462 322c 2064 6231 2c0d 0a20 2020 2020  db2, db1,..     
 00010e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010e30: 6462 2e63 6c6f 7365 2829 0d0a 2020 2020  db.close()..    
-00010e40: 2020 2020 6966 2070 6167 653a 0d0a 2020      if page:..  
-00010e50: 2020 2020 2020 2020 2020 666f 7220 6920            for i 
-00010e60: 696e 2072 616e 6765 2873 656c 662e 6e6f  in range(self.no
-00010e70: 7465 626f 6f6b 2e47 6574 5061 6765 436f  tebook.GetPageCo
-00010e80: 756e 7428 2929 3a0d 0a20 2020 2020 2020  unt()):..       
-00010e90: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-00010ea0: 2e6e 6f74 6562 6f6f 6b2e 4765 7450 6167  .notebook.GetPag
-00010eb0: 6528 6929 203d 3d20 7061 6765 3a0d 0a20  e(i) == page:.. 
-00010ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010ed0: 2020 2073 656c 662e 6e6f 7465 626f 6f6b     self.notebook
-00010ee0: 2e53 6574 5365 6c65 6374 696f 6e28 6929  .SetSelection(i)
-00010ef0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00010f00: 2020 2020 2020 7365 6c66 2e75 7064 6174        self.updat
-00010f10: 655f 6e6f 7465 626f 6f6b 5f68 6561 6465  e_notebook_heade
-00010f20: 7228 290d 0a20 2020 2020 2020 2020 2020  r()..           
-00010f30: 2020 2020 2020 2020 2062 7265 616b 2023           break #
-00010f40: 2066 6f72 2069 0d0a 0d0a 0d0a 2020 2020   for i......    
-00010f50: 6465 6620 6f6e 5f63 6f6d 7061 7265 5f64  def on_compare_d
-00010f60: 6174 6162 6173 6573 2873 656c 662c 2065  atabases(self, e
-00010f70: 7665 6e74 293a 0d0a 2020 2020 2020 2020  vent):..        
-00010f80: 2222 220d 0a20 2020 2020 2020 2048 616e  """..        Han
-00010f90: 646c 6572 2066 6f72 2063 6c69 636b 696e  dler for clickin
-00010fa0: 6720 746f 2063 6f6d 7061 7265 2061 2073  g to compare a s
-00010fb0: 656c 6563 7465 6420 6461 7461 6261 7365  elected database
-00010fc0: 2077 6974 6820 616e 6f74 6865 722c 2073   with another, s
-00010fd0: 686f 7773 0d0a 2020 2020 2020 2020 6120  hows..        a 
-00010fe0: 706f 7075 7020 6d65 6e75 2066 6f72 2063  popup menu for c
-00010ff0: 686f 6f73 696e 6720 7468 6520 7365 636f  hoosing the seco
-00011000: 6e64 2064 6174 6162 6173 6520 6669 6c65  nd database file
-00011010: 2e0d 0a20 2020 2020 2020 2022 2222 0d0a  ...        """..
-00011020: 2020 2020 2020 2020 666d 203d 2077 782e          fm = wx.
-00011030: 6c69 622e 6167 772e 666c 6174 6d65 6e75  lib.agw.flatmenu
-00011040: 0d0a 2020 2020 2020 2020 6d65 6e75 203d  ..        menu =
-00011050: 2066 6d2e 466c 6174 4d65 6e75 2829 0d0a   fm.FlatMenu()..
-00011060: 2020 2020 2020 2020 6974 656d 203d 2066          item = f
-00011070: 6d2e 466c 6174 4d65 6e75 4974 656d 286d  m.FlatMenuItem(m
-00011080: 656e 752c 2077 782e 4944 5f41 4e59 2c0d  enu, wx.ID_ANY,.
-00011090: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000110a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000110b0: 2226 5365 6c65 6374 2061 2066 696c 6520  "&Select a file 
-000110c0: 6672 6f6d 2079 6f75 7220 636f 6d70 7574  from your comput
-000110d0: 6572 2e2e 2229 0d0a 2020 2020 2020 2020  er..")..        
-000110e0: 6d65 6e75 2e41 7070 656e 6449 7465 6d28  menu.AppendItem(
-000110f0: 6974 656d 290d 0a20 2020 2020 2020 2069  item)..        i
-00011100: 6620 6c69 7665 2e69 6a73 6f6e 3a0d 0a20  f live.ijson:.. 
-00011110: 2020 2020 2020 2020 2020 2069 7465 6d20             item 
-00011120: 3d20 666d 2e46 6c61 744d 656e 7549 7465  = fm.FlatMenuIte
-00011130: 6d28 6d65 6e75 2c20 7778 2e49 445f 414e  m(menu, wx.ID_AN
-00011140: 592c 0d0a 2020 2020 2020 2020 2020 2020  Y,..            
-00011150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011160: 2020 2020 2020 2022 5365 6c65 6374 2061         "Select a
-00011170: 2053 6b79 7065 2063 6861 7420 6869 7374   Skype chat hist
-00011180: 6f72 7920 2665 7870 6f72 7420 6172 6368  ory &export arch
-00011190: 6976 6520 6672 6f6d 2079 6f75 7220 636f  ive from your co
-000111a0: 6d70 7574 6572 2e2e 2229 0d0a 2020 2020  mputer..")..    
-000111b0: 2020 2020 2020 2020 6d65 6e75 2e41 7070          menu.App
-000111c0: 656e 6449 7465 6d28 6974 656d 290d 0a20  endItem(item).. 
-000111d0: 2020 2020 2020 2072 6563 656e 7473 203d         recents =
-000111e0: 205b 6620 666f 7220 6620 696e 2063 6f6e   [f for f in con
-000111f0: 662e 5265 6365 6e74 4669 6c65 7320 6966  f.RecentFiles if
-00011200: 2066 2021 3d20 7365 6c66 2e64 625f 6669   f != self.db_fi
-00011210: 6c65 6e61 6d65 5d5b 3a35 5d0d 0a20 2020  lename][:5]..   
-00011220: 2020 2020 206f 7468 6572 7320 3d20 5b66       others = [f
-00011230: 2066 6f72 2066 2069 6e20 636f 6e66 2e44   for f in conf.D
-00011240: 4246 696c 6573 0d0a 2020 2020 2020 2020  BFiles..        
-00011250: 2020 2020 2020 2020 2020 6966 2066 206e            if f n
-00011260: 6f74 2069 6e20 7265 6365 6e74 7320 616e  ot in recents an
-00011270: 6420 6620 213d 2073 656c 662e 6462 5f66  d f != self.db_f
-00011280: 696c 656e 616d 655d 0d0a 2020 2020 2020  ilename]..      
-00011290: 2020 6966 2072 6563 656e 7473 206f 7220    if recents or 
-000112a0: 6f74 6865 7273 3a0d 0a20 2020 2020 2020  others:..       
-000112b0: 2020 2020 206d 656e 752e 4170 7065 6e64       menu.Append
-000112c0: 5365 7061 7261 746f 7228 290d 0a20 2020  Separator()..   
-000112d0: 2020 2020 2069 6620 7265 6365 6e74 733a       if recents:
-000112e0: 0d0a 2020 2020 2020 2020 2020 2020 6974  ..            it
-000112f0: 656d 203d 2066 6d2e 466c 6174 4d65 6e75  em = fm.FlatMenu
-00011300: 4974 656d 286d 656e 752c 2077 782e 4944  Item(menu, wx.ID
-00011310: 5f41 4e59 2c20 2252 6563 656e 7420 6669  _ANY, "Recent fi
-00011320: 6c65 7322 290d 0a20 2020 2020 2020 2020  les")..         
-00011330: 2020 2069 7465 6d2e 456e 6162 6c65 2846     item.Enable(F
-00011340: 616c 7365 290d 0a20 2020 2020 2020 2020  alse)..         
-00011350: 2020 206d 656e 752e 4170 7065 6e64 4974     menu.AppendIt
-00011360: 656d 2869 7465 6d29 0d0a 2020 2020 2020  em(item)..      
-00011370: 2020 2020 2020 666f 7220 692c 2066 2069        for i, f i
-00011380: 6e20 656e 756d 6572 6174 6528 7265 6365  n enumerate(rece
-00011390: 6e74 732c 2031 293a 0d0a 2020 2020 2020  nts, 1):..      
-000113a0: 2020 2020 2020 2020 2020 6d65 6e75 2e41            menu.A
-000113b0: 7070 656e 6449 7465 6d28 0d0a 2020 2020  ppendItem(..    
-000113c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000113d0: 666d 2e46 6c61 744d 656e 7549 7465 6d28  fm.FlatMenuItem(
-000113e0: 6d65 6e75 2c20 7778 2e49 445f 414e 592c  menu, wx.ID_ANY,
-000113f0: 2022 2625 7320 2573 2220 2520 2869 2c20   "&%s %s" % (i, 
-00011400: 6629 2929 0d0a 2020 2020 2020 2020 2020  f)))..          
-00011410: 2020 6966 206f 7468 6572 733a 0d0a 2020    if others:..  
-00011420: 2020 2020 2020 2020 2020 2020 2020 6d65                me
-00011430: 6e75 2e41 7070 656e 6453 6570 6172 6174  nu.AppendSeparat
-00011440: 6f72 2829 0d0a 2020 2020 2020 2020 2020  or()..          
-00011450: 2020 2020 2020 6974 656d 203d 2066 6d2e        item = fm.
-00011460: 466c 6174 4d65 6e75 4974 656d 286d 656e  FlatMenuItem(men
-00011470: 752c 2077 782e 4944 5f41 4e59 2c20 2252  u, wx.ID_ANY, "R
-00011480: 6573 7420 6f66 206c 6973 7422 290d 0a20  est of list").. 
-00011490: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000114a0: 7465 6d2e 456e 6162 6c65 2846 616c 7365  tem.Enable(False
-000114b0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-000114c0: 2020 206d 656e 752e 4170 7065 6e64 4974     menu.AppendIt
-000114d0: 656d 2869 7465 6d29 0d0a 2020 2020 2020  em(item)..      
-000114e0: 2020 666f 7220 692c 2066 2069 6e20 656e    for i, f in en
-000114f0: 756d 6572 6174 6528 736f 7274 6564 286f  umerate(sorted(o
-00011500: 7468 6572 7329 293a 0d0a 2020 2020 2020  thers)):..      
-00011510: 2020 2020 2020 6d65 6e75 2e41 7070 656e        menu.Appen
-00011520: 6449 7465 6d28 666d 2e46 6c61 744d 656e  dItem(fm.FlatMen
-00011530: 7549 7465 6d28 0d0a 2020 2020 2020 2020  uItem(..        
-00011540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011550: 2020 2020 6d65 6e75 2c20 7778 2e49 445f      menu, wx.ID_
-00011560: 414e 592c 2022 2625 7320 2573 2220 2520  ANY, "&%s %s" % 
-00011570: 2863 6872 2839 372b 6925 3236 292c 2066  (chr(97+i%26), f
-00011580: 2929 290d 0a20 2020 2020 2020 2066 6f72  )))..        for
-00011590: 2069 7465 6d20 696e 206d 656e 752e 4765   item in menu.Ge
-000115a0: 744d 656e 7549 7465 6d73 2829 3a0d 0a20  tMenuItems():.. 
-000115b0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000115c0: 4269 6e64 2877 782e 4556 545f 4d45 4e55  Bind(wx.EVT_MENU
-000115d0: 2c20 7365 6c66 2e6f 6e5f 636f 6d70 6172  , self.on_compar
-000115e0: 655f 6d65 6e75 2c20 6974 656d 290d 0a0d  e_menu, item)...
-000115f0: 0a20 2020 2020 2020 2062 746e 203d 2073  .        btn = s
-00011600: 656c 662e 6275 7474 6f6e 5f63 6f6d 7061  elf.button_compa
-00011610: 7265 0d0a 2020 2020 2020 2020 737a 5f62  re..        sz_b
-00011620: 746e 2c20 7074 5f62 746e 203d 2062 746e  tn, pt_btn = btn
-00011630: 2e53 697a 652c 2062 746e 2e50 6f73 6974  .Size, btn.Posit
-00011640: 696f 6e0d 0a20 2020 2020 2020 2070 745f  ion..        pt_
-00011650: 6274 6e20 3d20 6274 6e2e 5061 7265 6e74  btn = btn.Parent
-00011660: 2e43 6c69 656e 7454 6f53 6372 6565 6e28  .ClientToScreen(
-00011670: 7074 5f62 746e 290d 0a20 2020 2020 2020  pt_btn)..       
-00011680: 206d 656e 752e 5365 744f 776e 6572 4865   menu.SetOwnerHe
-00011690: 6967 6874 2873 7a5f 6274 6e2e 7929 0d0a  ight(sz_btn.y)..
-000116a0: 2020 2020 2020 2020 6966 206d 656e 752e          if menu.
-000116b0: 5369 7a65 2e77 6964 7468 203c 2073 7a5f  Size.width < sz_
-000116c0: 6274 6e2e 7769 6474 683a 0d0a 2020 2020  btn.width:..    
-000116d0: 2020 2020 2020 2020 6d65 6e75 2e53 697a          menu.Siz
-000116e0: 6520 3d20 737a 5f62 746e 2e77 6964 7468  e = sz_btn.width
-000116f0: 2c20 6d65 6e75 2e53 697a 652e 6865 6967  , menu.Size.heig
-00011700: 6874 0d0a 2020 2020 2020 2020 6d65 6e75  ht..        menu
-00011710: 2e50 6f70 7570 2870 745f 6274 6e2c 2073  .Popup(pt_btn, s
-00011720: 656c 6629 0d0a 0d0a 0d0a 2020 2020 6465  elf)......    de
-00011730: 6620 6f6e 5f6f 7065 6e5f 6f70 7469 6f6e  f on_open_option
-00011740: 7328 7365 6c66 2c20 6576 656e 7429 3a0d  s(self, event):.
-00011750: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
-00011760: 2020 2020 2020 4861 6e64 6c65 7220 666f        Handler fo
-00011770: 7220 6f70 656e 696e 6720 6164 7661 6e63  r opening advanc
-00011780: 6564 206f 7074 696f 6e73 2c20 6372 6561  ed options, crea
-00011790: 7465 7320 7468 6520 7072 6f70 6572 7479  tes the property
-000117a0: 2064 6961 6c6f 670d 0a20 2020 2020 2020   dialog..       
-000117b0: 2061 6e64 2073 6176 6573 2076 616c 7565   and saves value
-000117c0: 732e 0d0a 2020 2020 2020 2020 2222 220d  s...        """.
-000117d0: 0a20 2020 2020 2020 2064 6961 6c6f 6720  .        dialog 
-000117e0: 3d20 636f 6e74 726f 6c73 2e50 726f 7065  = controls.Prope
-000117f0: 7274 7944 6961 6c6f 6728 7365 6c66 2c20  rtyDialog(self, 
-00011800: 7469 746c 653d 2241 6476 616e 6365 6420  title="Advanced 
-00011810: 6f70 7469 6f6e 7322 290d 0a0d 0a20 2020  options")....   
-00011820: 2020 2020 2074 7279 3a20 736f 7572 6365       try: source
-00011830: 203d 2069 6e73 7065 6374 2e67 6574 736f   = inspect.getso
-00011840: 7572 6365 2863 6f6e 6629 0d0a 2020 2020  urce(conf)..    
-00011850: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
-00011860: 7469 6f6e 3a0d 0a20 2020 2020 2020 2020  tion:..         
-00011870: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
-00011880: 2020 2020 2020 2020 2077 6974 6820 6f70           with op
-00011890: 656e 286f 732e 7061 7468 2e6a 6f69 6e28  en(os.path.join(
-000118a0: 636f 6e66 2e52 6573 6f75 7263 6544 6972  conf.ResourceDir
-000118b0: 6563 746f 7279 2c20 222e 2e22 2c20 2263  ectory, "..", "c
-000118c0: 6f6e 662e 7079 2229 2920 6173 2066 3a0d  onf.py")) as f:.
-000118d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000118e0: 2020 2020 2073 6f75 7263 6520 3d20 662e       source = f.
-000118f0: 7265 6164 2829 0d0a 2020 2020 2020 2020  read()..        
-00011900: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
-00011910: 7469 6f6e 3a20 736f 7572 6365 203d 2022  tion: source = "
-00011920: 220d 0a0d 0a20 2020 2020 2020 2064 6566  "....        def
-00011930: 2067 6574 5f66 6965 6c64 5f64 6f63 286e   get_field_doc(n
-00011940: 616d 652c 2074 7265 653d 6173 742e 7061  ame, tree=ast.pa
-00011950: 7273 6528 736f 7572 6365 2929 3a0d 0a20  rse(source)):.. 
-00011960: 2020 2020 2020 2020 2020 2022 2222 5265             """Re
-00011970: 7475 726e 7320 7468 6520 646f 6373 7472  turns the docstr
-00011980: 696e 6720 696d 6d65 6469 6174 656c 7920  ing immediately 
-00011990: 6265 666f 7265 206e 616d 6520 6173 7369  before name assi
-000119a0: 676e 6d65 6e74 2e22 2222 0d0a 2020 2020  gnment."""..    
-000119b0: 2020 2020 2020 2020 666f 7220 692c 206e          for i, n
-000119c0: 6f64 6520 696e 2065 6e75 6d65 7261 7465  ode in enumerate
-000119d0: 2874 7265 652e 626f 6479 293a 0d0a 2020  (tree.body):..  
-000119e0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-000119f0: 2069 2061 6e64 2069 7369 6e73 7461 6e63   i and isinstanc
-00011a00: 6528 6e6f 6465 2c20 6173 742e 4173 7369  e(node, ast.Assi
-00011a10: 676e 2920 616e 6420 6e6f 6465 2e74 6172  gn) and node.tar
-00011a20: 6765 7473 5b30 5d2e 6964 203d 3d20 6e61  gets[0].id == na
-00011a30: 6d65 3a0d 0a20 2020 2020 2020 2020 2020  me:..           
-00011a40: 2020 2020 2020 2020 2070 7265 7620 3d20           prev = 
-00011a50: 7472 6565 2e62 6f64 795b 6920 2d20 315d  tree.body[i - 1]
-00011a60: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00011a70: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-00011a80: 6e63 6528 7072 6576 2c20 6173 742e 4578  nce(prev, ast.Ex
-00011a90: 7072 2920 5c0d 0a20 2020 2020 2020 2020  pr) \..         
-00011aa0: 2020 2020 2020 2020 2020 2061 6e64 2069             and i
-00011ab0: 7369 6e73 7461 6e63 6528 7072 6576 2e76  sinstance(prev.v
-00011ac0: 616c 7565 2c20 2861 7374 2e53 7472 2c20  alue, (ast.Str, 
-00011ad0: 6173 742e 436f 6e73 7461 6e74 2929 3a20  ast.Constant)): 
-00011ae0: 2023 2050 7932 3a20 5374 722c 2050 7933   # Py2: Str, Py3
-00011af0: 3a20 436f 6e73 7461 6e74 0d0a 2020 2020  : Constant..    
-00011b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011b10: 2020 2020 7265 7475 726e 2070 7265 762e      return prev.
-00011b20: 7661 6c75 652e 732e 7374 7269 7028 290d  value.s.strip().
-00011b30: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00011b40: 7572 6e20 2222 0d0a 0d0a 2020 2020 2020  urn ""....      
-00011b50: 2020 6465 6620 7479 7065 6c69 7374 286d    def typelist(m
-00011b60: 7974 7970 6529 3a0d 0a20 2020 2020 2020  ytype):..       
-00011b70: 2020 2020 2064 6566 2063 6f6e 7665 7274       def convert
-00011b80: 2876 293a 0d0a 2020 2020 2020 2020 2020  (v):..          
-00011b90: 2020 2020 2020 7620 3d20 6173 742e 6c69        v = ast.li
-00011ba0: 7465 7261 6c5f 6576 616c 2876 2920 6966  teral_eval(v) if
-00011bb0: 2069 7369 6e73 7461 6e63 6528 762c 2073   isinstance(v, s
-00011bc0: 6978 2e73 7472 696e 675f 7479 7065 7329  ix.string_types)
-00011bd0: 2065 6c73 6520 760d 0a20 2020 2020 2020   else v..       
-00011be0: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-00011bf0: 6973 696e 7374 616e 6365 2876 2c20 286c  isinstance(v, (l
-00011c00: 6973 742c 2074 7570 6c65 2929 3a20 7620  ist, tuple)): v 
-00011c10: 3d20 7475 706c 6528 5b76 5d29 0d0a 2020  = tuple([v])..  
-00011c20: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00011c30: 206e 6f74 2076 3a20 7261 6973 6520 5661   not v: raise Va
-00011c40: 6c75 6545 7272 6f72 2822 456d 7074 7920  lueError("Empty 
-00011c50: 636f 6c6c 6563 7469 6f6e 2229 0d0a 2020  collection")..  
-00011c60: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00011c70: 7475 726e 2074 7570 6c65 286d 6170 286d  turn tuple(map(m
-00011c80: 7974 7970 652c 2076 2929 0d0a 2020 2020  ytype, v))..    
-00011c90: 2020 2020 2020 2020 636f 6e76 6572 742e          convert.
-00011ca0: 5f5f 6e61 6d65 5f5f 203d 2022 7475 706c  __name__ = "tupl
-00011cb0: 6528 2573 2922 2025 206d 7974 7970 652e  e(%s)" % mytype.
-00011cc0: 5f5f 6e61 6d65 5f5f 0d0a 2020 2020 2020  __name__..      
-00011cd0: 2020 2020 2020 7265 7475 726e 2063 6f6e        return con
-00011ce0: 7665 7274 0d0a 0d0a 2020 2020 2020 2020  vert....        
-00011cf0: 666f 7220 6e61 6d65 2069 6e20 736f 7274  for name in sort
-00011d00: 6564 2863 6f6e 662e 4f70 7469 6f6e 616c  ed(conf.Optional
-00011d10: 4669 6c65 4469 7265 6374 6976 6573 293a  FileDirectives):
-00011d20: 0d0a 2020 2020 2020 2020 2020 2020 7661  ..            va
-00011d30: 6c75 652c 2068 656c 7020 3d20 6765 7461  lue, help = geta
-00011d40: 7474 7228 636f 6e66 2c20 6e61 6d65 2c20  ttr(conf, name, 
-00011d50: 4e6f 6e65 292c 2067 6574 5f66 6965 6c64  None), get_field
-00011d60: 5f64 6f63 286e 616d 6529 0d0a 2020 2020  _doc(name)..    
-00011d70: 2020 2020 2020 2020 6465 6661 756c 7420          default 
-00011d80: 3d20 636f 6e66 2e44 6566 6175 6c74 732e  = conf.Defaults.
-00011d90: 6765 7428 6e61 6d65 290d 0a20 2020 2020  get(name)..     
-00011da0: 2020 2020 2020 2069 6620 7661 6c75 6520         if value 
-00011db0: 6973 204e 6f6e 6520 616e 6420 6465 6661  is None and defa
-00011dc0: 756c 7420 6973 204e 6f6e 653a 0d0a 2020  ult is None:..  
-00011dd0: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00011de0: 6e74 696e 7565 2023 2066 6f72 206e 616d  ntinue # for nam
-00011df0: 650d 0a0d 0a20 2020 2020 2020 2020 2020  e....           
-00011e00: 206b 696e 6420 3d20 7479 7065 2876 616c   kind = type(val
-00011e10: 7565 290d 0a20 2020 2020 2020 2020 2020  ue)..           
-00011e20: 2069 6620 6973 696e 7374 616e 6365 2876   if isinstance(v
-00011e30: 616c 7565 2c20 2874 7570 6c65 2c20 6c69  alue, (tuple, li
-00011e40: 7374 2929 3a0d 0a20 2020 2020 2020 2020  st)):..         
-00011e50: 2020 2020 2020 206b 696e 6420 3d20 7479         kind = ty
-00011e60: 7065 6c69 7374 2874 7970 6528 7661 6c75  pelist(type(valu
-00011e70: 655b 305d 2929 0d0a 2020 2020 2020 2020  e[0]))..        
-00011e80: 2020 2020 2020 2020 6465 6661 756c 7420          default 
-00011e90: 3d20 6b69 6e64 2864 6566 6175 6c74 290d  = kind(default).
-00011ea0: 0a20 2020 2020 2020 2020 2020 2064 6961  .            dia
-00011eb0: 6c6f 672e 4164 6450 726f 7065 7274 7928  log.AddProperty(
-00011ec0: 6e61 6d65 2c20 7661 6c75 652c 2068 656c  name, value, hel
-00011ed0: 702c 2064 6566 6175 6c74 2c20 6b69 6e64  p, default, kind
-00011ee0: 290d 0a20 2020 2020 2020 2064 6961 6c6f  )..        dialo
-00011ef0: 672e 5265 616c 697a 6528 290d 0a0d 0a20  g.Realize().... 
-00011f00: 2020 2020 2020 2069 6620 7778 2e49 445f         if wx.ID_
-00011f10: 4f4b 203d 3d20 6469 616c 6f67 2e53 686f  OK == dialog.Sho
-00011f20: 774d 6f64 616c 2829 3a0d 0a20 2020 2020  wModal():..     
-00011f30: 2020 2020 2020 2066 6f72 206b 2c20 7620         for k, v 
-00011f40: 696e 2064 6961 6c6f 672e 4765 7450 726f  in dialog.GetPro
-00011f50: 7065 7274 6965 7328 293a 0d0a 2020 2020  perties():..    
-00011f60: 2020 2020 2020 2020 2020 2020 2320 4b65              # Ke
-00011f70: 6570 206e 756d 6265 7273 2069 6e20 7361  ep numbers in sa
-00011f80: 6e65 2072 6567 696f 6e73 0d0a 2020 2020  ne regions..    
-00011f90: 2020 2020 2020 2020 2020 2020 6966 2074              if t
-00011fa0: 7970 6528 7629 2069 6e20 7369 782e 696e  ype(v) in six.in
-00011fb0: 7465 6765 725f 7479 7065 733a 2076 203d  teger_types: v =
-00011fc0: 206d 6178 2831 2c20 6d69 6e28 7379 732e   max(1, min(sys.
-00011fd0: 6d61 7873 697a 652c 2076 2929 0d0a 2020  maxsize, v))..  
-00011fe0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00011ff0: 7461 7474 7228 636f 6e66 2c20 6b2c 2076  tattr(conf, k, v
-00012000: 290d 0a20 2020 2020 2020 2020 2020 2075  )..            u
-00012010: 7469 6c2e 7275 6e5f 6f6e 6365 2863 6f6e  til.run_once(con
-00012020: 662e 7361 7665 290d 0a20 2020 2020 2020  f.save)..       
-00012030: 2020 2020 2073 656c 662e 4d69 6e53 697a       self.MinSiz
-00012040: 6520 3d20 636f 6e66 2e4d 696e 5769 6e64  e = conf.MinWind
-00012050: 6f77 5369 7a65 0d0a 0d0a 0d0a 2020 2020  owSize......    
-00012060: 6465 6620 6f6e 5f6e 6577 5f64 6174 6162  def on_new_datab
-00012070: 6173 6528 7365 6c66 2c20 6576 656e 7429  ase(self, event)
-00012080: 3a0d 0a20 2020 2020 2020 2022 2222 4861  :..        """Ha
-00012090: 6e64 6c65 7220 666f 7220 636c 6963 6b69  ndler for clicki
-000120a0: 6e67 206e 6577 2d62 7574 746f 6e20 6f6e  ng new-button on
-000120b0: 206d 6169 6e20 7363 7265 656e 2c20 6f70   main screen, op
-000120c0: 656e 7320 706f 7075 7020 6d65 6e75 2e22  ens popup menu."
-000120d0: 2222 0d0a 2020 2020 2020 2020 6966 206e  ""..        if n
-000120e0: 6f74 206c 6976 652e 736b 7079 2061 6e64  ot live.skpy and
-000120f0: 206e 6f74 206c 6976 652e 696a 736f 6e3a   not live.ijson:
-00012100: 2072 6574 7572 6e20 7365 6c66 2e6f 6e5f   return self.on_
-00012110: 6e65 775f 626c 616e 6b28 6576 656e 7429  new_blank(event)
-00012120: 0d0a 2020 2020 2020 2020 6d65 6e75 203d  ..        menu =
-00012130: 2077 782e 6c69 622e 6167 772e 666c 6174   wx.lib.agw.flat
-00012140: 6d65 6e75 2e46 6c61 744d 656e 7528 290d  menu.FlatMenu().
-00012150: 0a20 2020 2020 2020 2069 7465 6d5f 626c  .        item_bl
-00012160: 616e 6b20 203d 206d 656e 752e 4170 7065  ank  = menu.Appe
-00012170: 6e64 4974 656d 2877 782e 6c69 622e 6167  ndItem(wx.lib.ag
-00012180: 772e 666c 6174 6d65 6e75 2e46 6c61 744d  w.flatmenu.FlatM
-00012190: 656e 7549 7465 6d28 6d65 6e75 2c20 7778  enuItem(menu, wx
-000121a0: 2e49 445f 414e 592c 0d0a 2020 2020 2020  .ID_ANY,..      
-000121b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000121c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000121d0: 2226 426c 616e 6b20 536b 7970 6520 6461  "&Blank Skype da
-000121e0: 7461 6261 7365 2c20 706f 7075 6c61 7465  tabase, populate
-000121f0: 6420 7769 7468 2075 7365 726e 616d 6520  d with username 
-00012200: 6f6e 6c79 2229 290d 0a20 2020 2020 2020  only"))..       
-00012210: 2069 7465 6d5f 6c69 7665 2020 203d 206d   item_live   = m
-00012220: 656e 752e 4170 7065 6e64 4974 656d 2877  enu.AppendItem(w
-00012230: 782e 6c69 622e 6167 772e 666c 6174 6d65  x.lib.agw.flatme
-00012240: 6e75 2e46 6c61 744d 656e 7549 7465 6d28  nu.FlatMenuItem(
-00012250: 6d65 6e75 2c20 7778 2e49 445f 414e 592c  menu, wx.ID_ANY,
-00012260: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00012270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012280: 2020 2020 2020 2020 2246 726f 6d20 536b          "From Sk
-00012290: 7970 6520 6f6e 266c 696e 6520 7365 7276  ype on&line serv
-000122a0: 6963 652c 2062 7920 6c6f 6767 696e 6720  ice, by logging 
-000122b0: 696e 2022 0d0a 2020 2020 2020 2020 2020  in "..          
-000122c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000122d0: 2020 2020 2020 2020 2020 2020 2261 6e64              "and
-000122e0: 2064 6f77 6e6c 6f61 6469 6e67 2061 7661   downloading ava
-000122f0: 696c 6162 6c65 2068 6973 746f 7279 220d  ilable history".
-00012300: 0a20 2020 2020 2020 2029 2920 6966 206c  .        )) if l
-00012310: 6976 652e 736b 7079 2065 6c73 6520 4e6f  ive.skpy else No
-00012320: 6e65 0d0a 2020 2020 2020 2020 6974 656d  ne..        item
-00012330: 5f65 7870 6f72 7420 3d20 6d65 6e75 2e41  _export = menu.A
-00012340: 7070 656e 6449 7465 6d28 7778 2e6c 6962  ppendItem(wx.lib
-00012350: 2e61 6777 2e66 6c61 746d 656e 752e 466c  .agw.flatmenu.Fl
-00012360: 6174 4d65 6e75 4974 656d 286d 656e 752c  atMenuItem(menu,
-00012370: 2077 782e 4944 5f41 4e59 2c0d 0a20 2020   wx.ID_ANY,..   
-00012380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010e30: 2020 7365 6c66 2e67 6574 5f75 6e69 7175    self.get_uniqu
+00010e40: 655f 7461 625f 7469 746c 6528 7469 746c  e_tab_title(titl
+00010e50: 6529 290d 0a20 2020 2020 2020 2020 2020  e))..           
+00010e60: 2020 2020 2073 656c 662e 6d65 7267 6572       self.merger
+00010e70: 5f70 6167 6573 5b70 6167 655d 203d 2028  _pages[page] = (
+00010e80: 6462 312c 2064 6232 290d 0a20 2020 2020  db1, db2)..     
+00010e90: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00010ea0: 5570 6461 7465 4163 6365 6c65 7261 746f  UpdateAccelerato
+00010eb0: 7273 2829 0d0a 2020 2020 2020 2020 2020  rs()..          
+00010ec0: 2020 2020 2020 7574 696c 2e72 756e 5f6f        util.run_o
+00010ed0: 6e63 6528 636f 6e66 2e73 6176 6529 0d0a  nce(conf.save)..
+00010ee0: 2020 2020 2020 2020 656c 6966 2064 6231          elif db1
+00010ef0: 206f 7220 6462 323a 0d0a 2020 2020 2020   or db2:..      
+00010f00: 2020 2020 2020 2320 436c 6f73 6520 4442        # Close DB
+00010f10: 2077 6974 6820 6e6f 206f 776e 6572 0d0a   with no owner..
+00010f20: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00010f30: 6462 2069 6e20 6669 6c74 6572 2862 6f6f  db in filter(boo
+00010f40: 6c2c 205b 6462 312c 2064 6232 5d29 3a0d  l, [db1, db2]):.
+00010f50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010f60: 2069 6620 6e6f 7420 6462 2e68 6173 5f63   if not db.has_c
+00010f70: 6f6e 7375 6d65 7273 2829 3a0d 0a20 2020  onsumers():..   
+00010f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010f90: 206c 6f67 6765 722e 696e 666f 2822 436c   logger.info("Cl
+00010fa0: 6f73 6564 2064 6174 6162 6173 6520 2573  osed database %s
+00010fb0: 2e22 2c20 6462 2e66 696c 656e 616d 6529  .", db.filename)
+00010fc0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00010fd0: 2020 2020 2020 7365 6c66 2e64 6273 2e70        self.dbs.p
+00010fe0: 6f70 2864 622e 6669 6c65 6e61 6d65 2c20  op(db.filename, 
+00010ff0: 4e6f 6e65 290d 0a20 2020 2020 2020 2020  None)..         
+00011000: 2020 2020 2020 2020 2020 2064 622e 636c             db.cl
+00011010: 6f73 6528 290d 0a20 2020 2020 2020 2069  ose()..        i
+00011020: 6620 7061 6765 3a0d 0a20 2020 2020 2020  f page:..       
+00011030: 2020 2020 2066 6f72 2069 2069 6e20 7261       for i in ra
+00011040: 6e67 6528 7365 6c66 2e6e 6f74 6562 6f6f  nge(self.noteboo
+00011050: 6b2e 4765 7450 6167 6543 6f75 6e74 2829  k.GetPageCount()
+00011060: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00011070: 2020 2020 6966 2073 656c 662e 6e6f 7465      if self.note
+00011080: 626f 6f6b 2e47 6574 5061 6765 2869 2920  book.GetPage(i) 
+00011090: 3d3d 2070 6167 653a 0d0a 2020 2020 2020  == page:..      
+000110a0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+000110b0: 6c66 2e6e 6f74 6562 6f6f 6b2e 5365 7453  lf.notebook.SetS
+000110c0: 656c 6563 7469 6f6e 2869 290d 0a20 2020  election(i)..   
+000110d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000110e0: 2073 656c 662e 7570 6461 7465 5f6e 6f74   self.update_not
+000110f0: 6562 6f6f 6b5f 6865 6164 6572 2829 0d0a  ebook_header()..
+00011100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011110: 2020 2020 6272 6561 6b20 2320 666f 7220      break # for 
+00011120: 690d 0a0d 0a0d 0a20 2020 2064 6566 206f  i......    def o
+00011130: 6e5f 636f 6d70 6172 655f 6461 7461 6261  n_compare_databa
+00011140: 7365 7328 7365 6c66 2c20 6576 656e 7429  ses(self, event)
+00011150: 3a0d 0a20 2020 2020 2020 2022 2222 0d0a  :..        """..
+00011160: 2020 2020 2020 2020 4861 6e64 6c65 7220          Handler 
+00011170: 666f 7220 636c 6963 6b69 6e67 2074 6f20  for clicking to 
+00011180: 636f 6d70 6172 6520 6120 7365 6c65 6374  compare a select
+00011190: 6564 2064 6174 6162 6173 6520 7769 7468  ed database with
+000111a0: 2061 6e6f 7468 6572 2c20 7368 6f77 730d   another, shows.
+000111b0: 0a20 2020 2020 2020 2061 2070 6f70 7570  .        a popup
+000111c0: 206d 656e 7520 666f 7220 6368 6f6f 7369   menu for choosi
+000111d0: 6e67 2074 6865 2073 6563 6f6e 6420 6461  ng the second da
+000111e0: 7461 6261 7365 2066 696c 652e 0d0a 2020  tabase file...  
+000111f0: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
+00011200: 2020 2066 6d20 3d20 7778 2e6c 6962 2e61     fm = wx.lib.a
+00011210: 6777 2e66 6c61 746d 656e 750d 0a20 2020  gw.flatmenu..   
+00011220: 2020 2020 206d 656e 7520 3d20 666d 2e46       menu = fm.F
+00011230: 6c61 744d 656e 7528 290d 0a20 2020 2020  latMenu()..     
+00011240: 2020 2069 7465 6d20 3d20 666d 2e46 6c61     item = fm.Fla
+00011250: 744d 656e 7549 7465 6d28 6d65 6e75 2c20  tMenuItem(menu, 
+00011260: 7778 2e49 445f 414e 592c 0d0a 2020 2020  wx.ID_ANY,..    
+00011270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011280: 2020 2020 2020 2020 2020 2022 2653 656c             "&Sel
+00011290: 6563 7420 6120 6669 6c65 2066 726f 6d20  ect a file from 
+000112a0: 796f 7572 2063 6f6d 7075 7465 722e 2e22  your computer.."
+000112b0: 290d 0a20 2020 2020 2020 206d 656e 752e  )..        menu.
+000112c0: 4170 7065 6e64 4974 656d 2869 7465 6d29  AppendItem(item)
+000112d0: 0d0a 2020 2020 2020 2020 6966 206c 6976  ..        if liv
+000112e0: 652e 696a 736f 6e3a 0d0a 2020 2020 2020  e.ijson:..      
+000112f0: 2020 2020 2020 6974 656d 203d 2066 6d2e        item = fm.
+00011300: 466c 6174 4d65 6e75 4974 656d 286d 656e  FlatMenuItem(men
+00011310: 752c 2077 782e 4944 5f41 4e59 2c0d 0a20  u, wx.ID_ANY,.. 
+00011320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011340: 2020 2253 656c 6563 7420 6120 536b 7970    "Select a Skyp
+00011350: 6520 6368 6174 2068 6973 746f 7279 2026  e chat history &
+00011360: 6578 706f 7274 2061 7263 6869 7665 2066  export archive f
+00011370: 726f 6d20 796f 7572 2063 6f6d 7075 7465  rom your compute
+00011380: 722e 2e22 290d 0a20 2020 2020 2020 2020  r..")..         
+00011390: 2020 206d 656e 752e 4170 7065 6e64 4974     menu.AppendIt
+000113a0: 656d 2869 7465 6d29 0d0a 2020 2020 2020  em(item)..      
+000113b0: 2020 7265 6365 6e74 7320 3d20 5b66 2066    recents = [f f
+000113c0: 6f72 2066 2069 6e20 636f 6e66 2e52 6563  or f in conf.Rec
+000113d0: 656e 7446 696c 6573 2069 6620 6620 213d  entFiles if f !=
+000113e0: 2073 656c 662e 6462 5f66 696c 656e 616d   self.db_filenam
+000113f0: 655d 5b3a 355d 0d0a 2020 2020 2020 2020  e][:5]..        
+00011400: 6f74 6865 7273 203d 205b 6620 666f 7220  others = [f for 
+00011410: 6620 696e 2063 6f6e 662e 4442 4669 6c65  f in conf.DBFile
+00011420: 730d 0a20 2020 2020 2020 2020 2020 2020  s..             
+00011430: 2020 2020 2069 6620 6620 6e6f 7420 696e       if f not in
+00011440: 2072 6563 656e 7473 2061 6e64 2066 2021   recents and f !
+00011450: 3d20 7365 6c66 2e64 625f 6669 6c65 6e61  = self.db_filena
+00011460: 6d65 5d0d 0a20 2020 2020 2020 2069 6620  me]..        if 
+00011470: 7265 6365 6e74 7320 6f72 206f 7468 6572  recents or other
+00011480: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
+00011490: 6d65 6e75 2e41 7070 656e 6453 6570 6172  menu.AppendSepar
+000114a0: 6174 6f72 2829 0d0a 2020 2020 2020 2020  ator()..        
+000114b0: 6966 2072 6563 656e 7473 3a0d 0a20 2020  if recents:..   
+000114c0: 2020 2020 2020 2020 2069 7465 6d20 3d20           item = 
+000114d0: 666d 2e46 6c61 744d 656e 7549 7465 6d28  fm.FlatMenuItem(
+000114e0: 6d65 6e75 2c20 7778 2e49 445f 414e 592c  menu, wx.ID_ANY,
+000114f0: 2022 5265 6365 6e74 2066 696c 6573 2229   "Recent files")
+00011500: 0d0a 2020 2020 2020 2020 2020 2020 6974  ..            it
+00011510: 656d 2e45 6e61 626c 6528 4661 6c73 6529  em.Enable(False)
+00011520: 0d0a 2020 2020 2020 2020 2020 2020 6d65  ..            me
+00011530: 6e75 2e41 7070 656e 6449 7465 6d28 6974  nu.AppendItem(it
+00011540: 656d 290d 0a20 2020 2020 2020 2020 2020  em)..           
+00011550: 2066 6f72 2069 2c20 6620 696e 2065 6e75   for i, f in enu
+00011560: 6d65 7261 7465 2872 6563 656e 7473 2c20  merate(recents, 
+00011570: 3129 3a0d 0a20 2020 2020 2020 2020 2020  1):..           
+00011580: 2020 2020 206d 656e 752e 4170 7065 6e64       menu.Append
+00011590: 4974 656d 280d 0a20 2020 2020 2020 2020  Item(..         
+000115a0: 2020 2020 2020 2020 2020 2066 6d2e 466c             fm.Fl
+000115b0: 6174 4d65 6e75 4974 656d 286d 656e 752c  atMenuItem(menu,
+000115c0: 2077 782e 4944 5f41 4e59 2c20 2226 2573   wx.ID_ANY, "&%s
+000115d0: 2025 7322 2025 2028 692c 2066 2929 290d   %s" % (i, f))).
+000115e0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000115f0: 6f74 6865 7273 3a0d 0a20 2020 2020 2020  others:..       
+00011600: 2020 2020 2020 2020 206d 656e 752e 4170           menu.Ap
+00011610: 7065 6e64 5365 7061 7261 746f 7228 290d  pendSeparator().
+00011620: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011630: 2069 7465 6d20 3d20 666d 2e46 6c61 744d   item = fm.FlatM
+00011640: 656e 7549 7465 6d28 6d65 6e75 2c20 7778  enuItem(menu, wx
+00011650: 2e49 445f 414e 592c 2022 5265 7374 206f  .ID_ANY, "Rest o
+00011660: 6620 6c69 7374 2229 0d0a 2020 2020 2020  f list")..      
+00011670: 2020 2020 2020 2020 2020 6974 656d 2e45            item.E
+00011680: 6e61 626c 6528 4661 6c73 6529 0d0a 2020  nable(False)..  
+00011690: 2020 2020 2020 2020 2020 2020 2020 6d65                me
+000116a0: 6e75 2e41 7070 656e 6449 7465 6d28 6974  nu.AppendItem(it
+000116b0: 656d 290d 0a20 2020 2020 2020 2066 6f72  em)..        for
+000116c0: 2069 2c20 6620 696e 2065 6e75 6d65 7261   i, f in enumera
+000116d0: 7465 2873 6f72 7465 6428 6f74 6865 7273  te(sorted(others
+000116e0: 2929 3a0d 0a20 2020 2020 2020 2020 2020  )):..           
+000116f0: 206d 656e 752e 4170 7065 6e64 4974 656d   menu.AppendItem
+00011700: 2866 6d2e 466c 6174 4d65 6e75 4974 656d  (fm.FlatMenuItem
+00011710: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+00011720: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00011730: 656e 752c 2077 782e 4944 5f41 4e59 2c20  enu, wx.ID_ANY, 
+00011740: 2226 2573 2025 7322 2025 2028 6368 7228  "&%s %s" % (chr(
+00011750: 3937 2b69 2532 3629 2c20 6629 2929 0d0a  97+i%26), f)))..
+00011760: 2020 2020 2020 2020 666f 7220 6974 656d          for item
+00011770: 2069 6e20 6d65 6e75 2e47 6574 4d65 6e75   in menu.GetMenu
+00011780: 4974 656d 7328 293a 0d0a 2020 2020 2020  Items():..      
+00011790: 2020 2020 2020 7365 6c66 2e42 696e 6428        self.Bind(
+000117a0: 7778 2e45 5654 5f4d 454e 552c 2073 656c  wx.EVT_MENU, sel
+000117b0: 662e 6f6e 5f63 6f6d 7061 7265 5f6d 656e  f.on_compare_men
+000117c0: 752c 2069 7465 6d29 0d0a 0d0a 2020 2020  u, item)....    
+000117d0: 2020 2020 6274 6e20 3d20 7365 6c66 2e62      btn = self.b
+000117e0: 7574 746f 6e5f 636f 6d70 6172 650d 0a20  utton_compare.. 
+000117f0: 2020 2020 2020 2073 7a5f 6274 6e2c 2070         sz_btn, p
+00011800: 745f 6274 6e20 3d20 6274 6e2e 5369 7a65  t_btn = btn.Size
+00011810: 2c20 6274 6e2e 506f 7369 7469 6f6e 0d0a  , btn.Position..
+00011820: 2020 2020 2020 2020 7074 5f62 746e 203d          pt_btn =
+00011830: 2062 746e 2e50 6172 656e 742e 436c 6965   btn.Parent.Clie
+00011840: 6e74 546f 5363 7265 656e 2870 745f 6274  ntToScreen(pt_bt
+00011850: 6e29 0d0a 2020 2020 2020 2020 6d65 6e75  n)..        menu
+00011860: 2e53 6574 4f77 6e65 7248 6569 6768 7428  .SetOwnerHeight(
+00011870: 737a 5f62 746e 2e79 290d 0a20 2020 2020  sz_btn.y)..     
+00011880: 2020 2069 6620 6d65 6e75 2e53 697a 652e     if menu.Size.
+00011890: 7769 6474 6820 3c20 737a 5f62 746e 2e77  width < sz_btn.w
+000118a0: 6964 7468 3a0d 0a20 2020 2020 2020 2020  idth:..         
+000118b0: 2020 206d 656e 752e 5369 7a65 203d 2073     menu.Size = s
+000118c0: 7a5f 6274 6e2e 7769 6474 682c 206d 656e  z_btn.width, men
+000118d0: 752e 5369 7a65 2e68 6569 6768 740d 0a20  u.Size.height.. 
+000118e0: 2020 2020 2020 206d 656e 752e 506f 7075         menu.Popu
+000118f0: 7028 7074 5f62 746e 2c20 7365 6c66 290d  p(pt_btn, self).
+00011900: 0a0d 0a0d 0a20 2020 2064 6566 206f 6e5f  .....    def on_
+00011910: 6f70 656e 5f6f 7074 696f 6e73 2873 656c  open_options(sel
+00011920: 662c 2065 7665 6e74 293a 0d0a 2020 2020  f, event):..    
+00011930: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
+00011940: 2048 616e 646c 6572 2066 6f72 206f 7065   Handler for ope
+00011950: 6e69 6e67 2061 6476 616e 6365 6420 6f70  ning advanced op
+00011960: 7469 6f6e 732c 2063 7265 6174 6573 2074  tions, creates t
+00011970: 6865 2070 726f 7065 7274 7920 6469 616c  he property dial
+00011980: 6f67 0d0a 2020 2020 2020 2020 616e 6420  og..        and 
+00011990: 7361 7665 7320 7661 6c75 6573 2e0d 0a20  saves values... 
+000119a0: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
+000119b0: 2020 2020 6469 616c 6f67 203d 2063 6f6e      dialog = con
+000119c0: 7472 6f6c 732e 5072 6f70 6572 7479 4469  trols.PropertyDi
+000119d0: 616c 6f67 2873 656c 662c 2074 6974 6c65  alog(self, title
+000119e0: 3d22 4164 7661 6e63 6564 206f 7074 696f  ="Advanced optio
+000119f0: 6e73 2229 0d0a 0d0a 2020 2020 2020 2020  ns")....        
+00011a00: 7472 793a 2073 6f75 7263 6520 3d20 696e  try: source = in
+00011a10: 7370 6563 742e 6765 7473 6f75 7263 6528  spect.getsource(
+00011a20: 636f 6e66 290d 0a20 2020 2020 2020 2065  conf)..        e
+00011a30: 7863 6570 7420 4578 6365 7074 696f 6e3a  xcept Exception:
+00011a40: 0d0a 2020 2020 2020 2020 2020 2020 7472  ..            tr
+00011a50: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
+00011a60: 2020 2020 7769 7468 206f 7065 6e28 6f73      with open(os
+00011a70: 2e70 6174 682e 6a6f 696e 2863 6f6e 662e  .path.join(conf.
+00011a80: 5265 736f 7572 6365 4469 7265 6374 6f72  ResourceDirector
+00011a90: 792c 2022 2e2e 222c 2022 636f 6e66 2e70  y, "..", "conf.p
+00011aa0: 7922 2929 2061 7320 663a 0d0a 2020 2020  y")) as f:..    
+00011ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011ac0: 736f 7572 6365 203d 2066 2e72 6561 6428  source = f.read(
+00011ad0: 290d 0a20 2020 2020 2020 2020 2020 2065  )..            e
+00011ae0: 7863 6570 7420 4578 6365 7074 696f 6e3a  xcept Exception:
+00011af0: 2073 6f75 7263 6520 3d20 2222 0d0a 0d0a   source = ""....
+00011b00: 2020 2020 2020 2020 6465 6620 6765 745f          def get_
+00011b10: 6669 656c 645f 646f 6328 6e61 6d65 2c20  field_doc(name, 
+00011b20: 7472 6565 3d61 7374 2e70 6172 7365 2873  tree=ast.parse(s
+00011b30: 6f75 7263 6529 293a 0d0a 2020 2020 2020  ource)):..      
+00011b40: 2020 2020 2020 2222 2252 6574 7572 6e73        """Returns
+00011b50: 2074 6865 2064 6f63 7374 7269 6e67 2069   the docstring i
+00011b60: 6d6d 6564 6961 7465 6c79 2062 6566 6f72  mmediately befor
+00011b70: 6520 6e61 6d65 2061 7373 6967 6e6d 656e  e name assignmen
+00011b80: 742e 2222 220d 0a20 2020 2020 2020 2020  t."""..         
+00011b90: 2020 2066 6f72 2069 2c20 6e6f 6465 2069     for i, node i
+00011ba0: 6e20 656e 756d 6572 6174 6528 7472 6565  n enumerate(tree
+00011bb0: 2e62 6f64 7929 3a0d 0a20 2020 2020 2020  .body):..       
+00011bc0: 2020 2020 2020 2020 2069 6620 6920 616e           if i an
+00011bd0: 6420 6973 696e 7374 616e 6365 286e 6f64  d isinstance(nod
+00011be0: 652c 2061 7374 2e41 7373 6967 6e29 2061  e, ast.Assign) a
+00011bf0: 6e64 206e 6f64 652e 7461 7267 6574 735b  nd node.targets[
+00011c00: 305d 2e69 6420 3d3d 206e 616d 653a 0d0a  0].id == name:..
+00011c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011c20: 2020 2020 7072 6576 203d 2074 7265 652e      prev = tree.
+00011c30: 626f 6479 5b69 202d 2031 5d0d 0a20 2020  body[i - 1]..   
+00011c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011c50: 2069 6620 6973 696e 7374 616e 6365 2870   if isinstance(p
+00011c60: 7265 762c 2061 7374 2e45 7870 7229 205c  rev, ast.Expr) \
+00011c70: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00011c80: 2020 2020 2020 616e 6420 6973 696e 7374        and isinst
+00011c90: 616e 6365 2870 7265 762e 7661 6c75 652c  ance(prev.value,
+00011ca0: 2028 6173 742e 5374 722c 2061 7374 2e43   (ast.Str, ast.C
+00011cb0: 6f6e 7374 616e 7429 293a 2020 2320 5079  onstant)):  # Py
+00011cc0: 323a 2053 7472 2c20 5079 333a 2043 6f6e  2: Str, Py3: Con
+00011cd0: 7374 616e 740d 0a20 2020 2020 2020 2020  stant..         
+00011ce0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00011cf0: 6574 7572 6e20 7072 6576 2e76 616c 7565  eturn prev.value
+00011d00: 2e73 2e73 7472 6970 2829 0d0a 2020 2020  .s.strip()..    
+00011d10: 2020 2020 2020 2020 7265 7475 726e 2022          return "
+00011d20: 220d 0a0d 0a20 2020 2020 2020 2064 6566  "....        def
+00011d30: 2074 7970 656c 6973 7428 6d79 7479 7065   typelist(mytype
+00011d40: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00011d50: 6465 6620 636f 6e76 6572 7428 7629 3a0d  def convert(v):.
+00011d60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011d70: 2076 203d 2061 7374 2e6c 6974 6572 616c   v = ast.literal
+00011d80: 5f65 7661 6c28 7629 2069 6620 6973 696e  _eval(v) if isin
+00011d90: 7374 616e 6365 2876 2c20 7369 782e 7374  stance(v, six.st
+00011da0: 7269 6e67 5f74 7970 6573 2920 656c 7365  ring_types) else
+00011db0: 2076 0d0a 2020 2020 2020 2020 2020 2020   v..            
+00011dc0: 2020 2020 6966 206e 6f74 2069 7369 6e73      if not isins
+00011dd0: 7461 6e63 6528 762c 2028 6c69 7374 2c20  tance(v, (list, 
+00011de0: 7475 706c 6529 293a 2076 203d 2074 7570  tuple)): v = tup
+00011df0: 6c65 285b 765d 290d 0a20 2020 2020 2020  le([v])..       
+00011e00: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+00011e10: 763a 2072 6169 7365 2056 616c 7565 4572  v: raise ValueEr
+00011e20: 726f 7228 2245 6d70 7479 2063 6f6c 6c65  ror("Empty colle
+00011e30: 6374 696f 6e22 290d 0a20 2020 2020 2020  ction")..       
+00011e40: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00011e50: 7475 706c 6528 6d61 7028 6d79 7479 7065  tuple(map(mytype
+00011e60: 2c20 7629 290d 0a20 2020 2020 2020 2020  , v))..         
+00011e70: 2020 2063 6f6e 7665 7274 2e5f 5f6e 616d     convert.__nam
+00011e80: 655f 5f20 3d20 2274 7570 6c65 2825 7329  e__ = "tuple(%s)
+00011e90: 2220 2520 6d79 7479 7065 2e5f 5f6e 616d  " % mytype.__nam
+00011ea0: 655f 5f0d 0a20 2020 2020 2020 2020 2020  e__..           
+00011eb0: 2072 6574 7572 6e20 636f 6e76 6572 740d   return convert.
+00011ec0: 0a0d 0a20 2020 2020 2020 2066 6f72 206e  ...        for n
+00011ed0: 616d 6520 696e 2073 6f72 7465 6428 636f  ame in sorted(co
+00011ee0: 6e66 2e4f 7074 696f 6e61 6c46 696c 6544  nf.OptionalFileD
+00011ef0: 6972 6563 7469 7665 7329 3a0d 0a20 2020  irectives):..   
+00011f00: 2020 2020 2020 2020 2076 616c 7565 2c20           value, 
+00011f10: 6865 6c70 203d 2067 6574 6174 7472 2863  help = getattr(c
+00011f20: 6f6e 662c 206e 616d 652c 204e 6f6e 6529  onf, name, None)
+00011f30: 2c20 6765 745f 6669 656c 645f 646f 6328  , get_field_doc(
+00011f40: 6e61 6d65 290d 0a20 2020 2020 2020 2020  name)..         
+00011f50: 2020 2064 6566 6175 6c74 203d 2063 6f6e     default = con
+00011f60: 662e 4465 6661 756c 7473 2e67 6574 286e  f.Defaults.get(n
+00011f70: 616d 6529 0d0a 2020 2020 2020 2020 2020  ame)..          
+00011f80: 2020 6966 2076 616c 7565 2069 7320 4e6f    if value is No
+00011f90: 6e65 2061 6e64 2064 6566 6175 6c74 2069  ne and default i
+00011fa0: 7320 4e6f 6e65 3a0d 0a20 2020 2020 2020  s None:..       
+00011fb0: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
+00011fc0: 6520 2320 666f 7220 6e61 6d65 0d0a 0d0a  e # for name....
+00011fd0: 2020 2020 2020 2020 2020 2020 6b69 6e64              kind
+00011fe0: 203d 2074 7970 6528 7661 6c75 6529 0d0a   = type(value)..
+00011ff0: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+00012000: 7369 6e73 7461 6e63 6528 7661 6c75 652c  sinstance(value,
+00012010: 2028 7475 706c 652c 206c 6973 7429 293a   (tuple, list)):
+00012020: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00012030: 2020 6b69 6e64 203d 2074 7970 656c 6973    kind = typelis
+00012040: 7428 7479 7065 2876 616c 7565 5b30 5d29  t(type(value[0])
+00012050: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00012060: 2020 2064 6566 6175 6c74 203d 206b 696e     default = kin
+00012070: 6428 6465 6661 756c 7429 0d0a 2020 2020  d(default)..    
+00012080: 2020 2020 2020 2020 6469 616c 6f67 2e41          dialog.A
+00012090: 6464 5072 6f70 6572 7479 286e 616d 652c  ddProperty(name,
+000120a0: 2076 616c 7565 2c20 6865 6c70 2c20 6465   value, help, de
+000120b0: 6661 756c 742c 206b 696e 6429 0d0a 2020  fault, kind)..  
+000120c0: 2020 2020 2020 6469 616c 6f67 2e52 6561        dialog.Rea
+000120d0: 6c69 7a65 2829 0d0a 0d0a 2020 2020 2020  lize()....      
+000120e0: 2020 6966 2077 782e 4944 5f4f 4b20 3d3d    if wx.ID_OK ==
+000120f0: 2064 6961 6c6f 672e 5368 6f77 4d6f 6461   dialog.ShowModa
+00012100: 6c28 293a 0d0a 2020 2020 2020 2020 2020  l():..          
+00012110: 2020 666f 7220 6b2c 2076 2069 6e20 6469    for k, v in di
+00012120: 616c 6f67 2e47 6574 5072 6f70 6572 7469  alog.GetProperti
+00012130: 6573 2829 3a0d 0a20 2020 2020 2020 2020  es():..         
+00012140: 2020 2020 2020 2023 204b 6565 7020 6e75         # Keep nu
+00012150: 6d62 6572 7320 696e 2073 616e 6520 7265  mbers in sane re
+00012160: 6769 6f6e 730d 0a20 2020 2020 2020 2020  gions..         
+00012170: 2020 2020 2020 2069 6620 7479 7065 2876         if type(v
+00012180: 2920 696e 2073 6978 2e69 6e74 6567 6572  ) in six.integer
+00012190: 5f74 7970 6573 3a20 7620 3d20 6d61 7828  _types: v = max(
+000121a0: 312c 206d 696e 2873 7973 2e6d 6178 7369  1, min(sys.maxsi
+000121b0: 7a65 2c20 7629 290d 0a20 2020 2020 2020  ze, v))..       
+000121c0: 2020 2020 2020 2020 2073 6574 6174 7472           setattr
+000121d0: 2863 6f6e 662c 206b 2c20 7629 0d0a 2020  (conf, k, v)..  
+000121e0: 2020 2020 2020 2020 2020 7574 696c 2e72            util.r
+000121f0: 756e 5f6f 6e63 6528 636f 6e66 2e73 6176  un_once(conf.sav
+00012200: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+00012210: 7365 6c66 2e4d 696e 5369 7a65 203d 2063  self.MinSize = c
+00012220: 6f6e 662e 4d69 6e57 696e 646f 7753 697a  onf.MinWindowSiz
+00012230: 650d 0a0d 0a0d 0a20 2020 2064 6566 206f  e......    def o
+00012240: 6e5f 6e65 775f 6461 7461 6261 7365 2873  n_new_database(s
+00012250: 656c 662c 2065 7665 6e74 293a 0d0a 2020  elf, event):..  
+00012260: 2020 2020 2020 2222 2248 616e 646c 6572        """Handler
+00012270: 2066 6f72 2063 6c69 636b 696e 6720 6e65   for clicking ne
+00012280: 772d 6275 7474 6f6e 206f 6e20 6d61 696e  w-button on main
+00012290: 2073 6372 6565 6e2c 206f 7065 6e73 2070   screen, opens p
+000122a0: 6f70 7570 206d 656e 752e 2222 220d 0a20  opup menu.""".. 
+000122b0: 2020 2020 2020 2069 6620 6e6f 7420 6c69         if not li
+000122c0: 7665 2e73 6b70 7920 616e 6420 6e6f 7420  ve.skpy and not 
+000122d0: 6c69 7665 2e69 6a73 6f6e 3a20 7265 7475  live.ijson: retu
+000122e0: 726e 2073 656c 662e 6f6e 5f6e 6577 5f62  rn self.on_new_b
+000122f0: 6c61 6e6b 2865 7665 6e74 290d 0a20 2020  lank(event)..   
+00012300: 2020 2020 206d 656e 7520 3d20 7778 2e6c       menu = wx.l
+00012310: 6962 2e61 6777 2e66 6c61 746d 656e 752e  ib.agw.flatmenu.
+00012320: 466c 6174 4d65 6e75 2829 0d0a 2020 2020  FlatMenu()..    
+00012330: 2020 2020 6974 656d 5f62 6c61 6e6b 2020      item_blank  
+00012340: 3d20 6d65 6e75 2e41 7070 656e 6449 7465  = menu.AppendIte
+00012350: 6d28 7778 2e6c 6962 2e61 6777 2e66 6c61  m(wx.lib.agw.fla
+00012360: 746d 656e 752e 466c 6174 4d65 6e75 4974  tmenu.FlatMenuIt
+00012370: 656d 286d 656e 752c 2077 782e 4944 5f41  em(menu, wx.ID_A
+00012380: 4e59 2c0d 0a20 2020 2020 2020 2020 2020  NY,..           
 00012390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000123a0: 2020 2246 726f 6d20 6120 536b 7970 6520    "From a Skype 
-000123b0: 2665 7870 6f72 7420 6172 6368 6976 6520  &export archive 
-000123c0: 282a 2e6a 736f 6e3b 2a2e 7461 7229 220d  (*.json;*.tar)".
-000123d0: 0a20 2020 2020 2020 2029 2920 6966 206c  .        )) if l
-000123e0: 6976 652e 696a 736f 6e20 656c 7365 204e  ive.ijson else N
-000123f0: 6f6e 650d 0a20 2020 2020 2020 2073 656c  one..        sel
-00012400: 662e 4269 6e64 2877 782e 4556 545f 4d45  f.Bind(wx.EVT_ME
-00012410: 4e55 2c20 7365 6c66 2e6f 6e5f 6e65 775f  NU, self.on_new_
-00012420: 626c 616e 6b2c 2069 7465 6d5f 626c 616e  blank, item_blan
-00012430: 6b29 0d0a 2020 2020 2020 2020 6966 2069  k)..        if i
-00012440: 7465 6d5f 6c69 7665 3a20 2020 7365 6c66  tem_live:   self
-00012450: 2e42 696e 6428 7778 2e45 5654 5f4d 454e  .Bind(wx.EVT_MEN
-00012460: 552c 2073 656c 662e 6f6e 5f6e 6577 5f6c  U, self.on_new_l
-00012470: 6976 652c 2020 2069 7465 6d5f 6c69 7665  ive,   item_live
-00012480: 290d 0a20 2020 2020 2020 2069 6620 6974  )..        if it
-00012490: 656d 5f65 7870 6f72 743a 2073 656c 662e  em_export: self.
-000124a0: 4269 6e64 2877 782e 4556 545f 4d45 4e55  Bind(wx.EVT_MENU
-000124b0: 2c20 7365 6c66 2e6f 6e5f 6e65 775f 6578  , self.on_new_ex
-000124c0: 706f 7274 2c20 6974 656d 5f65 7870 6f72  port, item_expor
-000124d0: 7429 0d0a 0d0a 2020 2020 2020 2020 6274  t)....        bt
-000124e0: 6e20 3d20 7365 6c66 2e62 7574 746f 6e5f  n = self.button_
-000124f0: 6e65 770d 0a20 2020 2020 2020 2073 7a5f  new..        sz_
-00012500: 6274 6e2c 2070 745f 6274 6e20 3d20 6274  btn, pt_btn = bt
-00012510: 6e2e 5369 7a65 2c20 6274 6e2e 506f 7369  n.Size, btn.Posi
-00012520: 7469 6f6e 0d0a 2020 2020 2020 2020 7074  tion..        pt
-00012530: 5f62 746e 203d 2062 746e 2e50 6172 656e  _btn = btn.Paren
-00012540: 742e 436c 6965 6e74 546f 5363 7265 656e  t.ClientToScreen
-00012550: 2870 745f 6274 6e29 0d0a 2020 2020 2020  (pt_btn)..      
-00012560: 2020 6d65 6e75 2e53 6574 4f77 6e65 7248    menu.SetOwnerH
-00012570: 6569 6768 7428 737a 5f62 746e 2e79 290d  eight(sz_btn.y).
-00012580: 0a20 2020 2020 2020 2069 6620 6d65 6e75  .        if menu
-00012590: 2e53 697a 652e 7769 6474 6820 3c20 737a  .Size.width < sz
-000125a0: 5f62 746e 2e77 6964 7468 3a0d 0a20 2020  _btn.width:..   
-000125b0: 2020 2020 2020 2020 206d 656e 752e 5369           menu.Si
-000125c0: 7a65 203d 2073 7a5f 6274 6e2e 7769 6474  ze = sz_btn.widt
-000125d0: 682c 206d 656e 752e 5369 7a65 2e68 6569  h, menu.Size.hei
-000125e0: 6768 740d 0a20 2020 2020 2020 206d 656e  ght..        men
-000125f0: 752e 506f 7075 7028 2870 745f 6274 6e29  u.Popup((pt_btn)
-00012600: 2c20 7365 6c66 290d 0a0d 0a0d 0a20 2020  , self)......   
-00012610: 2064 6566 206f 6e5f 6e65 775f 626c 616e   def on_new_blan
-00012620: 6b28 7365 6c66 2c20 6576 656e 7429 3a0d  k(self, event):.
-00012630: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
-00012640: 2020 2020 2020 4861 6e64 6c65 7220 666f        Handler fo
-00012650: 7220 6372 6561 7469 6e67 2061 206e 6577  r creating a new
-00012660: 2062 6c61 6e6b 2064 6174 6162 6173 652c   blank database,
-00012670: 2061 736b 7320 666f 7220 7573 6572 6e61   asks for userna
-00012680: 6d65 2c0d 0a20 2020 2020 2020 2070 6f70  me,..        pop
-00012690: 756c 6174 6573 2061 206e 6577 2064 6174  ulates a new dat
-000126a0: 6162 6173 6520 616e 6420 6f70 656e 7320  abase and opens 
-000126b0: 7468 6520 6461 7461 6261 7365 2070 6167  the database pag
-000126c0: 652e 0d0a 2020 2020 2020 2020 2222 220d  e...        """.
-000126d0: 0a20 2020 2020 2020 2064 6961 6c6f 6731  .        dialog1
-000126e0: 203d 2077 782e 5465 7874 456e 7472 7944   = wx.TextEntryD
-000126f0: 6961 6c6f 6728 7365 6c66 2c20 2245 6e74  ialog(self, "Ent
-00012700: 6572 2053 6b79 7065 2075 7365 726e 616d  er Skype usernam
-00012710: 6520 666f 7220 6e65 7720 6461 7461 6261  e for new databa
-00012720: 7365 3a22 2c0d 0a20 2020 2020 2020 2020  se:",..         
-00012730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012740: 2020 2020 2020 2020 2020 2020 636f 6e66              conf
-00012750: 2e54 6974 6c65 2c20 7374 796c 653d 7778  .Title, style=wx
-00012760: 2e4f 4b20 7c20 7778 2e43 414e 4345 4c29  .OK | wx.CANCEL)
-00012770: 0d0a 2020 2020 2020 2020 6469 616c 6f67  ..        dialog
-00012780: 312e 4365 6e74 6572 4f6e 5061 7265 6e74  1.CenterOnParent
-00012790: 2829 0d0a 2020 2020 2020 2020 6966 2077  ()..        if w
-000127a0: 782e 4944 5f4f 4b20 213d 2064 6961 6c6f  x.ID_OK != dialo
-000127b0: 6731 2e53 686f 774d 6f64 616c 2829 3a20  g1.ShowModal(): 
-000127c0: 7265 7475 726e 0d0a 2020 2020 2020 2020  return..        
-000127d0: 7573 6572 203d 2064 6961 6c6f 6731 2e47  user = dialog1.G
-000127e0: 6574 5661 6c75 6528 292e 7374 7269 7028  etValue().strip(
-000127f0: 290d 0a20 2020 2020 2020 2069 6620 6e6f  )..        if no
-00012800: 7420 7573 6572 3a20 7265 7475 726e 0d0a  t user: return..
-00012810: 0d0a 2020 2020 2020 2020 6669 6c65 6e61  ..        filena
-00012820: 6d65 3020 3d20 6c69 7665 2e6d 616b 655f  me0 = live.make_
-00012830: 6462 5f70 6174 6828 7573 6572 290d 0a20  db_path(user).. 
-00012840: 2020 2020 2020 2075 7469 6c2e 7472 795f         util.try_
-00012850: 6967 6e6f 7265 286f 732e 6d61 6b65 6469  ignore(os.makedi
-00012860: 7273 2c20 6f73 2e70 6174 682e 6469 726e  rs, os.path.dirn
-00012870: 616d 6528 6669 6c65 6e61 6d65 3029 290d  ame(filename0)).
-00012880: 0a20 2020 2020 2020 2064 6961 6c6f 6732  .        dialog2
-00012890: 203d 2077 782e 4669 6c65 4469 616c 6f67   = wx.FileDialog
-000128a0: 2870 6172 656e 743d 7365 6c66 2c20 6d65  (parent=self, me
-000128b0: 7373 6167 653d 2253 6176 6520 6e65 7720  ssage="Save new 
-000128c0: 6461 7461 6261 7365 222c 0d0a 2020 2020  database",..    
-000128d0: 2020 2020 2020 2020 6465 6661 756c 7444          defaultD
-000128e0: 6972 3d6f 732e 7061 7468 2e64 6972 6e61  ir=os.path.dirna
-000128f0: 6d65 2866 696c 656e 616d 6530 292c 0d0a  me(filename0),..
-00012900: 2020 2020 2020 2020 2020 2020 6465 6661              defa
-00012910: 756c 7446 696c 653d 6f73 2e70 6174 682e  ultFile=os.path.
-00012920: 6261 7365 6e61 6d65 2866 696c 656e 616d  basename(filenam
-00012930: 6530 292c 0d0a 2020 2020 2020 2020 2020  e0),..          
-00012940: 2020 7769 6c64 6361 7264 3d22 5351 4c69    wildcard="SQLi
-00012950: 7465 2064 6174 6162 6173 6520 282a 2e64  te database (*.d
-00012960: 6229 7c2a 2e64 627c 416c 6c20 6669 6c65  b)|*.db|All file
-00012970: 737c 2a2e 2a22 2c0d 0a20 2020 2020 2020  s|*.*",..       
-00012980: 2020 2020 2073 7479 6c65 3d77 782e 4644       style=wx.FD
-00012990: 5f4f 5645 5257 5249 5445 5f50 524f 4d50  _OVERWRITE_PROMP
-000129a0: 5420 7c20 7778 2e46 445f 5341 5645 207c  T | wx.FD_SAVE |
-000129b0: 2077 782e 5245 5349 5a45 5f42 4f52 4445   wx.RESIZE_BORDE
-000129c0: 520d 0a20 2020 2020 2020 2029 0d0a 2020  R..        )..  
-000129d0: 2020 2020 2020 6966 2077 782e 4944 5f4f        if wx.ID_O
-000129e0: 4b20 213d 2064 6961 6c6f 6732 2e53 686f  K != dialog2.Sho
-000129f0: 774d 6f64 616c 2829 3a20 7265 7475 726e  wModal(): return
-00012a00: 0d0a 0d0a 2020 2020 2020 2020 7778 2e59  ....        wx.Y
-00012a10: 6965 6c64 4966 4e65 6564 6564 2829 2023  ieldIfNeeded() #
-00012a20: 2041 6c6c 6f77 2055 4920 746f 2072 6566   Allow UI to ref
-00012a30: 7265 7368 0d0a 2020 2020 2020 2020 6669  resh..        fi
-00012a40: 6c65 6e61 6d65 203d 2063 6f6e 7472 6f6c  lename = control
-00012a50: 732e 6765 745f 6469 616c 6f67 5f70 6174  s.get_dialog_pat
-00012a60: 6828 6469 616c 6f67 3229 0d0a 0d0a 2020  h(dialog2)....  
-00012a70: 2020 2020 2020 6966 2066 696c 656e 616d        if filenam
-00012a80: 6520 696e 2073 656c 662e 6462 7320 6f72  e in self.dbs or
-00012a90: 2066 696c 656e 616d 6520 696e 2073 656c   filename in sel
-00012aa0: 662e 776f 726b 6572 735f 696d 706f 7274  f.workers_import
-00012ab0: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
-00012ac0: 6574 7572 6e20 7778 2e4d 6573 7361 6765  eturn wx.Message
-00012ad0: 426f 7828 2225 7320 6973 2063 7572 7265  Box("%s is curre
-00012ae0: 6e74 6c79 206f 7065 6e20 696e 2025 732c  ntly open in %s,
-00012af0: 2063 616e 6e6f 7420 6f76 6572 7772 6974   cannot overwrit
-00012b00: 652e 2220 250d 0a20 2020 2020 2020 2020  e." %..         
-00012b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012b20: 2020 2020 2020 2020 2866 696c 656e 616d          (filenam
-00012b30: 652c 2063 6f6e 662e 5469 746c 6529 2c20  e, conf.Title), 
-00012b40: 636f 6e66 2e54 6974 6c65 2c20 7778 2e4f  conf.Title, wx.O
-00012b50: 4b29 0d0a 0d0a 2020 2020 2020 2020 6275  K)....        bu
-00012b60: 7379 203d 2063 6f6e 7472 6f6c 732e 4275  sy = controls.Bu
-00012b70: 7379 5061 6e65 6c28 7365 6c66 2c20 2243  syPanel(self, "C
-00012b80: 7265 6174 696e 6720 6e65 7720 6461 7461  reating new data
-00012b90: 6261 7365 2e2e 2229 0d0a 2020 2020 2020  base..")..      
-00012ba0: 2020 7472 793a 0d0a 2020 2020 2020 2020    try:..        
-00012bb0: 2020 2020 6c6f 6767 6572 2e69 6e66 6f28      logger.info(
-00012bc0: 2243 7265 6174 696e 6720 6e65 7720 626c  "Creating new bl
-00012bd0: 616e 6b20 6461 7461 6261 7365 2025 7320  ank database %s 
-00012be0: 666f 7220 7573 6572 2027 2573 272e 222c  for user '%s'.",
-00012bf0: 2066 696c 656e 616d 652c 2075 7365 7229   filename, user)
-00012c00: 0d0a 2020 2020 2020 2020 2020 2020 6462  ..            db
-00012c10: 203d 2073 6b79 7065 6461 7461 2e53 6b79   = skypedata.Sky
-00012c20: 7065 4461 7461 6261 7365 2866 696c 656e  peDatabase(filen
-00012c30: 616d 652c 2074 7275 6e63 6174 653d 5472  ame, truncate=Tr
-00012c40: 7565 290d 0a20 2020 2020 2020 2020 2020  ue)..           
-00012c50: 2064 622e 656e 7375 7265 5f73 6368 656d   db.ensure_schem
-00012c60: 6128 290d 0a20 2020 2020 2020 2020 2020  a()..           
-00012c70: 2064 622e 696e 7365 7274 5f61 6363 6f75   db.insert_accou
-00012c80: 6e74 287b 2273 6b79 7065 6e61 6d65 223a  nt({"skypename":
-00012c90: 2075 7365 727d 290d 0a20 2020 2020 2020   user})..       
-00012ca0: 2020 2020 2064 622e 7461 626c 6573 5f6c       db.tables_l
-00012cb0: 6973 7420 3d20 4e6f 6e65 2023 2046 6f72  ist = None # For
-00012cc0: 6365 2072 656c 6f61 640d 0a20 2020 2020  ce reload..     
-00012cd0: 2020 2020 2020 2064 622e 7570 6461 7465         db.update
-00012ce0: 5f61 6363 6f75 6e74 696e 666f 2829 0d0a  _accountinfo()..
-00012cf0: 2020 2020 2020 2020 6578 6365 7074 2045          except E
-00012d00: 7863 6570 7469 6f6e 3a0d 0a20 2020 2020  xception:..     
-00012d10: 2020 2020 2020 205f 2c20 652c 2074 6220         _, e, tb 
-00012d20: 3d20 7379 732e 6578 635f 696e 666f 2829  = sys.exc_info()
-00012d30: 0d0a 2020 2020 2020 2020 2020 2020 7574  ..            ut
-00012d40: 696c 2e74 7279 5f69 676e 6f72 6528 6f73  il.try_ignore(os
-00012d50: 2e75 6e6c 696e 6b2c 2066 696c 656e 616d  .unlink, filenam
-00012d60: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
-00012d70: 7369 782e 7265 7261 6973 6528 7479 7065  six.reraise(type
-00012d80: 2865 292c 2065 2c20 7462 290d 0a20 2020  (e), e, tb)..   
-00012d90: 2020 2020 2066 696e 616c 6c79 3a20 6275       finally: bu
-00012da0: 7379 2e43 6c6f 7365 2829 0d0a 0d0a 2020  sy.Close()....  
-00012db0: 2020 2020 2020 7365 6c66 2e6c 6f61 645f        self.load_
-00012dc0: 6461 7461 6261 7365 2866 696c 656e 616d  database(filenam
-00012dd0: 652c 2064 6229 0d0a 2020 2020 2020 2020  e, db)..        
-00012de0: 7365 6c66 2e75 7064 6174 655f 6461 7461  self.update_data
-00012df0: 6261 7365 5f6c 6973 7428 6669 6c65 6e61  base_list(filena
-00012e00: 6d65 290d 0a20 2020 2020 2020 2073 656c  me)..        sel
-00012e10: 662e 6c6f 6164 5f64 6174 6162 6173 655f  f.load_database_
-00012e20: 7061 6765 2866 696c 656e 616d 6529 0d0a  page(filename)..
-00012e30: 0d0a 0d0a 2020 2020 6465 6620 6f6e 5f6e  ....    def on_n
-00012e40: 6577 5f6c 6976 6528 7365 6c66 2c20 6576  ew_live(self, ev
-00012e50: 656e 7429 3a0d 0a20 2020 2020 2020 2022  ent):..        "
-00012e60: 2222 0d0a 2020 2020 2020 2020 4861 6e64  ""..        Hand
-00012e70: 6c65 7220 666f 7220 6372 6561 7469 6e67  ler for creating
-00012e80: 206e 6577 2064 6174 6162 6173 6520 6672   new database fr
-00012e90: 6f6d 206c 6976 652c 2061 736b 7320 666f  om live, asks fo
-00012ea0: 7220 7573 6572 6e61 6d65 2061 6e64 0d0a  r username and..
-00012eb0: 2020 2020 2020 2020 7061 7373 776f 7264          password
-00012ec0: 2c20 6f70 656e 7320 6461 7461 6261 7365  , opens database
-00012ed0: 2070 6167 6520 616e 6420 7374 6172 7473   page and starts
-00012ee0: 2073 796e 6369 6e67 2064 6174 612e 0d0a   syncing data...
-00012ef0: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
-00012f00: 2020 2020 2064 6961 6c6f 6731 203d 204c       dialog1 = L
-00012f10: 6f67 696e 4469 616c 6f67 2873 656c 662c  oginDialog(self,
-00012f20: 2074 6974 6c65 3d22 4c6f 6720 696e 2074   title="Log in t
-00012f30: 6f20 536b 7970 6520 6f6e 6c69 6e65 2229  o Skype online")
-00012f40: 0d0a 2020 2020 2020 2020 6966 2077 782e  ..        if wx.
-00012f50: 4944 5f4f 4b20 213d 2064 6961 6c6f 6731  ID_OK != dialog1
-00012f60: 2e53 686f 774d 6f64 616c 2829 3a20 7265  .ShowModal(): re
-00012f70: 7475 726e 0d0a 2020 2020 2020 2020 7573  turn..        us
-00012f80: 6572 2c20 7077 203d 2064 6961 6c6f 6731  er, pw = dialog1
-00012f90: 2e55 7365 726e 616d 652c 2064 6961 6c6f  .Username, dialo
-00012fa0: 6731 2e50 6173 7377 6f72 640d 0a20 2020  g1.Password..   
-00012fb0: 2020 2020 2069 6620 6e6f 7420 7573 6572       if not user
-00012fc0: 206f 7220 6e6f 7420 7077 3a20 7265 7475   or not pw: retu
-00012fd0: 726e 0d0a 0d0a 2020 2020 2020 2020 6669  rn....        fi
-00012fe0: 6c65 6e61 6d65 3020 3d20 6c69 7665 2e6d  lename0 = live.m
-00012ff0: 616b 655f 6462 5f70 6174 6828 7573 6572  ake_db_path(user
-00013000: 290d 0a20 2020 2020 2020 2075 7469 6c2e  )..        util.
-00013010: 7472 795f 6967 6e6f 7265 286f 732e 6d61  try_ignore(os.ma
-00013020: 6b65 6469 7273 2c20 6f73 2e70 6174 682e  kedirs, os.path.
-00013030: 6469 726e 616d 6528 6669 6c65 6e61 6d65  dirname(filename
-00013040: 3029 290d 0a20 2020 2020 2020 2064 6961  0))..        dia
-00013050: 6c6f 6732 203d 2077 782e 4669 6c65 4469  log2 = wx.FileDi
-00013060: 616c 6f67 2870 6172 656e 743d 7365 6c66  alog(parent=self
-00013070: 2c20 6d65 7373 6167 653d 2253 6176 6520  , message="Save 
-00013080: 6e65 7720 6461 7461 6261 7365 222c 0d0a  new database",..
-00013090: 2020 2020 2020 2020 2020 2020 6465 6661              defa
-000130a0: 756c 7444 6972 3d6f 732e 7061 7468 2e64  ultDir=os.path.d
-000130b0: 6972 6e61 6d65 2866 696c 656e 616d 6530  irname(filename0
-000130c0: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
-000130d0: 6465 6661 756c 7446 696c 653d 6f73 2e70  defaultFile=os.p
-000130e0: 6174 682e 6261 7365 6e61 6d65 2866 696c  ath.basename(fil
-000130f0: 656e 616d 6530 292c 0d0a 2020 2020 2020  ename0),..      
-00013100: 2020 2020 2020 7769 6c64 6361 7264 3d22        wildcard="
-00013110: 5351 4c69 7465 2064 6174 6162 6173 6520  SQLite database 
-00013120: 282a 2e64 6229 7c2a 2e64 627c 416c 6c20  (*.db)|*.db|All 
-00013130: 6669 6c65 737c 2a2e 2a22 2c0d 0a20 2020  files|*.*",..   
-00013140: 2020 2020 2020 2020 2073 7479 6c65 3d77           style=w
-00013150: 782e 4644 5f4f 5645 5257 5249 5445 5f50  x.FD_OVERWRITE_P
-00013160: 524f 4d50 5420 7c20 7778 2e46 445f 5341  ROMPT | wx.FD_SA
-00013170: 5645 207c 2077 782e 5245 5349 5a45 5f42  VE | wx.RESIZE_B
-00013180: 4f52 4445 520d 0a20 2020 2020 2020 2029  ORDER..        )
-00013190: 0d0a 2020 2020 2020 2020 6966 2077 782e  ..        if wx.
-000131a0: 4944 5f4f 4b20 213d 2064 6961 6c6f 6732  ID_OK != dialog2
-000131b0: 2e53 686f 774d 6f64 616c 2829 3a20 7265  .ShowModal(): re
-000131c0: 7475 726e 0d0a 0d0a 2020 2020 2020 2020  turn....        
-000131d0: 7778 2e59 6965 6c64 4966 4e65 6564 6564  wx.YieldIfNeeded
-000131e0: 2829 2023 2041 6c6c 6f77 2055 4920 746f  () # Allow UI to
-000131f0: 2072 6566 7265 7368 0d0a 2020 2020 2020   refresh..      
-00013200: 2020 6669 6c65 6e61 6d65 203d 2063 6f6e    filename = con
-00013210: 7472 6f6c 732e 6765 745f 6469 616c 6f67  trols.get_dialog
-00013220: 5f70 6174 6828 6469 616c 6f67 3229 0d0a  _path(dialog2)..
-00013230: 0d0a 2020 2020 2020 2020 6966 2066 696c  ..        if fil
-00013240: 656e 616d 6520 696e 2073 656c 662e 6462  ename in self.db
-00013250: 7320 6f72 2066 696c 656e 616d 6520 696e  s or filename in
-00013260: 2073 656c 662e 776f 726b 6572 735f 696d   self.workers_im
-00013270: 706f 7274 3a0d 0a20 2020 2020 2020 2020  port:..         
-00013280: 2020 2072 6574 7572 6e20 7778 2e4d 6573     return wx.Mes
-00013290: 7361 6765 426f 7828 2225 7320 6973 2063  sageBox("%s is c
-000132a0: 7572 7265 6e74 6c79 206f 7065 6e20 696e  urrently open in
-000132b0: 2025 732c 2063 616e 6e6f 7420 6f76 6572   %s, cannot over
-000132c0: 7772 6974 652e 2220 250d 0a20 2020 2020  write." %..     
-000132d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000132e0: 2020 2020 2020 2020 2020 2020 2866 696c              (fil
-000132f0: 656e 616d 652c 2063 6f6e 662e 5469 746c  ename, conf.Titl
-00013300: 6529 2c20 636f 6e66 2e54 6974 6c65 2c20  e), conf.Title, 
-00013310: 7778 2e4f 4b29 0d0a 0d0a 2020 2020 2020  wx.OK)....      
-00013320: 2020 736b 7970 6520 3d20 6c69 7665 2e53    skype = live.S
-00013330: 6b79 7065 4c6f 6769 6e28 290d 0a20 2020  kypeLogin()..   
-00013340: 2020 2020 2062 7573 7920 3d20 636f 6e74       busy = cont
-00013350: 726f 6c73 2e42 7573 7950 616e 656c 2873  rols.BusyPanel(s
-00013360: 656c 662c 2022 4c6f 6767 696e 6720 696e  elf, "Logging in
-00013370: 2061 7320 2725 7327 2e22 2025 2075 7365   as '%s'." % use
-00013380: 7229 0d0a 2020 2020 2020 2020 7365 6c66  r)..        self
-00013390: 2e52 6566 7265 7368 2829 0d0a 2020 2020  .Refresh()..    
-000133a0: 2020 2020 7472 793a 0d0a 2020 2020 2020      try:..      
-000133b0: 2020 2020 2020 7472 793a 2073 6b79 7065        try: skype
-000133c0: 2e6c 6f67 696e 2875 7365 722c 2070 772c  .login(user, pw,
-000133d0: 2074 6f6b 656e 3d46 616c 7365 2c20 696e   token=False, in
-000133e0: 6974 5f64 623d 4661 6c73 6529 0d0a 2020  it_db=False)..  
-000133f0: 2020 2020 2020 2020 2020 6578 6365 7074            except
-00013400: 2045 7863 6570 7469 6f6e 2061 7320 653a   Exception as e:
-00013410: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00013420: 2020 6275 7379 2e43 6c6f 7365 2829 0d0a    busy.Close()..
-00013430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013440: 7265 7475 726e 2077 782e 4d65 7373 6167  return wx.Messag
-00013450: 6542 6f78 2822 4661 696c 6564 2074 6f20  eBox("Failed to 
-00013460: 6c6f 6720 696e 2061 7320 2725 7327 3a5c  log in as '%s':\
-00013470: 6e5c 6e25 7322 2025 0d0a 2020 2020 2020  n\n%s" %..      
-00013480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013490: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-000134a0: 7573 6572 2c20 7574 696c 2e66 6f72 6d61  user, util.forma
-000134b0: 745f 6578 6328 6529 292c 0d0a 2020 2020  t_exc(e)),..    
-000134c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000134d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000134e0: 2063 6f6e 662e 5469 746c 652c 2077 782e   conf.Title, wx.
-000134f0: 4f4b 207c 2077 782e 4943 4f4e 5f45 5252  OK | wx.ICON_ERR
-00013500: 4f52 290d 0a0d 0a20 2020 2020 2020 2020  OR)....         
-00013510: 2020 2063 6f6e 662e 4c6f 6769 6e2e 7365     conf.Login.se
-00013520: 7464 6566 6175 6c74 2866 696c 656e 616d  tdefault(filenam
-00013530: 652c 207b 7d29 5b22 7061 7373 776f 7264  e, {})["password
-00013540: 225d 203d 2075 7469 6c2e 6f62 6675 7363  "] = util.obfusc
-00013550: 6174 6528 7077 290d 0a20 2020 2020 2020  ate(pw)..       
-00013560: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
-00013570: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
-00013580: 722e 696e 666f 2822 4372 6561 7469 6e67  r.info("Creating
-00013590: 206e 6577 2053 6b79 7065 2064 6174 6162   new Skype datab
-000135a0: 6173 6520 6669 6c65 2025 7320 6672 6f6d  ase file %s from
-000135b0: 2053 6b79 7065 206f 6e6c 696e 6520 220d   Skype online ".
-000135c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000135d0: 2020 2020 2020 2020 2020 2020 2022 666f               "fo
-000135e0: 7220 7573 6572 2027 2573 272e 222c 2066  r user '%s'.", f
-000135f0: 696c 656e 616d 652c 2075 7365 7229 0d0a  ilename, user)..
-00013600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013610: 736b 7970 652e 696e 6974 5f64 6228 6669  skype.init_db(fi
-00013620: 6c65 6e61 6d65 2c20 7472 756e 6361 7465  lename, truncate
-00013630: 3d54 7275 6529 0d0a 2020 2020 2020 2020  =True)..        
-00013640: 2020 2020 2020 2020 736b 7970 652e 7361          skype.sa
-00013650: 7665 2822 6163 636f 756e 7473 222c 2073  ve("accounts", s
-00013660: 6b79 7065 2e73 6b79 7065 2e75 7365 7229  kype.skype.user)
-00013670: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00013680: 2020 736b 7970 652e 6462 2e74 6162 6c65    skype.db.table
-00013690: 735f 6c69 7374 203d 204e 6f6e 6520 2320  s_list = None # 
-000136a0: 466f 7263 6520 7265 6c6f 6164 0d0a 2020  Force reload..  
-000136b0: 2020 2020 2020 2020 2020 2020 2020 736b                sk
-000136c0: 7970 652e 6462 2e75 7064 6174 655f 6163  ype.db.update_ac
-000136d0: 636f 756e 7469 6e66 6f28 290d 0a20 2020  countinfo()..   
-000136e0: 2020 2020 2020 2020 2065 7863 6570 7420           except 
-000136f0: 4578 6365 7074 696f 6e3a 0d0a 2020 2020  Exception:..    
-00013700: 2020 2020 2020 2020 2020 2020 5f2c 2065              _, e
-00013710: 2c20 7462 203d 2073 7973 2e65 7863 5f69  , tb = sys.exc_i
-00013720: 6e66 6f28 290d 0a20 2020 2020 2020 2020  nfo()..         
-00013730: 2020 2020 2020 2075 7469 6c2e 7472 795f         util.try_
-00013740: 6967 6e6f 7265 2873 6b79 7065 2e64 6220  ignore(skype.db 
-00013750: 616e 6420 736b 7970 652e 6462 2e63 6c6f  and skype.db.clo
-00013760: 7365 290d 0a20 2020 2020 2020 2020 2020  se)..           
-00013770: 2020 2020 2075 7469 6c2e 7472 795f 6967       util.try_ig
-00013780: 6e6f 7265 286f 732e 756e 6c69 6e6b 2c20  nore(os.unlink, 
-00013790: 6669 6c65 6e61 6d65 290d 0a20 2020 2020  filename)..     
-000137a0: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
-000137b0: 722e 6578 6365 7074 696f 6e28 2245 7272  r.exception("Err
-000137c0: 6f72 2073 6176 696e 6720 6163 636f 756e  or saving accoun
-000137d0: 7420 2572 2e22 2c20 736b 7970 652e 736b  t %r.", skype.sk
-000137e0: 7970 652e 7573 6572 290d 0a20 2020 2020  ype.user)..     
-000137f0: 2020 2020 2020 2020 2020 2073 6978 2e72             six.r
-00013800: 6572 6169 7365 2874 7970 6528 6529 2c20  eraise(type(e), 
-00013810: 652c 2074 6229 0d0a 2020 2020 2020 2020  e, tb)..        
-00013820: 6669 6e61 6c6c 793a 2062 7573 792e 436c  finally: busy.Cl
-00013830: 6f73 6528 290d 0a0d 0a20 2020 2020 2020  ose()....       
-00013840: 2063 6f6e 662e 4c6f 6769 6e2e 7365 7464   conf.Login.setd
-00013850: 6566 6175 6c74 2866 696c 656e 616d 652c  efault(filename,
-00013860: 207b 7d29 5b22 7379 6e63 5f6f 6c64 6572   {})["sync_older
-00013870: 225d 203d 2046 616c 7365 0d0a 2020 2020  "] = False..    
-00013880: 2020 2020 7365 6c66 2e6c 6f61 645f 6461      self.load_da
-00013890: 7461 6261 7365 2866 696c 656e 616d 652c  tabase(filename,
-000138a0: 2073 6b79 7065 2e64 6229 0d0a 2020 2020   skype.db)..    
-000138b0: 2020 2020 7365 6c66 2e75 7064 6174 655f      self.update_
-000138c0: 6461 7461 6261 7365 5f6c 6973 7428 6669  database_list(fi
-000138d0: 6c65 6e61 6d65 290d 0a20 2020 2020 2020  lename)..       
-000138e0: 2070 6167 6520 3d20 7365 6c66 2e6c 6f61   page = self.loa
-000138f0: 645f 6461 7461 6261 7365 5f70 6167 6528  d_database_page(
-00013900: 6669 6c65 6e61 6d65 290d 0a20 2020 2020  filename)..     
-00013910: 2020 2069 6620 6e6f 7420 7061 6765 3a20     if not page: 
-00013920: 7265 7475 726e 0d0a 0d0a 2020 2020 2020  return....      
-00013930: 2020 6966 206e 6f74 2063 6f6e 662e 4c6f    if not conf.Lo
-00013940: 6769 6e2e 6765 7428 6669 6c65 6e61 6d65  gin.get(filename
-00013950: 2c20 7b7d 292e 6765 7428 2273 746f 7265  , {}).get("store
-00013960: 2229 3a0d 0a20 2020 2020 2020 2020 2020  "):..           
-00013970: 2063 6f6e 662e 4c6f 6769 6e2e 6765 7428   conf.Login.get(
-00013980: 6669 6c65 6e61 6d65 2c20 7b7d 292e 706f  filename, {}).po
-00013990: 7028 2270 6173 7377 6f72 6422 2c20 4e6f  p("password", No
-000139a0: 6e65 290d 0a20 2020 2020 2020 2070 6167  ne)..        pag
-000139b0: 652e 6e6f 7465 626f 6f6b 2e53 656c 6563  e.notebook.Selec
-000139c0: 7469 6f6e 203d 2070 6167 652e 7061 6765  tion = page.page
-000139d0: 6f72 6465 725b 7061 6765 2e70 6167 655f  order[page.page_
-000139e0: 6c69 7665 5d0d 0a20 2020 2020 2020 2069  live]..        i
-000139f0: 6620 6e6f 7420 636f 6e66 2e4c 6f67 696e  f not conf.Login
-00013a00: 2e67 6574 2866 696c 656e 616d 652c 207b  .get(filename, {
-00013a10: 7d29 2e67 6574 2822 7379 6e63 2229 3a0d  }).get("sync"):.
-00013a20: 0a20 2020 2020 2020 2020 2020 2070 6167  .            pag
-00013a30: 652e 6f6e 5f6c 6976 655f 7265 7375 6c74  e.on_live_result
-00013a40: 2861 6374 696f 6e3d 226c 6f67 696e 222c  (action="login",
-00013a50: 206f 7074 733d 7b22 7379 6e63 223a 2054   opts={"sync": T
-00013a60: 7275 657d 290d 0a0d 0a0d 0a20 2020 2064  rue})......    d
-00013a70: 6566 206f 6e5f 6e65 775f 6578 706f 7274  ef on_new_export
-00013a80: 2873 656c 662c 2065 7665 6e74 293a 0d0a  (self, event):..
-00013a90: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
-00013aa0: 2020 2020 2048 616e 646c 6572 2066 6f72       Handler for
-00013ab0: 2063 7265 6174 696e 6720 6120 6e65 7720   creating a new 
-00013ac0: 626c 616e 6b20 6461 7461 6261 7365 2066  blank database f
-00013ad0: 726f 6d20 536b 7970 6520 6578 706f 7274  rom Skype export
-00013ae0: 2c0d 0a20 2020 2020 2020 206f 7065 6e73  ,..        opens
-00013af0: 2064 6961 6c6f 6773 2066 6f72 2063 686f   dialogs for cho
-00013b00: 6f73 696e 6720 6578 706f 7274 2066 696c  osing export fil
-00013b10: 6520 616e 6420 6461 7461 6261 7365 206c  e and database l
-00013b20: 6f63 6174 696f 6e2e 0d0a 2020 2020 2020  ocation...      
-00013b30: 2020 2222 220d 0a20 2020 2020 2020 2064    """..        d
-00013b40: 6961 6c6f 6731 203d 2073 656c 662e 6469  ialog1 = self.di
-00013b50: 616c 6f67 5f6f 7065 6e65 7870 6f72 740d  alog_openexport.
-00013b60: 0a20 2020 2020 2020 2064 6961 6c6f 6731  .        dialog1
-00013b70: 2e53 686f 774d 6f64 616c 2829 0d0a 2020  .ShowModal()..  
-00013b80: 2020 2020 2020 6566 696c 656e 616d 6520        efilename 
-00013b90: 3d20 6469 616c 6f67 312e 4765 7450 6174  = dialog1.GetPat
-00013ba0: 6828 290d 0a20 2020 2020 2020 2069 6620  h()..        if 
-00013bb0: 6e6f 7420 6566 696c 656e 616d 653a 2072  not efilename: r
-00013bc0: 6574 7572 6e0d 0a0d 0a20 2020 2020 2020  eturn....       
-00013bd0: 2075 7365 7220 3d20 6c69 7665 2e53 6b79   user = live.Sky
-00013be0: 7065 4578 706f 7274 2e65 7870 6f72 745f  peExport.export_
-00013bf0: 6765 745f 6163 636f 756e 7428 6566 696c  get_account(efil
-00013c00: 656e 616d 6529 0d0a 2020 2020 2020 2020  ename)..        
-00013c10: 6966 206e 6f74 2075 7365 723a 2072 6574  if not user: ret
-00013c20: 7572 6e20 7778 2e4d 6573 7361 6765 426f  urn wx.MessageBo
-00013c30: 7828 224e 6f20 536b 7970 6520 7573 6572  x("No Skype user
-00013c40: 6e61 6d65 2066 6f75 6e64 2069 6e20 2573  name found in %s
-00013c50: 2e22 2025 2065 6669 6c65 6e61 6d65 2c0d  ." % efilename,.
-00013c60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013c80: 2020 2020 2020 2020 2020 2063 6f6e 662e             conf.
-00013c90: 5469 746c 652c 2077 782e 4f4b 207c 2077  Title, wx.OK | w
-00013ca0: 782e 4943 4f4e 5f57 4152 4e49 4e47 290d  x.ICON_WARNING).
-00013cb0: 0a0d 0a20 2020 2020 2020 2066 696c 656e  ...        filen
-00013cc0: 616d 6530 203d 206c 6976 652e 6d61 6b65  ame0 = live.make
-00013cd0: 5f64 625f 7061 7468 2875 7365 7229 0d0a  _db_path(user)..
-00013ce0: 2020 2020 2020 2020 7574 696c 2e74 7279          util.try
-00013cf0: 5f69 676e 6f72 6528 6f73 2e6d 616b 6564  _ignore(os.maked
-00013d00: 6972 732c 206f 732e 7061 7468 2e64 6972  irs, os.path.dir
-00013d10: 6e61 6d65 2866 696c 656e 616d 6530 2929  name(filename0))
-00013d20: 0d0a 2020 2020 2020 2020 6469 616c 6f67  ..        dialog
-00013d30: 3220 3d20 7778 2e46 696c 6544 6961 6c6f  2 = wx.FileDialo
-00013d40: 6728 7061 7265 6e74 3d73 656c 662c 206d  g(parent=self, m
-00013d50: 6573 7361 6765 3d22 5361 7665 206e 6577  essage="Save new
-00013d60: 2064 6174 6162 6173 6522 2c0d 0a20 2020   database",..   
-00013d70: 2020 2020 2020 2020 2064 6566 6175 6c74           default
-00013d80: 4469 723d 6f73 2e70 6174 682e 6469 726e  Dir=os.path.dirn
-00013d90: 616d 6528 6669 6c65 6e61 6d65 3029 2c0d  ame(filename0),.
-00013da0: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
-00013db0: 6175 6c74 4669 6c65 3d6f 732e 7061 7468  aultFile=os.path
-00013dc0: 2e62 6173 656e 616d 6528 6669 6c65 6e61  .basename(filena
-00013dd0: 6d65 3029 2c0d 0a20 2020 2020 2020 2020  me0),..         
-00013de0: 2020 2077 696c 6463 6172 643d 2253 514c     wildcard="SQL
-00013df0: 6974 6520 6461 7461 6261 7365 2028 2a2e  ite database (*.
-00013e00: 6462 297c 2a2e 6462 7c41 6c6c 2066 696c  db)|*.db|All fil
-00013e10: 6573 7c2a 2e2a 222c 0d0a 2020 2020 2020  es|*.*",..      
-00013e20: 2020 2020 2020 7374 796c 653d 7778 2e46        style=wx.F
-00013e30: 445f 4f56 4552 5752 4954 455f 5052 4f4d  D_OVERWRITE_PROM
-00013e40: 5054 207c 2077 782e 4644 5f53 4156 4520  PT | wx.FD_SAVE 
-00013e50: 7c20 7778 2e52 4553 495a 455f 424f 5244  | wx.RESIZE_BORD
-00013e60: 4552 0d0a 2020 2020 2020 2020 290d 0a20  ER..        ).. 
-00013e70: 2020 2020 2020 2069 6620 7778 2e49 445f         if wx.ID_
-00013e80: 4f4b 2021 3d20 6469 616c 6f67 322e 5368  OK != dialog2.Sh
-00013e90: 6f77 4d6f 6461 6c28 293a 2072 6574 7572  owModal(): retur
-00013ea0: 6e0d 0a0d 0a20 2020 2020 2020 2077 782e  n....        wx.
-00013eb0: 5969 656c 6449 664e 6565 6465 6428 2920  YieldIfNeeded() 
-00013ec0: 2320 416c 6c6f 7720 5549 2074 6f20 7265  # Allow UI to re
-00013ed0: 6672 6573 680d 0a20 2020 2020 2020 2066  fresh..        f
-00013ee0: 696c 656e 616d 6520 3d20 636f 6e74 726f  ilename = contro
-00013ef0: 6c73 2e67 6574 5f64 6961 6c6f 675f 7061  ls.get_dialog_pa
-00013f00: 7468 2864 6961 6c6f 6732 290d 0a0d 0a20  th(dialog2).... 
-00013f10: 2020 2020 2020 2069 6620 6669 6c65 6e61         if filena
-00013f20: 6d65 2069 6e20 7365 6c66 2e64 6273 206f  me in self.dbs o
-00013f30: 7220 6669 6c65 6e61 6d65 2069 6e20 7365  r filename in se
-00013f40: 6c66 2e77 6f72 6b65 7273 5f69 6d70 6f72  lf.workers_impor
-00013f50: 743a 0d0a 2020 2020 2020 2020 2020 2020  t:..            
-00013f60: 7265 7475 726e 2077 782e 4d65 7373 6167  return wx.Messag
-00013f70: 6542 6f78 2822 2573 2069 7320 6375 7272  eBox("%s is curr
-00013f80: 656e 746c 7920 6f70 656e 2069 6e20 2573  ently open in %s
-00013f90: 2c20 6361 6e6e 6f74 206f 7665 7277 7269  , cannot overwri
-00013fa0: 7465 2e22 2025 0d0a 2020 2020 2020 2020  te." %..        
-00013fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013fc0: 2020 2020 2020 2020 2028 6669 6c65 6e61           (filena
-00013fd0: 6d65 2c20 636f 6e66 2e54 6974 6c65 292c  me, conf.Title),
-00013fe0: 2063 6f6e 662e 5469 746c 652c 2077 782e   conf.Title, wx.
-00013ff0: 4f4b 290d 0a0d 0a20 2020 2020 2020 2064  OK)....        d
-00014000: 6566 206f 6e5f 6361 6e63 656c 2829 3a0d  ef on_cancel():.
-00014010: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-00014020: 756c 7420 3d20 7778 2e4f 4b20 3d3d 2077  ult = wx.OK == w
-00014030: 782e 4d65 7373 6167 6542 6f78 2822 4361  x.MessageBox("Ca
-00014040: 6e63 656c 2069 6d70 6f72 743f 222c 2063  ncel import?", c
-00014050: 6f6e 662e 5469 746c 652c 2077 782e 4f4b  onf.Title, wx.OK
-00014060: 207c 2077 782e 4341 4e43 454c 290d 0a20   | wx.CANCEL).. 
-00014070: 2020 2020 2020 2020 2020 2069 6620 7265             if re
-00014080: 7375 6c74 3a0d 0a20 2020 2020 2020 2020  sult:..         
-00014090: 2020 2020 2020 2077 6f72 6b65 722e 7374         worker.st
-000140a0: 6f70 2864 726f 705f 7265 7375 6c74 733d  op(drop_results=
-000140b0: 4661 6c73 6529 0d0a 2020 2020 2020 2020  False)..        
-000140c0: 2020 2020 2020 2020 7365 6c66 2e77 6f72          self.wor
-000140d0: 6b65 7273 5f69 6d70 6f72 742e 706f 7028  kers_import.pop(
-000140e0: 6669 6c65 6e61 6d65 2c20 4e6f 6e65 290d  filename, None).
-000140f0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00014100: 7572 6e20 7265 7375 6c74 0d0a 0d0a 2020  urn result....  
-00014110: 2020 2020 2020 6465 6620 6f6e 5f70 726f        def on_pro
-00014120: 6772 6573 7328 7265 7375 6c74 293a 0d0a  gress(result):..
-00014130: 2020 2020 2020 2020 2020 2020 6966 2072              if r
-00014140: 6573 756c 742e 6765 7428 2265 7272 6f72  esult.get("error
-00014150: 2229 206f 7220 7265 7375 6c74 2e67 6574  ") or result.get
-00014160: 2822 7374 6f70 2229 3a0d 0a20 2020 2020  ("stop"):..     
-00014170: 2020 2020 2020 2020 2020 2075 7469 6c2e             util.
-00014180: 7472 795f 6967 6e6f 7265 286c 616d 6264  try_ignore(lambd
-00014190: 613a 2064 622e 636c 6f73 6528 2929 0d0a  a: db.close())..
-000141a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000141b0: 7574 696c 2e74 7279 5f69 676e 6f72 6528  util.try_ignore(
-000141c0: 6f73 2e75 6e6c 696e 6b2c 2066 696c 656e  os.unlink, filen
-000141d0: 616d 6529 0d0a 2020 2020 2020 2020 2020  ame)..          
-000141e0: 2020 6966 2072 6573 756c 742e 6765 7428    if result.get(
-000141f0: 2264 6f6e 6522 293a 0d0a 2020 2020 2020  "done"):..      
-00014200: 2020 2020 2020 2020 2020 776f 726b 6572            worker
-00014210: 2e73 746f 7028 290d 0a20 2020 2020 2020  .stop()..       
-00014220: 2020 2020 2020 2020 2073 656c 662e 776f           self.wo
-00014230: 726b 6572 735f 696d 706f 7274 2e70 6f70  rkers_import.pop
-00014240: 2866 696c 656e 616d 652c 204e 6f6e 6529  (filename, None)
-00014250: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-00014260: 6465 6620 6166 7465 7228 293a 0d0a 2020  def after():..  
-00014270: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00014280: 206e 6f74 2073 656c 663a 2072 6574 7572   not self: retur
-00014290: 6e0d 0a0d 0a20 2020 2020 2020 2020 2020  n....           
-000142a0: 2020 2020 2069 6620 7265 7375 6c74 2e67       if result.g
-000142b0: 6574 2822 6572 726f 7222 293a 0d0a 2020  et("error"):..  
-000142c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000142d0: 2020 646c 672e 4465 7374 726f 7928 290d    dlg.Destroy().
-000142e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000142f0: 2020 2020 2067 7569 6261 7365 2e73 7461       guibase.sta
-00014300: 7475 7328 2245 7272 6f72 2070 6172 7369  tus("Error parsi
-00014310: 6e67 2053 6b79 7065 2065 7870 6f72 7422  ng Skype export"
-00014320: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00014330: 2020 2020 2020 2077 782e 4d65 7373 6167         wx.Messag
-00014340: 6542 6f78 2822 4572 726f 7220 7061 7273  eBox("Error pars
-00014350: 696e 6720 536b 7970 6520 6578 706f 7274  ing Skype export
-00014360: 3a5c 6e25 7322 2025 2072 6573 756c 745b  :\n%s" % result[
-00014370: 2265 7272 6f72 5f73 686f 7274 225d 2c0d  "error_short"],.
-00014380: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000143a0: 2020 2063 6f6e 662e 5469 746c 652c 2077     conf.Title, w
-000143b0: 782e 4f4b 207c 2077 782e 4943 4f4e 5f45  x.OK | wx.ICON_E
-000143c0: 5252 4f52 290d 0a20 2020 2020 2020 2020  RROR)..         
-000143d0: 2020 2020 2020 2065 6c69 6620 7265 7375         elif resu
-000143e0: 6c74 2e67 6574 2822 7374 6f70 2229 3a0d  lt.get("stop"):.
-000143f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014400: 2020 2020 2064 6c67 2e44 6573 7472 6f79       dlg.Destroy
-00014410: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
-00014420: 2020 2020 2020 2020 6775 6962 6173 652e          guibase.
-00014430: 7374 6174 7573 2829 0d0a 2020 2020 2020  status()..      
-00014440: 2020 2020 2020 2020 2020 656c 6966 2072            elif r
-00014450: 6573 756c 742e 6765 7428 2264 6f6e 6522  esult.get("done"
-00014460: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00014470: 2020 2020 2020 2020 646c 672e 4465 7374          dlg.Dest
-00014480: 726f 7928 290d 0a20 2020 2020 2020 2020  roy()..         
-00014490: 2020 2020 2020 2020 2020 2067 7569 6261             guiba
-000144a0: 7365 2e73 7461 7475 7328 290d 0a20 2020  se.status()..   
-000144b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000144c0: 2064 622e 636c 6f73 6528 290d 0a20 2020   db.close()..   
-000144d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000144e0: 2073 656c 662e 7570 6461 7465 5f64 6174   self.update_dat
-000144f0: 6162 6173 655f 6c69 7374 2866 696c 656e  abase_list(filen
-00014500: 616d 6529 0d0a 2020 2020 2020 2020 2020  ame)..          
-00014510: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
-00014520: 6f61 645f 6461 7461 6261 7365 5f70 6167  oad_database_pag
-00014530: 6528 6669 6c65 6e61 6d65 290d 0a20 2020  e(filename)..   
-00014540: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-00014550: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00014560: 2020 2020 2020 2020 7420 3d20 222c 2022          t = ", "
-00014570: 2e6a 6f69 6e28 7574 696c 2e70 6c75 7261  .join(util.plura
-00014580: 6c28 785b 3a2d 315d 2c20 7265 7375 6c74  l(x[:-1], result
-00014590: 5b22 636f 756e 7473 225d 5b78 5d2c 2073  ["counts"][x], s
-000145a0: 6570 3d22 2c22 290d 0a20 2020 2020 2020  ep=",")..       
-000145b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000145c0: 2020 2020 2020 2020 2020 2066 6f72 2078             for x
-000145d0: 2069 6e20 736f 7274 6564 2872 6573 756c   in sorted(resul
-000145e0: 745b 2263 6f75 6e74 7322 5d29 290d 0a20  t["counts"])).. 
+000123a0: 2020 2020 2020 2020 2020 2022 2642 6c61             "&Bla
+000123b0: 6e6b 2053 6b79 7065 2064 6174 6162 6173  nk Skype databas
+000123c0: 652c 2070 6f70 756c 6174 6564 2077 6974  e, populated wit
+000123d0: 6820 7573 6572 6e61 6d65 206f 6e6c 7922  h username only"
+000123e0: 2929 0d0a 2020 2020 2020 2020 6974 656d  ))..        item
+000123f0: 5f6c 6976 6520 2020 3d20 6d65 6e75 2e41  _live   = menu.A
+00012400: 7070 656e 6449 7465 6d28 7778 2e6c 6962  ppendItem(wx.lib
+00012410: 2e61 6777 2e66 6c61 746d 656e 752e 466c  .agw.flatmenu.Fl
+00012420: 6174 4d65 6e75 4974 656d 286d 656e 752c  atMenuItem(menu,
+00012430: 2077 782e 4944 5f41 4e59 2c0d 0a20 2020   wx.ID_ANY,..   
+00012440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012460: 2020 2022 4672 6f6d 2053 6b79 7065 206f     "From Skype o
+00012470: 6e26 6c69 6e65 2073 6572 7669 6365 2c20  n&line service, 
+00012480: 6279 206c 6f67 6769 6e67 2069 6e20 220d  by logging in ".
+00012490: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000124a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000124b0: 2020 2020 2020 2022 616e 6420 646f 776e         "and down
+000124c0: 6c6f 6164 696e 6720 6176 6169 6c61 626c  loading availabl
+000124d0: 6520 6869 7374 6f72 7922 0d0a 2020 2020  e history"..    
+000124e0: 2020 2020 2929 2069 6620 6c69 7665 2e73      )) if live.s
+000124f0: 6b70 7920 656c 7365 204e 6f6e 650d 0a20  kpy else None.. 
+00012500: 2020 2020 2020 2069 7465 6d5f 6578 706f         item_expo
+00012510: 7274 203d 206d 656e 752e 4170 7065 6e64  rt = menu.Append
+00012520: 4974 656d 2877 782e 6c69 622e 6167 772e  Item(wx.lib.agw.
+00012530: 666c 6174 6d65 6e75 2e46 6c61 744d 656e  flatmenu.FlatMen
+00012540: 7549 7465 6d28 6d65 6e75 2c20 7778 2e49  uItem(menu, wx.I
+00012550: 445f 414e 592c 0d0a 2020 2020 2020 2020  D_ANY,..        
+00012560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012570: 2020 2020 2020 2020 2020 2020 2022 4672               "Fr
+00012580: 6f6d 2061 2053 6b79 7065 2026 6578 706f  om a Skype &expo
+00012590: 7274 2061 7263 6869 7665 2028 2a2e 6a73  rt archive (*.js
+000125a0: 6f6e 3b2a 2e74 6172 2922 0d0a 2020 2020  on;*.tar)"..    
+000125b0: 2020 2020 2929 2069 6620 6c69 7665 2e69      )) if live.i
+000125c0: 6a73 6f6e 2065 6c73 6520 4e6f 6e65 0d0a  json else None..
+000125d0: 2020 2020 2020 2020 7365 6c66 2e42 696e          self.Bin
+000125e0: 6428 7778 2e45 5654 5f4d 454e 552c 2073  d(wx.EVT_MENU, s
+000125f0: 656c 662e 6f6e 5f6e 6577 5f62 6c61 6e6b  elf.on_new_blank
+00012600: 2c20 6974 656d 5f62 6c61 6e6b 290d 0a20  , item_blank).. 
+00012610: 2020 2020 2020 2069 6620 6974 656d 5f6c         if item_l
+00012620: 6976 653a 2020 2073 656c 662e 4269 6e64  ive:   self.Bind
+00012630: 2877 782e 4556 545f 4d45 4e55 2c20 7365  (wx.EVT_MENU, se
+00012640: 6c66 2e6f 6e5f 6e65 775f 6c69 7665 2c20  lf.on_new_live, 
+00012650: 2020 6974 656d 5f6c 6976 6529 0d0a 2020    item_live)..  
+00012660: 2020 2020 2020 6966 2069 7465 6d5f 6578        if item_ex
+00012670: 706f 7274 3a20 7365 6c66 2e42 696e 6428  port: self.Bind(
+00012680: 7778 2e45 5654 5f4d 454e 552c 2073 656c  wx.EVT_MENU, sel
+00012690: 662e 6f6e 5f6e 6577 5f65 7870 6f72 742c  f.on_new_export,
+000126a0: 2069 7465 6d5f 6578 706f 7274 290d 0a0d   item_export)...
+000126b0: 0a20 2020 2020 2020 2062 746e 203d 2073  .        btn = s
+000126c0: 656c 662e 6275 7474 6f6e 5f6e 6577 0d0a  elf.button_new..
+000126d0: 2020 2020 2020 2020 737a 5f62 746e 2c20          sz_btn, 
+000126e0: 7074 5f62 746e 203d 2062 746e 2e53 697a  pt_btn = btn.Siz
+000126f0: 652c 2062 746e 2e50 6f73 6974 696f 6e0d  e, btn.Position.
+00012700: 0a20 2020 2020 2020 2070 745f 6274 6e20  .        pt_btn 
+00012710: 3d20 6274 6e2e 5061 7265 6e74 2e43 6c69  = btn.Parent.Cli
+00012720: 656e 7454 6f53 6372 6565 6e28 7074 5f62  entToScreen(pt_b
+00012730: 746e 290d 0a20 2020 2020 2020 206d 656e  tn)..        men
+00012740: 752e 5365 744f 776e 6572 4865 6967 6874  u.SetOwnerHeight
+00012750: 2873 7a5f 6274 6e2e 7929 0d0a 2020 2020  (sz_btn.y)..    
+00012760: 2020 2020 6966 206d 656e 752e 5369 7a65      if menu.Size
+00012770: 2e77 6964 7468 203c 2073 7a5f 6274 6e2e  .width < sz_btn.
+00012780: 7769 6474 683a 0d0a 2020 2020 2020 2020  width:..        
+00012790: 2020 2020 6d65 6e75 2e53 697a 6520 3d20      menu.Size = 
+000127a0: 737a 5f62 746e 2e77 6964 7468 2c20 6d65  sz_btn.width, me
+000127b0: 6e75 2e53 697a 652e 6865 6967 6874 0d0a  nu.Size.height..
+000127c0: 2020 2020 2020 2020 6d65 6e75 2e50 6f70          menu.Pop
+000127d0: 7570 2828 7074 5f62 746e 292c 2073 656c  up((pt_btn), sel
+000127e0: 6629 0d0a 0d0a 0d0a 2020 2020 6465 6620  f)......    def 
+000127f0: 6f6e 5f6e 6577 5f62 6c61 6e6b 2873 656c  on_new_blank(sel
+00012800: 662c 2065 7665 6e74 293a 0d0a 2020 2020  f, event):..    
+00012810: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
+00012820: 2048 616e 646c 6572 2066 6f72 2063 7265   Handler for cre
+00012830: 6174 696e 6720 6120 6e65 7720 626c 616e  ating a new blan
+00012840: 6b20 6461 7461 6261 7365 2c20 6173 6b73  k database, asks
+00012850: 2066 6f72 2075 7365 726e 616d 652c 0d0a   for username,..
+00012860: 2020 2020 2020 2020 706f 7075 6c61 7465          populate
+00012870: 7320 6120 6e65 7720 6461 7461 6261 7365  s a new database
+00012880: 2061 6e64 206f 7065 6e73 2074 6865 2064   and opens the d
+00012890: 6174 6162 6173 6520 7061 6765 2e0d 0a20  atabase page... 
+000128a0: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
+000128b0: 2020 2020 6469 616c 6f67 3120 3d20 7778      dialog1 = wx
+000128c0: 2e54 6578 7445 6e74 7279 4469 616c 6f67  .TextEntryDialog
+000128d0: 2873 656c 662c 2022 456e 7465 7220 536b  (self, "Enter Sk
+000128e0: 7970 6520 7573 6572 6e61 6d65 2066 6f72  ype username for
+000128f0: 206e 6577 2064 6174 6162 6173 653a 222c   new database:",
+00012900: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00012910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012920: 2020 2020 2020 2063 6f6e 662e 5469 746c         conf.Titl
+00012930: 652c 2073 7479 6c65 3d77 782e 4f4b 207c  e, style=wx.OK |
+00012940: 2077 782e 4341 4e43 454c 290d 0a20 2020   wx.CANCEL)..   
+00012950: 2020 2020 2064 6961 6c6f 6731 2e43 656e       dialog1.Cen
+00012960: 7465 724f 6e50 6172 656e 7428 290d 0a20  terOnParent().. 
+00012970: 2020 2020 2020 2069 6620 7778 2e49 445f         if wx.ID_
+00012980: 4f4b 2021 3d20 6469 616c 6f67 312e 5368  OK != dialog1.Sh
+00012990: 6f77 4d6f 6461 6c28 293a 2072 6574 7572  owModal(): retur
+000129a0: 6e0d 0a20 2020 2020 2020 2075 7365 7220  n..        user 
+000129b0: 3d20 6469 616c 6f67 312e 4765 7456 616c  = dialog1.GetVal
+000129c0: 7565 2829 2e73 7472 6970 2829 0d0a 2020  ue().strip()..  
+000129d0: 2020 2020 2020 6966 206e 6f74 2075 7365        if not use
+000129e0: 723a 2072 6574 7572 6e0d 0a0d 0a20 2020  r: return....   
+000129f0: 2020 2020 2066 696c 656e 616d 6530 203d       filename0 =
+00012a00: 206c 6976 652e 6d61 6b65 5f64 625f 7061   live.make_db_pa
+00012a10: 7468 2875 7365 7229 0d0a 2020 2020 2020  th(user)..      
+00012a20: 2020 7574 696c 2e74 7279 5f69 676e 6f72    util.try_ignor
+00012a30: 6528 6f73 2e6d 616b 6564 6972 732c 206f  e(os.makedirs, o
+00012a40: 732e 7061 7468 2e64 6972 6e61 6d65 2866  s.path.dirname(f
+00012a50: 696c 656e 616d 6530 2929 0d0a 2020 2020  ilename0))..    
+00012a60: 2020 2020 6469 616c 6f67 3220 3d20 7778      dialog2 = wx
+00012a70: 2e46 696c 6544 6961 6c6f 6728 7061 7265  .FileDialog(pare
+00012a80: 6e74 3d73 656c 662c 206d 6573 7361 6765  nt=self, message
+00012a90: 3d22 5361 7665 206e 6577 2064 6174 6162  ="Save new datab
+00012aa0: 6173 6522 2c0d 0a20 2020 2020 2020 2020  ase",..         
+00012ab0: 2020 2064 6566 6175 6c74 4469 723d 6f73     defaultDir=os
+00012ac0: 2e70 6174 682e 6469 726e 616d 6528 6669  .path.dirname(fi
+00012ad0: 6c65 6e61 6d65 3029 2c0d 0a20 2020 2020  lename0),..     
+00012ae0: 2020 2020 2020 2064 6566 6175 6c74 4669         defaultFi
+00012af0: 6c65 3d6f 732e 7061 7468 2e62 6173 656e  le=os.path.basen
+00012b00: 616d 6528 6669 6c65 6e61 6d65 3029 2c0d  ame(filename0),.
+00012b10: 0a20 2020 2020 2020 2020 2020 2077 696c  .            wil
+00012b20: 6463 6172 643d 2253 514c 6974 6520 6461  dcard="SQLite da
+00012b30: 7461 6261 7365 2028 2a2e 6462 297c 2a2e  tabase (*.db)|*.
+00012b40: 6462 7c41 6c6c 2066 696c 6573 7c2a 2e2a  db|All files|*.*
+00012b50: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
+00012b60: 7374 796c 653d 7778 2e46 445f 4f56 4552  style=wx.FD_OVER
+00012b70: 5752 4954 455f 5052 4f4d 5054 207c 2077  WRITE_PROMPT | w
+00012b80: 782e 4644 5f53 4156 4520 7c20 7778 2e52  x.FD_SAVE | wx.R
+00012b90: 4553 495a 455f 424f 5244 4552 0d0a 2020  ESIZE_BORDER..  
+00012ba0: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+00012bb0: 2069 6620 7778 2e49 445f 4f4b 2021 3d20   if wx.ID_OK != 
+00012bc0: 6469 616c 6f67 322e 5368 6f77 4d6f 6461  dialog2.ShowModa
+00012bd0: 6c28 293a 2072 6574 7572 6e0d 0a0d 0a20  l(): return.... 
+00012be0: 2020 2020 2020 2077 782e 5969 656c 6449         wx.YieldI
+00012bf0: 664e 6565 6465 6428 2920 2320 416c 6c6f  fNeeded() # Allo
+00012c00: 7720 5549 2074 6f20 7265 6672 6573 680d  w UI to refresh.
+00012c10: 0a20 2020 2020 2020 2066 696c 656e 616d  .        filenam
+00012c20: 6520 3d20 636f 6e74 726f 6c73 2e67 6574  e = controls.get
+00012c30: 5f64 6961 6c6f 675f 7061 7468 2864 6961  _dialog_path(dia
+00012c40: 6c6f 6732 290d 0a0d 0a20 2020 2020 2020  log2)....       
+00012c50: 2069 6620 6669 6c65 6e61 6d65 2069 6e20   if filename in 
+00012c60: 7365 6c66 2e64 6273 206f 7220 6669 6c65  self.dbs or file
+00012c70: 6e61 6d65 2069 6e20 7365 6c66 2e77 6f72  name in self.wor
+00012c80: 6b65 7273 5f69 6d70 6f72 743a 0d0a 2020  kers_import:..  
+00012c90: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00012ca0: 2077 782e 4d65 7373 6167 6542 6f78 2822   wx.MessageBox("
+00012cb0: 2573 2069 7320 6375 7272 656e 746c 7920  %s is currently 
+00012cc0: 6f70 656e 2069 6e20 2573 2c20 6361 6e6e  open in %s, cann
+00012cd0: 6f74 206f 7665 7277 7269 7465 2e22 2025  ot overwrite." %
+00012ce0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00012cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012d00: 2020 2028 6669 6c65 6e61 6d65 2c20 636f     (filename, co
+00012d10: 6e66 2e54 6974 6c65 292c 2063 6f6e 662e  nf.Title), conf.
+00012d20: 5469 746c 652c 2077 782e 4f4b 290d 0a0d  Title, wx.OK)...
+00012d30: 0a20 2020 2020 2020 2062 7573 7920 3d20  .        busy = 
+00012d40: 636f 6e74 726f 6c73 2e42 7573 7950 616e  controls.BusyPan
+00012d50: 656c 2873 656c 662c 2022 4372 6561 7469  el(self, "Creati
+00012d60: 6e67 206e 6577 2064 6174 6162 6173 652e  ng new database.
+00012d70: 2e22 290d 0a20 2020 2020 2020 2074 7279  .")..        try
+00012d80: 3a0d 0a20 2020 2020 2020 2020 2020 206c  :..            l
+00012d90: 6f67 6765 722e 696e 666f 2822 4372 6561  ogger.info("Crea
+00012da0: 7469 6e67 206e 6577 2062 6c61 6e6b 2064  ting new blank d
+00012db0: 6174 6162 6173 6520 2573 2066 6f72 2075  atabase %s for u
+00012dc0: 7365 7220 2725 7327 2e22 2c20 6669 6c65  ser '%s'.", file
+00012dd0: 6e61 6d65 2c20 7573 6572 290d 0a20 2020  name, user)..   
+00012de0: 2020 2020 2020 2020 2064 6220 3d20 736b           db = sk
+00012df0: 7970 6564 6174 612e 536b 7970 6544 6174  ypedata.SkypeDat
+00012e00: 6162 6173 6528 6669 6c65 6e61 6d65 2c20  abase(filename, 
+00012e10: 7472 756e 6361 7465 3d54 7275 6529 0d0a  truncate=True)..
+00012e20: 2020 2020 2020 2020 2020 2020 6462 2e65              db.e
+00012e30: 6e73 7572 655f 7363 6865 6d61 2829 0d0a  nsure_schema()..
+00012e40: 2020 2020 2020 2020 2020 2020 6462 2e69              db.i
+00012e50: 6e73 6572 745f 6163 636f 756e 7428 7b22  nsert_account({"
+00012e60: 736b 7970 656e 616d 6522 3a20 7573 6572  skypename": user
+00012e70: 7d29 0d0a 2020 2020 2020 2020 2020 2020  })..            
+00012e80: 6462 2e74 6162 6c65 735f 6c69 7374 203d  db.tables_list =
+00012e90: 204e 6f6e 6520 2320 466f 7263 6520 7265   None # Force re
+00012ea0: 6c6f 6164 0d0a 2020 2020 2020 2020 2020  load..          
+00012eb0: 2020 6462 2e75 7064 6174 655f 6163 636f    db.update_acco
+00012ec0: 756e 7469 6e66 6f28 290d 0a20 2020 2020  untinfo()..     
+00012ed0: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
+00012ee0: 696f 6e3a 0d0a 2020 2020 2020 2020 2020  ion:..          
+00012ef0: 2020 5f2c 2065 2c20 7462 203d 2073 7973    _, e, tb = sys
+00012f00: 2e65 7863 5f69 6e66 6f28 290d 0a20 2020  .exc_info()..   
+00012f10: 2020 2020 2020 2020 2075 7469 6c2e 7472           util.tr
+00012f20: 795f 6967 6e6f 7265 286f 732e 756e 6c69  y_ignore(os.unli
+00012f30: 6e6b 2c20 6669 6c65 6e61 6d65 290d 0a20  nk, filename).. 
+00012f40: 2020 2020 2020 2020 2020 2073 6978 2e72             six.r
+00012f50: 6572 6169 7365 2874 7970 6528 6529 2c20  eraise(type(e), 
+00012f60: 652c 2074 6229 0d0a 2020 2020 2020 2020  e, tb)..        
+00012f70: 6669 6e61 6c6c 793a 2062 7573 792e 436c  finally: busy.Cl
+00012f80: 6f73 6528 290d 0a0d 0a20 2020 2020 2020  ose()....       
+00012f90: 2073 656c 662e 6c6f 6164 5f64 6174 6162   self.load_datab
+00012fa0: 6173 6528 6669 6c65 6e61 6d65 2c20 6462  ase(filename, db
+00012fb0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00012fc0: 7570 6461 7465 5f64 6174 6162 6173 655f  update_database_
+00012fd0: 6c69 7374 2866 696c 656e 616d 6529 0d0a  list(filename)..
+00012fe0: 2020 2020 2020 2020 7365 6c66 2e6c 6f61          self.loa
+00012ff0: 645f 6461 7461 6261 7365 5f70 6167 6528  d_database_page(
+00013000: 6669 6c65 6e61 6d65 290d 0a0d 0a0d 0a20  filename)...... 
+00013010: 2020 2064 6566 206f 6e5f 6e65 775f 6c69     def on_new_li
+00013020: 7665 2873 656c 662c 2065 7665 6e74 293a  ve(self, event):
+00013030: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
+00013040: 2020 2020 2020 2048 616e 646c 6572 2066         Handler f
+00013050: 6f72 2063 7265 6174 696e 6720 6e65 7720  or creating new 
+00013060: 6461 7461 6261 7365 2066 726f 6d20 6c69  database from li
+00013070: 7665 2c20 6173 6b73 2066 6f72 2075 7365  ve, asks for use
+00013080: 726e 616d 6520 616e 640d 0a20 2020 2020  rname and..     
+00013090: 2020 2070 6173 7377 6f72 642c 206f 7065     password, ope
+000130a0: 6e73 2064 6174 6162 6173 6520 7061 6765  ns database page
+000130b0: 2061 6e64 2073 7461 7274 7320 7379 6e63   and starts sync
+000130c0: 696e 6720 6461 7461 2e0d 0a20 2020 2020  ing data...     
+000130d0: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
+000130e0: 6469 616c 6f67 3120 3d20 4c6f 6769 6e44  dialog1 = LoginD
+000130f0: 6961 6c6f 6728 7365 6c66 2c20 7469 746c  ialog(self, titl
+00013100: 653d 224c 6f67 2069 6e20 746f 2053 6b79  e="Log in to Sky
+00013110: 7065 206f 6e6c 696e 6522 290d 0a20 2020  pe online")..   
+00013120: 2020 2020 2069 6620 7778 2e49 445f 4f4b       if wx.ID_OK
+00013130: 2021 3d20 6469 616c 6f67 312e 5368 6f77   != dialog1.Show
+00013140: 4d6f 6461 6c28 293a 2072 6574 7572 6e0d  Modal(): return.
+00013150: 0a20 2020 2020 2020 2075 7365 722c 2070  .        user, p
+00013160: 7720 3d20 6469 616c 6f67 312e 5573 6572  w = dialog1.User
+00013170: 6e61 6d65 2c20 6469 616c 6f67 312e 5061  name, dialog1.Pa
+00013180: 7373 776f 7264 0d0a 2020 2020 2020 2020  ssword..        
+00013190: 6966 206e 6f74 2075 7365 7220 6f72 206e  if not user or n
+000131a0: 6f74 2070 773a 2072 6574 7572 6e0d 0a0d  ot pw: return...
+000131b0: 0a20 2020 2020 2020 2066 696c 656e 616d  .        filenam
+000131c0: 6530 203d 206c 6976 652e 6d61 6b65 5f64  e0 = live.make_d
+000131d0: 625f 7061 7468 2875 7365 7229 0d0a 2020  b_path(user)..  
+000131e0: 2020 2020 2020 7574 696c 2e74 7279 5f69        util.try_i
+000131f0: 676e 6f72 6528 6f73 2e6d 616b 6564 6972  gnore(os.makedir
+00013200: 732c 206f 732e 7061 7468 2e64 6972 6e61  s, os.path.dirna
+00013210: 6d65 2866 696c 656e 616d 6530 2929 0d0a  me(filename0))..
+00013220: 2020 2020 2020 2020 6469 616c 6f67 3220          dialog2 
+00013230: 3d20 7778 2e46 696c 6544 6961 6c6f 6728  = wx.FileDialog(
+00013240: 7061 7265 6e74 3d73 656c 662c 206d 6573  parent=self, mes
+00013250: 7361 6765 3d22 5361 7665 206e 6577 2064  sage="Save new d
+00013260: 6174 6162 6173 6522 2c0d 0a20 2020 2020  atabase",..     
+00013270: 2020 2020 2020 2064 6566 6175 6c74 4469         defaultDi
+00013280: 723d 6f73 2e70 6174 682e 6469 726e 616d  r=os.path.dirnam
+00013290: 6528 6669 6c65 6e61 6d65 3029 2c0d 0a20  e(filename0),.. 
+000132a0: 2020 2020 2020 2020 2020 2064 6566 6175             defau
+000132b0: 6c74 4669 6c65 3d6f 732e 7061 7468 2e62  ltFile=os.path.b
+000132c0: 6173 656e 616d 6528 6669 6c65 6e61 6d65  asename(filename
+000132d0: 3029 2c0d 0a20 2020 2020 2020 2020 2020  0),..           
+000132e0: 2077 696c 6463 6172 643d 2253 514c 6974   wildcard="SQLit
+000132f0: 6520 6461 7461 6261 7365 2028 2a2e 6462  e database (*.db
+00013300: 297c 2a2e 6462 7c41 6c6c 2066 696c 6573  )|*.db|All files
+00013310: 7c2a 2e2a 222c 0d0a 2020 2020 2020 2020  |*.*",..        
+00013320: 2020 2020 7374 796c 653d 7778 2e46 445f      style=wx.FD_
+00013330: 4f56 4552 5752 4954 455f 5052 4f4d 5054  OVERWRITE_PROMPT
+00013340: 207c 2077 782e 4644 5f53 4156 4520 7c20   | wx.FD_SAVE | 
+00013350: 7778 2e52 4553 495a 455f 424f 5244 4552  wx.RESIZE_BORDER
+00013360: 0d0a 2020 2020 2020 2020 290d 0a20 2020  ..        )..   
+00013370: 2020 2020 2069 6620 7778 2e49 445f 4f4b       if wx.ID_OK
+00013380: 2021 3d20 6469 616c 6f67 322e 5368 6f77   != dialog2.Show
+00013390: 4d6f 6461 6c28 293a 2072 6574 7572 6e0d  Modal(): return.
+000133a0: 0a0d 0a20 2020 2020 2020 2077 782e 5969  ...        wx.Yi
+000133b0: 656c 6449 664e 6565 6465 6428 2920 2320  eldIfNeeded() # 
+000133c0: 416c 6c6f 7720 5549 2074 6f20 7265 6672  Allow UI to refr
+000133d0: 6573 680d 0a20 2020 2020 2020 2066 696c  esh..        fil
+000133e0: 656e 616d 6520 3d20 636f 6e74 726f 6c73  ename = controls
+000133f0: 2e67 6574 5f64 6961 6c6f 675f 7061 7468  .get_dialog_path
+00013400: 2864 6961 6c6f 6732 290d 0a0d 0a20 2020  (dialog2)....   
+00013410: 2020 2020 2069 6620 6669 6c65 6e61 6d65       if filename
+00013420: 2069 6e20 7365 6c66 2e64 6273 206f 7220   in self.dbs or 
+00013430: 6669 6c65 6e61 6d65 2069 6e20 7365 6c66  filename in self
+00013440: 2e77 6f72 6b65 7273 5f69 6d70 6f72 743a  .workers_import:
+00013450: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+00013460: 7475 726e 2077 782e 4d65 7373 6167 6542  turn wx.MessageB
+00013470: 6f78 2822 2573 2069 7320 6375 7272 656e  ox("%s is curren
+00013480: 746c 7920 6f70 656e 2069 6e20 2573 2c20  tly open in %s, 
+00013490: 6361 6e6e 6f74 206f 7665 7277 7269 7465  cannot overwrite
+000134a0: 2e22 2025 0d0a 2020 2020 2020 2020 2020  ." %..          
+000134b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000134c0: 2020 2020 2020 2028 6669 6c65 6e61 6d65         (filename
+000134d0: 2c20 636f 6e66 2e54 6974 6c65 292c 2063  , conf.Title), c
+000134e0: 6f6e 662e 5469 746c 652c 2077 782e 4f4b  onf.Title, wx.OK
+000134f0: 290d 0a0d 0a20 2020 2020 2020 2073 6b79  )....        sky
+00013500: 7065 203d 206c 6976 652e 536b 7970 654c  pe = live.SkypeL
+00013510: 6f67 696e 2829 0d0a 2020 2020 2020 2020  ogin()..        
+00013520: 6275 7379 203d 2063 6f6e 7472 6f6c 732e  busy = controls.
+00013530: 4275 7379 5061 6e65 6c28 7365 6c66 2c20  BusyPanel(self, 
+00013540: 224c 6f67 6769 6e67 2069 6e20 6173 2027  "Logging in as '
+00013550: 2573 272e 2220 2520 7573 6572 290d 0a20  %s'." % user).. 
+00013560: 2020 2020 2020 2073 656c 662e 5265 6672         self.Refr
+00013570: 6573 6828 290d 0a20 2020 2020 2020 2074  esh()..        t
+00013580: 7279 3a0d 0a20 2020 2020 2020 2020 2020  ry:..           
+00013590: 2074 7279 3a20 736b 7970 652e 6c6f 6769   try: skype.logi
+000135a0: 6e28 7573 6572 2c20 7077 2c20 746f 6b65  n(user, pw, toke
+000135b0: 6e3d 4661 6c73 652c 2069 6e69 745f 6462  n=False, init_db
+000135c0: 3d46 616c 7365 290d 0a20 2020 2020 2020  =False)..       
+000135d0: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
+000135e0: 7074 696f 6e20 6173 2065 3a0d 0a20 2020  ption as e:..   
+000135f0: 2020 2020 2020 2020 2020 2020 2062 7573               bus
+00013600: 792e 436c 6f73 6528 290d 0a20 2020 2020  y.Close()..     
+00013610: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00013620: 6e20 7778 2e4d 6573 7361 6765 426f 7828  n wx.MessageBox(
+00013630: 2246 6169 6c65 6420 746f 206c 6f67 2069  "Failed to log i
+00013640: 6e20 6173 2027 2573 273a 5c6e 5c6e 2573  n as '%s':\n\n%s
+00013650: 2220 250d 0a20 2020 2020 2020 2020 2020  " %..           
+00013660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013670: 2020 2020 2020 2020 2020 2875 7365 722c            (user,
+00013680: 2075 7469 6c2e 666f 726d 6174 5f65 7863   util.format_exc
+00013690: 2865 2929 2c0d 0a20 2020 2020 2020 2020  (e)),..         
+000136a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000136b0: 2020 2020 2020 2020 2020 2020 636f 6e66              conf
+000136c0: 2e54 6974 6c65 2c20 7778 2e4f 4b20 7c20  .Title, wx.OK | 
+000136d0: 7778 2e49 434f 4e5f 4552 524f 5229 0d0a  wx.ICON_ERROR)..
+000136e0: 0d0a 2020 2020 2020 2020 2020 2020 636f  ..            co
+000136f0: 6e66 2e4c 6f67 696e 2e73 6574 6465 6661  nf.Login.setdefa
+00013700: 756c 7428 6669 6c65 6e61 6d65 2c20 7b7d  ult(filename, {}
+00013710: 295b 2270 6173 7377 6f72 6422 5d20 3d20  )["password"] = 
+00013720: 7574 696c 2e6f 6266 7573 6361 7465 2870  util.obfuscate(p
+00013730: 7729 0d0a 2020 2020 2020 2020 2020 2020  w)..            
+00013740: 7472 793a 0d0a 2020 2020 2020 2020 2020  try:..          
+00013750: 2020 2020 2020 6c6f 6767 6572 2e69 6e66        logger.inf
+00013760: 6f28 2243 7265 6174 696e 6720 6e65 7720  o("Creating new 
+00013770: 536b 7970 6520 6461 7461 6261 7365 2066  Skype database f
+00013780: 696c 6520 2573 2066 726f 6d20 536b 7970  ile %s from Skyp
+00013790: 6520 6f6e 6c69 6e65 2022 0d0a 2020 2020  e online "..    
+000137a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000137b0: 2020 2020 2020 2020 2266 6f72 2075 7365          "for use
+000137c0: 7220 2725 7327 2e22 2c20 6669 6c65 6e61  r '%s'.", filena
+000137d0: 6d65 2c20 7573 6572 290d 0a20 2020 2020  me, user)..     
+000137e0: 2020 2020 2020 2020 2020 2073 6b79 7065             skype
+000137f0: 2e69 6e69 745f 6462 2866 696c 656e 616d  .init_db(filenam
+00013800: 652c 2074 7275 6e63 6174 653d 5472 7565  e, truncate=True
+00013810: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00013820: 2020 2073 6b79 7065 2e73 6176 6528 2261     skype.save("a
+00013830: 6363 6f75 6e74 7322 2c20 736b 7970 652e  ccounts", skype.
+00013840: 736b 7970 652e 7573 6572 290d 0a20 2020  skype.user)..   
+00013850: 2020 2020 2020 2020 2020 2020 2073 6b79               sky
+00013860: 7065 2e64 622e 7461 626c 6573 5f6c 6973  pe.db.tables_lis
+00013870: 7420 3d20 4e6f 6e65 2023 2046 6f72 6365  t = None # Force
+00013880: 2072 656c 6f61 640d 0a20 2020 2020 2020   reload..       
+00013890: 2020 2020 2020 2020 2073 6b79 7065 2e64           skype.d
+000138a0: 622e 7570 6461 7465 5f61 6363 6f75 6e74  b.update_account
+000138b0: 696e 666f 2829 0d0a 2020 2020 2020 2020  info()..        
+000138c0: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
+000138d0: 7469 6f6e 3a0d 0a20 2020 2020 2020 2020  tion:..         
+000138e0: 2020 2020 2020 205f 2c20 652c 2074 6220         _, e, tb 
+000138f0: 3d20 7379 732e 6578 635f 696e 666f 2829  = sys.exc_info()
+00013900: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00013910: 2020 7574 696c 2e74 7279 5f69 676e 6f72    util.try_ignor
+00013920: 6528 736b 7970 652e 6462 2061 6e64 2073  e(skype.db and s
+00013930: 6b79 7065 2e64 622e 636c 6f73 6529 0d0a  kype.db.close)..
+00013940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013950: 7574 696c 2e74 7279 5f69 676e 6f72 6528  util.try_ignore(
+00013960: 6f73 2e75 6e6c 696e 6b2c 2066 696c 656e  os.unlink, filen
+00013970: 616d 6529 0d0a 2020 2020 2020 2020 2020  ame)..          
+00013980: 2020 2020 2020 6c6f 6767 6572 2e65 7863        logger.exc
+00013990: 6570 7469 6f6e 2822 4572 726f 7220 7361  eption("Error sa
+000139a0: 7669 6e67 2061 6363 6f75 6e74 2025 722e  ving account %r.
+000139b0: 222c 2073 6b79 7065 2e73 6b79 7065 2e75  ", skype.skype.u
+000139c0: 7365 7229 0d0a 2020 2020 2020 2020 2020  ser)..          
+000139d0: 2020 2020 2020 7369 782e 7265 7261 6973        six.rerais
+000139e0: 6528 7479 7065 2865 292c 2065 2c20 7462  e(type(e), e, tb
+000139f0: 290d 0a20 2020 2020 2020 2066 696e 616c  )..        final
+00013a00: 6c79 3a20 6275 7379 2e43 6c6f 7365 2829  ly: busy.Close()
+00013a10: 0d0a 0d0a 2020 2020 2020 2020 636f 6e66  ....        conf
+00013a20: 2e4c 6f67 696e 2e73 6574 6465 6661 756c  .Login.setdefaul
+00013a30: 7428 6669 6c65 6e61 6d65 2c20 7b7d 295b  t(filename, {})[
+00013a40: 2273 796e 635f 6f6c 6465 7222 5d20 3d20  "sync_older"] = 
+00013a50: 4661 6c73 650d 0a20 2020 2020 2020 2073  False..        s
+00013a60: 656c 662e 6c6f 6164 5f64 6174 6162 6173  elf.load_databas
+00013a70: 6528 6669 6c65 6e61 6d65 2c20 736b 7970  e(filename, skyp
+00013a80: 652e 6462 290d 0a20 2020 2020 2020 2073  e.db)..        s
+00013a90: 656c 662e 7570 6461 7465 5f64 6174 6162  elf.update_datab
+00013aa0: 6173 655f 6c69 7374 2866 696c 656e 616d  ase_list(filenam
+00013ab0: 6529 0d0a 2020 2020 2020 2020 7061 6765  e)..        page
+00013ac0: 203d 2073 656c 662e 6c6f 6164 5f64 6174   = self.load_dat
+00013ad0: 6162 6173 655f 7061 6765 2866 696c 656e  abase_page(filen
+00013ae0: 616d 6529 0d0a 2020 2020 2020 2020 6966  ame)..        if
+00013af0: 206e 6f74 2070 6167 653a 2072 6574 7572   not page: retur
+00013b00: 6e0d 0a0d 0a20 2020 2020 2020 2069 6620  n....        if 
+00013b10: 6e6f 7420 636f 6e66 2e4c 6f67 696e 2e67  not conf.Login.g
+00013b20: 6574 2866 696c 656e 616d 652c 207b 7d29  et(filename, {})
+00013b30: 2e67 6574 2822 7374 6f72 6522 293a 0d0a  .get("store"):..
+00013b40: 2020 2020 2020 2020 2020 2020 636f 6e66              conf
+00013b50: 2e4c 6f67 696e 2e67 6574 2866 696c 656e  .Login.get(filen
+00013b60: 616d 652c 207b 7d29 2e70 6f70 2822 7061  ame, {}).pop("pa
+00013b70: 7373 776f 7264 222c 204e 6f6e 6529 0d0a  ssword", None)..
+00013b80: 2020 2020 2020 2020 7061 6765 2e6e 6f74          page.not
+00013b90: 6562 6f6f 6b2e 5365 6c65 6374 696f 6e20  ebook.Selection 
+00013ba0: 3d20 7061 6765 2e70 6167 656f 7264 6572  = page.pageorder
+00013bb0: 5b70 6167 652e 7061 6765 5f6c 6976 655d  [page.page_live]
+00013bc0: 0d0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
+00013bd0: 2063 6f6e 662e 4c6f 6769 6e2e 6765 7428   conf.Login.get(
+00013be0: 6669 6c65 6e61 6d65 2c20 7b7d 292e 6765  filename, {}).ge
+00013bf0: 7428 2273 796e 6322 293a 0d0a 2020 2020  t("sync"):..    
+00013c00: 2020 2020 2020 2020 7061 6765 2e6f 6e5f          page.on_
+00013c10: 6c69 7665 5f72 6573 756c 7428 6163 7469  live_result(acti
+00013c20: 6f6e 3d22 6c6f 6769 6e22 2c20 6f70 7473  on="login", opts
+00013c30: 3d7b 2273 796e 6322 3a20 5472 7565 7d29  ={"sync": True})
+00013c40: 0d0a 0d0a 0d0a 2020 2020 6465 6620 6f6e  ......    def on
+00013c50: 5f6e 6577 5f65 7870 6f72 7428 7365 6c66  _new_export(self
+00013c60: 2c20 6576 656e 7429 3a0d 0a20 2020 2020  , event):..     
+00013c70: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
+00013c80: 4861 6e64 6c65 7220 666f 7220 6372 6561  Handler for crea
+00013c90: 7469 6e67 2061 206e 6577 2062 6c61 6e6b  ting a new blank
+00013ca0: 2064 6174 6162 6173 6520 6672 6f6d 2053   database from S
+00013cb0: 6b79 7065 2065 7870 6f72 742c 0d0a 2020  kype export,..  
+00013cc0: 2020 2020 2020 6f70 656e 7320 6469 616c        opens dial
+00013cd0: 6f67 7320 666f 7220 6368 6f6f 7369 6e67  ogs for choosing
+00013ce0: 2065 7870 6f72 7420 6669 6c65 2061 6e64   export file and
+00013cf0: 2064 6174 6162 6173 6520 6c6f 6361 7469   database locati
+00013d00: 6f6e 2e0d 0a20 2020 2020 2020 2022 2222  on...        """
+00013d10: 0d0a 2020 2020 2020 2020 6469 616c 6f67  ..        dialog
+00013d20: 3120 3d20 7365 6c66 2e64 6961 6c6f 675f  1 = self.dialog_
+00013d30: 6f70 656e 6578 706f 7274 0d0a 2020 2020  openexport..    
+00013d40: 2020 2020 6469 616c 6f67 312e 5368 6f77      dialog1.Show
+00013d50: 4d6f 6461 6c28 290d 0a20 2020 2020 2020  Modal()..       
+00013d60: 2065 6669 6c65 6e61 6d65 203d 2064 6961   efilename = dia
+00013d70: 6c6f 6731 2e47 6574 5061 7468 2829 0d0a  log1.GetPath()..
+00013d80: 2020 2020 2020 2020 6966 206e 6f74 2065          if not e
+00013d90: 6669 6c65 6e61 6d65 3a20 7265 7475 726e  filename: return
+00013da0: 0d0a 0d0a 2020 2020 2020 2020 7573 6572  ....        user
+00013db0: 203d 206c 6976 652e 536b 7970 6545 7870   = live.SkypeExp
+00013dc0: 6f72 742e 6578 706f 7274 5f67 6574 5f61  ort.export_get_a
+00013dd0: 6363 6f75 6e74 2865 6669 6c65 6e61 6d65  ccount(efilename
+00013de0: 290d 0a20 2020 2020 2020 2069 6620 6e6f  )..        if no
+00013df0: 7420 7573 6572 3a20 7265 7475 726e 2077  t user: return w
+00013e00: 782e 4d65 7373 6167 6542 6f78 2822 4e6f  x.MessageBox("No
+00013e10: 2053 6b79 7065 2075 7365 726e 616d 6520   Skype username 
+00013e20: 666f 756e 6420 696e 2025 732e 2220 2520  found in %s." % 
+00013e30: 6566 696c 656e 616d 652c 0d0a 2020 2020  efilename,..    
+00013e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013e60: 2020 2020 2020 636f 6e66 2e54 6974 6c65        conf.Title
+00013e70: 2c20 7778 2e4f 4b20 7c20 7778 2e49 434f  , wx.OK | wx.ICO
+00013e80: 4e5f 5741 524e 494e 4729 0d0a 0d0a 2020  N_WARNING)....  
+00013e90: 2020 2020 2020 6669 6c65 6e61 6d65 3020        filename0 
+00013ea0: 3d20 6c69 7665 2e6d 616b 655f 6462 5f70  = live.make_db_p
+00013eb0: 6174 6828 7573 6572 290d 0a20 2020 2020  ath(user)..     
+00013ec0: 2020 2075 7469 6c2e 7472 795f 6967 6e6f     util.try_igno
+00013ed0: 7265 286f 732e 6d61 6b65 6469 7273 2c20  re(os.makedirs, 
+00013ee0: 6f73 2e70 6174 682e 6469 726e 616d 6528  os.path.dirname(
+00013ef0: 6669 6c65 6e61 6d65 3029 290d 0a20 2020  filename0))..   
+00013f00: 2020 2020 2064 6961 6c6f 6732 203d 2077       dialog2 = w
+00013f10: 782e 4669 6c65 4469 616c 6f67 2870 6172  x.FileDialog(par
+00013f20: 656e 743d 7365 6c66 2c20 6d65 7373 6167  ent=self, messag
+00013f30: 653d 2253 6176 6520 6e65 7720 6461 7461  e="Save new data
+00013f40: 6261 7365 222c 0d0a 2020 2020 2020 2020  base",..        
+00013f50: 2020 2020 6465 6661 756c 7444 6972 3d6f      defaultDir=o
+00013f60: 732e 7061 7468 2e64 6972 6e61 6d65 2866  s.path.dirname(f
+00013f70: 696c 656e 616d 6530 292c 0d0a 2020 2020  ilename0),..    
+00013f80: 2020 2020 2020 2020 6465 6661 756c 7446          defaultF
+00013f90: 696c 653d 6f73 2e70 6174 682e 6261 7365  ile=os.path.base
+00013fa0: 6e61 6d65 2866 696c 656e 616d 6530 292c  name(filename0),
+00013fb0: 0d0a 2020 2020 2020 2020 2020 2020 7769  ..            wi
+00013fc0: 6c64 6361 7264 3d22 5351 4c69 7465 2064  ldcard="SQLite d
+00013fd0: 6174 6162 6173 6520 282a 2e64 6229 7c2a  atabase (*.db)|*
+00013fe0: 2e64 627c 416c 6c20 6669 6c65 737c 2a2e  .db|All files|*.
+00013ff0: 2a22 2c0d 0a20 2020 2020 2020 2020 2020  *",..           
+00014000: 2073 7479 6c65 3d77 782e 4644 5f4f 5645   style=wx.FD_OVE
+00014010: 5257 5249 5445 5f50 524f 4d50 5420 7c20  RWRITE_PROMPT | 
+00014020: 7778 2e46 445f 5341 5645 207c 2077 782e  wx.FD_SAVE | wx.
+00014030: 5245 5349 5a45 5f42 4f52 4445 520d 0a20  RESIZE_BORDER.. 
+00014040: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
+00014050: 2020 6966 2077 782e 4944 5f4f 4b20 213d    if wx.ID_OK !=
+00014060: 2064 6961 6c6f 6732 2e53 686f 774d 6f64   dialog2.ShowMod
+00014070: 616c 2829 3a20 7265 7475 726e 0d0a 0d0a  al(): return....
+00014080: 2020 2020 2020 2020 7778 2e59 6965 6c64          wx.Yield
+00014090: 4966 4e65 6564 6564 2829 2023 2041 6c6c  IfNeeded() # All
+000140a0: 6f77 2055 4920 746f 2072 6566 7265 7368  ow UI to refresh
+000140b0: 0d0a 2020 2020 2020 2020 6669 6c65 6e61  ..        filena
+000140c0: 6d65 203d 2063 6f6e 7472 6f6c 732e 6765  me = controls.ge
+000140d0: 745f 6469 616c 6f67 5f70 6174 6828 6469  t_dialog_path(di
+000140e0: 616c 6f67 3229 0d0a 0d0a 2020 2020 2020  alog2)....      
+000140f0: 2020 6966 2066 696c 656e 616d 6520 696e    if filename in
+00014100: 2073 656c 662e 6462 7320 6f72 2066 696c   self.dbs or fil
+00014110: 656e 616d 6520 696e 2073 656c 662e 776f  ename in self.wo
+00014120: 726b 6572 735f 696d 706f 7274 3a0d 0a20  rkers_import:.. 
+00014130: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00014140: 6e20 7778 2e4d 6573 7361 6765 426f 7828  n wx.MessageBox(
+00014150: 2225 7320 6973 2063 7572 7265 6e74 6c79  "%s is currently
+00014160: 206f 7065 6e20 696e 2025 732c 2063 616e   open in %s, can
+00014170: 6e6f 7420 6f76 6572 7772 6974 652e 2220  not overwrite." 
+00014180: 250d 0a20 2020 2020 2020 2020 2020 2020  %..             
+00014190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000141a0: 2020 2020 2866 696c 656e 616d 652c 2063      (filename, c
+000141b0: 6f6e 662e 5469 746c 6529 2c20 636f 6e66  onf.Title), conf
+000141c0: 2e54 6974 6c65 2c20 7778 2e4f 4b29 0d0a  .Title, wx.OK)..
+000141d0: 0d0a 2020 2020 2020 2020 6465 6620 6f6e  ..        def on
+000141e0: 5f63 616e 6365 6c28 293a 0d0a 2020 2020  _cancel():..    
+000141f0: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
+00014200: 2077 782e 4f4b 203d 3d20 7778 2e4d 6573   wx.OK == wx.Mes
+00014210: 7361 6765 426f 7828 2243 616e 6365 6c20  sageBox("Cancel 
+00014220: 696d 706f 7274 3f22 2c20 636f 6e66 2e54  import?", conf.T
+00014230: 6974 6c65 2c20 7778 2e4f 4b20 7c20 7778  itle, wx.OK | wx
+00014240: 2e43 414e 4345 4c29 0d0a 2020 2020 2020  .CANCEL)..      
+00014250: 2020 2020 2020 6966 2072 6573 756c 743a        if result:
+00014260: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00014270: 2020 776f 726b 6572 2e73 746f 7028 6472    worker.stop(dr
+00014280: 6f70 5f72 6573 756c 7473 3d46 616c 7365  op_results=False
+00014290: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+000142a0: 2020 2073 656c 662e 776f 726b 6572 735f     self.workers_
+000142b0: 696d 706f 7274 2e70 6f70 2866 696c 656e  import.pop(filen
+000142c0: 616d 652c 204e 6f6e 6529 0d0a 2020 2020  ame, None)..    
+000142d0: 2020 2020 2020 2020 7265 7475 726e 2072          return r
+000142e0: 6573 756c 740d 0a0d 0a20 2020 2020 2020  esult....       
+000142f0: 2064 6566 206f 6e5f 7072 6f67 7265 7373   def on_progress
+00014300: 2872 6573 756c 7429 3a0d 0a20 2020 2020  (result):..     
+00014310: 2020 2020 2020 2069 6620 7265 7375 6c74         if result
+00014320: 2e67 6574 2822 6572 726f 7222 2920 6f72  .get("error") or
+00014330: 2072 6573 756c 742e 6765 7428 2273 746f   result.get("sto
+00014340: 7022 293a 0d0a 2020 2020 2020 2020 2020  p"):..          
+00014350: 2020 2020 2020 7574 696c 2e74 7279 5f69        util.try_i
+00014360: 676e 6f72 6528 6c61 6d62 6461 3a20 6462  gnore(lambda: db
+00014370: 2e63 6c6f 7365 2829 290d 0a20 2020 2020  .close())..     
+00014380: 2020 2020 2020 2020 2020 2075 7469 6c2e             util.
+00014390: 7472 795f 6967 6e6f 7265 286f 732e 756e  try_ignore(os.un
+000143a0: 6c69 6e6b 2c20 6669 6c65 6e61 6d65 290d  link, filename).
+000143b0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000143c0: 7265 7375 6c74 2e67 6574 2822 646f 6e65  result.get("done
+000143d0: 2229 3a0d 0a20 2020 2020 2020 2020 2020  "):..           
+000143e0: 2020 2020 2077 6f72 6b65 722e 7374 6f70       worker.stop
+000143f0: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+00014400: 2020 2020 7365 6c66 2e77 6f72 6b65 7273      self.workers
+00014410: 5f69 6d70 6f72 742e 706f 7028 6669 6c65  _import.pop(file
+00014420: 6e61 6d65 2c20 4e6f 6e65 290d 0a0d 0a20  name, None).... 
+00014430: 2020 2020 2020 2020 2020 2064 6566 2061             def a
+00014440: 6674 6572 2829 3a0d 0a20 2020 2020 2020  fter():..       
+00014450: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+00014460: 7365 6c66 3a20 7265 7475 726e 0d0a 0d0a  self: return....
+00014470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014480: 6966 2072 6573 756c 742e 6765 7428 2265  if result.get("e
+00014490: 7272 6f72 2229 3a0d 0a20 2020 2020 2020  rror"):..       
+000144a0: 2020 2020 2020 2020 2020 2020 2064 6c67               dlg
+000144b0: 2e44 6573 7472 6f79 2829 0d0a 2020 2020  .Destroy()..    
+000144c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000144d0: 6775 6962 6173 652e 7374 6174 7573 2822  guibase.status("
+000144e0: 4572 726f 7220 7061 7273 696e 6720 536b  Error parsing Sk
+000144f0: 7970 6520 6578 706f 7274 2229 0d0a 2020  ype export")..  
+00014500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014510: 2020 7778 2e4d 6573 7361 6765 426f 7828    wx.MessageBox(
+00014520: 2245 7272 6f72 2070 6172 7369 6e67 2053  "Error parsing S
+00014530: 6b79 7065 2065 7870 6f72 743a 5c6e 2573  kype export:\n%s
+00014540: 2220 2520 7265 7375 6c74 5b22 6572 726f  " % result["erro
+00014550: 725f 7368 6f72 7422 5d2c 0d0a 2020 2020  r_short"],..    
+00014560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014570: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00014580: 6e66 2e54 6974 6c65 2c20 7778 2e4f 4b20  nf.Title, wx.OK 
+00014590: 7c20 7778 2e49 434f 4e5f 4552 524f 5229  | wx.ICON_ERROR)
+000145a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000145b0: 2020 656c 6966 2072 6573 756c 742e 6765    elif result.ge
+000145c0: 7428 2273 746f 7022 293a 0d0a 2020 2020  t("stop"):..    
+000145d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000145e0: 646c 672e 4465 7374 726f 7928 290d 0a20  dlg.Destroy().. 
 000145f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014600: 2020 2064 6c67 2e4d 6573 7361 6765 203d     dlg.Message =
-00014610: 2022 5061 7273 6564 2025 732e 2220 2520   "Parsed %s." % 
-00014620: 740d 0a0d 0a20 2020 2020 2020 2020 2020  t....           
-00014630: 2077 782e 4361 6c6c 4166 7465 7228 6166   wx.CallAfter(af
-00014640: 7465 7229 0d0a 0d0a 2020 2020 2020 2020  ter)....        
-00014650: 7472 793a 0d0a 2020 2020 2020 2020 2020  try:..          
-00014660: 2020 6462 203d 206c 6976 652e 536b 7970    db = live.Skyp
-00014670: 6545 7870 6f72 7428 6566 696c 656e 616d  eExport(efilenam
-00014680: 652c 2066 696c 656e 616d 6529 0d0a 2020  e, filename)..  
-00014690: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
-000146a0: 6570 7469 6f6e 3a0d 0a20 2020 2020 2020  eption:..       
-000146b0: 2020 2020 205f 2c20 652c 2074 6220 3d20       _, e, tb = 
-000146c0: 7379 732e 6578 635f 696e 666f 2829 0d0a  sys.exc_info()..
-000146d0: 2020 2020 2020 2020 2020 2020 7574 696c              util
-000146e0: 2e74 7279 5f69 676e 6f72 6528 6f73 2e75  .try_ignore(os.u
-000146f0: 6e6c 696e 6b2c 2066 696c 656e 616d 6529  nlink, filename)
-00014700: 0d0a 2020 2020 2020 2020 2020 2020 7369  ..            si
-00014710: 782e 7265 7261 6973 6528 7479 7065 2865  x.reraise(type(e
-00014720: 292c 2065 2c20 7462 290d 0a0d 0a20 2020  ), e, tb)....   
-00014730: 2020 2020 2064 6c67 203d 2063 6f6e 7472       dlg = contr
-00014740: 6f6c 732e 5072 6f67 7265 7373 5769 6e64  ols.ProgressWind
-00014750: 6f77 2873 656c 662c 2022 496d 706f 7274  ow(self, "Import
-00014760: 2070 726f 6772 6573 7322 2c0d 0a20 2020   progress",..   
-00014770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014790: 2020 2063 616e 6365 6c3d 6f6e 5f63 616e     cancel=on_can
-000147a0: 6365 6c2c 2061 6777 5374 796c 653d 7778  cel, agwStyle=wx
-000147b0: 2e41 4c49 474e 5f43 454e 5445 5229 0d0a  .ALIGN_CENTER)..
-000147c0: 2020 2020 2020 2020 646c 672e 506f 7369          dlg.Posi
-000147d0: 7469 6f6e 203d 205b 7365 6c66 2e50 6f73  tion = [self.Pos
-000147e0: 6974 696f 6e5b 695d 202b 2061 202d 2062  ition[i] + a - b
-000147f0: 2066 6f72 2069 2c20 2861 2c20 6229 2069   for i, (a, b) i
-00014800: 6e20 656e 756d 6572 6174 6528 7a69 7028  n enumerate(zip(
-00014810: 7365 6c66 2e53 697a 652c 2064 6c67 2e53  self.Size, dlg.S
-00014820: 697a 6529 295d 0d0a 2020 2020 2020 2020  ize))]..        
-00014830: 646c 672e 5075 6c73 6528 290d 0a20 2020  dlg.Pulse()..   
-00014840: 2020 2020 2067 7569 6261 7365 2e73 7461       guibase.sta
-00014850: 7475 7328 2243 7265 6174 696e 6720 6e65  tus("Creating ne
-00014860: 7720 6461 7461 6261 7365 2066 726f 6d20  w database from 
-00014870: 536b 7970 6520 6578 706f 7274 2e22 290d  Skype export.").
-00014880: 0a20 2020 2020 2020 206c 6f67 6765 722e  .        logger.
-00014890: 696e 666f 2822 4372 6561 7469 6e67 206e  info("Creating n
-000148a0: 6577 2064 6174 6162 6173 6520 2573 2066  ew database %s f
-000148b0: 726f 6d20 536b 7970 6520 6578 706f 7274  rom Skype export
-000148c0: 2025 732c 2075 7365 7220 2725 7327 2e22   %s, user '%s'."
-000148d0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-000148e0: 2020 2020 2020 2066 696c 656e 616d 652c         filename,
-000148f0: 2065 6669 6c65 6e61 6d65 2c20 7573 6572   efilename, user
-00014900: 290d 0a20 2020 2020 2020 2077 6f72 6b65  )..        worke
-00014910: 7220 3d20 776f 726b 6572 732e 536b 7970  r = workers.Skyp
-00014920: 6541 7263 6869 7665 5468 7265 6164 286f  eArchiveThread(o
-00014930: 6e5f 7072 6f67 7265 7373 290d 0a20 2020  n_progress)..   
-00014940: 2020 2020 2073 656c 662e 776f 726b 6572       self.worker
-00014950: 735f 696d 706f 7274 5b66 696c 656e 616d  s_import[filenam
-00014960: 655d 203d 2077 6f72 6b65 720d 0a20 2020  e] = worker..   
-00014970: 2020 2020 2077 6f72 6b65 722e 776f 726b       worker.work
-00014980: 287b 2261 6374 696f 6e22 3a20 2270 6172  ({"action": "par
-00014990: 7365 222c 2022 6462 223a 2064 627d 290d  se", "db": db}).
-000149a0: 0a0d 0a0d 0a20 2020 2064 6566 206f 6e5f  .....    def on_
-000149b0: 6f70 656e 5f64 6174 6162 6173 6528 7365  open_database(se
-000149c0: 6c66 2c20 6576 656e 7429 3a0d 0a20 2020  lf, event):..   
-000149d0: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-000149e0: 2020 4861 6e64 6c65 7220 666f 7220 6f70    Handler for op
-000149f0: 656e 2064 6174 6162 6173 6520 6d65 6e75  en database menu
-00014a00: 206f 7220 6275 7474 6f6e 2c20 6469 7370   or button, disp
-00014a10: 6c61 7973 2061 2066 696c 6520 6469 616c  lays a file dial
-00014a20: 6f67 2061 6e64 0d0a 2020 2020 2020 2020  og and..        
-00014a30: 6c6f 6164 7320 7468 6520 6368 6f73 656e  loads the chosen
-00014a40: 2064 6174 6162 6173 652e 0d0a 2020 2020   database...    
-00014a50: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
-00014a60: 2069 6620 7778 2e49 445f 4f4b 203d 3d20   if wx.ID_OK == 
-00014a70: 7365 6c66 2e64 6961 6c6f 675f 6f70 656e  self.dialog_open
-00014a80: 6669 6c65 2e53 686f 774d 6f64 616c 2829  file.ShowModal()
-00014a90: 3a0d 0a20 2020 2020 2020 2020 2020 2066  :..            f
-00014aa0: 696c 656e 616d 6520 3d20 7365 6c66 2e64  ilename = self.d
-00014ab0: 6961 6c6f 675f 6f70 656e 6669 6c65 2e47  ialog_openfile.G
-00014ac0: 6574 5061 7468 2829 0d0a 2020 2020 2020  etPath()..      
-00014ad0: 2020 2020 2020 6966 2066 696c 656e 616d        if filenam
-00014ae0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00014af0: 2020 2020 7365 6c66 2e75 7064 6174 655f      self.update_
-00014b00: 6461 7461 6261 7365 5f6c 6973 7428 6669  database_list(fi
-00014b10: 6c65 6e61 6d65 290d 0a20 2020 2020 2020  lename)..       
-00014b20: 2020 2020 2020 2020 2073 656c 662e 6c6f           self.lo
-00014b30: 6164 5f64 6174 6162 6173 655f 7061 6765  ad_database_page
-00014b40: 2866 696c 656e 616d 6529 0d0a 0d0a 0d0a  (filename)......
-00014b50: 2020 2020 6465 6620 6f6e 5f6f 7065 6e5f      def on_open_
-00014b60: 6461 7461 6261 7365 5f65 7665 6e74 2873  database_event(s
-00014b70: 656c 662c 2065 7665 6e74 293a 0d0a 2020  elf, event):..  
-00014b80: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
-00014b90: 2020 2048 616e 646c 6572 2066 6f72 204f     Handler for O
-00014ba0: 7065 6e44 6174 6162 6173 6545 7665 6e74  penDatabaseEvent
-00014bb0: 2c20 7570 6461 7465 7320 6462 206c 6973  , updates db lis
-00014bc0: 7420 616e 6420 6c6f 6164 7320 7468 6520  t and loads the 
-00014bd0: 6576 656e 740d 0a20 2020 2020 2020 2064  event..        d
-00014be0: 6174 6162 6173 652e 0d0a 2020 2020 2020  atabase...      
-00014bf0: 2020 2222 220d 0a20 2020 2020 2020 2066    """..        f
-00014c00: 696c 656e 616d 6520 3d20 6f73 2e70 6174  ilename = os.pat
-00014c10: 682e 7265 616c 7061 7468 2865 7665 6e74  h.realpath(event
-00014c20: 2e66 696c 6529 0d0a 2020 2020 2020 2020  .file)..        
-00014c30: 7365 6c66 2e75 7064 6174 655f 6461 7461  self.update_data
-00014c40: 6261 7365 5f6c 6973 7428 6669 6c65 6e61  base_list(filena
-00014c50: 6d65 290d 0a20 2020 2020 2020 2073 656c  me)..        sel
-00014c60: 662e 6c6f 6164 5f64 6174 6162 6173 655f  f.load_database_
-00014c70: 7061 6765 2866 696c 656e 616d 6529 0d0a  page(filename)..
-00014c80: 0d0a 0d0a 2020 2020 6465 6620 6f6e 5f72  ....    def on_r
-00014c90: 6563 656e 745f 6669 6c65 2873 656c 662c  ecent_file(self,
-00014ca0: 2065 7665 6e74 293a 0d0a 2020 2020 2020   event):..      
-00014cb0: 2020 2222 2248 616e 646c 6572 2066 6f72    """Handler for
-00014cc0: 2063 6c69 636b 696e 6720 616e 2065 6e74   clicking an ent
-00014cd0: 7279 2069 6e20 5265 6365 6e74 2046 696c  ry in Recent Fil
-00014ce0: 6573 206d 656e 752e 2222 220d 0a20 2020  es menu."""..   
-00014cf0: 2020 2020 2066 696c 656e 616d 6520 3d20       filename = 
-00014d00: 7365 6c66 2e68 6973 746f 7279 5f66 696c  self.history_fil
-00014d10: 652e 4765 7448 6973 746f 7279 4669 6c65  e.GetHistoryFile
-00014d20: 2865 7665 6e74 2e49 6420 2d20 7778 2e49  (event.Id - wx.I
-00014d30: 445f 4649 4c45 3129 0d0a 2020 2020 2020  D_FILE1)..      
-00014d40: 2020 7365 6c66 2e75 7064 6174 655f 6461    self.update_da
-00014d50: 7461 6261 7365 5f6c 6973 7428 6669 6c65  tabase_list(file
-00014d60: 6e61 6d65 290d 0a20 2020 2020 2020 2073  name)..        s
-00014d70: 656c 662e 6c6f 6164 5f64 6174 6162 6173  elf.load_databas
-00014d80: 655f 7061 6765 2866 696c 656e 616d 6529  e_page(filename)
-00014d90: 0d0a 0d0a 0d0a 2020 2020 6465 6620 6f6e  ......    def on
-00014da0: 5f61 6464 5f66 726f 6d5f 666f 6c64 6572  _add_from_folder
-00014db0: 2873 656c 662c 2065 7665 6e74 293a 0d0a  (self, event):..
-00014dc0: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
-00014dd0: 2020 2020 2048 616e 646c 6572 2066 6f72       Handler for
-00014de0: 2063 6c69 636b 696e 6720 746f 2073 656c   clicking to sel
-00014df0: 6563 7420 666f 6c64 6572 2077 6865 7265  ect folder where
-00014e00: 2074 6f20 7365 6172 6368 2066 6f72 2064   to search for d
-00014e10: 6174 6162 6173 6573 2c0d 0a20 2020 2020  atabases,..     
-00014e20: 2020 2075 7064 6174 6573 2064 6174 6162     updates datab
-00014e30: 6173 6520 6c69 7374 2e0d 0a20 2020 2020  ase list...     
-00014e40: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
-00014e50: 6966 2073 656c 662e 6469 616c 6f67 5f73  if self.dialog_s
-00014e60: 656c 6563 7466 6f6c 6465 722e 5368 6f77  electfolder.Show
-00014e70: 4d6f 6461 6c28 2920 3d3d 2077 782e 4944  Modal() == wx.ID
-00014e80: 5f4f 4b3a 0d0a 2020 2020 2020 2020 2020  _OK:..          
-00014e90: 2020 6966 2073 656c 662e 6275 7474 6f6e    if self.button
-00014ea0: 5f66 6f6c 6465 722e 4669 6e64 466f 6375  _folder.FindFocu
-00014eb0: 7328 2920 3d3d 2073 656c 662e 6275 7474  s() == self.butt
-00014ec0: 6f6e 5f66 6f6c 6465 723a 0d0a 2020 2020  on_folder:..    
-00014ed0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00014ee0: 2e6c 6973 745f 6462 2e53 6574 466f 6375  .list_db.SetFocu
-00014ef0: 7328 290d 0a20 2020 2020 2020 2020 2020  s()..           
-00014f00: 2073 656c 662e 6275 7474 6f6e 5f66 6f6c   self.button_fol
-00014f10: 6465 722e 456e 6162 6c65 6420 3d20 4661  der.Enabled = Fa
-00014f20: 6c73 650d 0a20 2020 2020 2020 2020 2020  lse..           
-00014f30: 2066 6f6c 6465 7220 3d20 7365 6c66 2e64   folder = self.d
-00014f40: 6961 6c6f 675f 7365 6c65 6374 666f 6c64  ialog_selectfold
-00014f50: 6572 2e47 6574 5061 7468 2829 0d0a 2020  er.GetPath()..  
-00014f60: 2020 2020 2020 2020 2020 6775 6962 6173            guibas
-00014f70: 652e 7374 6174 7573 2822 4465 7465 6374  e.status("Detect
-00014f80: 696e 6720 6461 7461 6261 7365 7320 756e  ing databases un
-00014f90: 6465 7220 2573 2e22 2c20 666f 6c64 6572  der %s.", folder
-00014fa0: 2c20 6c6f 673d 5472 7565 290d 0a20 2020  , log=True)..   
-00014fb0: 2020 2020 2020 2020 2077 782e 5969 656c           wx.Yiel
-00014fc0: 6449 664e 6565 6465 6428 290d 0a20 2020  dIfNeeded()..   
-00014fd0: 2020 2020 2020 2020 2063 6f75 6e74 203d           count =
-00014fe0: 2030 0d0a 2020 2020 2020 2020 2020 2020   0..            
-00014ff0: 666f 7220 6669 6c65 6e61 6d65 2069 6e20  for filename in 
-00015000: 736b 7970 6564 6174 612e 6669 6e64 5f64  skypedata.find_d
-00015010: 6174 6162 6173 6573 2866 6f6c 6465 7229  atabases(folder)
-00015020: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00015030: 2020 2069 6620 6669 6c65 6e61 6d65 206e     if filename n
-00015040: 6f74 2069 6e20 7365 6c66 2e64 625f 6669  ot in self.db_fi
-00015050: 6c65 6e61 6d65 733a 0d0a 2020 2020 2020  lenames:..      
-00015060: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
-00015070: 6767 6572 2e69 6e66 6f28 2244 6574 6563  gger.info("Detec
-00015080: 7465 6420 6461 7461 6261 7365 2025 732e  ted database %s.
-00015090: 222c 2066 696c 656e 616d 6529 0d0a 2020  ", filename)..  
-000150a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000150b0: 2020 7365 6c66 2e75 7064 6174 655f 6461    self.update_da
-000150c0: 7461 6261 7365 5f6c 6973 7428 6669 6c65  tabase_list(file
-000150d0: 6e61 6d65 290d 0a20 2020 2020 2020 2020  name)..         
-000150e0: 2020 2020 2020 2020 2020 2063 6f75 6e74             count
-000150f0: 202b 3d20 310d 0a20 2020 2020 2020 2020   += 1..         
-00015100: 2020 2073 656c 662e 6275 7474 6f6e 5f66     self.button_f
-00015110: 6f6c 6465 722e 456e 6162 6c65 6420 3d20  older.Enabled = 
-00015120: 5472 7565 0d0a 2020 2020 2020 2020 2020  True..          
-00015130: 2020 6775 6962 6173 652e 7374 6174 7573    guibase.status
-00015140: 2822 4465 7465 6374 6564 2025 7320 756e  ("Detected %s un
-00015150: 6465 7220 2573 2e22 2c0d 0a20 2020 2020  der %s.",..     
-00015160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015170: 2020 2020 2020 7574 696c 2e70 6c75 7261        util.plura
-00015180: 6c28 226e 6577 2064 6174 6162 6173 6522  l("new database"
-00015190: 2c20 636f 756e 7429 2c20 666f 6c64 6572  , count), folder
-000151a0: 2c20 6c6f 673d 5472 7565 290d 0a0d 0a0d  , log=True).....
-000151b0: 0a20 2020 2064 6566 206f 6e5f 6f70 656e  .    def on_open
-000151c0: 5f63 7572 7265 6e74 5f64 6174 6162 6173  _current_databas
-000151d0: 6528 7365 6c66 2c20 6576 656e 7429 3a0d  e(self, event):.
-000151e0: 0a20 2020 2020 2020 2022 2222 4861 6e64  .        """Hand
-000151f0: 6c65 7220 666f 7220 636c 6963 6b69 6e67  ler for clicking
-00015200: 2074 6f20 6f70 656e 2073 656c 6563 7465   to open selecte
-00015210: 6420 6669 6c65 7320 6672 6f6d 2064 6174  d files from dat
-00015220: 6162 6173 6520 6c69 7374 2e22 2222 0d0a  abase list."""..
-00015230: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00015240: 6462 5f66 696c 656e 616d 653a 0d0a 2020  db_filename:..  
-00015250: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
-00015260: 6f61 645f 6461 7461 6261 7365 5f70 6167  oad_database_pag
-00015270: 6528 7365 6c66 2e64 625f 6669 6c65 6e61  e(self.db_filena
-00015280: 6d65 290d 0a0d 0a0d 0a20 2020 2064 6566  me)......    def
-00015290: 206f 6e5f 6f70 656e 5f66 726f 6d5f 6c69   on_open_from_li
-000152a0: 7374 5f64 6228 7365 6c66 2c20 6576 656e  st_db(self, even
-000152b0: 7429 3a0d 0a20 2020 2020 2020 2022 2222  t):..        """
-000152c0: 4861 6e64 6c65 7220 666f 7220 636c 6963  Handler for clic
-000152d0: 6b69 6e67 2074 6f20 6f70 656e 2073 656c  king to open sel
-000152e0: 6563 7465 6420 6669 6c65 7320 6672 6f6d  ected files from
-000152f0: 2064 6174 6162 6173 6520 6c69 7374 2e22   database list."
-00015300: 2222 0d0a 2020 2020 2020 2020 6966 2065  ""..        if e
-00015310: 7665 6e74 2e47 6574 496e 6465 7828 2920  vent.GetIndex() 
-00015320: 3e20 303a 0d0a 2020 2020 2020 2020 2020  > 0:..          
-00015330: 2020 7365 6c66 2e6c 6f61 645f 6461 7461    self.load_data
-00015340: 6261 7365 5f70 6167 6528 7365 6c66 2e6c  base_page(self.l
-00015350: 6973 745f 6462 2e47 6574 4974 656d 5465  ist_db.GetItemTe
-00015360: 7874 2865 7665 6e74 2e47 6574 496e 6465  xt(event.GetInde
-00015370: 7828 2929 290d 0a0d 0a0d 0a20 2020 2064  x()))......    d
-00015380: 6566 2075 7064 6174 655f 6461 7461 6261  ef update_databa
-00015390: 7365 5f73 7461 7473 2873 656c 662c 2066  se_stats(self, f
-000153a0: 696c 656e 616d 6529 3a0d 0a20 2020 2020  ilename):..     
-000153b0: 2020 2022 2222 4f70 656e 7320 7468 6520     """Opens the 
-000153c0: 6461 7461 6261 7365 2061 6e64 2075 7064  database and upd
-000153d0: 6174 6573 206d 6169 6e20 7061 6765 2055  ates main page U
-000153e0: 4920 7769 7468 2064 6174 6162 6173 6520  I with database 
-000153f0: 696e 666f 2e22 2222 0d0a 2020 2020 2020  info."""..      
-00015400: 2020 6462 203d 204e 6f6e 650d 0a20 2020    db = None..   
-00015410: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
-00015420: 2020 2020 2020 2064 6220 3d20 7365 6c66         db = self
-00015430: 2e64 6273 2e67 6574 2866 696c 656e 616d  .dbs.get(filenam
-00015440: 6529 206f 7220 736b 7970 6564 6174 612e  e) or skypedata.
-00015450: 536b 7970 6544 6174 6162 6173 6528 6669  SkypeDatabase(fi
-00015460: 6c65 6e61 6d65 290d 0a20 2020 2020 2020  lename)..       
-00015470: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
-00015480: 6e20 6173 2065 3a0d 0a20 2020 2020 2020  n as e:..       
-00015490: 2020 2020 2073 656c 662e 6c61 6265 6c5f       self.label_
-000154a0: 6163 636f 756e 742e 5661 6c75 6520 3d20  account.Value = 
-000154b0: 2228 6461 7461 6261 7365 206e 6f74 2072  "(database not r
-000154c0: 6561 6461 626c 6529 220d 0a20 2020 2020  eadable)"..     
-000154d0: 2020 2020 2020 2073 656c 662e 6c61 6265         self.labe
-000154e0: 6c5f 6d65 7373 6167 6573 2e56 616c 7565  l_messages.Value
-000154f0: 203d 2022 4572 726f 7220 7465 7874 3a20   = "Error text: 
-00015500: 2573 2220 2520 7574 696c 2e66 6f72 6d61  %s" % util.forma
-00015510: 745f 6578 6328 6529 0d0a 2020 2020 2020  t_exc(e)..      
-00015520: 2020 2020 2020 7365 6c66 2e6c 6162 656c        self.label
-00015530: 5f61 6363 6f75 6e74 2e46 6f72 6567 726f  _account.Foregro
-00015540: 756e 6443 6f6c 6f75 7220 3d20 636f 6e66  undColour = conf
-00015550: 2e4c 6162 656c 4572 726f 7243 6f6c 6f75  .LabelErrorColou
-00015560: 720d 0a20 2020 2020 2020 2020 2020 2073  r..            s
-00015570: 656c 662e 6c61 6265 6c5f 6368 6174 732e  elf.label_chats.
-00015580: 466f 7265 6772 6f75 6e64 436f 6c6f 7572  ForegroundColour
-00015590: 203d 2063 6f6e 662e 4c61 6265 6c45 7272   = conf.LabelErr
-000155a0: 6f72 436f 6c6f 7572 0d0a 2020 2020 2020  orColour..      
-000155b0: 2020 2020 2020 6c6f 6767 6572 2e65 7863        logger.exc
-000155c0: 6570 7469 6f6e 2822 4572 726f 7220 6f70  eption("Error op
-000155d0: 656e 696e 6720 2573 2e22 2c20 6669 6c65  ening %s.", file
-000155e0: 6e61 6d65 290d 0a20 2020 2020 2020 2020  name)..         
-000155f0: 2020 2072 6574 7572 6e0d 0a20 2020 2020     return..     
-00015600: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
-00015610: 2020 2020 2073 7461 7473 203d 2064 622e       stats = db.
-00015620: 6765 745f 6765 6e65 7261 6c5f 7374 6174  get_general_stat
-00015630: 6973 7469 6373 2866 756c 6c3d 4661 6c73  istics(full=Fals
-00015640: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
-00015650: 6966 2022 7573 6572 6e61 6d65 2220 696e  if "username" in
-00015660: 2073 7461 7473 3a0d 0a20 2020 2020 2020   stats:..       
-00015670: 2020 2020 2020 2020 2074 6578 7420 3d20           text = 
-00015680: 7374 6174 735b 2275 7365 726e 616d 6522  stats["username"
-00015690: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
-000156a0: 2020 2069 6620 226e 616d 6522 2069 6e20     if "name" in 
-000156b0: 7374 6174 7320 616e 6420 7374 6174 735b  stats and stats[
-000156c0: 226e 616d 6522 5d20 213d 2074 6578 743a  "name"] != text:
-000156d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000156e0: 2020 2020 2020 7465 7874 203d 2022 2573        text = "%s
-000156f0: 2028 2573 2922 2025 2028 7374 6174 735b   (%s)" % (stats[
-00015700: 226e 616d 6522 5d2c 2074 6578 7429 0d0a  "name"], text)..
-00015710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015720: 7365 6c66 2e6c 6162 656c 5f61 6363 6f75  self.label_accou
-00015730: 6e74 2e56 616c 7565 203d 2074 6578 740d  nt.Value = text.
-00015740: 0a20 2020 2020 2020 2020 2020 2074 6578  .            tex
-00015750: 7420 3d20 7574 696c 2e70 6c75 7261 6c28  t = util.plural(
-00015760: 2263 6861 7422 2c20 7374 6174 735b 2263  "chat", stats["c
-00015770: 6861 7473 225d 2c20 7365 703d 222c 2229  hats"], sep=",")
-00015780: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00015790: 2073 7461 7473 2e67 6574 2822 6c61 7374   stats.get("last
-000157a0: 6d65 7373 6167 655f 6368 6174 2229 3a0d  message_chat"):.
-000157b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000157c0: 2074 6578 7420 2b3d 2022 2c20 6c61 7465   text += ", late
-000157d0: 7374 2025 286c 6173 746d 6573 7361 6765  st %(lastmessage
-000157e0: 5f63 6861 7429 7322 2025 2073 7461 7473  _chat)s" % stats
-000157f0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00015800: 6c66 2e6c 6162 656c 5f63 6861 7473 2e56  lf.label_chats.V
-00015810: 616c 7565 203d 2074 6578 740d 0a20 2020  alue = text..   
-00015820: 2020 2020 2020 2020 2074 6578 7420 3d20           text = 
-00015830: 7574 696c 2e70 6c75 7261 6c28 226d 6573  util.plural("mes
-00015840: 7361 6765 222c 2073 7461 7473 5b22 6d65  sage", stats["me
-00015850: 7373 6167 6573 225d 2c20 7365 703d 222c  ssages"], sep=",
-00015860: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
-00015870: 6966 2073 7461 7473 2e67 6574 2822 6c61  if stats.get("la
-00015880: 7374 6d65 7373 6167 655f 6474 2229 3a0d  stmessage_dt"):.
-00015890: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000158a0: 2074 6578 7420 2b3d 2022 2c20 6c61 7374   text += ", last
-000158b0: 2061 7420 2528 6c61 7374 6d65 7373 6167   at %(lastmessag
-000158c0: 655f 6474 2973 2220 2520 7374 6174 730d  e_dt)s" % stats.
-000158d0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000158e0: 662e 6c61 6265 6c5f 6d65 7373 6167 6573  f.label_messages
-000158f0: 2e56 616c 7565 203d 2074 6578 740d 0a20  .Value = text.. 
-00015900: 2020 2020 2020 2020 2020 2064 6174 6120             data 
-00015910: 3d20 7365 6c66 2e64 625f 6669 6c65 6e61  = self.db_filena
-00015920: 6d65 732e 6765 7428 6669 6c65 6e61 6d65  mes.get(filename
-00015930: 2c20 7b7d 290d 0a20 2020 2020 2020 2020  , {})..         
-00015940: 2020 2064 6174 615b 2261 6363 6f75 6e74     data["account
-00015950: 225d 203d 2073 656c 662e 6c61 6265 6c5f  "] = self.label_
-00015960: 6163 636f 756e 742e 5661 6c75 650d 0a20  account.Value.. 
-00015970: 2020 2020 2020 2020 2020 2064 6174 615b             data[
-00015980: 2263 6861 7473 225d 203d 2073 656c 662e  "chats"] = self.
-00015990: 6c61 6265 6c5f 6368 6174 732e 5661 6c75  label_chats.Valu
-000159a0: 650d 0a20 2020 2020 2020 2020 2020 2064  e..            d
-000159b0: 6174 615b 226d 6573 7361 6765 7322 5d20  ata["messages"] 
-000159c0: 3d20 7365 6c66 2e6c 6162 656c 5f6d 6573  = self.label_mes
-000159d0: 7361 6765 732e 5661 6c75 650d 0a20 2020  sages.Value..   
-000159e0: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
-000159f0: 7074 696f 6e20 6173 2065 3a0d 0a20 2020  ption as e:..   
-00015a00: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-00015a10: 7365 6c66 2e6c 6162 656c 5f61 6363 6f75  self.label_accou
-00015a20: 6e74 2e56 616c 7565 3a0d 0a20 2020 2020  nt.Value:..     
-00015a30: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00015a40: 6c61 6265 6c5f 6163 636f 756e 742e 5661  label_account.Va
-00015a50: 6c75 6520 3d20 2228 6e6f 7420 7265 636f  lue = "(not reco
-00015a60: 676e 697a 6564 2061 7320 6120 536b 7970  gnized as a Skyp
-00015a70: 6520 6461 7461 6261 7365 2922 0d0a 2020  e database)"..  
-00015a80: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00015a90: 6c66 2e6c 6162 656c 5f61 6363 6f75 6e74  lf.label_account
-00015aa0: 2e46 6f72 6567 726f 756e 6443 6f6c 6f75  .ForegroundColou
-00015ab0: 7220 3d20 636f 6e66 2e4c 6162 656c 4572  r = conf.LabelEr
-00015ac0: 726f 7243 6f6c 6f75 720d 0a20 2020 2020  rorColour..     
-00015ad0: 2020 2020 2020 2073 656c 662e 6c61 6265         self.labe
-00015ae0: 6c5f 6368 6174 732e 5661 6c75 6520 3d20  l_chats.Value = 
-00015af0: 2245 7272 6f72 2074 6578 743a 2025 7322  "Error text: %s"
-00015b00: 2025 2075 7469 6c2e 666f 726d 6174 5f65   % util.format_e
-00015b10: 7863 2865 290d 0a20 2020 2020 2020 2020  xc(e)..         
-00015b20: 2020 2073 656c 662e 6c61 6265 6c5f 6368     self.label_ch
-00015b30: 6174 732e 466f 7265 6772 6f75 6e64 436f  ats.ForegroundCo
-00015b40: 6c6f 7572 203d 2063 6f6e 662e 4c61 6265  lour = conf.Labe
-00015b50: 6c45 7272 6f72 436f 6c6f 7572 0d0a 2020  lErrorColour..  
-00015b60: 2020 2020 2020 2020 2020 6c6f 6767 6572            logger
-00015b70: 2e65 7863 6570 7469 6f6e 2822 4572 726f  .exception("Erro
-00015b80: 7220 6c6f 6164 696e 6720 6461 7461 2066  r loading data f
-00015b90: 726f 6d20 2573 2e22 2c20 6669 6c65 6e61  rom %s.", filena
-00015ba0: 6d65 290d 0a20 2020 2020 2020 2069 6620  me)..        if 
-00015bb0: 6462 2061 6e64 206e 6f74 2064 622e 6861  db and not db.ha
-00015bc0: 735f 636f 6e73 756d 6572 7328 293a 0d0a  s_consumers():..
-00015bd0: 2020 2020 2020 2020 2020 2020 6462 2e63              db.c
-00015be0: 6c6f 7365 2829 0d0a 2020 2020 2020 2020  lose()..        
-00015bf0: 2020 2020 7365 6c66 2e64 6273 2e70 6f70      self.dbs.pop
-00015c00: 2866 696c 656e 616d 652c 204e 6f6e 6529  (filename, None)
-00015c10: 0d0a 0d0a 0d0a 2020 2020 6465 6620 7570  ......    def up
-00015c20: 6461 7465 5f64 6174 6162 6173 655f 6465  date_database_de
-00015c30: 7461 696c 2873 656c 6629 3a0d 0a20 2020  tail(self):..   
-00015c40: 2020 2020 2022 2222 5570 6461 7465 7320       """Updates 
-00015c50: 6461 7461 6261 7365 2064 6574 6169 6c20  database detail 
-00015c60: 7061 6e65 6c20 7769 7468 2063 7572 7265  panel with curre
-00015c70: 6e74 2064 6174 6162 6173 6520 696e 666f  nt database info
-00015c80: 726d 6174 696f 6e2e 2222 220d 0a20 2020  rmation."""..   
-00015c90: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
-00015ca0: 206f 7220 6e6f 7420 7365 6c66 2e64 625f   or not self.db_
-00015cb0: 6669 6c65 6e61 6d65 3a20 7265 7475 726e  filename: return
-00015cc0: 0d0a 0d0a 2020 2020 2020 2020 6669 6c65  ....        file
-00015cd0: 6e61 6d65 203d 2073 656c 662e 6462 5f66  name = self.db_f
-00015ce0: 696c 656e 616d 650d 0a20 2020 2020 2020  ilename..       
-00015cf0: 2070 6174 682c 2074 6169 6c20 3d20 6f73   path, tail = os
-00015d00: 2e70 6174 682e 7370 6c69 7428 6669 6c65  .path.split(file
-00015d10: 6e61 6d65 290d 0a20 2020 2020 2020 2073  name)..        s
-00015d20: 656c 662e 6c61 6265 6c5f 6462 2e56 616c  elf.label_db.Val
-00015d30: 7565 203d 2074 6169 6c0d 0a20 2020 2020  ue = tail..     
-00015d40: 2020 2073 656c 662e 6c61 6265 6c5f 7061     self.label_pa
-00015d50: 7468 2e56 616c 7565 203d 2070 6174 680d  th.Value = path.
-00015d60: 0a20 2020 2020 2020 2073 656c 662e 6c61  .        self.la
-00015d70: 6265 6c5f 7369 7a65 2e56 616c 7565 203d  bel_size.Value =
-00015d80: 2073 656c 662e 6c61 6265 6c5f 6d6f 6469   self.label_modi
-00015d90: 6669 6564 2e56 616c 7565 203d 2022 220d  fied.Value = "".
-00015da0: 0a20 2020 2020 2020 2073 656c 662e 6c61  .        self.la
-00015db0: 6265 6c5f 6163 636f 756e 742e 5661 6c75  bel_account.Valu
-00015dc0: 6520 3d20 7365 6c66 2e6c 6162 656c 5f63  e = self.label_c
-00015dd0: 6861 7473 2e56 616c 7565 203d 2022 220d  hats.Value = "".
-00015de0: 0a20 2020 2020 2020 2073 656c 662e 6c61  .        self.la
-00015df0: 6265 6c5f 6d65 7373 6167 6573 2e56 616c  bel_messages.Val
-00015e00: 7565 203d 2022 220d 0a20 2020 2020 2020  ue = ""..       
-00015e10: 2073 656c 662e 6c61 6265 6c5f 6163 636f   self.label_acco
-00015e20: 756e 742e 466f 7265 6772 6f75 6e64 436f  unt.ForegroundCo
-00015e30: 6c6f 7572 203d 2073 656c 662e 466f 7265  lour = self.Fore
-00015e40: 6772 6f75 6e64 436f 6c6f 7572 0d0a 2020  groundColour..  
-00015e50: 2020 2020 2020 7365 6c66 2e6c 6162 656c        self.label
-00015e60: 5f73 697a 652e 466f 7265 6772 6f75 6e64  _size.Foreground
-00015e70: 436f 6c6f 7572 203d 2073 656c 662e 466f  Colour = self.Fo
-00015e80: 7265 6772 6f75 6e64 436f 6c6f 7572 0d0a  regroundColour..
-00015e90: 2020 2020 2020 2020 7365 6c66 2e6c 6162          self.lab
-00015ea0: 656c 5f63 6861 7473 2e46 6f72 6567 726f  el_chats.Foregro
-00015eb0: 756e 6443 6f6c 6f75 7220 3d20 7365 6c66  undColour = self
-00015ec0: 2e46 6f72 6567 726f 756e 6443 6f6c 6f75  .ForegroundColou
-00015ed0: 720d 0a20 2020 2020 2020 2069 6620 6e6f  r..        if no
-00015ee0: 7420 7365 6c66 2e70 616e 656c 5f64 625f  t self.panel_db_
-00015ef0: 6465 7461 696c 2e53 686f 776e 3a0d 0a20  detail.Shown:.. 
-00015f00: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00015f10: 7061 6e65 6c5f 6462 5f6d 6169 6e2e 4869  panel_db_main.Hi
-00015f20: 6465 2829 0d0a 2020 2020 2020 2020 2020  de()..          
-00015f30: 2020 7365 6c66 2e70 616e 656c 5f64 625f    self.panel_db_
-00015f40: 6465 7461 696c 2e53 686f 7728 290d 0a20  detail.Show().. 
-00015f50: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00015f60: 7061 6e65 6c5f 6462 5f64 6574 6169 6c2e  panel_db_detail.
-00015f70: 5061 7265 6e74 2e4c 6179 6f75 7428 290d  Parent.Layout().
-00015f80: 0a20 2020 2020 2020 2069 6620 6f73 2e70  .        if os.p
-00015f90: 6174 682e 6578 6973 7473 2866 696c 656e  ath.exists(filen
-00015fa0: 616d 6529 3a0d 0a20 2020 2020 2020 2020  ame):..         
-00015fb0: 2020 2073 7a20 3d20 6f73 2e70 6174 682e     sz = os.path.
-00015fc0: 6765 7473 697a 6528 6669 6c65 6e61 6d65  getsize(filename
-00015fd0: 290d 0a20 2020 2020 2020 2020 2020 2064  )..            d
-00015fe0: 7420 3d20 6461 7465 7469 6d65 2e64 6174  t = datetime.dat
-00015ff0: 6574 696d 652e 6672 6f6d 7469 6d65 7374  etime.fromtimest
-00016000: 616d 7028 6f73 2e70 6174 682e 6765 746d  amp(os.path.getm
-00016010: 7469 6d65 2866 696c 656e 616d 6529 290d  time(filename)).
-00016020: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00016030: 662e 6c61 6265 6c5f 7369 7a65 2e56 616c  f.label_size.Val
-00016040: 7565 203d 2075 7469 6c2e 666f 726d 6174  ue = util.format
-00016050: 5f62 7974 6573 2873 7a29 0d0a 2020 2020  _bytes(sz)..    
-00016060: 2020 2020 2020 2020 7365 6c66 2e6c 6162          self.lab
-00016070: 656c 5f6d 6f64 6966 6965 642e 5661 6c75  el_modified.Valu
-00016080: 6520 3d20 6474 2e73 7472 6674 696d 6528  e = dt.strftime(
-00016090: 2225 592d 256d 2d25 6420 2548 3a25 4d3a  "%Y-%m-%d %H:%M:
-000160a0: 2553 2229 0d0a 2020 2020 2020 2020 2020  %S")..          
-000160b0: 2020 6461 7461 203d 2073 656c 662e 6462    data = self.db
-000160c0: 5f66 696c 656e 616d 6573 5b66 696c 656e  _filenames[filen
-000160d0: 616d 655d 0d0a 2020 2020 2020 2020 2020  ame]..          
-000160e0: 2020 6966 2064 6174 615b 2273 697a 6522    if data["size"
-000160f0: 5d20 3d3d 2073 7a20 616e 6420 6461 7461  ] == sz and data
-00016100: 5b22 6c61 7374 5f6d 6f64 6966 6965 6422  ["last_modified"
-00016110: 5d20 3d3d 2064 7420 5c0d 0a20 2020 2020  ] == dt \..     
-00016120: 2020 2020 2020 2061 6e64 2064 6174 615b         and data[
-00016130: 226d 6573 7361 6765 7322 5d3a 0d0a 2020  "messages"]:..  
-00016140: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00016150: 4669 6c65 2064 6f65 7320 6e6f 7420 7365  File does not se
-00016160: 656d 2063 6861 6e67 6564 3a20 7573 6520  em changed: use 
-00016170: 6361 6368 6564 2076 616c 7565 730d 0a20  cached values.. 
-00016180: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00016190: 656c 662e 6c61 6265 6c5f 6163 636f 756e  elf.label_accoun
-000161a0: 742e 5661 6c75 6520 3d20 6461 7461 5b22  t.Value = data["
-000161b0: 6163 636f 756e 7422 5d0d 0a20 2020 2020  account"]..     
-000161c0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000161d0: 6c61 6265 6c5f 6368 6174 732e 5661 6c75  label_chats.Valu
-000161e0: 6520 3d20 6461 7461 5b22 6368 6174 7322  e = data["chats"
-000161f0: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
-00016200: 2020 2073 656c 662e 6c61 6265 6c5f 6d65     self.label_me
-00016210: 7373 6167 6573 2e56 616c 7565 203d 2064  ssages.Value = d
-00016220: 6174 615b 226d 6573 7361 6765 7322 5d0d  ata["messages"].
-00016230: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-00016240: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00016250: 2020 2020 6964 7820 3d20 7365 6c66 2e6c      idx = self.l
-00016260: 6973 745f 6462 2e46 696e 6449 7465 6d28  ist_db.FindItem(
-00016270: 6669 6c65 6e61 6d65 290d 0a20 2020 2020  filename)..     
-00016280: 2020 2020 2020 2020 2020 2069 6620 6964             if id
-00016290: 7820 3e20 303a 2073 656c 662e 6c69 7374  x > 0: self.list
-000162a0: 5f64 622e 5265 6672 6573 6852 6f77 2869  _db.RefreshRow(i
-000162b0: 6478 290d 0a20 2020 2020 2020 2020 2020  dx)..           
-000162c0: 2020 2020 2077 782e 4361 6c6c 4c61 7465       wx.CallLate
-000162d0: 7228 3130 2c20 7365 6c66 2e75 7064 6174  r(10, self.updat
-000162e0: 655f 6461 7461 6261 7365 5f73 7461 7473  e_database_stats
-000162f0: 2c20 6669 6c65 6e61 6d65 290d 0a20 2020  , filename)..   
-00016300: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-00016310: 2020 2020 2020 2020 7365 6c66 2e6c 6162          self.lab
-00016320: 656c 5f73 697a 652e 5661 6c75 6520 3d20  el_size.Value = 
-00016330: 2246 696c 6520 646f 6573 206e 6f74 2065  "File does not e
-00016340: 7869 7374 2e22 0d0a 2020 2020 2020 2020  xist."..        
-00016350: 2020 2020 7365 6c66 2e6c 6162 656c 5f73      self.label_s
-00016360: 697a 652e 466f 7265 6772 6f75 6e64 436f  ize.ForegroundCo
-00016370: 6c6f 7572 203d 2063 6f6e 662e 4c61 6265  lour = conf.Labe
-00016380: 6c45 7272 6f72 436f 6c6f 7572 0d0a 0d0a  lErrorColour....
-00016390: 0d0a 2020 2020 6465 6620 6f6e 5f73 656c  ..    def on_sel
-000163a0: 6563 745f 6c69 7374 5f64 6228 7365 6c66  ect_list_db(self
-000163b0: 2c20 6576 656e 7429 3a0d 0a20 2020 2020  , event):..     
-000163c0: 2020 2022 2222 4861 6e64 6c65 7220 666f     """Handler fo
-000163d0: 7220 7365 6c65 6374 696e 6720 616e 2069  r selecting an i
-000163e0: 7465 6d20 696e 206d 6169 6e20 6c69 7374  tem in main list
-000163f0: 2c20 7570 6461 7465 7320 696e 666f 2070  , updates info p
-00016400: 616e 656c 2e22 2222 0d0a 2020 2020 2020  anel."""..      
-00016410: 2020 6669 6c65 6e61 6d65 203d 2073 656c    filename = sel
-00016420: 662e 6c69 7374 5f64 622e 4765 7449 7465  f.list_db.GetIte
-00016430: 6d54 6578 7428 6576 656e 742e 4765 7449  mText(event.GetI
-00016440: 6e64 6578 2829 290d 0a20 2020 2020 2020  ndex())..       
-00016450: 2069 6620 6576 656e 742e 4765 7449 6e64   if event.GetInd
-00016460: 6578 2829 203e 2030 205c 0d0a 2020 2020  ex() > 0 \..    
-00016470: 2020 2020 616e 6420 6669 6c65 6e61 6d65      and filename
-00016480: 2021 3d20 7365 6c66 2e64 625f 6669 6c65   != self.db_file
-00016490: 6e61 6d65 3a0d 0a20 2020 2020 2020 2020  name:..         
-000164a0: 2020 2073 656c 662e 6462 5f66 696c 656e     self.db_filen
-000164b0: 616d 6520 3d20 6669 6c65 6e61 6d65 0d0a  ame = filename..
-000164c0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000164d0: 2e75 7064 6174 655f 6461 7461 6261 7365  .update_database
-000164e0: 5f64 6574 6169 6c28 290d 0a20 2020 2020  _detail()..     
-000164f0: 2020 2065 6c69 6620 6576 656e 742e 4765     elif event.Ge
-00016500: 7449 6e64 6578 2829 203d 3d20 3020 616e  tIndex() == 0 an
-00016510: 6420 6e6f 7420 7365 6c66 2e70 616e 656c  d not self.panel
-00016520: 5f64 625f 6d61 696e 2e53 686f 776e 3a0d  _db_main.Shown:.
-00016530: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00016540: 662e 6462 5f66 696c 656e 616d 6520 3d20  f.db_filename = 
-00016550: 4e6f 6e65 0d0a 2020 2020 2020 2020 2020  None..          
-00016560: 2020 7365 6c66 2e70 616e 656c 5f64 625f    self.panel_db_
-00016570: 6d61 696e 2e53 686f 7728 290d 0a20 2020  main.Show()..   
-00016580: 2020 2020 2020 2020 2073 656c 662e 7061           self.pa
-00016590: 6e65 6c5f 6462 5f64 6574 6169 6c2e 4869  nel_db_detail.Hi
-000165a0: 6465 2829 0d0a 2020 2020 2020 2020 2020  de()..          
-000165b0: 2020 7365 6c66 2e70 616e 656c 5f64 625f    self.panel_db_
-000165c0: 6d61 696e 2e50 6172 656e 742e 4c61 796f  main.Parent.Layo
-000165d0: 7574 2829 0d0a 2020 2020 2020 2020 2320  ut()..        # 
-000165e0: 5361 7665 206c 6173 7420 7365 6c65 6374  Save last select
-000165f0: 6564 2066 696c 6573 2069 6e20 6462 206c  ed files in db l
-00016600: 6973 7473 2c20 746f 2072 6573 656c 6563  ists, to reselec
-00016610: 7420 7468 656d 206f 6e20 7265 7275 6e0d  t them on rerun.
-00016620: 0a20 2020 2020 2020 2064 656c 2063 6f6e  .        del con
-00016630: 662e 4c61 7374 5365 6c65 6374 6564 4669  f.LastSelectedFi
-00016640: 6c65 735b 3a5d 0d0a 2020 2020 2020 2020  les[:]..        
-00016650: 7365 6c65 6374 6564 203d 2073 656c 662e  selected = self.
-00016660: 6c69 7374 5f64 622e 4765 7446 6972 7374  list_db.GetFirst
-00016670: 5365 6c65 6374 6564 2829 0d0a 2020 2020  Selected()..    
-00016680: 2020 2020 7768 696c 6520 7365 6c65 6374      while select
-00016690: 6564 203e 2030 3a0d 0a20 2020 2020 2020  ed > 0:..       
-000166a0: 2020 2020 2066 696c 656e 616d 6520 3d20       filename = 
-000166b0: 7365 6c66 2e6c 6973 745f 6462 2e47 6574  self.list_db.Get
-000166c0: 4974 656d 5465 7874 2873 656c 6563 7465  ItemText(selecte
-000166d0: 6429 0d0a 2020 2020 2020 2020 2020 2020  d)..            
-000166e0: 636f 6e66 2e4c 6173 7453 656c 6563 7465  conf.LastSelecte
-000166f0: 6446 696c 6573 2e61 7070 656e 6428 6669  dFiles.append(fi
-00016700: 6c65 6e61 6d65 290d 0a20 2020 2020 2020  lename)..       
-00016710: 2020 2020 2073 656c 6563 7465 6420 3d20       selected = 
-00016720: 7365 6c66 2e6c 6973 745f 6462 2e47 6574  self.list_db.Get
-00016730: 4e65 7874 5365 6c65 6374 6564 2873 656c  NextSelected(sel
-00016740: 6563 7465 6429 0d0a 2020 2020 2020 2020  ected)..        
-00016750: 7574 696c 2e72 756e 5f6f 6e63 6528 636f  util.run_once(co
-00016760: 6e66 2e73 6176 6529 0d0a 0d0a 0d0a 2020  nf.save)......  
-00016770: 2020 6465 6620 6f6e 5f65 7869 7428 7365    def on_exit(se
-00016780: 6c66 2c20 6576 656e 7429 3a0d 0a20 2020  lf, event):..   
-00016790: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-000167a0: 2020 4861 6e64 6c65 7220 6f6e 2061 7070    Handler on app
-000167b0: 6c69 6361 7469 6f6e 2065 7869 742c 2061  lication exit, a
-000167c0: 736b 7320 6162 6f75 7420 756e 7361 7665  sks about unsave
-000167d0: 6420 6368 616e 6765 732c 2069 6620 616e  d changes, if an
-000167e0: 792e 0d0a 2020 2020 2020 2020 2222 220d  y...        """.
-000167f0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00016800: 7365 6c66 3a20 7265 7475 726e 0d0a 2020  self: return..  
-00016810: 2020 2020 2020 646f 5f65 7869 7420 3d20        do_exit = 
-00016820: 5472 7565 0d0a 2020 2020 2020 2020 756e  True..        un
-00016830: 7361 7665 645f 7061 6765 7320 3d20 7b7d  saved_pages = {}
-00016840: 2023 207b 4461 7461 6261 7365 5061 6765   # {DatabasePage
-00016850: 3a20 6669 6c65 6e61 6d65 2c20 7d0d 0a20  : filename, }.. 
-00016860: 2020 2020 2020 2073 796e 6369 6e67 5f70         syncing_p
-00016870: 6167 6573 203d 207b 7d20 2320 7b44 6174  ages = {} # {Dat
-00016880: 6162 6173 6550 6167 653a 2066 696c 656e  abasePage: filen
-00016890: 616d 652c 207d 0d0a 2020 2020 2020 2020  ame, }..        
-000168a0: 6d65 7267 696e 675f 7061 6765 7320 3d20  merging_pages = 
-000168b0: 5b5d 2023 205b 4d65 7267 6572 5061 6765  [] # [MergerPage
-000168c0: 2074 6974 6c65 2c20 5d0d 0a0d 0a20 2020   title, ]....   
-000168d0: 2020 2020 2069 6620 616e 7928 782e 6973       if any(x.is
-000168e0: 5f61 6c69 7665 2829 2066 6f72 2078 2069  _alive() for x i
-000168f0: 6e20 7365 6c66 2e77 6f72 6b65 7273 5f69  n self.workers_i
-00016900: 6d70 6f72 742e 7661 6c75 6573 2829 293a  mport.values()):
-00016910: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00016920: 2077 782e 4f4b 2021 3d20 7778 2e4d 6573   wx.OK != wx.Mes
-00016930: 7361 6765 426f 7828 0d0a 2020 2020 2020  sageBox(..      
-00016940: 2020 2020 2020 2020 2020 2249 6d70 6f72            "Impor
-00016950: 7420 6973 2063 7572 7265 6e74 6c79 2069  t is currently i
-00016960: 6e20 7072 6f67 7265 7373 2e5c 6e5c 6e45  n progress.\n\nE
-00016970: 7869 7420 616e 7977 6179 3f22 2c0d 0a20  xit anyway?",.. 
-00016980: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00016990: 6f6e 662e 5469 746c 652c 2077 782e 4f4b  onf.Title, wx.OK
-000169a0: 207c 2077 782e 4341 4e43 454c 207c 2077   | wx.CANCEL | w
-000169b0: 782e 4943 4f4e 5f57 4152 4e49 4e47 0d0a  x.ICON_WARNING..
-000169c0: 2020 2020 2020 2020 2020 2020 293a 2064              ): d
-000169d0: 6f5f 6578 6974 203d 2046 616c 7365 0d0a  o_exit = False..
-000169e0: 0d0a 2020 2020 2020 2020 666f 7220 7061  ..        for pa
-000169f0: 6765 2c20 6462 2069 6e20 7365 6c66 2e64  ge, db in self.d
-00016a00: 625f 7061 6765 732e 6974 656d 7328 2920  b_pages.items() 
-00016a10: 6966 2064 6f5f 6578 6974 2065 6c73 6520  if do_exit else 
-00016a20: 2829 3a0d 0a20 2020 2020 2020 2020 2020  ():..           
-00016a30: 2069 6620 7061 6765 2061 6e64 2064 622e   if page and db.
-00016a40: 6c69 7665 2e69 735f 6c6f 6767 6564 5f69  live.is_logged_i
-00016a50: 6e28 2920 616e 6420 7061 6765 2e77 6f72  n() and page.wor
-00016a60: 6b65 725f 6c69 7665 2e69 735f 776f 726b  ker_live.is_work
-00016a70: 696e 6728 293a 0d0a 2020 2020 2020 2020  ing():..        
-00016a80: 2020 2020 2020 2020 7379 6e63 696e 675f          syncing_
-00016a90: 7061 6765 735b 7061 6765 5d20 3d20 6462  pages[page] = db
-00016aa0: 2e66 696c 656e 616d 650d 0a20 2020 2020  .filename..     
-00016ab0: 2020 2069 6620 7379 6e63 696e 675f 7061     if syncing_pa
-00016ac0: 6765 733a 0d0a 2020 2020 2020 2020 2020  ges:..          
-00016ad0: 2020 6966 2077 782e 4f4b 2021 3d20 7778    if wx.OK != wx
-00016ae0: 2e4d 6573 7361 6765 426f 7828 0d0a 2020  .MessageBox(..  
-00016af0: 2020 2020 2020 2020 2020 2020 2020 224c                "L
-00016b00: 6976 6520 7379 6e63 696e 6720 6973 2063  ive syncing is c
-00016b10: 7572 7265 6e74 6c79 2069 6e20 7072 6f67  urrently in prog
-00016b20: 7265 7373 2069 6e20 2573 2e5c 6e5c 6e45  ress in %s.\n\nE
-00016b30: 7869 7420 616e 7977 6179 3f22 2025 0d0a  xit anyway?" %..
-00016b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016b50: 225c 6e22 2e6a 6f69 6e28 7465 7874 7772  "\n".join(textwr
-00016b60: 6170 2e77 7261 7028 222c 2022 2e6a 6f69  ap.wrap(", ".joi
-00016b70: 6e28 7379 6e63 696e 675f 7061 6765 732e  n(syncing_pages.
-00016b80: 7661 6c75 6573 2829 2929 292c 0d0a 2020  values()))),..  
-00016b90: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00016ba0: 6e66 2e54 6974 6c65 2c20 7778 2e4f 4b20  nf.Title, wx.OK 
-00016bb0: 7c20 7778 2e43 414e 4345 4c20 7c20 7778  | wx.CANCEL | wx
-00016bc0: 2e49 434f 4e5f 5741 524e 494e 470d 0a20  .ICON_WARNING.. 
-00016bd0: 2020 2020 2020 2020 2020 2029 3a20 646f             ): do
-00016be0: 5f65 7869 7420 3d20 4661 6c73 650d 0a0d  _exit = False...
-00016bf0: 0a20 2020 2020 2020 2066 6f72 2070 6167  .        for pag
-00016c00: 652c 2064 6220 696e 2073 656c 662e 6462  e, db in self.db
-00016c10: 5f70 6167 6573 2e69 7465 6d73 2829 2069  _pages.items() i
-00016c20: 6620 646f 5f65 7869 7420 656c 7365 2028  f do_exit else (
-00016c30: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00016c40: 6966 2070 6167 6520 616e 6420 7061 6765  if page and page
-00016c50: 2e67 6574 5f75 6e73 6176 6564 5f67 7269  .get_unsaved_gri
-00016c60: 6473 2829 3a0d 0a20 2020 2020 2020 2020  ds():..         
-00016c70: 2020 2020 2020 2075 6e73 6176 6564 5f70         unsaved_p
-00016c80: 6167 6573 5b70 6167 655d 203d 2064 622e  ages[page] = db.
-00016c90: 6669 6c65 6e61 6d65 0d0a 2020 2020 2020  filename..      
-00016ca0: 2020 6966 2075 6e73 6176 6564 5f70 6167    if unsaved_pag
-00016cb0: 6573 3a0d 0a20 2020 2020 2020 2020 2020  es:..           
-00016cc0: 2072 6573 706f 6e73 6520 3d20 7778 2e4d   response = wx.M
-00016cd0: 6573 7361 6765 426f 7828 0d0a 2020 2020  essageBox(..    
-00016ce0: 2020 2020 2020 2020 2020 2020 2254 6865              "The
-00016cf0: 7265 2061 7265 2075 6e73 6176 6564 2063  re are unsaved c
-00016d00: 6861 6e67 6573 2069 6e20 6461 7461 2067  hanges in data g
-00016d10: 7269 6473 5c6e 2825 7329 2e5c 6e5c 6e22  rids\n(%s).\n\n"
-00016d20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00016d30: 2020 2253 6176 6520 6368 616e 6765 7320    "Save changes 
-00016d40: 6265 666f 7265 2063 6c6f 7369 6e67 3f22  before closing?"
-00016d50: 2025 0d0a 2020 2020 2020 2020 2020 2020   %..            
-00016d60: 2020 2020 225c 6e22 2e6a 6f69 6e28 7465      "\n".join(te
-00016d70: 7874 7772 6170 2e77 7261 7028 222c 2022  xtwrap.wrap(", "
-00016d80: 2e6a 6f69 6e28 756e 7361 7665 645f 7061  .join(unsaved_pa
-00016d90: 6765 732e 7661 6c75 6573 2829 2929 292c  ges.values()))),
-00016da0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00016db0: 2020 636f 6e66 2e54 6974 6c65 2c20 7778    conf.Title, wx
-00016dc0: 2e59 4553 207c 2077 782e 4e4f 207c 2077  .YES | wx.NO | w
-00016dd0: 782e 4341 4e43 454c 207c 2077 782e 4943  x.CANCEL | wx.IC
-00016de0: 4f4e 5f49 4e46 4f52 4d41 5449 4f4e 0d0a  ON_INFORMATION..
-00016df0: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
-00016e00: 2020 2020 2020 2020 2020 2064 6f5f 6578             do_ex
-00016e10: 6974 203d 2028 7778 2e43 414e 4345 4c20  it = (wx.CANCEL 
-00016e20: 213d 2072 6573 706f 6e73 6529 0d0a 2020  != response)..  
-00016e30: 2020 2020 2020 2020 2020 6966 2077 782e            if wx.
-00016e40: 5945 5320 3d3d 2072 6573 706f 6e73 653a  YES == response:
-00016e50: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00016e60: 2020 646f 5f65 7869 7420 3d20 616c 6c28    do_exit = all(
-00016e70: 702e 7361 7665 5f75 6e73 6176 6564 5f67  p.save_unsaved_g
-00016e80: 7269 6473 2829 2066 6f72 2070 2069 6e20  rids() for p in 
-00016e90: 756e 7361 7665 645f 7061 6765 7329 0d0a  unsaved_pages)..
-00016ea0: 2020 2020 2020 2020 6966 2064 6f5f 6578          if do_ex
-00016eb0: 6974 3a0d 0a20 2020 2020 2020 2020 2020  it:..           
-00016ec0: 206d 6572 6769 6e67 5f70 6167 6573 203d   merging_pages =
-00016ed0: 205b 782e 7469 746c 6520 666f 7220 7820   [x.title for x 
-00016ee0: 696e 2073 656c 662e 6d65 7267 6572 5f70  in self.merger_p
-00016ef0: 6167 6573 0d0a 2020 2020 2020 2020 2020  ages..          
-00016f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016f10: 2020 2069 6620 782e 6973 5f6d 6572 6769     if x.is_mergi
-00016f20: 6e67 2061 6e64 2078 2e74 6974 6c65 5d0d  ng and x.title].
-00016f30: 0a20 2020 2020 2020 2069 6620 6d65 7267  .        if merg
-00016f40: 696e 675f 7061 6765 733a 0d0a 2020 2020  ing_pages:..    
-00016f50: 2020 2020 2020 2020 7265 7370 6f6e 7365          response
-00016f60: 203d 2077 782e 4d65 7373 6167 6542 6f78   = wx.MessageBox
-00016f70: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-00016f80: 2020 2022 4d65 7267 696e 6720 6973 2063     "Merging is c
-00016f90: 7572 7265 6e74 6c79 2069 6e20 7072 6f67  urrently in prog
-00016fa0: 7265 7373 2069 6e20 2573 2e5c 6e5c 6e45  ress in %s.\n\nE
-00016fb0: 7869 7420 616e 7977 6179 3f20 220d 0a20  xit anyway? ".. 
-00016fc0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00016fd0: 5468 6973 2063 616e 2072 6573 756c 7420  This can result 
-00016fe0: 696e 2063 6f72 7275 7074 2064 6174 612e  in corrupt data.
-00016ff0: 2220 250d 0a20 2020 2020 2020 2020 2020  " %..           
-00017000: 2020 2020 2022 5c6e 222e 6a6f 696e 2874       "\n".join(t
-00017010: 6578 7477 7261 702e 7772 6170 2822 2c20  extwrap.wrap(", 
-00017020: 222e 6a6f 696e 286d 6572 6769 6e67 5f70  ".join(merging_p
-00017030: 6167 6573 2929 292c 0d0a 2020 2020 2020  ages))),..      
-00017040: 2020 2020 2020 2020 2020 636f 6e66 2e54            conf.T
-00017050: 6974 6c65 2c20 7778 2e4f 4b20 7c20 7778  itle, wx.OK | wx
-00017060: 2e43 414e 4345 4c20 7c20 7778 2e49 434f  .CANCEL | wx.ICO
-00017070: 4e5f 5741 524e 494e 4729 0d0a 2020 2020  N_WARNING)..    
-00017080: 2020 2020 2020 2020 646f 5f65 7869 7420          do_exit 
-00017090: 3d20 2877 782e 4341 4e43 454c 2021 3d20  = (wx.CANCEL != 
-000170a0: 7265 7370 6f6e 7365 290d 0a20 2020 2020  response)..     
-000170b0: 2020 2069 6620 646f 5f65 7869 743a 0d0a     if do_exit:..
-000170c0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-000170d0: 7820 696e 2073 656c 662e 776f 726b 6572  x in self.worker
-000170e0: 735f 696d 706f 7274 2e76 616c 7565 7328  s_import.values(
-000170f0: 293a 2078 2e73 746f 7028 6472 6f70 5f72  ): x.stop(drop_r
-00017100: 6573 756c 7473 3d46 616c 7365 290d 0a20  esults=False).. 
-00017110: 2020 2020 2020 2020 2020 2066 6f72 2070             for p
-00017120: 6167 6520 696e 2073 656c 662e 6462 5f70  age in self.db_p
-00017130: 6167 6573 3a0d 0a20 2020 2020 2020 2020  ages:..         
-00017140: 2020 2020 2020 2069 6620 6e6f 7420 7061         if not pa
-00017150: 6765 3a20 636f 6e74 696e 7565 2023 2066  ge: continue # f
-00017160: 6f72 2070 6167 652c 2069 6620 6465 6164  or page, if dead
-00017170: 206f 626a 6563 740d 0a20 2020 2020 2020   object..       
-00017180: 2020 2020 2020 2020 2061 6374 6976 655f           active_
-00017190: 6964 7820 3d20 7061 6765 2e6e 6f74 6562  idx = page.noteb
-000171a0: 6f6f 6b2e 5365 6c65 6374 696f 6e0d 0a20  ook.Selection.. 
-000171b0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000171c0: 6620 6163 7469 7665 5f69 6478 3a0d 0a20  f active_idx:.. 
+00014600: 2020 2067 7569 6261 7365 2e73 7461 7475     guibase.statu
+00014610: 7328 290d 0a20 2020 2020 2020 2020 2020  s()..           
+00014620: 2020 2020 2065 6c69 6620 7265 7375 6c74       elif result
+00014630: 2e67 6574 2822 646f 6e65 2229 3a0d 0a20  .get("done"):.. 
+00014640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014650: 2020 2064 6c67 2e44 6573 7472 6f79 2829     dlg.Destroy()
+00014660: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00014670: 2020 2020 2020 6775 6962 6173 652e 7374        guibase.st
+00014680: 6174 7573 2829 0d0a 2020 2020 2020 2020  atus()..        
+00014690: 2020 2020 2020 2020 2020 2020 6462 2e63              db.c
+000146a0: 6c6f 7365 2829 0d0a 2020 2020 2020 2020  lose()..        
+000146b0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000146c0: 2e75 7064 6174 655f 6461 7461 6261 7365  .update_database
+000146d0: 5f6c 6973 7428 6669 6c65 6e61 6d65 290d  _list(filename).
+000146e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000146f0: 2020 2020 2073 656c 662e 6c6f 6164 5f64       self.load_d
+00014700: 6174 6162 6173 655f 7061 6765 2866 696c  atabase_page(fil
+00014710: 656e 616d 6529 0d0a 2020 2020 2020 2020  ename)..        
+00014720: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+00014730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014740: 2020 2074 203d 2022 2c20 222e 6a6f 696e     t = ", ".join
+00014750: 2875 7469 6c2e 706c 7572 616c 2878 5b3a  (util.plural(x[:
+00014760: 2d31 5d2c 2072 6573 756c 745b 2263 6f75  -1], result["cou
+00014770: 6e74 7322 5d5b 785d 2c20 7365 703d 222c  nts"][x], sep=",
+00014780: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
+00014790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000147a0: 2020 2020 2020 666f 7220 7820 696e 2073        for x in s
+000147b0: 6f72 7465 6428 7265 7375 6c74 5b22 636f  orted(result["co
+000147c0: 756e 7473 225d 2929 0d0a 2020 2020 2020  unts"]))..      
+000147d0: 2020 2020 2020 2020 2020 2020 2020 646c                dl
+000147e0: 672e 4d65 7373 6167 6520 3d20 2250 6172  g.Message = "Par
+000147f0: 7365 6420 2573 2e22 2025 2074 0d0a 0d0a  sed %s." % t....
+00014800: 2020 2020 2020 2020 2020 2020 7778 2e43              wx.C
+00014810: 616c 6c41 6674 6572 2861 6674 6572 290d  allAfter(after).
+00014820: 0a0d 0a20 2020 2020 2020 2074 7279 3a0d  ...        try:.
+00014830: 0a20 2020 2020 2020 2020 2020 2064 6220  .            db 
+00014840: 3d20 6c69 7665 2e53 6b79 7065 4578 706f  = live.SkypeExpo
+00014850: 7274 2865 6669 6c65 6e61 6d65 2c20 6669  rt(efilename, fi
+00014860: 6c65 6e61 6d65 290d 0a20 2020 2020 2020  lename)..       
+00014870: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
+00014880: 6e3a 0d0a 2020 2020 2020 2020 2020 2020  n:..            
+00014890: 5f2c 2065 2c20 7462 203d 2073 7973 2e65  _, e, tb = sys.e
+000148a0: 7863 5f69 6e66 6f28 290d 0a20 2020 2020  xc_info()..     
+000148b0: 2020 2020 2020 2075 7469 6c2e 7472 795f         util.try_
+000148c0: 6967 6e6f 7265 286f 732e 756e 6c69 6e6b  ignore(os.unlink
+000148d0: 2c20 6669 6c65 6e61 6d65 290d 0a20 2020  , filename)..   
+000148e0: 2020 2020 2020 2020 2073 6978 2e72 6572           six.rer
+000148f0: 6169 7365 2874 7970 6528 6529 2c20 652c  aise(type(e), e,
+00014900: 2074 6229 0d0a 0d0a 2020 2020 2020 2020   tb)....        
+00014910: 646c 6720 3d20 636f 6e74 726f 6c73 2e50  dlg = controls.P
+00014920: 726f 6772 6573 7357 696e 646f 7728 7365  rogressWindow(se
+00014930: 6c66 2c20 2249 6d70 6f72 7420 7072 6f67  lf, "Import prog
+00014940: 7265 7373 222c 0d0a 2020 2020 2020 2020  ress",..        
+00014950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014960: 2020 2020 2020 2020 2020 2020 2020 6361                ca
+00014970: 6e63 656c 3d6f 6e5f 6361 6e63 656c 2c20  ncel=on_cancel, 
+00014980: 6167 7753 7479 6c65 3d77 782e 414c 4947  agwStyle=wx.ALIG
+00014990: 4e5f 4345 4e54 4552 290d 0a20 2020 2020  N_CENTER)..     
+000149a0: 2020 2064 6c67 2e50 6f73 6974 696f 6e20     dlg.Position 
+000149b0: 3d20 5b73 656c 662e 506f 7369 7469 6f6e  = [self.Position
+000149c0: 5b69 5d20 2b20 6120 2d20 6220 666f 7220  [i] + a - b for 
+000149d0: 692c 2028 612c 2062 2920 696e 2065 6e75  i, (a, b) in enu
+000149e0: 6d65 7261 7465 287a 6970 2873 656c 662e  merate(zip(self.
+000149f0: 5369 7a65 2c20 646c 672e 5369 7a65 2929  Size, dlg.Size))
+00014a00: 5d0d 0a20 2020 2020 2020 2064 6c67 2e50  ]..        dlg.P
+00014a10: 756c 7365 2829 0d0a 2020 2020 2020 2020  ulse()..        
+00014a20: 6775 6962 6173 652e 7374 6174 7573 2822  guibase.status("
+00014a30: 4372 6561 7469 6e67 206e 6577 2064 6174  Creating new dat
+00014a40: 6162 6173 6520 6672 6f6d 2053 6b79 7065  abase from Skype
+00014a50: 2065 7870 6f72 742e 2229 0d0a 2020 2020   export.")..    
+00014a60: 2020 2020 6c6f 6767 6572 2e69 6e66 6f28      logger.info(
+00014a70: 2243 7265 6174 696e 6720 6e65 7720 6461  "Creating new da
+00014a80: 7461 6261 7365 2025 7320 6672 6f6d 2053  tabase %s from S
+00014a90: 6b79 7065 2065 7870 6f72 7420 2573 2c20  kype export %s, 
+00014aa0: 7573 6572 2027 2573 272e 222c 0d0a 2020  user '%s'.",..  
+00014ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014ac0: 2020 6669 6c65 6e61 6d65 2c20 6566 696c    filename, efil
+00014ad0: 656e 616d 652c 2075 7365 7229 0d0a 2020  ename, user)..  
+00014ae0: 2020 2020 2020 776f 726b 6572 203d 2077        worker = w
+00014af0: 6f72 6b65 7273 2e53 6b79 7065 4172 6368  orkers.SkypeArch
+00014b00: 6976 6554 6872 6561 6428 6f6e 5f70 726f  iveThread(on_pro
+00014b10: 6772 6573 7329 0d0a 2020 2020 2020 2020  gress)..        
+00014b20: 7365 6c66 2e77 6f72 6b65 7273 5f69 6d70  self.workers_imp
+00014b30: 6f72 745b 6669 6c65 6e61 6d65 5d20 3d20  ort[filename] = 
+00014b40: 776f 726b 6572 0d0a 2020 2020 2020 2020  worker..        
+00014b50: 776f 726b 6572 2e77 6f72 6b28 7b22 6163  worker.work({"ac
+00014b60: 7469 6f6e 223a 2022 7061 7273 6522 2c20  tion": "parse", 
+00014b70: 2264 6222 3a20 6462 7d29 0d0a 0d0a 0d0a  "db": db})......
+00014b80: 2020 2020 6465 6620 6f6e 5f6f 7065 6e5f      def on_open_
+00014b90: 6461 7461 6261 7365 2873 656c 662c 2065  database(self, e
+00014ba0: 7665 6e74 293a 0d0a 2020 2020 2020 2020  vent):..        
+00014bb0: 2222 220d 0a20 2020 2020 2020 2048 616e  """..        Han
+00014bc0: 646c 6572 2066 6f72 206f 7065 6e20 6461  dler for open da
+00014bd0: 7461 6261 7365 206d 656e 7520 6f72 2062  tabase menu or b
+00014be0: 7574 746f 6e2c 2064 6973 706c 6179 7320  utton, displays 
+00014bf0: 6120 6669 6c65 2064 6961 6c6f 6720 616e  a file dialog an
+00014c00: 640d 0a20 2020 2020 2020 206c 6f61 6473  d..        loads
+00014c10: 2074 6865 2063 686f 7365 6e20 6461 7461   the chosen data
+00014c20: 6261 7365 2e0d 0a20 2020 2020 2020 2022  base...        "
+00014c30: 2222 0d0a 2020 2020 2020 2020 6966 2077  ""..        if w
+00014c40: 782e 4944 5f4f 4b20 3d3d 2073 656c 662e  x.ID_OK == self.
+00014c50: 6469 616c 6f67 5f6f 7065 6e66 696c 652e  dialog_openfile.
+00014c60: 5368 6f77 4d6f 6461 6c28 293a 0d0a 2020  ShowModal():..  
+00014c70: 2020 2020 2020 2020 2020 6669 6c65 6e61            filena
+00014c80: 6d65 203d 2073 656c 662e 6469 616c 6f67  me = self.dialog
+00014c90: 5f6f 7065 6e66 696c 652e 4765 7450 6174  _openfile.GetPat
+00014ca0: 6828 290d 0a20 2020 2020 2020 2020 2020  h()..           
+00014cb0: 2069 6620 6669 6c65 6e61 6d65 3a0d 0a20   if filename:.. 
+00014cc0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00014cd0: 656c 662e 7570 6461 7465 5f64 6174 6162  elf.update_datab
+00014ce0: 6173 655f 6c69 7374 2866 696c 656e 616d  ase_list(filenam
+00014cf0: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+00014d00: 2020 2020 7365 6c66 2e6c 6f61 645f 6461      self.load_da
+00014d10: 7461 6261 7365 5f70 6167 6528 6669 6c65  tabase_page(file
+00014d20: 6e61 6d65 290d 0a0d 0a0d 0a20 2020 2064  name)......    d
+00014d30: 6566 206f 6e5f 6f70 656e 5f64 6174 6162  ef on_open_datab
+00014d40: 6173 655f 6576 656e 7428 7365 6c66 2c20  ase_event(self, 
+00014d50: 6576 656e 7429 3a0d 0a20 2020 2020 2020  event):..       
+00014d60: 2022 2222 0d0a 2020 2020 2020 2020 4861   """..        Ha
+00014d70: 6e64 6c65 7220 666f 7220 4f70 656e 4461  ndler for OpenDa
+00014d80: 7461 6261 7365 4576 656e 742c 2075 7064  tabaseEvent, upd
+00014d90: 6174 6573 2064 6220 6c69 7374 2061 6e64  ates db list and
+00014da0: 206c 6f61 6473 2074 6865 2065 7665 6e74   loads the event
+00014db0: 0d0a 2020 2020 2020 2020 6461 7461 6261  ..        databa
+00014dc0: 7365 2e0d 0a20 2020 2020 2020 2022 2222  se...        """
+00014dd0: 0d0a 2020 2020 2020 2020 6669 6c65 6e61  ..        filena
+00014de0: 6d65 203d 206f 732e 7061 7468 2e72 6561  me = os.path.rea
+00014df0: 6c70 6174 6828 6576 656e 742e 6669 6c65  lpath(event.file
+00014e00: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00014e10: 7570 6461 7465 5f64 6174 6162 6173 655f  update_database_
+00014e20: 6c69 7374 2866 696c 656e 616d 6529 0d0a  list(filename)..
+00014e30: 2020 2020 2020 2020 7365 6c66 2e6c 6f61          self.loa
+00014e40: 645f 6461 7461 6261 7365 5f70 6167 6528  d_database_page(
+00014e50: 6669 6c65 6e61 6d65 290d 0a0d 0a0d 0a20  filename)...... 
+00014e60: 2020 2064 6566 206f 6e5f 7265 6365 6e74     def on_recent
+00014e70: 5f66 696c 6528 7365 6c66 2c20 6576 656e  _file(self, even
+00014e80: 7429 3a0d 0a20 2020 2020 2020 2022 2222  t):..        """
+00014e90: 4861 6e64 6c65 7220 666f 7220 636c 6963  Handler for clic
+00014ea0: 6b69 6e67 2061 6e20 656e 7472 7920 696e  king an entry in
+00014eb0: 2052 6563 656e 7420 4669 6c65 7320 6d65   Recent Files me
+00014ec0: 6e75 2e22 2222 0d0a 2020 2020 2020 2020  nu."""..        
+00014ed0: 6669 6c65 6e61 6d65 203d 2073 656c 662e  filename = self.
+00014ee0: 6869 7374 6f72 795f 6669 6c65 2e47 6574  history_file.Get
+00014ef0: 4869 7374 6f72 7946 696c 6528 6576 656e  HistoryFile(even
+00014f00: 742e 4964 202d 2077 782e 4944 5f46 494c  t.Id - wx.ID_FIL
+00014f10: 4531 290d 0a20 2020 2020 2020 2073 656c  E1)..        sel
+00014f20: 662e 7570 6461 7465 5f64 6174 6162 6173  f.update_databas
+00014f30: 655f 6c69 7374 2866 696c 656e 616d 6529  e_list(filename)
+00014f40: 0d0a 2020 2020 2020 2020 7365 6c66 2e6c  ..        self.l
+00014f50: 6f61 645f 6461 7461 6261 7365 5f70 6167  oad_database_pag
+00014f60: 6528 6669 6c65 6e61 6d65 290d 0a0d 0a0d  e(filename).....
+00014f70: 0a20 2020 2064 6566 206f 6e5f 6164 645f  .    def on_add_
+00014f80: 6672 6f6d 5f66 6f6c 6465 7228 7365 6c66  from_folder(self
+00014f90: 2c20 6576 656e 7429 3a0d 0a20 2020 2020  , event):..     
+00014fa0: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
+00014fb0: 4861 6e64 6c65 7220 666f 7220 636c 6963  Handler for clic
+00014fc0: 6b69 6e67 2074 6f20 7365 6c65 6374 2066  king to select f
+00014fd0: 6f6c 6465 7220 7768 6572 6520 746f 2073  older where to s
+00014fe0: 6561 7263 6820 666f 7220 6461 7461 6261  earch for databa
+00014ff0: 7365 732c 0d0a 2020 2020 2020 2020 7570  ses,..        up
+00015000: 6461 7465 7320 6461 7461 6261 7365 206c  dates database l
+00015010: 6973 742e 0d0a 2020 2020 2020 2020 2222  ist...        ""
+00015020: 220d 0a20 2020 2020 2020 2069 6620 7365  "..        if se
+00015030: 6c66 2e64 6961 6c6f 675f 7365 6c65 6374  lf.dialog_select
+00015040: 666f 6c64 6572 2e53 686f 774d 6f64 616c  folder.ShowModal
+00015050: 2829 203d 3d20 7778 2e49 445f 4f4b 3a0d  () == wx.ID_OK:.
+00015060: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00015070: 7365 6c66 2e62 7574 746f 6e5f 666f 6c64  self.button_fold
+00015080: 6572 2e46 696e 6446 6f63 7573 2829 203d  er.FindFocus() =
+00015090: 3d20 7365 6c66 2e62 7574 746f 6e5f 666f  = self.button_fo
+000150a0: 6c64 6572 3a0d 0a20 2020 2020 2020 2020  lder:..         
+000150b0: 2020 2020 2020 2073 656c 662e 6c69 7374         self.list
+000150c0: 5f64 622e 5365 7446 6f63 7573 2829 0d0a  _db.SetFocus()..
+000150d0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000150e0: 2e62 7574 746f 6e5f 666f 6c64 6572 2e45  .button_folder.E
+000150f0: 6e61 626c 6564 203d 2046 616c 7365 0d0a  nabled = False..
+00015100: 2020 2020 2020 2020 2020 2020 666f 6c64              fold
+00015110: 6572 203d 2073 656c 662e 6469 616c 6f67  er = self.dialog
+00015120: 5f73 656c 6563 7466 6f6c 6465 722e 4765  _selectfolder.Ge
+00015130: 7450 6174 6828 290d 0a20 2020 2020 2020  tPath()..       
+00015140: 2020 2020 2067 7569 6261 7365 2e73 7461       guibase.sta
+00015150: 7475 7328 2244 6574 6563 7469 6e67 2064  tus("Detecting d
+00015160: 6174 6162 6173 6573 2075 6e64 6572 2025  atabases under %
+00015170: 732e 222c 2066 6f6c 6465 722c 206c 6f67  s.", folder, log
+00015180: 3d54 7275 6529 0d0a 2020 2020 2020 2020  =True)..        
+00015190: 2020 2020 7778 2e59 6965 6c64 4966 4e65      wx.YieldIfNe
+000151a0: 6564 6564 2829 0d0a 2020 2020 2020 2020  eded()..        
+000151b0: 2020 2020 636f 756e 7420 3d20 300d 0a20      count = 0.. 
+000151c0: 2020 2020 2020 2020 2020 2066 6f72 2066             for f
+000151d0: 696c 656e 616d 6520 696e 2073 6b79 7065  ilename in skype
+000151e0: 6461 7461 2e66 696e 645f 6461 7461 6261  data.find_databa
+000151f0: 7365 7328 666f 6c64 6572 293a 0d0a 2020  ses(folder):..  
+00015200: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00015210: 2066 696c 656e 616d 6520 6e6f 7420 696e   filename not in
+00015220: 2073 656c 662e 6462 5f66 696c 656e 616d   self.db_filenam
+00015230: 6573 3a0d 0a20 2020 2020 2020 2020 2020  es:..           
+00015240: 2020 2020 2020 2020 206c 6f67 6765 722e           logger.
+00015250: 696e 666f 2822 4465 7465 6374 6564 2064  info("Detected d
+00015260: 6174 6162 6173 6520 2573 2e22 2c20 6669  atabase %s.", fi
+00015270: 6c65 6e61 6d65 290d 0a20 2020 2020 2020  lename)..       
+00015280: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00015290: 662e 7570 6461 7465 5f64 6174 6162 6173  f.update_databas
+000152a0: 655f 6c69 7374 2866 696c 656e 616d 6529  e_list(filename)
+000152b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000152c0: 2020 2020 2020 636f 756e 7420 2b3d 2031        count += 1
+000152d0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+000152e0: 6c66 2e62 7574 746f 6e5f 666f 6c64 6572  lf.button_folder
+000152f0: 2e45 6e61 626c 6564 203d 2054 7275 650d  .Enabled = True.
+00015300: 0a20 2020 2020 2020 2020 2020 2067 7569  .            gui
+00015310: 6261 7365 2e73 7461 7475 7328 2244 6574  base.status("Det
+00015320: 6563 7465 6420 2573 2075 6e64 6572 2025  ected %s under %
+00015330: 732e 222c 0d0a 2020 2020 2020 2020 2020  s.",..          
+00015340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015350: 2075 7469 6c2e 706c 7572 616c 2822 6e65   util.plural("ne
+00015360: 7720 6461 7461 6261 7365 222c 2063 6f75  w database", cou
+00015370: 6e74 292c 2066 6f6c 6465 722c 206c 6f67  nt), folder, log
+00015380: 3d54 7275 6529 0d0a 0d0a 0d0a 2020 2020  =True)......    
+00015390: 6465 6620 6f6e 5f6f 7065 6e5f 6375 7272  def on_open_curr
+000153a0: 656e 745f 6461 7461 6261 7365 2873 656c  ent_database(sel
+000153b0: 662c 2065 7665 6e74 293a 0d0a 2020 2020  f, event):..    
+000153c0: 2020 2020 2222 2248 616e 646c 6572 2066      """Handler f
+000153d0: 6f72 2063 6c69 636b 696e 6720 746f 206f  or clicking to o
+000153e0: 7065 6e20 7365 6c65 6374 6564 2066 696c  pen selected fil
+000153f0: 6573 2066 726f 6d20 6461 7461 6261 7365  es from database
+00015400: 206c 6973 742e 2222 220d 0a20 2020 2020   list."""..     
+00015410: 2020 2069 6620 7365 6c66 2e64 625f 6669     if self.db_fi
+00015420: 6c65 6e61 6d65 3a0d 0a20 2020 2020 2020  lename:..       
+00015430: 2020 2020 2073 656c 662e 6c6f 6164 5f64       self.load_d
+00015440: 6174 6162 6173 655f 7061 6765 2873 656c  atabase_page(sel
+00015450: 662e 6462 5f66 696c 656e 616d 6529 0d0a  f.db_filename)..
+00015460: 0d0a 0d0a 2020 2020 6465 6620 6f6e 5f6f  ....    def on_o
+00015470: 7065 6e5f 6672 6f6d 5f6c 6973 745f 6462  pen_from_list_db
+00015480: 2873 656c 662c 2065 7665 6e74 293a 0d0a  (self, event):..
+00015490: 2020 2020 2020 2020 2222 2248 616e 646c          """Handl
+000154a0: 6572 2066 6f72 2063 6c69 636b 696e 6720  er for clicking 
+000154b0: 746f 206f 7065 6e20 7365 6c65 6374 6564  to open selected
+000154c0: 2066 696c 6573 2066 726f 6d20 6461 7461   files from data
+000154d0: 6261 7365 206c 6973 742e 2222 220d 0a20  base list.""".. 
+000154e0: 2020 2020 2020 2069 6620 6576 656e 742e         if event.
+000154f0: 4765 7449 6e64 6578 2829 203e 2030 3a0d  GetIndex() > 0:.
+00015500: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00015510: 662e 6c6f 6164 5f64 6174 6162 6173 655f  f.load_database_
+00015520: 7061 6765 2873 656c 662e 6c69 7374 5f64  page(self.list_d
+00015530: 622e 4765 7449 7465 6d54 6578 7428 6576  b.GetItemText(ev
+00015540: 656e 742e 4765 7449 6e64 6578 2829 2929  ent.GetIndex()))
+00015550: 0d0a 0d0a 0d0a 2020 2020 6465 6620 7570  ......    def up
+00015560: 6461 7465 5f64 6174 6162 6173 655f 7374  date_database_st
+00015570: 6174 7328 7365 6c66 2c20 6669 6c65 6e61  ats(self, filena
+00015580: 6d65 293a 0d0a 2020 2020 2020 2020 2222  me):..        ""
+00015590: 224f 7065 6e73 2074 6865 2064 6174 6162  "Opens the datab
+000155a0: 6173 6520 616e 6420 7570 6461 7465 7320  ase and updates 
+000155b0: 6d61 696e 2070 6167 6520 5549 2077 6974  main page UI wit
+000155c0: 6820 6461 7461 6261 7365 2069 6e66 6f2e  h database info.
+000155d0: 2222 220d 0a20 2020 2020 2020 2064 6220  """..        db 
+000155e0: 3d20 4e6f 6e65 0d0a 2020 2020 2020 2020  = None..        
+000155f0: 7472 793a 0d0a 2020 2020 2020 2020 2020  try:..          
+00015600: 2020 6462 203d 2073 656c 662e 6462 732e    db = self.dbs.
+00015610: 6765 7428 6669 6c65 6e61 6d65 2920 6f72  get(filename) or
+00015620: 2073 6b79 7065 6461 7461 2e53 6b79 7065   skypedata.Skype
+00015630: 4461 7461 6261 7365 2866 696c 656e 616d  Database(filenam
+00015640: 6529 0d0a 2020 2020 2020 2020 6578 6365  e)..        exce
+00015650: 7074 2045 7863 6570 7469 6f6e 2061 7320  pt Exception as 
+00015660: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00015670: 7365 6c66 2e6c 6162 656c 5f61 6363 6f75  self.label_accou
+00015680: 6e74 2e56 616c 7565 203d 2022 2864 6174  nt.Value = "(dat
+00015690: 6162 6173 6520 6e6f 7420 7265 6164 6162  abase not readab
+000156a0: 6c65 2922 0d0a 2020 2020 2020 2020 2020  le)"..          
+000156b0: 2020 7365 6c66 2e6c 6162 656c 5f6d 6573    self.label_mes
+000156c0: 7361 6765 732e 5661 6c75 6520 3d20 2245  sages.Value = "E
+000156d0: 7272 6f72 2074 6578 743a 2025 7322 2025  rror text: %s" %
+000156e0: 2075 7469 6c2e 666f 726d 6174 5f65 7863   util.format_exc
+000156f0: 2865 290d 0a20 2020 2020 2020 2020 2020  (e)..           
+00015700: 2073 656c 662e 6c61 6265 6c5f 6163 636f   self.label_acco
+00015710: 756e 742e 466f 7265 6772 6f75 6e64 436f  unt.ForegroundCo
+00015720: 6c6f 7572 203d 2063 6f6e 662e 4c61 6265  lour = conf.Labe
+00015730: 6c45 7272 6f72 436f 6c6f 7572 0d0a 2020  lErrorColour..  
+00015740: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
+00015750: 6162 656c 5f63 6861 7473 2e46 6f72 6567  abel_chats.Foreg
+00015760: 726f 756e 6443 6f6c 6f75 7220 3d20 636f  roundColour = co
+00015770: 6e66 2e4c 6162 656c 4572 726f 7243 6f6c  nf.LabelErrorCol
+00015780: 6f75 720d 0a20 2020 2020 2020 2020 2020  our..           
+00015790: 206c 6f67 6765 722e 6578 6365 7074 696f   logger.exceptio
+000157a0: 6e28 2245 7272 6f72 206f 7065 6e69 6e67  n("Error opening
+000157b0: 2025 732e 222c 2066 696c 656e 616d 6529   %s.", filename)
+000157c0: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+000157d0: 7475 726e 0d0a 2020 2020 2020 2020 7472  turn..        tr
+000157e0: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
+000157f0: 7374 6174 7320 3d20 6462 2e67 6574 5f67  stats = db.get_g
+00015800: 656e 6572 616c 5f73 7461 7469 7374 6963  eneral_statistic
+00015810: 7328 6675 6c6c 3d46 616c 7365 290d 0a20  s(full=False).. 
+00015820: 2020 2020 2020 2020 2020 2069 6620 2275             if "u
+00015830: 7365 726e 616d 6522 2069 6e20 7374 6174  sername" in stat
+00015840: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
+00015850: 2020 2020 7465 7874 203d 2073 7461 7473      text = stats
+00015860: 5b22 7573 6572 6e61 6d65 225d 0d0a 2020  ["username"]..  
+00015870: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00015880: 2022 6e61 6d65 2220 696e 2073 7461 7473   "name" in stats
+00015890: 2061 6e64 2073 7461 7473 5b22 6e61 6d65   and stats["name
+000158a0: 225d 2021 3d20 7465 7874 3a0d 0a20 2020  "] != text:..   
+000158b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000158c0: 2074 6578 7420 3d20 2225 7320 2825 7329   text = "%s (%s)
+000158d0: 2220 2520 2873 7461 7473 5b22 6e61 6d65  " % (stats["name
+000158e0: 225d 2c20 7465 7874 290d 0a20 2020 2020  "], text)..     
+000158f0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00015900: 6c61 6265 6c5f 6163 636f 756e 742e 5661  label_account.Va
+00015910: 6c75 6520 3d20 7465 7874 0d0a 2020 2020  lue = text..    
+00015920: 2020 2020 2020 2020 7465 7874 203d 2075          text = u
+00015930: 7469 6c2e 706c 7572 616c 2822 6368 6174  til.plural("chat
+00015940: 222c 2073 7461 7473 5b22 6368 6174 7322  ", stats["chats"
+00015950: 5d2c 2073 6570 3d22 2c22 290d 0a20 2020  ], sep=",")..   
+00015960: 2020 2020 2020 2020 2069 6620 7374 6174           if stat
+00015970: 732e 6765 7428 226c 6173 746d 6573 7361  s.get("lastmessa
+00015980: 6765 5f63 6861 7422 293a 0d0a 2020 2020  ge_chat"):..    
+00015990: 2020 2020 2020 2020 2020 2020 7465 7874              text
+000159a0: 202b 3d20 222c 206c 6174 6573 7420 2528   += ", latest %(
+000159b0: 6c61 7374 6d65 7373 6167 655f 6368 6174  lastmessage_chat
+000159c0: 2973 2220 2520 7374 6174 730d 0a20 2020  )s" % stats..   
+000159d0: 2020 2020 2020 2020 2073 656c 662e 6c61           self.la
+000159e0: 6265 6c5f 6368 6174 732e 5661 6c75 6520  bel_chats.Value 
+000159f0: 3d20 7465 7874 0d0a 2020 2020 2020 2020  = text..        
+00015a00: 2020 2020 7465 7874 203d 2075 7469 6c2e      text = util.
+00015a10: 706c 7572 616c 2822 6d65 7373 6167 6522  plural("message"
+00015a20: 2c20 7374 6174 735b 226d 6573 7361 6765  , stats["message
+00015a30: 7322 5d2c 2073 6570 3d22 2c22 290d 0a20  s"], sep=",").. 
+00015a40: 2020 2020 2020 2020 2020 2069 6620 7374             if st
+00015a50: 6174 732e 6765 7428 226c 6173 746d 6573  ats.get("lastmes
+00015a60: 7361 6765 5f64 7422 293a 0d0a 2020 2020  sage_dt"):..    
+00015a70: 2020 2020 2020 2020 2020 2020 7465 7874              text
+00015a80: 202b 3d20 222c 206c 6173 7420 6174 2025   += ", last at %
+00015a90: 286c 6173 746d 6573 7361 6765 5f64 7429  (lastmessage_dt)
+00015aa0: 7322 2025 2073 7461 7473 0d0a 2020 2020  s" % stats..    
+00015ab0: 2020 2020 2020 2020 7365 6c66 2e6c 6162          self.lab
+00015ac0: 656c 5f6d 6573 7361 6765 732e 5661 6c75  el_messages.Valu
+00015ad0: 6520 3d20 7465 7874 0d0a 2020 2020 2020  e = text..      
+00015ae0: 2020 2020 2020 6461 7461 203d 2073 656c        data = sel
+00015af0: 662e 6462 5f66 696c 656e 616d 6573 2e67  f.db_filenames.g
+00015b00: 6574 2866 696c 656e 616d 652c 207b 7d29  et(filename, {})
+00015b10: 0d0a 2020 2020 2020 2020 2020 2020 6461  ..            da
+00015b20: 7461 5b22 6163 636f 756e 7422 5d20 3d20  ta["account"] = 
+00015b30: 7365 6c66 2e6c 6162 656c 5f61 6363 6f75  self.label_accou
+00015b40: 6e74 2e56 616c 7565 0d0a 2020 2020 2020  nt.Value..      
+00015b50: 2020 2020 2020 6461 7461 5b22 6368 6174        data["chat
+00015b60: 7322 5d20 3d20 7365 6c66 2e6c 6162 656c  s"] = self.label
+00015b70: 5f63 6861 7473 2e56 616c 7565 0d0a 2020  _chats.Value..  
+00015b80: 2020 2020 2020 2020 2020 6461 7461 5b22            data["
+00015b90: 6d65 7373 6167 6573 225d 203d 2073 656c  messages"] = sel
+00015ba0: 662e 6c61 6265 6c5f 6d65 7373 6167 6573  f.label_messages
+00015bb0: 2e56 616c 7565 0d0a 2020 2020 2020 2020  .Value..        
+00015bc0: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
+00015bd0: 2061 7320 653a 0d0a 2020 2020 2020 2020   as e:..        
+00015be0: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
+00015bf0: 6c61 6265 6c5f 6163 636f 756e 742e 5661  label_account.Va
+00015c00: 6c75 653a 0d0a 2020 2020 2020 2020 2020  lue:..          
+00015c10: 2020 2020 2020 7365 6c66 2e6c 6162 656c        self.label
+00015c20: 5f61 6363 6f75 6e74 2e56 616c 7565 203d  _account.Value =
+00015c30: 2022 286e 6f74 2072 6563 6f67 6e69 7a65   "(not recognize
+00015c40: 6420 6173 2061 2053 6b79 7065 2064 6174  d as a Skype dat
+00015c50: 6162 6173 6529 220d 0a20 2020 2020 2020  abase)"..       
+00015c60: 2020 2020 2020 2020 2073 656c 662e 6c61           self.la
+00015c70: 6265 6c5f 6163 636f 756e 742e 466f 7265  bel_account.Fore
+00015c80: 6772 6f75 6e64 436f 6c6f 7572 203d 2063  groundColour = c
+00015c90: 6f6e 662e 4c61 6265 6c45 7272 6f72 436f  onf.LabelErrorCo
+00015ca0: 6c6f 7572 0d0a 2020 2020 2020 2020 2020  lour..          
+00015cb0: 2020 7365 6c66 2e6c 6162 656c 5f63 6861    self.label_cha
+00015cc0: 7473 2e56 616c 7565 203d 2022 4572 726f  ts.Value = "Erro
+00015cd0: 7220 7465 7874 3a20 2573 2220 2520 7574  r text: %s" % ut
+00015ce0: 696c 2e66 6f72 6d61 745f 6578 6328 6529  il.format_exc(e)
+00015cf0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00015d00: 6c66 2e6c 6162 656c 5f63 6861 7473 2e46  lf.label_chats.F
+00015d10: 6f72 6567 726f 756e 6443 6f6c 6f75 7220  oregroundColour 
+00015d20: 3d20 636f 6e66 2e4c 6162 656c 4572 726f  = conf.LabelErro
+00015d30: 7243 6f6c 6f75 720d 0a20 2020 2020 2020  rColour..       
+00015d40: 2020 2020 206c 6f67 6765 722e 6578 6365       logger.exce
+00015d50: 7074 696f 6e28 2245 7272 6f72 206c 6f61  ption("Error loa
+00015d60: 6469 6e67 2064 6174 6120 6672 6f6d 2025  ding data from %
+00015d70: 732e 222c 2066 696c 656e 616d 6529 0d0a  s.", filename)..
+00015d80: 2020 2020 2020 2020 6966 2064 6220 616e          if db an
+00015d90: 6420 6e6f 7420 6462 2e68 6173 5f63 6f6e  d not db.has_con
+00015da0: 7375 6d65 7273 2829 3a0d 0a20 2020 2020  sumers():..     
+00015db0: 2020 2020 2020 2064 622e 636c 6f73 6528         db.close(
+00015dc0: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
+00015dd0: 656c 662e 6462 732e 706f 7028 6669 6c65  elf.dbs.pop(file
+00015de0: 6e61 6d65 2c20 4e6f 6e65 290d 0a0d 0a0d  name, None).....
+00015df0: 0a20 2020 2064 6566 2075 7064 6174 655f  .    def update_
+00015e00: 6461 7461 6261 7365 5f64 6574 6169 6c28  database_detail(
+00015e10: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
+00015e20: 2222 2255 7064 6174 6573 2064 6174 6162  """Updates datab
+00015e30: 6173 6520 6465 7461 696c 2070 616e 656c  ase detail panel
+00015e40: 2077 6974 6820 6375 7272 656e 7420 6461   with current da
+00015e50: 7461 6261 7365 2069 6e66 6f72 6d61 7469  tabase informati
+00015e60: 6f6e 2e22 2222 0d0a 2020 2020 2020 2020  on."""..        
+00015e70: 6966 206e 6f74 2073 656c 6620 6f72 206e  if not self or n
+00015e80: 6f74 2073 656c 662e 6462 5f66 696c 656e  ot self.db_filen
+00015e90: 616d 653a 2072 6574 7572 6e0d 0a0d 0a20  ame: return.... 
+00015ea0: 2020 2020 2020 2066 696c 656e 616d 6520         filename 
+00015eb0: 3d20 7365 6c66 2e64 625f 6669 6c65 6e61  = self.db_filena
+00015ec0: 6d65 0d0a 2020 2020 2020 2020 7061 7468  me..        path
+00015ed0: 2c20 7461 696c 203d 206f 732e 7061 7468  , tail = os.path
+00015ee0: 2e73 706c 6974 2866 696c 656e 616d 6529  .split(filename)
+00015ef0: 0d0a 2020 2020 2020 2020 7365 6c66 2e6c  ..        self.l
+00015f00: 6162 656c 5f64 622e 5661 6c75 6520 3d20  abel_db.Value = 
+00015f10: 7461 696c 0d0a 2020 2020 2020 2020 7365  tail..        se
+00015f20: 6c66 2e6c 6162 656c 5f70 6174 682e 5661  lf.label_path.Va
+00015f30: 6c75 6520 3d20 7061 7468 0d0a 2020 2020  lue = path..    
+00015f40: 2020 2020 7365 6c66 2e6c 6162 656c 5f73      self.label_s
+00015f50: 697a 652e 5661 6c75 6520 3d20 7365 6c66  ize.Value = self
+00015f60: 2e6c 6162 656c 5f6d 6f64 6966 6965 642e  .label_modified.
+00015f70: 5661 6c75 6520 3d20 2222 0d0a 2020 2020  Value = ""..    
+00015f80: 2020 2020 7365 6c66 2e6c 6162 656c 5f61      self.label_a
+00015f90: 6363 6f75 6e74 2e56 616c 7565 203d 2073  ccount.Value = s
+00015fa0: 656c 662e 6c61 6265 6c5f 6368 6174 732e  elf.label_chats.
+00015fb0: 5661 6c75 6520 3d20 2222 0d0a 2020 2020  Value = ""..    
+00015fc0: 2020 2020 7365 6c66 2e6c 6162 656c 5f6d      self.label_m
+00015fd0: 6573 7361 6765 732e 5661 6c75 6520 3d20  essages.Value = 
+00015fe0: 2222 0d0a 2020 2020 2020 2020 7365 6c66  ""..        self
+00015ff0: 2e6c 6162 656c 5f61 6363 6f75 6e74 2e46  .label_account.F
+00016000: 6f72 6567 726f 756e 6443 6f6c 6f75 7220  oregroundColour 
+00016010: 3d20 7365 6c66 2e46 6f72 6567 726f 756e  = self.Foregroun
+00016020: 6443 6f6c 6f75 720d 0a20 2020 2020 2020  dColour..       
+00016030: 2073 656c 662e 6c61 6265 6c5f 7369 7a65   self.label_size
+00016040: 2e46 6f72 6567 726f 756e 6443 6f6c 6f75  .ForegroundColou
+00016050: 7220 3d20 7365 6c66 2e46 6f72 6567 726f  r = self.Foregro
+00016060: 756e 6443 6f6c 6f75 720d 0a20 2020 2020  undColour..     
+00016070: 2020 2073 656c 662e 6c61 6265 6c5f 6368     self.label_ch
+00016080: 6174 732e 466f 7265 6772 6f75 6e64 436f  ats.ForegroundCo
+00016090: 6c6f 7572 203d 2073 656c 662e 466f 7265  lour = self.Fore
+000160a0: 6772 6f75 6e64 436f 6c6f 7572 0d0a 2020  groundColour..  
+000160b0: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
+000160c0: 662e 7061 6e65 6c5f 6462 5f64 6574 6169  f.panel_db_detai
+000160d0: 6c2e 5368 6f77 6e3a 0d0a 2020 2020 2020  l.Shown:..      
+000160e0: 2020 2020 2020 7365 6c66 2e70 616e 656c        self.panel
+000160f0: 5f64 625f 6d61 696e 2e48 6964 6528 290d  _db_main.Hide().
+00016100: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00016110: 662e 7061 6e65 6c5f 6462 5f64 6574 6169  f.panel_db_detai
+00016120: 6c2e 5368 6f77 2829 0d0a 2020 2020 2020  l.Show()..      
+00016130: 2020 2020 2020 7365 6c66 2e70 616e 656c        self.panel
+00016140: 5f64 625f 6465 7461 696c 2e50 6172 656e  _db_detail.Paren
+00016150: 742e 4c61 796f 7574 2829 0d0a 2020 2020  t.Layout()..    
+00016160: 2020 2020 6966 206f 732e 7061 7468 2e65      if os.path.e
+00016170: 7869 7374 7328 6669 6c65 6e61 6d65 293a  xists(filename):
+00016180: 0d0a 2020 2020 2020 2020 2020 2020 737a  ..            sz
+00016190: 203d 206f 732e 7061 7468 2e67 6574 7369   = os.path.getsi
+000161a0: 7a65 2866 696c 656e 616d 6529 0d0a 2020  ze(filename)..  
+000161b0: 2020 2020 2020 2020 2020 6474 203d 2064            dt = d
+000161c0: 6174 6574 696d 652e 6461 7465 7469 6d65  atetime.datetime
+000161d0: 2e66 726f 6d74 696d 6573 7461 6d70 286f  .fromtimestamp(o
+000161e0: 732e 7061 7468 2e67 6574 6d74 696d 6528  s.path.getmtime(
+000161f0: 6669 6c65 6e61 6d65 2929 0d0a 2020 2020  filename))..    
+00016200: 2020 2020 2020 2020 7365 6c66 2e6c 6162          self.lab
+00016210: 656c 5f73 697a 652e 5661 6c75 6520 3d20  el_size.Value = 
+00016220: 7574 696c 2e66 6f72 6d61 745f 6279 7465  util.format_byte
+00016230: 7328 737a 290d 0a20 2020 2020 2020 2020  s(sz)..         
+00016240: 2020 2073 656c 662e 6c61 6265 6c5f 6d6f     self.label_mo
+00016250: 6469 6669 6564 2e56 616c 7565 203d 2064  dified.Value = d
+00016260: 742e 7374 7266 7469 6d65 2822 2559 2d25  t.strftime("%Y-%
+00016270: 6d2d 2564 2025 483a 254d 3a25 5322 290d  m-%d %H:%M:%S").
+00016280: 0a20 2020 2020 2020 2020 2020 2064 6174  .            dat
+00016290: 6120 3d20 7365 6c66 2e64 625f 6669 6c65  a = self.db_file
+000162a0: 6e61 6d65 735b 6669 6c65 6e61 6d65 5d0d  names[filename].
+000162b0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000162c0: 6461 7461 5b22 7369 7a65 225d 203d 3d20  data["size"] == 
+000162d0: 737a 2061 6e64 2064 6174 615b 226c 6173  sz and data["las
+000162e0: 745f 6d6f 6469 6669 6564 225d 203d 3d20  t_modified"] == 
+000162f0: 6474 205c 0d0a 2020 2020 2020 2020 2020  dt \..          
+00016300: 2020 616e 6420 6461 7461 5b22 6d65 7373    and data["mess
+00016310: 6167 6573 225d 3a0d 0a20 2020 2020 2020  ages"]:..       
+00016320: 2020 2020 2020 2020 2023 2046 696c 6520           # File 
+00016330: 646f 6573 206e 6f74 2073 6565 6d20 6368  does not seem ch
+00016340: 616e 6765 643a 2075 7365 2063 6163 6865  anged: use cache
+00016350: 6420 7661 6c75 6573 0d0a 2020 2020 2020  d values..      
+00016360: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
+00016370: 6162 656c 5f61 6363 6f75 6e74 2e56 616c  abel_account.Val
+00016380: 7565 203d 2064 6174 615b 2261 6363 6f75  ue = data["accou
+00016390: 6e74 225d 0d0a 2020 2020 2020 2020 2020  nt"]..          
+000163a0: 2020 2020 2020 7365 6c66 2e6c 6162 656c        self.label
+000163b0: 5f63 6861 7473 2e56 616c 7565 203d 2064  _chats.Value = d
+000163c0: 6174 615b 2263 6861 7473 225d 0d0a 2020  ata["chats"]..  
+000163d0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+000163e0: 6c66 2e6c 6162 656c 5f6d 6573 7361 6765  lf.label_message
+000163f0: 732e 5661 6c75 6520 3d20 6461 7461 5b22  s.Value = data["
+00016400: 6d65 7373 6167 6573 225d 0d0a 2020 2020  messages"]..    
+00016410: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+00016420: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00016430: 6478 203d 2073 656c 662e 6c69 7374 5f64  dx = self.list_d
+00016440: 622e 4669 6e64 4974 656d 2866 696c 656e  b.FindItem(filen
+00016450: 616d 6529 0d0a 2020 2020 2020 2020 2020  ame)..          
+00016460: 2020 2020 2020 6966 2069 6478 203e 2030        if idx > 0
+00016470: 3a20 7365 6c66 2e6c 6973 745f 6462 2e52  : self.list_db.R
+00016480: 6566 7265 7368 526f 7728 6964 7829 0d0a  efreshRow(idx)..
+00016490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000164a0: 7778 2e43 616c 6c4c 6174 6572 2831 302c  wx.CallLater(10,
+000164b0: 2073 656c 662e 7570 6461 7465 5f64 6174   self.update_dat
+000164c0: 6162 6173 655f 7374 6174 732c 2066 696c  abase_stats, fil
+000164d0: 656e 616d 6529 0d0a 2020 2020 2020 2020  ename)..        
+000164e0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+000164f0: 2020 2073 656c 662e 6c61 6265 6c5f 7369     self.label_si
+00016500: 7a65 2e56 616c 7565 203d 2022 4669 6c65  ze.Value = "File
+00016510: 2064 6f65 7320 6e6f 7420 6578 6973 742e   does not exist.
+00016520: 220d 0a20 2020 2020 2020 2020 2020 2073  "..            s
+00016530: 656c 662e 6c61 6265 6c5f 7369 7a65 2e46  elf.label_size.F
+00016540: 6f72 6567 726f 756e 6443 6f6c 6f75 7220  oregroundColour 
+00016550: 3d20 636f 6e66 2e4c 6162 656c 4572 726f  = conf.LabelErro
+00016560: 7243 6f6c 6f75 720d 0a0d 0a0d 0a20 2020  rColour......   
+00016570: 2064 6566 206f 6e5f 7365 6c65 6374 5f6c   def on_select_l
+00016580: 6973 745f 6462 2873 656c 662c 2065 7665  ist_db(self, eve
+00016590: 6e74 293a 0d0a 2020 2020 2020 2020 2222  nt):..        ""
+000165a0: 2248 616e 646c 6572 2066 6f72 2073 656c  "Handler for sel
+000165b0: 6563 7469 6e67 2061 6e20 6974 656d 2069  ecting an item i
+000165c0: 6e20 6d61 696e 206c 6973 742c 2075 7064  n main list, upd
+000165d0: 6174 6573 2069 6e66 6f20 7061 6e65 6c2e  ates info panel.
+000165e0: 2222 220d 0a20 2020 2020 2020 2066 696c  """..        fil
+000165f0: 656e 616d 6520 3d20 7365 6c66 2e6c 6973  ename = self.lis
+00016600: 745f 6462 2e47 6574 4974 656d 5465 7874  t_db.GetItemText
+00016610: 2865 7665 6e74 2e47 6574 496e 6465 7828  (event.GetIndex(
+00016620: 2929 0d0a 2020 2020 2020 2020 6966 2065  ))..        if e
+00016630: 7665 6e74 2e47 6574 496e 6465 7828 2920  vent.GetIndex() 
+00016640: 3e20 3020 5c0d 0a20 2020 2020 2020 2061  > 0 \..        a
+00016650: 6e64 2066 696c 656e 616d 6520 213d 2073  nd filename != s
+00016660: 656c 662e 6462 5f66 696c 656e 616d 653a  elf.db_filename:
+00016670: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00016680: 6c66 2e64 625f 6669 6c65 6e61 6d65 203d  lf.db_filename =
+00016690: 2066 696c 656e 616d 650d 0a20 2020 2020   filename..     
+000166a0: 2020 2020 2020 2073 656c 662e 7570 6461         self.upda
+000166b0: 7465 5f64 6174 6162 6173 655f 6465 7461  te_database_deta
+000166c0: 696c 2829 0d0a 2020 2020 2020 2020 656c  il()..        el
+000166d0: 6966 2065 7665 6e74 2e47 6574 496e 6465  if event.GetInde
+000166e0: 7828 2920 3d3d 2030 2061 6e64 206e 6f74  x() == 0 and not
+000166f0: 2073 656c 662e 7061 6e65 6c5f 6462 5f6d   self.panel_db_m
+00016700: 6169 6e2e 5368 6f77 6e3a 0d0a 2020 2020  ain.Shown:..    
+00016710: 2020 2020 2020 2020 7365 6c66 2e64 625f          self.db_
+00016720: 6669 6c65 6e61 6d65 203d 204e 6f6e 650d  filename = None.
+00016730: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00016740: 662e 7061 6e65 6c5f 6462 5f6d 6169 6e2e  f.panel_db_main.
+00016750: 5368 6f77 2829 0d0a 2020 2020 2020 2020  Show()..        
+00016760: 2020 2020 7365 6c66 2e70 616e 656c 5f64      self.panel_d
+00016770: 625f 6465 7461 696c 2e48 6964 6528 290d  b_detail.Hide().
+00016780: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00016790: 662e 7061 6e65 6c5f 6462 5f6d 6169 6e2e  f.panel_db_main.
+000167a0: 5061 7265 6e74 2e4c 6179 6f75 7428 290d  Parent.Layout().
+000167b0: 0a20 2020 2020 2020 2023 2053 6176 6520  .        # Save 
+000167c0: 6c61 7374 2073 656c 6563 7465 6420 6669  last selected fi
+000167d0: 6c65 7320 696e 2064 6220 6c69 7374 732c  les in db lists,
+000167e0: 2074 6f20 7265 7365 6c65 6374 2074 6865   to reselect the
+000167f0: 6d20 6f6e 2072 6572 756e 0d0a 2020 2020  m on rerun..    
+00016800: 2020 2020 6465 6c20 636f 6e66 2e4c 6173      del conf.Las
+00016810: 7453 656c 6563 7465 6446 696c 6573 5b3a  tSelectedFiles[:
+00016820: 5d0d 0a20 2020 2020 2020 2073 656c 6563  ]..        selec
+00016830: 7465 6420 3d20 7365 6c66 2e6c 6973 745f  ted = self.list_
+00016840: 6462 2e47 6574 4669 7273 7453 656c 6563  db.GetFirstSelec
+00016850: 7465 6428 290d 0a20 2020 2020 2020 2077  ted()..        w
+00016860: 6869 6c65 2073 656c 6563 7465 6420 3e20  hile selected > 
+00016870: 303a 0d0a 2020 2020 2020 2020 2020 2020  0:..            
+00016880: 6669 6c65 6e61 6d65 203d 2073 656c 662e  filename = self.
+00016890: 6c69 7374 5f64 622e 4765 7449 7465 6d54  list_db.GetItemT
+000168a0: 6578 7428 7365 6c65 6374 6564 290d 0a20  ext(selected).. 
+000168b0: 2020 2020 2020 2020 2020 2063 6f6e 662e             conf.
+000168c0: 4c61 7374 5365 6c65 6374 6564 4669 6c65  LastSelectedFile
+000168d0: 732e 6170 7065 6e64 2866 696c 656e 616d  s.append(filenam
+000168e0: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+000168f0: 7365 6c65 6374 6564 203d 2073 656c 662e  selected = self.
+00016900: 6c69 7374 5f64 622e 4765 744e 6578 7453  list_db.GetNextS
+00016910: 656c 6563 7465 6428 7365 6c65 6374 6564  elected(selected
+00016920: 290d 0a20 2020 2020 2020 2075 7469 6c2e  )..        util.
+00016930: 7275 6e5f 6f6e 6365 2863 6f6e 662e 7361  run_once(conf.sa
+00016940: 7665 290d 0a0d 0a0d 0a20 2020 2064 6566  ve)......    def
+00016950: 206f 6e5f 6578 6974 2873 656c 662c 2065   on_exit(self, e
+00016960: 7665 6e74 293a 0d0a 2020 2020 2020 2020  vent):..        
+00016970: 2222 220d 0a20 2020 2020 2020 2048 616e  """..        Han
+00016980: 646c 6572 206f 6e20 6170 706c 6963 6174  dler on applicat
+00016990: 696f 6e20 6578 6974 2c20 6173 6b73 2061  ion exit, asks a
+000169a0: 626f 7574 2075 6e73 6176 6564 2063 6861  bout unsaved cha
+000169b0: 6e67 6573 2c20 6966 2061 6e79 2e0d 0a20  nges, if any... 
+000169c0: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
+000169d0: 2020 2020 6966 206e 6f74 2073 656c 663a      if not self:
+000169e0: 2072 6574 7572 6e0d 0a20 2020 2020 2020   return..       
+000169f0: 2064 6f5f 6578 6974 203d 2054 7275 650d   do_exit = True.
+00016a00: 0a20 2020 2020 2020 2075 6e73 6176 6564  .        unsaved
+00016a10: 5f70 6167 6573 203d 207b 7d20 2320 7b44  _pages = {} # {D
+00016a20: 6174 6162 6173 6550 6167 653a 2066 696c  atabasePage: fil
+00016a30: 656e 616d 652c 207d 0d0a 2020 2020 2020  ename, }..      
+00016a40: 2020 7379 6e63 696e 675f 7061 6765 7320    syncing_pages 
+00016a50: 3d20 7b7d 2023 207b 4461 7461 6261 7365  = {} # {Database
+00016a60: 5061 6765 3a20 6669 6c65 6e61 6d65 2c20  Page: filename, 
+00016a70: 7d0d 0a20 2020 2020 2020 206d 6572 6769  }..        mergi
+00016a80: 6e67 5f70 6167 6573 203d 205b 5d20 2320  ng_pages = [] # 
+00016a90: 5b4d 6572 6765 7250 6167 6520 7469 746c  [MergerPage titl
+00016aa0: 652c 205d 0d0a 0d0a 2020 2020 2020 2020  e, ]....        
+00016ab0: 6966 2061 6e79 2878 2e69 735f 616c 6976  if any(x.is_aliv
+00016ac0: 6528 2920 666f 7220 7820 696e 2073 656c  e() for x in sel
+00016ad0: 662e 776f 726b 6572 735f 696d 706f 7274  f.workers_import
+00016ae0: 2e76 616c 7565 7328 2929 3a0d 0a20 2020  .values()):..   
+00016af0: 2020 2020 2020 2020 2069 6620 7778 2e4f           if wx.O
+00016b00: 4b20 213d 2077 782e 4d65 7373 6167 6542  K != wx.MessageB
+00016b10: 6f78 280d 0a20 2020 2020 2020 2020 2020  ox(..           
+00016b20: 2020 2020 2022 496d 706f 7274 2069 7320       "Import is 
+00016b30: 6375 7272 656e 746c 7920 696e 2070 726f  currently in pro
+00016b40: 6772 6573 732e 5c6e 5c6e 4578 6974 2061  gress.\n\nExit a
+00016b50: 6e79 7761 793f 222c 0d0a 2020 2020 2020  nyway?",..      
+00016b60: 2020 2020 2020 2020 2020 636f 6e66 2e54            conf.T
+00016b70: 6974 6c65 2c20 7778 2e4f 4b20 7c20 7778  itle, wx.OK | wx
+00016b80: 2e43 414e 4345 4c20 7c20 7778 2e49 434f  .CANCEL | wx.ICO
+00016b90: 4e5f 5741 524e 494e 470d 0a20 2020 2020  N_WARNING..     
+00016ba0: 2020 2020 2020 2029 3a20 646f 5f65 7869         ): do_exi
+00016bb0: 7420 3d20 4661 6c73 650d 0a0d 0a20 2020  t = False....   
+00016bc0: 2020 2020 2066 6f72 2070 6167 652c 2064       for page, d
+00016bd0: 6220 696e 2073 656c 662e 6462 5f70 6167  b in self.db_pag
+00016be0: 6573 2e69 7465 6d73 2829 2069 6620 646f  es.items() if do
+00016bf0: 5f65 7869 7420 656c 7365 2028 293a 0d0a  _exit else ():..
+00016c00: 2020 2020 2020 2020 2020 2020 6966 2070              if p
+00016c10: 6167 6520 616e 6420 6462 2e6c 6976 652e  age and db.live.
+00016c20: 6973 5f6c 6f67 6765 645f 696e 2829 2061  is_logged_in() a
+00016c30: 6e64 2070 6167 652e 776f 726b 6572 5f6c  nd page.worker_l
+00016c40: 6976 652e 6973 5f77 6f72 6b69 6e67 2829  ive.is_working()
+00016c50: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00016c60: 2020 2073 796e 6369 6e67 5f70 6167 6573     syncing_pages
+00016c70: 5b70 6167 655d 203d 2064 622e 6669 6c65  [page] = db.file
+00016c80: 6e61 6d65 0d0a 2020 2020 2020 2020 6966  name..        if
+00016c90: 2073 796e 6369 6e67 5f70 6167 6573 3a0d   syncing_pages:.
+00016ca0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00016cb0: 7778 2e4f 4b20 213d 2077 782e 4d65 7373  wx.OK != wx.Mess
+00016cc0: 6167 6542 6f78 280d 0a20 2020 2020 2020  ageBox(..       
+00016cd0: 2020 2020 2020 2020 2022 4c69 7665 2073           "Live s
+00016ce0: 796e 6369 6e67 2069 7320 6375 7272 656e  yncing is curren
+00016cf0: 746c 7920 696e 2070 726f 6772 6573 7320  tly in progress 
+00016d00: 696e 2025 732e 5c6e 5c6e 4578 6974 2061  in %s.\n\nExit a
+00016d10: 6e79 7761 793f 2220 250d 0a20 2020 2020  nyway?" %..     
+00016d20: 2020 2020 2020 2020 2020 2022 5c6e 222e             "\n".
+00016d30: 6a6f 696e 2874 6578 7477 7261 702e 7772  join(textwrap.wr
+00016d40: 6170 2822 2c20 222e 6a6f 696e 2873 796e  ap(", ".join(syn
+00016d50: 6369 6e67 5f70 6167 6573 2e76 616c 7565  cing_pages.value
+00016d60: 7328 2929 2929 2c0d 0a20 2020 2020 2020  s()))),..       
+00016d70: 2020 2020 2020 2020 2063 6f6e 662e 5469           conf.Ti
+00016d80: 746c 652c 2077 782e 4f4b 207c 2077 782e  tle, wx.OK | wx.
+00016d90: 4341 4e43 454c 207c 2077 782e 4943 4f4e  CANCEL | wx.ICON
+00016da0: 5f57 4152 4e49 4e47 0d0a 2020 2020 2020  _WARNING..      
+00016db0: 2020 2020 2020 293a 2064 6f5f 6578 6974        ): do_exit
+00016dc0: 203d 2046 616c 7365 0d0a 0d0a 2020 2020   = False....    
+00016dd0: 2020 2020 666f 7220 7061 6765 2c20 6462      for page, db
+00016de0: 2069 6e20 7365 6c66 2e64 625f 7061 6765   in self.db_page
+00016df0: 732e 6974 656d 7328 2920 6966 2064 6f5f  s.items() if do_
+00016e00: 6578 6974 2065 6c73 6520 2829 3a0d 0a20  exit else ():.. 
+00016e10: 2020 2020 2020 2020 2020 2069 6620 7061             if pa
+00016e20: 6765 2061 6e64 2070 6167 652e 6765 745f  ge and page.get_
+00016e30: 756e 7361 7665 645f 6772 6964 7328 293a  unsaved_grids():
+00016e40: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00016e50: 2020 756e 7361 7665 645f 7061 6765 735b    unsaved_pages[
+00016e60: 7061 6765 5d20 3d20 6462 2e66 696c 656e  page] = db.filen
+00016e70: 616d 650d 0a20 2020 2020 2020 2069 6620  ame..        if 
+00016e80: 756e 7361 7665 645f 7061 6765 733a 0d0a  unsaved_pages:..
+00016e90: 2020 2020 2020 2020 2020 2020 7265 7370              resp
+00016ea0: 6f6e 7365 203d 2077 782e 4d65 7373 6167  onse = wx.Messag
+00016eb0: 6542 6f78 280d 0a20 2020 2020 2020 2020  eBox(..         
+00016ec0: 2020 2020 2020 2022 5468 6572 6520 6172         "There ar
+00016ed0: 6520 756e 7361 7665 6420 6368 616e 6765  e unsaved change
+00016ee0: 7320 696e 2064 6174 6120 6772 6964 735c  s in data grids\
+00016ef0: 6e28 2573 292e 5c6e 5c6e 220d 0a20 2020  n(%s).\n\n"..   
+00016f00: 2020 2020 2020 2020 2020 2020 2022 5361               "Sa
+00016f10: 7665 2063 6861 6e67 6573 2062 6566 6f72  ve changes befor
+00016f20: 6520 636c 6f73 696e 673f 2220 250d 0a20  e closing?" %.. 
+00016f30: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00016f40: 5c6e 222e 6a6f 696e 2874 6578 7477 7261  \n".join(textwra
+00016f50: 702e 7772 6170 2822 2c20 222e 6a6f 696e  p.wrap(", ".join
+00016f60: 2875 6e73 6176 6564 5f70 6167 6573 2e76  (unsaved_pages.v
+00016f70: 616c 7565 7328 2929 2929 2c0d 0a20 2020  alues()))),..   
+00016f80: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+00016f90: 662e 5469 746c 652c 2077 782e 5945 5320  f.Title, wx.YES 
+00016fa0: 7c20 7778 2e4e 4f20 7c20 7778 2e43 414e  | wx.NO | wx.CAN
+00016fb0: 4345 4c20 7c20 7778 2e49 434f 4e5f 494e  CEL | wx.ICON_IN
+00016fc0: 464f 524d 4154 494f 4e0d 0a20 2020 2020  FORMATION..     
+00016fd0: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
+00016fe0: 2020 2020 2020 646f 5f65 7869 7420 3d20        do_exit = 
+00016ff0: 2877 782e 4341 4e43 454c 2021 3d20 7265  (wx.CANCEL != re
+00017000: 7370 6f6e 7365 290d 0a20 2020 2020 2020  sponse)..       
+00017010: 2020 2020 2069 6620 7778 2e59 4553 203d       if wx.YES =
+00017020: 3d20 7265 7370 6f6e 7365 3a0d 0a20 2020  = response:..   
+00017030: 2020 2020 2020 2020 2020 2020 2064 6f5f               do_
+00017040: 6578 6974 203d 2061 6c6c 2870 2e73 6176  exit = all(p.sav
+00017050: 655f 756e 7361 7665 645f 6772 6964 7328  e_unsaved_grids(
+00017060: 2920 666f 7220 7020 696e 2075 6e73 6176  ) for p in unsav
+00017070: 6564 5f70 6167 6573 290d 0a20 2020 2020  ed_pages)..     
+00017080: 2020 2069 6620 646f 5f65 7869 743a 0d0a     if do_exit:..
+00017090: 2020 2020 2020 2020 2020 2020 6d65 7267              merg
+000170a0: 696e 675f 7061 6765 7320 3d20 5b78 2e74  ing_pages = [x.t
+000170b0: 6974 6c65 2066 6f72 2078 2069 6e20 7365  itle for x in se
+000170c0: 6c66 2e6d 6572 6765 725f 7061 6765 730d  lf.merger_pages.
+000170d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000170e0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000170f0: 2078 2e69 735f 6d65 7267 696e 6720 616e   x.is_merging an
+00017100: 6420 782e 7469 746c 655d 0d0a 2020 2020  d x.title]..    
+00017110: 2020 2020 6966 206d 6572 6769 6e67 5f70      if merging_p
+00017120: 6167 6573 3a0d 0a20 2020 2020 2020 2020  ages:..         
+00017130: 2020 2072 6573 706f 6e73 6520 3d20 7778     response = wx
+00017140: 2e4d 6573 7361 6765 426f 7828 0d0a 2020  .MessageBox(..  
+00017150: 2020 2020 2020 2020 2020 2020 2020 224d                "M
+00017160: 6572 6769 6e67 2069 7320 6375 7272 656e  erging is curren
+00017170: 746c 7920 696e 2070 726f 6772 6573 7320  tly in progress 
+00017180: 696e 2025 732e 5c6e 5c6e 4578 6974 2061  in %s.\n\nExit a
+00017190: 6e79 7761 793f 2022 0d0a 2020 2020 2020  nyway? "..      
+000171a0: 2020 2020 2020 2020 2020 2254 6869 7320            "This 
+000171b0: 6361 6e20 7265 7375 6c74 2069 6e20 636f  can result in co
+000171c0: 7272 7570 7420 6461 7461 2e22 2025 0d0a  rrupt data." %..
 000171d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000171e0: 2020 2063 6f6e 662e 4c61 7374 4163 7469     conf.LastActi
-000171f0: 7665 5061 6765 5b70 6167 652e 6462 2e66  vePage[page.db.f
-00017200: 696c 656e 616d 655d 203d 2061 6374 6976  ilename] = activ
-00017210: 655f 6964 780d 0a20 2020 2020 2020 2020  e_idx..         
-00017220: 2020 2020 2020 2065 6c69 6620 7061 6765         elif page
-00017230: 2e64 622e 6669 6c65 6e61 6d65 2069 6e20  .db.filename in 
-00017240: 636f 6e66 2e4c 6173 7441 6374 6976 6550  conf.LastActiveP
-00017250: 6167 653a 0d0a 2020 2020 2020 2020 2020  age:..          
-00017260: 2020 2020 2020 2020 2020 6465 6c20 636f            del co
-00017270: 6e66 2e4c 6173 7441 6374 6976 6550 6167  nf.LastActivePag
-00017280: 655b 7061 6765 2e64 622e 6669 6c65 6e61  e[page.db.filena
-00017290: 6d65 5d0d 0a20 2020 2020 2020 2020 2020  me]..           
-000172a0: 2020 2020 2070 6167 652e 7361 7665 5f70       page.save_p
-000172b0: 6167 655f 636f 6e66 2829 0d0a 2020 2020  age_conf()..    
-000172c0: 2020 2020 2020 2020 2020 2020 7061 6765              page
-000172d0: 2e77 6f72 6b65 725f 6c69 7665 2e73 746f  .worker_live.sto
-000172e0: 7028 290d 0a20 2020 2020 2020 2020 2020  p()..           
-000172f0: 2020 2020 2066 6f72 2077 6f72 6b65 7220       for worker 
-00017300: 696e 2070 6167 652e 776f 726b 6572 735f  in page.workers_
-00017310: 7365 6172 6368 2e76 616c 7565 7328 293a  search.values():
-00017320: 2077 6f72 6b65 722e 7374 6f70 2829 0d0a   worker.stop()..
-00017330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017340: 7061 6765 2e64 622e 636c 6f73 6528 290d  page.db.close().
-00017350: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00017360: 2070 6167 6520 696e 2073 656c 662e 6d65   page in self.me
-00017370: 7267 6572 5f70 6167 6573 3a0d 0a20 2020  rger_pages:..   
-00017380: 2020 2020 2020 2020 2020 2020 2070 6167               pag
-00017390: 652e 776f 726b 6572 5f6d 6572 6765 2e73  e.worker_merge.s
-000173a0: 746f 7028 292c 2070 6167 652e 776f 726b  top(), page.work
-000173b0: 6572 5f69 6d70 6f72 742e 7374 6f70 2829  er_import.stop()
-000173c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000173d0: 2020 7061 6765 2e64 6231 2e63 6c6f 7365    page.db1.close
-000173e0: 2829 2c20 7061 6765 2e64 6232 2e63 6c6f  (), page.db2.clo
-000173f0: 7365 2829 0d0a 2020 2020 2020 2020 2020  se()..          
-00017400: 2020 7365 6c66 2e77 6f72 6b65 725f 6465    self.worker_de
-00017410: 7465 6374 696f 6e2e 7374 6f70 2829 0d0a  tection.stop()..
-00017420: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-00017430: 5361 7665 206c 6173 7420 7365 6c65 6374  Save last select
-00017440: 6564 2066 696c 6573 2069 6e20 6462 206c  ed files in db l
-00017450: 6973 7473 2c20 746f 2072 6573 656c 6563  ists, to reselec
-00017460: 7420 7468 656d 206f 6e20 7265 7275 6e0d  t them on rerun.
-00017470: 0a20 2020 2020 2020 2020 2020 2064 656c  .            del
-00017480: 2063 6f6e 662e 4c61 7374 5365 6c65 6374   conf.LastSelect
-00017490: 6564 4669 6c65 735b 3a5d 0d0a 2020 2020  edFiles[:]..    
-000174a0: 2020 2020 2020 2020 7365 6c65 6374 6564          selected
-000174b0: 203d 2073 656c 662e 6c69 7374 5f64 622e   = self.list_db.
-000174c0: 4765 7446 6972 7374 5365 6c65 6374 6564  GetFirstSelected
-000174d0: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
-000174e0: 7768 696c 6520 7365 6c65 6374 6564 203e  while selected >
-000174f0: 2030 3a0d 0a20 2020 2020 2020 2020 2020   0:..           
-00017500: 2020 2020 2066 696c 656e 616d 6520 3d20       filename = 
-00017510: 7365 6c66 2e6c 6973 745f 6462 2e47 6574  self.list_db.Get
-00017520: 4974 656d 5465 7874 2873 656c 6563 7465  ItemText(selecte
-00017530: 6429 0d0a 2020 2020 2020 2020 2020 2020  d)..            
-00017540: 2020 2020 636f 6e66 2e4c 6173 7453 656c      conf.LastSel
-00017550: 6563 7465 6446 696c 6573 2e61 7070 656e  ectedFiles.appen
-00017560: 6428 6669 6c65 6e61 6d65 290d 0a20 2020  d(filename)..   
-00017570: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00017580: 6563 7465 6420 3d20 7365 6c66 2e6c 6973  ected = self.lis
-00017590: 745f 6462 2e47 6574 4e65 7874 5365 6c65  t_db.GetNextSele
-000175a0: 6374 6564 2873 656c 6563 7465 6429 0d0a  cted(selected)..
-000175b0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-000175c0: 6f74 2063 6f6e 662e 5769 6e64 6f77 4963  ot conf.WindowIc
-000175d0: 6f6e 697a 6564 3a0d 0a20 2020 2020 2020  onized:..       
-000175e0: 2020 2020 2020 2020 2063 6f6e 662e 5769           conf.Wi
-000175f0: 6e64 6f77 506f 7369 7469 6f6e 203d 2073  ndowPosition = s
-00017600: 656c 662e 506f 7369 7469 6f6e 5b3a 5d0d  elf.Position[:].
-00017610: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
-00017620: 662e 5769 6e64 6f77 5369 7a65 203d 205b  f.WindowSize = [
-00017630: 2d31 2c20 2d31 5d20 6966 2073 656c 662e  -1, -1] if self.
-00017640: 4973 4d61 7869 6d69 7a65 6428 2920 656c  IsMaximized() el
-00017650: 7365 2073 656c 662e 5369 7a65 5b3a 5d0d  se self.Size[:].
-00017660: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
-00017670: 662e 7361 7665 2829 0d0a 2020 2020 2020  f.save()..      
-00017680: 2020 2020 2020 7472 793a 2073 656c 662e        try: self.
-00017690: 7472 6179 6963 6f6e 2e44 6573 7472 6f79  trayicon.Destroy
-000176a0: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
-000176b0: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
-000176c0: 3a20 7061 7373 0d0a 2020 2020 2020 2020  : pass..        
-000176d0: 2020 2020 666f 7220 7820 696e 2073 656c      for x in sel
-000176e0: 662e 776f 726b 6572 735f 696d 706f 7274  f.workers_import
-000176f0: 2e76 616c 7565 7328 293a 2078 2e6a 6f69  .values(): x.joi
-00017700: 6e28 290d 0a20 2020 2020 2020 2020 2020  n()..           
-00017710: 2073 7973 2e65 7869 7428 290d 0a0d 0a0d   sys.exit().....
-00017720: 0a20 2020 2064 6566 206f 6e5f 636c 6f73  .    def on_clos
-00017730: 655f 7061 6765 2873 656c 662c 2065 7665  e_page(self, eve
-00017740: 6e74 293a 0d0a 2020 2020 2020 2020 2222  nt):..        ""
-00017750: 220d 0a20 2020 2020 2020 2048 616e 646c  "..        Handl
-00017760: 6572 2066 6f72 2063 6c6f 7369 6e67 2061  er for closing a
-00017770: 2070 6167 652c 2061 736b 7320 7468 6520   page, asks the 
-00017780: 7573 6572 2061 626f 7574 2073 6176 696e  user about savin
-00017790: 6720 756e 7361 7665 6420 6461 7461 2c0d  g unsaved data,.
-000177a0: 0a20 2020 2020 2020 2069 6620 616e 792c  .        if any,
-000177b0: 2072 656d 6f76 6573 2070 6167 6520 6672   removes page fr
-000177c0: 6f6d 206d 6169 6e20 6e6f 7465 626f 6f6b  om main notebook
-000177d0: 2061 6e64 2075 7064 6174 6573 2061 6363   and updates acc
-000177e0: 656c 6572 6174 6f72 732e 0d0a 2020 2020  elerators...    
-000177f0: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
-00017800: 2069 6620 6576 656e 742e 4576 656e 744f   if event.EventO
-00017810: 626a 6563 7420 3d3d 2073 656c 662e 6e6f  bject == self.no
-00017820: 7465 626f 6f6b 3a0d 0a20 2020 2020 2020  tebook:..       
-00017830: 2020 2020 2070 6167 6520 3d20 7365 6c66       page = self
-00017840: 2e6e 6f74 6562 6f6f 6b2e 4765 7450 6167  .notebook.GetPag
-00017850: 6528 6576 656e 742e 4765 7453 656c 6563  e(event.GetSelec
-00017860: 7469 6f6e 2829 290d 0a20 2020 2020 2020  tion())..       
-00017870: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-00017880: 2020 2020 7061 6765 203d 2065 7665 6e74      page = event
-00017890: 2e45 7665 6e74 4f62 6a65 6374 0d0a 2020  .EventObject..  
-000178a0: 2020 2020 2020 2020 2020 7061 6765 2e53            page.S
-000178b0: 686f 7728 4661 6c73 6529 0d0a 2020 2020  how(False)..    
-000178c0: 2020 2020 6966 2073 656c 662e 7061 6765      if self.page
-000178d0: 5f6c 6f67 203d 3d20 7061 6765 3a0d 0a20  _log == page:.. 
-000178e0: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-000178f0: 7420 7365 6c66 2e70 6167 655f 6c6f 672e  t self.page_log.
-00017900: 6973 5f68 6964 6465 6e3a 0d0a 2020 2020  is_hidden:..    
-00017910: 2020 2020 2020 2020 2020 2020 6576 656e              even
-00017920: 742e 5665 746f 2829 2023 2056 6574 6f20  t.Veto() # Veto 
-00017930: 6465 6c65 7465 2065 7665 6e74 0d0a 2020  delete event..  
-00017940: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00017950: 6c66 2e6f 6e5f 7368 6f77 6869 6465 5f6c  lf.on_showhide_l
-00017960: 6f67 284e 6f6e 6529 2023 2046 6972 6520  og(None) # Fire 
-00017970: 7265 6d6f 7665 2065 7665 6e74 0d0a 2020  remove event..  
-00017980: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
-00017990: 6167 6573 5f76 6973 6974 6564 203d 205b  ages_visited = [
-000179a0: 7820 666f 7220 7820 696e 2073 656c 662e  x for x in self.
-000179b0: 7061 6765 735f 7669 7369 7465 6420 6966  pages_visited if
-000179c0: 2078 2021 3d20 7061 6765 5d0d 0a20 2020   x != page]..   
-000179d0: 2020 2020 2020 2020 2073 656c 662e 7061           self.pa
-000179e0: 6765 5f6c 6f67 2e53 686f 7728 4661 6c73  ge_log.Show(Fals
-000179f0: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
-00017a00: 7265 7475 726e 0d0a 2020 2020 2020 2020  return..        
-00017a10: 656c 6966 2028 6e6f 7420 6973 696e 7374  elif (not isinst
-00017a20: 616e 6365 2870 6167 652c 2028 4461 7461  ance(page, (Data
-00017a30: 6261 7365 5061 6765 2c20 4d65 7267 6572  basePage, Merger
-00017a40: 5061 6765 2929 0d0a 2020 2020 2020 2020  Page))..        
-00017a50: 6f72 206e 6f74 2070 6167 652e 7265 6164  or not page.read
-00017a60: 795f 746f 5f63 6c6f 7365 293a 0d0a 2020  y_to_close):..  
-00017a70: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00017a80: 2065 7665 6e74 2e56 6574 6f28 290d 0a0d   event.Veto()...
-00017a90: 0a20 2020 2020 2020 2023 2052 656d 6f76  .        # Remov
-00017aa0: 6520 7061 6765 2066 726f 6d20 4d61 696e  e page from Main
-00017ab0: 5769 6e64 6f77 2064 6174 6120 7374 7275  Window data stru
-00017ac0: 6374 7572 6573 0d0a 2020 2020 2020 2020  ctures..        
-00017ad0: 6966 2069 7369 6e73 7461 6e63 6528 7061  if isinstance(pa
-00017ae0: 6765 2c20 4461 7461 6261 7365 5061 6765  ge, DatabasePage
-00017af0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00017b00: 646f 5f63 6c6f 7365 203d 2054 7275 650d  do_close = True.
-00017b10: 0a0d 0a20 2020 2020 2020 2020 2020 2069  ...            i
-00017b20: 6620 7061 6765 2e64 622e 6c69 7665 2e69  f page.db.live.i
-00017b30: 735f 6c6f 6767 6564 5f69 6e28 2920 616e  s_logged_in() an
-00017b40: 6420 7061 6765 2e77 6f72 6b65 725f 6c69  d page.worker_li
-00017b50: 7665 2e69 735f 776f 726b 696e 6728 293a  ve.is_working():
-00017b60: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00017b70: 2020 6966 2077 782e 4f4b 2021 3d20 7778    if wx.OK != wx
-00017b80: 2e4d 6573 7361 6765 426f 7828 0d0a 2020  .MessageBox(..  
-00017b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017ba0: 2020 224c 6976 6520 7379 6e63 696e 6720    "Live syncing 
-00017bb0: 6973 2063 7572 7265 6e74 6c79 2069 6e20  is currently in 
-00017bc0: 7072 6f67 7265 7373 2e5c 6e5c 6e43 6c6f  progress.\n\nClo
-00017bd0: 7365 2061 6e79 7761 793f 222c 0d0a 2020  se anyway?",..  
-00017be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017bf0: 2020 636f 6e66 2e54 6974 6c65 2c20 7778    conf.Title, wx
-00017c00: 2e4f 4b20 7c20 7778 2e43 414e 4345 4c20  .OK | wx.CANCEL 
-00017c10: 7c20 7778 2e49 434f 4e5f 5741 524e 494e  | wx.ICON_WARNIN
-00017c20: 470d 0a20 2020 2020 2020 2020 2020 2020  G..             
-00017c30: 2020 2029 3a20 646f 5f63 6c6f 7365 203d     ): do_close =
-00017c40: 2046 616c 7365 0d0a 0d0a 2020 2020 2020   False....      
-00017c50: 2020 2020 2020 756e 7361 7665 6420 3d20        unsaved = 
-00017c60: 7061 6765 2e67 6574 5f75 6e73 6176 6564  page.get_unsaved
-00017c70: 5f67 7269 6473 2829 2069 6620 646f 5f63  _grids() if do_c
-00017c80: 6c6f 7365 2065 6c73 6520 5b5d 0d0a 2020  lose else []..  
-00017c90: 2020 2020 2020 2020 2020 6966 2075 6e73            if uns
-00017ca0: 6176 6564 3a0d 0a20 2020 2020 2020 2020  aved:..         
-00017cb0: 2020 2020 2020 2072 6573 706f 6e73 6520         response 
-00017cc0: 3d20 7778 2e4d 6573 7361 6765 426f 7828  = wx.MessageBox(
-00017cd0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00017ce0: 2020 2020 2020 2253 6f6d 6520 7461 626c        "Some tabl
-00017cf0: 6573 2069 6e20 2573 2068 6176 6520 756e  es in %s have un
-00017d00: 7361 7665 6420 6461 7461 2028 2573 292e  saved data (%s).
-00017d10: 5c6e 5c6e 220d 0a20 2020 2020 2020 2020  \n\n"..         
-00017d20: 2020 2020 2020 2020 2020 2022 5361 7665             "Save
-00017d30: 2063 6861 6e67 6573 2062 6566 6f72 6520   changes before 
-00017d40: 636c 6f73 696e 673f 2220 2520 280d 0a20  closing?" % (.. 
-00017d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017d60: 2020 2020 2020 2070 6167 652e 6462 2c20         page.db, 
-00017d70: 222c 2022 2e6a 6f69 6e28 736f 7274 6564  ", ".join(sorted
-00017d80: 2878 2e74 6162 6c65 2066 6f72 2078 2069  (x.table for x i
-00017d90: 6e20 756e 7361 7665 6429 290d 0a20 2020  n unsaved))..   
-00017da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017db0: 2029 2c20 636f 6e66 2e54 6974 6c65 2c0d   ), conf.Title,.
-00017dc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017dd0: 2020 2020 2077 782e 5945 5320 7c20 7778       wx.YES | wx
-00017de0: 2e4e 4f20 7c20 7778 2e43 414e 4345 4c20  .NO | wx.CANCEL 
-00017df0: 7c20 7778 2e49 434f 4e5f 494e 464f 524d  | wx.ICON_INFORM
-00017e00: 4154 494f 4e0d 0a20 2020 2020 2020 2020  ATION..         
-00017e10: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
-00017e20: 2020 2020 2020 2020 2020 6966 2077 782e            if wx.
-00017e30: 5945 5320 3d3d 2072 6573 706f 6e73 653a  YES == response:
-00017e40: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00017e50: 2020 2020 2020 646f 5f63 6c6f 7365 203d        do_close =
-00017e60: 2070 6167 652e 7361 7665 5f75 6e73 6176   page.save_unsav
-00017e70: 6564 5f67 7269 6473 2829 0d0a 2020 2020  ed_grids()..    
-00017e80: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-00017e90: 2077 782e 4341 4e43 454c 203d 3d20 7265   wx.CANCEL == re
-00017ea0: 7370 6f6e 7365 3a0d 0a20 2020 2020 2020  sponse:..       
-00017eb0: 2020 2020 2020 2020 2020 2020 2064 6f5f               do_
-00017ec0: 636c 6f73 6520 3d20 4661 6c73 650d 0a20  close = False.. 
-00017ed0: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-00017ee0: 7420 646f 5f63 6c6f 7365 3a0d 0a20 2020  t do_close:..   
-00017ef0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-00017f00: 7572 6e20 6576 656e 742e 5665 746f 2829  urn event.Veto()
-00017f10: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-00017f20: 6966 2070 6167 652e 6e6f 7465 626f 6f6b  if page.notebook
-00017f30: 2e53 656c 6563 7469 6f6e 3a0d 0a20 2020  .Selection:..   
-00017f40: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-00017f50: 662e 4c61 7374 4163 7469 7665 5061 6765  f.LastActivePage
-00017f60: 5b70 6167 652e 6462 2e66 696c 656e 616d  [page.db.filenam
-00017f70: 655d 203d 2070 6167 652e 6e6f 7465 626f  e] = page.notebo
-00017f80: 6f6b 2e53 656c 6563 7469 6f6e 0d0a 2020  ok.Selection..  
-00017f90: 2020 2020 2020 2020 2020 656c 6966 2070            elif p
-00017fa0: 6167 652e 6462 2e66 696c 656e 616d 6520  age.db.filename 
-00017fb0: 696e 2063 6f6e 662e 4c61 7374 4163 7469  in conf.LastActi
-00017fc0: 7665 5061 6765 3a0d 0a20 2020 2020 2020  vePage:..       
-00017fd0: 2020 2020 2020 2020 2064 656c 2063 6f6e           del con
-00017fe0: 662e 4c61 7374 4163 7469 7665 5061 6765  f.LastActivePage
-00017ff0: 5b70 6167 652e 6462 2e66 696c 656e 616d  [page.db.filenam
-00018000: 655d 0d0a 0d0a 2020 2020 2020 2020 2020  e]....          
-00018010: 2020 666f 7220 776f 726b 6572 2069 6e20    for worker in 
-00018020: 7061 6765 2e77 6f72 6b65 7273 5f73 6561  page.workers_sea
-00018030: 7263 682e 7661 6c75 6573 2829 3a20 776f  rch.values(): wo
-00018040: 726b 6572 2e73 746f 7028 290d 0a20 2020  rker.stop()..   
-00018050: 2020 2020 2020 2020 2070 6167 652e 776f           page.wo
-00018060: 726b 6572 5f6c 6976 652e 7374 6f70 2829  rker_live.stop()
-00018070: 0d0a 2020 2020 2020 2020 2020 2020 7061  ..            pa
-00018080: 6765 2e73 6176 655f 7061 6765 5f63 6f6e  ge.save_page_con
-00018090: 6628 290d 0a0d 0a20 2020 2020 2020 2020  f()....         
-000180a0: 2020 2069 6620 7061 6765 2069 6e20 7365     if page in se
-000180b0: 6c66 2e64 625f 7061 6765 733a 0d0a 2020  lf.db_pages:..  
-000180c0: 2020 2020 2020 2020 2020 2020 2020 6465                de
-000180d0: 6c20 7365 6c66 2e64 625f 7061 6765 735b  l self.db_pages[
-000180e0: 7061 6765 5d0d 0a20 2020 2020 2020 2020  page]..         
-000180f0: 2020 2070 6167 655f 6462 7320 3d20 5b70     page_dbs = [p
-00018100: 6167 652e 6462 5d0d 0a20 2020 2020 2020  age.db]..       
-00018110: 2020 2020 2067 7569 6261 7365 2e73 7461       guibase.sta
-00018120: 7475 7328 2243 6c6f 7365 6420 6461 7461  tus("Closed data
-00018130: 6261 7365 2074 6162 2066 6f72 2025 732e  base tab for %s.
-00018140: 222c 2070 6167 652e 6462 2c20 6c6f 673d  ", page.db, log=
-00018150: 5472 7565 290d 0a20 2020 2020 2020 2020  True)..         
-00018160: 2020 2075 7469 6c2e 7275 6e5f 6f6e 6365     util.run_once
-00018170: 2863 6f6e 662e 7361 7665 290d 0a20 2020  (conf.save)..   
-00018180: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-00018190: 2020 2020 2020 2020 6966 2070 6167 652e          if page.
-000181a0: 6973 5f6d 6572 6769 6e67 3a0d 0a20 2020  is_merging:..   
-000181b0: 2020 2020 2020 2020 2020 2020 2072 6573               res
-000181c0: 706f 6e73 6520 3d20 7778 2e4d 6573 7361  ponse = wx.Messa
-000181d0: 6765 426f 7828 0d0a 2020 2020 2020 2020  geBox(..        
-000181e0: 2020 2020 2020 2020 2020 2020 224d 6572              "Mer
-000181f0: 6769 6e67 2069 7320 6375 7272 656e 746c  ging is currentl
-00018200: 7920 696e 2070 726f 6772 6573 7320 696e  y in progress in
-00018210: 2025 732e 5c6e 5c6e 436c 6f73 6520 616e   %s.\n\nClose an
-00018220: 7977 6179 3f20 220d 0a20 2020 2020 2020  yway? "..       
-00018230: 2020 2020 2020 2020 2020 2020 2022 5468               "Th
-00018240: 6973 2063 616e 2072 6573 756c 7420 696e  is can result in
-00018250: 2063 6f72 7275 7074 2064 6174 612e 2220   corrupt data." 
-00018260: 2520 7061 6765 2e74 6974 6c65 2c0d 0a20  % page.title,.. 
-00018270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018280: 2020 2063 6f6e 662e 5469 746c 652c 2077     conf.Title, w
-00018290: 782e 4f4b 207c 2077 782e 4341 4e43 454c  x.OK | wx.CANCEL
-000182a0: 207c 2077 782e 4943 4f4e 5f57 4152 4e49   | wx.ICON_WARNI
-000182b0: 4e47 290d 0a20 2020 2020 2020 2020 2020  NG)..           
-000182c0: 2020 2020 2069 6620 7778 2e43 414e 4345       if wx.CANCE
-000182d0: 4c20 3d3d 2072 6573 706f 6e73 653a 0d0a  L == response:..
-000182e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000182f0: 2020 2020 7265 7475 726e 2065 7665 6e74      return event
-00018300: 2e56 6574 6f28 290d 0a0d 0a20 2020 2020  .Veto()....     
-00018310: 2020 2020 2020 2070 6167 652e 776f 726b         page.work
-00018320: 6572 5f6d 6572 6765 2e73 746f 7028 290d  er_merge.stop().
-00018330: 0a20 2020 2020 2020 2020 2020 2070 6167  .            pag
-00018340: 652e 776f 726b 6572 5f69 6d70 6f72 742e  e.worker_import.
-00018350: 7374 6f70 2829 0d0a 2020 2020 2020 2020  stop()..        
-00018360: 2020 2020 6966 2070 6167 652e 776f 726b      if page.work
-00018370: 6572 5f6d 6572 6765 2e69 735f 616c 6976  er_merge.is_aliv
-00018380: 6528 293a 2070 6167 652e 776f 726b 6572  e(): page.worker
-00018390: 5f6d 6572 6765 2e6a 6f69 6e28 290d 0a20  _merge.join().. 
-000183a0: 2020 2020 2020 2020 2020 2069 6620 7061             if pa
-000183b0: 6765 2e77 6f72 6b65 725f 696d 706f 7274  ge.worker_import
-000183c0: 2e69 735f 616c 6976 6528 293a 2070 6167  .is_alive(): pag
-000183d0: 652e 776f 726b 6572 5f69 6d70 6f72 742e  e.worker_import.
-000183e0: 6a6f 696e 2829 0d0a 2020 2020 2020 2020  join()..        
-000183f0: 2020 2020 6966 2070 6167 6520 696e 2073      if page in s
-00018400: 656c 662e 6d65 7267 6572 5f70 6167 6573  elf.merger_pages
-00018410: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00018420: 2020 2064 656c 2073 656c 662e 6d65 7267     del self.merg
-00018430: 6572 5f70 6167 6573 5b70 6167 655d 0d0a  er_pages[page]..
-00018440: 2020 2020 2020 2020 2020 2020 7061 6765              page
-00018450: 5f64 6273 203d 205b 7061 6765 2e64 6231  _dbs = [page.db1
-00018460: 2c20 7061 6765 2e64 6232 5d0d 0a20 2020  , page.db2]..   
-00018470: 2020 2020 2020 2020 2067 7569 6261 7365           guibase
-00018480: 2e73 7461 7475 7328 2243 6c6f 7365 6420  .status("Closed 
-00018490: 636f 6d70 6172 6973 6f6e 2074 6162 2066  comparison tab f
-000184a0: 6f72 2025 7320 616e 6420 2573 2e22 2c0d  or %s and %s.",.
-000184b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000184c0: 2020 2020 2020 2020 2020 2020 7061 6765              page
-000184d0: 2e64 6231 2c20 7061 6765 2e64 6232 2c20  .db1, page.db2, 
-000184e0: 6c6f 673d 5472 7565 290d 0a0d 0a20 2020  log=True)....   
-000184f0: 2020 2020 2023 2043 6c6f 7365 2064 6174       # Close dat
-00018500: 6162 6173 6573 2c20 6966 206e 6f74 2075  abases, if not u
-00018510: 7365 6420 696e 2061 6e79 206f 7468 6572  sed in any other
-00018520: 2070 6167 650d 0a20 2020 2020 2020 2066   page..        f
-00018530: 6f72 2064 6220 696e 2070 6167 655f 6462  or db in page_db
-00018540: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
-00018550: 6462 2e75 6e72 6567 6973 7465 725f 636f  db.unregister_co
-00018560: 6e73 756d 6572 2870 6167 6529 0d0a 2020  nsumer(page)..  
-00018570: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-00018580: 2064 622e 6861 735f 636f 6e73 756d 6572   db.has_consumer
-00018590: 7328 293a 0d0a 2020 2020 2020 2020 2020  s():..          
-000185a0: 2020 2020 2020 7365 6c66 2e64 6273 2e70        self.dbs.p
-000185b0: 6f70 2864 622e 6669 6c65 6e61 6d65 2c20  op(db.filename, 
-000185c0: 4e6f 6e65 290d 0a20 2020 2020 2020 2020  None)..         
-000185d0: 2020 2020 2020 2064 622e 636c 6f73 6528         db.close(
-000185e0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-000185f0: 2020 206c 6f67 6765 722e 696e 666f 2822     logger.info("
-00018600: 436c 6f73 6564 2064 6174 6162 6173 6520  Closed database 
-00018610: 2573 2e22 2c20 6462 2e66 696c 656e 616d  %s.", db.filenam
-00018620: 6529 0d0a 2020 2020 2020 2020 2320 5265  e)..        # Re
-00018630: 6d6f 7665 2061 6e79 2064 616e 676c 696e  move any danglin
-00018640: 6720 7265 6665 7265 6e63 6573 0d0a 2020  g references..  
-00018650: 2020 2020 2020 6966 2073 656c 662e 7061        if self.pa
-00018660: 6765 5f6d 6572 6765 5f6c 6174 6573 7420  ge_merge_latest 
-00018670: 3d3d 2070 6167 653a 0d0a 2020 2020 2020  == page:..      
-00018680: 2020 2020 2020 7365 6c66 2e70 6167 655f        self.page_
-00018690: 6d65 7267 655f 6c61 7465 7374 203d 204e  merge_latest = N
-000186a0: 6f6e 650d 0a20 2020 2020 2020 2069 6620  one..        if 
-000186b0: 7365 6c66 2e70 6167 655f 6462 5f6c 6174  self.page_db_lat
-000186c0: 6573 7420 3d3d 2070 6167 653a 0d0a 2020  est == page:..  
-000186d0: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
-000186e0: 6167 655f 6462 5f6c 6174 6573 7420 3d20  age_db_latest = 
-000186f0: 6e65 7874 2828 6920 666f 7220 6920 696e  next((i for i in
-00018700: 2073 656c 662e 7061 6765 735f 7669 7369   self.pages_visi
-00018710: 7465 645b 3a3a 2d31 5d0d 0a20 2020 2020  ted[::-1]..     
-00018720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018740: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-00018750: 2869 2c20 4461 7461 6261 7365 5061 6765  (i, DatabasePage
-00018760: 2929 2c20 4e6f 6e65 290d 0a20 2020 2020  )), None)..     
-00018770: 2020 2073 656c 662e 5365 6e64 5369 7a65     self.SendSize
-00018780: 4576 656e 7428 2920 2320 4d75 6c74 696c  Event() # Multil
-00018790: 696e 6520 7778 2e4e 6f74 6562 6f6f 6b73  ine wx.Notebooks
-000187a0: 206e 6565 6420 7265 6472 6177 696e 670d   need redrawing.
-000187b0: 0a20 2020 2020 2020 2073 656c 662e 5570  .        self.Up
-000187c0: 6461 7465 4163 6365 6c65 7261 746f 7273  dateAccelerators
-000187d0: 2829 2023 2052 656d 6f76 6520 7061 6765  () # Remove page
-000187e0: 2061 6363 656c 6572 6174 6f72 730d 0a0d   accelerators...
-000187f0: 0a20 2020 2020 2020 2023 2052 656d 6f76  .        # Remov
-00018800: 6520 7061 6765 2066 726f 6d20 7669 7369  e page from visi
-00018810: 7465 6420 7061 6765 7320 6f72 6465 720d  ted pages order.
-00018820: 0a20 2020 2020 2020 2073 656c 662e 7061  .        self.pa
-00018830: 6765 735f 7669 7369 7465 6420 3d20 5b78  ges_visited = [x
-00018840: 2066 6f72 2078 2069 6e20 7365 6c66 2e70   for x in self.p
-00018850: 6167 6573 5f76 6973 6974 6564 2069 6620  ages_visited if 
-00018860: 7820 213d 2070 6167 655d 0d0a 2020 2020  x != page]..    
-00018870: 2020 2020 696e 6465 785f 6e65 7720 3d20      index_new = 
-00018880: 300d 0a20 2020 2020 2020 2069 6620 7365  0..        if se
-00018890: 6c66 2e70 6167 6573 5f76 6973 6974 6564  lf.pages_visited
-000188a0: 3a0d 0a20 2020 2020 2020 2020 2020 2066  :..            f
-000188b0: 6f72 2069 2069 6e20 7261 6e67 6528 7365  or i in range(se
-000188c0: 6c66 2e6e 6f74 6562 6f6f 6b2e 4765 7450  lf.notebook.GetP
-000188d0: 6167 6543 6f75 6e74 2829 293a 0d0a 2020  ageCount()):..  
-000188e0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-000188f0: 2073 656c 662e 6e6f 7465 626f 6f6b 2e47   self.notebook.G
-00018900: 6574 5061 6765 2869 2920 3d3d 2073 656c  etPage(i) == sel
-00018910: 662e 7061 6765 735f 7669 7369 7465 645b  f.pages_visited[
-00018920: 2d31 5d3a 0d0a 2020 2020 2020 2020 2020  -1]:..          
-00018930: 2020 2020 2020 2020 2020 696e 6465 785f            index_
-00018940: 6e65 7720 3d20 690d 0a20 2020 2020 2020  new = i..       
-00018950: 2020 2020 2020 2020 2020 2020 2062 7265               bre
-00018960: 616b 0d0a 2020 2020 2020 2020 7365 6c66  ak..        self
-00018970: 2e6e 6f74 6562 6f6f 6b2e 5365 7453 656c  .notebook.SetSel
-00018980: 6563 7469 6f6e 2869 6e64 6578 5f6e 6577  ection(index_new
-00018990: 290d 0a0d 0a0d 0a20 2020 2064 6566 206f  )......    def o
-000189a0: 6e5f 636c 6561 725f 7365 6172 6368 616c  n_clear_searchal
-000189b0: 6c28 7365 6c66 2c20 6576 656e 7429 3a0d  l(self, event):.
-000189c0: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
-000189d0: 2020 2020 2020 4861 6e64 6c65 7220 666f        Handler fo
-000189e0: 7220 636c 6963 6b69 6e67 2074 6f20 636c  r clicking to cl
-000189f0: 6561 7220 7365 6172 6368 2068 6973 746f  ear search histo
-00018a00: 7279 2069 6e20 6120 6461 7461 6261 7365  ry in a database
-00018a10: 2070 6167 652c 0d0a 2020 2020 2020 2020   page,..        
-00018a20: 636f 6e66 6972 6d73 2061 6374 696f 6e20  confirms action 
-00018a30: 616e 6420 636c 6561 7273 2068 6973 746f  and clears histo
-00018a40: 7279 2067 6c6f 6261 6c6c 792e 0d0a 2020  ry globally...  
-00018a50: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
-00018a60: 2020 2063 686f 6963 6520 3d20 7778 2e4d     choice = wx.M
-00018a70: 6573 7361 6765 426f 7828 2243 6c65 6172  essageBox("Clear
-00018a80: 2073 6561 7263 6820 6869 7374 6f72 793f   search history?
-00018a90: 222c 2063 6f6e 662e 5469 746c 652c 0d0a  ", conf.Title,..
-00018aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018ab0: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-00018ac0: 782e 4f4b 207c 2077 782e 4341 4e43 454c  x.OK | wx.CANCEL
-00018ad0: 207c 2077 782e 4943 4f4e 5f57 4152 4e49   | wx.ICON_WARNI
-00018ae0: 4e47 290d 0a20 2020 2020 2020 2069 6620  NG)..        if 
-00018af0: 7778 2e4f 4b20 3d3d 2063 686f 6963 653a  wx.OK == choice:
-00018b00: 0d0a 2020 2020 2020 2020 2020 2020 636f  ..            co
-00018b10: 6e66 2e53 6561 7263 6848 6973 746f 7279  nf.SearchHistory
-00018b20: 203d 205b 5d0d 0a20 2020 2020 2020 2020   = []..         
-00018b30: 2020 2066 6f72 2070 6167 6520 696e 2073     for page in s
-00018b40: 656c 662e 6462 5f70 6167 6573 3a0d 0a20  elf.db_pages:.. 
-00018b50: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00018b60: 6167 652e 6564 6974 5f73 6561 7263 6861  age.edit_searcha
-00018b70: 6c6c 2e53 6574 4368 6f69 6365 7328 636f  ll.SetChoices(co
-00018b80: 6e66 2e53 6561 7263 6848 6973 746f 7279  nf.SearchHistory
-00018b90: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00018ba0: 2020 2070 6167 652e 6564 6974 5f73 6561     page.edit_sea
-00018bb0: 7263 6861 6c6c 2e53 686f 7744 726f 7044  rchall.ShowDropD
-00018bc0: 6f77 6e28 4661 6c73 6529 0d0a 2020 2020  own(False)..    
-00018bd0: 2020 2020 2020 2020 7365 6c66 2e64 6961          self.dia
-00018be0: 6c6f 675f 7365 6172 6368 2e53 6574 4368  log_search.SetCh
-00018bf0: 6f69 6365 7328 636f 6e66 2e53 6561 7263  oices(conf.Searc
-00018c00: 6848 6973 746f 7279 290d 0a20 2020 2020  hHistory)..     
-00018c10: 2020 2020 2020 2075 7469 6c2e 7275 6e5f         util.run_
-00018c20: 6f6e 6365 2863 6f6e 662e 7361 7665 290d  once(conf.save).
-00018c30: 0a0d 0a0d 0a20 2020 2064 6566 2067 6574  .....    def get
-00018c40: 5f75 6e69 7175 655f 7461 625f 7469 746c  _unique_tab_titl
-00018c50: 6528 7365 6c66 2c20 7469 746c 6529 3a0d  e(self, title):.
-00018c60: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
-00018c70: 2020 2020 2020 5265 7475 726e 7320 6120        Returns a 
-00018c80: 7469 746c 6520 7468 6174 2069 7320 756e  title that is un
-00018c90: 6971 7565 2066 6f72 2074 6865 2063 7572  ique for the cur
-00018ca0: 7265 6e74 206e 6f74 6562 6f6f 6b20 2d20  rent notebook - 
-00018cb0: 6966 2074 6865 0d0a 2020 2020 2020 2020  if the..        
-00018cc0: 7370 6563 6966 6965 6420 7469 746c 6520  specified title 
-00018cd0: 616c 7265 6164 7920 6578 6973 7473 2c20  already exists, 
-00018ce0: 6170 7065 6e64 7320 6120 636f 756e 7465  appends a counte
-00018cf0: 7220 746f 2074 6865 2065 6e64 2c0d 0a20  r to the end,.. 
-00018d00: 2020 2020 2020 2065 2e67 2e20 2244 6174         e.g. "Dat
-00018d10: 6162 6173 6520 636f 6d70 6172 6973 6f6e  abase comparison
-00018d20: 2028 3129 222e 2054 6974 6c65 2069 7320   (1)". Title is 
-00018d30: 7368 6f72 7465 6e65 6420 6672 6f6d 2074  shortened from t
-00018d40: 6865 206c 6566 740d 0a20 2020 2020 2020  he left..       
-00018d50: 2069 6620 6c6f 6e67 6572 2074 6861 6e20   if longer than 
-00018d60: 616c 6c6f 7765 642e 0d0a 2020 2020 2020  allowed...      
-00018d70: 2020 2222 220d 0a20 2020 2020 2020 2069    """..        i
-00018d80: 6620 6c65 6e28 7469 746c 6529 203e 2063  f len(title) > c
-00018d90: 6f6e 662e 4d61 7854 6162 5469 746c 654c  onf.MaxTabTitleL
-00018da0: 656e 6774 683a 0d0a 2020 2020 2020 2020  ength:..        
-00018db0: 2020 2020 7469 746c 6520 3d20 222e 2e25      title = "..%
-00018dc0: 7322 2025 2074 6974 6c65 5b2d 636f 6e66  s" % title[-conf
-00018dd0: 2e4d 6178 5461 6254 6974 6c65 4c65 6e67  .MaxTabTitleLeng
-00018de0: 7468 3a5d 0d0a 2020 2020 2020 2020 756e  th:]..        un
-00018df0: 6971 7565 203d 2074 6974 6c65 5f62 6173  ique = title_bas
-00018e00: 6520 3d20 7469 746c 650d 0a20 2020 2020  e = title..     
-00018e10: 2020 2061 6c6c 5f74 6974 6c65 7320 3d20     all_titles = 
-00018e20: 5b73 656c 662e 6e6f 7465 626f 6f6b 2e47  [self.notebook.G
-00018e30: 6574 5061 6765 5465 7874 2869 290d 0a20  etPageText(i).. 
-00018e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018e50: 2020 2020 2066 6f72 2069 2069 6e20 7261       for i in ra
-00018e60: 6e67 6528 7365 6c66 2e6e 6f74 6562 6f6f  nge(self.noteboo
-00018e70: 6b2e 4765 7450 6167 6543 6f75 6e74 2829  k.GetPageCount()
-00018e80: 295d 0d0a 2020 2020 2020 2020 6920 3d20  )]..        i = 
-00018e90: 3120 2320 5374 6172 7420 636f 756e 7465  1 # Start counte
-00018ea0: 7220 6672 6f6d 2031 0d0a 2020 2020 2020  r from 1..      
-00018eb0: 2020 7768 696c 6520 756e 6971 7565 2069    while unique i
-00018ec0: 6e20 616c 6c5f 7469 746c 6573 3a0d 0a20  n all_titles:.. 
-00018ed0: 2020 2020 2020 2020 2020 2075 6e69 7175             uniqu
-00018ee0: 6520 3d20 2225 7320 2825 6429 2220 2520  e = "%s (%d)" % 
-00018ef0: 2874 6974 6c65 5f62 6173 652c 2069 290d  (title_base, i).
-00018f00: 0a20 2020 2020 2020 2020 2020 2069 202b  .            i +
-00018f10: 3d20 310d 0a20 2020 2020 2020 2072 6574  = 1..        ret
-00018f20: 7572 6e20 756e 6971 7565 0d0a 0d0a 0d0a  urn unique......
-00018f30: 2020 2020 6465 6620 6c6f 6164 5f64 6174      def load_dat
-00018f40: 6162 6173 6528 7365 6c66 2c20 6669 6c65  abase(self, file
-00018f50: 6e61 6d65 2c20 6462 3d4e 6f6e 6529 3a0d  name, db=None):.
-00018f60: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
-00018f70: 2020 2020 2020 5472 6965 7320 746f 206c        Tries to l
-00018f80: 6f61 6420 7468 6520 7370 6563 6966 6965  oad the specifie
-00018f90: 6420 6461 7461 6261 7365 2c20 6966 206e  d database, if n
-00018fa0: 6f74 2061 6c72 6561 6479 206f 7065 6e2c  ot already open,
-00018fb0: 0d0a 2020 2020 2020 2020 616e 6420 7265  ..        and re
-00018fc0: 7475 726e 7320 6974 2e0d 0a20 2020 2020  turns it...     
-00018fd0: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
-00018fe0: 6462 3020 3d20 7365 6c66 2e64 6273 2e67  db0 = self.dbs.g
-00018ff0: 6574 2866 696c 656e 616d 6529 0d0a 2020  et(filename)..  
-00019000: 2020 2020 2020 6966 2064 6230 3a20 6462        if db0: db
-00019010: 203d 2064 6230 0d0a 2020 2020 2020 2020   = db0..        
-00019020: 656c 6966 206e 6f74 206f 732e 7061 7468  elif not os.path
-00019030: 2e65 7869 7374 7328 6669 6c65 6e61 6d65  .exists(filename
-00019040: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00019050: 7778 2e4d 6573 7361 6765 426f 7828 224e  wx.MessageBox("N
-00019060: 6f6e 6578 6973 7465 6e74 2066 696c 653a  onexistent file:
-00019070: 2025 732e 2220 2520 6669 6c65 6e61 6d65   %s." % filename
-00019080: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00019090: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-000190a0: 662e 5469 746c 652c 2077 782e 4f4b 207c  f.Title, wx.OK |
-000190b0: 2077 782e 4943 4f4e 5f57 4152 4e49 4e47   wx.ICON_WARNING
-000190c0: 290d 0a20 2020 2020 2020 2065 6c73 653a  )..        else:
-000190d0: 0d0a 2020 2020 2020 2020 2020 2020 7472  ..            tr
-000190e0: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
-000190f0: 2020 2020 6462 203d 2064 6220 6f72 2073      db = db or s
-00019100: 6b79 7065 6461 7461 2e53 6b79 7065 4461  kypedata.SkypeDa
-00019110: 7461 6261 7365 2866 696c 656e 616d 6529  tabase(filename)
-00019120: 0d0a 2020 2020 2020 2020 2020 2020 6578  ..            ex
-00019130: 6365 7074 2045 7863 6570 7469 6f6e 3a0d  cept Exception:.
-00019140: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019150: 2069 735f 6163 6365 7373 6962 6c65 203d   is_accessible =
-00019160: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
-00019170: 2020 2020 2020 2020 7472 793a 0d0a 2020          try:..  
-00019180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019190: 2020 7769 7468 206f 7065 6e28 6669 6c65    with open(file
-000191a0: 6e61 6d65 2c20 2272 6222 293a 0d0a 2020  name, "rb"):..  
-000191b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000191c0: 2020 2020 2020 6973 5f61 6363 6573 7369        is_accessi
-000191d0: 626c 6520 3d20 5472 7565 0d0a 2020 2020  ble = True..    
-000191e0: 2020 2020 2020 2020 2020 2020 6578 6365              exce
-000191f0: 7074 2045 7863 6570 7469 6f6e 3a0d 0a20  pt Exception:.. 
-00019200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019210: 2020 2070 6173 730d 0a20 2020 2020 2020     pass..       
-00019220: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-00019230: 6973 5f61 6363 6573 7369 626c 653a 0d0a  is_accessible:..
-00019240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019250: 2020 2020 7778 2e4d 6573 7361 6765 426f      wx.MessageBo
-00019260: 7828 0d0a 2020 2020 2020 2020 2020 2020  x(..            
-00019270: 2020 2020 2020 2020 2020 2020 2243 6f75              "Cou
-00019280: 6c64 206e 6f74 206f 7065 6e20 2573 2e5c  ld not open %s.\
-00019290: 6e5c 6e22 0d0a 2020 2020 2020 2020 2020  n\n"..          
-000192a0: 2020 2020 2020 2020 2020 2020 2020 2253                "S
-000192b0: 6f6d 6520 6f74 6865 7220 7072 6f63 6573  ome other proces
-000192c0: 7320 6d61 7920 6265 2075 7369 6e67 2074  s may be using t
-000192d0: 6865 2066 696c 652e 220d 0a20 2020 2020  he file."..     
-000192e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000192f0: 2020 2025 2066 696c 656e 616d 652c 2063     % filename, c
-00019300: 6f6e 662e 5469 746c 652c 2077 782e 4f4b  onf.Title, wx.OK
-00019310: 207c 2077 782e 4943 4f4e 5f57 4152 4e49   | wx.ICON_WARNI
-00019320: 4e47 290d 0a20 2020 2020 2020 2020 2020  NG)..           
-00019330: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-00019340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019350: 7778 2e4d 6573 7361 6765 426f 7828 0d0a  wx.MessageBox(..
-00019360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019370: 2020 2020 2020 2020 2243 6f75 6c64 206e          "Could n
-00019380: 6f74 206f 7065 6e20 2573 2e5c 6e5c 6e22  ot open %s.\n\n"
-00019390: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000193a0: 2020 2020 2020 2020 2020 224e 6f74 2061            "Not a
-000193b0: 2076 616c 6964 2053 514c 4954 4520 6461   valid SQLITE da
-000193c0: 7461 6261 7365 3f22 2025 2066 696c 656e  tabase?" % filen
-000193d0: 616d 652c 0d0a 2020 2020 2020 2020 2020  ame,..          
-000193e0: 2020 2020 2020 2020 2020 2020 2020 636f                co
-000193f0: 6e66 2e54 6974 6c65 2c20 7778 2e4f 4b20  nf.Title, wx.OK 
-00019400: 7c20 7778 2e49 434f 4e5f 5741 524e 494e  | wx.ICON_WARNIN
-00019410: 4729 0d0a 2020 2020 2020 2020 2020 2020  G)..            
-00019420: 6966 2064 623a 0d0a 2020 2020 2020 2020  if db:..        
-00019430: 2020 2020 2020 2020 6966 206e 6f74 2064          if not d
-00019440: 6230 3a0d 0a20 2020 2020 2020 2020 2020  b0:..           
-00019450: 2020 2020 2020 2020 206c 6f67 6765 722e           logger.
-00019460: 696e 666f 2822 4f70 656e 6564 2025 7320  info("Opened %s 
-00019470: 2825 7329 2e22 2c20 6462 2c20 7574 696c  (%s).", db, util
-00019480: 2e66 6f72 6d61 745f 6279 7465 7328 0d0a  .format_bytes(..
-00019490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000194a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000194b0: 6462 2e66 696c 6573 697a 6529 290d 0a20  db.filesize)).. 
-000194c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000194d0: 2020 2067 7569 6261 7365 2e73 7461 7475     guibase.statu
-000194e0: 7328 2252 6561 6469 6e67 2064 6174 6162  s("Reading datab
-000194f0: 6173 6520 6669 6c65 2025 732e 222c 2064  ase file %s.", d
-00019500: 6229 0d0a 2020 2020 2020 2020 2020 2020  b)..            
-00019510: 2020 2020 7365 6c66 2e64 6273 5b66 696c      self.dbs[fil
-00019520: 656e 616d 655d 203d 2064 620d 0a20 2020  ename] = db..   
-00019530: 2020 2020 2020 2020 2020 2020 2023 2041               # A
-00019540: 6464 2066 696c 656e 616d 6520 746f 2052  dd filename to R
-00019550: 6563 656e 7420 4669 6c65 7320 6d65 6e75  ecent Files menu
-00019560: 2061 6e64 2063 6f6e 662c 2069 6620 6e65   and conf, if ne
-00019570: 6564 6564 0d0a 2020 2020 2020 2020 2020  eded..          
-00019580: 2020 2020 2020 6966 2066 696c 656e 616d        if filenam
-00019590: 6520 696e 2063 6f6e 662e 5265 6365 6e74  e in conf.Recent
-000195a0: 4669 6c65 733a 2023 2052 656d 6f76 6520  Files: # Remove 
-000195b0: 6561 726c 6965 7220 706f 7369 7469 6f6e  earlier position
-000195c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000195d0: 2020 2020 2020 6964 7820 3d20 636f 6e66        idx = conf
-000195e0: 2e52 6563 656e 7446 696c 6573 2e69 6e64  .RecentFiles.ind
-000195f0: 6578 2866 696c 656e 616d 6529 0d0a 2020  ex(filename)..  
-00019600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019610: 2020 7472 793a 2073 656c 662e 6869 7374    try: self.hist
-00019620: 6f72 795f 6669 6c65 2e52 656d 6f76 6546  ory_file.RemoveF
-00019630: 696c 6546 726f 6d48 6973 746f 7279 2869  ileFromHistory(i
-00019640: 6478 290d 0a20 2020 2020 2020 2020 2020  dx)..           
-00019650: 2020 2020 2020 2020 2065 7863 6570 7420           except 
-00019660: 4578 6365 7074 696f 6e3a 2070 6173 730d  Exception: pass.
-00019670: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019680: 2073 656c 662e 6869 7374 6f72 795f 6669   self.history_fi
-00019690: 6c65 2e41 6464 4669 6c65 546f 4869 7374  le.AddFileToHist
-000196a0: 6f72 7928 6669 6c65 6e61 6d65 290d 0a20  ory(filename).. 
-000196b0: 2020 2020 2020 2020 2020 2020 2020 2075                 u
-000196c0: 7469 6c2e 6164 645f 756e 6971 7565 2863  til.add_unique(c
-000196d0: 6f6e 662e 5265 6365 6e74 4669 6c65 732c  onf.RecentFiles,
-000196e0: 2066 696c 656e 616d 652c 202d 312c 0d0a   filename, -1,..
-000196f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019710: 636f 6e66 2e4d 6178 5265 6365 6e74 4669  conf.MaxRecentFi
-00019720: 6c65 7329 0d0a 2020 2020 2020 2020 2020  les)..          
-00019730: 2020 2020 2020 7574 696c 2e72 756e 5f6f        util.run_o
-00019740: 6e63 6528 636f 6e66 2e73 6176 6529 0d0a  nce(conf.save)..
-00019750: 2020 2020 2020 2020 7265 7475 726e 2064          return d
-00019760: 620d 0a0d 0a0d 0a20 2020 2064 6566 206c  b......    def l
-00019770: 6f61 645f 6461 7461 6261 7365 5f70 6167  oad_database_pag
-00019780: 6528 7365 6c66 2c20 6669 6c65 6e61 6d65  e(self, filename
-00019790: 293a 0d0a 2020 2020 2020 2020 2222 220d  ):..        """.
-000197a0: 0a20 2020 2020 2020 2054 7269 6573 2074  .        Tries t
-000197b0: 6f20 6c6f 6164 2074 6865 2073 7065 6369  o load the speci
-000197c0: 6669 6564 2064 6174 6162 6173 652c 2069  fied database, i
-000197d0: 6620 6e6f 7420 616c 7265 6164 7920 6f70  f not already op
-000197e0: 656e 2c20 6372 6561 7465 2061 0d0a 2020  en, create a..  
-000197f0: 2020 2020 2020 7375 6270 6167 6520 666f        subpage fo
-00019800: 7220 6974 2c20 6966 206e 6f74 2061 6c72  r it, if not alr
-00019810: 6561 6479 2063 7265 6174 6564 2c20 616e  eady created, an
-00019820: 6420 666f 6375 7365 7320 7468 6520 7375  d focuses the su
-00019830: 6270 6167 652e 0d0a 0d0a 2020 2020 2020  bpage.....      
-00019840: 2020 4072 6574 7572 6e20 2064 6174 6162    @return  datab
-00019850: 6173 6520 7061 6765 2069 6e73 7461 6e63  ase page instanc
-00019860: 650d 0a20 2020 2020 2020 2022 2222 0d0a  e..        """..
-00019870: 2020 2020 2020 2020 7061 6765 2c20 6462          page, db
-00019880: 203d 204e 6f6e 652c 2073 656c 662e 6462   = None, self.db
-00019890: 732e 6765 7428 6669 6c65 6e61 6d65 290d  s.get(filename).
-000198a0: 0a20 2020 2020 2020 2069 6620 6462 2061  .        if db a
-000198b0: 6e64 2064 6220 696e 2073 656c 662e 6462  nd db in self.db
-000198c0: 5f70 6167 6573 2e76 616c 7565 7328 293a  _pages.values():
-000198d0: 0d0a 2020 2020 2020 2020 2020 2020 7061  ..            pa
-000198e0: 6765 203d 206e 6578 7428 2878 2066 6f72  ge = next((x for
-000198f0: 2078 2069 6e20 7365 6c66 2e64 625f 7061   x in self.db_pa
-00019900: 6765 7320 6966 2078 2061 6e64 2078 2e64  ges if x and x.d
-00019910: 6220 3d3d 2064 6229 2c20 4e6f 6e65 290d  b == db), None).
-00019920: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00019930: 7061 6765 3a0d 0a20 2020 2020 2020 2020  page:..         
-00019940: 2020 2069 6620 6669 6c65 6e61 6d65 2069     if filename i
-00019950: 6e20 7365 6c66 2e77 6f72 6b65 7273 5f69  n self.workers_i
-00019960: 6d70 6f72 743a 0d0a 2020 2020 2020 2020  mport:..        
-00019970: 2020 2020 2020 2020 7778 2e4d 6573 7361          wx.Messa
-00019980: 6765 426f 7828 2225 7320 6973 2063 7572  geBox("%s is cur
-00019990: 7265 6e74 6c79 2062 6569 6e67 2069 6d70  rently being imp
-000199a0: 6f72 7465 6420 746f 2c20 6361 6e6e 6f74  orted to, cannot
-000199b0: 206f 7065 6e2e 2220 250d 0a20 2020 2020   open." %..     
-000199c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000199d0: 2020 2020 2020 2020 2066 696c 656e 616d           filenam
-000199e0: 652c 2063 6f6e 662e 5469 746c 652c 2077  e, conf.Title, w
-000199f0: 782e 4f4b 207c 2077 782e 4943 4f4e 5f57  x.OK | wx.ICON_W
-00019a00: 4152 4e49 4e47 290d 0a20 2020 2020 2020  ARNING)..       
-00019a10: 2020 2020 2020 2020 2072 6574 7572 6e0d           return.
-00019a20: 0a0d 0a20 2020 2020 2020 2020 2020 2069  ...            i
-00019a30: 6620 6e6f 7420 6462 3a0d 0a20 2020 2020  f not db:..     
-00019a40: 2020 2020 2020 2020 2020 2064 6220 3d20             db = 
-00019a50: 7365 6c66 2e6c 6f61 645f 6461 7461 6261  self.load_databa
-00019a60: 7365 2866 696c 656e 616d 6529 0d0a 2020  se(filename)..  
-00019a70: 2020 2020 2020 2020 2020 6966 2064 623a            if db:
-00019a80: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00019a90: 2020 6775 6962 6173 652e 7374 6174 7573    guibase.status
-00019aa0: 2822 4f70 656e 696e 6720 6461 7461 6261  ("Opening databa
-00019ab0: 7365 2066 696c 6520 2573 2e22 2025 2064  se file %s." % d
-00019ac0: 6229 0d0a 2020 2020 2020 2020 2020 2020  b)..            
-00019ad0: 2020 2020 7461 625f 7469 746c 6520 3d20      tab_title = 
-00019ae0: 7365 6c66 2e67 6574 5f75 6e69 7175 655f  self.get_unique_
-00019af0: 7461 625f 7469 746c 6528 6462 2e66 696c  tab_title(db.fil
-00019b00: 656e 616d 6529 0d0a 2020 2020 2020 2020  ename)..        
-00019b10: 2020 2020 2020 2020 7061 6765 203d 2044          page = D
-00019b20: 6174 6162 6173 6550 6167 6528 7365 6c66  atabasePage(self
-00019b30: 2e6e 6f74 6562 6f6f 6b2c 2074 6162 5f74  .notebook, tab_t
-00019b40: 6974 6c65 2c20 6462 2c20 7365 6c66 2e6d  itle, db, self.m
-00019b50: 656d 6f72 7966 7329 0d0a 2020 2020 2020  emoryfs)..      
-00019b60: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
-00019b70: 625f 7061 6765 735b 7061 6765 5d20 3d20  b_pages[page] = 
-00019b80: 6462 0d0a 2020 2020 2020 2020 2020 2020  db..            
-00019b90: 2020 2020 7365 6c66 2e55 7064 6174 6541      self.UpdateA
-00019ba0: 6363 656c 6572 6174 6f72 7328 290d 0a20  ccelerators().. 
-00019bb0: 2020 2020 2020 2020 2020 2020 2020 2075                 u
-00019bc0: 7469 6c2e 7275 6e5f 6f6e 6365 2863 6f6e  til.run_once(con
-00019bd0: 662e 7361 7665 290d 0a20 2020 2020 2020  f.save)..       
-00019be0: 2020 2020 2020 2020 2073 656c 662e 4269           self.Bi
-00019bf0: 6e64 2877 782e 4556 545f 4c49 5354 5f44  nd(wx.EVT_LIST_D
-00019c00: 454c 4554 455f 414c 4c5f 4954 454d 532c  ELETE_ALL_ITEMS,
-00019c10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00019c20: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00019c30: 2e6f 6e5f 636c 6561 725f 7365 6172 6368  .on_clear_search
-00019c40: 616c 6c2c 2070 6167 652e 6564 6974 5f73  all, page.edit_s
-00019c50: 6561 7263 6861 6c6c 290d 0a20 2020 2020  earchall)..     
-00019c60: 2020 2069 6620 7061 6765 3a0d 0a20 2020     if page:..   
-00019c70: 2020 2020 2020 2020 2069 6478 3020 3d20           idx0 = 
-00019c80: 7365 6c66 2e6c 6973 745f 6462 2e47 6574  self.list_db.Get
-00019c90: 4669 7273 7453 656c 6563 7465 6428 290d  FirstSelected().
-00019ca0: 0a20 2020 2020 2020 2020 2020 2069 6478  .            idx
-00019cb0: 2020 3d20 7365 6c66 2e6c 6973 745f 6462    = self.list_db
-00019cc0: 2e46 696e 6449 7465 6d28 6669 6c65 6e61  .FindItem(filena
-00019cd0: 6d65 290d 0a20 2020 2020 2020 2020 2020  me)..           
-00019ce0: 2069 6620 6964 7830 203e 3d20 3020 616e   if idx0 >= 0 an
-00019cf0: 6420 6964 7830 2021 3d20 6964 783a 2073  d idx0 != idx: s
-00019d00: 656c 662e 6c69 7374 5f64 622e 5365 6c65  elf.list_db.Sele
-00019d10: 6374 2869 6478 302c 2046 616c 7365 290d  ct(idx0, False).
-00019d20: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00019d30: 6964 7820 3e20 3020 616e 6420 6964 7820  idx > 0 and idx 
-00019d40: 213d 2069 6478 303a 0d0a 2020 2020 2020  != idx0:..      
-00019d50: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
-00019d60: 6973 745f 6462 2e53 656c 6563 7428 6964  ist_db.Select(id
-00019d70: 782c 2054 7275 6529 0d0a 2020 2020 2020  x, True)..      
-00019d80: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
-00019d90: 6973 745f 6462 2e45 6e73 7572 6556 6973  ist_db.EnsureVis
-00019da0: 6962 6c65 2869 6478 290d 0a20 2020 2020  ible(idx)..     
-00019db0: 2020 2020 2020 2066 6f72 2069 2069 6e20         for i in 
-00019dc0: 7261 6e67 6528 7365 6c66 2e6e 6f74 6562  range(self.noteb
-00019dd0: 6f6f 6b2e 4765 7450 6167 6543 6f75 6e74  ook.GetPageCount
-00019de0: 2829 293a 0d0a 2020 2020 2020 2020 2020  ()):..          
-00019df0: 2020 2020 2020 6966 2073 656c 662e 6e6f        if self.no
-00019e00: 7465 626f 6f6b 2e47 6574 5061 6765 2869  tebook.GetPage(i
-00019e10: 2920 3d3d 2070 6167 653a 0d0a 2020 2020  ) == page:..    
-00019e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019e30: 7365 6c66 2e6e 6f74 6562 6f6f 6b2e 5365  self.notebook.Se
-00019e40: 7453 656c 6563 7469 6f6e 2869 290d 0a20  tSelection(i).. 
-00019e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019e60: 2020 2073 656c 662e 7570 6461 7465 5f6e     self.update_n
-00019e70: 6f74 6562 6f6f 6b5f 6865 6164 6572 2829  otebook_header()
-00019e80: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00019e90: 2020 2020 2020 6272 6561 6b20 2320 666f        break # fo
-00019ea0: 7220 690d 0a20 2020 2020 2020 2072 6574  r i..        ret
-00019eb0: 7572 6e20 7061 6765 0d0a 0d0a 0d0a 0d0a  urn page........
-00019ec0: 636c 6173 7320 4461 7461 6261 7365 5061  class DatabasePa
-00019ed0: 6765 2877 782e 5061 6e65 6c29 3a0d 0a20  ge(wx.Panel):.. 
-00019ee0: 2020 2022 2222 0d0a 2020 2020 4120 7778     """..    A wx
-00019ef0: 2e4e 6f74 6562 6f6f 6b20 7061 6765 2066  .Notebook page f
-00019f00: 6f72 206d 616e 6167 696e 6720 6120 7369  or managing a si
-00019f10: 6e67 6c65 2064 6174 6162 6173 6520 6669  ngle database fi
-00019f20: 6c65 2c20 6861 7320 6974 7320 6f77 6e0d  le, has its own.
-00019f30: 0a20 2020 204e 6f74 6562 6f6f 6b20 7769  .    Notebook wi
-00019f40: 7468 2061 206e 756d 6265 7220 6f66 2070  th a number of p
-00019f50: 6167 6573 2066 6f72 2073 6561 7263 6869  ages for searchi
-00019f60: 6e67 2c20 6272 6f77 7369 6e67 2063 6861  ng, browsing cha
-00019f70: 7420 6869 7374 6f72 7920 616e 640d 0a20  t history and.. 
-00019f80: 2020 2064 6174 6162 6173 6520 7461 626c     database tabl
-00019f90: 6573 2c20 696e 666f 726d 6174 696f 6e20  es, information 
-00019fa0: 616e 6420 636f 6e74 6163 7420 696d 706f  and contact impo
-00019fb0: 7274 2e0d 0a20 2020 2022 2222 0d0a 0d0a  rt...    """....
-00019fc0: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
-00019fd0: 2873 656c 662c 2070 6172 656e 745f 6e6f  (self, parent_no
-00019fe0: 7465 626f 6f6b 2c20 7469 746c 652c 2064  tebook, title, d
-00019ff0: 622c 206d 656d 6f72 7966 7329 3a0d 0a20  b, memoryfs):.. 
-0001a000: 2020 2020 2020 2077 782e 5061 6e65 6c2e         wx.Panel.
-0001a010: 5f5f 696e 6974 5f5f 2873 656c 662c 2070  __init__(self, p
-0001a020: 6172 656e 743d 7061 7265 6e74 5f6e 6f74  arent=parent_not
-0001a030: 6562 6f6f 6b29 0d0a 2020 2020 2020 2020  ebook)..        
-0001a040: 7365 6c66 2e70 6172 656e 745f 6e6f 7465  self.parent_note
-0001a050: 626f 6f6b 203d 2070 6172 656e 745f 6e6f  book = parent_no
-0001a060: 7465 626f 6f6b 0d0a 2020 2020 2020 2020  tebook..        
-0001a070: 7365 6c66 2e74 6974 6c65 203d 2074 6974  self.title = tit
-0001a080: 6c65 0d0a 0d0a 2020 2020 2020 2020 7365  le....        se
-0001a090: 6c66 2e70 6167 656f 7264 6572 203d 207b  lf.pageorder = {
-0001a0a0: 7d20 2320 7b70 6167 653a 206e 6f74 6562  } # {page: noteb
-0001a0b0: 6f6f 6b20 696e 6465 782c 207d 0d0a 2020  ook index, }..  
-0001a0c0: 2020 2020 2020 7365 6c66 2e72 6561 6479        self.ready
-0001a0d0: 5f74 6f5f 636c 6f73 6520 3d20 4661 6c73  _to_close = Fals
-0001a0e0: 650d 0a20 2020 2020 2020 2073 656c 662e  e..        self.
-0001a0f0: 6462 203d 2064 620d 0a20 2020 2020 2020  db = db..       
-0001a100: 2073 656c 662e 6462 2e72 6567 6973 7465   self.db.registe
-0001a110: 725f 636f 6e73 756d 6572 2873 656c 6629  r_consumer(self)
-0001a120: 0d0a 2020 2020 2020 2020 7365 6c66 2e64  ..        self.d
-0001a130: 625f 6772 6964 7320 3d20 7b7d 2023 207b  b_grids = {} # {
-0001a140: 2274 6162 6c65 6e61 6d65 223a 2053 716c  "tablename": Sql
-0001a150: 6974 6547 7269 6442 6173 652c 207d 0d0a  iteGridBase, }..
-0001a160: 2020 2020 2020 2020 7365 6c66 2e6d 656d          self.mem
-0001a170: 6f72 7966 7320 3d20 6d65 6d6f 7279 6673  oryfs = memoryfs
-0001a180: 0d0a 2020 2020 2020 2020 7365 6c66 2e74  ..        self.t
-0001a190: 696d 656c 696e 655f 7469 6d65 7220 3d20  imeline_timer = 
-0001a1a0: 4e6f 6e65 2023 2054 696d 656c 696e 6520  None # Timeline 
-0001a1b0: 6869 6768 6c69 6768 7420 6361 6c6c 6261  highlight callba
-0001a1c0: 636b 2074 696d 6572 0d0a 2020 2020 2020  ck timer..      
-0001a1d0: 2020 7061 7265 6e74 5f6e 6f74 6562 6f6f    parent_noteboo
-0001a1e0: 6b2e 496e 7365 7274 5061 6765 2831 2c20  k.InsertPage(1, 
-0001a1f0: 7365 6c66 2c20 7469 746c 6529 0d0a 2020  self, title)..  
-0001a200: 2020 2020 2020 6275 7379 203d 2063 6f6e        busy = con
-0001a210: 7472 6f6c 732e 4275 7379 5061 6e65 6c28  trols.BusyPanel(
-0001a220: 7365 6c66 2c20 224c 6f61 6469 6e67 205c  self, "Loading \
-0001a230: 2225 735c 222e 2220 2520 6462 2e66 696c  "%s\"." % db.fil
-0001a240: 656e 616d 6529 0d0a 2020 2020 2020 2020  ename)..        
-0001a250: 7365 6c66 2e63 6f75 6e74 6572 203d 206c  self.counter = l
-0001a260: 616d 6264 6120 783d 7b22 6322 3a20 307d  ambda x={"c": 0}
-0001a270: 3a20 782e 7570 6461 7465 2863 3d31 2b78  : x.update(c=1+x
-0001a280: 5b22 6322 5d29 206f 7220 785b 2263 225d  ["c"]) or x["c"]
-0001a290: 0d0a 2020 2020 2020 2020 436f 6c6f 7572  ..        Colour
-0001a2a0: 4d61 6e61 6765 722e 4d61 6e61 6765 2873  Manager.Manage(s
-0001a2b0: 656c 662c 2022 4261 636b 6772 6f75 6e64  elf, "Background
-0001a2c0: 436f 6c6f 7572 222c 2022 5769 6467 6574  Colour", "Widget
-0001a2d0: 436f 6c6f 7572 2229 0d0a 2020 2020 2020  Colour")..      
-0001a2e0: 2020 7365 6c66 2e42 696e 6428 7778 2e45    self.Bind(wx.E
-0001a2f0: 5654 5f53 5953 5f43 4f4c 4f55 525f 4348  VT_SYS_COLOUR_CH
-0001a300: 414e 4745 442c 2073 656c 662e 6f6e 5f73  ANGED, self.on_s
-0001a310: 7973 5f63 6f6c 6f75 725f 6368 616e 6765  ys_colour_change
-0001a320: 290d 0a0d 0a20 2020 2020 2020 2073 656c  )....        sel
-0001a330: 662e 6368 6174 203d 204e 6f6e 6520 2320  f.chat = None # 
-0001a340: 4375 7272 656e 746c 7920 7669 6577 6564  Currently viewed
-0001a350: 2063 6861 740d 0a20 2020 2020 2020 2073   chat..        s
-0001a360: 656c 662e 6368 6174 7320 3d20 5b5d 2020  elf.chats = []  
-0001a370: 2320 416c 6c20 6368 6174 7320 696e 2064  # All chats in d
-0001a380: 6174 6162 6173 650d 0a20 2020 2020 2020  atabase..       
-0001a390: 2073 656c 662e 6368 6174 5f66 696c 7465   self.chat_filte
-0001a3a0: 7220 3d20 7b20 2320 4669 6c74 6572 2066  r = { # Filter f
-0001a3b0: 6f72 2063 7572 7265 6e74 6c79 2073 686f  or currently sho
-0001a3c0: 776e 2063 6861 7420 6869 7374 6f72 790d  wn chat history.
-0001a3d0: 0a20 2020 2020 2020 2020 2020 2022 6461  .            "da
-0001a3e0: 7465 7261 6e67 6522 3a20 4e6f 6e65 2c20  terange": None, 
-0001a3f0: 2020 2020 2023 2043 7572 7265 6e74 2064       # Current d
-0001a400: 6174 6520 7261 6e67 650d 0a20 2020 2020  ate range..     
-0001a410: 2020 2020 2020 2022 7374 6172 7464 6174         "startdat
-0001a420: 6572 616e 6765 223a 204e 6f6e 652c 2023  erange": None, #
-0001a430: 2049 6e69 7469 616c 2064 6174 6520 7261   Initial date ra
-0001a440: 6e67 650d 0a20 2020 2020 2020 2020 2020  nge..           
-0001a450: 2022 7465 7874 223a 2022 222c 2020 2020   "text": "",    
-0001a460: 2020 2020 2020 2020 2023 2054 6578 7420           # Text 
-0001a470: 696e 206d 6573 7361 6765 2063 6f6e 7465  in message conte
-0001a480: 6e74 0d0a 2020 2020 2020 2020 2020 2020  nt..            
-0001a490: 2270 6172 7469 6369 7061 6e74 7322 3a20  "participants": 
-0001a4a0: 4e6f 6e65 2020 2020 2320 4d65 7373 6167  None    # Messag
-0001a4b0: 6573 2066 726f 6d20 5b73 6b79 7065 206e  es from [skype n
-0001a4c0: 616d 652c 205d 0d0a 2020 2020 2020 2020  ame, ]..        
-0001a4d0: 7d0d 0a20 2020 2020 2020 2073 656c 662e  }..        self.
-0001a4e0: 636f 6e74 6163 7420 3d20 4e6f 6e65 2023  contact = None #
-0001a4f0: 2043 7572 7265 6e74 6c79 2076 6965 7765   Currently viewe
-0001a500: 6420 636f 6e74 6163 740d 0a20 2020 2020  d contact..     
-0001a510: 2020 2073 656c 662e 636f 6e74 6163 7473     self.contacts
-0001a520: 203d 205b 5d20 2023 2041 6c6c 2063 6f6e   = []  # All con
-0001a530: 7461 6374 7320 696e 2064 6174 6162 6173  tacts in databas
-0001a540: 650d 0a20 2020 2020 2020 2073 656c 662e  e..        self.
-0001a550: 636f 6e74 6163 745f 736f 7274 5f66 6965  contact_sort_fie
-0001a560: 6c64 203d 2022 6c61 7374 5f6d 6573 7361  ld = "last_messa
-0001a570: 6765 5f64 6174 6574 696d 6522 0d0a 2020  ge_datetime"..  
-0001a580: 2020 2020 2020 7365 6c66 2e69 6d61 6765        self.image
-0001a590: 6361 6368 6520 3d20 7b7d 2023 207b 2822  cache = {} # {("
-0001a5a0: 6176 6174 6172 222c 2063 6f6e 7461 6374  avatar", contact
-0001a5b0: 2f61 6363 6f75 6e74 2049 4429 206f 7220  /account ID) or 
-0001a5c0: 2822 6368 6174 222c 2063 6861 7420 4944  ("chat", chat ID
-0001a5d0: 293a 2077 782e 496d 6167 657d 0d0a 2020  ): wx.Image}..  
-0001a5e0: 2020 2020 2020 7365 6c66 2e73 7461 7473        self.stats
-0001a5f0: 5f73 6f72 745f 6669 656c 6420 3d20 226e  _sort_field = "n
-0001a600: 616d 6522 0d0a 2020 2020 2020 2020 7365  ame"..        se
-0001a610: 6c66 2e73 7461 7473 5f65 7870 616e 6420  lf.stats_expand 
-0001a620: 3d20 7b22 636c 6f75 6473 223a 2046 616c  = {"clouds": Fal
-0001a630: 7365 2c20 2265 6d6f 7469 636f 6e73 223a  se, "emoticons":
-0001a640: 2046 616c 7365 2c0d 0a20 2020 2020 2020   False,..       
-0001a650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a660: 2020 2020 2020 2273 6861 7265 645f 6d65        "shared_me
-0001a670: 6469 6122 3a20 4661 6c73 657d 0d0a 0d0a  dia": False}....
-0001a680: 2020 2020 2020 2020 2320 4372 6561 7465          # Create
-0001a690: 2073 6561 7263 6820 7374 7275 6374 7572   search structur
-0001a6a0: 6573 2061 6e64 2074 6872 6561 6473 0d0a  es and threads..
-0001a6b0: 2020 2020 2020 2020 7365 6c66 2e42 696e          self.Bin
-0001a6c0: 6428 4556 545f 574f 524b 4552 2c20 7365  d(EVT_WORKER, se
-0001a6d0: 6c66 2e6f 6e5f 7365 6172 6368 616c 6c5f  lf.on_searchall_
-0001a6e0: 7265 7375 6c74 290d 0a20 2020 2020 2020  result)..       
-0001a6f0: 2073 656c 662e 776f 726b 6572 735f 7365   self.workers_se
-0001a700: 6172 6368 203d 207b 7d20 2320 7b73 6561  arch = {} # {sea
-0001a710: 7263 6820 4944 3a20 776f 726b 6572 732e  rch ID: workers.
-0001a720: 5365 6172 6368 5468 7265 6164 2c20 7d0d  SearchThread, }.
-0001a730: 0a20 2020 2020 2020 2073 656c 662e 6462  .        self.db
-0001a740: 2e6c 6976 652e 7072 6f67 7265 7373 203d  .live.progress =
-0001a750: 2073 656c 662e 6f6e 5f6c 6976 655f 7265   self.on_live_re
-0001a760: 7375 6c74 0d0a 2020 2020 2020 2020 7365  sult..        se
-0001a770: 6c66 2e77 6f72 6b65 725f 6c69 7665 203d  lf.worker_live =
-0001a780: 2077 6f72 6b65 7273 2e4c 6976 6554 6872   workers.LiveThr
-0001a790: 6561 6428 7365 6c66 2e6f 6e5f 6c69 7665  ead(self.on_live
-0001a7a0: 5f72 6573 756c 742c 2073 656c 662e 6462  _result, self.db
-0001a7b0: 2e6c 6976 6529 0d0a 0d0a 2020 2020 2020  .live)....      
-0001a7c0: 2020 7369 7a65 7220 3d20 7365 6c66 2e53    sizer = self.S
-0001a7d0: 697a 6572 203d 2077 782e 426f 7853 697a  izer = wx.BoxSiz
-0001a7e0: 6572 2877 782e 5645 5254 4943 414c 290d  er(wx.VERTICAL).
-0001a7f0: 0a0d 0a20 2020 2020 2020 2073 697a 6572  ...        sizer
-0001a800: 5f68 6561 6465 7220 3d20 7778 2e42 6f78  _header = wx.Box
-0001a810: 5369 7a65 7228 7778 2e48 4f52 495a 4f4e  Sizer(wx.HORIZON
-0001a820: 5441 4c29 0d0a 2020 2020 2020 2020 6c61  TAL)..        la
-0001a830: 6265 6c5f 7469 746c 6520 3d20 7365 6c66  bel_title = self
-0001a840: 2e6c 6162 656c 5f74 6974 6c65 203d 2077  .label_title = w
-0001a850: 782e 5374 6174 6963 5465 7874 2870 6172  x.StaticText(par
-0001a860: 656e 743d 7365 6c66 2c20 6c61 6265 6c3d  ent=self, label=
-0001a870: 2222 290d 0a20 2020 2020 2020 2073 697a  "")..        siz
-0001a880: 6572 5f68 6561 6465 722e 4164 6428 6c61  er_header.Add(la
-0001a890: 6265 6c5f 7469 746c 652c 2066 6c61 673d  bel_title, flag=
-0001a8a0: 7778 2e41 4c49 474e 5f43 454e 5445 525f  wx.ALIGN_CENTER_
-0001a8b0: 5645 5254 4943 414c 290d 0a20 2020 2020  VERTICAL)..     
-0001a8c0: 2020 2073 697a 6572 5f68 6561 6465 722e     sizer_header.
-0001a8d0: 4164 6453 7472 6574 6368 5370 6163 6572  AddStretchSpacer
-0001a8e0: 2829 0d0a 0d0a 0d0a 2020 2020 2020 2020  ()......        
-0001a8f0: 7365 6c66 2e6c 6162 656c 5f73 6561 7263  self.label_searc
-0001a900: 6820 3d20 7778 2e53 7461 7469 6354 6578  h = wx.StaticTex
-0001a910: 7428 7365 6c66 2c20 2d31 2c20 2226 5365  t(self, -1, "&Se
-0001a920: 6172 6368 2069 6e20 6d65 7373 6167 6573  arch in messages
-0001a930: 3a22 290d 0a20 2020 2020 2020 2073 697a  :")..        siz
-0001a940: 6572 5f68 6561 6465 722e 4164 6428 7365  er_header.Add(se
-0001a950: 6c66 2e6c 6162 656c 5f73 6561 7263 682c  lf.label_search,
-0001a960: 2062 6f72 6465 723d 352c 0d0a 2020 2020   border=5,..    
-0001a970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a980: 2020 2020 2066 6c61 673d 7778 2e52 4947       flag=wx.RIG
-0001a990: 4854 207c 2077 782e 414c 4947 4e5f 4345  HT | wx.ALIGN_CE
-0001a9a0: 4e54 4552 5f56 4552 5449 4341 4c29 0d0a  NTER_VERTICAL)..
-0001a9b0: 2020 2020 2020 2020 6564 6974 5f73 6561          edit_sea
-0001a9c0: 7263 6820 3d20 7365 6c66 2e65 6469 745f  rch = self.edit_
-0001a9d0: 7365 6172 6368 616c 6c20 3d20 636f 6e74  searchall = cont
-0001a9e0: 726f 6c73 2e54 6578 7443 7472 6c41 7574  rols.TextCtrlAut
-0001a9f0: 6f43 6f6d 706c 6574 6528 0d0a 2020 2020  oComplete(..    
-0001aa00: 2020 2020 2020 2020 7365 6c66 2c20 6465          self, de
-0001aa10: 7363 7269 7074 696f 6e3d 636f 6e66 2e48  scription=conf.H
-0001aa20: 6973 746f 7279 5365 6172 6368 4465 7363  istorySearchDesc
-0001aa30: 7269 7074 696f 6e2c 0d0a 2020 2020 2020  ription,..      
-0001aa40: 2020 2020 2020 7369 7a65 3d28 3330 302c        size=(300,
-0001aa50: 202d 3129 2c20 7374 796c 653d 7778 2e54   -1), style=wx.T
-0001aa60: 455f 5052 4f43 4553 535f 454e 5445 5229  E_PROCESS_ENTER)
-0001aa70: 0d0a 2020 2020 2020 2020 7365 6c66 2e42  ..        self.B
-0001aa80: 696e 6428 7778 2e45 5654 5f54 4558 545f  ind(wx.EVT_TEXT_
-0001aa90: 454e 5445 522c 2073 656c 662e 6f6e 5f73  ENTER, self.on_s
-0001aaa0: 6561 7263 6861 6c6c 2c20 6564 6974 5f73  earchall, edit_s
-0001aab0: 6561 7263 6829 0d0a 2020 2020 2020 2020  earch)..        
-0001aac0: 7462 203d 2073 656c 662e 7462 5f73 6561  tb = self.tb_sea
-0001aad0: 7263 6820 3d20 7778 2e54 6f6f 6c42 6172  rch = wx.ToolBar
-0001aae0: 2870 6172 656e 743d 7365 6c66 2c0d 0a20  (parent=self,.. 
-0001aaf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ab00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ab10: 2020 2020 2020 2020 7374 796c 653d 7778          style=wx
-0001ab20: 2e54 425f 464c 4154 207c 2077 782e 5442  .TB_FLAT | wx.TB
-0001ab30: 5f4e 4f44 4956 4944 4552 290d 0a0d 0a20  _NODIVIDER).... 
-0001ab40: 2020 2020 2020 2062 6d70 203d 2077 782e         bmp = wx.
-0001ab50: 4172 7450 726f 7669 6465 722e 4765 7442  ArtProvider.GetB
-0001ab60: 6974 6d61 7028 7778 2e41 5254 5f47 4f5f  itmap(wx.ART_GO_
-0001ab70: 464f 5257 4152 442c 2077 782e 4152 545f  FORWARD, wx.ART_
-0001ab80: 544f 4f4c 4241 522c 0d0a 2020 2020 2020  TOOLBAR,..      
-0001ab90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001abb0: 2028 3136 2c20 3136 2929 0d0a 2020 2020   (16, 16))..    
-0001abc0: 2020 2020 7462 2e53 6574 546f 6f6c 4269      tb.SetToolBi
-0001abd0: 746d 6170 5369 7a65 2862 6d70 2e53 697a  tmapSize(bmp.Siz
-0001abe0: 6529 0d0a 2020 2020 2020 2020 7462 2e41  e)..        tb.A
-0001abf0: 6464 546f 6f6c 2877 782e 4944 5f46 494e  ddTool(wx.ID_FIN
-0001ac00: 442c 2022 222c 2062 6974 6d61 703d 626d  D, "", bitmap=bm
-0001ac10: 702c 2073 686f 7274 4865 6c70 3d22 5374  p, shortHelp="St
-0001ac20: 6172 7420 7365 6172 6368 2229 0d0a 2020  art search")..  
-0001ac30: 2020 2020 2020 7462 2e52 6561 6c69 7a65        tb.Realize
-0001ac40: 2829 0d0a 2020 2020 2020 2020 7365 6c66  ()..        self
-0001ac50: 2e42 696e 6428 7778 2e45 5654 5f54 4f4f  .Bind(wx.EVT_TOO
-0001ac60: 4c2c 2073 656c 662e 6f6e 5f73 6561 7263  L, self.on_searc
-0001ac70: 6861 6c6c 2c20 6964 3d77 782e 4944 5f46  hall, id=wx.ID_F
-0001ac80: 494e 4429 0d0a 2020 2020 2020 2020 7369  IND)..        si
-0001ac90: 7a65 725f 6865 6164 6572 2e41 6464 2865  zer_header.Add(e
-0001aca0: 6469 745f 7365 6172 6368 2c20 626f 7264  dit_search, bord
-0001acb0: 6572 3d35 2c20 666c 6167 3d77 782e 5249  er=5, flag=wx.RI
-0001acc0: 4748 5429 0d0a 2020 2020 2020 2020 7369  GHT)..        si
-0001acd0: 7a65 725f 6865 6164 6572 2e41 6464 2874  zer_header.Add(t
-0001ace0: 622c 2066 6c61 673d 7778 2e47 524f 5729  b, flag=wx.GROW)
-0001acf0: 0d0a 2020 2020 2020 2020 7369 7a65 722e  ..        sizer.
-0001ad00: 4164 6428 7369 7a65 725f 6865 6164 6572  Add(sizer_header
-0001ad10: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0001ad20: 2020 2020 2062 6f72 6465 723d 352c 2066       border=5, f
-0001ad30: 6c61 673d 7778 2e4c 4546 5420 7c20 7778  lag=wx.LEFT | wx
-0001ad40: 2e52 4947 4854 207c 2077 782e 544f 5020  .RIGHT | wx.TOP 
-0001ad50: 7c20 7778 2e47 524f 5729 0d0a 2020 2020  | wx.GROW)..    
-0001ad60: 2020 2020 7369 7a65 722e 4c61 796f 7574      sizer.Layout
-0001ad70: 2829 2023 2054 6f20 6176 6f69 6420 7365  () # To avoid se
-0001ad80: 6172 6368 626f 7820 6d6f 7669 6e67 2061  archbox moving a
-0001ad90: 726f 756e 6420 6475 7269 6e67 2070 6167  round during pag
-0001ada0: 6520 6372 6561 7469 6f6e 0d0a 0d0a 2020  e creation....  
-0001adb0: 2020 2020 2020 6e6f 7465 626f 6f6b 203d        notebook =
-0001adc0: 2073 656c 662e 6e6f 7465 626f 6f6b 203d   self.notebook =
-0001add0: 2077 782e 6c69 622e 6167 772e 6c61 6265   wx.lib.agw.labe
-0001ade0: 6c62 6f6f 6b2e 466c 6174 496d 6167 6542  lbook.FlatImageB
-0001adf0: 6f6f 6b28 0d0a 2020 2020 2020 2020 2020  ook(..          
-0001ae00: 2020 7061 7265 6e74 3d73 656c 662c 2061    parent=self, a
-0001ae10: 6777 5374 796c 653d 7778 2e6c 6962 2e61  gwStyle=wx.lib.a
-0001ae20: 6777 2e66 6d72 6573 6f75 7263 6573 2e49  gw.fmresources.I
-0001ae30: 4e42 5f4c 4546 542c 2073 7479 6c65 3d77  NB_LEFT, style=w
-0001ae40: 782e 424f 5244 4552 5f53 5441 5449 4329  x.BORDER_STATIC)
-0001ae50: 0d0a 0d0a 2020 2020 2020 2020 696c 203d  ....        il =
-0001ae60: 2077 782e 496d 6167 654c 6973 7428 3332   wx.ImageList(32
-0001ae70: 2c20 3332 290d 0a20 2020 2020 2020 2069  , 32)..        i
-0001ae80: 6478 3120 3d20 696c 2e41 6464 2869 6d61  dx1 = il.Add(ima
-0001ae90: 6765 732e 5061 6765 5365 6172 6368 2e42  ges.PageSearch.B
-0001aea0: 6974 6d61 7029 0d0a 2020 2020 2020 2020  itmap)..        
-0001aeb0: 6964 7832 203d 2069 6c2e 4164 6428 696d  idx2 = il.Add(im
-0001aec0: 6167 6573 2e50 6167 6543 6861 7473 2e42  ages.PageChats.B
-0001aed0: 6974 6d61 7029 0d0a 2020 2020 2020 2020  itmap)..        
-0001aee0: 6964 7833 203d 2069 6c2e 4164 6428 696d  idx3 = il.Add(im
-0001aef0: 6167 6573 2e50 6167 6543 6f6e 7461 6374  ages.PageContact
-0001af00: 732e 4269 746d 6170 290d 0a20 2020 2020  s.Bitmap)..     
-0001af10: 2020 2069 6478 3420 3d20 696c 2e41 6464     idx4 = il.Add
-0001af20: 2869 6d61 6765 732e 5061 6765 496e 666f  (images.PageInfo
-0001af30: 2e42 6974 6d61 7029 0d0a 2020 2020 2020  .Bitmap)..      
-0001af40: 2020 6964 7835 203d 2069 6c2e 4164 6428    idx5 = il.Add(
-0001af50: 696d 6167 6573 2e50 6167 6554 6162 6c65  images.PageTable
-0001af60: 732e 4269 746d 6170 290d 0a20 2020 2020  s.Bitmap)..     
-0001af70: 2020 2069 6478 3620 3d20 696c 2e41 6464     idx6 = il.Add
-0001af80: 2869 6d61 6765 732e 5061 6765 5351 4c2e  (images.PageSQL.
-0001af90: 4269 746d 6170 290d 0a20 2020 2020 2020  Bitmap)..       
-0001afa0: 2069 6478 3720 3d20 696c 2e41 6464 2869   idx7 = il.Add(i
-0001afb0: 6d61 6765 732e 5061 6765 4f6e 6c69 6e65  mages.PageOnline
-0001afc0: 2e42 6974 6d61 7029 0d0a 2020 2020 2020  .Bitmap)..      
-0001afd0: 2020 6e6f 7465 626f 6f6b 2e41 7373 6967    notebook.Assig
-0001afe0: 6e49 6d61 6765 4c69 7374 2869 6c29 0d0a  nImageList(il)..
-0001aff0: 0d0a 2020 2020 2020 2020 7365 6c66 2e63  ..        self.c
-0001b000: 7265 6174 655f 7061 6765 5f73 6561 7263  reate_page_searc
-0001b010: 6828 6e6f 7465 626f 6f6b 290d 0a20 2020  h(notebook)..   
-0001b020: 2020 2020 2073 656c 662e 6372 6561 7465       self.create
-0001b030: 5f70 6167 655f 6368 6174 7328 6e6f 7465  _page_chats(note
-0001b040: 626f 6f6b 290d 0a20 2020 2020 2020 2073  book)..        s
-0001b050: 656c 662e 6372 6561 7465 5f70 6167 655f  elf.create_page_
-0001b060: 636f 6e74 6163 7473 286e 6f74 6562 6f6f  contacts(noteboo
-0001b070: 6b29 0d0a 2020 2020 2020 2020 7365 6c66  k)..        self
-0001b080: 2e63 7265 6174 655f 7061 6765 5f69 6e66  .create_page_inf
-0001b090: 6f28 6e6f 7465 626f 6f6b 290d 0a20 2020  o(notebook)..   
-0001b0a0: 2020 2020 2073 656c 662e 6372 6561 7465       self.create
-0001b0b0: 5f70 6167 655f 7461 626c 6573 286e 6f74  _page_tables(not
-0001b0c0: 6562 6f6f 6b29 0d0a 2020 2020 2020 2020  ebook)..        
-0001b0d0: 7365 6c66 2e63 7265 6174 655f 7061 6765  self.create_page
-0001b0e0: 5f73 716c 286e 6f74 6562 6f6f 6b29 0d0a  _sql(notebook)..
-0001b0f0: 2020 2020 2020 2020 7365 6c66 2e63 7265          self.cre
-0001b100: 6174 655f 7061 6765 5f6c 6976 6528 6e6f  ate_page_live(no
-0001b110: 7465 626f 6f6b 290d 0a0d 0a20 2020 2020  tebook)....     
-0001b120: 2020 206e 6f74 6562 6f6f 6b2e 5365 7450     notebook.SetP
-0001b130: 6167 6549 6d61 6765 2830 2c20 6964 7831  ageImage(0, idx1
-0001b140: 290d 0a20 2020 2020 2020 206e 6f74 6562  )..        noteb
-0001b150: 6f6f 6b2e 5365 7450 6167 6549 6d61 6765  ook.SetPageImage
-0001b160: 2831 2c20 6964 7832 290d 0a20 2020 2020  (1, idx2)..     
-0001b170: 2020 206e 6f74 6562 6f6f 6b2e 5365 7450     notebook.SetP
-0001b180: 6167 6549 6d61 6765 2832 2c20 6964 7833  ageImage(2, idx3
-0001b190: 290d 0a20 2020 2020 2020 206e 6f74 6562  )..        noteb
-0001b1a0: 6f6f 6b2e 5365 7450 6167 6549 6d61 6765  ook.SetPageImage
-0001b1b0: 2833 2c20 6964 7834 290d 0a20 2020 2020  (3, idx4)..     
-0001b1c0: 2020 206e 6f74 6562 6f6f 6b2e 5365 7450     notebook.SetP
-0001b1d0: 6167 6549 6d61 6765 2834 2c20 6964 7835  ageImage(4, idx5
-0001b1e0: 290d 0a20 2020 2020 2020 206e 6f74 6562  )..        noteb
-0001b1f0: 6f6f 6b2e 5365 7450 6167 6549 6d61 6765  ook.SetPageImage
-0001b200: 2835 2c20 6964 7836 290d 0a20 2020 2020  (5, idx6)..     
-0001b210: 2020 206e 6f74 6562 6f6f 6b2e 5365 7450     notebook.SetP
-0001b220: 6167 6549 6d61 6765 2836 2c20 6964 7837  ageImage(6, idx7
-0001b230: 290d 0a0d 0a20 2020 2020 2020 2073 697a  )....        siz
-0001b240: 6572 2e41 6464 286e 6f74 6562 6f6f 6b2c  er.Add(notebook,
-0001b250: 2070 726f 706f 7274 696f 6e3d 312c 2062   proportion=1, b
-0001b260: 6f72 6465 723d 352c 2066 6c61 673d 7778  order=5, flag=wx
-0001b270: 2e47 524f 5720 7c20 7778 2e41 4c4c 290d  .GROW | wx.ALL).
-0001b280: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
-0001b290: 6469 616c 6f67 5f73 6176 6563 6861 7420  dialog_savechat 
-0001b2a0: 3d20 7778 2e46 696c 6544 6961 6c6f 6728  = wx.FileDialog(
-0001b2b0: 0d0a 2020 2020 2020 2020 2020 2020 7061  ..            pa
-0001b2c0: 7265 6e74 3d73 656c 662c 206d 6573 7361  rent=self, messa
-0001b2d0: 6765 3d22 5361 7665 2063 6861 7422 2c20  ge="Save chat", 
-0001b2e0: 6465 6661 756c 7444 6972 3d73 6978 2e6d  defaultDir=six.m
-0001b2f0: 6f76 6573 2e67 6574 6377 6428 292c 0d0a  oves.getcwd(),..
-0001b300: 2020 2020 2020 2020 2020 2020 7769 6c64              wild
-0001b310: 6361 7264 3d65 7870 6f72 742e 4348 4154  card=export.CHAT
-0001b320: 5f57 494c 4443 4152 442c 0d0a 2020 2020  _WILDCARD,..    
-0001b330: 2020 2020 2020 2020 7374 796c 653d 7778          style=wx
-0001b340: 2e46 445f 5341 5645 207c 2077 782e 4644  .FD_SAVE | wx.FD
-0001b350: 5f4f 5645 5257 5249 5445 5f50 524f 4d50  _OVERWRITE_PROMP
-0001b360: 5420 7c20 7778 2e52 4553 495a 455f 424f  T | wx.RESIZE_BO
-0001b370: 5244 4552 0d0a 2020 2020 2020 2020 290d  RDER..        ).
-0001b380: 0a20 2020 2020 2020 2073 656c 662e 6469  .        self.di
-0001b390: 616c 6f67 5f73 6176 6563 6861 7473 203d  alog_savechats =
-0001b3a0: 2077 782e 4669 6c65 4469 616c 6f67 280d   wx.FileDialog(.
-0001b3b0: 0a20 2020 2020 2020 2020 2020 2070 6172  .            par
-0001b3c0: 656e 743d 7365 6c66 2c20 6d65 7373 6167  ent=self, messag
-0001b3d0: 653d 2243 686f 6f73 6520 666f 6c64 6572  e="Choose folder
-0001b3e0: 2077 6865 7265 2074 6f20 7361 7665 2063   where to save c
-0001b3f0: 6861 7420 6669 6c65 7322 2c0d 0a20 2020  hat files",..   
-0001b400: 2020 2020 2020 2020 2064 6566 6175 6c74           default
-0001b410: 4469 723d 7369 782e 6d6f 7665 732e 6765  Dir=six.moves.ge
-0001b420: 7463 7764 2829 2c20 6465 6661 756c 7446  tcwd(), defaultF
-0001b430: 696c 653d 2246 696c 656e 616d 6520 7769  ile="Filename wi
-0001b440: 6c6c 2062 6520 6967 6e6f 7265 6422 2c0d  ll be ignored",.
-0001b450: 0a20 2020 2020 2020 2020 2020 2077 696c  .            wil
-0001b460: 6463 6172 643d 6578 706f 7274 2e43 4841  dcard=export.CHA
-0001b470: 545f 5749 4c44 4341 5244 2c20 7374 796c  T_WILDCARD, styl
-0001b480: 653d 7778 2e46 445f 5341 5645 207c 2077  e=wx.FD_SAVE | w
-0001b490: 782e 5245 5349 5a45 5f42 4f52 4445 520d  x.RESIZE_BORDER.
-0001b4a0: 0a20 2020 2020 2020 2029 0d0a 2020 2020  .        )..    
-0001b4b0: 2020 2020 2320 4e65 6564 2073 6570 6172      # Need separ
-0001b4c0: 6174 6520 6469 616c 6f67 2077 2f6f 206f  ate dialog w/o o
-0001b4d0: 7665 7277 7269 7465 2070 726f 6d70 742c  verwrite prompt,
-0001b4e0: 2063 616e 6e6f 7420 7377 6170 2073 7479   cannot swap sty
-0001b4f0: 6c65 2069 6e20 4c69 6e75 780d 0a20 2020  le in Linux..   
-0001b500: 2020 2020 2073 656c 662e 6469 616c 6f67       self.dialog
-0001b510: 5f73 6176 6563 6861 7473 5f73 696e 676c  _savechats_singl
-0001b520: 6566 696c 6520 3d20 7778 2e46 696c 6544  efile = wx.FileD
-0001b530: 6961 6c6f 6728 0d0a 2020 2020 2020 2020  ialog(..        
-0001b540: 2020 2020 7061 7265 6e74 3d73 656c 662c      parent=self,
-0001b550: 206d 6573 7361 6765 3d22 5361 7665 2063   message="Save c
-0001b560: 6861 7473 2066 696c 6522 2c0d 0a20 2020  hats file",..   
-0001b570: 2020 2020 2020 2020 2064 6566 6175 6c74           default
-0001b580: 4469 723d 7369 782e 6d6f 7665 732e 6765  Dir=six.moves.ge
-0001b590: 7463 7764 2829 2c20 7769 6c64 6361 7264  tcwd(), wildcard
-0001b5a0: 3d65 7870 6f72 742e 4348 4154 5f57 494c  =export.CHAT_WIL
-0001b5b0: 4443 4152 445f 5349 4e47 4c45 4649 4c45  DCARD_SINGLEFILE
-0001b5c0: 2c0d 0a20 2020 2020 2020 2020 2020 2073  ,..            s
-0001b5d0: 7479 6c65 3d77 782e 4644 5f53 4156 4520  tyle=wx.FD_SAVE 
-0001b5e0: 7c20 7778 2e46 445f 4f56 4552 5752 4954  | wx.FD_OVERWRIT
-0001b5f0: 455f 5052 4f4d 5054 207c 2077 782e 5245  E_PROMPT | wx.RE
-0001b600: 5349 5a45 5f42 4f52 4445 520d 0a20 2020  SIZE_BORDER..   
-0001b610: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
-0001b620: 7365 6c66 2e64 6961 6c6f 675f 7361 7665  self.dialog_save
-0001b630: 6462 203d 2077 782e 4669 6c65 4469 616c  db = wx.FileDial
-0001b640: 6f67 280d 0a20 2020 2020 2020 2020 2020  og(..           
-0001b650: 2070 6172 656e 743d 7365 6c66 2c20 6d65   parent=self, me
-0001b660: 7373 6167 653d 2253 6176 6520 7265 636f  ssage="Save reco
-0001b670: 7665 7265 6420 6461 7461 2061 7322 2c0d  vered data as",.
-0001b680: 0a20 2020 2020 2020 2020 2020 2077 696c  .            wil
-0001b690: 6463 6172 643d 2253 514c 6974 6520 6461  dcard="SQLite da
-0001b6a0: 7461 6261 7365 2028 2a2e 6462 297c 2a2e  tabase (*.db)|*.
-0001b6b0: 6462 7c41 6c6c 2066 696c 6573 7c2a 2e2a  db|All files|*.*
-0001b6c0: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
-0001b6d0: 7374 796c 653d 7778 2e46 445f 5341 5645  style=wx.FD_SAVE
-0001b6e0: 207c 2077 782e 4644 5f4f 5645 5257 5249   | wx.FD_OVERWRI
-0001b6f0: 5445 5f50 524f 4d50 5420 7c20 7778 2e52  TE_PROMPT | wx.R
-0001b700: 4553 495a 455f 424f 5244 4552 0d0a 2020  ESIZE_BORDER..  
-0001b710: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
-0001b720: 2073 656c 662e 6469 616c 6f67 5f73 6176   self.dialog_sav
-0001b730: 6563 6f6e 7461 6374 7320 3d20 7778 2e46  econtacts = wx.F
-0001b740: 696c 6544 6961 6c6f 6728 0d0a 2020 2020  ileDialog(..    
-0001b750: 2020 2020 2020 2020 7061 7265 6e74 3d73          parent=s
-0001b760: 656c 662c 206d 6573 7361 6765 3d22 5361  elf, message="Sa
-0001b770: 7665 2063 6f6e 7461 6374 7322 2c20 6465  ve contacts", de
-0001b780: 6661 756c 7444 6972 3d73 6978 2e6d 6f76  faultDir=six.mov
-0001b790: 6573 2e67 6574 6377 6428 292c 0d0a 2020  es.getcwd(),..  
-0001b7a0: 2020 2020 2020 2020 2020 7769 6c64 6361            wildca
-0001b7b0: 7264 3d65 7870 6f72 742e 434f 4e54 4143  rd=export.CONTAC
-0001b7c0: 545f 5749 4c44 4341 5244 2c0d 0a20 2020  T_WILDCARD,..   
-0001b7d0: 2020 2020 2020 2020 2073 7479 6c65 3d77           style=w
-0001b7e0: 782e 4644 5f4f 5645 5257 5249 5445 5f50  x.FD_OVERWRITE_P
-0001b7f0: 524f 4d50 5420 7c20 7778 2e46 445f 5341  ROMPT | wx.FD_SA
-0001b800: 5645 207c 2077 782e 5245 5349 5a45 5f42  VE | wx.RESIZE_B
-0001b810: 4f52 4445 520d 0a20 2020 2020 2020 2029  ORDER..        )
-0001b820: 0d0a 2020 2020 2020 2020 7365 6c66 2e64  ..        self.d
-0001b830: 6961 6c6f 675f 7361 7665 6772 6964 203d  ialog_savegrid =
-0001b840: 2077 782e 4669 6c65 4469 616c 6f67 280d   wx.FileDialog(.
-0001b850: 0a20 2020 2020 2020 2020 2020 2070 6172  .            par
-0001b860: 656e 743d 7365 6c66 2c20 6465 6661 756c  ent=self, defaul
-0001b870: 7444 6972 3d73 6978 2e6d 6f76 6573 2e67  tDir=six.moves.g
-0001b880: 6574 6377 6428 292c 2077 696c 6463 6172  etcwd(), wildcar
-0001b890: 643d 6578 706f 7274 2e44 4154 415f 5749  d=export.DATA_WI
-0001b8a0: 4c44 4341 5244 2c0d 0a20 2020 2020 2020  LDCARD,..       
-0001b8b0: 2020 2020 2073 7479 6c65 3d77 782e 4644       style=wx.FD
-0001b8c0: 5f4f 5645 5257 5249 5445 5f50 524f 4d50  _OVERWRITE_PROMP
-0001b8d0: 5420 7c20 7778 2e46 445f 5341 5645 207c  T | wx.FD_SAVE |
-0001b8e0: 2077 782e 5245 5349 5a45 5f42 4f52 4445   wx.RESIZE_BORDE
-0001b8f0: 520d 0a20 2020 2020 2020 2029 0d0a 2020  R..        )..  
-0001b900: 2020 2020 2020 7365 6c66 2e64 6961 6c6f        self.dialo
-0001b910: 675f 7361 7665 696d 6167 6520 3d20 7778  g_saveimage = wx
-0001b920: 2e46 696c 6544 6961 6c6f 6728 0d0a 2020  .FileDialog(..  
-0001b930: 2020 2020 2020 2020 2020 7061 7265 6e74            parent
-0001b940: 3d73 656c 662c 206d 6573 7361 6765 3d22  =self, message="
-0001b950: 5361 7665 2069 6d61 6765 2061 7322 2c0d  Save image as",.
-0001b960: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
-0001b970: 6175 6c74 4469 723d 7369 782e 6d6f 7665  aultDir=six.move
-0001b980: 732e 6765 7463 7764 2829 2c20 7769 6c64  s.getcwd(), wild
-0001b990: 6361 7264 3d65 7870 6f72 742e 494d 4147  card=export.IMAG
-0001b9a0: 455f 5749 4c44 4341 5244 2c0d 0a20 2020  E_WILDCARD,..   
-0001b9b0: 2020 2020 2020 2020 2073 7479 6c65 3d77           style=w
-0001b9c0: 782e 4644 5f53 4156 4520 7c20 7778 2e46  x.FD_SAVE | wx.F
-0001b9d0: 445f 4f56 4552 5752 4954 455f 5052 4f4d  D_OVERWRITE_PROM
-0001b9e0: 5054 207c 2077 782e 4644 5f43 4841 4e47  PT | wx.FD_CHANG
-0001b9f0: 455f 4449 5220 7c20 7778 2e52 4553 495a  E_DIR | wx.RESIZ
-0001ba00: 455f 424f 5244 4552 0d0a 2020 2020 2020  E_BORDER..      
-0001ba10: 2020 290d 0a20 2020 2020 2020 2073 656c    )..        sel
-0001ba20: 662e 6469 616c 6f67 5f73 6176 6563 6861  f.dialog_savecha
-0001ba30: 7420 2020 202e 4669 6c74 6572 496e 6465  t    .FilterInde
-0001ba40: 7820 3d20 6578 706f 7274 2e43 4841 545f  x = export.CHAT_
-0001ba50: 4558 5453 2e69 6e64 6578 2822 6874 6d6c  EXTS.index("html
-0001ba60: 2229 0d0a 2020 2020 2020 2020 7365 6c66  ")..        self
-0001ba70: 2e64 6961 6c6f 675f 7361 7665 6368 6174  .dialog_savechat
-0001ba80: 7320 2020 2e46 696c 7465 7249 6e64 6578  s   .FilterIndex
-0001ba90: 203d 2065 7870 6f72 742e 4348 4154 5f45   = export.CHAT_E
-0001baa0: 5854 532e 696e 6465 7828 2268 746d 6c22  XTS.index("html"
-0001bab0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-0001bac0: 6469 616c 6f67 5f73 6176 6563 6f6e 7461  dialog_saveconta
-0001bad0: 6374 732e 4669 6c74 6572 496e 6465 7820  cts.FilterIndex 
-0001bae0: 3d20 6578 706f 7274 2e43 4f4e 5441 4354  = export.CONTACT
-0001baf0: 5f45 5854 532e 696e 6465 7828 2268 746d  _EXTS.index("htm
-0001bb00: 6c22 290d 0a20 2020 2020 2020 2073 656c  l")..        sel
-0001bb10: 662e 6469 616c 6f67 5f73 6176 6567 7269  f.dialog_savegri
-0001bb20: 6420 2020 202e 4669 6c74 6572 496e 6465  d    .FilterInde
-0001bb30: 7820 3d20 6578 706f 7274 2e44 4154 415f  x = export.DATA_
-0001bb40: 4558 5453 2e69 6e64 6578 2822 6874 6d6c  EXTS.index("html
-0001bb50: 2229 0d0a 2020 2020 2020 2020 7365 6c66  ")..        self
-0001bb60: 2e64 6961 6c6f 675f 7361 7665 696d 6167  .dialog_saveimag
-0001bb70: 6520 2020 2e46 696c 7465 7249 6e64 6578  e   .FilterIndex
-0001bb80: 203d 2065 7870 6f72 742e 494d 4147 455f   = export.IMAGE_
-0001bb90: 4558 5453 2e69 6e64 6578 2822 706e 6722  EXTS.index("png"
-0001bba0: 290d 0a0d 0a20 2020 2020 2020 2073 656c  )....        sel
-0001bbb0: 662e 546f 704c 6576 656c 5061 7265 6e74  f.TopLevelParent
-0001bbc0: 2e70 6167 655f 6462 5f6c 6174 6573 7420  .page_db_latest 
-0001bbd0: 3d20 7365 6c66 0d0a 2020 2020 2020 2020  = self..        
-0001bbe0: 7365 6c66 2e54 6f70 4c65 7665 6c50 6172  self.TopLevelPar
-0001bbf0: 656e 742e 7275 6e5f 636f 6e73 6f6c 6528  ent.run_console(
-0001bc00: 0d0a 2020 2020 2020 2020 2020 2020 2270  ..            "p
-0001bc10: 6167 6520 3d20 7365 6c66 2e70 6167 655f  age = self.page_
-0001bc20: 6462 5f6c 6174 6573 7420 2320 4461 7461  db_latest # Data
-0001bc30: 6261 7365 2074 6162 2229 0d0a 2020 2020  base tab")..    
-0001bc40: 2020 2020 7365 6c66 2e54 6f70 4c65 7665      self.TopLeve
-0001bc50: 6c50 6172 656e 742e 7275 6e5f 636f 6e73  lParent.run_cons
-0001bc60: 6f6c 6528 2264 6220 3d20 7061 6765 2e64  ole("db = page.d
-0001bc70: 6220 2320 5351 4c69 7465 2064 6174 6162  b # SQLite datab
-0001bc80: 6173 6520 7772 6170 7065 7222 290d 0a0d  ase wrapper")...
-0001bc90: 0a20 2020 2020 2020 2073 656c 662e 4c61  .        self.La
-0001bca0: 796f 7574 2829 0d0a 2020 2020 2020 2020  yout()..        
-0001bcb0: 7365 6c66 2e74 6f67 676c 655f 6669 6c74  self.toggle_filt
-0001bcc0: 6572 2854 7275 6529 0d0a 2020 2020 2020  er(True)..      
-0001bcd0: 2020 2320 4861 636b 2074 6f20 6765 7420    # Hack to get 
-0001bce0: 696e 666f 2d70 6167 6520 6d75 6c74 696c  info-page multil
-0001bcf0: 696e 6520 5465 7874 4374 726c 7320 746f  ine TextCtrls to
-0001bd00: 206c 6179 6f75 7420 7769 7468 6f75 7420   layout without 
-0001bd10: 7175 6972 6b73 2e0d 0a20 2020 2020 2020  quirks...       
-0001bd20: 2073 656c 662e 6e6f 7465 626f 6f6b 2e53   self.notebook.S
-0001bd30: 6574 5365 6c65 6374 696f 6e28 7365 6c66  etSelection(self
-0001bd40: 2e70 6167 656f 7264 6572 5b73 656c 662e  .pageorder[self.
-0001bd50: 7061 6765 5f69 6e66 6f5d 290d 0a20 2020  page_info])..   
-0001bd60: 2020 2020 2023 2048 6163 6b20 746f 2067       # Hack to g
-0001bd70: 6574 2063 6861 7473 2d70 6167 6520 6669  et chats-page fi
-0001bd80: 6c74 6572 2073 706c 6974 2077 696e 646f  lter split windo
-0001bd90: 7720 746f 206c 6179 6f75 7420 7769 7468  w to layout with
-0001bda0: 6f75 7420 7175 6972 6b73 2e0d 0a20 2020  out quirks...   
-0001bdb0: 2020 2020 2073 656c 662e 6e6f 7465 626f       self.notebo
-0001bdc0: 6f6b 2e53 6574 5365 6c65 6374 696f 6e28  ok.SetSelection(
-0001bdd0: 7365 6c66 2e70 6167 656f 7264 6572 5b73  self.pageorder[s
-0001bde0: 656c 662e 7061 6765 5f63 6861 7473 5d29  elf.page_chats])
-0001bdf0: 0d0a 2020 2020 2020 2020 7365 6c66 2e6e  ..        self.n
-0001be00: 6f74 6562 6f6f 6b2e 5365 7453 656c 6563  otebook.SetSelec
-0001be10: 7469 6f6e 2873 656c 662e 7061 6765 6f72  tion(self.pageor
-0001be20: 6465 725b 7365 6c66 2e70 6167 655f 7365  der[self.page_se
-0001be30: 6172 6368 5d29 0d0a 2020 2020 2020 2020  arch])..        
-0001be40: 2320 5265 7374 6f72 6520 6c61 7374 2061  # Restore last a
-0001be50: 6374 6976 6520 7061 6765 0d0a 2020 2020  ctive page..    
-0001be60: 2020 2020 6966 2064 622e 6669 6c65 6e61      if db.filena
-0001be70: 6d65 2069 6e20 636f 6e66 2e4c 6173 7441  me in conf.LastA
-0001be80: 6374 6976 6550 6167 6520 5c0d 0a20 2020  ctivePage \..   
-0001be90: 2020 2020 2061 6e64 2063 6f6e 662e 4c61       and conf.La
-0001bea0: 7374 4163 7469 7665 5061 6765 5b64 622e  stActivePage[db.
-0001beb0: 6669 6c65 6e61 6d65 5d20 213d 2073 656c  filename] != sel
-0001bec0: 662e 6e6f 7465 626f 6f6b 2e53 656c 6563  f.notebook.Selec
-0001bed0: 7469 6f6e 3a0d 0a20 2020 2020 2020 2020  tion:..         
-0001bee0: 2020 2073 656c 662e 6e6f 7465 626f 6f6b     self.notebook
-0001bef0: 2e53 6574 5365 6c65 6374 696f 6e28 636f  .SetSelection(co
-0001bf00: 6e66 2e4c 6173 7441 6374 6976 6550 6167  nf.LastActivePag
-0001bf10: 655b 6462 2e66 696c 656e 616d 655d 290d  e[db.filename]).
-0001bf20: 0a0d 0a20 2020 2020 2020 2074 7279 3a0d  ...        try:.
-0001bf30: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0001bf40: 662e 6c6f 6164 5f64 6174 6128 290d 0a20  f.load_data().. 
-0001bf50: 2020 2020 2020 2066 696e 616c 6c79 3a0d         finally:.
-0001bf60: 0a20 2020 2020 2020 2020 2020 2062 7573  .            bus
-0001bf70: 792e 436c 6f73 6528 290d 0a20 2020 2020  y.Close()..     
-0001bf80: 2020 2073 656c 662e 6564 6974 5f73 6561     self.edit_sea
-0001bf90: 7263 6861 6c6c 2e53 6574 466f 6375 7328  rchall.SetFocus(
-0001bfa0: 290d 0a20 2020 2020 2020 2077 782e 4361  )..        wx.Ca
-0001bfb0: 6c6c 4166 7465 7228 7365 6c66 2e65 6469  llAfter(self.edi
-0001bfc0: 745f 7365 6172 6368 616c 6c2e 5365 6c65  t_searchall.Sele
-0001bfd0: 6374 416c 6c29 0d0a 0d0a 0d0a 2020 2020  ctAll)......    
-0001bfe0: 6465 6620 6372 6561 7465 5f70 6167 655f  def create_page_
-0001bff0: 6368 6174 7328 7365 6c66 2c20 6e6f 7465  chats(self, note
-0001c000: 626f 6f6b 293a 0d0a 2020 2020 2020 2020  book):..        
-0001c010: 2222 2243 7265 6174 6573 2061 2070 6167  """Creates a pag
-0001c020: 6520 666f 7220 6c69 7374 696e 6720 616e  e for listing an
-0001c030: 6420 7265 6164 696e 6720 6368 6174 732e  d reading chats.
-0001c040: 2222 220d 0a20 2020 2020 2020 2070 6167  """..        pag
-0001c050: 6520 3d20 7365 6c66 2e70 6167 655f 6368  e = self.page_ch
-0001c060: 6174 7320 3d20 7778 2e50 616e 656c 2870  ats = wx.Panel(p
-0001c070: 6172 656e 743d 6e6f 7465 626f 6f6b 290d  arent=notebook).
-0001c080: 0a20 2020 2020 2020 2073 656c 662e 7061  .        self.pa
-0001c090: 6765 6f72 6465 725b 7061 6765 5d20 3d20  georder[page] = 
-0001c0a0: 6c65 6e28 7365 6c66 2e70 6167 656f 7264  len(self.pageord
-0001c0b0: 6572 290d 0a20 2020 2020 2020 206e 6f74  er)..        not
-0001c0c0: 6562 6f6f 6b2e 4164 6450 6167 6528 7061  ebook.AddPage(pa
-0001c0d0: 6765 2c20 2243 6861 7473 2229 0d0a 2020  ge, "Chats")..  
-0001c0e0: 2020 2020 2020 7369 7a65 7220 3d20 7061        sizer = pa
-0001c0f0: 6765 2e53 697a 6572 203d 2077 782e 426f  ge.Sizer = wx.Bo
-0001c100: 7853 697a 6572 2877 782e 5645 5254 4943  xSizer(wx.VERTIC
-0001c110: 414c 290d 0a20 2020 2020 2020 2073 706c  AL)..        spl
-0001c120: 6974 7465 7220 3d20 7365 6c66 2e73 706c  itter = self.spl
-0001c130: 6974 7465 725f 6368 6174 7320 3d20 7778  itter_chats = wx
-0001c140: 2e53 706c 6974 7465 7257 696e 646f 7728  .SplitterWindow(
-0001c150: 0d0a 2020 2020 2020 2020 2020 2020 7061  ..            pa
-0001c160: 7265 6e74 3d70 6167 652c 2073 7479 6c65  rent=page, style
-0001c170: 3d77 782e 424f 5244 4552 5f4e 4f4e 450d  =wx.BORDER_NONE.
-0001c180: 0a20 2020 2020 2020 2029 0d0a 2020 2020  .        )..    
-0001c190: 2020 2020 7370 6c69 7474 6572 2e53 6574      splitter.Set
-0001c1a0: 4d69 6e69 6d75 6d50 616e 6553 697a 6528  MinimumPaneSize(
-0001c1b0: 3130 3029 0d0a 0d0a 2020 2020 2020 2020  100)....        
-0001c1c0: 7061 6e65 6c31 203d 2073 656c 662e 7061  panel1 = self.pa
-0001c1d0: 6e65 6c5f 6368 6174 7331 203d 2077 782e  nel_chats1 = wx.
-0001c1e0: 5061 6e65 6c28 7061 7265 6e74 3d73 706c  Panel(parent=spl
-0001c1f0: 6974 7465 7229 0d0a 2020 2020 2020 2020  itter)..        
-0001c200: 7369 7a65 7231 203d 2070 616e 656c 312e  sizer1 = panel1.
-0001c210: 5369 7a65 7220 3d20 7778 2e42 6f78 5369  Sizer = wx.BoxSi
-0001c220: 7a65 7228 7778 2e56 4552 5449 4341 4c29  zer(wx.VERTICAL)
-0001c230: 0d0a 2020 2020 2020 2020 7369 7a65 725f  ..        sizer_
-0001c240: 746f 7020 3d20 7778 2e42 6f78 5369 7a65  top = wx.BoxSize
-0001c250: 7228 7778 2e48 4f52 495a 4f4e 5441 4c29  r(wx.HORIZONTAL)
-0001c260: 0d0a 2020 2020 2020 2020 7365 6c66 2e6c  ..        self.l
-0001c270: 6162 656c 5f6c 6973 745f 6368 6174 7320  abel_list_chats 
-0001c280: 3d20 7778 2e53 7461 7469 6354 6578 7428  = wx.StaticText(
-0001c290: 7061 6e65 6c31 2c20 6c61 6265 6c3d 2241  panel1, label="A
-0001c2a0: 266c 6c20 6368 6174 2065 6e74 7269 6573  &ll chat entries
-0001c2b0: 2069 6e20 6461 7461 6261 7365 3a22 290d   in database:").
-0001c2c0: 0a20 2020 2020 2020 2073 697a 6572 5f74  .        sizer_t
-0001c2d0: 6f70 2e41 6464 2873 656c 662e 6c61 6265  op.Add(self.labe
-0001c2e0: 6c5f 6c69 7374 5f63 6861 7473 2c20 7072  l_list_chats, pr
-0001c2f0: 6f70 6f72 7469 6f6e 3d31 2c20 626f 7264  oportion=1, bord
-0001c300: 6572 3d35 2c20 666c 6167 3d77 782e 414c  er=5, flag=wx.AL
-0001c310: 4947 4e5f 424f 5454 4f4d 290d 0a20 2020  IGN_BOTTOM)..   
-0001c320: 2020 2020 206c 6973 745f 6368 6174 7320       list_chats 
-0001c330: 3d20 7365 6c66 2e6c 6973 745f 6368 6174  = self.list_chat
-0001c340: 7320 3d20 636f 6e74 726f 6c73 2e53 6f72  s = controls.Sor
-0001c350: 7461 626c 654c 6973 7456 6965 7728 0d0a  tableListView(..
-0001c360: 2020 2020 2020 2020 2020 2020 7061 7265              pare
-0001c370: 6e74 3d70 616e 656c 312c 2073 7479 6c65  nt=panel1, style
-0001c380: 3d77 782e 4c43 5f52 4550 4f52 5429 0d0a  =wx.LC_REPORT)..
-0001c390: 2020 2020 2020 2020 636f 6c75 6d6e 7320          columns 
-0001c3a0: 3d20 5b28 2274 6974 6c65 222c 2022 4368  = [("title", "Ch
-0001c3b0: 6174 2229 2c20 2822 6d65 7373 6167 655f  at"), ("message_
-0001c3c0: 636f 756e 7422 2c20 224d 6573 7361 6765  count", "Message
-0001c3d0: 7322 292c 0d0a 2020 2020 2020 2020 2020  s"),..          
-0001c3e0: 2020 2020 2020 2020 2028 2263 7265 6174           ("creat
-0001c3f0: 6564 5f64 6174 6574 696d 6522 2c20 2243  ed_datetime", "C
-0001c400: 7265 6174 6564 2229 2c0d 0a20 2020 2020  reated"),..     
-0001c410: 2020 2020 2020 2020 2020 2020 2020 2822                ("
-0001c420: 6669 7273 745f 6d65 7373 6167 655f 6461  first_message_da
-0001c430: 7465 7469 6d65 222c 2022 4669 7273 7420  tetime", "First 
-0001c440: 6d65 7373 6167 6522 292c 0d0a 2020 2020  message"),..    
-0001c450: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-0001c460: 226c 6173 745f 6d65 7373 6167 655f 6461  "last_message_da
-0001c470: 7465 7469 6d65 222c 2022 4c61 7374 206d  tetime", "Last m
-0001c480: 6573 7361 6765 2229 2c0d 0a20 2020 2020  essage"),..     
-0001c490: 2020 2020 2020 2020 2020 2020 2020 2822                ("
-0001c4a0: 7479 7065 5f6e 616d 6522 2c20 2254 7970  type_name", "Typ
-0001c4b0: 6522 292c 2028 2270 656f 706c 6522 2c20  e"), ("people", 
-0001c4c0: 2250 656f 706c 6522 292c 205d 0d0a 2020  "People"), ]..  
-0001c4d0: 2020 2020 2020 6672 6d74 203d 206c 616d        frmt = lam
-0001c4e0: 6264 6120 722c 2063 3a20 725b 635d 2e73  bda r, c: r[c].s
-0001c4f0: 7472 6674 696d 6528 2225 592d 256d 2d25  trftime("%Y-%m-%
-0001c500: 6420 2548 3a25 4d22 2920 6966 2072 2e67  d %H:%M") if r.g
-0001c510: 6574 2863 2920 656c 7365 2022 220d 0a20  et(c) else "".. 
-0001c520: 2020 2020 2020 2066 726d 745f 6474 203d         frmt_dt =
-0001c530: 206c 616d 6264 6120 722c 2063 3a20 725b   lambda r, c: r[
-0001c540: 635d 2e73 7472 6674 696d 6528 2225 592d  c].strftime("%Y-
-0001c550: 256d 2d25 6422 2920 6966 2072 2e67 6574  %m-%d") if r.get
-0001c560: 2863 2920 656c 7365 2022 220d 0a20 2020  (c) else ""..   
-0001c570: 2020 2020 2066 6f72 6d61 7474 6572 7320       formatters 
-0001c580: 3d20 7b22 6372 6561 7465 645f 6461 7465  = {"created_date
-0001c590: 7469 6d65 223a 2066 726d 745f 6474 2c0d  time": frmt_dt,.
-0001c5a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c5b0: 2020 2020 2020 2022 6669 7273 745f 6d65         "first_me
-0001c5c0: 7373 6167 655f 6461 7465 7469 6d65 223a  ssage_datetime":
-0001c5d0: 2066 726d 742c 0d0a 2020 2020 2020 2020   frmt,..        
-0001c5e0: 2020 2020 2020 2020 2020 2020 2020 226c                "l
-0001c5f0: 6173 745f 6d65 7373 6167 655f 6461 7465  ast_message_date
-0001c600: 7469 6d65 223a 2066 726d 742c 207d 0d0a  time": frmt, }..
-0001c610: 2020 2020 2020 2020 6c69 7374 5f63 6861          list_cha
-0001c620: 7473 2e53 6574 436f 6c75 6d6e 7328 636f  ts.SetColumns(co
-0001c630: 6c75 6d6e 7329 0d0a 2020 2020 2020 2020  lumns)..        
-0001c640: 6c69 7374 5f63 6861 7473 2e53 6574 436f  list_chats.SetCo
-0001c650: 6c75 6d6e 466f 726d 6174 7465 7273 2866  lumnFormatters(f
-0001c660: 6f72 6d61 7474 6572 7329 0d0a 2020 2020  ormatters)..    
-0001c670: 2020 2020 6c69 7374 5f63 6861 7473 2e53      list_chats.S
-0001c680: 6574 436f 6c75 6d6e 734d 6178 5769 6474  etColumnsMaxWidt
-0001c690: 6828 3330 3029 0d0a 2020 2020 2020 2020  h(300)..        
-0001c6a0: 6564 6974 5f63 6861 7466 696c 7465 7220  edit_chatfilter 
-0001c6b0: 3d20 7365 6c66 2e65 6469 745f 6368 6174  = self.edit_chat
-0001c6c0: 6669 6c74 6572 203d 2063 6f6e 7472 6f6c  filter = control
-0001c6d0: 732e 4869 6e74 6564 5465 7874 4374 726c  s.HintedTextCtrl
-0001c6e0: 280d 0a20 2020 2020 2020 2020 2020 2070  (..            p
-0001c6f0: 616e 656c 312c 2022 4669 6c74 6572 206c  anel1, "Filter l
-0001c700: 6973 7422 2c20 7369 7a65 3d28 3735 2c20  ist", size=(75, 
-0001c710: 2d31 2929 0d0a 2020 2020 2020 2020 6564  -1))..        ed
-0001c720: 6974 5f63 6861 7466 696c 7465 722e 5365  it_chatfilter.Se
-0001c730: 7454 6f6f 6c54 6970 2822 4669 6c74 6572  tToolTip("Filter
-0001c740: 2069 7465 6d73 2069 6e20 6368 6174 206c   items in chat l
-0001c750: 6973 7422 290d 0a20 2020 2020 2020 2073  ist")..        s
-0001c760: 656c 662e 4269 6e64 2877 782e 4556 545f  elf.Bind(wx.EVT_
-0001c770: 5445 5854 5f45 4e54 4552 2c20 7365 6c66  TEXT_ENTER, self
-0001c780: 2e6f 6e5f 6368 616e 6765 5f63 6861 7466  .on_change_chatf
-0001c790: 696c 7465 722c 2065 6469 745f 6368 6174  ilter, edit_chat
-0001c7a0: 6669 6c74 6572 290d 0a20 2020 2020 2020  filter)..       
-0001c7b0: 2073 697a 6572 5f74 6f70 2e41 6464 2865   sizer_top.Add(e
-0001c7c0: 6469 745f 6368 6174 6669 6c74 6572 2c20  dit_chatfilter, 
-0001c7d0: 666c 6167 3d77 782e 5249 4748 542c 2062  flag=wx.RIGHT, b
-0001c7e0: 6f72 6465 723d 3135 290d 0a20 2020 2020  order=15)..     
-0001c7f0: 2020 2062 7574 746f 6e5f 6578 706f 7274     button_export
-0001c800: 5f63 6861 7473 203d 2073 656c 662e 6275  _chats = self.bu
-0001c810: 7474 6f6e 5f65 7870 6f72 745f 6368 6174  tton_export_chat
-0001c820: 7320 3d20 5c0d 0a20 2020 2020 2020 2020  s = \..         
-0001c830: 2020 2077 782e 4275 7474 6f6e 2870 6172     wx.Button(par
-0001c840: 656e 743d 7061 6e65 6c31 2c20 6c61 6265  ent=panel1, labe
-0001c850: 6c3d 2245 7870 266f 7274 2063 6861 7473  l="Exp&ort chats
-0001c860: 2229 0d0a 2020 2020 2020 2020 7369 7a65  ")..        size
-0001c870: 725f 746f 702e 4164 6428 6275 7474 6f6e  r_top.Add(button
-0001c880: 5f65 7870 6f72 745f 6368 6174 7329 0d0a  _export_chats)..
-0001c890: 2020 2020 2020 2020 7365 6c66 2e42 696e          self.Bin
-0001c8a0: 6428 7778 2e45 5654 5f42 5554 544f 4e2c  d(wx.EVT_BUTTON,
-0001c8b0: 2073 656c 662e 6f6e 5f65 7870 6f72 745f   self.on_export_
-0001c8c0: 6368 6174 735f 6d65 6e75 2c20 6275 7474  chats_menu, butt
-0001c8d0: 6f6e 5f65 7870 6f72 745f 6368 6174 7329  on_export_chats)
-0001c8e0: 0d0a 2020 2020 2020 2020 7369 7a65 7231  ..        sizer1
-0001c8f0: 2e41 6464 2873 697a 6572 5f74 6f70 2c20  .Add(sizer_top, 
-0001c900: 626f 7264 6572 3d35 2c0d 0a20 2020 2020  border=5,..     
-0001c910: 2020 2020 2020 2020 2020 2020 2020 666c                fl
-0001c920: 6167 3d77 782e 5249 4748 5420 7c20 7778  ag=wx.RIGHT | wx
-0001c930: 2e4c 4546 5420 7c20 7778 2e42 4f54 544f  .LEFT | wx.BOTTO
-0001c940: 4d20 7c20 7778 2e47 524f 5729 0d0a 0d0a  M | wx.GROW)....
-0001c950: 2020 2020 2020 2020 7365 6c66 2e42 696e          self.Bin
-0001c960: 6428 7778 2e45 5654 5f4c 4953 545f 4954  d(wx.EVT_LIST_IT
-0001c970: 454d 5f41 4354 4956 4154 4544 2c0d 0a20  EM_ACTIVATED,.. 
-0001c980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c990: 2073 656c 662e 6f6e 5f63 6861 6e67 655f   self.on_change_
-0001c9a0: 6c69 7374 5f63 6861 7473 2c20 6c69 7374  list_chats, list
-0001c9b0: 5f63 6861 7473 290d 0a20 2020 2020 2020  _chats)..       
-0001c9c0: 206c 6973 745f 6368 6174 732e 4269 6e64   list_chats.Bind
-0001c9d0: 2877 782e 4556 545f 434f 4e54 4558 545f  (wx.EVT_CONTEXT_
-0001c9e0: 4d45 4e55 2c20 7365 6c66 2e6f 6e5f 6d65  MENU, self.on_me
-0001c9f0: 6e75 5f6c 6973 745f 6368 6174 7329 0d0a  nu_list_chats)..
-0001ca00: 2020 2020 2020 2020 6c69 7374 5f63 6861          list_cha
-0001ca10: 7473 2e42 696e 6428 7778 2e45 5654 5f43  ts.Bind(wx.EVT_C
-0001ca20: 4841 525f 484f 4f4b 2c20 2020 2073 656c  HAR_HOOK,    sel
-0001ca30: 662e 6f6e 5f6c 6973 745f 6368 6174 735f  f.on_list_chats_
-0001ca40: 6b65 7929 0d0a 0d0a 2020 2020 2020 2020  key)....        
-0001ca50: 7369 7a65 7231 2e41 6464 286c 6973 745f  sizer1.Add(list_
-0001ca60: 6368 6174 732c 2070 726f 706f 7274 696f  chats, proportio
-0001ca70: 6e3d 312c 2062 6f72 6465 723d 352c 0d0a  n=1, border=5,..
-0001ca80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ca90: 2020 2066 6c61 673d 7778 2e47 524f 5720     flag=wx.GROW 
-0001caa0: 7c20 7778 2e4c 4546 5420 7c20 7778 2e52  | wx.LEFT | wx.R
-0001cab0: 4947 4854 290d 0a0d 0a20 2020 2020 2020  IGHT)....       
-0001cac0: 2070 616e 656c 3220 3d20 7365 6c66 2e70   panel2 = self.p
-0001cad0: 616e 656c 5f63 6861 7473 3220 3d20 7778  anel_chats2 = wx
-0001cae0: 2e50 616e 656c 2870 6172 656e 743d 7370  .Panel(parent=sp
-0001caf0: 6c69 7474 6572 290d 0a20 2020 2020 2020  litter)..       
-0001cb00: 2073 697a 6572 3220 3d20 7061 6e65 6c32   sizer2 = panel2
-0001cb10: 2e53 697a 6572 203d 2077 782e 426f 7853  .Sizer = wx.BoxS
-0001cb20: 697a 6572 2877 782e 5645 5254 4943 414c  izer(wx.VERTICAL
-0001cb30: 290d 0a0d 0a20 2020 2020 2020 2073 706c  )....        spl
-0001cb40: 6974 7465 725f 7374 6320 3d20 7365 6c66  itter_stc = self
-0001cb50: 2e73 706c 6974 7465 725f 7374 6320 3d20  .splitter_stc = 
-0001cb60: 5c0d 0a20 2020 2020 2020 2020 2020 2077  \..            w
-0001cb70: 782e 5370 6c69 7474 6572 5769 6e64 6f77  x.SplitterWindow
-0001cb80: 2870 6172 656e 743d 7061 6e65 6c32 2c20  (parent=panel2, 
-0001cb90: 7374 796c 653d 7778 2e42 4f52 4445 525f  style=wx.BORDER_
-0001cba0: 4e4f 4e45 290d 0a20 2020 2020 2020 2073  NONE)..        s
-0001cbb0: 706c 6974 7465 725f 7374 632e 5365 744d  plitter_stc.SetM
-0001cbc0: 696e 696d 756d 5061 6e65 5369 7a65 2831  inimumPaneSize(1
-0001cbd0: 3030 290d 0a20 2020 2020 2020 2070 616e  00)..        pan
-0001cbe0: 656c 5f73 7463 3120 3d20 7365 6c66 2e70  el_stc1 = self.p
-0001cbf0: 616e 656c 5f73 7463 3120 3d20 7778 2e50  anel_stc1 = wx.P
-0001cc00: 616e 656c 2870 6172 656e 743d 7370 6c69  anel(parent=spli
-0001cc10: 7474 6572 5f73 7463 290d 0a20 2020 2020  tter_stc)..     
-0001cc20: 2020 2070 616e 656c 5f73 7463 3220 3d20     panel_stc2 = 
-0001cc30: 7365 6c66 2e70 616e 656c 5f73 7463 3220  self.panel_stc2 
-0001cc40: 3d20 7778 2e50 616e 656c 2870 6172 656e  = wx.Panel(paren
-0001cc50: 743d 7370 6c69 7474 6572 5f73 7463 290d  t=splitter_stc).
-0001cc60: 0a20 2020 2020 2020 2073 697a 6572 5f73  .        sizer_s
-0001cc70: 7463 3120 3d20 7061 6e65 6c5f 7374 6331  tc1 = panel_stc1
-0001cc80: 2e53 697a 6572 203d 2077 782e 426f 7853  .Sizer = wx.BoxS
-0001cc90: 697a 6572 2877 782e 5645 5254 4943 414c  izer(wx.VERTICAL
-0001cca0: 290d 0a20 2020 2020 2020 2073 697a 6572  )..        sizer
-0001ccb0: 5f73 7463 3220 3d20 7061 6e65 6c5f 7374  _stc2 = panel_st
-0001ccc0: 6332 2e53 697a 6572 203d 2077 782e 426f  c2.Sizer = wx.Bo
-0001ccd0: 7853 697a 6572 2877 782e 5645 5254 4943  xSizer(wx.VERTIC
-0001cce0: 414c 290d 0a20 2020 2020 2020 2073 697a  AL)..        siz
-0001ccf0: 6572 5f73 7463 2020 3d20 7778 2e42 6f78  er_stc  = wx.Box
-0001cd00: 5369 7a65 7228 7778 2e48 4f52 495a 4f4e  Sizer(wx.HORIZON
-0001cd10: 5441 4c29 0d0a 0d0a 2020 2020 2020 2020  TAL)....        
-0001cd20: 7369 7a65 725f 6865 6164 6572 203d 2077  sizer_header = w
-0001cd30: 782e 426f 7853 697a 6572 2877 782e 484f  x.BoxSizer(wx.HO
-0001cd40: 5249 5a4f 4e54 414c 290d 0a20 2020 2020  RIZONTAL)..     
-0001cd50: 2020 206c 6162 656c 5f63 6861 7420 3d20     label_chat = 
-0001cd60: 7365 6c66 2e6c 6162 656c 5f63 6861 7420  self.label_chat 
-0001cd70: 3d20 7778 2e53 7461 7469 6354 6578 7428  = wx.StaticText(
-0001cd80: 0d0a 2020 2020 2020 2020 2020 2020 7061  ..            pa
-0001cd90: 7265 6e74 3d70 616e 656c 5f73 7463 312c  rent=panel_stc1,
-0001cda0: 206c 6162 656c 3d22 2643 6861 743a 222c   label="&Chat:",
-0001cdb0: 206e 616d 653d 2263 6861 745f 6869 7374   name="chat_hist
-0001cdc0: 6f72 795f 6c61 6265 6c22 290d 0a0d 0a20  ory_label").... 
-0001cdd0: 2020 2020 2020 2074 6220 3d20 7365 6c66         tb = self
-0001cde0: 2e74 625f 6368 6174 203d 205c 0d0a 2020  .tb_chat = \..  
-0001cdf0: 2020 2020 2020 2020 2020 7778 2e54 6f6f            wx.Too
-0001ce00: 6c42 6172 2870 6172 656e 743d 7061 6e65  lBar(parent=pane
-0001ce10: 6c5f 7374 6331 2c20 7374 796c 653d 7778  l_stc1, style=wx
-0001ce20: 2e54 425f 464c 4154 207c 2077 782e 5442  .TB_FLAT | wx.TB
-0001ce30: 5f4e 4f44 4956 4944 4552 290d 0a20 2020  _NODIVIDER)..   
-0001ce40: 2020 2020 2074 622e 5365 7454 6f6f 6c42       tb.SetToolB
-0001ce50: 6974 6d61 7053 697a 6528 2832 342c 2032  itmapSize((24, 2
-0001ce60: 3429 290d 0a20 2020 2020 2020 2074 622e  4))..        tb.
-0001ce70: 4164 6443 6865 636b 546f 6f6c 2877 782e  AddCheckTool(wx.
-0001ce80: 4944 5f4a 554d 505f 544f 2c20 2222 2c20  ID_JUMP_TO, "", 
-0001ce90: 6269 746d 6170 313d 696d 6167 6573 2e54  bitmap1=images.T
-0001cea0: 6f6f 6c62 6172 5469 6d65 6c69 6e65 2e42  oolbarTimeline.B
-0001ceb0: 6974 6d61 702c 0d0a 2020 2020 2020 2020  itmap,..        
-0001cec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ced0: 7368 6f72 7448 656c 703d 2254 6f67 676c  shortHelp="Toggl
-0001cee0: 6520 7469 6d65 6c69 6e65 2070 616e 656c  e timeline panel
-0001cef0: 2020 2841 6c74 2d4a 2922 290d 0a20 2020    (Alt-J)")..   
-0001cf00: 2020 2020 2074 622e 4164 6443 6865 636b       tb.AddCheck
-0001cf10: 546f 6f6c 2877 782e 4944 5f5a 4f4f 4d5f  Tool(wx.ID_ZOOM_
-0001cf20: 3130 302c 2022 222c 0d0a 2020 2020 2020  100, "",..      
-0001cf30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cf40: 2020 6269 746d 6170 313d 696d 6167 6573    bitmap1=images
-0001cf50: 2e54 6f6f 6c62 6172 4d61 7869 6d69 7a65  .ToolbarMaximize
-0001cf60: 2e42 6974 6d61 702c 0d0a 2020 2020 2020  .Bitmap,..      
-0001cf70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cf80: 2020 7368 6f72 7448 656c 703d 224d 6178    shortHelp="Max
-0001cf90: 696d 697a 6520 6368 6174 2070 616e 656c  imize chat panel
-0001cfa0: 2020 2841 6c74 2d4d 2922 290d 0a20 2020    (Alt-M)")..   
-0001cfb0: 2020 2020 2074 622e 4164 6454 6f6f 6c20       tb.AddTool 
-0001cfc0: 2020 2020 2877 782e 4944 5f53 4554 5550      (wx.ID_SETUP
-0001cfd0: 2c20 2222 2c0d 0a20 2020 2020 2020 2020  , "",..         
-0001cfe0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-0001cff0: 6974 6d61 703d 696d 6167 6573 2e54 6f6f  itmap=images.Too
-0001d000: 6c62 6172 5465 7874 2e42 6974 6d61 702c  lbarText.Bitmap,
-0001d010: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001d020: 2020 2020 2020 2020 2020 7368 6f72 7448            shortH
-0001d030: 656c 703d 2253 6574 2063 6861 7420 6869  elp="Set chat hi
-0001d040: 7374 6f72 7920 7465 7874 2073 697a 6522  story text size"
-0001d050: 290d 0a20 2020 2020 2020 2074 622e 4164  )..        tb.Ad
-0001d060: 6443 6865 636b 546f 6f6c 2877 782e 4944  dCheckTool(wx.ID
-0001d070: 5f50 524f 5045 5254 4945 532c 2022 222c  _PROPERTIES, "",
-0001d080: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001d090: 2020 2020 2020 2020 2020 6269 746d 6170            bitmap
-0001d0a0: 313d 696d 6167 6573 2e54 6f6f 6c62 6172  1=images.Toolbar
-0001d0b0: 5374 6174 732e 4269 746d 6170 2c0d 0a20  Stats.Bitmap,.. 
-0001d0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d0d0: 2020 2020 2020 2073 686f 7274 4865 6c70         shortHelp
-0001d0e0: 3d22 546f 6767 6c65 2063 6861 7420 7374  ="Toggle chat st
-0001d0f0: 6174 6973 7469 6373 2020 2841 6c74 2d49  atistics  (Alt-I
-0001d100: 2922 290d 0a20 2020 2020 2020 2074 622e  )")..        tb.
-0001d110: 4164 6443 6865 636b 546f 6f6c 2877 782e  AddCheckTool(wx.
-0001d120: 4944 5f4d 4f52 452c 2022 222c 2062 6974  ID_MORE, "", bit
-0001d130: 6d61 7031 3d69 6d61 6765 732e 546f 6f6c  map1=images.Tool
-0001d140: 6261 7246 696c 7465 722e 4269 746d 6170  barFilter.Bitmap
-0001d150: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0001d160: 2020 2020 2020 2020 2020 2073 686f 7274             short
-0001d170: 4865 6c70 3d22 546f 6767 6c65 2066 696c  Help="Toggle fil
-0001d180: 7465 7220 7061 6e65 6c20 2028 416c 742d  ter panel  (Alt-
-0001d190: 4729 2229 0d0a 2020 2020 2020 2020 7462  G)")..        tb
-0001d1a0: 2e52 6561 6c69 7a65 2829 0d0a 2020 2020  .Realize()..    
-0001d1b0: 2020 2020 7365 6c66 2e42 696e 6428 7778      self.Bind(wx
-0001d1c0: 2e45 5654 5f54 4f4f 4c2c 2073 656c 662e  .EVT_TOOL, self.
-0001d1d0: 6f6e 5f74 6f67 676c 655f 7469 6d65 6c69  on_toggle_timeli
-0001d1e0: 6e65 2c20 6964 3d77 782e 4944 5f4a 554d  ne, id=wx.ID_JUM
-0001d1f0: 505f 544f 290d 0a20 2020 2020 2020 2073  P_TO)..        s
-0001d200: 656c 662e 4269 6e64 2877 782e 4556 545f  elf.Bind(wx.EVT_
-0001d210: 544f 4f4c 2c20 7365 6c66 2e6f 6e5f 746f  TOOL, self.on_to
-0001d220: 6767 6c65 5f6d 6178 696d 697a 652c 2069  ggle_maximize, i
-0001d230: 643d 7778 2e49 445f 5a4f 4f4d 5f31 3030  d=wx.ID_ZOOM_100
-0001d240: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-0001d250: 4269 6e64 2877 782e 4556 545f 544f 4f4c  Bind(wx.EVT_TOOL
-0001d260: 2c20 7365 6c66 2e6f 6e5f 6d65 6e75 5f73  , self.on_menu_s
-0001d270: 697a 655f 6368 6174 2c20 2069 643d 7778  ize_chat,  id=wx
-0001d280: 2e49 445f 5345 5455 5029 0d0a 2020 2020  .ID_SETUP)..    
-0001d290: 2020 2020 7365 6c66 2e42 696e 6428 7778      self.Bind(wx
-0001d2a0: 2e45 5654 5f54 4f4f 4c2c 2073 656c 662e  .EVT_TOOL, self.
-0001d2b0: 6f6e 5f74 6f67 676c 655f 7374 6174 732c  on_toggle_stats,
-0001d2c0: 2020 2020 6964 3d77 782e 4944 5f50 524f      id=wx.ID_PRO
-0001d2d0: 5045 5254 4945 5329 0d0a 2020 2020 2020  PERTIES)..      
-0001d2e0: 2020 7365 6c66 2e42 696e 6428 7778 2e45    self.Bind(wx.E
-0001d2f0: 5654 5f54 4f4f 4c2c 2073 656c 662e 6f6e  VT_TOOL, self.on
-0001d300: 5f74 6f67 676c 655f 6669 6c74 6572 2c20  _toggle_filter, 
-0001d310: 2020 6964 3d77 782e 4944 5f4d 4f52 4529    id=wx.ID_MORE)
-0001d320: 0d0a 0d0a 2020 2020 2020 2020 6275 7474  ....        butt
-0001d330: 6f6e 5f61 6374 696f 6e20 3d20 7365 6c66  on_action = self
-0001d340: 2e62 7574 746f 6e5f 6163 7469 6f6e 5f63  .button_action_c
-0001d350: 6861 7420 3d20 5c0d 0a20 2020 2020 2020  hat = \..       
-0001d360: 2020 2020 2077 782e 4275 7474 6f6e 2870       wx.Button(p
-0001d370: 6172 656e 743d 7061 6e65 6c5f 7374 6331  arent=panel_stc1
-0001d380: 2c20 6c61 6265 6c3d 2226 4163 7469 6f6e  , label="&Action
-0001d390: 7320 2e2e 2229 0d0a 2020 2020 2020 2020  s ..")..        
-0001d3a0: 6275 7474 6f6e 5f65 7870 6f72 7420 3d20  button_export = 
-0001d3b0: 7365 6c66 2e62 7574 746f 6e5f 6578 706f  self.button_expo
-0001d3c0: 7274 5f63 6861 7420 3d20 5c0d 0a20 2020  rt_chat = \..   
-0001d3d0: 2020 2020 2020 2020 2077 782e 4275 7474           wx.Butt
-0001d3e0: 6f6e 2870 6172 656e 743d 7061 6e65 6c5f  on(parent=panel_
-0001d3f0: 7374 6331 2c20 6c61 6265 6c3d 2226 4578  stc1, label="&Ex
-0001d400: 706f 7274 206d 6573 7361 6765 7320 746f  port messages to
-0001d410: 2066 696c 6522 290d 0a20 2020 2020 2020   file")..       
-0001d420: 2062 7574 746f 6e5f 6163 7469 6f6e 2e53   button_action.S
-0001d430: 6574 546f 6f6c 5469 7028 224f 7065 6e20  etToolTip("Open 
-0001d440: 7375 626d 656e 7522 290d 0a20 2020 2020  submenu")..     
-0001d450: 2020 2062 7574 746f 6e5f 6578 706f 7274     button_export
-0001d460: 2e53 6574 546f 6f6c 5469 7028 2245 7870  .SetToolTip("Exp
-0001d470: 6f72 7420 6375 7272 656e 746c 7920 7368  ort currently sh
-0001d480: 6f77 6e20 6d65 7373 6167 6573 2074 6f20  own messages to 
-0001d490: 6120 6669 6c65 2229 0d0a 2020 2020 2020  a file")..      
-0001d4a0: 2020 7365 6c66 2e42 696e 6428 7778 2e45    self.Bind(wx.E
-0001d4b0: 5654 5f42 5554 544f 4e2c 2073 656c 662e  VT_BUTTON, self.
-0001d4c0: 6f6e 5f6d 656e 755f 6c69 7374 5f63 6861  on_menu_list_cha
-0001d4d0: 7473 2c20 6275 7474 6f6e 5f61 6374 696f  ts, button_actio
-0001d4e0: 6e29 0d0a 2020 2020 2020 2020 7365 6c66  n)..        self
-0001d4f0: 2e42 696e 6428 7778 2e45 5654 5f42 5554  .Bind(wx.EVT_BUT
-0001d500: 544f 4e2c 2073 656c 662e 6f6e 5f65 7870  TON, self.on_exp
-0001d510: 6f72 745f 6368 6174 2c20 6275 7474 6f6e  ort_chat, button
-0001d520: 5f65 7870 6f72 7429 0d0a 2020 2020 2020  _export)..      
-0001d530: 2020 7369 7a65 725f 6865 6164 6572 2e41    sizer_header.A
-0001d540: 6464 286c 6162 656c 5f63 6861 742c 2070  dd(label_chat, p
-0001d550: 726f 706f 7274 696f 6e3d 312c 2062 6f72  roportion=1, bor
-0001d560: 6465 723d 352c 2066 6c61 673d 7778 2e4c  der=5, flag=wx.L
-0001d570: 4546 5420 7c0d 0a20 2020 2020 2020 2020  EFT |..         
-0001d580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d590: 7778 2e41 4c49 474e 5f42 4f54 544f 4d29  wx.ALIGN_BOTTOM)
-0001d5a0: 0d0a 2020 2020 2020 2020 7369 7a65 725f  ..        sizer_
-0001d5b0: 6865 6164 6572 2e41 6464 2874 622c 2066  header.Add(tb, f
-0001d5c0: 6c61 673d 7778 2e41 4c49 474e 5f43 454e  lag=wx.ALIGN_CEN
-0001d5d0: 5445 525f 5645 5254 4943 414c 290d 0a20  TER_VERTICAL).. 
-0001d5e0: 2020 2020 2020 2073 697a 6572 5f68 6561         sizer_hea
-0001d5f0: 6465 722e 4164 6428 6275 7474 6f6e 5f61  der.Add(button_a
-0001d600: 6374 696f 6e2c 2062 6f72 6465 723d 3135  ction, border=15
-0001d610: 2c20 666c 6167 3d77 782e 4c45 4654 207c  , flag=wx.LEFT |
-0001d620: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001d630: 2020 2020 2020 2020 2020 2077 782e 414c             wx.AL
-0001d640: 4947 4e5f 4345 4e54 4552 5f56 4552 5449  IGN_CENTER_VERTI
-0001d650: 4341 4c29 0d0a 2020 2020 2020 2020 7369  CAL)..        si
-0001d660: 7a65 725f 6865 6164 6572 2e41 6464 2862  zer_header.Add(b
-0001d670: 7574 746f 6e5f 6578 706f 7274 2c20 626f  utton_export, bo
-0001d680: 7264 6572 3d35 2c20 666c 6167 3d77 782e  rder=5, flag=wx.
-0001d690: 4c45 4654 207c 0d0a 2020 2020 2020 2020  LEFT |..        
-0001d6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d6b0: 2077 782e 414c 4947 4e5f 4345 4e54 4552   wx.ALIGN_CENTER
-0001d6c0: 5f56 4552 5449 4341 4c29 0d0a 0d0a 2020  _VERTICAL)....  
-0001d6d0: 2020 2020 2020 7469 6d65 6c69 6e65 203d        timeline =
-0001d6e0: 2073 656c 662e 6c69 7374 5f74 696d 656c   self.list_timel
-0001d6f0: 696e 6520 3d20 4368 6174 436f 6e74 656e  ine = ChatConten
-0001d700: 7454 696d 656c 696e 6528 7061 6e65 6c5f  tTimeline(panel_
-0001d710: 7374 6331 2c20 7369 7a65 3d28 3135 302c  stc1, size=(150,
-0001d720: 202d 3129 290d 0a20 2020 2020 2020 2074   -1))..        t
-0001d730: 696d 656c 696e 652e 4869 6465 2829 0d0a  imeline.Hide()..
-0001d740: 2020 2020 2020 2020 7365 6c66 2e42 696e          self.Bin
-0001d750: 6428 7778 2e45 5654 5f4c 4953 5442 4f58  d(wx.EVT_LISTBOX
-0001d760: 2c20 7365 6c66 2e6f 6e5f 7365 6c65 6374  , self.on_select
-0001d770: 5f74 696d 656c 696e 652c 2074 696d 656c  _timeline, timel
-0001d780: 696e 6529 0d0a 2020 2020 2020 2020 7469  ine)..        ti
-0001d790: 6d65 6c69 6e65 2e42 696e 6428 7778 2e45  meline.Bind(wx.E
-0001d7a0: 5654 5f4b 494c 4c5f 464f 4355 532c 2073  VT_KILL_FOCUS, s
-0001d7b0: 656c 662e 6f6e 5f62 6c75 725f 7469 6d65  elf.on_blur_time
-0001d7c0: 6c69 6e65 290d 0a20 2020 2020 2020 2073  line)..        s
-0001d7d0: 7463 203d 2073 656c 662e 7374 635f 6869  tc = self.stc_hi
-0001d7e0: 7374 6f72 7920 3d20 4368 6174 436f 6e74  story = ChatCont
-0001d7f0: 656e 7453 5443 280d 0a20 2020 2020 2020  entSTC(..       
-0001d800: 2020 2020 2070 6172 656e 743d 7061 6e65       parent=pane
-0001d810: 6c5f 7374 6331 2c20 7374 796c 653d 7778  l_stc1, style=wx
-0001d820: 2e42 4f52 4445 525f 5354 4154 4943 2c20  .BORDER_STATIC, 
-0001d830: 6e61 6d65 3d22 6368 6174 5f68 6973 746f  name="chat_histo
-0001d840: 7279 2229 0d0a 2020 2020 2020 2020 7374  ry")..        st
-0001d850: 632e 5365 7444 6174 6162 6173 6550 6167  c.SetDatabasePag
-0001d860: 6528 7365 6c66 290d 0a20 2020 2020 2020  e(self)..       
-0001d870: 2073 7463 2e53 5443 2e42 696e 6428 7778   stc.STC.Bind(wx
-0001d880: 2e73 7463 2e45 5654 5f53 5443 5f55 5044  .stc.EVT_STC_UPD
-0001d890: 4154 4555 492c 2073 656c 662e 6f6e 5f73  ATEUI, self.on_s
-0001d8a0: 6372 6f6c 6c5f 6368 6174 5f68 6973 746f  croll_chat_histo
-0001d8b0: 7279 290d 0a20 2020 2020 2020 2068 746d  ry)..        htm
-0001d8c0: 6c5f 7374 6174 7320 3d20 7365 6c66 2e68  l_stats = self.h
-0001d8d0: 746d 6c5f 7374 6174 7320 3d20 7778 2e68  tml_stats = wx.h
-0001d8e0: 746d 6c2e 4874 6d6c 5769 6e64 6f77 2870  tml.HtmlWindow(p
-0001d8f0: 6172 656e 743d 7061 6e65 6c5f 7374 6331  arent=panel_stc1
-0001d900: 290d 0a20 2020 2020 2020 2068 746d 6c5f  )..        html_
-0001d910: 7374 6174 732e 4269 6e64 2877 782e 6874  stats.Bind(wx.ht
-0001d920: 6d6c 2e45 5654 5f48 544d 4c5f 4c49 4e4b  ml.EVT_HTML_LINK
-0001d930: 5f43 4c49 434b 4544 2c20 7365 6c66 2e6f  _CLICKED, self.o
-0001d940: 6e5f 636c 6963 6b5f 6874 6d6c 5f73 7461  n_click_html_sta
-0001d950: 7473 290d 0a20 2020 2020 2020 2068 746d  ts)..        htm
-0001d960: 6c5f 7374 6174 732e 4269 6e64 2877 782e  l_stats.Bind(wx.
-0001d970: 4556 545f 434f 4e54 4558 545f 4d45 4e55  EVT_CONTEXT_MENU
-0001d980: 2c20 2020 2020 2020 2020 2020 7365 6c66  ,           self
-0001d990: 2e6f 6e5f 7269 6768 7463 6c69 636b 5f68  .on_rightclick_h
-0001d9a0: 746d 6c29 0d0a 2020 2020 2020 2020 6874  tml)..        ht
-0001d9b0: 6d6c 5f73 7461 7473 2e42 696e 6428 7778  ml_stats.Bind(wx
-0001d9c0: 2e45 5654 5f52 4947 4854 5f55 502c 2020  .EVT_RIGHT_UP,  
-0001d9d0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0001d9e0: 662e 6f6e 5f72 6967 6874 636c 6963 6b5f  f.on_rightclick_
-0001d9f0: 6874 6d6c 290d 0a20 2020 2020 2020 2068  html)..        h
-0001da00: 746d 6c5f 7374 6174 732e 4269 6e64 2877  tml_stats.Bind(w
-0001da10: 782e 4556 545f 5343 524f 4c4c 5749 4e2c  x.EVT_SCROLLWIN,
-0001da20: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0001da30: 6c66 2e6f 6e5f 7363 726f 6c6c 5f68 746d  lf.on_scroll_htm
-0001da40: 6c5f 7374 6174 7329 0d0a 2020 2020 2020  l_stats)..      
-0001da50: 2020 6874 6d6c 5f73 7461 7473 2e42 696e    html_stats.Bin
-0001da60: 6428 7778 2e45 5654 5f53 495a 452c 2020  d(wx.EVT_SIZE,  
-0001da70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001da80: 2073 656c 662e 6f6e 5f73 697a 655f 6874   self.on_size_ht
-0001da90: 6d6c 5f73 7461 7473 290d 0a20 2020 2020  ml_stats)..     
-0001daa0: 2020 2068 746d 6c5f 7374 6174 732e 4869     html_stats.Hi
-0001dab0: 6465 2829 0d0a 0d0a 2020 2020 2020 2020  de()....        
-0001dac0: 7369 7a65 725f 7374 632e 4164 6428 7469  sizer_stc.Add(ti
-0001dad0: 6d65 6c69 6e65 2c20 666c 6167 3d77 782e  meline, flag=wx.
-0001dae0: 4752 4f57 290d 0a20 2020 2020 2020 2073  GROW)..        s
-0001daf0: 697a 6572 5f73 7463 2e41 6464 2873 7463  izer_stc.Add(stc
-0001db00: 2c20 7072 6f70 6f72 7469 6f6e 3d31 2c20  , proportion=1, 
-0001db10: 666c 6167 3d77 782e 4752 4f57 290d 0a20  flag=wx.GROW).. 
-0001db20: 2020 2020 2020 2073 697a 6572 5f73 7463         sizer_stc
-0001db30: 312e 4164 6428 7369 7a65 725f 6865 6164  1.Add(sizer_head
-0001db40: 6572 2c20 626f 7264 6572 3d35 2c20 666c  er, border=5, fl
-0001db50: 6167 3d77 782e 4752 4f57 207c 2077 782e  ag=wx.GROW | wx.
-0001db60: 5249 4748 5420 7c0d 0a20 2020 2020 2020  RIGHT |..       
-0001db70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001db80: 7778 2e42 4f54 544f 4d29 0d0a 2020 2020  wx.BOTTOM)..    
-0001db90: 2020 2020 7369 7a65 725f 7374 6331 2e41      sizer_stc1.A
-0001dba0: 6464 2873 697a 6572 5f73 7463 2c20 7072  dd(sizer_stc, pr
-0001dbb0: 6f70 6f72 7469 6f6e 3d31 2c20 626f 7264  oportion=1, bord
-0001dbc0: 6572 3d35 2c20 666c 6167 3d77 782e 4752  er=5, flag=wx.GR
-0001dbd0: 4f57 290d 0a20 2020 2020 2020 2073 697a  OW)..        siz
-0001dbe0: 6572 5f73 7463 312e 4164 6428 6874 6d6c  er_stc1.Add(html
-0001dbf0: 5f73 7461 7473 2c20 7072 6f70 6f72 7469  _stats, proporti
-0001dc00: 6f6e 3d31 2c20 666c 6167 3d77 782e 4752  on=1, flag=wx.GR
-0001dc10: 4f57 290d 0a0d 0a20 2020 2020 2020 206c  OW)....        l
-0001dc20: 6162 656c 5f66 696c 7465 7220 3d20 5c0d  abel_filter = \.
-0001dc30: 0a20 2020 2020 2020 2020 2020 2077 782e  .            wx.
-0001dc40: 5374 6174 6963 5465 7874 2870 6172 656e  StaticText(paren
-0001dc50: 743d 7061 6e65 6c5f 7374 6332 2c20 6c61  t=panel_stc2, la
-0001dc60: 6265 6c3d 2246 696e 6420 6d65 7373 6167  bel="Find messag
-0001dc70: 6573 2077 6974 6820 2674 6578 743a 2229  es with &text:")
-0001dc80: 0d0a 2020 2020 2020 2020 6564 6974 5f66  ..        edit_f
-0001dc90: 696c 7465 7220 3d20 7365 6c66 2e65 6469  ilter = self.edi
-0001dca0: 745f 6669 6c74 6572 7465 7874 203d 2077  t_filtertext = w
-0001dcb0: 782e 5465 7874 4374 726c 280d 0a20 2020  x.TextCtrl(..   
-0001dcc0: 2020 2020 2020 2020 2070 6172 656e 743d           parent=
-0001dcd0: 7061 6e65 6c5f 7374 6332 2c20 7369 7a65  panel_stc2, size
-0001dce0: 3d28 3130 302c 202d 3129 2c20 7374 796c  =(100, -1), styl
-0001dcf0: 653d 7778 2e54 455f 5052 4f43 4553 535f  e=wx.TE_PROCESS_
-0001dd00: 454e 5445 5229 0d0a 2020 2020 2020 2020  ENTER)..        
-0001dd10: 7365 6c66 2e42 696e 6428 7778 2e45 5654  self.Bind(wx.EVT
-0001dd20: 5f54 4558 545f 454e 5445 522c 2073 656c  _TEXT_ENTER, sel
-0001dd30: 662e 6f6e 5f66 696c 7465 725f 6368 6174  f.on_filter_chat
-0001dd40: 2c20 6564 6974 5f66 696c 7465 7229 0d0a  , edit_filter)..
-0001dd50: 2020 2020 2020 2020 6564 6974 5f66 696c          edit_fil
-0001dd60: 7465 722e 5365 7454 6f6f 6c54 6970 2822  ter.SetToolTip("
-0001dd70: 4669 6e64 206d 6573 7361 6765 7320 636f  Find messages co
-0001dd80: 6e74 6169 6e69 6e67 2074 6865 2065 7861  ntaining the exa
-0001dd90: 6374 2074 6578 7422 290d 0a20 2020 2020  ct text")..     
-0001dda0: 2020 206c 6162 656c 5f72 616e 6765 203d     label_range =
-0001ddb0: 2077 782e 5374 6174 6963 5465 7874 280d   wx.StaticText(.
-0001ddc0: 0a20 2020 2020 2020 2020 2020 2070 6172  .            par
-0001ddd0: 656e 743d 7061 6e65 6c5f 7374 6332 2c20  ent=panel_stc2, 
-0001dde0: 6c61 6265 6c3d 2253 686f 7720 6d65 7373  label="Show mess
-0001ddf0: 6167 6573 2066 726f 6d20 7469 6d65 2070  ages from time p
-0001de00: 6572 696f 2664 3a22 290d 0a20 2020 2020  erio&d:")..     
-0001de10: 2020 2064 7473 697a 6520 3d20 2869 6e74     dtsize = (int
-0001de20: 2839 3020 2a20 636f 6e74 726f 6c73 2e43  (90 * controls.C
-0001de30: 4f4d 424f 5f57 4944 5448 5f46 4143 544f  OMBO_WIDTH_FACTO
-0001de40: 5229 2c20 2d31 290d 0a20 2020 2020 2020  R), -1)..       
-0001de50: 2064 6174 6531 203d 2073 656c 662e 6564   date1 = self.ed
-0001de60: 6974 5f66 696c 7465 7264 6174 6531 203d  it_filterdate1 =
-0001de70: 2063 6f6e 7472 6f6c 732e 4461 7465 5069   controls.DatePi
-0001de80: 636b 6572 4374 726c 2870 616e 656c 5f73  ckerCtrl(panel_s
-0001de90: 7463 322c 2073 697a 653d 6474 7369 7a65  tc2, size=dtsize
-0001dea0: 290d 0a20 2020 2020 2020 2064 6174 6532  )..        date2
-0001deb0: 203d 2073 656c 662e 6564 6974 5f66 696c   = self.edit_fil
-0001dec0: 7465 7264 6174 6532 203d 2063 6f6e 7472  terdate2 = contr
-0001ded0: 6f6c 732e 4461 7465 5069 636b 6572 4374  ols.DatePickerCt
-0001dee0: 726c 2870 616e 656c 5f73 7463 322c 2073  rl(panel_stc2, s
-0001def0: 697a 653d 6474 7369 7a65 290d 0a20 2020  ize=dtsize)..   
-0001df00: 2020 2020 2064 6174 6531 2e46 6f72 6d61       date1.Forma
-0001df10: 7420 3d20 6461 7465 322e 466f 726d 6174  t = date2.Format
-0001df20: 203d 2022 2559 2d25 6d2d 2564 220d 0a20   = "%Y-%m-%d".. 
-0001df30: 2020 2020 2020 2064 6174 6532 2e53 6574         date2.Set
-0001df40: 506f 7075 7041 6e63 686f 7228 7778 2e52  PopupAnchor(wx.R
-0001df50: 4947 4854 290d 0a20 2020 2020 2020 2064  IGHT)..        d
-0001df60: 6174 6531 2e53 6574 546f 6f6c 5469 7028  ate1.SetToolTip(
-0001df70: 2244 6174 6520 696e 2074 6865 2066 6f72  "Date in the for
-0001df80: 6d20 5959 5959 2d4d 4d2d 4444 2229 0d0a  m YYYY-MM-DD")..
-0001df90: 2020 2020 2020 2020 6461 7465 322e 5365          date2.Se
-0001dfa0: 7454 6f6f 6c54 6970 2822 4461 7465 2069  tToolTip("Date i
-0001dfb0: 6e20 7468 6520 666f 726d 2059 5959 592d  n the form YYYY-
-0001dfc0: 4d4d 2d44 4422 290d 0a20 2020 2020 2020  MM-DD")..       
-0001dfd0: 2073 656c 662e 4269 6e64 2877 782e 4556   self.Bind(wx.EV
-0001dfe0: 545f 5445 5854 2c20 7365 6c66 2e6f 6e5f  T_TEXT, self.on_
-0001dff0: 6368 616e 6765 5f66 696c 7465 7264 6174  change_filterdat
-0001e000: 652c 2064 6174 6531 290d 0a20 2020 2020  e, date1)..     
-0001e010: 2020 2073 656c 662e 4269 6e64 2877 782e     self.Bind(wx.
-0001e020: 4556 545f 5445 5854 2c20 7365 6c66 2e6f  EVT_TEXT, self.o
-0001e030: 6e5f 6368 616e 6765 5f66 696c 7465 7264  n_change_filterd
-0001e040: 6174 652c 2064 6174 6532 290d 0a20 2020  ate, date2)..   
-0001e050: 2020 2020 2063 6f6e 7472 6f6c 732e 5261       controls.Ra
-0001e060: 6e67 6553 6c69 6465 722e 4d41 524b 4552  ngeSlider.MARKER
-0001e070: 5f4c 4142 454c 5f53 484f 5720 3d20 4661  _LABEL_SHOW = Fa
-0001e080: 6c73 650d 0a20 2020 2020 2020 2072 616e  lse..        ran
-0001e090: 6765 5f64 6174 6520 3d20 7365 6c66 2e72  ge_date = self.r
-0001e0a0: 616e 6765 5f64 6174 6520 3d20 5c0d 0a20  ange_date = \.. 
-0001e0b0: 2020 2020 2020 2020 2020 2063 6f6e 7472             contr
-0001e0c0: 6f6c 732e 5261 6e67 6553 6c69 6465 7228  ols.RangeSlider(
-0001e0d0: 7061 7265 6e74 3d70 616e 656c 5f73 7463  parent=panel_stc
-0001e0e0: 322c 2066 6d74 3d22 2559 2d25 6d2d 2564  2, fmt="%Y-%m-%d
-0001e0f0: 2229 0d0a 2020 2020 2020 2020 7261 6e67  ")..        rang
-0001e100: 655f 6461 7465 2e53 6574 5261 6e67 6528  e_date.SetRange(
-0001e110: 4e6f 6e65 2c20 4e6f 6e65 290d 0a20 2020  None, None)..   
-0001e120: 2020 2020 2072 616e 6765 5f64 6174 652e       range_date.
-0001e130: 4269 6e64 2877 782e 4556 545f 534c 4944  Bind(wx.EVT_SLID
-0001e140: 4552 2c20 7365 6c66 2e6f 6e5f 6368 616e  ER, self.on_chan
-0001e150: 6765 5f72 616e 6765 5f64 6174 6529 0d0a  ge_range_date)..
-0001e160: 2020 2020 2020 2020 6c61 6265 6c5f 6c69          label_li
-0001e170: 7374 203d 205c 0d0a 2020 2020 2020 2020  st = \..        
-0001e180: 2020 2020 7778 2e53 7461 7469 6354 6578      wx.StaticTex
-0001e190: 7428 7061 7265 6e74 3d70 616e 656c 5f73  t(parent=panel_s
-0001e1a0: 7463 322c 206c 6162 656c 3d22 5368 6f26  tc2, label="Sho&
-0001e1b0: 7720 6d65 7373 6167 6573 2066 726f 6d3a  w messages from:
-0001e1c0: 2229 0d0a 2020 2020 2020 2020 6167 775f  ")..        agw_
-0001e1d0: 7374 796c 6520 3d20 2877 782e 4c43 5f52  style = (wx.LC_R
-0001e1e0: 4550 4f52 5420 7c20 7778 2e4c 435f 4e4f  EPORT | wx.LC_NO
-0001e1f0: 5f48 4541 4445 5220 7c20 7778 2e4c 435f  _HEADER | wx.LC_
-0001e200: 5349 4e47 4c45 5f53 454c 207c 0d0a 2020  SINGLE_SEL |..  
-0001e210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e220: 2020 2077 782e 6c69 622e 6167 772e 756c     wx.lib.agw.ul
-0001e230: 7469 6d61 7465 6c69 7374 6374 726c 2e55  timatelistctrl.U
-0001e240: 4c43 5f4e 4f5f 4849 4748 4c49 4748 5420  LC_NO_HIGHLIGHT 
-0001e250: 7c0d 0a20 2020 2020 2020 2020 2020 2020  |..             
-0001e260: 2020 2020 2020 2020 7778 2e6c 6962 2e61          wx.lib.a
-0001e270: 6777 2e75 6c74 696d 6174 656c 6973 7463  gw.ultimatelistc
-0001e280: 7472 6c2e 554c 435f 4852 554c 4553 207c  trl.ULC_HRULES |
-0001e290: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001e2a0: 2020 2020 2020 2077 782e 6c69 622e 6167         wx.lib.ag
-0001e2b0: 772e 756c 7469 6d61 7465 6c69 7374 6374  w.ultimatelistct
-0001e2c0: 726c 2e55 4c43 5f53 484f 575f 544f 4f4c  rl.ULC_SHOW_TOOL
-0001e2d0: 5449 5053 290d 0a20 2020 2020 2020 2069  TIPS)..        i
-0001e2e0: 6620 6861 7361 7474 7228 7778 2e6c 6962  f hasattr(wx.lib
-0001e2f0: 2e61 6777 2e75 6c74 696d 6174 656c 6973  .agw.ultimatelis
-0001e300: 7463 7472 6c2c 2022 554c 435f 5553 4552  tctrl, "ULC_USER
-0001e310: 5f52 4f57 5f48 4549 4748 5422 293a 0d0a  _ROW_HEIGHT"):..
-0001e320: 2020 2020 2020 2020 2020 2020 6167 775f              agw_
-0001e330: 7374 796c 6520 7c3d 2077 782e 6c69 622e  style |= wx.lib.
-0001e340: 6167 772e 756c 7469 6d61 7465 6c69 7374  agw.ultimatelist
-0001e350: 6374 726c 2e55 4c43 5f55 5345 525f 524f  ctrl.ULC_USER_RO
-0001e360: 575f 4845 4947 4854 0d0a 2020 2020 2020  W_HEIGHT..      
-0001e370: 2020 6c69 7374 5f70 6172 7469 6369 7061    list_participa
-0001e380: 6e74 7320 3d20 7365 6c66 2e6c 6973 745f  nts = self.list_
-0001e390: 7061 7274 6963 6970 616e 7473 203d 205c  participants = \
-0001e3a0: 0d0a 2020 2020 2020 2020 2020 2020 7778  ..            wx
-0001e3b0: 2e6c 6962 2e61 6777 2e75 6c74 696d 6174  .lib.agw.ultimat
-0001e3c0: 656c 6973 7463 7472 6c2e 556c 7469 6d61  elistctrl.Ultima
-0001e3d0: 7465 4c69 7374 4374 726c 2870 6172 656e  teListCtrl(paren
-0001e3e0: 743d 7061 6e65 6c5f 7374 6332 2c0d 0a20  t=panel_stc2,.. 
-0001e3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e420: 2020 2020 2020 2020 6167 7753 7479 6c65          agwStyle
-0001e430: 3d61 6777 5f73 7479 6c65 290d 0a20 2020  =agw_style)..   
-0001e440: 2020 2020 2043 6f6c 6f75 724d 616e 6167       ColourManag
-0001e450: 6572 2e4d 616e 6167 6528 6c69 7374 5f70  er.Manage(list_p
-0001e460: 6172 7469 6369 7061 6e74 732c 2022 466f  articipants, "Fo
-0001e470: 7265 6772 6f75 6e64 436f 6c6f 7572 222c  regroundColour",
-0001e480: 2077 782e 5359 535f 434f 4c4f 5552 5f42   wx.SYS_COLOUR_B
-0001e490: 544e 5445 5854 290d 0a20 2020 2020 2020  TNTEXT)..       
-0001e4a0: 2043 6f6c 6f75 724d 616e 6167 6572 2e4d   ColourManager.M
-0001e4b0: 616e 6167 6528 6c69 7374 5f70 6172 7469  anage(list_parti
-0001e4c0: 6369 7061 6e74 732c 2022 4261 636b 6772  cipants, "Backgr
-0001e4d0: 6f75 6e64 436f 6c6f 7572 222c 2077 782e  oundColour", wx.
-0001e4e0: 5359 535f 434f 4c4f 5552 5f57 494e 444f  SYS_COLOUR_WINDO
-0001e4f0: 5729 0d0a 2020 2020 2020 2020 7472 793a  W)..        try:
-0001e500: 0d0a 2020 2020 2020 2020 2020 2020 436f  ..            Co
-0001e510: 6c6f 7572 4d61 6e61 6765 722e 4d61 6e61  lourManager.Mana
-0001e520: 6765 286c 6973 745f 7061 7274 6963 6970  ge(list_particip
-0001e530: 616e 7473 2e5f 6865 6164 6572 5769 6e2c  ants._headerWin,
-0001e540: 2022 466f 7265 6772 6f75 6e64 436f 6c6f   "ForegroundColo
-0001e550: 7572 222c 2077 782e 5359 535f 434f 4c4f  ur", wx.SYS_COLO
-0001e560: 5552 5f42 544e 5445 5854 290d 0a20 2020  UR_BTNTEXT)..   
-0001e570: 2020 2020 2020 2020 2043 6f6c 6f75 724d           ColourM
-0001e580: 616e 6167 6572 2e4d 616e 6167 6528 6c69  anager.Manage(li
-0001e590: 7374 5f70 6172 7469 6369 7061 6e74 732e  st_participants.
-0001e5a0: 5f6d 6169 6e57 696e 2c20 2020 2242 6163  _mainWin,   "Bac
-0001e5b0: 6b67 726f 756e 6443 6f6c 6f75 7222 2c20  kgroundColour", 
-0001e5c0: 7778 2e53 5953 5f43 4f4c 4f55 525f 5749  wx.SYS_COLOUR_WI
-0001e5d0: 4e44 4f57 290d 0a20 2020 2020 2020 2065  NDOW)..        e
-0001e5e0: 7863 6570 7420 4578 6365 7074 696f 6e3a  xcept Exception:
-0001e5f0: 2070 6173 730d 0a20 2020 2020 2020 206c   pass..        l
-0001e600: 6973 745f 7061 7274 6963 6970 616e 7473  ist_participants
-0001e610: 2e49 6e73 6572 7443 6f6c 756d 6e28 302c  .InsertColumn(0,
-0001e620: 2022 2229 0d0a 2020 2020 2020 2020 7365   "")..        se
-0001e630: 6c66 2e42 696e 6428 7778 2e45 5654 5f4c  lf.Bind(wx.EVT_L
-0001e640: 4953 545f 4954 454d 5f53 454c 4543 5445  IST_ITEM_SELECTE
-0001e650: 442c 2073 656c 662e 6f6e 5f73 656c 6563  D, self.on_selec
-0001e660: 745f 7061 7274 6963 6970 616e 742c 0d0a  t_participant,..
-0001e670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e680: 2020 6c69 7374 5f70 6172 7469 6369 7061    list_participa
-0001e690: 6e74 7329 0d0a 2020 2020 2020 2020 6966  nts)..        if
-0001e6a0: 2068 6173 6174 7472 286c 6973 745f 7061   hasattr(list_pa
-0001e6b0: 7274 6963 6970 616e 7473 2c20 2253 6574  rticipants, "Set
-0001e6c0: 5573 6572 4c69 6e65 4865 6967 6874 2229  UserLineHeight")
-0001e6d0: 3a0d 0a20 2020 2020 2020 2020 2020 206c  :..            l
-0001e6e0: 6973 745f 7061 7274 6963 6970 616e 7473  ist_participants
-0001e6f0: 2e53 6574 5573 6572 4c69 6e65 4865 6967  .SetUserLineHeig
-0001e700: 6874 2863 6f6e 662e 4176 6174 6172 496d  ht(conf.AvatarIm
-0001e710: 6167 6553 697a 655b 315d 202b 2032 290d  ageSize[1] + 2).
-0001e720: 0a20 2020 2020 2020 2073 697a 6572 5f64  .        sizer_d
-0001e730: 6174 6573 203d 2077 782e 426f 7853 697a  ates = wx.BoxSiz
-0001e740: 6572 2877 782e 484f 5249 5a4f 4e54 414c  er(wx.HORIZONTAL
-0001e750: 290d 0a20 2020 2020 2020 2073 697a 6572  )..        sizer
-0001e760: 5f66 696c 7465 725f 6275 7474 6f6e 7320  _filter_buttons 
-0001e770: 3d20 7778 2e42 6f78 5369 7a65 7228 7778  = wx.BoxSizer(wx
-0001e780: 2e48 4f52 495a 4f4e 5441 4c29 0d0a 2020  .HORIZONTAL)..  
-0001e790: 2020 2020 2020 6275 7474 6f6e 5f66 696c        button_fil
-0001e7a0: 7465 725f 6170 706c 7920 3d20 7365 6c66  ter_apply = self
-0001e7b0: 2e62 7574 746f 6e5f 6368 6174 5f61 7070  .button_chat_app
-0001e7c0: 6c79 6669 6c74 6572 203d 205c 0d0a 2020  lyfilter = \..  
-0001e7d0: 2020 2020 2020 2020 2020 7778 2e42 7574            wx.But
-0001e7e0: 746f 6e28 7061 7265 6e74 3d70 616e 656c  ton(parent=panel
-0001e7f0: 5f73 7463 322c 206c 6162 656c 3d22 4126  _stc2, label="A&
-0001e800: 7070 6c79 2066 696c 7465 7222 290d 0a20  pply filter").. 
-0001e810: 2020 2020 2020 2062 7574 746f 6e5f 6669         button_fi
-0001e820: 6c74 6572 5f65 7870 6f72 7420 3d20 7365  lter_export = se
-0001e830: 6c66 2e62 7574 746f 6e5f 6368 6174 5f65  lf.button_chat_e
-0001e840: 7870 6f72 7466 696c 7465 7220 3d20 5c0d  xportfilter = \.
-0001e850: 0a20 2020 2020 2020 2020 2020 2077 782e  .            wx.
-0001e860: 4275 7474 6f6e 2870 6172 656e 743d 7061  Button(parent=pa
-0001e870: 6e65 6c5f 7374 6332 2c20 6c61 6265 6c3d  nel_stc2, label=
-0001e880: 2245 7870 6f26 7274 2066 696c 7465 7222  "Expo&rt filter"
-0001e890: 290d 0a20 2020 2020 2020 2062 7574 746f  )..        butto
-0001e8a0: 6e5f 6669 6c74 6572 5f72 6573 6574 203d  n_filter_reset =
-0001e8b0: 2073 656c 662e 6275 7474 6f6e 5f63 6861   self.button_cha
-0001e8c0: 745f 756e 6669 6c74 6572 203d 205c 0d0a  t_unfilter = \..
-0001e8d0: 2020 2020 2020 2020 2020 2020 7778 2e42              wx.B
-0001e8e0: 7574 746f 6e28 7061 7265 6e74 3d70 616e  utton(parent=pan
-0001e8f0: 656c 5f73 7463 322c 206c 6162 656c 3d22  el_stc2, label="
-0001e900: 5265 7374 6f72 6520 6926 6e69 7469 616c  Restore i&nitial
-0001e910: 2229 0d0a 2020 2020 2020 2020 7365 6c66  ")..        self
-0001e920: 2e42 696e 6428 7778 2e45 5654 5f42 5554  .Bind(wx.EVT_BUT
-0001e930: 544f 4e2c 2073 656c 662e 6f6e 5f66 696c  TON, self.on_fil
-0001e940: 7465 725f 6368 6174 2c20 6275 7474 6f6e  ter_chat, button
-0001e950: 5f66 696c 7465 725f 6170 706c 7929 0d0a  _filter_apply)..
-0001e960: 2020 2020 2020 2020 7365 6c66 2e42 696e          self.Bin
-0001e970: 6428 7778 2e45 5654 5f42 5554 544f 4e2c  d(wx.EVT_BUTTON,
-0001e980: 2073 656c 662e 6f6e 5f66 696c 7465 7265   self.on_filtere
-0001e990: 7870 6f72 745f 6368 6174 2c0d 0a20 2020  xport_chat,..   
-0001e9a0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-0001e9b0: 7574 746f 6e5f 6669 6c74 6572 5f65 7870  utton_filter_exp
-0001e9c0: 6f72 7429 0d0a 2020 2020 2020 2020 7365  ort)..        se
-0001e9d0: 6c66 2e42 696e 6428 7778 2e45 5654 5f42  lf.Bind(wx.EVT_B
-0001e9e0: 5554 544f 4e2c 2073 656c 662e 6f6e 5f66  UTTON, self.on_f
-0001e9f0: 696c 7465 7272 6573 6574 5f63 6861 742c  ilterreset_chat,
-0001ea00: 2062 7574 746f 6e5f 6669 6c74 6572 5f72   button_filter_r
-0001ea10: 6573 6574 290d 0a20 2020 2020 2020 2062  eset)..        b
-0001ea20: 7574 746f 6e5f 6669 6c74 6572 5f61 7070  utton_filter_app
-0001ea30: 6c79 2e53 6574 546f 6f6c 5469 7028 0d0a  ly.SetToolTip(..
-0001ea40: 2020 2020 2020 2020 2020 2020 2246 696c              "Fil
-0001ea50: 7465 7273 2074 6865 2063 6f6e 7665 7273  ters the convers
-0001ea60: 6174 696f 6e20 6279 2074 6865 2073 7065  ation by the spe
-0001ea70: 6369 6669 6564 2074 6578 742c 2022 0d0a  cified text, "..
-0001ea80: 2020 2020 2020 2020 2020 2020 2264 6174              "dat
-0001ea90: 6520 7261 6e67 6520 616e 6420 7061 7274  e range and part
-0001eaa0: 6963 6970 616e 7473 2e22 290d 0a20 2020  icipants.")..   
-0001eab0: 2020 2020 2062 7574 746f 6e5f 6669 6c74       button_filt
-0001eac0: 6572 5f65 7870 6f72 742e 5365 7454 6f6f  er_export.SetToo
-0001ead0: 6c54 6970 280d 0a20 2020 2020 2020 2020  lTip(..         
-0001eae0: 2020 2022 4578 706f 7274 7320 6669 6c74     "Exports filt
-0001eaf0: 6572 6564 206d 6573 7361 6765 7320 7374  ered messages st
-0001eb00: 7261 6967 6874 2074 6f20 6669 6c65 2c20  raight to file, 
-0001eb10: 220d 0a20 2020 2020 2020 2020 2020 2022  "..            "
-0001eb20: 7769 7468 6f75 7420 7368 6f77 696e 6720  without showing 
-0001eb30: 7468 656d 2028 7368 6f77 696e 6720 7468  them (showing th
-0001eb40: 6f75 7361 6e64 7320 6f66 206d 6573 7361  ousands of messa
-0001eb50: 6765 7320 6765 7473 2073 6c6f 7729 2e22  ges gets slow)."
-0001eb60: 290d 0a20 2020 2020 2020 2062 7574 746f  )..        butto
-0001eb70: 6e5f 6669 6c74 6572 5f72 6573 6574 2e53  n_filter_reset.S
-0001eb80: 6574 546f 6f6c 5469 7028 0d0a 2020 2020  etToolTip(..    
-0001eb90: 2020 2020 2020 2020 2252 6573 746f 7265          "Restore
-0001eba0: 7320 6669 6c74 6572 2063 6f6e 7472 6f6c  s filter control
-0001ebb0: 7320 746f 2069 6e69 7469 616c 2076 616c  s to initial val
-0001ebc0: 7565 7320 616e 6420 7265 6170 706c 6965  ues and reapplie
-0001ebd0: 7320 6669 6c74 6572 2e22 290d 0a20 2020  s filter.")..   
-0001ebe0: 2020 2020 2073 697a 6572 5f66 696c 7465       sizer_filte
-0001ebf0: 725f 6275 7474 6f6e 732e 4164 6428 6275  r_buttons.Add(bu
-0001ec00: 7474 6f6e 5f66 696c 7465 725f 6170 706c  tton_filter_appl
-0001ec10: 7929 0d0a 2020 2020 2020 2020 7369 7a65  y)..        size
-0001ec20: 725f 6669 6c74 6572 5f62 7574 746f 6e73  r_filter_buttons
-0001ec30: 2e41 6464 5370 6163 6572 2835 290d 0a20  .AddSpacer(5).. 
-0001ec40: 2020 2020 2020 2073 697a 6572 5f66 696c         sizer_fil
-0001ec50: 7465 725f 6275 7474 6f6e 732e 4164 6428  ter_buttons.Add(
-0001ec60: 6275 7474 6f6e 5f66 696c 7465 725f 6578  button_filter_ex
-0001ec70: 706f 7274 290d 0a20 2020 2020 2020 2073  port)..        s
-0001ec80: 697a 6572 5f66 696c 7465 725f 6275 7474  izer_filter_butt
-0001ec90: 6f6e 732e 4164 6453 7061 6365 7228 3529  ons.AddSpacer(5)
-0001eca0: 0d0a 2020 2020 2020 2020 7369 7a65 725f  ..        sizer_
-0001ecb0: 6669 6c74 6572 5f62 7574 746f 6e73 2e41  filter_buttons.A
-0001ecc0: 6464 2862 7574 746f 6e5f 6669 6c74 6572  dd(button_filter
-0001ecd0: 5f72 6573 6574 290d 0a20 2020 2020 2020  _reset)..       
-0001ece0: 2073 697a 6572 5f66 696c 7465 725f 6275   sizer_filter_bu
-0001ecf0: 7474 6f6e 732e 4164 6453 7061 6365 7228  ttons.AddSpacer(
-0001ed00: 3529 0d0a 2020 2020 2020 2020 7369 7a65  5)..        size
-0001ed10: 725f 6461 7465 732e 4164 6428 6461 7465  r_dates.Add(date
-0001ed20: 3129 0d0a 2020 2020 2020 2020 7369 7a65  1)..        size
-0001ed30: 725f 6461 7465 732e 4164 6453 7472 6574  r_dates.AddStret
-0001ed40: 6368 5370 6163 6572 2829 0d0a 2020 2020  chSpacer()..    
-0001ed50: 2020 2020 7369 7a65 725f 6461 7465 732e      sizer_dates.
-0001ed60: 4164 6428 6461 7465 3229 0d0a 2020 2020  Add(date2)..    
-0001ed70: 2020 2020 7369 7a65 725f 7374 6332 2e41      sizer_stc2.A
-0001ed80: 6464 286c 6162 656c 5f66 696c 7465 722c  dd(label_filter,
-0001ed90: 2062 6f72 6465 723d 352c 2066 6c61 673d   border=5, flag=
-0001eda0: 7778 2e4c 4546 5429 0d0a 2020 2020 2020  wx.LEFT)..      
-0001edb0: 2020 7369 7a65 725f 7374 6332 2e41 6464    sizer_stc2.Add
-0001edc0: 2865 6469 745f 6669 6c74 6572 2c20 626f  (edit_filter, bo
-0001edd0: 7264 6572 3d35 2c20 666c 6167 3d77 782e  rder=5, flag=wx.
-0001ede0: 4752 4f57 207c 2077 782e 4c45 4654 290d  GROW | wx.LEFT).
-0001edf0: 0a20 2020 2020 2020 2073 697a 6572 5f73  .        sizer_s
-0001ee00: 7463 322e 4164 6453 7061 6365 7228 3529  tc2.AddSpacer(5)
-0001ee10: 0d0a 2020 2020 2020 2020 7369 7a65 725f  ..        sizer_
-0001ee20: 7374 6332 2e41 6464 286c 6162 656c 5f72  stc2.Add(label_r
-0001ee30: 616e 6765 2c20 626f 7264 6572 3d35 2c20  ange, border=5, 
-0001ee40: 666c 6167 3d77 782e 4c45 4654 290d 0a20  flag=wx.LEFT).. 
-0001ee50: 2020 2020 2020 2073 697a 6572 5f73 7463         sizer_stc
-0001ee60: 322e 4164 6428 7369 7a65 725f 6461 7465  2.Add(sizer_date
-0001ee70: 732c 2062 6f72 6465 723d 352c 2066 6c61  s, border=5, fla
-0001ee80: 673d 7778 2e47 524f 5720 7c20 7778 2e4c  g=wx.GROW | wx.L
-0001ee90: 4546 5420 7c20 7778 2e42 4f54 544f 4d29  EFT | wx.BOTTOM)
-0001eea0: 0d0a 2020 2020 2020 2020 7369 7a65 725f  ..        sizer_
-0001eeb0: 7374 6332 2e41 6464 2872 616e 6765 5f64  stc2.Add(range_d
-0001eec0: 6174 652c 2062 6f72 6465 723d 352c 2066  ate, border=5, f
-0001eed0: 6c61 673d 7778 2e47 524f 5720 7c20 7778  lag=wx.GROW | wx
-0001eee0: 2e4c 4546 5429 0d0a 2020 2020 2020 2020  .LEFT)..        
-0001eef0: 7369 7a65 725f 7374 6332 2e41 6464 5370  sizer_stc2.AddSp
-0001ef00: 6163 6572 2835 290d 0a20 2020 2020 2020  acer(5)..       
-0001ef10: 2073 697a 6572 5f73 7463 322e 4164 6428   sizer_stc2.Add(
-0001ef20: 6c61 6265 6c5f 6c69 7374 2c20 626f 7264  label_list, bord
-0001ef30: 6572 3d35 2c20 666c 6167 3d77 782e 4c45  er=5, flag=wx.LE
-0001ef40: 4654 290d 0a20 2020 2020 2020 2073 697a  FT)..        siz
-0001ef50: 6572 5f73 7463 322e 4164 6428 6c69 7374  er_stc2.Add(list
-0001ef60: 5f70 6172 7469 6369 7061 6e74 732c 2070  _participants, p
-0001ef70: 726f 706f 7274 696f 6e3d 312c 2062 6f72  roportion=1, bor
-0001ef80: 6465 723d 352c 0d0a 2020 2020 2020 2020  der=5,..        
-0001ef90: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0001efa0: 6c61 673d 7778 2e47 524f 5720 7c20 7778  lag=wx.GROW | wx
-0001efb0: 2e4c 4546 5429 0d0a 2020 2020 2020 2020  .LEFT)..        
-0001efc0: 7369 7a65 725f 7374 6332 2e41 6464 5370  sizer_stc2.AddSp
-0001efd0: 6163 6572 2835 290d 0a20 2020 2020 2020  acer(5)..       
-0001efe0: 2073 697a 6572 5f73 7463 322e 4164 6428   sizer_stc2.Add(
-0001eff0: 7369 7a65 725f 6669 6c74 6572 5f62 7574  sizer_filter_but
-0001f000: 746f 6e73 2c20 7072 6f70 6f72 7469 6f6e  tons, proportion
-0001f010: 3d30 2c20 626f 7264 6572 3d35 2c0d 0a20  =0, border=5,.. 
-0001f020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f030: 2020 2020 2020 666c 6167 3d77 782e 4752        flag=wx.GR
-0001f040: 4f57 207c 2077 782e 4c45 4654 207c 2077  OW | wx.LEFT | w
-0001f050: 782e 5249 4748 5429 0d0a 0d0a 2020 2020  x.RIGHT)....    
-0001f060: 2020 2020 7370 6c69 7474 6572 5f73 7463      splitter_stc
-0001f070: 2e53 706c 6974 5665 7274 6963 616c 6c79  .SplitVertically
-0001f080: 2870 616e 656c 5f73 7463 312c 2070 616e  (panel_stc1, pan
-0001f090: 656c 5f73 7463 322c 2073 6173 6850 6f73  el_stc2, sashPos
-0001f0a0: 6974 696f 6e3d 3029 0d0a 2020 2020 2020  ition=0)..      
-0001f0b0: 2020 7370 6c69 7474 6572 5f73 7463 2e55    splitter_stc.U
-0001f0c0: 6e73 706c 6974 2870 616e 656c 5f73 7463  nsplit(panel_stc
-0001f0d0: 3229 2023 2048 6964 6520 6669 6c74 6572  2) # Hide filter
-0001f0e0: 2070 616e 656c 0d0a 2020 2020 2020 2020   panel..        
-0001f0f0: 7369 7a65 7232 2e41 6464 2873 706c 6974  sizer2.Add(split
-0001f100: 7465 725f 7374 632c 2070 726f 706f 7274  ter_stc, proport
-0001f110: 696f 6e3d 312c 2062 6f72 6465 723d 352c  ion=1, border=5,
-0001f120: 2066 6c61 673d 7778 2e47 524f 5720 7c20   flag=wx.GROW | 
-0001f130: 7778 2e41 4c4c 290d 0a0d 0a20 2020 2020  wx.ALL)....     
-0001f140: 2020 2073 697a 6572 2e41 6464 5370 6163     sizer.AddSpac
-0001f150: 6572 2831 3029 0d0a 2020 2020 2020 2020  er(10)..        
-0001f160: 7369 7a65 722e 4164 6428 7370 6c69 7474  sizer.Add(splitt
-0001f170: 6572 2c20 7072 6f70 6f72 7469 6f6e 3d31  er, proportion=1
-0001f180: 2c20 666c 6167 3d77 782e 4752 4f57 290d  , flag=wx.GROW).
-0001f190: 0a20 2020 2020 2020 2073 706c 6974 7465  .        splitte
-0001f1a0: 722e 5370 6c69 7448 6f72 697a 6f6e 7461  r.SplitHorizonta
-0001f1b0: 6c6c 7928 7061 6e65 6c31 2c20 7061 6e65  lly(panel1, pane
-0001f1c0: 6c32 2c20 7361 7368 506f 7369 7469 6f6e  l2, sashPosition
-0001f1d0: 3d73 656c 662e 5369 7a65 5b31 5d20 2f2f  =self.Size[1] //
-0001f1e0: 2033 290d 0a20 2020 2020 2020 2070 616e   3)..        pan
-0001f1f0: 656c 322e 456e 6162 6c65 6420 3d20 4661  el2.Enabled = Fa
-0001f200: 6c73 650d 0a0d 0a0d 0a20 2020 2064 6566  lse......    def
-0001f210: 2063 7265 6174 655f 7061 6765 5f63 6f6e   create_page_con
-0001f220: 7461 6374 7328 7365 6c66 2c20 6e6f 7465  tacts(self, note
-0001f230: 626f 6f6b 293a 0d0a 2020 2020 2020 2020  book):..        
-0001f240: 2222 2243 7265 6174 6573 2061 2070 6167  """Creates a pag
-0001f250: 6520 666f 7220 7669 6577 696e 6720 636f  e for viewing co
-0001f260: 6e74 6163 7473 2e22 2222 0d0a 2020 2020  ntacts."""..    
-0001f270: 2020 2020 7061 6765 203d 2073 656c 662e      page = self.
-0001f280: 7061 6765 5f63 6f6e 7461 6374 7320 3d20  page_contacts = 
-0001f290: 7778 2e50 616e 656c 2870 6172 656e 743d  wx.Panel(parent=
-0001f2a0: 6e6f 7465 626f 6f6b 290d 0a20 2020 2020  notebook)..     
-0001f2b0: 2020 2073 656c 662e 7061 6765 6f72 6465     self.pageorde
-0001f2c0: 725b 7061 6765 5d20 3d20 6c65 6e28 7365  r[page] = len(se
-0001f2d0: 6c66 2e70 6167 656f 7264 6572 290d 0a20  lf.pageorder).. 
-0001f2e0: 2020 2020 2020 206e 6f74 6562 6f6f 6b2e         notebook.
-0001f2f0: 4164 6450 6167 6528 7061 6765 2c20 2243  AddPage(page, "C
-0001f300: 6f6e 7461 6374 7322 290d 0a20 2020 2020  ontacts")..     
-0001f310: 2020 2073 697a 6572 203d 2070 6167 652e     sizer = page.
-0001f320: 5369 7a65 7220 3d20 7778 2e42 6f78 5369  Sizer = wx.BoxSi
-0001f330: 7a65 7228 7778 2e56 4552 5449 4341 4c29  zer(wx.VERTICAL)
-0001f340: 0d0a 2020 2020 2020 2020 7370 6c69 7474  ..        splitt
-0001f350: 6572 203d 2073 656c 662e 7370 6c69 7474  er = self.splitt
-0001f360: 6572 5f63 6f6e 7461 6374 7320 3d20 7778  er_contacts = wx
-0001f370: 2e53 706c 6974 7465 7257 696e 646f 7728  .SplitterWindow(
-0001f380: 0d0a 2020 2020 2020 2020 2020 2020 7061  ..            pa
-0001f390: 7265 6e74 3d70 6167 652c 2073 7479 6c65  rent=page, style
-0001f3a0: 3d77 782e 424f 5244 4552 5f4e 4f4e 450d  =wx.BORDER_NONE.
-0001f3b0: 0a20 2020 2020 2020 2029 0d0a 2020 2020  .        )..    
-0001f3c0: 2020 2020 7370 6c69 7474 6572 2e53 6574      splitter.Set
-0001f3d0: 4d69 6e69 6d75 6d50 616e 6553 697a 6528  MinimumPaneSize(
-0001f3e0: 3130 3029 0d0a 0d0a 2020 2020 2020 2020  100)....        
-0001f3f0: 7061 6e65 6c31 203d 2073 656c 662e 7061  panel1 = self.pa
-0001f400: 6e65 6c5f 636f 6e74 6163 7473 3120 3d20  nel_contacts1 = 
-0001f410: 7778 2e50 616e 656c 2870 6172 656e 743d  wx.Panel(parent=
-0001f420: 7370 6c69 7474 6572 290d 0a20 2020 2020  splitter)..     
-0001f430: 2020 2073 697a 6572 3120 3d20 7061 6e65     sizer1 = pane
-0001f440: 6c31 2e53 697a 6572 203d 2077 782e 426f  l1.Sizer = wx.Bo
-0001f450: 7853 697a 6572 2877 782e 5645 5254 4943  xSizer(wx.VERTIC
-0001f460: 414c 290d 0a20 2020 2020 2020 2073 697a  AL)..        siz
-0001f470: 6572 5f74 6f70 203d 2077 782e 426f 7853  er_top = wx.BoxS
-0001f480: 697a 6572 2877 782e 484f 5249 5a4f 4e54  izer(wx.HORIZONT
-0001f490: 414c 290d 0a20 2020 2020 2020 2073 656c  AL)..        sel
-0001f4a0: 662e 6c61 6265 6c5f 6c69 7374 5f63 6f6e  f.label_list_con
-0001f4b0: 7461 6374 7320 3d20 7778 2e53 7461 7469  tacts = wx.Stati
-0001f4c0: 6354 6578 7428 7061 6e65 6c31 2c20 6c61  cText(panel1, la
-0001f4d0: 6265 6c3d 2241 266c 6c20 7072 6f66 696c  bel="A&ll profil
-0001f4e0: 6573 2069 6e20 6461 7461 6261 7365 3a22  es in database:"
-0001f4f0: 290d 0a20 2020 2020 2020 2073 697a 6572  )..        sizer
-0001f500: 5f74 6f70 2e41 6464 2873 656c 662e 6c61  _top.Add(self.la
-0001f510: 6265 6c5f 6c69 7374 5f63 6f6e 7461 6374  bel_list_contact
-0001f520: 732c 2070 726f 706f 7274 696f 6e3d 312c  s, proportion=1,
-0001f530: 2062 6f72 6465 723d 352c 2066 6c61 673d   border=5, flag=
-0001f540: 7778 2e41 4c49 474e 5f42 4f54 544f 4d29  wx.ALIGN_BOTTOM)
-0001f550: 0d0a 2020 2020 2020 2020 6c69 7374 5f63  ..        list_c
-0001f560: 6f6e 7461 6374 7320 3d20 7365 6c66 2e6c  ontacts = self.l
-0001f570: 6973 745f 636f 6e74 6163 7473 203d 2063  ist_contacts = c
-0001f580: 6f6e 7472 6f6c 732e 536f 7274 6162 6c65  ontrols.Sortable
-0001f590: 4c69 7374 5669 6577 280d 0a20 2020 2020  ListView(..     
-0001f5a0: 2020 2020 2020 2070 6172 656e 743d 7061         parent=pa
-0001f5b0: 6e65 6c31 2c20 7374 796c 653d 7778 2e4c  nel1, style=wx.L
-0001f5c0: 435f 5245 504f 5254 290d 0a20 2020 2020  C_REPORT)..     
-0001f5d0: 2020 2063 6f6c 756d 6e73 203d 205b 2822     columns = [("
-0001f5e0: 6964 656e 7469 7479 222c 2022 4163 636f  identity", "Acco
-0001f5f0: 756e 7422 292c 2028 226e 616d 6522 2c20  unt"), ("name", 
-0001f600: 224e 616d 6522 292c 2028 2270 686f 6e65  "Name"), ("phone
-0001f610: 222c 2022 5068 6f6e 6522 292c 0d0a 2020  ", "Phone"),..  
-0001f620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f630: 2028 2266 6972 7374 5f6d 6573 7361 6765   ("first_message
-0001f640: 5f64 6174 6574 696d 6522 2c20 2246 6972  _datetime", "Fir
-0001f650: 7374 206d 6573 7361 6765 2229 2c0d 0a20  st message"),.. 
-0001f660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f670: 2020 2822 6c61 7374 5f6d 6573 7361 6765    ("last_message
-0001f680: 5f64 6174 6574 696d 6522 2c20 224c 6173  _datetime", "Las
-0001f690: 7420 6d65 7373 6167 6522 292c 0d0a 2020  t message"),..  
-0001f6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f6b0: 2028 226d 6573 7361 6765 5f63 6f75 6e74   ("message_count
-0001f6c0: 5f73 696e 676c 6522 2c20 2231 3a31 206d  _single", "1:1 m
-0001f6d0: 6573 7361 6765 7322 292c 0d0a 2020 2020  essages"),..    
-0001f6e0: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-0001f6f0: 226d 6573 7361 6765 5f63 6f75 6e74 5f67  "message_count_g
-0001f700: 726f 7570 222c 2022 4772 6f75 7020 6368  roup", "Group ch
-0001f710: 6174 206d 6573 7361 6765 7322 292c 205d  at messages"), ]
-0001f720: 0d0a 2020 2020 2020 2020 6672 6d74 203d  ..        frmt =
-0001f730: 206c 616d 6264 6120 722c 2063 3a20 725b   lambda r, c: r[
-0001f740: 635d 2e73 7472 6674 696d 6528 2225 592d  c].strftime("%Y-
-0001f750: 256d 2d25 6420 2548 3a25 4d22 2920 6966  %m-%d %H:%M") if
-0001f760: 2072 2e67 6574 2863 2920 656c 7365 2022   r.get(c) else "
-0001f770: 220d 0a20 2020 2020 2020 2066 6f72 6d61  "..        forma
-0001f780: 7474 6572 7320 3d20 7b22 6669 7273 745f  tters = {"first_
-0001f790: 6d65 7373 6167 655f 6461 7465 7469 6d65  message_datetime
-0001f7a0: 223a 2066 726d 742c 0d0a 2020 2020 2020  ": frmt,..      
-0001f7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f7c0: 226c 6173 745f 6d65 7373 6167 655f 6461  "last_message_da
-0001f7d0: 7465 7469 6d65 223a 2066 726d 742c 207d  tetime": frmt, }
-0001f7e0: 0d0a 2020 2020 2020 2020 6c69 7374 5f63  ..        list_c
-0001f7f0: 6f6e 7461 6374 732e 5365 7443 6f6c 756d  ontacts.SetColum
-0001f800: 6e73 2863 6f6c 756d 6e73 290d 0a20 2020  ns(columns)..   
-0001f810: 2020 2020 206c 6973 745f 636f 6e74 6163       list_contac
-0001f820: 7473 2e53 6574 436f 6c75 6d6e 466f 726d  ts.SetColumnForm
-0001f830: 6174 7465 7273 2866 6f72 6d61 7474 6572  atters(formatter
-0001f840: 7329 0d0a 2020 2020 2020 2020 6c69 7374  s)..        list
-0001f850: 5f63 6f6e 7461 6374 732e 5365 7443 6f6c  _contacts.SetCol
-0001f860: 756d 6e73 4d61 7857 6964 7468 2833 3030  umnsMaxWidth(300
-0001f870: 290d 0a20 2020 2020 2020 2065 6469 745f  )..        edit_
-0001f880: 636f 6e74 6163 7466 696c 7465 7220 3d20  contactfilter = 
-0001f890: 7365 6c66 2e65 6469 745f 636f 6e74 6163  self.edit_contac
-0001f8a0: 7466 696c 7465 7220 3d20 636f 6e74 726f  tfilter = contro
-0001f8b0: 6c73 2e48 696e 7465 6454 6578 7443 7472  ls.HintedTextCtr
-0001f8c0: 6c28 0d0a 2020 2020 2020 2020 2020 2020  l(..            
-0001f8d0: 7061 6e65 6c31 2c20 2246 696c 7465 7220  panel1, "Filter 
-0001f8e0: 6c69 7374 222c 2073 697a 653d 2837 352c  list", size=(75,
-0001f8f0: 202d 3129 290d 0a20 2020 2020 2020 2065   -1))..        e
-0001f900: 6469 745f 636f 6e74 6163 7466 696c 7465  dit_contactfilte
-0001f910: 722e 5365 7454 6f6f 6c54 6970 2822 4669  r.SetToolTip("Fi
-0001f920: 6c74 6572 2069 7465 6d73 2069 6e20 636f  lter items in co
-0001f930: 6e74 6163 7473 206c 6973 7422 290d 0a20  ntacts list").. 
-0001f940: 2020 2020 2020 2073 656c 662e 4269 6e64         self.Bind
-0001f950: 2877 782e 4556 545f 5445 5854 5f45 4e54  (wx.EVT_TEXT_ENT
-0001f960: 4552 2c20 7365 6c66 2e6f 6e5f 6368 616e  ER, self.on_chan
-0001f970: 6765 5f63 6f6e 7461 6374 6669 6c74 6572  ge_contactfilter
-0001f980: 2c20 6564 6974 5f63 6f6e 7461 6374 6669  , edit_contactfi
-0001f990: 6c74 6572 290d 0a20 2020 2020 2020 2073  lter)..        s
-0001f9a0: 697a 6572 5f74 6f70 2e41 6464 2865 6469  izer_top.Add(edi
-0001f9b0: 745f 636f 6e74 6163 7466 696c 7465 722c  t_contactfilter,
-0001f9c0: 2066 6c61 673d 7778 2e52 4947 4854 2c20   flag=wx.RIGHT, 
-0001f9d0: 626f 7264 6572 3d31 3529 0d0a 2020 2020  border=15)..    
-0001f9e0: 2020 2020 6275 7474 6f6e 5f65 7870 6f72      button_expor
-0001f9f0: 745f 636f 6e74 6163 7473 203d 2073 656c  t_contacts = sel
-0001fa00: 662e 6275 7474 6f6e 5f65 7870 6f72 745f  f.button_export_
-0001fa10: 636f 6e74 6163 7473 203d 205c 0d0a 2020  contacts = \..  
-0001fa20: 2020 2020 2020 2020 2020 7778 2e42 7574            wx.But
-0001fa30: 746f 6e28 7061 7265 6e74 3d70 616e 656c  ton(parent=panel
-0001fa40: 312c 206c 6162 656c 3d22 4578 7026 6f72  1, label="Exp&or
-0001fa50: 7420 636f 6e74 6163 7473 2229 0d0a 2020  t contacts")..  
-0001fa60: 2020 2020 2020 6275 7474 6f6e 5f65 7870        button_exp
-0001fa70: 6f72 745f 6368 6174 7320 3d20 7365 6c66  ort_chats = self
-0001fa80: 2e62 7574 746f 6e5f 6578 706f 7274 5f63  .button_export_c
-0001fa90: 6f6e 7461 6374 735f 6368 6174 7320 3d20  ontacts_chats = 
-0001faa0: 5c0d 0a20 2020 2020 2020 2020 2020 2077  \..            w
-0001fab0: 782e 4275 7474 6f6e 2870 6172 656e 743d  x.Button(parent=
-0001fac0: 7061 6e65 6c31 2c20 6c61 6265 6c3d 2245  panel1, label="E
-0001fad0: 7870 266f 7274 2063 6861 7473 2229 0d0a  xp&ort chats")..
-0001fae0: 2020 2020 2020 2020 7369 7a65 725f 746f          sizer_to
-0001faf0: 702e 4164 6428 6275 7474 6f6e 5f65 7870  p.Add(button_exp
-0001fb00: 6f72 745f 636f 6e74 6163 7473 290d 0a20  ort_contacts).. 
-0001fb10: 2020 2020 2020 2073 697a 6572 5f74 6f70         sizer_top
-0001fb20: 2e41 6464 2862 7574 746f 6e5f 6578 706f  .Add(button_expo
-0001fb30: 7274 5f63 6861 7473 2c20 626f 7264 6572  rt_chats, border
-0001fb40: 3d35 2c20 666c 6167 3d77 782e 4c45 4654  =5, flag=wx.LEFT
-0001fb50: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-0001fb60: 4269 6e64 2877 782e 4556 545f 4255 5454  Bind(wx.EVT_BUTT
-0001fb70: 4f4e 2c20 7365 6c66 2e6f 6e5f 6578 706f  ON, self.on_expo
-0001fb80: 7274 5f63 6f6e 7461 6374 735f 6d65 6e75  rt_contacts_menu
-0001fb90: 2c20 6275 7474 6f6e 5f65 7870 6f72 745f  , button_export_
-0001fba0: 6368 6174 7329 0d0a 2020 2020 2020 2020  chats)..        
-0001fbb0: 7365 6c66 2e42 696e 6428 7778 2e45 5654  self.Bind(wx.EVT
-0001fbc0: 5f42 5554 544f 4e2c 2073 656c 662e 6f6e  _BUTTON, self.on
-0001fbd0: 5f65 7870 6f72 745f 636f 6e74 6163 7473  _export_contacts
-0001fbe0: 2c20 2020 2020 2062 7574 746f 6e5f 6578  ,      button_ex
-0001fbf0: 706f 7274 5f63 6f6e 7461 6374 7329 0d0a  port_contacts)..
-0001fc00: 2020 2020 2020 2020 7369 7a65 7231 2e41          sizer1.A
-0001fc10: 6464 2873 697a 6572 5f74 6f70 2c20 626f  dd(sizer_top, bo
-0001fc20: 7264 6572 3d35 2c0d 0a20 2020 2020 2020  rder=5,..       
-0001fc30: 2020 2020 2020 2020 2020 2020 666c 6167              flag
-0001fc40: 3d77 782e 5249 4748 5420 7c20 7778 2e4c  =wx.RIGHT | wx.L
-0001fc50: 4546 5420 7c20 7778 2e42 4f54 544f 4d20  EFT | wx.BOTTOM 
-0001fc60: 7c20 7778 2e47 524f 5729 0d0a 0d0a 2020  | wx.GROW)....  
-0001fc70: 2020 2020 2020 7061 6e65 6c32 203d 2073        panel2 = s
-0001fc80: 656c 662e 7061 6e65 6c5f 636f 6e74 6163  elf.panel_contac
-0001fc90: 7473 3220 3d20 7778 2e50 616e 656c 2870  ts2 = wx.Panel(p
-0001fca0: 6172 656e 743d 7370 6c69 7474 6572 290d  arent=splitter).
-0001fcb0: 0a20 2020 2020 2020 2073 697a 6572 3220  .        sizer2 
-0001fcc0: 3d20 7061 6e65 6c32 2e53 697a 6572 203d  = panel2.Sizer =
-0001fcd0: 2077 782e 426f 7853 697a 6572 2877 782e   wx.BoxSizer(wx.
-0001fce0: 5645 5254 4943 414c 290d 0a20 2020 2020  VERTICAL)..     
-0001fcf0: 2020 2073 697a 6572 325f 746f 7020 3d20     sizer2_top = 
-0001fd00: 7778 2e42 6f78 5369 7a65 7228 7778 2e48  wx.BoxSizer(wx.H
-0001fd10: 4f52 495a 4f4e 5441 4c29 0d0a 2020 2020  ORIZONTAL)..    
-0001fd20: 2020 2020 6c61 6265 6c5f 636f 6e74 6163      label_contac
-0001fd30: 7420 3d20 7365 6c66 2e6c 6162 656c 5f63  t = self.label_c
-0001fd40: 6f6e 7461 6374 203d 2077 782e 5374 6174  ontact = wx.Stat
-0001fd50: 6963 5465 7874 2870 6172 656e 743d 7061  icText(parent=pa
-0001fd60: 6e65 6c32 2c20 6c61 6265 6c3d 2226 436f  nel2, label="&Co
-0001fd70: 6e74 6163 743a 2229 0d0a 2020 2020 2020  ntact:")..      
-0001fd80: 2020 6275 7474 6f6e 5f61 6374 696f 6e20    button_action 
-0001fd90: 3d20 7365 6c66 2e62 7574 746f 6e5f 6163  = self.button_ac
-0001fda0: 7469 6f6e 5f63 6f6e 7461 6374 203d 2077  tion_contact = w
-0001fdb0: 782e 4275 7474 6f6e 280d 0a20 2020 2020  x.Button(..     
-0001fdc0: 2020 2020 2020 2070 6172 656e 743d 7061         parent=pa
-0001fdd0: 6e65 6c32 2c20 6c61 6265 6c3d 2226 4163  nel2, label="&Ac
-0001fde0: 7469 6f6e 7320 2e2e 2229 0d0a 2020 2020  tions ..")..    
-0001fdf0: 2020 2020 6275 7474 6f6e 5f65 7870 6f72      button_expor
-0001fe00: 7420 3d20 7365 6c66 2e62 7574 746f 6e5f  t = self.button_
-0001fe10: 6578 706f 7274 5f63 6f6e 7461 6374 5f63  export_contact_c
-0001fe20: 6861 7473 203d 2077 782e 4275 7474 6f6e  hats = wx.Button
-0001fe30: 280d 0a20 2020 2020 2020 2020 2020 2070  (..            p
-0001fe40: 6172 656e 743d 7061 6e65 6c32 2c20 6c61  arent=panel2, la
-0001fe50: 6265 6c3d 2226 4578 706f 7274 2063 6f6e  bel="&Export con
-0001fe60: 7461 6374 2063 6861 7473 2229 0d0a 2020  tact chats")..  
-0001fe70: 2020 2020 2020 6275 7474 6f6e 5f61 6374        button_act
-0001fe80: 696f 6e2e 5365 7454 6f6f 6c54 6970 2822  ion.SetToolTip("
-0001fe90: 4f70 656e 2073 7562 6d65 6e75 2229 0d0a  Open submenu")..
-0001fea0: 2020 2020 2020 2020 6275 7474 6f6e 5f65          button_e
-0001feb0: 7870 6f72 742e 5365 7454 6f6f 6c54 6970  xport.SetToolTip
-0001fec0: 2822 4578 706f 7274 2063 6f6e 7461 6374  ("Export contact
-0001fed0: 2063 6861 7473 2061 6e64 206d 6573 7361   chats and messa
-0001fee0: 6765 7320 746f 2066 696c 6522 290d 0a20  ges to file").. 
-0001fef0: 2020 2020 2020 2068 746d 6c5f 636f 6e74         html_cont
-0001ff00: 6163 7420 3d20 7365 6c66 2e68 746d 6c5f  act = self.html_
-0001ff10: 636f 6e74 6163 7420 3d20 7778 2e68 746d  contact = wx.htm
-0001ff20: 6c2e 4874 6d6c 5769 6e64 6f77 2870 6172  l.HtmlWindow(par
-0001ff30: 656e 743d 7061 6e65 6c32 290d 0a20 2020  ent=panel2)..   
-0001ff40: 2020 2020 2068 746d 6c5f 636f 6e74 6163       html_contac
-0001ff50: 742e 4261 636b 6772 6f75 6e64 436f 6c6f  t.BackgroundColo
-0001ff60: 7572 203d 2043 6f6c 6f75 724d 616e 6167  ur = ColourManag
-0001ff70: 6572 2e47 6574 436f 6c6f 7572 2877 782e  er.GetColour(wx.
-0001ff80: 5359 535f 434f 4c4f 5552 5f57 494e 444f  SYS_COLOUR_WINDO
-0001ff90: 5729 0d0a 2020 2020 2020 2020 7061 6e65  W)..        pane
-0001ffa0: 6c32 2e44 6973 6162 6c65 2829 0d0a 2020  l2.Disable()..  
-0001ffb0: 2020 2020 2020 6275 7474 6f6e 5f61 6374        button_act
-0001ffc0: 696f 6e2e 4269 6e64 2877 782e 4556 545f  ion.Bind(wx.EVT_
-0001ffd0: 4255 5454 4f4e 2c20 7365 6c66 2e6f 6e5f  BUTTON, self.on_
-0001ffe0: 6d65 6e75 5f6c 6973 745f 636f 6e74 6163  menu_list_contac
-0001fff0: 7473 290d 0a20 2020 2020 2020 2062 7574  ts)..        but
-00020000: 746f 6e5f 6578 706f 7274 2e42 696e 6428  ton_export.Bind(
-00020010: 7778 2e45 5654 5f42 5554 544f 4e2c 2073  wx.EVT_BUTTON, s
-00020020: 656c 662e 6f6e 5f65 7870 6f72 745f 636f  elf.on_export_co
-00020030: 6e74 6163 745f 6368 6174 735f 6d65 6e75  ntact_chats_menu
-00020040: 290d 0a20 2020 2020 2020 2068 746d 6c5f  )..        html_
-00020050: 636f 6e74 6163 742e 4269 6e64 2877 782e  contact.Bind(wx.
-00020060: 6874 6d6c 2e45 5654 5f48 544d 4c5f 4c49  html.EVT_HTML_LI
-00020070: 4e4b 5f43 4c49 434b 4544 2c20 7365 6c66  NK_CLICKED, self
-00020080: 2e6f 6e5f 636c 6963 6b5f 6874 6d6c 5f63  .on_click_html_c
-00020090: 6f6e 7461 6374 290d 0a20 2020 2020 2020  ontact)..       
-000200a0: 2068 746d 6c5f 636f 6e74 6163 742e 4269   html_contact.Bi
-000200b0: 6e64 2877 782e 4556 545f 434f 4e54 4558  nd(wx.EVT_CONTEX
-000200c0: 545f 4d45 4e55 2c20 2020 2020 2020 2020  T_MENU,         
-000200d0: 2020 7365 6c66 2e6f 6e5f 7269 6768 7463    self.on_rightc
-000200e0: 6c69 636b 5f68 746d 6c29 0d0a 2020 2020  lick_html)..    
-000200f0: 2020 2020 6874 6d6c 5f63 6f6e 7461 6374      html_contact
-00020100: 2e42 696e 6428 7778 2e45 5654 5f52 4947  .Bind(wx.EVT_RIG
-00020110: 4854 5f55 502c 2020 2020 2020 2020 2020  HT_UP,          
-00020120: 2020 2020 2073 656c 662e 6f6e 5f72 6967       self.on_rig
-00020130: 6874 636c 6963 6b5f 6874 6d6c 290d 0a0d  htclick_html)...
-00020140: 0a20 2020 2020 2020 2073 656c 662e 4269  .        self.Bi
-00020150: 6e64 2877 782e 4556 545f 4c49 5354 5f49  nd(wx.EVT_LIST_I
-00020160: 5445 4d5f 4143 5449 5641 5445 442c 2073  TEM_ACTIVATED, s
-00020170: 656c 662e 6f6e 5f63 6861 6e67 655f 6c69  elf.on_change_li
-00020180: 7374 5f63 6f6e 7461 6374 732c 206c 6973  st_contacts, lis
-00020190: 745f 636f 6e74 6163 7473 290d 0a20 2020  t_contacts)..   
-000201a0: 2020 2020 206c 6973 745f 636f 6e74 6163       list_contac
-000201b0: 7473 2e42 696e 6428 7778 2e45 5654 5f43  ts.Bind(wx.EVT_C
-000201c0: 4f4e 5445 5854 5f4d 454e 552c 2073 656c  ONTEXT_MENU, sel
-000201d0: 662e 6f6e 5f6d 656e 755f 6c69 7374 5f63  f.on_menu_list_c
-000201e0: 6f6e 7461 6374 7329 0d0a 2020 2020 2020  ontacts)..      
-000201f0: 2020 6c69 7374 5f63 6f6e 7461 6374 732e    list_contacts.
-00020200: 4269 6e64 2877 782e 4556 545f 4348 4152  Bind(wx.EVT_CHAR
-00020210: 5f48 4f4f 4b2c 2020 2020 7365 6c66 2e6f  _HOOK,    self.o
-00020220: 6e5f 6c69 7374 5f63 6f6e 7461 6374 735f  n_list_contacts_
-00020230: 6b65 7929 0d0a 0d0a 2020 2020 2020 2020  key)....        
-00020240: 7369 7a65 7231 2e41 6464 286c 6973 745f  sizer1.Add(list_
-00020250: 636f 6e74 6163 7473 2c20 7072 6f70 6f72  contacts, propor
-00020260: 7469 6f6e 3d31 2c20 626f 7264 6572 3d35  tion=1, border=5
-00020270: 2c20 666c 6167 3d77 782e 4752 4f57 207c  , flag=wx.GROW |
-00020280: 2077 782e 4c45 4654 207c 2077 782e 5249   wx.LEFT | wx.RI
-00020290: 4748 5429 0d0a 2020 2020 2020 2020 7369  GHT)..        si
-000202a0: 7a65 7232 5f74 6f70 2e41 6464 286c 6162  zer2_top.Add(lab
-000202b0: 656c 5f63 6f6e 7461 6374 2c20 7072 6f70  el_contact, prop
-000202c0: 6f72 7469 6f6e 3d31 2c20 626f 7264 6572  ortion=1, border
-000202d0: 3d35 2c20 666c 6167 3d77 782e 4c45 4654  =5, flag=wx.LEFT
-000202e0: 207c 2077 782e 424f 5454 4f4d 207c 2077   | wx.BOTTOM | w
-000202f0: 782e 414c 4947 4e5f 424f 5454 4f4d 290d  x.ALIGN_BOTTOM).
-00020300: 0a20 2020 2020 2020 2073 697a 6572 325f  .        sizer2_
-00020310: 746f 702e 4164 6453 7472 6574 6368 5370  top.AddStretchSp
-00020320: 6163 6572 2829 0d0a 2020 2020 2020 2020  acer()..        
-00020330: 7369 7a65 7232 5f74 6f70 2e41 6464 2862  sizer2_top.Add(b
-00020340: 7574 746f 6e5f 6163 7469 6f6e 2c20 626f  utton_action, bo
-00020350: 7264 6572 3d35 2c20 666c 6167 3d77 782e  rder=5, flag=wx.
-00020360: 424f 5454 4f4d 207c 2077 782e 5249 4748  BOTTOM | wx.RIGH
-00020370: 5429 0d0a 2020 2020 2020 2020 7369 7a65  T)..        size
-00020380: 7232 5f74 6f70 2e41 6464 2862 7574 746f  r2_top.Add(butto
-00020390: 6e5f 6578 706f 7274 2c20 626f 7264 6572  n_export, border
-000203a0: 3d35 2c20 666c 6167 3d77 782e 424f 5454  =5, flag=wx.BOTT
-000203b0: 4f4d 290d 0a20 2020 2020 2020 2073 697a  OM)..        siz
-000203c0: 6572 322e 4164 6428 7369 7a65 7232 5f74  er2.Add(sizer2_t
-000203d0: 6f70 2c20 626f 7264 6572 3d35 2c20 666c  op, border=5, fl
-000203e0: 6167 3d77 782e 4752 4f57 207c 2077 782e  ag=wx.GROW | wx.
-000203f0: 414c 4c20 5e20 7778 2e42 4f54 544f 4d29  ALL ^ wx.BOTTOM)
-00020400: 0d0a 2020 2020 2020 2020 7369 7a65 7232  ..        sizer2
-00020410: 2e41 6464 2868 746d 6c5f 636f 6e74 6163  .Add(html_contac
-00020420: 742c 2020 626f 7264 6572 3d35 2c20 666c  t,  border=5, fl
-00020430: 6167 3d77 782e 4752 4f57 207c 2077 782e  ag=wx.GROW | wx.
-00020440: 414c 4c20 5e20 7778 2e54 4f50 2c20 7072  ALL ^ wx.TOP, pr
-00020450: 6f70 6f72 7469 6f6e 3d31 290d 0a0d 0a20  oportion=1).... 
-00020460: 2020 2020 2020 2073 697a 6572 2e41 6464         sizer.Add
-00020470: 5370 6163 6572 2831 3029 0d0a 2020 2020  Spacer(10)..    
-00020480: 2020 2020 7369 7a65 722e 4164 6428 7370      sizer.Add(sp
-00020490: 6c69 7474 6572 2c20 7072 6f70 6f72 7469  litter, proporti
-000204a0: 6f6e 3d31 2c20 666c 6167 3d77 782e 4752  on=1, flag=wx.GR
-000204b0: 4f57 290d 0a20 2020 2020 2020 2073 706c  OW)..        spl
-000204c0: 6974 7465 722e 5370 6c69 7448 6f72 697a  itter.SplitHoriz
-000204d0: 6f6e 7461 6c6c 7928 7061 6e65 6c31 2c20  ontally(panel1, 
-000204e0: 7061 6e65 6c32 2c20 7361 7368 506f 7369  panel2, sashPosi
-000204f0: 7469 6f6e 3d73 656c 662e 5369 7a65 5b31  tion=self.Size[1
-00020500: 5d20 2f2f 2033 290d 0a0d 0a0d 0a20 2020  ] // 3)......   
-00020510: 2064 6566 2063 7265 6174 655f 7061 6765   def create_page
-00020520: 5f73 6561 7263 6828 7365 6c66 2c20 6e6f  _search(self, no
-00020530: 7465 626f 6f6b 293a 0d0a 2020 2020 2020  tebook):..      
-00020540: 2020 2222 2243 7265 6174 6573 2061 2070    """Creates a p
-00020550: 6167 6520 666f 7220 7365 6172 6368 696e  age for searchin
-00020560: 6720 6368 6174 732e 2222 220d 0a20 2020  g chats."""..   
-00020570: 2020 2020 2070 6167 6520 3d20 7365 6c66       page = self
-00020580: 2e70 6167 655f 7365 6172 6368 203d 2077  .page_search = w
-00020590: 782e 5061 6e65 6c28 7061 7265 6e74 3d6e  x.Panel(parent=n
-000205a0: 6f74 6562 6f6f 6b29 0d0a 2020 2020 2020  otebook)..      
-000205b0: 2020 7365 6c66 2e70 6167 656f 7264 6572    self.pageorder
-000205c0: 5b70 6167 655d 203d 206c 656e 2873 656c  [page] = len(sel
-000205d0: 662e 7061 6765 6f72 6465 7229 0d0a 2020  f.pageorder)..  
-000205e0: 2020 2020 2020 6e6f 7465 626f 6f6b 2e41        notebook.A
-000205f0: 6464 5061 6765 2870 6167 652c 2022 5365  ddPage(page, "Se
-00020600: 6172 6368 2229 0d0a 2020 2020 2020 2020  arch")..        
-00020610: 7369 7a65 7220 3d20 7061 6765 2e53 697a  sizer = page.Siz
-00020620: 6572 203d 2077 782e 426f 7853 697a 6572  er = wx.BoxSizer
-00020630: 2877 782e 5645 5254 4943 414c 290d 0a20  (wx.VERTICAL).. 
-00020640: 2020 2020 2020 2073 697a 6572 5f74 6f70         sizer_top
-00020650: 203d 2077 782e 426f 7853 697a 6572 2877   = wx.BoxSizer(w
-00020660: 782e 484f 5249 5a4f 4e54 414c 290d 0a0d  x.HORIZONTAL)...
-00020670: 0a20 2020 2020 2020 206c 6162 656c 5f68  .        label_h
-00020680: 746d 6c20 3d20 7365 6c66 2e6c 6162 656c  tml = self.label
-00020690: 5f68 746d 6c20 3d20 5c0d 0a20 2020 2020  _html = \..     
-000206a0: 2020 2020 2020 2077 782e 6874 6d6c 2e48         wx.html.H
-000206b0: 746d 6c57 696e 646f 7728 7061 6765 2c20  tmlWindow(page, 
-000206c0: 7374 796c 653d 7778 2e68 746d 6c2e 4857  style=wx.html.HW
-000206d0: 5f53 4352 4f4c 4c42 4152 5f4e 4556 4552  _SCROLLBAR_NEVER
-000206e0: 290d 0a20 2020 2020 2020 206c 6162 656c  )..        label
-000206f0: 5f68 746d 6c2e 5365 7446 6f6e 7473 286e  _html.SetFonts(n
-00020700: 6f72 6d61 6c5f 6661 6365 3d73 656c 662e  ormal_face=self.
-00020710: 466f 6e74 2e46 6163 654e 616d 652c 0d0a  Font.FaceName,..
-00020720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020730: 2020 2020 2020 2020 2020 2020 6669 7865              fixe
-00020740: 645f 6661 6365 3d73 656c 662e 466f 6e74  d_face=self.Font
-00020750: 2e46 6163 654e 616d 652c 2073 697a 6573  .FaceName, sizes
-00020760: 3d5b 385d 202a 2037 290d 0a20 2020 2020  =[8] * 7)..     
-00020770: 2020 206c 6162 656c 5f68 746d 6c2e 5365     label_html.Se
-00020780: 7450 6167 6528 7374 6570 2e54 656d 706c  tPage(step.Templ
-00020790: 6174 6528 7465 6d70 6c61 7465 732e 5345  ate(templates.SE
-000207a0: 4152 4348 5f48 454c 505f 5348 4f52 5429  ARCH_HELP_SHORT)
-000207b0: 2e65 7870 616e 6428 2929 0d0a 0d0a 2020  .expand())....  
-000207c0: 2020 2020 2020 7462 203d 2073 656c 662e        tb = self.
-000207d0: 7462 5f73 6561 7263 685f 7365 7474 696e  tb_search_settin
-000207e0: 6773 203d 205c 0d0a 2020 2020 2020 2020  gs = \..        
-000207f0: 2020 2020 7778 2e54 6f6f 6c42 6172 2870      wx.ToolBar(p
-00020800: 6172 656e 743d 7061 6765 2c20 7374 796c  arent=page, styl
-00020810: 653d 7778 2e54 425f 464c 4154 207c 2077  e=wx.TB_FLAT | w
-00020820: 782e 5442 5f4e 4f44 4956 4944 4552 290d  x.TB_NODIVIDER).
-00020830: 0a20 2020 2020 2020 2074 622e 4d69 6e53  .        tb.MinS
-00020840: 697a 6520 3d20 2831 3935 2c20 2d31 290d  ize = (195, -1).
-00020850: 0a20 2020 2020 2020 2074 622e 5365 7454  .        tb.SetT
-00020860: 6f6f 6c42 6974 6d61 7053 697a 6528 2832  oolBitmapSize((2
-00020870: 342c 2032 3429 290d 0a20 2020 2020 2020  4, 24))..       
-00020880: 2074 622e 4164 6452 6164 696f 546f 6f6c   tb.AddRadioTool
-00020890: 2877 782e 4944 5f49 4e44 4558 2c20 2222  (wx.ID_INDEX, ""
-000208a0: 2c20 6269 746d 6170 313d 696d 6167 6573  , bitmap1=images
-000208b0: 2e54 6f6f 6c62 6172 4d65 7373 6167 652e  .ToolbarMessage.
-000208c0: 4269 746d 6170 2c0d 0a20 2020 2020 2020  Bitmap,..       
-000208d0: 2020 2020 2073 686f 7274 4865 6c70 3d22       shortHelp="
-000208e0: 5365 6172 6368 2069 6e20 6d65 7373 6167  Search in messag
-000208f0: 6520 626f 6479 2229 0d0a 2020 2020 2020  e body")..      
-00020900: 2020 7462 2e41 6464 5261 6469 6f54 6f6f    tb.AddRadioToo
-00020910: 6c28 7778 2e49 445f 5052 4556 4945 572c  l(wx.ID_PREVIEW,
-00020920: 2022 222c 2062 6974 6d61 7031 3d69 6d61   "", bitmap1=ima
-00020930: 6765 732e 546f 6f6c 6261 7243 6f6e 7461  ges.ToolbarConta
-00020940: 6374 2e42 6974 6d61 702c 0d0a 2020 2020  ct.Bitmap,..    
-00020950: 2020 2020 2020 2020 7368 6f72 7448 656c          shortHel
-00020960: 703d 2253 6561 7263 6820 696e 2063 6f6e  p="Search in con
-00020970: 7461 6374 2069 6e66 6f72 6d61 7469 6f6e  tact information
-00020980: 2229 0d0a 2020 2020 2020 2020 7462 2e41  ")..        tb.A
-00020990: 6464 5261 6469 6f54 6f6f 6c28 7778 2e49  ddRadioTool(wx.I
-000209a0: 445f 4142 4f55 542c 2022 222c 2062 6974  D_ABOUT, "", bit
-000209b0: 6d61 7031 3d69 6d61 6765 732e 546f 6f6c  map1=images.Tool
-000209c0: 6261 7254 6974 6c65 2e42 6974 6d61 702c  barTitle.Bitmap,
-000209d0: 0d0a 2020 2020 2020 2020 2020 2020 7368  ..            sh
-000209e0: 6f72 7448 656c 703d 2253 6561 7263 6820  ortHelp="Search 
-000209f0: 696e 2063 6861 7420 7469 746c 6520 616e  in chat title an
-00020a00: 6420 7061 7274 6963 6970 616e 7473 2229  d participants")
-00020a10: 0d0a 2020 2020 2020 2020 7462 2e41 6464  ..        tb.Add
-00020a20: 5261 6469 6f54 6f6f 6c28 7778 2e49 445f  RadioTool(wx.ID_
-00020a30: 5354 4154 4943 2c20 2222 2c20 6269 746d  STATIC, "", bitm
-00020a40: 6170 313d 696d 6167 6573 2e54 6f6f 6c62  ap1=images.Toolb
-00020a50: 6172 5461 626c 6573 2e42 6974 6d61 702c  arTables.Bitmap,
-00020a60: 0d0a 2020 2020 2020 2020 2020 2020 7368  ..            sh
-00020a70: 6f72 7448 656c 703d 2253 6561 7263 6820  ortHelp="Search 
-00020a80: 696e 2061 6c6c 2063 6f6c 756d 6e73 206f  in all columns o
-00020a90: 6620 616c 6c20 6461 7461 6261 7365 2074  f all database t
-00020aa0: 6162 6c65 7322 290d 0a20 2020 2020 2020  ables")..       
-00020ab0: 2074 622e 4164 6453 6570 6172 6174 6f72   tb.AddSeparator
-00020ac0: 2829 0d0a 2020 2020 2020 2020 7462 2e41  ()..        tb.A
-00020ad0: 6464 4368 6563 6b54 6f6f 6c28 7778 2e49  ddCheckTool(wx.I
-00020ae0: 445f 4e45 572c 2022 222c 2062 6974 6d61  D_NEW, "", bitma
-00020af0: 7031 3d69 6d61 6765 732e 546f 6f6c 6261  p1=images.Toolba
-00020b00: 7254 6162 732e 4269 746d 6170 2c0d 0a20  rTabs.Bitmap,.. 
-00020b10: 2020 2020 2020 2020 2020 2073 686f 7274             short
-00020b20: 4865 6c70 3d22 4e65 7720 7461 6220 666f  Help="New tab fo
-00020b30: 7220 6561 6368 2073 6561 7263 6820 2028  r each search  (
-00020b40: 416c 742d 4e29 222c 206c 6f6e 6748 656c  Alt-N)", longHel
-00020b50: 703d 2222 290d 0a20 2020 2020 2020 2074  p="")..        t
-00020b60: 622e 4164 6454 6f6f 6c28 7778 2e49 445f  b.AddTool(wx.ID_
-00020b70: 5354 4f50 2c20 2222 2c20 6269 746d 6170  STOP, "", bitmap
-00020b80: 3d69 6d61 6765 732e 546f 6f6c 6261 7253  =images.ToolbarS
-00020b90: 746f 7070 6564 2e42 6974 6d61 702c 0d0a  topped.Bitmap,..
-00020ba0: 2020 2020 2020 2020 2020 2020 7368 6f72              shor
-00020bb0: 7448 656c 703d 2253 746f 7020 6375 7272  tHelp="Stop curr
-00020bc0: 656e 7420 7365 6172 6368 2c20 6966 2061  ent search, if a
-00020bd0: 6e79 2229 0d0a 2020 2020 2020 2020 7462  ny")..        tb
-00020be0: 2e52 6561 6c69 7a65 2829 0d0a 2020 2020  .Realize()..    
-00020bf0: 2020 2020 7462 2e54 6f67 676c 6554 6f6f      tb.ToggleToo
-00020c00: 6c28 7778 2e49 445f 494e 4445 582c 2063  l(wx.ID_INDEX, c
-00020c10: 6f6e 662e 5365 6172 6368 496e 4d65 7373  onf.SearchInMess
-00020c20: 6167 6573 290d 0a20 2020 2020 2020 2074  ages)..        t
-00020c30: 622e 546f 6767 6c65 546f 6f6c 2877 782e  b.ToggleTool(wx.
-00020c40: 4944 5f41 424f 5554 2c20 636f 6e66 2e53  ID_ABOUT, conf.S
-00020c50: 6561 7263 6849 6e43 6861 7449 6e66 6f29  earchInChatInfo)
-00020c60: 0d0a 2020 2020 2020 2020 7462 2e54 6f67  ..        tb.Tog
-00020c70: 676c 6554 6f6f 6c28 7778 2e49 445f 5052  gleTool(wx.ID_PR
-00020c80: 4556 4945 572c 2063 6f6e 662e 5365 6172  EVIEW, conf.Sear
-00020c90: 6368 496e 436f 6e74 6163 7473 290d 0a20  chInContacts).. 
-00020ca0: 2020 2020 2020 2074 622e 546f 6767 6c65         tb.Toggle
-00020cb0: 546f 6f6c 2877 782e 4944 5f53 5441 5449  Tool(wx.ID_STATI
-00020cc0: 432c 2063 6f6e 662e 5365 6172 6368 496e  C, conf.SearchIn
-00020cd0: 5461 626c 6573 290d 0a20 2020 2020 2020  Tables)..       
-00020ce0: 2074 622e 546f 6767 6c65 546f 6f6c 2877   tb.ToggleTool(w
-00020cf0: 782e 4944 5f4e 4557 2c20 636f 6e66 2e53  x.ID_NEW, conf.S
-00020d00: 6561 7263 6855 7365 4e65 7754 6162 290d  earchUseNewTab).
-00020d10: 0a20 2020 2020 2020 2066 6f72 2069 6420  .        for id 
-00020d20: 696e 205b 7778 2e49 445f 494e 4445 582c  in [wx.ID_INDEX,
-00020d30: 2077 782e 4944 5f41 424f 5554 2c20 7778   wx.ID_ABOUT, wx
-00020d40: 2e49 445f 5052 4556 4945 572c 2077 782e  .ID_PREVIEW, wx.
-00020d50: 4944 5f53 5441 5449 432c 0d0a 2020 2020  ID_STATIC,..    
-00020d60: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-00020d70: 782e 4944 5f4e 4557 5d3a 0d0a 2020 2020  x.ID_NEW]:..    
-00020d80: 2020 2020 2020 2020 7365 6c66 2e42 696e          self.Bin
-00020d90: 6428 7778 2e45 5654 5f54 4f4f 4c2c 2073  d(wx.EVT_TOOL, s
-00020da0: 656c 662e 6f6e 5f73 6561 7263 6861 6c6c  elf.on_searchall
-00020db0: 5f74 6f67 676c 655f 746f 6f6c 6261 722c  _toggle_toolbar,
-00020dc0: 2069 643d 6964 290d 0a20 2020 2020 2020   id=id)..       
-00020dd0: 2073 656c 662e 4269 6e64 2877 782e 4556   self.Bind(wx.EV
-00020de0: 545f 544f 4f4c 2c20 7365 6c66 2e6f 6e5f  T_TOOL, self.on_
-00020df0: 7365 6172 6368 616c 6c5f 7374 6f70 2c20  searchall_stop, 
-00020e00: 6964 3d77 782e 4944 5f53 544f 5029 0d0a  id=wx.ID_STOP)..
-00020e10: 0d0a 2020 2020 2020 2020 6966 2063 6f6e  ..        if con
-00020e20: 662e 5365 6172 6368 496e 4368 6174 496e  f.SearchInChatIn
-00020e30: 666f 3a0d 0a20 2020 2020 2020 2020 2020  fo:..           
-00020e40: 2073 656c 662e 6c61 6265 6c5f 7365 6172   self.label_sear
-00020e50: 6368 2e4c 6162 656c 203d 2022 2653 6561  ch.Label = "&Sea
-00020e60: 7263 6820 696e 2063 6861 7420 696e 666f  rch in chat info
-00020e70: 3a22 0d0a 2020 2020 2020 2020 656c 6966  :"..        elif
-00020e80: 2063 6f6e 662e 5365 6172 6368 496e 436f   conf.SearchInCo
-00020e90: 6e74 6163 7473 3a0d 0a20 2020 2020 2020  ntacts:..       
-00020ea0: 2020 2020 2073 656c 662e 6c61 6265 6c5f       self.label_
-00020eb0: 7365 6172 6368 2e4c 6162 656c 203d 2022  search.Label = "
-00020ec0: 2653 6561 7263 6820 696e 2063 6f6e 7461  &Search in conta
-00020ed0: 6374 733a 220d 0a20 2020 2020 2020 2065  cts:"..        e
-00020ee0: 6c69 6620 636f 6e66 2e53 6561 7263 6849  lif conf.SearchI
-00020ef0: 6e54 6162 6c65 733a 0d0a 2020 2020 2020  nTables:..      
-00020f00: 2020 2020 2020 7365 6c66 2e6c 6162 656c        self.label
-00020f10: 5f73 6561 7263 682e 4c61 6265 6c20 3d20  _search.Label = 
-00020f20: 2226 5365 6172 6368 2069 6e20 616c 6c20  "&Search in all 
-00020f30: 7461 626c 6573 3a22 0d0a 0d0a 2020 2020  tables:"....    
-00020f40: 2020 2020 6874 6d6c 203d 2073 656c 662e      html = self.
-00020f50: 6874 6d6c 5f73 6561 7263 6861 6c6c 203d  html_searchall =
-00020f60: 2063 6f6e 7472 6f6c 732e 5461 6262 6564   controls.Tabbed
-00020f70: 4874 6d6c 5769 6e64 6f77 2870 6172 656e  HtmlWindow(paren
-00020f80: 743d 7061 6765 290d 0a20 2020 2020 2020  t=page)..       
-00020f90: 2043 6f6c 6f75 724d 616e 6167 6572 2e4d   ColourManager.M
-00020fa0: 616e 6167 6528 6874 6d6c 2c20 2254 6162  anage(html, "Tab
-00020fb0: 4172 6561 436f 6c6f 7572 222c 2022 5769  AreaColour", "Wi
-00020fc0: 6467 6574 436f 6c6f 7572 2229 0d0a 2020  dgetColour")..  
-00020fd0: 2020 2020 2020 6465 6661 756c 7420 3d20        default = 
-00020fe0: 7374 6570 2e54 656d 706c 6174 6528 7465  step.Template(te
-00020ff0: 6d70 6c61 7465 732e 5345 4152 4348 5f57  mplates.SEARCH_W
-00021000: 454c 434f 4d45 5f48 544d 4c29 2e65 7870  ELCOME_HTML).exp
-00021010: 616e 6428 290d 0a20 2020 2020 2020 2068  and()..        h
-00021020: 746d 6c2e 5365 7444 6566 6175 6c74 5061  tml.SetDefaultPa
-00021030: 6765 2864 6566 6175 6c74 290d 0a20 2020  ge(default)..   
-00021040: 2020 2020 2068 746d 6c2e 5365 7444 656c       html.SetDel
-00021050: 6574 6543 616c 6c62 6163 6b28 7365 6c66  eteCallback(self
-00021060: 2e6f 6e5f 6465 6c65 7465 5f74 6162 5f63  .on_delete_tab_c
-00021070: 616c 6c62 6163 6b29 0d0a 2020 2020 2020  allback)..      
-00021080: 2020 6c61 6265 6c5f 6874 6d6c 2e42 696e    label_html.Bin
-00021090: 6428 7778 2e45 5654 5f52 4947 4854 5f55  d(wx.EVT_RIGHT_U
-000210a0: 502c 2020 2020 2020 2020 2020 2020 2020  P,              
-000210b0: 2073 656c 662e 6f6e 5f72 6967 6874 636c   self.on_rightcl
-000210c0: 6963 6b5f 6874 6d6c 290d 0a20 2020 2020  ick_html)..     
-000210d0: 2020 206c 6162 656c 5f68 746d 6c2e 4269     label_html.Bi
-000210e0: 6e64 2877 782e 6874 6d6c 2e45 5654 5f48  nd(wx.html.EVT_H
-000210f0: 544d 4c5f 4c49 4e4b 5f43 4c49 434b 4544  TML_LINK_CLICKED
-00021100: 2c20 7365 6c66 2e6f 6e5f 636c 6963 6b5f  , self.on_click_
-00021110: 6874 6d6c 5f6c 696e 6b29 0d0a 2020 2020  html_link)..    
-00021120: 2020 2020 6874 6d6c 2e42 696e 6428 7778      html.Bind(wx
-00021130: 2e68 746d 6c2e 4556 545f 4854 4d4c 5f4c  .html.EVT_HTML_L
-00021140: 494e 4b5f 434c 4943 4b45 442c 2020 2020  INK_CLICKED,    
-00021150: 2020 2073 656c 662e 6f6e 5f63 6c69 636b     self.on_click
-00021160: 5f68 746d 6c5f 6c69 6e6b 290d 0a20 2020  _html_link)..   
-00021170: 2020 2020 2068 746d 6c2e 4874 6d6c 5769       html.HtmlWi
-00021180: 6e64 6f77 2e42 696e 6428 7778 2e45 5654  ndow.Bind(wx.EVT
-00021190: 5f43 4f4e 5445 5854 5f4d 454e 552c 2020  _CONTEXT_MENU,  
-000211a0: 2020 2020 7365 6c66 2e6f 6e5f 7269 6768      self.on_righ
-000211b0: 7463 6c69 636b 5f68 746d 6c29 0d0a 2020  tclick_html)..  
-000211c0: 2020 2020 2020 6874 6d6c 2e48 746d 6c57        html.HtmlW
-000211d0: 696e 646f 772e 4269 6e64 2877 782e 4556  indow.Bind(wx.EV
-000211e0: 545f 5249 4748 545f 5550 2c20 2020 2020  T_RIGHT_UP,     
-000211f0: 2020 2020 2073 656c 662e 6f6e 5f72 6967       self.on_rig
-00021200: 6874 636c 6963 6b5f 6874 6d6c 290d 0a20  htclick_html).. 
-00021210: 2020 2020 2020 2068 746d 6c2e 4269 6e64         html.Bind
-00021220: 2877 782e 4556 545f 4e4f 5445 424f 4f4b  (wx.EVT_NOTEBOOK
-00021230: 5f50 4147 455f 4348 414e 4745 442c 2020  _PAGE_CHANGED,  
-00021240: 2020 2020 2020 7365 6c66 2e6f 6e5f 6368        self.on_ch
-00021250: 616e 6765 5f73 6561 7263 6861 6c6c 5f74  ange_searchall_t
-00021260: 6162 290d 0a20 2020 2020 2020 2068 746d  ab)..        htm
-00021270: 6c2e 4269 6e64 2863 6f6e 7472 6f6c 732e  l.Bind(controls.
-00021280: 4556 545f 5441 425f 4c45 4654 5f44 434c  EVT_TAB_LEFT_DCL
-00021290: 4943 4b2c 2020 2020 2020 2020 7365 6c66  ICK,        self
-000212a0: 2e6f 6e5f 6463 6c69 636b 5f73 6561 7263  .on_dclick_searc
-000212b0: 6861 6c6c 5f74 6162 290d 0a20 2020 2020  hall_tab)..     
-000212c0: 2020 2068 746d 6c2e 466f 6e74 2e50 6978     html.Font.Pix
-000212d0: 656c 5369 7a65 203d 2028 302c 2038 290d  elSize = (0, 8).
-000212e0: 0a0d 0a20 2020 2020 2020 2043 6f6c 6f75  ...        Colou
-000212f0: 724d 616e 6167 6572 2e4d 616e 6167 6528  rManager.Manage(
-00021300: 6c61 6265 6c5f 6874 6d6c 2c20 2242 6163  label_html, "Bac
-00021310: 6b67 726f 756e 6443 6f6c 6f75 7222 2c20  kgroundColour", 
-00021320: 2257 6964 6765 7443 6f6c 6f75 7222 290d  "WidgetColour").
-00021330: 0a0d 0a20 2020 2020 2020 2073 697a 6572  ...        sizer
-00021340: 5f74 6f70 2e41 6464 286c 6162 656c 5f68  _top.Add(label_h
-00021350: 746d 6c2c 2070 726f 706f 7274 696f 6e3d  tml, proportion=
-00021360: 312c 2066 6c61 673d 7778 2e47 524f 5729  1, flag=wx.GROW)
-00021370: 0d0a 2020 2020 2020 2020 7369 7a65 725f  ..        sizer_
-00021380: 746f 702e 4164 6428 7462 2c20 626f 7264  top.Add(tb, bord
-00021390: 6572 3d35 2c20 666c 6167 3d77 782e 544f  er=5, flag=wx.TO
-000213a0: 5020 7c20 7778 2e52 4947 4854 207c 0d0a  P | wx.RIGHT |..
-000213b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000213c0: 2020 2020 2020 7778 2e41 4c49 474e 5f43        wx.ALIGN_C
-000213d0: 454e 5445 525f 5645 5254 4943 414c 290d  ENTER_VERTICAL).
-000213e0: 0a20 2020 2020 2020 2073 697a 6572 2e41  .        sizer.A
-000213f0: 6464 2873 697a 6572 5f74 6f70 2c20 626f  dd(sizer_top, bo
-00021400: 7264 6572 3d35 2c20 666c 6167 3d77 782e  rder=5, flag=wx.
-00021410: 544f 5020 7c20 7778 2e52 4947 4854 207c  TOP | wx.RIGHT |
-00021420: 2077 782e 4752 4f57 290d 0a20 2020 2020   wx.GROW)..     
-00021430: 2020 2073 697a 6572 2e41 6464 2868 746d     sizer.Add(htm
-00021440: 6c2c 2062 6f72 6465 723d 352c 2070 726f  l, border=5, pro
-00021450: 706f 7274 696f 6e3d 312c 0d0a 2020 2020  portion=1,..    
-00021460: 2020 2020 2020 2020 2020 2020 2020 666c                fl
-00021470: 6167 3d77 782e 4752 4f57 207c 2077 782e  ag=wx.GROW | wx.
-00021480: 4c45 4654 207c 2077 782e 5249 4748 5420  LEFT | wx.RIGHT 
-00021490: 7c20 7778 2e42 4f54 544f 4d29 0d0a 2020  | wx.BOTTOM)..  
-000214a0: 2020 2020 2020 7778 2e43 616c 6c41 6674        wx.CallAft
-000214b0: 6572 286c 616d 6264 613a 206c 6162 656c  er(lambda: label
-000214c0: 5f68 746d 6c20 616e 6420 6c61 6265 6c5f  _html and label_
-000214d0: 6874 6d6c 2e53 686f 7728 2929 0d0a 0d0a  html.Show())....
-000214e0: 0d0a 2020 2020 6465 6620 6372 6561 7465  ..    def create
-000214f0: 5f70 6167 655f 7461 626c 6573 2873 656c  _page_tables(sel
-00021500: 662c 206e 6f74 6562 6f6f 6b29 3a0d 0a20  f, notebook):.. 
-00021510: 2020 2020 2020 2022 2222 4372 6561 7465         """Create
-00021520: 7320 6120 7061 6765 2066 6f72 206c 6973  s a page for lis
-00021530: 7469 6e67 2061 6e64 2062 726f 7773 696e  ting and browsin
-00021540: 6720 7461 626c 6573 2e22 2222 0d0a 2020  g tables."""..  
-00021550: 2020 2020 2020 7061 6765 203d 2073 656c        page = sel
-00021560: 662e 7061 6765 5f74 6162 6c65 7320 3d20  f.page_tables = 
-00021570: 7778 2e50 616e 656c 2870 6172 656e 743d  wx.Panel(parent=
-00021580: 6e6f 7465 626f 6f6b 290d 0a20 2020 2020  notebook)..     
-00021590: 2020 2073 656c 662e 7061 6765 6f72 6465     self.pageorde
-000215a0: 725b 7061 6765 5d20 3d20 6c65 6e28 7365  r[page] = len(se
-000215b0: 6c66 2e70 6167 656f 7264 6572 290d 0a20  lf.pageorder).. 
-000215c0: 2020 2020 2020 206e 6f74 6562 6f6f 6b2e         notebook.
-000215d0: 4164 6450 6167 6528 7061 6765 2c20 2244  AddPage(page, "D
-000215e0: 6174 6120 7461 626c 6573 2229 0d0a 2020  ata tables")..  
-000215f0: 2020 2020 2020 7369 7a65 7220 3d20 7061        sizer = pa
-00021600: 6765 2e53 697a 6572 203d 2077 782e 426f  ge.Sizer = wx.Bo
-00021610: 7853 697a 6572 2877 782e 484f 5249 5a4f  xSizer(wx.HORIZO
-00021620: 4e54 414c 290d 0a20 2020 2020 2020 2073  NTAL)..        s
-00021630: 706c 6974 7465 7220 3d20 7365 6c66 2e73  plitter = self.s
-00021640: 706c 6974 7465 725f 7461 626c 6573 203d  plitter_tables =
-00021650: 2077 782e 5370 6c69 7474 6572 5769 6e64   wx.SplitterWind
-00021660: 6f77 280d 0a20 2020 2020 2020 2020 2020  ow(..           
-00021670: 2070 6172 656e 743d 7061 6765 2c20 7374   parent=page, st
-00021680: 796c 653d 7778 2e42 4f52 4445 525f 4e4f  yle=wx.BORDER_NO
-00021690: 4e45 0d0a 2020 2020 2020 2020 290d 0a20  NE..        ).. 
-000216a0: 2020 2020 2020 2073 706c 6974 7465 722e         splitter.
-000216b0: 5365 744d 696e 696d 756d 5061 6e65 5369  SetMinimumPaneSi
-000216c0: 7a65 2831 3030 290d 0a0d 0a20 2020 2020  ze(100)....     
-000216d0: 2020 2070 616e 656c 3120 3d20 7778 2e50     panel1 = wx.P
-000216e0: 616e 656c 2870 6172 656e 743d 7370 6c69  anel(parent=spli
-000216f0: 7474 6572 290d 0a20 2020 2020 2020 2073  tter)..        s
-00021700: 697a 6572 3120 3d20 7061 6e65 6c31 2e53  izer1 = panel1.S
-00021710: 697a 6572 203d 2077 782e 426f 7853 697a  izer = wx.BoxSiz
-00021720: 6572 2877 782e 5645 5254 4943 414c 290d  er(wx.VERTICAL).
-00021730: 0a20 2020 2020 2020 2073 697a 6572 5f74  .        sizer_t
-00021740: 6f70 6c65 6674 203d 2077 782e 426f 7853  opleft = wx.BoxS
-00021750: 697a 6572 2877 782e 484f 5249 5a4f 4e54  izer(wx.HORIZONT
-00021760: 414c 290d 0a20 2020 2020 2020 2073 697a  AL)..        siz
-00021770: 6572 5f74 6f70 6c65 6674 2e41 6464 2877  er_topleft.Add(w
-00021780: 782e 5374 6174 6963 5465 7874 2870 6172  x.StaticText(par
-00021790: 656e 743d 7061 6e65 6c31 2c20 6c61 6265  ent=panel1, labe
-000217a0: 6c3d 2226 5461 626c 6573 3a22 292c 0d0a  l="&Tables:"),..
-000217b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000217c0: 2020 2020 2020 2020 2020 666c 6167 3d77            flag=w
-000217d0: 782e 414c 4947 4e5f 4345 4e54 4552 5f56  x.ALIGN_CENTER_V
-000217e0: 4552 5449 4341 4c29 0d0a 2020 2020 2020  ERTICAL)..      
-000217f0: 2020 6275 7474 6f6e 5f72 6566 7265 7368    button_refresh
-00021800: 203d 2073 656c 662e 6275 7474 6f6e 5f72   = self.button_r
-00021810: 6566 7265 7368 5f74 6162 6c65 7320 3d20  efresh_tables = 
-00021820: 5c0d 0a20 2020 2020 2020 2020 2020 2077  \..            w
-00021830: 782e 4275 7474 6f6e 2870 616e 656c 312c  x.Button(panel1,
-00021840: 206c 6162 656c 3d22 5265 6672 6573 6822   label="Refresh"
-00021850: 290d 0a20 2020 2020 2020 2073 697a 6572  )..        sizer
-00021860: 5f74 6f70 6c65 6674 2e41 6464 5374 7265  _topleft.AddStre
-00021870: 7463 6853 7061 6365 7228 290d 0a20 2020  tchSpacer()..   
-00021880: 2020 2020 2073 697a 6572 5f74 6f70 6c65       sizer_tople
-00021890: 6674 2e41 6464 2862 7574 746f 6e5f 7265  ft.Add(button_re
-000218a0: 6672 6573 6829 0d0a 2020 2020 2020 2020  fresh)..        
-000218b0: 7472 6565 203d 2073 656c 662e 7472 6565  tree = self.tree
-000218c0: 5f74 6162 6c65 7320 3d20 7778 2e6c 6962  _tables = wx.lib
-000218d0: 2e67 697a 6d6f 732e 5472 6565 4c69 7374  .gizmos.TreeList
-000218e0: 4374 726c 2870 616e 656c 312c 0d0a 2020  Ctrl(panel1,..  
-000218f0: 2020 2020 2020 2020 2020 6167 7753 7479            agwSty
-00021900: 6c65 3d77 782e 5452 5f44 4546 4155 4c54  le=wx.TR_DEFAULT
-00021910: 5f53 5459 4c45 207c 2077 782e 5452 5f46  _STYLE | wx.TR_F
-00021920: 554c 4c5f 524f 575f 4849 4748 4c49 4748  ULL_ROW_HIGHLIGH
-00021930: 540d 0a20 2020 2020 2020 2029 0d0a 2020  T..        )..  
-00021940: 2020 2020 2020 436f 6c6f 7572 4d61 6e61        ColourMana
-00021950: 6765 722e 4d61 6e61 6765 2874 7265 652c  ger.Manage(tree,
-00021960: 2022 4261 636b 6772 6f75 6e64 436f 6c6f   "BackgroundColo
-00021970: 7572 222c 2077 782e 5359 535f 434f 4c4f  ur", wx.SYS_COLO
-00021980: 5552 5f57 494e 444f 5729 0d0a 2020 2020  UR_WINDOW)..    
-00021990: 2020 2020 436f 6c6f 7572 4d61 6e61 6765      ColourManage
-000219a0: 722e 4d61 6e61 6765 2874 7265 652c 2022  r.Manage(tree, "
-000219b0: 466f 7265 6772 6f75 6e64 436f 6c6f 7572  ForegroundColour
-000219c0: 222c 2077 782e 5359 535f 434f 4c4f 5552  ", wx.SYS_COLOUR
-000219d0: 5f42 544e 5445 5854 290d 0a20 2020 2020  _BTNTEXT)..     
-000219e0: 2020 2074 7265 652e 4164 6443 6f6c 756d     tree.AddColum
-000219f0: 6e28 2254 6162 6c65 2229 0d0a 2020 2020  n("Table")..    
-00021a00: 2020 2020 7472 6565 2e41 6464 436f 6c75      tree.AddColu
-00021a10: 6d6e 2822 496e 666f 2229 0d0a 2020 2020  mn("Info")..    
-00021a20: 2020 2020 7472 6565 2e41 6464 526f 6f74      tree.AddRoot
-00021a30: 2822 4c6f 6164 696e 6720 6461 7461 2e2e  ("Loading data..
-00021a40: 2229 0d0a 2020 2020 2020 2020 7472 6565  ")..        tree
-00021a50: 2e53 6574 4d61 696e 436f 6c75 6d6e 2830  .SetMainColumn(0
-00021a60: 290d 0a20 2020 2020 2020 2074 7265 652e  )..        tree.
-00021a70: 5365 7443 6f6c 756d 6e41 6c69 676e 6d65  SetColumnAlignme
-00021a80: 6e74 2831 2c20 7778 2e41 4c49 474e 5f52  nt(1, wx.ALIGN_R
-00021a90: 4947 4854 290d 0a20 2020 2020 2020 2073  IGHT)..        s
-00021aa0: 656c 662e 4269 6e64 2877 782e 4556 545f  elf.Bind(wx.EVT_
-00021ab0: 4255 5454 4f4e 2c20 7365 6c66 2e6f 6e5f  BUTTON, self.on_
-00021ac0: 7265 6672 6573 685f 7461 626c 6573 2c20  refresh_tables, 
-00021ad0: 6275 7474 6f6e 5f72 6566 7265 7368 290d  button_refresh).
-00021ae0: 0a20 2020 2020 2020 2073 656c 662e 4269  .        self.Bi
-00021af0: 6e64 2877 782e 4556 545f 5452 4545 5f49  nd(wx.EVT_TREE_I
-00021b00: 5445 4d5f 4143 5449 5641 5445 442c 2073  TEM_ACTIVATED, s
-00021b10: 656c 662e 6f6e 5f63 6861 6e67 655f 7472  elf.on_change_tr
-00021b20: 6565 5f74 6162 6c65 732c 2074 7265 6529  ee_tables, tree)
-00021b30: 0d0a 0d0a 2020 2020 2020 2020 7369 7a65  ....        size
-00021b40: 7231 2e41 6464 2873 697a 6572 5f74 6f70  r1.Add(sizer_top
-00021b50: 6c65 6674 2c20 626f 7264 6572 3d35 2c20  left, border=5, 
-00021b60: 666c 6167 3d77 782e 4752 4f57 207c 2077  flag=wx.GROW | w
-00021b70: 782e 4c45 4654 207c 2077 782e 544f 5029  x.LEFT | wx.TOP)
-00021b80: 0d0a 2020 2020 2020 2020 7369 7a65 7231  ..        sizer1
-00021b90: 2e41 6464 2874 7265 652c 2070 726f 706f  .Add(tree, propo
-00021ba0: 7274 696f 6e3d 312c 0d0a 2020 2020 2020  rtion=1,..      
-00021bb0: 2020 2020 2020 2020 2020 2020 2062 6f72               bor
-00021bc0: 6465 723d 352c 2066 6c61 673d 7778 2e47  der=5, flag=wx.G
-00021bd0: 524f 5720 7c20 7778 2e4c 4546 5420 7c20  ROW | wx.LEFT | 
-00021be0: 7778 2e54 4f50 207c 2077 782e 424f 5454  wx.TOP | wx.BOTT
-00021bf0: 4f4d 290d 0a0d 0a20 2020 2020 2020 2070  OM)....        p
-00021c00: 616e 656c 3220 3d20 7778 2e50 616e 656c  anel2 = wx.Panel
-00021c10: 2870 6172 656e 743d 7370 6c69 7474 6572  (parent=splitter
-00021c20: 290d 0a20 2020 2020 2020 2073 697a 6572  )..        sizer
-00021c30: 3220 3d20 7061 6e65 6c32 2e53 697a 6572  2 = panel2.Sizer
-00021c40: 203d 2077 782e 426f 7853 697a 6572 2877   = wx.BoxSizer(w
-00021c50: 782e 5645 5254 4943 414c 290d 0a20 2020  x.VERTICAL)..   
-00021c60: 2020 2020 2073 697a 6572 5f74 6220 3d20       sizer_tb = 
-00021c70: 7778 2e42 6f78 5369 7a65 7228 7778 2e48  wx.BoxSizer(wx.H
-00021c80: 4f52 495a 4f4e 5441 4c29 0d0a 2020 2020  ORIZONTAL)..    
-00021c90: 2020 2020 7462 203d 2073 656c 662e 7462      tb = self.tb
-00021ca0: 5f67 7269 6420 3d20 7778 2e54 6f6f 6c42  _grid = wx.ToolB
-00021cb0: 6172 280d 0a20 2020 2020 2020 2020 2020  ar(..           
-00021cc0: 2070 6172 656e 743d 7061 6e65 6c32 2c20   parent=panel2, 
-00021cd0: 7374 796c 653d 7778 2e54 425f 464c 4154  style=wx.TB_FLAT
-00021ce0: 207c 2077 782e 5442 5f4e 4f44 4956 4944   | wx.TB_NODIVID
-00021cf0: 4552 290d 0a20 2020 2020 2020 2062 6d70  ER)..        bmp
-00021d00: 5f74 6220 3d20 696d 6167 6573 2e54 6f6f  _tb = images.Too
-00021d10: 6c62 6172 496e 7365 7274 2e42 6974 6d61  lbarInsert.Bitma
-00021d20: 700d 0a20 2020 2020 2020 2074 622e 5365  p..        tb.Se
-00021d30: 7454 6f6f 6c42 6974 6d61 7053 697a 6528  tToolBitmapSize(
-00021d40: 626d 705f 7462 2e53 697a 6529 0d0a 2020  bmp_tb.Size)..  
-00021d50: 2020 2020 2020 7462 2e41 6464 546f 6f6c        tb.AddTool
-00021d60: 2877 782e 4944 5f41 4444 2c20 2249 6e73  (wx.ID_ADD, "Ins
-00021d70: 6572 7420 6e65 7720 726f 772e 222c 0d0a  ert new row.",..
-00021d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021d90: 2020 2062 6974 6d61 703d 626d 705f 7462     bitmap=bmp_tb
-00021da0: 2c20 7368 6f72 7448 656c 703d 2241 6464  , shortHelp="Add
-00021db0: 206e 6577 2072 6f77 2e22 290d 0a20 2020   new row.")..   
-00021dc0: 2020 2020 2074 622e 4164 6454 6f6f 6c28       tb.AddTool(
-00021dd0: 7778 2e49 445f 4445 4c45 5445 2c20 2244  wx.ID_DELETE, "D
-00021de0: 656c 6574 6520 6375 7272 656e 7420 726f  elete current ro
-00021df0: 772e 222c 0d0a 2020 2020 2020 2020 2020  w.",..          
-00021e00: 2020 6269 746d 6170 3d69 6d61 6765 732e    bitmap=images.
-00021e10: 546f 6f6c 6261 7244 656c 6574 652e 4269  ToolbarDelete.Bi
-00021e20: 746d 6170 2c20 7368 6f72 7448 656c 703d  tmap, shortHelp=
-00021e30: 2244 656c 6574 6520 726f 772e 2229 0d0a  "Delete row.")..
-00021e40: 2020 2020 2020 2020 7462 2e41 6464 5365          tb.AddSe
-00021e50: 7061 7261 746f 7228 290d 0a20 2020 2020  parator()..     
-00021e60: 2020 2074 622e 4164 6454 6f6f 6c28 7778     tb.AddTool(wx
-00021e70: 2e49 445f 5341 5645 2c20 2243 6f6d 6d69  .ID_SAVE, "Commi
-00021e80: 7422 2c20 6269 746d 6170 3d69 6d61 6765  t", bitmap=image
-00021e90: 732e 546f 6f6c 6261 7243 6f6d 6d69 742e  s.ToolbarCommit.
-00021ea0: 4269 746d 6170 2c0d 0a20 2020 2020 2020  Bitmap,..       
-00021eb0: 2020 2020 2020 2020 2020 2020 7368 6f72              shor
-00021ec0: 7448 656c 703d 2243 6f6d 6d69 7420 6368  tHelp="Commit ch
-00021ed0: 616e 6765 7320 746f 2064 6174 6162 6173  anges to databas
-00021ee0: 652e 2229 0d0a 2020 2020 2020 2020 7462  e.")..        tb
-00021ef0: 2e41 6464 546f 6f6c 2877 782e 4944 5f55  .AddTool(wx.ID_U
-00021f00: 4e44 4f2c 2022 526f 6c6c 6261 636b 222c  NDO, "Rollback",
-00021f10: 2062 6974 6d61 703d 696d 6167 6573 2e54   bitmap=images.T
-00021f20: 6f6f 6c62 6172 526f 6c6c 6261 636b 2e42  oolbarRollback.B
-00021f30: 6974 6d61 702c 0d0a 2020 2020 2020 2020  itmap,..        
-00021f40: 2020 2020 2020 2020 2020 2073 686f 7274             short
-00021f50: 4865 6c70 3d22 526f 6c6c 6261 636b 2063  Help="Rollback c
-00021f60: 6861 6e67 6573 2061 6e64 2072 6573 746f  hanges and resto
-00021f70: 7265 206f 7269 6769 6e61 6c20 7661 6c75  re original valu
-00021f80: 6573 2e22 290d 0a20 2020 2020 2020 2074  es.")..        t
-00021f90: 622e 456e 6162 6c65 546f 6f6c 2877 782e  b.EnableTool(wx.
-00021fa0: 4944 5f41 4444 2c20 4661 6c73 6529 0d0a  ID_ADD, False)..
-00021fb0: 2020 2020 2020 2020 7462 2e45 6e61 626c          tb.Enabl
-00021fc0: 6554 6f6f 6c28 7778 2e49 445f 4445 4c45  eTool(wx.ID_DELE
-00021fd0: 5445 2c20 4661 6c73 6529 0d0a 2020 2020  TE, False)..    
-00021fe0: 2020 2020 7462 2e45 6e61 626c 6554 6f6f      tb.EnableToo
-00021ff0: 6c28 7778 2e49 445f 554e 444f 2c20 4661  l(wx.ID_UNDO, Fa
-00022000: 6c73 6529 0d0a 2020 2020 2020 2020 7462  lse)..        tb
-00022010: 2e45 6e61 626c 6554 6f6f 6c28 7778 2e49  .EnableTool(wx.I
-00022020: 445f 5341 5645 2c20 4661 6c73 6529 0d0a  D_SAVE, False)..
-00022030: 2020 2020 2020 2020 7365 6c66 2e42 696e          self.Bin
-00022040: 6428 7778 2e45 5654 5f54 4f4f 4c2c 2068  d(wx.EVT_TOOL, h
-00022050: 616e 646c 6572 3d73 656c 662e 6f6e 5f69  andler=self.on_i
-00022060: 6e73 6572 745f 726f 772c 2069 643d 7778  nsert_row, id=wx
-00022070: 2e49 445f 4144 4429 0d0a 2020 2020 2020  .ID_ADD)..      
-00022080: 2020 7365 6c66 2e42 696e 6428 7778 2e45    self.Bind(wx.E
-00022090: 5654 5f54 4f4f 4c2c 2068 616e 646c 6572  VT_TOOL, handler
-000220a0: 3d73 656c 662e 6f6e 5f64 656c 6574 655f  =self.on_delete_
-000220b0: 726f 772c 2069 643d 7778 2e49 445f 4445  row, id=wx.ID_DE
-000220c0: 4c45 5445 290d 0a20 2020 2020 2020 2073  LETE)..        s
-000220d0: 656c 662e 4269 6e64 2877 782e 4556 545f  elf.Bind(wx.EVT_
-000220e0: 544f 4f4c 2c20 6861 6e64 6c65 723d 7365  TOOL, handler=se
-000220f0: 6c66 2e6f 6e5f 636f 6d6d 6974 5f74 6162  lf.on_commit_tab
-00022100: 6c65 2c20 6964 3d77 782e 4944 5f53 4156  le, id=wx.ID_SAV
-00022110: 4529 0d0a 2020 2020 2020 2020 7365 6c66  E)..        self
-00022120: 2e42 696e 6428 7778 2e45 5654 5f54 4f4f  .Bind(wx.EVT_TOO
-00022130: 4c2c 2068 616e 646c 6572 3d73 656c 662e  L, handler=self.
-00022140: 6f6e 5f72 6f6c 6c62 6163 6b5f 7461 626c  on_rollback_tabl
-00022150: 652c 2069 643d 7778 2e49 445f 554e 444f  e, id=wx.ID_UNDO
-00022160: 290d 0a20 2020 2020 2020 2074 622e 5265  )..        tb.Re
-00022170: 616c 697a 6528 2920 2320 7368 6f75 6c64  alize() # should
-00022180: 2062 6520 6361 6c6c 6564 2061 6674 6572   be called after
-00022190: 2061 6464 696e 6720 746f 6f6c 730d 0a20   adding tools.. 
-000221a0: 2020 2020 2020 206c 6162 656c 5f74 6162         label_tab
-000221b0: 6c65 203d 2073 656c 662e 6c61 6265 6c5f  le = self.label_
-000221c0: 7461 626c 6520 3d20 7778 2e53 7461 7469  table = wx.Stati
-000221d0: 6354 6578 7428 7061 7265 6e74 3d70 616e  cText(parent=pan
-000221e0: 656c 322c 206c 6162 656c 3d22 2229 0d0a  el2, label="")..
-000221f0: 2020 2020 2020 2020 6275 7474 6f6e 5f72          button_r
-00022200: 6573 6574 203d 2073 656c 662e 6275 7474  eset = self.butt
-00022210: 6f6e 5f72 6573 6574 5f67 7269 645f 7461  on_reset_grid_ta
-00022220: 626c 6520 3d20 5c0d 0a20 2020 2020 2020  ble = \..       
-00022230: 2020 2020 2077 782e 4275 7474 6f6e 2870       wx.Button(p
-00022240: 6172 656e 743d 7061 6e65 6c32 2c20 6c61  arent=panel2, la
-00022250: 6265 6c3d 2226 5265 7365 7420 6669 6c74  bel="&Reset filt
-00022260: 6572 2f73 6f72 7422 290d 0a20 2020 2020  er/sort")..     
-00022270: 2020 2062 7574 746f 6e5f 7265 7365 742e     button_reset.
-00022280: 5365 7454 6f6f 6c54 6970 2822 5265 7365  SetToolTip("Rese
-00022290: 7473 2061 6c6c 2061 7070 6c69 6564 2073  ts all applied s
-000222a0: 6f72 7469 6e67 2022 0d0a 2020 2020 2020  orting "..      
-000222b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000222c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000222d0: 2261 6e64 2066 696c 7465 7269 6e67 2e22  "and filtering."
-000222e0: 290d 0a20 2020 2020 2020 2062 7574 746f  )..        butto
-000222f0: 6e5f 7265 7365 742e 4269 6e64 2877 782e  n_reset.Bind(wx.
-00022300: 4556 545f 4255 5454 4f4e 2c20 7365 6c66  EVT_BUTTON, self
-00022310: 2e6f 6e5f 6275 7474 6f6e 5f72 6573 6574  .on_button_reset
-00022320: 5f67 7269 6429 0d0a 2020 2020 2020 2020  _grid)..        
-00022330: 6275 7474 6f6e 5f72 6573 6574 2e45 6e61  button_reset.Ena
-00022340: 626c 6564 203d 2046 616c 7365 0d0a 2020  bled = False..  
-00022350: 2020 2020 2020 6275 7474 6f6e 5f65 7870        button_exp
-00022360: 6f72 7420 3d20 7365 6c66 2e62 7574 746f  ort = self.butto
-00022370: 6e5f 6578 706f 7274 5f74 6162 6c65 203d  n_export_table =
-00022380: 205c 0d0a 2020 2020 2020 2020 2020 2020   \..            
-00022390: 7778 2e42 7574 746f 6e28 7061 7265 6e74  wx.Button(parent
-000223a0: 3d70 616e 656c 322c 206c 6162 656c 3d22  =panel2, label="
-000223b0: 2645 7870 6f72 7420 746f 2066 696c 6522  &Export to file"
-000223c0: 290d 0a20 2020 2020 2020 2062 7574 746f  )..        butto
-000223d0: 6e5f 6578 706f 7274 2e4d 696e 5369 7a65  n_export.MinSize
-000223e0: 203d 2028 3130 302c 202d 3129 0d0a 2020   = (100, -1)..  
-000223f0: 2020 2020 2020 6275 7474 6f6e 5f65 7870        button_exp
-00022400: 6f72 742e 5365 7454 6f6f 6c54 6970 2822  ort.SetToolTip("
-00022410: 4578 706f 7274 2072 6f77 7320 746f 2061  Export rows to a
-00022420: 2066 696c 652e 2229 0d0a 2020 2020 2020   file.")..      
-00022430: 2020 6275 7474 6f6e 5f65 7870 6f72 742e    button_export.
-00022440: 4269 6e64 2877 782e 4556 545f 4255 5454  Bind(wx.EVT_BUTT
-00022450: 4f4e 2c20 7365 6c66 2e6f 6e5f 6275 7474  ON, self.on_butt
-00022460: 6f6e 5f65 7870 6f72 745f 6772 6964 290d  on_export_grid).
-00022470: 0a20 2020 2020 2020 2062 7574 746f 6e5f  .        button_
-00022480: 6578 706f 7274 2e45 6e61 626c 6564 203d  export.Enabled =
-00022490: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
-000224a0: 7369 7a65 725f 7462 2e41 6464 286c 6162  sizer_tb.Add(lab
-000224b0: 656c 5f74 6162 6c65 2c20 666c 6167 3d77  el_table, flag=w
-000224c0: 782e 414c 4947 4e5f 4345 4e54 4552 5f56  x.ALIGN_CENTER_V
-000224d0: 4552 5449 4341 4c29 0d0a 2020 2020 2020  ERTICAL)..      
-000224e0: 2020 7369 7a65 725f 7462 2e41 6464 5374    sizer_tb.AddSt
-000224f0: 7265 7463 6853 7061 6365 7228 290d 0a20  retchSpacer().. 
-00022500: 2020 2020 2020 2073 697a 6572 5f74 622e         sizer_tb.
-00022510: 4164 6428 6275 7474 6f6e 5f72 6573 6574  Add(button_reset
-00022520: 2c20 626f 7264 6572 3d35 2c20 666c 6167  , border=5, flag
-00022530: 3d77 782e 424f 5454 4f4d 207c 2077 782e  =wx.BOTTOM | wx.
-00022540: 5249 4748 5420 7c0d 0a20 2020 2020 2020  RIGHT |..       
-00022550: 2020 2020 2020 2020 2020 2020 2020 7778                wx
-00022560: 2e41 4c49 474e 5f43 454e 5445 525f 5645  .ALIGN_CENTER_VE
-00022570: 5254 4943 414c 290d 0a20 2020 2020 2020  RTICAL)..       
-00022580: 2073 697a 6572 5f74 622e 4164 6428 6275   sizer_tb.Add(bu
-00022590: 7474 6f6e 5f65 7870 6f72 742c 2062 6f72  tton_export, bor
-000225a0: 6465 723d 352c 2066 6c61 673d 7778 2e42  der=5, flag=wx.B
-000225b0: 4f54 544f 4d20 7c20 7778 2e52 4947 4854  OTTOM | wx.RIGHT
-000225c0: 207c 0d0a 2020 2020 2020 2020 2020 2020   |..            
-000225d0: 2020 2020 2020 2020 2077 782e 414c 4947           wx.ALIG
-000225e0: 4e5f 4345 4e54 4552 5f56 4552 5449 4341  N_CENTER_VERTICA
-000225f0: 4c29 0d0a 2020 2020 2020 2020 7369 7a65  L)..        size
-00022600: 725f 7462 2e41 6464 2874 6229 0d0a 2020  r_tb.Add(tb)..  
-00022610: 2020 2020 2020 6772 6964 203d 2073 656c        grid = sel
-00022620: 662e 6772 6964 5f74 6162 6c65 203d 2077  f.grid_table = w
-00022630: 782e 6772 6964 2e47 7269 6428 7061 7265  x.grid.Grid(pare
-00022640: 6e74 3d70 616e 656c 3229 0d0a 2020 2020  nt=panel2)..    
-00022650: 2020 2020 436f 6c6f 7572 4d61 6e61 6765      ColourManage
-00022660: 722e 4d61 6e61 6765 2867 7269 642c 2022  r.Manage(grid, "
-00022670: 4465 6661 756c 7443 656c 6c42 6163 6b67  DefaultCellBackg
-00022680: 726f 756e 6443 6f6c 6f75 7222 2c20 7778  roundColour", wx
-00022690: 2e53 5953 5f43 4f4c 4f55 525f 5749 4e44  .SYS_COLOUR_WIND
-000226a0: 4f57 290d 0a20 2020 2020 2020 2043 6f6c  OW)..        Col
-000226b0: 6f75 724d 616e 6167 6572 2e4d 616e 6167  ourManager.Manag
-000226c0: 6528 6772 6964 2c20 2244 6566 6175 6c74  e(grid, "Default
-000226d0: 4365 6c6c 5465 7874 436f 6c6f 7572 222c  CellTextColour",
-000226e0: 2020 2020 2020 2077 782e 5359 535f 434f         wx.SYS_CO
-000226f0: 4c4f 5552 5f57 494e 444f 5754 4558 5429  LOUR_WINDOWTEXT)
-00022700: 0d0a 2020 2020 2020 2020 436f 6c6f 7572  ..        Colour
-00022710: 4d61 6e61 6765 722e 4d61 6e61 6765 2867  Manager.Manage(g
-00022720: 7269 642c 2022 4c61 6265 6c42 6163 6b67  rid, "LabelBackg
-00022730: 726f 756e 6443 6f6c 6f75 7222 2c20 2020  roundColour",   
-00022740: 2020 2020 7778 2e53 5953 5f43 4f4c 4f55      wx.SYS_COLOU
-00022750: 525f 4254 4e46 4143 4529 0d0a 2020 2020  R_BTNFACE)..    
-00022760: 2020 2020 436f 6c6f 7572 4d61 6e61 6765      ColourManage
-00022770: 722e 4d61 6e61 6765 2867 7269 642c 2022  r.Manage(grid, "
-00022780: 4c61 6265 6c54 6578 7443 6f6c 6f75 7222  LabelTextColour"
-00022790: 2c20 2020 2020 2020 2020 2020 2020 7778  ,             wx
-000227a0: 2e53 5953 5f43 4f4c 4f55 525f 5749 4e44  .SYS_COLOUR_WIND
-000227b0: 4f57 5445 5854 290d 0a20 2020 2020 2020  OWTEXT)..       
-000227c0: 2069 6620 6861 7361 7474 7228 6772 6964   if hasattr(grid
-000227d0: 2c20 2253 6574 4465 6661 756c 7443 656c  , "SetDefaultCel
-000227e0: 6c46 6974 4d6f 6465 2229 3a0d 0a20 2020  lFitMode"):..   
-000227f0: 2020 2020 2020 2020 2067 7269 642e 5365           grid.Se
-00022800: 7444 6566 6175 6c74 4365 6c6c 4669 744d  tDefaultCellFitM
-00022810: 6f64 6528 7778 2e67 7269 642e 4772 6964  ode(wx.grid.Grid
-00022820: 4669 744d 6f64 652e 436c 6970 2829 2920  FitMode.Clip()) 
-00022830: 2023 2053 696e 6365 2077 7820 332e 312e   # Since wx 3.1.
-00022840: 340d 0a20 2020 2020 2020 2067 7269 642e  4..        grid.
-00022850: 4269 6e64 2877 782e 6772 6964 2e45 5654  Bind(wx.grid.EVT
-00022860: 5f47 5249 445f 4c41 4245 4c5f 4c45 4654  _GRID_LABEL_LEFT
-00022870: 5f44 434c 4943 4b2c 2073 656c 662e 6f6e  _DCLICK, self.on
-00022880: 5f73 6f72 745f 6772 6964 5f63 6f6c 756d  _sort_grid_colum
-00022890: 6e29 0d0a 2020 2020 2020 2020 6772 6964  n)..        grid
-000228a0: 2e47 7269 6457 696e 646f 772e 4269 6e64  .GridWindow.Bind
-000228b0: 2877 782e 4556 545f 4d4f 5449 4f4e 2c20  (wx.EVT_MOTION, 
-000228c0: 7365 6c66 2e6f 6e5f 6d6f 7573 655f 6f76  self.on_mouse_ov
-000228d0: 6572 5f67 7269 6429 0d0a 2020 2020 2020  er_grid)..      
-000228e0: 2020 6772 6964 2e42 696e 6428 7778 2e67    grid.Bind(wx.g
-000228f0: 7269 642e 4556 545f 4752 4944 5f4c 4142  rid.EVT_GRID_LAB
-00022900: 454c 5f52 4947 4854 5f43 4c49 434b 2c0d  EL_RIGHT_CLICK,.
-00022910: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022920: 2020 2073 656c 662e 6f6e 5f66 696c 7465     self.on_filte
-00022930: 725f 6772 6964 5f63 6f6c 756d 6e29 0d0a  r_grid_column)..
-00022940: 2020 2020 2020 2020 6772 6964 2e42 696e          grid.Bin
-00022950: 6428 7778 2e67 7269 642e 4556 545f 4752  d(wx.grid.EVT_GR
-00022960: 4944 5f43 454c 4c5f 4348 414e 4745 442c  ID_CELL_CHANGED,
-00022970: 2073 656c 662e 6f6e 5f63 6861 6e67 655f   self.on_change_
-00022980: 7461 626c 6529 0d0a 2020 2020 2020 2020  table)..        
-00022990: 6c61 6265 6c5f 6865 6c70 203d 2077 782e  label_help = wx.
-000229a0: 5374 6174 6963 5465 7874 2870 616e 656c  StaticText(panel
-000229b0: 322c 206c 6162 656c 3d22 446f 7562 6c65  2, label="Double
-000229c0: 2d63 6c69 636b 206f 6e20 636f 6c75 6d6e  -click on column
-000229d0: 2022 0d0a 2020 2020 2020 2020 2020 2020   "..            
-000229e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000229f0: 2020 2020 2020 2022 6865 6164 6572 2074         "header t
-00022a00: 6f20 736f 7274 2c20 7269 6768 7420 636c  o sort, right cl
-00022a10: 6963 6b20 746f 2066 696c 7465 722e 2229  ick to filter.")
-00022a20: 0d0a 2020 2020 2020 2020 436f 6c6f 7572  ..        Colour
-00022a30: 4d61 6e61 6765 722e 4d61 6e61 6765 286c  Manager.Manage(l
-00022a40: 6162 656c 5f68 656c 702c 2022 466f 7265  abel_help, "Fore
-00022a50: 6772 6f75 6e64 436f 6c6f 7572 222c 2022  groundColour", "
-00022a60: 4469 7361 626c 6564 436f 6c6f 7572 2229  DisabledColour")
-00022a70: 0d0a 2020 2020 2020 2020 7369 7a65 7232  ..        sizer2
-00022a80: 2e41 6464 2873 697a 6572 5f74 622c 2062  .Add(sizer_tb, b
-00022a90: 6f72 6465 723d 352c 2066 6c61 673d 7778  order=5, flag=wx
-00022aa0: 2e47 524f 5720 7c20 7778 2e4c 4546 5420  .GROW | wx.LEFT 
-00022ab0: 7c20 7778 2e54 4f50 290d 0a20 2020 2020  | wx.TOP)..     
-00022ac0: 2020 2073 697a 6572 322e 4164 6428 6772     sizer2.Add(gr
-00022ad0: 6964 2c20 626f 7264 6572 3d35 2c20 7072  id, border=5, pr
-00022ae0: 6f70 6f72 7469 6f6e 3d32 2c0d 0a20 2020  oportion=2,..   
-00022af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022b00: 666c 6167 3d77 782e 4752 4f57 207c 2077  flag=wx.GROW | w
-00022b10: 782e 4c45 4654 207c 2077 782e 5249 4748  x.LEFT | wx.RIGH
-00022b20: 5429 0d0a 2020 2020 2020 2020 7369 7a65  T)..        size
-00022b30: 7232 2e41 6464 286c 6162 656c 5f68 656c  r2.Add(label_hel
-00022b40: 702c 2062 6f72 6465 723d 352c 2066 6c61  p, border=5, fla
-00022b50: 673d 7778 2e4c 4546 5420 7c20 7778 2e54  g=wx.LEFT | wx.T
-00022b60: 4f50 290d 0a0d 0a20 2020 2020 2020 2073  OP)....        s
-00022b70: 697a 6572 2e41 6464 2873 706c 6974 7465  izer.Add(splitte
-00022b80: 722c 2070 726f 706f 7274 696f 6e3d 312c  r, proportion=1,
-00022b90: 2066 6c61 673d 7778 2e47 524f 5729 0d0a   flag=wx.GROW)..
-00022ba0: 2020 2020 2020 2020 7370 6c69 7474 6572          splitter
-00022bb0: 2e53 706c 6974 5665 7274 6963 616c 6c79  .SplitVertically
-00022bc0: 2870 616e 656c 312c 2070 616e 656c 322c  (panel1, panel2,
-00022bd0: 2032 3730 290d 0a0d 0a0d 0a20 2020 2064   270)......    d
-00022be0: 6566 2063 7265 6174 655f 7061 6765 5f73  ef create_page_s
-00022bf0: 716c 2873 656c 662c 206e 6f74 6562 6f6f  ql(self, noteboo
-00022c00: 6b29 3a0d 0a20 2020 2020 2020 2022 2222  k):..        """
-00022c10: 4372 6561 7465 7320 6120 7061 6765 2066  Creates a page f
-00022c20: 6f72 2065 7865 6375 7469 6e67 2061 7262  or executing arb
-00022c30: 6974 7261 7279 2053 514c 2e22 2222 0d0a  itrary SQL."""..
-00022c40: 2020 2020 2020 2020 7061 6765 203d 2073          page = s
-00022c50: 656c 662e 7061 6765 5f73 716c 203d 2077  elf.page_sql = w
-00022c60: 782e 5061 6e65 6c28 7061 7265 6e74 3d6e  x.Panel(parent=n
-00022c70: 6f74 6562 6f6f 6b29 0d0a 2020 2020 2020  otebook)..      
-00022c80: 2020 7365 6c66 2e70 6167 656f 7264 6572    self.pageorder
-00022c90: 5b70 6167 655d 203d 206c 656e 2873 656c  [page] = len(sel
-00022ca0: 662e 7061 6765 6f72 6465 7229 0d0a 2020  f.pageorder)..  
-00022cb0: 2020 2020 2020 6e6f 7465 626f 6f6b 2e41        notebook.A
-00022cc0: 6464 5061 6765 2870 6167 652c 2022 5351  ddPage(page, "SQ
-00022cd0: 4c20 7769 6e64 6f77 2229 0d0a 2020 2020  L window")..    
-00022ce0: 2020 2020 7369 7a65 7220 3d20 7061 6765      sizer = page
-00022cf0: 2e53 697a 6572 203d 2077 782e 426f 7853  .Sizer = wx.BoxS
-00022d00: 697a 6572 2877 782e 5645 5254 4943 414c  izer(wx.VERTICAL
-00022d10: 290d 0a20 2020 2020 2020 2073 706c 6974  )..        split
-00022d20: 7465 7220 3d20 7365 6c66 2e73 706c 6974  ter = self.split
-00022d30: 7465 725f 7371 6c20 3d20 5c0d 0a20 2020  ter_sql = \..   
-00022d40: 2020 2020 2020 2020 2077 782e 5370 6c69           wx.Spli
-00022d50: 7474 6572 5769 6e64 6f77 2870 6172 656e  tterWindow(paren
-00022d60: 743d 7061 6765 2c20 7374 796c 653d 7778  t=page, style=wx
-00022d70: 2e42 4f52 4445 525f 4e4f 4e45 290d 0a20  .BORDER_NONE).. 
-00022d80: 2020 2020 2020 2073 706c 6974 7465 722e         splitter.
-00022d90: 5365 744d 696e 696d 756d 5061 6e65 5369  SetMinimumPaneSi
-00022da0: 7a65 2831 3030 290d 0a0d 0a20 2020 2020  ze(100)....     
-00022db0: 2020 2070 616e 656c 3120 3d20 7365 6c66     panel1 = self
-00022dc0: 2e70 616e 656c 5f73 716c 3120 3d20 7778  .panel_sql1 = wx
-00022dd0: 2e50 616e 656c 2870 6172 656e 743d 7370  .Panel(parent=sp
-00022de0: 6c69 7474 6572 290d 0a20 2020 2020 2020  litter)..       
-00022df0: 2073 697a 6572 3120 3d20 7061 6e65 6c31   sizer1 = panel1
-00022e00: 2e53 697a 6572 203d 2077 782e 426f 7853  .Sizer = wx.BoxS
-00022e10: 697a 6572 2877 782e 5645 5254 4943 414c  izer(wx.VERTICAL
-00022e20: 290d 0a20 2020 2020 2020 206c 6162 656c  )..        label
-00022e30: 5f73 7463 203d 2077 782e 5374 6174 6963  _stc = wx.Static
-00022e40: 5465 7874 2870 6172 656e 743d 7061 6e65  Text(parent=pane
-00022e50: 6c31 2c20 6c61 6265 6c3d 2253 5126 4c3a  l1, label="SQ&L:
-00022e60: 2229 0d0a 2020 2020 2020 2020 7374 6320  ")..        stc 
-00022e70: 3d20 7365 6c66 2e73 7463 5f73 716c 203d  = self.stc_sql =
-00022e80: 2063 6f6e 7472 6f6c 732e 5351 4c69 7465   controls.SQLite
-00022e90: 5465 7874 4374 726c 2870 6172 656e 743d  TextCtrl(parent=
-00022ea0: 7061 6e65 6c31 2c0d 0a20 2020 2020 2020  panel1,..       
-00022eb0: 2020 2020 2073 7479 6c65 3d77 782e 424f       style=wx.BO
-00022ec0: 5244 4552 5f53 5441 5449 4320 7c20 7778  RDER_STATIC | wx
-00022ed0: 2e54 455f 5052 4f43 4553 535f 5441 4220  .TE_PROCESS_TAB 
-00022ee0: 7c20 7778 2e54 455f 5052 4f43 4553 535f  | wx.TE_PROCESS_
-00022ef0: 454e 5445 5229 0d0a 2020 2020 2020 2020  ENTER)..        
-00022f00: 7374 632e 4269 6e64 2877 782e 4556 545f  stc.Bind(wx.EVT_
-00022f10: 4b45 595f 444f 574e 2c20 7365 6c66 2e6f  KEY_DOWN, self.o
-00022f20: 6e5f 6b65 7964 6f77 6e5f 7371 6c29 0d0a  n_keydown_sql)..
-00022f30: 2020 2020 2020 2020 7374 632e 5365 7454          stc.SetT
-00022f40: 6578 7428 636f 6e66 2e53 514c 5769 6e64  ext(conf.SQLWind
-00022f50: 6f77 5465 7874 732e 6765 7428 7365 6c66  owTexts.get(self
-00022f60: 2e64 622e 6669 6c65 6e61 6d65 2c20 2222  .db.filename, ""
-00022f70: 2929 0d0a 2020 2020 2020 2020 7374 632e  ))..        stc.
-00022f80: 456d 7074 7955 6e64 6f42 7566 6665 7228  EmptyUndoBuffer(
-00022f90: 2920 2320 536f 2074 6861 7420 756e 646f  ) # So that undo
-00022fa0: 2064 6f65 7320 6e6f 7420 636c 6561 7220   does not clear 
-00022fb0: 7468 6520 5354 430d 0a20 2020 2020 2020  the STC..       
-00022fc0: 2073 697a 6572 312e 4164 6428 6c61 6265   sizer1.Add(labe
-00022fd0: 6c5f 7374 632c 2062 6f72 6465 723d 352c  l_stc, border=5,
-00022fe0: 2066 6c61 673d 7778 2e41 4c4c 290d 0a20   flag=wx.ALL).. 
-00022ff0: 2020 2020 2020 2073 697a 6572 312e 4164         sizer1.Ad
-00023000: 6428 7374 632c 2062 6f72 6465 723d 352c  d(stc, border=5,
-00023010: 2070 726f 706f 7274 696f 6e3d 312c 2066   proportion=1, f
-00023020: 6c61 673d 7778 2e47 524f 5720 7c20 7778  lag=wx.GROW | wx
-00023030: 2e4c 4546 5429 0d0a 0d0a 2020 2020 2020  .LEFT)....      
-00023040: 2020 7061 6e65 6c32 203d 2073 656c 662e    panel2 = self.
-00023050: 7061 6e65 6c5f 7371 6c32 203d 2077 782e  panel_sql2 = wx.
-00023060: 5061 6e65 6c28 7061 7265 6e74 3d73 706c  Panel(parent=spl
-00023070: 6974 7465 7229 0d0a 2020 2020 2020 2020  itter)..        
-00023080: 7369 7a65 7232 203d 2070 616e 656c 322e  sizer2 = panel2.
-00023090: 5369 7a65 7220 3d20 7778 2e42 6f78 5369  Sizer = wx.BoxSi
-000230a0: 7a65 7228 7778 2e56 4552 5449 4341 4c29  zer(wx.VERTICAL)
-000230b0: 0d0a 2020 2020 2020 2020 6c61 6265 6c5f  ..        label_
-000230c0: 6865 6c70 203d 2077 782e 5374 6174 6963  help = wx.Static
-000230d0: 5465 7874 2870 616e 656c 322c 206c 6162  Text(panel2, lab
-000230e0: 656c 3d0d 0a20 2020 2020 2020 2020 2020  el=..           
-000230f0: 2022 416c 742d 456e 7465 7220 7275 6e73   "Alt-Enter runs
-00023100: 2074 6865 2071 7565 7279 2063 6f6e 7461   the query conta
-00023110: 696e 6564 2069 6e20 6375 7272 656e 746c  ined in currentl
-00023120: 7920 7365 6c65 6374 6564 2074 6578 7420  y selected text 
-00023130: 6f72 2022 0d0a 2020 2020 2020 2020 2020  or "..          
-00023140: 2020 226f 6e20 7468 6520 6375 7272 656e    "on the curren
-00023150: 7420 6c69 6e65 2e20 4374 726c 2d53 7061  t line. Ctrl-Spa
-00023160: 6365 2073 686f 7773 2061 7574 6f63 6f6d  ce shows autocom
-00023170: 706c 6574 696f 6e20 6c69 7374 2e22 290d  pletion list.").
-00023180: 0a20 2020 2020 2020 2043 6f6c 6f75 724d  .        ColourM
-00023190: 616e 6167 6572 2e4d 616e 6167 6528 6c61  anager.Manage(la
-000231a0: 6265 6c5f 6865 6c70 2c20 2246 6f72 6567  bel_help, "Foreg
-000231b0: 726f 756e 6443 6f6c 6f75 7222 2c20 2244  roundColour", "D
-000231c0: 6973 6162 6c65 6443 6f6c 6f75 7222 290d  isabledColour").
-000231d0: 0a20 2020 2020 2020 2073 697a 6572 5f62  .        sizer_b
-000231e0: 7574 746f 6e73 203d 2077 782e 426f 7853  uttons = wx.BoxS
-000231f0: 697a 6572 2877 782e 484f 5249 5a4f 4e54  izer(wx.HORIZONT
-00023200: 414c 290d 0a20 2020 2020 2020 2062 7574  AL)..        but
-00023210: 746f 6e5f 7371 6c20 3d20 7365 6c66 2e62  ton_sql = self.b
-00023220: 7574 746f 6e5f 7371 6c20 3d20 7778 2e42  utton_sql = wx.B
-00023230: 7574 746f 6e28 7061 6e65 6c32 2c20 6c61  utton(panel2, la
-00023240: 6265 6c3d 2245 7865 6375 7465 2053 2651  bel="Execute S&Q
-00023250: 4c22 290d 0a20 2020 2020 2020 2062 7574  L")..        but
-00023260: 746f 6e5f 7363 7269 7074 203d 2073 656c  ton_script = sel
-00023270: 662e 6275 7474 6f6e 5f73 6372 6970 7420  f.button_script 
-00023280: 3d20 7778 2e42 7574 746f 6e28 7061 6e65  = wx.Button(pane
-00023290: 6c32 2c0d 0a20 2020 2020 2020 2020 2020  l2,..           
-000232a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000232b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000232c0: 2020 2020 2020 2020 2020 2020 6c61 6265              labe
-000232d0: 6c3d 2245 7865 6375 7465 2073 6372 6970  l="Execute scrip
-000232e0: 2674 2229 0d0a 2020 2020 2020 2020 6275  &t")..        bu
-000232f0: 7474 6f6e 5f73 716c 2e53 6574 546f 6f6c  tton_sql.SetTool
-00023300: 5469 7028 2245 7865 6375 7465 2061 2073  Tip("Execute a s
-00023310: 696e 676c 6520 7374 6174 656d 656e 7420  ingle statement 
-00023320: 220d 0a20 2020 2020 2020 2020 2020 2020  "..             
-00023330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023340: 2020 2020 2020 2022 6672 6f6d 2074 6865         "from the
-00023350: 2053 514c 2077 696e 646f 7722 290d 0a20   SQL window").. 
-00023360: 2020 2020 2020 2062 7574 746f 6e5f 7363         button_sc
-00023370: 7269 7074 2e53 6574 546f 6f6c 5469 7028  ript.SetToolTip(
-00023380: 2245 7865 6375 7465 206d 756c 7469 706c  "Execute multipl
-00023390: 6520 5351 4c20 7374 6174 656d 656e 7473  e SQL statements
-000233a0: 2c20 220d 0a20 2020 2020 2020 2020 2020  , "..           
-000233b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000233c0: 2020 2020 2020 2020 2020 2020 2273 6570              "sep
-000233d0: 6172 6174 6564 2062 7920 7365 6d69 636f  arated by semico
-000233e0: 6c6f 6e73 2229 0d0a 2020 2020 2020 2020  lons")..        
-000233f0: 7365 6c66 2e42 696e 6428 7778 2e45 5654  self.Bind(wx.EVT
-00023400: 5f42 5554 544f 4e2c 2073 656c 662e 6f6e  _BUTTON, self.on
-00023410: 5f62 7574 746f 6e5f 7371 6c2c 2062 7574  _button_sql, but
-00023420: 746f 6e5f 7371 6c29 0d0a 2020 2020 2020  ton_sql)..      
-00023430: 2020 7365 6c66 2e42 696e 6428 7778 2e45    self.Bind(wx.E
-00023440: 5654 5f42 5554 544f 4e2c 2073 656c 662e  VT_BUTTON, self.
-00023450: 6f6e 5f62 7574 746f 6e5f 7363 7269 7074  on_button_script
-00023460: 2c20 6275 7474 6f6e 5f73 6372 6970 7429  , button_script)
-00023470: 0d0a 2020 2020 2020 2020 6275 7474 6f6e  ..        button
-00023480: 5f72 6573 6574 203d 2073 656c 662e 6275  _reset = self.bu
-00023490: 7474 6f6e 5f72 6573 6574 5f67 7269 645f  tton_reset_grid_
-000234a0: 7371 6c20 3d20 5c0d 0a20 2020 2020 2020  sql = \..       
-000234b0: 2020 2020 2077 782e 4275 7474 6f6e 2870       wx.Button(p
-000234c0: 6172 656e 743d 7061 6e65 6c32 2c20 6c61  arent=panel2, la
-000234d0: 6265 6c3d 2226 5265 7365 7420 6669 6c74  bel="&Reset filt
-000234e0: 6572 2f73 6f72 7422 290d 0a20 2020 2020  er/sort")..     
-000234f0: 2020 2062 7574 746f 6e5f 7265 7365 742e     button_reset.
-00023500: 5365 7454 6f6f 6c54 6970 2822 5265 7365  SetToolTip("Rese
-00023510: 7473 2061 6c6c 2061 7070 6c69 6564 2073  ts all applied s
-00023520: 6f72 7469 6e67 2022 0d0a 2020 2020 2020  orting "..      
-00023530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023550: 2261 6e64 2066 696c 7465 7269 6e67 2e22  "and filtering."
-00023560: 290d 0a20 2020 2020 2020 2062 7574 746f  )..        butto
-00023570: 6e5f 7265 7365 742e 4269 6e64 2877 782e  n_reset.Bind(wx.
-00023580: 4556 545f 4255 5454 4f4e 2c20 7365 6c66  EVT_BUTTON, self
-00023590: 2e6f 6e5f 6275 7474 6f6e 5f72 6573 6574  .on_button_reset
-000235a0: 5f67 7269 6429 0d0a 2020 2020 2020 2020  _grid)..        
-000235b0: 6275 7474 6f6e 5f72 6573 6574 2e45 6e61  button_reset.Ena
-000235c0: 626c 6564 203d 2046 616c 7365 0d0a 2020  bled = False..  
-000235d0: 2020 2020 2020 6275 7474 6f6e 5f65 7870        button_exp
-000235e0: 6f72 7420 3d20 7365 6c66 2e62 7574 746f  ort = self.butto
-000235f0: 6e5f 6578 706f 7274 5f73 716c 203d 205c  n_export_sql = \
-00023600: 0d0a 2020 2020 2020 2020 2020 2020 7778  ..            wx
-00023610: 2e42 7574 746f 6e28 7061 7265 6e74 3d70  .Button(parent=p
-00023620: 616e 656c 322c 206c 6162 656c 3d22 2645  anel2, label="&E
-00023630: 7870 6f72 7420 746f 2066 696c 6522 290d  xport to file").
-00023640: 0a20 2020 2020 2020 2062 7574 746f 6e5f  .        button_
-00023650: 6578 706f 7274 2e53 6574 546f 6f6c 5469  export.SetToolTi
-00023660: 7028 2245 7870 6f72 7420 7265 7375 6c74  p("Export result
-00023670: 2074 6f20 6120 6669 6c65 2e22 290d 0a20   to a file.").. 
-00023680: 2020 2020 2020 2062 7574 746f 6e5f 6578         button_ex
-00023690: 706f 7274 2e42 696e 6428 7778 2e45 5654  port.Bind(wx.EVT
-000236a0: 5f42 5554 544f 4e2c 2073 656c 662e 6f6e  _BUTTON, self.on
-000236b0: 5f62 7574 746f 6e5f 6578 706f 7274 5f67  _button_export_g
-000236c0: 7269 6429 0d0a 2020 2020 2020 2020 6275  rid)..        bu
-000236d0: 7474 6f6e 5f65 7870 6f72 742e 456e 6162  tton_export.Enab
-000236e0: 6c65 6420 3d20 4661 6c73 650d 0a20 2020  led = False..   
-000236f0: 2020 2020 2073 697a 6572 5f62 7574 746f       sizer_butto
-00023700: 6e73 2e41 6464 2862 7574 746f 6e5f 7371  ns.Add(button_sq
-00023710: 6c2c 2066 6c61 673d 7778 2e41 4c49 474e  l, flag=wx.ALIGN
-00023720: 5f4c 4546 5429 0d0a 2020 2020 2020 2020  _LEFT)..        
-00023730: 7369 7a65 725f 6275 7474 6f6e 732e 4164  sizer_buttons.Ad
-00023740: 6428 6275 7474 6f6e 5f73 6372 6970 742c  d(button_script,
-00023750: 2062 6f72 6465 723d 352c 2066 6c61 673d   border=5, flag=
-00023760: 7778 2e4c 4546 5420 7c20 7778 2e41 4c49  wx.LEFT | wx.ALI
-00023770: 474e 5f4c 4546 5429 0d0a 2020 2020 2020  GN_LEFT)..      
-00023780: 2020 7369 7a65 725f 6275 7474 6f6e 732e    sizer_buttons.
-00023790: 4164 6453 7472 6574 6368 5370 6163 6572  AddStretchSpacer
-000237a0: 2829 0d0a 2020 2020 2020 2020 7369 7a65  ()..        size
-000237b0: 725f 6275 7474 6f6e 732e 4164 6428 6275  r_buttons.Add(bu
-000237c0: 7474 6f6e 5f72 6573 6574 2c20 626f 7264  tton_reset, bord
-000237d0: 6572 3d35 2c20 666c 6167 3d77 782e 5249  er=5, flag=wx.RI
-000237e0: 4748 5429 0d0a 2020 2020 2020 2020 7369  GHT)..        si
-000237f0: 7a65 725f 6275 7474 6f6e 732e 4164 6428  zer_buttons.Add(
-00023800: 6275 7474 6f6e 5f65 7870 6f72 7429 0d0a  button_export)..
-00023810: 2020 2020 2020 2020 6772 6964 203d 2073          grid = s
-00023820: 656c 662e 6772 6964 5f73 716c 203d 2077  elf.grid_sql = w
-00023830: 782e 6772 6964 2e47 7269 6428 7061 7265  x.grid.Grid(pare
-00023840: 6e74 3d70 616e 656c 3229 0d0a 2020 2020  nt=panel2)..    
-00023850: 2020 2020 436f 6c6f 7572 4d61 6e61 6765      ColourManage
-00023860: 722e 4d61 6e61 6765 2867 7269 642c 2022  r.Manage(grid, "
-00023870: 4465 6661 756c 7443 656c 6c42 6163 6b67  DefaultCellBackg
-00023880: 726f 756e 6443 6f6c 6f75 7222 2c20 7778  roundColour", wx
-00023890: 2e53 5953 5f43 4f4c 4f55 525f 5749 4e44  .SYS_COLOUR_WIND
-000238a0: 4f57 290d 0a20 2020 2020 2020 2043 6f6c  OW)..        Col
-000238b0: 6f75 724d 616e 6167 6572 2e4d 616e 6167  ourManager.Manag
-000238c0: 6528 6772 6964 2c20 2244 6566 6175 6c74  e(grid, "Default
-000238d0: 4365 6c6c 5465 7874 436f 6c6f 7572 222c  CellTextColour",
-000238e0: 2020 2020 2020 2077 782e 5359 535f 434f         wx.SYS_CO
-000238f0: 4c4f 5552 5f57 494e 444f 5754 4558 5429  LOUR_WINDOWTEXT)
-00023900: 0d0a 2020 2020 2020 2020 436f 6c6f 7572  ..        Colour
-00023910: 4d61 6e61 6765 722e 4d61 6e61 6765 2867  Manager.Manage(g
-00023920: 7269 642c 2022 4c61 6265 6c42 6163 6b67  rid, "LabelBackg
-00023930: 726f 756e 6443 6f6c 6f75 7222 2c20 2020  roundColour",   
-00023940: 2020 2020 7778 2e53 5953 5f43 4f4c 4f55      wx.SYS_COLOU
-00023950: 525f 4254 4e46 4143 4529 0d0a 2020 2020  R_BTNFACE)..    
-00023960: 2020 2020 436f 6c6f 7572 4d61 6e61 6765      ColourManage
-00023970: 722e 4d61 6e61 6765 2867 7269 642c 2022  r.Manage(grid, "
-00023980: 4c61 6265 6c54 6578 7443 6f6c 6f75 7222  LabelTextColour"
-00023990: 2c20 2020 2020 2020 2020 2020 2020 7778  ,             wx
-000239a0: 2e53 5953 5f43 4f4c 4f55 525f 5749 4e44  .SYS_COLOUR_WIND
-000239b0: 4f57 5445 5854 290d 0a20 2020 2020 2020  OWTEXT)..       
-000239c0: 2069 6620 6861 7361 7474 7228 6772 6964   if hasattr(grid
-000239d0: 2c20 2253 6574 4465 6661 756c 7443 656c  , "SetDefaultCel
-000239e0: 6c46 6974 4d6f 6465 2229 3a0d 0a20 2020  lFitMode"):..   
-000239f0: 2020 2020 2020 2020 2067 7269 642e 5365           grid.Se
-00023a00: 7444 6566 6175 6c74 4365 6c6c 4669 744d  tDefaultCellFitM
-00023a10: 6f64 6528 7778 2e67 7269 642e 4772 6964  ode(wx.grid.Grid
-00023a20: 4669 744d 6f64 652e 436c 6970 2829 2920  FitMode.Clip()) 
-00023a30: 2023 2053 696e 6365 2077 7820 332e 312e   # Since wx 3.1.
-00023a40: 340d 0a20 2020 2020 2020 2067 7269 642e  4..        grid.
-00023a50: 4269 6e64 2877 782e 6772 6964 2e45 5654  Bind(wx.grid.EVT
-00023a60: 5f47 5249 445f 4c41 4245 4c5f 4c45 4654  _GRID_LABEL_LEFT
-00023a70: 5f44 434c 4943 4b2c 0d0a 2020 2020 2020  _DCLICK,..      
-00023a80: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00023a90: 2e6f 6e5f 736f 7274 5f67 7269 645f 636f  .on_sort_grid_co
-00023aa0: 6c75 6d6e 290d 0a20 2020 2020 2020 2067  lumn)..        g
-00023ab0: 7269 642e 4269 6e64 2877 782e 6772 6964  rid.Bind(wx.grid
-00023ac0: 2e45 5654 5f47 5249 445f 4c41 4245 4c5f  .EVT_GRID_LABEL_
-00023ad0: 5249 4748 545f 434c 4943 4b2c 0d0a 2020  RIGHT_CLICK,..  
-00023ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023af0: 7365 6c66 2e6f 6e5f 6669 6c74 6572 5f67  self.on_filter_g
-00023b00: 7269 645f 636f 6c75 6d6e 290d 0a20 2020  rid_column)..   
-00023b10: 2020 2020 2067 7269 642e 4269 6e64 2877       grid.Bind(w
-00023b20: 782e 4556 545f 5343 524f 4c4c 5749 4e2c  x.EVT_SCROLLWIN,
-00023b30: 2073 656c 662e 6f6e 5f73 6372 6f6c 6c5f   self.on_scroll_
-00023b40: 6772 6964 5f73 716c 290d 0a20 2020 2020  grid_sql)..     
-00023b50: 2020 2067 7269 642e 4269 6e64 2877 782e     grid.Bind(wx.
-00023b60: 4556 545f 5343 524f 4c4c 5f54 4855 4d42  EVT_SCROLL_THUMB
-00023b70: 5245 4c45 4153 452c 2073 656c 662e 6f6e  RELEASE, self.on
-00023b80: 5f73 6372 6f6c 6c5f 6772 6964 5f73 716c  _scroll_grid_sql
-00023b90: 290d 0a20 2020 2020 2020 2067 7269 642e  )..        grid.
-00023ba0: 4269 6e64 2877 782e 4556 545f 5343 524f  Bind(wx.EVT_SCRO
-00023bb0: 4c4c 5f43 4841 4e47 4544 2c20 7365 6c66  LL_CHANGED, self
-00023bc0: 2e6f 6e5f 7363 726f 6c6c 5f67 7269 645f  .on_scroll_grid_
-00023bd0: 7371 6c29 0d0a 2020 2020 2020 2020 6772  sql)..        gr
-00023be0: 6964 2e42 696e 6428 7778 2e45 5654 5f4b  id.Bind(wx.EVT_K
-00023bf0: 4559 5f44 4f57 4e2c 2073 656c 662e 6f6e  EY_DOWN, self.on
-00023c00: 5f73 6372 6f6c 6c5f 6772 6964 5f73 716c  _scroll_grid_sql
-00023c10: 290d 0a20 2020 2020 2020 2067 7269 642e  )..        grid.
-00023c20: 4772 6964 5769 6e64 6f77 2e42 696e 6428  GridWindow.Bind(
-00023c30: 7778 2e45 5654 5f4d 4f54 494f 4e2c 2073  wx.EVT_MOTION, s
-00023c40: 656c 662e 6f6e 5f6d 6f75 7365 5f6f 7665  elf.on_mouse_ove
-00023c50: 725f 6772 6964 290d 0a20 2020 2020 2020  r_grid)..       
-00023c60: 206c 6162 656c 5f68 656c 705f 6772 6964   label_help_grid
-00023c70: 203d 2077 782e 5374 6174 6963 5465 7874   = wx.StaticText
-00023c80: 2870 616e 656c 322c 206c 6162 656c 3d22  (panel2, label="
-00023c90: 446f 7562 6c65 2d63 6c69 636b 206f 6e20  Double-click on 
-00023ca0: 636f 6c75 6d6e 2022 0d0a 2020 2020 2020  column "..      
-00023cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023cd0: 2020 2268 6561 6465 7220 746f 2073 6f72    "header to sor
-00023ce0: 742c 2072 6967 6874 2063 6c69 636b 2074  t, right click t
-00023cf0: 6f20 6669 6c74 6572 2e22 290d 0a20 2020  o filter.")..   
-00023d00: 2020 2020 2043 6f6c 6f75 724d 616e 6167       ColourManag
-00023d10: 6572 2e4d 616e 6167 6528 6c61 6265 6c5f  er.Manage(label_
-00023d20: 6865 6c70 5f67 7269 642c 2022 466f 7265  help_grid, "Fore
-00023d30: 6772 6f75 6e64 436f 6c6f 7572 222c 2022  groundColour", "
-00023d40: 4469 7361 626c 6564 436f 6c6f 7572 2229  DisabledColour")
-00023d50: 0d0a 0d0a 2020 2020 2020 2020 7369 7a65  ....        size
-00023d60: 7232 2e41 6464 286c 6162 656c 5f68 656c  r2.Add(label_hel
-00023d70: 702c 2062 6f72 6465 723d 352c 2066 6c61  p, border=5, fla
-00023d80: 673d 7778 2e47 524f 5720 7c20 7778 2e4c  g=wx.GROW | wx.L
-00023d90: 4546 5420 7c20 7778 2e42 4f54 544f 4d29  EFT | wx.BOTTOM)
-00023da0: 0d0a 2020 2020 2020 2020 7369 7a65 7232  ..        sizer2
-00023db0: 2e41 6464 2873 697a 6572 5f62 7574 746f  .Add(sizer_butto
-00023dc0: 6e73 2c20 626f 7264 6572 3d35 2c20 666c  ns, border=5, fl
-00023dd0: 6167 3d77 782e 4752 4f57 207c 2077 782e  ag=wx.GROW | wx.
-00023de0: 414c 4c29 0d0a 2020 2020 2020 2020 7369  ALL)..        si
-00023df0: 7a65 7232 2e41 6464 2867 7269 642c 2062  zer2.Add(grid, b
-00023e00: 6f72 6465 723d 352c 2070 726f 706f 7274  order=5, proport
-00023e10: 696f 6e3d 322c 0d0a 2020 2020 2020 2020  ion=2,..        
-00023e20: 2020 2020 2020 2020 2020 2066 6c61 673d             flag=
-00023e30: 7778 2e47 524f 5720 7c20 7778 2e4c 4546  wx.GROW | wx.LEF
-00023e40: 5420 7c20 7778 2e52 4947 4854 290d 0a20  T | wx.RIGHT).. 
-00023e50: 2020 2020 2020 2073 697a 6572 322e 4164         sizer2.Ad
-00023e60: 6428 6c61 6265 6c5f 6865 6c70 5f67 7269  d(label_help_gri
-00023e70: 642c 2062 6f72 6465 723d 352c 2066 6c61  d, border=5, fla
-00023e80: 673d 7778 2e47 524f 5720 7c20 7778 2e4c  g=wx.GROW | wx.L
-00023e90: 4546 5420 7c20 7778 2e54 4f50 290d 0a0d  EFT | wx.TOP)...
-00023ea0: 0a20 2020 2020 2020 2073 697a 6572 2e41  .        sizer.A
-00023eb0: 6464 2873 706c 6974 7465 722c 2070 726f  dd(splitter, pro
-00023ec0: 706f 7274 696f 6e3d 312c 2066 6c61 673d  portion=1, flag=
-00023ed0: 7778 2e47 524f 5729 0d0a 2020 2020 2020  wx.GROW)..      
-00023ee0: 2020 7361 7368 5f70 6f73 203d 2073 656c    sash_pos = sel
-00023ef0: 662e 5369 7a65 5b31 5d20 2f2f 2033 0d0a  f.Size[1] // 3..
-00023f00: 2020 2020 2020 2020 7370 6c69 7474 6572          splitter
-00023f10: 2e53 706c 6974 486f 7269 7a6f 6e74 616c  .SplitHorizontal
-00023f20: 6c79 2870 616e 656c 312c 2070 616e 656c  ly(panel1, panel
-00023f30: 322c 2073 6173 6850 6f73 6974 696f 6e3d  2, sashPosition=
-00023f40: 7361 7368 5f70 6f73 290d 0a0d 0a0d 0a20  sash_pos)...... 
-00023f50: 2020 2064 6566 2063 7265 6174 655f 7061     def create_pa
-00023f60: 6765 5f69 6e66 6f28 7365 6c66 2c20 6e6f  ge_info(self, no
-00023f70: 7465 626f 6f6b 293a 0d0a 2020 2020 2020  tebook):..      
-00023f80: 2020 2222 2243 7265 6174 6573 2061 2070    """Creates a p
-00023f90: 6167 6520 666f 7220 7365 6569 6e67 2067  age for seeing g
-00023fa0: 656e 6572 616c 2064 6174 6162 6173 6520  eneral database 
-00023fb0: 696e 666f 726d 6174 696f 6e2e 2222 220d  information.""".
-00023fc0: 0a20 2020 2020 2020 2070 6167 6520 3d20  .        page = 
-00023fd0: 7365 6c66 2e70 6167 655f 696e 666f 203d  self.page_info =
-00023fe0: 2077 782e 6c69 622e 7363 726f 6c6c 6564   wx.lib.scrolled
-00023ff0: 7061 6e65 6c2e 5363 726f 6c6c 6564 5061  panel.ScrolledPa
-00024000: 6e65 6c28 6e6f 7465 626f 6f6b 290d 0a20  nel(notebook).. 
-00024010: 2020 2020 2020 2073 656c 662e 7061 6765         self.page
-00024020: 6f72 6465 725b 7061 6765 5d20 3d20 6c65  order[page] = le
-00024030: 6e28 7365 6c66 2e70 6167 656f 7264 6572  n(self.pageorder
-00024040: 290d 0a20 2020 2020 2020 206e 6f74 6562  )..        noteb
-00024050: 6f6f 6b2e 4164 6450 6167 6528 7061 6765  ook.AddPage(page
-00024060: 2c20 2249 6e66 6f72 6d61 7469 6f6e 2229  , "Information")
-00024070: 0d0a 2020 2020 2020 2020 7369 7a65 7220  ..        sizer 
-00024080: 3d20 7061 6765 2e53 697a 6572 203d 2077  = page.Sizer = w
-00024090: 782e 426f 7853 697a 6572 2877 782e 484f  x.BoxSizer(wx.HO
-000240a0: 5249 5a4f 4e54 414c 290d 0a0d 0a20 2020  RIZONTAL)....   
-000240b0: 2020 2020 2070 616e 656c 3120 3d20 7365       panel1 = se
-000240c0: 6c66 2e70 616e 656c 5f61 6363 6f75 6e74  lf.panel_account
-000240d0: 696e 666f 203d 2077 782e 5061 6e65 6c28  info = wx.Panel(
-000240e0: 7061 7265 6e74 3d70 6167 6529 0d0a 2020  parent=page)..  
-000240f0: 2020 2020 2020 7061 6e65 6c32 203d 2077        panel2 = w
-00024100: 782e 5061 6e65 6c28 7061 7265 6e74 3d70  x.Panel(parent=p
-00024110: 6167 6529 0d0a 2020 2020 2020 2020 436f  age)..        Co
-00024120: 6c6f 7572 4d61 6e61 6765 722e 4d61 6e61  lourManager.Mana
-00024130: 6765 2870 616e 656c 312c 2022 4261 636b  ge(panel1, "Back
-00024140: 6772 6f75 6e64 436f 6c6f 7572 222c 2022  groundColour", "
-00024150: 4267 436f 6c6f 7572 2229 0d0a 2020 2020  BgColour")..    
-00024160: 2020 2020 436f 6c6f 7572 4d61 6e61 6765      ColourManage
-00024170: 722e 4d61 6e61 6765 2870 616e 656c 322c  r.Manage(panel2,
-00024180: 2022 4261 636b 6772 6f75 6e64 436f 6c6f   "BackgroundColo
-00024190: 7572 222c 2022 4267 436f 6c6f 7572 2229  ur", "BgColour")
-000241a0: 0d0a 2020 2020 2020 2020 7369 7a65 7231  ..        sizer1
-000241b0: 203d 2070 616e 656c 312e 5369 7a65 7220   = panel1.Sizer 
-000241c0: 3d20 7778 2e42 6f78 5369 7a65 7228 7778  = wx.BoxSizer(wx
-000241d0: 2e56 4552 5449 4341 4c29 0d0a 2020 2020  .VERTICAL)..    
-000241e0: 2020 2020 7369 7a65 725f 6163 636f 756e      sizer_accoun
-000241f0: 7420 3d20 7778 2e42 6f78 5369 7a65 7228  t = wx.BoxSizer(
-00024200: 7778 2e48 4f52 495a 4f4e 5441 4c29 0d0a  wx.HORIZONTAL)..
-00024210: 2020 2020 2020 2020 6c61 6265 6c5f 6163          label_ac
-00024220: 636f 756e 7420 3d20 7778 2e53 7461 7469  count = wx.Stati
-00024230: 6354 6578 7428 7061 7265 6e74 3d70 616e  cText(parent=pan
-00024240: 656c 312c 0d0a 2020 2020 2020 2020 2020  el1,..          
-00024250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024260: 2020 2020 2020 2020 2020 2020 6c61 6265              labe
-00024270: 6c3d 224d 6169 6e20 6163 636f 756e 7420  l="Main account 
-00024280: 696e 666f 726d 6174 696f 6e22 290d 0a20  information").. 
-00024290: 2020 2020 2020 206c 6162 656c 5f61 6363         label_acc
-000242a0: 6f75 6e74 2e46 6f6e 7420 3d20 7778 2e46  ount.Font = wx.F
-000242b0: 6f6e 7428 3130 2c20 7778 2e46 4f4e 5446  ont(10, wx.FONTF
-000242c0: 414d 494c 595f 5357 4953 532c 0d0a 2020  AMILY_SWISS,..  
-000242d0: 2020 2020 2020 2020 2020 7778 2e46 4f4e            wx.FON
-000242e0: 5453 5459 4c45 5f4e 4f52 4d41 4c2c 2077  TSTYLE_NORMAL, w
-000242f0: 782e 464f 4e54 5745 4947 4854 5f42 4f4c  x.FONTWEIGHT_BOL
-00024300: 442c 2066 6163 654e 616d 653d 7365 6c66  D, faceName=self
-00024310: 2e46 6f6e 742e 4661 6365 4e61 6d65 290d  .Font.FaceName).
-00024320: 0a20 2020 2020 2020 2073 697a 6572 312e  .        sizer1.
-00024330: 4164 6428 6c61 6265 6c5f 6163 636f 756e  Add(label_accoun
-00024340: 742c 2062 6f72 6465 723d 352c 2066 6c61  t, border=5, fla
-00024350: 673d 7778 2e41 4c4c 290d 0a0d 0a20 2020  g=wx.ALL)....   
-00024360: 2020 2020 2062 6d70 5f70 616e 656c 203d       bmp_panel =
-00024370: 2077 782e 5061 6e65 6c28 7061 7265 6e74   wx.Panel(parent
-00024380: 3d70 616e 656c 3129 0d0a 2020 2020 2020  =panel1)..      
-00024390: 2020 626d 705f 7061 6e65 6c2e 5369 7a65    bmp_panel.Size
-000243a0: 7220 3d20 7778 2e42 6f78 5369 7a65 7228  r = wx.BoxSizer(
-000243b0: 7778 2e56 4552 5449 4341 4c29 0d0a 2020  wx.VERTICAL)..  
-000243c0: 2020 2020 2020 626d 7020 3d20 696d 6167        bmp = imag
-000243d0: 6573 2e41 7661 7461 7244 6566 6175 6c74  es.AvatarDefault
-000243e0: 4c61 7267 652e 4269 746d 6170 0d0a 2020  Large.Bitmap..  
-000243f0: 2020 2020 2020 626d 705f 7374 6174 6963        bmp_static
-00024400: 203d 2073 656c 662e 626d 705f 6163 636f   = self.bmp_acco
-00024410: 756e 7420 3d20 7778 2e53 7461 7469 6342  unt = wx.StaticB
-00024420: 6974 6d61 7028 626d 705f 7061 6e65 6c2c  itmap(bmp_panel,
-00024430: 2062 6974 6d61 703d 626d 7029 0d0a 2020   bitmap=bmp)..  
-00024440: 2020 2020 2020 7369 7a65 725f 6163 636f        sizer_acco
-00024450: 756e 7469 6e66 6f20 3d20 7778 2e46 6c65  untinfo = wx.Fle
-00024460: 7847 7269 6453 697a 6572 2863 6f6c 733d  xGridSizer(cols=
-00024470: 322c 2076 6761 703d 332c 2068 6761 703d  2, vgap=3, hgap=
-00024480: 3130 290d 0a20 2020 2020 2020 2073 656c  10)..        sel
-00024490: 662e 7369 7a65 725f 6163 636f 756e 7469  f.sizer_accounti
-000244a0: 6e66 6f20 3d20 7369 7a65 725f 6163 636f  nfo = sizer_acco
-000244b0: 756e 7469 6e66 6f0d 0a20 2020 2020 2020  untinfo..       
-000244c0: 2073 697a 6572 5f61 6363 6f75 6e74 696e   sizer_accountin
-000244d0: 666f 2e41 6464 4772 6f77 6162 6c65 436f  fo.AddGrowableCo
-000244e0: 6c28 312c 2031 290d 0a0d 0a20 2020 2020  l(1, 1)....     
-000244f0: 2020 2062 6d70 5f70 616e 656c 2e53 697a     bmp_panel.Siz
-00024500: 6572 2e41 6464 2862 6d70 5f73 7461 7469  er.Add(bmp_stati
-00024510: 632c 2062 6f72 6465 723d 322c 2066 6c61  c, border=2, fla
-00024520: 673d 7778 2e47 524f 5720 7c20 7778 2e54  g=wx.GROW | wx.T
-00024530: 4f50 290d 0a20 2020 2020 2020 2073 697a  OP)..        siz
-00024540: 6572 5f61 6363 6f75 6e74 2e41 6464 2862  er_account.Add(b
-00024550: 6d70 5f70 616e 656c 2c20 626f 7264 6572  mp_panel, border
-00024560: 3d31 302c 2066 6c61 673d 7778 2e4c 4546  =10, flag=wx.LEF
-00024570: 5420 7c20 7778 2e52 4947 4854 290d 0a20  T | wx.RIGHT).. 
-00024580: 2020 2020 2020 2073 697a 6572 5f61 6363         sizer_acc
-00024590: 6f75 6e74 2e41 6464 2873 697a 6572 5f61  ount.Add(sizer_a
-000245a0: 6363 6f75 6e74 696e 666f 2c20 7072 6f70  ccountinfo, prop
-000245b0: 6f72 7469 6f6e 3d31 2c20 666c 6167 3d77  ortion=1, flag=w
-000245c0: 782e 4752 4f57 290d 0a20 2020 2020 2020  x.GROW)..       
-000245d0: 2073 697a 6572 312e 4164 6428 7369 7a65   sizer1.Add(size
-000245e0: 725f 6163 636f 756e 742c 2062 6f72 6465  r_account, borde
-000245f0: 723d 3230 2c20 7072 6f70 6f72 7469 6f6e  r=20, proportion
-00024600: 3d31 2c0d 0a20 2020 2020 2020 2020 2020  =1,..           
-00024610: 2020 2020 2020 2020 666c 6167 3d77 782e          flag=wx.
-00024620: 544f 5020 7c20 7778 2e47 524f 5729 0d0a  TOP | wx.GROW)..
-00024630: 0d0a 2020 2020 2020 2020 7369 7a65 7232  ..        sizer2
-00024640: 203d 2070 616e 656c 322e 5369 7a65 7220   = panel2.Sizer 
-00024650: 3d20 7778 2e42 6f78 5369 7a65 7228 7778  = wx.BoxSizer(wx
-00024660: 2e56 4552 5449 4341 4c29 0d0a 2020 2020  .VERTICAL)..    
-00024670: 2020 2020 7369 7a65 725f 6669 6c65 203d      sizer_file =
-00024680: 2077 782e 466c 6578 4772 6964 5369 7a65   wx.FlexGridSize
-00024690: 7228 636f 6c73 3d32 2c20 7667 6170 3d33  r(cols=2, vgap=3
-000246a0: 2c20 6867 6170 3d31 3029 0d0a 2020 2020  , hgap=10)..    
-000246b0: 2020 2020 6c61 6265 6c5f 6669 6c65 203d      label_file =
-000246c0: 2077 782e 5374 6174 6963 5465 7874 2870   wx.StaticText(p
-000246d0: 6172 656e 743d 7061 6e65 6c32 2c20 6c61  arent=panel2, la
-000246e0: 6265 6c3d 2244 6174 6162 6173 6520 696e  bel="Database in
-000246f0: 666f 726d 6174 696f 6e22 290d 0a20 2020  formation")..   
-00024700: 2020 2020 206c 6162 656c 5f66 696c 652e       label_file.
-00024710: 466f 6e74 203d 2077 782e 466f 6e74 2831  Font = wx.Font(1
-00024720: 302c 2077 782e 464f 4e54 4641 4d49 4c59  0, wx.FONTFAMILY
-00024730: 5f53 5749 5353 2c20 7778 2e46 4f4e 5453  _SWISS, wx.FONTS
-00024740: 5459 4c45 5f4e 4f52 4d41 4c2c 0d0a 2020  TYLE_NORMAL,..  
-00024750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024770: 7778 2e46 4f4e 5457 4549 4748 545f 424f  wx.FONTWEIGHT_BO
-00024780: 4c44 2c20 6661 6365 4e61 6d65 3d73 656c  LD, faceName=sel
-00024790: 662e 466f 6e74 2e46 6163 654e 616d 6529  f.Font.FaceName)
-000247a0: 0d0a 2020 2020 2020 2020 7369 7a65 7232  ..        sizer2
-000247b0: 2e41 6464 286c 6162 656c 5f66 696c 652c  .Add(label_file,
-000247c0: 2062 6f72 6465 723d 352c 2066 6c61 673d   border=5, flag=
-000247d0: 7778 2e41 4c4c 290d 0a0d 0a20 2020 2020  wx.ALL)....     
-000247e0: 2020 206e 616d 6573 203d 205b 2265 6469     names = ["edi
-000247f0: 745f 696e 666f 5f63 6861 7473 222c 2022  t_info_chats", "
-00024800: 6564 6974 5f69 6e66 6f5f 636f 6e74 6163  edit_info_contac
-00024810: 7473 222c 0d0a 2020 2020 2020 2020 2020  ts",..          
-00024820: 2020 2020 2020 2022 6564 6974 5f69 6e66         "edit_inf
-00024830: 6f5f 7472 616e 7366 6572 7322 2c20 2265  o_transfers", "e
-00024840: 6469 745f 696e 666f 5f6d 6573 7361 6765  dit_info_message
-00024850: 7322 2c0d 0a20 2020 2020 2020 2020 2020  s",..           
-00024860: 2020 2020 2020 2265 6469 745f 696e 666f        "edit_info
-00024870: 5f6c 6173 746d 6573 7361 6765 222c 2022  _lastmessage", "
-00024880: 6564 6974 5f69 6e66 6f5f 6669 7273 746d  edit_info_firstm
-00024890: 6573 7361 6765 222c 2022 222c 0d0a 2020  essage", "",..  
-000248a0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-000248b0: 6564 6974 5f69 6e66 6f5f 7061 7468 222c  edit_info_path",
-000248c0: 2022 6564 6974 5f69 6e66 6f5f 7369 7a65   "edit_info_size
-000248d0: 222c 2022 6564 6974 5f69 6e66 6f5f 6d6f  ", "edit_info_mo
-000248e0: 6469 6669 6564 222c 0d0a 2020 2020 2020  dified",..      
-000248f0: 2020 2020 2020 2020 2020 2022 6564 6974             "edit
-00024900: 5f69 6e66 6f5f 7368 6131 222c 2022 6564  _info_sha1", "ed
-00024910: 6974 5f69 6e66 6f5f 6d64 3522 2c20 5d0d  it_info_md5", ].
-00024920: 0a20 2020 2020 2020 206c 6162 656c 7320  .        labels 
-00024930: 3d20 5b22 436f 6e76 6572 7361 7469 6f6e  = ["Conversation
-00024940: 7322 2c20 2243 6f6e 7461 6374 7322 2c20  s", "Contacts", 
-00024950: 2246 696c 6520 7472 616e 7366 6572 7322  "File transfers"
-00024960: 2c20 224d 6573 7361 6765 7322 2c0d 0a20  , "Messages",.. 
-00024970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024980: 2022 4c61 7374 206d 6573 7361 6765 222c   "Last message",
-00024990: 2022 4669 7273 7420 6d65 7373 6167 6522   "First message"
-000249a0: 2c20 2222 2c0d 0a20 2020 2020 2020 2020  , "",..         
-000249b0: 2020 2020 2020 2020 2022 4675 6c6c 2070           "Full p
-000249c0: 6174 6822 2c20 2246 696c 6520 7369 7a65  ath", "File size
-000249d0: 222c 2022 4c61 7374 206d 6f64 6966 6965  ", "Last modifie
-000249e0: 6422 2c0d 0a20 2020 2020 2020 2020 2020  d",..           
-000249f0: 2020 2020 2020 2022 5348 412d 3120 6368         "SHA-1 ch
-00024a00: 6563 6b73 756d 222c 2022 4d44 3520 6368  ecksum", "MD5 ch
-00024a10: 6563 6b73 756d 222c 2020 5d0d 0a20 2020  ecksum",  ]..   
-00024a20: 2020 2020 2066 6f72 206e 616d 652c 206c       for name, l
-00024a30: 6162 656c 2069 6e20 7a69 7028 6e61 6d65  abel in zip(name
-00024a40: 732c 206c 6162 656c 7329 3a0d 0a20 2020  s, labels):..   
-00024a50: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-00024a60: 6e61 6d65 2061 6e64 206e 6f74 206c 6162  name and not lab
-00024a70: 656c 3a0d 0a20 2020 2020 2020 2020 2020  el:..           
-00024a80: 2020 2020 2073 697a 6572 5f66 696c 652e       sizer_file.
-00024a90: 4164 6453 7061 6365 7228 3230 292c 2073  AddSpacer(20), s
-00024aa0: 697a 6572 5f66 696c 652e 4164 6453 7061  izer_file.AddSpa
-00024ab0: 6365 7228 3230 290d 0a20 2020 2020 2020  cer(20)..       
-00024ac0: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
-00024ad0: 6520 2320 666f 7220 6e61 6d65 2c20 6c61  e # for name, la
-00024ae0: 6265 6c0d 0a20 2020 2020 2020 2020 2020  bel..           
-00024af0: 206c 6162 656c 7465 7874 203d 2077 782e   labeltext = wx.
-00024b00: 5374 6174 6963 5465 7874 2870 6172 656e  StaticText(paren
-00024b10: 743d 7061 6e65 6c32 2c20 6c61 6265 6c3d  t=panel2, label=
-00024b20: 2225 733a 2220 2520 6c61 6265 6c29 0d0a  "%s:" % label)..
-00024b30: 2020 2020 2020 2020 2020 2020 436f 6c6f              Colo
-00024b40: 7572 4d61 6e61 6765 722e 4d61 6e61 6765  urManager.Manage
-00024b50: 286c 6162 656c 7465 7874 2c20 2246 6f72  (labeltext, "For
-00024b60: 6567 726f 756e 6443 6f6c 6f75 7222 2c20  egroundColour", 
-00024b70: 2244 6973 6162 6c65 6443 6f6c 6f75 7222  "DisabledColour"
-00024b80: 290d 0a20 2020 2020 2020 2020 2020 2076  )..            v
-00024b90: 616c 7565 7465 7874 203d 2077 782e 5465  aluetext = wx.Te
-00024ba0: 7874 4374 726c 2870 6172 656e 743d 7061  xtCtrl(parent=pa
-00024bb0: 6e65 6c32 2c20 7661 6c75 653d 2241 6e61  nel2, value="Ana
-00024bc0: 6c79 7a69 6e67 2e2e 222c 0d0a 2020 2020  lyzing..",..    
-00024bd0: 2020 2020 2020 2020 2020 2020 7374 796c              styl
-00024be0: 653d 7778 2e4e 4f5f 424f 5244 4552 207c  e=wx.NO_BORDER |
-00024bf0: 2077 782e 5445 5f4d 554c 5449 4c49 4e45   wx.TE_MULTILINE
-00024c00: 207c 2077 782e 5445 5f52 4943 4829 0d0a   | wx.TE_RICH)..
-00024c10: 2020 2020 2020 2020 2020 2020 7661 6c75              valu
-00024c20: 6574 6578 742e 4d69 6e53 697a 6520 3d20  etext.MinSize = 
-00024c30: 282d 312c 2033 3529 0d0a 2020 2020 2020  (-1, 35)..      
-00024c40: 2020 2020 2020 436f 6c6f 7572 4d61 6e61        ColourMana
-00024c50: 6765 722e 4d61 6e61 6765 2876 616c 7565  ger.Manage(value
-00024c60: 7465 7874 2c20 2242 6163 6b67 726f 756e  text, "Backgroun
-00024c70: 6443 6f6c 6f75 7222 2c20 2242 6743 6f6c  dColour", "BgCol
-00024c80: 6f75 7222 290d 0a20 2020 2020 2020 2020  our")..         
-00024c90: 2020 2076 616c 7565 7465 7874 2e53 6574     valuetext.Set
-00024ca0: 4564 6974 6162 6c65 2846 616c 7365 290d  Editable(False).
-00024cb0: 0a20 2020 2020 2020 2020 2020 2073 697a  .            siz
-00024cc0: 6572 5f66 696c 652e 4164 6428 6c61 6265  er_file.Add(labe
-00024cd0: 6c74 6578 742c 2062 6f72 6465 723d 352c  ltext, border=5,
-00024ce0: 2066 6c61 673d 7778 2e4c 4546 5429 0d0a   flag=wx.LEFT)..
-00024cf0: 2020 2020 2020 2020 2020 2020 7369 7a65              size
-00024d00: 725f 6669 6c65 2e41 6464 2876 616c 7565  r_file.Add(value
-00024d10: 7465 7874 2c20 7072 6f70 6f72 7469 6f6e  text, proportion
-00024d20: 3d31 2c20 666c 6167 3d77 782e 4752 4f57  =1, flag=wx.GROW
-00024d30: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
-00024d40: 6574 6174 7472 2873 656c 662c 206e 616d  etattr(self, nam
-00024d50: 652c 2076 616c 7565 7465 7874 290d 0a20  e, valuetext).. 
-00024d60: 2020 2020 2020 2073 656c 662e 6564 6974         self.edit
-00024d70: 5f69 6e66 6f5f 7061 7468 2e56 616c 7565  _info_path.Value
-00024d80: 203d 2073 656c 662e 6462 2e66 696c 656e   = self.db.filen
-00024d90: 616d 650d 0a0d 0a20 2020 2020 2020 2062  ame....        b
-00024da0: 7574 746f 6e5f 6368 6563 6b20 3d20 7365  utton_check = se
-00024db0: 6c66 2e62 7574 746f 6e5f 6368 6563 6b5f  lf.button_check_
-00024dc0: 696e 7465 6772 6974 7920 3d20 5c0d 0a20  integrity = \.. 
-00024dd0: 2020 2020 2020 2020 2020 2077 782e 4275             wx.Bu
-00024de0: 7474 6f6e 2870 6172 656e 743d 7061 6e65  tton(parent=pane
-00024df0: 6c32 2c20 6c61 6265 6c3d 2243 6865 636b  l2, label="Check
-00024e00: 2066 6f72 2063 6f72 7275 7074 696f 6e22   for corruption"
-00024e10: 290d 0a20 2020 2020 2020 2062 7574 746f  )..        butto
-00024e20: 6e5f 7265 6672 6573 6820 3d20 7365 6c66  n_refresh = self
-00024e30: 2e62 7574 746f 6e5f 7265 6672 6573 685f  .button_refresh_
-00024e40: 6669 6c65 696e 666f 203d 205c 0d0a 2020  fileinfo = \..  
-00024e50: 2020 2020 2020 2020 2020 7778 2e42 7574            wx.But
-00024e60: 746f 6e28 7061 7265 6e74 3d70 616e 656c  ton(parent=panel
-00024e70: 322c 206c 6162 656c 3d22 5265 6672 6573  2, label="Refres
-00024e80: 6822 290d 0a20 2020 2020 2020 2062 7574  h")..        but
-00024e90: 746f 6e5f 6368 6563 6b2e 456e 6162 6c65  ton_check.Enable
-00024ea0: 6420 3d20 6275 7474 6f6e 5f72 6566 7265  d = button_refre
-00024eb0: 7368 2e45 6e61 626c 6564 203d 2046 616c  sh.Enabled = Fal
-00024ec0: 7365 0d0a 2020 2020 2020 2020 6275 7474  se..        butt
-00024ed0: 6f6e 5f63 6865 636b 2e53 6574 546f 6f6c  on_check.SetTool
-00024ee0: 5469 7028 2243 6865 636b 2064 6174 6162  Tip("Check datab
-00024ef0: 6173 6520 696e 7465 6772 6974 7920 666f  ase integrity fo
-00024f00: 7220 636f 7272 7570 7469 6f6e 2061 6e64  r corruption and
-00024f10: 2072 6563 6f76 6572 792e 2229 0d0a 2020   recovery.")..  
-00024f20: 2020 2020 2020 7369 7a65 725f 6669 6c65        sizer_file
-00024f30: 2e41 6464 2862 7574 746f 6e5f 6368 6563  .Add(button_chec
-00024f40: 6b29 0d0a 2020 2020 2020 2020 7369 7a65  k)..        size
-00024f50: 725f 6669 6c65 2e41 6464 2862 7574 746f  r_file.Add(butto
-00024f60: 6e5f 7265 6672 6573 682c 2062 6f72 6465  n_refresh, borde
-00024f70: 723d 3135 2c0d 0a20 2020 2020 2020 2020  r=15,..         
-00024f80: 2020 2020 2020 2020 2020 2020 2020 666c                fl
-00024f90: 6167 3d77 782e 414c 4947 4e5f 5249 4748  ag=wx.ALIGN_RIGH
-00024fa0: 5420 7c20 7778 2e52 4947 4854 290d 0a20  T | wx.RIGHT).. 
-00024fb0: 2020 2020 2020 2073 656c 662e 4269 6e64         self.Bind
-00024fc0: 2877 782e 4556 545f 4255 5454 4f4e 2c20  (wx.EVT_BUTTON, 
-00024fd0: 7365 6c66 2e6f 6e5f 6368 6563 6b5f 696e  self.on_check_in
-00024fe0: 7465 6772 6974 792c 2062 7574 746f 6e5f  tegrity, button_
-00024ff0: 6368 6563 6b29 0d0a 2020 2020 2020 2020  check)..        
-00025000: 7365 6c66 2e42 696e 6428 7778 2e45 5654  self.Bind(wx.EVT
-00025010: 5f42 5554 544f 4e2c 206c 616d 6264 6120  _BUTTON, lambda 
-00025020: 653a 2073 656c 662e 7570 6461 7465 5f69  e: self.update_i
-00025030: 6e66 6f5f 7061 6765 2829 2c0d 0a20 2020  nfo_page(),..   
-00025040: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-00025050: 7574 746f 6e5f 7265 6672 6573 6829 0d0a  utton_refresh)..
-00025060: 0d0a 2020 2020 2020 2020 7369 7a65 725f  ..        sizer_
-00025070: 6669 6c65 2e41 6464 4772 6f77 6162 6c65  file.AddGrowable
-00025080: 436f 6c28 312c 2031 290d 0a20 2020 2020  Col(1, 1)..     
-00025090: 2020 2073 697a 6572 322e 4164 6428 7369     sizer2.Add(si
-000250a0: 7a65 725f 6669 6c65 2c20 626f 7264 6572  zer_file, border
-000250b0: 3d32 302c 2070 726f 706f 7274 696f 6e3d  =20, proportion=
-000250c0: 312c 2066 6c61 673d 7778 2e54 4f50 207c  1, flag=wx.TOP |
-000250d0: 2077 782e 4752 4f57 290d 0a0d 0a20 2020   wx.GROW)....   
-000250e0: 2020 2020 2073 697a 6572 2e41 6464 2870       sizer.Add(p
-000250f0: 616e 656c 312c 2070 726f 706f 7274 696f  anel1, proportio
-00025100: 6e3d 312c 2062 6f72 6465 723d 352c 0d0a  n=1, border=5,..
-00025110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025120: 2020 666c 6167 3d77 782e 4c45 4654 2020    flag=wx.LEFT  
-00025130: 7c20 7778 2e54 4f50 207c 2077 782e 424f  | wx.TOP | wx.BO
-00025140: 5454 4f4d 207c 2077 782e 4752 4f57 290d  TTOM | wx.GROW).
-00025150: 0a20 2020 2020 2020 2073 697a 6572 2e41  .        sizer.A
-00025160: 6464 2870 616e 656c 322c 2070 726f 706f  dd(panel2, propo
-00025170: 7274 696f 6e3d 312c 2062 6f72 6465 723d  rtion=1, border=
-00025180: 352c 0d0a 2020 2020 2020 2020 2020 2020  5,..            
-00025190: 2020 2020 2020 666c 6167 3d77 782e 5249        flag=wx.RI
-000251a0: 4748 5420 7c20 7778 2e54 4f50 207c 2077  GHT | wx.TOP | w
-000251b0: 782e 424f 5454 4f4d 207c 2077 782e 4752  x.BOTTOM | wx.GR
-000251c0: 4f57 290d 0a20 2020 2020 2020 2073 656c  OW)..        sel
-000251d0: 662e 7570 6461 7465 5f61 6363 6f75 6e74  f.update_account
-000251e0: 696e 666f 2829 0d0a 2020 2020 2020 2020  info()..        
-000251f0: 7061 6765 2e53 6574 7570 5363 726f 6c6c  page.SetupScroll
-00025200: 696e 6728 290d 0a0d 0a0d 0a20 2020 2064  ing()......    d
-00025210: 6566 2063 7265 6174 655f 7061 6765 5f6c  ef create_page_l
-00025220: 6976 6528 7365 6c66 2c20 6e6f 7465 626f  ive(self, notebo
-00025230: 6f6b 293a 0d0a 2020 2020 2020 2020 2222  ok):..        ""
-00025240: 2243 7265 6174 6573 2061 2070 6167 6520  "Creates a page 
-00025250: 666f 7220 6861 6e64 6c69 6e67 2063 6f6d  for handling com
-00025260: 6d75 6e69 6361 7469 6f6e 2077 6974 6820  munication with 
-00025270: 536b 7970 6520 6f6e 6c69 6e65 206c 6f67  Skype online log
-00025280: 696e 2e22 2222 0d0a 2020 2020 2020 2020  in."""..        
-00025290: 7061 6765 203d 2073 656c 662e 7061 6765  page = self.page
-000252a0: 5f6c 6976 6520 3d20 7778 2e50 616e 656c  _live = wx.Panel
-000252b0: 286e 6f74 6562 6f6f 6b29 0d0a 2020 2020  (notebook)..    
-000252c0: 2020 2020 7365 6c66 2e70 6167 656f 7264      self.pageord
-000252d0: 6572 5b70 6167 655d 203d 206c 656e 2873  er[page] = len(s
-000252e0: 656c 662e 7061 6765 6f72 6465 7229 0d0a  elf.pageorder)..
-000252f0: 2020 2020 2020 2020 6e6f 7465 626f 6f6b          notebook
-00025300: 2e41 6464 5061 6765 2870 6167 652c 2022  .AddPage(page, "
-00025310: 4f6e 6c69 6e65 2229 0d0a 0d0a 2020 2020  Online")....    
-00025320: 2020 2020 7370 6c69 7474 6572 203d 2073      splitter = s
-00025330: 656c 662e 7370 6c69 7474 6572 5f6c 6976  elf.splitter_liv
-00025340: 6520 3d20 7778 2e53 706c 6974 7465 7257  e = wx.SplitterW
-00025350: 696e 646f 7728 0d0a 2020 2020 2020 2020  indow(..        
-00025360: 2020 2020 7061 7265 6e74 3d70 6167 652c      parent=page,
-00025370: 2073 7479 6c65 3d77 782e 424f 5244 4552   style=wx.BORDER
-00025380: 5f4e 4f4e 450d 0a20 2020 2020 2020 2029  _NONE..        )
-00025390: 0d0a 2020 2020 2020 2020 7370 6c69 7474  ..        splitt
-000253a0: 6572 2e53 6574 4d69 6e69 6d75 6d50 616e  er.SetMinimumPan
-000253b0: 6553 697a 6528 3330 3029 0d0a 2020 2020  eSize(300)..    
-000253c0: 2020 2020 7061 6e65 6c31 203d 2073 656c      panel1 = sel
-000253d0: 662e 7061 6e65 6c5f 6c6f 6769 6e20 3d20  f.panel_login = 
-000253e0: 7778 2e50 616e 656c 2873 706c 6974 7465  wx.Panel(splitte
-000253f0: 7229 0d0a 2020 2020 2020 2020 7061 6e65  r)..        pane
-00025400: 6c32 203d 2073 656c 662e 7061 6e65 6c5f  l2 = self.panel_
-00025410: 7379 6e63 2020 3d20 7778 2e50 616e 656c  sync  = wx.Panel
-00025420: 2873 706c 6974 7465 7229 0d0a 2020 2020  (splitter)..    
-00025430: 2020 2020 7370 6c69 7474 6572 5f73 796e      splitter_syn
-00025440: 6320 3d20 7365 6c66 2e73 706c 6974 7465  c = self.splitte
-00025450: 725f 7379 6e63 203d 2077 782e 5370 6c69  r_sync = wx.Spli
-00025460: 7474 6572 5769 6e64 6f77 280d 0a20 2020  tterWindow(..   
-00025470: 2020 2020 2020 2020 2070 6172 656e 743d           parent=
-00025480: 7061 6e65 6c32 2c20 7374 796c 653d 7778  panel2, style=wx
-00025490: 2e42 4f52 4445 525f 4e4f 4e45 0d0a 2020  .BORDER_NONE..  
-000254a0: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
-000254b0: 2073 706c 6974 7465 725f 7379 6e63 2e53   splitter_sync.S
-000254c0: 6574 4d69 6e69 6d75 6d50 616e 6553 697a  etMinimumPaneSiz
-000254d0: 6528 3130 3029 0d0a 2020 2020 2020 2020  e(100)..        
-000254e0: 7061 6e65 6c5f 7379 6e63 3120 3d20 7778  panel_sync1 = wx
-000254f0: 2e50 616e 656c 2873 706c 6974 7465 725f  .Panel(splitter_
-00025500: 7379 6e63 290d 0a20 2020 2020 2020 2070  sync)..        p
-00025510: 616e 656c 5f73 796e 6332 203d 2077 782e  anel_sync2 = wx.
-00025520: 5061 6e65 6c28 7370 6c69 7474 6572 5f73  Panel(splitter_s
-00025530: 796e 6329 0d0a 0d0a 2020 2020 2020 2020  ync)....        
-00025540: 6c61 6265 6c5f 6c6f 6769 6e20 203d 2077  label_login  = w
-00025550: 782e 5374 6174 6963 5465 7874 2870 616e  x.StaticText(pan
-00025560: 656c 312c 206c 6162 656c 3d22 4c6f 6720  el1, label="Log 
-00025570: 696e 2074 6f20 536b 7970 6520 6f6e 6c69  in to Skype onli
-00025580: 6e65 2061 6363 6f75 6e74 2229 0d0a 2020  ne account")..  
-00025590: 2020 2020 2020 6c61 6265 6c5f 7573 6572        label_user
-000255a0: 2020 203d 2077 782e 5374 6174 6963 5465     = wx.StaticTe
-000255b0: 7874 2870 616e 656c 312c 206c 6162 656c  xt(panel1, label
-000255c0: 3d22 5573 6572 6e61 6d65 3a22 290d 0a20  ="Username:").. 
-000255d0: 2020 2020 2020 2065 6469 745f 7573 6572         edit_user
-000255e0: 2020 2020 3d20 7778 2e54 6578 7443 7472      = wx.TextCtr
-000255f0: 6c28 7061 6e65 6c31 290d 0a20 2020 2020  l(panel1)..     
-00025600: 2020 2062 7574 746f 6e5f 7573 6572 2020     button_user  
-00025610: 3d20 7778 2e42 7574 746f 6e28 7061 6e65  = wx.Button(pane
-00025620: 6c31 2c20 6c61 6265 6c3d 2243 6861 6e67  l1, label="Chang
-00025630: 6522 290d 0a20 2020 2020 2020 206c 6162  e")..        lab
-00025640: 656c 5f70 7720 2020 2020 3d20 7778 2e53  el_pw     = wx.S
-00025650: 7461 7469 6354 6578 7428 7061 6e65 6c31  taticText(panel1
-00025660: 2c20 6c61 6265 6c3d 2226 5061 7373 776f  , label="&Passwo
-00025670: 7264 3a22 2c20 6e61 6d65 3d22 6c61 6265  rd:", name="labe
-00025680: 6c5f 6c69 7665 5f70 7722 290d 0a20 2020  l_live_pw")..   
-00025690: 2020 2020 2065 6469 745f 7077 2020 2020       edit_pw    
-000256a0: 2020 3d20 7778 2e54 6578 7443 7472 6c28    = wx.TextCtrl(
-000256b0: 7061 6e65 6c31 2c20 7374 796c 653d 7778  panel1, style=wx
-000256c0: 2e54 455f 5041 5353 574f 5244 207c 2077  .TE_PASSWORD | w
-000256d0: 782e 5445 5f50 524f 4345 5353 5f45 4e54  x.TE_PROCESS_ENT
-000256e0: 4552 2c20 6e61 6d65 3d22 6c69 7665 5f70  ER, name="live_p
-000256f0: 7722 290d 0a20 2020 2020 2020 2063 6865  w")..        che
-00025700: 636b 5f73 746f 7265 2020 3d20 7778 2e43  ck_store  = wx.C
-00025710: 6865 636b 426f 7828 7061 6e65 6c31 2c20  heckBox(panel1, 
-00025720: 6c61 6265 6c3d 2226 5265 6d65 6d62 6572  label="&Remember
-00025730: 2070 6173 7377 6f72 6422 290d 0a20 2020   password")..   
-00025740: 2020 2020 2063 6865 636b 5f6c 6f67 696e       check_login
-00025750: 2020 3d20 7778 2e43 6865 636b 426f 7828    = wx.CheckBox(
-00025760: 7061 6e65 6c31 2c20 6c61 6265 6c3d 224c  panel1, label="L
-00025770: 6f67 2069 6e20 2661 7574 6f6d 6174 6963  og in &automatic
-00025780: 616c 6c79 2229 0d0a 2020 2020 2020 2020  ally")..        
-00025790: 6368 6563 6b5f 7379 6e63 2020 203d 2077  check_sync   = w
-000257a0: 782e 4368 6563 6b42 6f78 2870 616e 656c  x.CheckBox(panel
-000257b0: 312c 206c 6162 656c 3d22 5379 6e63 6872  1, label="Synchr
-000257c0: 6f6e 697a 6520 6869 7374 6f72 7920 2661  onize history &a
-000257d0: 7574 6f6d 6174 6963 616c 6c79 2229 0d0a  utomatically")..
-000257e0: 2020 2020 2020 2020 6564 6974 5f73 7461          edit_sta
-000257f0: 7475 7320 203d 2077 782e 5465 7874 4374  tus  = wx.TextCt
-00025800: 726c 2870 616e 656c 312c 2073 697a 653d  rl(panel1, size=
-00025810: 282d 312c 2033 3029 2c20 7374 796c 653d  (-1, 30), style=
-00025820: 7778 2e54 455f 4d55 4c54 494c 494e 4520  wx.TE_MULTILINE 
-00025830: 7c20 7778 2e54 455f 4e4f 5f56 5343 524f  | wx.TE_NO_VSCRO
-00025840: 4c4c 207c 2077 782e 424f 5244 4552 5f4e  LL | wx.BORDER_N
-00025850: 4f4e 4529 0d0a 2020 2020 2020 2020 6275  ONE)..        bu
-00025860: 7474 6f6e 5f6c 6f67 696e 203d 2063 6f6e  tton_login = con
-00025870: 7472 6f6c 732e 4e6f 7465 4275 7474 6f6e  trols.NoteButton
-00025880: 2870 616e 656c 312c 2062 6d70 3d69 6d61  (panel1, bmp=ima
-00025890: 6765 732e 4275 7474 6f6e 4c6f 6769 6e2e  ges.ButtonLogin.
-000258a0: 4269 746d 6170 290d 0a20 2020 2020 2020  Bitmap)..       
-000258b0: 206c 6162 656c 5f69 6e66 6f20 2020 3d20   label_info   = 
-000258c0: 7778 2e68 746d 6c2e 4874 6d6c 5769 6e64  wx.html.HtmlWind
-000258d0: 6f77 2870 616e 656c 3129 0d0a 0d0a 2020  ow(panel1)....  
-000258e0: 2020 2020 2020 6c61 6265 6c5f 7379 6e63        label_sync
-000258f0: 203d 2077 782e 5374 6174 6963 5465 7874   = wx.StaticText
-00025900: 2870 6172 656e 743d 7061 6e65 6c32 2c20  (parent=panel2, 
-00025910: 6c61 6265 6c3d 2255 7064 6174 6520 6461  label="Update da
-00025920: 7461 6261 7365 2066 726f 6d20 536b 7970  tabase from Skyp
-00025930: 6520 6f6e 6c69 6e65 2229 0d0a 2020 2020  e online")..    
-00025940: 2020 2020 6c69 7374 5f63 6861 7473 203d      list_chats =
-00025950: 2063 6f6e 7472 6f6c 732e 536f 7274 6162   controls.Sortab
-00025960: 6c65 4c69 7374 5669 6577 2870 6172 656e  leListView(paren
-00025970: 743d 7061 6e65 6c5f 7379 6e63 312c 2073  t=panel_sync1, s
-00025980: 7479 6c65 3d77 782e 4c43 5f52 4550 4f52  tyle=wx.LC_REPOR
-00025990: 5429 0d0a 2020 2020 2020 2020 6761 7567  T)..        gaug
-000259a0: 6520 3d20 7778 2e47 6175 6765 2870 616e  e = wx.Gauge(pan
-000259b0: 656c 5f73 796e 6332 2c20 7369 7a65 3d28  el_sync2, size=(
-000259c0: 3330 302c 2031 3529 2c20 7374 796c 653d  300, 15), style=
-000259d0: 7778 2e47 415f 484f 5249 5a4f 4e54 414c  wx.GA_HORIZONTAL
-000259e0: 207c 2077 782e 5044 5f53 4d4f 4f54 4829   | wx.PD_SMOOTH)
-000259f0: 0d0a 2020 2020 2020 2020 6c61 6265 6c5f  ..        label_
-00025a00: 7072 6f67 7265 7373 2020 203d 2077 782e  progress   = wx.
-00025a10: 5374 6174 6963 5465 7874 2870 616e 656c  StaticText(panel
-00025a20: 5f73 796e 6332 290d 0a20 2020 2020 2020  _sync2)..       
-00025a30: 2065 6469 745f 7379 6e63 5f73 7461 7475   edit_sync_statu
-00025a40: 7320 3d20 7778 2e54 6578 7443 7472 6c28  s = wx.TextCtrl(
-00025a50: 7061 6e65 6c5f 7379 6e63 322c 2073 697a  panel_sync2, siz
-00025a60: 653d 282d 312c 2035 3029 2c20 7374 796c  e=(-1, 50), styl
-00025a70: 653d 7778 2e54 455f 4d55 4c54 494c 494e  e=wx.TE_MULTILIN
-00025a80: 4529 0d0a 2020 2020 2020 2020 6368 6563  E)..        chec
-00025a90: 6b5f 636f 6e74 6163 7473 2020 203d 2077  k_contacts   = w
-00025aa0: 782e 4368 6563 6b42 6f78 2870 616e 656c  x.CheckBox(panel
-00025ab0: 5f73 796e 6332 2c20 6c61 6265 6c3d 2255  _sync2, label="U
-00025ac0: 7064 6174 6520 6578 6973 7469 6e67 2026  pdate existing &
-00025ad0: 636f 6e74 6163 7420 696e 666f 726d 6174  contact informat
-00025ae0: 696f 6e22 290d 0a20 2020 2020 2020 2063  ion")..        c
-00025af0: 6865 636b 5f6f 6c64 6572 2020 2020 2020  heck_older      
-00025b00: 3d20 7778 2e43 6865 636b 426f 7828 7061  = wx.CheckBox(pa
-00025b10: 6e65 6c5f 7379 6e63 322c 206c 6162 656c  nel_sync2, label
-00025b20: 3d22 4368 6563 6b20 266f 6c64 6572 2064  ="Check &older d
-00025b30: 6174 6162 6173 6520 6368 6174 7320 666f  atabase chats fo
-00025b40: 7220 6d65 7373 6167 6573 2074 6f20 7379  r messages to sy
-00025b50: 6e63 2229 0d0a 2020 2020 2020 2020 6275  nc")..        bu
-00025b60: 7474 6f6e 5f73 796e 6320 2020 2020 203d  tton_sync      =
-00025b70: 2063 6f6e 7472 6f6c 732e 4e6f 7465 4275   controls.NoteBu
-00025b80: 7474 6f6e 2870 616e 656c 5f73 796e 6332  tton(panel_sync2
-00025b90: 2c20 626d 703d 696d 6167 6573 2e42 7574  , bmp=images.But
-00025ba0: 746f 6e4d 6572 6765 4c65 6674 4d75 6c74  tonMergeLeftMult
-00025bb0: 692e 4269 746d 6170 290d 0a20 2020 2020  i.Bitmap)..     
-00025bc0: 2020 2062 7574 746f 6e5f 7379 6e63 5f73     button_sync_s
-00025bd0: 656c 2020 3d20 636f 6e74 726f 6c73 2e4e  el  = controls.N
-00025be0: 6f74 6542 7574 746f 6e28 7061 6e65 6c5f  oteButton(panel_
-00025bf0: 7379 6e63 322c 2062 6d70 3d69 6d61 6765  sync2, bmp=image
-00025c00: 732e 4275 7474 6f6e 4d65 7267 654c 6566  s.ButtonMergeLef
-00025c10: 742e 4269 746d 6170 290d 0a20 2020 2020  t.Bitmap)..     
-00025c20: 2020 2062 7574 746f 6e5f 7379 6e63 5f73     button_sync_s
-00025c30: 746f 7020 3d20 636f 6e74 726f 6c73 2e4e  top = controls.N
-00025c40: 6f74 6542 7574 746f 6e28 7061 6e65 6c5f  oteButton(panel_
-00025c50: 7379 6e63 322c 2062 6d70 3d69 6d61 6765  sync2, bmp=image
-00025c60: 732e 4275 7474 6f6e 5374 6f70 2e42 6974  s.ButtonStop.Bit
-00025c70: 6d61 7029 0d0a 0d0a 2020 2020 2020 2020  map)....        
-00025c80: 436f 6c6f 7572 4d61 6e61 6765 722e 4d61  ColourManager.Ma
-00025c90: 6e61 6765 2870 616e 656c 312c 2022 4261  nage(panel1, "Ba
-00025ca0: 636b 6772 6f75 6e64 436f 6c6f 7572 222c  ckgroundColour",
-00025cb0: 2022 4267 436f 6c6f 7572 2229 0d0a 2020   "BgColour")..  
-00025cc0: 2020 2020 2020 436f 6c6f 7572 4d61 6e61        ColourMana
-00025cd0: 6765 722e 4d61 6e61 6765 2870 616e 656c  ger.Manage(panel
-00025ce0: 322c 2022 4261 636b 6772 6f75 6e64 436f  2, "BackgroundCo
-00025cf0: 6c6f 7572 222c 2022 4267 436f 6c6f 7572  lour", "BgColour
-00025d00: 2229 0d0a 2020 2020 2020 2020 6c61 6265  ")..        labe
-00025d10: 6c5f 7573 6572 2e44 6973 6162 6c65 2829  l_user.Disable()
-00025d20: 0d0a 2020 2020 2020 2020 6564 6974 5f75  ..        edit_u
-00025d30: 7365 722e 4469 7361 626c 6528 290d 0a20  ser.Disable().. 
-00025d40: 2020 2020 2020 206c 6162 656c 5f6c 6f67         label_log
-00025d50: 696e 2e46 6f6e 7420 3d20 7778 2e46 6f6e  in.Font = wx.Fon
-00025d60: 7428 3130 2c20 7778 2e46 4f4e 5446 414d  t(10, wx.FONTFAM
-00025d70: 494c 595f 5357 4953 532c 0d0a 2020 2020  ILY_SWISS,..    
-00025d80: 2020 2020 2020 2020 7778 2e46 4f4e 5453          wx.FONTS
-00025d90: 5459 4c45 5f4e 4f52 4d41 4c2c 2077 782e  TYLE_NORMAL, wx.
-00025da0: 464f 4e54 5745 4947 4854 5f42 4f4c 442c  FONTWEIGHT_BOLD,
-00025db0: 2066 6163 654e 616d 653d 7365 6c66 2e46   faceName=self.F
-00025dc0: 6f6e 742e 4661 6365 4e61 6d65 290d 0a20  ont.FaceName).. 
-00025dd0: 2020 2020 2020 2063 6865 636b 5f73 746f         check_sto
-00025de0: 7265 2e54 6f6f 6c54 6970 203d 2022 5374  re.ToolTip = "St
-00025df0: 6f72 6520 7061 7373 776f 7264 2066 6f72  ore password for
-00025e00: 2074 6869 7320 6461 7461 6261 7365 206c   this database l
-00025e10: 6f63 616c 6c79 220d 0a20 2020 2020 2020  ocally"..       
-00025e20: 2063 6865 636b 5f6c 6f67 696e 2e54 6f6f   check_login.Too
-00025e30: 6c54 6970 203d 2022 4c6f 6720 696e 2074  lTip = "Log in t
-00025e40: 6f20 536b 7970 6520 6f6e 6c69 6e65 2073  o Skype online s
-00025e50: 6572 7669 6365 2061 7574 6f6d 6174 6963  ervice automatic
-00025e60: 616c 6c79 2022 205c 0d0a 2020 2020 2020  ally " \..      
-00025e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025e80: 2020 2020 2020 2020 226f 6e20 6f70 656e          "on open
-00025e90: 696e 6720 7468 6973 2064 6174 6162 6173  ing this databas
-00025ea0: 6520 6e65 7874 2074 696d 6522 0d0a 2020  e next time"..  
-00025eb0: 2020 2020 2020 6368 6563 6b5f 7379 6e63        check_sync
-00025ec0: 2e54 6f6f 6c54 6970 2020 3d20 2255 7064  .ToolTip  = "Upd
-00025ed0: 6174 6520 6461 7461 6261 7365 2066 726f  ate database fro
-00025ee0: 6d20 536b 7970 6520 6f6e 6c69 6e65 2073  m Skype online s
-00025ef0: 6572 7669 6365 2022 205c 0d0a 2020 2020  ervice " \..    
-00025f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025f10: 2020 2020 2020 2020 2020 2261 7574 6f6d            "autom
-00025f20: 6174 6963 616c 6c79 206f 6e20 6f70 656e  atically on open
-00025f30: 696e 6720 7468 6973 2064 6174 6162 6173  ing this databas
-00025f40: 6520 6e65 7874 2074 696d 6522 0d0a 2020  e next time"..  
-00025f50: 2020 2020 2020 6368 6563 6b5f 6c6f 6769        check_logi
-00025f60: 6e2e 456e 6162 6c65 6420 3d20 6368 6563  n.Enabled = chec
-00025f70: 6b5f 7379 6e63 2e45 6e61 626c 6564 203d  k_sync.Enabled =
-00025f80: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
-00025f90: 436f 6c6f 7572 4d61 6e61 6765 722e 4d61  ColourManager.Ma
-00025fa0: 6e61 6765 2865 6469 745f 7374 6174 7573  nage(edit_status
-00025fb0: 2c20 2246 6f72 6567 726f 756e 6443 6f6c  , "ForegroundCol
-00025fc0: 6f75 7222 2c20 2244 6973 6162 6c65 6443  our", "DisabledC
-00025fd0: 6f6c 6f75 7222 290d 0a20 2020 2020 2020  olour")..       
-00025fe0: 2043 6f6c 6f75 724d 616e 6167 6572 2e4d   ColourManager.M
-00025ff0: 616e 6167 6528 6564 6974 5f73 7461 7475  anage(edit_statu
-00026000: 732c 2022 4261 636b 6772 6f75 6e64 436f  s, "BackgroundCo
-00026010: 6c6f 7572 222c 2022 4267 436f 6c6f 7572  lour", "BgColour
-00026020: 2229 0d0a 2020 2020 2020 2020 6564 6974  ")..        edit
-00026030: 5f73 7461 7475 732e 5365 7445 6469 7461  _status.SetEdita
-00026040: 626c 6528 4661 6c73 6529 0d0a 2020 2020  ble(False)..    
-00026050: 2020 2020 436f 6c6f 7572 4d61 6e61 6765      ColourManage
-00026060: 722e 4d61 6e61 6765 2862 7574 746f 6e5f  r.Manage(button_
-00026070: 6c6f 6769 6e2c 2022 4261 636b 6772 6f75  login, "Backgrou
-00026080: 6e64 436f 6c6f 7572 222c 2022 4267 436f  ndColour", "BgCo
-00026090: 6c6f 7572 2229 0d0a 2020 2020 2020 2020  lour")..        
-000260a0: 6275 7474 6f6e 5f6c 6f67 696e 2e4c 6162  button_login.Lab
-000260b0: 656c 203d 2022 264c 6f67 2069 6e20 6173  el = "&Log in as
-000260c0: 2027 2573 2722 2025 2073 656c 662e 6462   '%s'" % self.db
-000260d0: 2e75 7365 726e 616d 650d 0a20 2020 2020  .username..     
-000260e0: 2020 2062 7574 746f 6e5f 6c6f 6769 6e2e     button_login.
-000260f0: 4e6f 7465 203d 2022 4166 7465 7220 6c6f  Note = "After lo
-00026100: 6769 6e2c 206c 6f63 616c 2064 6174 6162  gin, local datab
-00026110: 6173 6520 6361 6e20 6265 2075 7064 6174  ase can be updat
-00026120: 6564 2066 726f 6d20 2220 5c0d 0a20 2020  ed from " \..   
-00026130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026140: 2020 2020 2020 2020 2022 536b 7970 6520           "Skype 
-00026150: 6f6e 6c69 6e65 2073 6572 7669 6365 2e5c  online service.\
-00026160: 6e41 6464 6974 696f 6e61 6c6c 792c 2048  nAdditionally, H
-00026170: 544d 4c20 6578 706f 7274 2022 205c 0d0a  TML export " \..
-00026180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026190: 2020 2020 2020 2020 2020 2020 2263 616e              "can
-000261a0: 2064 6f77 6e6c 6f61 6420 616e 6420 696e   download and in
-000261b0: 636c 7564 6520 7368 6172 6564 206d 6564  clude shared med
-000261c0: 6961 2e22 0d0a 2020 2020 2020 2020 6c61  ia."..        la
-000261d0: 6265 6c5f 696e 666f 2e53 6574 466f 6e74  bel_info.SetFont
-000261e0: 7328 6e6f 726d 616c 5f66 6163 653d 7365  s(normal_face=se
-000261f0: 6c66 2e46 6f6e 742e 4661 6365 4e61 6d65  lf.Font.FaceName
-00026200: 2c20 6669 7865 645f 6661 6365 3d73 656c  , fixed_face=sel
-00026210: 662e 466f 6e74 2e46 6163 654e 616d 652c  f.Font.FaceName,
-00026220: 2073 697a 6573 3d5b 385d 202a 2037 290d   sizes=[8] * 7).
-00026230: 0a20 2020 2020 2020 206c 6162 656c 5f69  .        label_i
-00026240: 6e66 6f2e 5365 7450 6167 6528 7374 6570  nfo.SetPage(step
-00026250: 2e54 656d 706c 6174 6528 7465 6d70 6c61  .Template(templa
-00026260: 7465 732e 4c4f 4749 4e5f 4641 494c 5f49  tes.LOGIN_FAIL_I
-00026270: 4e46 4f29 2e65 7870 616e 6428 2929 0d0a  NFO).expand())..
-00026280: 2020 2020 2020 2020 6c61 6265 6c5f 696e          label_in
-00026290: 666f 2e48 6964 6528 290d 0a0d 0a20 2020  fo.Hide()....   
-000262a0: 2020 2020 206c 6162 656c 5f73 796e 632e       label_sync.
-000262b0: 466f 6e74 203d 2077 782e 466f 6e74 2831  Font = wx.Font(1
-000262c0: 302c 2077 782e 464f 4e54 4641 4d49 4c59  0, wx.FONTFAMILY
-000262d0: 5f53 5749 5353 2c20 7778 2e46 4f4e 5453  _SWISS, wx.FONTS
-000262e0: 5459 4c45 5f4e 4f52 4d41 4c2c 0d0a 2020  TYLE_NORMAL,..  
-000262f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026310: 7778 2e46 4f4e 5457 4549 4748 545f 424f  wx.FONTWEIGHT_BO
-00026320: 4c44 2c20 6661 6365 4e61 6d65 3d73 656c  LD, faceName=sel
-00026330: 662e 466f 6e74 2e46 6163 654e 616d 6529  f.Font.FaceName)
-00026340: 0d0a 2020 2020 2020 2020 636f 6c75 6d6e  ..        column
-00026350: 7320 3d20 5b28 2274 6974 6c65 222c 2022  s = [("title", "
-00026360: 4368 6174 2229 2c20 2822 6d65 7373 6167  Chat"), ("messag
-00026370: 655f 636f 756e 7422 2c20 2255 7064 6174  e_count", "Updat
-00026380: 6573 2229 2c0d 0a20 2020 2020 2020 2020  es"),..         
-00026390: 2020 2020 2020 2020 2020 2822 6669 7273            ("firs
-000263a0: 745f 6d65 7373 6167 655f 6461 7465 7469  t_message_dateti
-000263b0: 6d65 222c 2022 4672 6f6d 2229 2c0d 0a20  me", "From"),.. 
-000263c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000263d0: 2020 2822 6c61 7374 5f6d 6573 7361 6765    ("last_message
-000263e0: 5f64 6174 6574 696d 6522 2c20 2255 6e74  _datetime", "Unt
-000263f0: 696c 2229 205d 0d0a 2020 2020 2020 2020  il") ]..        
-00026400: 6672 6d74 203d 206c 616d 6264 6120 722c  frmt = lambda r,
-00026410: 2063 3a20 725b 635d 2e73 7472 6674 696d   c: r[c].strftim
-00026420: 6528 2225 592d 256d 2d25 6422 2920 6966  e("%Y-%m-%d") if
-00026430: 2072 2e67 6574 2863 2920 656c 7365 2022   r.get(c) else "
-00026440: 220d 0a20 2020 2020 2020 2066 6f72 6d61  "..        forma
-00026450: 7474 6572 7320 3d20 7b22 6669 7273 745f  tters = {"first_
-00026460: 6d65 7373 6167 655f 6461 7465 7469 6d65  message_datetime
-00026470: 223a 2066 726d 742c 0d0a 2020 2020 2020  ": frmt,..      
-00026480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026490: 226c 6173 745f 6d65 7373 6167 655f 6461  "last_message_da
-000264a0: 7465 7469 6d65 223a 2066 726d 742c 207d  tetime": frmt, }
-000264b0: 0d0a 2020 2020 2020 2020 6c69 7374 5f63  ..        list_c
-000264c0: 6861 7473 2e53 6574 436f 6c75 6d6e 7328  hats.SetColumns(
-000264d0: 636f 6c75 6d6e 7329 0d0a 2020 2020 2020  columns)..      
-000264e0: 2020 6c69 7374 5f63 6861 7473 2e53 6574    list_chats.Set
-000264f0: 436f 6c75 6d6e 466f 726d 6174 7465 7273  ColumnFormatters
-00026500: 2866 6f72 6d61 7474 6572 7329 0d0a 2020  (formatters)..  
-00026510: 2020 2020 2020 6c69 7374 5f63 6861 7473        list_chats
-00026520: 2e53 6574 436f 6c75 6d6e 734d 6178 5769  .SetColumnsMaxWi
-00026530: 6474 6828 3330 3029 0d0a 2020 2020 2020  dth(300)..      
-00026540: 2020 436f 6c6f 7572 4d61 6e61 6765 722e    ColourManager.
-00026550: 4d61 6e61 6765 2865 6469 745f 7379 6e63  Manage(edit_sync
-00026560: 5f73 7461 7475 732c 2022 466f 7265 6772  _status, "Foregr
-00026570: 6f75 6e64 436f 6c6f 7572 222c 2022 4469  oundColour", "Di
-00026580: 7361 626c 6564 436f 6c6f 7572 2229 0d0a  sabledColour")..
-00026590: 2020 2020 2020 2020 436f 6c6f 7572 4d61          ColourMa
-000265a0: 6e61 6765 722e 4d61 6e61 6765 2865 6469  nager.Manage(edi
-000265b0: 745f 7379 6e63 5f73 7461 7475 732c 2022  t_sync_status, "
-000265c0: 4261 636b 6772 6f75 6e64 436f 6c6f 7572  BackgroundColour
-000265d0: 222c 2022 4267 436f 6c6f 7572 2229 0d0a  ", "BgColour")..
-000265e0: 2020 2020 2020 2020 6564 6974 5f73 796e          edit_syn
-000265f0: 635f 7374 6174 7573 2e53 6574 4564 6974  c_status.SetEdit
-00026600: 6162 6c65 2846 616c 7365 290d 0a20 2020  able(False)..   
-00026610: 2020 2020 2063 6865 636b 5f63 6f6e 7461       check_conta
-00026620: 6374 732e 546f 6f6c 5469 7020 3d20 2255  cts.ToolTip = "U
-00026630: 7064 6174 6520 7072 6f66 696c 6520 6669  pdate profile fi
-00026640: 656c 6473 206f 6620 6578 6973 7469 6e67  elds of existing
-00026650: 2063 6f6e 7461 6374 7320 6672 6f6d 206f   contacts from o
-00026660: 6e6c 696e 6520 6461 7461 220d 0a20 2020  nline data"..   
-00026670: 2020 2020 2063 6865 636b 5f6f 6c64 6572       check_older
-00026680: 2e54 6f6f 6c54 6970 203d 2022 4368 6563  .ToolTip = "Chec
-00026690: 6b20 616c 6c20 6f6c 6465 7220 6368 6174  k all older chat
-000266a0: 7320 696e 2064 6174 6162 6173 6520 666f  s in database fo
-000266b0: 7220 6d65 7373 6167 6573 2022 205c 0d0a  r messages " \..
-000266c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000266d0: 2020 2020 2020 2020 2020 2020 2020 2274                "t
-000266e0: 6f20 7379 6e63 2066 726f 6d20 6f6e 6c69  o sync from onli
-000266f0: 6e65 2c20 6d61 7920 7461 6b65 2061 206c  ne, may take a l
-00026700: 6f6e 6720 7768 696c 6522 0d0a 2020 2020  ong while"..    
-00026710: 2020 2020 6368 6563 6b5f 636f 6e74 6163      check_contac
-00026720: 7473 2e56 616c 7565 2020 203d 2063 6865  ts.Value   = che
-00026730: 636b 5f6f 6c64 6572 2e56 616c 7565 2020  ck_older.Value  
-00026740: 203d 2054 7275 650d 0a20 2020 2020 2020   = True..       
-00026750: 2063 6865 636b 5f63 6f6e 7461 6374 732e   check_contacts.
-00026760: 456e 6162 6c65 6420 3d20 6368 6563 6b5f  Enabled = check_
-00026770: 6f6c 6465 722e 456e 6162 6c65 6420 3d20  older.Enabled = 
-00026780: 4661 6c73 650d 0a20 2020 2020 2020 2043  False..        C
-00026790: 6f6c 6f75 724d 616e 6167 6572 2e4d 616e  olourManager.Man
-000267a0: 6167 6528 6275 7474 6f6e 5f73 796e 632c  age(button_sync,
-000267b0: 2020 2020 2020 2242 6163 6b67 726f 756e        "Backgroun
-000267c0: 6443 6f6c 6f75 7222 2c20 2242 6743 6f6c  dColour", "BgCol
-000267d0: 6f75 7222 290d 0a20 2020 2020 2020 2043  our")..        C
-000267e0: 6f6c 6f75 724d 616e 6167 6572 2e4d 616e  olourManager.Man
-000267f0: 6167 6528 6275 7474 6f6e 5f73 796e 635f  age(button_sync_
-00026800: 7365 6c2c 2020 2242 6163 6b67 726f 756e  sel,  "Backgroun
-00026810: 6443 6f6c 6f75 7222 2c20 2242 6743 6f6c  dColour", "BgCol
-00026820: 6f75 7222 290d 0a20 2020 2020 2020 2043  our")..        C
-00026830: 6f6c 6f75 724d 616e 6167 6572 2e4d 616e  olourManager.Man
-00026840: 6167 6528 6275 7474 6f6e 5f73 796e 635f  age(button_sync_
-00026850: 7374 6f70 2c20 2242 6163 6b67 726f 756e  stop, "Backgroun
-00026860: 6443 6f6c 6f75 7222 2c20 2242 6743 6f6c  dColour", "BgCol
-00026870: 6f75 7222 290d 0a20 2020 2020 2020 2062  our")..        b
-00026880: 7574 746f 6e5f 7379 6e63 2e4c 6162 656c  utton_sync.Label
-00026890: 203d 2022 5326 796e 6368 726f 6e69 7a65   = "S&ynchronize
-000268a0: 2068 6973 746f 7279 2069 6e20 6c6f 6361   history in loca
-000268b0: 6c20 6461 7461 6261 7365 220d 0a20 2020  l database"..   
-000268c0: 2020 2020 2062 7574 746f 6e5f 7379 6e63       button_sync
-000268d0: 2e4e 6f74 6520 203d 2022 5175 6572 7920  .Note  = "Query 
-000268e0: 536b 7970 6520 6f6e 6c69 6e65 2073 6572  Skype online ser
-000268f0: 7669 6365 7320 666f 7220 6e65 7720 6d65  vices for new me
-00026900: 7373 6167 6573 2061 6e64 2073 6176 6520  ssages and save 
-00026910: 7468 656d 2069 6e20 6c6f 6361 6c20 6461  them in local da
-00026920: 7461 6261 7365 2e22 0d0a 2020 2020 2020  tabase."..      
-00026930: 2020 6275 7474 6f6e 5f73 796e 635f 7365    button_sync_se
-00026940: 6c2e 4c61 6265 6c20 3d20 2253 796e 6368  l.Label = "Synch
-00026950: 726f 6e69 7a65 2073 656c 6563 2674 6564  ronize selec&ted
-00026960: 2063 6861 7473 220d 0a20 2020 2020 2020   chats"..       
-00026970: 2062 7574 746f 6e5f 7379 6e63 5f73 656c   button_sync_sel
-00026980: 2e4e 6f74 6520 203d 2022 5365 6c65 6374  .Note  = "Select
-00026990: 2073 7065 6369 6669 6320 6368 6174 7320   specific chats 
-000269a0: 746f 2075 7064 6174 6520 696e 206c 6f63  to update in loc
-000269b0: 616c 2064 6174 6162 6173 652e 220d 0a20  al database.".. 
-000269c0: 2020 2020 2020 2062 7574 746f 6e5f 7379         button_sy
-000269d0: 6e63 5f73 746f 702e 4c61 6265 6c20 3d20  nc_stop.Label = 
-000269e0: 2253 746f 7020 7379 6e63 6872 6f6e 697a  "Stop synchroniz
-000269f0: 696e 6722 0d0a 2020 2020 2020 2020 6275  ing"..        bu
-00026a00: 7474 6f6e 5f73 796e 635f 7374 6f70 2e4e  tton_sync_stop.N
-00026a10: 6f74 6520 3d20 2243 6561 7365 2071 7565  ote = "Cease que
-00026a20: 7279 696e 6720 7468 6520 6f6e 6c69 6e65  rying the online
-00026a30: 2073 6572 7669 6365 2e22 0d0a 2020 2020   service."..    
-00026a40: 2020 2020 666f 7220 6320 696e 2063 6f6e      for c in con
-00026a50: 7472 6f6c 732e 6765 745f 636f 6e74 726f  trols.get_contro
-00026a60: 6c73 2870 616e 656c 3229 3a20 632e 4469  ls(panel2): c.Di
-00026a70: 7361 626c 6528 290d 0a20 2020 2020 2020  sable()..       
-00026a80: 2069 6620 6e6f 7420 6c69 7665 2e73 6b70   if not live.skp
-00026a90: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
-00026aa0: 6564 6974 5f73 7461 7475 732e 5661 6c75  edit_status.Valu
-00026ab0: 6520 3d20 224c 6f67 696e 2075 6e61 7661  e = "Login unava
-00026ac0: 696c 6162 6c65 3a20 536b 5079 206d 6f64  ilable: SkPy mod
-00026ad0: 756c 6520 6e6f 7420 696e 7374 616c 6c65  ule not installe
-00026ae0: 6422 0d0a 2020 2020 2020 2020 2020 2020  d"..            
-00026af0: 6275 7474 6f6e 5f6c 6f67 696e 2e44 6973  button_login.Dis
-00026b00: 6162 6c65 2829 0d0a 2020 2020 2020 2020  able()..        
-00026b10: 2020 2020 7061 6765 2e44 6973 6162 6c65      page.Disable
-00026b20: 2829 0d0a 0d0a 2020 2020 2020 2020 7365  ()....        se
-00026b30: 6c66 2e42 696e 6428 7778 2e45 5654 5f42  lf.Bind(wx.EVT_B
-00026b40: 5554 544f 4e2c 2020 2020 2073 656c 662e  UTTON,     self.
-00026b50: 6f6e 5f63 6861 6e67 655f 6c69 7665 5f75  on_change_live_u
-00026b60: 7365 722c 2020 6275 7474 6f6e 5f75 7365  ser,  button_use
-00026b70: 7229 0d0a 2020 2020 2020 2020 7365 6c66  r)..        self
-00026b80: 2e42 696e 6428 7778 2e45 5654 5f54 4558  .Bind(wx.EVT_TEX
-00026b90: 542c 2020 2020 2020 2073 656c 662e 6f6e  T,       self.on
-00026ba0: 5f63 6861 6e67 655f 6374 726c 5f6c 6f67  _change_ctrl_log
-00026bb0: 696e 2c20 6564 6974 5f70 7729 0d0a 2020  in, edit_pw)..  
-00026bc0: 2020 2020 2020 7365 6c66 2e42 696e 6428        self.Bind(
-00026bd0: 7778 2e45 5654 5f54 4558 545f 454e 5445  wx.EVT_TEXT_ENTE
-00026be0: 522c 2073 656c 662e 6f6e 5f6c 6976 655f  R, self.on_live_
-00026bf0: 6c6f 6769 6e2c 2020 2020 2020 2020 6564  login,        ed
-00026c00: 6974 5f70 7729 0d0a 2020 2020 2020 2020  it_pw)..        
-00026c10: 7365 6c66 2e42 696e 6428 7778 2e45 5654  self.Bind(wx.EVT
-00026c20: 5f43 4845 434b 424f 582c 2020 2073 656c  _CHECKBOX,   sel
-00026c30: 662e 6f6e 5f63 6861 6e67 655f 6374 726c  f.on_change_ctrl
-00026c40: 5f6c 6f67 696e 2c20 6368 6563 6b5f 7374  _login, check_st
-00026c50: 6f72 6529 0d0a 2020 2020 2020 2020 7365  ore)..        se
-00026c60: 6c66 2e42 696e 6428 7778 2e45 5654 5f43  lf.Bind(wx.EVT_C
-00026c70: 4845 434b 424f 582c 2020 2073 656c 662e  HECKBOX,   self.
-00026c80: 6f6e 5f63 6861 6e67 655f 6374 726c 5f6c  on_change_ctrl_l
-00026c90: 6f67 696e 2c20 6368 6563 6b5f 6c6f 6769  ogin, check_logi
-00026ca0: 6e29 0d0a 2020 2020 2020 2020 7365 6c66  n)..        self
-00026cb0: 2e42 696e 6428 7778 2e45 5654 5f43 4845  .Bind(wx.EVT_CHE
-00026cc0: 434b 424f 582c 2020 2073 656c 662e 6f6e  CKBOX,   self.on
-00026cd0: 5f63 6861 6e67 655f 6374 726c 5f6c 6f67  _change_ctrl_log
-00026ce0: 696e 2c20 6368 6563 6b5f 7379 6e63 290d  in, check_sync).
-00026cf0: 0a20 2020 2020 2020 2073 656c 662e 4269  .        self.Bi
-00026d00: 6e64 2877 782e 4556 545f 4348 4543 4b42  nd(wx.EVT_CHECKB
-00026d10: 4f58 2c20 2020 7365 6c66 2e6f 6e5f 6368  OX,   self.on_ch
-00026d20: 616e 6765 5f63 7472 6c5f 6c6f 6769 6e2c  ange_ctrl_login,
-00026d30: 2063 6865 636b 5f63 6f6e 7461 6374 7329   check_contacts)
-00026d40: 0d0a 2020 2020 2020 2020 7365 6c66 2e42  ..        self.B
-00026d50: 696e 6428 7778 2e45 5654 5f43 4845 434b  ind(wx.EVT_CHECK
-00026d60: 424f 582c 2020 2073 656c 662e 6f6e 5f63  BOX,   self.on_c
-00026d70: 6861 6e67 655f 6374 726c 5f6c 6f67 696e  hange_ctrl_login
-00026d80: 2c20 6368 6563 6b5f 6f6c 6465 7229 0d0a  , check_older)..
-00026d90: 2020 2020 2020 2020 7365 6c66 2e42 696e          self.Bin
-00026da0: 6428 7778 2e45 5654 5f42 5554 544f 4e2c  d(wx.EVT_BUTTON,
-00026db0: 2020 2020 2073 656c 662e 6f6e 5f6c 6976       self.on_liv
-00026dc0: 655f 6c6f 6769 6e2c 2020 2020 2020 2020  e_login,        
-00026dd0: 6275 7474 6f6e 5f6c 6f67 696e 290d 0a20  button_login).. 
-00026de0: 2020 2020 2020 2073 656c 662e 4269 6e64         self.Bind
-00026df0: 2877 782e 4556 545f 4255 5454 4f4e 2c20  (wx.EVT_BUTTON, 
-00026e00: 2020 2020 7365 6c66 2e6f 6e5f 6c69 7665      self.on_live
-00026e10: 5f73 796e 632c 2020 2020 2020 2020 2062  _sync,         b
-00026e20: 7574 746f 6e5f 7379 6e63 290d 0a20 2020  utton_sync)..   
-00026e30: 2020 2020 2073 656c 662e 4269 6e64 2877       self.Bind(w
-00026e40: 782e 4556 545f 4255 5454 4f4e 2c20 2020  x.EVT_BUTTON,   
-00026e50: 2020 7365 6c66 2e6f 6e5f 6c69 7665 5f73    self.on_live_s
-00026e60: 796e 635f 7365 6c2c 2020 2020 2062 7574  ync_sel,     but
-00026e70: 746f 6e5f 7379 6e63 5f73 656c 290d 0a20  ton_sync_sel).. 
+000171e0: 225c 6e22 2e6a 6f69 6e28 7465 7874 7772  "\n".join(textwr
+000171f0: 6170 2e77 7261 7028 222c 2022 2e6a 6f69  ap.wrap(", ".joi
+00017200: 6e28 6d65 7267 696e 675f 7061 6765 7329  n(merging_pages)
+00017210: 2929 2c0d 0a20 2020 2020 2020 2020 2020  )),..           
+00017220: 2020 2020 2063 6f6e 662e 5469 746c 652c       conf.Title,
+00017230: 2077 782e 4f4b 207c 2077 782e 4341 4e43   wx.OK | wx.CANC
+00017240: 454c 207c 2077 782e 4943 4f4e 5f57 4152  EL | wx.ICON_WAR
+00017250: 4e49 4e47 290d 0a20 2020 2020 2020 2020  NING)..         
+00017260: 2020 2064 6f5f 6578 6974 203d 2028 7778     do_exit = (wx
+00017270: 2e43 414e 4345 4c20 213d 2072 6573 706f  .CANCEL != respo
+00017280: 6e73 6529 0d0a 2020 2020 2020 2020 6966  nse)..        if
+00017290: 2064 6f5f 6578 6974 3a0d 0a20 2020 2020   do_exit:..     
+000172a0: 2020 2020 2020 2066 6f72 2078 2069 6e20         for x in 
+000172b0: 7365 6c66 2e77 6f72 6b65 7273 5f69 6d70  self.workers_imp
+000172c0: 6f72 742e 7661 6c75 6573 2829 3a20 782e  ort.values(): x.
+000172d0: 7374 6f70 2864 726f 705f 7265 7375 6c74  stop(drop_result
+000172e0: 733d 4661 6c73 6529 0d0a 2020 2020 2020  s=False)..      
+000172f0: 2020 2020 2020 666f 7220 7061 6765 2069        for page i
+00017300: 6e20 7365 6c66 2e64 625f 7061 6765 733a  n self.db_pages:
+00017310: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00017320: 2020 6966 206e 6f74 2070 6167 653a 2063    if not page: c
+00017330: 6f6e 7469 6e75 6520 2320 666f 7220 7061  ontinue # for pa
+00017340: 6765 2c20 6966 2064 6561 6420 6f62 6a65  ge, if dead obje
+00017350: 6374 0d0a 2020 2020 2020 2020 2020 2020  ct..            
+00017360: 2020 2020 6163 7469 7665 5f69 6478 203d      active_idx =
+00017370: 2070 6167 652e 6e6f 7465 626f 6f6b 2e53   page.notebook.S
+00017380: 656c 6563 7469 6f6e 0d0a 2020 2020 2020  election..      
+00017390: 2020 2020 2020 2020 2020 6966 2061 6374            if act
+000173a0: 6976 655f 6964 783a 0d0a 2020 2020 2020  ive_idx:..      
+000173b0: 2020 2020 2020 2020 2020 2020 2020 636f                co
+000173c0: 6e66 2e4c 6173 7441 6374 6976 6550 6167  nf.LastActivePag
+000173d0: 655b 7061 6765 2e64 622e 6669 6c65 6e61  e[page.db.filena
+000173e0: 6d65 5d20 3d20 6163 7469 7665 5f69 6478  me] = active_idx
+000173f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00017400: 2020 656c 6966 2070 6167 652e 6462 2e66    elif page.db.f
+00017410: 696c 656e 616d 6520 696e 2063 6f6e 662e  ilename in conf.
+00017420: 4c61 7374 4163 7469 7665 5061 6765 3a0d  LastActivePage:.
+00017430: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017440: 2020 2020 2064 656c 2063 6f6e 662e 4c61       del conf.La
+00017450: 7374 4163 7469 7665 5061 6765 5b70 6167  stActivePage[pag
+00017460: 652e 6462 2e66 696c 656e 616d 655d 0d0a  e.db.filename]..
+00017470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017480: 7061 6765 2e73 6176 655f 7061 6765 5f63  page.save_page_c
+00017490: 6f6e 6628 290d 0a20 2020 2020 2020 2020  onf()..         
+000174a0: 2020 2020 2020 2070 6167 652e 776f 726b         page.work
+000174b0: 6572 5f6c 6976 652e 7374 6f70 2829 0d0a  er_live.stop()..
+000174c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000174d0: 666f 7220 776f 726b 6572 2069 6e20 7061  for worker in pa
+000174e0: 6765 2e77 6f72 6b65 7273 5f73 6561 7263  ge.workers_searc
+000174f0: 682e 7661 6c75 6573 2829 3a20 776f 726b  h.values(): work
+00017500: 6572 2e73 746f 7028 290d 0a20 2020 2020  er.stop()..     
+00017510: 2020 2020 2020 2020 2020 2070 6167 652e             page.
+00017520: 6462 2e63 6c6f 7365 2829 0d0a 2020 2020  db.close()..    
+00017530: 2020 2020 2020 2020 666f 7220 7061 6765          for page
+00017540: 2069 6e20 7365 6c66 2e6d 6572 6765 725f   in self.merger_
+00017550: 7061 6765 733a 0d0a 2020 2020 2020 2020  pages:..        
+00017560: 2020 2020 2020 2020 7061 6765 2e77 6f72          page.wor
+00017570: 6b65 725f 6d65 7267 652e 7374 6f70 2829  ker_merge.stop()
+00017580: 2c20 7061 6765 2e77 6f72 6b65 725f 696d  , page.worker_im
+00017590: 706f 7274 2e73 746f 7028 290d 0a20 2020  port.stop()..   
+000175a0: 2020 2020 2020 2020 2020 2020 2070 6167               pag
+000175b0: 652e 6462 312e 636c 6f73 6528 292c 2070  e.db1.close(), p
+000175c0: 6167 652e 6462 322e 636c 6f73 6528 290d  age.db2.close().
+000175d0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+000175e0: 662e 776f 726b 6572 5f64 6574 6563 7469  f.worker_detecti
+000175f0: 6f6e 2e73 746f 7028 290d 0a0d 0a20 2020  on.stop()....   
+00017600: 2020 2020 2020 2020 2023 2053 6176 6520           # Save 
+00017610: 6c61 7374 2073 656c 6563 7465 6420 6669  last selected fi
+00017620: 6c65 7320 696e 2064 6220 6c69 7374 732c  les in db lists,
+00017630: 2074 6f20 7265 7365 6c65 6374 2074 6865   to reselect the
+00017640: 6d20 6f6e 2072 6572 756e 0d0a 2020 2020  m on rerun..    
+00017650: 2020 2020 2020 2020 6465 6c20 636f 6e66          del conf
+00017660: 2e4c 6173 7453 656c 6563 7465 6446 696c  .LastSelectedFil
+00017670: 6573 5b3a 5d0d 0a20 2020 2020 2020 2020  es[:]..         
+00017680: 2020 2073 656c 6563 7465 6420 3d20 7365     selected = se
+00017690: 6c66 2e6c 6973 745f 6462 2e47 6574 4669  lf.list_db.GetFi
+000176a0: 7273 7453 656c 6563 7465 6428 290d 0a20  rstSelected().. 
+000176b0: 2020 2020 2020 2020 2020 2077 6869 6c65             while
+000176c0: 2073 656c 6563 7465 6420 3e20 303a 0d0a   selected > 0:..
+000176d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000176e0: 6669 6c65 6e61 6d65 203d 2073 656c 662e  filename = self.
+000176f0: 6c69 7374 5f64 622e 4765 7449 7465 6d54  list_db.GetItemT
+00017700: 6578 7428 7365 6c65 6374 6564 290d 0a20  ext(selected).. 
+00017710: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00017720: 6f6e 662e 4c61 7374 5365 6c65 6374 6564  onf.LastSelected
+00017730: 4669 6c65 732e 6170 7065 6e64 2866 696c  Files.append(fil
+00017740: 656e 616d 6529 0d0a 2020 2020 2020 2020  ename)..        
+00017750: 2020 2020 2020 2020 7365 6c65 6374 6564          selected
+00017760: 203d 2073 656c 662e 6c69 7374 5f64 622e   = self.list_db.
+00017770: 4765 744e 6578 7453 656c 6563 7465 6428  GetNextSelected(
+00017780: 7365 6c65 6374 6564 290d 0a20 2020 2020  selected)..     
+00017790: 2020 2020 2020 2069 6620 6e6f 7420 636f         if not co
+000177a0: 6e66 2e57 696e 646f 7749 636f 6e69 7a65  nf.WindowIconize
+000177b0: 643a 0d0a 2020 2020 2020 2020 2020 2020  d:..            
+000177c0: 2020 2020 636f 6e66 2e57 696e 646f 7750      conf.WindowP
+000177d0: 6f73 6974 696f 6e20 3d20 7365 6c66 2e50  osition = self.P
+000177e0: 6f73 6974 696f 6e5b 3a5d 0d0a 2020 2020  osition[:]..    
+000177f0: 2020 2020 2020 2020 636f 6e66 2e57 696e          conf.Win
+00017800: 646f 7753 697a 6520 3d20 5b2d 312c 202d  dowSize = [-1, -
+00017810: 315d 2069 6620 7365 6c66 2e49 734d 6178  1] if self.IsMax
+00017820: 696d 697a 6564 2829 2065 6c73 6520 7365  imized() else se
+00017830: 6c66 2e53 697a 655b 3a5d 0d0a 2020 2020  lf.Size[:]..    
+00017840: 2020 2020 2020 2020 636f 6e66 2e73 6176          conf.sav
+00017850: 6528 290d 0a20 2020 2020 2020 2020 2020  e()..           
+00017860: 2074 7279 3a20 7365 6c66 2e74 7261 7969   try: self.trayi
+00017870: 636f 6e2e 4465 7374 726f 7928 290d 0a20  con.Destroy().. 
+00017880: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+00017890: 7420 4578 6365 7074 696f 6e3a 2070 6173  t Exception: pas
+000178a0: 730d 0a20 2020 2020 2020 2020 2020 2066  s..            f
+000178b0: 6f72 2078 2069 6e20 7365 6c66 2e77 6f72  or x in self.wor
+000178c0: 6b65 7273 5f69 6d70 6f72 742e 7661 6c75  kers_import.valu
+000178d0: 6573 2829 3a20 782e 6a6f 696e 2829 0d0a  es(): x.join()..
+000178e0: 2020 2020 2020 2020 2020 2020 7379 732e              sys.
+000178f0: 6578 6974 2829 0d0a 0d0a 0d0a 2020 2020  exit()......    
+00017900: 6465 6620 6f6e 5f63 6c6f 7365 5f70 6167  def on_close_pag
+00017910: 6528 7365 6c66 2c20 6576 656e 7429 3a0d  e(self, event):.
+00017920: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
+00017930: 2020 2020 2020 4861 6e64 6c65 7220 666f        Handler fo
+00017940: 7220 636c 6f73 696e 6720 6120 7061 6765  r closing a page
+00017950: 2c20 6173 6b73 2074 6865 2075 7365 7220  , asks the user 
+00017960: 6162 6f75 7420 7361 7669 6e67 2075 6e73  about saving uns
+00017970: 6176 6564 2064 6174 612c 0d0a 2020 2020  aved data,..    
+00017980: 2020 2020 6966 2061 6e79 2c20 7265 6d6f      if any, remo
+00017990: 7665 7320 7061 6765 2066 726f 6d20 6d61  ves page from ma
+000179a0: 696e 206e 6f74 6562 6f6f 6b20 616e 6420  in notebook and 
+000179b0: 7570 6461 7465 7320 6163 6365 6c65 7261  updates accelera
+000179c0: 746f 7273 2e0d 0a20 2020 2020 2020 2022  tors...        "
+000179d0: 2222 0d0a 2020 2020 2020 2020 6966 2065  ""..        if e
+000179e0: 7665 6e74 2e45 7665 6e74 4f62 6a65 6374  vent.EventObject
+000179f0: 203d 3d20 7365 6c66 2e6e 6f74 6562 6f6f   == self.noteboo
+00017a00: 6b3a 0d0a 2020 2020 2020 2020 2020 2020  k:..            
+00017a10: 7061 6765 203d 2073 656c 662e 6e6f 7465  page = self.note
+00017a20: 626f 6f6b 2e47 6574 5061 6765 2865 7665  book.GetPage(eve
+00017a30: 6e74 2e47 6574 5365 6c65 6374 696f 6e28  nt.GetSelection(
+00017a40: 2929 0d0a 2020 2020 2020 2020 656c 7365  ))..        else
+00017a50: 3a0d 0a20 2020 2020 2020 2020 2020 2070  :..            p
+00017a60: 6167 6520 3d20 6576 656e 742e 4576 656e  age = event.Even
+00017a70: 744f 626a 6563 740d 0a20 2020 2020 2020  tObject..       
+00017a80: 2020 2020 2070 6167 652e 5368 6f77 2846       page.Show(F
+00017a90: 616c 7365 290d 0a20 2020 2020 2020 2069  alse)..        i
+00017aa0: 6620 7365 6c66 2e70 6167 655f 6c6f 6720  f self.page_log 
+00017ab0: 3d3d 2070 6167 653a 0d0a 2020 2020 2020  == page:..      
+00017ac0: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
+00017ad0: 662e 7061 6765 5f6c 6f67 2e69 735f 6869  f.page_log.is_hi
+00017ae0: 6464 656e 3a0d 0a20 2020 2020 2020 2020  dden:..         
+00017af0: 2020 2020 2020 2065 7665 6e74 2e56 6574         event.Vet
+00017b00: 6f28 2920 2320 5665 746f 2064 656c 6574  o() # Veto delet
+00017b10: 6520 6576 656e 740d 0a20 2020 2020 2020  e event..       
+00017b20: 2020 2020 2020 2020 2073 656c 662e 6f6e           self.on
+00017b30: 5f73 686f 7768 6964 655f 6c6f 6728 4e6f  _showhide_log(No
+00017b40: 6e65 2920 2320 4669 7265 2072 656d 6f76  ne) # Fire remov
+00017b50: 6520 6576 656e 740d 0a20 2020 2020 2020  e event..       
+00017b60: 2020 2020 2073 656c 662e 7061 6765 735f       self.pages_
+00017b70: 7669 7369 7465 6420 3d20 5b78 2066 6f72  visited = [x for
+00017b80: 2078 2069 6e20 7365 6c66 2e70 6167 6573   x in self.pages
+00017b90: 5f76 6973 6974 6564 2069 6620 7820 213d  _visited if x !=
+00017ba0: 2070 6167 655d 0d0a 2020 2020 2020 2020   page]..        
+00017bb0: 2020 2020 7365 6c66 2e70 6167 655f 6c6f      self.page_lo
+00017bc0: 672e 5368 6f77 2846 616c 7365 290d 0a20  g.Show(False).. 
+00017bd0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00017be0: 6e0d 0a20 2020 2020 2020 2065 6c69 6620  n..        elif 
+00017bf0: 286e 6f74 2069 7369 6e73 7461 6e63 6528  (not isinstance(
+00017c00: 7061 6765 2c20 2844 6174 6162 6173 6550  page, (DatabaseP
+00017c10: 6167 652c 204d 6572 6765 7250 6167 6529  age, MergerPage)
+00017c20: 290d 0a20 2020 2020 2020 206f 7220 6e6f  )..        or no
+00017c30: 7420 7061 6765 2e72 6561 6479 5f74 6f5f  t page.ready_to_
+00017c40: 636c 6f73 6529 3a0d 0a20 2020 2020 2020  close):..       
+00017c50: 2020 2020 2072 6574 7572 6e20 6576 656e       return even
+00017c60: 742e 5665 746f 2829 0d0a 0d0a 2020 2020  t.Veto()....    
+00017c70: 2020 2020 2320 5265 6d6f 7665 2070 6167      # Remove pag
+00017c80: 6520 6672 6f6d 204d 6169 6e57 696e 646f  e from MainWindo
+00017c90: 7720 6461 7461 2073 7472 7563 7475 7265  w data structure
+00017ca0: 730d 0a20 2020 2020 2020 2069 6620 6973  s..        if is
+00017cb0: 696e 7374 616e 6365 2870 6167 652c 2044  instance(page, D
+00017cc0: 6174 6162 6173 6550 6167 6529 3a0d 0a20  atabasePage):.. 
+00017cd0: 2020 2020 2020 2020 2020 2064 6f5f 636c             do_cl
+00017ce0: 6f73 6520 3d20 5472 7565 0d0a 0d0a 2020  ose = True....  
+00017cf0: 2020 2020 2020 2020 2020 6966 2070 6167            if pag
+00017d00: 652e 6462 2e6c 6976 652e 6973 5f6c 6f67  e.db.live.is_log
+00017d10: 6765 645f 696e 2829 2061 6e64 2070 6167  ged_in() and pag
+00017d20: 652e 776f 726b 6572 5f6c 6976 652e 6973  e.worker_live.is
+00017d30: 5f77 6f72 6b69 6e67 2829 3a0d 0a20 2020  _working():..   
+00017d40: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00017d50: 7778 2e4f 4b20 213d 2077 782e 4d65 7373  wx.OK != wx.Mess
+00017d60: 6167 6542 6f78 280d 0a20 2020 2020 2020  ageBox(..       
+00017d70: 2020 2020 2020 2020 2020 2020 2022 4c69               "Li
+00017d80: 7665 2073 796e 6369 6e67 2069 7320 6375  ve syncing is cu
+00017d90: 7272 656e 746c 7920 696e 2070 726f 6772  rrently in progr
+00017da0: 6573 732e 5c6e 5c6e 436c 6f73 6520 616e  ess.\n\nClose an
+00017db0: 7977 6179 3f22 2c0d 0a20 2020 2020 2020  yway?",..       
+00017dc0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+00017dd0: 662e 5469 746c 652c 2077 782e 4f4b 207c  f.Title, wx.OK |
+00017de0: 2077 782e 4341 4e43 454c 207c 2077 782e   wx.CANCEL | wx.
+00017df0: 4943 4f4e 5f57 4152 4e49 4e47 0d0a 2020  ICON_WARNING..  
+00017e00: 2020 2020 2020 2020 2020 2020 2020 293a                ):
+00017e10: 2064 6f5f 636c 6f73 6520 3d20 4661 6c73   do_close = Fals
+00017e20: 650d 0a0d 0a20 2020 2020 2020 2020 2020  e....           
+00017e30: 2075 6e73 6176 6564 203d 2070 6167 652e   unsaved = page.
+00017e40: 6765 745f 756e 7361 7665 645f 6772 6964  get_unsaved_grid
+00017e50: 7328 2920 6966 2064 6f5f 636c 6f73 6520  s() if do_close 
+00017e60: 656c 7365 205b 5d0d 0a20 2020 2020 2020  else []..       
+00017e70: 2020 2020 2069 6620 756e 7361 7665 643a       if unsaved:
+00017e80: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00017e90: 2020 7265 7370 6f6e 7365 203d 2077 782e    response = wx.
+00017ea0: 4d65 7373 6167 6542 6f78 280d 0a20 2020  MessageBox(..   
+00017eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017ec0: 2022 536f 6d65 2074 6162 6c65 7320 696e   "Some tables in
+00017ed0: 2025 7320 6861 7665 2075 6e73 6176 6564   %s have unsaved
+00017ee0: 2064 6174 6120 2825 7329 2e5c 6e5c 6e22   data (%s).\n\n"
+00017ef0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00017f00: 2020 2020 2020 2253 6176 6520 6368 616e        "Save chan
+00017f10: 6765 7320 6265 666f 7265 2063 6c6f 7369  ges before closi
+00017f20: 6e67 3f22 2025 2028 0d0a 2020 2020 2020  ng?" % (..      
+00017f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017f40: 2020 7061 6765 2e64 622c 2022 2c20 222e    page.db, ", ".
+00017f50: 6a6f 696e 2873 6f72 7465 6428 782e 7461  join(sorted(x.ta
+00017f60: 626c 6520 666f 7220 7820 696e 2075 6e73  ble for x in uns
+00017f70: 6176 6564 2929 0d0a 2020 2020 2020 2020  aved))..        
+00017f80: 2020 2020 2020 2020 2020 2020 292c 2063              ), c
+00017f90: 6f6e 662e 5469 746c 652c 0d0a 2020 2020  onf.Title,..    
+00017fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017fb0: 7778 2e59 4553 207c 2077 782e 4e4f 207c  wx.YES | wx.NO |
+00017fc0: 2077 782e 4341 4e43 454c 207c 2077 782e   wx.CANCEL | wx.
+00017fd0: 4943 4f4e 5f49 4e46 4f52 4d41 5449 4f4e  ICON_INFORMATION
+00017fe0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00017ff0: 2020 290d 0a20 2020 2020 2020 2020 2020    )..           
+00018000: 2020 2020 2069 6620 7778 2e59 4553 203d       if wx.YES =
+00018010: 3d20 7265 7370 6f6e 7365 3a0d 0a20 2020  = response:..   
+00018020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018030: 2064 6f5f 636c 6f73 6520 3d20 7061 6765   do_close = page
+00018040: 2e73 6176 655f 756e 7361 7665 645f 6772  .save_unsaved_gr
+00018050: 6964 7328 290d 0a20 2020 2020 2020 2020  ids()..         
+00018060: 2020 2020 2020 2065 6c69 6620 7778 2e43         elif wx.C
+00018070: 414e 4345 4c20 3d3d 2072 6573 706f 6e73  ANCEL == respons
+00018080: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00018090: 2020 2020 2020 2020 646f 5f63 6c6f 7365          do_close
+000180a0: 203d 2046 616c 7365 0d0a 2020 2020 2020   = False..      
+000180b0: 2020 2020 2020 6966 206e 6f74 2064 6f5f        if not do_
+000180c0: 636c 6f73 653a 0d0a 2020 2020 2020 2020  close:..        
+000180d0: 2020 2020 2020 2020 7265 7475 726e 2065          return e
+000180e0: 7665 6e74 2e56 6574 6f28 290d 0a0d 0a20  vent.Veto().... 
+000180f0: 2020 2020 2020 2020 2020 2069 6620 7061             if pa
+00018100: 6765 2e6e 6f74 6562 6f6f 6b2e 5365 6c65  ge.notebook.Sele
+00018110: 6374 696f 6e3a 0d0a 2020 2020 2020 2020  ction:..        
+00018120: 2020 2020 2020 2020 636f 6e66 2e4c 6173          conf.Las
+00018130: 7441 6374 6976 6550 6167 655b 7061 6765  tActivePage[page
+00018140: 2e64 622e 6669 6c65 6e61 6d65 5d20 3d20  .db.filename] = 
+00018150: 7061 6765 2e6e 6f74 6562 6f6f 6b2e 5365  page.notebook.Se
+00018160: 6c65 6374 696f 6e0d 0a20 2020 2020 2020  lection..       
+00018170: 2020 2020 2065 6c69 6620 7061 6765 2e64       elif page.d
+00018180: 622e 6669 6c65 6e61 6d65 2069 6e20 636f  b.filename in co
+00018190: 6e66 2e4c 6173 7441 6374 6976 6550 6167  nf.LastActivePag
+000181a0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+000181b0: 2020 2020 6465 6c20 636f 6e66 2e4c 6173      del conf.Las
+000181c0: 7441 6374 6976 6550 6167 655b 7061 6765  tActivePage[page
+000181d0: 2e64 622e 6669 6c65 6e61 6d65 5d0d 0a0d  .db.filename]...
+000181e0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+000181f0: 2077 6f72 6b65 7220 696e 2070 6167 652e   worker in page.
+00018200: 776f 726b 6572 735f 7365 6172 6368 2e76  workers_search.v
+00018210: 616c 7565 7328 293a 2077 6f72 6b65 722e  alues(): worker.
+00018220: 7374 6f70 2829 0d0a 2020 2020 2020 2020  stop()..        
+00018230: 2020 2020 7061 6765 2e77 6f72 6b65 725f      page.worker_
+00018240: 6c69 7665 2e73 746f 7028 290d 0a20 2020  live.stop()..   
+00018250: 2020 2020 2020 2020 2070 6167 652e 7361           page.sa
+00018260: 7665 5f70 6167 655f 636f 6e66 2829 0d0a  ve_page_conf()..
+00018270: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00018280: 2070 6167 6520 696e 2073 656c 662e 6462   page in self.db
+00018290: 5f70 6167 6573 3a0d 0a20 2020 2020 2020  _pages:..       
+000182a0: 2020 2020 2020 2020 2064 656c 2073 656c           del sel
+000182b0: 662e 6462 5f70 6167 6573 5b70 6167 655d  f.db_pages[page]
+000182c0: 0d0a 2020 2020 2020 2020 2020 2020 7061  ..            pa
+000182d0: 6765 5f64 6273 203d 205b 7061 6765 2e64  ge_dbs = [page.d
+000182e0: 625d 0d0a 2020 2020 2020 2020 2020 2020  b]..            
+000182f0: 6775 6962 6173 652e 7374 6174 7573 2822  guibase.status("
+00018300: 436c 6f73 6564 2064 6174 6162 6173 6520  Closed database 
+00018310: 7461 6220 666f 7220 2573 2e22 2c20 7061  tab for %s.", pa
+00018320: 6765 2e64 622c 206c 6f67 3d54 7275 6529  ge.db, log=True)
+00018330: 0d0a 2020 2020 2020 2020 2020 2020 7574  ..            ut
+00018340: 696c 2e72 756e 5f6f 6e63 6528 636f 6e66  il.run_once(conf
+00018350: 2e73 6176 6529 0d0a 2020 2020 2020 2020  .save)..        
+00018360: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+00018370: 2020 2069 6620 7061 6765 2e69 735f 6d65     if page.is_me
+00018380: 7267 696e 673a 0d0a 2020 2020 2020 2020  rging:..        
+00018390: 2020 2020 2020 2020 7265 7370 6f6e 7365          response
+000183a0: 203d 2077 782e 4d65 7373 6167 6542 6f78   = wx.MessageBox
+000183b0: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+000183c0: 2020 2020 2020 2022 4d65 7267 696e 6720         "Merging 
+000183d0: 6973 2063 7572 7265 6e74 6c79 2069 6e20  is currently in 
+000183e0: 7072 6f67 7265 7373 2069 6e20 2573 2e5c  progress in %s.\
+000183f0: 6e5c 6e43 6c6f 7365 2061 6e79 7761 793f  n\nClose anyway?
+00018400: 2022 0d0a 2020 2020 2020 2020 2020 2020   "..            
+00018410: 2020 2020 2020 2020 2254 6869 7320 6361          "This ca
+00018420: 6e20 7265 7375 6c74 2069 6e20 636f 7272  n result in corr
+00018430: 7570 7420 6461 7461 2e22 2025 2070 6167  upt data." % pag
+00018440: 652e 7469 746c 652c 0d0a 2020 2020 2020  e.title,..      
+00018450: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00018460: 6e66 2e54 6974 6c65 2c20 7778 2e4f 4b20  nf.Title, wx.OK 
+00018470: 7c20 7778 2e43 414e 4345 4c20 7c20 7778  | wx.CANCEL | wx
+00018480: 2e49 434f 4e5f 5741 524e 494e 4729 0d0a  .ICON_WARNING)..
+00018490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000184a0: 6966 2077 782e 4341 4e43 454c 203d 3d20  if wx.CANCEL == 
+000184b0: 7265 7370 6f6e 7365 3a0d 0a20 2020 2020  response:..     
+000184c0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+000184d0: 6574 7572 6e20 6576 656e 742e 5665 746f  eturn event.Veto
+000184e0: 2829 0d0a 0d0a 2020 2020 2020 2020 2020  ()....          
+000184f0: 2020 7061 6765 2e77 6f72 6b65 725f 6d65    page.worker_me
+00018500: 7267 652e 7374 6f70 2829 0d0a 2020 2020  rge.stop()..    
+00018510: 2020 2020 2020 2020 7061 6765 2e77 6f72          page.wor
+00018520: 6b65 725f 696d 706f 7274 2e73 746f 7028  ker_import.stop(
+00018530: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
+00018540: 6620 7061 6765 2e77 6f72 6b65 725f 6d65  f page.worker_me
+00018550: 7267 652e 6973 5f61 6c69 7665 2829 3a20  rge.is_alive(): 
+00018560: 7061 6765 2e77 6f72 6b65 725f 6d65 7267  page.worker_merg
+00018570: 652e 6a6f 696e 2829 0d0a 2020 2020 2020  e.join()..      
+00018580: 2020 2020 2020 6966 2070 6167 652e 776f        if page.wo
+00018590: 726b 6572 5f69 6d70 6f72 742e 6973 5f61  rker_import.is_a
+000185a0: 6c69 7665 2829 3a20 7061 6765 2e77 6f72  live(): page.wor
+000185b0: 6b65 725f 696d 706f 7274 2e6a 6f69 6e28  ker_import.join(
+000185c0: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
+000185d0: 6620 7061 6765 2069 6e20 7365 6c66 2e6d  f page in self.m
+000185e0: 6572 6765 725f 7061 6765 733a 0d0a 2020  erger_pages:..  
+000185f0: 2020 2020 2020 2020 2020 2020 2020 6465                de
+00018600: 6c20 7365 6c66 2e6d 6572 6765 725f 7061  l self.merger_pa
+00018610: 6765 735b 7061 6765 5d0d 0a20 2020 2020  ges[page]..     
+00018620: 2020 2020 2020 2070 6167 655f 6462 7320         page_dbs 
+00018630: 3d20 5b70 6167 652e 6462 312c 2070 6167  = [page.db1, pag
+00018640: 652e 6462 325d 0d0a 2020 2020 2020 2020  e.db2]..        
+00018650: 2020 2020 6775 6962 6173 652e 7374 6174      guibase.stat
+00018660: 7573 2822 436c 6f73 6564 2063 6f6d 7061  us("Closed compa
+00018670: 7269 736f 6e20 7461 6220 666f 7220 2573  rison tab for %s
+00018680: 2061 6e64 2025 732e 222c 0d0a 2020 2020   and %s.",..    
+00018690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000186a0: 2020 2020 2020 2070 6167 652e 6462 312c         page.db1,
+000186b0: 2070 6167 652e 6462 322c 206c 6f67 3d54   page.db2, log=T
+000186c0: 7275 6529 0d0a 0d0a 2020 2020 2020 2020  rue)....        
+000186d0: 2320 436c 6f73 6520 6461 7461 6261 7365  # Close database
+000186e0: 732c 2069 6620 6e6f 7420 7573 6564 2069  s, if not used i
+000186f0: 6e20 616e 7920 6f74 6865 7220 7061 6765  n any other page
+00018700: 0d0a 2020 2020 2020 2020 666f 7220 6462  ..        for db
+00018710: 2069 6e20 7061 6765 5f64 6273 3a0d 0a20   in page_dbs:.. 
+00018720: 2020 2020 2020 2020 2020 2064 622e 756e             db.un
+00018730: 7265 6769 7374 6572 5f63 6f6e 7375 6d65  register_consume
+00018740: 7228 7061 6765 290d 0a20 2020 2020 2020  r(page)..       
+00018750: 2020 2020 2069 6620 6e6f 7420 6462 2e68       if not db.h
+00018760: 6173 5f63 6f6e 7375 6d65 7273 2829 3a0d  as_consumers():.
+00018770: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018780: 2073 656c 662e 6462 732e 706f 7028 6462   self.dbs.pop(db
+00018790: 2e66 696c 656e 616d 652c 204e 6f6e 6529  .filename, None)
+000187a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000187b0: 2020 6462 2e63 6c6f 7365 2829 0d0a 2020    db.close()..  
+000187c0: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
+000187d0: 6767 6572 2e69 6e66 6f28 2243 6c6f 7365  gger.info("Close
+000187e0: 6420 6461 7461 6261 7365 2025 732e 222c  d database %s.",
+000187f0: 2064 622e 6669 6c65 6e61 6d65 290d 0a20   db.filename).. 
+00018800: 2020 2020 2020 2023 2052 656d 6f76 6520         # Remove 
+00018810: 616e 7920 6461 6e67 6c69 6e67 2072 6566  any dangling ref
+00018820: 6572 656e 6365 730d 0a20 2020 2020 2020  erences..       
+00018830: 2069 6620 7365 6c66 2e70 6167 655f 6d65   if self.page_me
+00018840: 7267 655f 6c61 7465 7374 203d 3d20 7061  rge_latest == pa
+00018850: 6765 3a0d 0a20 2020 2020 2020 2020 2020  ge:..           
+00018860: 2073 656c 662e 7061 6765 5f6d 6572 6765   self.page_merge
+00018870: 5f6c 6174 6573 7420 3d20 4e6f 6e65 0d0a  _latest = None..
+00018880: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00018890: 7061 6765 5f64 625f 6c61 7465 7374 203d  page_db_latest =
+000188a0: 3d20 7061 6765 3a0d 0a20 2020 2020 2020  = page:..       
+000188b0: 2020 2020 2073 656c 662e 7061 6765 5f64       self.page_d
+000188c0: 625f 6c61 7465 7374 203d 206e 6578 7428  b_latest = next(
+000188d0: 2869 2066 6f72 2069 2069 6e20 7365 6c66  (i for i in self
+000188e0: 2e70 6167 6573 5f76 6973 6974 6564 5b3a  .pages_visited[:
+000188f0: 3a2d 315d 0d0a 2020 2020 2020 2020 2020  :-1]..          
+00018900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018910: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00018920: 2069 7369 6e73 7461 6e63 6528 692c 2044   isinstance(i, D
+00018930: 6174 6162 6173 6550 6167 6529 292c 204e  atabasePage)), N
+00018940: 6f6e 6529 0d0a 2020 2020 2020 2020 7365  one)..        se
+00018950: 6c66 2e53 656e 6453 697a 6545 7665 6e74  lf.SendSizeEvent
+00018960: 2829 2023 204d 756c 7469 6c69 6e65 2077  () # Multiline w
+00018970: 782e 4e6f 7465 626f 6f6b 7320 6e65 6564  x.Notebooks need
+00018980: 2072 6564 7261 7769 6e67 0d0a 2020 2020   redrawing..    
+00018990: 2020 2020 7365 6c66 2e55 7064 6174 6541      self.UpdateA
+000189a0: 6363 656c 6572 6174 6f72 7328 2920 2320  ccelerators() # 
+000189b0: 5265 6d6f 7665 2070 6167 6520 6163 6365  Remove page acce
+000189c0: 6c65 7261 746f 7273 0d0a 0d0a 2020 2020  lerators....    
+000189d0: 2020 2020 2320 5265 6d6f 7665 2070 6167      # Remove pag
+000189e0: 6520 6672 6f6d 2076 6973 6974 6564 2070  e from visited p
+000189f0: 6167 6573 206f 7264 6572 0d0a 2020 2020  ages order..    
+00018a00: 2020 2020 7365 6c66 2e70 6167 6573 5f76      self.pages_v
+00018a10: 6973 6974 6564 203d 205b 7820 666f 7220  isited = [x for 
+00018a20: 7820 696e 2073 656c 662e 7061 6765 735f  x in self.pages_
+00018a30: 7669 7369 7465 6420 6966 2078 2021 3d20  visited if x != 
+00018a40: 7061 6765 5d0d 0a20 2020 2020 2020 2069  page]..        i
+00018a50: 6e64 6578 5f6e 6577 203d 2030 0d0a 2020  ndex_new = 0..  
+00018a60: 2020 2020 2020 6966 2073 656c 662e 7061        if self.pa
+00018a70: 6765 735f 7669 7369 7465 643a 0d0a 2020  ges_visited:..  
+00018a80: 2020 2020 2020 2020 2020 666f 7220 6920            for i 
+00018a90: 696e 2072 616e 6765 2873 656c 662e 6e6f  in range(self.no
+00018aa0: 7465 626f 6f6b 2e47 6574 5061 6765 436f  tebook.GetPageCo
+00018ab0: 756e 7428 2929 3a0d 0a20 2020 2020 2020  unt()):..       
+00018ac0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+00018ad0: 2e6e 6f74 6562 6f6f 6b2e 4765 7450 6167  .notebook.GetPag
+00018ae0: 6528 6929 203d 3d20 7365 6c66 2e70 6167  e(i) == self.pag
+00018af0: 6573 5f76 6973 6974 6564 5b2d 315d 3a0d  es_visited[-1]:.
+00018b00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018b10: 2020 2020 2069 6e64 6578 5f6e 6577 203d       index_new =
+00018b20: 2069 0d0a 2020 2020 2020 2020 2020 2020   i..            
+00018b30: 2020 2020 2020 2020 6272 6561 6b0d 0a20          break.. 
+00018b40: 2020 2020 2020 2073 656c 662e 6e6f 7465         self.note
+00018b50: 626f 6f6b 2e53 6574 5365 6c65 6374 696f  book.SetSelectio
+00018b60: 6e28 696e 6465 785f 6e65 7729 0d0a 0d0a  n(index_new)....
+00018b70: 0d0a 2020 2020 6465 6620 6f6e 5f63 6c65  ..    def on_cle
+00018b80: 6172 5f73 6561 7263 6861 6c6c 2873 656c  ar_searchall(sel
+00018b90: 662c 2065 7665 6e74 293a 0d0a 2020 2020  f, event):..    
+00018ba0: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
+00018bb0: 2048 616e 646c 6572 2066 6f72 2063 6c69   Handler for cli
+00018bc0: 636b 696e 6720 746f 2063 6c65 6172 2073  cking to clear s
+00018bd0: 6561 7263 6820 6869 7374 6f72 7920 696e  earch history in
+00018be0: 2061 2064 6174 6162 6173 6520 7061 6765   a database page
+00018bf0: 2c0d 0a20 2020 2020 2020 2063 6f6e 6669  ,..        confi
+00018c00: 726d 7320 6163 7469 6f6e 2061 6e64 2063  rms action and c
+00018c10: 6c65 6172 7320 6869 7374 6f72 7920 676c  lears history gl
+00018c20: 6f62 616c 6c79 2e0d 0a20 2020 2020 2020  obally...       
+00018c30: 2022 2222 0d0a 2020 2020 2020 2020 6368   """..        ch
+00018c40: 6f69 6365 203d 2077 782e 4d65 7373 6167  oice = wx.Messag
+00018c50: 6542 6f78 2822 436c 6561 7220 7365 6172  eBox("Clear sear
+00018c60: 6368 2068 6973 746f 7279 3f22 2c20 636f  ch history?", co
+00018c70: 6e66 2e54 6974 6c65 2c0d 0a20 2020 2020  nf.Title,..     
+00018c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018c90: 2020 2020 2020 2020 2020 7778 2e4f 4b20            wx.OK 
+00018ca0: 7c20 7778 2e43 414e 4345 4c20 7c20 7778  | wx.CANCEL | wx
+00018cb0: 2e49 434f 4e5f 5741 524e 494e 4729 0d0a  .ICON_WARNING)..
+00018cc0: 2020 2020 2020 2020 6966 2077 782e 4f4b          if wx.OK
+00018cd0: 203d 3d20 6368 6f69 6365 3a0d 0a20 2020   == choice:..   
+00018ce0: 2020 2020 2020 2020 2063 6f6e 662e 5365           conf.Se
+00018cf0: 6172 6368 4869 7374 6f72 7920 3d20 5b5d  archHistory = []
+00018d00: 0d0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
+00018d10: 7220 7061 6765 2069 6e20 7365 6c66 2e64  r page in self.d
+00018d20: 625f 7061 6765 733a 0d0a 2020 2020 2020  b_pages:..      
+00018d30: 2020 2020 2020 2020 2020 7061 6765 2e65            page.e
+00018d40: 6469 745f 7365 6172 6368 616c 6c2e 5365  dit_searchall.Se
+00018d50: 7443 686f 6963 6573 2863 6f6e 662e 5365  tChoices(conf.Se
+00018d60: 6172 6368 4869 7374 6f72 7929 0d0a 2020  archHistory)..  
+00018d70: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+00018d80: 6765 2e65 6469 745f 7365 6172 6368 616c  ge.edit_searchal
+00018d90: 6c2e 5368 6f77 4472 6f70 446f 776e 2846  l.ShowDropDown(F
+00018da0: 616c 7365 290d 0a20 2020 2020 2020 2020  alse)..         
+00018db0: 2020 2073 656c 662e 6469 616c 6f67 5f73     self.dialog_s
+00018dc0: 6561 7263 682e 5365 7443 686f 6963 6573  earch.SetChoices
+00018dd0: 2863 6f6e 662e 5365 6172 6368 4869 7374  (conf.SearchHist
+00018de0: 6f72 7929 0d0a 2020 2020 2020 2020 2020  ory)..          
+00018df0: 2020 7574 696c 2e72 756e 5f6f 6e63 6528    util.run_once(
+00018e00: 636f 6e66 2e73 6176 6529 0d0a 0d0a 0d0a  conf.save)......
+00018e10: 2020 2020 6465 6620 6765 745f 756e 6971      def get_uniq
+00018e20: 7565 5f74 6162 5f74 6974 6c65 2873 656c  ue_tab_title(sel
+00018e30: 662c 2074 6974 6c65 293a 0d0a 2020 2020  f, title):..    
+00018e40: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
+00018e50: 2052 6574 7572 6e73 2061 2074 6974 6c65   Returns a title
+00018e60: 2074 6861 7420 6973 2075 6e69 7175 6520   that is unique 
+00018e70: 666f 7220 7468 6520 6375 7272 656e 7420  for the current 
+00018e80: 6e6f 7465 626f 6f6b 202d 2069 6620 7468  notebook - if th
+00018e90: 650d 0a20 2020 2020 2020 2073 7065 6369  e..        speci
+00018ea0: 6669 6564 2074 6974 6c65 2061 6c72 6561  fied title alrea
+00018eb0: 6479 2065 7869 7374 732c 2061 7070 656e  dy exists, appen
+00018ec0: 6473 2061 2063 6f75 6e74 6572 2074 6f20  ds a counter to 
+00018ed0: 7468 6520 656e 642c 0d0a 2020 2020 2020  the end,..      
+00018ee0: 2020 652e 672e 2022 4461 7461 6261 7365    e.g. "Database
+00018ef0: 2063 6f6d 7061 7269 736f 6e20 2831 2922   comparison (1)"
+00018f00: 2e20 5469 746c 6520 6973 2073 686f 7274  . Title is short
+00018f10: 656e 6564 2066 726f 6d20 7468 6520 6c65  ened from the le
+00018f20: 6674 0d0a 2020 2020 2020 2020 6966 206c  ft..        if l
+00018f30: 6f6e 6765 7220 7468 616e 2061 6c6c 6f77  onger than allow
+00018f40: 6564 2e0d 0a20 2020 2020 2020 2022 2222  ed...        """
+00018f50: 0d0a 2020 2020 2020 2020 6966 206c 656e  ..        if len
+00018f60: 2874 6974 6c65 2920 3e20 636f 6e66 2e4d  (title) > conf.M
+00018f70: 6178 5461 6254 6974 6c65 4c65 6e67 7468  axTabTitleLength
+00018f80: 3a0d 0a20 2020 2020 2020 2020 2020 2074  :..            t
+00018f90: 6974 6c65 203d 2022 2e2e 2573 2220 2520  itle = "..%s" % 
+00018fa0: 7469 746c 655b 2d63 6f6e 662e 4d61 7854  title[-conf.MaxT
+00018fb0: 6162 5469 746c 654c 656e 6774 683a 5d0d  abTitleLength:].
+00018fc0: 0a20 2020 2020 2020 2075 6e69 7175 6520  .        unique 
+00018fd0: 3d20 7469 746c 655f 6261 7365 203d 2074  = title_base = t
+00018fe0: 6974 6c65 0d0a 2020 2020 2020 2020 616c  itle..        al
+00018ff0: 6c5f 7469 746c 6573 203d 205b 7365 6c66  l_titles = [self
+00019000: 2e6e 6f74 6562 6f6f 6b2e 4765 7450 6167  .notebook.GetPag
+00019010: 6554 6578 7428 6929 0d0a 2020 2020 2020  eText(i)..      
+00019020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019030: 666f 7220 6920 696e 2072 616e 6765 2873  for i in range(s
+00019040: 656c 662e 6e6f 7465 626f 6f6b 2e47 6574  elf.notebook.Get
+00019050: 5061 6765 436f 756e 7428 2929 5d0d 0a20  PageCount())].. 
+00019060: 2020 2020 2020 2069 203d 2031 2023 2053         i = 1 # S
+00019070: 7461 7274 2063 6f75 6e74 6572 2066 726f  tart counter fro
+00019080: 6d20 310d 0a20 2020 2020 2020 2077 6869  m 1..        whi
+00019090: 6c65 2075 6e69 7175 6520 696e 2061 6c6c  le unique in all
+000190a0: 5f74 6974 6c65 733a 0d0a 2020 2020 2020  _titles:..      
+000190b0: 2020 2020 2020 756e 6971 7565 203d 2022        unique = "
+000190c0: 2573 2028 2564 2922 2025 2028 7469 746c  %s (%d)" % (titl
+000190d0: 655f 6261 7365 2c20 6929 0d0a 2020 2020  e_base, i)..    
+000190e0: 2020 2020 2020 2020 6920 2b3d 2031 0d0a          i += 1..
+000190f0: 2020 2020 2020 2020 7265 7475 726e 2075          return u
+00019100: 6e69 7175 650d 0a0d 0a0d 0a20 2020 2064  nique......    d
+00019110: 6566 206c 6f61 645f 6461 7461 6261 7365  ef load_database
+00019120: 2873 656c 662c 2066 696c 656e 616d 652c  (self, filename,
+00019130: 2064 623d 4e6f 6e65 293a 0d0a 2020 2020   db=None):..    
+00019140: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
+00019150: 2054 7269 6573 2074 6f20 6c6f 6164 2074   Tries to load t
+00019160: 6865 2073 7065 6369 6669 6564 2064 6174  he specified dat
+00019170: 6162 6173 652c 2069 6620 6e6f 7420 616c  abase, if not al
+00019180: 7265 6164 7920 6f70 656e 2c0d 0a20 2020  ready open,..   
+00019190: 2020 2020 2061 6e64 2072 6574 7572 6e73       and returns
+000191a0: 2069 742e 0d0a 2020 2020 2020 2020 2222   it...        ""
+000191b0: 220d 0a20 2020 2020 2020 2064 6230 203d  "..        db0 =
+000191c0: 2073 656c 662e 6462 732e 6765 7428 6669   self.dbs.get(fi
+000191d0: 6c65 6e61 6d65 290d 0a20 2020 2020 2020  lename)..       
+000191e0: 2069 6620 6462 303a 2064 6220 3d20 6462   if db0: db = db
+000191f0: 300d 0a20 2020 2020 2020 2065 6c69 6620  0..        elif 
+00019200: 6e6f 7420 6f73 2e70 6174 682e 6578 6973  not os.path.exis
+00019210: 7473 2866 696c 656e 616d 6529 3a0d 0a20  ts(filename):.. 
+00019220: 2020 2020 2020 2020 2020 2077 782e 4d65             wx.Me
+00019230: 7373 6167 6542 6f78 2822 4e6f 6e65 7869  ssageBox("Nonexi
+00019240: 7374 656e 7420 6669 6c65 3a20 2573 2e22  stent file: %s."
+00019250: 2025 2066 696c 656e 616d 652c 0d0a 2020   % filename,..  
+00019260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019270: 2020 2020 2020 2020 636f 6e66 2e54 6974          conf.Tit
+00019280: 6c65 2c20 7778 2e4f 4b20 7c20 7778 2e49  le, wx.OK | wx.I
+00019290: 434f 4e5f 5741 524e 494e 4729 0d0a 2020  CON_WARNING)..  
+000192a0: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+000192b0: 2020 2020 2020 2020 2074 7279 3a0d 0a20           try:.. 
+000192c0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+000192d0: 6220 3d20 6462 206f 7220 736b 7970 6564  b = db or skyped
+000192e0: 6174 612e 536b 7970 6544 6174 6162 6173  ata.SkypeDatabas
+000192f0: 6528 6669 6c65 6e61 6d65 290d 0a20 2020  e(filename)..   
+00019300: 2020 2020 2020 2020 2065 7863 6570 7420           except 
+00019310: 4578 6365 7074 696f 6e3a 0d0a 2020 2020  Exception:..    
+00019320: 2020 2020 2020 2020 2020 2020 6973 5f61              is_a
+00019330: 6363 6573 7369 626c 6520 3d20 4661 6c73  ccessible = Fals
+00019340: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
+00019350: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
+00019360: 2020 2020 2020 2020 2020 2020 2077 6974               wit
+00019370: 6820 6f70 656e 2866 696c 656e 616d 652c  h open(filename,
+00019380: 2022 7262 2229 3a0d 0a20 2020 2020 2020   "rb"):..       
+00019390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000193a0: 2069 735f 6163 6365 7373 6962 6c65 203d   is_accessible =
+000193b0: 2054 7275 650d 0a20 2020 2020 2020 2020   True..         
+000193c0: 2020 2020 2020 2065 7863 6570 7420 4578         except Ex
+000193d0: 6365 7074 696f 6e3a 0d0a 2020 2020 2020  ception:..      
+000193e0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+000193f0: 7373 0d0a 2020 2020 2020 2020 2020 2020  ss..            
+00019400: 2020 2020 6966 206e 6f74 2069 735f 6163      if not is_ac
+00019410: 6365 7373 6962 6c65 3a0d 0a20 2020 2020  cessible:..     
+00019420: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+00019430: 782e 4d65 7373 6167 6542 6f78 280d 0a20  x.MessageBox(.. 
+00019440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019450: 2020 2020 2020 2022 436f 756c 6420 6e6f         "Could no
+00019460: 7420 6f70 656e 2025 732e 5c6e 5c6e 220d  t open %s.\n\n".
+00019470: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019480: 2020 2020 2020 2020 2022 536f 6d65 206f           "Some o
+00019490: 7468 6572 2070 726f 6365 7373 206d 6179  ther process may
+000194a0: 2062 6520 7573 696e 6720 7468 6520 6669   be using the fi
+000194b0: 6c65 2e22 0d0a 2020 2020 2020 2020 2020  le."..          
+000194c0: 2020 2020 2020 2020 2020 2020 2020 2520                % 
+000194d0: 6669 6c65 6e61 6d65 2c20 636f 6e66 2e54  filename, conf.T
+000194e0: 6974 6c65 2c20 7778 2e4f 4b20 7c20 7778  itle, wx.OK | wx
+000194f0: 2e49 434f 4e5f 5741 524e 494e 4729 0d0a  .ICON_WARNING)..
+00019500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019510: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+00019520: 2020 2020 2020 2020 2020 2077 782e 4d65             wx.Me
+00019530: 7373 6167 6542 6f78 280d 0a20 2020 2020  ssageBox(..     
+00019540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019550: 2020 2022 436f 756c 6420 6e6f 7420 6f70     "Could not op
+00019560: 656e 2025 732e 5c6e 5c6e 220d 0a20 2020  en %s.\n\n"..   
+00019570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019580: 2020 2020 2022 4e6f 7420 6120 7661 6c69       "Not a vali
+00019590: 6420 5351 4c49 5445 2064 6174 6162 6173  d SQLITE databas
+000195a0: 653f 2220 2520 6669 6c65 6e61 6d65 2c0d  e?" % filename,.
+000195b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000195c0: 2020 2020 2020 2020 2063 6f6e 662e 5469           conf.Ti
+000195d0: 746c 652c 2077 782e 4f4b 207c 2077 782e  tle, wx.OK | wx.
+000195e0: 4943 4f4e 5f57 4152 4e49 4e47 290d 0a20  ICON_WARNING).. 
+000195f0: 2020 2020 2020 2020 2020 2069 6620 6462             if db
+00019600: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00019610: 2020 2069 6620 6e6f 7420 6462 303a 0d0a     if not db0:..
+00019620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019630: 2020 2020 6c6f 6767 6572 2e69 6e66 6f28      logger.info(
+00019640: 224f 7065 6e65 6420 2573 2028 2573 292e  "Opened %s (%s).
+00019650: 222c 2064 622c 2075 7469 6c2e 666f 726d  ", db, util.form
+00019660: 6174 5f62 7974 6573 280d 0a20 2020 2020  at_bytes(..     
+00019670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019680: 2020 2020 2020 2020 2020 2064 622e 6669             db.fi
+00019690: 6c65 7369 7a65 2929 0d0a 2020 2020 2020  lesize))..      
+000196a0: 2020 2020 2020 2020 2020 2020 2020 6775                gu
+000196b0: 6962 6173 652e 7374 6174 7573 2822 5265  ibase.status("Re
+000196c0: 6164 696e 6720 6461 7461 6261 7365 2066  ading database f
+000196d0: 696c 6520 2573 2e22 2c20 6462 290d 0a20  ile %s.", db).. 
+000196e0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000196f0: 656c 662e 6462 735b 6669 6c65 6e61 6d65  elf.dbs[filename
+00019700: 5d20 3d20 6462 0d0a 2020 2020 2020 2020  ] = db..        
+00019710: 2020 2020 2020 2020 2320 4164 6420 6669          # Add fi
+00019720: 6c65 6e61 6d65 2074 6f20 5265 6365 6e74  lename to Recent
+00019730: 2046 696c 6573 206d 656e 7520 616e 6420   Files menu and 
+00019740: 636f 6e66 2c20 6966 206e 6565 6465 640d  conf, if needed.
+00019750: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019760: 2069 6620 6669 6c65 6e61 6d65 2069 6e20   if filename in 
+00019770: 636f 6e66 2e52 6563 656e 7446 696c 6573  conf.RecentFiles
+00019780: 3a20 2320 5265 6d6f 7665 2065 6172 6c69  : # Remove earli
+00019790: 6572 2070 6f73 6974 696f 6e0d 0a20 2020  er position..   
+000197a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000197b0: 2069 6478 203d 2063 6f6e 662e 5265 6365   idx = conf.Rece
+000197c0: 6e74 4669 6c65 732e 696e 6465 7828 6669  ntFiles.index(fi
+000197d0: 6c65 6e61 6d65 290d 0a20 2020 2020 2020  lename)..       
+000197e0: 2020 2020 2020 2020 2020 2020 2074 7279               try
+000197f0: 3a20 7365 6c66 2e68 6973 746f 7279 5f66  : self.history_f
+00019800: 696c 652e 5265 6d6f 7665 4669 6c65 4672  ile.RemoveFileFr
+00019810: 6f6d 4869 7374 6f72 7928 6964 7829 0d0a  omHistory(idx)..
+00019820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019830: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
+00019840: 7469 6f6e 3a20 7061 7373 0d0a 2020 2020  tion: pass..    
+00019850: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00019860: 2e68 6973 746f 7279 5f66 696c 652e 4164  .history_file.Ad
+00019870: 6446 696c 6554 6f48 6973 746f 7279 2866  dFileToHistory(f
+00019880: 696c 656e 616d 6529 0d0a 2020 2020 2020  ilename)..      
+00019890: 2020 2020 2020 2020 2020 7574 696c 2e61            util.a
+000198a0: 6464 5f75 6e69 7175 6528 636f 6e66 2e52  dd_unique(conf.R
+000198b0: 6563 656e 7446 696c 6573 2c20 6669 6c65  ecentFiles, file
+000198c0: 6e61 6d65 2c20 2d31 2c0d 0a20 2020 2020  name, -1,..     
+000198d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000198e0: 2020 2020 2020 2020 2020 2063 6f6e 662e             conf.
+000198f0: 4d61 7852 6563 656e 7446 696c 6573 290d  MaxRecentFiles).
+00019900: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019910: 2075 7469 6c2e 7275 6e5f 6f6e 6365 2863   util.run_once(c
+00019920: 6f6e 662e 7361 7665 290d 0a20 2020 2020  onf.save)..     
+00019930: 2020 2072 6574 7572 6e20 6462 0d0a 0d0a     return db....
+00019940: 0d0a 2020 2020 6465 6620 6c6f 6164 5f64  ..    def load_d
+00019950: 6174 6162 6173 655f 7061 6765 2873 656c  atabase_page(sel
+00019960: 662c 2066 696c 656e 616d 6529 3a0d 0a20  f, filename):.. 
+00019970: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
+00019980: 2020 2020 5472 6965 7320 746f 206c 6f61      Tries to loa
+00019990: 6420 7468 6520 7370 6563 6966 6965 6420  d the specified 
+000199a0: 6461 7461 6261 7365 2c20 6966 206e 6f74  database, if not
+000199b0: 2061 6c72 6561 6479 206f 7065 6e2c 2063   already open, c
+000199c0: 7265 6174 6520 610d 0a20 2020 2020 2020  reate a..       
+000199d0: 2073 7562 7061 6765 2066 6f72 2069 742c   subpage for it,
+000199e0: 2069 6620 6e6f 7420 616c 7265 6164 7920   if not already 
+000199f0: 6372 6561 7465 642c 2061 6e64 2066 6f63  created, and foc
+00019a00: 7573 6573 2074 6865 2073 7562 7061 6765  uses the subpage
+00019a10: 2e0d 0a0d 0a20 2020 2020 2020 2040 7265  .....        @re
+00019a20: 7475 726e 2020 6461 7461 6261 7365 2070  turn  database p
+00019a30: 6167 6520 696e 7374 616e 6365 0d0a 2020  age instance..  
+00019a40: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
+00019a50: 2020 2070 6167 652c 2064 6220 3d20 4e6f     page, db = No
+00019a60: 6e65 2c20 7365 6c66 2e64 6273 2e67 6574  ne, self.dbs.get
+00019a70: 2866 696c 656e 616d 6529 0d0a 2020 2020  (filename)..    
+00019a80: 2020 2020 6966 2064 6220 616e 6420 6462      if db and db
+00019a90: 2069 6e20 7365 6c66 2e64 625f 7061 6765   in self.db_page
+00019aa0: 732e 7661 6c75 6573 2829 3a0d 0a20 2020  s.values():..   
+00019ab0: 2020 2020 2020 2020 2070 6167 6520 3d20           page = 
+00019ac0: 6e65 7874 2828 7820 666f 7220 7820 696e  next((x for x in
+00019ad0: 2073 656c 662e 6462 5f70 6167 6573 2069   self.db_pages i
+00019ae0: 6620 7820 616e 6420 782e 6462 203d 3d20  f x and x.db == 
+00019af0: 6462 292c 204e 6f6e 6529 0d0a 2020 2020  db), None)..    
+00019b00: 2020 2020 6966 206e 6f74 2070 6167 653a      if not page:
+00019b10: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00019b20: 2066 696c 656e 616d 6520 696e 2073 656c   filename in sel
+00019b30: 662e 776f 726b 6572 735f 696d 706f 7274  f.workers_import
+00019b40: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00019b50: 2020 2077 782e 4d65 7373 6167 6542 6f78     wx.MessageBox
+00019b60: 2822 2573 2069 7320 6375 7272 656e 746c  ("%s is currentl
+00019b70: 7920 6265 696e 6720 696d 706f 7274 6564  y being imported
+00019b80: 2074 6f2c 2063 616e 6e6f 7420 6f70 656e   to, cannot open
+00019b90: 2e22 2025 0d0a 2020 2020 2020 2020 2020  ." %..          
+00019ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019bb0: 2020 2020 6669 6c65 6e61 6d65 2c20 636f      filename, co
+00019bc0: 6e66 2e54 6974 6c65 2c20 7778 2e4f 4b20  nf.Title, wx.OK 
+00019bd0: 7c20 7778 2e49 434f 4e5f 5741 524e 494e  | wx.ICON_WARNIN
+00019be0: 4729 0d0a 2020 2020 2020 2020 2020 2020  G)..            
+00019bf0: 2020 2020 7265 7475 726e 0d0a 0d0a 2020      return....  
+00019c00: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+00019c10: 2064 623a 0d0a 2020 2020 2020 2020 2020   db:..          
+00019c20: 2020 2020 2020 6462 203d 2073 656c 662e        db = self.
+00019c30: 6c6f 6164 5f64 6174 6162 6173 6528 6669  load_database(fi
+00019c40: 6c65 6e61 6d65 290d 0a20 2020 2020 2020  lename)..       
+00019c50: 2020 2020 2069 6620 6462 3a0d 0a20 2020       if db:..   
+00019c60: 2020 2020 2020 2020 2020 2020 2067 7569               gui
+00019c70: 6261 7365 2e73 7461 7475 7328 224f 7065  base.status("Ope
+00019c80: 6e69 6e67 2064 6174 6162 6173 6520 6669  ning database fi
+00019c90: 6c65 2025 732e 2220 2520 6462 290d 0a20  le %s." % db).. 
+00019ca0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00019cb0: 6162 5f74 6974 6c65 203d 2073 656c 662e  ab_title = self.
+00019cc0: 6765 745f 756e 6971 7565 5f74 6162 5f74  get_unique_tab_t
+00019cd0: 6974 6c65 2864 622e 6669 6c65 6e61 6d65  itle(db.filename
+00019ce0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00019cf0: 2020 2070 6167 6520 3d20 4461 7461 6261     page = Databa
+00019d00: 7365 5061 6765 2873 656c 662e 6e6f 7465  sePage(self.note
+00019d10: 626f 6f6b 2c20 7461 625f 7469 746c 652c  book, tab_title,
+00019d20: 2064 622c 2073 656c 662e 6d65 6d6f 7279   db, self.memory
+00019d30: 6673 290d 0a20 2020 2020 2020 2020 2020  fs)..           
+00019d40: 2020 2020 2073 656c 662e 6462 5f70 6167       self.db_pag
+00019d50: 6573 5b70 6167 655d 203d 2064 620d 0a20  es[page] = db.. 
+00019d60: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00019d70: 656c 662e 5570 6461 7465 4163 6365 6c65  elf.UpdateAccele
+00019d80: 7261 746f 7273 2829 0d0a 2020 2020 2020  rators()..      
+00019d90: 2020 2020 2020 2020 2020 7574 696c 2e72            util.r
+00019da0: 756e 5f6f 6e63 6528 636f 6e66 2e73 6176  un_once(conf.sav
+00019db0: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+00019dc0: 2020 2020 7365 6c66 2e42 696e 6428 7778      self.Bind(wx
+00019dd0: 2e45 5654 5f4c 4953 545f 4445 4c45 5445  .EVT_LIST_DELETE
+00019de0: 5f41 4c4c 5f49 5445 4d53 2c0d 0a20 2020  _ALL_ITEMS,..   
+00019df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019e00: 2020 2020 2020 2073 656c 662e 6f6e 5f63         self.on_c
+00019e10: 6c65 6172 5f73 6561 7263 6861 6c6c 2c20  lear_searchall, 
+00019e20: 7061 6765 2e65 6469 745f 7365 6172 6368  page.edit_search
+00019e30: 616c 6c29 0d0a 2020 2020 2020 2020 6966  all)..        if
+00019e40: 2070 6167 653a 0d0a 2020 2020 2020 2020   page:..        
+00019e50: 2020 2020 6964 7830 203d 2073 656c 662e      idx0 = self.
+00019e60: 6c69 7374 5f64 622e 4765 7446 6972 7374  list_db.GetFirst
+00019e70: 5365 6c65 6374 6564 2829 0d0a 2020 2020  Selected()..    
+00019e80: 2020 2020 2020 2020 6964 7820 203d 2073          idx  = s
+00019e90: 656c 662e 6c69 7374 5f64 622e 4669 6e64  elf.list_db.Find
+00019ea0: 4974 656d 2866 696c 656e 616d 6529 0d0a  Item(filename)..
+00019eb0: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+00019ec0: 6478 3020 3e3d 2030 2061 6e64 2069 6478  dx0 >= 0 and idx
+00019ed0: 3020 213d 2069 6478 3a20 7365 6c66 2e6c  0 != idx: self.l
+00019ee0: 6973 745f 6462 2e53 656c 6563 7428 6964  ist_db.Select(id
+00019ef0: 7830 2c20 4661 6c73 6529 0d0a 2020 2020  x0, False)..    
+00019f00: 2020 2020 2020 2020 6966 2069 6478 203e          if idx >
+00019f10: 2030 2061 6e64 2069 6478 2021 3d20 6964   0 and idx != id
+00019f20: 7830 3a0d 0a20 2020 2020 2020 2020 2020  x0:..           
+00019f30: 2020 2020 2073 656c 662e 6c69 7374 5f64       self.list_d
+00019f40: 622e 5365 6c65 6374 2869 6478 2c20 5472  b.Select(idx, Tr
+00019f50: 7565 290d 0a20 2020 2020 2020 2020 2020  ue)..           
+00019f60: 2020 2020 2073 656c 662e 6c69 7374 5f64       self.list_d
+00019f70: 622e 456e 7375 7265 5669 7369 626c 6528  b.EnsureVisible(
+00019f80: 6964 7829 0d0a 2020 2020 2020 2020 2020  idx)..          
+00019f90: 2020 666f 7220 6920 696e 2072 616e 6765    for i in range
+00019fa0: 2873 656c 662e 6e6f 7465 626f 6f6b 2e47  (self.notebook.G
+00019fb0: 6574 5061 6765 436f 756e 7428 2929 3a0d  etPageCount()):.
+00019fc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019fd0: 2069 6620 7365 6c66 2e6e 6f74 6562 6f6f   if self.noteboo
+00019fe0: 6b2e 4765 7450 6167 6528 6929 203d 3d20  k.GetPage(i) == 
+00019ff0: 7061 6765 3a0d 0a20 2020 2020 2020 2020  page:..         
+0001a000: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0001a010: 6e6f 7465 626f 6f6b 2e53 6574 5365 6c65  notebook.SetSele
+0001a020: 6374 696f 6e28 6929 0d0a 2020 2020 2020  ction(i)..      
+0001a030: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0001a040: 6c66 2e75 7064 6174 655f 6e6f 7465 626f  lf.update_notebo
+0001a050: 6f6b 5f68 6561 6465 7228 290d 0a20 2020  ok_header()..   
+0001a060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a070: 2062 7265 616b 2023 2066 6f72 2069 0d0a   break # for i..
+0001a080: 2020 2020 2020 2020 7265 7475 726e 2070          return p
+0001a090: 6167 650d 0a0d 0a0d 0a0d 0a63 6c61 7373  age........class
+0001a0a0: 2044 6174 6162 6173 6550 6167 6528 7778   DatabasePage(wx
+0001a0b0: 2e50 616e 656c 293a 0d0a 2020 2020 2222  .Panel):..    ""
+0001a0c0: 220d 0a20 2020 2041 2077 782e 4e6f 7465  "..    A wx.Note
+0001a0d0: 626f 6f6b 2070 6167 6520 666f 7220 6d61  book page for ma
+0001a0e0: 6e61 6769 6e67 2061 2073 696e 676c 6520  naging a single 
+0001a0f0: 6461 7461 6261 7365 2066 696c 652c 2068  database file, h
+0001a100: 6173 2069 7473 206f 776e 0d0a 2020 2020  as its own..    
+0001a110: 4e6f 7465 626f 6f6b 2077 6974 6820 6120  Notebook with a 
+0001a120: 6e75 6d62 6572 206f 6620 7061 6765 7320  number of pages 
+0001a130: 666f 7220 7365 6172 6368 696e 672c 2062  for searching, b
+0001a140: 726f 7773 696e 6720 6368 6174 2068 6973  rowsing chat his
+0001a150: 746f 7279 2061 6e64 0d0a 2020 2020 6461  tory and..    da
+0001a160: 7461 6261 7365 2074 6162 6c65 732c 2069  tabase tables, i
+0001a170: 6e66 6f72 6d61 7469 6f6e 2061 6e64 2063  nformation and c
+0001a180: 6f6e 7461 6374 2069 6d70 6f72 742e 0d0a  ontact import...
+0001a190: 2020 2020 2222 220d 0a0d 0a20 2020 2064      """....    d
+0001a1a0: 6566 205f 5f69 6e69 745f 5f28 7365 6c66  ef __init__(self
+0001a1b0: 2c20 7061 7265 6e74 5f6e 6f74 6562 6f6f  , parent_noteboo
+0001a1c0: 6b2c 2074 6974 6c65 2c20 6462 2c20 6d65  k, title, db, me
+0001a1d0: 6d6f 7279 6673 293a 0d0a 2020 2020 2020  moryfs):..      
+0001a1e0: 2020 7778 2e50 616e 656c 2e5f 5f69 6e69    wx.Panel.__ini
+0001a1f0: 745f 5f28 7365 6c66 2c20 7061 7265 6e74  t__(self, parent
+0001a200: 3d70 6172 656e 745f 6e6f 7465 626f 6f6b  =parent_notebook
+0001a210: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+0001a220: 7061 7265 6e74 5f6e 6f74 6562 6f6f 6b20  parent_notebook 
+0001a230: 3d20 7061 7265 6e74 5f6e 6f74 6562 6f6f  = parent_noteboo
+0001a240: 6b0d 0a20 2020 2020 2020 2073 656c 662e  k..        self.
+0001a250: 7469 746c 6520 3d20 7469 746c 650d 0a0d  title = title...
+0001a260: 0a20 2020 2020 2020 2073 656c 662e 7061  .        self.pa
+0001a270: 6765 6f72 6465 7220 3d20 7b7d 2023 207b  georder = {} # {
+0001a280: 7061 6765 3a20 6e6f 7465 626f 6f6b 2069  page: notebook i
+0001a290: 6e64 6578 2c20 7d0d 0a20 2020 2020 2020  ndex, }..       
+0001a2a0: 2073 656c 662e 7265 6164 795f 746f 5f63   self.ready_to_c
+0001a2b0: 6c6f 7365 203d 2046 616c 7365 0d0a 2020  lose = False..  
+0001a2c0: 2020 2020 2020 7365 6c66 2e64 6220 3d20        self.db = 
+0001a2d0: 6462 0d0a 2020 2020 2020 2020 7365 6c66  db..        self
+0001a2e0: 2e64 622e 7265 6769 7374 6572 5f63 6f6e  .db.register_con
+0001a2f0: 7375 6d65 7228 7365 6c66 290d 0a20 2020  sumer(self)..   
+0001a300: 2020 2020 2073 656c 662e 6462 5f67 7269       self.db_gri
+0001a310: 6473 203d 207b 7d20 2320 7b22 7461 626c  ds = {} # {"tabl
+0001a320: 656e 616d 6522 3a20 5371 6c69 7465 4772  ename": SqliteGr
+0001a330: 6964 4261 7365 2c20 7d0d 0a20 2020 2020  idBase, }..     
+0001a340: 2020 2073 656c 662e 6d65 6d6f 7279 6673     self.memoryfs
+0001a350: 203d 206d 656d 6f72 7966 730d 0a20 2020   = memoryfs..   
+0001a360: 2020 2020 2073 656c 662e 7469 6d65 6c69       self.timeli
+0001a370: 6e65 5f74 696d 6572 203d 204e 6f6e 6520  ne_timer = None 
+0001a380: 2320 5469 6d65 6c69 6e65 2068 6967 686c  # Timeline highl
+0001a390: 6967 6874 2063 616c 6c62 6163 6b20 7469  ight callback ti
+0001a3a0: 6d65 720d 0a20 2020 2020 2020 2070 6172  mer..        par
+0001a3b0: 656e 745f 6e6f 7465 626f 6f6b 2e49 6e73  ent_notebook.Ins
+0001a3c0: 6572 7450 6167 6528 312c 2073 656c 662c  ertPage(1, self,
+0001a3d0: 2074 6974 6c65 290d 0a20 2020 2020 2020   title)..       
+0001a3e0: 2062 7573 7920 3d20 636f 6e74 726f 6c73   busy = controls
+0001a3f0: 2e42 7573 7950 616e 656c 2873 656c 662c  .BusyPanel(self,
+0001a400: 2022 4c6f 6164 696e 6720 5c22 2573 5c22   "Loading \"%s\"
+0001a410: 2e22 2025 2064 622e 6669 6c65 6e61 6d65  ." % db.filename
+0001a420: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+0001a430: 636f 756e 7465 7220 3d20 6c61 6d62 6461  counter = lambda
+0001a440: 2078 3d7b 2263 223a 2030 7d3a 2078 2e75   x={"c": 0}: x.u
+0001a450: 7064 6174 6528 633d 312b 785b 2263 225d  pdate(c=1+x["c"]
+0001a460: 2920 6f72 2078 5b22 6322 5d0d 0a20 2020  ) or x["c"]..   
+0001a470: 2020 2020 2043 6f6c 6f75 724d 616e 6167       ColourManag
+0001a480: 6572 2e4d 616e 6167 6528 7365 6c66 2c20  er.Manage(self, 
+0001a490: 2242 6163 6b67 726f 756e 6443 6f6c 6f75  "BackgroundColou
+0001a4a0: 7222 2c20 2257 6964 6765 7443 6f6c 6f75  r", "WidgetColou
+0001a4b0: 7222 290d 0a20 2020 2020 2020 2073 656c  r")..        sel
+0001a4c0: 662e 4269 6e64 2877 782e 4556 545f 5359  f.Bind(wx.EVT_SY
+0001a4d0: 535f 434f 4c4f 5552 5f43 4841 4e47 4544  S_COLOUR_CHANGED
+0001a4e0: 2c20 7365 6c66 2e6f 6e5f 7379 735f 636f  , self.on_sys_co
+0001a4f0: 6c6f 7572 5f63 6861 6e67 6529 0d0a 0d0a  lour_change)....
+0001a500: 2020 2020 2020 2020 7365 6c66 2e63 6861          self.cha
+0001a510: 7420 3d20 4e6f 6e65 2023 2043 7572 7265  t = None # Curre
+0001a520: 6e74 6c79 2076 6965 7765 6420 6368 6174  ntly viewed chat
+0001a530: 0d0a 2020 2020 2020 2020 7365 6c66 2e63  ..        self.c
+0001a540: 6861 7473 203d 205b 5d20 2023 2041 6c6c  hats = []  # All
+0001a550: 2063 6861 7473 2069 6e20 6461 7461 6261   chats in databa
+0001a560: 7365 0d0a 2020 2020 2020 2020 7365 6c66  se..        self
+0001a570: 2e63 6861 745f 6669 6c74 6572 203d 207b  .chat_filter = {
+0001a580: 2023 2046 696c 7465 7220 666f 7220 6375   # Filter for cu
+0001a590: 7272 656e 746c 7920 7368 6f77 6e20 6368  rrently shown ch
+0001a5a0: 6174 2068 6973 746f 7279 0d0a 2020 2020  at history..    
+0001a5b0: 2020 2020 2020 2020 2264 6174 6572 616e          "dateran
+0001a5c0: 6765 223a 204e 6f6e 652c 2020 2020 2020  ge": None,      
+0001a5d0: 2320 4375 7272 656e 7420 6461 7465 2072  # Current date r
+0001a5e0: 616e 6765 0d0a 2020 2020 2020 2020 2020  ange..          
+0001a5f0: 2020 2273 7461 7274 6461 7465 7261 6e67    "startdaterang
+0001a600: 6522 3a20 4e6f 6e65 2c20 2320 496e 6974  e": None, # Init
+0001a610: 6961 6c20 6461 7465 2072 616e 6765 0d0a  ial date range..
+0001a620: 2020 2020 2020 2020 2020 2020 2274 6578              "tex
+0001a630: 7422 3a20 2222 2c20 2020 2020 2020 2020  t": "",         
+0001a640: 2020 2020 2320 5465 7874 2069 6e20 6d65      # Text in me
+0001a650: 7373 6167 6520 636f 6e74 656e 740d 0a20  ssage content.. 
+0001a660: 2020 2020 2020 2020 2020 2022 7061 7274             "part
+0001a670: 6963 6970 616e 7473 223a 204e 6f6e 6520  icipants": None 
+0001a680: 2020 2023 204d 6573 7361 6765 7320 6672     # Messages fr
+0001a690: 6f6d 205b 736b 7970 6520 6e61 6d65 2c20  om [skype name, 
+0001a6a0: 5d0d 0a20 2020 2020 2020 207d 0d0a 2020  ]..        }..  
+0001a6b0: 2020 2020 2020 7365 6c66 2e63 6f6e 7461        self.conta
+0001a6c0: 6374 203d 204e 6f6e 6520 2320 4375 7272  ct = None # Curr
+0001a6d0: 656e 746c 7920 7669 6577 6564 2063 6f6e  ently viewed con
+0001a6e0: 7461 6374 0d0a 2020 2020 2020 2020 7365  tact..        se
+0001a6f0: 6c66 2e63 6f6e 7461 6374 7320 3d20 5b5d  lf.contacts = []
+0001a700: 2020 2320 416c 6c20 636f 6e74 6163 7473    # All contacts
+0001a710: 2069 6e20 6461 7461 6261 7365 0d0a 2020   in database..  
+0001a720: 2020 2020 2020 7365 6c66 2e63 6f6e 7461        self.conta
+0001a730: 6374 5f73 6f72 745f 6669 656c 6420 3d20  ct_sort_field = 
+0001a740: 226c 6173 745f 6d65 7373 6167 655f 6461  "last_message_da
+0001a750: 7465 7469 6d65 220d 0a20 2020 2020 2020  tetime"..       
+0001a760: 2073 656c 662e 696d 6167 6563 6163 6865   self.imagecache
+0001a770: 203d 207b 7d20 2320 7b28 2261 7661 7461   = {} # {("avata
+0001a780: 7222 2c20 636f 6e74 6163 742f 6163 636f  r", contact/acco
+0001a790: 756e 7420 4944 2920 6f72 2028 2263 6861  unt ID) or ("cha
+0001a7a0: 7422 2c20 6368 6174 2049 4429 3a20 7778  t", chat ID): wx
+0001a7b0: 2e49 6d61 6765 7d0d 0a20 2020 2020 2020  .Image}..       
+0001a7c0: 2073 656c 662e 7374 6174 735f 736f 7274   self.stats_sort
+0001a7d0: 5f66 6965 6c64 203d 2022 6e61 6d65 220d  _field = "name".
+0001a7e0: 0a20 2020 2020 2020 2073 656c 662e 7374  .        self.st
+0001a7f0: 6174 735f 6578 7061 6e64 203d 207b 2263  ats_expand = {"c
+0001a800: 6c6f 7564 7322 3a20 4661 6c73 652c 2022  louds": False, "
+0001a810: 656d 6f74 6963 6f6e 7322 3a20 4661 6c73  emoticons": Fals
+0001a820: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
+0001a830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a840: 2022 7368 6172 6564 5f6d 6564 6961 223a   "shared_media":
+0001a850: 2046 616c 7365 7d0d 0a0d 0a20 2020 2020   False}....     
+0001a860: 2020 2023 2043 7265 6174 6520 7365 6172     # Create sear
+0001a870: 6368 2073 7472 7563 7475 7265 7320 616e  ch structures an
+0001a880: 6420 7468 7265 6164 730d 0a20 2020 2020  d threads..     
+0001a890: 2020 2073 656c 662e 4269 6e64 2845 5654     self.Bind(EVT
+0001a8a0: 5f57 4f52 4b45 522c 2073 656c 662e 6f6e  _WORKER, self.on
+0001a8b0: 5f73 6561 7263 6861 6c6c 5f72 6573 756c  _searchall_resul
+0001a8c0: 7429 0d0a 2020 2020 2020 2020 7365 6c66  t)..        self
+0001a8d0: 2e77 6f72 6b65 7273 5f73 6561 7263 6820  .workers_search 
+0001a8e0: 3d20 7b7d 2023 207b 7365 6172 6368 2049  = {} # {search I
+0001a8f0: 443a 2077 6f72 6b65 7273 2e53 6561 7263  D: workers.Searc
+0001a900: 6854 6872 6561 642c 207d 0d0a 2020 2020  hThread, }..    
+0001a910: 2020 2020 7365 6c66 2e64 622e 6c69 7665      self.db.live
+0001a920: 2e70 726f 6772 6573 7320 3d20 7365 6c66  .progress = self
+0001a930: 2e6f 6e5f 6c69 7665 5f72 6573 756c 740d  .on_live_result.
+0001a940: 0a20 2020 2020 2020 2073 656c 662e 776f  .        self.wo
+0001a950: 726b 6572 5f6c 6976 6520 3d20 776f 726b  rker_live = work
+0001a960: 6572 732e 4c69 7665 5468 7265 6164 2873  ers.LiveThread(s
+0001a970: 656c 662e 6f6e 5f6c 6976 655f 7265 7375  elf.on_live_resu
+0001a980: 6c74 2c20 7365 6c66 2e64 622e 6c69 7665  lt, self.db.live
+0001a990: 290d 0a0d 0a20 2020 2020 2020 2073 697a  )....        siz
+0001a9a0: 6572 203d 2073 656c 662e 5369 7a65 7220  er = self.Sizer 
+0001a9b0: 3d20 7778 2e42 6f78 5369 7a65 7228 7778  = wx.BoxSizer(wx
+0001a9c0: 2e56 4552 5449 4341 4c29 0d0a 0d0a 2020  .VERTICAL)....  
+0001a9d0: 2020 2020 2020 7369 7a65 725f 6865 6164        sizer_head
+0001a9e0: 6572 203d 2077 782e 426f 7853 697a 6572  er = wx.BoxSizer
+0001a9f0: 2877 782e 484f 5249 5a4f 4e54 414c 290d  (wx.HORIZONTAL).
+0001aa00: 0a20 2020 2020 2020 206c 6162 656c 5f74  .        label_t
+0001aa10: 6974 6c65 203d 2073 656c 662e 6c61 6265  itle = self.labe
+0001aa20: 6c5f 7469 746c 6520 3d20 7778 2e53 7461  l_title = wx.Sta
+0001aa30: 7469 6354 6578 7428 7061 7265 6e74 3d73  ticText(parent=s
+0001aa40: 656c 662c 206c 6162 656c 3d22 2229 0d0a  elf, label="")..
+0001aa50: 2020 2020 2020 2020 7369 7a65 725f 6865          sizer_he
+0001aa60: 6164 6572 2e41 6464 286c 6162 656c 5f74  ader.Add(label_t
+0001aa70: 6974 6c65 2c20 666c 6167 3d77 782e 414c  itle, flag=wx.AL
+0001aa80: 4947 4e5f 4345 4e54 4552 5f56 4552 5449  IGN_CENTER_VERTI
+0001aa90: 4341 4c29 0d0a 2020 2020 2020 2020 7369  CAL)..        si
+0001aaa0: 7a65 725f 6865 6164 6572 2e41 6464 5374  zer_header.AddSt
+0001aab0: 7265 7463 6853 7061 6365 7228 290d 0a0d  retchSpacer()...
+0001aac0: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
+0001aad0: 6c61 6265 6c5f 7365 6172 6368 203d 2077  label_search = w
+0001aae0: 782e 5374 6174 6963 5465 7874 2873 656c  x.StaticText(sel
+0001aaf0: 662c 202d 312c 2022 2653 6561 7263 6820  f, -1, "&Search 
+0001ab00: 696e 206d 6573 7361 6765 733a 2229 0d0a  in messages:")..
+0001ab10: 2020 2020 2020 2020 7369 7a65 725f 6865          sizer_he
+0001ab20: 6164 6572 2e41 6464 2873 656c 662e 6c61  ader.Add(self.la
+0001ab30: 6265 6c5f 7365 6172 6368 2c20 626f 7264  bel_search, bord
+0001ab40: 6572 3d35 2c0d 0a20 2020 2020 2020 2020  er=5,..         
+0001ab50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ab60: 666c 6167 3d77 782e 5249 4748 5420 7c20  flag=wx.RIGHT | 
+0001ab70: 7778 2e41 4c49 474e 5f43 454e 5445 525f  wx.ALIGN_CENTER_
+0001ab80: 5645 5254 4943 414c 290d 0a20 2020 2020  VERTICAL)..     
+0001ab90: 2020 2065 6469 745f 7365 6172 6368 203d     edit_search =
+0001aba0: 2073 656c 662e 6564 6974 5f73 6561 7263   self.edit_searc
+0001abb0: 6861 6c6c 203d 2063 6f6e 7472 6f6c 732e  hall = controls.
+0001abc0: 5465 7874 4374 726c 4175 746f 436f 6d70  TextCtrlAutoComp
+0001abd0: 6c65 7465 280d 0a20 2020 2020 2020 2020  lete(..         
+0001abe0: 2020 2073 656c 662c 2064 6573 6372 6970     self, descrip
+0001abf0: 7469 6f6e 3d63 6f6e 662e 4869 7374 6f72  tion=conf.Histor
+0001ac00: 7953 6561 7263 6844 6573 6372 6970 7469  ySearchDescripti
+0001ac10: 6f6e 2c0d 0a20 2020 2020 2020 2020 2020  on,..           
+0001ac20: 2073 697a 653d 2833 3030 2c20 2d31 292c   size=(300, -1),
+0001ac30: 2073 7479 6c65 3d77 782e 5445 5f50 524f   style=wx.TE_PRO
+0001ac40: 4345 5353 5f45 4e54 4552 290d 0a20 2020  CESS_ENTER)..   
+0001ac50: 2020 2020 2073 656c 662e 4269 6e64 2877       self.Bind(w
+0001ac60: 782e 4556 545f 5445 5854 5f45 4e54 4552  x.EVT_TEXT_ENTER
+0001ac70: 2c20 7365 6c66 2e6f 6e5f 7365 6172 6368  , self.on_search
+0001ac80: 616c 6c2c 2065 6469 745f 7365 6172 6368  all, edit_search
+0001ac90: 290d 0a20 2020 2020 2020 2074 6220 3d20  )..        tb = 
+0001aca0: 7365 6c66 2e74 625f 7365 6172 6368 203d  self.tb_search =
+0001acb0: 2077 782e 546f 6f6c 4261 7228 7061 7265   wx.ToolBar(pare
+0001acc0: 6e74 3d73 656c 662c 0d0a 2020 2020 2020  nt=self,..      
+0001acd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ace0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001acf0: 2020 2073 7479 6c65 3d77 782e 5442 5f46     style=wx.TB_F
+0001ad00: 4c41 5420 7c20 7778 2e54 425f 4e4f 4449  LAT | wx.TB_NODI
+0001ad10: 5649 4445 5229 0d0a 0d0a 2020 2020 2020  VIDER)....      
+0001ad20: 2020 626d 7020 3d20 7778 2e41 7274 5072    bmp = wx.ArtPr
+0001ad30: 6f76 6964 6572 2e47 6574 4269 746d 6170  ovider.GetBitmap
+0001ad40: 2877 782e 4152 545f 474f 5f46 4f52 5741  (wx.ART_GO_FORWA
+0001ad50: 5244 2c20 7778 2e41 5254 5f54 4f4f 4c42  RD, wx.ART_TOOLB
+0001ad60: 4152 2c0d 0a20 2020 2020 2020 2020 2020  AR,..           
+0001ad70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ad80: 2020 2020 2020 2020 2020 2020 2831 362c              (16,
+0001ad90: 2031 3629 290d 0a20 2020 2020 2020 2074   16))..        t
+0001ada0: 622e 5365 7454 6f6f 6c42 6974 6d61 7053  b.SetToolBitmapS
+0001adb0: 697a 6528 626d 702e 5369 7a65 290d 0a20  ize(bmp.Size).. 
+0001adc0: 2020 2020 2020 2074 622e 4164 6454 6f6f         tb.AddToo
+0001add0: 6c28 7778 2e49 445f 4649 4e44 2c20 2222  l(wx.ID_FIND, ""
+0001ade0: 2c20 6269 746d 6170 3d62 6d70 2c20 7368  , bitmap=bmp, sh
+0001adf0: 6f72 7448 656c 703d 2253 7461 7274 2073  ortHelp="Start s
+0001ae00: 6561 7263 6822 290d 0a20 2020 2020 2020  earch")..       
+0001ae10: 2074 622e 5265 616c 697a 6528 290d 0a20   tb.Realize().. 
+0001ae20: 2020 2020 2020 2073 656c 662e 4269 6e64         self.Bind
+0001ae30: 2877 782e 4556 545f 544f 4f4c 2c20 7365  (wx.EVT_TOOL, se
+0001ae40: 6c66 2e6f 6e5f 7365 6172 6368 616c 6c2c  lf.on_searchall,
+0001ae50: 2069 643d 7778 2e49 445f 4649 4e44 290d   id=wx.ID_FIND).
+0001ae60: 0a20 2020 2020 2020 2073 697a 6572 5f68  .        sizer_h
+0001ae70: 6561 6465 722e 4164 6428 6564 6974 5f73  eader.Add(edit_s
+0001ae80: 6561 7263 682c 2062 6f72 6465 723d 352c  earch, border=5,
+0001ae90: 2066 6c61 673d 7778 2e52 4947 4854 290d   flag=wx.RIGHT).
+0001aea0: 0a20 2020 2020 2020 2073 697a 6572 5f68  .        sizer_h
+0001aeb0: 6561 6465 722e 4164 6428 7462 2c20 666c  eader.Add(tb, fl
+0001aec0: 6167 3d77 782e 4752 4f57 290d 0a20 2020  ag=wx.GROW)..   
+0001aed0: 2020 2020 2073 697a 6572 2e41 6464 2873       sizer.Add(s
+0001aee0: 697a 6572 5f68 6561 6465 722c 0d0a 2020  izer_header,..  
+0001aef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001af00: 626f 7264 6572 3d35 2c20 666c 6167 3d77  border=5, flag=w
+0001af10: 782e 4c45 4654 207c 2077 782e 5249 4748  x.LEFT | wx.RIGH
+0001af20: 5420 7c20 7778 2e54 4f50 207c 2077 782e  T | wx.TOP | wx.
+0001af30: 4752 4f57 290d 0a20 2020 2020 2020 2073  GROW)..        s
+0001af40: 697a 6572 2e4c 6179 6f75 7428 2920 2320  izer.Layout() # 
+0001af50: 546f 2061 766f 6964 2073 6561 7263 6862  To avoid searchb
+0001af60: 6f78 206d 6f76 696e 6720 6172 6f75 6e64  ox moving around
+0001af70: 2064 7572 696e 6720 7061 6765 2063 7265   during page cre
+0001af80: 6174 696f 6e0d 0a0d 0a20 2020 2020 2020  ation....       
+0001af90: 206e 6f74 6562 6f6f 6b20 3d20 7365 6c66   notebook = self
+0001afa0: 2e6e 6f74 6562 6f6f 6b20 3d20 7778 2e6c  .notebook = wx.l
+0001afb0: 6962 2e61 6777 2e6c 6162 656c 626f 6f6b  ib.agw.labelbook
+0001afc0: 2e46 6c61 7449 6d61 6765 426f 6f6b 280d  .FlatImageBook(.
+0001afd0: 0a20 2020 2020 2020 2020 2020 2070 6172  .            par
+0001afe0: 656e 743d 7365 6c66 2c20 6167 7753 7479  ent=self, agwSty
+0001aff0: 6c65 3d77 782e 6c69 622e 6167 772e 666d  le=wx.lib.agw.fm
+0001b000: 7265 736f 7572 6365 732e 494e 425f 4c45  resources.INB_LE
+0001b010: 4654 2c20 7374 796c 653d 7778 2e42 4f52  FT, style=wx.BOR
+0001b020: 4445 525f 5354 4154 4943 290d 0a0d 0a20  DER_STATIC).... 
+0001b030: 2020 2020 2020 2069 6c20 3d20 7778 2e49         il = wx.I
+0001b040: 6d61 6765 4c69 7374 2833 322c 2033 3229  mageList(32, 32)
+0001b050: 0d0a 2020 2020 2020 2020 6964 7831 203d  ..        idx1 =
+0001b060: 2069 6c2e 4164 6428 696d 6167 6573 2e50   il.Add(images.P
+0001b070: 6167 6553 6561 7263 682e 4269 746d 6170  ageSearch.Bitmap
+0001b080: 290d 0a20 2020 2020 2020 2069 6478 3220  )..        idx2 
+0001b090: 3d20 696c 2e41 6464 2869 6d61 6765 732e  = il.Add(images.
+0001b0a0: 5061 6765 4368 6174 732e 4269 746d 6170  PageChats.Bitmap
+0001b0b0: 290d 0a20 2020 2020 2020 2069 6478 3320  )..        idx3 
+0001b0c0: 3d20 696c 2e41 6464 2869 6d61 6765 732e  = il.Add(images.
+0001b0d0: 5061 6765 436f 6e74 6163 7473 2e42 6974  PageContacts.Bit
+0001b0e0: 6d61 7029 0d0a 2020 2020 2020 2020 6964  map)..        id
+0001b0f0: 7834 203d 2069 6c2e 4164 6428 696d 6167  x4 = il.Add(imag
+0001b100: 6573 2e50 6167 6549 6e66 6f2e 4269 746d  es.PageInfo.Bitm
+0001b110: 6170 290d 0a20 2020 2020 2020 2069 6478  ap)..        idx
+0001b120: 3520 3d20 696c 2e41 6464 2869 6d61 6765  5 = il.Add(image
+0001b130: 732e 5061 6765 5461 626c 6573 2e42 6974  s.PageTables.Bit
+0001b140: 6d61 7029 0d0a 2020 2020 2020 2020 6964  map)..        id
+0001b150: 7836 203d 2069 6c2e 4164 6428 696d 6167  x6 = il.Add(imag
+0001b160: 6573 2e50 6167 6553 514c 2e42 6974 6d61  es.PageSQL.Bitma
+0001b170: 7029 0d0a 2020 2020 2020 2020 6964 7837  p)..        idx7
+0001b180: 203d 2069 6c2e 4164 6428 696d 6167 6573   = il.Add(images
+0001b190: 2e50 6167 654f 6e6c 696e 652e 4269 746d  .PageOnline.Bitm
+0001b1a0: 6170 290d 0a20 2020 2020 2020 206e 6f74  ap)..        not
+0001b1b0: 6562 6f6f 6b2e 4173 7369 676e 496d 6167  ebook.AssignImag
+0001b1c0: 654c 6973 7428 696c 290d 0a0d 0a20 2020  eList(il)....   
+0001b1d0: 2020 2020 2073 656c 662e 6372 6561 7465       self.create
+0001b1e0: 5f70 6167 655f 7365 6172 6368 286e 6f74  _page_search(not
+0001b1f0: 6562 6f6f 6b29 0d0a 2020 2020 2020 2020  ebook)..        
+0001b200: 7365 6c66 2e63 7265 6174 655f 7061 6765  self.create_page
+0001b210: 5f63 6861 7473 286e 6f74 6562 6f6f 6b29  _chats(notebook)
+0001b220: 0d0a 2020 2020 2020 2020 7365 6c66 2e63  ..        self.c
+0001b230: 7265 6174 655f 7061 6765 5f63 6f6e 7461  reate_page_conta
+0001b240: 6374 7328 6e6f 7465 626f 6f6b 290d 0a20  cts(notebook).. 
+0001b250: 2020 2020 2020 2073 656c 662e 6372 6561         self.crea
+0001b260: 7465 5f70 6167 655f 696e 666f 286e 6f74  te_page_info(not
+0001b270: 6562 6f6f 6b29 0d0a 2020 2020 2020 2020  ebook)..        
+0001b280: 7365 6c66 2e63 7265 6174 655f 7061 6765  self.create_page
+0001b290: 5f74 6162 6c65 7328 6e6f 7465 626f 6f6b  _tables(notebook
+0001b2a0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+0001b2b0: 6372 6561 7465 5f70 6167 655f 7371 6c28  create_page_sql(
+0001b2c0: 6e6f 7465 626f 6f6b 290d 0a20 2020 2020  notebook)..     
+0001b2d0: 2020 2073 656c 662e 6372 6561 7465 5f70     self.create_p
+0001b2e0: 6167 655f 6c69 7665 286e 6f74 6562 6f6f  age_live(noteboo
+0001b2f0: 6b29 0d0a 0d0a 2020 2020 2020 2020 6e6f  k)....        no
+0001b300: 7465 626f 6f6b 2e53 6574 5061 6765 496d  tebook.SetPageIm
+0001b310: 6167 6528 302c 2069 6478 3129 0d0a 2020  age(0, idx1)..  
+0001b320: 2020 2020 2020 6e6f 7465 626f 6f6b 2e53        notebook.S
+0001b330: 6574 5061 6765 496d 6167 6528 312c 2069  etPageImage(1, i
+0001b340: 6478 3229 0d0a 2020 2020 2020 2020 6e6f  dx2)..        no
+0001b350: 7465 626f 6f6b 2e53 6574 5061 6765 496d  tebook.SetPageIm
+0001b360: 6167 6528 322c 2069 6478 3329 0d0a 2020  age(2, idx3)..  
+0001b370: 2020 2020 2020 6e6f 7465 626f 6f6b 2e53        notebook.S
+0001b380: 6574 5061 6765 496d 6167 6528 332c 2069  etPageImage(3, i
+0001b390: 6478 3429 0d0a 2020 2020 2020 2020 6e6f  dx4)..        no
+0001b3a0: 7465 626f 6f6b 2e53 6574 5061 6765 496d  tebook.SetPageIm
+0001b3b0: 6167 6528 342c 2069 6478 3529 0d0a 2020  age(4, idx5)..  
+0001b3c0: 2020 2020 2020 6e6f 7465 626f 6f6b 2e53        notebook.S
+0001b3d0: 6574 5061 6765 496d 6167 6528 352c 2069  etPageImage(5, i
+0001b3e0: 6478 3629 0d0a 2020 2020 2020 2020 6e6f  dx6)..        no
+0001b3f0: 7465 626f 6f6b 2e53 6574 5061 6765 496d  tebook.SetPageIm
+0001b400: 6167 6528 362c 2069 6478 3729 0d0a 0d0a  age(6, idx7)....
+0001b410: 2020 2020 2020 2020 7369 7a65 722e 4164          sizer.Ad
+0001b420: 6428 6e6f 7465 626f 6f6b 2c20 7072 6f70  d(notebook, prop
+0001b430: 6f72 7469 6f6e 3d31 2c20 626f 7264 6572  ortion=1, border
+0001b440: 3d35 2c20 666c 6167 3d77 782e 4752 4f57  =5, flag=wx.GROW
+0001b450: 207c 2077 782e 414c 4c29 0d0a 0d0a 2020   | wx.ALL)....  
+0001b460: 2020 2020 2020 7365 6c66 2e64 6961 6c6f        self.dialo
+0001b470: 675f 7361 7665 6368 6174 203d 2077 782e  g_savechat = wx.
+0001b480: 4669 6c65 4469 616c 6f67 280d 0a20 2020  FileDialog(..   
+0001b490: 2020 2020 2020 2020 2070 6172 656e 743d           parent=
+0001b4a0: 7365 6c66 2c20 6d65 7373 6167 653d 2253  self, message="S
+0001b4b0: 6176 6520 6368 6174 222c 2064 6566 6175  ave chat", defau
+0001b4c0: 6c74 4469 723d 7369 782e 6d6f 7665 732e  ltDir=six.moves.
+0001b4d0: 6765 7463 7764 2829 2c0d 0a20 2020 2020  getcwd(),..     
+0001b4e0: 2020 2020 2020 2077 696c 6463 6172 643d         wildcard=
+0001b4f0: 6578 706f 7274 2e43 4841 545f 5749 4c44  export.CHAT_WILD
+0001b500: 4341 5244 2c0d 0a20 2020 2020 2020 2020  CARD,..         
+0001b510: 2020 2073 7479 6c65 3d77 782e 4644 5f53     style=wx.FD_S
+0001b520: 4156 4520 7c20 7778 2e46 445f 4f56 4552  AVE | wx.FD_OVER
+0001b530: 5752 4954 455f 5052 4f4d 5054 207c 2077  WRITE_PROMPT | w
+0001b540: 782e 5245 5349 5a45 5f42 4f52 4445 520d  x.RESIZE_BORDER.
+0001b550: 0a20 2020 2020 2020 2029 0d0a 2020 2020  .        )..    
+0001b560: 2020 2020 7365 6c66 2e64 6961 6c6f 675f      self.dialog_
+0001b570: 7361 7665 6368 6174 7320 3d20 7778 2e46  savechats = wx.F
+0001b580: 696c 6544 6961 6c6f 6728 0d0a 2020 2020  ileDialog(..    
+0001b590: 2020 2020 2020 2020 7061 7265 6e74 3d73          parent=s
+0001b5a0: 656c 662c 206d 6573 7361 6765 3d22 4368  elf, message="Ch
+0001b5b0: 6f6f 7365 2066 6f6c 6465 7220 7768 6572  oose folder wher
+0001b5c0: 6520 746f 2073 6176 6520 6368 6174 2066  e to save chat f
+0001b5d0: 696c 6573 222c 0d0a 2020 2020 2020 2020  iles",..        
+0001b5e0: 2020 2020 6465 6661 756c 7444 6972 3d73      defaultDir=s
+0001b5f0: 6978 2e6d 6f76 6573 2e67 6574 6377 6428  ix.moves.getcwd(
+0001b600: 292c 2064 6566 6175 6c74 4669 6c65 3d22  ), defaultFile="
+0001b610: 4669 6c65 6e61 6d65 2077 696c 6c20 6265  Filename will be
+0001b620: 2069 676e 6f72 6564 222c 0d0a 2020 2020   ignored",..    
+0001b630: 2020 2020 2020 2020 7769 6c64 6361 7264          wildcard
+0001b640: 3d65 7870 6f72 742e 4348 4154 5f57 494c  =export.CHAT_WIL
+0001b650: 4443 4152 442c 2073 7479 6c65 3d77 782e  DCARD, style=wx.
+0001b660: 4644 5f53 4156 4520 7c20 7778 2e52 4553  FD_SAVE | wx.RES
+0001b670: 495a 455f 424f 5244 4552 0d0a 2020 2020  IZE_BORDER..    
+0001b680: 2020 2020 290d 0a20 2020 2020 2020 2023      )..        #
+0001b690: 204e 6565 6420 7365 7061 7261 7465 2064   Need separate d
+0001b6a0: 6961 6c6f 6720 772f 6f20 6f76 6572 7772  ialog w/o overwr
+0001b6b0: 6974 6520 7072 6f6d 7074 2c20 6361 6e6e  ite prompt, cann
+0001b6c0: 6f74 2073 7761 7020 7374 796c 6520 696e  ot swap style in
+0001b6d0: 204c 696e 7578 0d0a 2020 2020 2020 2020   Linux..        
+0001b6e0: 7365 6c66 2e64 6961 6c6f 675f 7361 7665  self.dialog_save
+0001b6f0: 6368 6174 735f 7369 6e67 6c65 6669 6c65  chats_singlefile
+0001b700: 203d 2077 782e 4669 6c65 4469 616c 6f67   = wx.FileDialog
+0001b710: 280d 0a20 2020 2020 2020 2020 2020 2070  (..            p
+0001b720: 6172 656e 743d 7365 6c66 2c20 6d65 7373  arent=self, mess
+0001b730: 6167 653d 2253 6176 6520 6368 6174 7320  age="Save chats 
+0001b740: 6669 6c65 222c 0d0a 2020 2020 2020 2020  file",..        
+0001b750: 2020 2020 6465 6661 756c 7444 6972 3d73      defaultDir=s
+0001b760: 6978 2e6d 6f76 6573 2e67 6574 6377 6428  ix.moves.getcwd(
+0001b770: 292c 2077 696c 6463 6172 643d 6578 706f  ), wildcard=expo
+0001b780: 7274 2e43 4841 545f 5749 4c44 4341 5244  rt.CHAT_WILDCARD
+0001b790: 5f53 494e 474c 4546 494c 452c 0d0a 2020  _SINGLEFILE,..  
+0001b7a0: 2020 2020 2020 2020 2020 7374 796c 653d            style=
+0001b7b0: 7778 2e46 445f 5341 5645 207c 2077 782e  wx.FD_SAVE | wx.
+0001b7c0: 4644 5f4f 5645 5257 5249 5445 5f50 524f  FD_OVERWRITE_PRO
+0001b7d0: 4d50 5420 7c20 7778 2e52 4553 495a 455f  MPT | wx.RESIZE_
+0001b7e0: 424f 5244 4552 0d0a 2020 2020 2020 2020  BORDER..        
+0001b7f0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+0001b800: 6469 616c 6f67 5f73 6176 6564 6220 3d20  dialog_savedb = 
+0001b810: 7778 2e46 696c 6544 6961 6c6f 6728 0d0a  wx.FileDialog(..
+0001b820: 2020 2020 2020 2020 2020 2020 7061 7265              pare
+0001b830: 6e74 3d73 656c 662c 206d 6573 7361 6765  nt=self, message
+0001b840: 3d22 5361 7665 2072 6563 6f76 6572 6564  ="Save recovered
+0001b850: 2064 6174 6120 6173 222c 0d0a 2020 2020   data as",..    
+0001b860: 2020 2020 2020 2020 7769 6c64 6361 7264          wildcard
+0001b870: 3d22 5351 4c69 7465 2064 6174 6162 6173  ="SQLite databas
+0001b880: 6520 282a 2e64 6229 7c2a 2e64 627c 416c  e (*.db)|*.db|Al
+0001b890: 6c20 6669 6c65 737c 2a2e 2a22 2c0d 0a20  l files|*.*",.. 
+0001b8a0: 2020 2020 2020 2020 2020 2073 7479 6c65             style
+0001b8b0: 3d77 782e 4644 5f53 4156 4520 7c20 7778  =wx.FD_SAVE | wx
+0001b8c0: 2e46 445f 4f56 4552 5752 4954 455f 5052  .FD_OVERWRITE_PR
+0001b8d0: 4f4d 5054 207c 2077 782e 5245 5349 5a45  OMPT | wx.RESIZE
+0001b8e0: 5f42 4f52 4445 520d 0a20 2020 2020 2020  _BORDER..       
+0001b8f0: 2029 0d0a 2020 2020 2020 2020 7365 6c66   )..        self
+0001b900: 2e64 6961 6c6f 675f 7361 7665 636f 6e74  .dialog_savecont
+0001b910: 6163 7473 203d 2077 782e 4669 6c65 4469  acts = wx.FileDi
+0001b920: 616c 6f67 280d 0a20 2020 2020 2020 2020  alog(..         
+0001b930: 2020 2070 6172 656e 743d 7365 6c66 2c20     parent=self, 
+0001b940: 6d65 7373 6167 653d 2253 6176 6520 636f  message="Save co
+0001b950: 6e74 6163 7473 222c 2064 6566 6175 6c74  ntacts", default
+0001b960: 4469 723d 7369 782e 6d6f 7665 732e 6765  Dir=six.moves.ge
+0001b970: 7463 7764 2829 2c0d 0a20 2020 2020 2020  tcwd(),..       
+0001b980: 2020 2020 2077 696c 6463 6172 643d 6578       wildcard=ex
+0001b990: 706f 7274 2e43 4f4e 5441 4354 5f57 494c  port.CONTACT_WIL
+0001b9a0: 4443 4152 442c 0d0a 2020 2020 2020 2020  DCARD,..        
+0001b9b0: 2020 2020 7374 796c 653d 7778 2e46 445f      style=wx.FD_
+0001b9c0: 4f56 4552 5752 4954 455f 5052 4f4d 5054  OVERWRITE_PROMPT
+0001b9d0: 207c 2077 782e 4644 5f53 4156 4520 7c20   | wx.FD_SAVE | 
+0001b9e0: 7778 2e52 4553 495a 455f 424f 5244 4552  wx.RESIZE_BORDER
+0001b9f0: 0d0a 2020 2020 2020 2020 290d 0a20 2020  ..        )..   
+0001ba00: 2020 2020 2073 656c 662e 6469 616c 6f67       self.dialog
+0001ba10: 5f73 6176 6567 7269 6420 3d20 7778 2e46  _savegrid = wx.F
+0001ba20: 696c 6544 6961 6c6f 6728 0d0a 2020 2020  ileDialog(..    
+0001ba30: 2020 2020 2020 2020 7061 7265 6e74 3d73          parent=s
+0001ba40: 656c 662c 2064 6566 6175 6c74 4469 723d  elf, defaultDir=
+0001ba50: 7369 782e 6d6f 7665 732e 6765 7463 7764  six.moves.getcwd
+0001ba60: 2829 2c20 7769 6c64 6361 7264 3d65 7870  (), wildcard=exp
+0001ba70: 6f72 742e 4441 5441 5f57 494c 4443 4152  ort.DATA_WILDCAR
+0001ba80: 442c 0d0a 2020 2020 2020 2020 2020 2020  D,..            
+0001ba90: 7374 796c 653d 7778 2e46 445f 4f56 4552  style=wx.FD_OVER
+0001baa0: 5752 4954 455f 5052 4f4d 5054 207c 2077  WRITE_PROMPT | w
+0001bab0: 782e 4644 5f53 4156 4520 7c20 7778 2e52  x.FD_SAVE | wx.R
+0001bac0: 4553 495a 455f 424f 5244 4552 0d0a 2020  ESIZE_BORDER..  
+0001bad0: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+0001bae0: 2073 656c 662e 6469 616c 6f67 5f73 6176   self.dialog_sav
+0001baf0: 6569 6d61 6765 203d 2077 782e 4669 6c65  eimage = wx.File
+0001bb00: 4469 616c 6f67 280d 0a20 2020 2020 2020  Dialog(..       
+0001bb10: 2020 2020 2070 6172 656e 743d 7365 6c66       parent=self
+0001bb20: 2c20 6d65 7373 6167 653d 2253 6176 6520  , message="Save 
+0001bb30: 696d 6167 6520 6173 222c 0d0a 2020 2020  image as",..    
+0001bb40: 2020 2020 2020 2020 6465 6661 756c 7444          defaultD
+0001bb50: 6972 3d73 6978 2e6d 6f76 6573 2e67 6574  ir=six.moves.get
+0001bb60: 6377 6428 292c 2077 696c 6463 6172 643d  cwd(), wildcard=
+0001bb70: 6578 706f 7274 2e49 4d41 4745 5f57 494c  export.IMAGE_WIL
+0001bb80: 4443 4152 442c 0d0a 2020 2020 2020 2020  DCARD,..        
+0001bb90: 2020 2020 7374 796c 653d 7778 2e46 445f      style=wx.FD_
+0001bba0: 5341 5645 207c 2077 782e 4644 5f4f 5645  SAVE | wx.FD_OVE
+0001bbb0: 5257 5249 5445 5f50 524f 4d50 5420 7c20  RWRITE_PROMPT | 
+0001bbc0: 7778 2e46 445f 4348 414e 4745 5f44 4952  wx.FD_CHANGE_DIR
+0001bbd0: 207c 2077 782e 5245 5349 5a45 5f42 4f52   | wx.RESIZE_BOR
+0001bbe0: 4445 520d 0a20 2020 2020 2020 2029 0d0a  DER..        )..
+0001bbf0: 2020 2020 2020 2020 7365 6c66 2e64 6961          self.dia
+0001bc00: 6c6f 675f 7361 7665 6368 6174 2020 2020  log_savechat    
+0001bc10: 2e46 696c 7465 7249 6e64 6578 203d 2065  .FilterIndex = e
+0001bc20: 7870 6f72 742e 4348 4154 5f45 5854 532e  xport.CHAT_EXTS.
+0001bc30: 696e 6465 7828 2268 746d 6c22 290d 0a20  index("html").. 
+0001bc40: 2020 2020 2020 2073 656c 662e 6469 616c         self.dial
+0001bc50: 6f67 5f73 6176 6563 6861 7473 2020 202e  og_savechats   .
+0001bc60: 4669 6c74 6572 496e 6465 7820 3d20 6578  FilterIndex = ex
+0001bc70: 706f 7274 2e43 4841 545f 4558 5453 2e69  port.CHAT_EXTS.i
+0001bc80: 6e64 6578 2822 6874 6d6c 2229 0d0a 2020  ndex("html")..  
+0001bc90: 2020 2020 2020 7365 6c66 2e64 6961 6c6f        self.dialo
+0001bca0: 675f 7361 7665 636f 6e74 6163 7473 2e46  g_savecontacts.F
+0001bcb0: 696c 7465 7249 6e64 6578 203d 2065 7870  ilterIndex = exp
+0001bcc0: 6f72 742e 434f 4e54 4143 545f 4558 5453  ort.CONTACT_EXTS
+0001bcd0: 2e69 6e64 6578 2822 6874 6d6c 2229 0d0a  .index("html")..
+0001bce0: 2020 2020 2020 2020 7365 6c66 2e64 6961          self.dia
+0001bcf0: 6c6f 675f 7361 7665 6772 6964 2020 2020  log_savegrid    
+0001bd00: 2e46 696c 7465 7249 6e64 6578 203d 2065  .FilterIndex = e
+0001bd10: 7870 6f72 742e 4441 5441 5f45 5854 532e  xport.DATA_EXTS.
+0001bd20: 696e 6465 7828 2268 746d 6c22 290d 0a20  index("html").. 
+0001bd30: 2020 2020 2020 2073 656c 662e 6469 616c         self.dial
+0001bd40: 6f67 5f73 6176 6569 6d61 6765 2020 202e  og_saveimage   .
+0001bd50: 4669 6c74 6572 496e 6465 7820 3d20 6578  FilterIndex = ex
+0001bd60: 706f 7274 2e49 4d41 4745 5f45 5854 532e  port.IMAGE_EXTS.
+0001bd70: 696e 6465 7828 2270 6e67 2229 0d0a 0d0a  index("png")....
+0001bd80: 2020 2020 2020 2020 7365 6c66 2e54 6f70          self.Top
+0001bd90: 4c65 7665 6c50 6172 656e 742e 7061 6765  LevelParent.page
+0001bda0: 5f64 625f 6c61 7465 7374 203d 2073 656c  _db_latest = sel
+0001bdb0: 660d 0a20 2020 2020 2020 2073 656c 662e  f..        self.
+0001bdc0: 546f 704c 6576 656c 5061 7265 6e74 2e72  TopLevelParent.r
+0001bdd0: 756e 5f63 6f6e 736f 6c65 280d 0a20 2020  un_console(..   
+0001bde0: 2020 2020 2020 2020 2022 7061 6765 203d           "page =
+0001bdf0: 2073 656c 662e 7061 6765 5f64 625f 6c61   self.page_db_la
+0001be00: 7465 7374 2023 2044 6174 6162 6173 6520  test # Database 
+0001be10: 7461 6222 290d 0a20 2020 2020 2020 2073  tab")..        s
+0001be20: 656c 662e 546f 704c 6576 656c 5061 7265  elf.TopLevelPare
+0001be30: 6e74 2e72 756e 5f63 6f6e 736f 6c65 2822  nt.run_console("
+0001be40: 6462 203d 2070 6167 652e 6462 2023 2053  db = page.db # S
+0001be50: 514c 6974 6520 6461 7461 6261 7365 2077  QLite database w
+0001be60: 7261 7070 6572 2229 0d0a 0d0a 2020 2020  rapper")....    
+0001be70: 2020 2020 7365 6c66 2e4c 6179 6f75 7428      self.Layout(
+0001be80: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+0001be90: 746f 6767 6c65 5f66 696c 7465 7228 5472  toggle_filter(Tr
+0001bea0: 7565 290d 0a20 2020 2020 2020 2023 2048  ue)..        # H
+0001beb0: 6163 6b20 746f 2067 6574 2069 6e66 6f2d  ack to get info-
+0001bec0: 7061 6765 206d 756c 7469 6c69 6e65 2054  page multiline T
+0001bed0: 6578 7443 7472 6c73 2074 6f20 6c61 796f  extCtrls to layo
+0001bee0: 7574 2077 6974 686f 7574 2071 7569 726b  ut without quirk
+0001bef0: 732e 0d0a 2020 2020 2020 2020 7365 6c66  s...        self
+0001bf00: 2e6e 6f74 6562 6f6f 6b2e 5365 7453 656c  .notebook.SetSel
+0001bf10: 6563 7469 6f6e 2873 656c 662e 7061 6765  ection(self.page
+0001bf20: 6f72 6465 725b 7365 6c66 2e70 6167 655f  order[self.page_
+0001bf30: 696e 666f 5d29 0d0a 2020 2020 2020 2020  info])..        
+0001bf40: 2320 4861 636b 2074 6f20 6765 7420 6368  # Hack to get ch
+0001bf50: 6174 732d 7061 6765 2066 696c 7465 7220  ats-page filter 
+0001bf60: 7370 6c69 7420 7769 6e64 6f77 2074 6f20  split window to 
+0001bf70: 6c61 796f 7574 2077 6974 686f 7574 2071  layout without q
+0001bf80: 7569 726b 732e 0d0a 2020 2020 2020 2020  uirks...        
+0001bf90: 7365 6c66 2e6e 6f74 6562 6f6f 6b2e 5365  self.notebook.Se
+0001bfa0: 7453 656c 6563 7469 6f6e 2873 656c 662e  tSelection(self.
+0001bfb0: 7061 6765 6f72 6465 725b 7365 6c66 2e70  pageorder[self.p
+0001bfc0: 6167 655f 6368 6174 735d 290d 0a20 2020  age_chats])..   
+0001bfd0: 2020 2020 2073 656c 662e 6e6f 7465 626f       self.notebo
+0001bfe0: 6f6b 2e53 6574 5365 6c65 6374 696f 6e28  ok.SetSelection(
+0001bff0: 7365 6c66 2e70 6167 656f 7264 6572 5b73  self.pageorder[s
+0001c000: 656c 662e 7061 6765 5f73 6561 7263 685d  elf.page_search]
+0001c010: 290d 0a20 2020 2020 2020 2023 2052 6573  )..        # Res
+0001c020: 746f 7265 206c 6173 7420 6163 7469 7665  tore last active
+0001c030: 2070 6167 650d 0a20 2020 2020 2020 2069   page..        i
+0001c040: 6620 6462 2e66 696c 656e 616d 6520 696e  f db.filename in
+0001c050: 2063 6f6e 662e 4c61 7374 4163 7469 7665   conf.LastActive
+0001c060: 5061 6765 205c 0d0a 2020 2020 2020 2020  Page \..        
+0001c070: 616e 6420 636f 6e66 2e4c 6173 7441 6374  and conf.LastAct
+0001c080: 6976 6550 6167 655b 6462 2e66 696c 656e  ivePage[db.filen
+0001c090: 616d 655d 2021 3d20 7365 6c66 2e6e 6f74  ame] != self.not
+0001c0a0: 6562 6f6f 6b2e 5365 6c65 6374 696f 6e3a  ebook.Selection:
+0001c0b0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+0001c0c0: 6c66 2e6e 6f74 6562 6f6f 6b2e 5365 7453  lf.notebook.SetS
+0001c0d0: 656c 6563 7469 6f6e 2863 6f6e 662e 4c61  election(conf.La
+0001c0e0: 7374 4163 7469 7665 5061 6765 5b64 622e  stActivePage[db.
+0001c0f0: 6669 6c65 6e61 6d65 5d29 0d0a 0d0a 2020  filename])....  
+0001c100: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
+0001c110: 2020 2020 2020 2020 7365 6c66 2e6c 6f61          self.loa
+0001c120: 645f 6461 7461 2829 0d0a 2020 2020 2020  d_data()..      
+0001c130: 2020 6669 6e61 6c6c 793a 0d0a 2020 2020    finally:..    
+0001c140: 2020 2020 2020 2020 6275 7379 2e43 6c6f          busy.Clo
+0001c150: 7365 2829 0d0a 2020 2020 2020 2020 7365  se()..        se
+0001c160: 6c66 2e65 6469 745f 7365 6172 6368 616c  lf.edit_searchal
+0001c170: 6c2e 5365 7446 6f63 7573 2829 0d0a 2020  l.SetFocus()..  
+0001c180: 2020 2020 2020 7778 2e43 616c 6c41 6674        wx.CallAft
+0001c190: 6572 2873 656c 662e 6564 6974 5f73 6561  er(self.edit_sea
+0001c1a0: 7263 6861 6c6c 2e53 656c 6563 7441 6c6c  rchall.SelectAll
+0001c1b0: 290d 0a0d 0a0d 0a20 2020 2064 6566 2063  )......    def c
+0001c1c0: 7265 6174 655f 7061 6765 5f63 6861 7473  reate_page_chats
+0001c1d0: 2873 656c 662c 206e 6f74 6562 6f6f 6b29  (self, notebook)
+0001c1e0: 3a0d 0a20 2020 2020 2020 2022 2222 4372  :..        """Cr
+0001c1f0: 6561 7465 7320 6120 7061 6765 2066 6f72  eates a page for
+0001c200: 206c 6973 7469 6e67 2061 6e64 2072 6561   listing and rea
+0001c210: 6469 6e67 2063 6861 7473 2e22 2222 0d0a  ding chats."""..
+0001c220: 2020 2020 2020 2020 7061 6765 203d 2073          page = s
+0001c230: 656c 662e 7061 6765 5f63 6861 7473 203d  elf.page_chats =
+0001c240: 2077 782e 5061 6e65 6c28 7061 7265 6e74   wx.Panel(parent
+0001c250: 3d6e 6f74 6562 6f6f 6b29 0d0a 2020 2020  =notebook)..    
+0001c260: 2020 2020 7365 6c66 2e70 6167 656f 7264      self.pageord
+0001c270: 6572 5b70 6167 655d 203d 206c 656e 2873  er[page] = len(s
+0001c280: 656c 662e 7061 6765 6f72 6465 7229 0d0a  elf.pageorder)..
+0001c290: 2020 2020 2020 2020 6e6f 7465 626f 6f6b          notebook
+0001c2a0: 2e41 6464 5061 6765 2870 6167 652c 2022  .AddPage(page, "
+0001c2b0: 4368 6174 7322 290d 0a20 2020 2020 2020  Chats")..       
+0001c2c0: 2073 697a 6572 203d 2070 6167 652e 5369   sizer = page.Si
+0001c2d0: 7a65 7220 3d20 7778 2e42 6f78 5369 7a65  zer = wx.BoxSize
+0001c2e0: 7228 7778 2e56 4552 5449 4341 4c29 0d0a  r(wx.VERTICAL)..
+0001c2f0: 2020 2020 2020 2020 7370 6c69 7474 6572          splitter
+0001c300: 203d 2073 656c 662e 7370 6c69 7474 6572   = self.splitter
+0001c310: 5f63 6861 7473 203d 2077 782e 5370 6c69  _chats = wx.Spli
+0001c320: 7474 6572 5769 6e64 6f77 280d 0a20 2020  tterWindow(..   
+0001c330: 2020 2020 2020 2020 2070 6172 656e 743d           parent=
+0001c340: 7061 6765 2c20 7374 796c 653d 7778 2e42  page, style=wx.B
+0001c350: 4f52 4445 525f 4e4f 4e45 0d0a 2020 2020  ORDER_NONE..    
+0001c360: 2020 2020 290d 0a20 2020 2020 2020 2073      )..        s
+0001c370: 706c 6974 7465 722e 5365 744d 696e 696d  plitter.SetMinim
+0001c380: 756d 5061 6e65 5369 7a65 2831 3030 290d  umPaneSize(100).
+0001c390: 0a0d 0a20 2020 2020 2020 2070 616e 656c  ...        panel
+0001c3a0: 3120 3d20 7365 6c66 2e70 616e 656c 5f63  1 = self.panel_c
+0001c3b0: 6861 7473 3120 3d20 7778 2e50 616e 656c  hats1 = wx.Panel
+0001c3c0: 2870 6172 656e 743d 7370 6c69 7474 6572  (parent=splitter
+0001c3d0: 290d 0a20 2020 2020 2020 2073 697a 6572  )..        sizer
+0001c3e0: 3120 3d20 7061 6e65 6c31 2e53 697a 6572  1 = panel1.Sizer
+0001c3f0: 203d 2077 782e 426f 7853 697a 6572 2877   = wx.BoxSizer(w
+0001c400: 782e 5645 5254 4943 414c 290d 0a20 2020  x.VERTICAL)..   
+0001c410: 2020 2020 2073 697a 6572 5f74 6f70 203d       sizer_top =
+0001c420: 2077 782e 426f 7853 697a 6572 2877 782e   wx.BoxSizer(wx.
+0001c430: 484f 5249 5a4f 4e54 414c 290d 0a20 2020  HORIZONTAL)..   
+0001c440: 2020 2020 2073 656c 662e 6c61 6265 6c5f       self.label_
+0001c450: 6c69 7374 5f63 6861 7473 203d 2077 782e  list_chats = wx.
+0001c460: 5374 6174 6963 5465 7874 2870 616e 656c  StaticText(panel
+0001c470: 312c 206c 6162 656c 3d22 4126 6c6c 2063  1, label="A&ll c
+0001c480: 6861 7420 656e 7472 6965 7320 696e 2064  hat entries in d
+0001c490: 6174 6162 6173 653a 2229 0d0a 2020 2020  atabase:")..    
+0001c4a0: 2020 2020 7369 7a65 725f 746f 702e 4164      sizer_top.Ad
+0001c4b0: 6428 7365 6c66 2e6c 6162 656c 5f6c 6973  d(self.label_lis
+0001c4c0: 745f 6368 6174 732c 2070 726f 706f 7274  t_chats, proport
+0001c4d0: 696f 6e3d 312c 2062 6f72 6465 723d 352c  ion=1, border=5,
+0001c4e0: 2066 6c61 673d 7778 2e41 4c49 474e 5f42   flag=wx.ALIGN_B
+0001c4f0: 4f54 544f 4d29 0d0a 2020 2020 2020 2020  OTTOM)..        
+0001c500: 6c69 7374 5f63 6861 7473 203d 2073 656c  list_chats = sel
+0001c510: 662e 6c69 7374 5f63 6861 7473 203d 2063  f.list_chats = c
+0001c520: 6f6e 7472 6f6c 732e 536f 7274 6162 6c65  ontrols.Sortable
+0001c530: 4c69 7374 5669 6577 280d 0a20 2020 2020  ListView(..     
+0001c540: 2020 2020 2020 2070 6172 656e 743d 7061         parent=pa
+0001c550: 6e65 6c31 2c20 7374 796c 653d 7778 2e4c  nel1, style=wx.L
+0001c560: 435f 5245 504f 5254 290d 0a20 2020 2020  C_REPORT)..     
+0001c570: 2020 2063 6f6c 756d 6e73 203d 205b 2822     columns = [("
+0001c580: 7469 746c 6522 2c20 2243 6861 7422 292c  title", "Chat"),
+0001c590: 2028 226d 6573 7361 6765 5f63 6f75 6e74   ("message_count
+0001c5a0: 222c 2022 4d65 7373 6167 6573 2229 2c0d  ", "Messages"),.
+0001c5b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c5c0: 2020 2020 2822 6372 6561 7465 645f 6461      ("created_da
+0001c5d0: 7465 7469 6d65 222c 2022 4372 6561 7465  tetime", "Create
+0001c5e0: 6422 292c 0d0a 2020 2020 2020 2020 2020  d"),..          
+0001c5f0: 2020 2020 2020 2020 2028 2266 6972 7374           ("first
+0001c600: 5f6d 6573 7361 6765 5f64 6174 6574 696d  _message_datetim
+0001c610: 6522 2c20 2246 6972 7374 206d 6573 7361  e", "First messa
+0001c620: 6765 2229 2c0d 0a20 2020 2020 2020 2020  ge"),..         
+0001c630: 2020 2020 2020 2020 2020 2822 6c61 7374            ("last
+0001c640: 5f6d 6573 7361 6765 5f64 6174 6574 696d  _message_datetim
+0001c650: 6522 2c20 224c 6173 7420 6d65 7373 6167  e", "Last messag
+0001c660: 6522 292c 0d0a 2020 2020 2020 2020 2020  e"),..          
+0001c670: 2020 2020 2020 2020 2028 2274 7970 655f           ("type_
+0001c680: 6e61 6d65 222c 2022 5479 7065 2229 2c20  name", "Type"), 
+0001c690: 2822 7065 6f70 6c65 222c 2022 5065 6f70  ("people", "Peop
+0001c6a0: 6c65 2229 2c20 5d0d 0a20 2020 2020 2020  le"), ]..       
+0001c6b0: 2066 726d 7420 3d20 6c61 6d62 6461 2072   frmt = lambda r
+0001c6c0: 2c20 633a 2072 5b63 5d2e 7374 7266 7469  , c: r[c].strfti
+0001c6d0: 6d65 2822 2559 2d25 6d2d 2564 2025 483a  me("%Y-%m-%d %H:
+0001c6e0: 254d 2229 2069 6620 722e 6765 7428 6329  %M") if r.get(c)
+0001c6f0: 2065 6c73 6520 2222 0d0a 2020 2020 2020   else ""..      
+0001c700: 2020 6672 6d74 5f64 7420 3d20 6c61 6d62    frmt_dt = lamb
+0001c710: 6461 2072 2c20 633a 2072 5b63 5d2e 7374  da r, c: r[c].st
+0001c720: 7266 7469 6d65 2822 2559 2d25 6d2d 2564  rftime("%Y-%m-%d
+0001c730: 2229 2069 6620 722e 6765 7428 6329 2065  ") if r.get(c) e
+0001c740: 6c73 6520 2222 0d0a 2020 2020 2020 2020  lse ""..        
+0001c750: 666f 726d 6174 7465 7273 203d 207b 2263  formatters = {"c
+0001c760: 7265 6174 6564 5f64 6174 6574 696d 6522  reated_datetime"
+0001c770: 3a20 6672 6d74 5f64 742c 0d0a 2020 2020  : frmt_dt,..    
+0001c780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c790: 2020 2266 6972 7374 5f6d 6573 7361 6765    "first_message
+0001c7a0: 5f64 6174 6574 696d 6522 3a20 6672 6d74  _datetime": frmt
+0001c7b0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0001c7c0: 2020 2020 2020 2020 2022 6c61 7374 5f6d           "last_m
+0001c7d0: 6573 7361 6765 5f64 6174 6574 696d 6522  essage_datetime"
+0001c7e0: 3a20 6672 6d74 2c20 7d0d 0a20 2020 2020  : frmt, }..     
+0001c7f0: 2020 206c 6973 745f 6368 6174 732e 5365     list_chats.Se
+0001c800: 7443 6f6c 756d 6e73 2863 6f6c 756d 6e73  tColumns(columns
+0001c810: 290d 0a20 2020 2020 2020 206c 6973 745f  )..        list_
+0001c820: 6368 6174 732e 5365 7443 6f6c 756d 6e46  chats.SetColumnF
+0001c830: 6f72 6d61 7474 6572 7328 666f 726d 6174  ormatters(format
+0001c840: 7465 7273 290d 0a20 2020 2020 2020 206c  ters)..        l
+0001c850: 6973 745f 6368 6174 732e 5365 7443 6f6c  ist_chats.SetCol
+0001c860: 756d 6e73 4d61 7857 6964 7468 2833 3030  umnsMaxWidth(300
+0001c870: 290d 0a20 2020 2020 2020 2065 6469 745f  )..        edit_
+0001c880: 6368 6174 6669 6c74 6572 203d 2073 656c  chatfilter = sel
+0001c890: 662e 6564 6974 5f63 6861 7466 696c 7465  f.edit_chatfilte
+0001c8a0: 7220 3d20 636f 6e74 726f 6c73 2e48 696e  r = controls.Hin
+0001c8b0: 7465 6454 6578 7443 7472 6c28 0d0a 2020  tedTextCtrl(..  
+0001c8c0: 2020 2020 2020 2020 2020 7061 6e65 6c31            panel1
+0001c8d0: 2c20 2246 696c 7465 7220 6c69 7374 222c  , "Filter list",
+0001c8e0: 2073 697a 653d 2837 352c 202d 3129 290d   size=(75, -1)).
+0001c8f0: 0a20 2020 2020 2020 2065 6469 745f 6368  .        edit_ch
+0001c900: 6174 6669 6c74 6572 2e53 6574 546f 6f6c  atfilter.SetTool
+0001c910: 5469 7028 2246 696c 7465 7220 6974 656d  Tip("Filter item
+0001c920: 7320 696e 2063 6861 7420 6c69 7374 2229  s in chat list")
+0001c930: 0d0a 2020 2020 2020 2020 7365 6c66 2e42  ..        self.B
+0001c940: 696e 6428 7778 2e45 5654 5f54 4558 545f  ind(wx.EVT_TEXT_
+0001c950: 454e 5445 522c 2073 656c 662e 6f6e 5f63  ENTER, self.on_c
+0001c960: 6861 6e67 655f 6368 6174 6669 6c74 6572  hange_chatfilter
+0001c970: 2c20 6564 6974 5f63 6861 7466 696c 7465  , edit_chatfilte
+0001c980: 7229 0d0a 2020 2020 2020 2020 7369 7a65  r)..        size
+0001c990: 725f 746f 702e 4164 6428 6564 6974 5f63  r_top.Add(edit_c
+0001c9a0: 6861 7466 696c 7465 722c 2066 6c61 673d  hatfilter, flag=
+0001c9b0: 7778 2e52 4947 4854 2c20 626f 7264 6572  wx.RIGHT, border
+0001c9c0: 3d31 3529 0d0a 2020 2020 2020 2020 6275  =15)..        bu
+0001c9d0: 7474 6f6e 5f65 7870 6f72 745f 6368 6174  tton_export_chat
+0001c9e0: 7320 3d20 7365 6c66 2e62 7574 746f 6e5f  s = self.button_
+0001c9f0: 6578 706f 7274 5f63 6861 7473 203d 205c  export_chats = \
+0001ca00: 0d0a 2020 2020 2020 2020 2020 2020 7778  ..            wx
+0001ca10: 2e42 7574 746f 6e28 7061 7265 6e74 3d70  .Button(parent=p
+0001ca20: 616e 656c 312c 206c 6162 656c 3d22 4578  anel1, label="Ex
+0001ca30: 7026 6f72 7420 6368 6174 7322 290d 0a20  p&ort chats").. 
+0001ca40: 2020 2020 2020 2073 697a 6572 5f74 6f70         sizer_top
+0001ca50: 2e41 6464 2862 7574 746f 6e5f 6578 706f  .Add(button_expo
+0001ca60: 7274 5f63 6861 7473 290d 0a20 2020 2020  rt_chats)..     
+0001ca70: 2020 2073 656c 662e 4269 6e64 2877 782e     self.Bind(wx.
+0001ca80: 4556 545f 4255 5454 4f4e 2c20 7365 6c66  EVT_BUTTON, self
+0001ca90: 2e6f 6e5f 6578 706f 7274 5f63 6861 7473  .on_export_chats
+0001caa0: 5f6d 656e 752c 2062 7574 746f 6e5f 6578  _menu, button_ex
+0001cab0: 706f 7274 5f63 6861 7473 290d 0a20 2020  port_chats)..   
+0001cac0: 2020 2020 2073 697a 6572 312e 4164 6428       sizer1.Add(
+0001cad0: 7369 7a65 725f 746f 702c 2062 6f72 6465  sizer_top, borde
+0001cae0: 723d 352c 0d0a 2020 2020 2020 2020 2020  r=5,..          
+0001caf0: 2020 2020 2020 2020 2066 6c61 673d 7778           flag=wx
+0001cb00: 2e52 4947 4854 207c 2077 782e 4c45 4654  .RIGHT | wx.LEFT
+0001cb10: 207c 2077 782e 424f 5454 4f4d 207c 2077   | wx.BOTTOM | w
+0001cb20: 782e 4752 4f57 290d 0a0d 0a20 2020 2020  x.GROW)....     
+0001cb30: 2020 2073 656c 662e 4269 6e64 2877 782e     self.Bind(wx.
+0001cb40: 4556 545f 4c49 5354 5f49 5445 4d5f 4143  EVT_LIST_ITEM_AC
+0001cb50: 5449 5641 5445 442c 0d0a 2020 2020 2020  TIVATED,..      
+0001cb60: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0001cb70: 2e6f 6e5f 6368 616e 6765 5f6c 6973 745f  .on_change_list_
+0001cb80: 6368 6174 732c 206c 6973 745f 6368 6174  chats, list_chat
+0001cb90: 7329 0d0a 2020 2020 2020 2020 6c69 7374  s)..        list
+0001cba0: 5f63 6861 7473 2e42 696e 6428 7778 2e45  _chats.Bind(wx.E
+0001cbb0: 5654 5f43 4f4e 5445 5854 5f4d 454e 552c  VT_CONTEXT_MENU,
+0001cbc0: 2073 656c 662e 6f6e 5f6d 656e 755f 6c69   self.on_menu_li
+0001cbd0: 7374 5f63 6861 7473 290d 0a20 2020 2020  st_chats)..     
+0001cbe0: 2020 206c 6973 745f 6368 6174 732e 4269     list_chats.Bi
+0001cbf0: 6e64 2877 782e 4556 545f 4348 4152 5f48  nd(wx.EVT_CHAR_H
+0001cc00: 4f4f 4b2c 2020 2020 7365 6c66 2e6f 6e5f  OOK,    self.on_
+0001cc10: 6c69 7374 5f63 6861 7473 5f6b 6579 290d  list_chats_key).
+0001cc20: 0a0d 0a20 2020 2020 2020 2073 697a 6572  ...        sizer
+0001cc30: 312e 4164 6428 6c69 7374 5f63 6861 7473  1.Add(list_chats
+0001cc40: 2c20 7072 6f70 6f72 7469 6f6e 3d31 2c20  , proportion=1, 
+0001cc50: 626f 7264 6572 3d35 2c0d 0a20 2020 2020  border=5,..     
+0001cc60: 2020 2020 2020 2020 2020 2020 2020 666c                fl
+0001cc70: 6167 3d77 782e 4752 4f57 207c 2077 782e  ag=wx.GROW | wx.
+0001cc80: 4c45 4654 207c 2077 782e 5249 4748 5429  LEFT | wx.RIGHT)
+0001cc90: 0d0a 0d0a 2020 2020 2020 2020 7061 6e65  ....        pane
+0001cca0: 6c32 203d 2073 656c 662e 7061 6e65 6c5f  l2 = self.panel_
+0001ccb0: 6368 6174 7332 203d 2077 782e 5061 6e65  chats2 = wx.Pane
+0001ccc0: 6c28 7061 7265 6e74 3d73 706c 6974 7465  l(parent=splitte
+0001ccd0: 7229 0d0a 2020 2020 2020 2020 7369 7a65  r)..        size
+0001cce0: 7232 203d 2070 616e 656c 322e 5369 7a65  r2 = panel2.Size
+0001ccf0: 7220 3d20 7778 2e42 6f78 5369 7a65 7228  r = wx.BoxSizer(
+0001cd00: 7778 2e56 4552 5449 4341 4c29 0d0a 0d0a  wx.VERTICAL)....
+0001cd10: 2020 2020 2020 2020 7370 6c69 7474 6572          splitter
+0001cd20: 5f73 7463 203d 2073 656c 662e 7370 6c69  _stc = self.spli
+0001cd30: 7474 6572 5f73 7463 203d 205c 0d0a 2020  tter_stc = \..  
+0001cd40: 2020 2020 2020 2020 2020 7778 2e53 706c            wx.Spl
+0001cd50: 6974 7465 7257 696e 646f 7728 7061 7265  itterWindow(pare
+0001cd60: 6e74 3d70 616e 656c 322c 2073 7479 6c65  nt=panel2, style
+0001cd70: 3d77 782e 424f 5244 4552 5f4e 4f4e 4529  =wx.BORDER_NONE)
+0001cd80: 0d0a 2020 2020 2020 2020 7370 6c69 7474  ..        splitt
+0001cd90: 6572 5f73 7463 2e53 6574 4d69 6e69 6d75  er_stc.SetMinimu
+0001cda0: 6d50 616e 6553 697a 6528 3130 3029 0d0a  mPaneSize(100)..
+0001cdb0: 2020 2020 2020 2020 7061 6e65 6c5f 7374          panel_st
+0001cdc0: 6331 203d 2073 656c 662e 7061 6e65 6c5f  c1 = self.panel_
+0001cdd0: 7374 6331 203d 2077 782e 5061 6e65 6c28  stc1 = wx.Panel(
+0001cde0: 7061 7265 6e74 3d73 706c 6974 7465 725f  parent=splitter_
+0001cdf0: 7374 6329 0d0a 2020 2020 2020 2020 7061  stc)..        pa
+0001ce00: 6e65 6c5f 7374 6332 203d 2073 656c 662e  nel_stc2 = self.
+0001ce10: 7061 6e65 6c5f 7374 6332 203d 2077 782e  panel_stc2 = wx.
+0001ce20: 5061 6e65 6c28 7061 7265 6e74 3d73 706c  Panel(parent=spl
+0001ce30: 6974 7465 725f 7374 6329 0d0a 2020 2020  itter_stc)..    
+0001ce40: 2020 2020 7369 7a65 725f 7374 6331 203d      sizer_stc1 =
+0001ce50: 2070 616e 656c 5f73 7463 312e 5369 7a65   panel_stc1.Size
+0001ce60: 7220 3d20 7778 2e42 6f78 5369 7a65 7228  r = wx.BoxSizer(
+0001ce70: 7778 2e56 4552 5449 4341 4c29 0d0a 2020  wx.VERTICAL)..  
+0001ce80: 2020 2020 2020 7369 7a65 725f 7374 6332        sizer_stc2
+0001ce90: 203d 2070 616e 656c 5f73 7463 322e 5369   = panel_stc2.Si
+0001cea0: 7a65 7220 3d20 7778 2e42 6f78 5369 7a65  zer = wx.BoxSize
+0001ceb0: 7228 7778 2e56 4552 5449 4341 4c29 0d0a  r(wx.VERTICAL)..
+0001cec0: 2020 2020 2020 2020 7369 7a65 725f 7374          sizer_st
+0001ced0: 6320 203d 2077 782e 426f 7853 697a 6572  c  = wx.BoxSizer
+0001cee0: 2877 782e 484f 5249 5a4f 4e54 414c 290d  (wx.HORIZONTAL).
+0001cef0: 0a0d 0a20 2020 2020 2020 2073 697a 6572  ...        sizer
+0001cf00: 5f68 6561 6465 7220 3d20 7778 2e42 6f78  _header = wx.Box
+0001cf10: 5369 7a65 7228 7778 2e48 4f52 495a 4f4e  Sizer(wx.HORIZON
+0001cf20: 5441 4c29 0d0a 2020 2020 2020 2020 6c61  TAL)..        la
+0001cf30: 6265 6c5f 6368 6174 203d 2073 656c 662e  bel_chat = self.
+0001cf40: 6c61 6265 6c5f 6368 6174 203d 2077 782e  label_chat = wx.
+0001cf50: 5374 6174 6963 5465 7874 280d 0a20 2020  StaticText(..   
+0001cf60: 2020 2020 2020 2020 2070 6172 656e 743d           parent=
+0001cf70: 7061 6e65 6c5f 7374 6331 2c20 6c61 6265  panel_stc1, labe
+0001cf80: 6c3d 2226 4368 6174 3a22 2c20 6e61 6d65  l="&Chat:", name
+0001cf90: 3d22 6368 6174 5f68 6973 746f 7279 5f6c  ="chat_history_l
+0001cfa0: 6162 656c 2229 0d0a 0d0a 2020 2020 2020  abel")....      
+0001cfb0: 2020 7462 203d 2073 656c 662e 7462 5f63    tb = self.tb_c
+0001cfc0: 6861 7420 3d20 5c0d 0a20 2020 2020 2020  hat = \..       
+0001cfd0: 2020 2020 2077 782e 546f 6f6c 4261 7228       wx.ToolBar(
+0001cfe0: 7061 7265 6e74 3d70 616e 656c 5f73 7463  parent=panel_stc
+0001cff0: 312c 2073 7479 6c65 3d77 782e 5442 5f46  1, style=wx.TB_F
+0001d000: 4c41 5420 7c20 7778 2e54 425f 4e4f 4449  LAT | wx.TB_NODI
+0001d010: 5649 4445 5229 0d0a 2020 2020 2020 2020  VIDER)..        
+0001d020: 7462 2e53 6574 546f 6f6c 4269 746d 6170  tb.SetToolBitmap
+0001d030: 5369 7a65 2828 3234 2c20 3234 2929 0d0a  Size((24, 24))..
+0001d040: 2020 2020 2020 2020 7462 2e41 6464 4368          tb.AddCh
+0001d050: 6563 6b54 6f6f 6c28 7778 2e49 445f 4a55  eckTool(wx.ID_JU
+0001d060: 4d50 5f54 4f2c 2022 222c 2062 6974 6d61  MP_TO, "", bitma
+0001d070: 7031 3d69 6d61 6765 732e 546f 6f6c 6261  p1=images.Toolba
+0001d080: 7254 696d 656c 696e 652e 4269 746d 6170  rTimeline.Bitmap
+0001d090: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0001d0a0: 2020 2020 2020 2020 2020 2073 686f 7274             short
+0001d0b0: 4865 6c70 3d22 546f 6767 6c65 2074 696d  Help="Toggle tim
+0001d0c0: 656c 696e 6520 7061 6e65 6c20 2028 416c  eline panel  (Al
+0001d0d0: 742d 4a29 2229 0d0a 2020 2020 2020 2020  t-J)")..        
+0001d0e0: 7462 2e41 6464 4368 6563 6b54 6f6f 6c28  tb.AddCheckTool(
+0001d0f0: 7778 2e49 445f 5a4f 4f4d 5f31 3030 2c20  wx.ID_ZOOM_100, 
+0001d100: 2222 2c0d 0a20 2020 2020 2020 2020 2020  "",..           
+0001d110: 2020 2020 2020 2020 2020 2020 2062 6974               bit
+0001d120: 6d61 7031 3d69 6d61 6765 732e 546f 6f6c  map1=images.Tool
+0001d130: 6261 724d 6178 696d 697a 652e 4269 746d  barMaximize.Bitm
+0001d140: 6170 2c0d 0a20 2020 2020 2020 2020 2020  ap,..           
+0001d150: 2020 2020 2020 2020 2020 2020 2073 686f               sho
+0001d160: 7274 4865 6c70 3d22 4d61 7869 6d69 7a65  rtHelp="Maximize
+0001d170: 2063 6861 7420 7061 6e65 6c20 2028 416c   chat panel  (Al
+0001d180: 742d 4d29 2229 0d0a 2020 2020 2020 2020  t-M)")..        
+0001d190: 7462 2e41 6464 546f 6f6c 2020 2020 2028  tb.AddTool     (
+0001d1a0: 7778 2e49 445f 5345 5455 502c 2022 222c  wx.ID_SETUP, "",
+0001d1b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001d1c0: 2020 2020 2020 2020 2020 6269 746d 6170            bitmap
+0001d1d0: 3d69 6d61 6765 732e 546f 6f6c 6261 7254  =images.ToolbarT
+0001d1e0: 6578 742e 4269 746d 6170 2c0d 0a20 2020  ext.Bitmap,..   
+0001d1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d200: 2020 2020 2073 686f 7274 4865 6c70 3d22       shortHelp="
+0001d210: 5365 7420 6368 6174 2068 6973 746f 7279  Set chat history
+0001d220: 2074 6578 7420 7369 7a65 2229 0d0a 2020   text size")..  
+0001d230: 2020 2020 2020 7462 2e41 6464 4368 6563        tb.AddChec
+0001d240: 6b54 6f6f 6c28 7778 2e49 445f 5052 4f50  kTool(wx.ID_PROP
+0001d250: 4552 5449 4553 2c20 2222 2c0d 0a20 2020  ERTIES, "",..   
+0001d260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d270: 2020 2020 2062 6974 6d61 7031 3d69 6d61       bitmap1=ima
+0001d280: 6765 732e 546f 6f6c 6261 7253 7461 7473  ges.ToolbarStats
+0001d290: 2e42 6974 6d61 702c 0d0a 2020 2020 2020  .Bitmap,..      
+0001d2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d2b0: 2020 7368 6f72 7448 656c 703d 2254 6f67    shortHelp="Tog
+0001d2c0: 676c 6520 6368 6174 2073 7461 7469 7374  gle chat statist
+0001d2d0: 6963 7320 2028 416c 742d 4929 2229 0d0a  ics  (Alt-I)")..
+0001d2e0: 2020 2020 2020 2020 7462 2e41 6464 4368          tb.AddCh
+0001d2f0: 6563 6b54 6f6f 6c28 7778 2e49 445f 4d4f  eckTool(wx.ID_MO
+0001d300: 5245 2c20 2222 2c20 6269 746d 6170 313d  RE, "", bitmap1=
+0001d310: 696d 6167 6573 2e54 6f6f 6c62 6172 4669  images.ToolbarFi
+0001d320: 6c74 6572 2e42 6974 6d61 702c 0d0a 2020  lter.Bitmap,..  
+0001d330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d340: 2020 2020 2020 7368 6f72 7448 656c 703d        shortHelp=
+0001d350: 2254 6f67 676c 6520 6669 6c74 6572 2070  "Toggle filter p
+0001d360: 616e 656c 2020 2841 6c74 2d47 2922 290d  anel  (Alt-G)").
+0001d370: 0a20 2020 2020 2020 2074 622e 5265 616c  .        tb.Real
+0001d380: 697a 6528 290d 0a20 2020 2020 2020 2073  ize()..        s
+0001d390: 656c 662e 4269 6e64 2877 782e 4556 545f  elf.Bind(wx.EVT_
+0001d3a0: 544f 4f4c 2c20 7365 6c66 2e6f 6e5f 746f  TOOL, self.on_to
+0001d3b0: 6767 6c65 5f74 696d 656c 696e 652c 2069  ggle_timeline, i
+0001d3c0: 643d 7778 2e49 445f 4a55 4d50 5f54 4f29  d=wx.ID_JUMP_TO)
+0001d3d0: 0d0a 2020 2020 2020 2020 7365 6c66 2e42  ..        self.B
+0001d3e0: 696e 6428 7778 2e45 5654 5f54 4f4f 4c2c  ind(wx.EVT_TOOL,
+0001d3f0: 2073 656c 662e 6f6e 5f74 6f67 676c 655f   self.on_toggle_
+0001d400: 6d61 7869 6d69 7a65 2c20 6964 3d77 782e  maximize, id=wx.
+0001d410: 4944 5f5a 4f4f 4d5f 3130 3029 0d0a 2020  ID_ZOOM_100)..  
+0001d420: 2020 2020 2020 7365 6c66 2e42 696e 6428        self.Bind(
+0001d430: 7778 2e45 5654 5f54 4f4f 4c2c 2073 656c  wx.EVT_TOOL, sel
+0001d440: 662e 6f6e 5f6d 656e 755f 7369 7a65 5f63  f.on_menu_size_c
+0001d450: 6861 742c 2020 6964 3d77 782e 4944 5f53  hat,  id=wx.ID_S
+0001d460: 4554 5550 290d 0a20 2020 2020 2020 2073  ETUP)..        s
+0001d470: 656c 662e 4269 6e64 2877 782e 4556 545f  elf.Bind(wx.EVT_
+0001d480: 544f 4f4c 2c20 7365 6c66 2e6f 6e5f 746f  TOOL, self.on_to
+0001d490: 6767 6c65 5f73 7461 7473 2c20 2020 2069  ggle_stats,    i
+0001d4a0: 643d 7778 2e49 445f 5052 4f50 4552 5449  d=wx.ID_PROPERTI
+0001d4b0: 4553 290d 0a20 2020 2020 2020 2073 656c  ES)..        sel
+0001d4c0: 662e 4269 6e64 2877 782e 4556 545f 544f  f.Bind(wx.EVT_TO
+0001d4d0: 4f4c 2c20 7365 6c66 2e6f 6e5f 746f 6767  OL, self.on_togg
+0001d4e0: 6c65 5f66 696c 7465 722c 2020 2069 643d  le_filter,   id=
+0001d4f0: 7778 2e49 445f 4d4f 5245 290d 0a0d 0a20  wx.ID_MORE).... 
+0001d500: 2020 2020 2020 2062 7574 746f 6e5f 6163         button_ac
+0001d510: 7469 6f6e 203d 2073 656c 662e 6275 7474  tion = self.butt
+0001d520: 6f6e 5f61 6374 696f 6e5f 6368 6174 203d  on_action_chat =
+0001d530: 205c 0d0a 2020 2020 2020 2020 2020 2020   \..            
+0001d540: 7778 2e42 7574 746f 6e28 7061 7265 6e74  wx.Button(parent
+0001d550: 3d70 616e 656c 5f73 7463 312c 206c 6162  =panel_stc1, lab
+0001d560: 656c 3d22 2641 6374 696f 6e73 202e 2e22  el="&Actions .."
+0001d570: 290d 0a20 2020 2020 2020 2062 7574 746f  )..        butto
+0001d580: 6e5f 6578 706f 7274 203d 2073 656c 662e  n_export = self.
+0001d590: 6275 7474 6f6e 5f65 7870 6f72 745f 6368  button_export_ch
+0001d5a0: 6174 203d 205c 0d0a 2020 2020 2020 2020  at = \..        
+0001d5b0: 2020 2020 7778 2e42 7574 746f 6e28 7061      wx.Button(pa
+0001d5c0: 7265 6e74 3d70 616e 656c 5f73 7463 312c  rent=panel_stc1,
+0001d5d0: 206c 6162 656c 3d22 2645 7870 6f72 7420   label="&Export 
+0001d5e0: 6d65 7373 6167 6573 2074 6f20 6669 6c65  messages to file
+0001d5f0: 2229 0d0a 2020 2020 2020 2020 6275 7474  ")..        butt
+0001d600: 6f6e 5f61 6374 696f 6e2e 5365 7454 6f6f  on_action.SetToo
+0001d610: 6c54 6970 2822 4f70 656e 2073 7562 6d65  lTip("Open subme
+0001d620: 6e75 2229 0d0a 2020 2020 2020 2020 6275  nu")..        bu
+0001d630: 7474 6f6e 5f65 7870 6f72 742e 5365 7454  tton_export.SetT
+0001d640: 6f6f 6c54 6970 2822 4578 706f 7274 2063  oolTip("Export c
+0001d650: 7572 7265 6e74 6c79 2073 686f 776e 206d  urrently shown m
+0001d660: 6573 7361 6765 7320 746f 2061 2066 696c  essages to a fil
+0001d670: 6522 290d 0a20 2020 2020 2020 2073 656c  e")..        sel
+0001d680: 662e 4269 6e64 2877 782e 4556 545f 4255  f.Bind(wx.EVT_BU
+0001d690: 5454 4f4e 2c20 7365 6c66 2e6f 6e5f 6d65  TTON, self.on_me
+0001d6a0: 6e75 5f6c 6973 745f 6368 6174 732c 2062  nu_list_chats, b
+0001d6b0: 7574 746f 6e5f 6163 7469 6f6e 290d 0a20  utton_action).. 
+0001d6c0: 2020 2020 2020 2073 656c 662e 4269 6e64         self.Bind
+0001d6d0: 2877 782e 4556 545f 4255 5454 4f4e 2c20  (wx.EVT_BUTTON, 
+0001d6e0: 7365 6c66 2e6f 6e5f 6578 706f 7274 5f63  self.on_export_c
+0001d6f0: 6861 742c 2062 7574 746f 6e5f 6578 706f  hat, button_expo
+0001d700: 7274 290d 0a20 2020 2020 2020 2073 697a  rt)..        siz
+0001d710: 6572 5f68 6561 6465 722e 4164 6428 6c61  er_header.Add(la
+0001d720: 6265 6c5f 6368 6174 2c20 7072 6f70 6f72  bel_chat, propor
+0001d730: 7469 6f6e 3d31 2c20 626f 7264 6572 3d35  tion=1, border=5
+0001d740: 2c20 666c 6167 3d77 782e 4c45 4654 207c  , flag=wx.LEFT |
+0001d750: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001d760: 2020 2020 2020 2020 2020 2077 782e 414c             wx.AL
+0001d770: 4947 4e5f 424f 5454 4f4d 290d 0a20 2020  IGN_BOTTOM)..   
+0001d780: 2020 2020 2073 697a 6572 5f68 6561 6465       sizer_heade
+0001d790: 722e 4164 6428 7462 2c20 666c 6167 3d77  r.Add(tb, flag=w
+0001d7a0: 782e 414c 4947 4e5f 4345 4e54 4552 5f56  x.ALIGN_CENTER_V
+0001d7b0: 4552 5449 4341 4c29 0d0a 2020 2020 2020  ERTICAL)..      
+0001d7c0: 2020 7369 7a65 725f 6865 6164 6572 2e41    sizer_header.A
+0001d7d0: 6464 2862 7574 746f 6e5f 6163 7469 6f6e  dd(button_action
+0001d7e0: 2c20 626f 7264 6572 3d31 352c 2066 6c61  , border=15, fla
+0001d7f0: 673d 7778 2e4c 4546 5420 7c0d 0a20 2020  g=wx.LEFT |..   
+0001d800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d810: 2020 2020 2020 7778 2e41 4c49 474e 5f43        wx.ALIGN_C
+0001d820: 454e 5445 525f 5645 5254 4943 414c 290d  ENTER_VERTICAL).
+0001d830: 0a20 2020 2020 2020 2073 697a 6572 5f68  .        sizer_h
+0001d840: 6561 6465 722e 4164 6428 6275 7474 6f6e  eader.Add(button
+0001d850: 5f65 7870 6f72 742c 2062 6f72 6465 723d  _export, border=
+0001d860: 352c 2066 6c61 673d 7778 2e4c 4546 5420  5, flag=wx.LEFT 
+0001d870: 7c0d 0a20 2020 2020 2020 2020 2020 2020  |..             
+0001d880: 2020 2020 2020 2020 2020 2020 7778 2e41              wx.A
+0001d890: 4c49 474e 5f43 454e 5445 525f 5645 5254  LIGN_CENTER_VERT
+0001d8a0: 4943 414c 290d 0a0d 0a20 2020 2020 2020  ICAL)....       
+0001d8b0: 2074 696d 656c 696e 6520 3d20 7365 6c66   timeline = self
+0001d8c0: 2e6c 6973 745f 7469 6d65 6c69 6e65 203d  .list_timeline =
+0001d8d0: 2043 6861 7443 6f6e 7465 6e74 5469 6d65   ChatContentTime
+0001d8e0: 6c69 6e65 2870 616e 656c 5f73 7463 312c  line(panel_stc1,
+0001d8f0: 2073 697a 653d 2831 3530 2c20 2d31 2929   size=(150, -1))
+0001d900: 0d0a 2020 2020 2020 2020 7469 6d65 6c69  ..        timeli
+0001d910: 6e65 2e48 6964 6528 290d 0a20 2020 2020  ne.Hide()..     
+0001d920: 2020 2073 656c 662e 4269 6e64 2877 782e     self.Bind(wx.
+0001d930: 4556 545f 4c49 5354 424f 582c 2073 656c  EVT_LISTBOX, sel
+0001d940: 662e 6f6e 5f73 656c 6563 745f 7469 6d65  f.on_select_time
+0001d950: 6c69 6e65 2c20 7469 6d65 6c69 6e65 290d  line, timeline).
+0001d960: 0a20 2020 2020 2020 2074 696d 656c 696e  .        timelin
+0001d970: 652e 4269 6e64 2877 782e 4556 545f 4b49  e.Bind(wx.EVT_KI
+0001d980: 4c4c 5f46 4f43 5553 2c20 7365 6c66 2e6f  LL_FOCUS, self.o
+0001d990: 6e5f 626c 7572 5f74 696d 656c 696e 6529  n_blur_timeline)
+0001d9a0: 0d0a 2020 2020 2020 2020 7374 6320 3d20  ..        stc = 
+0001d9b0: 7365 6c66 2e73 7463 5f68 6973 746f 7279  self.stc_history
+0001d9c0: 203d 2043 6861 7443 6f6e 7465 6e74 5354   = ChatContentST
+0001d9d0: 4328 0d0a 2020 2020 2020 2020 2020 2020  C(..            
+0001d9e0: 7061 7265 6e74 3d70 616e 656c 5f73 7463  parent=panel_stc
+0001d9f0: 312c 2073 7479 6c65 3d77 782e 424f 5244  1, style=wx.BORD
+0001da00: 4552 5f53 5441 5449 432c 206e 616d 653d  ER_STATIC, name=
+0001da10: 2263 6861 745f 6869 7374 6f72 7922 290d  "chat_history").
+0001da20: 0a20 2020 2020 2020 2073 7463 2e53 6574  .        stc.Set
+0001da30: 4461 7461 6261 7365 5061 6765 2873 656c  DatabasePage(sel
+0001da40: 6629 0d0a 2020 2020 2020 2020 7374 632e  f)..        stc.
+0001da50: 5354 432e 4269 6e64 2877 782e 7374 632e  STC.Bind(wx.stc.
+0001da60: 4556 545f 5354 435f 5550 4441 5445 5549  EVT_STC_UPDATEUI
+0001da70: 2c20 7365 6c66 2e6f 6e5f 7363 726f 6c6c  , self.on_scroll
+0001da80: 5f63 6861 745f 6869 7374 6f72 7929 0d0a  _chat_history)..
+0001da90: 2020 2020 2020 2020 6874 6d6c 5f73 7461          html_sta
+0001daa0: 7473 203d 2073 656c 662e 6874 6d6c 5f73  ts = self.html_s
+0001dab0: 7461 7473 203d 2077 782e 6874 6d6c 2e48  tats = wx.html.H
+0001dac0: 746d 6c57 696e 646f 7728 7061 7265 6e74  tmlWindow(parent
+0001dad0: 3d70 616e 656c 5f73 7463 3129 0d0a 2020  =panel_stc1)..  
+0001dae0: 2020 2020 2020 6874 6d6c 5f73 7461 7473        html_stats
+0001daf0: 2e42 696e 6428 7778 2e68 746d 6c2e 4556  .Bind(wx.html.EV
+0001db00: 545f 4854 4d4c 5f4c 494e 4b5f 434c 4943  T_HTML_LINK_CLIC
+0001db10: 4b45 442c 2073 656c 662e 6f6e 5f63 6c69  KED, self.on_cli
+0001db20: 636b 5f68 746d 6c5f 7374 6174 7329 0d0a  ck_html_stats)..
+0001db30: 2020 2020 2020 2020 6874 6d6c 5f73 7461          html_sta
+0001db40: 7473 2e42 696e 6428 7778 2e45 5654 5f43  ts.Bind(wx.EVT_C
+0001db50: 4f4e 5445 5854 5f4d 454e 552c 2020 2020  ONTEXT_MENU,    
+0001db60: 2020 2020 2020 2073 656c 662e 6f6e 5f72         self.on_r
+0001db70: 6967 6874 636c 6963 6b5f 6874 6d6c 290d  ightclick_html).
+0001db80: 0a20 2020 2020 2020 2068 746d 6c5f 7374  .        html_st
+0001db90: 6174 732e 4269 6e64 2877 782e 4556 545f  ats.Bind(wx.EVT_
+0001dba0: 5249 4748 545f 5550 2c20 2020 2020 2020  RIGHT_UP,       
+0001dbb0: 2020 2020 2020 2020 7365 6c66 2e6f 6e5f          self.on_
+0001dbc0: 7269 6768 7463 6c69 636b 5f68 746d 6c29  rightclick_html)
+0001dbd0: 0d0a 2020 2020 2020 2020 6874 6d6c 5f73  ..        html_s
+0001dbe0: 7461 7473 2e42 696e 6428 7778 2e45 5654  tats.Bind(wx.EVT
+0001dbf0: 5f53 4352 4f4c 4c57 494e 2c20 2020 2020  _SCROLLWIN,     
+0001dc00: 2020 2020 2020 2020 2073 656c 662e 6f6e           self.on
+0001dc10: 5f73 6372 6f6c 6c5f 6874 6d6c 5f73 7461  _scroll_html_sta
+0001dc20: 7473 290d 0a20 2020 2020 2020 2068 746d  ts)..        htm
+0001dc30: 6c5f 7374 6174 732e 4269 6e64 2877 782e  l_stats.Bind(wx.
+0001dc40: 4556 545f 5349 5a45 2c20 2020 2020 2020  EVT_SIZE,       
+0001dc50: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0001dc60: 2e6f 6e5f 7369 7a65 5f68 746d 6c5f 7374  .on_size_html_st
+0001dc70: 6174 7329 0d0a 2020 2020 2020 2020 6874  ats)..        ht
+0001dc80: 6d6c 5f73 7461 7473 2e48 6964 6528 290d  ml_stats.Hide().
+0001dc90: 0a0d 0a20 2020 2020 2020 2073 697a 6572  ...        sizer
+0001dca0: 5f73 7463 2e41 6464 2874 696d 656c 696e  _stc.Add(timelin
+0001dcb0: 652c 2066 6c61 673d 7778 2e47 524f 5729  e, flag=wx.GROW)
+0001dcc0: 0d0a 2020 2020 2020 2020 7369 7a65 725f  ..        sizer_
+0001dcd0: 7374 632e 4164 6428 7374 632c 2070 726f  stc.Add(stc, pro
+0001dce0: 706f 7274 696f 6e3d 312c 2066 6c61 673d  portion=1, flag=
+0001dcf0: 7778 2e47 524f 5729 0d0a 2020 2020 2020  wx.GROW)..      
+0001dd00: 2020 7369 7a65 725f 7374 6331 2e41 6464    sizer_stc1.Add
+0001dd10: 2873 697a 6572 5f68 6561 6465 722c 2062  (sizer_header, b
+0001dd20: 6f72 6465 723d 352c 2066 6c61 673d 7778  order=5, flag=wx
+0001dd30: 2e47 524f 5720 7c20 7778 2e52 4947 4854  .GROW | wx.RIGHT
+0001dd40: 207c 0d0a 2020 2020 2020 2020 2020 2020   |..            
+0001dd50: 2020 2020 2020 2020 2020 2077 782e 424f             wx.BO
+0001dd60: 5454 4f4d 290d 0a20 2020 2020 2020 2073  TTOM)..        s
+0001dd70: 697a 6572 5f73 7463 312e 4164 6428 7369  izer_stc1.Add(si
+0001dd80: 7a65 725f 7374 632c 2070 726f 706f 7274  zer_stc, proport
+0001dd90: 696f 6e3d 312c 2062 6f72 6465 723d 352c  ion=1, border=5,
+0001dda0: 2066 6c61 673d 7778 2e47 524f 5729 0d0a   flag=wx.GROW)..
+0001ddb0: 2020 2020 2020 2020 7369 7a65 725f 7374          sizer_st
+0001ddc0: 6331 2e41 6464 2868 746d 6c5f 7374 6174  c1.Add(html_stat
+0001ddd0: 732c 2070 726f 706f 7274 696f 6e3d 312c  s, proportion=1,
+0001dde0: 2066 6c61 673d 7778 2e47 524f 5729 0d0a   flag=wx.GROW)..
+0001ddf0: 0d0a 2020 2020 2020 2020 6c61 6265 6c5f  ..        label_
+0001de00: 6669 6c74 6572 203d 205c 0d0a 2020 2020  filter = \..    
+0001de10: 2020 2020 2020 2020 7778 2e53 7461 7469          wx.Stati
+0001de20: 6354 6578 7428 7061 7265 6e74 3d70 616e  cText(parent=pan
+0001de30: 656c 5f73 7463 322c 206c 6162 656c 3d22  el_stc2, label="
+0001de40: 4669 6e64 206d 6573 7361 6765 7320 7769  Find messages wi
+0001de50: 7468 2026 7465 7874 3a22 290d 0a20 2020  th &text:")..   
+0001de60: 2020 2020 2065 6469 745f 6669 6c74 6572       edit_filter
+0001de70: 203d 2073 656c 662e 6564 6974 5f66 696c   = self.edit_fil
+0001de80: 7465 7274 6578 7420 3d20 7778 2e54 6578  tertext = wx.Tex
+0001de90: 7443 7472 6c28 0d0a 2020 2020 2020 2020  tCtrl(..        
+0001dea0: 2020 2020 7061 7265 6e74 3d70 616e 656c      parent=panel
+0001deb0: 5f73 7463 322c 2073 697a 653d 2831 3030  _stc2, size=(100
+0001dec0: 2c20 2d31 292c 2073 7479 6c65 3d77 782e  , -1), style=wx.
+0001ded0: 5445 5f50 524f 4345 5353 5f45 4e54 4552  TE_PROCESS_ENTER
+0001dee0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+0001def0: 4269 6e64 2877 782e 4556 545f 5445 5854  Bind(wx.EVT_TEXT
+0001df00: 5f45 4e54 4552 2c20 7365 6c66 2e6f 6e5f  _ENTER, self.on_
+0001df10: 6669 6c74 6572 5f63 6861 742c 2065 6469  filter_chat, edi
+0001df20: 745f 6669 6c74 6572 290d 0a20 2020 2020  t_filter)..     
+0001df30: 2020 2065 6469 745f 6669 6c74 6572 2e53     edit_filter.S
+0001df40: 6574 546f 6f6c 5469 7028 2246 696e 6420  etToolTip("Find 
+0001df50: 6d65 7373 6167 6573 2063 6f6e 7461 696e  messages contain
+0001df60: 696e 6720 7468 6520 6578 6163 7420 7465  ing the exact te
+0001df70: 7874 2229 0d0a 2020 2020 2020 2020 6c61  xt")..        la
+0001df80: 6265 6c5f 7261 6e67 6520 3d20 7778 2e53  bel_range = wx.S
+0001df90: 7461 7469 6354 6578 7428 0d0a 2020 2020  taticText(..    
+0001dfa0: 2020 2020 2020 2020 7061 7265 6e74 3d70          parent=p
+0001dfb0: 616e 656c 5f73 7463 322c 206c 6162 656c  anel_stc2, label
+0001dfc0: 3d22 5368 6f77 206d 6573 7361 6765 7320  ="Show messages 
+0001dfd0: 6672 6f6d 2074 696d 6520 7065 7269 6f26  from time perio&
+0001dfe0: 643a 2229 0d0a 2020 2020 2020 2020 6474  d:")..        dt
+0001dff0: 7369 7a65 203d 2028 696e 7428 3930 202a  size = (int(90 *
+0001e000: 2063 6f6e 7472 6f6c 732e 434f 4d42 4f5f   controls.COMBO_
+0001e010: 5749 4454 485f 4641 4354 4f52 292c 202d  WIDTH_FACTOR), -
+0001e020: 3129 0d0a 2020 2020 2020 2020 6461 7465  1)..        date
+0001e030: 3120 3d20 7365 6c66 2e65 6469 745f 6669  1 = self.edit_fi
+0001e040: 6c74 6572 6461 7465 3120 3d20 636f 6e74  lterdate1 = cont
+0001e050: 726f 6c73 2e44 6174 6550 6963 6b65 7243  rols.DatePickerC
+0001e060: 7472 6c28 7061 6e65 6c5f 7374 6332 2c20  trl(panel_stc2, 
+0001e070: 7369 7a65 3d64 7473 697a 6529 0d0a 2020  size=dtsize)..  
+0001e080: 2020 2020 2020 6461 7465 3220 3d20 7365        date2 = se
+0001e090: 6c66 2e65 6469 745f 6669 6c74 6572 6461  lf.edit_filterda
+0001e0a0: 7465 3220 3d20 636f 6e74 726f 6c73 2e44  te2 = controls.D
+0001e0b0: 6174 6550 6963 6b65 7243 7472 6c28 7061  atePickerCtrl(pa
+0001e0c0: 6e65 6c5f 7374 6332 2c20 7369 7a65 3d64  nel_stc2, size=d
+0001e0d0: 7473 697a 6529 0d0a 2020 2020 2020 2020  tsize)..        
+0001e0e0: 6461 7465 312e 466f 726d 6174 203d 2064  date1.Format = d
+0001e0f0: 6174 6532 2e46 6f72 6d61 7420 3d20 2225  ate2.Format = "%
+0001e100: 592d 256d 2d25 6422 0d0a 2020 2020 2020  Y-%m-%d"..      
+0001e110: 2020 6461 7465 322e 5365 7450 6f70 7570    date2.SetPopup
+0001e120: 416e 6368 6f72 2877 782e 5249 4748 5429  Anchor(wx.RIGHT)
+0001e130: 0d0a 2020 2020 2020 2020 6461 7465 312e  ..        date1.
+0001e140: 5365 7454 6f6f 6c54 6970 2822 4461 7465  SetToolTip("Date
+0001e150: 2069 6e20 7468 6520 666f 726d 2059 5959   in the form YYY
+0001e160: 592d 4d4d 2d44 4422 290d 0a20 2020 2020  Y-MM-DD")..     
+0001e170: 2020 2064 6174 6532 2e53 6574 546f 6f6c     date2.SetTool
+0001e180: 5469 7028 2244 6174 6520 696e 2074 6865  Tip("Date in the
+0001e190: 2066 6f72 6d20 5959 5959 2d4d 4d2d 4444   form YYYY-MM-DD
+0001e1a0: 2229 0d0a 2020 2020 2020 2020 7365 6c66  ")..        self
+0001e1b0: 2e42 696e 6428 7778 2e45 5654 5f54 4558  .Bind(wx.EVT_TEX
+0001e1c0: 542c 2073 656c 662e 6f6e 5f63 6861 6e67  T, self.on_chang
+0001e1d0: 655f 6669 6c74 6572 6461 7465 2c20 6461  e_filterdate, da
+0001e1e0: 7465 3129 0d0a 2020 2020 2020 2020 7365  te1)..        se
+0001e1f0: 6c66 2e42 696e 6428 7778 2e45 5654 5f54  lf.Bind(wx.EVT_T
+0001e200: 4558 542c 2073 656c 662e 6f6e 5f63 6861  EXT, self.on_cha
+0001e210: 6e67 655f 6669 6c74 6572 6461 7465 2c20  nge_filterdate, 
+0001e220: 6461 7465 3229 0d0a 2020 2020 2020 2020  date2)..        
+0001e230: 636f 6e74 726f 6c73 2e52 616e 6765 536c  controls.RangeSl
+0001e240: 6964 6572 2e4d 4152 4b45 525f 4c41 4245  ider.MARKER_LABE
+0001e250: 4c5f 5348 4f57 203d 2046 616c 7365 0d0a  L_SHOW = False..
+0001e260: 2020 2020 2020 2020 7261 6e67 655f 6461          range_da
+0001e270: 7465 203d 2073 656c 662e 7261 6e67 655f  te = self.range_
+0001e280: 6461 7465 203d 205c 0d0a 2020 2020 2020  date = \..      
+0001e290: 2020 2020 2020 636f 6e74 726f 6c73 2e52        controls.R
+0001e2a0: 616e 6765 536c 6964 6572 2870 6172 656e  angeSlider(paren
+0001e2b0: 743d 7061 6e65 6c5f 7374 6332 2c20 666d  t=panel_stc2, fm
+0001e2c0: 743d 2225 592d 256d 2d25 6422 290d 0a20  t="%Y-%m-%d").. 
+0001e2d0: 2020 2020 2020 2072 616e 6765 5f64 6174         range_dat
+0001e2e0: 652e 5365 7452 616e 6765 284e 6f6e 652c  e.SetRange(None,
+0001e2f0: 204e 6f6e 6529 0d0a 2020 2020 2020 2020   None)..        
+0001e300: 7261 6e67 655f 6461 7465 2e42 696e 6428  range_date.Bind(
+0001e310: 7778 2e45 5654 5f53 4c49 4445 522c 2073  wx.EVT_SLIDER, s
+0001e320: 656c 662e 6f6e 5f63 6861 6e67 655f 7261  elf.on_change_ra
+0001e330: 6e67 655f 6461 7465 290d 0a20 2020 2020  nge_date)..     
+0001e340: 2020 206c 6162 656c 5f6c 6973 7420 3d20     label_list = 
+0001e350: 5c0d 0a20 2020 2020 2020 2020 2020 2077  \..            w
+0001e360: 782e 5374 6174 6963 5465 7874 2870 6172  x.StaticText(par
+0001e370: 656e 743d 7061 6e65 6c5f 7374 6332 2c20  ent=panel_stc2, 
+0001e380: 6c61 6265 6c3d 2253 686f 2677 206d 6573  label="Sho&w mes
+0001e390: 7361 6765 7320 6672 6f6d 3a22 290d 0a20  sages from:").. 
+0001e3a0: 2020 2020 2020 2061 6777 5f73 7479 6c65         agw_style
+0001e3b0: 203d 2028 7778 2e4c 435f 5245 504f 5254   = (wx.LC_REPORT
+0001e3c0: 207c 2077 782e 4c43 5f4e 4f5f 4845 4144   | wx.LC_NO_HEAD
+0001e3d0: 4552 207c 2077 782e 4c43 5f53 494e 474c  ER | wx.LC_SINGL
+0001e3e0: 455f 5345 4c20 7c0d 0a20 2020 2020 2020  E_SEL |..       
+0001e3f0: 2020 2020 2020 2020 2020 2020 2020 7778                wx
+0001e400: 2e6c 6962 2e61 6777 2e75 6c74 696d 6174  .lib.agw.ultimat
+0001e410: 656c 6973 7463 7472 6c2e 554c 435f 4e4f  elistctrl.ULC_NO
+0001e420: 5f48 4947 484c 4947 4854 207c 0d0a 2020  _HIGHLIGHT |..  
+0001e430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e440: 2020 2077 782e 6c69 622e 6167 772e 756c     wx.lib.agw.ul
+0001e450: 7469 6d61 7465 6c69 7374 6374 726c 2e55  timatelistctrl.U
+0001e460: 4c43 5f48 5255 4c45 5320 7c0d 0a20 2020  LC_HRULES |..   
+0001e470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e480: 2020 7778 2e6c 6962 2e61 6777 2e75 6c74    wx.lib.agw.ult
+0001e490: 696d 6174 656c 6973 7463 7472 6c2e 554c  imatelistctrl.UL
+0001e4a0: 435f 5348 4f57 5f54 4f4f 4c54 4950 5329  C_SHOW_TOOLTIPS)
+0001e4b0: 0d0a 2020 2020 2020 2020 6966 2068 6173  ..        if has
+0001e4c0: 6174 7472 2877 782e 6c69 622e 6167 772e  attr(wx.lib.agw.
+0001e4d0: 756c 7469 6d61 7465 6c69 7374 6374 726c  ultimatelistctrl
+0001e4e0: 2c20 2255 4c43 5f55 5345 525f 524f 575f  , "ULC_USER_ROW_
+0001e4f0: 4845 4947 4854 2229 3a0d 0a20 2020 2020  HEIGHT"):..     
+0001e500: 2020 2020 2020 2061 6777 5f73 7479 6c65         agw_style
+0001e510: 207c 3d20 7778 2e6c 6962 2e61 6777 2e75   |= wx.lib.agw.u
+0001e520: 6c74 696d 6174 656c 6973 7463 7472 6c2e  ltimatelistctrl.
+0001e530: 554c 435f 5553 4552 5f52 4f57 5f48 4549  ULC_USER_ROW_HEI
+0001e540: 4748 540d 0a20 2020 2020 2020 206c 6973  GHT..        lis
+0001e550: 745f 7061 7274 6963 6970 616e 7473 203d  t_participants =
+0001e560: 2073 656c 662e 6c69 7374 5f70 6172 7469   self.list_parti
+0001e570: 6369 7061 6e74 7320 3d20 5c0d 0a20 2020  cipants = \..   
+0001e580: 2020 2020 2020 2020 2077 782e 6c69 622e           wx.lib.
+0001e590: 6167 772e 756c 7469 6d61 7465 6c69 7374  agw.ultimatelist
+0001e5a0: 6374 726c 2e55 6c74 696d 6174 654c 6973  ctrl.UltimateLis
+0001e5b0: 7443 7472 6c28 7061 7265 6e74 3d70 616e  tCtrl(parent=pan
+0001e5c0: 656c 5f73 7463 322c 0d0a 2020 2020 2020  el_stc2,..      
+0001e5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e600: 2020 2061 6777 5374 796c 653d 6167 775f     agwStyle=agw_
+0001e610: 7374 796c 6529 0d0a 2020 2020 2020 2020  style)..        
+0001e620: 436f 6c6f 7572 4d61 6e61 6765 722e 4d61  ColourManager.Ma
+0001e630: 6e61 6765 286c 6973 745f 7061 7274 6963  nage(list_partic
+0001e640: 6970 616e 7473 2c20 2246 6f72 6567 726f  ipants, "Foregro
+0001e650: 756e 6443 6f6c 6f75 7222 2c20 7778 2e53  undColour", wx.S
+0001e660: 5953 5f43 4f4c 4f55 525f 4254 4e54 4558  YS_COLOUR_BTNTEX
+0001e670: 5429 0d0a 2020 2020 2020 2020 436f 6c6f  T)..        Colo
+0001e680: 7572 4d61 6e61 6765 722e 4d61 6e61 6765  urManager.Manage
+0001e690: 286c 6973 745f 7061 7274 6963 6970 616e  (list_participan
+0001e6a0: 7473 2c20 2242 6163 6b67 726f 756e 6443  ts, "BackgroundC
+0001e6b0: 6f6c 6f75 7222 2c20 7778 2e53 5953 5f43  olour", wx.SYS_C
+0001e6c0: 4f4c 4f55 525f 5749 4e44 4f57 290d 0a20  OLOUR_WINDOW).. 
+0001e6d0: 2020 2020 2020 2074 7279 3a0d 0a20 2020         try:..   
+0001e6e0: 2020 2020 2020 2020 2043 6f6c 6f75 724d           ColourM
+0001e6f0: 616e 6167 6572 2e4d 616e 6167 6528 6c69  anager.Manage(li
+0001e700: 7374 5f70 6172 7469 6369 7061 6e74 732e  st_participants.
+0001e710: 5f68 6561 6465 7257 696e 2c20 2246 6f72  _headerWin, "For
+0001e720: 6567 726f 756e 6443 6f6c 6f75 7222 2c20  egroundColour", 
+0001e730: 7778 2e53 5953 5f43 4f4c 4f55 525f 4254  wx.SYS_COLOUR_BT
+0001e740: 4e54 4558 5429 0d0a 2020 2020 2020 2020  NTEXT)..        
+0001e750: 2020 2020 436f 6c6f 7572 4d61 6e61 6765      ColourManage
+0001e760: 722e 4d61 6e61 6765 286c 6973 745f 7061  r.Manage(list_pa
+0001e770: 7274 6963 6970 616e 7473 2e5f 6d61 696e  rticipants._main
+0001e780: 5769 6e2c 2020 2022 4261 636b 6772 6f75  Win,   "Backgrou
+0001e790: 6e64 436f 6c6f 7572 222c 2077 782e 5359  ndColour", wx.SY
+0001e7a0: 535f 434f 4c4f 5552 5f57 494e 444f 5729  S_COLOUR_WINDOW)
+0001e7b0: 0d0a 2020 2020 2020 2020 6578 6365 7074  ..        except
+0001e7c0: 2045 7863 6570 7469 6f6e 3a20 7061 7373   Exception: pass
+0001e7d0: 0d0a 2020 2020 2020 2020 6c69 7374 5f70  ..        list_p
+0001e7e0: 6172 7469 6369 7061 6e74 732e 496e 7365  articipants.Inse
+0001e7f0: 7274 436f 6c75 6d6e 2830 2c20 2222 290d  rtColumn(0, "").
+0001e800: 0a20 2020 2020 2020 2073 656c 662e 4269  .        self.Bi
+0001e810: 6e64 2877 782e 4556 545f 4c49 5354 5f49  nd(wx.EVT_LIST_I
+0001e820: 5445 4d5f 5345 4c45 4354 4544 2c20 7365  TEM_SELECTED, se
+0001e830: 6c66 2e6f 6e5f 7365 6c65 6374 5f70 6172  lf.on_select_par
+0001e840: 7469 6369 7061 6e74 2c0d 0a20 2020 2020  ticipant,..     
+0001e850: 2020 2020 2020 2020 2020 2020 206c 6973               lis
+0001e860: 745f 7061 7274 6963 6970 616e 7473 290d  t_participants).
+0001e870: 0a20 2020 2020 2020 2069 6620 6861 7361  .        if hasa
+0001e880: 7474 7228 6c69 7374 5f70 6172 7469 6369  ttr(list_partici
+0001e890: 7061 6e74 732c 2022 5365 7455 7365 724c  pants, "SetUserL
+0001e8a0: 696e 6548 6569 6768 7422 293a 0d0a 2020  ineHeight"):..  
+0001e8b0: 2020 2020 2020 2020 2020 6c69 7374 5f70            list_p
+0001e8c0: 6172 7469 6369 7061 6e74 732e 5365 7455  articipants.SetU
+0001e8d0: 7365 724c 696e 6548 6569 6768 7428 636f  serLineHeight(co
+0001e8e0: 6e66 2e41 7661 7461 7249 6d61 6765 5369  nf.AvatarImageSi
+0001e8f0: 7a65 5b31 5d20 2b20 3229 0d0a 2020 2020  ze[1] + 2)..    
+0001e900: 2020 2020 7369 7a65 725f 6461 7465 7320      sizer_dates 
+0001e910: 3d20 7778 2e42 6f78 5369 7a65 7228 7778  = wx.BoxSizer(wx
+0001e920: 2e48 4f52 495a 4f4e 5441 4c29 0d0a 2020  .HORIZONTAL)..  
+0001e930: 2020 2020 2020 7369 7a65 725f 6669 6c74        sizer_filt
+0001e940: 6572 5f62 7574 746f 6e73 203d 2077 782e  er_buttons = wx.
+0001e950: 426f 7853 697a 6572 2877 782e 484f 5249  BoxSizer(wx.HORI
+0001e960: 5a4f 4e54 414c 290d 0a20 2020 2020 2020  ZONTAL)..       
+0001e970: 2062 7574 746f 6e5f 6669 6c74 6572 5f61   button_filter_a
+0001e980: 7070 6c79 203d 2073 656c 662e 6275 7474  pply = self.butt
+0001e990: 6f6e 5f63 6861 745f 6170 706c 7966 696c  on_chat_applyfil
+0001e9a0: 7465 7220 3d20 5c0d 0a20 2020 2020 2020  ter = \..       
+0001e9b0: 2020 2020 2077 782e 4275 7474 6f6e 2870       wx.Button(p
+0001e9c0: 6172 656e 743d 7061 6e65 6c5f 7374 6332  arent=panel_stc2
+0001e9d0: 2c20 6c61 6265 6c3d 2241 2670 706c 7920  , label="A&pply 
+0001e9e0: 6669 6c74 6572 2229 0d0a 2020 2020 2020  filter")..      
+0001e9f0: 2020 6275 7474 6f6e 5f66 696c 7465 725f    button_filter_
+0001ea00: 6578 706f 7274 203d 2073 656c 662e 6275  export = self.bu
+0001ea10: 7474 6f6e 5f63 6861 745f 6578 706f 7274  tton_chat_export
+0001ea20: 6669 6c74 6572 203d 205c 0d0a 2020 2020  filter = \..    
+0001ea30: 2020 2020 2020 2020 7778 2e42 7574 746f          wx.Butto
+0001ea40: 6e28 7061 7265 6e74 3d70 616e 656c 5f73  n(parent=panel_s
+0001ea50: 7463 322c 206c 6162 656c 3d22 4578 706f  tc2, label="Expo
+0001ea60: 2672 7420 6669 6c74 6572 2229 0d0a 2020  &rt filter")..  
+0001ea70: 2020 2020 2020 6275 7474 6f6e 5f66 696c        button_fil
+0001ea80: 7465 725f 7265 7365 7420 3d20 7365 6c66  ter_reset = self
+0001ea90: 2e62 7574 746f 6e5f 6368 6174 5f75 6e66  .button_chat_unf
+0001eaa0: 696c 7465 7220 3d20 5c0d 0a20 2020 2020  ilter = \..     
+0001eab0: 2020 2020 2020 2077 782e 4275 7474 6f6e         wx.Button
+0001eac0: 2870 6172 656e 743d 7061 6e65 6c5f 7374  (parent=panel_st
+0001ead0: 6332 2c20 6c61 6265 6c3d 2252 6573 746f  c2, label="Resto
+0001eae0: 7265 2069 266e 6974 6961 6c22 290d 0a20  re i&nitial").. 
+0001eaf0: 2020 2020 2020 2073 656c 662e 4269 6e64         self.Bind
+0001eb00: 2877 782e 4556 545f 4255 5454 4f4e 2c20  (wx.EVT_BUTTON, 
+0001eb10: 7365 6c66 2e6f 6e5f 6669 6c74 6572 5f63  self.on_filter_c
+0001eb20: 6861 742c 2062 7574 746f 6e5f 6669 6c74  hat, button_filt
+0001eb30: 6572 5f61 7070 6c79 290d 0a20 2020 2020  er_apply)..     
+0001eb40: 2020 2073 656c 662e 4269 6e64 2877 782e     self.Bind(wx.
+0001eb50: 4556 545f 4255 5454 4f4e 2c20 7365 6c66  EVT_BUTTON, self
+0001eb60: 2e6f 6e5f 6669 6c74 6572 6578 706f 7274  .on_filterexport
+0001eb70: 5f63 6861 742c 0d0a 2020 2020 2020 2020  _chat,..        
+0001eb80: 2020 2020 2020 2020 2020 6275 7474 6f6e            button
+0001eb90: 5f66 696c 7465 725f 6578 706f 7274 290d  _filter_export).
+0001eba0: 0a20 2020 2020 2020 2073 656c 662e 4269  .        self.Bi
+0001ebb0: 6e64 2877 782e 4556 545f 4255 5454 4f4e  nd(wx.EVT_BUTTON
+0001ebc0: 2c20 7365 6c66 2e6f 6e5f 6669 6c74 6572  , self.on_filter
+0001ebd0: 7265 7365 745f 6368 6174 2c20 6275 7474  reset_chat, butt
+0001ebe0: 6f6e 5f66 696c 7465 725f 7265 7365 7429  on_filter_reset)
+0001ebf0: 0d0a 2020 2020 2020 2020 6275 7474 6f6e  ..        button
+0001ec00: 5f66 696c 7465 725f 6170 706c 792e 5365  _filter_apply.Se
+0001ec10: 7454 6f6f 6c54 6970 280d 0a20 2020 2020  tToolTip(..     
+0001ec20: 2020 2020 2020 2022 4669 6c74 6572 7320         "Filters 
+0001ec30: 7468 6520 636f 6e76 6572 7361 7469 6f6e  the conversation
+0001ec40: 2062 7920 7468 6520 7370 6563 6966 6965   by the specifie
+0001ec50: 6420 7465 7874 2c20 220d 0a20 2020 2020  d text, "..     
+0001ec60: 2020 2020 2020 2022 6461 7465 2072 616e         "date ran
+0001ec70: 6765 2061 6e64 2070 6172 7469 6369 7061  ge and participa
+0001ec80: 6e74 732e 2229 0d0a 2020 2020 2020 2020  nts.")..        
+0001ec90: 6275 7474 6f6e 5f66 696c 7465 725f 6578  button_filter_ex
+0001eca0: 706f 7274 2e53 6574 546f 6f6c 5469 7028  port.SetToolTip(
+0001ecb0: 0d0a 2020 2020 2020 2020 2020 2020 2245  ..            "E
+0001ecc0: 7870 6f72 7473 2066 696c 7465 7265 6420  xports filtered 
+0001ecd0: 6d65 7373 6167 6573 2073 7472 6169 6768  messages straigh
+0001ece0: 7420 746f 2066 696c 652c 2022 0d0a 2020  t to file, "..  
+0001ecf0: 2020 2020 2020 2020 2020 2277 6974 686f            "witho
+0001ed00: 7574 2073 686f 7769 6e67 2074 6865 6d20  ut showing them 
+0001ed10: 2873 686f 7769 6e67 2074 686f 7573 616e  (showing thousan
+0001ed20: 6473 206f 6620 6d65 7373 6167 6573 2067  ds of messages g
+0001ed30: 6574 7320 736c 6f77 292e 2229 0d0a 2020  ets slow).")..  
+0001ed40: 2020 2020 2020 6275 7474 6f6e 5f66 696c        button_fil
+0001ed50: 7465 725f 7265 7365 742e 5365 7454 6f6f  ter_reset.SetToo
+0001ed60: 6c54 6970 280d 0a20 2020 2020 2020 2020  lTip(..         
+0001ed70: 2020 2022 5265 7374 6f72 6573 2066 696c     "Restores fil
+0001ed80: 7465 7220 636f 6e74 726f 6c73 2074 6f20  ter controls to 
+0001ed90: 696e 6974 6961 6c20 7661 6c75 6573 2061  initial values a
+0001eda0: 6e64 2072 6561 7070 6c69 6573 2066 696c  nd reapplies fil
+0001edb0: 7465 722e 2229 0d0a 2020 2020 2020 2020  ter.")..        
+0001edc0: 7369 7a65 725f 6669 6c74 6572 5f62 7574  sizer_filter_but
+0001edd0: 746f 6e73 2e41 6464 2862 7574 746f 6e5f  tons.Add(button_
+0001ede0: 6669 6c74 6572 5f61 7070 6c79 290d 0a20  filter_apply).. 
+0001edf0: 2020 2020 2020 2073 697a 6572 5f66 696c         sizer_fil
+0001ee00: 7465 725f 6275 7474 6f6e 732e 4164 6453  ter_buttons.AddS
+0001ee10: 7061 6365 7228 3529 0d0a 2020 2020 2020  pacer(5)..      
+0001ee20: 2020 7369 7a65 725f 6669 6c74 6572 5f62    sizer_filter_b
+0001ee30: 7574 746f 6e73 2e41 6464 2862 7574 746f  uttons.Add(butto
+0001ee40: 6e5f 6669 6c74 6572 5f65 7870 6f72 7429  n_filter_export)
+0001ee50: 0d0a 2020 2020 2020 2020 7369 7a65 725f  ..        sizer_
+0001ee60: 6669 6c74 6572 5f62 7574 746f 6e73 2e41  filter_buttons.A
+0001ee70: 6464 5370 6163 6572 2835 290d 0a20 2020  ddSpacer(5)..   
+0001ee80: 2020 2020 2073 697a 6572 5f66 696c 7465       sizer_filte
+0001ee90: 725f 6275 7474 6f6e 732e 4164 6428 6275  r_buttons.Add(bu
+0001eea0: 7474 6f6e 5f66 696c 7465 725f 7265 7365  tton_filter_rese
+0001eeb0: 7429 0d0a 2020 2020 2020 2020 7369 7a65  t)..        size
+0001eec0: 725f 6669 6c74 6572 5f62 7574 746f 6e73  r_filter_buttons
+0001eed0: 2e41 6464 5370 6163 6572 2835 290d 0a20  .AddSpacer(5).. 
+0001eee0: 2020 2020 2020 2073 697a 6572 5f64 6174         sizer_dat
+0001eef0: 6573 2e41 6464 2864 6174 6531 290d 0a20  es.Add(date1).. 
+0001ef00: 2020 2020 2020 2073 697a 6572 5f64 6174         sizer_dat
+0001ef10: 6573 2e41 6464 5374 7265 7463 6853 7061  es.AddStretchSpa
+0001ef20: 6365 7228 290d 0a20 2020 2020 2020 2073  cer()..        s
+0001ef30: 697a 6572 5f64 6174 6573 2e41 6464 2864  izer_dates.Add(d
+0001ef40: 6174 6532 290d 0a20 2020 2020 2020 2073  ate2)..        s
+0001ef50: 697a 6572 5f73 7463 322e 4164 6428 6c61  izer_stc2.Add(la
+0001ef60: 6265 6c5f 6669 6c74 6572 2c20 626f 7264  bel_filter, bord
+0001ef70: 6572 3d35 2c20 666c 6167 3d77 782e 4c45  er=5, flag=wx.LE
+0001ef80: 4654 290d 0a20 2020 2020 2020 2073 697a  FT)..        siz
+0001ef90: 6572 5f73 7463 322e 4164 6428 6564 6974  er_stc2.Add(edit
+0001efa0: 5f66 696c 7465 722c 2062 6f72 6465 723d  _filter, border=
+0001efb0: 352c 2066 6c61 673d 7778 2e47 524f 5720  5, flag=wx.GROW 
+0001efc0: 7c20 7778 2e4c 4546 5429 0d0a 2020 2020  | wx.LEFT)..    
+0001efd0: 2020 2020 7369 7a65 725f 7374 6332 2e41      sizer_stc2.A
+0001efe0: 6464 5370 6163 6572 2835 290d 0a20 2020  ddSpacer(5)..   
+0001eff0: 2020 2020 2073 697a 6572 5f73 7463 322e       sizer_stc2.
+0001f000: 4164 6428 6c61 6265 6c5f 7261 6e67 652c  Add(label_range,
+0001f010: 2062 6f72 6465 723d 352c 2066 6c61 673d   border=5, flag=
+0001f020: 7778 2e4c 4546 5429 0d0a 2020 2020 2020  wx.LEFT)..      
+0001f030: 2020 7369 7a65 725f 7374 6332 2e41 6464    sizer_stc2.Add
+0001f040: 2873 697a 6572 5f64 6174 6573 2c20 626f  (sizer_dates, bo
+0001f050: 7264 6572 3d35 2c20 666c 6167 3d77 782e  rder=5, flag=wx.
+0001f060: 4752 4f57 207c 2077 782e 4c45 4654 207c  GROW | wx.LEFT |
+0001f070: 2077 782e 424f 5454 4f4d 290d 0a20 2020   wx.BOTTOM)..   
+0001f080: 2020 2020 2073 697a 6572 5f73 7463 322e       sizer_stc2.
+0001f090: 4164 6428 7261 6e67 655f 6461 7465 2c20  Add(range_date, 
+0001f0a0: 626f 7264 6572 3d35 2c20 666c 6167 3d77  border=5, flag=w
+0001f0b0: 782e 4752 4f57 207c 2077 782e 4c45 4654  x.GROW | wx.LEFT
+0001f0c0: 290d 0a20 2020 2020 2020 2073 697a 6572  )..        sizer
+0001f0d0: 5f73 7463 322e 4164 6453 7061 6365 7228  _stc2.AddSpacer(
+0001f0e0: 3529 0d0a 2020 2020 2020 2020 7369 7a65  5)..        size
+0001f0f0: 725f 7374 6332 2e41 6464 286c 6162 656c  r_stc2.Add(label
+0001f100: 5f6c 6973 742c 2062 6f72 6465 723d 352c  _list, border=5,
+0001f110: 2066 6c61 673d 7778 2e4c 4546 5429 0d0a   flag=wx.LEFT)..
+0001f120: 2020 2020 2020 2020 7369 7a65 725f 7374          sizer_st
+0001f130: 6332 2e41 6464 286c 6973 745f 7061 7274  c2.Add(list_part
+0001f140: 6963 6970 616e 7473 2c20 7072 6f70 6f72  icipants, propor
+0001f150: 7469 6f6e 3d31 2c20 626f 7264 6572 3d35  tion=1, border=5
+0001f160: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0001f170: 2020 2020 2020 2020 2020 666c 6167 3d77            flag=w
+0001f180: 782e 4752 4f57 207c 2077 782e 4c45 4654  x.GROW | wx.LEFT
+0001f190: 290d 0a20 2020 2020 2020 2073 697a 6572  )..        sizer
+0001f1a0: 5f73 7463 322e 4164 6453 7061 6365 7228  _stc2.AddSpacer(
+0001f1b0: 3529 0d0a 2020 2020 2020 2020 7369 7a65  5)..        size
+0001f1c0: 725f 7374 6332 2e41 6464 2873 697a 6572  r_stc2.Add(sizer
+0001f1d0: 5f66 696c 7465 725f 6275 7474 6f6e 732c  _filter_buttons,
+0001f1e0: 2070 726f 706f 7274 696f 6e3d 302c 2062   proportion=0, b
+0001f1f0: 6f72 6465 723d 352c 0d0a 2020 2020 2020  order=5,..      
+0001f200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f210: 2066 6c61 673d 7778 2e47 524f 5720 7c20   flag=wx.GROW | 
+0001f220: 7778 2e4c 4546 5420 7c20 7778 2e52 4947  wx.LEFT | wx.RIG
+0001f230: 4854 290d 0a0d 0a20 2020 2020 2020 2073  HT)....        s
+0001f240: 706c 6974 7465 725f 7374 632e 5370 6c69  plitter_stc.Spli
+0001f250: 7456 6572 7469 6361 6c6c 7928 7061 6e65  tVertically(pane
+0001f260: 6c5f 7374 6331 2c20 7061 6e65 6c5f 7374  l_stc1, panel_st
+0001f270: 6332 2c20 7361 7368 506f 7369 7469 6f6e  c2, sashPosition
+0001f280: 3d30 290d 0a20 2020 2020 2020 2073 706c  =0)..        spl
+0001f290: 6974 7465 725f 7374 632e 556e 7370 6c69  itter_stc.Unspli
+0001f2a0: 7428 7061 6e65 6c5f 7374 6332 2920 2320  t(panel_stc2) # 
+0001f2b0: 4869 6465 2066 696c 7465 7220 7061 6e65  Hide filter pane
+0001f2c0: 6c0d 0a20 2020 2020 2020 2073 697a 6572  l..        sizer
+0001f2d0: 322e 4164 6428 7370 6c69 7474 6572 5f73  2.Add(splitter_s
+0001f2e0: 7463 2c20 7072 6f70 6f72 7469 6f6e 3d31  tc, proportion=1
+0001f2f0: 2c20 626f 7264 6572 3d35 2c20 666c 6167  , border=5, flag
+0001f300: 3d77 782e 4752 4f57 207c 2077 782e 414c  =wx.GROW | wx.AL
+0001f310: 4c29 0d0a 0d0a 2020 2020 2020 2020 7369  L)....        si
+0001f320: 7a65 722e 4164 6453 7061 6365 7228 3130  zer.AddSpacer(10
+0001f330: 290d 0a20 2020 2020 2020 2073 697a 6572  )..        sizer
+0001f340: 2e41 6464 2873 706c 6974 7465 722c 2070  .Add(splitter, p
+0001f350: 726f 706f 7274 696f 6e3d 312c 2066 6c61  roportion=1, fla
+0001f360: 673d 7778 2e47 524f 5729 0d0a 2020 2020  g=wx.GROW)..    
+0001f370: 2020 2020 7370 6c69 7474 6572 2e53 706c      splitter.Spl
+0001f380: 6974 486f 7269 7a6f 6e74 616c 6c79 2870  itHorizontally(p
+0001f390: 616e 656c 312c 2070 616e 656c 322c 2073  anel1, panel2, s
+0001f3a0: 6173 6850 6f73 6974 696f 6e3d 7365 6c66  ashPosition=self
+0001f3b0: 2e53 697a 655b 315d 202f 2f20 3329 0d0a  .Size[1] // 3)..
+0001f3c0: 2020 2020 2020 2020 7061 6e65 6c32 2e45          panel2.E
+0001f3d0: 6e61 626c 6564 203d 2046 616c 7365 0d0a  nabled = False..
+0001f3e0: 0d0a 0d0a 2020 2020 6465 6620 6372 6561  ....    def crea
+0001f3f0: 7465 5f70 6167 655f 636f 6e74 6163 7473  te_page_contacts
+0001f400: 2873 656c 662c 206e 6f74 6562 6f6f 6b29  (self, notebook)
+0001f410: 3a0d 0a20 2020 2020 2020 2022 2222 4372  :..        """Cr
+0001f420: 6561 7465 7320 6120 7061 6765 2066 6f72  eates a page for
+0001f430: 2076 6965 7769 6e67 2063 6f6e 7461 6374   viewing contact
+0001f440: 732e 2222 220d 0a20 2020 2020 2020 2070  s."""..        p
+0001f450: 6167 6520 3d20 7365 6c66 2e70 6167 655f  age = self.page_
+0001f460: 636f 6e74 6163 7473 203d 2077 782e 5061  contacts = wx.Pa
+0001f470: 6e65 6c28 7061 7265 6e74 3d6e 6f74 6562  nel(parent=noteb
+0001f480: 6f6f 6b29 0d0a 2020 2020 2020 2020 7365  ook)..        se
+0001f490: 6c66 2e70 6167 656f 7264 6572 5b70 6167  lf.pageorder[pag
+0001f4a0: 655d 203d 206c 656e 2873 656c 662e 7061  e] = len(self.pa
+0001f4b0: 6765 6f72 6465 7229 0d0a 2020 2020 2020  georder)..      
+0001f4c0: 2020 6e6f 7465 626f 6f6b 2e41 6464 5061    notebook.AddPa
+0001f4d0: 6765 2870 6167 652c 2022 436f 6e74 6163  ge(page, "Contac
+0001f4e0: 7473 2229 0d0a 2020 2020 2020 2020 7369  ts")..        si
+0001f4f0: 7a65 7220 3d20 7061 6765 2e53 697a 6572  zer = page.Sizer
+0001f500: 203d 2077 782e 426f 7853 697a 6572 2877   = wx.BoxSizer(w
+0001f510: 782e 5645 5254 4943 414c 290d 0a20 2020  x.VERTICAL)..   
+0001f520: 2020 2020 2073 706c 6974 7465 7220 3d20       splitter = 
+0001f530: 7365 6c66 2e73 706c 6974 7465 725f 636f  self.splitter_co
+0001f540: 6e74 6163 7473 203d 2077 782e 5370 6c69  ntacts = wx.Spli
+0001f550: 7474 6572 5769 6e64 6f77 280d 0a20 2020  tterWindow(..   
+0001f560: 2020 2020 2020 2020 2070 6172 656e 743d           parent=
+0001f570: 7061 6765 2c20 7374 796c 653d 7778 2e42  page, style=wx.B
+0001f580: 4f52 4445 525f 4e4f 4e45 0d0a 2020 2020  ORDER_NONE..    
+0001f590: 2020 2020 290d 0a20 2020 2020 2020 2073      )..        s
+0001f5a0: 706c 6974 7465 722e 5365 744d 696e 696d  plitter.SetMinim
+0001f5b0: 756d 5061 6e65 5369 7a65 2831 3030 290d  umPaneSize(100).
+0001f5c0: 0a0d 0a20 2020 2020 2020 2070 616e 656c  ...        panel
+0001f5d0: 3120 3d20 7365 6c66 2e70 616e 656c 5f63  1 = self.panel_c
+0001f5e0: 6f6e 7461 6374 7331 203d 2077 782e 5061  ontacts1 = wx.Pa
+0001f5f0: 6e65 6c28 7061 7265 6e74 3d73 706c 6974  nel(parent=split
+0001f600: 7465 7229 0d0a 2020 2020 2020 2020 7369  ter)..        si
+0001f610: 7a65 7231 203d 2070 616e 656c 312e 5369  zer1 = panel1.Si
+0001f620: 7a65 7220 3d20 7778 2e42 6f78 5369 7a65  zer = wx.BoxSize
+0001f630: 7228 7778 2e56 4552 5449 4341 4c29 0d0a  r(wx.VERTICAL)..
+0001f640: 2020 2020 2020 2020 7369 7a65 725f 746f          sizer_to
+0001f650: 7020 3d20 7778 2e42 6f78 5369 7a65 7228  p = wx.BoxSizer(
+0001f660: 7778 2e48 4f52 495a 4f4e 5441 4c29 0d0a  wx.HORIZONTAL)..
+0001f670: 2020 2020 2020 2020 7365 6c66 2e6c 6162          self.lab
+0001f680: 656c 5f6c 6973 745f 636f 6e74 6163 7473  el_list_contacts
+0001f690: 203d 2077 782e 5374 6174 6963 5465 7874   = wx.StaticText
+0001f6a0: 2870 616e 656c 312c 206c 6162 656c 3d22  (panel1, label="
+0001f6b0: 4126 6c6c 2070 726f 6669 6c65 7320 696e  A&ll profiles in
+0001f6c0: 2064 6174 6162 6173 653a 2229 0d0a 2020   database:")..  
+0001f6d0: 2020 2020 2020 7369 7a65 725f 746f 702e        sizer_top.
+0001f6e0: 4164 6428 7365 6c66 2e6c 6162 656c 5f6c  Add(self.label_l
+0001f6f0: 6973 745f 636f 6e74 6163 7473 2c20 7072  ist_contacts, pr
+0001f700: 6f70 6f72 7469 6f6e 3d31 2c20 626f 7264  oportion=1, bord
+0001f710: 6572 3d35 2c20 666c 6167 3d77 782e 414c  er=5, flag=wx.AL
+0001f720: 4947 4e5f 424f 5454 4f4d 290d 0a20 2020  IGN_BOTTOM)..   
+0001f730: 2020 2020 206c 6973 745f 636f 6e74 6163       list_contac
+0001f740: 7473 203d 2073 656c 662e 6c69 7374 5f63  ts = self.list_c
+0001f750: 6f6e 7461 6374 7320 3d20 636f 6e74 726f  ontacts = contro
+0001f760: 6c73 2e53 6f72 7461 626c 654c 6973 7456  ls.SortableListV
+0001f770: 6965 7728 0d0a 2020 2020 2020 2020 2020  iew(..          
+0001f780: 2020 7061 7265 6e74 3d70 616e 656c 312c    parent=panel1,
+0001f790: 2073 7479 6c65 3d77 782e 4c43 5f52 4550   style=wx.LC_REP
+0001f7a0: 4f52 5429 0d0a 2020 2020 2020 2020 636f  ORT)..        co
+0001f7b0: 6c75 6d6e 7320 3d20 5b28 2269 6465 6e74  lumns = [("ident
+0001f7c0: 6974 7922 2c20 2241 6363 6f75 6e74 2229  ity", "Account")
+0001f7d0: 2c20 2822 6e61 6d65 222c 2022 4e61 6d65  , ("name", "Name
+0001f7e0: 2229 2c20 2822 7068 6f6e 6522 2c20 2250  "), ("phone", "P
+0001f7f0: 686f 6e65 2229 2c0d 0a20 2020 2020 2020  hone"),..       
+0001f800: 2020 2020 2020 2020 2020 2020 2822 6669              ("fi
+0001f810: 7273 745f 6d65 7373 6167 655f 6461 7465  rst_message_date
+0001f820: 7469 6d65 222c 2022 4669 7273 7420 6d65  time", "First me
+0001f830: 7373 6167 6522 292c 0d0a 2020 2020 2020  ssage"),..      
+0001f840: 2020 2020 2020 2020 2020 2020 2028 226c               ("l
+0001f850: 6173 745f 6d65 7373 6167 655f 6461 7465  ast_message_date
+0001f860: 7469 6d65 222c 2022 4c61 7374 206d 6573  time", "Last mes
+0001f870: 7361 6765 2229 2c0d 0a20 2020 2020 2020  sage"),..       
+0001f880: 2020 2020 2020 2020 2020 2020 2822 6d65              ("me
+0001f890: 7373 6167 655f 636f 756e 745f 7369 6e67  ssage_count_sing
+0001f8a0: 6c65 222c 2022 313a 3120 6d65 7373 6167  le", "1:1 messag
+0001f8b0: 6573 2229 2c0d 0a20 2020 2020 2020 2020  es"),..         
+0001f8c0: 2020 2020 2020 2020 2020 2822 6d65 7373            ("mess
+0001f8d0: 6167 655f 636f 756e 745f 6772 6f75 7022  age_count_group"
+0001f8e0: 2c20 2247 726f 7570 2063 6861 7420 6d65  , "Group chat me
+0001f8f0: 7373 6167 6573 2229 2c20 5d0d 0a20 2020  ssages"), ]..   
+0001f900: 2020 2020 2066 726d 7420 3d20 6c61 6d62       frmt = lamb
+0001f910: 6461 2072 2c20 633a 2072 5b63 5d2e 7374  da r, c: r[c].st
+0001f920: 7266 7469 6d65 2822 2559 2d25 6d2d 2564  rftime("%Y-%m-%d
+0001f930: 2025 483a 254d 2229 2069 6620 722e 6765   %H:%M") if r.ge
+0001f940: 7428 6329 2065 6c73 6520 2222 0d0a 2020  t(c) else ""..  
+0001f950: 2020 2020 2020 666f 726d 6174 7465 7273        formatters
+0001f960: 203d 207b 2266 6972 7374 5f6d 6573 7361   = {"first_messa
+0001f970: 6765 5f64 6174 6574 696d 6522 3a20 6672  ge_datetime": fr
+0001f980: 6d74 2c0d 0a20 2020 2020 2020 2020 2020  mt,..           
+0001f990: 2020 2020 2020 2020 2020 2022 6c61 7374             "last
+0001f9a0: 5f6d 6573 7361 6765 5f64 6174 6574 696d  _message_datetim
+0001f9b0: 6522 3a20 6672 6d74 2c20 7d0d 0a20 2020  e": frmt, }..   
+0001f9c0: 2020 2020 206c 6973 745f 636f 6e74 6163       list_contac
+0001f9d0: 7473 2e53 6574 436f 6c75 6d6e 7328 636f  ts.SetColumns(co
+0001f9e0: 6c75 6d6e 7329 0d0a 2020 2020 2020 2020  lumns)..        
+0001f9f0: 6c69 7374 5f63 6f6e 7461 6374 732e 5365  list_contacts.Se
+0001fa00: 7443 6f6c 756d 6e46 6f72 6d61 7474 6572  tColumnFormatter
+0001fa10: 7328 666f 726d 6174 7465 7273 290d 0a20  s(formatters).. 
+0001fa20: 2020 2020 2020 206c 6973 745f 636f 6e74         list_cont
+0001fa30: 6163 7473 2e53 6574 436f 6c75 6d6e 734d  acts.SetColumnsM
+0001fa40: 6178 5769 6474 6828 3330 3029 0d0a 2020  axWidth(300)..  
+0001fa50: 2020 2020 2020 6564 6974 5f63 6f6e 7461        edit_conta
+0001fa60: 6374 6669 6c74 6572 203d 2073 656c 662e  ctfilter = self.
+0001fa70: 6564 6974 5f63 6f6e 7461 6374 6669 6c74  edit_contactfilt
+0001fa80: 6572 203d 2063 6f6e 7472 6f6c 732e 4869  er = controls.Hi
+0001fa90: 6e74 6564 5465 7874 4374 726c 280d 0a20  ntedTextCtrl(.. 
+0001faa0: 2020 2020 2020 2020 2020 2070 616e 656c             panel
+0001fab0: 312c 2022 4669 6c74 6572 206c 6973 7422  1, "Filter list"
+0001fac0: 2c20 7369 7a65 3d28 3735 2c20 2d31 2929  , size=(75, -1))
+0001fad0: 0d0a 2020 2020 2020 2020 6564 6974 5f63  ..        edit_c
+0001fae0: 6f6e 7461 6374 6669 6c74 6572 2e53 6574  ontactfilter.Set
+0001faf0: 546f 6f6c 5469 7028 2246 696c 7465 7220  ToolTip("Filter 
+0001fb00: 6974 656d 7320 696e 2063 6f6e 7461 6374  items in contact
+0001fb10: 7320 6c69 7374 2229 0d0a 2020 2020 2020  s list")..      
+0001fb20: 2020 7365 6c66 2e42 696e 6428 7778 2e45    self.Bind(wx.E
+0001fb30: 5654 5f54 4558 545f 454e 5445 522c 2073  VT_TEXT_ENTER, s
+0001fb40: 656c 662e 6f6e 5f63 6861 6e67 655f 636f  elf.on_change_co
+0001fb50: 6e74 6163 7466 696c 7465 722c 2065 6469  ntactfilter, edi
+0001fb60: 745f 636f 6e74 6163 7466 696c 7465 7229  t_contactfilter)
+0001fb70: 0d0a 2020 2020 2020 2020 7369 7a65 725f  ..        sizer_
+0001fb80: 746f 702e 4164 6428 6564 6974 5f63 6f6e  top.Add(edit_con
+0001fb90: 7461 6374 6669 6c74 6572 2c20 666c 6167  tactfilter, flag
+0001fba0: 3d77 782e 5249 4748 542c 2062 6f72 6465  =wx.RIGHT, borde
+0001fbb0: 723d 3135 290d 0a20 2020 2020 2020 2062  r=15)..        b
+0001fbc0: 7574 746f 6e5f 6578 706f 7274 5f63 6f6e  utton_export_con
+0001fbd0: 7461 6374 7320 3d20 7365 6c66 2e62 7574  tacts = self.but
+0001fbe0: 746f 6e5f 6578 706f 7274 5f63 6f6e 7461  ton_export_conta
+0001fbf0: 6374 7320 3d20 5c0d 0a20 2020 2020 2020  cts = \..       
+0001fc00: 2020 2020 2077 782e 4275 7474 6f6e 2870       wx.Button(p
+0001fc10: 6172 656e 743d 7061 6e65 6c31 2c20 6c61  arent=panel1, la
+0001fc20: 6265 6c3d 2245 7870 266f 7274 2063 6f6e  bel="Exp&ort con
+0001fc30: 7461 6374 7322 290d 0a20 2020 2020 2020  tacts")..       
+0001fc40: 2062 7574 746f 6e5f 6578 706f 7274 5f63   button_export_c
+0001fc50: 6861 7473 203d 2073 656c 662e 6275 7474  hats = self.butt
+0001fc60: 6f6e 5f65 7870 6f72 745f 636f 6e74 6163  on_export_contac
+0001fc70: 7473 5f63 6861 7473 203d 205c 0d0a 2020  ts_chats = \..  
+0001fc80: 2020 2020 2020 2020 2020 7778 2e42 7574            wx.But
+0001fc90: 746f 6e28 7061 7265 6e74 3d70 616e 656c  ton(parent=panel
+0001fca0: 312c 206c 6162 656c 3d22 4578 7026 6f72  1, label="Exp&or
+0001fcb0: 7420 6368 6174 7322 290d 0a20 2020 2020  t chats")..     
+0001fcc0: 2020 2073 697a 6572 5f74 6f70 2e41 6464     sizer_top.Add
+0001fcd0: 2862 7574 746f 6e5f 6578 706f 7274 5f63  (button_export_c
+0001fce0: 6f6e 7461 6374 7329 0d0a 2020 2020 2020  ontacts)..      
+0001fcf0: 2020 7369 7a65 725f 746f 702e 4164 6428    sizer_top.Add(
+0001fd00: 6275 7474 6f6e 5f65 7870 6f72 745f 6368  button_export_ch
+0001fd10: 6174 732c 2062 6f72 6465 723d 352c 2066  ats, border=5, f
+0001fd20: 6c61 673d 7778 2e4c 4546 5429 0d0a 2020  lag=wx.LEFT)..  
+0001fd30: 2020 2020 2020 7365 6c66 2e42 696e 6428        self.Bind(
+0001fd40: 7778 2e45 5654 5f42 5554 544f 4e2c 2073  wx.EVT_BUTTON, s
+0001fd50: 656c 662e 6f6e 5f65 7870 6f72 745f 636f  elf.on_export_co
+0001fd60: 6e74 6163 7473 5f6d 656e 752c 2062 7574  ntacts_menu, but
+0001fd70: 746f 6e5f 6578 706f 7274 5f63 6861 7473  ton_export_chats
+0001fd80: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+0001fd90: 4269 6e64 2877 782e 4556 545f 4255 5454  Bind(wx.EVT_BUTT
+0001fda0: 4f4e 2c20 7365 6c66 2e6f 6e5f 6578 706f  ON, self.on_expo
+0001fdb0: 7274 5f63 6f6e 7461 6374 732c 2020 2020  rt_contacts,    
+0001fdc0: 2020 6275 7474 6f6e 5f65 7870 6f72 745f    button_export_
+0001fdd0: 636f 6e74 6163 7473 290d 0a20 2020 2020  contacts)..     
+0001fde0: 2020 2073 697a 6572 312e 4164 6428 7369     sizer1.Add(si
+0001fdf0: 7a65 725f 746f 702c 2062 6f72 6465 723d  zer_top, border=
+0001fe00: 352c 0d0a 2020 2020 2020 2020 2020 2020  5,..            
+0001fe10: 2020 2020 2020 2066 6c61 673d 7778 2e52         flag=wx.R
+0001fe20: 4947 4854 207c 2077 782e 4c45 4654 207c  IGHT | wx.LEFT |
+0001fe30: 2077 782e 424f 5454 4f4d 207c 2077 782e   wx.BOTTOM | wx.
+0001fe40: 4752 4f57 290d 0a0d 0a20 2020 2020 2020  GROW)....       
+0001fe50: 2070 616e 656c 3220 3d20 7365 6c66 2e70   panel2 = self.p
+0001fe60: 616e 656c 5f63 6f6e 7461 6374 7332 203d  anel_contacts2 =
+0001fe70: 2077 782e 5061 6e65 6c28 7061 7265 6e74   wx.Panel(parent
+0001fe80: 3d73 706c 6974 7465 7229 0d0a 2020 2020  =splitter)..    
+0001fe90: 2020 2020 7369 7a65 7232 203d 2070 616e      sizer2 = pan
+0001fea0: 656c 322e 5369 7a65 7220 3d20 7778 2e42  el2.Sizer = wx.B
+0001feb0: 6f78 5369 7a65 7228 7778 2e56 4552 5449  oxSizer(wx.VERTI
+0001fec0: 4341 4c29 0d0a 2020 2020 2020 2020 7369  CAL)..        si
+0001fed0: 7a65 7232 5f74 6f70 203d 2077 782e 426f  zer2_top = wx.Bo
+0001fee0: 7853 697a 6572 2877 782e 484f 5249 5a4f  xSizer(wx.HORIZO
+0001fef0: 4e54 414c 290d 0a20 2020 2020 2020 206c  NTAL)..        l
+0001ff00: 6162 656c 5f63 6f6e 7461 6374 203d 2073  abel_contact = s
+0001ff10: 656c 662e 6c61 6265 6c5f 636f 6e74 6163  elf.label_contac
+0001ff20: 7420 3d20 7778 2e53 7461 7469 6354 6578  t = wx.StaticTex
+0001ff30: 7428 7061 7265 6e74 3d70 616e 656c 322c  t(parent=panel2,
+0001ff40: 206c 6162 656c 3d22 2643 6f6e 7461 6374   label="&Contact
+0001ff50: 3a22 290d 0a20 2020 2020 2020 2062 7574  :")..        but
+0001ff60: 746f 6e5f 6163 7469 6f6e 203d 2073 656c  ton_action = sel
+0001ff70: 662e 6275 7474 6f6e 5f61 6374 696f 6e5f  f.button_action_
+0001ff80: 636f 6e74 6163 7420 3d20 7778 2e42 7574  contact = wx.But
+0001ff90: 746f 6e28 0d0a 2020 2020 2020 2020 2020  ton(..          
+0001ffa0: 2020 7061 7265 6e74 3d70 616e 656c 322c    parent=panel2,
+0001ffb0: 206c 6162 656c 3d22 2641 6374 696f 6e73   label="&Actions
+0001ffc0: 202e 2e22 290d 0a20 2020 2020 2020 2062   ..")..        b
+0001ffd0: 7574 746f 6e5f 6578 706f 7274 203d 2073  utton_export = s
+0001ffe0: 656c 662e 6275 7474 6f6e 5f65 7870 6f72  elf.button_expor
+0001fff0: 745f 636f 6e74 6163 745f 6368 6174 7320  t_contact_chats 
+00020000: 3d20 7778 2e42 7574 746f 6e28 0d0a 2020  = wx.Button(..  
+00020010: 2020 2020 2020 2020 2020 7061 7265 6e74            parent
+00020020: 3d70 616e 656c 322c 206c 6162 656c 3d22  =panel2, label="
+00020030: 2645 7870 6f72 7420 636f 6e74 6163 7420  &Export contact 
+00020040: 6368 6174 7322 290d 0a20 2020 2020 2020  chats")..       
+00020050: 2062 7574 746f 6e5f 6163 7469 6f6e 2e53   button_action.S
+00020060: 6574 546f 6f6c 5469 7028 224f 7065 6e20  etToolTip("Open 
+00020070: 7375 626d 656e 7522 290d 0a20 2020 2020  submenu")..     
+00020080: 2020 2062 7574 746f 6e5f 6578 706f 7274     button_export
+00020090: 2e53 6574 546f 6f6c 5469 7028 2245 7870  .SetToolTip("Exp
+000200a0: 6f72 7420 636f 6e74 6163 7420 6368 6174  ort contact chat
+000200b0: 7320 616e 6420 6d65 7373 6167 6573 2074  s and messages t
+000200c0: 6f20 6669 6c65 2229 0d0a 2020 2020 2020  o file")..      
+000200d0: 2020 6874 6d6c 5f63 6f6e 7461 6374 203d    html_contact =
+000200e0: 2073 656c 662e 6874 6d6c 5f63 6f6e 7461   self.html_conta
+000200f0: 6374 203d 2077 782e 6874 6d6c 2e48 746d  ct = wx.html.Htm
+00020100: 6c57 696e 646f 7728 7061 7265 6e74 3d70  lWindow(parent=p
+00020110: 616e 656c 3229 0d0a 2020 2020 2020 2020  anel2)..        
+00020120: 6874 6d6c 5f63 6f6e 7461 6374 2e42 6163  html_contact.Bac
+00020130: 6b67 726f 756e 6443 6f6c 6f75 7220 3d20  kgroundColour = 
+00020140: 436f 6c6f 7572 4d61 6e61 6765 722e 4765  ColourManager.Ge
+00020150: 7443 6f6c 6f75 7228 7778 2e53 5953 5f43  tColour(wx.SYS_C
+00020160: 4f4c 4f55 525f 5749 4e44 4f57 290d 0a20  OLOUR_WINDOW).. 
+00020170: 2020 2020 2020 2070 616e 656c 322e 4469         panel2.Di
+00020180: 7361 626c 6528 290d 0a20 2020 2020 2020  sable()..       
+00020190: 2062 7574 746f 6e5f 6163 7469 6f6e 2e42   button_action.B
+000201a0: 696e 6428 7778 2e45 5654 5f42 5554 544f  ind(wx.EVT_BUTTO
+000201b0: 4e2c 2073 656c 662e 6f6e 5f6d 656e 755f  N, self.on_menu_
+000201c0: 6c69 7374 5f63 6f6e 7461 6374 7329 0d0a  list_contacts)..
+000201d0: 2020 2020 2020 2020 6275 7474 6f6e 5f65          button_e
+000201e0: 7870 6f72 742e 4269 6e64 2877 782e 4556  xport.Bind(wx.EV
+000201f0: 545f 4255 5454 4f4e 2c20 7365 6c66 2e6f  T_BUTTON, self.o
+00020200: 6e5f 6578 706f 7274 5f63 6f6e 7461 6374  n_export_contact
+00020210: 5f63 6861 7473 5f6d 656e 7529 0d0a 2020  _chats_menu)..  
+00020220: 2020 2020 2020 6874 6d6c 5f63 6f6e 7461        html_conta
+00020230: 6374 2e42 696e 6428 7778 2e68 746d 6c2e  ct.Bind(wx.html.
+00020240: 4556 545f 4854 4d4c 5f4c 494e 4b5f 434c  EVT_HTML_LINK_CL
+00020250: 4943 4b45 442c 2073 656c 662e 6f6e 5f63  ICKED, self.on_c
+00020260: 6c69 636b 5f68 746d 6c5f 636f 6e74 6163  lick_html_contac
+00020270: 7429 0d0a 2020 2020 2020 2020 6874 6d6c  t)..        html
+00020280: 5f63 6f6e 7461 6374 2e42 696e 6428 7778  _contact.Bind(wx
+00020290: 2e45 5654 5f43 4f4e 5445 5854 5f4d 454e  .EVT_CONTEXT_MEN
+000202a0: 552c 2020 2020 2020 2020 2020 2073 656c  U,           sel
+000202b0: 662e 6f6e 5f72 6967 6874 636c 6963 6b5f  f.on_rightclick_
+000202c0: 6874 6d6c 290d 0a20 2020 2020 2020 2068  html)..        h
+000202d0: 746d 6c5f 636f 6e74 6163 742e 4269 6e64  tml_contact.Bind
+000202e0: 2877 782e 4556 545f 5249 4748 545f 5550  (wx.EVT_RIGHT_UP
+000202f0: 2c20 2020 2020 2020 2020 2020 2020 2020  ,               
+00020300: 7365 6c66 2e6f 6e5f 7269 6768 7463 6c69  self.on_rightcli
+00020310: 636b 5f68 746d 6c29 0d0a 0d0a 2020 2020  ck_html)....    
+00020320: 2020 2020 7365 6c66 2e42 696e 6428 7778      self.Bind(wx
+00020330: 2e45 5654 5f4c 4953 545f 4954 454d 5f41  .EVT_LIST_ITEM_A
+00020340: 4354 4956 4154 4544 2c20 7365 6c66 2e6f  CTIVATED, self.o
+00020350: 6e5f 6368 616e 6765 5f6c 6973 745f 636f  n_change_list_co
+00020360: 6e74 6163 7473 2c20 6c69 7374 5f63 6f6e  ntacts, list_con
+00020370: 7461 6374 7329 0d0a 2020 2020 2020 2020  tacts)..        
+00020380: 6c69 7374 5f63 6f6e 7461 6374 732e 4269  list_contacts.Bi
+00020390: 6e64 2877 782e 4556 545f 434f 4e54 4558  nd(wx.EVT_CONTEX
+000203a0: 545f 4d45 4e55 2c20 7365 6c66 2e6f 6e5f  T_MENU, self.on_
+000203b0: 6d65 6e75 5f6c 6973 745f 636f 6e74 6163  menu_list_contac
+000203c0: 7473 290d 0a20 2020 2020 2020 206c 6973  ts)..        lis
+000203d0: 745f 636f 6e74 6163 7473 2e42 696e 6428  t_contacts.Bind(
+000203e0: 7778 2e45 5654 5f43 4841 525f 484f 4f4b  wx.EVT_CHAR_HOOK
+000203f0: 2c20 2020 2073 656c 662e 6f6e 5f6c 6973  ,    self.on_lis
+00020400: 745f 636f 6e74 6163 7473 5f6b 6579 290d  t_contacts_key).
+00020410: 0a0d 0a20 2020 2020 2020 2073 697a 6572  ...        sizer
+00020420: 312e 4164 6428 6c69 7374 5f63 6f6e 7461  1.Add(list_conta
+00020430: 6374 732c 2070 726f 706f 7274 696f 6e3d  cts, proportion=
+00020440: 312c 2062 6f72 6465 723d 352c 2066 6c61  1, border=5, fla
+00020450: 673d 7778 2e47 524f 5720 7c20 7778 2e4c  g=wx.GROW | wx.L
+00020460: 4546 5420 7c20 7778 2e52 4947 4854 290d  EFT | wx.RIGHT).
+00020470: 0a20 2020 2020 2020 2073 697a 6572 325f  .        sizer2_
+00020480: 746f 702e 4164 6428 6c61 6265 6c5f 636f  top.Add(label_co
+00020490: 6e74 6163 742c 2070 726f 706f 7274 696f  ntact, proportio
+000204a0: 6e3d 312c 2062 6f72 6465 723d 352c 2066  n=1, border=5, f
+000204b0: 6c61 673d 7778 2e4c 4546 5420 7c20 7778  lag=wx.LEFT | wx
+000204c0: 2e42 4f54 544f 4d20 7c20 7778 2e41 4c49  .BOTTOM | wx.ALI
+000204d0: 474e 5f42 4f54 544f 4d29 0d0a 2020 2020  GN_BOTTOM)..    
+000204e0: 2020 2020 7369 7a65 7232 5f74 6f70 2e41      sizer2_top.A
+000204f0: 6464 5374 7265 7463 6853 7061 6365 7228  ddStretchSpacer(
+00020500: 290d 0a20 2020 2020 2020 2073 697a 6572  )..        sizer
+00020510: 325f 746f 702e 4164 6428 6275 7474 6f6e  2_top.Add(button
+00020520: 5f61 6374 696f 6e2c 2062 6f72 6465 723d  _action, border=
+00020530: 352c 2066 6c61 673d 7778 2e42 4f54 544f  5, flag=wx.BOTTO
+00020540: 4d20 7c20 7778 2e52 4947 4854 290d 0a20  M | wx.RIGHT).. 
+00020550: 2020 2020 2020 2073 697a 6572 325f 746f         sizer2_to
+00020560: 702e 4164 6428 6275 7474 6f6e 5f65 7870  p.Add(button_exp
+00020570: 6f72 742c 2062 6f72 6465 723d 352c 2066  ort, border=5, f
+00020580: 6c61 673d 7778 2e42 4f54 544f 4d29 0d0a  lag=wx.BOTTOM)..
+00020590: 2020 2020 2020 2020 7369 7a65 7232 2e41          sizer2.A
+000205a0: 6464 2873 697a 6572 325f 746f 702c 2062  dd(sizer2_top, b
+000205b0: 6f72 6465 723d 352c 2066 6c61 673d 7778  order=5, flag=wx
+000205c0: 2e47 524f 5720 7c20 7778 2e41 4c4c 205e  .GROW | wx.ALL ^
+000205d0: 2077 782e 424f 5454 4f4d 290d 0a20 2020   wx.BOTTOM)..   
+000205e0: 2020 2020 2073 697a 6572 322e 4164 6428       sizer2.Add(
+000205f0: 6874 6d6c 5f63 6f6e 7461 6374 2c20 2062  html_contact,  b
+00020600: 6f72 6465 723d 352c 2066 6c61 673d 7778  order=5, flag=wx
+00020610: 2e47 524f 5720 7c20 7778 2e41 4c4c 205e  .GROW | wx.ALL ^
+00020620: 2077 782e 544f 502c 2070 726f 706f 7274   wx.TOP, proport
+00020630: 696f 6e3d 3129 0d0a 0d0a 2020 2020 2020  ion=1)....      
+00020640: 2020 7369 7a65 722e 4164 6453 7061 6365    sizer.AddSpace
+00020650: 7228 3130 290d 0a20 2020 2020 2020 2073  r(10)..        s
+00020660: 697a 6572 2e41 6464 2873 706c 6974 7465  izer.Add(splitte
+00020670: 722c 2070 726f 706f 7274 696f 6e3d 312c  r, proportion=1,
+00020680: 2066 6c61 673d 7778 2e47 524f 5729 0d0a   flag=wx.GROW)..
+00020690: 2020 2020 2020 2020 7370 6c69 7474 6572          splitter
+000206a0: 2e53 706c 6974 486f 7269 7a6f 6e74 616c  .SplitHorizontal
+000206b0: 6c79 2870 616e 656c 312c 2070 616e 656c  ly(panel1, panel
+000206c0: 322c 2073 6173 6850 6f73 6974 696f 6e3d  2, sashPosition=
+000206d0: 7365 6c66 2e53 697a 655b 315d 202f 2f20  self.Size[1] // 
+000206e0: 3329 0d0a 0d0a 0d0a 2020 2020 6465 6620  3)......    def 
+000206f0: 6372 6561 7465 5f70 6167 655f 7365 6172  create_page_sear
+00020700: 6368 2873 656c 662c 206e 6f74 6562 6f6f  ch(self, noteboo
+00020710: 6b29 3a0d 0a20 2020 2020 2020 2022 2222  k):..        """
+00020720: 4372 6561 7465 7320 6120 7061 6765 2066  Creates a page f
+00020730: 6f72 2073 6561 7263 6869 6e67 2063 6861  or searching cha
+00020740: 7473 2e22 2222 0d0a 2020 2020 2020 2020  ts."""..        
+00020750: 7061 6765 203d 2073 656c 662e 7061 6765  page = self.page
+00020760: 5f73 6561 7263 6820 3d20 7778 2e50 616e  _search = wx.Pan
+00020770: 656c 2870 6172 656e 743d 6e6f 7465 626f  el(parent=notebo
+00020780: 6f6b 290d 0a20 2020 2020 2020 2073 656c  ok)..        sel
+00020790: 662e 7061 6765 6f72 6465 725b 7061 6765  f.pageorder[page
+000207a0: 5d20 3d20 6c65 6e28 7365 6c66 2e70 6167  ] = len(self.pag
+000207b0: 656f 7264 6572 290d 0a20 2020 2020 2020  eorder)..       
+000207c0: 206e 6f74 6562 6f6f 6b2e 4164 6450 6167   notebook.AddPag
+000207d0: 6528 7061 6765 2c20 2253 6561 7263 6822  e(page, "Search"
+000207e0: 290d 0a20 2020 2020 2020 2073 697a 6572  )..        sizer
+000207f0: 203d 2070 6167 652e 5369 7a65 7220 3d20   = page.Sizer = 
+00020800: 7778 2e42 6f78 5369 7a65 7228 7778 2e56  wx.BoxSizer(wx.V
+00020810: 4552 5449 4341 4c29 0d0a 2020 2020 2020  ERTICAL)..      
+00020820: 2020 7369 7a65 725f 746f 7020 3d20 7778    sizer_top = wx
+00020830: 2e42 6f78 5369 7a65 7228 7778 2e48 4f52  .BoxSizer(wx.HOR
+00020840: 495a 4f4e 5441 4c29 0d0a 0d0a 2020 2020  IZONTAL)....    
+00020850: 2020 2020 6c61 6265 6c5f 6874 6d6c 203d      label_html =
+00020860: 2073 656c 662e 6c61 6265 6c5f 6874 6d6c   self.label_html
+00020870: 203d 205c 0d0a 2020 2020 2020 2020 2020   = \..          
+00020880: 2020 7778 2e68 746d 6c2e 4874 6d6c 5769    wx.html.HtmlWi
+00020890: 6e64 6f77 2870 6167 652c 2073 7479 6c65  ndow(page, style
+000208a0: 3d77 782e 6874 6d6c 2e48 575f 5343 524f  =wx.html.HW_SCRO
+000208b0: 4c4c 4241 525f 4e45 5645 5229 0d0a 2020  LLBAR_NEVER)..  
+000208c0: 2020 2020 2020 6c61 6265 6c5f 6874 6d6c        label_html
+000208d0: 2e53 6574 466f 6e74 7328 6e6f 726d 616c  .SetFonts(normal
+000208e0: 5f66 6163 653d 7365 6c66 2e46 6f6e 742e  _face=self.Font.
+000208f0: 4661 6365 4e61 6d65 2c0d 0a20 2020 2020  FaceName,..     
+00020900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020910: 2020 2020 2020 2066 6978 6564 5f66 6163         fixed_fac
+00020920: 653d 7365 6c66 2e46 6f6e 742e 4661 6365  e=self.Font.Face
+00020930: 4e61 6d65 2c20 7369 7a65 733d 5b38 5d20  Name, sizes=[8] 
+00020940: 2a20 3729 0d0a 2020 2020 2020 2020 6c61  * 7)..        la
+00020950: 6265 6c5f 6874 6d6c 2e53 6574 5061 6765  bel_html.SetPage
+00020960: 2873 7465 702e 5465 6d70 6c61 7465 2874  (step.Template(t
+00020970: 656d 706c 6174 6573 2e53 4541 5243 485f  emplates.SEARCH_
+00020980: 4845 4c50 5f53 484f 5254 292e 6578 7061  HELP_SHORT).expa
+00020990: 6e64 2829 290d 0a0d 0a20 2020 2020 2020  nd())....       
+000209a0: 2074 6220 3d20 7365 6c66 2e74 625f 7365   tb = self.tb_se
+000209b0: 6172 6368 5f73 6574 7469 6e67 7320 3d20  arch_settings = 
+000209c0: 5c0d 0a20 2020 2020 2020 2020 2020 2077  \..            w
+000209d0: 782e 546f 6f6c 4261 7228 7061 7265 6e74  x.ToolBar(parent
+000209e0: 3d70 6167 652c 2073 7479 6c65 3d77 782e  =page, style=wx.
+000209f0: 5442 5f46 4c41 5420 7c20 7778 2e54 425f  TB_FLAT | wx.TB_
+00020a00: 4e4f 4449 5649 4445 5229 0d0a 2020 2020  NODIVIDER)..    
+00020a10: 2020 2020 7462 2e4d 696e 5369 7a65 203d      tb.MinSize =
+00020a20: 2028 3139 352c 202d 3129 0d0a 2020 2020   (195, -1)..    
+00020a30: 2020 2020 7462 2e53 6574 546f 6f6c 4269      tb.SetToolBi
+00020a40: 746d 6170 5369 7a65 2828 3234 2c20 3234  tmapSize((24, 24
+00020a50: 2929 0d0a 2020 2020 2020 2020 7462 2e41  ))..        tb.A
+00020a60: 6464 5261 6469 6f54 6f6f 6c28 7778 2e49  ddRadioTool(wx.I
+00020a70: 445f 494e 4445 582c 2022 222c 2062 6974  D_INDEX, "", bit
+00020a80: 6d61 7031 3d69 6d61 6765 732e 546f 6f6c  map1=images.Tool
+00020a90: 6261 724d 6573 7361 6765 2e42 6974 6d61  barMessage.Bitma
+00020aa0: 702c 0d0a 2020 2020 2020 2020 2020 2020  p,..            
+00020ab0: 7368 6f72 7448 656c 703d 2253 6561 7263  shortHelp="Searc
+00020ac0: 6820 696e 206d 6573 7361 6765 2062 6f64  h in message bod
+00020ad0: 7922 290d 0a20 2020 2020 2020 2074 622e  y")..        tb.
+00020ae0: 4164 6452 6164 696f 546f 6f6c 2877 782e  AddRadioTool(wx.
+00020af0: 4944 5f50 5245 5649 4557 2c20 2222 2c20  ID_PREVIEW, "", 
+00020b00: 6269 746d 6170 313d 696d 6167 6573 2e54  bitmap1=images.T
+00020b10: 6f6f 6c62 6172 436f 6e74 6163 742e 4269  oolbarContact.Bi
+00020b20: 746d 6170 2c0d 0a20 2020 2020 2020 2020  tmap,..         
+00020b30: 2020 2073 686f 7274 4865 6c70 3d22 5365     shortHelp="Se
+00020b40: 6172 6368 2069 6e20 636f 6e74 6163 7420  arch in contact 
+00020b50: 696e 666f 726d 6174 696f 6e22 290d 0a20  information").. 
+00020b60: 2020 2020 2020 2074 622e 4164 6452 6164         tb.AddRad
+00020b70: 696f 546f 6f6c 2877 782e 4944 5f41 424f  ioTool(wx.ID_ABO
+00020b80: 5554 2c20 2222 2c20 6269 746d 6170 313d  UT, "", bitmap1=
+00020b90: 696d 6167 6573 2e54 6f6f 6c62 6172 5469  images.ToolbarTi
+00020ba0: 746c 652e 4269 746d 6170 2c0d 0a20 2020  tle.Bitmap,..   
+00020bb0: 2020 2020 2020 2020 2073 686f 7274 4865           shortHe
+00020bc0: 6c70 3d22 5365 6172 6368 2069 6e20 6368  lp="Search in ch
+00020bd0: 6174 2074 6974 6c65 2061 6e64 2070 6172  at title and par
+00020be0: 7469 6369 7061 6e74 7322 290d 0a20 2020  ticipants")..   
+00020bf0: 2020 2020 2074 622e 4164 6452 6164 696f       tb.AddRadio
+00020c00: 546f 6f6c 2877 782e 4944 5f53 5441 5449  Tool(wx.ID_STATI
+00020c10: 432c 2022 222c 2062 6974 6d61 7031 3d69  C, "", bitmap1=i
+00020c20: 6d61 6765 732e 546f 6f6c 6261 7254 6162  mages.ToolbarTab
+00020c30: 6c65 732e 4269 746d 6170 2c0d 0a20 2020  les.Bitmap,..   
+00020c40: 2020 2020 2020 2020 2073 686f 7274 4865           shortHe
+00020c50: 6c70 3d22 5365 6172 6368 2069 6e20 616c  lp="Search in al
+00020c60: 6c20 636f 6c75 6d6e 7320 6f66 2061 6c6c  l columns of all
+00020c70: 2064 6174 6162 6173 6520 7461 626c 6573   database tables
+00020c80: 2229 0d0a 2020 2020 2020 2020 7462 2e41  ")..        tb.A
+00020c90: 6464 5365 7061 7261 746f 7228 290d 0a20  ddSeparator().. 
+00020ca0: 2020 2020 2020 2074 622e 4164 6443 6865         tb.AddChe
+00020cb0: 636b 546f 6f6c 2877 782e 4944 5f4e 4557  ckTool(wx.ID_NEW
+00020cc0: 2c20 2222 2c20 6269 746d 6170 313d 696d  , "", bitmap1=im
+00020cd0: 6167 6573 2e54 6f6f 6c62 6172 5461 6273  ages.ToolbarTabs
+00020ce0: 2e42 6974 6d61 702c 0d0a 2020 2020 2020  .Bitmap,..      
+00020cf0: 2020 2020 2020 7368 6f72 7448 656c 703d        shortHelp=
+00020d00: 224e 6577 2074 6162 2066 6f72 2065 6163  "New tab for eac
+00020d10: 6820 7365 6172 6368 2020 2841 6c74 2d4e  h search  (Alt-N
+00020d20: 2922 2c20 6c6f 6e67 4865 6c70 3d22 2229  )", longHelp="")
+00020d30: 0d0a 2020 2020 2020 2020 7462 2e41 6464  ..        tb.Add
+00020d40: 546f 6f6c 2877 782e 4944 5f53 544f 502c  Tool(wx.ID_STOP,
+00020d50: 2022 222c 2062 6974 6d61 703d 696d 6167   "", bitmap=imag
+00020d60: 6573 2e54 6f6f 6c62 6172 5374 6f70 7065  es.ToolbarStoppe
+00020d70: 642e 4269 746d 6170 2c0d 0a20 2020 2020  d.Bitmap,..     
+00020d80: 2020 2020 2020 2073 686f 7274 4865 6c70         shortHelp
+00020d90: 3d22 5374 6f70 2063 7572 7265 6e74 2073  ="Stop current s
+00020da0: 6561 7263 682c 2069 6620 616e 7922 290d  earch, if any").
+00020db0: 0a20 2020 2020 2020 2074 622e 5265 616c  .        tb.Real
+00020dc0: 697a 6528 290d 0a20 2020 2020 2020 2074  ize()..        t
+00020dd0: 622e 546f 6767 6c65 546f 6f6c 2877 782e  b.ToggleTool(wx.
+00020de0: 4944 5f49 4e44 4558 2c20 636f 6e66 2e53  ID_INDEX, conf.S
+00020df0: 6561 7263 6849 6e4d 6573 7361 6765 7329  earchInMessages)
+00020e00: 0d0a 2020 2020 2020 2020 7462 2e54 6f67  ..        tb.Tog
+00020e10: 676c 6554 6f6f 6c28 7778 2e49 445f 4142  gleTool(wx.ID_AB
+00020e20: 4f55 542c 2063 6f6e 662e 5365 6172 6368  OUT, conf.Search
+00020e30: 496e 4368 6174 496e 666f 290d 0a20 2020  InChatInfo)..   
+00020e40: 2020 2020 2074 622e 546f 6767 6c65 546f       tb.ToggleTo
+00020e50: 6f6c 2877 782e 4944 5f50 5245 5649 4557  ol(wx.ID_PREVIEW
+00020e60: 2c20 636f 6e66 2e53 6561 7263 6849 6e43  , conf.SearchInC
+00020e70: 6f6e 7461 6374 7329 0d0a 2020 2020 2020  ontacts)..      
+00020e80: 2020 7462 2e54 6f67 676c 6554 6f6f 6c28    tb.ToggleTool(
+00020e90: 7778 2e49 445f 5354 4154 4943 2c20 636f  wx.ID_STATIC, co
+00020ea0: 6e66 2e53 6561 7263 6849 6e54 6162 6c65  nf.SearchInTable
+00020eb0: 7329 0d0a 2020 2020 2020 2020 7462 2e54  s)..        tb.T
+00020ec0: 6f67 676c 6554 6f6f 6c28 7778 2e49 445f  oggleTool(wx.ID_
+00020ed0: 4e45 572c 2063 6f6e 662e 5365 6172 6368  NEW, conf.Search
+00020ee0: 5573 654e 6577 5461 6229 0d0a 2020 2020  UseNewTab)..    
+00020ef0: 2020 2020 666f 7220 6964 2069 6e20 5b77      for id in [w
+00020f00: 782e 4944 5f49 4e44 4558 2c20 7778 2e49  x.ID_INDEX, wx.I
+00020f10: 445f 4142 4f55 542c 2077 782e 4944 5f50  D_ABOUT, wx.ID_P
+00020f20: 5245 5649 4557 2c20 7778 2e49 445f 5354  REVIEW, wx.ID_ST
+00020f30: 4154 4943 2c0d 0a20 2020 2020 2020 2020  ATIC,..         
+00020f40: 2020 2020 2020 2020 2020 7778 2e49 445f            wx.ID_
+00020f50: 4e45 575d 3a0d 0a20 2020 2020 2020 2020  NEW]:..         
+00020f60: 2020 2073 656c 662e 4269 6e64 2877 782e     self.Bind(wx.
+00020f70: 4556 545f 544f 4f4c 2c20 7365 6c66 2e6f  EVT_TOOL, self.o
+00020f80: 6e5f 7365 6172 6368 616c 6c5f 746f 6767  n_searchall_togg
+00020f90: 6c65 5f74 6f6f 6c62 6172 2c20 6964 3d69  le_toolbar, id=i
+00020fa0: 6429 0d0a 2020 2020 2020 2020 7365 6c66  d)..        self
+00020fb0: 2e42 696e 6428 7778 2e45 5654 5f54 4f4f  .Bind(wx.EVT_TOO
+00020fc0: 4c2c 2073 656c 662e 6f6e 5f73 6561 7263  L, self.on_searc
+00020fd0: 6861 6c6c 5f73 746f 702c 2069 643d 7778  hall_stop, id=wx
+00020fe0: 2e49 445f 5354 4f50 290d 0a0d 0a20 2020  .ID_STOP)....   
+00020ff0: 2020 2020 2069 6620 636f 6e66 2e53 6561       if conf.Sea
+00021000: 7263 6849 6e43 6861 7449 6e66 6f3a 0d0a  rchInChatInfo:..
+00021010: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00021020: 2e6c 6162 656c 5f73 6561 7263 682e 4c61  .label_search.La
+00021030: 6265 6c20 3d20 2226 5365 6172 6368 2069  bel = "&Search i
+00021040: 6e20 6368 6174 2069 6e66 6f3a 220d 0a20  n chat info:".. 
+00021050: 2020 2020 2020 2065 6c69 6620 636f 6e66         elif conf
+00021060: 2e53 6561 7263 6849 6e43 6f6e 7461 6374  .SearchInContact
+00021070: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
+00021080: 7365 6c66 2e6c 6162 656c 5f73 6561 7263  self.label_searc
+00021090: 682e 4c61 6265 6c20 3d20 2226 5365 6172  h.Label = "&Sear
+000210a0: 6368 2069 6e20 636f 6e74 6163 7473 3a22  ch in contacts:"
+000210b0: 0d0a 2020 2020 2020 2020 656c 6966 2063  ..        elif c
+000210c0: 6f6e 662e 5365 6172 6368 496e 5461 626c  onf.SearchInTabl
+000210d0: 6573 3a0d 0a20 2020 2020 2020 2020 2020  es:..           
+000210e0: 2073 656c 662e 6c61 6265 6c5f 7365 6172   self.label_sear
+000210f0: 6368 2e4c 6162 656c 203d 2022 2653 6561  ch.Label = "&Sea
+00021100: 7263 6820 696e 2061 6c6c 2074 6162 6c65  rch in all table
+00021110: 733a 220d 0a0d 0a20 2020 2020 2020 2068  s:"....        h
+00021120: 746d 6c20 3d20 7365 6c66 2e68 746d 6c5f  tml = self.html_
+00021130: 7365 6172 6368 616c 6c20 3d20 636f 6e74  searchall = cont
+00021140: 726f 6c73 2e54 6162 6265 6448 746d 6c57  rols.TabbedHtmlW
+00021150: 696e 646f 7728 7061 7265 6e74 3d70 6167  indow(parent=pag
+00021160: 6529 0d0a 2020 2020 2020 2020 436f 6c6f  e)..        Colo
+00021170: 7572 4d61 6e61 6765 722e 4d61 6e61 6765  urManager.Manage
+00021180: 2868 746d 6c2c 2022 5461 6241 7265 6143  (html, "TabAreaC
+00021190: 6f6c 6f75 7222 2c20 2257 6964 6765 7443  olour", "WidgetC
+000211a0: 6f6c 6f75 7222 290d 0a20 2020 2020 2020  olour")..       
+000211b0: 2064 6566 6175 6c74 203d 2073 7465 702e   default = step.
+000211c0: 5465 6d70 6c61 7465 2874 656d 706c 6174  Template(templat
+000211d0: 6573 2e53 4541 5243 485f 5745 4c43 4f4d  es.SEARCH_WELCOM
+000211e0: 455f 4854 4d4c 292e 6578 7061 6e64 2829  E_HTML).expand()
+000211f0: 0d0a 2020 2020 2020 2020 6874 6d6c 2e53  ..        html.S
+00021200: 6574 4465 6661 756c 7450 6167 6528 6465  etDefaultPage(de
+00021210: 6661 756c 7429 0d0a 2020 2020 2020 2020  fault)..        
+00021220: 6874 6d6c 2e53 6574 4465 6c65 7465 4361  html.SetDeleteCa
+00021230: 6c6c 6261 636b 2873 656c 662e 6f6e 5f64  llback(self.on_d
+00021240: 656c 6574 655f 7461 625f 6361 6c6c 6261  elete_tab_callba
+00021250: 636b 290d 0a20 2020 2020 2020 206c 6162  ck)..        lab
+00021260: 656c 5f68 746d 6c2e 4269 6e64 2877 782e  el_html.Bind(wx.
+00021270: 4556 545f 5249 4748 545f 5550 2c20 2020  EVT_RIGHT_UP,   
+00021280: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00021290: 2e6f 6e5f 7269 6768 7463 6c69 636b 5f68  .on_rightclick_h
+000212a0: 746d 6c29 0d0a 2020 2020 2020 2020 6c61  tml)..        la
+000212b0: 6265 6c5f 6874 6d6c 2e42 696e 6428 7778  bel_html.Bind(wx
+000212c0: 2e68 746d 6c2e 4556 545f 4854 4d4c 5f4c  .html.EVT_HTML_L
+000212d0: 494e 4b5f 434c 4943 4b45 442c 2073 656c  INK_CLICKED, sel
+000212e0: 662e 6f6e 5f63 6c69 636b 5f68 746d 6c5f  f.on_click_html_
+000212f0: 6c69 6e6b 290d 0a20 2020 2020 2020 2068  link)..        h
+00021300: 746d 6c2e 4269 6e64 2877 782e 6874 6d6c  tml.Bind(wx.html
+00021310: 2e45 5654 5f48 544d 4c5f 4c49 4e4b 5f43  .EVT_HTML_LINK_C
+00021320: 4c49 434b 4544 2c20 2020 2020 2020 7365  LICKED,       se
+00021330: 6c66 2e6f 6e5f 636c 6963 6b5f 6874 6d6c  lf.on_click_html
+00021340: 5f6c 696e 6b29 0d0a 2020 2020 2020 2020  _link)..        
+00021350: 6874 6d6c 2e48 746d 6c57 696e 646f 772e  html.HtmlWindow.
+00021360: 4269 6e64 2877 782e 4556 545f 434f 4e54  Bind(wx.EVT_CONT
+00021370: 4558 545f 4d45 4e55 2c20 2020 2020 2073  EXT_MENU,      s
+00021380: 656c 662e 6f6e 5f72 6967 6874 636c 6963  elf.on_rightclic
+00021390: 6b5f 6874 6d6c 290d 0a20 2020 2020 2020  k_html)..       
+000213a0: 2068 746d 6c2e 4874 6d6c 5769 6e64 6f77   html.HtmlWindow
+000213b0: 2e42 696e 6428 7778 2e45 5654 5f52 4947  .Bind(wx.EVT_RIG
+000213c0: 4854 5f55 502c 2020 2020 2020 2020 2020  HT_UP,          
+000213d0: 7365 6c66 2e6f 6e5f 7269 6768 7463 6c69  self.on_rightcli
+000213e0: 636b 5f68 746d 6c29 0d0a 2020 2020 2020  ck_html)..      
+000213f0: 2020 6874 6d6c 2e42 696e 6428 7778 2e45    html.Bind(wx.E
+00021400: 5654 5f4e 4f54 4542 4f4f 4b5f 5041 4745  VT_NOTEBOOK_PAGE
+00021410: 5f43 4841 4e47 4544 2c20 2020 2020 2020  _CHANGED,       
+00021420: 2073 656c 662e 6f6e 5f63 6861 6e67 655f   self.on_change_
+00021430: 7365 6172 6368 616c 6c5f 7461 6229 0d0a  searchall_tab)..
+00021440: 2020 2020 2020 2020 6874 6d6c 2e42 696e          html.Bin
+00021450: 6428 636f 6e74 726f 6c73 2e45 5654 5f54  d(controls.EVT_T
+00021460: 4142 5f4c 4546 545f 4443 4c49 434b 2c20  AB_LEFT_DCLICK, 
+00021470: 2020 2020 2020 2073 656c 662e 6f6e 5f64         self.on_d
+00021480: 636c 6963 6b5f 7365 6172 6368 616c 6c5f  click_searchall_
+00021490: 7461 6229 0d0a 2020 2020 2020 2020 6874  tab)..        ht
+000214a0: 6d6c 2e46 6f6e 742e 5069 7865 6c53 697a  ml.Font.PixelSiz
+000214b0: 6520 3d20 2830 2c20 3829 0d0a 0d0a 2020  e = (0, 8)....  
+000214c0: 2020 2020 2020 436f 6c6f 7572 4d61 6e61        ColourMana
+000214d0: 6765 722e 4d61 6e61 6765 286c 6162 656c  ger.Manage(label
+000214e0: 5f68 746d 6c2c 2022 4261 636b 6772 6f75  _html, "Backgrou
+000214f0: 6e64 436f 6c6f 7572 222c 2022 5769 6467  ndColour", "Widg
+00021500: 6574 436f 6c6f 7572 2229 0d0a 0d0a 2020  etColour")....  
+00021510: 2020 2020 2020 7369 7a65 725f 746f 702e        sizer_top.
+00021520: 4164 6428 6c61 6265 6c5f 6874 6d6c 2c20  Add(label_html, 
+00021530: 7072 6f70 6f72 7469 6f6e 3d31 2c20 666c  proportion=1, fl
+00021540: 6167 3d77 782e 4752 4f57 290d 0a20 2020  ag=wx.GROW)..   
+00021550: 2020 2020 2073 697a 6572 5f74 6f70 2e41       sizer_top.A
+00021560: 6464 2874 622c 2062 6f72 6465 723d 352c  dd(tb, border=5,
+00021570: 2066 6c61 673d 7778 2e54 4f50 207c 2077   flag=wx.TOP | w
+00021580: 782e 5249 4748 5420 7c0d 0a20 2020 2020  x.RIGHT |..     
+00021590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000215a0: 2077 782e 414c 4947 4e5f 4345 4e54 4552   wx.ALIGN_CENTER
+000215b0: 5f56 4552 5449 4341 4c29 0d0a 2020 2020  _VERTICAL)..    
+000215c0: 2020 2020 7369 7a65 722e 4164 6428 7369      sizer.Add(si
+000215d0: 7a65 725f 746f 702c 2062 6f72 6465 723d  zer_top, border=
+000215e0: 352c 2066 6c61 673d 7778 2e54 4f50 207c  5, flag=wx.TOP |
+000215f0: 2077 782e 5249 4748 5420 7c20 7778 2e47   wx.RIGHT | wx.G
+00021600: 524f 5729 0d0a 2020 2020 2020 2020 7369  ROW)..        si
+00021610: 7a65 722e 4164 6428 6874 6d6c 2c20 626f  zer.Add(html, bo
+00021620: 7264 6572 3d35 2c20 7072 6f70 6f72 7469  rder=5, proporti
+00021630: 6f6e 3d31 2c0d 0a20 2020 2020 2020 2020  on=1,..         
+00021640: 2020 2020 2020 2020 2066 6c61 673d 7778           flag=wx
+00021650: 2e47 524f 5720 7c20 7778 2e4c 4546 5420  .GROW | wx.LEFT 
+00021660: 7c20 7778 2e52 4947 4854 207c 2077 782e  | wx.RIGHT | wx.
+00021670: 424f 5454 4f4d 290d 0a20 2020 2020 2020  BOTTOM)..       
+00021680: 2077 782e 4361 6c6c 4166 7465 7228 6c61   wx.CallAfter(la
+00021690: 6d62 6461 3a20 6c61 6265 6c5f 6874 6d6c  mbda: label_html
+000216a0: 2061 6e64 206c 6162 656c 5f68 746d 6c2e   and label_html.
+000216b0: 5368 6f77 2829 290d 0a0d 0a0d 0a20 2020  Show())......   
+000216c0: 2064 6566 2063 7265 6174 655f 7061 6765   def create_page
+000216d0: 5f74 6162 6c65 7328 7365 6c66 2c20 6e6f  _tables(self, no
+000216e0: 7465 626f 6f6b 293a 0d0a 2020 2020 2020  tebook):..      
+000216f0: 2020 2222 2243 7265 6174 6573 2061 2070    """Creates a p
+00021700: 6167 6520 666f 7220 6c69 7374 696e 6720  age for listing 
+00021710: 616e 6420 6272 6f77 7369 6e67 2074 6162  and browsing tab
+00021720: 6c65 732e 2222 220d 0a20 2020 2020 2020  les."""..       
+00021730: 2070 6167 6520 3d20 7365 6c66 2e70 6167   page = self.pag
+00021740: 655f 7461 626c 6573 203d 2077 782e 5061  e_tables = wx.Pa
+00021750: 6e65 6c28 7061 7265 6e74 3d6e 6f74 6562  nel(parent=noteb
+00021760: 6f6f 6b29 0d0a 2020 2020 2020 2020 7365  ook)..        se
+00021770: 6c66 2e70 6167 656f 7264 6572 5b70 6167  lf.pageorder[pag
+00021780: 655d 203d 206c 656e 2873 656c 662e 7061  e] = len(self.pa
+00021790: 6765 6f72 6465 7229 0d0a 2020 2020 2020  georder)..      
+000217a0: 2020 6e6f 7465 626f 6f6b 2e41 6464 5061    notebook.AddPa
+000217b0: 6765 2870 6167 652c 2022 4461 7461 2074  ge(page, "Data t
+000217c0: 6162 6c65 7322 290d 0a20 2020 2020 2020  ables")..       
+000217d0: 2073 697a 6572 203d 2070 6167 652e 5369   sizer = page.Si
+000217e0: 7a65 7220 3d20 7778 2e42 6f78 5369 7a65  zer = wx.BoxSize
+000217f0: 7228 7778 2e48 4f52 495a 4f4e 5441 4c29  r(wx.HORIZONTAL)
+00021800: 0d0a 2020 2020 2020 2020 7370 6c69 7474  ..        splitt
+00021810: 6572 203d 2073 656c 662e 7370 6c69 7474  er = self.splitt
+00021820: 6572 5f74 6162 6c65 7320 3d20 7778 2e53  er_tables = wx.S
+00021830: 706c 6974 7465 7257 696e 646f 7728 0d0a  plitterWindow(..
+00021840: 2020 2020 2020 2020 2020 2020 7061 7265              pare
+00021850: 6e74 3d70 6167 652c 2073 7479 6c65 3d77  nt=page, style=w
+00021860: 782e 424f 5244 4552 5f4e 4f4e 450d 0a20  x.BORDER_NONE.. 
+00021870: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
+00021880: 2020 7370 6c69 7474 6572 2e53 6574 4d69    splitter.SetMi
+00021890: 6e69 6d75 6d50 616e 6553 697a 6528 3130  nimumPaneSize(10
+000218a0: 3029 0d0a 0d0a 2020 2020 2020 2020 7061  0)....        pa
+000218b0: 6e65 6c31 203d 2077 782e 5061 6e65 6c28  nel1 = wx.Panel(
+000218c0: 7061 7265 6e74 3d73 706c 6974 7465 7229  parent=splitter)
+000218d0: 0d0a 2020 2020 2020 2020 7369 7a65 7231  ..        sizer1
+000218e0: 203d 2070 616e 656c 312e 5369 7a65 7220   = panel1.Sizer 
+000218f0: 3d20 7778 2e42 6f78 5369 7a65 7228 7778  = wx.BoxSizer(wx
+00021900: 2e56 4552 5449 4341 4c29 0d0a 2020 2020  .VERTICAL)..    
+00021910: 2020 2020 7369 7a65 725f 746f 706c 6566      sizer_toplef
+00021920: 7420 3d20 7778 2e42 6f78 5369 7a65 7228  t = wx.BoxSizer(
+00021930: 7778 2e48 4f52 495a 4f4e 5441 4c29 0d0a  wx.HORIZONTAL)..
+00021940: 2020 2020 2020 2020 7369 7a65 725f 746f          sizer_to
+00021950: 706c 6566 742e 4164 6428 7778 2e53 7461  pleft.Add(wx.Sta
+00021960: 7469 6354 6578 7428 7061 7265 6e74 3d70  ticText(parent=p
+00021970: 616e 656c 312c 206c 6162 656c 3d22 2654  anel1, label="&T
+00021980: 6162 6c65 733a 2229 2c0d 0a20 2020 2020  ables:"),..     
+00021990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000219a0: 2020 2020 2066 6c61 673d 7778 2e41 4c49       flag=wx.ALI
+000219b0: 474e 5f43 454e 5445 525f 5645 5254 4943  GN_CENTER_VERTIC
+000219c0: 414c 290d 0a20 2020 2020 2020 2062 7574  AL)..        but
+000219d0: 746f 6e5f 7265 6672 6573 6820 3d20 7365  ton_refresh = se
+000219e0: 6c66 2e62 7574 746f 6e5f 7265 6672 6573  lf.button_refres
+000219f0: 685f 7461 626c 6573 203d 205c 0d0a 2020  h_tables = \..  
+00021a00: 2020 2020 2020 2020 2020 7778 2e42 7574            wx.But
+00021a10: 746f 6e28 7061 6e65 6c31 2c20 6c61 6265  ton(panel1, labe
+00021a20: 6c3d 2252 6566 7265 7368 2229 0d0a 2020  l="Refresh")..  
+00021a30: 2020 2020 2020 7369 7a65 725f 746f 706c        sizer_topl
+00021a40: 6566 742e 4164 6453 7472 6574 6368 5370  eft.AddStretchSp
+00021a50: 6163 6572 2829 0d0a 2020 2020 2020 2020  acer()..        
+00021a60: 7369 7a65 725f 746f 706c 6566 742e 4164  sizer_topleft.Ad
+00021a70: 6428 6275 7474 6f6e 5f72 6566 7265 7368  d(button_refresh
+00021a80: 290d 0a20 2020 2020 2020 2074 7265 6520  )..        tree 
+00021a90: 3d20 7365 6c66 2e74 7265 655f 7461 626c  = self.tree_tabl
+00021aa0: 6573 203d 2077 782e 6c69 622e 6769 7a6d  es = wx.lib.gizm
+00021ab0: 6f73 2e54 7265 654c 6973 7443 7472 6c28  os.TreeListCtrl(
+00021ac0: 7061 6e65 6c31 2c0d 0a20 2020 2020 2020  panel1,..       
+00021ad0: 2020 2020 2061 6777 5374 796c 653d 7778       agwStyle=wx
+00021ae0: 2e54 525f 4445 4641 554c 545f 5354 594c  .TR_DEFAULT_STYL
+00021af0: 4520 7c20 7778 2e54 525f 4655 4c4c 5f52  E | wx.TR_FULL_R
+00021b00: 4f57 5f48 4947 484c 4947 4854 0d0a 2020  OW_HIGHLIGHT..  
+00021b10: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+00021b20: 2043 6f6c 6f75 724d 616e 6167 6572 2e4d   ColourManager.M
+00021b30: 616e 6167 6528 7472 6565 2c20 2242 6163  anage(tree, "Bac
+00021b40: 6b67 726f 756e 6443 6f6c 6f75 7222 2c20  kgroundColour", 
+00021b50: 7778 2e53 5953 5f43 4f4c 4f55 525f 5749  wx.SYS_COLOUR_WI
+00021b60: 4e44 4f57 290d 0a20 2020 2020 2020 2043  NDOW)..        C
+00021b70: 6f6c 6f75 724d 616e 6167 6572 2e4d 616e  olourManager.Man
+00021b80: 6167 6528 7472 6565 2c20 2246 6f72 6567  age(tree, "Foreg
+00021b90: 726f 756e 6443 6f6c 6f75 7222 2c20 7778  roundColour", wx
+00021ba0: 2e53 5953 5f43 4f4c 4f55 525f 4254 4e54  .SYS_COLOUR_BTNT
+00021bb0: 4558 5429 0d0a 2020 2020 2020 2020 7472  EXT)..        tr
+00021bc0: 6565 2e41 6464 436f 6c75 6d6e 2822 5461  ee.AddColumn("Ta
+00021bd0: 626c 6522 290d 0a20 2020 2020 2020 2074  ble")..        t
+00021be0: 7265 652e 4164 6443 6f6c 756d 6e28 2249  ree.AddColumn("I
+00021bf0: 6e66 6f22 290d 0a20 2020 2020 2020 2074  nfo")..        t
+00021c00: 7265 652e 4164 6452 6f6f 7428 224c 6f61  ree.AddRoot("Loa
+00021c10: 6469 6e67 2064 6174 612e 2e22 290d 0a20  ding data..").. 
+00021c20: 2020 2020 2020 2074 7265 652e 5365 744d         tree.SetM
+00021c30: 6169 6e43 6f6c 756d 6e28 3029 0d0a 2020  ainColumn(0)..  
+00021c40: 2020 2020 2020 7472 6565 2e53 6574 436f        tree.SetCo
+00021c50: 6c75 6d6e 416c 6967 6e6d 656e 7428 312c  lumnAlignment(1,
+00021c60: 2077 782e 414c 4947 4e5f 5249 4748 5429   wx.ALIGN_RIGHT)
+00021c70: 0d0a 2020 2020 2020 2020 7365 6c66 2e42  ..        self.B
+00021c80: 696e 6428 7778 2e45 5654 5f42 5554 544f  ind(wx.EVT_BUTTO
+00021c90: 4e2c 2073 656c 662e 6f6e 5f72 6566 7265  N, self.on_refre
+00021ca0: 7368 5f74 6162 6c65 732c 2062 7574 746f  sh_tables, butto
+00021cb0: 6e5f 7265 6672 6573 6829 0d0a 2020 2020  n_refresh)..    
+00021cc0: 2020 2020 7365 6c66 2e42 696e 6428 7778      self.Bind(wx
+00021cd0: 2e45 5654 5f54 5245 455f 4954 454d 5f41  .EVT_TREE_ITEM_A
+00021ce0: 4354 4956 4154 4544 2c20 7365 6c66 2e6f  CTIVATED, self.o
+00021cf0: 6e5f 6368 616e 6765 5f74 7265 655f 7461  n_change_tree_ta
+00021d00: 626c 6573 2c20 7472 6565 290d 0a0d 0a20  bles, tree).... 
+00021d10: 2020 2020 2020 2073 697a 6572 312e 4164         sizer1.Ad
+00021d20: 6428 7369 7a65 725f 746f 706c 6566 742c  d(sizer_topleft,
+00021d30: 2062 6f72 6465 723d 352c 2066 6c61 673d   border=5, flag=
+00021d40: 7778 2e47 524f 5720 7c20 7778 2e4c 4546  wx.GROW | wx.LEF
+00021d50: 5420 7c20 7778 2e54 4f50 290d 0a20 2020  T | wx.TOP)..   
+00021d60: 2020 2020 2073 697a 6572 312e 4164 6428       sizer1.Add(
+00021d70: 7472 6565 2c20 7072 6f70 6f72 7469 6f6e  tree, proportion
+00021d80: 3d31 2c0d 0a20 2020 2020 2020 2020 2020  =1,..           
+00021d90: 2020 2020 2020 2020 626f 7264 6572 3d35          border=5
+00021da0: 2c20 666c 6167 3d77 782e 4752 4f57 207c  , flag=wx.GROW |
+00021db0: 2077 782e 4c45 4654 207c 2077 782e 544f   wx.LEFT | wx.TO
+00021dc0: 5020 7c20 7778 2e42 4f54 544f 4d29 0d0a  P | wx.BOTTOM)..
+00021dd0: 0d0a 2020 2020 2020 2020 7061 6e65 6c32  ..        panel2
+00021de0: 203d 2077 782e 5061 6e65 6c28 7061 7265   = wx.Panel(pare
+00021df0: 6e74 3d73 706c 6974 7465 7229 0d0a 2020  nt=splitter)..  
+00021e00: 2020 2020 2020 7369 7a65 7232 203d 2070        sizer2 = p
+00021e10: 616e 656c 322e 5369 7a65 7220 3d20 7778  anel2.Sizer = wx
+00021e20: 2e42 6f78 5369 7a65 7228 7778 2e56 4552  .BoxSizer(wx.VER
+00021e30: 5449 4341 4c29 0d0a 2020 2020 2020 2020  TICAL)..        
+00021e40: 7369 7a65 725f 7462 203d 2077 782e 426f  sizer_tb = wx.Bo
+00021e50: 7853 697a 6572 2877 782e 484f 5249 5a4f  xSizer(wx.HORIZO
+00021e60: 4e54 414c 290d 0a20 2020 2020 2020 2074  NTAL)..        t
+00021e70: 6220 3d20 7365 6c66 2e74 625f 6772 6964  b = self.tb_grid
+00021e80: 203d 2077 782e 546f 6f6c 4261 7228 0d0a   = wx.ToolBar(..
+00021e90: 2020 2020 2020 2020 2020 2020 7061 7265              pare
+00021ea0: 6e74 3d70 616e 656c 322c 2073 7479 6c65  nt=panel2, style
+00021eb0: 3d77 782e 5442 5f46 4c41 5420 7c20 7778  =wx.TB_FLAT | wx
+00021ec0: 2e54 425f 4e4f 4449 5649 4445 5229 0d0a  .TB_NODIVIDER)..
+00021ed0: 2020 2020 2020 2020 626d 705f 7462 203d          bmp_tb =
+00021ee0: 2069 6d61 6765 732e 546f 6f6c 6261 7249   images.ToolbarI
+00021ef0: 6e73 6572 742e 4269 746d 6170 0d0a 2020  nsert.Bitmap..  
+00021f00: 2020 2020 2020 7462 2e53 6574 546f 6f6c        tb.SetTool
+00021f10: 4269 746d 6170 5369 7a65 2862 6d70 5f74  BitmapSize(bmp_t
+00021f20: 622e 5369 7a65 290d 0a20 2020 2020 2020  b.Size)..       
+00021f30: 2074 622e 4164 6454 6f6f 6c28 7778 2e49   tb.AddTool(wx.I
+00021f40: 445f 4144 442c 2022 496e 7365 7274 206e  D_ADD, "Insert n
+00021f50: 6577 2072 6f77 2e22 2c0d 0a20 2020 2020  ew row.",..     
+00021f60: 2020 2020 2020 2020 2020 2020 2020 6269                bi
+00021f70: 746d 6170 3d62 6d70 5f74 622c 2073 686f  tmap=bmp_tb, sho
+00021f80: 7274 4865 6c70 3d22 4164 6420 6e65 7720  rtHelp="Add new 
+00021f90: 726f 772e 2229 0d0a 2020 2020 2020 2020  row.")..        
+00021fa0: 7462 2e41 6464 546f 6f6c 2877 782e 4944  tb.AddTool(wx.ID
+00021fb0: 5f44 454c 4554 452c 2022 4465 6c65 7465  _DELETE, "Delete
+00021fc0: 2063 7572 7265 6e74 2072 6f77 2e22 2c0d   current row.",.
+00021fd0: 0a20 2020 2020 2020 2020 2020 2062 6974  .            bit
+00021fe0: 6d61 703d 696d 6167 6573 2e54 6f6f 6c62  map=images.Toolb
+00021ff0: 6172 4465 6c65 7465 2e42 6974 6d61 702c  arDelete.Bitmap,
+00022000: 2073 686f 7274 4865 6c70 3d22 4465 6c65   shortHelp="Dele
+00022010: 7465 2072 6f77 2e22 290d 0a20 2020 2020  te row.")..     
+00022020: 2020 2074 622e 4164 6453 6570 6172 6174     tb.AddSeparat
+00022030: 6f72 2829 0d0a 2020 2020 2020 2020 7462  or()..        tb
+00022040: 2e41 6464 546f 6f6c 2877 782e 4944 5f53  .AddTool(wx.ID_S
+00022050: 4156 452c 2022 436f 6d6d 6974 222c 2062  AVE, "Commit", b
+00022060: 6974 6d61 703d 696d 6167 6573 2e54 6f6f  itmap=images.Too
+00022070: 6c62 6172 436f 6d6d 6974 2e42 6974 6d61  lbarCommit.Bitma
+00022080: 702c 0d0a 2020 2020 2020 2020 2020 2020  p,..            
+00022090: 2020 2020 2020 2073 686f 7274 4865 6c70         shortHelp
+000220a0: 3d22 436f 6d6d 6974 2063 6861 6e67 6573  ="Commit changes
+000220b0: 2074 6f20 6461 7461 6261 7365 2e22 290d   to database.").
+000220c0: 0a20 2020 2020 2020 2074 622e 4164 6454  .        tb.AddT
+000220d0: 6f6f 6c28 7778 2e49 445f 554e 444f 2c20  ool(wx.ID_UNDO, 
+000220e0: 2252 6f6c 6c62 6163 6b22 2c20 6269 746d  "Rollback", bitm
+000220f0: 6170 3d69 6d61 6765 732e 546f 6f6c 6261  ap=images.Toolba
+00022100: 7252 6f6c 6c62 6163 6b2e 4269 746d 6170  rRollback.Bitmap
+00022110: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00022120: 2020 2020 2020 7368 6f72 7448 656c 703d        shortHelp=
+00022130: 2252 6f6c 6c62 6163 6b20 6368 616e 6765  "Rollback change
+00022140: 7320 616e 6420 7265 7374 6f72 6520 6f72  s and restore or
+00022150: 6967 696e 616c 2076 616c 7565 732e 2229  iginal values.")
+00022160: 0d0a 2020 2020 2020 2020 7462 2e45 6e61  ..        tb.Ena
+00022170: 626c 6554 6f6f 6c28 7778 2e49 445f 4144  bleTool(wx.ID_AD
+00022180: 442c 2046 616c 7365 290d 0a20 2020 2020  D, False)..     
+00022190: 2020 2074 622e 456e 6162 6c65 546f 6f6c     tb.EnableTool
+000221a0: 2877 782e 4944 5f44 454c 4554 452c 2046  (wx.ID_DELETE, F
+000221b0: 616c 7365 290d 0a20 2020 2020 2020 2074  alse)..        t
+000221c0: 622e 456e 6162 6c65 546f 6f6c 2877 782e  b.EnableTool(wx.
+000221d0: 4944 5f55 4e44 4f2c 2046 616c 7365 290d  ID_UNDO, False).
+000221e0: 0a20 2020 2020 2020 2074 622e 456e 6162  .        tb.Enab
+000221f0: 6c65 546f 6f6c 2877 782e 4944 5f53 4156  leTool(wx.ID_SAV
+00022200: 452c 2046 616c 7365 290d 0a20 2020 2020  E, False)..     
+00022210: 2020 2073 656c 662e 4269 6e64 2877 782e     self.Bind(wx.
+00022220: 4556 545f 544f 4f4c 2c20 6861 6e64 6c65  EVT_TOOL, handle
+00022230: 723d 7365 6c66 2e6f 6e5f 696e 7365 7274  r=self.on_insert
+00022240: 5f72 6f77 2c20 6964 3d77 782e 4944 5f41  _row, id=wx.ID_A
+00022250: 4444 290d 0a20 2020 2020 2020 2073 656c  DD)..        sel
+00022260: 662e 4269 6e64 2877 782e 4556 545f 544f  f.Bind(wx.EVT_TO
+00022270: 4f4c 2c20 6861 6e64 6c65 723d 7365 6c66  OL, handler=self
+00022280: 2e6f 6e5f 6465 6c65 7465 5f72 6f77 2c20  .on_delete_row, 
+00022290: 6964 3d77 782e 4944 5f44 454c 4554 4529  id=wx.ID_DELETE)
+000222a0: 0d0a 2020 2020 2020 2020 7365 6c66 2e42  ..        self.B
+000222b0: 696e 6428 7778 2e45 5654 5f54 4f4f 4c2c  ind(wx.EVT_TOOL,
+000222c0: 2068 616e 646c 6572 3d73 656c 662e 6f6e   handler=self.on
+000222d0: 5f63 6f6d 6d69 745f 7461 626c 652c 2069  _commit_table, i
+000222e0: 643d 7778 2e49 445f 5341 5645 290d 0a20  d=wx.ID_SAVE).. 
+000222f0: 2020 2020 2020 2073 656c 662e 4269 6e64         self.Bind
+00022300: 2877 782e 4556 545f 544f 4f4c 2c20 6861  (wx.EVT_TOOL, ha
+00022310: 6e64 6c65 723d 7365 6c66 2e6f 6e5f 726f  ndler=self.on_ro
+00022320: 6c6c 6261 636b 5f74 6162 6c65 2c20 6964  llback_table, id
+00022330: 3d77 782e 4944 5f55 4e44 4f29 0d0a 2020  =wx.ID_UNDO)..  
+00022340: 2020 2020 2020 7462 2e52 6561 6c69 7a65        tb.Realize
+00022350: 2829 2023 2073 686f 756c 6420 6265 2063  () # should be c
+00022360: 616c 6c65 6420 6166 7465 7220 6164 6469  alled after addi
+00022370: 6e67 2074 6f6f 6c73 0d0a 2020 2020 2020  ng tools..      
+00022380: 2020 6c61 6265 6c5f 7461 626c 6520 3d20    label_table = 
+00022390: 7365 6c66 2e6c 6162 656c 5f74 6162 6c65  self.label_table
+000223a0: 203d 2077 782e 5374 6174 6963 5465 7874   = wx.StaticText
+000223b0: 2870 6172 656e 743d 7061 6e65 6c32 2c20  (parent=panel2, 
+000223c0: 6c61 6265 6c3d 2222 290d 0a20 2020 2020  label="")..     
+000223d0: 2020 2062 7574 746f 6e5f 7265 7365 7420     button_reset 
+000223e0: 3d20 7365 6c66 2e62 7574 746f 6e5f 7265  = self.button_re
+000223f0: 7365 745f 6772 6964 5f74 6162 6c65 203d  set_grid_table =
+00022400: 205c 0d0a 2020 2020 2020 2020 2020 2020   \..            
+00022410: 7778 2e42 7574 746f 6e28 7061 7265 6e74  wx.Button(parent
+00022420: 3d70 616e 656c 322c 206c 6162 656c 3d22  =panel2, label="
+00022430: 2652 6573 6574 2066 696c 7465 722f 736f  &Reset filter/so
+00022440: 7274 2229 0d0a 2020 2020 2020 2020 6275  rt")..        bu
+00022450: 7474 6f6e 5f72 6573 6574 2e53 6574 546f  tton_reset.SetTo
+00022460: 6f6c 5469 7028 2252 6573 6574 7320 616c  olTip("Resets al
+00022470: 6c20 6170 706c 6965 6420 736f 7274 696e  l applied sortin
+00022480: 6720 220d 0a20 2020 2020 2020 2020 2020  g "..           
+00022490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000224a0: 2020 2020 2020 2020 2020 2022 616e 6420             "and 
+000224b0: 6669 6c74 6572 696e 672e 2229 0d0a 2020  filtering.")..  
+000224c0: 2020 2020 2020 6275 7474 6f6e 5f72 6573        button_res
+000224d0: 6574 2e42 696e 6428 7778 2e45 5654 5f42  et.Bind(wx.EVT_B
+000224e0: 5554 544f 4e2c 2073 656c 662e 6f6e 5f62  UTTON, self.on_b
+000224f0: 7574 746f 6e5f 7265 7365 745f 6772 6964  utton_reset_grid
+00022500: 290d 0a20 2020 2020 2020 2062 7574 746f  )..        butto
+00022510: 6e5f 7265 7365 742e 456e 6162 6c65 6420  n_reset.Enabled 
+00022520: 3d20 4661 6c73 650d 0a20 2020 2020 2020  = False..       
+00022530: 2062 7574 746f 6e5f 6578 706f 7274 203d   button_export =
+00022540: 2073 656c 662e 6275 7474 6f6e 5f65 7870   self.button_exp
+00022550: 6f72 745f 7461 626c 6520 3d20 5c0d 0a20  ort_table = \.. 
+00022560: 2020 2020 2020 2020 2020 2077 782e 4275             wx.Bu
+00022570: 7474 6f6e 2870 6172 656e 743d 7061 6e65  tton(parent=pane
+00022580: 6c32 2c20 6c61 6265 6c3d 2226 4578 706f  l2, label="&Expo
+00022590: 7274 2074 6f20 6669 6c65 2229 0d0a 2020  rt to file")..  
+000225a0: 2020 2020 2020 6275 7474 6f6e 5f65 7870        button_exp
+000225b0: 6f72 742e 4d69 6e53 697a 6520 3d20 2831  ort.MinSize = (1
+000225c0: 3030 2c20 2d31 290d 0a20 2020 2020 2020  00, -1)..       
+000225d0: 2062 7574 746f 6e5f 6578 706f 7274 2e53   button_export.S
+000225e0: 6574 546f 6f6c 5469 7028 2245 7870 6f72  etToolTip("Expor
+000225f0: 7420 726f 7773 2074 6f20 6120 6669 6c65  t rows to a file
+00022600: 2e22 290d 0a20 2020 2020 2020 2062 7574  .")..        but
+00022610: 746f 6e5f 6578 706f 7274 2e42 696e 6428  ton_export.Bind(
+00022620: 7778 2e45 5654 5f42 5554 544f 4e2c 2073  wx.EVT_BUTTON, s
+00022630: 656c 662e 6f6e 5f62 7574 746f 6e5f 6578  elf.on_button_ex
+00022640: 706f 7274 5f67 7269 6429 0d0a 2020 2020  port_grid)..    
+00022650: 2020 2020 6275 7474 6f6e 5f65 7870 6f72      button_expor
+00022660: 742e 456e 6162 6c65 6420 3d20 4661 6c73  t.Enabled = Fals
+00022670: 650d 0a20 2020 2020 2020 2073 697a 6572  e..        sizer
+00022680: 5f74 622e 4164 6428 6c61 6265 6c5f 7461  _tb.Add(label_ta
+00022690: 626c 652c 2066 6c61 673d 7778 2e41 4c49  ble, flag=wx.ALI
+000226a0: 474e 5f43 454e 5445 525f 5645 5254 4943  GN_CENTER_VERTIC
+000226b0: 414c 290d 0a20 2020 2020 2020 2073 697a  AL)..        siz
+000226c0: 6572 5f74 622e 4164 6453 7472 6574 6368  er_tb.AddStretch
+000226d0: 5370 6163 6572 2829 0d0a 2020 2020 2020  Spacer()..      
+000226e0: 2020 7369 7a65 725f 7462 2e41 6464 2862    sizer_tb.Add(b
+000226f0: 7574 746f 6e5f 7265 7365 742c 2062 6f72  utton_reset, bor
+00022700: 6465 723d 352c 2066 6c61 673d 7778 2e42  der=5, flag=wx.B
+00022710: 4f54 544f 4d20 7c20 7778 2e52 4947 4854  OTTOM | wx.RIGHT
+00022720: 207c 0d0a 2020 2020 2020 2020 2020 2020   |..            
+00022730: 2020 2020 2020 2020 2077 782e 414c 4947           wx.ALIG
+00022740: 4e5f 4345 4e54 4552 5f56 4552 5449 4341  N_CENTER_VERTICA
+00022750: 4c29 0d0a 2020 2020 2020 2020 7369 7a65  L)..        size
+00022760: 725f 7462 2e41 6464 2862 7574 746f 6e5f  r_tb.Add(button_
+00022770: 6578 706f 7274 2c20 626f 7264 6572 3d35  export, border=5
+00022780: 2c20 666c 6167 3d77 782e 424f 5454 4f4d  , flag=wx.BOTTOM
+00022790: 207c 2077 782e 5249 4748 5420 7c0d 0a20   | wx.RIGHT |.. 
+000227a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000227b0: 2020 2020 7778 2e41 4c49 474e 5f43 454e      wx.ALIGN_CEN
+000227c0: 5445 525f 5645 5254 4943 414c 290d 0a20  TER_VERTICAL).. 
+000227d0: 2020 2020 2020 2073 697a 6572 5f74 622e         sizer_tb.
+000227e0: 4164 6428 7462 290d 0a20 2020 2020 2020  Add(tb)..       
+000227f0: 2067 7269 6420 3d20 7365 6c66 2e67 7269   grid = self.gri
+00022800: 645f 7461 626c 6520 3d20 7778 2e67 7269  d_table = wx.gri
+00022810: 642e 4772 6964 2870 6172 656e 743d 7061  d.Grid(parent=pa
+00022820: 6e65 6c32 290d 0a20 2020 2020 2020 2043  nel2)..        C
+00022830: 6f6c 6f75 724d 616e 6167 6572 2e4d 616e  olourManager.Man
+00022840: 6167 6528 6772 6964 2c20 2244 6566 6175  age(grid, "Defau
+00022850: 6c74 4365 6c6c 4261 636b 6772 6f75 6e64  ltCellBackground
+00022860: 436f 6c6f 7572 222c 2077 782e 5359 535f  Colour", wx.SYS_
+00022870: 434f 4c4f 5552 5f57 494e 444f 5729 0d0a  COLOUR_WINDOW)..
+00022880: 2020 2020 2020 2020 436f 6c6f 7572 4d61          ColourMa
+00022890: 6e61 6765 722e 4d61 6e61 6765 2867 7269  nager.Manage(gri
+000228a0: 642c 2022 4465 6661 756c 7443 656c 6c54  d, "DefaultCellT
+000228b0: 6578 7443 6f6c 6f75 7222 2c20 2020 2020  extColour",     
+000228c0: 2020 7778 2e53 5953 5f43 4f4c 4f55 525f    wx.SYS_COLOUR_
+000228d0: 5749 4e44 4f57 5445 5854 290d 0a20 2020  WINDOWTEXT)..   
+000228e0: 2020 2020 2043 6f6c 6f75 724d 616e 6167       ColourManag
+000228f0: 6572 2e4d 616e 6167 6528 6772 6964 2c20  er.Manage(grid, 
+00022900: 224c 6162 656c 4261 636b 6772 6f75 6e64  "LabelBackground
+00022910: 436f 6c6f 7572 222c 2020 2020 2020 2077  Colour",       w
+00022920: 782e 5359 535f 434f 4c4f 5552 5f42 544e  x.SYS_COLOUR_BTN
+00022930: 4641 4345 290d 0a20 2020 2020 2020 2043  FACE)..        C
+00022940: 6f6c 6f75 724d 616e 6167 6572 2e4d 616e  olourManager.Man
+00022950: 6167 6528 6772 6964 2c20 224c 6162 656c  age(grid, "Label
+00022960: 5465 7874 436f 6c6f 7572 222c 2020 2020  TextColour",    
+00022970: 2020 2020 2020 2020 2077 782e 5359 535f           wx.SYS_
+00022980: 434f 4c4f 5552 5f57 494e 444f 5754 4558  COLOUR_WINDOWTEX
+00022990: 5429 0d0a 2020 2020 2020 2020 6966 2068  T)..        if h
+000229a0: 6173 6174 7472 2867 7269 642c 2022 5365  asattr(grid, "Se
+000229b0: 7444 6566 6175 6c74 4365 6c6c 4669 744d  tDefaultCellFitM
+000229c0: 6f64 6522 293a 0d0a 2020 2020 2020 2020  ode"):..        
+000229d0: 2020 2020 6772 6964 2e53 6574 4465 6661      grid.SetDefa
+000229e0: 756c 7443 656c 6c46 6974 4d6f 6465 2877  ultCellFitMode(w
+000229f0: 782e 6772 6964 2e47 7269 6446 6974 4d6f  x.grid.GridFitMo
+00022a00: 6465 2e43 6c69 7028 2929 2020 2320 5369  de.Clip())  # Si
+00022a10: 6e63 6520 7778 2033 2e31 2e34 0d0a 2020  nce wx 3.1.4..  
+00022a20: 2020 2020 2020 6772 6964 2e42 696e 6428        grid.Bind(
+00022a30: 7778 2e67 7269 642e 4556 545f 4752 4944  wx.grid.EVT_GRID
+00022a40: 5f4c 4142 454c 5f4c 4546 545f 4443 4c49  _LABEL_LEFT_DCLI
+00022a50: 434b 2c20 7365 6c66 2e6f 6e5f 736f 7274  CK, self.on_sort
+00022a60: 5f67 7269 645f 636f 6c75 6d6e 290d 0a20  _grid_column).. 
+00022a70: 2020 2020 2020 2067 7269 642e 4772 6964         grid.Grid
+00022a80: 5769 6e64 6f77 2e42 696e 6428 7778 2e45  Window.Bind(wx.E
+00022a90: 5654 5f4d 4f54 494f 4e2c 2073 656c 662e  VT_MOTION, self.
+00022aa0: 6f6e 5f6d 6f75 7365 5f6f 7665 725f 6772  on_mouse_over_gr
+00022ab0: 6964 290d 0a20 2020 2020 2020 2067 7269  id)..        gri
+00022ac0: 642e 4269 6e64 2877 782e 6772 6964 2e45  d.Bind(wx.grid.E
+00022ad0: 5654 5f47 5249 445f 4c41 4245 4c5f 5249  VT_GRID_LABEL_RI
+00022ae0: 4748 545f 434c 4943 4b2c 0d0a 2020 2020  GHT_CLICK,..    
+00022af0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00022b00: 6c66 2e6f 6e5f 6669 6c74 6572 5f67 7269  lf.on_filter_gri
+00022b10: 645f 636f 6c75 6d6e 290d 0a20 2020 2020  d_column)..     
+00022b20: 2020 2067 7269 642e 4269 6e64 2877 782e     grid.Bind(wx.
+00022b30: 6772 6964 2e45 5654 5f47 5249 445f 4345  grid.EVT_GRID_CE
+00022b40: 4c4c 5f43 4841 4e47 4544 2c20 7365 6c66  LL_CHANGED, self
+00022b50: 2e6f 6e5f 6368 616e 6765 5f74 6162 6c65  .on_change_table
+00022b60: 290d 0a20 2020 2020 2020 206c 6162 656c  )..        label
+00022b70: 5f68 656c 7020 3d20 7778 2e53 7461 7469  _help = wx.Stati
+00022b80: 6354 6578 7428 7061 6e65 6c32 2c20 6c61  cText(panel2, la
+00022b90: 6265 6c3d 2244 6f75 626c 652d 636c 6963  bel="Double-clic
+00022ba0: 6b20 6f6e 2063 6f6c 756d 6e20 220d 0a20  k on column ".. 
+00022bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022bd0: 2020 2268 6561 6465 7220 746f 2073 6f72    "header to sor
+00022be0: 742c 2072 6967 6874 2063 6c69 636b 2074  t, right click t
+00022bf0: 6f20 6669 6c74 6572 2e22 290d 0a20 2020  o filter.")..   
+00022c00: 2020 2020 2043 6f6c 6f75 724d 616e 6167       ColourManag
+00022c10: 6572 2e4d 616e 6167 6528 6c61 6265 6c5f  er.Manage(label_
+00022c20: 6865 6c70 2c20 2246 6f72 6567 726f 756e  help, "Foregroun
+00022c30: 6443 6f6c 6f75 7222 2c20 2244 6973 6162  dColour", "Disab
+00022c40: 6c65 6443 6f6c 6f75 7222 290d 0a20 2020  ledColour")..   
+00022c50: 2020 2020 2073 697a 6572 322e 4164 6428       sizer2.Add(
+00022c60: 7369 7a65 725f 7462 2c20 626f 7264 6572  sizer_tb, border
+00022c70: 3d35 2c20 666c 6167 3d77 782e 4752 4f57  =5, flag=wx.GROW
+00022c80: 207c 2077 782e 4c45 4654 207c 2077 782e   | wx.LEFT | wx.
+00022c90: 544f 5029 0d0a 2020 2020 2020 2020 7369  TOP)..        si
+00022ca0: 7a65 7232 2e41 6464 2867 7269 642c 2062  zer2.Add(grid, b
+00022cb0: 6f72 6465 723d 352c 2070 726f 706f 7274  order=5, proport
+00022cc0: 696f 6e3d 322c 0d0a 2020 2020 2020 2020  ion=2,..        
+00022cd0: 2020 2020 2020 2020 2020 2066 6c61 673d             flag=
+00022ce0: 7778 2e47 524f 5720 7c20 7778 2e4c 4546  wx.GROW | wx.LEF
+00022cf0: 5420 7c20 7778 2e52 4947 4854 290d 0a20  T | wx.RIGHT).. 
+00022d00: 2020 2020 2020 2073 697a 6572 322e 4164         sizer2.Ad
+00022d10: 6428 6c61 6265 6c5f 6865 6c70 2c20 626f  d(label_help, bo
+00022d20: 7264 6572 3d35 2c20 666c 6167 3d77 782e  rder=5, flag=wx.
+00022d30: 4c45 4654 207c 2077 782e 544f 5029 0d0a  LEFT | wx.TOP)..
+00022d40: 0d0a 2020 2020 2020 2020 7369 7a65 722e  ..        sizer.
+00022d50: 4164 6428 7370 6c69 7474 6572 2c20 7072  Add(splitter, pr
+00022d60: 6f70 6f72 7469 6f6e 3d31 2c20 666c 6167  oportion=1, flag
+00022d70: 3d77 782e 4752 4f57 290d 0a20 2020 2020  =wx.GROW)..     
+00022d80: 2020 2073 706c 6974 7465 722e 5370 6c69     splitter.Spli
+00022d90: 7456 6572 7469 6361 6c6c 7928 7061 6e65  tVertically(pane
+00022da0: 6c31 2c20 7061 6e65 6c32 2c20 3237 3029  l1, panel2, 270)
+00022db0: 0d0a 0d0a 0d0a 2020 2020 6465 6620 6372  ......    def cr
+00022dc0: 6561 7465 5f70 6167 655f 7371 6c28 7365  eate_page_sql(se
+00022dd0: 6c66 2c20 6e6f 7465 626f 6f6b 293a 0d0a  lf, notebook):..
+00022de0: 2020 2020 2020 2020 2222 2243 7265 6174          """Creat
+00022df0: 6573 2061 2070 6167 6520 666f 7220 6578  es a page for ex
+00022e00: 6563 7574 696e 6720 6172 6269 7472 6172  ecuting arbitrar
+00022e10: 7920 5351 4c2e 2222 220d 0a20 2020 2020  y SQL."""..     
+00022e20: 2020 2070 6167 6520 3d20 7365 6c66 2e70     page = self.p
+00022e30: 6167 655f 7371 6c20 3d20 7778 2e50 616e  age_sql = wx.Pan
+00022e40: 656c 2870 6172 656e 743d 6e6f 7465 626f  el(parent=notebo
+00022e50: 6f6b 290d 0a20 2020 2020 2020 2073 656c  ok)..        sel
+00022e60: 662e 7061 6765 6f72 6465 725b 7061 6765  f.pageorder[page
+00022e70: 5d20 3d20 6c65 6e28 7365 6c66 2e70 6167  ] = len(self.pag
+00022e80: 656f 7264 6572 290d 0a20 2020 2020 2020  eorder)..       
+00022e90: 206e 6f74 6562 6f6f 6b2e 4164 6450 6167   notebook.AddPag
+00022ea0: 6528 7061 6765 2c20 2253 514c 2077 696e  e(page, "SQL win
+00022eb0: 646f 7722 290d 0a20 2020 2020 2020 2073  dow")..        s
+00022ec0: 697a 6572 203d 2070 6167 652e 5369 7a65  izer = page.Size
+00022ed0: 7220 3d20 7778 2e42 6f78 5369 7a65 7228  r = wx.BoxSizer(
+00022ee0: 7778 2e56 4552 5449 4341 4c29 0d0a 2020  wx.VERTICAL)..  
+00022ef0: 2020 2020 2020 7370 6c69 7474 6572 203d        splitter =
+00022f00: 2073 656c 662e 7370 6c69 7474 6572 5f73   self.splitter_s
+00022f10: 716c 203d 205c 0d0a 2020 2020 2020 2020  ql = \..        
+00022f20: 2020 2020 7778 2e53 706c 6974 7465 7257      wx.SplitterW
+00022f30: 696e 646f 7728 7061 7265 6e74 3d70 6167  indow(parent=pag
+00022f40: 652c 2073 7479 6c65 3d77 782e 424f 5244  e, style=wx.BORD
+00022f50: 4552 5f4e 4f4e 4529 0d0a 2020 2020 2020  ER_NONE)..      
+00022f60: 2020 7370 6c69 7474 6572 2e53 6574 4d69    splitter.SetMi
+00022f70: 6e69 6d75 6d50 616e 6553 697a 6528 3130  nimumPaneSize(10
+00022f80: 3029 0d0a 0d0a 2020 2020 2020 2020 7061  0)....        pa
+00022f90: 6e65 6c31 203d 2073 656c 662e 7061 6e65  nel1 = self.pane
+00022fa0: 6c5f 7371 6c31 203d 2077 782e 5061 6e65  l_sql1 = wx.Pane
+00022fb0: 6c28 7061 7265 6e74 3d73 706c 6974 7465  l(parent=splitte
+00022fc0: 7229 0d0a 2020 2020 2020 2020 7369 7a65  r)..        size
+00022fd0: 7231 203d 2070 616e 656c 312e 5369 7a65  r1 = panel1.Size
+00022fe0: 7220 3d20 7778 2e42 6f78 5369 7a65 7228  r = wx.BoxSizer(
+00022ff0: 7778 2e56 4552 5449 4341 4c29 0d0a 2020  wx.VERTICAL)..  
+00023000: 2020 2020 2020 6c61 6265 6c5f 7374 6320        label_stc 
+00023010: 3d20 7778 2e53 7461 7469 6354 6578 7428  = wx.StaticText(
+00023020: 7061 7265 6e74 3d70 616e 656c 312c 206c  parent=panel1, l
+00023030: 6162 656c 3d22 5351 264c 3a22 290d 0a20  abel="SQ&L:").. 
+00023040: 2020 2020 2020 2073 7463 203d 2073 656c         stc = sel
+00023050: 662e 7374 635f 7371 6c20 3d20 636f 6e74  f.stc_sql = cont
+00023060: 726f 6c73 2e53 514c 6974 6554 6578 7443  rols.SQLiteTextC
+00023070: 7472 6c28 7061 7265 6e74 3d70 616e 656c  trl(parent=panel
+00023080: 312c 0d0a 2020 2020 2020 2020 2020 2020  1,..            
+00023090: 7374 796c 653d 7778 2e42 4f52 4445 525f  style=wx.BORDER_
+000230a0: 5354 4154 4943 207c 2077 782e 5445 5f50  STATIC | wx.TE_P
+000230b0: 524f 4345 5353 5f54 4142 207c 2077 782e  ROCESS_TAB | wx.
+000230c0: 5445 5f50 524f 4345 5353 5f45 4e54 4552  TE_PROCESS_ENTER
+000230d0: 290d 0a20 2020 2020 2020 2073 7463 2e42  )..        stc.B
+000230e0: 696e 6428 7778 2e45 5654 5f4b 4559 5f44  ind(wx.EVT_KEY_D
+000230f0: 4f57 4e2c 2073 656c 662e 6f6e 5f6b 6579  OWN, self.on_key
+00023100: 646f 776e 5f73 716c 290d 0a20 2020 2020  down_sql)..     
+00023110: 2020 2073 7463 2e53 6574 5465 7874 2863     stc.SetText(c
+00023120: 6f6e 662e 5351 4c57 696e 646f 7754 6578  onf.SQLWindowTex
+00023130: 7473 2e67 6574 2873 656c 662e 6462 2e66  ts.get(self.db.f
+00023140: 696c 656e 616d 652c 2022 2229 290d 0a20  ilename, "")).. 
+00023150: 2020 2020 2020 2073 7463 2e45 6d70 7479         stc.Empty
+00023160: 556e 646f 4275 6666 6572 2829 2023 2053  UndoBuffer() # S
+00023170: 6f20 7468 6174 2075 6e64 6f20 646f 6573  o that undo does
+00023180: 206e 6f74 2063 6c65 6172 2074 6865 2053   not clear the S
+00023190: 5443 0d0a 2020 2020 2020 2020 7369 7a65  TC..        size
+000231a0: 7231 2e41 6464 286c 6162 656c 5f73 7463  r1.Add(label_stc
+000231b0: 2c20 626f 7264 6572 3d35 2c20 666c 6167  , border=5, flag
+000231c0: 3d77 782e 414c 4c29 0d0a 2020 2020 2020  =wx.ALL)..      
+000231d0: 2020 7369 7a65 7231 2e41 6464 2873 7463    sizer1.Add(stc
+000231e0: 2c20 626f 7264 6572 3d35 2c20 7072 6f70  , border=5, prop
+000231f0: 6f72 7469 6f6e 3d31 2c20 666c 6167 3d77  ortion=1, flag=w
+00023200: 782e 4752 4f57 207c 2077 782e 4c45 4654  x.GROW | wx.LEFT
+00023210: 290d 0a0d 0a20 2020 2020 2020 2070 616e  )....        pan
+00023220: 656c 3220 3d20 7365 6c66 2e70 616e 656c  el2 = self.panel
+00023230: 5f73 716c 3220 3d20 7778 2e50 616e 656c  _sql2 = wx.Panel
+00023240: 2870 6172 656e 743d 7370 6c69 7474 6572  (parent=splitter
+00023250: 290d 0a20 2020 2020 2020 2073 697a 6572  )..        sizer
+00023260: 3220 3d20 7061 6e65 6c32 2e53 697a 6572  2 = panel2.Sizer
+00023270: 203d 2077 782e 426f 7853 697a 6572 2877   = wx.BoxSizer(w
+00023280: 782e 5645 5254 4943 414c 290d 0a20 2020  x.VERTICAL)..   
+00023290: 2020 2020 206c 6162 656c 5f68 656c 7020       label_help 
+000232a0: 3d20 7778 2e53 7461 7469 6354 6578 7428  = wx.StaticText(
+000232b0: 7061 6e65 6c32 2c20 6c61 6265 6c3d 0d0a  panel2, label=..
+000232c0: 2020 2020 2020 2020 2020 2020 2241 6c74              "Alt
+000232d0: 2d45 6e74 6572 2072 756e 7320 7468 6520  -Enter runs the 
+000232e0: 7175 6572 7920 636f 6e74 6169 6e65 6420  query contained 
+000232f0: 696e 2063 7572 7265 6e74 6c79 2073 656c  in currently sel
+00023300: 6563 7465 6420 7465 7874 206f 7220 220d  ected text or ".
+00023310: 0a20 2020 2020 2020 2020 2020 2022 6f6e  .            "on
+00023320: 2074 6865 2063 7572 7265 6e74 206c 696e   the current lin
+00023330: 652e 2043 7472 6c2d 5370 6163 6520 7368  e. Ctrl-Space sh
+00023340: 6f77 7320 6175 746f 636f 6d70 6c65 7469  ows autocompleti
+00023350: 6f6e 206c 6973 742e 2229 0d0a 2020 2020  on list.")..    
+00023360: 2020 2020 436f 6c6f 7572 4d61 6e61 6765      ColourManage
+00023370: 722e 4d61 6e61 6765 286c 6162 656c 5f68  r.Manage(label_h
+00023380: 656c 702c 2022 466f 7265 6772 6f75 6e64  elp, "Foreground
+00023390: 436f 6c6f 7572 222c 2022 4469 7361 626c  Colour", "Disabl
+000233a0: 6564 436f 6c6f 7572 2229 0d0a 2020 2020  edColour")..    
+000233b0: 2020 2020 7369 7a65 725f 6275 7474 6f6e      sizer_button
+000233c0: 7320 3d20 7778 2e42 6f78 5369 7a65 7228  s = wx.BoxSizer(
+000233d0: 7778 2e48 4f52 495a 4f4e 5441 4c29 0d0a  wx.HORIZONTAL)..
+000233e0: 2020 2020 2020 2020 6275 7474 6f6e 5f73          button_s
+000233f0: 716c 203d 2073 656c 662e 6275 7474 6f6e  ql = self.button
+00023400: 5f73 716c 203d 2077 782e 4275 7474 6f6e  _sql = wx.Button
+00023410: 2870 616e 656c 322c 206c 6162 656c 3d22  (panel2, label="
+00023420: 4578 6563 7574 6520 5326 514c 2229 0d0a  Execute S&QL")..
+00023430: 2020 2020 2020 2020 6275 7474 6f6e 5f73          button_s
+00023440: 6372 6970 7420 3d20 7365 6c66 2e62 7574  cript = self.but
+00023450: 746f 6e5f 7363 7269 7074 203d 2077 782e  ton_script = wx.
+00023460: 4275 7474 6f6e 2870 616e 656c 322c 0d0a  Button(panel2,..
+00023470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000234a0: 2020 2020 2020 206c 6162 656c 3d22 4578         label="Ex
+000234b0: 6563 7574 6520 7363 7269 7026 7422 290d  ecute scrip&t").
+000234c0: 0a20 2020 2020 2020 2062 7574 746f 6e5f  .        button_
+000234d0: 7371 6c2e 5365 7454 6f6f 6c54 6970 2822  sql.SetToolTip("
+000234e0: 4578 6563 7574 6520 6120 7369 6e67 6c65  Execute a single
+000234f0: 2073 7461 7465 6d65 6e74 2022 0d0a 2020   statement "..  
+00023500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023520: 2020 2266 726f 6d20 7468 6520 5351 4c20    "from the SQL 
+00023530: 7769 6e64 6f77 2229 0d0a 2020 2020 2020  window")..      
+00023540: 2020 6275 7474 6f6e 5f73 6372 6970 742e    button_script.
+00023550: 5365 7454 6f6f 6c54 6970 2822 4578 6563  SetToolTip("Exec
+00023560: 7574 6520 6d75 6c74 6970 6c65 2053 514c  ute multiple SQL
+00023570: 2073 7461 7465 6d65 6e74 732c 2022 0d0a   statements, "..
+00023580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000235a0: 2020 2020 2020 2022 7365 7061 7261 7465         "separate
+000235b0: 6420 6279 2073 656d 6963 6f6c 6f6e 7322  d by semicolons"
+000235c0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+000235d0: 4269 6e64 2877 782e 4556 545f 4255 5454  Bind(wx.EVT_BUTT
+000235e0: 4f4e 2c20 7365 6c66 2e6f 6e5f 6275 7474  ON, self.on_butt
+000235f0: 6f6e 5f73 716c 2c20 6275 7474 6f6e 5f73  on_sql, button_s
+00023600: 716c 290d 0a20 2020 2020 2020 2073 656c  ql)..        sel
+00023610: 662e 4269 6e64 2877 782e 4556 545f 4255  f.Bind(wx.EVT_BU
+00023620: 5454 4f4e 2c20 7365 6c66 2e6f 6e5f 6275  TTON, self.on_bu
+00023630: 7474 6f6e 5f73 6372 6970 742c 2062 7574  tton_script, but
+00023640: 746f 6e5f 7363 7269 7074 290d 0a20 2020  ton_script)..   
+00023650: 2020 2020 2062 7574 746f 6e5f 7265 7365       button_rese
+00023660: 7420 3d20 7365 6c66 2e62 7574 746f 6e5f  t = self.button_
+00023670: 7265 7365 745f 6772 6964 5f73 716c 203d  reset_grid_sql =
+00023680: 205c 0d0a 2020 2020 2020 2020 2020 2020   \..            
+00023690: 7778 2e42 7574 746f 6e28 7061 7265 6e74  wx.Button(parent
+000236a0: 3d70 616e 656c 322c 206c 6162 656c 3d22  =panel2, label="
+000236b0: 2652 6573 6574 2066 696c 7465 722f 736f  &Reset filter/so
+000236c0: 7274 2229 0d0a 2020 2020 2020 2020 6275  rt")..        bu
+000236d0: 7474 6f6e 5f72 6573 6574 2e53 6574 546f  tton_reset.SetTo
+000236e0: 6f6c 5469 7028 2252 6573 6574 7320 616c  olTip("Resets al
+000236f0: 6c20 6170 706c 6965 6420 736f 7274 696e  l applied sortin
+00023700: 6720 220d 0a20 2020 2020 2020 2020 2020  g "..           
+00023710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023720: 2020 2020 2020 2020 2020 2022 616e 6420             "and 
+00023730: 6669 6c74 6572 696e 672e 2229 0d0a 2020  filtering.")..  
+00023740: 2020 2020 2020 6275 7474 6f6e 5f72 6573        button_res
+00023750: 6574 2e42 696e 6428 7778 2e45 5654 5f42  et.Bind(wx.EVT_B
+00023760: 5554 544f 4e2c 2073 656c 662e 6f6e 5f62  UTTON, self.on_b
+00023770: 7574 746f 6e5f 7265 7365 745f 6772 6964  utton_reset_grid
+00023780: 290d 0a20 2020 2020 2020 2062 7574 746f  )..        butto
+00023790: 6e5f 7265 7365 742e 456e 6162 6c65 6420  n_reset.Enabled 
+000237a0: 3d20 4661 6c73 650d 0a20 2020 2020 2020  = False..       
+000237b0: 2062 7574 746f 6e5f 6578 706f 7274 203d   button_export =
+000237c0: 2073 656c 662e 6275 7474 6f6e 5f65 7870   self.button_exp
+000237d0: 6f72 745f 7371 6c20 3d20 5c0d 0a20 2020  ort_sql = \..   
+000237e0: 2020 2020 2020 2020 2077 782e 4275 7474           wx.Butt
+000237f0: 6f6e 2870 6172 656e 743d 7061 6e65 6c32  on(parent=panel2
+00023800: 2c20 6c61 6265 6c3d 2226 4578 706f 7274  , label="&Export
+00023810: 2074 6f20 6669 6c65 2229 0d0a 2020 2020   to file")..    
+00023820: 2020 2020 6275 7474 6f6e 5f65 7870 6f72      button_expor
+00023830: 742e 5365 7454 6f6f 6c54 6970 2822 4578  t.SetToolTip("Ex
+00023840: 706f 7274 2072 6573 756c 7420 746f 2061  port result to a
+00023850: 2066 696c 652e 2229 0d0a 2020 2020 2020   file.")..      
+00023860: 2020 6275 7474 6f6e 5f65 7870 6f72 742e    button_export.
+00023870: 4269 6e64 2877 782e 4556 545f 4255 5454  Bind(wx.EVT_BUTT
+00023880: 4f4e 2c20 7365 6c66 2e6f 6e5f 6275 7474  ON, self.on_butt
+00023890: 6f6e 5f65 7870 6f72 745f 6772 6964 290d  on_export_grid).
+000238a0: 0a20 2020 2020 2020 2062 7574 746f 6e5f  .        button_
+000238b0: 6578 706f 7274 2e45 6e61 626c 6564 203d  export.Enabled =
+000238c0: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
+000238d0: 7369 7a65 725f 6275 7474 6f6e 732e 4164  sizer_buttons.Ad
+000238e0: 6428 6275 7474 6f6e 5f73 716c 2c20 666c  d(button_sql, fl
+000238f0: 6167 3d77 782e 414c 4947 4e5f 4c45 4654  ag=wx.ALIGN_LEFT
+00023900: 290d 0a20 2020 2020 2020 2073 697a 6572  )..        sizer
+00023910: 5f62 7574 746f 6e73 2e41 6464 2862 7574  _buttons.Add(but
+00023920: 746f 6e5f 7363 7269 7074 2c20 626f 7264  ton_script, bord
+00023930: 6572 3d35 2c20 666c 6167 3d77 782e 4c45  er=5, flag=wx.LE
+00023940: 4654 207c 2077 782e 414c 4947 4e5f 4c45  FT | wx.ALIGN_LE
+00023950: 4654 290d 0a20 2020 2020 2020 2073 697a  FT)..        siz
+00023960: 6572 5f62 7574 746f 6e73 2e41 6464 5374  er_buttons.AddSt
+00023970: 7265 7463 6853 7061 6365 7228 290d 0a20  retchSpacer().. 
+00023980: 2020 2020 2020 2073 697a 6572 5f62 7574         sizer_but
+00023990: 746f 6e73 2e41 6464 2862 7574 746f 6e5f  tons.Add(button_
+000239a0: 7265 7365 742c 2062 6f72 6465 723d 352c  reset, border=5,
+000239b0: 2066 6c61 673d 7778 2e52 4947 4854 290d   flag=wx.RIGHT).
+000239c0: 0a20 2020 2020 2020 2073 697a 6572 5f62  .        sizer_b
+000239d0: 7574 746f 6e73 2e41 6464 2862 7574 746f  uttons.Add(butto
+000239e0: 6e5f 6578 706f 7274 290d 0a20 2020 2020  n_export)..     
+000239f0: 2020 2067 7269 6420 3d20 7365 6c66 2e67     grid = self.g
+00023a00: 7269 645f 7371 6c20 3d20 7778 2e67 7269  rid_sql = wx.gri
+00023a10: 642e 4772 6964 2870 6172 656e 743d 7061  d.Grid(parent=pa
+00023a20: 6e65 6c32 290d 0a20 2020 2020 2020 2043  nel2)..        C
+00023a30: 6f6c 6f75 724d 616e 6167 6572 2e4d 616e  olourManager.Man
+00023a40: 6167 6528 6772 6964 2c20 2244 6566 6175  age(grid, "Defau
+00023a50: 6c74 4365 6c6c 4261 636b 6772 6f75 6e64  ltCellBackground
+00023a60: 436f 6c6f 7572 222c 2077 782e 5359 535f  Colour", wx.SYS_
+00023a70: 434f 4c4f 5552 5f57 494e 444f 5729 0d0a  COLOUR_WINDOW)..
+00023a80: 2020 2020 2020 2020 436f 6c6f 7572 4d61          ColourMa
+00023a90: 6e61 6765 722e 4d61 6e61 6765 2867 7269  nager.Manage(gri
+00023aa0: 642c 2022 4465 6661 756c 7443 656c 6c54  d, "DefaultCellT
+00023ab0: 6578 7443 6f6c 6f75 7222 2c20 2020 2020  extColour",     
+00023ac0: 2020 7778 2e53 5953 5f43 4f4c 4f55 525f    wx.SYS_COLOUR_
+00023ad0: 5749 4e44 4f57 5445 5854 290d 0a20 2020  WINDOWTEXT)..   
+00023ae0: 2020 2020 2043 6f6c 6f75 724d 616e 6167       ColourManag
+00023af0: 6572 2e4d 616e 6167 6528 6772 6964 2c20  er.Manage(grid, 
+00023b00: 224c 6162 656c 4261 636b 6772 6f75 6e64  "LabelBackground
+00023b10: 436f 6c6f 7572 222c 2020 2020 2020 2077  Colour",       w
+00023b20: 782e 5359 535f 434f 4c4f 5552 5f42 544e  x.SYS_COLOUR_BTN
+00023b30: 4641 4345 290d 0a20 2020 2020 2020 2043  FACE)..        C
+00023b40: 6f6c 6f75 724d 616e 6167 6572 2e4d 616e  olourManager.Man
+00023b50: 6167 6528 6772 6964 2c20 224c 6162 656c  age(grid, "Label
+00023b60: 5465 7874 436f 6c6f 7572 222c 2020 2020  TextColour",    
+00023b70: 2020 2020 2020 2020 2077 782e 5359 535f           wx.SYS_
+00023b80: 434f 4c4f 5552 5f57 494e 444f 5754 4558  COLOUR_WINDOWTEX
+00023b90: 5429 0d0a 2020 2020 2020 2020 6966 2068  T)..        if h
+00023ba0: 6173 6174 7472 2867 7269 642c 2022 5365  asattr(grid, "Se
+00023bb0: 7444 6566 6175 6c74 4365 6c6c 4669 744d  tDefaultCellFitM
+00023bc0: 6f64 6522 293a 0d0a 2020 2020 2020 2020  ode"):..        
+00023bd0: 2020 2020 6772 6964 2e53 6574 4465 6661      grid.SetDefa
+00023be0: 756c 7443 656c 6c46 6974 4d6f 6465 2877  ultCellFitMode(w
+00023bf0: 782e 6772 6964 2e47 7269 6446 6974 4d6f  x.grid.GridFitMo
+00023c00: 6465 2e43 6c69 7028 2929 2020 2320 5369  de.Clip())  # Si
+00023c10: 6e63 6520 7778 2033 2e31 2e34 0d0a 2020  nce wx 3.1.4..  
+00023c20: 2020 2020 2020 6772 6964 2e42 696e 6428        grid.Bind(
+00023c30: 7778 2e67 7269 642e 4556 545f 4752 4944  wx.grid.EVT_GRID
+00023c40: 5f4c 4142 454c 5f4c 4546 545f 4443 4c49  _LABEL_LEFT_DCLI
+00023c50: 434b 2c0d 0a20 2020 2020 2020 2020 2020  CK,..           
+00023c60: 2020 2020 2020 2073 656c 662e 6f6e 5f73         self.on_s
+00023c70: 6f72 745f 6772 6964 5f63 6f6c 756d 6e29  ort_grid_column)
+00023c80: 0d0a 2020 2020 2020 2020 6772 6964 2e42  ..        grid.B
+00023c90: 696e 6428 7778 2e67 7269 642e 4556 545f  ind(wx.grid.EVT_
+00023ca0: 4752 4944 5f4c 4142 454c 5f52 4947 4854  GRID_LABEL_RIGHT
+00023cb0: 5f43 4c49 434b 2c0d 0a20 2020 2020 2020  _CLICK,..       
+00023cc0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00023cd0: 6f6e 5f66 696c 7465 725f 6772 6964 5f63  on_filter_grid_c
+00023ce0: 6f6c 756d 6e29 0d0a 2020 2020 2020 2020  olumn)..        
+00023cf0: 6772 6964 2e42 696e 6428 7778 2e45 5654  grid.Bind(wx.EVT
+00023d00: 5f53 4352 4f4c 4c57 494e 2c20 7365 6c66  _SCROLLWIN, self
+00023d10: 2e6f 6e5f 7363 726f 6c6c 5f67 7269 645f  .on_scroll_grid_
+00023d20: 7371 6c29 0d0a 2020 2020 2020 2020 6772  sql)..        gr
+00023d30: 6964 2e42 696e 6428 7778 2e45 5654 5f53  id.Bind(wx.EVT_S
+00023d40: 4352 4f4c 4c5f 5448 554d 4252 454c 4541  CROLL_THUMBRELEA
+00023d50: 5345 2c20 7365 6c66 2e6f 6e5f 7363 726f  SE, self.on_scro
+00023d60: 6c6c 5f67 7269 645f 7371 6c29 0d0a 2020  ll_grid_sql)..  
+00023d70: 2020 2020 2020 6772 6964 2e42 696e 6428        grid.Bind(
+00023d80: 7778 2e45 5654 5f53 4352 4f4c 4c5f 4348  wx.EVT_SCROLL_CH
+00023d90: 414e 4745 442c 2073 656c 662e 6f6e 5f73  ANGED, self.on_s
+00023da0: 6372 6f6c 6c5f 6772 6964 5f73 716c 290d  croll_grid_sql).
+00023db0: 0a20 2020 2020 2020 2067 7269 642e 4269  .        grid.Bi
+00023dc0: 6e64 2877 782e 4556 545f 4b45 595f 444f  nd(wx.EVT_KEY_DO
+00023dd0: 574e 2c20 7365 6c66 2e6f 6e5f 7363 726f  WN, self.on_scro
+00023de0: 6c6c 5f67 7269 645f 7371 6c29 0d0a 2020  ll_grid_sql)..  
+00023df0: 2020 2020 2020 6772 6964 2e47 7269 6457        grid.GridW
+00023e00: 696e 646f 772e 4269 6e64 2877 782e 4556  indow.Bind(wx.EV
+00023e10: 545f 4d4f 5449 4f4e 2c20 7365 6c66 2e6f  T_MOTION, self.o
+00023e20: 6e5f 6d6f 7573 655f 6f76 6572 5f67 7269  n_mouse_over_gri
+00023e30: 6429 0d0a 2020 2020 2020 2020 6c61 6265  d)..        labe
+00023e40: 6c5f 6865 6c70 5f67 7269 6420 3d20 7778  l_help_grid = wx
+00023e50: 2e53 7461 7469 6354 6578 7428 7061 6e65  .StaticText(pane
+00023e60: 6c32 2c20 6c61 6265 6c3d 2244 6f75 626c  l2, label="Doubl
+00023e70: 652d 636c 6963 6b20 6f6e 2063 6f6c 756d  e-click on colum
+00023e80: 6e20 220d 0a20 2020 2020 2020 2020 2020  n "..           
+00023e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023ea0: 2020 2020 2020 2020 2020 2020 2022 6865               "he
+00023eb0: 6164 6572 2074 6f20 736f 7274 2c20 7269  ader to sort, ri
+00023ec0: 6768 7420 636c 6963 6b20 746f 2066 696c  ght click to fil
+00023ed0: 7465 722e 2229 0d0a 2020 2020 2020 2020  ter.")..        
+00023ee0: 436f 6c6f 7572 4d61 6e61 6765 722e 4d61  ColourManager.Ma
+00023ef0: 6e61 6765 286c 6162 656c 5f68 656c 705f  nage(label_help_
+00023f00: 6772 6964 2c20 2246 6f72 6567 726f 756e  grid, "Foregroun
+00023f10: 6443 6f6c 6f75 7222 2c20 2244 6973 6162  dColour", "Disab
+00023f20: 6c65 6443 6f6c 6f75 7222 290d 0a0d 0a20  ledColour").... 
+00023f30: 2020 2020 2020 2073 697a 6572 322e 4164         sizer2.Ad
+00023f40: 6428 6c61 6265 6c5f 6865 6c70 2c20 626f  d(label_help, bo
+00023f50: 7264 6572 3d35 2c20 666c 6167 3d77 782e  rder=5, flag=wx.
+00023f60: 4752 4f57 207c 2077 782e 4c45 4654 207c  GROW | wx.LEFT |
+00023f70: 2077 782e 424f 5454 4f4d 290d 0a20 2020   wx.BOTTOM)..   
+00023f80: 2020 2020 2073 697a 6572 322e 4164 6428       sizer2.Add(
+00023f90: 7369 7a65 725f 6275 7474 6f6e 732c 2062  sizer_buttons, b
+00023fa0: 6f72 6465 723d 352c 2066 6c61 673d 7778  order=5, flag=wx
+00023fb0: 2e47 524f 5720 7c20 7778 2e41 4c4c 290d  .GROW | wx.ALL).
+00023fc0: 0a20 2020 2020 2020 2073 697a 6572 322e  .        sizer2.
+00023fd0: 4164 6428 6772 6964 2c20 626f 7264 6572  Add(grid, border
+00023fe0: 3d35 2c20 7072 6f70 6f72 7469 6f6e 3d32  =5, proportion=2
+00023ff0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00024000: 2020 2020 2020 666c 6167 3d77 782e 4752        flag=wx.GR
+00024010: 4f57 207c 2077 782e 4c45 4654 207c 2077  OW | wx.LEFT | w
+00024020: 782e 5249 4748 5429 0d0a 2020 2020 2020  x.RIGHT)..      
+00024030: 2020 7369 7a65 7232 2e41 6464 286c 6162    sizer2.Add(lab
+00024040: 656c 5f68 656c 705f 6772 6964 2c20 626f  el_help_grid, bo
+00024050: 7264 6572 3d35 2c20 666c 6167 3d77 782e  rder=5, flag=wx.
+00024060: 4752 4f57 207c 2077 782e 4c45 4654 207c  GROW | wx.LEFT |
+00024070: 2077 782e 544f 5029 0d0a 0d0a 2020 2020   wx.TOP)....    
+00024080: 2020 2020 7369 7a65 722e 4164 6428 7370      sizer.Add(sp
+00024090: 6c69 7474 6572 2c20 7072 6f70 6f72 7469  litter, proporti
+000240a0: 6f6e 3d31 2c20 666c 6167 3d77 782e 4752  on=1, flag=wx.GR
+000240b0: 4f57 290d 0a20 2020 2020 2020 2073 6173  OW)..        sas
+000240c0: 685f 706f 7320 3d20 7365 6c66 2e53 697a  h_pos = self.Siz
+000240d0: 655b 315d 202f 2f20 330d 0a20 2020 2020  e[1] // 3..     
+000240e0: 2020 2073 706c 6974 7465 722e 5370 6c69     splitter.Spli
+000240f0: 7448 6f72 697a 6f6e 7461 6c6c 7928 7061  tHorizontally(pa
+00024100: 6e65 6c31 2c20 7061 6e65 6c32 2c20 7361  nel1, panel2, sa
+00024110: 7368 506f 7369 7469 6f6e 3d73 6173 685f  shPosition=sash_
+00024120: 706f 7329 0d0a 0d0a 0d0a 2020 2020 6465  pos)......    de
+00024130: 6620 6372 6561 7465 5f70 6167 655f 696e  f create_page_in
+00024140: 666f 2873 656c 662c 206e 6f74 6562 6f6f  fo(self, noteboo
+00024150: 6b29 3a0d 0a20 2020 2020 2020 2022 2222  k):..        """
+00024160: 4372 6561 7465 7320 6120 7061 6765 2066  Creates a page f
+00024170: 6f72 2073 6565 696e 6720 6765 6e65 7261  or seeing genera
+00024180: 6c20 6461 7461 6261 7365 2069 6e66 6f72  l database infor
+00024190: 6d61 7469 6f6e 2e22 2222 0d0a 2020 2020  mation."""..    
+000241a0: 2020 2020 7061 6765 203d 2073 656c 662e      page = self.
+000241b0: 7061 6765 5f69 6e66 6f20 3d20 7778 2e6c  page_info = wx.l
+000241c0: 6962 2e73 6372 6f6c 6c65 6470 616e 656c  ib.scrolledpanel
+000241d0: 2e53 6372 6f6c 6c65 6450 616e 656c 286e  .ScrolledPanel(n
+000241e0: 6f74 6562 6f6f 6b29 0d0a 2020 2020 2020  otebook)..      
+000241f0: 2020 7365 6c66 2e70 6167 656f 7264 6572    self.pageorder
+00024200: 5b70 6167 655d 203d 206c 656e 2873 656c  [page] = len(sel
+00024210: 662e 7061 6765 6f72 6465 7229 0d0a 2020  f.pageorder)..  
+00024220: 2020 2020 2020 6e6f 7465 626f 6f6b 2e41        notebook.A
+00024230: 6464 5061 6765 2870 6167 652c 2022 496e  ddPage(page, "In
+00024240: 666f 726d 6174 696f 6e22 290d 0a20 2020  formation")..   
+00024250: 2020 2020 2073 697a 6572 203d 2070 6167       sizer = pag
+00024260: 652e 5369 7a65 7220 3d20 7778 2e42 6f78  e.Sizer = wx.Box
+00024270: 5369 7a65 7228 7778 2e48 4f52 495a 4f4e  Sizer(wx.HORIZON
+00024280: 5441 4c29 0d0a 0d0a 2020 2020 2020 2020  TAL)....        
+00024290: 7061 6e65 6c31 203d 2073 656c 662e 7061  panel1 = self.pa
+000242a0: 6e65 6c5f 6163 636f 756e 7469 6e66 6f20  nel_accountinfo 
+000242b0: 3d20 7778 2e50 616e 656c 2870 6172 656e  = wx.Panel(paren
+000242c0: 743d 7061 6765 290d 0a20 2020 2020 2020  t=page)..       
+000242d0: 2070 616e 656c 3220 3d20 7778 2e50 616e   panel2 = wx.Pan
+000242e0: 656c 2870 6172 656e 743d 7061 6765 290d  el(parent=page).
+000242f0: 0a20 2020 2020 2020 2043 6f6c 6f75 724d  .        ColourM
+00024300: 616e 6167 6572 2e4d 616e 6167 6528 7061  anager.Manage(pa
+00024310: 6e65 6c31 2c20 2242 6163 6b67 726f 756e  nel1, "Backgroun
+00024320: 6443 6f6c 6f75 7222 2c20 2242 6743 6f6c  dColour", "BgCol
+00024330: 6f75 7222 290d 0a20 2020 2020 2020 2043  our")..        C
+00024340: 6f6c 6f75 724d 616e 6167 6572 2e4d 616e  olourManager.Man
+00024350: 6167 6528 7061 6e65 6c32 2c20 2242 6163  age(panel2, "Bac
+00024360: 6b67 726f 756e 6443 6f6c 6f75 7222 2c20  kgroundColour", 
+00024370: 2242 6743 6f6c 6f75 7222 290d 0a20 2020  "BgColour")..   
+00024380: 2020 2020 2073 697a 6572 3120 3d20 7061       sizer1 = pa
+00024390: 6e65 6c31 2e53 697a 6572 203d 2077 782e  nel1.Sizer = wx.
+000243a0: 426f 7853 697a 6572 2877 782e 5645 5254  BoxSizer(wx.VERT
+000243b0: 4943 414c 290d 0a20 2020 2020 2020 2073  ICAL)..        s
+000243c0: 697a 6572 5f61 6363 6f75 6e74 203d 2077  izer_account = w
+000243d0: 782e 426f 7853 697a 6572 2877 782e 484f  x.BoxSizer(wx.HO
+000243e0: 5249 5a4f 4e54 414c 290d 0a20 2020 2020  RIZONTAL)..     
+000243f0: 2020 206c 6162 656c 5f61 6363 6f75 6e74     label_account
+00024400: 203d 2077 782e 5374 6174 6963 5465 7874   = wx.StaticText
+00024410: 2870 6172 656e 743d 7061 6e65 6c31 2c0d  (parent=panel1,.
+00024420: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00024430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024440: 2020 2020 2020 206c 6162 656c 3d22 4d61         label="Ma
+00024450: 696e 2061 6363 6f75 6e74 2069 6e66 6f72  in account infor
+00024460: 6d61 7469 6f6e 2229 0d0a 2020 2020 2020  mation")..      
+00024470: 2020 6c61 6265 6c5f 6163 636f 756e 742e    label_account.
+00024480: 466f 6e74 203d 2077 782e 466f 6e74 2831  Font = wx.Font(1
+00024490: 302c 2077 782e 464f 4e54 4641 4d49 4c59  0, wx.FONTFAMILY
+000244a0: 5f53 5749 5353 2c0d 0a20 2020 2020 2020  _SWISS,..       
+000244b0: 2020 2020 2077 782e 464f 4e54 5354 594c       wx.FONTSTYL
+000244c0: 455f 4e4f 524d 414c 2c20 7778 2e46 4f4e  E_NORMAL, wx.FON
+000244d0: 5457 4549 4748 545f 424f 4c44 2c20 6661  TWEIGHT_BOLD, fa
+000244e0: 6365 4e61 6d65 3d73 656c 662e 466f 6e74  ceName=self.Font
+000244f0: 2e46 6163 654e 616d 6529 0d0a 2020 2020  .FaceName)..    
+00024500: 2020 2020 7369 7a65 7231 2e41 6464 286c      sizer1.Add(l
+00024510: 6162 656c 5f61 6363 6f75 6e74 2c20 626f  abel_account, bo
+00024520: 7264 6572 3d35 2c20 666c 6167 3d77 782e  rder=5, flag=wx.
+00024530: 414c 4c29 0d0a 0d0a 2020 2020 2020 2020  ALL)....        
+00024540: 626d 705f 7061 6e65 6c20 3d20 7778 2e50  bmp_panel = wx.P
+00024550: 616e 656c 2870 6172 656e 743d 7061 6e65  anel(parent=pane
+00024560: 6c31 290d 0a20 2020 2020 2020 2062 6d70  l1)..        bmp
+00024570: 5f70 616e 656c 2e53 697a 6572 203d 2077  _panel.Sizer = w
+00024580: 782e 426f 7853 697a 6572 2877 782e 5645  x.BoxSizer(wx.VE
+00024590: 5254 4943 414c 290d 0a20 2020 2020 2020  RTICAL)..       
+000245a0: 2062 6d70 203d 2069 6d61 6765 732e 4176   bmp = images.Av
+000245b0: 6174 6172 4465 6661 756c 744c 6172 6765  atarDefaultLarge
+000245c0: 2e42 6974 6d61 700d 0a20 2020 2020 2020  .Bitmap..       
+000245d0: 2062 6d70 5f73 7461 7469 6320 3d20 7365   bmp_static = se
+000245e0: 6c66 2e62 6d70 5f61 6363 6f75 6e74 203d  lf.bmp_account =
+000245f0: 2077 782e 5374 6174 6963 4269 746d 6170   wx.StaticBitmap
+00024600: 2862 6d70 5f70 616e 656c 2c20 6269 746d  (bmp_panel, bitm
+00024610: 6170 3d62 6d70 290d 0a20 2020 2020 2020  ap=bmp)..       
+00024620: 2073 697a 6572 5f61 6363 6f75 6e74 696e   sizer_accountin
+00024630: 666f 203d 2077 782e 466c 6578 4772 6964  fo = wx.FlexGrid
+00024640: 5369 7a65 7228 636f 6c73 3d32 2c20 7667  Sizer(cols=2, vg
+00024650: 6170 3d33 2c20 6867 6170 3d31 3029 0d0a  ap=3, hgap=10)..
+00024660: 2020 2020 2020 2020 7365 6c66 2e73 697a          self.siz
+00024670: 6572 5f61 6363 6f75 6e74 696e 666f 203d  er_accountinfo =
+00024680: 2073 697a 6572 5f61 6363 6f75 6e74 696e   sizer_accountin
+00024690: 666f 0d0a 2020 2020 2020 2020 7369 7a65  fo..        size
+000246a0: 725f 6163 636f 756e 7469 6e66 6f2e 4164  r_accountinfo.Ad
+000246b0: 6447 726f 7761 626c 6543 6f6c 2831 2c20  dGrowableCol(1, 
+000246c0: 3129 0d0a 0d0a 2020 2020 2020 2020 626d  1)....        bm
+000246d0: 705f 7061 6e65 6c2e 5369 7a65 722e 4164  p_panel.Sizer.Ad
+000246e0: 6428 626d 705f 7374 6174 6963 2c20 626f  d(bmp_static, bo
+000246f0: 7264 6572 3d32 2c20 666c 6167 3d77 782e  rder=2, flag=wx.
+00024700: 4752 4f57 207c 2077 782e 544f 5029 0d0a  GROW | wx.TOP)..
+00024710: 2020 2020 2020 2020 7369 7a65 725f 6163          sizer_ac
+00024720: 636f 756e 742e 4164 6428 626d 705f 7061  count.Add(bmp_pa
+00024730: 6e65 6c2c 2062 6f72 6465 723d 3130 2c20  nel, border=10, 
+00024740: 666c 6167 3d77 782e 4c45 4654 207c 2077  flag=wx.LEFT | w
+00024750: 782e 5249 4748 5429 0d0a 2020 2020 2020  x.RIGHT)..      
+00024760: 2020 7369 7a65 725f 6163 636f 756e 742e    sizer_account.
+00024770: 4164 6428 7369 7a65 725f 6163 636f 756e  Add(sizer_accoun
+00024780: 7469 6e66 6f2c 2070 726f 706f 7274 696f  tinfo, proportio
+00024790: 6e3d 312c 2066 6c61 673d 7778 2e47 524f  n=1, flag=wx.GRO
+000247a0: 5729 0d0a 2020 2020 2020 2020 7369 7a65  W)..        size
+000247b0: 7231 2e41 6464 2873 697a 6572 5f61 6363  r1.Add(sizer_acc
+000247c0: 6f75 6e74 2c20 626f 7264 6572 3d32 302c  ount, border=20,
+000247d0: 2070 726f 706f 7274 696f 6e3d 312c 0d0a   proportion=1,..
+000247e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000247f0: 2020 2066 6c61 673d 7778 2e54 4f50 207c     flag=wx.TOP |
+00024800: 2077 782e 4752 4f57 290d 0a0d 0a20 2020   wx.GROW)....   
+00024810: 2020 2020 2073 697a 6572 3220 3d20 7061       sizer2 = pa
+00024820: 6e65 6c32 2e53 697a 6572 203d 2077 782e  nel2.Sizer = wx.
+00024830: 426f 7853 697a 6572 2877 782e 5645 5254  BoxSizer(wx.VERT
+00024840: 4943 414c 290d 0a20 2020 2020 2020 2073  ICAL)..        s
+00024850: 697a 6572 5f66 696c 6520 3d20 7778 2e46  izer_file = wx.F
+00024860: 6c65 7847 7269 6453 697a 6572 2863 6f6c  lexGridSizer(col
+00024870: 733d 322c 2076 6761 703d 332c 2068 6761  s=2, vgap=3, hga
+00024880: 703d 3130 290d 0a20 2020 2020 2020 206c  p=10)..        l
+00024890: 6162 656c 5f66 696c 6520 3d20 7778 2e53  abel_file = wx.S
+000248a0: 7461 7469 6354 6578 7428 7061 7265 6e74  taticText(parent
+000248b0: 3d70 616e 656c 322c 206c 6162 656c 3d22  =panel2, label="
+000248c0: 4461 7461 6261 7365 2069 6e66 6f72 6d61  Database informa
+000248d0: 7469 6f6e 2229 0d0a 2020 2020 2020 2020  tion")..        
+000248e0: 6c61 6265 6c5f 6669 6c65 2e46 6f6e 7420  label_file.Font 
+000248f0: 3d20 7778 2e46 6f6e 7428 3130 2c20 7778  = wx.Font(10, wx
+00024900: 2e46 4f4e 5446 414d 494c 595f 5357 4953  .FONTFAMILY_SWIS
+00024910: 532c 2077 782e 464f 4e54 5354 594c 455f  S, wx.FONTSTYLE_
+00024920: 4e4f 524d 414c 2c0d 0a20 2020 2020 2020  NORMAL,..       
+00024930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024940: 2020 2020 2020 2020 2020 2077 782e 464f             wx.FO
+00024950: 4e54 5745 4947 4854 5f42 4f4c 442c 2066  NTWEIGHT_BOLD, f
+00024960: 6163 654e 616d 653d 7365 6c66 2e46 6f6e  aceName=self.Fon
+00024970: 742e 4661 6365 4e61 6d65 290d 0a20 2020  t.FaceName)..   
+00024980: 2020 2020 2073 697a 6572 322e 4164 6428       sizer2.Add(
+00024990: 6c61 6265 6c5f 6669 6c65 2c20 626f 7264  label_file, bord
+000249a0: 6572 3d35 2c20 666c 6167 3d77 782e 414c  er=5, flag=wx.AL
+000249b0: 4c29 0d0a 0d0a 2020 2020 2020 2020 6e61  L)....        na
+000249c0: 6d65 7320 3d20 5b22 6564 6974 5f69 6e66  mes = ["edit_inf
+000249d0: 6f5f 6368 6174 7322 2c20 2265 6469 745f  o_chats", "edit_
+000249e0: 696e 666f 5f63 6f6e 7461 6374 7322 2c0d  info_contacts",.
+000249f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00024a00: 2020 2265 6469 745f 696e 666f 5f74 7261    "edit_info_tra
+00024a10: 6e73 6665 7273 222c 2022 6564 6974 5f69  nsfers", "edit_i
+00024a20: 6e66 6f5f 6d65 7373 6167 6573 222c 0d0a  nfo_messages",..
+00024a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024a40: 2022 6564 6974 5f69 6e66 6f5f 6c61 7374   "edit_info_last
+00024a50: 6d65 7373 6167 6522 2c20 2265 6469 745f  message", "edit_
+00024a60: 696e 666f 5f66 6972 7374 6d65 7373 6167  info_firstmessag
+00024a70: 6522 2c20 2222 2c0d 0a20 2020 2020 2020  e", "",..       
+00024a80: 2020 2020 2020 2020 2020 2265 6469 745f            "edit_
+00024a90: 696e 666f 5f70 6174 6822 2c20 2265 6469  info_path", "edi
+00024aa0: 745f 696e 666f 5f73 697a 6522 2c20 2265  t_info_size", "e
+00024ab0: 6469 745f 696e 666f 5f6d 6f64 6966 6965  dit_info_modifie
+00024ac0: 6422 2c0d 0a20 2020 2020 2020 2020 2020  d",..           
+00024ad0: 2020 2020 2020 2265 6469 745f 696e 666f        "edit_info
+00024ae0: 5f73 6861 3122 2c20 2265 6469 745f 696e  _sha1", "edit_in
+00024af0: 666f 5f6d 6435 222c 205d 0d0a 2020 2020  fo_md5", ]..    
+00024b00: 2020 2020 6c61 6265 6c73 203d 205b 2243      labels = ["C
+00024b10: 6f6e 7665 7273 6174 696f 6e73 222c 2022  onversations", "
+00024b20: 436f 6e74 6163 7473 222c 2022 4669 6c65  Contacts", "File
+00024b30: 2074 7261 6e73 6665 7273 222c 2022 4d65   transfers", "Me
+00024b40: 7373 6167 6573 222c 0d0a 2020 2020 2020  ssages",..      
+00024b50: 2020 2020 2020 2020 2020 2020 224c 6173              "Las
+00024b60: 7420 6d65 7373 6167 6522 2c20 2246 6972  t message", "Fir
+00024b70: 7374 206d 6573 7361 6765 222c 2022 222c  st message", "",
+00024b80: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00024b90: 2020 2020 2246 756c 6c20 7061 7468 222c      "Full path",
+00024ba0: 2022 4669 6c65 2073 697a 6522 2c20 224c   "File size", "L
+00024bb0: 6173 7420 6d6f 6469 6669 6564 222c 0d0a  ast modified",..
+00024bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024bd0: 2020 2253 4841 2d31 2063 6865 636b 7375    "SHA-1 checksu
+00024be0: 6d22 2c20 224d 4435 2063 6865 636b 7375  m", "MD5 checksu
+00024bf0: 6d22 2c20 205d 0d0a 2020 2020 2020 2020  m",  ]..        
+00024c00: 666f 7220 6e61 6d65 2c20 6c61 6265 6c20  for name, label 
+00024c10: 696e 207a 6970 286e 616d 6573 2c20 6c61  in zip(names, la
+00024c20: 6265 6c73 293a 0d0a 2020 2020 2020 2020  bels):..        
+00024c30: 2020 2020 6966 206e 6f74 206e 616d 6520      if not name 
+00024c40: 616e 6420 6e6f 7420 6c61 6265 6c3a 0d0a  and not label:..
+00024c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024c60: 7369 7a65 725f 6669 6c65 2e41 6464 5370  sizer_file.AddSp
+00024c70: 6163 6572 2832 3029 2c20 7369 7a65 725f  acer(20), sizer_
+00024c80: 6669 6c65 2e41 6464 5370 6163 6572 2832  file.AddSpacer(2
+00024c90: 3029 0d0a 2020 2020 2020 2020 2020 2020  0)..            
+00024ca0: 2020 2020 636f 6e74 696e 7565 2023 2066      continue # f
+00024cb0: 6f72 206e 616d 652c 206c 6162 656c 0d0a  or name, label..
+00024cc0: 2020 2020 2020 2020 2020 2020 6c61 6265              labe
+00024cd0: 6c74 6578 7420 3d20 7778 2e53 7461 7469  ltext = wx.Stati
+00024ce0: 6354 6578 7428 7061 7265 6e74 3d70 616e  cText(parent=pan
+00024cf0: 656c 322c 206c 6162 656c 3d22 2573 3a22  el2, label="%s:"
+00024d00: 2025 206c 6162 656c 290d 0a20 2020 2020   % label)..     
+00024d10: 2020 2020 2020 2043 6f6c 6f75 724d 616e         ColourMan
+00024d20: 6167 6572 2e4d 616e 6167 6528 6c61 6265  ager.Manage(labe
+00024d30: 6c74 6578 742c 2022 466f 7265 6772 6f75  ltext, "Foregrou
+00024d40: 6e64 436f 6c6f 7572 222c 2022 4469 7361  ndColour", "Disa
+00024d50: 626c 6564 436f 6c6f 7572 2229 0d0a 2020  bledColour")..  
+00024d60: 2020 2020 2020 2020 2020 7661 6c75 6574            valuet
+00024d70: 6578 7420 3d20 7778 2e54 6578 7443 7472  ext = wx.TextCtr
+00024d80: 6c28 7061 7265 6e74 3d70 616e 656c 322c  l(parent=panel2,
+00024d90: 2076 616c 7565 3d22 416e 616c 797a 696e   value="Analyzin
+00024da0: 672e 2e22 2c0d 0a20 2020 2020 2020 2020  g..",..         
+00024db0: 2020 2020 2020 2073 7479 6c65 3d77 782e         style=wx.
+00024dc0: 4e4f 5f42 4f52 4445 5220 7c20 7778 2e54  NO_BORDER | wx.T
+00024dd0: 455f 4d55 4c54 494c 494e 4520 7c20 7778  E_MULTILINE | wx
+00024de0: 2e54 455f 5249 4348 290d 0a20 2020 2020  .TE_RICH)..     
+00024df0: 2020 2020 2020 2076 616c 7565 7465 7874         valuetext
+00024e00: 2e4d 696e 5369 7a65 203d 2028 2d31 2c20  .MinSize = (-1, 
+00024e10: 3335 290d 0a20 2020 2020 2020 2020 2020  35)..           
+00024e20: 2043 6f6c 6f75 724d 616e 6167 6572 2e4d   ColourManager.M
+00024e30: 616e 6167 6528 7661 6c75 6574 6578 742c  anage(valuetext,
+00024e40: 2022 4261 636b 6772 6f75 6e64 436f 6c6f   "BackgroundColo
+00024e50: 7572 222c 2022 4267 436f 6c6f 7572 2229  ur", "BgColour")
+00024e60: 0d0a 2020 2020 2020 2020 2020 2020 7661  ..            va
+00024e70: 6c75 6574 6578 742e 5365 7445 6469 7461  luetext.SetEdita
+00024e80: 626c 6528 4661 6c73 6529 0d0a 2020 2020  ble(False)..    
+00024e90: 2020 2020 2020 2020 7369 7a65 725f 6669          sizer_fi
+00024ea0: 6c65 2e41 6464 286c 6162 656c 7465 7874  le.Add(labeltext
+00024eb0: 2c20 626f 7264 6572 3d35 2c20 666c 6167  , border=5, flag
+00024ec0: 3d77 782e 4c45 4654 290d 0a20 2020 2020  =wx.LEFT)..     
+00024ed0: 2020 2020 2020 2073 697a 6572 5f66 696c         sizer_fil
+00024ee0: 652e 4164 6428 7661 6c75 6574 6578 742c  e.Add(valuetext,
+00024ef0: 2070 726f 706f 7274 696f 6e3d 312c 2066   proportion=1, f
+00024f00: 6c61 673d 7778 2e47 524f 5729 0d0a 2020  lag=wx.GROW)..  
+00024f10: 2020 2020 2020 2020 2020 7365 7461 7474            setatt
+00024f20: 7228 7365 6c66 2c20 6e61 6d65 2c20 7661  r(self, name, va
+00024f30: 6c75 6574 6578 7429 0d0a 2020 2020 2020  luetext)..      
+00024f40: 2020 7365 6c66 2e65 6469 745f 696e 666f    self.edit_info
+00024f50: 5f70 6174 682e 5661 6c75 6520 3d20 7365  _path.Value = se
+00024f60: 6c66 2e64 622e 6669 6c65 6e61 6d65 0d0a  lf.db.filename..
+00024f70: 0d0a 2020 2020 2020 2020 6275 7474 6f6e  ..        button
+00024f80: 5f63 6865 636b 203d 2073 656c 662e 6275  _check = self.bu
+00024f90: 7474 6f6e 5f63 6865 636b 5f69 6e74 6567  tton_check_integ
+00024fa0: 7269 7479 203d 205c 0d0a 2020 2020 2020  rity = \..      
+00024fb0: 2020 2020 2020 7778 2e42 7574 746f 6e28        wx.Button(
+00024fc0: 7061 7265 6e74 3d70 616e 656c 322c 206c  parent=panel2, l
+00024fd0: 6162 656c 3d22 4368 6563 6b20 666f 7220  abel="Check for 
+00024fe0: 636f 7272 7570 7469 6f6e 2229 0d0a 2020  corruption")..  
+00024ff0: 2020 2020 2020 6275 7474 6f6e 5f72 6566        button_ref
+00025000: 7265 7368 203d 2073 656c 662e 6275 7474  resh = self.butt
+00025010: 6f6e 5f72 6566 7265 7368 5f66 696c 6569  on_refresh_filei
+00025020: 6e66 6f20 3d20 5c0d 0a20 2020 2020 2020  nfo = \..       
+00025030: 2020 2020 2077 782e 4275 7474 6f6e 2870       wx.Button(p
+00025040: 6172 656e 743d 7061 6e65 6c32 2c20 6c61  arent=panel2, la
+00025050: 6265 6c3d 2252 6566 7265 7368 2229 0d0a  bel="Refresh")..
+00025060: 2020 2020 2020 2020 6275 7474 6f6e 5f63          button_c
+00025070: 6865 636b 2e45 6e61 626c 6564 203d 2062  heck.Enabled = b
+00025080: 7574 746f 6e5f 7265 6672 6573 682e 456e  utton_refresh.En
+00025090: 6162 6c65 6420 3d20 4661 6c73 650d 0a20  abled = False.. 
+000250a0: 2020 2020 2020 2062 7574 746f 6e5f 6368         button_ch
+000250b0: 6563 6b2e 5365 7454 6f6f 6c54 6970 2822  eck.SetToolTip("
+000250c0: 4368 6563 6b20 6461 7461 6261 7365 2069  Check database i
+000250d0: 6e74 6567 7269 7479 2066 6f72 2063 6f72  ntegrity for cor
+000250e0: 7275 7074 696f 6e20 616e 6420 7265 636f  ruption and reco
+000250f0: 7665 7279 2e22 290d 0a20 2020 2020 2020  very.")..       
+00025100: 2073 697a 6572 5f66 696c 652e 4164 6428   sizer_file.Add(
+00025110: 6275 7474 6f6e 5f63 6865 636b 290d 0a20  button_check).. 
+00025120: 2020 2020 2020 2073 697a 6572 5f66 696c         sizer_fil
+00025130: 652e 4164 6428 6275 7474 6f6e 5f72 6566  e.Add(button_ref
+00025140: 7265 7368 2c20 626f 7264 6572 3d31 352c  resh, border=15,
+00025150: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00025160: 2020 2020 2020 2020 2066 6c61 673d 7778           flag=wx
+00025170: 2e41 4c49 474e 5f52 4947 4854 207c 2077  .ALIGN_RIGHT | w
+00025180: 782e 5249 4748 5429 0d0a 2020 2020 2020  x.RIGHT)..      
+00025190: 2020 7365 6c66 2e42 696e 6428 7778 2e45    self.Bind(wx.E
+000251a0: 5654 5f42 5554 544f 4e2c 2073 656c 662e  VT_BUTTON, self.
+000251b0: 6f6e 5f63 6865 636b 5f69 6e74 6567 7269  on_check_integri
+000251c0: 7479 2c20 6275 7474 6f6e 5f63 6865 636b  ty, button_check
+000251d0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+000251e0: 4269 6e64 2877 782e 4556 545f 4255 5454  Bind(wx.EVT_BUTT
+000251f0: 4f4e 2c20 6c61 6d62 6461 2065 3a20 7365  ON, lambda e: se
+00025200: 6c66 2e75 7064 6174 655f 696e 666f 5f70  lf.update_info_p
+00025210: 6167 6528 292c 0d0a 2020 2020 2020 2020  age(),..        
+00025220: 2020 2020 2020 2020 2020 6275 7474 6f6e            button
+00025230: 5f72 6566 7265 7368 290d 0a0d 0a20 2020  _refresh)....   
+00025240: 2020 2020 2073 697a 6572 5f66 696c 652e       sizer_file.
+00025250: 4164 6447 726f 7761 626c 6543 6f6c 2831  AddGrowableCol(1
+00025260: 2c20 3129 0d0a 2020 2020 2020 2020 7369  , 1)..        si
+00025270: 7a65 7232 2e41 6464 2873 697a 6572 5f66  zer2.Add(sizer_f
+00025280: 696c 652c 2062 6f72 6465 723d 3230 2c20  ile, border=20, 
+00025290: 7072 6f70 6f72 7469 6f6e 3d31 2c20 666c  proportion=1, fl
+000252a0: 6167 3d77 782e 544f 5020 7c20 7778 2e47  ag=wx.TOP | wx.G
+000252b0: 524f 5729 0d0a 0d0a 2020 2020 2020 2020  ROW)....        
+000252c0: 7369 7a65 722e 4164 6428 7061 6e65 6c31  sizer.Add(panel1
+000252d0: 2c20 7072 6f70 6f72 7469 6f6e 3d31 2c20  , proportion=1, 
+000252e0: 626f 7264 6572 3d35 2c0d 0a20 2020 2020  border=5,..     
+000252f0: 2020 2020 2020 2020 2020 2020 2066 6c61               fla
+00025300: 673d 7778 2e4c 4546 5420 207c 2077 782e  g=wx.LEFT  | wx.
+00025310: 544f 5020 7c20 7778 2e42 4f54 544f 4d20  TOP | wx.BOTTOM 
+00025320: 7c20 7778 2e47 524f 5729 0d0a 2020 2020  | wx.GROW)..    
+00025330: 2020 2020 7369 7a65 722e 4164 6428 7061      sizer.Add(pa
+00025340: 6e65 6c32 2c20 7072 6f70 6f72 7469 6f6e  nel2, proportion
+00025350: 3d31 2c20 626f 7264 6572 3d35 2c0d 0a20  =1, border=5,.. 
+00025360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025370: 2066 6c61 673d 7778 2e52 4947 4854 207c   flag=wx.RIGHT |
+00025380: 2077 782e 544f 5020 7c20 7778 2e42 4f54   wx.TOP | wx.BOT
+00025390: 544f 4d20 7c20 7778 2e47 524f 5729 0d0a  TOM | wx.GROW)..
+000253a0: 2020 2020 2020 2020 7365 6c66 2e75 7064          self.upd
+000253b0: 6174 655f 6163 636f 756e 7469 6e66 6f28  ate_accountinfo(
+000253c0: 290d 0a20 2020 2020 2020 2070 6167 652e  )..        page.
+000253d0: 5365 7475 7053 6372 6f6c 6c69 6e67 2829  SetupScrolling()
+000253e0: 0d0a 0d0a 0d0a 2020 2020 6465 6620 6372  ......    def cr
+000253f0: 6561 7465 5f70 6167 655f 6c69 7665 2873  eate_page_live(s
+00025400: 656c 662c 206e 6f74 6562 6f6f 6b29 3a0d  elf, notebook):.
+00025410: 0a20 2020 2020 2020 2022 2222 4372 6561  .        """Crea
+00025420: 7465 7320 6120 7061 6765 2066 6f72 2068  tes a page for h
+00025430: 616e 646c 696e 6720 636f 6d6d 756e 6963  andling communic
+00025440: 6174 696f 6e20 7769 7468 2053 6b79 7065  ation with Skype
+00025450: 206f 6e6c 696e 6520 6c6f 6769 6e2e 2222   online login.""
+00025460: 220d 0a20 2020 2020 2020 2070 6167 6520  "..        page 
+00025470: 3d20 7365 6c66 2e70 6167 655f 6c69 7665  = self.page_live
+00025480: 203d 2077 782e 5061 6e65 6c28 6e6f 7465   = wx.Panel(note
+00025490: 626f 6f6b 290d 0a20 2020 2020 2020 2073  book)..        s
+000254a0: 656c 662e 7061 6765 6f72 6465 725b 7061  elf.pageorder[pa
+000254b0: 6765 5d20 3d20 6c65 6e28 7365 6c66 2e70  ge] = len(self.p
+000254c0: 6167 656f 7264 6572 290d 0a20 2020 2020  ageorder)..     
+000254d0: 2020 206e 6f74 6562 6f6f 6b2e 4164 6450     notebook.AddP
+000254e0: 6167 6528 7061 6765 2c20 224f 6e6c 696e  age(page, "Onlin
+000254f0: 6522 290d 0a0d 0a20 2020 2020 2020 2073  e")....        s
+00025500: 706c 6974 7465 7220 3d20 7365 6c66 2e73  plitter = self.s
+00025510: 706c 6974 7465 725f 6c69 7665 203d 2077  plitter_live = w
+00025520: 782e 5370 6c69 7474 6572 5769 6e64 6f77  x.SplitterWindow
+00025530: 280d 0a20 2020 2020 2020 2020 2020 2070  (..            p
+00025540: 6172 656e 743d 7061 6765 2c20 7374 796c  arent=page, styl
+00025550: 653d 7778 2e42 4f52 4445 525f 4e4f 4e45  e=wx.BORDER_NONE
+00025560: 0d0a 2020 2020 2020 2020 290d 0a20 2020  ..        )..   
+00025570: 2020 2020 2073 706c 6974 7465 722e 5365       splitter.Se
+00025580: 744d 696e 696d 756d 5061 6e65 5369 7a65  tMinimumPaneSize
+00025590: 2833 3030 290d 0a20 2020 2020 2020 2070  (300)..        p
+000255a0: 616e 656c 3120 3d20 7365 6c66 2e70 616e  anel1 = self.pan
+000255b0: 656c 5f6c 6f67 696e 203d 2077 782e 5061  el_login = wx.Pa
+000255c0: 6e65 6c28 7370 6c69 7474 6572 290d 0a20  nel(splitter).. 
+000255d0: 2020 2020 2020 2070 616e 656c 3220 3d20         panel2 = 
+000255e0: 7365 6c66 2e70 616e 656c 5f73 796e 6320  self.panel_sync 
+000255f0: 203d 2077 782e 5061 6e65 6c28 7370 6c69   = wx.Panel(spli
+00025600: 7474 6572 290d 0a20 2020 2020 2020 2073  tter)..        s
+00025610: 706c 6974 7465 725f 7379 6e63 203d 2073  plitter_sync = s
+00025620: 656c 662e 7370 6c69 7474 6572 5f73 796e  elf.splitter_syn
+00025630: 6320 3d20 7778 2e53 706c 6974 7465 7257  c = wx.SplitterW
+00025640: 696e 646f 7728 0d0a 2020 2020 2020 2020  indow(..        
+00025650: 2020 2020 7061 7265 6e74 3d70 616e 656c      parent=panel
+00025660: 322c 2073 7479 6c65 3d77 782e 424f 5244  2, style=wx.BORD
+00025670: 4552 5f4e 4f4e 450d 0a20 2020 2020 2020  ER_NONE..       
+00025680: 2029 0d0a 2020 2020 2020 2020 7370 6c69   )..        spli
+00025690: 7474 6572 5f73 796e 632e 5365 744d 696e  tter_sync.SetMin
+000256a0: 696d 756d 5061 6e65 5369 7a65 2831 3030  imumPaneSize(100
+000256b0: 290d 0a20 2020 2020 2020 2070 616e 656c  )..        panel
+000256c0: 5f73 796e 6331 203d 2077 782e 5061 6e65  _sync1 = wx.Pane
+000256d0: 6c28 7370 6c69 7474 6572 5f73 796e 6329  l(splitter_sync)
+000256e0: 0d0a 2020 2020 2020 2020 7061 6e65 6c5f  ..        panel_
+000256f0: 7379 6e63 3220 3d20 7778 2e50 616e 656c  sync2 = wx.Panel
+00025700: 2873 706c 6974 7465 725f 7379 6e63 290d  (splitter_sync).
+00025710: 0a0d 0a20 2020 2020 2020 206c 6162 656c  ...        label
+00025720: 5f6c 6f67 696e 2020 3d20 7778 2e53 7461  _login  = wx.Sta
+00025730: 7469 6354 6578 7428 7061 6e65 6c31 2c20  ticText(panel1, 
+00025740: 6c61 6265 6c3d 224c 6f67 2069 6e20 746f  label="Log in to
+00025750: 2053 6b79 7065 206f 6e6c 696e 6520 6163   Skype online ac
+00025760: 636f 756e 7422 290d 0a20 2020 2020 2020  count")..       
+00025770: 206c 6162 656c 5f75 7365 7220 2020 3d20   label_user   = 
+00025780: 7778 2e53 7461 7469 6354 6578 7428 7061  wx.StaticText(pa
+00025790: 6e65 6c31 2c20 6c61 6265 6c3d 2255 7365  nel1, label="Use
+000257a0: 726e 616d 653a 2229 0d0a 2020 2020 2020  rname:")..      
+000257b0: 2020 6564 6974 5f75 7365 7220 2020 203d    edit_user    =
+000257c0: 2077 782e 5465 7874 4374 726c 2870 616e   wx.TextCtrl(pan
+000257d0: 656c 3129 0d0a 2020 2020 2020 2020 6275  el1)..        bu
+000257e0: 7474 6f6e 5f75 7365 7220 203d 2077 782e  tton_user  = wx.
+000257f0: 4275 7474 6f6e 2870 616e 656c 312c 206c  Button(panel1, l
+00025800: 6162 656c 3d22 4368 616e 6765 2229 0d0a  abel="Change")..
+00025810: 2020 2020 2020 2020 6c61 6265 6c5f 7077          label_pw
+00025820: 2020 2020 203d 2077 782e 5374 6174 6963       = wx.Static
+00025830: 5465 7874 2870 616e 656c 312c 206c 6162  Text(panel1, lab
+00025840: 656c 3d22 2650 6173 7377 6f72 643a 222c  el="&Password:",
+00025850: 206e 616d 653d 226c 6162 656c 5f6c 6976   name="label_liv
+00025860: 655f 7077 2229 0d0a 2020 2020 2020 2020  e_pw")..        
+00025870: 6564 6974 5f70 7720 2020 2020 203d 2077  edit_pw      = w
+00025880: 782e 5465 7874 4374 726c 2870 616e 656c  x.TextCtrl(panel
+00025890: 312c 2073 7479 6c65 3d77 782e 5445 5f50  1, style=wx.TE_P
+000258a0: 4153 5357 4f52 4420 7c20 7778 2e54 455f  ASSWORD | wx.TE_
+000258b0: 5052 4f43 4553 535f 454e 5445 522c 206e  PROCESS_ENTER, n
+000258c0: 616d 653d 226c 6976 655f 7077 2229 0d0a  ame="live_pw")..
+000258d0: 2020 2020 2020 2020 6368 6563 6b5f 7374          check_st
+000258e0: 6f72 6520 203d 2077 782e 4368 6563 6b42  ore  = wx.CheckB
+000258f0: 6f78 2870 616e 656c 312c 206c 6162 656c  ox(panel1, label
+00025900: 3d22 2652 656d 656d 6265 7220 7061 7373  ="&Remember pass
+00025910: 776f 7264 2229 0d0a 2020 2020 2020 2020  word")..        
+00025920: 6368 6563 6b5f 6c6f 6769 6e20 203d 2077  check_login  = w
+00025930: 782e 4368 6563 6b42 6f78 2870 616e 656c  x.CheckBox(panel
+00025940: 312c 206c 6162 656c 3d22 4c6f 6720 696e  1, label="Log in
+00025950: 2026 6175 746f 6d61 7469 6361 6c6c 7922   &automatically"
+00025960: 290d 0a20 2020 2020 2020 2063 6865 636b  )..        check
+00025970: 5f73 796e 6320 2020 3d20 7778 2e43 6865  _sync   = wx.Che
+00025980: 636b 426f 7828 7061 6e65 6c31 2c20 6c61  ckBox(panel1, la
+00025990: 6265 6c3d 2253 796e 6368 726f 6e69 7a65  bel="Synchronize
+000259a0: 2068 6973 746f 7279 2026 6175 746f 6d61   history &automa
+000259b0: 7469 6361 6c6c 7922 290d 0a20 2020 2020  tically")..     
+000259c0: 2020 2065 6469 745f 7374 6174 7573 2020     edit_status  
+000259d0: 3d20 7778 2e54 6578 7443 7472 6c28 7061  = wx.TextCtrl(pa
+000259e0: 6e65 6c31 2c20 7369 7a65 3d28 2d31 2c20  nel1, size=(-1, 
+000259f0: 3330 292c 2073 7479 6c65 3d77 782e 5445  30), style=wx.TE
+00025a00: 5f4d 554c 5449 4c49 4e45 207c 2077 782e  _MULTILINE | wx.
+00025a10: 5445 5f4e 4f5f 5653 4352 4f4c 4c20 7c20  TE_NO_VSCROLL | 
+00025a20: 7778 2e42 4f52 4445 525f 4e4f 4e45 290d  wx.BORDER_NONE).
+00025a30: 0a20 2020 2020 2020 2062 7574 746f 6e5f  .        button_
+00025a40: 6c6f 6769 6e20 3d20 636f 6e74 726f 6c73  login = controls
+00025a50: 2e4e 6f74 6542 7574 746f 6e28 7061 6e65  .NoteButton(pane
+00025a60: 6c31 2c20 626d 703d 696d 6167 6573 2e42  l1, bmp=images.B
+00025a70: 7574 746f 6e4c 6f67 696e 2e42 6974 6d61  uttonLogin.Bitma
+00025a80: 7029 0d0a 2020 2020 2020 2020 6c61 6265  p)..        labe
+00025a90: 6c5f 696e 666f 2020 203d 2077 782e 6874  l_info   = wx.ht
+00025aa0: 6d6c 2e48 746d 6c57 696e 646f 7728 7061  ml.HtmlWindow(pa
+00025ab0: 6e65 6c31 290d 0a0d 0a20 2020 2020 2020  nel1)....       
+00025ac0: 206c 6162 656c 5f73 796e 6320 3d20 7778   label_sync = wx
+00025ad0: 2e53 7461 7469 6354 6578 7428 7061 7265  .StaticText(pare
+00025ae0: 6e74 3d70 616e 656c 322c 206c 6162 656c  nt=panel2, label
+00025af0: 3d22 5570 6461 7465 2064 6174 6162 6173  ="Update databas
+00025b00: 6520 6672 6f6d 2053 6b79 7065 206f 6e6c  e from Skype onl
+00025b10: 696e 6522 290d 0a20 2020 2020 2020 206c  ine")..        l
+00025b20: 6973 745f 6368 6174 7320 3d20 636f 6e74  ist_chats = cont
+00025b30: 726f 6c73 2e53 6f72 7461 626c 654c 6973  rols.SortableLis
+00025b40: 7456 6965 7728 7061 7265 6e74 3d70 616e  tView(parent=pan
+00025b50: 656c 5f73 796e 6331 2c20 7374 796c 653d  el_sync1, style=
+00025b60: 7778 2e4c 435f 5245 504f 5254 290d 0a20  wx.LC_REPORT).. 
+00025b70: 2020 2020 2020 2067 6175 6765 203d 2077         gauge = w
+00025b80: 782e 4761 7567 6528 7061 6e65 6c5f 7379  x.Gauge(panel_sy
+00025b90: 6e63 322c 2073 697a 653d 2833 3030 2c20  nc2, size=(300, 
+00025ba0: 3135 292c 2073 7479 6c65 3d77 782e 4741  15), style=wx.GA
+00025bb0: 5f48 4f52 495a 4f4e 5441 4c20 7c20 7778  _HORIZONTAL | wx
+00025bc0: 2e50 445f 534d 4f4f 5448 290d 0a20 2020  .PD_SMOOTH)..   
+00025bd0: 2020 2020 206c 6162 656c 5f70 726f 6772       label_progr
+00025be0: 6573 7320 2020 3d20 7778 2e53 7461 7469  ess   = wx.Stati
+00025bf0: 6354 6578 7428 7061 6e65 6c5f 7379 6e63  cText(panel_sync
+00025c00: 3229 0d0a 2020 2020 2020 2020 6564 6974  2)..        edit
+00025c10: 5f73 796e 635f 7374 6174 7573 203d 2077  _sync_status = w
+00025c20: 782e 5465 7874 4374 726c 2870 616e 656c  x.TextCtrl(panel
+00025c30: 5f73 796e 6332 2c20 7369 7a65 3d28 2d31  _sync2, size=(-1
+00025c40: 2c20 3530 292c 2073 7479 6c65 3d77 782e  , 50), style=wx.
+00025c50: 5445 5f4d 554c 5449 4c49 4e45 290d 0a20  TE_MULTILINE).. 
+00025c60: 2020 2020 2020 2063 6865 636b 5f63 6f6e         check_con
+00025c70: 7461 6374 7320 2020 3d20 7778 2e43 6865  tacts   = wx.Che
+00025c80: 636b 426f 7828 7061 6e65 6c5f 7379 6e63  ckBox(panel_sync
+00025c90: 322c 206c 6162 656c 3d22 5570 6461 7465  2, label="Update
+00025ca0: 2065 7869 7374 696e 6720 2663 6f6e 7461   existing &conta
+00025cb0: 6374 2069 6e66 6f72 6d61 7469 6f6e 2229  ct information")
+00025cc0: 0d0a 2020 2020 2020 2020 6368 6563 6b5f  ..        check_
+00025cd0: 6f6c 6465 7220 2020 2020 203d 2077 782e  older      = wx.
+00025ce0: 4368 6563 6b42 6f78 2870 616e 656c 5f73  CheckBox(panel_s
+00025cf0: 796e 6332 2c20 6c61 6265 6c3d 2243 6865  ync2, label="Che
+00025d00: 636b 2026 6f6c 6465 7220 6461 7461 6261  ck &older databa
+00025d10: 7365 2063 6861 7473 2066 6f72 206d 6573  se chats for mes
+00025d20: 7361 6765 7320 746f 2073 796e 6322 290d  sages to sync").
+00025d30: 0a20 2020 2020 2020 2062 7574 746f 6e5f  .        button_
+00025d40: 7379 6e63 2020 2020 2020 3d20 636f 6e74  sync      = cont
+00025d50: 726f 6c73 2e4e 6f74 6542 7574 746f 6e28  rols.NoteButton(
+00025d60: 7061 6e65 6c5f 7379 6e63 322c 2062 6d70  panel_sync2, bmp
+00025d70: 3d69 6d61 6765 732e 4275 7474 6f6e 4d65  =images.ButtonMe
+00025d80: 7267 654c 6566 744d 756c 7469 2e42 6974  rgeLeftMulti.Bit
+00025d90: 6d61 7029 0d0a 2020 2020 2020 2020 6275  map)..        bu
+00025da0: 7474 6f6e 5f73 796e 635f 7365 6c20 203d  tton_sync_sel  =
+00025db0: 2063 6f6e 7472 6f6c 732e 4e6f 7465 4275   controls.NoteBu
+00025dc0: 7474 6f6e 2870 616e 656c 5f73 796e 6332  tton(panel_sync2
+00025dd0: 2c20 626d 703d 696d 6167 6573 2e42 7574  , bmp=images.But
+00025de0: 746f 6e4d 6572 6765 4c65 6674 2e42 6974  tonMergeLeft.Bit
+00025df0: 6d61 7029 0d0a 2020 2020 2020 2020 6275  map)..        bu
+00025e00: 7474 6f6e 5f73 796e 635f 7374 6f70 203d  tton_sync_stop =
+00025e10: 2063 6f6e 7472 6f6c 732e 4e6f 7465 4275   controls.NoteBu
+00025e20: 7474 6f6e 2870 616e 656c 5f73 796e 6332  tton(panel_sync2
+00025e30: 2c20 626d 703d 696d 6167 6573 2e42 7574  , bmp=images.But
+00025e40: 746f 6e53 746f 702e 4269 746d 6170 290d  tonStop.Bitmap).
+00025e50: 0a0d 0a20 2020 2020 2020 2043 6f6c 6f75  ...        Colou
+00025e60: 724d 616e 6167 6572 2e4d 616e 6167 6528  rManager.Manage(
+00025e70: 7061 6e65 6c31 2c20 2242 6163 6b67 726f  panel1, "Backgro
+00025e80: 756e 6443 6f6c 6f75 7222 2c20 2242 6743  undColour", "BgC
+00025e90: 6f6c 6f75 7222 290d 0a20 2020 2020 2020  olour")..       
+00025ea0: 2043 6f6c 6f75 724d 616e 6167 6572 2e4d   ColourManager.M
+00025eb0: 616e 6167 6528 7061 6e65 6c32 2c20 2242  anage(panel2, "B
+00025ec0: 6163 6b67 726f 756e 6443 6f6c 6f75 7222  ackgroundColour"
+00025ed0: 2c20 2242 6743 6f6c 6f75 7222 290d 0a20  , "BgColour").. 
+00025ee0: 2020 2020 2020 206c 6162 656c 5f75 7365         label_use
+00025ef0: 722e 4469 7361 626c 6528 290d 0a20 2020  r.Disable()..   
+00025f00: 2020 2020 2065 6469 745f 7573 6572 2e44       edit_user.D
+00025f10: 6973 6162 6c65 2829 0d0a 2020 2020 2020  isable()..      
+00025f20: 2020 6c61 6265 6c5f 6c6f 6769 6e2e 466f    label_login.Fo
+00025f30: 6e74 203d 2077 782e 466f 6e74 2831 302c  nt = wx.Font(10,
+00025f40: 2077 782e 464f 4e54 4641 4d49 4c59 5f53   wx.FONTFAMILY_S
+00025f50: 5749 5353 2c0d 0a20 2020 2020 2020 2020  WISS,..         
+00025f60: 2020 2077 782e 464f 4e54 5354 594c 455f     wx.FONTSTYLE_
+00025f70: 4e4f 524d 414c 2c20 7778 2e46 4f4e 5457  NORMAL, wx.FONTW
+00025f80: 4549 4748 545f 424f 4c44 2c20 6661 6365  EIGHT_BOLD, face
+00025f90: 4e61 6d65 3d73 656c 662e 466f 6e74 2e46  Name=self.Font.F
+00025fa0: 6163 654e 616d 6529 0d0a 2020 2020 2020  aceName)..      
+00025fb0: 2020 6368 6563 6b5f 7374 6f72 652e 546f    check_store.To
+00025fc0: 6f6c 5469 7020 3d20 2253 746f 7265 2070  olTip = "Store p
+00025fd0: 6173 7377 6f72 6420 666f 7220 7468 6973  assword for this
+00025fe0: 2064 6174 6162 6173 6520 6c6f 6361 6c6c   database locall
+00025ff0: 7922 0d0a 2020 2020 2020 2020 6368 6563  y"..        chec
+00026000: 6b5f 6c6f 6769 6e2e 546f 6f6c 5469 7020  k_login.ToolTip 
+00026010: 3d20 224c 6f67 2069 6e20 746f 2053 6b79  = "Log in to Sky
+00026020: 7065 206f 6e6c 696e 6520 7365 7276 6963  pe online servic
+00026030: 6520 6175 746f 6d61 7469 6361 6c6c 7920  e automatically 
+00026040: 2220 5c0d 0a20 2020 2020 2020 2020 2020  " \..           
+00026050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026060: 2020 2022 6f6e 206f 7065 6e69 6e67 2074     "on opening t
+00026070: 6869 7320 6461 7461 6261 7365 206e 6578  his database nex
+00026080: 7420 7469 6d65 220d 0a20 2020 2020 2020  t time"..       
+00026090: 2063 6865 636b 5f73 796e 632e 546f 6f6c   check_sync.Tool
+000260a0: 5469 7020 203d 2022 5570 6461 7465 2064  Tip  = "Update d
+000260b0: 6174 6162 6173 6520 6672 6f6d 2053 6b79  atabase from Sky
+000260c0: 7065 206f 6e6c 696e 6520 7365 7276 6963  pe online servic
+000260d0: 6520 2220 5c0d 0a20 2020 2020 2020 2020  e " \..         
+000260e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000260f0: 2020 2020 2022 6175 746f 6d61 7469 6361       "automatica
+00026100: 6c6c 7920 6f6e 206f 7065 6e69 6e67 2074  lly on opening t
+00026110: 6869 7320 6461 7461 6261 7365 206e 6578  his database nex
+00026120: 7420 7469 6d65 220d 0a20 2020 2020 2020  t time"..       
+00026130: 2063 6865 636b 5f6c 6f67 696e 2e45 6e61   check_login.Ena
+00026140: 626c 6564 203d 2063 6865 636b 5f73 796e  bled = check_syn
+00026150: 632e 456e 6162 6c65 6420 3d20 4661 6c73  c.Enabled = Fals
+00026160: 650d 0a20 2020 2020 2020 2043 6f6c 6f75  e..        Colou
+00026170: 724d 616e 6167 6572 2e4d 616e 6167 6528  rManager.Manage(
+00026180: 6564 6974 5f73 7461 7475 732c 2022 466f  edit_status, "Fo
+00026190: 7265 6772 6f75 6e64 436f 6c6f 7572 222c  regroundColour",
+000261a0: 2022 4469 7361 626c 6564 436f 6c6f 7572   "DisabledColour
+000261b0: 2229 0d0a 2020 2020 2020 2020 436f 6c6f  ")..        Colo
+000261c0: 7572 4d61 6e61 6765 722e 4d61 6e61 6765  urManager.Manage
+000261d0: 2865 6469 745f 7374 6174 7573 2c20 2242  (edit_status, "B
+000261e0: 6163 6b67 726f 756e 6443 6f6c 6f75 7222  ackgroundColour"
+000261f0: 2c20 2242 6743 6f6c 6f75 7222 290d 0a20  , "BgColour").. 
+00026200: 2020 2020 2020 2065 6469 745f 7374 6174         edit_stat
+00026210: 7573 2e53 6574 4564 6974 6162 6c65 2846  us.SetEditable(F
+00026220: 616c 7365 290d 0a20 2020 2020 2020 2043  alse)..        C
+00026230: 6f6c 6f75 724d 616e 6167 6572 2e4d 616e  olourManager.Man
+00026240: 6167 6528 6275 7474 6f6e 5f6c 6f67 696e  age(button_login
+00026250: 2c20 2242 6163 6b67 726f 756e 6443 6f6c  , "BackgroundCol
+00026260: 6f75 7222 2c20 2242 6743 6f6c 6f75 7222  our", "BgColour"
+00026270: 290d 0a20 2020 2020 2020 2062 7574 746f  )..        butto
+00026280: 6e5f 6c6f 6769 6e2e 4c61 6265 6c20 3d20  n_login.Label = 
+00026290: 2226 4c6f 6720 696e 2061 7320 2725 7327  "&Log in as '%s'
+000262a0: 2220 2520 7365 6c66 2e64 622e 7573 6572  " % self.db.user
+000262b0: 6e61 6d65 0d0a 2020 2020 2020 2020 6275  name..        bu
+000262c0: 7474 6f6e 5f6c 6f67 696e 2e4e 6f74 6520  tton_login.Note 
+000262d0: 3d20 2241 6674 6572 206c 6f67 696e 2c20  = "After login, 
+000262e0: 6c6f 6361 6c20 6461 7461 6261 7365 2063  local database c
+000262f0: 616e 2062 6520 7570 6461 7465 6420 6672  an be updated fr
+00026300: 6f6d 2022 205c 0d0a 2020 2020 2020 2020  om " \..        
+00026310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026320: 2020 2020 2253 6b79 7065 206f 6e6c 696e      "Skype onlin
+00026330: 6520 7365 7276 6963 652e 5c6e 4164 6469  e service.\nAddi
+00026340: 7469 6f6e 616c 6c79 2c20 4854 4d4c 2065  tionally, HTML e
+00026350: 7870 6f72 7420 2220 5c0d 0a20 2020 2020  xport " \..     
+00026360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026370: 2020 2020 2020 2022 6361 6e20 646f 776e         "can down
+00026380: 6c6f 6164 2061 6e64 2069 6e63 6c75 6465  load and include
+00026390: 2073 6861 7265 6420 6d65 6469 612e 220d   shared media.".
+000263a0: 0a20 2020 2020 2020 206c 6162 656c 5f69  .        label_i
+000263b0: 6e66 6f2e 5365 7446 6f6e 7473 286e 6f72  nfo.SetFonts(nor
+000263c0: 6d61 6c5f 6661 6365 3d73 656c 662e 466f  mal_face=self.Fo
+000263d0: 6e74 2e46 6163 654e 616d 652c 2066 6978  nt.FaceName, fix
+000263e0: 6564 5f66 6163 653d 7365 6c66 2e46 6f6e  ed_face=self.Fon
+000263f0: 742e 4661 6365 4e61 6d65 2c20 7369 7a65  t.FaceName, size
+00026400: 733d 5b38 5d20 2a20 3729 0d0a 2020 2020  s=[8] * 7)..    
+00026410: 2020 2020 6c61 6265 6c5f 696e 666f 2e53      label_info.S
+00026420: 6574 5061 6765 2873 7465 702e 5465 6d70  etPage(step.Temp
+00026430: 6c61 7465 2874 656d 706c 6174 6573 2e4c  late(templates.L
+00026440: 4f47 494e 5f46 4149 4c5f 494e 464f 292e  OGIN_FAIL_INFO).
+00026450: 6578 7061 6e64 2829 290d 0a20 2020 2020  expand())..     
+00026460: 2020 206c 6162 656c 5f69 6e66 6f2e 4869     label_info.Hi
+00026470: 6465 2829 0d0a 0d0a 2020 2020 2020 2020  de()....        
+00026480: 6c61 6265 6c5f 7379 6e63 2e46 6f6e 7420  label_sync.Font 
+00026490: 3d20 7778 2e46 6f6e 7428 3130 2c20 7778  = wx.Font(10, wx
+000264a0: 2e46 4f4e 5446 414d 494c 595f 5357 4953  .FONTFAMILY_SWIS
+000264b0: 532c 2077 782e 464f 4e54 5354 594c 455f  S, wx.FONTSTYLE_
+000264c0: 4e4f 524d 414c 2c0d 0a20 2020 2020 2020  NORMAL,..       
+000264d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000264e0: 2020 2020 2020 2020 2020 2077 782e 464f             wx.FO
+000264f0: 4e54 5745 4947 4854 5f42 4f4c 442c 2066  NTWEIGHT_BOLD, f
+00026500: 6163 654e 616d 653d 7365 6c66 2e46 6f6e  aceName=self.Fon
+00026510: 742e 4661 6365 4e61 6d65 290d 0a20 2020  t.FaceName)..   
+00026520: 2020 2020 2063 6f6c 756d 6e73 203d 205b       columns = [
+00026530: 2822 7469 746c 6522 2c20 2243 6861 7422  ("title", "Chat"
+00026540: 292c 2028 226d 6573 7361 6765 5f63 6f75  ), ("message_cou
+00026550: 6e74 222c 2022 5570 6461 7465 7322 292c  nt", "Updates"),
+00026560: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00026570: 2020 2020 2028 2266 6972 7374 5f6d 6573       ("first_mes
+00026580: 7361 6765 5f64 6174 6574 696d 6522 2c20  sage_datetime", 
+00026590: 2246 726f 6d22 292c 0d0a 2020 2020 2020  "From"),..      
+000265a0: 2020 2020 2020 2020 2020 2020 2028 226c               ("l
+000265b0: 6173 745f 6d65 7373 6167 655f 6461 7465  ast_message_date
+000265c0: 7469 6d65 222c 2022 556e 7469 6c22 2920  time", "Until") 
+000265d0: 5d0d 0a20 2020 2020 2020 2066 726d 7420  ]..        frmt 
+000265e0: 3d20 6c61 6d62 6461 2072 2c20 633a 2072  = lambda r, c: r
+000265f0: 5b63 5d2e 7374 7266 7469 6d65 2822 2559  [c].strftime("%Y
+00026600: 2d25 6d2d 2564 2229 2069 6620 722e 6765  -%m-%d") if r.ge
+00026610: 7428 6329 2065 6c73 6520 2222 0d0a 2020  t(c) else ""..  
+00026620: 2020 2020 2020 666f 726d 6174 7465 7273        formatters
+00026630: 203d 207b 2266 6972 7374 5f6d 6573 7361   = {"first_messa
+00026640: 6765 5f64 6174 6574 696d 6522 3a20 6672  ge_datetime": fr
+00026650: 6d74 2c0d 0a20 2020 2020 2020 2020 2020  mt,..           
+00026660: 2020 2020 2020 2020 2020 2022 6c61 7374             "last
+00026670: 5f6d 6573 7361 6765 5f64 6174 6574 696d  _message_datetim
+00026680: 6522 3a20 6672 6d74 2c20 7d0d 0a20 2020  e": frmt, }..   
+00026690: 2020 2020 206c 6973 745f 6368 6174 732e       list_chats.
+000266a0: 5365 7443 6f6c 756d 6e73 2863 6f6c 756d  SetColumns(colum
+000266b0: 6e73 290d 0a20 2020 2020 2020 206c 6973  ns)..        lis
+000266c0: 745f 6368 6174 732e 5365 7443 6f6c 756d  t_chats.SetColum
+000266d0: 6e46 6f72 6d61 7474 6572 7328 666f 726d  nFormatters(form
+000266e0: 6174 7465 7273 290d 0a20 2020 2020 2020  atters)..       
+000266f0: 206c 6973 745f 6368 6174 732e 5365 7443   list_chats.SetC
+00026700: 6f6c 756d 6e73 4d61 7857 6964 7468 2833  olumnsMaxWidth(3
+00026710: 3030 290d 0a20 2020 2020 2020 2043 6f6c  00)..        Col
+00026720: 6f75 724d 616e 6167 6572 2e4d 616e 6167  ourManager.Manag
+00026730: 6528 6564 6974 5f73 796e 635f 7374 6174  e(edit_sync_stat
+00026740: 7573 2c20 2246 6f72 6567 726f 756e 6443  us, "ForegroundC
+00026750: 6f6c 6f75 7222 2c20 2244 6973 6162 6c65  olour", "Disable
+00026760: 6443 6f6c 6f75 7222 290d 0a20 2020 2020  dColour")..     
+00026770: 2020 2043 6f6c 6f75 724d 616e 6167 6572     ColourManager
+00026780: 2e4d 616e 6167 6528 6564 6974 5f73 796e  .Manage(edit_syn
+00026790: 635f 7374 6174 7573 2c20 2242 6163 6b67  c_status, "Backg
+000267a0: 726f 756e 6443 6f6c 6f75 7222 2c20 2242  roundColour", "B
+000267b0: 6743 6f6c 6f75 7222 290d 0a20 2020 2020  gColour")..     
+000267c0: 2020 2065 6469 745f 7379 6e63 5f73 7461     edit_sync_sta
+000267d0: 7475 732e 5365 7445 6469 7461 626c 6528  tus.SetEditable(
+000267e0: 4661 6c73 6529 0d0a 2020 2020 2020 2020  False)..        
+000267f0: 6368 6563 6b5f 636f 6e74 6163 7473 2e54  check_contacts.T
+00026800: 6f6f 6c54 6970 203d 2022 5570 6461 7465  oolTip = "Update
+00026810: 2070 726f 6669 6c65 2066 6965 6c64 7320   profile fields 
+00026820: 6f66 2065 7869 7374 696e 6720 636f 6e74  of existing cont
+00026830: 6163 7473 2066 726f 6d20 6f6e 6c69 6e65  acts from online
+00026840: 2064 6174 6122 0d0a 2020 2020 2020 2020   data"..        
+00026850: 6368 6563 6b5f 6f6c 6465 722e 546f 6f6c  check_older.Tool
+00026860: 5469 7020 3d20 2243 6865 636b 2061 6c6c  Tip = "Check all
+00026870: 206f 6c64 6572 2063 6861 7473 2069 6e20   older chats in 
+00026880: 6461 7461 6261 7365 2066 6f72 206d 6573  database for mes
+00026890: 7361 6765 7320 2220 5c0d 0a20 2020 2020  sages " \..     
+000268a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000268b0: 2020 2020 2020 2020 2022 746f 2073 796e           "to syn
+000268c0: 6320 6672 6f6d 206f 6e6c 696e 652c 206d  c from online, m
+000268d0: 6179 2074 616b 6520 6120 6c6f 6e67 2077  ay take a long w
+000268e0: 6869 6c65 220d 0a20 2020 2020 2020 2063  hile"..        c
+000268f0: 6865 636b 5f63 6f6e 7461 6374 732e 5661  heck_contacts.Va
+00026900: 6c75 6520 2020 3d20 6368 6563 6b5f 6f6c  lue   = check_ol
+00026910: 6465 722e 5661 6c75 6520 2020 3d20 5472  der.Value   = Tr
+00026920: 7565 0d0a 2020 2020 2020 2020 6368 6563  ue..        chec
+00026930: 6b5f 636f 6e74 6163 7473 2e45 6e61 626c  k_contacts.Enabl
+00026940: 6564 203d 2063 6865 636b 5f6f 6c64 6572  ed = check_older
+00026950: 2e45 6e61 626c 6564 203d 2046 616c 7365  .Enabled = False
+00026960: 0d0a 2020 2020 2020 2020 436f 6c6f 7572  ..        Colour
+00026970: 4d61 6e61 6765 722e 4d61 6e61 6765 2862  Manager.Manage(b
+00026980: 7574 746f 6e5f 7379 6e63 2c20 2020 2020  utton_sync,     
+00026990: 2022 4261 636b 6772 6f75 6e64 436f 6c6f   "BackgroundColo
+000269a0: 7572 222c 2022 4267 436f 6c6f 7572 2229  ur", "BgColour")
+000269b0: 0d0a 2020 2020 2020 2020 436f 6c6f 7572  ..        Colour
+000269c0: 4d61 6e61 6765 722e 4d61 6e61 6765 2862  Manager.Manage(b
+000269d0: 7574 746f 6e5f 7379 6e63 5f73 656c 2c20  utton_sync_sel, 
+000269e0: 2022 4261 636b 6772 6f75 6e64 436f 6c6f   "BackgroundColo
+000269f0: 7572 222c 2022 4267 436f 6c6f 7572 2229  ur", "BgColour")
+00026a00: 0d0a 2020 2020 2020 2020 436f 6c6f 7572  ..        Colour
+00026a10: 4d61 6e61 6765 722e 4d61 6e61 6765 2862  Manager.Manage(b
+00026a20: 7574 746f 6e5f 7379 6e63 5f73 746f 702c  utton_sync_stop,
+00026a30: 2022 4261 636b 6772 6f75 6e64 436f 6c6f   "BackgroundColo
+00026a40: 7572 222c 2022 4267 436f 6c6f 7572 2229  ur", "BgColour")
+00026a50: 0d0a 2020 2020 2020 2020 6275 7474 6f6e  ..        button
+00026a60: 5f73 796e 632e 4c61 6265 6c20 3d20 2253  _sync.Label = "S
+00026a70: 2679 6e63 6872 6f6e 697a 6520 6869 7374  &ynchronize hist
+00026a80: 6f72 7920 696e 206c 6f63 616c 2064 6174  ory in local dat
+00026a90: 6162 6173 6522 0d0a 2020 2020 2020 2020  abase"..        
+00026aa0: 6275 7474 6f6e 5f73 796e 632e 4e6f 7465  button_sync.Note
+00026ab0: 2020 3d20 2251 7565 7279 2053 6b79 7065    = "Query Skype
+00026ac0: 206f 6e6c 696e 6520 7365 7276 6963 6573   online services
+00026ad0: 2066 6f72 206e 6577 206d 6573 7361 6765   for new message
+00026ae0: 7320 616e 6420 7361 7665 2074 6865 6d20  s and save them 
+00026af0: 696e 206c 6f63 616c 2064 6174 6162 6173  in local databas
+00026b00: 652e 220d 0a20 2020 2020 2020 2062 7574  e."..        but
+00026b10: 746f 6e5f 7379 6e63 5f73 656c 2e4c 6162  ton_sync_sel.Lab
+00026b20: 656c 203d 2022 5379 6e63 6872 6f6e 697a  el = "Synchroniz
+00026b30: 6520 7365 6c65 6326 7465 6420 6368 6174  e selec&ted chat
+00026b40: 7322 0d0a 2020 2020 2020 2020 6275 7474  s"..        butt
+00026b50: 6f6e 5f73 796e 635f 7365 6c2e 4e6f 7465  on_sync_sel.Note
+00026b60: 2020 3d20 2253 656c 6563 7420 7370 6563    = "Select spec
+00026b70: 6966 6963 2063 6861 7473 2074 6f20 7570  ific chats to up
+00026b80: 6461 7465 2069 6e20 6c6f 6361 6c20 6461  date in local da
+00026b90: 7461 6261 7365 2e22 0d0a 2020 2020 2020  tabase."..      
+00026ba0: 2020 6275 7474 6f6e 5f73 796e 635f 7374    button_sync_st
+00026bb0: 6f70 2e4c 6162 656c 203d 2022 5374 6f70  op.Label = "Stop
+00026bc0: 2073 796e 6368 726f 6e69 7a69 6e67 220d   synchronizing".
+00026bd0: 0a20 2020 2020 2020 2062 7574 746f 6e5f  .        button_
+00026be0: 7379 6e63 5f73 746f 702e 4e6f 7465 203d  sync_stop.Note =
+00026bf0: 2022 4365 6173 6520 7175 6572 7969 6e67   "Cease querying
+00026c00: 2074 6865 206f 6e6c 696e 6520 7365 7276   the online serv
+00026c10: 6963 652e 220d 0a20 2020 2020 2020 2066  ice."..        f
+00026c20: 6f72 2063 2069 6e20 636f 6e74 726f 6c73  or c in controls
+00026c30: 2e67 6574 5f63 6f6e 7472 6f6c 7328 7061  .get_controls(pa
+00026c40: 6e65 6c32 293a 2063 2e44 6973 6162 6c65  nel2): c.Disable
+00026c50: 2829 0d0a 2020 2020 2020 2020 6966 206e  ()..        if n
+00026c60: 6f74 206c 6976 652e 736b 7079 3a0d 0a20  ot live.skpy:.. 
+00026c70: 2020 2020 2020 2020 2020 2065 6469 745f             edit_
+00026c80: 7374 6174 7573 2e56 616c 7565 203d 2022  status.Value = "
+00026c90: 4c6f 6769 6e20 756e 6176 6169 6c61 626c  Login unavailabl
+00026ca0: 653a 2053 6b50 7920 6d6f 6475 6c65 206e  e: SkPy module n
+00026cb0: 6f74 2069 6e73 7461 6c6c 6564 220d 0a20  ot installed".. 
+00026cc0: 2020 2020 2020 2020 2020 2062 7574 746f             butto
+00026cd0: 6e5f 6c6f 6769 6e2e 4469 7361 626c 6528  n_login.Disable(
+00026ce0: 290d 0a20 2020 2020 2020 2020 2020 2070  )..            p
+00026cf0: 6167 652e 4469 7361 626c 6528 290d 0a0d  age.Disable()...
+00026d00: 0a20 2020 2020 2020 2073 656c 662e 4269  .        self.Bi
+00026d10: 6e64 2877 782e 4556 545f 4255 5454 4f4e  nd(wx.EVT_BUTTON
+00026d20: 2c20 2020 2020 7365 6c66 2e6f 6e5f 6368  ,     self.on_ch
+00026d30: 616e 6765 5f6c 6976 655f 7573 6572 2c20  ange_live_user, 
+00026d40: 2062 7574 746f 6e5f 7573 6572 290d 0a20   button_user).. 
+00026d50: 2020 2020 2020 2073 656c 662e 4269 6e64         self.Bind
+00026d60: 2877 782e 4556 545f 5445 5854 2c20 2020  (wx.EVT_TEXT,   
+00026d70: 2020 2020 7365 6c66 2e6f 6e5f 6368 616e      self.on_chan
+00026d80: 6765 5f63 7472 6c5f 6c6f 6769 6e2c 2065  ge_ctrl_login, e
+00026d90: 6469 745f 7077 290d 0a20 2020 2020 2020  dit_pw)..       
+00026da0: 2073 656c 662e 4269 6e64 2877 782e 4556   self.Bind(wx.EV
+00026db0: 545f 5445 5854 5f45 4e54 4552 2c20 7365  T_TEXT_ENTER, se
+00026dc0: 6c66 2e6f 6e5f 6c69 7665 5f6c 6f67 696e  lf.on_live_login
+00026dd0: 2c20 2020 2020 2020 2065 6469 745f 7077  ,        edit_pw
+00026de0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00026df0: 4269 6e64 2877 782e 4556 545f 4348 4543  Bind(wx.EVT_CHEC
+00026e00: 4b42 4f58 2c20 2020 7365 6c66 2e6f 6e5f  KBOX,   self.on_
+00026e10: 6368 616e 6765 5f63 7472 6c5f 6c6f 6769  change_ctrl_logi
+00026e20: 6e2c 2063 6865 636b 5f73 746f 7265 290d  n, check_store).
+00026e30: 0a20 2020 2020 2020 2073 656c 662e 4269  .        self.Bi
+00026e40: 6e64 2877 782e 4556 545f 4348 4543 4b42  nd(wx.EVT_CHECKB
+00026e50: 4f58 2c20 2020 7365 6c66 2e6f 6e5f 6368  OX,   self.on_ch
+00026e60: 616e 6765 5f63 7472 6c5f 6c6f 6769 6e2c  ange_ctrl_login,
+00026e70: 2063 6865 636b 5f6c 6f67 696e 290d 0a20   check_login).. 
 00026e80: 2020 2020 2020 2073 656c 662e 4269 6e64         self.Bind
-00026e90: 2877 782e 4556 545f 4255 5454 4f4e 2c20  (wx.EVT_BUTTON, 
-00026ea0: 2020 2020 7365 6c66 2e6f 6e5f 6c69 7665      self.on_live
-00026eb0: 5f73 796e 635f 7374 6f70 2c20 2020 2062  _sync_stop,    b
-00026ec0: 7574 746f 6e5f 7379 6e63 5f73 746f 7029  utton_sync_stop)
-00026ed0: 0d0a 2020 2020 2020 2020 7365 6c66 2e42  ..        self.B
-00026ee0: 696e 6428 7778 2e45 5654 5f4c 4953 545f  ind(wx.EVT_LIST_
-00026ef0: 4954 454d 5f41 4354 4956 4154 4544 2c20  ITEM_ACTIVATED, 
-00026f00: 7365 6c66 2e6f 6e5f 6368 616e 6765 5f6c  self.on_change_l
-00026f10: 6973 745f 6368 6174 735f 7379 6e63 2c20  ist_chats_sync, 
-00026f20: 6c69 7374 5f63 6861 7473 290d 0a20 2020  list_chats)..   
-00026f30: 2020 2020 206c 6162 656c 5f69 6e66 6f2e       label_info.
-00026f40: 4269 6e64 2877 782e 6874 6d6c 2e45 5654  Bind(wx.html.EVT
-00026f50: 5f48 544d 4c5f 4c49 4e4b 5f43 4c49 434b  _HTML_LINK_CLICK
-00026f60: 4544 2c20 2020 2020 2020 2020 2073 656c  ED,          sel
-00026f70: 662e 6f6e 5f63 6c69 636b 5f68 746d 6c5f  f.on_click_html_
-00026f80: 6c69 6e6b 290d 0a20 2020 2020 2020 206c  link)..        l
-00026f90: 6162 656c 5f69 6e66 6f2e 4269 6e64 2877  abel_info.Bind(w
-00026fa0: 782e 4556 545f 5249 4748 545f 5550 2c20  x.EVT_RIGHT_UP, 
-00026fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026fc0: 2020 2020 2020 2073 656c 662e 6f6e 5f72         self.on_r
-00026fd0: 6967 6874 636c 6963 6b5f 6874 6d6c 290d  ightclick_html).
-00026fe0: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
-00026ff0: 6564 6974 5f75 7365 7220 2020 2020 2020  edit_user       
-00027000: 2020 2020 3d20 6564 6974 5f75 7365 720d      = edit_user.
-00027010: 0a20 2020 2020 2020 2073 656c 662e 6275  .        self.bu
-00027020: 7474 6f6e 5f75 7365 7220 2020 2020 2020  tton_user       
-00027030: 2020 3d20 6275 7474 6f6e 5f75 7365 720d    = button_user.
-00027040: 0a20 2020 2020 2020 2073 656c 662e 6564  .        self.ed
-00027050: 6974 5f70 7720 2020 2020 2020 2020 2020  it_pw           
-00027060: 2020 3d20 6564 6974 5f70 770d 0a20 2020    = edit_pw..   
-00027070: 2020 2020 2073 656c 662e 6368 6563 6b5f       self.check_
-00027080: 6c6f 6769 6e5f 7374 6f72 6520 2020 3d20  login_store   = 
-00027090: 6368 6563 6b5f 7374 6f72 650d 0a20 2020  check_store..   
-000270a0: 2020 2020 2073 656c 662e 6368 6563 6b5f       self.check_
-000270b0: 6c6f 6769 6e5f 6175 746f 2020 2020 3d20  login_auto    = 
-000270c0: 6368 6563 6b5f 6c6f 6769 6e0d 0a20 2020  check_login..   
-000270d0: 2020 2020 2073 656c 662e 6368 6563 6b5f       self.check_
-000270e0: 6c6f 6769 6e5f 7379 6e63 2020 2020 3d20  login_sync    = 
-000270f0: 6368 6563 6b5f 7379 6e63 0d0a 2020 2020  check_sync..    
-00027100: 2020 2020 7365 6c66 2e65 6469 745f 6c6f      self.edit_lo
-00027110: 6769 6e5f 7374 6174 7573 2020 203d 2065  gin_status   = e
-00027120: 6469 745f 7374 6174 7573 0d0a 2020 2020  dit_status..    
-00027130: 2020 2020 7365 6c66 2e62 7574 746f 6e5f      self.button_
-00027140: 6c6f 6769 6e20 2020 2020 2020 203d 2062  login        = b
-00027150: 7574 746f 6e5f 6c6f 6769 6e0d 0a20 2020  utton_login..   
-00027160: 2020 2020 2073 656c 662e 6c61 6265 6c5f       self.label_
-00027170: 6c6f 6769 6e5f 6661 696c 2020 2020 3d20  login_fail    = 
-00027180: 6c61 6265 6c5f 696e 666f 0d0a 2020 2020  label_info..    
-00027190: 2020 2020 7365 6c66 2e6c 6973 745f 6368      self.list_ch
-000271a0: 6174 735f 7379 6e63 2020 2020 203d 206c  ats_sync     = l
-000271b0: 6973 745f 6368 6174 730d 0a20 2020 2020  ist_chats..     
-000271c0: 2020 2073 656c 662e 6761 7567 655f 7379     self.gauge_sy
-000271d0: 6e63 2020 2020 2020 2020 2020 3d20 6761  nc          = ga
-000271e0: 7567 650d 0a20 2020 2020 2020 2073 656c  uge..        sel
-000271f0: 662e 6c61 6265 6c5f 7379 6e63 5f70 726f  f.label_sync_pro
-00027200: 6772 6573 7320 3d20 6c61 6265 6c5f 7072  gress = label_pr
-00027210: 6f67 7265 7373 0d0a 2020 2020 2020 2020  ogress..        
-00027220: 7365 6c66 2e65 6469 745f 7379 6e63 5f73  self.edit_sync_s
-00027230: 7461 7475 7320 2020 203d 2065 6469 745f  tatus    = edit_
-00027240: 7379 6e63 5f73 7461 7475 730d 0a20 2020  sync_status..   
-00027250: 2020 2020 2073 656c 662e 6368 6563 6b5f       self.check_
-00027260: 7379 6e63 5f63 6f6e 7461 6374 7320 3d20  sync_contacts = 
-00027270: 6368 6563 6b5f 636f 6e74 6163 7473 0d0a  check_contacts..
-00027280: 2020 2020 2020 2020 7365 6c66 2e63 6865          self.che
-00027290: 636b 5f73 796e 635f 6f6c 6465 7220 2020  ck_sync_older   
-000272a0: 203d 2063 6865 636b 5f6f 6c64 6572 0d0a   = check_older..
-000272b0: 2020 2020 2020 2020 7365 6c66 2e62 7574          self.but
-000272c0: 746f 6e5f 7379 6e63 2020 2020 2020 2020  ton_sync        
-000272d0: 203d 2062 7574 746f 6e5f 7379 6e63 0d0a   = button_sync..
-000272e0: 2020 2020 2020 2020 7365 6c66 2e62 7574          self.but
-000272f0: 746f 6e5f 7379 6e63 5f73 656c 2020 2020  ton_sync_sel    
-00027300: 203d 2062 7574 746f 6e5f 7379 6e63 5f73   = button_sync_s
-00027310: 656c 0d0a 2020 2020 2020 2020 7365 6c66  el..        self
-00027320: 2e62 7574 746f 6e5f 7379 6e63 5f73 746f  .button_sync_sto
-00027330: 7020 2020 203d 2062 7574 746f 6e5f 7379  p    = button_sy
-00027340: 6e63 5f73 746f 700d 0a0d 0a20 2020 2020  nc_stop....     
-00027350: 2020 2073 697a 6572 203d 2070 6167 652e     sizer = page.
-00027360: 5369 7a65 7220 3d20 7778 2e42 6f78 5369  Sizer = wx.BoxSi
-00027370: 7a65 7228 7778 2e48 4f52 495a 4f4e 5441  zer(wx.HORIZONTA
-00027380: 4c29 0d0a 2020 2020 2020 2020 7369 7a65  L)..        size
-00027390: 7231 203d 2070 616e 656c 312e 5369 7a65  r1 = panel1.Size
-000273a0: 7220 3d20 7778 2e42 6f78 5369 7a65 7228  r = wx.BoxSizer(
-000273b0: 7778 2e56 4552 5449 4341 4c29 0d0a 2020  wx.VERTICAL)..  
-000273c0: 2020 2020 2020 7369 7a65 7232 203d 2070        sizer2 = p
-000273d0: 616e 656c 322e 5369 7a65 7220 3d20 7778  anel2.Sizer = wx
-000273e0: 2e42 6f78 5369 7a65 7228 7778 2e56 4552  .BoxSizer(wx.VER
-000273f0: 5449 4341 4c29 0d0a 2020 2020 2020 2020  TICAL)..        
-00027400: 7369 7a65 725f 6c6f 6769 6e20 3d20 7778  sizer_login = wx
-00027410: 2e46 6c65 7847 7269 6453 697a 6572 2863  .FlexGridSizer(c
-00027420: 6f6c 733d 322c 2076 6761 703d 302c 2068  ols=2, vgap=0, h
-00027430: 6761 703d 3130 290d 0a20 2020 2020 2020  gap=10)..       
-00027440: 2073 697a 6572 5f6c 6f67 696e 2e41 6464   sizer_login.Add
-00027450: 4772 6f77 6162 6c65 436f 6c28 312c 2031  GrowableCol(1, 1
-00027460: 290d 0a20 2020 2020 2020 2073 697a 6572  )..        sizer
-00027470: 5f75 7365 7220 203d 2077 782e 426f 7853  _user  = wx.BoxS
-00027480: 697a 6572 2877 782e 484f 5249 5a4f 4e54  izer(wx.HORIZONT
-00027490: 414c 290d 0a20 2020 2020 2020 2073 697a  AL)..        siz
-000274a0: 6572 5f73 796e 6331 203d 2070 616e 656c  er_sync1 = panel
-000274b0: 5f73 796e 6331 2e53 697a 6572 203d 2077  _sync1.Sizer = w
-000274c0: 782e 426f 7853 697a 6572 2877 782e 5645  x.BoxSizer(wx.VE
-000274d0: 5254 4943 414c 290d 0a20 2020 2020 2020  RTICAL)..       
-000274e0: 2073 697a 6572 5f73 796e 6332 203d 2070   sizer_sync2 = p
-000274f0: 616e 656c 5f73 796e 6332 2e53 697a 6572  anel_sync2.Sizer
-00027500: 203d 2077 782e 426f 7853 697a 6572 2877   = wx.BoxSizer(w
-00027510: 782e 5645 5254 4943 414c 290d 0a0d 0a20  x.VERTICAL).... 
-00027520: 2020 2020 2020 2073 697a 6572 5f75 7365         sizer_use
-00027530: 722e 4164 6428 6564 6974 5f75 7365 722c  r.Add(edit_user,
-00027540: 2020 2020 666c 6167 3d77 782e 4752 4f57      flag=wx.GROW
-00027550: 2c20 7072 6f70 6f72 7469 6f6e 3d31 290d  , proportion=1).
-00027560: 0a20 2020 2020 2020 2073 697a 6572 5f75  .        sizer_u
-00027570: 7365 722e 4164 6428 6275 7474 6f6e 5f75  ser.Add(button_u
-00027580: 7365 722c 2020 626f 7264 6572 3d31 302c  ser,  border=10,
-00027590: 2066 6c61 673d 7778 2e4c 4546 5429 0d0a   flag=wx.LEFT)..
-000275a0: 0d0a 2020 2020 2020 2020 7369 7a65 725f  ..        sizer_
-000275b0: 6c6f 6769 6e2e 4164 6428 6c61 6265 6c5f  login.Add(label_
-000275c0: 7573 6572 2c20 2062 6f72 6465 723d 352c  user,  border=5,
-000275d0: 2066 6c61 673d 7778 2e41 4c4c 290d 0a20   flag=wx.ALL).. 
-000275e0: 2020 2020 2020 2073 697a 6572 5f6c 6f67         sizer_log
-000275f0: 696e 2e41 6464 2873 697a 6572 5f75 7365  in.Add(sizer_use
-00027600: 722c 2020 626f 7264 6572 3d35 2c20 666c  r,  border=5, fl
-00027610: 6167 3d77 782e 414c 4c20 7c20 7778 2e47  ag=wx.ALL | wx.G
-00027620: 524f 5729 0d0a 2020 2020 2020 2020 7369  ROW)..        si
-00027630: 7a65 725f 6c6f 6769 6e2e 4164 6428 6c61  zer_login.Add(la
-00027640: 6265 6c5f 7077 2c20 2020 2062 6f72 6465  bel_pw,    borde
-00027650: 723d 352c 2066 6c61 673d 7778 2e41 4c4c  r=5, flag=wx.ALL
-00027660: 290d 0a20 2020 2020 2020 2073 697a 6572  )..        sizer
-00027670: 5f6c 6f67 696e 2e41 6464 2865 6469 745f  _login.Add(edit_
-00027680: 7077 2c20 2020 2020 626f 7264 6572 3d35  pw,     border=5
-00027690: 2c20 666c 6167 3d77 782e 414c 4c20 7c20  , flag=wx.ALL | 
-000276a0: 7778 2e47 524f 5729 0d0a 2020 2020 2020  wx.GROW)..      
-000276b0: 2020 7369 7a65 725f 6c6f 6769 6e2e 4164    sizer_login.Ad
-000276c0: 6453 7061 6365 7228 3529 0d0a 2020 2020  dSpacer(5)..    
-000276d0: 2020 2020 7369 7a65 725f 6c6f 6769 6e2e      sizer_login.
-000276e0: 4164 6428 6368 6563 6b5f 7374 6f72 652c  Add(check_store,
-000276f0: 2062 6f72 6465 723d 352c 2066 6c61 673d   border=5, flag=
-00027700: 7778 2e41 4c4c 207c 2077 782e 4752 4f57  wx.ALL | wx.GROW
-00027710: 290d 0a20 2020 2020 2020 2073 697a 6572  )..        sizer
-00027720: 5f6c 6f67 696e 2e41 6464 5370 6163 6572  _login.AddSpacer
-00027730: 2835 290d 0a20 2020 2020 2020 2073 697a  (5)..        siz
-00027740: 6572 5f6c 6f67 696e 2e41 6464 2863 6865  er_login.Add(che
-00027750: 636b 5f6c 6f67 696e 2c20 626f 7264 6572  ck_login, border
-00027760: 3d35 2c20 666c 6167 3d77 782e 414c 4c20  =5, flag=wx.ALL 
-00027770: 7c20 7778 2e47 524f 5729 0d0a 2020 2020  | wx.GROW)..    
-00027780: 2020 2020 7369 7a65 725f 6c6f 6769 6e2e      sizer_login.
-00027790: 4164 6453 7061 6365 7228 3529 0d0a 2020  AddSpacer(5)..  
-000277a0: 2020 2020 2020 7369 7a65 725f 6c6f 6769        sizer_logi
-000277b0: 6e2e 4164 6428 6368 6563 6b5f 7379 6e63  n.Add(check_sync
-000277c0: 2c20 2062 6f72 6465 723d 352c 2066 6c61  ,  border=5, fla
-000277d0: 673d 7778 2e41 4c4c 207c 2077 782e 4752  g=wx.ALL | wx.GR
-000277e0: 4f57 290d 0a0d 0a20 2020 2020 2020 2073  OW)....        s
-000277f0: 697a 6572 312e 4164 6428 6c61 6265 6c5f  izer1.Add(label_
-00027800: 6c6f 6769 6e2c 2020 626f 7264 6572 3d35  login,  border=5
-00027810: 2c20 2066 6c61 673d 7778 2e41 4c4c 290d  ,  flag=wx.ALL).
-00027820: 0a20 2020 2020 2020 2073 697a 6572 312e  .        sizer1.
-00027830: 4164 6428 7369 7a65 725f 6c6f 6769 6e2c  Add(sizer_login,
-00027840: 2020 626f 7264 6572 3d32 302c 2066 6c61    border=20, fla
-00027850: 673d 7778 2e54 4f50 207c 2077 782e 4752  g=wx.TOP | wx.GR
-00027860: 4f57 290d 0a20 2020 2020 2020 2073 697a  OW)..        siz
-00027870: 6572 312e 4164 6428 6564 6974 5f73 7461  er1.Add(edit_sta
-00027880: 7475 732c 2020 626f 7264 6572 3d31 302c  tus,  border=10,
-00027890: 2066 6c61 673d 7778 2e54 4f50 207c 2077   flag=wx.TOP | w
-000278a0: 782e 4c45 4654 207c 2077 782e 5249 4748  x.LEFT | wx.RIGH
-000278b0: 5420 7c20 7778 2e47 524f 5729 0d0a 2020  T | wx.GROW)..  
-000278c0: 2020 2020 2020 7369 7a65 7231 2e41 6464        sizer1.Add
-000278d0: 2862 7574 746f 6e5f 6c6f 6769 6e2c 2062  (button_login, b
-000278e0: 6f72 6465 723d 352c 2020 666c 6167 3d77  order=5,  flag=w
-000278f0: 782e 414c 4c20 7c20 7778 2e47 524f 5729  x.ALL | wx.GROW)
-00027900: 0d0a 2020 2020 2020 2020 7369 7a65 7231  ..        sizer1
-00027910: 2e41 6464 286c 6162 656c 5f69 6e66 6f2c  .Add(label_info,
-00027920: 2020 2062 6f72 6465 723d 3135 2c20 666c     border=15, fl
-00027930: 6167 3d77 782e 414c 4c20 7c20 7778 2e47  ag=wx.ALL | wx.G
-00027940: 524f 572c 2070 726f 706f 7274 696f 6e3d  ROW, proportion=
-00027950: 3129 0d0a 0d0a 2020 2020 2020 2020 7369  1)....        si
-00027960: 7a65 7232 2e41 6464 286c 6162 656c 5f73  zer2.Add(label_s
-00027970: 796e 632c 2062 6f72 6465 723d 352c 2066  ync, border=5, f
-00027980: 6c61 673d 7778 2e41 4c4c 207c 2077 782e  lag=wx.ALL | wx.
-00027990: 4752 4f57 290d 0a0d 0a20 2020 2020 2020  GROW)....       
-000279a0: 2073 697a 6572 5f73 796e 6331 2e41 6464   sizer_sync1.Add
-000279b0: 286c 6973 745f 6368 6174 732c 2070 726f  (list_chats, pro
-000279c0: 706f 7274 696f 6e3d 312c 2062 6f72 6465  portion=1, borde
-000279d0: 723d 352c 2066 6c61 673d 7778 2e41 4c4c  r=5, flag=wx.ALL
-000279e0: 207c 2077 782e 4752 4f57 290d 0a20 2020   | wx.GROW)..   
-000279f0: 2020 2020 2073 697a 6572 5f73 796e 6332       sizer_sync2
-00027a00: 2e41 6464 2867 6175 6765 2c20 626f 7264  .Add(gauge, bord
-00027a10: 6572 3d35 2c20 666c 6167 3d77 782e 414c  er=5, flag=wx.AL
-00027a20: 4c20 7c20 7778 2e41 4c49 474e 5f43 454e  L | wx.ALIGN_CEN
-00027a30: 5445 525f 484f 5249 5a4f 4e54 414c 290d  TER_HORIZONTAL).
-00027a40: 0a20 2020 2020 2020 2073 697a 6572 5f73  .        sizer_s
-00027a50: 796e 6332 2e41 6464 286c 6162 656c 5f70  ync2.Add(label_p
-00027a60: 726f 6772 6573 732c 2062 6f72 6465 723d  rogress, border=
-00027a70: 352c 2066 6c61 673d 7778 2e41 4c4c 207c  5, flag=wx.ALL |
-00027a80: 2077 782e 414c 4947 4e5f 4345 4e54 4552   wx.ALIGN_CENTER
-00027a90: 5f48 4f52 495a 4f4e 5441 4c29 0d0a 2020  _HORIZONTAL)..  
-00027aa0: 2020 2020 2020 7369 7a65 725f 7379 6e63        sizer_sync
-00027ab0: 322e 4164 6428 6564 6974 5f73 796e 635f  2.Add(edit_sync_
-00027ac0: 7374 6174 7573 2c20 7072 6f70 6f72 7469  status, proporti
-00027ad0: 6f6e 3d31 2c20 626f 7264 6572 3d35 2c20  on=1, border=5, 
-00027ae0: 666c 6167 3d77 782e 414c 4c20 7c20 7778  flag=wx.ALL | wx
-00027af0: 2e47 524f 5729 0d0a 2020 2020 2020 2020  .GROW)..        
-00027b00: 7369 7a65 725f 7379 6e63 322e 4164 6428  sizer_sync2.Add(
-00027b10: 6368 6563 6b5f 636f 6e74 6163 7473 2c20  check_contacts, 
-00027b20: 626f 7264 6572 3d35 2c20 666c 6167 3d77  border=5, flag=w
-00027b30: 782e 414c 4c20 7c20 7778 2e47 524f 5729  x.ALL | wx.GROW)
-00027b40: 0d0a 2020 2020 2020 2020 7369 7a65 725f  ..        sizer_
-00027b50: 7379 6e63 322e 4164 6428 6368 6563 6b5f  sync2.Add(check_
-00027b60: 6f6c 6465 722c 2020 2020 626f 7264 6572  older,    border
-00027b70: 3d35 2c20 666c 6167 3d77 782e 414c 4c20  =5, flag=wx.ALL 
-00027b80: 7c20 7778 2e47 524f 5729 0d0a 2020 2020  | wx.GROW)..    
-00027b90: 2020 2020 7369 7a65 725f 7379 6e63 322e      sizer_sync2.
-00027ba0: 4164 6428 6275 7474 6f6e 5f73 796e 632c  Add(button_sync,
-00027bb0: 2062 6f72 6465 723d 352c 2066 6c61 673d   border=5, flag=
-00027bc0: 7778 2e41 4c4c 207c 2077 782e 4752 4f57  wx.ALL | wx.GROW
-00027bd0: 290d 0a20 2020 2020 2020 2073 697a 6572  )..        sizer
-00027be0: 5f73 796e 6332 2e41 6464 2862 7574 746f  _sync2.Add(butto
-00027bf0: 6e5f 7379 6e63 5f73 656c 2c20 626f 7264  n_sync_sel, bord
-00027c00: 6572 3d35 2c20 666c 6167 3d77 782e 414c  er=5, flag=wx.AL
-00027c10: 4c20 7c20 7778 2e47 524f 5729 0d0a 2020  L | wx.GROW)..  
-00027c20: 2020 2020 2020 7369 7a65 725f 7379 6e63        sizer_sync
-00027c30: 322e 4164 6428 6275 7474 6f6e 5f73 796e  2.Add(button_syn
-00027c40: 635f 7374 6f70 2c20 626f 7264 6572 3d35  c_stop, border=5
-00027c50: 2c20 666c 6167 3d77 782e 414c 4c20 7c20  , flag=wx.ALL | 
-00027c60: 7778 2e47 524f 5729 0d0a 0d0a 2020 2020  wx.GROW)....    
-00027c70: 2020 2020 7369 7a65 7232 2e41 6464 2873      sizer2.Add(s
-00027c80: 706c 6974 7465 725f 7379 6e63 2c20 7072  plitter_sync, pr
-00027c90: 6f70 6f72 7469 6f6e 3d31 2c20 666c 6167  oportion=1, flag
-00027ca0: 3d77 782e 4752 4f57 290d 0a0d 0a20 2020  =wx.GROW)....   
-00027cb0: 2020 2020 2073 697a 6572 2e41 6464 2873       sizer.Add(s
-00027cc0: 706c 6974 7465 722c 2062 6f72 6465 723d  plitter, border=
-00027cd0: 352c 2070 726f 706f 7274 696f 6e3d 312c  5, proportion=1,
-00027ce0: 2066 6c61 673d 7778 2e41 4c4c 207c 2077   flag=wx.ALL | w
-00027cf0: 782e 4752 4f57 290d 0a20 2020 2020 2020  x.GROW)..       
-00027d00: 2073 706c 6974 7465 722e 5370 6c69 7456   splitter.SplitV
-00027d10: 6572 7469 6361 6c6c 7928 7061 6e65 6c31  ertically(panel1
-00027d20: 2c20 7061 6e65 6c32 290d 0a20 2020 2020  , panel2)..     
-00027d30: 2020 2070 6f73 203d 2073 656c 662e 5369     pos = self.Si
-00027d40: 7a65 5b31 5d20 2f2f 2034 0d0a 2020 2020  ze[1] // 4..    
-00027d50: 2020 2020 7370 6c69 7474 6572 5f73 796e      splitter_syn
-00027d60: 632e 5370 6c69 7448 6f72 697a 6f6e 7461  c.SplitHorizonta
-00027d70: 6c6c 7928 7061 6e65 6c5f 7379 6e63 312c  lly(panel_sync1,
-00027d80: 2070 616e 656c 5f73 796e 6332 2c20 7361   panel_sync2, sa
-00027d90: 7368 506f 7369 7469 6f6e 3d70 6f73 290d  shPosition=pos).
-00027da0: 0a0d 0a0d 0a20 2020 2064 6566 206f 6e5f  .....    def on_
-00027db0: 7379 735f 636f 6c6f 7572 5f63 6861 6e67  sys_colour_chang
-00027dc0: 6528 7365 6c66 2c20 6576 656e 7429 3a0d  e(self, event):.
-00027dd0: 0a20 2020 2020 2020 2022 2222 4861 6e64  .        """Hand
-00027de0: 6c65 7220 666f 7220 7379 7374 656d 2063  ler for system c
-00027df0: 6f6c 6f75 7220 6368 616e 6765 2c20 7265  olour change, re
-00027e00: 6672 6573 6865 7320 636f 6e74 656e 742e  freshes content.
-00027e10: 2222 220d 0a20 2020 2020 2020 2065 7665  """..        eve
-00027e20: 6e74 2e53 6b69 7028 290d 0a20 2020 2020  nt.Skip()..     
-00027e30: 2020 2064 6566 2064 6f72 6566 7265 7368     def dorefresh
-00027e40: 2829 3a0d 0a20 2020 2020 2020 2020 2020  ():..           
-00027e50: 2069 6620 6e6f 7420 7365 6c66 3a20 7265   if not self: re
-00027e60: 7475 726e 0d0a 0d0a 2020 2020 2020 2020  turn....        
-00027e70: 2020 2020 7365 6c66 2e6c 6162 656c 5f68      self.label_h
-00027e80: 746d 6c2e 5365 7450 6167 6528 7374 6570  tml.SetPage(step
-00027e90: 2e54 656d 706c 6174 6528 7465 6d70 6c61  .Template(templa
-00027ea0: 7465 732e 5345 4152 4348 5f48 454c 505f  tes.SEARCH_HELP_
-00027eb0: 5348 4f52 5429 2e65 7870 616e 6428 2929  SHORT).expand())
-00027ec0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00027ed0: 6c66 2e6c 6162 656c 5f68 746d 6c2e 4261  lf.label_html.Ba
-00027ee0: 636b 6772 6f75 6e64 436f 6c6f 7572 203d  ckgroundColour =
-00027ef0: 2043 6f6c 6f75 724d 616e 6167 6572 2e47   ColourManager.G
-00027f00: 6574 436f 6c6f 7572 2877 782e 5359 535f  etColour(wx.SYS_
-00027f10: 434f 4c4f 5552 5f42 544e 4641 4345 290d  COLOUR_BTNFACE).
-00027f20: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00027f30: 662e 6c61 6265 6c5f 6874 6d6c 2e46 6f72  f.label_html.For
-00027f40: 6567 726f 756e 6443 6f6c 6f75 7220 3d20  egroundColour = 
-00027f50: 436f 6c6f 7572 4d61 6e61 6765 722e 4765  ColourManager.Ge
-00027f60: 7443 6f6c 6f75 7228 7778 2e53 5953 5f43  tColour(wx.SYS_C
-00027f70: 4f4c 4f55 525f 4254 4e54 4558 5429 0d0a  OLOUR_BTNTEXT)..
-00027f80: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00027f90: 2e6c 6162 656c 5f6c 6f67 696e 5f66 6169  .label_login_fai
-00027fa0: 6c2e 5365 7450 6167 6528 7374 6570 2e54  l.SetPage(step.T
-00027fb0: 656d 706c 6174 6528 7465 6d70 6c61 7465  emplate(template
-00027fc0: 732e 4c4f 4749 4e5f 4641 494c 5f49 4e46  s.LOGIN_FAIL_INF
-00027fd0: 4f29 2e65 7870 616e 6428 2929 0d0a 2020  O).expand())..  
-00027fe0: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
-00027ff0: 7420 3d20 7374 6570 2e54 656d 706c 6174  t = step.Templat
-00028000: 6528 7465 6d70 6c61 7465 732e 5345 4152  e(templates.SEAR
-00028010: 4348 5f57 454c 434f 4d45 5f48 544d 4c29  CH_WELCOME_HTML)
-00028020: 2e65 7870 616e 6428 290d 0a20 2020 2020  .expand()..     
-00028030: 2020 2020 2020 2073 656c 662e 6874 6d6c         self.html
-00028040: 5f73 6561 7263 6861 6c6c 2e53 6574 4465  _searchall.SetDe
-00028050: 6661 756c 7450 6167 6528 6465 6661 756c  faultPage(defaul
-00028060: 7429 0d0a 2020 2020 2020 2020 2020 2020  t)..            
-00028070: 7365 6c66 2e6c 6f61 645f 7461 626c 6573  self.load_tables
-00028080: 5f64 6174 6128 290d 0a20 2020 2020 2020  _data()..       
-00028090: 2020 2020 2073 656c 662e 6c69 7374 5f74       self.list_t
-000280a0: 696d 656c 696e 652e 5265 6672 6573 6849  imeline.RefreshI
-000280b0: 7465 6d73 2829 0d0a 2020 2020 2020 2020  tems()..        
-000280c0: 2020 2020 7365 6c66 2e70 6f70 756c 6174      self.populat
-000280d0: 655f 6368 6174 5f73 7461 7469 7374 6963  e_chat_statistic
-000280e0: 7328 290d 0a20 2020 2020 2020 2020 2020  s()..           
-000280f0: 2075 7469 6c2e 7472 795f 6967 6e6f 7265   util.try_ignore
-00028100: 286c 616d 6264 613a 2073 656c 662e 6772  (lambda: self.gr
-00028110: 6964 5f74 6162 6c65 2e54 6162 6c65 2e43  id_table.Table.C
-00028120: 6c65 6172 4174 7472 7328 2929 0d0a 2020  learAttrs())..  
-00028130: 2020 2020 2020 2020 2020 7574 696c 2e74            util.t
-00028140: 7279 5f69 676e 6f72 6528 6c61 6d62 6461  ry_ignore(lambda
-00028150: 3a20 7365 6c66 2e67 7269 645f 7371 6c2e  : self.grid_sql.
-00028160: 5461 626c 652e 436c 6561 7241 7474 7273  Table.ClearAttrs
-00028170: 2829 290d 0a0d 0a20 2020 2020 2020 2020  ())....         
-00028180: 2020 2066 6f72 206c 7374 2069 6e20 2873     for lst in (s
-00028190: 656c 662e 6c69 7374 5f63 6861 7473 2c20  elf.list_chats, 
-000281a0: 7365 6c66 2e6c 6973 745f 636f 6e74 6163  self.list_contac
-000281b0: 7473 2c0d 0a20 2020 2020 2020 2020 2020  ts,..           
-000281c0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-000281d0: 662e 6c69 7374 5f63 6861 7473 5f73 796e  f.list_chats_syn
-000281e0: 632c 2073 656c 662e 6c69 7374 5f70 6172  c, self.list_par
-000281f0: 7469 6369 7061 6e74 7329 3a0d 0a20 2020  ticipants):..   
-00028200: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-00028210: 2069 2069 6e20 7261 6e67 6528 6c73 742e   i in range(lst.
-00028220: 4765 7449 7465 6d43 6f75 6e74 2829 293a  GetItemCount()):
-00028230: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00028240: 2020 2020 2020 6c73 742e 5365 7449 7465        lst.SetIte
-00028250: 6d54 6578 7443 6f6c 6f75 7228 692c 2020  mTextColour(i,  
-00028260: 2020 2020 206c 7374 2e46 6f72 6567 726f       lst.Foregro
-00028270: 756e 6443 6f6c 6f75 7229 0d0a 2020 2020  undColour)..    
-00028280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028290: 6c73 742e 5365 7449 7465 6d42 6163 6b67  lst.SetItemBackg
-000282a0: 726f 756e 6443 6f6c 6f75 7228 692c 206c  roundColour(i, l
-000282b0: 7374 2e42 6163 6b67 726f 756e 6443 6f6c  st.BackgroundCol
-000282c0: 6f75 7229 0d0a 2020 2020 2020 2020 2020  our)..          
-000282d0: 2020 7365 6c66 2e6c 6f61 645f 636f 6e74    self.load_cont
-000282e0: 6163 7428 7365 6c66 2e63 6f6e 7461 6374  act(self.contact
-000282f0: 290d 0a0d 0a20 2020 2020 2020 2077 782e  )....        wx.
-00028300: 4361 6c6c 4166 7465 7228 646f 7265 6672  CallAfter(dorefr
-00028310: 6573 6829 2023 2050 6f73 7470 6f6e 6520  esh) # Postpone 
-00028320: 746f 2061 6c6c 6f77 2063 6f6e 6620 7570  to allow conf up
-00028330: 6461 7465 0d0a 0d0a 0d0a 2020 2020 6465  date......    de
-00028340: 6620 7570 6461 7465 5f6c 6976 6569 6e66  f update_liveinf
-00028350: 6f28 7365 6c66 293a 0d0a 2020 2020 2020  o(self):..      
-00028360: 2020 2222 2252 6566 7265 7368 6573 2061    """Refreshes a
-00028370: 6363 6f75 6e74 2073 6574 7469 6e67 7320  ccount settings 
-00028380: 696e 206c 6f67 696e 2d70 6167 6520 6672  in login-page fr
-00028390: 6f6d 2063 6f6e 6669 6775 7261 7469 6f6e  om configuration
-000283a0: 2e22 2222 0d0a 2020 2020 2020 2020 6966  ."""..        if
-000283b0: 206e 6f74 2073 656c 663a 2072 6574 7572   not self: retur
-000283c0: 6e0d 0a20 2020 2020 2020 206f 7074 7320  n..        opts 
-000283d0: 3d20 636f 6e66 2e4c 6f67 696e 2e67 6574  = conf.Login.get
-000283e0: 2873 656c 662e 6462 2e66 696c 656e 616d  (self.db.filenam
-000283f0: 6529 206f 7220 7b7d 0d0a 2020 2020 2020  e) or {}..      
-00028400: 2020 7365 6c66 2e65 6469 745f 7573 6572    self.edit_user
-00028410: 2e56 616c 7565 203d 2073 656c 662e 6462  .Value = self.db
-00028420: 2e75 7365 726e 616d 6520 6966 2073 656c  .username if sel
-00028430: 662e 6462 2e75 7365 726e 616d 6520 656c  f.db.username el
-00028440: 7365 2022 220d 0a20 2020 2020 2020 2073  se ""..        s
-00028450: 656c 662e 6275 7474 6f6e 5f6c 6f67 696e  elf.button_login
-00028460: 2e4c 6162 656c 203d 2022 264c 6f67 2069  .Label = "&Log i
-00028470: 6e20 6173 2027 2573 2722 2025 2073 656c  n as '%s'" % sel
-00028480: 662e 6564 6974 5f75 7365 722e 5661 6c75  f.edit_user.Valu
-00028490: 650d 0a20 2020 2020 2020 2074 7279 3a20  e..        try: 
-000284a0: 7365 6c66 2e65 6469 745f 7077 2e43 6861  self.edit_pw.Cha
-000284b0: 6e67 6556 616c 7565 2875 7469 6c2e 6465  ngeValue(util.de
-000284c0: 6f62 6675 7363 6174 6528 6f70 7473 2e67  obfuscate(opts.g
-000284d0: 6574 2822 7061 7373 776f 7264 222c 2022  et("password", "
-000284e0: 2229 2929 0d0a 2020 2020 2020 2020 6578  ")))..        ex
-000284f0: 6365 7074 2045 7863 6570 7469 6f6e 2061  cept Exception a
-00028500: 7320 653a 206c 6f67 6765 722e 6572 726f  s e: logger.erro
-00028510: 7228 2245 7272 6f72 2064 6563 6f64 696e  r("Error decodin
-00028520: 6720 7374 6f72 6564 2070 6173 7377 6f72  g stored passwor
-00028530: 643a 2025 7322 2c20 7574 696c 2e66 6f72  d: %s", util.for
-00028540: 6d61 745f 6578 6328 6529 290d 0a20 2020  mat_exc(e))..   
-00028550: 2020 2020 2073 656c 662e 6368 6563 6b5f       self.check_
-00028560: 6c6f 6769 6e5f 7374 6f72 652e 5661 6c75  login_store.Valu
-00028570: 6520 3d20 6f70 7473 2e67 6574 2822 7374  e = opts.get("st
-00028580: 6f72 6522 2c20 4661 6c73 6529 0d0a 2020  ore", False)..  
-00028590: 2020 2020 2020 7365 6c66 2e63 6865 636b        self.check
-000285a0: 5f6c 6f67 696e 5f61 7574 6f2e 5661 6c75  _login_auto.Valu
-000285b0: 6520 203d 206f 7074 732e 6765 7428 2261  e  = opts.get("a
-000285c0: 7574 6f22 2c20 2046 616c 7365 2920 616e  uto",  False) an
-000285d0: 6420 7365 6c66 2e63 6865 636b 5f6c 6f67  d self.check_log
-000285e0: 696e 5f73 746f 7265 2e56 616c 7565 0d0a  in_store.Value..
-000285f0: 2020 2020 2020 2020 7365 6c66 2e63 6865          self.che
-00028600: 636b 5f6c 6f67 696e 5f73 796e 632e 5661  ck_login_sync.Va
-00028610: 6c75 6520 203d 206f 7074 732e 6765 7428  lue  = opts.get(
-00028620: 2273 796e 6322 2c20 2046 616c 7365 2920  "sync",  False) 
-00028630: 616e 6420 7365 6c66 2e63 6865 636b 5f6c  and self.check_l
-00028640: 6f67 696e 5f61 7574 6f20 2e56 616c 7565  ogin_auto .Value
-00028650: 0d0a 2020 2020 2020 2020 7365 6c66 2e63  ..        self.c
-00028660: 6865 636b 5f6c 6f67 696e 5f61 7574 6f2e  heck_login_auto.
-00028670: 456e 6162 6c65 2873 656c 662e 6368 6563  Enable(self.chec
-00028680: 6b5f 6c6f 6769 6e5f 7374 6f72 652e 5661  k_login_store.Va
-00028690: 6c75 6529 0d0a 2020 2020 2020 2020 7365  lue)..        se
-000286a0: 6c66 2e63 6865 636b 5f6c 6f67 696e 5f73  lf.check_login_s
-000286b0: 796e 632e 456e 6162 6c65 2873 656c 662e  ync.Enable(self.
-000286c0: 6368 6563 6b5f 6c6f 6769 6e5f 6175 746f  check_login_auto
-000286d0: 202e 5661 6c75 6529 0d0a 2020 2020 2020   .Value)..      
-000286e0: 2020 7365 6c66 2e63 6865 636b 5f73 796e    self.check_syn
-000286f0: 635f 636f 6e74 6163 7473 2e56 616c 7565  c_contacts.Value
-00028700: 203d 206f 7074 732e 6765 7428 2273 796e   = opts.get("syn
-00028710: 635f 636f 6e74 6163 7473 222c 2054 7275  c_contacts", Tru
-00028720: 6529 0d0a 2020 2020 2020 2020 7365 6c66  e)..        self
-00028730: 2e63 6865 636b 5f73 796e 635f 6f6c 6465  .check_sync_olde
-00028740: 722e 5661 6c75 6520 2020 203d 206f 7074  r.Value    = opt
-00028750: 732e 6765 7428 2273 796e 635f 6f6c 6465  s.get("sync_olde
-00028760: 7222 2c20 2020 2054 7275 6529 0d0a 2020  r",    True)..  
-00028770: 2020 2020 2020 6966 2073 656c 662e 6462        if self.db
-00028780: 2e6c 6976 652e 6973 5f6c 6f67 6765 645f  .live.is_logged_
-00028790: 696e 2829 2061 6e64 2073 656c 662e 6275  in() and self.bu
-000287a0: 7474 6f6e 5f6c 6f67 696e 2e45 6e61 626c  tton_login.Enabl
-000287b0: 6564 3a0d 0a20 2020 2020 2020 2020 2020  ed:..           
-000287c0: 2023 2050 726f 6261 626c 6520 6175 746f   # Probable auto
-000287d0: 2d6c 6f67 696e 2064 7572 696e 6720 4854  -login during HT
-000287e0: 4d4c 2065 7870 6f72 740d 0a20 2020 2020  ML export..     
-000287f0: 2020 2020 2020 2073 656c 662e 6564 6974         self.edit
-00028800: 5f6c 6f67 696e 5f73 7461 7475 732e 5661  _login_status.Va
-00028810: 6c75 6520 3d20 274c 6f67 6765 6420 696e  lue = 'Logged in
-00028820: 2074 6f20 536b 7970 6520 6173 2022 2573   to Skype as "%s
-00028830: 2227 2025 2073 656c 662e 6462 2e75 7365  "' % self.db.use
-00028840: 726e 616d 650d 0a20 2020 2020 2020 2020  rname..         
-00028850: 2020 2073 656c 662e 6275 7474 6f6e 5f6c     self.button_l
-00028860: 6f67 696e 2e44 6973 6162 6c65 2829 0d0a  ogin.Disable()..
-00028870: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00028880: 2e6c 6162 656c 5f6c 6f67 696e 5f66 6169  .label_login_fai
-00028890: 6c2e 4869 6465 2829 0d0a 2020 2020 2020  l.Hide()..      
-000288a0: 2020 2020 2020 666f 7220 6320 696e 2063        for c in c
-000288b0: 6f6e 7472 6f6c 732e 6765 745f 636f 6e74  ontrols.get_cont
-000288c0: 726f 6c73 2873 656c 662e 7061 6e65 6c5f  rols(self.panel_
-000288d0: 7379 6e63 293a 2063 2e45 6e61 626c 6528  sync): c.Enable(
-000288e0: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
-000288f0: 656c 662e 6275 7474 6f6e 5f73 796e 635f  elf.button_sync_
-00028900: 7374 6f70 2e44 6973 6162 6c65 2829 0d0a  stop.Disable()..
-00028910: 0d0a 0d0a 2020 2020 6465 6620 6f6e 5f63  ....    def on_c
-00028920: 6861 6e67 655f 6c69 7665 5f75 7365 7228  hange_live_user(
-00028930: 7365 6c66 2c20 6576 656e 7429 3a0d 0a20  self, event):.. 
-00028940: 2020 2020 2020 2022 2222 4861 6e64 6c65         """Handle
-00028950: 7220 666f 7220 636c 6963 6b69 6e67 2074  r for clicking t
-00028960: 6f20 6368 616e 6765 206c 6976 6520 6c6f  o change live lo
-00028970: 6769 6e20 6e61 6d65 2c20 6f70 656e 7320  gin name, opens 
-00028980: 696e 7075 7420 6469 616c 6f67 2e22 2222  input dialog."""
-00028990: 0d0a 2020 2020 2020 2020 6d73 6720 3d20  ..        msg = 
-000289a0: 2253 7065 6369 6679 2061 6e6f 7468 6572  "Specify another
-000289b0: 206c 6f67 696e 206e 616d 6520 666f 7220   login name for 
-000289c0: 536b 7970 6520 6f6e 6c69 6e65 2e5c 6e5c  Skype online.\n\
-000289d0: 6e22 205c 0d0a 2020 2020 2020 2020 2020  n" \..          
-000289e0: 2020 2020 2254 6869 7320 7368 6f75 6c64      "This should
-000289f0: 2062 6520 7468 6520 7573 6572 6e61 6d65   be the username
-00028a00: 2074 6861 7420 776f 726b 7320 666f 7220   that works for 
-00028a10: 4d69 6372 6f73 6f66 7420 4c69 7665 206c  Microsoft Live l
-00028a20: 6f67 696e 3a22 0d0a 2020 2020 2020 2020  ogin:"..        
-00028a30: 646c 6720 3d20 7778 2e54 6578 7445 6e74  dlg = wx.TextEnt
-00028a40: 7279 4469 616c 6f67 2873 656c 662c 206d  ryDialog(self, m
-00028a50: 7367 2c20 636f 6e66 2e54 6974 6c65 2c20  sg, conf.Title, 
-00028a60: 7661 6c75 653d 7365 6c66 2e64 622e 7573  value=self.db.us
-00028a70: 6572 6e61 6d65 206f 7220 2222 2c0d 0a20  ername or "",.. 
-00028a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028aa0: 7374 796c 653d 7778 2e4f 4b20 7c20 7778  style=wx.OK | wx
-00028ab0: 2e43 414e 4345 4c29 0d0a 2020 2020 2020  .CANCEL)..      
-00028ac0: 2020 646c 672e 4365 6e74 6572 4f6e 5061    dlg.CenterOnPa
-00028ad0: 7265 6e74 2829 0d0a 2020 2020 2020 2020  rent()..        
-00028ae0: 6966 2077 782e 4944 5f4f 4b20 213d 2064  if wx.ID_OK != d
-00028af0: 6c67 2e53 686f 774d 6f64 616c 2829 3a20  lg.ShowModal(): 
-00028b00: 7265 7475 726e 0d0a 0d0a 2020 2020 2020  return....      
-00028b10: 2020 7620 3d20 646c 672e 4765 7456 616c    v = dlg.GetVal
-00028b20: 7565 2829 2e73 7472 6970 2829 0d0a 2020  ue().strip()..  
-00028b30: 2020 2020 2020 6966 206e 6f74 2076 3a20        if not v: 
-00028b40: 7265 7475 726e 0d0a 0d0a 2020 2020 2020  return....      
-00028b50: 2020 6966 2076 203d 3d20 7365 6c66 2e64    if v == self.d
-00028b60: 622e 6964 2061 6e64 2076 2021 3d20 7365  b.id and v != se
-00028b70: 6c66 2e64 622e 7573 6572 6e61 6d65 3a20  lf.db.username: 
-00028b80: 7620 3d20 4e6f 6e65 0d0a 2020 2020 2020  v = None..      
-00028b90: 2020 7365 6c66 2e64 622e 7570 6461 7465    self.db.update
-00028ba0: 5f72 6f77 2822 6163 636f 756e 7473 222c  _row("accounts",
-00028bb0: 207b 226c 6976 6569 645f 6d65 6d62 6572   {"liveid_member
-00028bc0: 6e61 6d65 223a 2076 7d2c 2073 656c 662e  name": v}, self.
-00028bd0: 6462 2e61 6363 6f75 6e74 290d 0a20 2020  db.account)..   
-00028be0: 2020 2020 2073 656c 662e 6462 2e61 6363       self.db.acc
-00028bf0: 6f75 6e74 5b22 6c69 7665 6964 5f6d 656d  ount["liveid_mem
-00028c00: 6265 726e 616d 6522 5d20 3d20 760d 0a20  bername"] = v.. 
-00028c10: 2020 2020 2020 2073 656c 662e 6462 2e75         self.db.u
-00028c20: 7365 726e 616d 6520 3d20 7620 6f72 2073  sername = v or s
-00028c30: 656c 662e 6462 2e69 640d 0a20 2020 2020  elf.db.id..     
-00028c40: 2020 2073 656c 662e 6564 6974 5f75 7365     self.edit_use
-00028c50: 722e 5661 6c75 6520 3d20 7365 6c66 2e64  r.Value = self.d
-00028c60: 622e 7573 6572 6e61 6d65 0d0a 2020 2020  b.username..    
-00028c70: 2020 2020 7365 6c66 2e62 7574 746f 6e5f      self.button_
-00028c80: 6c6f 6769 6e2e 4c61 6265 6c20 3d20 2226  login.Label = "&
-00028c90: 4c6f 6720 696e 2061 7320 2725 7327 2220  Log in as '%s'" 
-00028ca0: 2520 7365 6c66 2e64 622e 7573 6572 6e61  % self.db.userna
-00028cb0: 6d65 0d0a 2020 2020 2020 2020 7365 6c66  me..        self
-00028cc0: 2e75 7064 6174 655f 6163 636f 756e 7469  .update_accounti
-00028cd0: 6e66 6f28 290d 0a0d 0a0d 0a20 2020 2064  nfo()......    d
-00028ce0: 6566 206f 6e5f 6368 616e 6765 5f63 7472  ef on_change_ctr
-00028cf0: 6c5f 6c6f 6769 6e28 7365 6c66 2c20 6576  l_login(self, ev
-00028d00: 656e 7429 3a0d 0a20 2020 2020 2020 2022  ent):..        "
-00028d10: 2222 4861 6e64 6c65 7220 666f 7220 6368  ""Handler for ch
-00028d20: 616e 6769 6e67 2061 206c 6f67 696e 2063  anging a login c
-00028d30: 6f6e 7472 6f6c 206c 696b 6520 7061 7373  ontrol like pass
-00028d40: 776f 7264 206f 7220 6368 6563 6b62 6f78  word or checkbox
-00028d50: 6573 2c20 7570 6461 7465 7320 636f 6e66  es, updates conf
-00028d60: 2e22 2222 0d0a 2020 2020 2020 2020 6374  ."""..        ct
-00028d70: 726c 2c20 7661 6c75 6520 3d20 6576 656e  rl, value = even
-00028d80: 742e 4576 656e 744f 626a 6563 742c 2065  t.EventObject, e
-00028d90: 7665 6e74 2e45 7665 6e74 4f62 6a65 6374  vent.EventObject
-00028da0: 2e56 616c 7565 0d0a 2020 2020 2020 2020  .Value..        
-00028db0: 6966 2063 7472 6c20 6973 2073 656c 662e  if ctrl is self.
-00028dc0: 6564 6974 5f70 773a 0d0a 2020 2020 2020  edit_pw:..      
-00028dd0: 2020 2020 2020 6e61 6d65 2c20 7661 6c75        name, valu
-00028de0: 6520 3d20 2270 6173 7377 6f72 6422 2c20  e = "password", 
-00028df0: 7574 696c 2e6f 6266 7573 6361 7465 2876  util.obfuscate(v
-00028e00: 616c 7565 290d 0a20 2020 2020 2020 2065  alue)..        e
-00028e10: 6c69 6620 6374 726c 2069 7320 7365 6c66  lif ctrl is self
-00028e20: 2e63 6865 636b 5f6c 6f67 696e 5f73 746f  .check_login_sto
-00028e30: 7265 3a20 2020 6e61 6d65 203d 2022 7374  re:   name = "st
-00028e40: 6f72 6522 0d0a 2020 2020 2020 2020 656c  ore"..        el
-00028e50: 6966 2063 7472 6c20 6973 2073 656c 662e  if ctrl is self.
-00028e60: 6368 6563 6b5f 6c6f 6769 6e5f 6175 746f  check_login_auto
-00028e70: 3a20 2020 206e 616d 6520 3d20 2261 7574  :    name = "aut
-00028e80: 6f22 0d0a 2020 2020 2020 2020 656c 6966  o"..        elif
-00028e90: 2063 7472 6c20 6973 2073 656c 662e 6368   ctrl is self.ch
-00028ea0: 6563 6b5f 6c6f 6769 6e5f 7379 6e63 3a20  eck_login_sync: 
-00028eb0: 2020 206e 616d 6520 3d20 2273 796e 6322     name = "sync"
-00028ec0: 0d0a 2020 2020 2020 2020 656c 6966 2063  ..        elif c
-00028ed0: 7472 6c20 6973 2073 656c 662e 6368 6563  trl is self.chec
-00028ee0: 6b5f 7379 6e63 5f63 6f6e 7461 6374 733a  k_sync_contacts:
-00028ef0: 206e 616d 6520 3d20 2273 796e 635f 636f   name = "sync_co
-00028f00: 6e74 6163 7473 220d 0a20 2020 2020 2020  ntacts"..       
-00028f10: 2065 6c69 6620 6374 726c 2069 7320 7365   elif ctrl is se
-00028f20: 6c66 2e63 6865 636b 5f73 796e 635f 6f6c  lf.check_sync_ol
-00028f30: 6465 723a 2020 2020 6e61 6d65 203d 2022  der:    name = "
-00028f40: 7379 6e63 5f6f 6c64 6572 220d 0a20 2020  sync_older"..   
-00028f50: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
-00028f60: 2e63 6865 636b 5f6c 6f67 696e 5f73 746f  .check_login_sto
-00028f70: 7265 2e56 616c 7565 3a20 7365 6c66 2e63  re.Value: self.c
-00028f80: 6865 636b 5f6c 6f67 696e 5f61 7574 6f2e  heck_login_auto.
-00028f90: 5661 6c75 6520 3d20 4661 6c73 650d 0a20  Value = False.. 
-00028fa0: 2020 2020 2020 2069 6620 6e6f 7420 7365         if not se
-00028fb0: 6c66 2e63 6865 636b 5f6c 6f67 696e 5f61  lf.check_login_a
-00028fc0: 7574 6f20 2e56 616c 7565 3a20 7365 6c66  uto .Value: self
-00028fd0: 2e63 6865 636b 5f6c 6f67 696e 5f73 796e  .check_login_syn
-00028fe0: 632e 5661 6c75 6520 3d20 4661 6c73 650d  c.Value = False.
-00028ff0: 0a20 2020 2020 2020 2073 656c 662e 6368  .        self.ch
-00029000: 6563 6b5f 6c6f 6769 6e5f 6175 746f 2e45  eck_login_auto.E
-00029010: 6e61 626c 6528 7365 6c66 2e63 6865 636b  nable(self.check
-00029020: 5f6c 6f67 696e 5f73 746f 7265 2e56 616c  _login_store.Val
-00029030: 7565 290d 0a20 2020 2020 2020 2073 656c  ue)..        sel
-00029040: 662e 6368 6563 6b5f 6c6f 6769 6e5f 7379  f.check_login_sy
-00029050: 6e63 2e45 6e61 626c 6528 7365 6c66 2e63  nc.Enable(self.c
-00029060: 6865 636b 5f6c 6f67 696e 5f61 7574 6f2e  heck_login_auto.
-00029070: 5661 6c75 6529 0d0a 2020 2020 2020 2020  Value)..        
-00029080: 636f 6e66 2e4c 6f67 696e 2e73 6574 6465  conf.Login.setde
-00029090: 6661 756c 7428 7365 6c66 2e64 622e 6669  fault(self.db.fi
-000290a0: 6c65 6e61 6d65 2c20 7b7d 295b 6e61 6d65  lename, {})[name
-000290b0: 5d20 3d20 7661 6c75 650d 0a20 2020 2020  ] = value..     
-000290c0: 2020 2069 6620 2273 746f 7265 2220 3d3d     if "store" ==
-000290d0: 206e 616d 6520 616e 6420 7661 6c75 6520   name and value 
-000290e0: 616e 6420 7365 6c66 2e65 6469 745f 7077  and self.edit_pw
-000290f0: 2e56 616c 7565 3a0d 0a20 2020 2020 2020  .Value:..       
-00029100: 2020 2020 2070 7720 3d20 7574 696c 2e6f       pw = util.o
-00029110: 6266 7573 6361 7465 2873 656c 662e 6564  bfuscate(self.ed
-00029120: 6974 5f70 772e 5661 6c75 6529 0d0a 2020  it_pw.Value)..  
-00029130: 2020 2020 2020 2020 2020 636f 6e66 2e4c            conf.L
-00029140: 6f67 696e 5b73 656c 662e 6462 2e66 696c  ogin[self.db.fil
-00029150: 656e 616d 655d 5b22 7061 7373 776f 7264  ename]["password
-00029160: 225d 203d 2070 770d 0a20 2020 2020 2020  "] = pw..       
-00029170: 2069 6620 6e6f 7420 7365 6c66 2e63 6865   if not self.che
-00029180: 636b 5f6c 6f67 696e 5f73 746f 7265 2e56  ck_login_store.V
-00029190: 616c 7565 3a0d 0a20 2020 2020 2020 2020  alue:..         
-000291a0: 2020 2073 656c 662e 6368 6563 6b5f 6c6f     self.check_lo
-000291b0: 6769 6e5f 6175 746f 2e56 616c 7565 203d  gin_auto.Value =
-000291c0: 2073 656c 662e 6368 6563 6b5f 6c6f 6769   self.check_logi
-000291d0: 6e5f 7379 6e63 2e56 616c 7565 203d 2046  n_sync.Value = F
-000291e0: 616c 7365 0d0a 2020 2020 2020 2020 2020  alse..          
-000291f0: 2020 636f 6e66 2e4c 6f67 696e 5b73 656c    conf.Login[sel
-00029200: 662e 6462 2e66 696c 656e 616d 655d 2e70  f.db.filename].p
-00029210: 6f70 2822 7374 6f72 6522 2c20 2020 204e  op("store",    N
-00029220: 6f6e 6529 0d0a 2020 2020 2020 2020 2020  one)..          
-00029230: 2020 636f 6e66 2e4c 6f67 696e 5b73 656c    conf.Login[sel
-00029240: 662e 6462 2e66 696c 656e 616d 655d 2e70  f.db.filename].p
-00029250: 6f70 2822 6175 746f 222c 2020 2020 204e  op("auto",     N
-00029260: 6f6e 6529 0d0a 2020 2020 2020 2020 2020  one)..          
-00029270: 2020 636f 6e66 2e4c 6f67 696e 5b73 656c    conf.Login[sel
-00029280: 662e 6462 2e66 696c 656e 616d 655d 2e70  f.db.filename].p
-00029290: 6f70 2822 7379 6e63 222c 2020 2020 204e  op("sync",     N
-000292a0: 6f6e 6529 0d0a 2020 2020 2020 2020 2020  one)..          
-000292b0: 2020 636f 6e66 2e4c 6f67 696e 5b73 656c    conf.Login[sel
-000292c0: 662e 6462 2e66 696c 656e 616d 655d 2e70  f.db.filename].p
-000292d0: 6f70 2822 7061 7373 776f 7264 222c 204e  op("password", N
-000292e0: 6f6e 6529 0d0a 2020 2020 2020 2020 6966  one)..        if
-000292f0: 206e 6f74 2073 656c 662e 6368 6563 6b5f   not self.check_
-00029300: 6c6f 6769 6e5f 6175 746f 2e56 616c 7565  login_auto.Value
-00029310: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
-00029320: 656c 662e 6368 6563 6b5f 6c6f 6769 6e5f  elf.check_login_
-00029330: 7379 6e63 2e56 616c 7565 203d 2046 616c  sync.Value = Fal
-00029340: 7365 0d0a 2020 2020 2020 2020 2020 2020  se..            
-00029350: 636f 6e66 2e4c 6f67 696e 5b73 656c 662e  conf.Login[self.
-00029360: 6462 2e66 696c 656e 616d 655d 2e70 6f70  db.filename].pop
-00029370: 2822 6175 746f 222c 2020 2020 204e 6f6e  ("auto",     Non
-00029380: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
-00029390: 636f 6e66 2e4c 6f67 696e 5b73 656c 662e  conf.Login[self.
-000293a0: 6462 2e66 696c 656e 616d 655d 2e70 6f70  db.filename].pop
-000293b0: 2822 7379 6e63 222c 2020 2020 204e 6f6e  ("sync",     Non
-000293c0: 6529 0d0a 2020 2020 2020 2020 6966 206e  e)..        if n
-000293d0: 6f74 2073 656c 662e 6368 6563 6b5f 6c6f  ot self.check_lo
-000293e0: 6769 6e5f 7379 6e63 2e56 616c 7565 3a0d  gin_sync.Value:.
-000293f0: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
-00029400: 662e 4c6f 6769 6e5b 7365 6c66 2e64 622e  f.Login[self.db.
-00029410: 6669 6c65 6e61 6d65 5d2e 706f 7028 2273  filename].pop("s
-00029420: 796e 6322 2c20 2020 2020 4e6f 6e65 290d  ync",     None).
-00029430: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-00029440: 2e63 6865 636b 5f73 796e 635f 636f 6e74  .check_sync_cont
-00029450: 6163 7473 2e56 616c 7565 3a0d 0a20 2020  acts.Value:..   
-00029460: 2020 2020 2020 2020 2063 6f6e 662e 4c6f           conf.Lo
-00029470: 6769 6e5b 7365 6c66 2e64 622e 6669 6c65  gin[self.db.file
-00029480: 6e61 6d65 5d2e 706f 7028 2273 796e 635f  name].pop("sync_
-00029490: 636f 6e74 6163 7473 222c 204e 6f6e 6529  contacts", None)
-000294a0: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
-000294b0: 662e 6368 6563 6b5f 7379 6e63 5f6f 6c64  f.check_sync_old
-000294c0: 6572 2e56 616c 7565 3a0d 0a20 2020 2020  er.Value:..     
-000294d0: 2020 2020 2020 2063 6f6e 662e 4c6f 6769         conf.Logi
-000294e0: 6e5b 7365 6c66 2e64 622e 6669 6c65 6e61  n[self.db.filena
-000294f0: 6d65 5d2e 706f 7028 2273 796e 635f 6f6c  me].pop("sync_ol
-00029500: 6465 7222 2c20 4e6f 6e65 290d 0a20 2020  der", None)..   
-00029510: 2020 2020 2069 6620 6e6f 7420 636f 6e66       if not conf
-00029520: 2e4c 6f67 696e 5b73 656c 662e 6462 2e66  .Login[self.db.f
-00029530: 696c 656e 616d 655d 3a20 636f 6e66 2e4c  ilename]: conf.L
-00029540: 6f67 696e 2e70 6f70 2873 656c 662e 6462  ogin.pop(self.db
-00029550: 2e66 696c 656e 616d 6529 0d0a 2020 2020  .filename)..    
-00029560: 2020 2020 7574 696c 2e72 756e 5f6f 6e63      util.run_onc
-00029570: 6528 636f 6e66 2e73 6176 6529 0d0a 0d0a  e(conf.save)....
-00029580: 0d0a 2020 2020 6465 6620 6f6e 5f6c 6973  ..    def on_lis
-00029590: 745f 6368 6174 735f 6b65 7928 7365 6c66  t_chats_key(self
-000295a0: 2c20 6576 656e 7429 3a0d 0a20 2020 2020  , event):..     
-000295b0: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
-000295c0: 4861 6e64 6c65 7220 666f 7220 7072 6573  Handler for pres
-000295d0: 7369 6e67 2061 206b 6579 2069 6e20 6368  sing a key in ch
-000295e0: 6174 7320 6c69 7374 2c20 6f70 656e 7320  ats list, opens 
-000295f0: 7265 6e61 6d65 2064 6961 6c6f 6720 6f6e  rename dialog on
-00029600: 2046 322c 0d0a 2020 2020 2020 2020 616e   F2,..        an
-00029610: 6420 666f 6375 7365 7320 6669 6c74 6572  d focuses filter
-00029620: 206f 6e20 4374 726c 2d46 2e0d 0a20 2020   on Ctrl-F...   
-00029630: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-00029640: 2020 6966 2065 7665 6e74 2e4b 6579 436f    if event.KeyCo
-00029650: 6465 2069 6e20 5b6f 7264 2822 4622 295d  de in [ord("F")]
-00029660: 2061 6e64 2065 7665 6e74 2e43 6d64 446f   and event.CmdDo
-00029670: 776e 2829 3a0d 0a20 2020 2020 2020 2020  wn():..         
-00029680: 2020 2073 656c 662e 6564 6974 5f63 6861     self.edit_cha
-00029690: 7466 696c 7465 722e 5365 7446 6f63 7573  tfilter.SetFocus
-000296a0: 2829 0d0a 2020 2020 2020 2020 656c 6966  ()..        elif
-000296b0: 2065 7665 6e74 2e4b 6579 436f 6465 2069   event.KeyCode i
-000296c0: 6e20 5b77 782e 5758 4b5f 4632 5d20 616e  n [wx.WXK_F2] an
-000296d0: 6420 7365 6c66 2e6c 6973 745f 6368 6174  d self.list_chat
-000296e0: 732e 5365 6c65 6374 6564 4974 656d 436f  s.SelectedItemCo
-000296f0: 756e 7420 3d3d 2031 3a0d 0a20 2020 2020  unt == 1:..     
-00029700: 2020 2020 2020 2069 7465 6d20 3d20 7365         item = se
-00029710: 6c66 2e6c 6973 745f 6368 6174 732e 4765  lf.list_chats.Ge
-00029720: 7449 7465 6d4d 6170 7065 6444 6174 6128  tItemMappedData(
-00029730: 7365 6c66 2e6c 6973 745f 6368 6174 732e  self.list_chats.
-00029740: 4765 7446 6972 7374 5365 6c65 6374 6564  GetFirstSelected
-00029750: 2829 290d 0a20 2020 2020 2020 2020 2020  ())..           
-00029760: 2073 656c 662e 6f6e 5f72 656e 616d 655f   self.on_rename_
-00029770: 6368 6174 2863 6861 743d 6974 656d 290d  chat(chat=item).
-00029780: 0a20 2020 2020 2020 2065 7665 6e74 2e53  .        event.S
-00029790: 6b69 7028 290d 0a0d 0a0d 0a20 2020 2064  kip()......    d
-000297a0: 6566 206f 6e5f 6c69 7374 5f63 6f6e 7461  ef on_list_conta
-000297b0: 6374 735f 6b65 7928 7365 6c66 2c20 6576  cts_key(self, ev
-000297c0: 656e 7429 3a0d 0a20 2020 2020 2020 2022  ent):..        "
-000297d0: 2222 0d0a 2020 2020 2020 2020 4861 6e64  ""..        Hand
-000297e0: 6c65 7220 666f 7220 7072 6573 7369 6e67  ler for pressing
-000297f0: 2061 206b 6579 2069 6e20 636f 6e74 6163   a key in contac
-00029800: 7473 206c 6973 742c 206f 7065 6e73 2072  ts list, opens r
-00029810: 656e 616d 6520 6469 616c 6f67 206f 6e20  ename dialog on 
-00029820: 4632 2c0d 0a20 2020 2020 2020 2061 6e64  F2,..        and
-00029830: 2066 6f63 7573 6573 2066 696c 7465 7220   focuses filter 
-00029840: 6f6e 2043 7472 6c2d 462e 0d0a 2020 2020  on Ctrl-F...    
-00029850: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
-00029860: 2069 6620 6576 656e 742e 4b65 7943 6f64   if event.KeyCod
-00029870: 6520 696e 205b 6f72 6428 2246 2229 5d20  e in [ord("F")] 
-00029880: 616e 6420 6576 656e 742e 436d 6444 6f77  and event.CmdDow
-00029890: 6e28 293a 0d0a 2020 2020 2020 2020 2020  n():..          
-000298a0: 2020 7365 6c66 2e65 6469 745f 636f 6e74    self.edit_cont
-000298b0: 6163 7466 696c 7465 722e 5365 7446 6f63  actfilter.SetFoc
-000298c0: 7573 2829 0d0a 2020 2020 2020 2020 656c  us()..        el
-000298d0: 6966 2065 7665 6e74 2e4b 6579 436f 6465  if event.KeyCode
-000298e0: 2069 6e20 5b77 782e 5758 4b5f 4632 5d20   in [wx.WXK_F2] 
-000298f0: 616e 6420 7365 6c66 2e6c 6973 745f 636f  and self.list_co
-00029900: 6e74 6163 7473 2e53 656c 6563 7465 6449  ntacts.SelectedI
-00029910: 7465 6d43 6f75 6e74 203d 3d20 313a 0d0a  temCount == 1:..
-00029920: 2020 2020 2020 2020 2020 2020 6974 656d              item
-00029930: 203d 2073 656c 662e 6c69 7374 5f63 6f6e   = self.list_con
-00029940: 7461 6374 732e 4765 7449 7465 6d4d 6170  tacts.GetItemMap
-00029950: 7065 6444 6174 6128 7365 6c66 2e6c 6973  pedData(self.lis
-00029960: 745f 636f 6e74 6163 7473 2e47 6574 4669  t_contacts.GetFi
-00029970: 7273 7453 656c 6563 7465 6428 2929 0d0a  rstSelected())..
-00029980: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00029990: 2e6f 6e5f 7265 6e61 6d65 5f63 6f6e 7461  .on_rename_conta
-000299a0: 6374 2863 6f6e 7461 6374 3d69 7465 6d29  ct(contact=item)
-000299b0: 0d0a 2020 2020 2020 2020 6576 656e 742e  ..        event.
-000299c0: 536b 6970 2829 0d0a 0d0a 0d0a 2020 2020  Skip()......    
-000299d0: 6465 6620 6f6e 5f6d 656e 755f 6c69 7374  def on_menu_list
-000299e0: 5f63 6861 7473 2873 656c 662c 2065 7665  _chats(self, eve
-000299f0: 6e74 293a 0d0a 2020 2020 2020 2020 2222  nt):..        ""
-00029a00: 2248 616e 646c 6572 2066 6f72 2072 6967  "Handler for rig
-00029a10: 6874 2d63 6c69 636b 696e 6720 6368 6174  ht-clicking chat
-00029a20: 6c69 7374 206f 7220 6368 6174 2061 6374  list or chat act
-00029a30: 696f 6e73 2d62 7574 746f 6e2c 206f 7065  ions-button, ope
-00029a40: 6e73 2070 6f70 7570 206d 656e 752e 2222  ns popup menu.""
-00029a50: 220d 0a20 2020 2020 2020 2069 6620 6576  "..        if ev
-00029a60: 656e 742e 4576 656e 744f 626a 6563 7420  ent.EventObject 
-00029a70: 6973 2073 656c 662e 6275 7474 6f6e 5f61  is self.button_a
-00029a80: 6374 696f 6e5f 6368 6174 3a0d 0a20 2020  ction_chat:..   
-00029a90: 2020 2020 2020 2020 2063 6861 7473 2c20           chats, 
-00029aa0: 6675 6c6c 6d65 6e75 203d 205b 7365 6c66  fullmenu = [self
-00029ab0: 2e63 6861 745d 2c20 4661 6c73 650d 0a20  .chat], False.. 
-00029ac0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-00029ad0: 2020 2020 2020 2020 2020 6368 6174 732c            chats,
-00029ae0: 2073 656c 6563 7465 6473 2c20 6675 6c6c   selecteds, full
-00029af0: 6d65 6e75 203d 205b 5d2c 205b 5d2c 2054  menu = [], [], T
-00029b00: 7275 650d 0a20 2020 2020 2020 2020 2020  rue..           
-00029b10: 2073 656c 6563 7465 6420 3d20 7365 6c66   selected = self
-00029b20: 2e6c 6973 745f 6368 6174 732e 4765 7446  .list_chats.GetF
-00029b30: 6972 7374 5365 6c65 6374 6564 2829 0d0a  irstSelected()..
-00029b40: 2020 2020 2020 2020 2020 2020 7768 696c              whil
-00029b50: 6520 7365 6c65 6374 6564 203e 3d20 303a  e selected >= 0:
-00029b60: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00029b70: 2020 7365 6c65 6374 6564 732e 6170 7065    selecteds.appe
-00029b80: 6e64 2873 656c 6563 7465 6429 0d0a 2020  nd(selected)..  
-00029b90: 2020 2020 2020 2020 2020 2020 2020 6368                ch
-00029ba0: 6174 732e 6170 7065 6e64 2873 656c 662e  ats.append(self.
-00029bb0: 6c69 7374 5f63 6861 7473 2e47 6574 4974  list_chats.GetIt
-00029bc0: 656d 4d61 7070 6564 4461 7461 2873 656c  emMappedData(sel
-00029bd0: 6563 7465 6429 290d 0a20 2020 2020 2020  ected))..       
-00029be0: 2020 2020 2020 2020 2073 656c 6563 7465           selecte
-00029bf0: 6420 3d20 7365 6c66 2e6c 6973 745f 6368  d = self.list_ch
-00029c00: 6174 732e 4765 744e 6578 7453 656c 6563  ats.GetNextSelec
-00029c10: 7465 6428 7365 6c65 6374 6564 290d 0a20  ted(selected).. 
-00029c20: 2020 2020 2020 2020 2020 2069 6620 6973             if is
-00029c30: 696e 7374 616e 6365 2865 7665 6e74 2c20  instance(event, 
-00029c40: 7778 2e4c 6973 7445 7665 6e74 2920 616e  wx.ListEvent) an
-00029c50: 6420 6576 656e 742e 4765 7449 6e64 6578  d event.GetIndex
-00029c60: 2829 203e 3d20 3020 5c0d 0a20 2020 2020  () >= 0 \..     
-00029c70: 2020 2020 2020 2061 6e64 2065 7665 6e74         and event
-00029c80: 2e47 6574 496e 6465 7828 2920 6e6f 7420  .GetIndex() not 
-00029c90: 696e 2073 656c 6563 7465 6473 3a0d 0a20  in selecteds:.. 
-00029ca0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00029cb0: 6861 7473 203d 205b 7365 6c66 2e6c 6973  hats = [self.lis
-00029cc0: 745f 6368 6174 732e 4765 7449 7465 6d4d  t_chats.GetItemM
-00029cd0: 6170 7065 6444 6174 6128 6576 656e 742e  appedData(event.
-00029ce0: 4765 7449 6e64 6578 2829 295d 0d0a 2020  GetIndex())]..  
-00029cf0: 2020 2020 2020 6966 206e 6f74 2063 6861        if not cha
-00029d00: 7473 3a20 7265 7475 726e 0d0a 0d0a 2020  ts: return....  
-00029d10: 2020 2020 2020 6368 6174 5f63 6f6c 7320        chat_cols 
-00029d20: 3d20 7365 6c66 2e64 622e 6765 745f 7461  = self.db.get_ta
-00029d30: 626c 655f 636f 6c75 6d6e 7328 2263 6f6e  ble_columns("con
-00029d40: 7665 7273 6174 696f 6e73 2229 0d0a 2020  versations")..  
-00029d50: 2020 2020 2020 636f 6e74 6163 745f 636f        contact_co
-00029d60: 6c73 203d 2073 656c 662e 6462 2e67 6574  ls = self.db.get
-00029d70: 5f74 6162 6c65 5f63 6f6c 756d 6e73 2822  _table_columns("
-00029d80: 636f 6e74 6163 7473 2229 0d0a 2020 2020  contacts")..    
-00029d90: 2020 2020 6e61 6d65 203d 2028 224f 7065      name = ("Ope
-00029da0: 6e20 2573 2022 2025 2063 6861 7473 5b30  n %s " % chats[0
-00029db0: 5d5b 2274 6974 6c65 5f6c 6f6e 675f 6c63  ]["title_long_lc
-00029dc0: 225d 2920 6966 206c 656e 2863 6861 7473  "]) if len(chats
-00029dd0: 2920 3c20 3220 5c0d 0a20 2020 2020 2020  ) < 2 \..       
-00029de0: 2020 2020 2020 2020 656c 7365 2075 7469          else uti
-00029df0: 6c2e 706c 7572 616c 2822 6368 6174 222c  l.plural("chat",
-00029e00: 2063 6861 7473 290d 0a0d 0a20 2020 2020   chats)....     
-00029e10: 2020 2064 6566 2063 6c69 7062 6f61 7264     def clipboard
-00029e20: 697a 6528 6361 7465 676f 7279 293a 0d0a  ize(category):..
-00029e30: 2020 2020 2020 2020 2020 2020 6966 2022              if "
-00029e40: 7469 746c 6522 203d 3d20 6361 7465 676f  title" == catego
-00029e50: 7279 3a0d 0a20 2020 2020 2020 2020 2020  ry:..           
-00029e60: 2020 2020 2074 6578 7420 3d20 225c 6e22       text = "\n"
-00029e70: 2e6a 6f69 6e28 635b 2274 6974 6c65 225d  .join(c["title"]
-00029e80: 2066 6f72 2063 2069 6e20 6368 6174 7329   for c in chats)
-00029e90: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
-00029ea0: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-00029eb0: 2020 2020 206e 616d 6572 203d 206c 616d       namer = lam
-00029ec0: 6264 6120 703a 2070 5b22 6964 656e 7469  bda p: p["identi
-00029ed0: 7479 225d 2069 6620 705b 2263 6f6e 7461  ty"] if p["conta
-00029ee0: 6374 225d 2e67 6574 2822 6e61 6d65 2229  ct"].get("name")
-00029ef0: 205c 0d0a 2020 2020 2020 2020 2020 2020   \..            
-00029f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029f10: 2020 2020 2020 616e 6420 705b 2269 6465        and p["ide
-00029f20: 6e74 6974 7922 5d20 3d3d 2070 5b22 636f  ntity"] == p["co
-00029f30: 6e74 6163 7422 5d5b 226e 616d 6522 5d20  ntact"]["name"] 
-00029f40: 5c0d 0a20 2020 2020 2020 2020 2020 2020  \..             
-00029f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029f60: 2020 2020 2065 6c73 6520 2225 7320 2825       else "%s (%
-00029f70: 7329 2220 2520 2870 5b22 636f 6e74 6163  s)" % (p["contac
-00029f80: 7422 5d5b 226e 616d 6522 5d2c 2070 5b22  t"]["name"], p["
-00029f90: 6964 656e 7469 7479 225d 290d 0a20 2020  identity"])..   
-00029fa0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00029fb0: 6c65 6e28 6368 6174 7329 203c 2032 3a20  len(chats) < 2: 
-00029fc0: 2320 6e61 6d65 315c 6e6e 616d 6532 0d0a  # name1\nname2..
-00029fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029fe0: 2020 2020 7465 7874 203d 2022 5c6e 222e      text = "\n".
-00029ff0: 6a6f 696e 286e 616d 6572 2870 2920 666f  join(namer(p) fo
-0002a000: 7220 7020 696e 2063 6861 7473 5b30 5d5b  r p in chats[0][
-0002a010: 2270 6172 7469 6369 7061 6e74 7322 5d0d  "participants"].
-0002a020: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00026e90: 2877 782e 4556 545f 4348 4543 4b42 4f58  (wx.EVT_CHECKBOX
+00026ea0: 2c20 2020 7365 6c66 2e6f 6e5f 6368 616e  ,   self.on_chan
+00026eb0: 6765 5f63 7472 6c5f 6c6f 6769 6e2c 2063  ge_ctrl_login, c
+00026ec0: 6865 636b 5f73 796e 6329 0d0a 2020 2020  heck_sync)..    
+00026ed0: 2020 2020 7365 6c66 2e42 696e 6428 7778      self.Bind(wx
+00026ee0: 2e45 5654 5f43 4845 434b 424f 582c 2020  .EVT_CHECKBOX,  
+00026ef0: 2073 656c 662e 6f6e 5f63 6861 6e67 655f   self.on_change_
+00026f00: 6374 726c 5f6c 6f67 696e 2c20 6368 6563  ctrl_login, chec
+00026f10: 6b5f 636f 6e74 6163 7473 290d 0a20 2020  k_contacts)..   
+00026f20: 2020 2020 2073 656c 662e 4269 6e64 2877       self.Bind(w
+00026f30: 782e 4556 545f 4348 4543 4b42 4f58 2c20  x.EVT_CHECKBOX, 
+00026f40: 2020 7365 6c66 2e6f 6e5f 6368 616e 6765    self.on_change
+00026f50: 5f63 7472 6c5f 6c6f 6769 6e2c 2063 6865  _ctrl_login, che
+00026f60: 636b 5f6f 6c64 6572 290d 0a20 2020 2020  ck_older)..     
+00026f70: 2020 2073 656c 662e 4269 6e64 2877 782e     self.Bind(wx.
+00026f80: 4556 545f 4255 5454 4f4e 2c20 2020 2020  EVT_BUTTON,     
+00026f90: 7365 6c66 2e6f 6e5f 6c69 7665 5f6c 6f67  self.on_live_log
+00026fa0: 696e 2c20 2020 2020 2020 2062 7574 746f  in,        butto
+00026fb0: 6e5f 6c6f 6769 6e29 0d0a 2020 2020 2020  n_login)..      
+00026fc0: 2020 7365 6c66 2e42 696e 6428 7778 2e45    self.Bind(wx.E
+00026fd0: 5654 5f42 5554 544f 4e2c 2020 2020 2073  VT_BUTTON,     s
+00026fe0: 656c 662e 6f6e 5f6c 6976 655f 7379 6e63  elf.on_live_sync
+00026ff0: 2c20 2020 2020 2020 2020 6275 7474 6f6e  ,         button
+00027000: 5f73 796e 6329 0d0a 2020 2020 2020 2020  _sync)..        
+00027010: 7365 6c66 2e42 696e 6428 7778 2e45 5654  self.Bind(wx.EVT
+00027020: 5f42 5554 544f 4e2c 2020 2020 2073 656c  _BUTTON,     sel
+00027030: 662e 6f6e 5f6c 6976 655f 7379 6e63 5f73  f.on_live_sync_s
+00027040: 656c 2c20 2020 2020 6275 7474 6f6e 5f73  el,     button_s
+00027050: 796e 635f 7365 6c29 0d0a 2020 2020 2020  ync_sel)..      
+00027060: 2020 7365 6c66 2e42 696e 6428 7778 2e45    self.Bind(wx.E
+00027070: 5654 5f42 5554 544f 4e2c 2020 2020 2073  VT_BUTTON,     s
+00027080: 656c 662e 6f6e 5f6c 6976 655f 7379 6e63  elf.on_live_sync
+00027090: 5f73 746f 702c 2020 2020 6275 7474 6f6e  _stop,    button
+000270a0: 5f73 796e 635f 7374 6f70 290d 0a20 2020  _sync_stop)..   
+000270b0: 2020 2020 2073 656c 662e 4269 6e64 2877       self.Bind(w
+000270c0: 782e 4556 545f 4c49 5354 5f49 5445 4d5f  x.EVT_LIST_ITEM_
+000270d0: 4143 5449 5641 5445 442c 2073 656c 662e  ACTIVATED, self.
+000270e0: 6f6e 5f63 6861 6e67 655f 6c69 7374 5f63  on_change_list_c
+000270f0: 6861 7473 5f73 796e 632c 206c 6973 745f  hats_sync, list_
+00027100: 6368 6174 7329 0d0a 2020 2020 2020 2020  chats)..        
+00027110: 6c61 6265 6c5f 696e 666f 2e42 696e 6428  label_info.Bind(
+00027120: 7778 2e68 746d 6c2e 4556 545f 4854 4d4c  wx.html.EVT_HTML
+00027130: 5f4c 494e 4b5f 434c 4943 4b45 442c 2020  _LINK_CLICKED,  
+00027140: 2020 2020 2020 2020 7365 6c66 2e6f 6e5f          self.on_
+00027150: 636c 6963 6b5f 6874 6d6c 5f6c 696e 6b29  click_html_link)
+00027160: 0d0a 2020 2020 2020 2020 6c61 6265 6c5f  ..        label_
+00027170: 696e 666f 2e42 696e 6428 7778 2e45 5654  info.Bind(wx.EVT
+00027180: 5f52 4947 4854 5f55 502c 2020 2020 2020  _RIGHT_UP,      
+00027190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000271a0: 2020 7365 6c66 2e6f 6e5f 7269 6768 7463    self.on_rightc
+000271b0: 6c69 636b 5f68 746d 6c29 0d0a 0d0a 2020  lick_html)....  
+000271c0: 2020 2020 2020 7365 6c66 2e65 6469 745f        self.edit_
+000271d0: 7573 6572 2020 2020 2020 2020 2020 203d  user           =
+000271e0: 2065 6469 745f 7573 6572 0d0a 2020 2020   edit_user..    
+000271f0: 2020 2020 7365 6c66 2e62 7574 746f 6e5f      self.button_
+00027200: 7573 6572 2020 2020 2020 2020 203d 2062  user         = b
+00027210: 7574 746f 6e5f 7573 6572 0d0a 2020 2020  utton_user..    
+00027220: 2020 2020 7365 6c66 2e65 6469 745f 7077      self.edit_pw
+00027230: 2020 2020 2020 2020 2020 2020 203d 2065               = e
+00027240: 6469 745f 7077 0d0a 2020 2020 2020 2020  dit_pw..        
+00027250: 7365 6c66 2e63 6865 636b 5f6c 6f67 696e  self.check_login
+00027260: 5f73 746f 7265 2020 203d 2063 6865 636b  _store   = check
+00027270: 5f73 746f 7265 0d0a 2020 2020 2020 2020  _store..        
+00027280: 7365 6c66 2e63 6865 636b 5f6c 6f67 696e  self.check_login
+00027290: 5f61 7574 6f20 2020 203d 2063 6865 636b  _auto    = check
+000272a0: 5f6c 6f67 696e 0d0a 2020 2020 2020 2020  _login..        
+000272b0: 7365 6c66 2e63 6865 636b 5f6c 6f67 696e  self.check_login
+000272c0: 5f73 796e 6320 2020 203d 2063 6865 636b  _sync    = check
+000272d0: 5f73 796e 630d 0a20 2020 2020 2020 2073  _sync..        s
+000272e0: 656c 662e 6564 6974 5f6c 6f67 696e 5f73  elf.edit_login_s
+000272f0: 7461 7475 7320 2020 3d20 6564 6974 5f73  tatus   = edit_s
+00027300: 7461 7475 730d 0a20 2020 2020 2020 2073  tatus..        s
+00027310: 656c 662e 6275 7474 6f6e 5f6c 6f67 696e  elf.button_login
+00027320: 2020 2020 2020 2020 3d20 6275 7474 6f6e          = button
+00027330: 5f6c 6f67 696e 0d0a 2020 2020 2020 2020  _login..        
+00027340: 7365 6c66 2e6c 6162 656c 5f6c 6f67 696e  self.label_login
+00027350: 5f66 6169 6c20 2020 203d 206c 6162 656c  _fail    = label
+00027360: 5f69 6e66 6f0d 0a20 2020 2020 2020 2073  _info..        s
+00027370: 656c 662e 6c69 7374 5f63 6861 7473 5f73  elf.list_chats_s
+00027380: 796e 6320 2020 2020 3d20 6c69 7374 5f63  ync     = list_c
+00027390: 6861 7473 0d0a 2020 2020 2020 2020 7365  hats..        se
+000273a0: 6c66 2e67 6175 6765 5f73 796e 6320 2020  lf.gauge_sync   
+000273b0: 2020 2020 2020 203d 2067 6175 6765 0d0a         = gauge..
+000273c0: 2020 2020 2020 2020 7365 6c66 2e6c 6162          self.lab
+000273d0: 656c 5f73 796e 635f 7072 6f67 7265 7373  el_sync_progress
+000273e0: 203d 206c 6162 656c 5f70 726f 6772 6573   = label_progres
+000273f0: 730d 0a20 2020 2020 2020 2073 656c 662e  s..        self.
+00027400: 6564 6974 5f73 796e 635f 7374 6174 7573  edit_sync_status
+00027410: 2020 2020 3d20 6564 6974 5f73 796e 635f      = edit_sync_
+00027420: 7374 6174 7573 0d0a 2020 2020 2020 2020  status..        
+00027430: 7365 6c66 2e63 6865 636b 5f73 796e 635f  self.check_sync_
+00027440: 636f 6e74 6163 7473 203d 2063 6865 636b  contacts = check
+00027450: 5f63 6f6e 7461 6374 730d 0a20 2020 2020  _contacts..     
+00027460: 2020 2073 656c 662e 6368 6563 6b5f 7379     self.check_sy
+00027470: 6e63 5f6f 6c64 6572 2020 2020 3d20 6368  nc_older    = ch
+00027480: 6563 6b5f 6f6c 6465 720d 0a20 2020 2020  eck_older..     
+00027490: 2020 2073 656c 662e 6275 7474 6f6e 5f73     self.button_s
+000274a0: 796e 6320 2020 2020 2020 2020 3d20 6275  ync         = bu
+000274b0: 7474 6f6e 5f73 796e 630d 0a20 2020 2020  tton_sync..     
+000274c0: 2020 2073 656c 662e 6275 7474 6f6e 5f73     self.button_s
+000274d0: 796e 635f 7365 6c20 2020 2020 3d20 6275  ync_sel     = bu
+000274e0: 7474 6f6e 5f73 796e 635f 7365 6c0d 0a20  tton_sync_sel.. 
+000274f0: 2020 2020 2020 2073 656c 662e 6275 7474         self.butt
+00027500: 6f6e 5f73 796e 635f 7374 6f70 2020 2020  on_sync_stop    
+00027510: 3d20 6275 7474 6f6e 5f73 796e 635f 7374  = button_sync_st
+00027520: 6f70 0d0a 0d0a 2020 2020 2020 2020 7369  op....        si
+00027530: 7a65 7220 3d20 7061 6765 2e53 697a 6572  zer = page.Sizer
+00027540: 203d 2077 782e 426f 7853 697a 6572 2877   = wx.BoxSizer(w
+00027550: 782e 484f 5249 5a4f 4e54 414c 290d 0a20  x.HORIZONTAL).. 
+00027560: 2020 2020 2020 2073 697a 6572 3120 3d20         sizer1 = 
+00027570: 7061 6e65 6c31 2e53 697a 6572 203d 2077  panel1.Sizer = w
+00027580: 782e 426f 7853 697a 6572 2877 782e 5645  x.BoxSizer(wx.VE
+00027590: 5254 4943 414c 290d 0a20 2020 2020 2020  RTICAL)..       
+000275a0: 2073 697a 6572 3220 3d20 7061 6e65 6c32   sizer2 = panel2
+000275b0: 2e53 697a 6572 203d 2077 782e 426f 7853  .Sizer = wx.BoxS
+000275c0: 697a 6572 2877 782e 5645 5254 4943 414c  izer(wx.VERTICAL
+000275d0: 290d 0a20 2020 2020 2020 2073 697a 6572  )..        sizer
+000275e0: 5f6c 6f67 696e 203d 2077 782e 466c 6578  _login = wx.Flex
+000275f0: 4772 6964 5369 7a65 7228 636f 6c73 3d32  GridSizer(cols=2
+00027600: 2c20 7667 6170 3d30 2c20 6867 6170 3d31  , vgap=0, hgap=1
+00027610: 3029 0d0a 2020 2020 2020 2020 7369 7a65  0)..        size
+00027620: 725f 6c6f 6769 6e2e 4164 6447 726f 7761  r_login.AddGrowa
+00027630: 626c 6543 6f6c 2831 2c20 3129 0d0a 2020  bleCol(1, 1)..  
+00027640: 2020 2020 2020 7369 7a65 725f 7573 6572        sizer_user
+00027650: 2020 3d20 7778 2e42 6f78 5369 7a65 7228    = wx.BoxSizer(
+00027660: 7778 2e48 4f52 495a 4f4e 5441 4c29 0d0a  wx.HORIZONTAL)..
+00027670: 2020 2020 2020 2020 7369 7a65 725f 7379          sizer_sy
+00027680: 6e63 3120 3d20 7061 6e65 6c5f 7379 6e63  nc1 = panel_sync
+00027690: 312e 5369 7a65 7220 3d20 7778 2e42 6f78  1.Sizer = wx.Box
+000276a0: 5369 7a65 7228 7778 2e56 4552 5449 4341  Sizer(wx.VERTICA
+000276b0: 4c29 0d0a 2020 2020 2020 2020 7369 7a65  L)..        size
+000276c0: 725f 7379 6e63 3220 3d20 7061 6e65 6c5f  r_sync2 = panel_
+000276d0: 7379 6e63 322e 5369 7a65 7220 3d20 7778  sync2.Sizer = wx
+000276e0: 2e42 6f78 5369 7a65 7228 7778 2e56 4552  .BoxSizer(wx.VER
+000276f0: 5449 4341 4c29 0d0a 0d0a 2020 2020 2020  TICAL)....      
+00027700: 2020 7369 7a65 725f 7573 6572 2e41 6464    sizer_user.Add
+00027710: 2865 6469 745f 7573 6572 2c20 2020 2066  (edit_user,    f
+00027720: 6c61 673d 7778 2e47 524f 572c 2070 726f  lag=wx.GROW, pro
+00027730: 706f 7274 696f 6e3d 3129 0d0a 2020 2020  portion=1)..    
+00027740: 2020 2020 7369 7a65 725f 7573 6572 2e41      sizer_user.A
+00027750: 6464 2862 7574 746f 6e5f 7573 6572 2c20  dd(button_user, 
+00027760: 2062 6f72 6465 723d 3130 2c20 666c 6167   border=10, flag
+00027770: 3d77 782e 4c45 4654 290d 0a0d 0a20 2020  =wx.LEFT)....   
+00027780: 2020 2020 2073 697a 6572 5f6c 6f67 696e       sizer_login
+00027790: 2e41 6464 286c 6162 656c 5f75 7365 722c  .Add(label_user,
+000277a0: 2020 626f 7264 6572 3d35 2c20 666c 6167    border=5, flag
+000277b0: 3d77 782e 414c 4c29 0d0a 2020 2020 2020  =wx.ALL)..      
+000277c0: 2020 7369 7a65 725f 6c6f 6769 6e2e 4164    sizer_login.Ad
+000277d0: 6428 7369 7a65 725f 7573 6572 2c20 2062  d(sizer_user,  b
+000277e0: 6f72 6465 723d 352c 2066 6c61 673d 7778  order=5, flag=wx
+000277f0: 2e41 4c4c 207c 2077 782e 4752 4f57 290d  .ALL | wx.GROW).
+00027800: 0a20 2020 2020 2020 2073 697a 6572 5f6c  .        sizer_l
+00027810: 6f67 696e 2e41 6464 286c 6162 656c 5f70  ogin.Add(label_p
+00027820: 772c 2020 2020 626f 7264 6572 3d35 2c20  w,    border=5, 
+00027830: 666c 6167 3d77 782e 414c 4c29 0d0a 2020  flag=wx.ALL)..  
+00027840: 2020 2020 2020 7369 7a65 725f 6c6f 6769        sizer_logi
+00027850: 6e2e 4164 6428 6564 6974 5f70 772c 2020  n.Add(edit_pw,  
+00027860: 2020 2062 6f72 6465 723d 352c 2066 6c61     border=5, fla
+00027870: 673d 7778 2e41 4c4c 207c 2077 782e 4752  g=wx.ALL | wx.GR
+00027880: 4f57 290d 0a20 2020 2020 2020 2073 697a  OW)..        siz
+00027890: 6572 5f6c 6f67 696e 2e41 6464 5370 6163  er_login.AddSpac
+000278a0: 6572 2835 290d 0a20 2020 2020 2020 2073  er(5)..        s
+000278b0: 697a 6572 5f6c 6f67 696e 2e41 6464 2863  izer_login.Add(c
+000278c0: 6865 636b 5f73 746f 7265 2c20 626f 7264  heck_store, bord
+000278d0: 6572 3d35 2c20 666c 6167 3d77 782e 414c  er=5, flag=wx.AL
+000278e0: 4c20 7c20 7778 2e47 524f 5729 0d0a 2020  L | wx.GROW)..  
+000278f0: 2020 2020 2020 7369 7a65 725f 6c6f 6769        sizer_logi
+00027900: 6e2e 4164 6453 7061 6365 7228 3529 0d0a  n.AddSpacer(5)..
+00027910: 2020 2020 2020 2020 7369 7a65 725f 6c6f          sizer_lo
+00027920: 6769 6e2e 4164 6428 6368 6563 6b5f 6c6f  gin.Add(check_lo
+00027930: 6769 6e2c 2062 6f72 6465 723d 352c 2066  gin, border=5, f
+00027940: 6c61 673d 7778 2e41 4c4c 207c 2077 782e  lag=wx.ALL | wx.
+00027950: 4752 4f57 290d 0a20 2020 2020 2020 2073  GROW)..        s
+00027960: 697a 6572 5f6c 6f67 696e 2e41 6464 5370  izer_login.AddSp
+00027970: 6163 6572 2835 290d 0a20 2020 2020 2020  acer(5)..       
+00027980: 2073 697a 6572 5f6c 6f67 696e 2e41 6464   sizer_login.Add
+00027990: 2863 6865 636b 5f73 796e 632c 2020 626f  (check_sync,  bo
+000279a0: 7264 6572 3d35 2c20 666c 6167 3d77 782e  rder=5, flag=wx.
+000279b0: 414c 4c20 7c20 7778 2e47 524f 5729 0d0a  ALL | wx.GROW)..
+000279c0: 0d0a 2020 2020 2020 2020 7369 7a65 7231  ..        sizer1
+000279d0: 2e41 6464 286c 6162 656c 5f6c 6f67 696e  .Add(label_login
+000279e0: 2c20 2062 6f72 6465 723d 352c 2020 666c  ,  border=5,  fl
+000279f0: 6167 3d77 782e 414c 4c29 0d0a 2020 2020  ag=wx.ALL)..    
+00027a00: 2020 2020 7369 7a65 7231 2e41 6464 2873      sizer1.Add(s
+00027a10: 697a 6572 5f6c 6f67 696e 2c20 2062 6f72  izer_login,  bor
+00027a20: 6465 723d 3230 2c20 666c 6167 3d77 782e  der=20, flag=wx.
+00027a30: 544f 5020 7c20 7778 2e47 524f 5729 0d0a  TOP | wx.GROW)..
+00027a40: 2020 2020 2020 2020 7369 7a65 7231 2e41          sizer1.A
+00027a50: 6464 2865 6469 745f 7374 6174 7573 2c20  dd(edit_status, 
+00027a60: 2062 6f72 6465 723d 3130 2c20 666c 6167   border=10, flag
+00027a70: 3d77 782e 544f 5020 7c20 7778 2e4c 4546  =wx.TOP | wx.LEF
+00027a80: 5420 7c20 7778 2e52 4947 4854 207c 2077  T | wx.RIGHT | w
+00027a90: 782e 4752 4f57 290d 0a20 2020 2020 2020  x.GROW)..       
+00027aa0: 2073 697a 6572 312e 4164 6428 6275 7474   sizer1.Add(butt
+00027ab0: 6f6e 5f6c 6f67 696e 2c20 626f 7264 6572  on_login, border
+00027ac0: 3d35 2c20 2066 6c61 673d 7778 2e41 4c4c  =5,  flag=wx.ALL
+00027ad0: 207c 2077 782e 4752 4f57 290d 0a20 2020   | wx.GROW)..   
+00027ae0: 2020 2020 2073 697a 6572 312e 4164 6428       sizer1.Add(
+00027af0: 6c61 6265 6c5f 696e 666f 2c20 2020 626f  label_info,   bo
+00027b00: 7264 6572 3d31 352c 2066 6c61 673d 7778  rder=15, flag=wx
+00027b10: 2e41 4c4c 207c 2077 782e 4752 4f57 2c20  .ALL | wx.GROW, 
+00027b20: 7072 6f70 6f72 7469 6f6e 3d31 290d 0a0d  proportion=1)...
+00027b30: 0a20 2020 2020 2020 2073 697a 6572 322e  .        sizer2.
+00027b40: 4164 6428 6c61 6265 6c5f 7379 6e63 2c20  Add(label_sync, 
+00027b50: 626f 7264 6572 3d35 2c20 666c 6167 3d77  border=5, flag=w
+00027b60: 782e 414c 4c20 7c20 7778 2e47 524f 5729  x.ALL | wx.GROW)
+00027b70: 0d0a 0d0a 2020 2020 2020 2020 7369 7a65  ....        size
+00027b80: 725f 7379 6e63 312e 4164 6428 6c69 7374  r_sync1.Add(list
+00027b90: 5f63 6861 7473 2c20 7072 6f70 6f72 7469  _chats, proporti
+00027ba0: 6f6e 3d31 2c20 626f 7264 6572 3d35 2c20  on=1, border=5, 
+00027bb0: 666c 6167 3d77 782e 414c 4c20 7c20 7778  flag=wx.ALL | wx
+00027bc0: 2e47 524f 5729 0d0a 2020 2020 2020 2020  .GROW)..        
+00027bd0: 7369 7a65 725f 7379 6e63 322e 4164 6428  sizer_sync2.Add(
+00027be0: 6761 7567 652c 2062 6f72 6465 723d 352c  gauge, border=5,
+00027bf0: 2066 6c61 673d 7778 2e41 4c4c 207c 2077   flag=wx.ALL | w
+00027c00: 782e 414c 4947 4e5f 4345 4e54 4552 5f48  x.ALIGN_CENTER_H
+00027c10: 4f52 495a 4f4e 5441 4c29 0d0a 2020 2020  ORIZONTAL)..    
+00027c20: 2020 2020 7369 7a65 725f 7379 6e63 322e      sizer_sync2.
+00027c30: 4164 6428 6c61 6265 6c5f 7072 6f67 7265  Add(label_progre
+00027c40: 7373 2c20 626f 7264 6572 3d35 2c20 666c  ss, border=5, fl
+00027c50: 6167 3d77 782e 414c 4c20 7c20 7778 2e41  ag=wx.ALL | wx.A
+00027c60: 4c49 474e 5f43 454e 5445 525f 484f 5249  LIGN_CENTER_HORI
+00027c70: 5a4f 4e54 414c 290d 0a20 2020 2020 2020  ZONTAL)..       
+00027c80: 2073 697a 6572 5f73 796e 6332 2e41 6464   sizer_sync2.Add
+00027c90: 2865 6469 745f 7379 6e63 5f73 7461 7475  (edit_sync_statu
+00027ca0: 732c 2070 726f 706f 7274 696f 6e3d 312c  s, proportion=1,
+00027cb0: 2062 6f72 6465 723d 352c 2066 6c61 673d   border=5, flag=
+00027cc0: 7778 2e41 4c4c 207c 2077 782e 4752 4f57  wx.ALL | wx.GROW
+00027cd0: 290d 0a20 2020 2020 2020 2073 697a 6572  )..        sizer
+00027ce0: 5f73 796e 6332 2e41 6464 2863 6865 636b  _sync2.Add(check
+00027cf0: 5f63 6f6e 7461 6374 732c 2062 6f72 6465  _contacts, borde
+00027d00: 723d 352c 2066 6c61 673d 7778 2e41 4c4c  r=5, flag=wx.ALL
+00027d10: 207c 2077 782e 4752 4f57 290d 0a20 2020   | wx.GROW)..   
+00027d20: 2020 2020 2073 697a 6572 5f73 796e 6332       sizer_sync2
+00027d30: 2e41 6464 2863 6865 636b 5f6f 6c64 6572  .Add(check_older
+00027d40: 2c20 2020 2062 6f72 6465 723d 352c 2066  ,    border=5, f
+00027d50: 6c61 673d 7778 2e41 4c4c 207c 2077 782e  lag=wx.ALL | wx.
+00027d60: 4752 4f57 290d 0a20 2020 2020 2020 2073  GROW)..        s
+00027d70: 697a 6572 5f73 796e 6332 2e41 6464 2862  izer_sync2.Add(b
+00027d80: 7574 746f 6e5f 7379 6e63 2c20 626f 7264  utton_sync, bord
+00027d90: 6572 3d35 2c20 666c 6167 3d77 782e 414c  er=5, flag=wx.AL
+00027da0: 4c20 7c20 7778 2e47 524f 5729 0d0a 2020  L | wx.GROW)..  
+00027db0: 2020 2020 2020 7369 7a65 725f 7379 6e63        sizer_sync
+00027dc0: 322e 4164 6428 6275 7474 6f6e 5f73 796e  2.Add(button_syn
+00027dd0: 635f 7365 6c2c 2062 6f72 6465 723d 352c  c_sel, border=5,
+00027de0: 2066 6c61 673d 7778 2e41 4c4c 207c 2077   flag=wx.ALL | w
+00027df0: 782e 4752 4f57 290d 0a20 2020 2020 2020  x.GROW)..       
+00027e00: 2073 697a 6572 5f73 796e 6332 2e41 6464   sizer_sync2.Add
+00027e10: 2862 7574 746f 6e5f 7379 6e63 5f73 746f  (button_sync_sto
+00027e20: 702c 2062 6f72 6465 723d 352c 2066 6c61  p, border=5, fla
+00027e30: 673d 7778 2e41 4c4c 207c 2077 782e 4752  g=wx.ALL | wx.GR
+00027e40: 4f57 290d 0a0d 0a20 2020 2020 2020 2073  OW)....        s
+00027e50: 697a 6572 322e 4164 6428 7370 6c69 7474  izer2.Add(splitt
+00027e60: 6572 5f73 796e 632c 2070 726f 706f 7274  er_sync, proport
+00027e70: 696f 6e3d 312c 2066 6c61 673d 7778 2e47  ion=1, flag=wx.G
+00027e80: 524f 5729 0d0a 0d0a 2020 2020 2020 2020  ROW)....        
+00027e90: 7369 7a65 722e 4164 6428 7370 6c69 7474  sizer.Add(splitt
+00027ea0: 6572 2c20 626f 7264 6572 3d35 2c20 7072  er, border=5, pr
+00027eb0: 6f70 6f72 7469 6f6e 3d31 2c20 666c 6167  oportion=1, flag
+00027ec0: 3d77 782e 414c 4c20 7c20 7778 2e47 524f  =wx.ALL | wx.GRO
+00027ed0: 5729 0d0a 2020 2020 2020 2020 7370 6c69  W)..        spli
+00027ee0: 7474 6572 2e53 706c 6974 5665 7274 6963  tter.SplitVertic
+00027ef0: 616c 6c79 2870 616e 656c 312c 2070 616e  ally(panel1, pan
+00027f00: 656c 3229 0d0a 2020 2020 2020 2020 706f  el2)..        po
+00027f10: 7320 3d20 7365 6c66 2e53 697a 655b 315d  s = self.Size[1]
+00027f20: 202f 2f20 340d 0a20 2020 2020 2020 2073   // 4..        s
+00027f30: 706c 6974 7465 725f 7379 6e63 2e53 706c  plitter_sync.Spl
+00027f40: 6974 486f 7269 7a6f 6e74 616c 6c79 2870  itHorizontally(p
+00027f50: 616e 656c 5f73 796e 6331 2c20 7061 6e65  anel_sync1, pane
+00027f60: 6c5f 7379 6e63 322c 2073 6173 6850 6f73  l_sync2, sashPos
+00027f70: 6974 696f 6e3d 706f 7329 0d0a 0d0a 0d0a  ition=pos)......
+00027f80: 2020 2020 6465 6620 6f6e 5f73 7973 5f63      def on_sys_c
+00027f90: 6f6c 6f75 725f 6368 616e 6765 2873 656c  olour_change(sel
+00027fa0: 662c 2065 7665 6e74 293a 0d0a 2020 2020  f, event):..    
+00027fb0: 2020 2020 2222 2248 616e 646c 6572 2066      """Handler f
+00027fc0: 6f72 2073 7973 7465 6d20 636f 6c6f 7572  or system colour
+00027fd0: 2063 6861 6e67 652c 2072 6566 7265 7368   change, refresh
+00027fe0: 6573 2063 6f6e 7465 6e74 2e22 2222 0d0a  es content."""..
+00027ff0: 2020 2020 2020 2020 6576 656e 742e 536b          event.Sk
+00028000: 6970 2829 0d0a 2020 2020 2020 2020 6465  ip()..        de
+00028010: 6620 646f 7265 6672 6573 6828 293a 0d0a  f dorefresh():..
+00028020: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+00028030: 6f74 2073 656c 663a 2072 6574 7572 6e0d  ot self: return.
+00028040: 0a0d 0a20 2020 2020 2020 2020 2020 2073  ...            s
+00028050: 656c 662e 6c61 6265 6c5f 6874 6d6c 2e53  elf.label_html.S
+00028060: 6574 5061 6765 2873 7465 702e 5465 6d70  etPage(step.Temp
+00028070: 6c61 7465 2874 656d 706c 6174 6573 2e53  late(templates.S
+00028080: 4541 5243 485f 4845 4c50 5f53 484f 5254  EARCH_HELP_SHORT
+00028090: 292e 6578 7061 6e64 2829 290d 0a20 2020  ).expand())..   
+000280a0: 2020 2020 2020 2020 2073 656c 662e 6c61           self.la
+000280b0: 6265 6c5f 6874 6d6c 2e42 6163 6b67 726f  bel_html.Backgro
+000280c0: 756e 6443 6f6c 6f75 7220 3d20 436f 6c6f  undColour = Colo
+000280d0: 7572 4d61 6e61 6765 722e 4765 7443 6f6c  urManager.GetCol
+000280e0: 6f75 7228 7778 2e53 5953 5f43 4f4c 4f55  our(wx.SYS_COLOU
+000280f0: 525f 4254 4e46 4143 4529 0d0a 2020 2020  R_BTNFACE)..    
+00028100: 2020 2020 2020 2020 7365 6c66 2e6c 6162          self.lab
+00028110: 656c 5f68 746d 6c2e 466f 7265 6772 6f75  el_html.Foregrou
+00028120: 6e64 436f 6c6f 7572 203d 2043 6f6c 6f75  ndColour = Colou
+00028130: 724d 616e 6167 6572 2e47 6574 436f 6c6f  rManager.GetColo
+00028140: 7572 2877 782e 5359 535f 434f 4c4f 5552  ur(wx.SYS_COLOUR
+00028150: 5f42 544e 5445 5854 290d 0a20 2020 2020  _BTNTEXT)..     
+00028160: 2020 2020 2020 2073 656c 662e 6c61 6265         self.labe
+00028170: 6c5f 6c6f 6769 6e5f 6661 696c 2e53 6574  l_login_fail.Set
+00028180: 5061 6765 2873 7465 702e 5465 6d70 6c61  Page(step.Templa
+00028190: 7465 2874 656d 706c 6174 6573 2e4c 4f47  te(templates.LOG
+000281a0: 494e 5f46 4149 4c5f 494e 464f 292e 6578  IN_FAIL_INFO).ex
+000281b0: 7061 6e64 2829 290d 0a20 2020 2020 2020  pand())..       
+000281c0: 2020 2020 2064 6566 6175 6c74 203d 2073       default = s
+000281d0: 7465 702e 5465 6d70 6c61 7465 2874 656d  tep.Template(tem
+000281e0: 706c 6174 6573 2e53 4541 5243 485f 5745  plates.SEARCH_WE
+000281f0: 4c43 4f4d 455f 4854 4d4c 292e 6578 7061  LCOME_HTML).expa
+00028200: 6e64 2829 0d0a 2020 2020 2020 2020 2020  nd()..          
+00028210: 2020 7365 6c66 2e68 746d 6c5f 7365 6172    self.html_sear
+00028220: 6368 616c 6c2e 5365 7444 6566 6175 6c74  chall.SetDefault
+00028230: 5061 6765 2864 6566 6175 6c74 290d 0a20  Page(default).. 
+00028240: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00028250: 6c6f 6164 5f74 6162 6c65 735f 6461 7461  load_tables_data
+00028260: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+00028270: 7365 6c66 2e6c 6973 745f 7469 6d65 6c69  self.list_timeli
+00028280: 6e65 2e52 6566 7265 7368 4974 656d 7328  ne.RefreshItems(
+00028290: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
+000282a0: 656c 662e 706f 7075 6c61 7465 5f63 6861  elf.populate_cha
+000282b0: 745f 7374 6174 6973 7469 6373 2829 0d0a  t_statistics()..
+000282c0: 2020 2020 2020 2020 2020 2020 7574 696c              util
+000282d0: 2e74 7279 5f69 676e 6f72 6528 6c61 6d62  .try_ignore(lamb
+000282e0: 6461 3a20 7365 6c66 2e67 7269 645f 7461  da: self.grid_ta
+000282f0: 626c 652e 5461 626c 652e 436c 6561 7241  ble.Table.ClearA
+00028300: 7474 7273 2829 290d 0a20 2020 2020 2020  ttrs())..       
+00028310: 2020 2020 2075 7469 6c2e 7472 795f 6967       util.try_ig
+00028320: 6e6f 7265 286c 616d 6264 613a 2073 656c  nore(lambda: sel
+00028330: 662e 6772 6964 5f73 716c 2e54 6162 6c65  f.grid_sql.Table
+00028340: 2e43 6c65 6172 4174 7472 7328 2929 0d0a  .ClearAttrs())..
+00028350: 0d0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
+00028360: 7220 6c73 7420 696e 2028 7365 6c66 2e6c  r lst in (self.l
+00028370: 6973 745f 6368 6174 732c 2073 656c 662e  ist_chats, self.
+00028380: 6c69 7374 5f63 6f6e 7461 6374 732c 0d0a  list_contacts,..
+00028390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000283a0: 2020 2020 2020 2020 7365 6c66 2e6c 6973          self.lis
+000283b0: 745f 6368 6174 735f 7379 6e63 2c20 7365  t_chats_sync, se
+000283c0: 6c66 2e6c 6973 745f 7061 7274 6963 6970  lf.list_particip
+000283d0: 616e 7473 293a 0d0a 2020 2020 2020 2020  ants):..        
+000283e0: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
+000283f0: 2072 616e 6765 286c 7374 2e47 6574 4974   range(lst.GetIt
+00028400: 656d 436f 756e 7428 2929 3a0d 0a20 2020  emCount()):..   
+00028410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028420: 206c 7374 2e53 6574 4974 656d 5465 7874   lst.SetItemText
+00028430: 436f 6c6f 7572 2869 2c20 2020 2020 2020  Colour(i,       
+00028440: 6c73 742e 466f 7265 6772 6f75 6e64 436f  lst.ForegroundCo
+00028450: 6c6f 7572 290d 0a20 2020 2020 2020 2020  lour)..         
+00028460: 2020 2020 2020 2020 2020 206c 7374 2e53             lst.S
+00028470: 6574 4974 656d 4261 636b 6772 6f75 6e64  etItemBackground
+00028480: 436f 6c6f 7572 2869 2c20 6c73 742e 4261  Colour(i, lst.Ba
+00028490: 636b 6772 6f75 6e64 436f 6c6f 7572 290d  ckgroundColour).
+000284a0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+000284b0: 662e 6c6f 6164 5f63 6f6e 7461 6374 2873  f.load_contact(s
+000284c0: 656c 662e 636f 6e74 6163 7429 0d0a 0d0a  elf.contact)....
+000284d0: 2020 2020 2020 2020 7778 2e43 616c 6c41          wx.CallA
+000284e0: 6674 6572 2864 6f72 6566 7265 7368 2920  fter(dorefresh) 
+000284f0: 2320 506f 7374 706f 6e65 2074 6f20 616c  # Postpone to al
+00028500: 6c6f 7720 636f 6e66 2075 7064 6174 650d  low conf update.
+00028510: 0a0d 0a0d 0a20 2020 2064 6566 2075 7064  .....    def upd
+00028520: 6174 655f 6c69 7665 696e 666f 2873 656c  ate_liveinfo(sel
+00028530: 6629 3a0d 0a20 2020 2020 2020 2022 2222  f):..        """
+00028540: 5265 6672 6573 6865 7320 6163 636f 756e  Refreshes accoun
+00028550: 7420 7365 7474 696e 6773 2069 6e20 6c6f  t settings in lo
+00028560: 6769 6e2d 7061 6765 2066 726f 6d20 636f  gin-page from co
+00028570: 6e66 6967 7572 6174 696f 6e2e 2222 220d  nfiguration.""".
+00028580: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+00028590: 7365 6c66 3a20 7265 7475 726e 0d0a 2020  self: return..  
+000285a0: 2020 2020 2020 6f70 7473 203d 2063 6f6e        opts = con
+000285b0: 662e 4c6f 6769 6e2e 6765 7428 7365 6c66  f.Login.get(self
+000285c0: 2e64 622e 6669 6c65 6e61 6d65 2920 6f72  .db.filename) or
+000285d0: 207b 7d0d 0a20 2020 2020 2020 2073 656c   {}..        sel
+000285e0: 662e 6564 6974 5f75 7365 722e 5661 6c75  f.edit_user.Valu
+000285f0: 6520 3d20 7365 6c66 2e64 622e 7573 6572  e = self.db.user
+00028600: 6e61 6d65 2069 6620 7365 6c66 2e64 622e  name if self.db.
+00028610: 7573 6572 6e61 6d65 2065 6c73 6520 2222  username else ""
+00028620: 0d0a 2020 2020 2020 2020 7365 6c66 2e62  ..        self.b
+00028630: 7574 746f 6e5f 6c6f 6769 6e2e 4c61 6265  utton_login.Labe
+00028640: 6c20 3d20 2226 4c6f 6720 696e 2061 7320  l = "&Log in as 
+00028650: 2725 7327 2220 2520 7365 6c66 2e65 6469  '%s'" % self.edi
+00028660: 745f 7573 6572 2e56 616c 7565 0d0a 2020  t_user.Value..  
+00028670: 2020 2020 2020 7472 793a 2073 656c 662e        try: self.
+00028680: 6564 6974 5f70 772e 4368 616e 6765 5661  edit_pw.ChangeVa
+00028690: 6c75 6528 7574 696c 2e64 656f 6266 7573  lue(util.deobfus
+000286a0: 6361 7465 286f 7074 732e 6765 7428 2270  cate(opts.get("p
+000286b0: 6173 7377 6f72 6422 2c20 2222 2929 290d  assword", ""))).
+000286c0: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+000286d0: 4578 6365 7074 696f 6e20 6173 2065 3a20  Exception as e: 
+000286e0: 6c6f 6767 6572 2e65 7272 6f72 2822 4572  logger.error("Er
+000286f0: 726f 7220 6465 636f 6469 6e67 2073 746f  ror decoding sto
+00028700: 7265 6420 7061 7373 776f 7264 3a20 2573  red password: %s
+00028710: 222c 2075 7469 6c2e 666f 726d 6174 5f65  ", util.format_e
+00028720: 7863 2865 2929 0d0a 2020 2020 2020 2020  xc(e))..        
+00028730: 7365 6c66 2e63 6865 636b 5f6c 6f67 696e  self.check_login
+00028740: 5f73 746f 7265 2e56 616c 7565 203d 206f  _store.Value = o
+00028750: 7074 732e 6765 7428 2273 746f 7265 222c  pts.get("store",
+00028760: 2046 616c 7365 290d 0a20 2020 2020 2020   False)..       
+00028770: 2073 656c 662e 6368 6563 6b5f 6c6f 6769   self.check_logi
+00028780: 6e5f 6175 746f 2e56 616c 7565 2020 3d20  n_auto.Value  = 
+00028790: 6f70 7473 2e67 6574 2822 6175 746f 222c  opts.get("auto",
+000287a0: 2020 4661 6c73 6529 2061 6e64 2073 656c    False) and sel
+000287b0: 662e 6368 6563 6b5f 6c6f 6769 6e5f 7374  f.check_login_st
+000287c0: 6f72 652e 5661 6c75 650d 0a20 2020 2020  ore.Value..     
+000287d0: 2020 2073 656c 662e 6368 6563 6b5f 6c6f     self.check_lo
+000287e0: 6769 6e5f 7379 6e63 2e56 616c 7565 2020  gin_sync.Value  
+000287f0: 3d20 6f70 7473 2e67 6574 2822 7379 6e63  = opts.get("sync
+00028800: 222c 2020 4661 6c73 6529 2061 6e64 2073  ",  False) and s
+00028810: 656c 662e 6368 6563 6b5f 6c6f 6769 6e5f  elf.check_login_
+00028820: 6175 746f 202e 5661 6c75 650d 0a20 2020  auto .Value..   
+00028830: 2020 2020 2073 656c 662e 6368 6563 6b5f       self.check_
+00028840: 6c6f 6769 6e5f 6175 746f 2e45 6e61 626c  login_auto.Enabl
+00028850: 6528 7365 6c66 2e63 6865 636b 5f6c 6f67  e(self.check_log
+00028860: 696e 5f73 746f 7265 2e56 616c 7565 290d  in_store.Value).
+00028870: 0a20 2020 2020 2020 2073 656c 662e 6368  .        self.ch
+00028880: 6563 6b5f 6c6f 6769 6e5f 7379 6e63 2e45  eck_login_sync.E
+00028890: 6e61 626c 6528 7365 6c66 2e63 6865 636b  nable(self.check
+000288a0: 5f6c 6f67 696e 5f61 7574 6f20 2e56 616c  _login_auto .Val
+000288b0: 7565 290d 0a20 2020 2020 2020 2073 656c  ue)..        sel
+000288c0: 662e 6368 6563 6b5f 7379 6e63 5f63 6f6e  f.check_sync_con
+000288d0: 7461 6374 732e 5661 6c75 6520 3d20 6f70  tacts.Value = op
+000288e0: 7473 2e67 6574 2822 7379 6e63 5f63 6f6e  ts.get("sync_con
+000288f0: 7461 6374 7322 2c20 5472 7565 290d 0a20  tacts", True).. 
+00028900: 2020 2020 2020 2073 656c 662e 6368 6563         self.chec
+00028910: 6b5f 7379 6e63 5f6f 6c64 6572 2e56 616c  k_sync_older.Val
+00028920: 7565 2020 2020 3d20 6f70 7473 2e67 6574  ue    = opts.get
+00028930: 2822 7379 6e63 5f6f 6c64 6572 222c 2020  ("sync_older",  
+00028940: 2020 5472 7565 290d 0a20 2020 2020 2020    True)..       
+00028950: 2069 6620 7365 6c66 2e64 622e 6c69 7665   if self.db.live
+00028960: 2e69 735f 6c6f 6767 6564 5f69 6e28 2920  .is_logged_in() 
+00028970: 616e 6420 7365 6c66 2e62 7574 746f 6e5f  and self.button_
+00028980: 6c6f 6769 6e2e 456e 6162 6c65 643a 0d0a  login.Enabled:..
+00028990: 2020 2020 2020 2020 2020 2020 2320 5072              # Pr
+000289a0: 6f62 6162 6c65 2061 7574 6f2d 6c6f 6769  obable auto-logi
+000289b0: 6e20 6475 7269 6e67 2048 544d 4c20 6578  n during HTML ex
+000289c0: 706f 7274 0d0a 2020 2020 2020 2020 2020  port..          
+000289d0: 2020 7365 6c66 2e65 6469 745f 6c6f 6769    self.edit_logi
+000289e0: 6e5f 7374 6174 7573 2e56 616c 7565 203d  n_status.Value =
+000289f0: 2027 4c6f 6767 6564 2069 6e20 746f 2053   'Logged in to S
+00028a00: 6b79 7065 2061 7320 2225 7322 2720 2520  kype as "%s"' % 
+00028a10: 7365 6c66 2e64 622e 7573 6572 6e61 6d65  self.db.username
+00028a20: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00028a30: 6c66 2e62 7574 746f 6e5f 6c6f 6769 6e2e  lf.button_login.
+00028a40: 4469 7361 626c 6528 290d 0a20 2020 2020  Disable()..     
+00028a50: 2020 2020 2020 2073 656c 662e 6c61 6265         self.labe
+00028a60: 6c5f 6c6f 6769 6e5f 6661 696c 2e48 6964  l_login_fail.Hid
+00028a70: 6528 290d 0a20 2020 2020 2020 2020 2020  e()..           
+00028a80: 2066 6f72 2063 2069 6e20 636f 6e74 726f   for c in contro
+00028a90: 6c73 2e67 6574 5f63 6f6e 7472 6f6c 7328  ls.get_controls(
+00028aa0: 7365 6c66 2e70 616e 656c 5f73 796e 6329  self.panel_sync)
+00028ab0: 3a20 632e 456e 6162 6c65 2829 0d0a 2020  : c.Enable()..  
+00028ac0: 2020 2020 2020 2020 2020 7365 6c66 2e62            self.b
+00028ad0: 7574 746f 6e5f 7379 6e63 5f73 746f 702e  utton_sync_stop.
+00028ae0: 4469 7361 626c 6528 290d 0a0d 0a0d 0a20  Disable()...... 
+00028af0: 2020 2064 6566 206f 6e5f 6368 616e 6765     def on_change
+00028b00: 5f6c 6976 655f 7573 6572 2873 656c 662c  _live_user(self,
+00028b10: 2065 7665 6e74 293a 0d0a 2020 2020 2020   event):..      
+00028b20: 2020 2222 2248 616e 646c 6572 2066 6f72    """Handler for
+00028b30: 2063 6c69 636b 696e 6720 746f 2063 6861   clicking to cha
+00028b40: 6e67 6520 6c69 7665 206c 6f67 696e 206e  nge live login n
+00028b50: 616d 652c 206f 7065 6e73 2069 6e70 7574  ame, opens input
+00028b60: 2064 6961 6c6f 672e 2222 220d 0a20 2020   dialog."""..   
+00028b70: 2020 2020 206d 7367 203d 2022 5370 6563       msg = "Spec
+00028b80: 6966 7920 616e 6f74 6865 7220 6c6f 6769  ify another logi
+00028b90: 6e20 6e61 6d65 2066 6f72 2053 6b79 7065  n name for Skype
+00028ba0: 206f 6e6c 696e 652e 5c6e 5c6e 2220 5c0d   online.\n\n" \.
+00028bb0: 0a20 2020 2020 2020 2020 2020 2020 2022  .              "
+00028bc0: 5468 6973 2073 686f 756c 6420 6265 2074  This should be t
+00028bd0: 6865 2075 7365 726e 616d 6520 7468 6174  he username that
+00028be0: 2077 6f72 6b73 2066 6f72 204d 6963 726f   works for Micro
+00028bf0: 736f 6674 204c 6976 6520 6c6f 6769 6e3a  soft Live login:
+00028c00: 220d 0a20 2020 2020 2020 2064 6c67 203d  "..        dlg =
+00028c10: 2077 782e 5465 7874 456e 7472 7944 6961   wx.TextEntryDia
+00028c20: 6c6f 6728 7365 6c66 2c20 6d73 672c 2063  log(self, msg, c
+00028c30: 6f6e 662e 5469 746c 652c 2076 616c 7565  onf.Title, value
+00028c40: 3d73 656c 662e 6462 2e75 7365 726e 616d  =self.db.usernam
+00028c50: 6520 6f72 2022 222c 0d0a 2020 2020 2020  e or "",..      
+00028c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028c70: 2020 2020 2020 2020 2020 2073 7479 6c65             style
+00028c80: 3d77 782e 4f4b 207c 2077 782e 4341 4e43  =wx.OK | wx.CANC
+00028c90: 454c 290d 0a20 2020 2020 2020 2064 6c67  EL)..        dlg
+00028ca0: 2e43 656e 7465 724f 6e50 6172 656e 7428  .CenterOnParent(
+00028cb0: 290d 0a20 2020 2020 2020 2069 6620 7778  )..        if wx
+00028cc0: 2e49 445f 4f4b 2021 3d20 646c 672e 5368  .ID_OK != dlg.Sh
+00028cd0: 6f77 4d6f 6461 6c28 293a 2072 6574 7572  owModal(): retur
+00028ce0: 6e0d 0a0d 0a20 2020 2020 2020 2076 203d  n....        v =
+00028cf0: 2064 6c67 2e47 6574 5661 6c75 6528 292e   dlg.GetValue().
+00028d00: 7374 7269 7028 290d 0a20 2020 2020 2020  strip()..       
+00028d10: 2069 6620 6e6f 7420 763a 2072 6574 7572   if not v: retur
+00028d20: 6e0d 0a0d 0a20 2020 2020 2020 2069 6620  n....        if 
+00028d30: 7620 3d3d 2073 656c 662e 6462 2e69 6420  v == self.db.id 
+00028d40: 616e 6420 7620 213d 2073 656c 662e 6462  and v != self.db
+00028d50: 2e75 7365 726e 616d 653a 2076 203d 204e  .username: v = N
+00028d60: 6f6e 650d 0a20 2020 2020 2020 2073 656c  one..        sel
+00028d70: 662e 6462 2e75 7064 6174 655f 726f 7728  f.db.update_row(
+00028d80: 2261 6363 6f75 6e74 7322 2c20 7b22 6c69  "accounts", {"li
+00028d90: 7665 6964 5f6d 656d 6265 726e 616d 6522  veid_membername"
+00028da0: 3a20 767d 2c20 7365 6c66 2e64 622e 6163  : v}, self.db.ac
+00028db0: 636f 756e 7429 0d0a 2020 2020 2020 2020  count)..        
+00028dc0: 7365 6c66 2e64 622e 6163 636f 756e 745b  self.db.account[
+00028dd0: 226c 6976 6569 645f 6d65 6d62 6572 6e61  "liveid_memberna
+00028de0: 6d65 225d 203d 2076 0d0a 2020 2020 2020  me"] = v..      
+00028df0: 2020 7365 6c66 2e64 622e 7573 6572 6e61    self.db.userna
+00028e00: 6d65 203d 2076 206f 7220 7365 6c66 2e64  me = v or self.d
+00028e10: 622e 6964 0d0a 2020 2020 2020 2020 7365  b.id..        se
+00028e20: 6c66 2e65 6469 745f 7573 6572 2e56 616c  lf.edit_user.Val
+00028e30: 7565 203d 2073 656c 662e 6462 2e75 7365  ue = self.db.use
+00028e40: 726e 616d 650d 0a20 2020 2020 2020 2073  rname..        s
+00028e50: 656c 662e 6275 7474 6f6e 5f6c 6f67 696e  elf.button_login
+00028e60: 2e4c 6162 656c 203d 2022 264c 6f67 2069  .Label = "&Log i
+00028e70: 6e20 6173 2027 2573 2722 2025 2073 656c  n as '%s'" % sel
+00028e80: 662e 6462 2e75 7365 726e 616d 650d 0a20  f.db.username.. 
+00028e90: 2020 2020 2020 2073 656c 662e 7570 6461         self.upda
+00028ea0: 7465 5f61 6363 6f75 6e74 696e 666f 2829  te_accountinfo()
+00028eb0: 0d0a 0d0a 0d0a 2020 2020 6465 6620 6f6e  ......    def on
+00028ec0: 5f63 6861 6e67 655f 6374 726c 5f6c 6f67  _change_ctrl_log
+00028ed0: 696e 2873 656c 662c 2065 7665 6e74 293a  in(self, event):
+00028ee0: 0d0a 2020 2020 2020 2020 2222 2248 616e  ..        """Han
+00028ef0: 646c 6572 2066 6f72 2063 6861 6e67 696e  dler for changin
+00028f00: 6720 6120 6c6f 6769 6e20 636f 6e74 726f  g a login contro
+00028f10: 6c20 6c69 6b65 2070 6173 7377 6f72 6420  l like password 
+00028f20: 6f72 2063 6865 636b 626f 7865 732c 2075  or checkboxes, u
+00028f30: 7064 6174 6573 2063 6f6e 662e 2222 220d  pdates conf.""".
+00028f40: 0a20 2020 2020 2020 2063 7472 6c2c 2076  .        ctrl, v
+00028f50: 616c 7565 203d 2065 7665 6e74 2e45 7665  alue = event.Eve
+00028f60: 6e74 4f62 6a65 6374 2c20 6576 656e 742e  ntObject, event.
+00028f70: 4576 656e 744f 626a 6563 742e 5661 6c75  EventObject.Valu
+00028f80: 650d 0a20 2020 2020 2020 2069 6620 6374  e..        if ct
+00028f90: 726c 2069 7320 7365 6c66 2e65 6469 745f  rl is self.edit_
+00028fa0: 7077 3a0d 0a20 2020 2020 2020 2020 2020  pw:..           
+00028fb0: 206e 616d 652c 2076 616c 7565 203d 2022   name, value = "
+00028fc0: 7061 7373 776f 7264 222c 2075 7469 6c2e  password", util.
+00028fd0: 6f62 6675 7363 6174 6528 7661 6c75 6529  obfuscate(value)
+00028fe0: 0d0a 2020 2020 2020 2020 656c 6966 2063  ..        elif c
+00028ff0: 7472 6c20 6973 2073 656c 662e 6368 6563  trl is self.chec
+00029000: 6b5f 6c6f 6769 6e5f 7374 6f72 653a 2020  k_login_store:  
+00029010: 206e 616d 6520 3d20 2273 746f 7265 220d   name = "store".
+00029020: 0a20 2020 2020 2020 2065 6c69 6620 6374  .        elif ct
+00029030: 726c 2069 7320 7365 6c66 2e63 6865 636b  rl is self.check
+00029040: 5f6c 6f67 696e 5f61 7574 6f3a 2020 2020  _login_auto:    
+00029050: 6e61 6d65 203d 2022 6175 746f 220d 0a20  name = "auto".. 
+00029060: 2020 2020 2020 2065 6c69 6620 6374 726c         elif ctrl
+00029070: 2069 7320 7365 6c66 2e63 6865 636b 5f6c   is self.check_l
+00029080: 6f67 696e 5f73 796e 633a 2020 2020 6e61  ogin_sync:    na
+00029090: 6d65 203d 2022 7379 6e63 220d 0a20 2020  me = "sync"..   
+000290a0: 2020 2020 2065 6c69 6620 6374 726c 2069       elif ctrl i
+000290b0: 7320 7365 6c66 2e63 6865 636b 5f73 796e  s self.check_syn
+000290c0: 635f 636f 6e74 6163 7473 3a20 6e61 6d65  c_contacts: name
+000290d0: 203d 2022 7379 6e63 5f63 6f6e 7461 6374   = "sync_contact
+000290e0: 7322 0d0a 2020 2020 2020 2020 656c 6966  s"..        elif
+000290f0: 2063 7472 6c20 6973 2073 656c 662e 6368   ctrl is self.ch
+00029100: 6563 6b5f 7379 6e63 5f6f 6c64 6572 3a20  eck_sync_older: 
+00029110: 2020 206e 616d 6520 3d20 2273 796e 635f     name = "sync_
+00029120: 6f6c 6465 7222 0d0a 2020 2020 2020 2020  older"..        
+00029130: 6966 206e 6f74 2073 656c 662e 6368 6563  if not self.chec
+00029140: 6b5f 6c6f 6769 6e5f 7374 6f72 652e 5661  k_login_store.Va
+00029150: 6c75 653a 2073 656c 662e 6368 6563 6b5f  lue: self.check_
+00029160: 6c6f 6769 6e5f 6175 746f 2e56 616c 7565  login_auto.Value
+00029170: 203d 2046 616c 7365 0d0a 2020 2020 2020   = False..      
+00029180: 2020 6966 206e 6f74 2073 656c 662e 6368    if not self.ch
+00029190: 6563 6b5f 6c6f 6769 6e5f 6175 746f 202e  eck_login_auto .
+000291a0: 5661 6c75 653a 2073 656c 662e 6368 6563  Value: self.chec
+000291b0: 6b5f 6c6f 6769 6e5f 7379 6e63 2e56 616c  k_login_sync.Val
+000291c0: 7565 203d 2046 616c 7365 0d0a 2020 2020  ue = False..    
+000291d0: 2020 2020 7365 6c66 2e63 6865 636b 5f6c      self.check_l
+000291e0: 6f67 696e 5f61 7574 6f2e 456e 6162 6c65  ogin_auto.Enable
+000291f0: 2873 656c 662e 6368 6563 6b5f 6c6f 6769  (self.check_logi
+00029200: 6e5f 7374 6f72 652e 5661 6c75 6529 0d0a  n_store.Value)..
+00029210: 2020 2020 2020 2020 7365 6c66 2e63 6865          self.che
+00029220: 636b 5f6c 6f67 696e 5f73 796e 632e 456e  ck_login_sync.En
+00029230: 6162 6c65 2873 656c 662e 6368 6563 6b5f  able(self.check_
+00029240: 6c6f 6769 6e5f 6175 746f 2e56 616c 7565  login_auto.Value
+00029250: 290d 0a20 2020 2020 2020 2063 6f6e 662e  )..        conf.
+00029260: 4c6f 6769 6e2e 7365 7464 6566 6175 6c74  Login.setdefault
+00029270: 2873 656c 662e 6462 2e66 696c 656e 616d  (self.db.filenam
+00029280: 652c 207b 7d29 5b6e 616d 655d 203d 2076  e, {})[name] = v
+00029290: 616c 7565 0d0a 2020 2020 2020 2020 6966  alue..        if
+000292a0: 2022 7374 6f72 6522 203d 3d20 6e61 6d65   "store" == name
+000292b0: 2061 6e64 2076 616c 7565 2061 6e64 2073   and value and s
+000292c0: 656c 662e 6564 6974 5f70 772e 5661 6c75  elf.edit_pw.Valu
+000292d0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+000292e0: 7077 203d 2075 7469 6c2e 6f62 6675 7363  pw = util.obfusc
+000292f0: 6174 6528 7365 6c66 2e65 6469 745f 7077  ate(self.edit_pw
+00029300: 2e56 616c 7565 290d 0a20 2020 2020 2020  .Value)..       
+00029310: 2020 2020 2063 6f6e 662e 4c6f 6769 6e5b       conf.Login[
+00029320: 7365 6c66 2e64 622e 6669 6c65 6e61 6d65  self.db.filename
+00029330: 5d5b 2270 6173 7377 6f72 6422 5d20 3d20  ]["password"] = 
+00029340: 7077 0d0a 2020 2020 2020 2020 6966 206e  pw..        if n
+00029350: 6f74 2073 656c 662e 6368 6563 6b5f 6c6f  ot self.check_lo
+00029360: 6769 6e5f 7374 6f72 652e 5661 6c75 653a  gin_store.Value:
+00029370: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00029380: 6c66 2e63 6865 636b 5f6c 6f67 696e 5f61  lf.check_login_a
+00029390: 7574 6f2e 5661 6c75 6520 3d20 7365 6c66  uto.Value = self
+000293a0: 2e63 6865 636b 5f6c 6f67 696e 5f73 796e  .check_login_syn
+000293b0: 632e 5661 6c75 6520 3d20 4661 6c73 650d  c.Value = False.
+000293c0: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
+000293d0: 662e 4c6f 6769 6e5b 7365 6c66 2e64 622e  f.Login[self.db.
+000293e0: 6669 6c65 6e61 6d65 5d2e 706f 7028 2273  filename].pop("s
+000293f0: 746f 7265 222c 2020 2020 4e6f 6e65 290d  tore",    None).
+00029400: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
+00029410: 662e 4c6f 6769 6e5b 7365 6c66 2e64 622e  f.Login[self.db.
+00029420: 6669 6c65 6e61 6d65 5d2e 706f 7028 2261  filename].pop("a
+00029430: 7574 6f22 2c20 2020 2020 4e6f 6e65 290d  uto",     None).
+00029440: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
+00029450: 662e 4c6f 6769 6e5b 7365 6c66 2e64 622e  f.Login[self.db.
+00029460: 6669 6c65 6e61 6d65 5d2e 706f 7028 2273  filename].pop("s
+00029470: 796e 6322 2c20 2020 2020 4e6f 6e65 290d  ync",     None).
+00029480: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
+00029490: 662e 4c6f 6769 6e5b 7365 6c66 2e64 622e  f.Login[self.db.
+000294a0: 6669 6c65 6e61 6d65 5d2e 706f 7028 2270  filename].pop("p
+000294b0: 6173 7377 6f72 6422 2c20 4e6f 6e65 290d  assword", None).
+000294c0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+000294d0: 7365 6c66 2e63 6865 636b 5f6c 6f67 696e  self.check_login
+000294e0: 5f61 7574 6f2e 5661 6c75 653a 0d0a 2020  _auto.Value:..  
+000294f0: 2020 2020 2020 2020 2020 7365 6c66 2e63            self.c
+00029500: 6865 636b 5f6c 6f67 696e 5f73 796e 632e  heck_login_sync.
+00029510: 5661 6c75 6520 3d20 4661 6c73 650d 0a20  Value = False.. 
+00029520: 2020 2020 2020 2020 2020 2063 6f6e 662e             conf.
+00029530: 4c6f 6769 6e5b 7365 6c66 2e64 622e 6669  Login[self.db.fi
+00029540: 6c65 6e61 6d65 5d2e 706f 7028 2261 7574  lename].pop("aut
+00029550: 6f22 2c20 2020 2020 4e6f 6e65 290d 0a20  o",     None).. 
+00029560: 2020 2020 2020 2020 2020 2063 6f6e 662e             conf.
+00029570: 4c6f 6769 6e5b 7365 6c66 2e64 622e 6669  Login[self.db.fi
+00029580: 6c65 6e61 6d65 5d2e 706f 7028 2273 796e  lename].pop("syn
+00029590: 6322 2c20 2020 2020 4e6f 6e65 290d 0a20  c",     None).. 
+000295a0: 2020 2020 2020 2069 6620 6e6f 7420 7365         if not se
+000295b0: 6c66 2e63 6865 636b 5f6c 6f67 696e 5f73  lf.check_login_s
+000295c0: 796e 632e 5661 6c75 653a 0d0a 2020 2020  ync.Value:..    
+000295d0: 2020 2020 2020 2020 636f 6e66 2e4c 6f67          conf.Log
+000295e0: 696e 5b73 656c 662e 6462 2e66 696c 656e  in[self.db.filen
+000295f0: 616d 655d 2e70 6f70 2822 7379 6e63 222c  ame].pop("sync",
+00029600: 2020 2020 204e 6f6e 6529 0d0a 2020 2020       None)..    
+00029610: 2020 2020 6966 2073 656c 662e 6368 6563      if self.chec
+00029620: 6b5f 7379 6e63 5f63 6f6e 7461 6374 732e  k_sync_contacts.
+00029630: 5661 6c75 653a 0d0a 2020 2020 2020 2020  Value:..        
+00029640: 2020 2020 636f 6e66 2e4c 6f67 696e 5b73      conf.Login[s
+00029650: 656c 662e 6462 2e66 696c 656e 616d 655d  elf.db.filename]
+00029660: 2e70 6f70 2822 7379 6e63 5f63 6f6e 7461  .pop("sync_conta
+00029670: 6374 7322 2c20 4e6f 6e65 290d 0a20 2020  cts", None)..   
+00029680: 2020 2020 2069 6620 7365 6c66 2e63 6865       if self.che
+00029690: 636b 5f73 796e 635f 6f6c 6465 722e 5661  ck_sync_older.Va
+000296a0: 6c75 653a 0d0a 2020 2020 2020 2020 2020  lue:..          
+000296b0: 2020 636f 6e66 2e4c 6f67 696e 5b73 656c    conf.Login[sel
+000296c0: 662e 6462 2e66 696c 656e 616d 655d 2e70  f.db.filename].p
+000296d0: 6f70 2822 7379 6e63 5f6f 6c64 6572 222c  op("sync_older",
+000296e0: 204e 6f6e 6529 0d0a 2020 2020 2020 2020   None)..        
+000296f0: 6966 206e 6f74 2063 6f6e 662e 4c6f 6769  if not conf.Logi
+00029700: 6e5b 7365 6c66 2e64 622e 6669 6c65 6e61  n[self.db.filena
+00029710: 6d65 5d3a 2063 6f6e 662e 4c6f 6769 6e2e  me]: conf.Login.
+00029720: 706f 7028 7365 6c66 2e64 622e 6669 6c65  pop(self.db.file
+00029730: 6e61 6d65 290d 0a20 2020 2020 2020 2075  name)..        u
+00029740: 7469 6c2e 7275 6e5f 6f6e 6365 2863 6f6e  til.run_once(con
+00029750: 662e 7361 7665 290d 0a0d 0a0d 0a20 2020  f.save)......   
+00029760: 2064 6566 206f 6e5f 6c69 7374 5f63 6861   def on_list_cha
+00029770: 7473 5f6b 6579 2873 656c 662c 2065 7665  ts_key(self, eve
+00029780: 6e74 293a 0d0a 2020 2020 2020 2020 2222  nt):..        ""
+00029790: 220d 0a20 2020 2020 2020 2048 616e 646c  "..        Handl
+000297a0: 6572 2066 6f72 2070 7265 7373 696e 6720  er for pressing 
+000297b0: 6120 6b65 7920 696e 2063 6861 7473 206c  a key in chats l
+000297c0: 6973 742c 206f 7065 6e73 2072 656e 616d  ist, opens renam
+000297d0: 6520 6469 616c 6f67 206f 6e20 4632 2c0d  e dialog on F2,.
+000297e0: 0a20 2020 2020 2020 2061 6e64 2066 6f63  .        and foc
+000297f0: 7573 6573 2066 696c 7465 7220 6f6e 2043  uses filter on C
+00029800: 7472 6c2d 462e 0d0a 2020 2020 2020 2020  trl-F...        
+00029810: 2222 220d 0a20 2020 2020 2020 2069 6620  """..        if 
+00029820: 6576 656e 742e 4b65 7943 6f64 6520 696e  event.KeyCode in
+00029830: 205b 6f72 6428 2246 2229 5d20 616e 6420   [ord("F")] and 
+00029840: 6576 656e 742e 436d 6444 6f77 6e28 293a  event.CmdDown():
+00029850: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00029860: 6c66 2e65 6469 745f 6368 6174 6669 6c74  lf.edit_chatfilt
+00029870: 6572 2e53 6574 466f 6375 7328 290d 0a20  er.SetFocus().. 
+00029880: 2020 2020 2020 2065 6c69 6620 6576 656e         elif even
+00029890: 742e 4b65 7943 6f64 6520 696e 205b 7778  t.KeyCode in [wx
+000298a0: 2e57 584b 5f46 325d 2061 6e64 2073 656c  .WXK_F2] and sel
+000298b0: 662e 6c69 7374 5f63 6861 7473 2e53 656c  f.list_chats.Sel
+000298c0: 6563 7465 6449 7465 6d43 6f75 6e74 203d  ectedItemCount =
+000298d0: 3d20 313a 0d0a 2020 2020 2020 2020 2020  = 1:..          
+000298e0: 2020 6974 656d 203d 2073 656c 662e 6c69    item = self.li
+000298f0: 7374 5f63 6861 7473 2e47 6574 4974 656d  st_chats.GetItem
+00029900: 4d61 7070 6564 4461 7461 2873 656c 662e  MappedData(self.
+00029910: 6c69 7374 5f63 6861 7473 2e47 6574 4669  list_chats.GetFi
+00029920: 7273 7453 656c 6563 7465 6428 2929 0d0a  rstSelected())..
+00029930: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00029940: 2e6f 6e5f 7265 6e61 6d65 5f63 6861 7428  .on_rename_chat(
+00029950: 6368 6174 3d69 7465 6d29 0d0a 2020 2020  chat=item)..    
+00029960: 2020 2020 6576 656e 742e 536b 6970 2829      event.Skip()
+00029970: 0d0a 0d0a 0d0a 2020 2020 6465 6620 6f6e  ......    def on
+00029980: 5f6c 6973 745f 636f 6e74 6163 7473 5f6b  _list_contacts_k
+00029990: 6579 2873 656c 662c 2065 7665 6e74 293a  ey(self, event):
+000299a0: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
+000299b0: 2020 2020 2020 2048 616e 646c 6572 2066         Handler f
+000299c0: 6f72 2070 7265 7373 696e 6720 6120 6b65  or pressing a ke
+000299d0: 7920 696e 2063 6f6e 7461 6374 7320 6c69  y in contacts li
+000299e0: 7374 2c20 6f70 656e 7320 7265 6e61 6d65  st, opens rename
+000299f0: 2064 6961 6c6f 6720 6f6e 2046 322c 0d0a   dialog on F2,..
+00029a00: 2020 2020 2020 2020 616e 6420 666f 6375          and focu
+00029a10: 7365 7320 6669 6c74 6572 206f 6e20 4374  ses filter on Ct
+00029a20: 726c 2d46 2e0d 0a20 2020 2020 2020 2022  rl-F...        "
+00029a30: 2222 0d0a 2020 2020 2020 2020 6966 2065  ""..        if e
+00029a40: 7665 6e74 2e4b 6579 436f 6465 2069 6e20  vent.KeyCode in 
+00029a50: 5b6f 7264 2822 4622 295d 2061 6e64 2065  [ord("F")] and e
+00029a60: 7665 6e74 2e43 6d64 446f 776e 2829 3a0d  vent.CmdDown():.
+00029a70: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00029a80: 662e 6564 6974 5f63 6f6e 7461 6374 6669  f.edit_contactfi
+00029a90: 6c74 6572 2e53 6574 466f 6375 7328 290d  lter.SetFocus().
+00029aa0: 0a20 2020 2020 2020 2065 6c69 6620 6576  .        elif ev
+00029ab0: 656e 742e 4b65 7943 6f64 6520 696e 205b  ent.KeyCode in [
+00029ac0: 7778 2e57 584b 5f46 325d 2061 6e64 2073  wx.WXK_F2] and s
+00029ad0: 656c 662e 6c69 7374 5f63 6f6e 7461 6374  elf.list_contact
+00029ae0: 732e 5365 6c65 6374 6564 4974 656d 436f  s.SelectedItemCo
+00029af0: 756e 7420 3d3d 2031 3a0d 0a20 2020 2020  unt == 1:..     
+00029b00: 2020 2020 2020 2069 7465 6d20 3d20 7365         item = se
+00029b10: 6c66 2e6c 6973 745f 636f 6e74 6163 7473  lf.list_contacts
+00029b20: 2e47 6574 4974 656d 4d61 7070 6564 4461  .GetItemMappedDa
+00029b30: 7461 2873 656c 662e 6c69 7374 5f63 6f6e  ta(self.list_con
+00029b40: 7461 6374 732e 4765 7446 6972 7374 5365  tacts.GetFirstSe
+00029b50: 6c65 6374 6564 2829 290d 0a20 2020 2020  lected())..     
+00029b60: 2020 2020 2020 2073 656c 662e 6f6e 5f72         self.on_r
+00029b70: 656e 616d 655f 636f 6e74 6163 7428 636f  ename_contact(co
+00029b80: 6e74 6163 743d 6974 656d 290d 0a20 2020  ntact=item)..   
+00029b90: 2020 2020 2065 7665 6e74 2e53 6b69 7028       event.Skip(
+00029ba0: 290d 0a0d 0a0d 0a20 2020 2064 6566 206f  )......    def o
+00029bb0: 6e5f 6d65 6e75 5f6c 6973 745f 6368 6174  n_menu_list_chat
+00029bc0: 7328 7365 6c66 2c20 6576 656e 7429 3a0d  s(self, event):.
+00029bd0: 0a20 2020 2020 2020 2022 2222 4861 6e64  .        """Hand
+00029be0: 6c65 7220 666f 7220 7269 6768 742d 636c  ler for right-cl
+00029bf0: 6963 6b69 6e67 2063 6861 746c 6973 7420  icking chatlist 
+00029c00: 6f72 2063 6861 7420 6163 7469 6f6e 732d  or chat actions-
+00029c10: 6275 7474 6f6e 2c20 6f70 656e 7320 706f  button, opens po
+00029c20: 7075 7020 6d65 6e75 2e22 2222 0d0a 2020  pup menu."""..  
+00029c30: 2020 2020 2020 6966 2065 7665 6e74 2e45        if event.E
+00029c40: 7665 6e74 4f62 6a65 6374 2069 7320 7365  ventObject is se
+00029c50: 6c66 2e62 7574 746f 6e5f 6163 7469 6f6e  lf.button_action
+00029c60: 5f63 6861 743a 0d0a 2020 2020 2020 2020  _chat:..        
+00029c70: 2020 2020 6368 6174 732c 2066 756c 6c6d      chats, fullm
+00029c80: 656e 7520 3d20 5b73 656c 662e 6368 6174  enu = [self.chat
+00029c90: 5d2c 2046 616c 7365 0d0a 2020 2020 2020  ], False..      
+00029ca0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+00029cb0: 2020 2020 2063 6861 7473 2c20 7365 6c65       chats, sele
+00029cc0: 6374 6564 732c 2066 756c 6c6d 656e 7520  cteds, fullmenu 
+00029cd0: 3d20 5b5d 2c20 5b5d 2c20 5472 7565 0d0a  = [], [], True..
+00029ce0: 2020 2020 2020 2020 2020 2020 7365 6c65              sele
+00029cf0: 6374 6564 203d 2073 656c 662e 6c69 7374  cted = self.list
+00029d00: 5f63 6861 7473 2e47 6574 4669 7273 7453  _chats.GetFirstS
+00029d10: 656c 6563 7465 6428 290d 0a20 2020 2020  elected()..     
+00029d20: 2020 2020 2020 2077 6869 6c65 2073 656c         while sel
+00029d30: 6563 7465 6420 3e3d 2030 3a0d 0a20 2020  ected >= 0:..   
+00029d40: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00029d50: 6563 7465 6473 2e61 7070 656e 6428 7365  ecteds.append(se
+00029d60: 6c65 6374 6564 290d 0a20 2020 2020 2020  lected)..       
+00029d70: 2020 2020 2020 2020 2063 6861 7473 2e61           chats.a
+00029d80: 7070 656e 6428 7365 6c66 2e6c 6973 745f  ppend(self.list_
+00029d90: 6368 6174 732e 4765 7449 7465 6d4d 6170  chats.GetItemMap
+00029da0: 7065 6444 6174 6128 7365 6c65 6374 6564  pedData(selected
+00029db0: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
+00029dc0: 2020 2020 7365 6c65 6374 6564 203d 2073      selected = s
+00029dd0: 656c 662e 6c69 7374 5f63 6861 7473 2e47  elf.list_chats.G
+00029de0: 6574 4e65 7874 5365 6c65 6374 6564 2873  etNextSelected(s
+00029df0: 656c 6563 7465 6429 0d0a 2020 2020 2020  elected)..      
+00029e00: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+00029e10: 6e63 6528 6576 656e 742c 2077 782e 4c69  nce(event, wx.Li
+00029e20: 7374 4576 656e 7429 2061 6e64 2065 7665  stEvent) and eve
+00029e30: 6e74 2e47 6574 496e 6465 7828 2920 3e3d  nt.GetIndex() >=
+00029e40: 2030 205c 0d0a 2020 2020 2020 2020 2020   0 \..          
+00029e50: 2020 616e 6420 6576 656e 742e 4765 7449    and event.GetI
+00029e60: 6e64 6578 2829 206e 6f74 2069 6e20 7365  ndex() not in se
+00029e70: 6c65 6374 6564 733a 0d0a 2020 2020 2020  lecteds:..      
+00029e80: 2020 2020 2020 2020 2020 6368 6174 7320            chats 
+00029e90: 3d20 5b73 656c 662e 6c69 7374 5f63 6861  = [self.list_cha
+00029ea0: 7473 2e47 6574 4974 656d 4d61 7070 6564  ts.GetItemMapped
+00029eb0: 4461 7461 2865 7665 6e74 2e47 6574 496e  Data(event.GetIn
+00029ec0: 6465 7828 2929 5d0d 0a20 2020 2020 2020  dex())]..       
+00029ed0: 2069 6620 6e6f 7420 6368 6174 733a 2072   if not chats: r
+00029ee0: 6574 7572 6e0d 0a0d 0a20 2020 2020 2020  eturn....       
+00029ef0: 2063 6861 745f 636f 6c73 203d 2073 656c   chat_cols = sel
+00029f00: 662e 6462 2e67 6574 5f74 6162 6c65 5f63  f.db.get_table_c
+00029f10: 6f6c 756d 6e73 2822 636f 6e76 6572 7361  olumns("conversa
+00029f20: 7469 6f6e 7322 290d 0a20 2020 2020 2020  tions")..       
+00029f30: 2063 6f6e 7461 6374 5f63 6f6c 7320 3d20   contact_cols = 
+00029f40: 7365 6c66 2e64 622e 6765 745f 7461 626c  self.db.get_tabl
+00029f50: 655f 636f 6c75 6d6e 7328 2263 6f6e 7461  e_columns("conta
+00029f60: 6374 7322 290d 0a20 2020 2020 2020 206e  cts")..        n
+00029f70: 616d 6520 3d20 2822 4f70 656e 2025 7320  ame = ("Open %s 
+00029f80: 2220 2520 6368 6174 735b 305d 5b22 7469  " % chats[0]["ti
+00029f90: 746c 655f 6c6f 6e67 5f6c 6322 5d29 2069  tle_long_lc"]) i
+00029fa0: 6620 6c65 6e28 6368 6174 7329 203c 2032  f len(chats) < 2
+00029fb0: 205c 0d0a 2020 2020 2020 2020 2020 2020   \..            
+00029fc0: 2020 2065 6c73 6520 7574 696c 2e70 6c75     else util.plu
+00029fd0: 7261 6c28 2263 6861 7422 2c20 6368 6174  ral("chat", chat
+00029fe0: 7329 0d0a 0d0a 2020 2020 2020 2020 6465  s)....        de
+00029ff0: 6620 636c 6970 626f 6172 6469 7a65 2863  f clipboardize(c
+0002a000: 6174 6567 6f72 7929 3a0d 0a20 2020 2020  ategory):..     
+0002a010: 2020 2020 2020 2069 6620 2274 6974 6c65         if "title
+0002a020: 2220 3d3d 2063 6174 6567 6f72 793a 0d0a  " == category:..
 0002a030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a040: 2020 2020 2020 6966 2070 5b22 6964 656e        if p["iden
-0002a050: 7469 7479 225d 2021 3d20 7365 6c66 2e64  tity"] != self.d
-0002a060: 622e 6964 290d 0a20 2020 2020 2020 2020  b.id)..         
-0002a070: 2020 2020 2020 2065 6c73 653a 2074 6578         else: tex
-0002a080: 7420 3d20 225c 6e5c 6e22 2e6a 6f69 6e28  t = "\n\n".join(
-0002a090: 2225 733a 5c6e 2020 2573 2220 2520 2863  "%s:\n  %s" % (c
-0002a0a0: 5b22 7469 746c 655f 6c6f 6e67 225d 2c20  ["title_long"], 
-0002a0b0: 225c 6e20 2022 2e6a 6f69 6e28 0d0a 2020  "\n  ".join(..  
-0002a0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a0d0: 2020 6e61 6d65 7228 7029 2066 6f72 2070    namer(p) for p
-0002a0e0: 2069 6e20 635b 2270 6172 7469 6369 7061   in c["participa
-0002a0f0: 6e74 7322 5d20 6966 2070 5b22 6964 656e  nts"] if p["iden
-0002a100: 7469 7479 225d 2021 3d20 7365 6c66 2e64  tity"] != self.d
-0002a110: 622e 6964 0d0a 2020 2020 2020 2020 2020  b.id..          
-0002a120: 2020 2020 2020 2929 2066 6f72 2063 2069        )) for c i
-0002a130: 6e20 6368 6174 7329 2023 2047 726f 7570  n chats) # Group
-0002a140: 2063 6861 7420 413a 5c6e 2020 6e61 6d65   chat A:\n  name
-0002a150: 315c 6e6e 616d 6532 5c6e 5c6e 4772 6f75  1\nname2\n\nGrou
-0002a160: 7020 6368 6174 2042 2e2e 0d0a 2020 2020  p chat B....    
-0002a170: 2020 2020 2020 2020 6966 2077 782e 5468          if wx.Th
-0002a180: 6543 6c69 7062 6f61 7264 2e4f 7065 6e28  eClipboard.Open(
-0002a190: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-0002a1a0: 2020 2020 6420 3d20 7778 2e54 6578 7444      d = wx.TextD
-0002a1b0: 6174 614f 626a 6563 7428 7465 7874 290d  ataObject(text).
-0002a1c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002a1d0: 2077 782e 5468 6543 6c69 7062 6f61 7264   wx.TheClipboard
-0002a1e0: 2e53 6574 4461 7461 2864 292c 2077 782e  .SetData(d), wx.
-0002a1f0: 5468 6543 6c69 7062 6f61 7264 2e43 6c6f  TheClipboard.Clo
-0002a200: 7365 2829 0d0a 0d0a 2020 2020 2020 2020  se()....        
-0002a210: 6465 6620 6578 706f 7274 6572 2864 6f5f  def exporter(do_
-0002a220: 7369 6e67 6c65 6669 6c65 3d46 616c 7365  singlefile=False
-0002a230: 2c20 646f 5f74 696d 6572 616e 6765 3d46  , do_timerange=F
-0002a240: 616c 7365 293a 0d0a 2020 2020 2020 2020  alse):..        
-0002a250: 2020 2020 7365 6c66 2e6f 6e5f 6578 706f      self.on_expo
-0002a260: 7274 5f63 6861 7473 2863 6861 7473 2c20  rt_chats(chats, 
-0002a270: 4661 6c73 652c 2064 6f5f 7369 6e67 6c65  False, do_single
-0002a280: 6669 6c65 2c20 646f 5f74 696d 6572 616e  file, do_timeran
-0002a290: 6765 290d 0a0d 0a20 2020 2020 2020 2064  ge)....        d
-0002a2a0: 6566 2073 796e 6328 6d65 7373 6167 6573  ef sync(messages
-0002a2b0: 3d46 616c 7365 293a 0d0a 2020 2020 2020  =False):..      
-0002a2c0: 2020 2020 2020 6d79 6368 6174 732c 206d        mychats, m
-0002a2d0: 7963 6f6e 7461 6374 7320 3d20 6368 6174  ycontacts = chat
-0002a2e0: 732c 204e 6f6e 650d 0a20 2020 2020 2020  s, None..       
-0002a2f0: 2020 2020 2069 6620 6e6f 7420 6d65 7373       if not mess
-0002a300: 6167 6573 3a0d 0a20 2020 2020 2020 2020  ages:..         
-0002a310: 2020 2020 2020 2069 6465 6e74 6974 6965         identitie
-0002a320: 7320 3d20 7365 7428 705b 2269 6465 6e74  s = set(p["ident
-0002a330: 6974 7922 5d20 666f 7220 6320 696e 2063  ity"] for c in c
-0002a340: 6861 7473 2066 6f72 2070 2069 6e20 635b  hats for p in c[
-0002a350: 2270 6172 7469 6369 7061 6e74 7322 5d29  "participants"])
-0002a360: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0002a370: 2020 6d79 636f 6e74 6163 7473 203d 205b    mycontacts = [
-0002a380: 7820 666f 7220 7820 696e 2073 656c 662e  x for x in self.
-0002a390: 636f 6e74 6163 7473 2069 6620 785b 2269  contacts if x["i
-0002a3a0: 6465 6e74 6974 7922 5d20 696e 2069 6465  dentity"] in ide
-0002a3b0: 6e74 6974 6965 735d 0d0a 2020 2020 2020  ntities]..      
-0002a3c0: 2020 2020 2020 7365 6c66 2e6f 6e5f 6c69        self.on_li
-0002a3d0: 7665 5f73 796e 635f 6974 656d 7328 6d79  ve_sync_items(my
-0002a3e0: 6368 6174 732c 206d 7963 6f6e 7461 6374  chats, mycontact
-0002a3f0: 732c 206d 6573 7361 6765 733d 6d65 7373  s, messages=mess
-0002a400: 6167 6573 290d 0a0d 0a20 2020 2020 2020  ages)....       
-0002a410: 206d 656e 752c 2070 6d65 6e75 2c20 736d   menu, pmenu, sm
-0002a420: 656e 752c 2078 6d65 6e75 203d 2077 782e  enu, xmenu = wx.
-0002a430: 4d65 6e75 2829 2c20 7778 2e4d 656e 7528  Menu(), wx.Menu(
-0002a440: 292c 2077 782e 4d65 6e75 2829 2c20 4e6f  ), wx.Menu(), No
-0002a450: 6e65 0d0a 2020 2020 2020 2020 666f 7220  ne..        for 
-0002a460: 7020 696e 2063 6861 7473 5b30 5d5b 2270  p in chats[0]["p
-0002a470: 6172 7469 6369 7061 6e74 7322 5d20 6966  articipants"] if
-0002a480: 206c 656e 2863 6861 7473 2920 3d3d 2031   len(chats) == 1
-0002a490: 2065 6c73 6520 2829 3a0d 0a20 2020 2020   else ():..     
-0002a4a0: 2020 2020 2020 2069 7465 6d20 3d20 7778         item = wx
-0002a4b0: 2e4d 656e 7549 7465 6d28 6d65 6e75 2c20  .MenuItem(menu, 
-0002a4c0: 2d31 2c20 2225 286e 616d 6529 7320 2825  -1, "%(name)s (%
-0002a4d0: 2869 6465 6e74 6974 7929 7329 2220 2520  (identity)s)" % 
-0002a4e0: 705b 2263 6f6e 7461 6374 225d 290d 0a20  p["contact"]).. 
-0002a4f0: 2020 2020 2020 2020 2020 2070 6d65 6e75             pmenu
-0002a500: 2e41 7070 656e 6428 6974 656d 290d 0a20  .Append(item).. 
-0002a510: 2020 2020 2020 2020 2020 2070 6d65 6e75             pmenu
-0002a520: 2e42 696e 6428 7778 2e45 5654 5f4d 454e  .Bind(wx.EVT_MEN
-0002a530: 552c 2066 756e 6374 6f6f 6c73 2e70 6172  U, functools.par
-0002a540: 7469 616c 2873 656c 662e 6f6e 5f72 656e  tial(self.on_ren
-0002a550: 616d 655f 636f 6e74 6163 742c 2070 5b22  ame_contact, p["
-0002a560: 636f 6e74 6163 7422 5d29 2c0d 0a20 2020  contact"]),..   
-0002a570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a580: 2020 2020 6964 3d69 7465 6d2e 4765 7449      id=item.GetI
-0002a590: 6428 2929 0d0a 2020 2020 2020 2020 6966  d())..        if
-0002a5a0: 2066 756c 6c6d 656e 753a 0d0a 2020 2020   fullmenu:..    
-0002a5b0: 2020 2020 2020 2020 6974 656d 5f6e 616d          item_nam
-0002a5c0: 6520 3d20 7778 2e4d 656e 7549 7465 6d28  e = wx.MenuItem(
-0002a5d0: 6d65 6e75 2c20 2d31 2c20 6e61 6d65 290d  menu, -1, name).
-0002a5e0: 0a20 2020 2020 2020 2069 7465 6d5f 636f  .        item_co
-0002a5f0: 7079 2020 2020 203d 2077 782e 4d65 6e75  py     = wx.Menu
-0002a600: 4974 656d 286d 656e 752c 202d 312c 2022  Item(menu, -1, "
-0002a610: 2643 6f70 7920 2573 2220 250d 0a20 2020  &Copy %s" %..   
-0002a620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a640: 2075 7469 6c2e 706c 7572 616c 2822 7469   util.plural("ti
-0002a650: 746c 6522 2c20 6368 6174 732c 206e 756d  tle", chats, num
-0002a660: 6265 7273 3d46 616c 7365 2929 0d0a 2020  bers=False))..  
-0002a670: 2020 2020 2020 6974 656d 5f63 6f70 7963        item_copyc
-0002a680: 6f6e 2020 3d20 7778 2e4d 656e 7549 7465  on  = wx.MenuIte
-0002a690: 6d28 6d65 6e75 2c20 2d31 2c20 2243 6f70  m(menu, -1, "Cop
-0002a6a0: 7920 2573 2220 250d 0a20 2020 2020 2020  y %s" %..       
-0002a6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a6c0: 2020 2020 2020 2020 2020 2020 2075 7469               uti
-0002a6d0: 6c2e 706c 7572 616c 2822 636f 6e26 7461  l.plural("con&ta
-0002a6e0: 6374 206e 616d 6522 2c0d 0a20 2020 2020  ct name",..     
-0002a6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a700: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0002a710: 6861 7473 5b30 5d5b 2270 6172 7469 6369  hats[0]["partici
-0002a720: 7061 6e74 7322 5d5b 313a 5d20 6966 206c  pants"][1:] if l
-0002a730: 656e 2863 6861 7473 2920 3c20 3220 656c  en(chats) < 2 el
-0002a740: 7365 2063 6861 7473 2c0d 0a20 2020 2020  se chats,..     
-0002a750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a760: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-0002a770: 756d 6265 7273 3d46 616c 7365 2929 0d0a  umbers=False))..
-0002a780: 2020 2020 2020 2020 6974 656d 5f72 656e          item_ren
-0002a790: 616d 6520 2020 3d20 7778 2e4d 656e 7549  ame   = wx.MenuI
-0002a7a0: 7465 6d28 6d65 6e75 2c20 2d31 2c20 2252  tem(menu, -1, "R
-0002a7b0: 6526 6e61 6d65 2229 0d0a 0d0a 2020 2020  e&name")....    
-0002a7c0: 2020 2020 6974 656d 5f73 796e 636d 2020      item_syncm  
+0002a040: 7465 7874 203d 2022 5c6e 222e 6a6f 696e  text = "\n".join
+0002a050: 2863 5b22 7469 746c 6522 5d20 666f 7220  (c["title"] for 
+0002a060: 6320 696e 2063 6861 7473 290d 0a20 2020  c in chats)..   
+0002a070: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
+0002a080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a090: 6e61 6d65 7220 3d20 6c61 6d62 6461 2070  namer = lambda p
+0002a0a0: 3a20 705b 2269 6465 6e74 6974 7922 5d20  : p["identity"] 
+0002a0b0: 6966 2070 5b22 636f 6e74 6163 7422 5d2e  if p["contact"].
+0002a0c0: 6765 7428 226e 616d 6522 2920 5c0d 0a20  get("name") \.. 
+0002a0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a0f0: 2061 6e64 2070 5b22 6964 656e 7469 7479   and p["identity
+0002a100: 225d 203d 3d20 705b 2263 6f6e 7461 6374  "] == p["contact
+0002a110: 225d 5b22 6e61 6d65 225d 205c 0d0a 2020  "]["name"] \..  
+0002a120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a140: 656c 7365 2022 2573 2028 2573 2922 2025  else "%s (%s)" %
+0002a150: 2028 705b 2263 6f6e 7461 6374 225d 5b22   (p["contact"]["
+0002a160: 6e61 6d65 225d 2c20 705b 2269 6465 6e74  name"], p["ident
+0002a170: 6974 7922 5d29 0d0a 2020 2020 2020 2020  ity"])..        
+0002a180: 2020 2020 2020 2020 6966 206c 656e 2863          if len(c
+0002a190: 6861 7473 2920 3c20 323a 2023 206e 616d  hats) < 2: # nam
+0002a1a0: 6531 5c6e 6e61 6d65 320d 0a20 2020 2020  e1\nname2..     
+0002a1b0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0002a1c0: 6578 7420 3d20 225c 6e22 2e6a 6f69 6e28  ext = "\n".join(
+0002a1d0: 6e61 6d65 7228 7029 2066 6f72 2070 2069  namer(p) for p i
+0002a1e0: 6e20 6368 6174 735b 305d 5b22 7061 7274  n chats[0]["part
+0002a1f0: 6963 6970 616e 7473 225d 0d0a 2020 2020  icipants"]..    
+0002a200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a220: 2069 6620 705b 2269 6465 6e74 6974 7922   if p["identity"
+0002a230: 5d20 213d 2073 656c 662e 6462 2e69 6429  ] != self.db.id)
+0002a240: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0002a250: 2020 656c 7365 3a20 7465 7874 203d 2022    else: text = "
+0002a260: 5c6e 5c6e 222e 6a6f 696e 2822 2573 3a5c  \n\n".join("%s:\
+0002a270: 6e20 2025 7322 2025 2028 635b 2274 6974  n  %s" % (c["tit
+0002a280: 6c65 5f6c 6f6e 6722 5d2c 2022 5c6e 2020  le_long"], "\n  
+0002a290: 222e 6a6f 696e 280d 0a20 2020 2020 2020  ".join(..       
+0002a2a0: 2020 2020 2020 2020 2020 2020 206e 616d               nam
+0002a2b0: 6572 2870 2920 666f 7220 7020 696e 2063  er(p) for p in c
+0002a2c0: 5b22 7061 7274 6963 6970 616e 7473 225d  ["participants"]
+0002a2d0: 2069 6620 705b 2269 6465 6e74 6974 7922   if p["identity"
+0002a2e0: 5d20 213d 2073 656c 662e 6462 2e69 640d  ] != self.db.id.
+0002a2f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002a300: 2029 2920 666f 7220 6320 696e 2063 6861   )) for c in cha
+0002a310: 7473 2920 2320 4772 6f75 7020 6368 6174  ts) # Group chat
+0002a320: 2041 3a5c 6e20 206e 616d 6531 5c6e 6e61   A:\n  name1\nna
+0002a330: 6d65 325c 6e5c 6e47 726f 7570 2063 6861  me2\n\nGroup cha
+0002a340: 7420 422e 2e0d 0a20 2020 2020 2020 2020  t B....         
+0002a350: 2020 2069 6620 7778 2e54 6865 436c 6970     if wx.TheClip
+0002a360: 626f 6172 642e 4f70 656e 2829 3a0d 0a20  board.Open():.. 
+0002a370: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0002a380: 203d 2077 782e 5465 7874 4461 7461 4f62   = wx.TextDataOb
+0002a390: 6a65 6374 2874 6578 7429 0d0a 2020 2020  ject(text)..    
+0002a3a0: 2020 2020 2020 2020 2020 2020 7778 2e54              wx.T
+0002a3b0: 6865 436c 6970 626f 6172 642e 5365 7444  heClipboard.SetD
+0002a3c0: 6174 6128 6429 2c20 7778 2e54 6865 436c  ata(d), wx.TheCl
+0002a3d0: 6970 626f 6172 642e 436c 6f73 6528 290d  ipboard.Close().
+0002a3e0: 0a0d 0a20 2020 2020 2020 2064 6566 2065  ...        def e
+0002a3f0: 7870 6f72 7465 7228 646f 5f73 696e 676c  xporter(do_singl
+0002a400: 6566 696c 653d 4661 6c73 652c 2064 6f5f  efile=False, do_
+0002a410: 7469 6d65 7261 6e67 653d 4661 6c73 6529  timerange=False)
+0002a420: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+0002a430: 656c 662e 6f6e 5f65 7870 6f72 745f 6368  elf.on_export_ch
+0002a440: 6174 7328 6368 6174 732c 2046 616c 7365  ats(chats, False
+0002a450: 2c20 646f 5f73 696e 676c 6566 696c 652c  , do_singlefile,
+0002a460: 2064 6f5f 7469 6d65 7261 6e67 6529 0d0a   do_timerange)..
+0002a470: 0d0a 2020 2020 2020 2020 6465 6620 7379  ..        def sy
+0002a480: 6e63 286d 6573 7361 6765 733d 4661 6c73  nc(messages=Fals
+0002a490: 6529 3a0d 0a20 2020 2020 2020 2020 2020  e):..           
+0002a4a0: 206d 7963 6861 7473 2c20 6d79 636f 6e74   mychats, mycont
+0002a4b0: 6163 7473 203d 2063 6861 7473 2c20 4e6f  acts = chats, No
+0002a4c0: 6e65 0d0a 2020 2020 2020 2020 2020 2020  ne..            
+0002a4d0: 6966 206e 6f74 206d 6573 7361 6765 733a  if not messages:
+0002a4e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0002a4f0: 2020 6964 656e 7469 7469 6573 203d 2073    identities = s
+0002a500: 6574 2870 5b22 6964 656e 7469 7479 225d  et(p["identity"]
+0002a510: 2066 6f72 2063 2069 6e20 6368 6174 7320   for c in chats 
+0002a520: 666f 7220 7020 696e 2063 5b22 7061 7274  for p in c["part
+0002a530: 6963 6970 616e 7473 225d 290d 0a20 2020  icipants"])..   
+0002a540: 2020 2020 2020 2020 2020 2020 206d 7963               myc
+0002a550: 6f6e 7461 6374 7320 3d20 5b78 2066 6f72  ontacts = [x for
+0002a560: 2078 2069 6e20 7365 6c66 2e63 6f6e 7461   x in self.conta
+0002a570: 6374 7320 6966 2078 5b22 6964 656e 7469  cts if x["identi
+0002a580: 7479 225d 2069 6e20 6964 656e 7469 7469  ty"] in identiti
+0002a590: 6573 5d0d 0a20 2020 2020 2020 2020 2020  es]..           
+0002a5a0: 2073 656c 662e 6f6e 5f6c 6976 655f 7379   self.on_live_sy
+0002a5b0: 6e63 5f69 7465 6d73 286d 7963 6861 7473  nc_items(mychats
+0002a5c0: 2c20 6d79 636f 6e74 6163 7473 2c20 6d65  , mycontacts, me
+0002a5d0: 7373 6167 6573 3d6d 6573 7361 6765 7329  ssages=messages)
+0002a5e0: 0d0a 0d0a 2020 2020 2020 2020 6d65 6e75  ....        menu
+0002a5f0: 2c20 706d 656e 752c 2073 6d65 6e75 2c20  , pmenu, smenu, 
+0002a600: 786d 656e 7520 3d20 7778 2e4d 656e 7528  xmenu = wx.Menu(
+0002a610: 292c 2077 782e 4d65 6e75 2829 2c20 7778  ), wx.Menu(), wx
+0002a620: 2e4d 656e 7528 292c 204e 6f6e 650d 0a20  .Menu(), None.. 
+0002a630: 2020 2020 2020 2066 6f72 2070 2069 6e20         for p in 
+0002a640: 6368 6174 735b 305d 5b22 7061 7274 6963  chats[0]["partic
+0002a650: 6970 616e 7473 225d 2069 6620 6c65 6e28  ipants"] if len(
+0002a660: 6368 6174 7329 203d 3d20 3120 656c 7365  chats) == 1 else
+0002a670: 2028 293a 0d0a 2020 2020 2020 2020 2020   ():..          
+0002a680: 2020 6974 656d 203d 2077 782e 4d65 6e75    item = wx.Menu
+0002a690: 4974 656d 286d 656e 752c 202d 312c 2022  Item(menu, -1, "
+0002a6a0: 2528 6e61 6d65 2973 2028 2528 6964 656e  %(name)s (%(iden
+0002a6b0: 7469 7479 2973 2922 2025 2070 5b22 636f  tity)s)" % p["co
+0002a6c0: 6e74 6163 7422 5d29 0d0a 2020 2020 2020  ntact"])..      
+0002a6d0: 2020 2020 2020 706d 656e 752e 4170 7065        pmenu.Appe
+0002a6e0: 6e64 2869 7465 6d29 0d0a 2020 2020 2020  nd(item)..      
+0002a6f0: 2020 2020 2020 706d 656e 752e 4269 6e64        pmenu.Bind
+0002a700: 2877 782e 4556 545f 4d45 4e55 2c20 6675  (wx.EVT_MENU, fu
+0002a710: 6e63 746f 6f6c 732e 7061 7274 6961 6c28  nctools.partial(
+0002a720: 7365 6c66 2e6f 6e5f 7265 6e61 6d65 5f63  self.on_rename_c
+0002a730: 6f6e 7461 6374 2c20 705b 2263 6f6e 7461  ontact, p["conta
+0002a740: 6374 225d 292c 0d0a 2020 2020 2020 2020  ct"]),..        
+0002a750: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0002a760: 643d 6974 656d 2e47 6574 4964 2829 290d  d=item.GetId()).
+0002a770: 0a20 2020 2020 2020 2069 6620 6675 6c6c  .        if full
+0002a780: 6d65 6e75 3a0d 0a20 2020 2020 2020 2020  menu:..         
+0002a790: 2020 2069 7465 6d5f 6e61 6d65 203d 2077     item_name = w
+0002a7a0: 782e 4d65 6e75 4974 656d 286d 656e 752c  x.MenuItem(menu,
+0002a7b0: 202d 312c 206e 616d 6529 0d0a 2020 2020   -1, name)..    
+0002a7c0: 2020 2020 6974 656d 5f63 6f70 7920 2020      item_copy   
 0002a7d0: 2020 3d20 7778 2e4d 656e 7549 7465 6d28    = wx.MenuItem(
-0002a7e0: 6d65 6e75 2c20 2d31 2c20 2253 796e 6368  menu, -1, "Synch
-0002a7f0: 726f 6e69 7a65 2026 6d65 7373 6167 6573  ronize &messages
-0002a800: 2061 6e64 2070 726f 6669 6c65 7322 290d   and profiles").
-0002a810: 0a20 2020 2020 2020 2069 7465 6d5f 7379  .        item_sy
-0002a820: 6e63 7020 2020 203d 2077 782e 4d65 6e75  ncp    = wx.Menu
-0002a830: 4974 656d 286d 656e 752c 202d 312c 2022  Item(menu, -1, "
-0002a840: 5379 6e63 6872 6f6e 697a 6520 2670 726f  Synchronize &pro
-0002a850: 6669 6c65 7322 290d 0a20 2020 2020 2020  files")..       
-0002a860: 2073 6d65 6e75 2e41 7070 656e 6428 6974   smenu.Append(it
-0002a870: 656d 5f73 796e 636d 290d 0a20 2020 2020  em_syncm)..     
-0002a880: 2020 2073 6d65 6e75 2e41 7070 656e 6428     smenu.Append(
-0002a890: 6974 656d 5f73 796e 6370 290d 0a0d 0a20  item_syncp).... 
-0002a8a0: 2020 2020 2020 2069 6620 6675 6c6c 6d65         if fullme
-0002a8b0: 6e75 3a0d 0a20 2020 2020 2020 2020 2020  nu:..           
-0002a8c0: 2069 7465 6d5f 6578 706f 7274 203d 2077   item_export = w
-0002a8d0: 782e 4d65 6e75 4974 656d 286d 656e 752c  x.MenuItem(menu,
-0002a8e0: 202d 312c 2022 2645 7870 6f72 7420 746f   -1, "&Export to
-0002a8f0: 2025 7322 2025 0d0a 2020 2020 2020 2020   %s" %..        
-0002a900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a910: 2020 2020 2020 2020 2020 2020 2020 7574                ut
-0002a920: 696c 2e70 6c75 7261 6c28 2266 696c 6522  il.plural("file"
-0002a930: 2c20 6368 6174 732c 206e 756d 6265 7273  , chats, numbers
-0002a940: 3d46 616c 7365 2929 0d0a 2020 2020 2020  =False))..      
-0002a950: 2020 2020 2020 6974 656d 5f65 7870 6f72        item_expor
-0002a960: 746d 203d 2069 7465 6d5f 6461 7465 736d  tm = item_datesm
-0002a970: 203d 204e 6f6e 650d 0a20 2020 2020 2020   = None..       
-0002a980: 2069 6620 6675 6c6c 6d65 6e75 2061 6e64   if fullmenu and
-0002a990: 2065 7870 6f72 742e 786c 7378 7772 6974   export.xlsxwrit
-0002a9a0: 6572 2061 6e64 206c 656e 2863 6861 7473  er and len(chats
-0002a9b0: 2920 3e20 313a 0d0a 2020 2020 2020 2020  ) > 1:..        
-0002a9c0: 2020 2020 786d 656e 7520 3d20 7778 2e4d      xmenu = wx.M
-0002a9d0: 656e 7528 290d 0a20 2020 2020 2020 2020  enu()..         
-0002a9e0: 2020 2069 7465 6d5f 6578 706f 7274 6d20     item_exportm 
-0002a9f0: 3d20 7778 2e4d 656e 7549 7465 6d28 6d65  = wx.MenuItem(me
-0002aa00: 6e75 2c20 2d31 2c20 2243 6861 7473 206f  nu, -1, "Chats o
-0002aa10: 6e20 2673 6570 6172 6174 6520 7368 6565  n &separate shee
-0002aa20: 7473 2229 0d0a 2020 2020 2020 2020 2020  ts")..          
-0002aa30: 2020 6974 656d 5f64 6174 6573 6d20 203d    item_datesm  =
-0002aa40: 2077 782e 4d65 6e75 4974 656d 286d 656e   wx.MenuItem(men
-0002aa50: 752c 202d 312c 2022 4368 6174 7320 696e  u, -1, "Chats in
-0002aa60: 2026 6461 7465 2072 616e 6765 206f 6e20   &date range on 
-0002aa70: 7365 7061 7261 7465 2073 6865 6574 7322  separate sheets"
-0002aa80: 290d 0a20 2020 2020 2020 2020 2020 2078  )..            x
-0002aa90: 6d65 6e75 2e41 7070 656e 6428 6974 656d  menu.Append(item
-0002aaa0: 5f65 7870 6f72 746d 290d 0a20 2020 2020  _exportm)..     
-0002aab0: 2020 2020 2020 2078 6d65 6e75 2e41 7070         xmenu.App
-0002aac0: 656e 6428 6974 656d 5f64 6174 6573 6d29  end(item_datesm)
-0002aad0: 0d0a 2020 2020 2020 2020 6966 2066 756c  ..        if ful
-0002aae0: 6c6d 656e 753a 0d0a 2020 2020 2020 2020  lmenu:..        
-0002aaf0: 2020 2020 6974 656d 5f64 6174 6573 2020      item_dates  
-0002ab00: 203d 2077 782e 4d65 6e75 4974 656d 286d   = wx.MenuItem(m
-0002ab10: 656e 752c 202d 312c 2022 4578 706f 7274  enu, -1, "Export
-0002ab20: 2026 6461 7465 2072 616e 6765 2074 6f20   &date range to 
-0002ab30: 6669 6c65 2229 0d0a 2020 2020 2020 2020  file")..        
-0002ab40: 6974 656d 5f64 656c 6574 6520 2020 2020  item_delete     
-0002ab50: 203d 2077 782e 4d65 6e75 4974 656d 286d   = wx.MenuItem(m
-0002ab60: 656e 752c 202d 312c 2022 4465 6c65 7465  enu, -1, "Delete
-0002ab70: 2066 726f 6d20 6461 7461 6261 7365 2229   from database")
-0002ab80: 0d0a 0d0a 2020 2020 2020 2020 6966 2066  ....        if f
-0002ab90: 756c 6c6d 656e 753a 0d0a 2020 2020 2020  ullmenu:..      
-0002aba0: 2020 2020 2020 626f 6c64 666f 6e74 203d        boldfont =
-0002abb0: 2077 782e 466f 6e74 2869 7465 6d5f 6e61   wx.Font(item_na
-0002abc0: 6d65 2e46 6f6e 7429 0d0a 2020 2020 2020  me.Font)..      
-0002abd0: 2020 2020 2020 626f 6c64 666f 6e74 2e53        boldfont.S
-0002abe0: 6574 5765 6967 6874 2877 782e 464f 4e54  etWeight(wx.FONT
-0002abf0: 5745 4947 4854 5f42 4f4c 4429 0d0a 2020  WEIGHT_BOLD)..  
-0002ac00: 2020 2020 2020 2020 2020 626f 6c64 666f            boldfo
-0002ac10: 6e74 2e53 6574 4661 6365 4e61 6d65 2873  nt.SetFaceName(s
-0002ac20: 656c 662e 466f 6e74 2e46 6163 654e 616d  elf.Font.FaceNam
-0002ac30: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
-0002ac40: 626f 6c64 666f 6e74 2e53 6574 506f 696e  boldfont.SetPoin
-0002ac50: 7453 697a 6528 7365 6c66 2e46 6f6e 742e  tSize(self.Font.
-0002ac60: 506f 696e 7453 697a 6529 0d0a 2020 2020  PointSize)..    
-0002ac70: 2020 2020 2020 2020 6974 656d 5f6e 616d          item_nam
-0002ac80: 652e 466f 6e74 203d 2062 6f6c 6466 6f6e  e.Font = boldfon
-0002ac90: 740d 0a0d 0a20 2020 2020 2020 2069 6620  t....        if 
-0002aca0: 6675 6c6c 6d65 6e75 3a0d 0a20 2020 2020  fullmenu:..     
-0002acb0: 2020 2020 2020 206d 656e 752e 4170 7065         menu.Appe
-0002acc0: 6e64 2869 7465 6d5f 6e61 6d65 290d 0a20  nd(item_name).. 
-0002acd0: 2020 2020 2020 2020 2020 206d 656e 752e             menu.
-0002ace0: 4170 7065 6e64 5365 7061 7261 746f 7228  AppendSeparator(
-0002acf0: 290d 0a20 2020 2020 2020 206d 656e 752e  )..        menu.
-0002ad00: 4170 7065 6e64 2869 7465 6d5f 636f 7079  Append(item_copy
-0002ad10: 290d 0a20 2020 2020 2020 206d 656e 752e  )..        menu.
-0002ad20: 4170 7065 6e64 2869 7465 6d5f 636f 7079  Append(item_copy
-0002ad30: 636f 6e29 0d0a 2020 2020 2020 2020 6d65  con)..        me
-0002ad40: 6e75 2e41 7070 656e 6453 6570 6172 6174  nu.AppendSeparat
-0002ad50: 6f72 2829 0d0a 2020 2020 2020 2020 6d65  or()..        me
-0002ad60: 6e75 2e41 7070 656e 6428 6974 656d 5f72  nu.Append(item_r
-0002ad70: 656e 616d 6529 0d0a 2020 2020 2020 2020  ename)..        
-0002ad80: 6974 656d 5f70 6172 7469 6369 7061 6e74  item_participant
-0002ad90: 7320 3d20 6d65 6e75 2e41 7070 656e 6453  s = menu.AppendS
-0002ada0: 7562 4d65 6e75 2870 6d65 6e75 2c20 2252  ubMenu(pmenu, "R
-0002adb0: 656e 2661 6d65 2070 6172 7469 6369 7061  en&ame participa
-0002adc0: 6e74 2229 0d0a 2020 2020 2020 2020 6d65  nt")..        me
-0002add0: 6e75 2e41 7070 656e 6453 6570 6172 6174  nu.AppendSeparat
-0002ade0: 6f72 2829 0d0a 2020 2020 2020 2020 6974  or()..        it
-0002adf0: 656d 5f73 796e 6320 2020 2020 2020 2020  em_sync         
-0002ae00: 3d20 6d65 6e75 2e41 7070 656e 6453 7562  = menu.AppendSub
-0002ae10: 4d65 6e75 2873 6d65 6e75 2c20 2255 7064  Menu(smenu, "Upd
-0002ae20: 6174 6520 6672 6f6d 206f 6e26 6c69 6e65  ate from on&line
-0002ae30: 2229 0d0a 2020 2020 2020 2020 6d65 6e75  ")..        menu
-0002ae40: 2e41 7070 656e 6453 6570 6172 6174 6f72  .AppendSeparator
-0002ae50: 2829 0d0a 2020 2020 2020 2020 6966 2066  ()..        if f
-0002ae60: 756c 6c6d 656e 753a 0d0a 2020 2020 2020  ullmenu:..      
-0002ae70: 2020 2020 2020 6d65 6e75 2e41 7070 656e        menu.Appen
-0002ae80: 6428 6974 656d 5f65 7870 6f72 7429 0d0a  d(item_export)..
-0002ae90: 2020 2020 2020 2020 2020 2020 6d65 6e75              menu
-0002aea0: 2e41 7070 656e 6428 6974 656d 5f64 6174  .Append(item_dat
-0002aeb0: 6573 290d 0a20 2020 2020 2020 2020 2020  es)..           
-0002aec0: 2069 6620 786d 656e 753a 206d 656e 752e   if xmenu: menu.
-0002aed0: 4170 7065 6e64 5375 624d 656e 7528 786d  AppendSubMenu(xm
-0002aee0: 656e 752c 2022 4578 706f 7274 2074 6f20  enu, "Export to 
-0002aef0: 6120 7369 6e67 6c65 2045 7863 656c 2026  a single Excel &
-0002af00: 776f 726b 626f 6f6b 2229 0d0a 2020 2020  workbook")..    
-0002af10: 2020 2020 2020 2020 6d65 6e75 2e41 7070          menu.App
-0002af20: 656e 6453 6570 6172 6174 6f72 2829 0d0a  endSeparator()..
-0002af30: 2020 2020 2020 2020 6d65 6e75 2e41 7070          menu.App
-0002af40: 656e 6428 6974 656d 5f64 656c 6574 6529  end(item_delete)
-0002af50: 0d0a 2020 2020 2020 2020 6966 2066 756c  ..        if ful
-0002af60: 6c6d 656e 753a 0d0a 2020 2020 2020 2020  lmenu:..        
-0002af70: 2020 2020 6974 656d 5f6e 616d 652e 456e      item_name.En
-0002af80: 6162 6c65 6420 2020 2020 3d20 2831 203d  abled     = (1 =
-0002af90: 3d20 6c65 6e28 6368 6174 7329 290d 0a20  = len(chats)).. 
-0002afa0: 2020 2020 2020 2069 7465 6d5f 7265 6e61         item_rena
-0002afb0: 6d65 2e45 6e61 626c 6564 2020 2020 2020  me.Enabled      
-0002afc0: 203d 2028 3120 3d3d 206c 656e 2863 6861   = (1 == len(cha
-0002afd0: 7473 2929 2061 6e64 2061 6e79 2878 5b22  ts)) and any(x["
-0002afe0: 6e61 6d65 225d 203d 3d20 2267 6976 656e  name"] == "given
-0002aff0: 5f64 6973 706c 6179 6e61 6d65 2220 666f  _displayname" fo
-0002b000: 7220 7820 696e 2063 6861 745f 636f 6c73  r x in chat_cols
-0002b010: 290d 0a20 2020 2020 2020 2069 7465 6d5f  )..        item_
-0002b020: 7061 7274 6963 6970 616e 7473 2e45 6e61  participants.Ena
-0002b030: 626c 6564 203d 2028 3120 3d3d 206c 656e  bled = (1 == len
-0002b040: 2863 6861 7473 2929 2061 6e64 2061 6e79  (chats)) and any
-0002b050: 2878 5b22 6e61 6d65 225d 203d 3d20 2267  (x["name"] == "g
-0002b060: 6976 656e 5f64 6973 706c 6179 6e61 6d65  iven_displayname
-0002b070: 2220 666f 7220 7820 696e 2063 6f6e 7461  " for x in conta
-0002b080: 6374 5f63 6f6c 7329 0d0a 0d0a 2020 2020  ct_cols)....    
-0002b090: 2020 2020 6966 2066 756c 6c6d 656e 753a      if fullmenu:
-0002b0a0: 0d0a 2020 2020 2020 2020 2020 2020 6d65  ..            me
-0002b0b0: 6e75 2e42 696e 6428 7778 2e45 5654 5f4d  nu.Bind(wx.EVT_M
-0002b0c0: 454e 552c 206c 616d 6264 6120 653a 2073  ENU, lambda e: s
-0002b0d0: 656c 662e 6c6f 6164 5f63 6861 7428 6368  elf.load_chat(ch
-0002b0e0: 6174 735b 305d 292c 2069 7465 6d5f 6e61  ats[0]), item_na
-0002b0f0: 6d65 290d 0a20 2020 2020 2020 206d 656e  me)..        men
-0002b100: 752e 4269 6e64 2877 782e 4556 545f 4d45  u.Bind(wx.EVT_ME
-0002b110: 4e55 2c20 206c 616d 6264 6120 653a 2063  NU,  lambda e: c
-0002b120: 6c69 7062 6f61 7264 697a 6528 2274 6974  lipboardize("tit
-0002b130: 6c65 2229 2c20 2020 2069 7465 6d5f 636f  le"),    item_co
-0002b140: 7079 290d 0a20 2020 2020 2020 206d 656e  py)..        men
-0002b150: 752e 4269 6e64 2877 782e 4556 545f 4d45  u.Bind(wx.EVT_ME
-0002b160: 4e55 2c20 206c 616d 6264 6120 653a 2063  NU,  lambda e: c
-0002b170: 6c69 7062 6f61 7264 697a 6528 2263 6f6e  lipboardize("con
-0002b180: 7461 6374 2229 2c20 2069 7465 6d5f 636f  tact"),  item_co
-0002b190: 7079 636f 6e29 0d0a 2020 2020 2020 2020  pycon)..        
-0002b1a0: 6d65 6e75 2e42 696e 6428 7778 2e45 5654  menu.Bind(wx.EVT
-0002b1b0: 5f4d 454e 552c 2020 6c61 6d62 6461 2065  _MENU,  lambda e
-0002b1c0: 3a20 7365 6c66 2e6f 6e5f 7265 6e61 6d65  : self.on_rename
-0002b1d0: 5f63 6861 7428 6368 6174 3d63 6861 7473  _chat(chat=chats
-0002b1e0: 5b30 5d29 2c20 6974 656d 5f72 656e 616d  [0]), item_renam
-0002b1f0: 6529 0d0a 2020 2020 2020 2020 736d 656e  e)..        smen
-0002b200: 752e 4269 6e64 2877 782e 4556 545f 4d45  u.Bind(wx.EVT_ME
-0002b210: 4e55 2c20 6c61 6d62 6461 2065 3a20 7379  NU, lambda e: sy
-0002b220: 6e63 286d 6573 7361 6765 733d 5472 7565  nc(messages=True
-0002b230: 292c 2069 643d 6974 656d 5f73 796e 636d  ), id=item_syncm
-0002b240: 2e47 6574 4964 2829 290d 0a20 2020 2020  .GetId())..     
-0002b250: 2020 2073 6d65 6e75 2e42 696e 6428 7778     smenu.Bind(wx
-0002b260: 2e45 5654 5f4d 454e 552c 206c 616d 6264  .EVT_MENU, lambd
-0002b270: 6120 653a 2073 796e 6328 292c 2069 643d  a e: sync(), id=
-0002b280: 6974 656d 5f73 796e 6370 2e47 6574 4964  item_syncp.GetId
-0002b290: 2829 290d 0a20 2020 2020 2020 2069 6620  ())..        if 
-0002b2a0: 6675 6c6c 6d65 6e75 3a0d 0a20 2020 2020  fullmenu:..     
-0002b2b0: 2020 2020 2020 206d 656e 752e 4269 6e64         menu.Bind
-0002b2c0: 2877 782e 4556 545f 4d45 4e55 2c20 6c61  (wx.EVT_MENU, la
-0002b2d0: 6d62 6461 2065 3a20 6578 706f 7274 6572  mbda e: exporter
-0002b2e0: 2846 616c 7365 2c20 4661 6c73 6529 2c20  (False, False), 
-0002b2f0: 6974 656d 5f65 7870 6f72 7429 0d0a 2020  item_export)..  
-0002b300: 2020 2020 2020 2020 2020 6d65 6e75 2e42            menu.B
-0002b310: 696e 6428 7778 2e45 5654 5f4d 454e 552c  ind(wx.EVT_MENU,
-0002b320: 206c 616d 6264 6120 653a 2065 7870 6f72   lambda e: expor
-0002b330: 7465 7228 4661 6c73 652c 2054 7275 6529  ter(False, True)
-0002b340: 2c20 2069 7465 6d5f 6461 7465 7329 0d0a  ,  item_dates)..
-0002b350: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-0002b360: 7465 6d5f 6578 706f 7274 6d3a 0d0a 2020  tem_exportm:..  
-0002b370: 2020 2020 2020 2020 2020 2020 2020 6d65                me
-0002b380: 6e75 2e42 696e 6428 7778 2e45 5654 5f4d  nu.Bind(wx.EVT_M
-0002b390: 454e 552c 206c 616d 6264 6120 653a 2065  ENU, lambda e: e
-0002b3a0: 7870 6f72 7465 7228 5472 7565 2c20 2046  xporter(True,  F
-0002b3b0: 616c 7365 292c 2069 7465 6d5f 6578 706f  alse), item_expo
-0002b3c0: 7274 6d29 0d0a 2020 2020 2020 2020 2020  rtm)..          
-0002b3d0: 2020 6966 2069 7465 6d5f 6461 7465 736d    if item_datesm
-0002b3e0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0002b3f0: 2020 206d 656e 752e 4269 6e64 2877 782e     menu.Bind(wx.
-0002b400: 4556 545f 4d45 4e55 2c20 6c61 6d62 6461  EVT_MENU, lambda
-0002b410: 2065 3a20 6578 706f 7274 6572 2854 7275   e: exporter(Tru
-0002b420: 652c 2020 5472 7565 292c 2020 6974 656d  e,  True),  item
-0002b430: 5f64 6174 6573 6d29 0d0a 2020 2020 2020  _datesm)..      
-0002b440: 2020 6d65 6e75 2e42 696e 6428 7778 2e45    menu.Bind(wx.E
-0002b450: 5654 5f4d 454e 552c 206c 616d 6264 6120  VT_MENU, lambda 
-0002b460: 653a 2073 656c 662e 6465 6c65 7465 5f63  e: self.delete_c
-0002b470: 6861 7473 2863 6861 7473 292c 2069 7465  hats(chats), ite
-0002b480: 6d5f 6465 6c65 7465 290d 0a0d 0a20 2020  m_delete)....   
-0002b490: 2020 2020 2069 6620 6675 6c6c 6d65 6e75       if fullmenu
-0002b4a0: 3a0d 0a20 2020 2020 2020 2020 2020 2023  :..            #
-0002b4b0: 204e 6565 6473 2063 616c 6c62 6163 6b2c   Needs callback,
-0002b4c0: 2061 6374 696f 6e73 2063 616e 206d 6f64   actions can mod
-0002b4d0: 6966 7920 6c69 7374 2077 6869 6c65 206d  ify list while m
-0002b4e0: 6f75 7365 2065 7665 6e74 206f 6e67 6f69  ouse event ongoi
-0002b4f0: 6e67 0d0a 2020 2020 2020 2020 2020 2020  ng..            
-0002b500: 7778 2e43 616c 6c41 6674 6572 2873 656c  wx.CallAfter(sel
-0002b510: 662e 6c69 7374 5f63 6861 7473 2e50 6f70  f.list_chats.Pop
-0002b520: 7570 4d65 6e75 2c20 6d65 6e75 290d 0a20  upMenu, menu).. 
-0002b530: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-0002b540: 2020 2020 2020 2020 2020 7365 6c66 2e62            self.b
-0002b550: 7574 746f 6e5f 6163 7469 6f6e 5f63 6861  utton_action_cha
-0002b560: 742e 506f 7075 704d 656e 7528 6d65 6e75  t.PopupMenu(menu
-0002b570: 2c20 2830 2c20 7365 6c66 2e62 7574 746f  , (0, self.butto
-0002b580: 6e5f 6163 7469 6f6e 5f63 6861 742e 5369  n_action_chat.Si
-0002b590: 7a65 5b31 5d29 290d 0a0d 0a0d 0a20 2020  ze[1]))......   
-0002b5a0: 2064 6566 206f 6e5f 6d65 6e75 5f6c 6973   def on_menu_lis
-0002b5b0: 745f 636f 6e74 6163 7473 2873 656c 662c  t_contacts(self,
-0002b5c0: 2065 7665 6e74 293a 0d0a 2020 2020 2020   event):..      
-0002b5d0: 2020 2222 2248 616e 646c 6572 2066 6f72    """Handler for
-0002b5e0: 2072 6967 6874 2d63 6c69 636b 696e 6720   right-clicking 
-0002b5f0: 636f 6e74 6163 746c 6973 7420 6f72 2063  contactlist or c
-0002b600: 6f6e 7461 6374 2061 6374 696f 6e73 2d62  ontact actions-b
-0002b610: 7574 746f 6e2c 206f 7065 6e73 2070 6f70  utton, opens pop
-0002b620: 7570 206d 656e 752e 2222 220d 0a20 2020  up menu."""..   
-0002b630: 2020 2020 2069 6620 6576 656e 742e 4576       if event.Ev
-0002b640: 656e 744f 626a 6563 7420 6973 2073 656c  entObject is sel
-0002b650: 662e 6275 7474 6f6e 5f61 6374 696f 6e5f  f.button_action_
-0002b660: 636f 6e74 6163 743a 0d0a 2020 2020 2020  contact:..      
-0002b670: 2020 2020 2020 636f 6e74 6163 7473 2c20        contacts, 
-0002b680: 6675 6c6c 6d65 6e75 203d 205b 7365 6c66  fullmenu = [self
-0002b690: 2e63 6f6e 7461 6374 5d2c 2046 616c 7365  .contact], False
-0002b6a0: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
-0002b6b0: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
-0002b6c0: 7461 6374 732c 2073 656c 6563 7465 6473  tacts, selecteds
-0002b6d0: 2c20 6675 6c6c 6d65 6e75 203d 205b 5d2c  , fullmenu = [],
-0002b6e0: 205b 5d2c 2054 7275 650d 0a20 2020 2020   [], True..     
-0002b6f0: 2020 2020 2020 2073 656c 6563 7465 6420         selected 
-0002b700: 3d20 7365 6c66 2e6c 6973 745f 636f 6e74  = self.list_cont
-0002b710: 6163 7473 2e47 6574 4669 7273 7453 656c  acts.GetFirstSel
-0002b720: 6563 7465 6428 290d 0a20 2020 2020 2020  ected()..       
-0002b730: 2020 2020 2077 6869 6c65 2073 656c 6563       while selec
-0002b740: 7465 6420 3e3d 2030 3a0d 0a20 2020 2020  ted >= 0:..     
-0002b750: 2020 2020 2020 2020 2020 2073 656c 6563             selec
-0002b760: 7465 6473 2e61 7070 656e 6428 7365 6c65  teds.append(sele
-0002b770: 6374 6564 290d 0a20 2020 2020 2020 2020  cted)..         
-0002b780: 2020 2020 2020 2063 6f6e 7461 6374 732e         contacts.
-0002b790: 6170 7065 6e64 2873 656c 662e 6c69 7374  append(self.list
-0002b7a0: 5f63 6f6e 7461 6374 732e 4765 7449 7465  _contacts.GetIte
-0002b7b0: 6d4d 6170 7065 6444 6174 6128 7365 6c65  mMappedData(sele
-0002b7c0: 6374 6564 2929 0d0a 2020 2020 2020 2020  cted))..        
-0002b7d0: 2020 2020 2020 2020 7365 6c65 6374 6564          selected
-0002b7e0: 203d 2073 656c 662e 6c69 7374 5f63 6f6e   = self.list_con
-0002b7f0: 7461 6374 732e 4765 744e 6578 7453 656c  tacts.GetNextSel
-0002b800: 6563 7465 6428 7365 6c65 6374 6564 290d  ected(selected).
-0002b810: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0002b820: 6973 696e 7374 616e 6365 2865 7665 6e74  isinstance(event
-0002b830: 2c20 7778 2e4c 6973 7445 7665 6e74 2920  , wx.ListEvent) 
-0002b840: 616e 6420 6576 656e 742e 4765 7449 6e64  and event.GetInd
-0002b850: 6578 2829 203e 3d20 3020 5c0d 0a20 2020  ex() >= 0 \..   
-0002b860: 2020 2020 2020 2020 2061 6e64 2065 7665           and eve
-0002b870: 6e74 2e47 6574 496e 6465 7828 2920 6e6f  nt.GetIndex() no
-0002b880: 7420 696e 2073 656c 6563 7465 6473 3a0d  t in selecteds:.
-0002b890: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002b8a0: 2063 6f6e 7461 6374 7320 3d20 5b73 656c   contacts = [sel
-0002b8b0: 662e 6c69 7374 5f63 6f6e 7461 6374 732e  f.list_contacts.
-0002b8c0: 4765 7449 7465 6d4d 6170 7065 6444 6174  GetItemMappedDat
-0002b8d0: 6128 6576 656e 742e 4765 7449 6e64 6578  a(event.GetIndex
-0002b8e0: 2829 295d 0d0a 2020 2020 2020 2020 2020  ())]..          
-0002b8f0: 2020 6966 206e 6f74 2063 6f6e 7461 6374    if not contact
-0002b900: 733a 2072 6574 7572 6e0d 0a0d 0a20 2020  s: return....   
-0002b910: 2020 2020 2063 6174 6567 6f72 7920 3d20       category = 
-0002b920: 2263 6f6e 7461 6374 220d 0a20 2020 2020  "contact"..     
-0002b930: 2020 2069 6620 6c65 6e28 636f 6e74 6163     if len(contac
-0002b940: 7473 2920 3d3d 2031 2061 6e64 2073 656c  ts) == 1 and sel
-0002b950: 662e 6462 2e69 6420 3d3d 2063 6f6e 7461  f.db.id == conta
-0002b960: 6374 735b 305d 5b22 6964 656e 7469 7479  cts[0]["identity
-0002b970: 225d 3a20 6361 7465 676f 7279 203d 2022  "]: category = "
-0002b980: 6163 636f 756e 7422 0d0a 2020 2020 2020  account"..      
-0002b990: 2020 6368 6174 732c 2076 6973 6974 6564    chats, visited
-0002b9a0: 2c20 6368 6174 6d61 7020 3d20 5b5d 2c20  , chatmap = [], 
-0002b9b0: 7365 7428 292c 207b 785b 2269 6422 5d3a  set(), {x["id"]:
-0002b9c0: 2078 2066 6f72 2078 2069 6e20 7365 6c66   x for x in self
-0002b9d0: 2e63 6861 7473 7d0d 0a20 2020 2020 2020  .chats}..       
-0002b9e0: 2066 6f72 2063 2069 6e20 636f 6e74 6163   for c in contac
-0002b9f0: 7473 3a0d 0a20 2020 2020 2020 2020 2020  ts:..           
-0002ba00: 2063 6861 7473 2e65 7874 656e 6428 736f   chats.extend(so
-0002ba10: 7274 6564 2828 6368 6174 6d61 705b 785b  rted((chatmap[x[
-0002ba20: 2269 6422 5d5d 2066 6f72 2078 2069 6e20  "id"]] for x in 
-0002ba30: 632e 6765 7428 2263 6f6e 7665 7273 6174  c.get("conversat
-0002ba40: 696f 6e73 222c 205b 5d29 0d0a 2020 2020  ions", [])..    
-0002ba50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ba60: 2020 2020 2020 2020 2020 2020 6966 2078              if x
-0002ba70: 5b22 6964 225d 206e 6f74 2069 6e20 7669  ["id"] not in vi
-0002ba80: 7369 7465 6429 2c0d 0a20 2020 2020 2020  sited),..       
-0002ba90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002baa0: 2020 2020 2020 2020 206b 6579 3d6c 616d           key=lam
-0002bab0: 6264 6120 783a 2028 785b 2274 7970 6522  bda x: (x["type"
-0002bac0: 5d2c 2078 5b22 7469 746c 655f 6c6f 6e67  ], x["title_long
-0002bad0: 225d 2e6c 6f77 6572 2829 2929 290d 0a20  "].lower()))).. 
-0002bae0: 2020 2020 2020 2020 2020 2076 6973 6974             visit
-0002baf0: 6564 2e75 7064 6174 6528 785b 2269 6422  ed.update(x["id"
-0002bb00: 5d20 666f 7220 7820 696e 2063 6861 7473  ] for x in chats
-0002bb10: 290d 0a20 2020 2020 2020 2063 6f6e 7461  )..        conta
-0002bb20: 6374 5f63 6f6c 7320 3d20 7365 6c66 2e64  ct_cols = self.d
-0002bb30: 622e 6765 745f 7461 626c 655f 636f 6c75  b.get_table_colu
-0002bb40: 6d6e 7328 2263 6f6e 7461 6374 7322 290d  mns("contacts").
-0002bb50: 0a20 2020 2020 2020 2063 6c61 6265 6c20  .        clabel 
-0002bb60: 3d20 7574 696c 2e70 6c75 7261 6c28 2231  = util.plural("1
-0002bb70: 3a31 2063 6861 7422 2c20 4e6f 6e65 2069  :1 chat", None i
-0002bb80: 6620 2261 6363 6f75 6e74 2220 3d3d 2063  f "account" == c
-0002bb90: 6174 6567 6f72 7920 656c 7365 2063 6f6e  ategory else con
-0002bba0: 7461 6374 732c 206e 756d 6265 7273 3d46  tacts, numbers=F
-0002bbb0: 616c 7365 290d 0a20 2020 2020 2020 2070  alse)..        p
-0002bbc0: 6c61 6265 6c20 3d20 7574 696c 2e70 6c75  label = util.plu
-0002bbd0: 7261 6c28 2270 726f 6669 6c65 222c 2063  ral("profile", c
-0002bbe0: 6f6e 7461 6374 732c 206e 756d 6265 7273  ontacts, numbers
-0002bbf0: 3d46 616c 7365 290d 0a0d 0a20 2020 2020  =False)....     
-0002bc00: 2020 2064 6566 2063 6c69 7062 6f61 7264     def clipboard
-0002bc10: 697a 6528 6361 7465 676f 7279 293a 0d0a  ize(category):..
-0002bc20: 2020 2020 2020 2020 2020 2020 6966 2022              if "
-0002bc30: 6e61 6d65 2220 3d3d 2063 6174 6567 6f72  name" == categor
-0002bc40: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
-0002bc50: 2020 2020 7465 7874 203d 2022 5c6e 222e      text = "\n".
-0002bc60: 6a6f 696e 2863 5b22 6e61 6d65 225d 2066  join(c["name"] f
-0002bc70: 6f72 2063 2069 6e20 636f 6e74 6163 7473  or c in contacts
-0002bc80: 290d 0a20 2020 2020 2020 2020 2020 2065  )..            e
-0002bc90: 6c69 6620 2263 6861 7422 203d 3d20 6361  lif "chat" == ca
-0002bca0: 7465 676f 7279 3a0d 0a20 2020 2020 2020  tegory:..       
-0002bcb0: 2020 2020 2020 2020 2074 6578 7420 3d20           text = 
-0002bcc0: 225c 6e22 2e6a 6f69 6e28 785b 2274 6974  "\n".join(x["tit
-0002bcd0: 6c65 5f6c 6f6e 6722 5d20 666f 7220 7820  le_long"] for x 
-0002bce0: 696e 2063 6861 7473 290d 0a20 2020 2020  in chats)..     
-0002bcf0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-0002bd00: 2020 2020 2020 2020 2020 2020 2020 6765                ge
-0002bd10: 745f 6669 656c 6473 203d 206c 616d 6264  t_fields = lambd
-0002bd20: 6120 633a 2073 6b79 7065 6461 7461 2e43  a c: skypedata.C
-0002bd30: 4f4e 5441 4354 5f46 4945 4c44 5f54 4954  ONTACT_FIELD_TIT
-0002bd40: 4c45 5320 6966 2073 656c 662e 6462 2e69  LES if self.db.i
-0002bd50: 6420 213d 2063 5b22 6964 656e 7469 7479  d != c["identity
-0002bd60: 225d 205c 0d0a 2020 2020 2020 2020 2020  "] \..          
-0002bd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bd80: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-0002bd90: 6520 736b 7970 6564 6174 612e 4143 434f  e skypedata.ACCO
-0002bda0: 554e 545f 4649 454c 445f 5449 544c 4553  UNT_FIELD_TITLES
-0002bdb0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0002bdc0: 2020 7465 7874 203d 2022 5c6e 5c6e 222e    text = "\n\n".
-0002bdd0: 6a6f 696e 2822 2573 2573 2220 2520 280d  join("%s%s" % (.
-0002bde0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002bdf0: 2020 2020 2022 4461 7461 6261 7365 2061       "Database a
-0002be00: 6363 6f75 6e74 5c6e 2220 6966 2073 656c  ccount\n" if sel
-0002be10: 662e 6462 2e69 6420 3d3d 2063 5b22 6964  f.db.id == c["id
-0002be20: 656e 7469 7479 225d 2065 6c73 6520 2222  entity"] else ""
-0002be30: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0002be40: 2020 2020 2020 2022 5c6e 222e 6a6f 696e         "\n".join
-0002be50: 2822 2573 3a20 2573 2220 2520 286c 2c20  ("%s: %s" % (l, 
-0002be60: 7629 2066 6f72 206e 2c20 6c20 696e 2067  v) for n, l in g
-0002be70: 6574 5f66 6965 6c64 7328 6329 2e69 7465  et_fields(c).ite
-0002be80: 6d73 2829 0d0a 2020 2020 2020 2020 2020  ms()..          
-0002be90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bea0: 2020 2020 666f 7220 7620 696e 205b 736b      for v in [sk
-0002beb0: 7970 6564 6174 612e 666f 726d 6174 5f63  ypedata.format_c
-0002bec0: 6f6e 7461 6374 5f66 6965 6c64 2863 2c20  ontact_field(c, 
-0002bed0: 6e29 5d20 6966 2076 290d 0a20 2020 2020  n)] if v)..     
-0002bee0: 2020 2020 2020 2020 2020 2029 2066 6f72             ) for
-0002bef0: 2063 2069 6e20 636f 6e74 6163 7473 290d   c in contacts).
-0002bf00: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0002bf10: 7778 2e54 6865 436c 6970 626f 6172 642e  wx.TheClipboard.
-0002bf20: 4f70 656e 2829 3a0d 0a20 2020 2020 2020  Open():..       
-0002bf30: 2020 2020 2020 2020 2064 203d 2077 782e           d = wx.
-0002bf40: 5465 7874 4461 7461 4f62 6a65 6374 2874  TextDataObject(t
-0002bf50: 6578 7429 0d0a 2020 2020 2020 2020 2020  ext)..          
-0002bf60: 2020 2020 2020 7778 2e54 6865 436c 6970        wx.TheClip
-0002bf70: 626f 6172 642e 5365 7444 6174 6128 6429  board.SetData(d)
-0002bf80: 2c20 7778 2e54 6865 436c 6970 626f 6172  , wx.TheClipboar
-0002bf90: 642e 436c 6f73 6528 290d 0a0d 0a20 2020  d.Close()....   
-0002bfa0: 2020 2020 2064 6566 2065 7870 6f72 7465       def exporte
-0002bfb0: 7228 646f 5f73 696e 676c 6566 696c 653d  r(do_singlefile=
-0002bfc0: 4661 6c73 652c 2064 6f5f 7469 6d65 7261  False, do_timera
-0002bfd0: 6e67 653d 4661 6c73 6529 3a0d 0a20 2020  nge=False):..   
-0002bfe0: 2020 2020 2020 2020 2073 656c 662e 6f6e           self.on
-0002bff0: 5f65 7870 6f72 745f 6368 6174 7328 6368  _export_chats(ch
-0002c000: 6174 732c 2046 616c 7365 2c20 646f 5f73  ats, False, do_s
-0002c010: 696e 676c 6566 696c 652c 2064 6f5f 7469  inglefile, do_ti
-0002c020: 6d65 7261 6e67 6529 0d0a 0d0a 2020 2020  merange)....    
-0002c030: 2020 2020 6465 6620 7379 6e63 2873 696e      def sync(sin
-0002c040: 676c 6573 3d4e 6f6e 6529 3a0d 0a20 2020  gles=None):..   
-0002c050: 2020 2020 2020 2020 206d 7963 6861 7473           mychats
-0002c060: 2c20 6d79 636f 6e74 6163 7473 203d 2028  , mycontacts = (
-0002c070: 4e6f 6e65 2069 6620 7369 6e67 6c65 7320  None if singles 
-0002c080: 6973 204e 6f6e 6520 656c 7365 2063 6861  is None else cha
-0002c090: 7473 292c 2063 6f6e 7461 6374 730d 0a20  ts), contacts.. 
-0002c0a0: 2020 2020 2020 2020 2020 2069 6620 7369             if si
-0002c0b0: 6e67 6c65 733a 0d0a 2020 2020 2020 2020  ngles:..        
-0002c0c0: 2020 2020 2020 2020 6d79 6368 6174 7320          mychats 
-0002c0d0: 3d20 5b78 2066 6f72 2078 2069 6e20 6d79  = [x for x in my
-0002c0e0: 6368 6174 7320 6966 2073 6b79 7065 6461  chats if skypeda
-0002c0f0: 7461 2e43 4841 5453 5f54 5950 455f 5349  ta.CHATS_TYPE_SI
-0002c100: 4e47 4c45 203d 3d20 785b 2274 7970 6522  NGLE == x["type"
-0002c110: 5d5d 0d0a 2020 2020 2020 2020 2020 2020  ]]..            
-0002c120: 6966 2073 696e 676c 6573 2069 7320 6e6f  if singles is no
-0002c130: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
-0002c140: 2020 2020 2020 2020 2063 6861 7469 6473           chatids
-0002c150: 203d 2073 6574 2878 5b22 6964 656e 7469   = set(x["identi
-0002c160: 7479 225d 2066 6f72 2078 2069 6e20 6d79  ty"] for x in my
-0002c170: 6368 6174 7329 0d0a 2020 2020 2020 2020  chats)..        
-0002c180: 2020 2020 2020 2020 6d79 6368 6174 7320          mychats 
-0002c190: 3d20 5b7b 2269 6465 6e74 6974 7922 3a20  = [{"identity": 
-0002c1a0: 635b 2269 6465 6e74 6974 7922 5d7d 2066  c["identity"]} f
-0002c1b0: 6f72 2063 2069 6e20 636f 6e74 6163 7473  or c in contacts
-0002c1c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0002c1d0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0002c1e0: 635b 2269 6465 6e74 6974 7922 5d20 6e6f  c["identity"] no
-0002c1f0: 7420 696e 2063 6861 7469 6473 5d20 2b20  t in chatids] + 
-0002c200: 6d79 6368 6174 730d 0a20 2020 2020 2020  mychats..       
-0002c210: 2020 2020 2073 656c 662e 6f6e 5f6c 6976       self.on_liv
-0002c220: 655f 7379 6e63 5f69 7465 6d73 286d 7963  e_sync_items(myc
-0002c230: 6861 7473 2c20 6d79 636f 6e74 6163 7473  hats, mycontacts
-0002c240: 2c20 6d65 7373 6167 6573 3d73 696e 676c  , messages=singl
-0002c250: 6573 2069 7320 6e6f 7420 4e6f 6e65 290d  es is not None).
-0002c260: 0a0d 0a20 2020 2020 2020 206d 656e 752c  ...        menu,
-0002c270: 2073 6d65 6e75 2c20 786d 656e 7520 203d   smenu, xmenu  =
-0002c280: 2077 782e 4d65 6e75 2829 2c20 7778 2e4d   wx.Menu(), wx.M
-0002c290: 656e 7528 292c 204e 6f6e 650d 0a20 2020  enu(), None..   
-0002c2a0: 2020 2020 2069 6620 6675 6c6c 6d65 6e75       if fullmenu
-0002c2b0: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
-0002c2c0: 7465 6d5f 6e61 6d65 2020 3d20 7778 2e4d  tem_name  = wx.M
-0002c2d0: 656e 7549 7465 6d28 6d65 6e75 2c20 2d31  enuItem(menu, -1
-0002c2e0: 2c20 2822 4f70 656e 2025 7320 2220 2520  , ("Open %s " % 
-0002c2f0: 6361 7465 676f 7279 2920 6966 206c 656e  category) if len
-0002c300: 2863 6f6e 7461 6374 7329 203c 2032 0d0a  (contacts) < 2..
-0002c310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c330: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0002c340: 6c73 6520 7574 696c 2e70 6c75 7261 6c28  lse util.plural(
-0002c350: 2263 6f6e 7461 6374 222c 2063 6f6e 7461  "contact", conta
-0002c360: 6374 7329 290d 0a20 2020 2020 2020 2069  cts))..        i
-0002c370: 7465 6d5f 636f 7079 2020 2020 2020 3d20  tem_copy      = 
-0002c380: 7778 2e4d 656e 7549 7465 6d28 6d65 6e75  wx.MenuItem(menu
-0002c390: 2c20 2d31 2c20 2226 436f 7079 2025 7322  , -1, "&Copy %s"
-0002c3a0: 2025 0d0a 2020 2020 2020 2020 2020 2020   %..            
-0002c3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c3c0: 2020 2020 2020 2020 2075 7469 6c2e 706c           util.pl
-0002c3d0: 7572 616c 2822 6e61 6d65 222c 2063 6f6e  ural("name", con
-0002c3e0: 7461 6374 732c 206e 756d 6265 7273 3d46  tacts, numbers=F
-0002c3f0: 616c 7365 2929 0d0a 2020 2020 2020 2020  alse))..        
-0002c400: 6974 656d 5f63 6f70 7970 726f 6620 203d  item_copyprof  =
-0002c410: 2077 782e 4d65 6e75 4974 656d 286d 656e   wx.MenuItem(men
-0002c420: 752c 202d 312c 2022 436f 7079 2026 2573  u, -1, "Copy &%s
-0002c430: 2220 2520 706c 6162 656c 290d 0a20 2020  " % plabel)..   
-0002c440: 2020 2020 2069 7465 6d5f 636f 7079 6368       item_copych
-0002c450: 6174 7320 3d20 7778 2e4d 656e 7549 7465  ats = wx.MenuIte
-0002c460: 6d28 6d65 6e75 2c20 2d31 2c20 2243 6f70  m(menu, -1, "Cop
-0002c470: 7920 2573 2220 250d 0a20 2020 2020 2020  y %s" %..       
-0002c480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c490: 2020 2020 2020 2020 2020 2020 2020 7574                ut
-0002c4a0: 696c 2e70 6c75 7261 6c28 2263 2668 6174  il.plural("c&hat
-0002c4b0: 206e 616d 6522 2c20 6368 6174 732c 206e   name", chats, n
-0002c4c0: 756d 6265 7273 3d46 616c 7365 2929 0d0a  umbers=False))..
-0002c4d0: 2020 2020 2020 2020 6974 656d 5f72 656e          item_ren
-0002c4e0: 616d 6520 2020 203d 2077 782e 4d65 6e75  ame    = wx.Menu
-0002c4f0: 4974 656d 286d 656e 752c 202d 312c 2022  Item(menu, -1, "
-0002c500: 5265 266e 616d 6520 2573 2220 2520 6361  Re&name %s" % ca
-0002c510: 7465 676f 7279 290d 0a20 2020 2020 2020  tegory)..       
-0002c520: 2069 7465 6d5f 7379 6e63 6120 2020 2020   item_synca     
-0002c530: 3d20 7778 2e4d 656e 7549 7465 6d28 6d65  = wx.MenuItem(me
-0002c540: 6e75 2c20 2d31 2c20 2253 796e 6368 726f  nu, -1, "Synchro
-0002c550: 6e69 7a65 2026 616c 6c20 6368 6174 7320  nize &all chats 
-0002c560: 616e 6420 2573 2220 2520 706c 6162 656c  and %s" % plabel
-0002c570: 290d 0a20 2020 2020 2020 2069 7465 6d5f  )..        item_
-0002c580: 7379 6e63 6d20 2020 2020 3d20 7778 2e4d  syncm     = wx.M
-0002c590: 656e 7549 7465 6d28 6d65 6e75 2c20 2d31  enuItem(menu, -1
-0002c5a0: 2c20 2253 796e 6368 726f 6e69 7a65 2025  , "Synchronize %
-0002c5b0: 7320 616e 6420 2573 2220 2520 2863 6c61  s and %s" % (cla
-0002c5c0: 6265 6c2c 2070 6c61 6265 6c29 290d 0a20  bel, plabel)).. 
-0002c5d0: 2020 2020 2020 2069 7465 6d5f 7379 6e63         item_sync
-0002c5e0: 7020 2020 2020 3d20 7778 2e4d 656e 7549  p     = wx.MenuI
-0002c5f0: 7465 6d28 6d65 6e75 2c20 2d31 2c20 2253  tem(menu, -1, "S
-0002c600: 796e 6368 726f 6e69 7a65 2026 2573 2220  ynchronize &%s" 
-0002c610: 2520 706c 6162 656c 290d 0a20 2020 2020  % plabel)..     
-0002c620: 2020 2069 6620 6675 6c6c 6d65 6e75 3a0d     if fullmenu:.
-0002c630: 0a20 2020 2020 2020 2020 2020 2069 7465  .            ite
-0002c640: 6d5f 6578 706f 7274 2020 3d20 7778 2e4d  m_export  = wx.M
-0002c650: 656e 7549 7465 6d28 6d65 6e75 2c20 2d31  enuItem(menu, -1
-0002c660: 2c20 2226 4578 706f 7274 2063 6861 7473  , "&Export chats
-0002c670: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
-0002c680: 6974 656d 5f65 7870 6f72 746d 203d 2069  item_exportm = i
-0002c690: 7465 6d5f 6461 7465 736d 203d 204e 6f6e  tem_datesm = Non
-0002c6a0: 650d 0a20 2020 2020 2020 2069 6620 6675  e..        if fu
-0002c6b0: 6c6c 6d65 6e75 2061 6e64 2065 7870 6f72  llmenu and expor
-0002c6c0: 742e 786c 7378 7772 6974 6572 2061 6e64  t.xlsxwriter and
-0002c6d0: 206c 656e 2863 6f6e 7461 6374 7329 203e   len(contacts) >
-0002c6e0: 2031 3a0d 0a20 2020 2020 2020 2020 2020   1:..           
-0002c6f0: 2078 6d65 6e75 203d 2077 782e 4d65 6e75   xmenu = wx.Menu
-0002c700: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
-0002c710: 6974 656d 5f65 7870 6f72 746d 203d 2077  item_exportm = w
-0002c720: 782e 4d65 6e75 4974 656d 286d 656e 752c  x.MenuItem(menu,
-0002c730: 202d 312c 2022 4368 6174 7320 6f6e 2026   -1, "Chats on &
-0002c740: 7365 7061 7261 7465 2073 6865 6574 7322  separate sheets"
-0002c750: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
-0002c760: 7465 6d5f 6461 7465 736d 2020 3d20 7778  tem_datesm  = wx
-0002c770: 2e4d 656e 7549 7465 6d28 6d65 6e75 2c20  .MenuItem(menu, 
-0002c780: 2d31 2c20 2243 6861 7473 2069 6e20 2664  -1, "Chats in &d
-0002c790: 6174 6520 7261 6e67 6520 6f6e 2073 6570  ate range on sep
-0002c7a0: 6172 6174 6520 7368 6565 7473 2229 0d0a  arate sheets")..
-0002c7b0: 2020 2020 2020 2020 2020 2020 786d 656e              xmen
-0002c7c0: 752e 4170 7065 6e64 2869 7465 6d5f 6578  u.Append(item_ex
-0002c7d0: 706f 7274 6d29 0d0a 2020 2020 2020 2020  portm)..        
-0002c7e0: 2020 2020 786d 656e 752e 4170 7065 6e64      xmenu.Append
-0002c7f0: 2869 7465 6d5f 6461 7465 736d 290d 0a20  (item_datesm).. 
-0002c800: 2020 2020 2020 2069 6620 6675 6c6c 6d65         if fullme
-0002c810: 6e75 3a0d 0a20 2020 2020 2020 2020 2020  nu:..           
-0002c820: 2069 7465 6d5f 6461 7465 7320 2020 3d20   item_dates   = 
-0002c830: 7778 2e4d 656e 7549 7465 6d28 6d65 6e75  wx.MenuItem(menu
-0002c840: 2c20 2d31 2c20 2245 7870 6f72 7420 6368  , -1, "Export ch
-0002c850: 6174 7320 2664 6174 6520 7261 6e67 6522  ats &date range"
-0002c860: 290d 0a20 2020 2020 2020 2069 7465 6d5f  )..        item_
-0002c870: 6465 6c65 7465 2020 3d20 7778 2e4d 656e  delete  = wx.Men
-0002c880: 7549 7465 6d28 6d65 6e75 2c20 2d31 2c20  uItem(menu, -1, 
-0002c890: 2244 656c 6574 6522 290d 0a0d 0a20 2020  "Delete")....   
-0002c8a0: 2020 2020 2069 6620 6675 6c6c 6d65 6e75       if fullmenu
-0002c8b0: 3a0d 0a20 2020 2020 2020 2020 2020 2062  :..            b
-0002c8c0: 6f6c 6466 6f6e 7420 3d20 7778 2e46 6f6e  oldfont = wx.Fon
-0002c8d0: 7428 6974 656d 5f6e 616d 652e 466f 6e74  t(item_name.Font
-0002c8e0: 290d 0a20 2020 2020 2020 2020 2020 2062  )..            b
-0002c8f0: 6f6c 6466 6f6e 742e 5365 7457 6569 6768  oldfont.SetWeigh
-0002c900: 7428 7778 2e46 4f4e 5457 4549 4748 545f  t(wx.FONTWEIGHT_
-0002c910: 424f 4c44 290d 0a20 2020 2020 2020 2020  BOLD)..         
-0002c920: 2020 2062 6f6c 6466 6f6e 742e 5365 7446     boldfont.SetF
-0002c930: 6163 654e 616d 6528 7365 6c66 2e46 6f6e  aceName(self.Fon
-0002c940: 742e 4661 6365 4e61 6d65 290d 0a20 2020  t.FaceName)..   
-0002c950: 2020 2020 2020 2020 2062 6f6c 6466 6f6e           boldfon
-0002c960: 742e 5365 7450 6f69 6e74 5369 7a65 2873  t.SetPointSize(s
-0002c970: 656c 662e 466f 6e74 2e50 6f69 6e74 5369  elf.Font.PointSi
-0002c980: 7a65 290d 0a20 2020 2020 2020 2020 2020  ze)..           
-0002c990: 2069 7465 6d5f 6e61 6d65 2e46 6f6e 7420   item_name.Font 
-0002c9a0: 3d20 626f 6c64 666f 6e74 0d0a 0d0a 2020  = boldfont....  
-0002c9b0: 2020 2020 2020 6966 2066 756c 6c6d 656e        if fullmen
-0002c9c0: 753a 0d0a 2020 2020 2020 2020 2020 2020  u:..            
-0002c9d0: 6d65 6e75 2e41 7070 656e 6428 6974 656d  menu.Append(item
-0002c9e0: 5f6e 616d 6529 0d0a 2020 2020 2020 2020  _name)..        
-0002c9f0: 2020 2020 6d65 6e75 2e41 7070 656e 6453      menu.AppendS
-0002ca00: 6570 6172 6174 6f72 2829 0d0a 2020 2020  eparator()..    
-0002ca10: 2020 2020 6d65 6e75 2e41 7070 656e 6428      menu.Append(
-0002ca20: 6974 656d 5f63 6f70 7929 0d0a 2020 2020  item_copy)..    
-0002ca30: 2020 2020 6d65 6e75 2e41 7070 656e 6428      menu.Append(
-0002ca40: 6974 656d 5f63 6f70 7970 726f 6629 0d0a  item_copyprof)..
-0002ca50: 2020 2020 2020 2020 6d65 6e75 2e41 7070          menu.App
-0002ca60: 656e 6428 6974 656d 5f63 6f70 7963 6861  end(item_copycha
-0002ca70: 7473 290d 0a20 2020 2020 2020 206d 656e  ts)..        men
-0002ca80: 752e 4170 7065 6e64 5365 7061 7261 746f  u.AppendSeparato
-0002ca90: 7228 290d 0a20 2020 2020 2020 206d 656e  r()..        men
-0002caa0: 752e 4170 7065 6e64 2869 7465 6d5f 7265  u.Append(item_re
-0002cab0: 6e61 6d65 290d 0a20 2020 2020 2020 206d  name)..        m
-0002cac0: 656e 752e 4170 7065 6e64 5365 7061 7261  enu.AppendSepara
-0002cad0: 746f 7228 290d 0a20 2020 2020 2020 2073  tor()..        s
-0002cae0: 6d65 6e75 2e41 7070 656e 6428 6974 656d  menu.Append(item
-0002caf0: 5f73 796e 6361 290d 0a20 2020 2020 2020  _synca)..       
-0002cb00: 2073 6d65 6e75 2e41 7070 656e 6428 6974   smenu.Append(it
-0002cb10: 656d 5f73 796e 636d 290d 0a20 2020 2020  em_syncm)..     
-0002cb20: 2020 2073 6d65 6e75 2e41 7070 656e 6428     smenu.Append(
-0002cb30: 6974 656d 5f73 796e 6370 290d 0a20 2020  item_syncp)..   
-0002cb40: 2020 2020 2069 7465 6d5f 7379 6e63 203d       item_sync =
-0002cb50: 206d 656e 752e 4170 7065 6e64 5375 624d   menu.AppendSubM
-0002cb60: 656e 7528 736d 656e 752c 2022 5570 6461  enu(smenu, "Upda
-0002cb70: 7465 2066 726f 6d20 6f6e 266c 696e 6522  te from on&line"
-0002cb80: 290d 0a20 2020 2020 2020 206d 656e 752e  )..        menu.
-0002cb90: 4170 7065 6e64 5365 7061 7261 746f 7228  AppendSeparator(
-0002cba0: 290d 0a20 2020 2020 2020 2069 6620 6675  )..        if fu
-0002cbb0: 6c6c 6d65 6e75 3a0d 0a20 2020 2020 2020  llmenu:..       
-0002cbc0: 2020 2020 206d 656e 752e 4170 7065 6e64       menu.Append
-0002cbd0: 2869 7465 6d5f 6578 706f 7274 290d 0a20  (item_export).. 
-0002cbe0: 2020 2020 2020 2020 2020 206d 656e 752e             menu.
-0002cbf0: 4170 7065 6e64 2869 7465 6d5f 6461 7465  Append(item_date
-0002cc00: 7329 0d0a 2020 2020 2020 2020 2020 2020  s)..            
-0002cc10: 6966 2078 6d65 6e75 3a20 6d65 6e75 2e41  if xmenu: menu.A
-0002cc20: 7070 656e 6453 7562 4d65 6e75 2878 6d65  ppendSubMenu(xme
-0002cc30: 6e75 2c20 2245 7870 6f72 7420 746f 2061  nu, "Export to a
-0002cc40: 2073 696e 676c 6520 4578 6365 6c20 2677   single Excel &w
-0002cc50: 6f72 6b62 6f6f 6b22 290d 0a20 2020 2020  orkbook")..     
-0002cc60: 2020 2020 2020 206d 656e 752e 4170 7065         menu.Appe
-0002cc70: 6e64 5365 7061 7261 746f 7228 290d 0a20  ndSeparator().. 
-0002cc80: 2020 2020 2020 206d 656e 752e 4170 7065         menu.Appe
-0002cc90: 6e64 2869 7465 6d5f 6465 6c65 7465 290d  nd(item_delete).
-0002cca0: 0a20 2020 2020 2020 2069 6620 6675 6c6c  .        if full
-0002ccb0: 6d65 6e75 3a0d 0a20 2020 2020 2020 2020  menu:..         
-0002ccc0: 2020 2069 7465 6d5f 6e61 6d65 2e45 6e61     item_name.Ena
-0002ccd0: 626c 6564 203d 2028 3120 3d3d 206c 656e  bled = (1 == len
-0002cce0: 2863 6f6e 7461 6374 7329 290d 0a20 2020  (contacts))..   
-0002ccf0: 2020 2020 2069 7465 6d5f 7265 6e61 6d65       item_rename
-0002cd00: 2e45 6e61 626c 6564 203d 2028 3120 3d3d  .Enabled = (1 ==
-0002cd10: 206c 656e 2863 6f6e 7461 6374 7329 2920   len(contacts)) 
-0002cd20: 616e 6420 616e 7928 785b 226e 616d 6522  and any(x["name"
-0002cd30: 5d20 3d3d 2022 6769 7665 6e5f 6469 7370  ] == "given_disp
-0002cd40: 6c61 796e 616d 6522 2066 6f72 2078 2069  layname" for x i
-0002cd50: 6e20 636f 6e74 6163 745f 636f 6c73 290d  n contact_cols).
-0002cd60: 0a20 2020 2020 2020 2069 7465 6d5f 6465  .        item_de
-0002cd70: 6c65 7465 2e45 6e61 626c 6564 203d 2028  lete.Enabled = (
-0002cd80: 2261 6363 6f75 6e74 2220 213d 2063 6174  "account" != cat
-0002cd90: 6567 6f72 7929 0d0a 0d0a 2020 2020 2020  egory)....      
-0002cda0: 2020 6966 2066 756c 6c6d 656e 753a 0d0a    if fullmenu:..
-0002cdb0: 2020 2020 2020 2020 2020 2020 6d65 6e75              menu
-0002cdc0: 2e42 696e 6428 7778 2e45 5654 5f4d 454e  .Bind(wx.EVT_MEN
-0002cdd0: 552c 206c 616d 6264 6120 653a 2073 656c  U, lambda e: sel
-0002cde0: 662e 6c6f 6164 5f63 6f6e 7461 6374 2863  f.load_contact(c
-0002cdf0: 6f6e 7461 6374 735b 305d 292c 2069 7465  ontacts[0]), ite
-0002ce00: 6d5f 6e61 6d65 290d 0a20 2020 2020 2020  m_name)..       
-0002ce10: 206d 656e 752e 4269 6e64 2877 782e 4556   menu.Bind(wx.EV
-0002ce20: 545f 4d45 4e55 2c20 206c 616d 6264 6120  T_MENU,  lambda 
-0002ce30: 653a 2063 6c69 7062 6f61 7264 697a 6528  e: clipboardize(
-0002ce40: 226e 616d 6522 292c 2020 2020 6974 656d  "name"),    item
-0002ce50: 5f63 6f70 7929 0d0a 2020 2020 2020 2020  _copy)..        
-0002ce60: 6d65 6e75 2e42 696e 6428 7778 2e45 5654  menu.Bind(wx.EVT
-0002ce70: 5f4d 454e 552c 2020 6c61 6d62 6461 2065  _MENU,  lambda e
-0002ce80: 3a20 636c 6970 626f 6172 6469 7a65 2822  : clipboardize("
-0002ce90: 7072 6f66 696c 6522 292c 2069 7465 6d5f  profile"), item_
-0002cea0: 636f 7079 7072 6f66 290d 0a20 2020 2020  copyprof)..     
-0002ceb0: 2020 206d 656e 752e 4269 6e64 2877 782e     menu.Bind(wx.
-0002cec0: 4556 545f 4d45 4e55 2c20 206c 616d 6264  EVT_MENU,  lambd
-0002ced0: 6120 653a 2063 6c69 7062 6f61 7264 697a  a e: clipboardiz
-0002cee0: 6528 2263 6861 7422 292c 2020 2020 6974  e("chat"),    it
-0002cef0: 656d 5f63 6f70 7963 6861 7473 290d 0a20  em_copychats).. 
-0002cf00: 2020 2020 2020 206d 656e 752e 4269 6e64         menu.Bind
-0002cf10: 2877 782e 4556 545f 4d45 4e55 2c20 206c  (wx.EVT_MENU,  l
-0002cf20: 616d 6264 6120 653a 2073 656c 662e 6f6e  ambda e: self.on
-0002cf30: 5f72 656e 616d 655f 636f 6e74 6163 7428  _rename_contact(
-0002cf40: 636f 6e74 6163 743d 636f 6e74 6163 7473  contact=contacts
-0002cf50: 5b30 5d29 2c20 6974 656d 5f72 656e 616d  [0]), item_renam
-0002cf60: 6529 0d0a 2020 2020 2020 2020 6d65 6e75  e)..        menu
-0002cf70: 2e42 696e 6428 7778 2e45 5654 5f4d 454e  .Bind(wx.EVT_MEN
-0002cf80: 552c 2020 6c61 6d62 6461 2065 3a20 7365  U,  lambda e: se
-0002cf90: 6c66 2e6f 6e5f 6465 6c65 7465 5f63 6f6e  lf.on_delete_con
-0002cfa0: 7461 6374 7328 636f 6e74 6163 7473 3d63  tacts(contacts=c
-0002cfb0: 6f6e 7461 6374 7329 2c20 2069 7465 6d5f  ontacts),  item_
-0002cfc0: 6465 6c65 7465 290d 0a20 2020 2020 2020  delete)..       
-0002cfd0: 2073 6d65 6e75 2e42 696e 6428 7778 2e45   smenu.Bind(wx.E
-0002cfe0: 5654 5f4d 454e 552c 206c 616d 6264 6120  VT_MENU, lambda 
-0002cff0: 653a 2073 796e 6328 7369 6e67 6c65 733d  e: sync(singles=
-0002d000: 4661 6c73 6529 2c20 6964 3d69 7465 6d5f  False), id=item_
-0002d010: 7379 6e63 612e 4765 7449 6428 2929 0d0a  synca.GetId())..
-0002d020: 2020 2020 2020 2020 736d 656e 752e 4269          smenu.Bi
-0002d030: 6e64 2877 782e 4556 545f 4d45 4e55 2c20  nd(wx.EVT_MENU, 
-0002d040: 6c61 6d62 6461 2065 3a20 7379 6e63 2873  lambda e: sync(s
-0002d050: 696e 676c 6573 3d54 7275 6529 2c20 2069  ingles=True),  i
-0002d060: 643d 6974 656d 5f73 796e 636d 2e47 6574  d=item_syncm.Get
-0002d070: 4964 2829 290d 0a20 2020 2020 2020 2073  Id())..        s
-0002d080: 6d65 6e75 2e42 696e 6428 7778 2e45 5654  menu.Bind(wx.EVT
-0002d090: 5f4d 454e 552c 206c 616d 6264 6120 653a  _MENU, lambda e:
-0002d0a0: 2073 796e 6328 292c 2020 2020 2020 2020   sync(),        
-0002d0b0: 2020 2020 2020 6964 3d69 7465 6d5f 7379        id=item_sy
-0002d0c0: 6e63 702e 4765 7449 6428 2929 0d0a 2020  ncp.GetId())..  
-0002d0d0: 2020 2020 2020 6966 2066 756c 6c6d 656e        if fullmen
-0002d0e0: 753a 0d0a 2020 2020 2020 2020 2020 2020  u:..            
-0002d0f0: 6d65 6e75 2e42 696e 6428 7778 2e45 5654  menu.Bind(wx.EVT
-0002d100: 5f4d 454e 552c 206c 616d 6264 6120 653a  _MENU, lambda e:
-0002d110: 2065 7870 6f72 7465 7228 4661 6c73 652c   exporter(False,
-0002d120: 2046 616c 7365 292c 2069 7465 6d5f 6578   False), item_ex
-0002d130: 706f 7274 290d 0a20 2020 2020 2020 2020  port)..         
-0002d140: 2020 206d 656e 752e 4269 6e64 2877 782e     menu.Bind(wx.
-0002d150: 4556 545f 4d45 4e55 2c20 6c61 6d62 6461  EVT_MENU, lambda
-0002d160: 2065 3a20 6578 706f 7274 6572 2846 616c   e: exporter(Fal
-0002d170: 7365 2c20 5472 7565 292c 2020 6974 656d  se, True),  item
-0002d180: 5f64 6174 6573 290d 0a20 2020 2020 2020  _dates)..       
-0002d190: 2020 2020 2069 6620 6974 656d 5f65 7870       if item_exp
-0002d1a0: 6f72 746d 3a0d 0a20 2020 2020 2020 2020  ortm:..         
-0002d1b0: 2020 2020 2020 206d 656e 752e 4269 6e64         menu.Bind
-0002d1c0: 2877 782e 4556 545f 4d45 4e55 2c20 6c61  (wx.EVT_MENU, la
-0002d1d0: 6d62 6461 2065 3a20 6578 706f 7274 6572  mbda e: exporter
-0002d1e0: 2854 7275 652c 2020 4661 6c73 6529 2c20  (True,  False), 
-0002d1f0: 6974 656d 5f65 7870 6f72 746d 290d 0a20  item_exportm).. 
-0002d200: 2020 2020 2020 2020 2020 2069 6620 6974             if it
-0002d210: 656d 5f64 6174 6573 6d3a 0d0a 2020 2020  em_datesm:..    
-0002d220: 2020 2020 2020 2020 2020 2020 6d65 6e75              menu
-0002d230: 2e42 696e 6428 7778 2e45 5654 5f4d 454e  .Bind(wx.EVT_MEN
-0002d240: 552c 206c 616d 6264 6120 653a 2065 7870  U, lambda e: exp
-0002d250: 6f72 7465 7228 5472 7565 2c20 2054 7275  orter(True,  Tru
-0002d260: 6529 2c20 2069 7465 6d5f 6461 7465 736d  e),  item_datesm
-0002d270: 290d 0a0d 0a20 2020 2020 2020 2069 6620  )....        if 
-0002d280: 6675 6c6c 6d65 6e75 3a0d 0a20 2020 2020  fullmenu:..     
-0002d290: 2020 2020 2020 2023 204e 6565 6473 2063         # Needs c
-0002d2a0: 616c 6c62 6163 6b2c 2061 6374 696f 6e73  allback, actions
-0002d2b0: 2063 616e 206d 6f64 6966 7920 6c69 7374   can modify list
-0002d2c0: 2077 6869 6c65 206d 6f75 7365 2065 7665   while mouse eve
-0002d2d0: 6e74 206f 6e67 6f69 6e67 0d0a 2020 2020  nt ongoing..    
-0002d2e0: 2020 2020 2020 2020 7778 2e43 616c 6c41          wx.CallA
-0002d2f0: 6674 6572 2873 656c 662e 6c69 7374 5f63  fter(self.list_c
-0002d300: 6f6e 7461 6374 732e 506f 7075 704d 656e  ontacts.PopupMen
-0002d310: 752c 206d 656e 7529 0d0a 2020 2020 2020  u, menu)..      
-0002d320: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-0002d330: 2020 2020 2073 656c 662e 6275 7474 6f6e       self.button
-0002d340: 5f61 6374 696f 6e5f 636f 6e74 6163 742e  _action_contact.
-0002d350: 506f 7075 704d 656e 7528 6d65 6e75 2c20  PopupMenu(menu, 
-0002d360: 2830 2c20 7365 6c66 2e62 7574 746f 6e5f  (0, self.button_
-0002d370: 6163 7469 6f6e 5f63 6f6e 7461 6374 2e53  action_contact.S
-0002d380: 697a 655b 315d 2929 0d0a 0d0a 0d0a 2020  ize[1]))......  
-0002d390: 2020 6465 6620 6f6e 5f63 6861 6e67 655f    def on_change_
-0002d3a0: 6c69 7374 5f63 6861 7473 5f73 796e 6328  list_chats_sync(
-0002d3b0: 7365 6c66 2c20 6576 656e 7429 3a0d 0a20  self, event):.. 
-0002d3c0: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
-0002d3d0: 2020 2020 4861 6e64 6c65 7220 666f 7220      Handler for 
-0002d3e0: 7365 6c65 6374 696e 6720 616e 2069 7465  selecting an ite
-0002d3f0: 6d20 696e 2074 6865 2073 796e 6365 6420  m in the synced 
-0002d400: 6368 6174 7320 6c69 7374 2c20 6c6f 6164  chats list, load
-0002d410: 7320 7468 650d 0a20 2020 2020 2020 206d  s the..        m
-0002d420: 6573 7361 6765 7320 696e 2063 6861 7473  essages in chats
-0002d430: 2d70 6167 652e 0d0a 2020 2020 2020 2020  -page...        
-0002d440: 2222 220d 0a20 2020 2020 2020 2063 203d  """..        c =
-0002d450: 2073 656c 662e 6c69 7374 5f63 6861 7473   self.list_chats
-0002d460: 5f73 796e 632e 4765 7449 7465 6d4d 6170  _sync.GetItemMap
-0002d470: 7065 6444 6174 6128 6576 656e 742e 496e  pedData(event.In
-0002d480: 6465 7829 0d0a 2020 2020 2020 2020 6368  dex)..        ch
-0002d490: 6174 203d 206e 6578 7428 2878 2066 6f72  at = next((x for
-0002d4a0: 2078 2069 6e20 7365 6c66 2e63 6861 7473   x in self.chats
-0002d4b0: 2069 6620 785b 2269 6465 6e74 6974 7922   if x["identity"
-0002d4c0: 5d20 3d3d 2063 5b22 6964 656e 7469 7479  ] == c["identity
-0002d4d0: 225d 292c 204e 6f6e 6529 0d0a 2020 2020  "]), None)..    
-0002d4e0: 2020 2020 6966 2063 6861 743a 0d0a 2020      if chat:..  
-0002d4f0: 2020 2020 2020 2020 2020 7365 6c66 2e6e            self.n
-0002d500: 6f74 6562 6f6f 6b2e 5365 6c65 6374 696f  otebook.Selectio
-0002d510: 6e20 3d20 7365 6c66 2e70 6167 656f 7264  n = self.pageord
-0002d520: 6572 5b73 656c 662e 7061 6765 5f63 6861  er[self.page_cha
-0002d530: 7473 5d0d 0a20 2020 2020 2020 2020 2020  ts]..           
-0002d540: 2073 656c 662e 6c6f 6164 5f63 6861 7428   self.load_chat(
-0002d550: 6368 6174 290d 0a20 2020 2020 2020 2020  chat)..         
-0002d560: 2020 2073 656c 662e 7374 635f 6869 7374     self.stc_hist
-0002d570: 6f72 792e 5365 7446 6f63 7573 2829 0d0a  ory.SetFocus()..
-0002d580: 0d0a 0d0a 2020 2020 6465 6620 6f6e 5f6c  ....    def on_l
-0002d590: 6976 655f 6c6f 6769 6e28 7365 6c66 2c20  ive_login(self, 
-0002d5a0: 6576 656e 743d 4e6f 6e65 2c20 7379 6e63  event=None, sync
-0002d5b0: 3d46 616c 7365 293a 0d0a 2020 2020 2020  =False):..      
-0002d5c0: 2020 2222 220d 0a20 2020 2020 2020 2041    """..        A
-0002d5d0: 7474 656d 7074 7320 746f 206c 6f67 696e  ttempts to login
-0002d5e0: 2074 6f20 536b 7970 6520 6f6e 6c69 6e65   to Skype online
-0002d5f0: 2073 6572 7669 6365 2e0d 0a0d 0a20 2020   service.....   
-0002d600: 2020 2020 2040 7061 7261 6d20 2020 7379       @param   sy
-0002d610: 6e63 2020 7768 6574 6865 7220 7379 6e63  nc  whether sync
-0002d620: 2073 686f 756c 6420 7374 6172 7420 6175   should start au
-0002d630: 746f 6d61 7469 6361 6c6c 7920 6166 7465  tomatically afte
-0002d640: 7220 6c6f 6769 6e0d 0a20 2020 2020 2020  r login..       
-0002d650: 2022 2222 0d0a 2020 2020 2020 2020 6966   """..        if
-0002d660: 206e 6f74 2073 656c 6620 6f72 206e 6f74   not self or not
-0002d670: 2073 656c 662e 6564 6974 5f70 772e 5661   self.edit_pw.Va
-0002d680: 6c75 6520 6f72 206e 6f74 206c 6976 652e  lue or not live.
-0002d690: 736b 7079 3a20 7265 7475 726e 0d0a 2020  skpy: return..  
-0002d6a0: 2020 2020 2020 7365 6c66 2e65 6469 745f        self.edit_
-0002d6b0: 6c6f 6769 6e5f 7374 6174 7573 2e56 616c  login_status.Val
-0002d6c0: 7565 203d 2022 4c6f 6767 696e 6720 696e  ue = "Logging in
-0002d6d0: 2074 6f20 536b 7970 652e 2e22 0d0a 2020   to Skype.."..  
-0002d6e0: 2020 2020 2020 666f 7220 6320 696e 2073        for c in s
-0002d6f0: 656c 662e 7061 6e65 6c5f 6c6f 6769 6e2e  elf.panel_login.
-0002d700: 4368 696c 6472 656e 3a0d 0a20 2020 2020  Children:..     
-0002d710: 2020 2020 2020 2069 6620 6320 6973 2073         if c is s
-0002d720: 656c 662e 6564 6974 5f70 7720 6f72 2069  elf.edit_pw or i
-0002d730: 7369 6e73 7461 6e63 6528 632c 2077 782e  sinstance(c, wx.
-0002d740: 4368 6563 6b42 6f78 293a 2063 2e44 6973  CheckBox): c.Dis
-0002d750: 6162 6c65 2829 0d0a 2020 2020 2020 2020  able()..        
-0002d760: 7365 6c66 2e62 7574 746f 6e5f 7573 6572  self.button_user
-0002d770: 2e44 6973 6162 6c65 2829 0d0a 2020 2020  .Disable()..    
-0002d780: 2020 2020 7365 6c66 2e62 7574 746f 6e5f      self.button_
-0002d790: 6c6f 6769 6e2e 4469 7361 626c 6528 290d  login.Disable().
-0002d7a0: 0a20 2020 2020 2020 2073 656c 662e 7061  .        self.pa
-0002d7b0: 6e65 6c5f 6c6f 6769 6e2e 5265 6672 6573  nel_login.Refres
-0002d7c0: 6828 290d 0a20 2020 2020 2020 2061 6374  h()..        act
-0002d7d0: 696f 6e20 3d20 7b22 6163 7469 6f6e 223a  ion = {"action":
-0002d7e0: 2022 6c6f 6769 6e22 2c20 2270 6173 7377   "login", "passw
-0002d7f0: 6f72 6422 3a20 7365 6c66 2e65 6469 745f  ord": self.edit_
-0002d800: 7077 2e56 616c 7565 2c20 2273 796e 6322  pw.Value, "sync"
-0002d810: 3a20 7379 6e63 7d0d 0a20 2020 2020 2020  : sync}..       
-0002d820: 2073 656c 662e 776f 726b 6572 5f6c 6976   self.worker_liv
-0002d830: 652e 776f 726b 2861 6374 696f 6e29 0d0a  e.work(action)..
-0002d840: 0d0a 0d0a 2020 2020 6465 6620 6f6e 5f6c  ....    def on_l
-0002d850: 6976 655f 7379 6e63 2873 656c 662c 2065  ive_sync(self, e
-0002d860: 7665 6e74 3d4e 6f6e 6529 3a0d 0a20 2020  vent=None):..   
-0002d870: 2020 2020 2022 2222 5374 6172 7473 2073       """Starts s
-0002d880: 796e 6368 726f 6e69 7a69 6e67 206c 6f63  ynchronizing loc
-0002d890: 616c 2064 6174 6162 6173 6520 6672 6f6d  al database from
-0002d8a0: 2053 6b79 7065 206f 6e6c 696e 6520 7365   Skype online se
-0002d8b0: 7276 6963 652e 2222 220d 0a20 2020 2020  rvice."""..     
-0002d8c0: 2020 2073 656c 662e 6c61 6265 6c5f 7379     self.label_sy
-0002d8d0: 6e63 5f70 726f 6772 6573 732e 4c61 6265  nc_progress.Labe
-0002d8e0: 6c20 3d20 2255 7064 6174 696e 6720 6c6f  l = "Updating lo
-0002d8f0: 6361 6c20 6461 7461 6261 7365 2066 726f  cal database fro
-0002d900: 6d20 536b 7970 6520 6f6e 6c69 6e65 2073  m Skype online s
-0002d910: 6572 7669 6365 2e2e 220d 0a20 2020 2020  ervice.."..     
-0002d920: 2020 2073 656c 662e 6c69 7374 5f63 6861     self.list_cha
-0002d930: 7473 5f73 796e 632e 4465 6c65 7465 416c  ts_sync.DeleteAl
-0002d940: 6c49 7465 6d73 2829 0d0a 2020 2020 2020  lItems()..      
-0002d950: 2020 7365 6c66 2e65 6469 745f 7379 6e63    self.edit_sync
-0002d960: 5f73 7461 7475 732e 436c 6561 7228 290d  _status.Clear().
-0002d970: 0a20 2020 2020 2020 2073 656c 662e 6761  .        self.ga
-0002d980: 7567 655f 7379 6e63 2e50 756c 7365 2829  uge_sync.Pulse()
-0002d990: 0d0a 2020 2020 2020 2020 7365 6c66 2e63  ..        self.c
-0002d9a0: 6865 636b 5f73 796e 635f 636f 6e74 6163  heck_sync_contac
-0002d9b0: 7473 2e45 6e61 626c 6564 203d 2073 656c  ts.Enabled = sel
-0002d9c0: 662e 6368 6563 6b5f 7379 6e63 5f6f 6c64  f.check_sync_old
-0002d9d0: 6572 2e45 6e61 626c 6564 203d 2046 616c  er.Enabled = Fal
-0002d9e0: 7365 0d0a 2020 2020 2020 2020 7365 6c66  se..        self
-0002d9f0: 2e62 7574 746f 6e5f 7379 6e63 2e45 6e61  .button_sync.Ena
-0002da00: 626c 6564 203d 2073 656c 662e 6275 7474  bled = self.butt
-0002da10: 6f6e 5f73 796e 635f 7365 6c2e 456e 6162  on_sync_sel.Enab
-0002da20: 6c65 6420 3d20 4661 6c73 650d 0a20 2020  led = False..   
-0002da30: 2020 2020 2073 656c 662e 6275 7474 6f6e       self.button
-0002da40: 5f73 796e 635f 7374 6f70 2e45 6e61 626c  _sync_stop.Enabl
-0002da50: 6528 290d 0a20 2020 2020 2020 2073 656c  e()..        sel
-0002da60: 662e 6761 7567 655f 7379 6e63 2e43 6f6e  f.gauge_sync.Con
-0002da70: 7461 696e 696e 6753 697a 6572 2e4c 6179  tainingSizer.Lay
-0002da80: 6f75 7428 290d 0a20 2020 2020 2020 2073  out()..        s
-0002da90: 656c 662e 776f 726b 6572 5f6c 6976 652e  elf.worker_live.
-0002daa0: 776f 726b 287b 2261 6374 696f 6e22 3a20  work({"action": 
-0002dab0: 2270 6f70 756c 6174 6522 7d29 0d0a 0d0a  "populate"})....
-0002dac0: 0d0a 2020 2020 6465 6620 6f6e 5f6c 6976  ..    def on_liv
-0002dad0: 655f 7379 6e63 5f73 656c 2873 656c 662c  e_sync_sel(self,
-0002dae0: 2065 7665 6e74 3d4e 6f6e 6529 3a0d 0a20   event=None):.. 
-0002daf0: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
-0002db00: 2020 2020 4f70 656e 7320 6368 6f69 6365      Opens choice
-0002db10: 2064 6961 6c6f 6720 666f 7220 7365 6c65   dialog for sele
-0002db20: 6374 696e 6720 6368 6174 7320 616e 6420  cting chats and 
-0002db30: 7374 6172 7473 2073 796e 6368 726f 6e69  starts synchroni
-0002db40: 7a69 6e67 0d0a 2020 2020 2020 2020 6c6f  zing..        lo
-0002db50: 6361 6c20 6461 7461 6261 7365 2066 726f  cal database fro
-0002db60: 6d20 536b 7970 6520 6f6e 6c69 6e65 2073  m Skype online s
-0002db70: 6572 7669 6365 2e0d 0a20 2020 2020 2020  ervice...       
-0002db80: 2022 2222 0d0a 2020 2020 2020 2020 4649   """..        FI
-0002db90: 454c 4453 203d 205b 2269 6465 6e74 6974  ELDS = ["identit
-0002dba0: 7922 2c20 2274 6974 6c65 222c 2022 7469  y", "title", "ti
-0002dbb0: 746c 655f 6c6f 6e67 222c 2022 7479 7065  tle_long", "type
-0002dbc0: 225d 0d0a 2020 2020 2020 2020 6368 6174  "]..        chat
-0002dbd0: 7320 3d20 736f 7274 6564 2873 656c 662e  s = sorted(self.
-0002dbe0: 6368 6174 732c 206b 6579 3d6c 616d 6264  chats, key=lambd
-0002dbf0: 6120 783a 2028 785b 2274 7970 6522 5d2c  a x: (x["type"],
-0002dc00: 2078 5b22 7469 746c 6522 5d2e 6c6f 7765   x["title"].lowe
-0002dc10: 7228 2929 290d 0a20 2020 2020 2020 2063  r()))..        c
-0002dc20: 6861 7473 203d 205b 7b6b 3a20 782e 6765  hats = [{k: x.ge
-0002dc30: 7428 6b29 2066 6f72 206b 2069 6e20 4649  t(k) for k in FI
-0002dc40: 454c 4453 7d20 666f 7220 7820 696e 2063  ELDS} for x in c
-0002dc50: 6861 7473 5d0d 0a20 2020 2020 2020 2066  hats]..        f
-0002dc60: 6f72 2078 2069 6e20 6368 6174 733a 0d0a  or x in chats:..
-0002dc70: 2020 2020 2020 2020 2020 2020 7420 3d20              t = 
-0002dc80: 785b 2274 6974 6c65 225d 2069 6620 736b  x["title"] if sk
-0002dc90: 7970 6564 6174 612e 4348 4154 535f 5459  ypedata.CHATS_TY
-0002dca0: 5045 5f53 494e 474c 4520 3d3d 2078 5b22  PE_SINGLE == x["
-0002dcb0: 7479 7065 225d 2065 6c73 6520 785b 2274  type"] else x["t
-0002dcc0: 6974 6c65 5f6c 6f6e 6722 5d0d 0a20 2020  itle_long"]..   
-0002dcd0: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
-0002dce0: 7429 203e 2036 303a 0d0a 2020 2020 2020  t) > 60:..      
-0002dcf0: 2020 2020 2020 2020 2020 7420 3d20 2225            t = "%
-0002dd00: 732e 2e22 2025 2074 5b3a 3630 5d0d 0a20  s.." % t[:60].. 
-0002dd10: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0002dd20: 6620 736b 7970 6564 6174 612e 4348 4154  f skypedata.CHAT
-0002dd30: 535f 5459 5045 5f53 494e 474c 4520 213d  S_TYPE_SINGLE !=
-0002dd40: 2078 5b22 7479 7065 225d 3a20 7420 2b3d   x["type"]: t +=
-0002dd50: 2027 2227 0d0a 2020 2020 2020 2020 2020   '"'..          
-0002dd60: 2020 6966 2073 6b79 7065 6461 7461 2e43    if skypedata.C
-0002dd70: 4841 5453 5f54 5950 455f 5349 4e47 4c45  HATS_TYPE_SINGLE
-0002dd80: 203d 3d20 785b 2274 7970 6522 5d20 616e   == x["type"] an
-0002dd90: 6420 785b 2269 6465 6e74 6974 7922 5d20  d x["identity"] 
-0002dda0: 213d 2078 5b22 7469 746c 6522 5d3a 0d0a  != x["title"]:..
-0002ddb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ddc0: 7420 2b3d 2022 2028 2573 2922 2025 2078  t += " (%s)" % x
-0002ddd0: 5b22 6964 656e 7469 7479 225d 0d0a 2020  ["identity"]..  
-0002dde0: 2020 2020 2020 2020 2020 785b 2274 6974            x["tit
-0002ddf0: 6c65 225d 203d 2074 0d0a 0d0a 2020 2020  le"] = t....    
-0002de00: 2020 2020 646c 6720 3d20 7778 2e4d 756c      dlg = wx.Mul
-0002de10: 7469 4368 6f69 6365 4469 616c 6f67 2873  tiChoiceDialog(s
-0002de20: 656c 662c 2022 5365 6c65 6374 2063 6861  elf, "Select cha
-0002de30: 7473 2074 6f20 7570 6461 7465 3a22 2c0d  ts to update:",.
-0002de40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002de50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002de60: 2020 2020 636f 6e66 2e54 6974 6c65 2c20      conf.Title, 
-0002de70: 5b78 5b22 7469 746c 6522 5d20 666f 7220  [x["title"] for 
-0002de80: 7820 696e 2063 6861 7473 5d29 0d0a 2020  x in chats])..  
-0002de90: 2020 2020 2020 6966 2077 782e 4944 5f4f        if wx.ID_O
-0002dea0: 4b20 213d 2064 6c67 2e53 686f 774d 6f64  K != dlg.ShowMod
-0002deb0: 616c 2829 206f 7220 6e6f 7420 646c 672e  al() or not dlg.
-0002dec0: 4765 7453 656c 6563 7469 6f6e 7328 293a  GetSelections():
-0002ded0: 2072 6574 7572 6e0d 0a0d 0a20 2020 2020   return....     
-0002dee0: 2020 2073 656c 6368 6174 7320 3d20 5b63     selchats = [c
-0002def0: 6861 7473 5b69 5d20 666f 7220 6920 696e  hats[i] for i in
-0002df00: 2064 6c67 2e47 6574 5365 6c65 6374 696f   dlg.GetSelectio
-0002df10: 6e73 2829 5d0d 0a20 2020 2020 2020 2073  ns()]..        s
-0002df20: 6c61 6265 6c20 3d20 2255 7064 6174 696e  label = "Updatin
-0002df30: 6720 2573 2028 2573 2920 6672 6f6d 2053  g %s (%s) from S
-0002df40: 6b79 7065 206f 6e6c 696e 6520 7365 7276  kype online serv
-0002df50: 6963 652e 2e22 2025 2028 0d0a 2020 2020  ice.." % (..    
-0002df60: 2020 2020 2020 2020 2020 2020 2075 7469               uti
-0002df70: 6c2e 706c 7572 616c 2822 6368 6174 222c  l.plural("chat",
-0002df80: 2073 656c 6368 6174 732c 2073 6570 3d22   selchats, sep="
-0002df90: 2c22 292c 2022 2c20 222e 6a6f 696e 2878  ,"), ", ".join(x
-0002dfa0: 5b22 7469 746c 6522 5d20 666f 7220 7820  ["title"] for x 
-0002dfb0: 696e 2073 656c 6368 6174 7329 290d 0a20  in selchats)).. 
-0002dfc0: 2020 2020 2020 2070 6c61 6265 6c20 3d20         plabel = 
-0002dfd0: 2255 7064 6174 696e 6720 2573 2066 726f  "Updating %s fro
-0002dfe0: 6d20 536b 7970 6520 6f6e 6c69 6e65 2073  m Skype online s
-0002dff0: 6572 7669 6365 2e2e 2220 2520 7574 696c  ervice.." % util
-0002e000: 2e70 6c75 7261 6c28 2263 6861 7422 2c20  .plural("chat", 
-0002e010: 7365 6c63 6861 7473 2c20 7365 703d 222c  selchats, sep=",
-0002e020: 2229 0d0a 2020 2020 2020 2020 7365 6c66  ")..        self
-0002e030: 2e65 6469 745f 7379 6e63 5f73 7461 7475  .edit_sync_statu
-0002e040: 732e 5661 6c75 6520 2b3d 2028 225c 6e5c  s.Value += ("\n\
-0002e050: 6e22 2069 6620 7365 6c66 2e65 6469 745f  n" if self.edit_
-0002e060: 7379 6e63 5f73 7461 7475 732e 5661 6c75  sync_status.Valu
-0002e070: 6520 656c 7365 2022 2229 202b 2073 6c61  e else "") + sla
-0002e080: 6265 6c0d 0a20 2020 2020 2020 2073 656c  bel..        sel
-0002e090: 662e 6564 6974 5f73 796e 635f 7374 6174  f.edit_sync_stat
-0002e0a0: 7573 2e53 686f 7750 6f73 6974 696f 6e28  us.ShowPosition(
-0002e0b0: 7365 6c66 2e65 6469 745f 7379 6e63 5f73  self.edit_sync_s
-0002e0c0: 7461 7475 732e 4c61 7374 506f 7369 7469  tatus.LastPositi
-0002e0d0: 6f6e 290d 0a20 2020 2020 2020 2073 656c  on)..        sel
-0002e0e0: 662e 6c61 6265 6c5f 7379 6e63 5f70 726f  f.label_sync_pro
-0002e0f0: 6772 6573 732e 4c61 6265 6c20 3d20 706c  gress.Label = pl
-0002e100: 6162 656c 0d0a 2020 2020 2020 2020 7365  abel..        se
-0002e110: 6c66 2e6c 6973 745f 6368 6174 735f 7379  lf.list_chats_sy
-0002e120: 6e63 2e44 656c 6574 6541 6c6c 4974 656d  nc.DeleteAllItem
-0002e130: 7328 290d 0a20 2020 2020 2020 2073 656c  s()..        sel
-0002e140: 662e 6564 6974 5f73 796e 635f 7374 6174  f.edit_sync_stat
-0002e150: 7573 2e43 6c65 6172 2829 0d0a 2020 2020  us.Clear()..    
-0002e160: 2020 2020 7365 6c66 2e67 6175 6765 5f73      self.gauge_s
-0002e170: 796e 632e 5075 6c73 6528 290d 0a20 2020  ync.Pulse()..   
-0002e180: 2020 2020 2073 656c 662e 6368 6563 6b5f       self.check_
-0002e190: 7379 6e63 5f63 6f6e 7461 6374 732e 456e  sync_contacts.En
-0002e1a0: 6162 6c65 6420 3d20 7365 6c66 2e63 6865  abled = self.che
-0002e1b0: 636b 5f73 796e 635f 6f6c 6465 722e 456e  ck_sync_older.En
-0002e1c0: 6162 6c65 6420 3d20 4661 6c73 650d 0a20  abled = False.. 
-0002e1d0: 2020 2020 2020 2073 656c 662e 6275 7474         self.butt
-0002e1e0: 6f6e 5f73 796e 632e 456e 6162 6c65 6420  on_sync.Enabled 
-0002e1f0: 3d20 7365 6c66 2e62 7574 746f 6e5f 7379  = self.button_sy
-0002e200: 6e63 5f73 656c 2e45 6e61 626c 6564 203d  nc_sel.Enabled =
-0002e210: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
-0002e220: 7365 6c66 2e62 7574 746f 6e5f 7379 6e63  self.button_sync
-0002e230: 5f73 746f 702e 456e 6162 6c65 2829 0d0a  _stop.Enable()..
-0002e240: 2020 2020 2020 2020 7365 6c66 2e67 6175          self.gau
-0002e250: 6765 5f73 796e 632e 436f 6e74 6169 6e69  ge_sync.Containi
-0002e260: 6e67 5369 7a65 722e 4c61 796f 7574 2829  ngSizer.Layout()
-0002e270: 0d0a 2020 2020 2020 2020 7365 6c66 2e77  ..        self.w
-0002e280: 6f72 6b65 725f 6c69 7665 2e77 6f72 6b28  orker_live.work(
-0002e290: 7b22 6163 7469 6f6e 223a 2022 706f 7075  {"action": "popu
-0002e2a0: 6c61 7465 222c 2022 6368 6174 7322 3a20  late", "chats": 
-0002e2b0: 5b78 5b22 6964 656e 7469 7479 225d 2066  [x["identity"] f
-0002e2c0: 6f72 2078 2069 6e20 7365 6c63 6861 7473  or x in selchats
-0002e2d0: 5d7d 290d 0a0d 0a0d 0a20 2020 2064 6566  ]})......    def
-0002e2e0: 206f 6e5f 6c69 7665 5f73 796e 635f 7374   on_live_sync_st
-0002e2f0: 6f70 2873 656c 662c 2065 7665 6e74 3d4e  op(self, event=N
-0002e300: 6f6e 6529 3a0d 0a20 2020 2020 2020 2022  one):..        "
-0002e310: 2222 5374 6f70 7320 7379 6e63 6872 6f6e  ""Stops synchron
-0002e320: 697a 696e 6720 6c6f 6361 6c20 6461 7461  izing local data
-0002e330: 6261 7365 2066 726f 6d20 536b 7970 6520  base from Skype 
-0002e340: 6f6e 6c69 6e65 2073 6572 7669 6365 2e22  online service."
-0002e350: 2222 0d0a 2020 2020 2020 2020 6966 2077  ""..        if w
-0002e360: 782e 4f4b 2021 3d20 7778 2e4d 6573 7361  x.OK != wx.Messa
-0002e370: 6765 426f 7828 2241 7265 2079 6f75 2073  geBox("Are you s
-0002e380: 7572 6520 796f 7520 7761 6e74 2074 6f20  ure you want to 
-0002e390: 7374 6f70 2073 796e 6368 726f 6e69 7a61  stop synchroniza
-0002e3a0: 7469 6f6e 3f22 2c0d 0a20 2020 2020 2020  tion?",..       
-0002e3b0: 2020 2020 2063 6f6e 662e 5469 746c 652c       conf.Title,
-0002e3c0: 2077 782e 4943 4f4e 5f51 5545 5354 494f   wx.ICON_QUESTIO
-0002e3d0: 4e20 7c20 7778 2e4f 4b20 7c20 7778 2e43  N | wx.OK | wx.C
-0002e3e0: 414e 4345 4c0d 0a20 2020 2020 2020 2029  ANCEL..        )
-0002e3f0: 206f 7220 6e6f 7420 7365 6c66 2e77 6f72   or not self.wor
-0002e400: 6b65 725f 6c69 7665 2e69 735f 776f 726b  ker_live.is_work
-0002e410: 696e 6728 293a 2072 6574 7572 6e0d 0a20  ing(): return.. 
-0002e420: 2020 2020 2020 2073 656c 662e 6761 7567         self.gaug
-0002e430: 655f 7379 6e63 2e56 616c 7565 203d 2073  e_sync.Value = s
-0002e440: 656c 662e 6761 7567 655f 7379 6e63 2e56  elf.gauge_sync.V
-0002e450: 616c 7565 2023 2053 746f 7020 7075 6c73  alue # Stop puls
-0002e460: 652c 2069 6620 616e 790d 0a20 2020 2020  e, if any..     
-0002e470: 2020 2073 656c 662e 6368 6563 6b5f 7379     self.check_sy
-0002e480: 6e63 5f63 6f6e 7461 6374 732e 456e 6162  nc_contacts.Enab
-0002e490: 6c65 6420 3d20 7365 6c66 2e63 6865 636b  led = self.check
-0002e4a0: 5f73 796e 635f 6f6c 6465 722e 456e 6162  _sync_older.Enab
-0002e4b0: 6c65 6420 3d20 5472 7565 0d0a 2020 2020  led = True..    
-0002e4c0: 2020 2020 7365 6c66 2e62 7574 746f 6e5f      self.button_
-0002e4d0: 7379 6e63 2e45 6e61 626c 6564 203d 2073  sync.Enabled = s
-0002e4e0: 656c 662e 6275 7474 6f6e 5f73 796e 635f  elf.button_sync_
-0002e4f0: 7365 6c2e 456e 6162 6c65 6420 3d20 5472  sel.Enabled = Tr
-0002e500: 7565 0d0a 2020 2020 2020 2020 7365 6c66  ue..        self
-0002e510: 2e62 7574 746f 6e5f 7379 6e63 5f73 746f  .button_sync_sto
-0002e520: 702e 4469 7361 626c 6528 290d 0a20 2020  p.Disable()..   
-0002e530: 2020 2020 2073 656c 662e 6761 7567 655f       self.gauge_
-0002e540: 7379 6e63 2e43 6f6e 7461 696e 696e 6753  sync.ContainingS
-0002e550: 697a 6572 2e4c 6179 6f75 7428 290d 0a20  izer.Layout().. 
-0002e560: 2020 2020 2020 2073 656c 662e 776f 726b         self.work
-0002e570: 6572 5f6c 6976 652e 7374 6f70 5f77 6f72  er_live.stop_wor
-0002e580: 6b28 290d 0a0d 0a0d 0a20 2020 2064 6566  k()......    def
-0002e590: 206f 6e5f 6c69 7665 5f73 796e 635f 6974   on_live_sync_it
-0002e5a0: 656d 7328 7365 6c66 2c20 6368 6174 733d  ems(self, chats=
-0002e5b0: 2829 2c20 636f 6e74 6163 7473 3d28 292c  (), contacts=(),
-0002e5c0: 206d 6573 7361 6765 733d 5472 7565 293a   messages=True):
-0002e5d0: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
-0002e5e0: 2020 2020 2020 204f 7065 6e73 206f 6e6c         Opens onl
-0002e5f0: 696e 6520 7061 6765 2c20 6c6f 6773 2069  ine page, logs i
-0002e600: 6e20 6966 206e 6f74 206c 6f67 6765 6420  n if not logged 
-0002e610: 696e 2c20 616e 6420 7379 6e63 6872 6f6e  in, and synchron
-0002e620: 697a 6573 2073 7065 6369 6669 6564 2069  izes specified i
-0002e630: 7465 6d73 2066 726f 6d20 6c69 7665 2e0d  tems from live..
-0002e640: 0a0d 0a20 2020 2020 2020 2040 7061 7261  ...        @para
-0002e650: 6d20 2020 6368 6174 7320 2020 2020 6c69  m   chats     li
-0002e660: 7374 206f 6620 6368 6174 7320 746f 2075  st of chats to u
-0002e670: 7064 6174 650d 0a20 2020 2020 2020 2040  pdate..        @
-0002e680: 7061 7261 6d20 2020 636f 6e74 6163 7473  param   contacts
-0002e690: 2020 6c69 7374 206f 6620 636f 6e74 6163    list of contac
-0002e6a0: 7473 2074 6f20 7570 6461 7465 2070 726f  ts to update pro
-0002e6b0: 6669 6c65 7320 666f 720d 0a20 2020 2020  files for..     
-0002e6c0: 2020 2040 7061 7261 6d20 2020 6d65 7373     @param   mess
-0002e6d0: 6167 6573 2020 7768 6574 6865 7220 746f  ages  whether to
-0002e6e0: 2073 796e 6320 6368 6174 206d 6573 7361   sync chat messa
-0002e6f0: 6765 7320 6966 2063 6861 7473 2c20 6f72  ges if chats, or
-0002e700: 206f 6e6c 7920 6368 6174 2070 6172 7469   only chat parti
-0002e710: 6369 7061 6e74 2070 726f 6669 6c65 730d  cipant profiles.
-0002e720: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
-0002e730: 2020 2020 2020 6966 206e 6f74 2063 6861        if not cha
-0002e740: 7473 2061 6e64 206e 6f74 2063 6f6e 7461  ts and not conta
-0002e750: 6374 733a 2072 6574 7572 6e0d 0a20 2020  cts: return..   
-0002e760: 2020 2020 2073 656c 662e 6e6f 7465 626f       self.notebo
-0002e770: 6f6b 2e53 6574 5365 6c65 6374 696f 6e28  ok.SetSelection(
-0002e780: 7365 6c66 2e70 6167 656f 7264 6572 5b73  self.pageorder[s
-0002e790: 656c 662e 7061 6765 5f6c 6976 655d 290d  elf.page_live]).
-0002e7a0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-0002e7b0: 7365 6c66 2e64 622e 6c69 7665 2e69 735f  self.db.live.is_
-0002e7c0: 6c6f 6767 6564 5f69 6e28 2920 616e 6420  logged_in() and 
-0002e7d0: 636f 6e66 2e4c 6f67 696e 2e67 6574 2873  conf.Login.get(s
-0002e7e0: 656c 662e 6462 2e66 696c 656e 616d 652c  elf.db.filename,
-0002e7f0: 207b 7d29 2e67 6574 2822 7061 7373 776f   {}).get("passwo
-0002e800: 7264 2229 3a0d 0a20 2020 2020 2020 2020  rd"):..         
-0002e810: 2020 2070 7764 203d 2075 7469 6c2e 6465     pwd = util.de
-0002e820: 6f62 6675 7363 6174 6528 636f 6e66 2e4c  obfuscate(conf.L
-0002e830: 6f67 696e 5b73 656c 662e 6462 2e66 696c  ogin[self.db.fil
-0002e840: 656e 616d 655d 5b22 7061 7373 776f 7264  ename]["password
-0002e850: 225d 290d 0a20 2020 2020 2020 2020 2020  "])..           
-0002e860: 2073 656c 662e 6462 2e6c 6976 652e 6c6f   self.db.live.lo
-0002e870: 6769 6e28 7061 7373 776f 7264 3d70 7764  gin(password=pwd
-0002e880: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
-0002e890: 656c 662e 6f6e 5f6c 6976 655f 6c6f 6769  elf.on_live_logi
-0002e8a0: 6e5f 7265 7375 6c74 287b 7d29 0d0a 2020  n_result({})..  
-0002e8b0: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
-0002e8c0: 662e 6462 2e6c 6976 652e 6973 5f6c 6f67  f.db.live.is_log
-0002e8d0: 6765 645f 696e 2829 3a0d 0a20 2020 2020  ged_in():..     
-0002e8e0: 2020 2020 2020 2073 656c 662e 6564 6974         self.edit
-0002e8f0: 5f70 772e 5365 7446 6f63 7573 2829 0d0a  _pw.SetFocus()..
-0002e900: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0002e910: 726e 0d0a 0d0a 2020 2020 2020 2020 7365  rn....        se
-0002e920: 6c66 2e63 6865 636b 5f73 796e 635f 636f  lf.check_sync_co
-0002e930: 6e74 6163 7473 2e45 6e61 626c 6564 203d  ntacts.Enabled =
-0002e940: 2073 656c 662e 6368 6563 6b5f 7379 6e63   self.check_sync
-0002e950: 5f6f 6c64 6572 2e45 6e61 626c 6564 203d  _older.Enabled =
-0002e960: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
-0002e970: 7365 6c66 2e62 7574 746f 6e5f 7379 6e63  self.button_sync
-0002e980: 2e45 6e61 626c 6564 203d 2073 656c 662e  .Enabled = self.
-0002e990: 6275 7474 6f6e 5f73 796e 635f 7365 6c2e  button_sync_sel.
-0002e9a0: 456e 6162 6c65 6420 3d20 4661 6c73 650d  Enabled = False.
-0002e9b0: 0a20 2020 2020 2020 2073 656c 662e 6275  .        self.bu
-0002e9c0: 7474 6f6e 5f73 796e 635f 7374 6f70 2e45  tton_sync_stop.E
-0002e9d0: 6e61 626c 6528 290d 0a20 2020 2020 2020  nable()..       
-0002e9e0: 2069 6620 6e6f 7420 7365 6c66 2e77 6f72   if not self.wor
-0002e9f0: 6b65 725f 6c69 7665 2e69 735f 776f 726b  ker_live.is_work
-0002ea00: 696e 6728 293a 0d0a 2020 2020 2020 2020  ing():..        
-0002ea10: 2020 2020 7365 6c66 2e6c 6973 745f 6368      self.list_ch
-0002ea20: 6174 735f 7379 6e63 2e44 656c 6574 6541  ats_sync.DeleteA
-0002ea30: 6c6c 4974 656d 7328 290d 0a20 2020 2020  llItems()..     
-0002ea40: 2020 2020 2020 2073 656c 662e 6564 6974         self.edit
-0002ea50: 5f73 796e 635f 7374 6174 7573 2e43 6c65  _sync_status.Cle
-0002ea60: 6172 2829 0d0a 2020 2020 2020 2020 2020  ar()..          
-0002ea70: 2020 7365 6c66 2e67 6175 6765 5f73 796e    self.gauge_syn
-0002ea80: 632e 5075 6c73 6528 290d 0a20 2020 2020  c.Pulse()..     
-0002ea90: 2020 2020 2020 2073 656c 662e 6761 7567         self.gaug
-0002eaa0: 655f 7379 6e63 2e43 6f6e 7461 696e 696e  e_sync.Containin
-0002eab0: 6753 697a 6572 2e4c 6179 6f75 7428 290d  gSizer.Layout().
-0002eac0: 0a0d 0a20 2020 2020 2020 2061 6363 6f75  ...        accou
-0002ead0: 6e74 2020 3d20 6e65 7874 2828 6320 666f  nt  = next((c fo
-0002eae0: 7220 6320 696e 2063 6f6e 7461 6374 7320  r c in contacts 
-0002eaf0: 6f72 205b 5d20 6966 2063 5b22 6964 656e  or [] if c["iden
-0002eb00: 7469 7479 225d 203d 3d20 7365 6c66 2e64  tity"] == self.d
-0002eb10: 622e 6964 292c 204e 6f6e 6529 0d0a 2020  b.id), None)..  
-0002eb20: 2020 2020 2020 6966 2061 6363 6f75 6e74        if account
-0002eb30: 3a0d 0a20 2020 2020 2020 2020 2020 2063  :..            c
-0002eb40: 6f6e 7461 6374 7320 3d20 5b63 2066 6f72  ontacts = [c for
-0002eb50: 2063 2069 6e20 636f 6e74 6163 7473 206f   c in contacts o
-0002eb60: 7220 5b5d 2069 6620 635b 2269 6465 6e74  r [] if c["ident
-0002eb70: 6974 7922 5d20 213d 2073 656c 662e 6462  ity"] != self.db
-0002eb80: 2e69 645d 0d0a 2020 2020 2020 2020 2020  .id]..          
-0002eb90: 2020 7365 6c66 2e77 6f72 6b65 725f 6c69    self.worker_li
-0002eba0: 7665 2e77 6f72 6b28 7b22 6163 7469 6f6e  ve.work({"action
-0002ebb0: 223a 2022 6163 636f 756e 7422 7d29 0d0a  ": "account"})..
-0002ebc0: 2020 2020 2020 2020 6966 2063 6f6e 7461          if conta
-0002ebd0: 6374 733a 0d0a 2020 2020 2020 2020 2020  cts:..          
-0002ebe0: 2020 7365 6c66 2e77 6f72 6b65 725f 6c69    self.worker_li
-0002ebf0: 7665 2e77 6f72 6b28 7b22 6163 7469 6f6e  ve.work({"action
-0002ec00: 223a 2022 636f 6e74 6163 7473 222c 2022  ": "contacts", "
-0002ec10: 636f 6e74 6163 7473 223a 205b 785b 2269  contacts": [x["i
-0002ec20: 6465 6e74 6974 7922 5d20 666f 7220 7820  dentity"] for x 
-0002ec30: 696e 2063 6f6e 7461 6374 735d 7d29 0d0a  in contacts]})..
-0002ec40: 2020 2020 2020 2020 6966 2063 6861 7473          if chats
-0002ec50: 2061 6e64 206d 6573 7361 6765 733a 0d0a   and messages:..
-0002ec60: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0002ec70: 2e77 6f72 6b65 725f 6c69 7665 2e77 6f72  .worker_live.wor
-0002ec80: 6b28 7b22 6163 7469 6f6e 223a 2022 6869  k({"action": "hi
-0002ec90: 7374 6f72 7922 2c20 2263 6861 7473 223a  story", "chats":
-0002eca0: 205b 785b 2269 6465 6e74 6974 7922 5d20   [x["identity"] 
-0002ecb0: 666f 7220 7820 696e 2063 6861 7473 5d7d  for x in chats]}
-0002ecc0: 290d 0a20 2020 2020 2020 2065 6c69 6620  )..        elif 
-0002ecd0: 6368 6174 733a 0d0a 2020 2020 2020 2020  chats:..        
-0002ece0: 2020 2020 7365 6c66 2e77 6f72 6b65 725f      self.worker_
-0002ecf0: 6c69 7665 2e77 6f72 6b28 7b22 6163 7469  live.work({"acti
-0002ed00: 6f6e 223a 2022 6368 6174 7322 2c20 2263  on": "chats", "c
-0002ed10: 6861 7473 223a 205b 785b 2269 6465 6e74  hats": [x["ident
-0002ed20: 6974 7922 5d20 666f 7220 7820 696e 2063  ity"] for x in c
-0002ed30: 6861 7473 5d7d 290d 0a0d 0a0d 0a20 2020  hats]})......   
-0002ed40: 2064 6566 206f 6e5f 6c69 7665 5f72 6573   def on_live_res
-0002ed50: 756c 7428 7365 6c66 2c20 7265 7375 6c74  ult(self, result
-0002ed60: 3d4e 6f6e 652c 202a 2a6b 7761 7267 7329  =None, **kwargs)
-0002ed70: 3a0d 0a20 2020 2020 2020 2022 2222 4361  :..        """Ca
-0002ed80: 6c6c 6261 636b 2066 6f72 2077 6f72 6b65  llback for worke
-0002ed90: 7273 2e4c 6976 6554 6872 6561 6420 7265  rs.LiveThread re
-0002eda0: 7375 6c74 732e 2222 220d 0a0d 0a20 2020  sults."""....   
-0002edb0: 2020 2020 2064 6566 2061 6674 6572 2872       def after(r
-0002edc0: 6573 756c 7429 3a0d 0a20 2020 2020 2020  esult):..       
-0002edd0: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
-0002ede0: 206f 7220 6e6f 7420 7265 7375 6c74 206f   or not result o
-0002edf0: 7220 2261 6374 696f 6e22 206e 6f74 2069  r "action" not i
-0002ee00: 6e20 7265 7375 6c74 3a20 7265 7475 726e  n result: return
-0002ee10: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-0002ee20: 6966 2022 6c6f 6769 6e22 2020 3d3d 2072  if "login"  == r
-0002ee30: 6573 756c 745b 2261 6374 696f 6e22 5d3a  esult["action"]:
-0002ee40: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0002ee50: 2020 7365 6c66 2e6f 6e5f 6c69 7665 5f6c    self.on_live_l
-0002ee60: 6f67 696e 5f72 6573 756c 7428 7265 7375  ogin_result(resu
-0002ee70: 6c74 290d 0a20 2020 2020 2020 2020 2020  lt)..           
-0002ee80: 2065 6c69 6620 2269 6e66 6f22 203d 3d20   elif "info" == 
-0002ee90: 7265 7375 6c74 5b22 6163 7469 6f6e 225d  result["action"]
-0002eea0: 2061 6e64 2022 6d65 7373 6167 6522 2069   and "message" i
-0002eeb0: 6e20 7265 7375 6c74 3a0d 0a20 2020 2020  n result:..     
-0002eec0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0002eed0: 6c61 6265 6c5f 7379 6e63 5f70 726f 6772  label_sync_progr
-0002eee0: 6573 732e 4c61 6265 6c20 3d20 7265 7375  ess.Label = resu
-0002eef0: 6c74 5b22 6d65 7373 6167 6522 5d20 6f72  lt["message"] or
-0002ef00: 2022 220d 0a20 2020 2020 2020 2020 2020   ""..           
-0002ef10: 2020 2020 2069 6620 2269 6e64 6578 2220       if "index" 
-0002ef20: 696e 2072 6573 756c 7420 616e 6420 2263  in result and "c
-0002ef30: 6f75 6e74 2220 696e 2072 6573 756c 743a  ount" in result:
-0002ef40: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0002ef50: 2020 2020 2020 7065 7263 656e 7420 3d20        percent = 
-0002ef60: 6d69 6e28 3130 302c 206d 6174 682e 6365  min(100, math.ce
-0002ef70: 696c 2831 3030 202a 2075 7469 6c2e 7361  il(100 * util.sa
-0002ef80: 6665 6469 7666 2872 6573 756c 745b 2269  fedivf(result["i
-0002ef90: 6e64 6578 225d 2c20 7265 7375 6c74 5b22  ndex"], result["
-0002efa0: 636f 756e 7422 5d29 2929 0d0a 2020 2020  count"])))..    
-0002efb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002efc0: 7365 6c66 2e67 6175 6765 5f73 796e 632e  self.gauge_sync.
-0002efd0: 5661 6c75 6520 3d20 7065 7263 656e 740d  Value = percent.
-0002efe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002eff0: 2073 656c 662e 6761 7567 655f 7379 6e63   self.gauge_sync
-0002f000: 2e43 6f6e 7461 696e 696e 6753 697a 6572  .ContainingSizer
-0002f010: 2e4c 6179 6f75 7428 290d 0a20 2020 2020  .Layout()..     
-0002f020: 2020 2020 2020 2065 6c69 6620 7265 7375         elif resu
-0002f030: 6c74 2e67 6574 2822 6572 726f 7222 2920  lt.get("error") 
-0002f040: 6f72 2072 6573 756c 742e 6765 7428 2264  or result.get("d
-0002f050: 6f6e 6522 293a 0d0a 2020 2020 2020 2020  one"):..        
-0002f060: 2020 2020 2020 2020 7365 6c66 2e6f 6e5f          self.on_
-0002f070: 6c69 7665 5f77 6f72 6b5f 646f 6e65 2872  live_work_done(r
-0002f080: 6573 756c 7429 0d0a 2020 2020 2020 2020  esult)..        
-0002f090: 2020 2020 656c 6966 2022 706f 7075 6c61      elif "popula
-0002f0a0: 7465 2220 3d3d 2072 6573 756c 745b 2261  te" == result["a
-0002f0b0: 6374 696f 6e22 5d3a 0d0a 2020 2020 2020  ction"]:..      
-0002f0c0: 2020 2020 2020 2020 2020 7265 6c6f 6164            reload
-0002f0d0: 7320 3d20 7b7d 2023 207b 6361 7465 676f  s = {} # {catego
-0002f0e0: 7279 3a20 7768 6574 6865 7220 746f 2072  ry: whether to r
-0002f0f0: 656c 6f61 6420 696e 2066 756c 6c20 6f72  eload in full or
-0002f100: 2072 6566 7265 7368 2055 4920 6f6e 6c79   refresh UI only
-0002f110: 7d0d 0a20 2020 2020 2020 2020 2020 2020  }..             
-0002f120: 2020 2074 6c61 6265 6c20 3d20 2822 6163     tlabel = ("ac
-0002f130: 636f 756e 7422 2069 6620 2261 6363 6f75  count" if "accou
-0002f140: 6e74 7322 203d 3d20 7265 7375 6c74 5b22  nts" == result["
-0002f150: 7461 626c 6522 5d20 656c 7365 2072 6573  table"] else res
-0002f160: 756c 745b 2274 6162 6c65 225d 290d 0a20  ult["table"]).. 
-0002f170: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0002f180: 6c61 6265 6c2c 2073 6c61 6265 6c2c 2063  label, slabel, c
-0002f190: 6861 7420 3d20 7522 5379 6e63 6872 6f6e  hat = u"Synchron
-0002f1a0: 697a 696e 6720 2573 2220 2520 746c 6162  izing %s" % tlab
-0002f1b0: 656c 2c20 4e6f 6e65 2c20 4e6f 6e65 0d0a  el, None, None..
-0002f1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f1d0: 6966 2072 6573 756c 742e 6765 7428 2263  if result.get("c
-0002f1e0: 6861 7422 293a 0d0a 2020 2020 2020 2020  hat"):..        
-0002f1f0: 2020 2020 2020 2020 2020 2020 6368 6174              chat
-0002f200: 2020 3d20 6e65 7874 2828 6320 666f 7220    = next((c for 
-0002f210: 6320 696e 2073 656c 662e 6368 6174 7320  c in self.chats 
-0002f220: 6966 2063 5b22 6964 656e 7469 7479 225d  if c["identity"]
-0002f230: 203d 3d20 7265 7375 6c74 5b22 6368 6174   == result["chat
-0002f240: 225d 292c 204e 6f6e 6529 0d0a 2020 2020  "]), None)..    
-0002f250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f260: 6966 206e 6f74 2063 6861 743a 0d0a 2020  if not chat:..  
-0002f270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f280: 2020 2020 2020 6363 203d 2073 656c 662e        cc = self.
-0002f290: 6462 2e67 6574 5f63 6f6e 7665 7273 6174  db.get_conversat
-0002f2a0: 696f 6e73 2863 6861 7469 6465 6e74 6974  ions(chatidentit
-0002f2b0: 6965 733d 5b72 6573 756c 745b 2263 6861  ies=[result["cha
-0002f2c0: 7422 5d5d 2c20 7265 6c6f 6164 3d54 7275  t"]], reload=Tru
-0002f2d0: 652c 206c 6f67 3d46 616c 7365 290d 0a20  e, log=False).. 
-0002f2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f2f0: 2020 2020 2020 2073 656c 662e 6368 6174         self.chat
-0002f300: 732e 6578 7465 6e64 2863 6329 0d0a 2020  s.extend(cc)..  
-0002f310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f320: 2020 2020 2020 6966 2063 633a 2063 6861        if cc: cha
-0002f330: 7420 3d20 6363 5b30 5d0d 0a0d 0a20 2020  t = cc[0]....   
-0002f340: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0002f350: 226d 6573 7361 6765 7322 203d 3d20 7265  "messages" == re
-0002f360: 7375 6c74 5b22 7461 626c 6522 5d20 616e  sult["table"] an
-0002f370: 6420 7265 7375 6c74 2e67 6574 2822 6368  d result.get("ch
-0002f380: 6174 2229 3a0d 0a20 2020 2020 2020 2020  at"):..         
-0002f390: 2020 2020 2020 2020 2020 2074 6974 6c65             title
-0002f3a0: 203d 2063 6861 745b 2274 6974 6c65 5f6c   = chat["title_l
-0002f3b0: 6f6e 675f 6c63 225d 2069 6620 6368 6174  ong_lc"] if chat
-0002f3c0: 2065 6c73 6520 7265 7375 6c74 5b22 6368   else result["ch
-0002f3d0: 6174 225d 0d0a 2020 2020 2020 2020 2020  at"]..          
-0002f3e0: 2020 2020 2020 2020 2020 6966 206c 656e            if len
-0002f3f0: 2874 6974 6c65 2920 3e20 3335 3a0d 0a20  (title) > 35:.. 
-0002f400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f410: 2020 2020 2020 2074 6974 6c65 203d 2074         title = t
-0002f420: 6974 6c65 5b3a 3335 5d20 2b20 222e 2e22  itle[:35] + ".."
-0002f430: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0002f440: 2020 2020 2020 2020 2020 6966 2063 6861            if cha
-0002f450: 7420 616e 6420 736b 7970 6564 6174 612e  t and skypedata.
-0002f460: 4348 4154 535f 5459 5045 5f47 524f 5550  CHATS_TYPE_GROUP
-0002f470: 203d 3d20 6368 6174 5b22 7479 7065 225d   == chat["type"]
-0002f480: 3a20 7469 746c 6520 2b3d 2027 2227 0d0a  : title += '"'..
-0002f490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f4a0: 2020 2020 706c 6162 656c 202b 3d20 2220      plabel += " 
-0002f4b0: 696e 2025 7322 2025 2074 6974 6c65 0d0a  in %s" % title..
-0002f4c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0002f4d0: 2020 6966 2072 6573 756c 742e 6765 7428    if result.get(
-0002f4e0: 2263 6f75 6e74 2229 3a0d 0a20 2020 2020  "count"):..     
-0002f4f0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0002f500: 6c61 6265 6c20 3d20 222c 2025 7320 7072  label = ", %s pr
-0002f510: 6f63 6573 7365 6422 2025 2072 6573 756c  ocessed" % resul
-0002f520: 745b 2263 6f75 6e74 225d 0d0a 2020 2020  t["count"]..    
-0002f530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f540: 666f 7220 6b20 696e 2022 6e65 7722 2c20  for k in "new", 
-0002f550: 2275 7064 6174 6564 223a 0d0a 2020 2020  "updated":..    
-0002f560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f570: 2020 2020 6966 2072 6573 756c 742e 6765      if result.ge
-0002f580: 7428 6b29 3a20 636c 6162 656c 202b 3d20  t(k): clabel += 
-0002f590: 222c 2025 7320 2573 2220 2520 2872 6573  ", %s %s" % (res
-0002f5a0: 756c 745b 6b5d 2c20 6b29 0d0a 2020 2020  ult[k], k)..    
-0002f5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f5c0: 706c 6162 656c 202b 3d20 636c 6162 656c  plabel += clabel
-0002f5d0: 202b 2022 2e22 0d0a 2020 2020 2020 2020   + "."..        
-0002f5e0: 2020 2020 2020 2020 656c 6966 2072 6573          elif res
-0002f5f0: 756c 742e 6765 7428 2273 7461 7274 2229  ult.get("start")
-0002f600: 2061 6e64 2022 6368 6174 7322 203d 3d20   and "chats" == 
-0002f610: 7265 7375 6c74 5b22 7461 626c 6522 5d20  result["table"] 
-0002f620: 616e 6420 2263 6964 656e 7469 7479 2220  and "cidentity" 
-0002f630: 696e 2072 6573 756c 743a 0d0a 2020 2020  in result:..    
-0002f640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f650: 706c 6162 656c 203d 2073 6c61 6265 6c20  plabel = slabel 
-0002f660: 3d20 2253 796e 6368 726f 6e69 7a69 6e67  = "Synchronizing
-0002f670: 206d 6573 7361 6765 732e 2e22 0d0a 0d0a   messages.."....
-0002f680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f690: 6966 2072 6573 756c 742e 6765 7428 2265  if result.get("e
-0002f6a0: 6e64 2229 3a0d 0a20 2020 2020 2020 2020  nd"):..         
-0002f6b0: 2020 2020 2020 2020 2020 2073 6c61 6265             slabe
-0002f6c0: 6c20 3d20 2253 796e 6368 726f 6e69 7a65  l = "Synchronize
-0002f6d0: 6420 2573 2220 2520 746c 6162 656c 0d0a  d %s" % tlabel..
-0002f6e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0002f6f0: 2020 2020 2020 6966 2022 6163 636f 756e        if "accoun
-0002f700: 7473 2220 3d3d 2072 6573 756c 745b 2274  ts" == result["t
-0002f710: 6162 6c65 225d 3a0d 0a20 2020 2020 2020  able"]:..       
-0002f720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f730: 2069 6620 7265 7375 6c74 5b22 6964 656e   if result["iden
-0002f740: 7469 7469 6573 225d 3a0d 0a20 2020 2020  tities"]:..     
-0002f750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f760: 2020 2020 2020 2072 656c 6f61 6473 2e75         reloads.u
-0002f770: 7064 6174 6528 6163 636f 756e 7473 3d54  pdate(accounts=T
-0002f780: 7275 652c 2063 6f6e 7461 6374 733d 4e6f  rue, contacts=No
-0002f790: 6e65 290d 0a0d 0a20 2020 2020 2020 2020  ne)....         
-0002f7a0: 2020 2020 2020 2020 2020 2069 6620 2263             if "c
-0002f7b0: 6f6e 7461 6374 7322 203d 3d20 7265 7375  ontacts" == resu
-0002f7c0: 6c74 5b22 7461 626c 6522 5d3a 0d0a 2020  lt["table"]:..  
-0002f7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f7e0: 2020 2020 2020 6966 2072 6573 756c 745b        if result[
-0002f7f0: 2269 6465 6e74 6974 6965 7322 5d3a 0d0a  "identities"]:..
-0002f800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f810: 2020 2020 2020 2020 2020 2020 7265 6c6f              relo
-0002f820: 6164 732e 7570 6461 7465 2863 6f6e 7461  ads.update(conta
-0002f830: 6374 733d 7265 7375 6c74 5b22 6964 656e  cts=result["iden
-0002f840: 7469 7469 6573 225d 290d 0a0d 0a20 2020  tities"])....   
-0002f850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f860: 2069 6620 2263 6861 7473 2220 3d3d 2072   if "chats" == r
-0002f870: 6573 756c 745b 2274 6162 6c65 225d 3a0d  esult["table"]:.
-0002f880: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002f890: 2020 2020 2020 2020 2073 6c61 6265 6c20           slabel 
-0002f8a0: 3d20 2253 796e 6368 726f 6e69 7a65 6420  = "Synchronized 
-0002f8b0: 2573 2573 2220 2520 280d 0a20 2020 2020  %s%s" % (..     
+0002a7e0: 6d65 6e75 2c20 2d31 2c20 2226 436f 7079  menu, -1, "&Copy
+0002a7f0: 2025 7322 2025 0d0a 2020 2020 2020 2020   %s" %..        
+0002a800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a810: 2020 2020 2020 2020 2020 2020 7574 696c              util
+0002a820: 2e70 6c75 7261 6c28 2274 6974 6c65 222c  .plural("title",
+0002a830: 2063 6861 7473 2c20 6e75 6d62 6572 733d   chats, numbers=
+0002a840: 4661 6c73 6529 290d 0a20 2020 2020 2020  False))..       
+0002a850: 2069 7465 6d5f 636f 7079 636f 6e20 203d   item_copycon  =
+0002a860: 2077 782e 4d65 6e75 4974 656d 286d 656e   wx.MenuItem(men
+0002a870: 752c 202d 312c 2022 436f 7079 2025 7322  u, -1, "Copy %s"
+0002a880: 2025 0d0a 2020 2020 2020 2020 2020 2020   %..            
+0002a890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a8a0: 2020 2020 2020 2020 7574 696c 2e70 6c75          util.plu
+0002a8b0: 7261 6c28 2263 6f6e 2674 6163 7420 6e61  ral("con&tact na
+0002a8c0: 6d65 222c 0d0a 2020 2020 2020 2020 2020  me",..          
+0002a8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a8e0: 2020 2020 2020 2020 2020 6368 6174 735b            chats[
+0002a8f0: 305d 5b22 7061 7274 6963 6970 616e 7473  0]["participants
+0002a900: 225d 5b31 3a5d 2069 6620 6c65 6e28 6368  "][1:] if len(ch
+0002a910: 6174 7329 203c 2032 2065 6c73 6520 6368  ats) < 2 else ch
+0002a920: 6174 732c 0d0a 2020 2020 2020 2020 2020  ats,..          
+0002a930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a940: 2020 2020 2020 2020 2020 6e75 6d62 6572            number
+0002a950: 733d 4661 6c73 6529 290d 0a20 2020 2020  s=False))..     
+0002a960: 2020 2069 7465 6d5f 7265 6e61 6d65 2020     item_rename  
+0002a970: 203d 2077 782e 4d65 6e75 4974 656d 286d   = wx.MenuItem(m
+0002a980: 656e 752c 202d 312c 2022 5265 266e 616d  enu, -1, "Re&nam
+0002a990: 6522 290d 0a0d 0a20 2020 2020 2020 2069  e")....        i
+0002a9a0: 7465 6d5f 7379 6e63 6d20 2020 203d 2077  tem_syncm    = w
+0002a9b0: 782e 4d65 6e75 4974 656d 286d 656e 752c  x.MenuItem(menu,
+0002a9c0: 202d 312c 2022 5379 6e63 6872 6f6e 697a   -1, "Synchroniz
+0002a9d0: 6520 266d 6573 7361 6765 7320 616e 6420  e &messages and 
+0002a9e0: 7072 6f66 696c 6573 2229 0d0a 2020 2020  profiles")..    
+0002a9f0: 2020 2020 6974 656d 5f73 796e 6370 2020      item_syncp  
+0002aa00: 2020 3d20 7778 2e4d 656e 7549 7465 6d28    = wx.MenuItem(
+0002aa10: 6d65 6e75 2c20 2d31 2c20 2253 796e 6368  menu, -1, "Synch
+0002aa20: 726f 6e69 7a65 2026 7072 6f66 696c 6573  ronize &profiles
+0002aa30: 2229 0d0a 2020 2020 2020 2020 736d 656e  ")..        smen
+0002aa40: 752e 4170 7065 6e64 2869 7465 6d5f 7379  u.Append(item_sy
+0002aa50: 6e63 6d29 0d0a 2020 2020 2020 2020 736d  ncm)..        sm
+0002aa60: 656e 752e 4170 7065 6e64 2869 7465 6d5f  enu.Append(item_
+0002aa70: 7379 6e63 7029 0d0a 0d0a 2020 2020 2020  syncp)....      
+0002aa80: 2020 6966 2066 756c 6c6d 656e 753a 0d0a    if fullmenu:..
+0002aa90: 2020 2020 2020 2020 2020 2020 6974 656d              item
+0002aaa0: 5f65 7870 6f72 7420 3d20 7778 2e4d 656e  _export = wx.Men
+0002aab0: 7549 7465 6d28 6d65 6e75 2c20 2d31 2c20  uItem(menu, -1, 
+0002aac0: 2226 4578 706f 7274 2074 6f20 2573 2220  "&Export to %s" 
+0002aad0: 250d 0a20 2020 2020 2020 2020 2020 2020  %..             
+0002aae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002aaf0: 2020 2020 2020 2020 2075 7469 6c2e 706c           util.pl
+0002ab00: 7572 616c 2822 6669 6c65 222c 2063 6861  ural("file", cha
+0002ab10: 7473 2c20 6e75 6d62 6572 733d 4661 6c73  ts, numbers=Fals
+0002ab20: 6529 290d 0a20 2020 2020 2020 2020 2020  e))..           
+0002ab30: 2069 7465 6d5f 6578 706f 7274 6d20 3d20   item_exportm = 
+0002ab40: 6974 656d 5f64 6174 6573 6d20 3d20 4e6f  item_datesm = No
+0002ab50: 6e65 0d0a 2020 2020 2020 2020 6966 2066  ne..        if f
+0002ab60: 756c 6c6d 656e 7520 616e 6420 6578 706f  ullmenu and expo
+0002ab70: 7274 2e78 6c73 7877 7269 7465 7220 616e  rt.xlsxwriter an
+0002ab80: 6420 6c65 6e28 6368 6174 7329 203e 2031  d len(chats) > 1
+0002ab90: 3a0d 0a20 2020 2020 2020 2020 2020 2078  :..            x
+0002aba0: 6d65 6e75 203d 2077 782e 4d65 6e75 2829  menu = wx.Menu()
+0002abb0: 0d0a 2020 2020 2020 2020 2020 2020 6974  ..            it
+0002abc0: 656d 5f65 7870 6f72 746d 203d 2077 782e  em_exportm = wx.
+0002abd0: 4d65 6e75 4974 656d 286d 656e 752c 202d  MenuItem(menu, -
+0002abe0: 312c 2022 4368 6174 7320 6f6e 2026 7365  1, "Chats on &se
+0002abf0: 7061 7261 7465 2073 6865 6574 7322 290d  parate sheets").
+0002ac00: 0a20 2020 2020 2020 2020 2020 2069 7465  .            ite
+0002ac10: 6d5f 6461 7465 736d 2020 3d20 7778 2e4d  m_datesm  = wx.M
+0002ac20: 656e 7549 7465 6d28 6d65 6e75 2c20 2d31  enuItem(menu, -1
+0002ac30: 2c20 2243 6861 7473 2069 6e20 2664 6174  , "Chats in &dat
+0002ac40: 6520 7261 6e67 6520 6f6e 2073 6570 6172  e range on separ
+0002ac50: 6174 6520 7368 6565 7473 2229 0d0a 2020  ate sheets")..  
+0002ac60: 2020 2020 2020 2020 2020 786d 656e 752e            xmenu.
+0002ac70: 4170 7065 6e64 2869 7465 6d5f 6578 706f  Append(item_expo
+0002ac80: 7274 6d29 0d0a 2020 2020 2020 2020 2020  rtm)..          
+0002ac90: 2020 786d 656e 752e 4170 7065 6e64 2869    xmenu.Append(i
+0002aca0: 7465 6d5f 6461 7465 736d 290d 0a20 2020  tem_datesm)..   
+0002acb0: 2020 2020 2069 6620 6675 6c6c 6d65 6e75       if fullmenu
+0002acc0: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
+0002acd0: 7465 6d5f 6461 7465 7320 2020 3d20 7778  tem_dates   = wx
+0002ace0: 2e4d 656e 7549 7465 6d28 6d65 6e75 2c20  .MenuItem(menu, 
+0002acf0: 2d31 2c20 2245 7870 6f72 7420 2664 6174  -1, "Export &dat
+0002ad00: 6520 7261 6e67 6520 746f 2066 696c 6522  e range to file"
+0002ad10: 290d 0a20 2020 2020 2020 2069 7465 6d5f  )..        item_
+0002ad20: 6465 6c65 7465 2020 2020 2020 3d20 7778  delete      = wx
+0002ad30: 2e4d 656e 7549 7465 6d28 6d65 6e75 2c20  .MenuItem(menu, 
+0002ad40: 2d31 2c20 2244 656c 6574 6520 6672 6f6d  -1, "Delete from
+0002ad50: 2064 6174 6162 6173 6522 290d 0a0d 0a20   database").... 
+0002ad60: 2020 2020 2020 2069 6620 6675 6c6c 6d65         if fullme
+0002ad70: 6e75 3a0d 0a20 2020 2020 2020 2020 2020  nu:..           
+0002ad80: 2062 6f6c 6466 6f6e 7420 3d20 7778 2e46   boldfont = wx.F
+0002ad90: 6f6e 7428 6974 656d 5f6e 616d 652e 466f  ont(item_name.Fo
+0002ada0: 6e74 290d 0a20 2020 2020 2020 2020 2020  nt)..           
+0002adb0: 2062 6f6c 6466 6f6e 742e 5365 7457 6569   boldfont.SetWei
+0002adc0: 6768 7428 7778 2e46 4f4e 5457 4549 4748  ght(wx.FONTWEIGH
+0002add0: 545f 424f 4c44 290d 0a20 2020 2020 2020  T_BOLD)..       
+0002ade0: 2020 2020 2062 6f6c 6466 6f6e 742e 5365       boldfont.Se
+0002adf0: 7446 6163 654e 616d 6528 7365 6c66 2e46  tFaceName(self.F
+0002ae00: 6f6e 742e 4661 6365 4e61 6d65 290d 0a20  ont.FaceName).. 
+0002ae10: 2020 2020 2020 2020 2020 2062 6f6c 6466             boldf
+0002ae20: 6f6e 742e 5365 7450 6f69 6e74 5369 7a65  ont.SetPointSize
+0002ae30: 2873 656c 662e 466f 6e74 2e50 6f69 6e74  (self.Font.Point
+0002ae40: 5369 7a65 290d 0a20 2020 2020 2020 2020  Size)..         
+0002ae50: 2020 2069 7465 6d5f 6e61 6d65 2e46 6f6e     item_name.Fon
+0002ae60: 7420 3d20 626f 6c64 666f 6e74 0d0a 0d0a  t = boldfont....
+0002ae70: 2020 2020 2020 2020 6966 2066 756c 6c6d          if fullm
+0002ae80: 656e 753a 0d0a 2020 2020 2020 2020 2020  enu:..          
+0002ae90: 2020 6d65 6e75 2e41 7070 656e 6428 6974    menu.Append(it
+0002aea0: 656d 5f6e 616d 6529 0d0a 2020 2020 2020  em_name)..      
+0002aeb0: 2020 2020 2020 6d65 6e75 2e41 7070 656e        menu.Appen
+0002aec0: 6453 6570 6172 6174 6f72 2829 0d0a 2020  dSeparator()..  
+0002aed0: 2020 2020 2020 6d65 6e75 2e41 7070 656e        menu.Appen
+0002aee0: 6428 6974 656d 5f63 6f70 7929 0d0a 2020  d(item_copy)..  
+0002aef0: 2020 2020 2020 6d65 6e75 2e41 7070 656e        menu.Appen
+0002af00: 6428 6974 656d 5f63 6f70 7963 6f6e 290d  d(item_copycon).
+0002af10: 0a20 2020 2020 2020 206d 656e 752e 4170  .        menu.Ap
+0002af20: 7065 6e64 5365 7061 7261 746f 7228 290d  pendSeparator().
+0002af30: 0a20 2020 2020 2020 206d 656e 752e 4170  .        menu.Ap
+0002af40: 7065 6e64 2869 7465 6d5f 7265 6e61 6d65  pend(item_rename
+0002af50: 290d 0a20 2020 2020 2020 2069 7465 6d5f  )..        item_
+0002af60: 7061 7274 6963 6970 616e 7473 203d 206d  participants = m
+0002af70: 656e 752e 4170 7065 6e64 5375 624d 656e  enu.AppendSubMen
+0002af80: 7528 706d 656e 752c 2022 5265 6e26 616d  u(pmenu, "Ren&am
+0002af90: 6520 7061 7274 6963 6970 616e 7422 290d  e participant").
+0002afa0: 0a20 2020 2020 2020 206d 656e 752e 4170  .        menu.Ap
+0002afb0: 7065 6e64 5365 7061 7261 746f 7228 290d  pendSeparator().
+0002afc0: 0a20 2020 2020 2020 2069 7465 6d5f 7379  .        item_sy
+0002afd0: 6e63 2020 2020 2020 2020 203d 206d 656e  nc         = men
+0002afe0: 752e 4170 7065 6e64 5375 624d 656e 7528  u.AppendSubMenu(
+0002aff0: 736d 656e 752c 2022 5570 6461 7465 2066  smenu, "Update f
+0002b000: 726f 6d20 6f6e 266c 696e 6522 290d 0a20  rom on&line").. 
+0002b010: 2020 2020 2020 206d 656e 752e 4170 7065         menu.Appe
+0002b020: 6e64 5365 7061 7261 746f 7228 290d 0a20  ndSeparator().. 
+0002b030: 2020 2020 2020 2069 6620 6675 6c6c 6d65         if fullme
+0002b040: 6e75 3a0d 0a20 2020 2020 2020 2020 2020  nu:..           
+0002b050: 206d 656e 752e 4170 7065 6e64 2869 7465   menu.Append(ite
+0002b060: 6d5f 6578 706f 7274 290d 0a20 2020 2020  m_export)..     
+0002b070: 2020 2020 2020 206d 656e 752e 4170 7065         menu.Appe
+0002b080: 6e64 2869 7465 6d5f 6461 7465 7329 0d0a  nd(item_dates)..
+0002b090: 2020 2020 2020 2020 2020 2020 6966 2078              if x
+0002b0a0: 6d65 6e75 3a20 6d65 6e75 2e41 7070 656e  menu: menu.Appen
+0002b0b0: 6453 7562 4d65 6e75 2878 6d65 6e75 2c20  dSubMenu(xmenu, 
+0002b0c0: 2245 7870 6f72 7420 746f 2061 2073 696e  "Export to a sin
+0002b0d0: 676c 6520 4578 6365 6c20 2677 6f72 6b62  gle Excel &workb
+0002b0e0: 6f6f 6b22 290d 0a20 2020 2020 2020 2020  ook")..         
+0002b0f0: 2020 206d 656e 752e 4170 7065 6e64 5365     menu.AppendSe
+0002b100: 7061 7261 746f 7228 290d 0a20 2020 2020  parator()..     
+0002b110: 2020 206d 656e 752e 4170 7065 6e64 2869     menu.Append(i
+0002b120: 7465 6d5f 6465 6c65 7465 290d 0a20 2020  tem_delete)..   
+0002b130: 2020 2020 2069 6620 6675 6c6c 6d65 6e75       if fullmenu
+0002b140: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
+0002b150: 7465 6d5f 6e61 6d65 2e45 6e61 626c 6564  tem_name.Enabled
+0002b160: 2020 2020 203d 2028 3120 3d3d 206c 656e       = (1 == len
+0002b170: 2863 6861 7473 2929 0d0a 2020 2020 2020  (chats))..      
+0002b180: 2020 6974 656d 5f72 656e 616d 652e 456e    item_rename.En
+0002b190: 6162 6c65 6420 2020 2020 2020 3d20 2831  abled       = (1
+0002b1a0: 203d 3d20 6c65 6e28 6368 6174 7329 2920   == len(chats)) 
+0002b1b0: 616e 6420 616e 7928 785b 226e 616d 6522  and any(x["name"
+0002b1c0: 5d20 3d3d 2022 6769 7665 6e5f 6469 7370  ] == "given_disp
+0002b1d0: 6c61 796e 616d 6522 2066 6f72 2078 2069  layname" for x i
+0002b1e0: 6e20 6368 6174 5f63 6f6c 7329 0d0a 2020  n chat_cols)..  
+0002b1f0: 2020 2020 2020 6974 656d 5f70 6172 7469        item_parti
+0002b200: 6369 7061 6e74 732e 456e 6162 6c65 6420  cipants.Enabled 
+0002b210: 3d20 2831 203d 3d20 6c65 6e28 6368 6174  = (1 == len(chat
+0002b220: 7329 2920 616e 6420 616e 7928 785b 226e  s)) and any(x["n
+0002b230: 616d 6522 5d20 3d3d 2022 6769 7665 6e5f  ame"] == "given_
+0002b240: 6469 7370 6c61 796e 616d 6522 2066 6f72  displayname" for
+0002b250: 2078 2069 6e20 636f 6e74 6163 745f 636f   x in contact_co
+0002b260: 6c73 290d 0a0d 0a20 2020 2020 2020 2069  ls)....        i
+0002b270: 6620 6675 6c6c 6d65 6e75 3a0d 0a20 2020  f fullmenu:..   
+0002b280: 2020 2020 2020 2020 206d 656e 752e 4269           menu.Bi
+0002b290: 6e64 2877 782e 4556 545f 4d45 4e55 2c20  nd(wx.EVT_MENU, 
+0002b2a0: 6c61 6d62 6461 2065 3a20 7365 6c66 2e6c  lambda e: self.l
+0002b2b0: 6f61 645f 6368 6174 2863 6861 7473 5b30  oad_chat(chats[0
+0002b2c0: 5d29 2c20 6974 656d 5f6e 616d 6529 0d0a  ]), item_name)..
+0002b2d0: 2020 2020 2020 2020 6d65 6e75 2e42 696e          menu.Bin
+0002b2e0: 6428 7778 2e45 5654 5f4d 454e 552c 2020  d(wx.EVT_MENU,  
+0002b2f0: 6c61 6d62 6461 2065 3a20 636c 6970 626f  lambda e: clipbo
+0002b300: 6172 6469 7a65 2822 7469 746c 6522 292c  ardize("title"),
+0002b310: 2020 2020 6974 656d 5f63 6f70 7929 0d0a      item_copy)..
+0002b320: 2020 2020 2020 2020 6d65 6e75 2e42 696e          menu.Bin
+0002b330: 6428 7778 2e45 5654 5f4d 454e 552c 2020  d(wx.EVT_MENU,  
+0002b340: 6c61 6d62 6461 2065 3a20 636c 6970 626f  lambda e: clipbo
+0002b350: 6172 6469 7a65 2822 636f 6e74 6163 7422  ardize("contact"
+0002b360: 292c 2020 6974 656d 5f63 6f70 7963 6f6e  ),  item_copycon
+0002b370: 290d 0a20 2020 2020 2020 206d 656e 752e  )..        menu.
+0002b380: 4269 6e64 2877 782e 4556 545f 4d45 4e55  Bind(wx.EVT_MENU
+0002b390: 2c20 206c 616d 6264 6120 653a 2073 656c  ,  lambda e: sel
+0002b3a0: 662e 6f6e 5f72 656e 616d 655f 6368 6174  f.on_rename_chat
+0002b3b0: 2863 6861 743d 6368 6174 735b 305d 292c  (chat=chats[0]),
+0002b3c0: 2069 7465 6d5f 7265 6e61 6d65 290d 0a20   item_rename).. 
+0002b3d0: 2020 2020 2020 2073 6d65 6e75 2e42 696e         smenu.Bin
+0002b3e0: 6428 7778 2e45 5654 5f4d 454e 552c 206c  d(wx.EVT_MENU, l
+0002b3f0: 616d 6264 6120 653a 2073 796e 6328 6d65  ambda e: sync(me
+0002b400: 7373 6167 6573 3d54 7275 6529 2c20 6964  ssages=True), id
+0002b410: 3d69 7465 6d5f 7379 6e63 6d2e 4765 7449  =item_syncm.GetI
+0002b420: 6428 2929 0d0a 2020 2020 2020 2020 736d  d())..        sm
+0002b430: 656e 752e 4269 6e64 2877 782e 4556 545f  enu.Bind(wx.EVT_
+0002b440: 4d45 4e55 2c20 6c61 6d62 6461 2065 3a20  MENU, lambda e: 
+0002b450: 7379 6e63 2829 2c20 6964 3d69 7465 6d5f  sync(), id=item_
+0002b460: 7379 6e63 702e 4765 7449 6428 2929 0d0a  syncp.GetId())..
+0002b470: 2020 2020 2020 2020 6966 2066 756c 6c6d          if fullm
+0002b480: 656e 753a 0d0a 2020 2020 2020 2020 2020  enu:..          
+0002b490: 2020 6d65 6e75 2e42 696e 6428 7778 2e45    menu.Bind(wx.E
+0002b4a0: 5654 5f4d 454e 552c 206c 616d 6264 6120  VT_MENU, lambda 
+0002b4b0: 653a 2065 7870 6f72 7465 7228 4661 6c73  e: exporter(Fals
+0002b4c0: 652c 2046 616c 7365 292c 2069 7465 6d5f  e, False), item_
+0002b4d0: 6578 706f 7274 290d 0a20 2020 2020 2020  export)..       
+0002b4e0: 2020 2020 206d 656e 752e 4269 6e64 2877       menu.Bind(w
+0002b4f0: 782e 4556 545f 4d45 4e55 2c20 6c61 6d62  x.EVT_MENU, lamb
+0002b500: 6461 2065 3a20 6578 706f 7274 6572 2846  da e: exporter(F
+0002b510: 616c 7365 2c20 5472 7565 292c 2020 6974  alse, True),  it
+0002b520: 656d 5f64 6174 6573 290d 0a20 2020 2020  em_dates)..     
+0002b530: 2020 2020 2020 2069 6620 6974 656d 5f65         if item_e
+0002b540: 7870 6f72 746d 3a0d 0a20 2020 2020 2020  xportm:..       
+0002b550: 2020 2020 2020 2020 206d 656e 752e 4269           menu.Bi
+0002b560: 6e64 2877 782e 4556 545f 4d45 4e55 2c20  nd(wx.EVT_MENU, 
+0002b570: 6c61 6d62 6461 2065 3a20 6578 706f 7274  lambda e: export
+0002b580: 6572 2854 7275 652c 2020 4661 6c73 6529  er(True,  False)
+0002b590: 2c20 6974 656d 5f65 7870 6f72 746d 290d  , item_exportm).
+0002b5a0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0002b5b0: 6974 656d 5f64 6174 6573 6d3a 0d0a 2020  item_datesm:..  
+0002b5c0: 2020 2020 2020 2020 2020 2020 2020 6d65                me
+0002b5d0: 6e75 2e42 696e 6428 7778 2e45 5654 5f4d  nu.Bind(wx.EVT_M
+0002b5e0: 454e 552c 206c 616d 6264 6120 653a 2065  ENU, lambda e: e
+0002b5f0: 7870 6f72 7465 7228 5472 7565 2c20 2054  xporter(True,  T
+0002b600: 7275 6529 2c20 2069 7465 6d5f 6461 7465  rue),  item_date
+0002b610: 736d 290d 0a20 2020 2020 2020 206d 656e  sm)..        men
+0002b620: 752e 4269 6e64 2877 782e 4556 545f 4d45  u.Bind(wx.EVT_ME
+0002b630: 4e55 2c20 6c61 6d62 6461 2065 3a20 7365  NU, lambda e: se
+0002b640: 6c66 2e64 656c 6574 655f 6368 6174 7328  lf.delete_chats(
+0002b650: 6368 6174 7329 2c20 6974 656d 5f64 656c  chats), item_del
+0002b660: 6574 6529 0d0a 0d0a 2020 2020 2020 2020  ete)....        
+0002b670: 6966 2066 756c 6c6d 656e 753a 0d0a 2020  if fullmenu:..  
+0002b680: 2020 2020 2020 2020 2020 2320 4e65 6564            # Need
+0002b690: 7320 6361 6c6c 6261 636b 2c20 6163 7469  s callback, acti
+0002b6a0: 6f6e 7320 6361 6e20 6d6f 6469 6679 206c  ons can modify l
+0002b6b0: 6973 7420 7768 696c 6520 6d6f 7573 6520  ist while mouse 
+0002b6c0: 6576 656e 7420 6f6e 676f 696e 670d 0a20  event ongoing.. 
+0002b6d0: 2020 2020 2020 2020 2020 2077 782e 4361             wx.Ca
+0002b6e0: 6c6c 4166 7465 7228 7365 6c66 2e6c 6973  llAfter(self.lis
+0002b6f0: 745f 6368 6174 732e 506f 7075 704d 656e  t_chats.PopupMen
+0002b700: 752c 206d 656e 7529 0d0a 2020 2020 2020  u, menu)..      
+0002b710: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+0002b720: 2020 2020 2073 656c 662e 6275 7474 6f6e       self.button
+0002b730: 5f61 6374 696f 6e5f 6368 6174 2e50 6f70  _action_chat.Pop
+0002b740: 7570 4d65 6e75 286d 656e 752c 2028 302c  upMenu(menu, (0,
+0002b750: 2073 656c 662e 6275 7474 6f6e 5f61 6374   self.button_act
+0002b760: 696f 6e5f 6368 6174 2e53 697a 655b 315d  ion_chat.Size[1]
+0002b770: 2929 0d0a 0d0a 0d0a 2020 2020 6465 6620  ))......    def 
+0002b780: 6f6e 5f6d 656e 755f 6c69 7374 5f63 6f6e  on_menu_list_con
+0002b790: 7461 6374 7328 7365 6c66 2c20 6576 656e  tacts(self, even
+0002b7a0: 7429 3a0d 0a20 2020 2020 2020 2022 2222  t):..        """
+0002b7b0: 4861 6e64 6c65 7220 666f 7220 7269 6768  Handler for righ
+0002b7c0: 742d 636c 6963 6b69 6e67 2063 6f6e 7461  t-clicking conta
+0002b7d0: 6374 6c69 7374 206f 7220 636f 6e74 6163  ctlist or contac
+0002b7e0: 7420 6163 7469 6f6e 732d 6275 7474 6f6e  t actions-button
+0002b7f0: 2c20 6f70 656e 7320 706f 7075 7020 6d65  , opens popup me
+0002b800: 6e75 2e22 2222 0d0a 2020 2020 2020 2020  nu."""..        
+0002b810: 6966 2065 7665 6e74 2e45 7665 6e74 4f62  if event.EventOb
+0002b820: 6a65 6374 2069 7320 7365 6c66 2e62 7574  ject is self.but
+0002b830: 746f 6e5f 6163 7469 6f6e 5f63 6f6e 7461  ton_action_conta
+0002b840: 6374 3a0d 0a20 2020 2020 2020 2020 2020  ct:..           
+0002b850: 2063 6f6e 7461 6374 732c 2066 756c 6c6d   contacts, fullm
+0002b860: 656e 7520 3d20 5b73 656c 662e 636f 6e74  enu = [self.cont
+0002b870: 6163 745d 2c20 4661 6c73 650d 0a20 2020  act], False..   
+0002b880: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+0002b890: 2020 2020 2020 2020 636f 6e74 6163 7473          contacts
+0002b8a0: 2c20 7365 6c65 6374 6564 732c 2066 756c  , selecteds, ful
+0002b8b0: 6c6d 656e 7520 3d20 5b5d 2c20 5b5d 2c20  lmenu = [], [], 
+0002b8c0: 5472 7565 0d0a 2020 2020 2020 2020 2020  True..          
+0002b8d0: 2020 7365 6c65 6374 6564 203d 2073 656c    selected = sel
+0002b8e0: 662e 6c69 7374 5f63 6f6e 7461 6374 732e  f.list_contacts.
+0002b8f0: 4765 7446 6972 7374 5365 6c65 6374 6564  GetFirstSelected
+0002b900: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+0002b910: 7768 696c 6520 7365 6c65 6374 6564 203e  while selected >
+0002b920: 3d20 303a 0d0a 2020 2020 2020 2020 2020  = 0:..          
+0002b930: 2020 2020 2020 7365 6c65 6374 6564 732e        selecteds.
+0002b940: 6170 7065 6e64 2873 656c 6563 7465 6429  append(selected)
+0002b950: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0002b960: 2020 636f 6e74 6163 7473 2e61 7070 656e    contacts.appen
+0002b970: 6428 7365 6c66 2e6c 6973 745f 636f 6e74  d(self.list_cont
+0002b980: 6163 7473 2e47 6574 4974 656d 4d61 7070  acts.GetItemMapp
+0002b990: 6564 4461 7461 2873 656c 6563 7465 6429  edData(selected)
+0002b9a0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0002b9b0: 2020 2073 656c 6563 7465 6420 3d20 7365     selected = se
+0002b9c0: 6c66 2e6c 6973 745f 636f 6e74 6163 7473  lf.list_contacts
+0002b9d0: 2e47 6574 4e65 7874 5365 6c65 6374 6564  .GetNextSelected
+0002b9e0: 2873 656c 6563 7465 6429 0d0a 2020 2020  (selected)..    
+0002b9f0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+0002ba00: 7461 6e63 6528 6576 656e 742c 2077 782e  tance(event, wx.
+0002ba10: 4c69 7374 4576 656e 7429 2061 6e64 2065  ListEvent) and e
+0002ba20: 7665 6e74 2e47 6574 496e 6465 7828 2920  vent.GetIndex() 
+0002ba30: 3e3d 2030 205c 0d0a 2020 2020 2020 2020  >= 0 \..        
+0002ba40: 2020 2020 616e 6420 6576 656e 742e 4765      and event.Ge
+0002ba50: 7449 6e64 6578 2829 206e 6f74 2069 6e20  tIndex() not in 
+0002ba60: 7365 6c65 6374 6564 733a 0d0a 2020 2020  selecteds:..    
+0002ba70: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+0002ba80: 6163 7473 203d 205b 7365 6c66 2e6c 6973  acts = [self.lis
+0002ba90: 745f 636f 6e74 6163 7473 2e47 6574 4974  t_contacts.GetIt
+0002baa0: 656d 4d61 7070 6564 4461 7461 2865 7665  emMappedData(eve
+0002bab0: 6e74 2e47 6574 496e 6465 7828 2929 5d0d  nt.GetIndex())].
+0002bac0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0002bad0: 6e6f 7420 636f 6e74 6163 7473 3a20 7265  not contacts: re
+0002bae0: 7475 726e 0d0a 0d0a 2020 2020 2020 2020  turn....        
+0002baf0: 6361 7465 676f 7279 203d 2022 636f 6e74  category = "cont
+0002bb00: 6163 7422 0d0a 2020 2020 2020 2020 6966  act"..        if
+0002bb10: 206c 656e 2863 6f6e 7461 6374 7329 203d   len(contacts) =
+0002bb20: 3d20 3120 616e 6420 7365 6c66 2e64 622e  = 1 and self.db.
+0002bb30: 6964 203d 3d20 636f 6e74 6163 7473 5b30  id == contacts[0
+0002bb40: 5d5b 2269 6465 6e74 6974 7922 5d3a 2063  ]["identity"]: c
+0002bb50: 6174 6567 6f72 7920 3d20 2261 6363 6f75  ategory = "accou
+0002bb60: 6e74 220d 0a20 2020 2020 2020 2063 6861  nt"..        cha
+0002bb70: 7473 2c20 7669 7369 7465 642c 2063 6861  ts, visited, cha
+0002bb80: 746d 6170 203d 205b 5d2c 2073 6574 2829  tmap = [], set()
+0002bb90: 2c20 7b78 5b22 6964 225d 3a20 7820 666f  , {x["id"]: x fo
+0002bba0: 7220 7820 696e 2073 656c 662e 6368 6174  r x in self.chat
+0002bbb0: 737d 0d0a 2020 2020 2020 2020 666f 7220  s}..        for 
+0002bbc0: 6320 696e 2063 6f6e 7461 6374 733a 0d0a  c in contacts:..
+0002bbd0: 2020 2020 2020 2020 2020 2020 6368 6174              chat
+0002bbe0: 732e 6578 7465 6e64 2873 6f72 7465 6428  s.extend(sorted(
+0002bbf0: 2863 6861 746d 6170 5b78 5b22 6964 225d  (chatmap[x["id"]
+0002bc00: 5d20 666f 7220 7820 696e 2063 2e67 6574  ] for x in c.get
+0002bc10: 2822 636f 6e76 6572 7361 7469 6f6e 7322  ("conversations"
+0002bc20: 2c20 5b5d 290d 0a20 2020 2020 2020 2020  , [])..         
+0002bc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002bc40: 2020 2020 2020 2069 6620 785b 2269 6422         if x["id"
+0002bc50: 5d20 6e6f 7420 696e 2076 6973 6974 6564  ] not in visited
+0002bc60: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
+0002bc70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002bc80: 2020 2020 6b65 793d 6c61 6d62 6461 2078      key=lambda x
+0002bc90: 3a20 2878 5b22 7479 7065 225d 2c20 785b  : (x["type"], x[
+0002bca0: 2274 6974 6c65 5f6c 6f6e 6722 5d2e 6c6f  "title_long"].lo
+0002bcb0: 7765 7228 2929 2929 0d0a 2020 2020 2020  wer())))..      
+0002bcc0: 2020 2020 2020 7669 7369 7465 642e 7570        visited.up
+0002bcd0: 6461 7465 2878 5b22 6964 225d 2066 6f72  date(x["id"] for
+0002bce0: 2078 2069 6e20 6368 6174 7329 0d0a 2020   x in chats)..  
+0002bcf0: 2020 2020 2020 636f 6e74 6163 745f 636f        contact_co
+0002bd00: 6c73 203d 2073 656c 662e 6462 2e67 6574  ls = self.db.get
+0002bd10: 5f74 6162 6c65 5f63 6f6c 756d 6e73 2822  _table_columns("
+0002bd20: 636f 6e74 6163 7473 2229 0d0a 2020 2020  contacts")..    
+0002bd30: 2020 2020 636c 6162 656c 203d 2075 7469      clabel = uti
+0002bd40: 6c2e 706c 7572 616c 2822 313a 3120 6368  l.plural("1:1 ch
+0002bd50: 6174 222c 204e 6f6e 6520 6966 2022 6163  at", None if "ac
+0002bd60: 636f 756e 7422 203d 3d20 6361 7465 676f  count" == catego
+0002bd70: 7279 2065 6c73 6520 636f 6e74 6163 7473  ry else contacts
+0002bd80: 2c20 6e75 6d62 6572 733d 4661 6c73 6529  , numbers=False)
+0002bd90: 0d0a 2020 2020 2020 2020 706c 6162 656c  ..        plabel
+0002bda0: 203d 2075 7469 6c2e 706c 7572 616c 2822   = util.plural("
+0002bdb0: 7072 6f66 696c 6522 2c20 636f 6e74 6163  profile", contac
+0002bdc0: 7473 2c20 6e75 6d62 6572 733d 4661 6c73  ts, numbers=Fals
+0002bdd0: 6529 0d0a 0d0a 2020 2020 2020 2020 6465  e)....        de
+0002bde0: 6620 636c 6970 626f 6172 6469 7a65 2863  f clipboardize(c
+0002bdf0: 6174 6567 6f72 7929 3a0d 0a20 2020 2020  ategory):..     
+0002be00: 2020 2020 2020 2069 6620 226e 616d 6522         if "name"
+0002be10: 203d 3d20 6361 7465 676f 7279 3a0d 0a20   == category:.. 
+0002be20: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0002be30: 6578 7420 3d20 225c 6e22 2e6a 6f69 6e28  ext = "\n".join(
+0002be40: 635b 226e 616d 6522 5d20 666f 7220 6320  c["name"] for c 
+0002be50: 696e 2063 6f6e 7461 6374 7329 0d0a 2020  in contacts)..  
+0002be60: 2020 2020 2020 2020 2020 656c 6966 2022            elif "
+0002be70: 6368 6174 2220 3d3d 2063 6174 6567 6f72  chat" == categor
+0002be80: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
+0002be90: 2020 2020 7465 7874 203d 2022 5c6e 222e      text = "\n".
+0002bea0: 6a6f 696e 2878 5b22 7469 746c 655f 6c6f  join(x["title_lo
+0002beb0: 6e67 225d 2066 6f72 2078 2069 6e20 6368  ng"] for x in ch
+0002bec0: 6174 7329 0d0a 2020 2020 2020 2020 2020  ats)..          
+0002bed0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+0002bee0: 2020 2020 2020 2020 2067 6574 5f66 6965           get_fie
+0002bef0: 6c64 7320 3d20 6c61 6d62 6461 2063 3a20  lds = lambda c: 
+0002bf00: 736b 7970 6564 6174 612e 434f 4e54 4143  skypedata.CONTAC
+0002bf10: 545f 4649 454c 445f 5449 544c 4553 2069  T_FIELD_TITLES i
+0002bf20: 6620 7365 6c66 2e64 622e 6964 2021 3d20  f self.db.id != 
+0002bf30: 635b 2269 6465 6e74 6974 7922 5d20 5c0d  c["identity"] \.
+0002bf40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002bf50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002bf60: 2020 2020 2020 2020 656c 7365 2073 6b79          else sky
+0002bf70: 7065 6461 7461 2e41 4343 4f55 4e54 5f46  pedata.ACCOUNT_F
+0002bf80: 4945 4c44 5f54 4954 4c45 530d 0a20 2020  IELD_TITLES..   
+0002bf90: 2020 2020 2020 2020 2020 2020 2074 6578               tex
+0002bfa0: 7420 3d20 225c 6e5c 6e22 2e6a 6f69 6e28  t = "\n\n".join(
+0002bfb0: 2225 7325 7322 2025 2028 0d0a 2020 2020  "%s%s" % (..    
+0002bfc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002bfd0: 2244 6174 6162 6173 6520 6163 636f 756e  "Database accoun
+0002bfe0: 745c 6e22 2069 6620 7365 6c66 2e64 622e  t\n" if self.db.
+0002bff0: 6964 203d 3d20 635b 2269 6465 6e74 6974  id == c["identit
+0002c000: 7922 5d20 656c 7365 2022 222c 0d0a 2020  y"] else "",..  
+0002c010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c020: 2020 225c 6e22 2e6a 6f69 6e28 2225 733a    "\n".join("%s:
+0002c030: 2025 7322 2025 2028 6c2c 2076 2920 666f   %s" % (l, v) fo
+0002c040: 7220 6e2c 206c 2069 6e20 6765 745f 6669  r n, l in get_fi
+0002c050: 656c 6473 2863 292e 6974 656d 7328 290d  elds(c).items().
+0002c060: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002c070: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0002c080: 6f72 2076 2069 6e20 5b73 6b79 7065 6461  or v in [skypeda
+0002c090: 7461 2e66 6f72 6d61 745f 636f 6e74 6163  ta.format_contac
+0002c0a0: 745f 6669 656c 6428 632c 206e 295d 2069  t_field(c, n)] i
+0002c0b0: 6620 7629 0d0a 2020 2020 2020 2020 2020  f v)..          
+0002c0c0: 2020 2020 2020 2920 666f 7220 6320 696e        ) for c in
+0002c0d0: 2063 6f6e 7461 6374 7329 0d0a 2020 2020   contacts)..    
+0002c0e0: 2020 2020 2020 2020 6966 2077 782e 5468          if wx.Th
+0002c0f0: 6543 6c69 7062 6f61 7264 2e4f 7065 6e28  eClipboard.Open(
+0002c100: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+0002c110: 2020 2020 6420 3d20 7778 2e54 6578 7444      d = wx.TextD
+0002c120: 6174 614f 626a 6563 7428 7465 7874 290d  ataObject(text).
+0002c130: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002c140: 2077 782e 5468 6543 6c69 7062 6f61 7264   wx.TheClipboard
+0002c150: 2e53 6574 4461 7461 2864 292c 2077 782e  .SetData(d), wx.
+0002c160: 5468 6543 6c69 7062 6f61 7264 2e43 6c6f  TheClipboard.Clo
+0002c170: 7365 2829 0d0a 0d0a 2020 2020 2020 2020  se()....        
+0002c180: 6465 6620 6578 706f 7274 6572 2864 6f5f  def exporter(do_
+0002c190: 7369 6e67 6c65 6669 6c65 3d46 616c 7365  singlefile=False
+0002c1a0: 2c20 646f 5f74 696d 6572 616e 6765 3d46  , do_timerange=F
+0002c1b0: 616c 7365 293a 0d0a 2020 2020 2020 2020  alse):..        
+0002c1c0: 2020 2020 7365 6c66 2e6f 6e5f 6578 706f      self.on_expo
+0002c1d0: 7274 5f63 6861 7473 2863 6861 7473 2c20  rt_chats(chats, 
+0002c1e0: 4661 6c73 652c 2064 6f5f 7369 6e67 6c65  False, do_single
+0002c1f0: 6669 6c65 2c20 646f 5f74 696d 6572 616e  file, do_timeran
+0002c200: 6765 290d 0a0d 0a20 2020 2020 2020 2064  ge)....        d
+0002c210: 6566 2073 796e 6328 7369 6e67 6c65 733d  ef sync(singles=
+0002c220: 4e6f 6e65 293a 0d0a 2020 2020 2020 2020  None):..        
+0002c230: 2020 2020 6d79 6368 6174 732c 206d 7963      mychats, myc
+0002c240: 6f6e 7461 6374 7320 3d20 284e 6f6e 6520  ontacts = (None 
+0002c250: 6966 2073 696e 676c 6573 2069 7320 4e6f  if singles is No
+0002c260: 6e65 2065 6c73 6520 6368 6174 7329 2c20  ne else chats), 
+0002c270: 636f 6e74 6163 7473 0d0a 2020 2020 2020  contacts..      
+0002c280: 2020 2020 2020 6966 2073 696e 676c 6573        if singles
+0002c290: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0002c2a0: 2020 206d 7963 6861 7473 203d 205b 7820     mychats = [x 
+0002c2b0: 666f 7220 7820 696e 206d 7963 6861 7473  for x in mychats
+0002c2c0: 2069 6620 736b 7970 6564 6174 612e 4348   if skypedata.CH
+0002c2d0: 4154 535f 5459 5045 5f53 494e 474c 4520  ATS_TYPE_SINGLE 
+0002c2e0: 3d3d 2078 5b22 7479 7065 225d 5d0d 0a20  == x["type"]].. 
+0002c2f0: 2020 2020 2020 2020 2020 2069 6620 7369             if si
+0002c300: 6e67 6c65 7320 6973 206e 6f74 204e 6f6e  ngles is not Non
+0002c310: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+0002c320: 2020 2020 6368 6174 6964 7320 3d20 7365      chatids = se
+0002c330: 7428 785b 2269 6465 6e74 6974 7922 5d20  t(x["identity"] 
+0002c340: 666f 7220 7820 696e 206d 7963 6861 7473  for x in mychats
+0002c350: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0002c360: 2020 206d 7963 6861 7473 203d 205b 7b22     mychats = [{"
+0002c370: 6964 656e 7469 7479 223a 2063 5b22 6964  identity": c["id
+0002c380: 656e 7469 7479 225d 7d20 666f 7220 6320  entity"]} for c 
+0002c390: 696e 2063 6f6e 7461 6374 730d 0a20 2020  in contacts..   
+0002c3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c3b0: 2020 2020 2020 2020 6966 2063 5b22 6964          if c["id
+0002c3c0: 656e 7469 7479 225d 206e 6f74 2069 6e20  entity"] not in 
+0002c3d0: 6368 6174 6964 735d 202b 206d 7963 6861  chatids] + mycha
+0002c3e0: 7473 0d0a 2020 2020 2020 2020 2020 2020  ts..            
+0002c3f0: 7365 6c66 2e6f 6e5f 6c69 7665 5f73 796e  self.on_live_syn
+0002c400: 635f 6974 656d 7328 6d79 6368 6174 732c  c_items(mychats,
+0002c410: 206d 7963 6f6e 7461 6374 732c 206d 6573   mycontacts, mes
+0002c420: 7361 6765 733d 7369 6e67 6c65 7320 6973  sages=singles is
+0002c430: 206e 6f74 204e 6f6e 6529 0d0a 0d0a 2020   not None)....  
+0002c440: 2020 2020 2020 6d65 6e75 2c20 736d 656e        menu, smen
+0002c450: 752c 2078 6d65 6e75 2020 3d20 7778 2e4d  u, xmenu  = wx.M
+0002c460: 656e 7528 292c 2077 782e 4d65 6e75 2829  enu(), wx.Menu()
+0002c470: 2c20 4e6f 6e65 0d0a 2020 2020 2020 2020  , None..        
+0002c480: 6966 2066 756c 6c6d 656e 753a 0d0a 2020  if fullmenu:..  
+0002c490: 2020 2020 2020 2020 2020 6974 656d 5f6e            item_n
+0002c4a0: 616d 6520 203d 2077 782e 4d65 6e75 4974  ame  = wx.MenuIt
+0002c4b0: 656d 286d 656e 752c 202d 312c 2028 224f  em(menu, -1, ("O
+0002c4c0: 7065 6e20 2573 2022 2025 2063 6174 6567  pen %s " % categ
+0002c4d0: 6f72 7929 2069 6620 6c65 6e28 636f 6e74  ory) if len(cont
+0002c4e0: 6163 7473 2920 3c20 320d 0a20 2020 2020  acts) < 2..     
+0002c4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c510: 2020 2020 2020 2020 2020 656c 7365 2075            else u
+0002c520: 7469 6c2e 706c 7572 616c 2822 636f 6e74  til.plural("cont
+0002c530: 6163 7422 2c20 636f 6e74 6163 7473 2929  act", contacts))
+0002c540: 0d0a 2020 2020 2020 2020 6974 656d 5f63  ..        item_c
+0002c550: 6f70 7920 2020 2020 203d 2077 782e 4d65  opy      = wx.Me
+0002c560: 6e75 4974 656d 286d 656e 752c 202d 312c  nuItem(menu, -1,
+0002c570: 2022 2643 6f70 7920 2573 2220 250d 0a20   "&Copy %s" %.. 
+0002c580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c5a0: 2020 2020 7574 696c 2e70 6c75 7261 6c28      util.plural(
+0002c5b0: 226e 616d 6522 2c20 636f 6e74 6163 7473  "name", contacts
+0002c5c0: 2c20 6e75 6d62 6572 733d 4661 6c73 6529  , numbers=False)
+0002c5d0: 290d 0a20 2020 2020 2020 2069 7465 6d5f  )..        item_
+0002c5e0: 636f 7079 7072 6f66 2020 3d20 7778 2e4d  copyprof  = wx.M
+0002c5f0: 656e 7549 7465 6d28 6d65 6e75 2c20 2d31  enuItem(menu, -1
+0002c600: 2c20 2243 6f70 7920 2625 7322 2025 2070  , "Copy &%s" % p
+0002c610: 6c61 6265 6c29 0d0a 2020 2020 2020 2020  label)..        
+0002c620: 6974 656d 5f63 6f70 7963 6861 7473 203d  item_copychats =
+0002c630: 2077 782e 4d65 6e75 4974 656d 286d 656e   wx.MenuItem(men
+0002c640: 752c 202d 312c 2022 436f 7079 2025 7322  u, -1, "Copy %s"
+0002c650: 2025 0d0a 2020 2020 2020 2020 2020 2020   %..            
+0002c660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c670: 2020 2020 2020 2020 2075 7469 6c2e 706c           util.pl
+0002c680: 7572 616c 2822 6326 6861 7420 6e61 6d65  ural("c&hat name
+0002c690: 222c 2063 6861 7473 2c20 6e75 6d62 6572  ", chats, number
+0002c6a0: 733d 4661 6c73 6529 290d 0a20 2020 2020  s=False))..     
+0002c6b0: 2020 2069 7465 6d5f 7265 6e61 6d65 2020     item_rename  
+0002c6c0: 2020 3d20 7778 2e4d 656e 7549 7465 6d28    = wx.MenuItem(
+0002c6d0: 6d65 6e75 2c20 2d31 2c20 2252 6526 6e61  menu, -1, "Re&na
+0002c6e0: 6d65 2025 7322 2025 2063 6174 6567 6f72  me %s" % categor
+0002c6f0: 7929 0d0a 2020 2020 2020 2020 6974 656d  y)..        item
+0002c700: 5f73 796e 6361 2020 2020 203d 2077 782e  _synca     = wx.
+0002c710: 4d65 6e75 4974 656d 286d 656e 752c 202d  MenuItem(menu, -
+0002c720: 312c 2022 5379 6e63 6872 6f6e 697a 6520  1, "Synchronize 
+0002c730: 2661 6c6c 2063 6861 7473 2061 6e64 2025  &all chats and %
+0002c740: 7322 2025 2070 6c61 6265 6c29 0d0a 2020  s" % plabel)..  
+0002c750: 2020 2020 2020 6974 656d 5f73 796e 636d        item_syncm
+0002c760: 2020 2020 203d 2077 782e 4d65 6e75 4974       = wx.MenuIt
+0002c770: 656d 286d 656e 752c 202d 312c 2022 5379  em(menu, -1, "Sy
+0002c780: 6e63 6872 6f6e 697a 6520 2573 2061 6e64  nchronize %s and
+0002c790: 2025 7322 2025 2028 636c 6162 656c 2c20   %s" % (clabel, 
+0002c7a0: 706c 6162 656c 2929 0d0a 2020 2020 2020  plabel))..      
+0002c7b0: 2020 6974 656d 5f73 796e 6370 2020 2020    item_syncp    
+0002c7c0: 203d 2077 782e 4d65 6e75 4974 656d 286d   = wx.MenuItem(m
+0002c7d0: 656e 752c 202d 312c 2022 5379 6e63 6872  enu, -1, "Synchr
+0002c7e0: 6f6e 697a 6520 2625 7322 2025 2070 6c61  onize &%s" % pla
+0002c7f0: 6265 6c29 0d0a 2020 2020 2020 2020 6966  bel)..        if
+0002c800: 2066 756c 6c6d 656e 753a 0d0a 2020 2020   fullmenu:..    
+0002c810: 2020 2020 2020 2020 6974 656d 5f65 7870          item_exp
+0002c820: 6f72 7420 203d 2077 782e 4d65 6e75 4974  ort  = wx.MenuIt
+0002c830: 656d 286d 656e 752c 202d 312c 2022 2645  em(menu, -1, "&E
+0002c840: 7870 6f72 7420 6368 6174 7322 290d 0a20  xport chats").. 
+0002c850: 2020 2020 2020 2020 2020 2069 7465 6d5f             item_
+0002c860: 6578 706f 7274 6d20 3d20 6974 656d 5f64  exportm = item_d
+0002c870: 6174 6573 6d20 3d20 4e6f 6e65 0d0a 2020  atesm = None..  
+0002c880: 2020 2020 2020 6966 2066 756c 6c6d 656e        if fullmen
+0002c890: 7520 616e 6420 6578 706f 7274 2e78 6c73  u and export.xls
+0002c8a0: 7877 7269 7465 7220 616e 6420 6c65 6e28  xwriter and len(
+0002c8b0: 636f 6e74 6163 7473 2920 3e20 313a 0d0a  contacts) > 1:..
+0002c8c0: 2020 2020 2020 2020 2020 2020 786d 656e              xmen
+0002c8d0: 7520 3d20 7778 2e4d 656e 7528 290d 0a20  u = wx.Menu().. 
+0002c8e0: 2020 2020 2020 2020 2020 2069 7465 6d5f             item_
+0002c8f0: 6578 706f 7274 6d20 3d20 7778 2e4d 656e  exportm = wx.Men
+0002c900: 7549 7465 6d28 6d65 6e75 2c20 2d31 2c20  uItem(menu, -1, 
+0002c910: 2243 6861 7473 206f 6e20 2673 6570 6172  "Chats on &separ
+0002c920: 6174 6520 7368 6565 7473 2229 0d0a 2020  ate sheets")..  
+0002c930: 2020 2020 2020 2020 2020 6974 656d 5f64            item_d
+0002c940: 6174 6573 6d20 203d 2077 782e 4d65 6e75  atesm  = wx.Menu
+0002c950: 4974 656d 286d 656e 752c 202d 312c 2022  Item(menu, -1, "
+0002c960: 4368 6174 7320 696e 2026 6461 7465 2072  Chats in &date r
+0002c970: 616e 6765 206f 6e20 7365 7061 7261 7465  ange on separate
+0002c980: 2073 6865 6574 7322 290d 0a20 2020 2020   sheets")..     
+0002c990: 2020 2020 2020 2078 6d65 6e75 2e41 7070         xmenu.App
+0002c9a0: 656e 6428 6974 656d 5f65 7870 6f72 746d  end(item_exportm
+0002c9b0: 290d 0a20 2020 2020 2020 2020 2020 2078  )..            x
+0002c9c0: 6d65 6e75 2e41 7070 656e 6428 6974 656d  menu.Append(item
+0002c9d0: 5f64 6174 6573 6d29 0d0a 2020 2020 2020  _datesm)..      
+0002c9e0: 2020 6966 2066 756c 6c6d 656e 753a 0d0a    if fullmenu:..
+0002c9f0: 2020 2020 2020 2020 2020 2020 6974 656d              item
+0002ca00: 5f64 6174 6573 2020 203d 2077 782e 4d65  _dates   = wx.Me
+0002ca10: 6e75 4974 656d 286d 656e 752c 202d 312c  nuItem(menu, -1,
+0002ca20: 2022 4578 706f 7274 2063 6861 7473 2026   "Export chats &
+0002ca30: 6461 7465 2072 616e 6765 2229 0d0a 2020  date range")..  
+0002ca40: 2020 2020 2020 6974 656d 5f64 656c 6574        item_delet
+0002ca50: 6520 203d 2077 782e 4d65 6e75 4974 656d  e  = wx.MenuItem
+0002ca60: 286d 656e 752c 202d 312c 2022 4465 6c65  (menu, -1, "Dele
+0002ca70: 7465 2229 0d0a 0d0a 2020 2020 2020 2020  te")....        
+0002ca80: 6966 2066 756c 6c6d 656e 753a 0d0a 2020  if fullmenu:..  
+0002ca90: 2020 2020 2020 2020 2020 626f 6c64 666f            boldfo
+0002caa0: 6e74 203d 2077 782e 466f 6e74 2869 7465  nt = wx.Font(ite
+0002cab0: 6d5f 6e61 6d65 2e46 6f6e 7429 0d0a 2020  m_name.Font)..  
+0002cac0: 2020 2020 2020 2020 2020 626f 6c64 666f            boldfo
+0002cad0: 6e74 2e53 6574 5765 6967 6874 2877 782e  nt.SetWeight(wx.
+0002cae0: 464f 4e54 5745 4947 4854 5f42 4f4c 4429  FONTWEIGHT_BOLD)
+0002caf0: 0d0a 2020 2020 2020 2020 2020 2020 626f  ..            bo
+0002cb00: 6c64 666f 6e74 2e53 6574 4661 6365 4e61  ldfont.SetFaceNa
+0002cb10: 6d65 2873 656c 662e 466f 6e74 2e46 6163  me(self.Font.Fac
+0002cb20: 654e 616d 6529 0d0a 2020 2020 2020 2020  eName)..        
+0002cb30: 2020 2020 626f 6c64 666f 6e74 2e53 6574      boldfont.Set
+0002cb40: 506f 696e 7453 697a 6528 7365 6c66 2e46  PointSize(self.F
+0002cb50: 6f6e 742e 506f 696e 7453 697a 6529 0d0a  ont.PointSize)..
+0002cb60: 2020 2020 2020 2020 2020 2020 6974 656d              item
+0002cb70: 5f6e 616d 652e 466f 6e74 203d 2062 6f6c  _name.Font = bol
+0002cb80: 6466 6f6e 740d 0a0d 0a20 2020 2020 2020  dfont....       
+0002cb90: 2069 6620 6675 6c6c 6d65 6e75 3a0d 0a20   if fullmenu:.. 
+0002cba0: 2020 2020 2020 2020 2020 206d 656e 752e             menu.
+0002cbb0: 4170 7065 6e64 2869 7465 6d5f 6e61 6d65  Append(item_name
+0002cbc0: 290d 0a20 2020 2020 2020 2020 2020 206d  )..            m
+0002cbd0: 656e 752e 4170 7065 6e64 5365 7061 7261  enu.AppendSepara
+0002cbe0: 746f 7228 290d 0a20 2020 2020 2020 206d  tor()..        m
+0002cbf0: 656e 752e 4170 7065 6e64 2869 7465 6d5f  enu.Append(item_
+0002cc00: 636f 7079 290d 0a20 2020 2020 2020 206d  copy)..        m
+0002cc10: 656e 752e 4170 7065 6e64 2869 7465 6d5f  enu.Append(item_
+0002cc20: 636f 7079 7072 6f66 290d 0a20 2020 2020  copyprof)..     
+0002cc30: 2020 206d 656e 752e 4170 7065 6e64 2869     menu.Append(i
+0002cc40: 7465 6d5f 636f 7079 6368 6174 7329 0d0a  tem_copychats)..
+0002cc50: 2020 2020 2020 2020 6d65 6e75 2e41 7070          menu.App
+0002cc60: 656e 6453 6570 6172 6174 6f72 2829 0d0a  endSeparator()..
+0002cc70: 2020 2020 2020 2020 6d65 6e75 2e41 7070          menu.App
+0002cc80: 656e 6428 6974 656d 5f72 656e 616d 6529  end(item_rename)
+0002cc90: 0d0a 2020 2020 2020 2020 6d65 6e75 2e41  ..        menu.A
+0002cca0: 7070 656e 6453 6570 6172 6174 6f72 2829  ppendSeparator()
+0002ccb0: 0d0a 2020 2020 2020 2020 736d 656e 752e  ..        smenu.
+0002ccc0: 4170 7065 6e64 2869 7465 6d5f 7379 6e63  Append(item_sync
+0002ccd0: 6129 0d0a 2020 2020 2020 2020 736d 656e  a)..        smen
+0002cce0: 752e 4170 7065 6e64 2869 7465 6d5f 7379  u.Append(item_sy
+0002ccf0: 6e63 6d29 0d0a 2020 2020 2020 2020 736d  ncm)..        sm
+0002cd00: 656e 752e 4170 7065 6e64 2869 7465 6d5f  enu.Append(item_
+0002cd10: 7379 6e63 7029 0d0a 2020 2020 2020 2020  syncp)..        
+0002cd20: 6974 656d 5f73 796e 6320 3d20 6d65 6e75  item_sync = menu
+0002cd30: 2e41 7070 656e 6453 7562 4d65 6e75 2873  .AppendSubMenu(s
+0002cd40: 6d65 6e75 2c20 2255 7064 6174 6520 6672  menu, "Update fr
+0002cd50: 6f6d 206f 6e26 6c69 6e65 2229 0d0a 2020  om on&line")..  
+0002cd60: 2020 2020 2020 6d65 6e75 2e41 7070 656e        menu.Appen
+0002cd70: 6453 6570 6172 6174 6f72 2829 0d0a 2020  dSeparator()..  
+0002cd80: 2020 2020 2020 6966 2066 756c 6c6d 656e        if fullmen
+0002cd90: 753a 0d0a 2020 2020 2020 2020 2020 2020  u:..            
+0002cda0: 6d65 6e75 2e41 7070 656e 6428 6974 656d  menu.Append(item
+0002cdb0: 5f65 7870 6f72 7429 0d0a 2020 2020 2020  _export)..      
+0002cdc0: 2020 2020 2020 6d65 6e75 2e41 7070 656e        menu.Appen
+0002cdd0: 6428 6974 656d 5f64 6174 6573 290d 0a20  d(item_dates).. 
+0002cde0: 2020 2020 2020 2020 2020 2069 6620 786d             if xm
+0002cdf0: 656e 753a 206d 656e 752e 4170 7065 6e64  enu: menu.Append
+0002ce00: 5375 624d 656e 7528 786d 656e 752c 2022  SubMenu(xmenu, "
+0002ce10: 4578 706f 7274 2074 6f20 6120 7369 6e67  Export to a sing
+0002ce20: 6c65 2045 7863 656c 2026 776f 726b 626f  le Excel &workbo
+0002ce30: 6f6b 2229 0d0a 2020 2020 2020 2020 2020  ok")..          
+0002ce40: 2020 6d65 6e75 2e41 7070 656e 6453 6570    menu.AppendSep
+0002ce50: 6172 6174 6f72 2829 0d0a 2020 2020 2020  arator()..      
+0002ce60: 2020 6d65 6e75 2e41 7070 656e 6428 6974    menu.Append(it
+0002ce70: 656d 5f64 656c 6574 6529 0d0a 2020 2020  em_delete)..    
+0002ce80: 2020 2020 6966 2066 756c 6c6d 656e 753a      if fullmenu:
+0002ce90: 0d0a 2020 2020 2020 2020 2020 2020 6974  ..            it
+0002cea0: 656d 5f6e 616d 652e 456e 6162 6c65 6420  em_name.Enabled 
+0002ceb0: 3d20 2831 203d 3d20 6c65 6e28 636f 6e74  = (1 == len(cont
+0002cec0: 6163 7473 2929 0d0a 2020 2020 2020 2020  acts))..        
+0002ced0: 6974 656d 5f72 656e 616d 652e 456e 6162  item_rename.Enab
+0002cee0: 6c65 6420 3d20 2831 203d 3d20 6c65 6e28  led = (1 == len(
+0002cef0: 636f 6e74 6163 7473 2929 2061 6e64 2061  contacts)) and a
+0002cf00: 6e79 2878 5b22 6e61 6d65 225d 203d 3d20  ny(x["name"] == 
+0002cf10: 2267 6976 656e 5f64 6973 706c 6179 6e61  "given_displayna
+0002cf20: 6d65 2220 666f 7220 7820 696e 2063 6f6e  me" for x in con
+0002cf30: 7461 6374 5f63 6f6c 7329 0d0a 2020 2020  tact_cols)..    
+0002cf40: 2020 2020 6974 656d 5f64 656c 6574 652e      item_delete.
+0002cf50: 456e 6162 6c65 6420 3d20 2822 6163 636f  Enabled = ("acco
+0002cf60: 756e 7422 2021 3d20 6361 7465 676f 7279  unt" != category
+0002cf70: 290d 0a0d 0a20 2020 2020 2020 2069 6620  )....        if 
+0002cf80: 6675 6c6c 6d65 6e75 3a0d 0a20 2020 2020  fullmenu:..     
+0002cf90: 2020 2020 2020 206d 656e 752e 4269 6e64         menu.Bind
+0002cfa0: 2877 782e 4556 545f 4d45 4e55 2c20 6c61  (wx.EVT_MENU, la
+0002cfb0: 6d62 6461 2065 3a20 7365 6c66 2e6c 6f61  mbda e: self.loa
+0002cfc0: 645f 636f 6e74 6163 7428 636f 6e74 6163  d_contact(contac
+0002cfd0: 7473 5b30 5d29 2c20 6974 656d 5f6e 616d  ts[0]), item_nam
+0002cfe0: 6529 0d0a 2020 2020 2020 2020 6d65 6e75  e)..        menu
+0002cff0: 2e42 696e 6428 7778 2e45 5654 5f4d 454e  .Bind(wx.EVT_MEN
+0002d000: 552c 2020 6c61 6d62 6461 2065 3a20 636c  U,  lambda e: cl
+0002d010: 6970 626f 6172 6469 7a65 2822 6e61 6d65  ipboardize("name
+0002d020: 2229 2c20 2020 2069 7465 6d5f 636f 7079  "),    item_copy
+0002d030: 290d 0a20 2020 2020 2020 206d 656e 752e  )..        menu.
+0002d040: 4269 6e64 2877 782e 4556 545f 4d45 4e55  Bind(wx.EVT_MENU
+0002d050: 2c20 206c 616d 6264 6120 653a 2063 6c69  ,  lambda e: cli
+0002d060: 7062 6f61 7264 697a 6528 2270 726f 6669  pboardize("profi
+0002d070: 6c65 2229 2c20 6974 656d 5f63 6f70 7970  le"), item_copyp
+0002d080: 726f 6629 0d0a 2020 2020 2020 2020 6d65  rof)..        me
+0002d090: 6e75 2e42 696e 6428 7778 2e45 5654 5f4d  nu.Bind(wx.EVT_M
+0002d0a0: 454e 552c 2020 6c61 6d62 6461 2065 3a20  ENU,  lambda e: 
+0002d0b0: 636c 6970 626f 6172 6469 7a65 2822 6368  clipboardize("ch
+0002d0c0: 6174 2229 2c20 2020 2069 7465 6d5f 636f  at"),    item_co
+0002d0d0: 7079 6368 6174 7329 0d0a 2020 2020 2020  pychats)..      
+0002d0e0: 2020 6d65 6e75 2e42 696e 6428 7778 2e45    menu.Bind(wx.E
+0002d0f0: 5654 5f4d 454e 552c 2020 6c61 6d62 6461  VT_MENU,  lambda
+0002d100: 2065 3a20 7365 6c66 2e6f 6e5f 7265 6e61   e: self.on_rena
+0002d110: 6d65 5f63 6f6e 7461 6374 2863 6f6e 7461  me_contact(conta
+0002d120: 6374 3d63 6f6e 7461 6374 735b 305d 292c  ct=contacts[0]),
+0002d130: 2069 7465 6d5f 7265 6e61 6d65 290d 0a20   item_rename).. 
+0002d140: 2020 2020 2020 206d 656e 752e 4269 6e64         menu.Bind
+0002d150: 2877 782e 4556 545f 4d45 4e55 2c20 206c  (wx.EVT_MENU,  l
+0002d160: 616d 6264 6120 653a 2073 656c 662e 6f6e  ambda e: self.on
+0002d170: 5f64 656c 6574 655f 636f 6e74 6163 7473  _delete_contacts
+0002d180: 2863 6f6e 7461 6374 733d 636f 6e74 6163  (contacts=contac
+0002d190: 7473 292c 2020 6974 656d 5f64 656c 6574  ts),  item_delet
+0002d1a0: 6529 0d0a 2020 2020 2020 2020 736d 656e  e)..        smen
+0002d1b0: 752e 4269 6e64 2877 782e 4556 545f 4d45  u.Bind(wx.EVT_ME
+0002d1c0: 4e55 2c20 6c61 6d62 6461 2065 3a20 7379  NU, lambda e: sy
+0002d1d0: 6e63 2873 696e 676c 6573 3d46 616c 7365  nc(singles=False
+0002d1e0: 292c 2069 643d 6974 656d 5f73 796e 6361  ), id=item_synca
+0002d1f0: 2e47 6574 4964 2829 290d 0a20 2020 2020  .GetId())..     
+0002d200: 2020 2073 6d65 6e75 2e42 696e 6428 7778     smenu.Bind(wx
+0002d210: 2e45 5654 5f4d 454e 552c 206c 616d 6264  .EVT_MENU, lambd
+0002d220: 6120 653a 2073 796e 6328 7369 6e67 6c65  a e: sync(single
+0002d230: 733d 5472 7565 292c 2020 6964 3d69 7465  s=True),  id=ite
+0002d240: 6d5f 7379 6e63 6d2e 4765 7449 6428 2929  m_syncm.GetId())
+0002d250: 0d0a 2020 2020 2020 2020 736d 656e 752e  ..        smenu.
+0002d260: 4269 6e64 2877 782e 4556 545f 4d45 4e55  Bind(wx.EVT_MENU
+0002d270: 2c20 6c61 6d62 6461 2065 3a20 7379 6e63  , lambda e: sync
+0002d280: 2829 2c20 2020 2020 2020 2020 2020 2020  (),             
+0002d290: 2069 643d 6974 656d 5f73 796e 6370 2e47   id=item_syncp.G
+0002d2a0: 6574 4964 2829 290d 0a20 2020 2020 2020  etId())..       
+0002d2b0: 2069 6620 6675 6c6c 6d65 6e75 3a0d 0a20   if fullmenu:.. 
+0002d2c0: 2020 2020 2020 2020 2020 206d 656e 752e             menu.
+0002d2d0: 4269 6e64 2877 782e 4556 545f 4d45 4e55  Bind(wx.EVT_MENU
+0002d2e0: 2c20 6c61 6d62 6461 2065 3a20 6578 706f  , lambda e: expo
+0002d2f0: 7274 6572 2846 616c 7365 2c20 4661 6c73  rter(False, Fals
+0002d300: 6529 2c20 6974 656d 5f65 7870 6f72 7429  e), item_export)
+0002d310: 0d0a 2020 2020 2020 2020 2020 2020 6d65  ..            me
+0002d320: 6e75 2e42 696e 6428 7778 2e45 5654 5f4d  nu.Bind(wx.EVT_M
+0002d330: 454e 552c 206c 616d 6264 6120 653a 2065  ENU, lambda e: e
+0002d340: 7870 6f72 7465 7228 4661 6c73 652c 2054  xporter(False, T
+0002d350: 7275 6529 2c20 2069 7465 6d5f 6461 7465  rue),  item_date
+0002d360: 7329 0d0a 2020 2020 2020 2020 2020 2020  s)..            
+0002d370: 6966 2069 7465 6d5f 6578 706f 7274 6d3a  if item_exportm:
+0002d380: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0002d390: 2020 6d65 6e75 2e42 696e 6428 7778 2e45    menu.Bind(wx.E
+0002d3a0: 5654 5f4d 454e 552c 206c 616d 6264 6120  VT_MENU, lambda 
+0002d3b0: 653a 2065 7870 6f72 7465 7228 5472 7565  e: exporter(True
+0002d3c0: 2c20 2046 616c 7365 292c 2069 7465 6d5f  ,  False), item_
+0002d3d0: 6578 706f 7274 6d29 0d0a 2020 2020 2020  exportm)..      
+0002d3e0: 2020 2020 2020 6966 2069 7465 6d5f 6461        if item_da
+0002d3f0: 7465 736d 3a0d 0a20 2020 2020 2020 2020  tesm:..         
+0002d400: 2020 2020 2020 206d 656e 752e 4269 6e64         menu.Bind
+0002d410: 2877 782e 4556 545f 4d45 4e55 2c20 6c61  (wx.EVT_MENU, la
+0002d420: 6d62 6461 2065 3a20 6578 706f 7274 6572  mbda e: exporter
+0002d430: 2854 7275 652c 2020 5472 7565 292c 2020  (True,  True),  
+0002d440: 6974 656d 5f64 6174 6573 6d29 0d0a 0d0a  item_datesm)....
+0002d450: 2020 2020 2020 2020 6966 2066 756c 6c6d          if fullm
+0002d460: 656e 753a 0d0a 2020 2020 2020 2020 2020  enu:..          
+0002d470: 2020 2320 4e65 6564 7320 6361 6c6c 6261    # Needs callba
+0002d480: 636b 2c20 6163 7469 6f6e 7320 6361 6e20  ck, actions can 
+0002d490: 6d6f 6469 6679 206c 6973 7420 7768 696c  modify list whil
+0002d4a0: 6520 6d6f 7573 6520 6576 656e 7420 6f6e  e mouse event on
+0002d4b0: 676f 696e 670d 0a20 2020 2020 2020 2020  going..         
+0002d4c0: 2020 2077 782e 4361 6c6c 4166 7465 7228     wx.CallAfter(
+0002d4d0: 7365 6c66 2e6c 6973 745f 636f 6e74 6163  self.list_contac
+0002d4e0: 7473 2e50 6f70 7570 4d65 6e75 2c20 6d65  ts.PopupMenu, me
+0002d4f0: 6e75 290d 0a20 2020 2020 2020 2065 6c73  nu)..        els
+0002d500: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+0002d510: 7365 6c66 2e62 7574 746f 6e5f 6163 7469  self.button_acti
+0002d520: 6f6e 5f63 6f6e 7461 6374 2e50 6f70 7570  on_contact.Popup
+0002d530: 4d65 6e75 286d 656e 752c 2028 302c 2073  Menu(menu, (0, s
+0002d540: 656c 662e 6275 7474 6f6e 5f61 6374 696f  elf.button_actio
+0002d550: 6e5f 636f 6e74 6163 742e 5369 7a65 5b31  n_contact.Size[1
+0002d560: 5d29 290d 0a0d 0a0d 0a20 2020 2064 6566  ]))......    def
+0002d570: 206f 6e5f 6368 616e 6765 5f6c 6973 745f   on_change_list_
+0002d580: 6368 6174 735f 7379 6e63 2873 656c 662c  chats_sync(self,
+0002d590: 2065 7665 6e74 293a 0d0a 2020 2020 2020   event):..      
+0002d5a0: 2020 2222 220d 0a20 2020 2020 2020 2048    """..        H
+0002d5b0: 616e 646c 6572 2066 6f72 2073 656c 6563  andler for selec
+0002d5c0: 7469 6e67 2061 6e20 6974 656d 2069 6e20  ting an item in 
+0002d5d0: 7468 6520 7379 6e63 6564 2063 6861 7473  the synced chats
+0002d5e0: 206c 6973 742c 206c 6f61 6473 2074 6865   list, loads the
+0002d5f0: 0d0a 2020 2020 2020 2020 6d65 7373 6167  ..        messag
+0002d600: 6573 2069 6e20 6368 6174 732d 7061 6765  es in chats-page
+0002d610: 2e0d 0a20 2020 2020 2020 2022 2222 0d0a  ...        """..
+0002d620: 2020 2020 2020 2020 6320 3d20 7365 6c66          c = self
+0002d630: 2e6c 6973 745f 6368 6174 735f 7379 6e63  .list_chats_sync
+0002d640: 2e47 6574 4974 656d 4d61 7070 6564 4461  .GetItemMappedDa
+0002d650: 7461 2865 7665 6e74 2e49 6e64 6578 290d  ta(event.Index).
+0002d660: 0a20 2020 2020 2020 2063 6861 7420 3d20  .        chat = 
+0002d670: 6e65 7874 2828 7820 666f 7220 7820 696e  next((x for x in
+0002d680: 2073 656c 662e 6368 6174 7320 6966 2078   self.chats if x
+0002d690: 5b22 6964 656e 7469 7479 225d 203d 3d20  ["identity"] == 
+0002d6a0: 635b 2269 6465 6e74 6974 7922 5d29 2c20  c["identity"]), 
+0002d6b0: 4e6f 6e65 290d 0a20 2020 2020 2020 2069  None)..        i
+0002d6c0: 6620 6368 6174 3a0d 0a20 2020 2020 2020  f chat:..       
+0002d6d0: 2020 2020 2073 656c 662e 6e6f 7465 626f       self.notebo
+0002d6e0: 6f6b 2e53 656c 6563 7469 6f6e 203d 2073  ok.Selection = s
+0002d6f0: 656c 662e 7061 6765 6f72 6465 725b 7365  elf.pageorder[se
+0002d700: 6c66 2e70 6167 655f 6368 6174 735d 0d0a  lf.page_chats]..
+0002d710: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0002d720: 2e6c 6f61 645f 6368 6174 2863 6861 7429  .load_chat(chat)
+0002d730: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+0002d740: 6c66 2e73 7463 5f68 6973 746f 7279 2e53  lf.stc_history.S
+0002d750: 6574 466f 6375 7328 290d 0a0d 0a0d 0a20  etFocus()...... 
+0002d760: 2020 2064 6566 206f 6e5f 6c69 7665 5f6c     def on_live_l
+0002d770: 6f67 696e 2873 656c 662c 2065 7665 6e74  ogin(self, event
+0002d780: 3d4e 6f6e 652c 2073 796e 633d 4661 6c73  =None, sync=Fals
+0002d790: 6529 3a0d 0a20 2020 2020 2020 2022 2222  e):..        """
+0002d7a0: 0d0a 2020 2020 2020 2020 4174 7465 6d70  ..        Attemp
+0002d7b0: 7473 2074 6f20 6c6f 6769 6e20 746f 2053  ts to login to S
+0002d7c0: 6b79 7065 206f 6e6c 696e 6520 7365 7276  kype online serv
+0002d7d0: 6963 652e 0d0a 0d0a 2020 2020 2020 2020  ice.....        
+0002d7e0: 4070 6172 616d 2020 2073 796e 6320 2077  @param   sync  w
+0002d7f0: 6865 7468 6572 2073 796e 6320 7368 6f75  hether sync shou
+0002d800: 6c64 2073 7461 7274 2061 7574 6f6d 6174  ld start automat
+0002d810: 6963 616c 6c79 2061 6674 6572 206c 6f67  ically after log
+0002d820: 696e 0d0a 2020 2020 2020 2020 2222 220d  in..        """.
+0002d830: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+0002d840: 7365 6c66 206f 7220 6e6f 7420 7365 6c66  self or not self
+0002d850: 2e65 6469 745f 7077 2e56 616c 7565 206f  .edit_pw.Value o
+0002d860: 7220 6e6f 7420 6c69 7665 2e73 6b70 793a  r not live.skpy:
+0002d870: 2072 6574 7572 6e0d 0a20 2020 2020 2020   return..       
+0002d880: 2073 656c 662e 6564 6974 5f6c 6f67 696e   self.edit_login
+0002d890: 5f73 7461 7475 732e 5661 6c75 6520 3d20  _status.Value = 
+0002d8a0: 224c 6f67 6769 6e67 2069 6e20 746f 2053  "Logging in to S
+0002d8b0: 6b79 7065 2e2e 220d 0a20 2020 2020 2020  kype.."..       
+0002d8c0: 2066 6f72 2063 2069 6e20 7365 6c66 2e70   for c in self.p
+0002d8d0: 616e 656c 5f6c 6f67 696e 2e43 6869 6c64  anel_login.Child
+0002d8e0: 7265 6e3a 0d0a 2020 2020 2020 2020 2020  ren:..          
+0002d8f0: 2020 6966 2063 2069 7320 7365 6c66 2e65    if c is self.e
+0002d900: 6469 745f 7077 206f 7220 6973 696e 7374  dit_pw or isinst
+0002d910: 616e 6365 2863 2c20 7778 2e43 6865 636b  ance(c, wx.Check
+0002d920: 426f 7829 3a20 632e 4469 7361 626c 6528  Box): c.Disable(
+0002d930: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+0002d940: 6275 7474 6f6e 5f75 7365 722e 4469 7361  button_user.Disa
+0002d950: 626c 6528 290d 0a20 2020 2020 2020 2073  ble()..        s
+0002d960: 656c 662e 6275 7474 6f6e 5f6c 6f67 696e  elf.button_login
+0002d970: 2e44 6973 6162 6c65 2829 0d0a 2020 2020  .Disable()..    
+0002d980: 2020 2020 7365 6c66 2e70 616e 656c 5f6c      self.panel_l
+0002d990: 6f67 696e 2e52 6566 7265 7368 2829 0d0a  ogin.Refresh()..
+0002d9a0: 2020 2020 2020 2020 6163 7469 6f6e 203d          action =
+0002d9b0: 207b 2261 6374 696f 6e22 3a20 226c 6f67   {"action": "log
+0002d9c0: 696e 222c 2022 7061 7373 776f 7264 223a  in", "password":
+0002d9d0: 2073 656c 662e 6564 6974 5f70 772e 5661   self.edit_pw.Va
+0002d9e0: 6c75 652c 2022 7379 6e63 223a 2073 796e  lue, "sync": syn
+0002d9f0: 637d 0d0a 2020 2020 2020 2020 7365 6c66  c}..        self
+0002da00: 2e77 6f72 6b65 725f 6c69 7665 2e77 6f72  .worker_live.wor
+0002da10: 6b28 6163 7469 6f6e 290d 0a0d 0a0d 0a20  k(action)...... 
+0002da20: 2020 2064 6566 206f 6e5f 6c69 7665 5f73     def on_live_s
+0002da30: 796e 6328 7365 6c66 2c20 6576 656e 743d  ync(self, event=
+0002da40: 4e6f 6e65 293a 0d0a 2020 2020 2020 2020  None):..        
+0002da50: 2222 2253 7461 7274 7320 7379 6e63 6872  """Starts synchr
+0002da60: 6f6e 697a 696e 6720 6c6f 6361 6c20 6461  onizing local da
+0002da70: 7461 6261 7365 2066 726f 6d20 536b 7970  tabase from Skyp
+0002da80: 6520 6f6e 6c69 6e65 2073 6572 7669 6365  e online service
+0002da90: 2e22 2222 0d0a 2020 2020 2020 2020 7365  ."""..        se
+0002daa0: 6c66 2e6c 6162 656c 5f73 796e 635f 7072  lf.label_sync_pr
+0002dab0: 6f67 7265 7373 2e4c 6162 656c 203d 2022  ogress.Label = "
+0002dac0: 5570 6461 7469 6e67 206c 6f63 616c 2064  Updating local d
+0002dad0: 6174 6162 6173 6520 6672 6f6d 2053 6b79  atabase from Sky
+0002dae0: 7065 206f 6e6c 696e 6520 7365 7276 6963  pe online servic
+0002daf0: 652e 2e22 0d0a 2020 2020 2020 2020 7365  e.."..        se
+0002db00: 6c66 2e6c 6973 745f 6368 6174 735f 7379  lf.list_chats_sy
+0002db10: 6e63 2e44 656c 6574 6541 6c6c 4974 656d  nc.DeleteAllItem
+0002db20: 7328 290d 0a20 2020 2020 2020 2073 656c  s()..        sel
+0002db30: 662e 6564 6974 5f73 796e 635f 7374 6174  f.edit_sync_stat
+0002db40: 7573 2e43 6c65 6172 2829 0d0a 2020 2020  us.Clear()..    
+0002db50: 2020 2020 7365 6c66 2e67 6175 6765 5f73      self.gauge_s
+0002db60: 796e 632e 5075 6c73 6528 290d 0a20 2020  ync.Pulse()..   
+0002db70: 2020 2020 2073 656c 662e 6368 6563 6b5f       self.check_
+0002db80: 7379 6e63 5f63 6f6e 7461 6374 732e 456e  sync_contacts.En
+0002db90: 6162 6c65 6420 3d20 7365 6c66 2e63 6865  abled = self.che
+0002dba0: 636b 5f73 796e 635f 6f6c 6465 722e 456e  ck_sync_older.En
+0002dbb0: 6162 6c65 6420 3d20 4661 6c73 650d 0a20  abled = False.. 
+0002dbc0: 2020 2020 2020 2073 656c 662e 6275 7474         self.butt
+0002dbd0: 6f6e 5f73 796e 632e 456e 6162 6c65 6420  on_sync.Enabled 
+0002dbe0: 3d20 7365 6c66 2e62 7574 746f 6e5f 7379  = self.button_sy
+0002dbf0: 6e63 5f73 656c 2e45 6e61 626c 6564 203d  nc_sel.Enabled =
+0002dc00: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
+0002dc10: 7365 6c66 2e62 7574 746f 6e5f 7379 6e63  self.button_sync
+0002dc20: 5f73 746f 702e 456e 6162 6c65 2829 0d0a  _stop.Enable()..
+0002dc30: 2020 2020 2020 2020 7365 6c66 2e67 6175          self.gau
+0002dc40: 6765 5f73 796e 632e 436f 6e74 6169 6e69  ge_sync.Containi
+0002dc50: 6e67 5369 7a65 722e 4c61 796f 7574 2829  ngSizer.Layout()
+0002dc60: 0d0a 2020 2020 2020 2020 7365 6c66 2e77  ..        self.w
+0002dc70: 6f72 6b65 725f 6c69 7665 2e77 6f72 6b28  orker_live.work(
+0002dc80: 7b22 6163 7469 6f6e 223a 2022 706f 7075  {"action": "popu
+0002dc90: 6c61 7465 227d 290d 0a0d 0a0d 0a20 2020  late"})......   
+0002dca0: 2064 6566 206f 6e5f 6c69 7665 5f73 796e   def on_live_syn
+0002dcb0: 635f 7365 6c28 7365 6c66 2c20 6576 656e  c_sel(self, even
+0002dcc0: 743d 4e6f 6e65 293a 0d0a 2020 2020 2020  t=None):..      
+0002dcd0: 2020 2222 220d 0a20 2020 2020 2020 204f    """..        O
+0002dce0: 7065 6e73 2063 686f 6963 6520 6469 616c  pens choice dial
+0002dcf0: 6f67 2066 6f72 2073 656c 6563 7469 6e67  og for selecting
+0002dd00: 2063 6861 7473 2061 6e64 2073 7461 7274   chats and start
+0002dd10: 7320 7379 6e63 6872 6f6e 697a 696e 670d  s synchronizing.
+0002dd20: 0a20 2020 2020 2020 206c 6f63 616c 2064  .        local d
+0002dd30: 6174 6162 6173 6520 6672 6f6d 2053 6b79  atabase from Sky
+0002dd40: 7065 206f 6e6c 696e 6520 7365 7276 6963  pe online servic
+0002dd50: 652e 0d0a 2020 2020 2020 2020 2222 220d  e...        """.
+0002dd60: 0a20 2020 2020 2020 2046 4945 4c44 5320  .        FIELDS 
+0002dd70: 3d20 5b22 6964 656e 7469 7479 222c 2022  = ["identity", "
+0002dd80: 7469 746c 6522 2c20 2274 6974 6c65 5f6c  title", "title_l
+0002dd90: 6f6e 6722 2c20 2274 7970 6522 5d0d 0a20  ong", "type"].. 
+0002dda0: 2020 2020 2020 2063 6861 7473 203d 2073         chats = s
+0002ddb0: 6f72 7465 6428 7365 6c66 2e63 6861 7473  orted(self.chats
+0002ddc0: 2c20 6b65 793d 6c61 6d62 6461 2078 3a20  , key=lambda x: 
+0002ddd0: 2878 5b22 7479 7065 225d 2c20 785b 2274  (x["type"], x["t
+0002dde0: 6974 6c65 225d 2e6c 6f77 6572 2829 2929  itle"].lower()))
+0002ddf0: 0d0a 2020 2020 2020 2020 6368 6174 7320  ..        chats 
+0002de00: 3d20 5b7b 6b3a 2078 2e67 6574 286b 2920  = [{k: x.get(k) 
+0002de10: 666f 7220 6b20 696e 2046 4945 4c44 537d  for k in FIELDS}
+0002de20: 2066 6f72 2078 2069 6e20 6368 6174 735d   for x in chats]
+0002de30: 0d0a 2020 2020 2020 2020 666f 7220 7820  ..        for x 
+0002de40: 696e 2063 6861 7473 3a0d 0a20 2020 2020  in chats:..     
+0002de50: 2020 2020 2020 2074 203d 2078 5b22 7469         t = x["ti
+0002de60: 746c 6522 5d20 6966 2073 6b79 7065 6461  tle"] if skypeda
+0002de70: 7461 2e43 4841 5453 5f54 5950 455f 5349  ta.CHATS_TYPE_SI
+0002de80: 4e47 4c45 203d 3d20 785b 2274 7970 6522  NGLE == x["type"
+0002de90: 5d20 656c 7365 2078 5b22 7469 746c 655f  ] else x["title_
+0002dea0: 6c6f 6e67 225d 0d0a 2020 2020 2020 2020  long"]..        
+0002deb0: 2020 2020 6966 206c 656e 2874 2920 3e20      if len(t) > 
+0002dec0: 3630 3a0d 0a20 2020 2020 2020 2020 2020  60:..           
+0002ded0: 2020 2020 2074 203d 2022 2573 2e2e 2220       t = "%s.." 
+0002dee0: 2520 745b 3a36 305d 0d0a 2020 2020 2020  % t[:60]..      
+0002def0: 2020 2020 2020 2020 2020 6966 2073 6b79            if sky
+0002df00: 7065 6461 7461 2e43 4841 5453 5f54 5950  pedata.CHATS_TYP
+0002df10: 455f 5349 4e47 4c45 2021 3d20 785b 2274  E_SINGLE != x["t
+0002df20: 7970 6522 5d3a 2074 202b 3d20 2722 270d  ype"]: t += '"'.
+0002df30: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0002df40: 736b 7970 6564 6174 612e 4348 4154 535f  skypedata.CHATS_
+0002df50: 5459 5045 5f53 494e 474c 4520 3d3d 2078  TYPE_SINGLE == x
+0002df60: 5b22 7479 7065 225d 2061 6e64 2078 5b22  ["type"] and x["
+0002df70: 6964 656e 7469 7479 225d 2021 3d20 785b  identity"] != x[
+0002df80: 2274 6974 6c65 225d 3a0d 0a20 2020 2020  "title"]:..     
+0002df90: 2020 2020 2020 2020 2020 2074 202b 3d20             t += 
+0002dfa0: 2220 2825 7329 2220 2520 785b 2269 6465  " (%s)" % x["ide
+0002dfb0: 6e74 6974 7922 5d0d 0a20 2020 2020 2020  ntity"]..       
+0002dfc0: 2020 2020 2078 5b22 7469 746c 6522 5d20       x["title"] 
+0002dfd0: 3d20 740d 0a0d 0a20 2020 2020 2020 2064  = t....        d
+0002dfe0: 6c67 203d 2077 782e 4d75 6c74 6943 686f  lg = wx.MultiCho
+0002dff0: 6963 6544 6961 6c6f 6728 7365 6c66 2c20  iceDialog(self, 
+0002e000: 2253 656c 6563 7420 6368 6174 7320 746f  "Select chats to
+0002e010: 2075 7064 6174 653a 222c 0d0a 2020 2020   update:",..    
+0002e020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e030: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0002e040: 6f6e 662e 5469 746c 652c 205b 785b 2274  onf.Title, [x["t
+0002e050: 6974 6c65 225d 2066 6f72 2078 2069 6e20  itle"] for x in 
+0002e060: 6368 6174 735d 290d 0a20 2020 2020 2020  chats])..       
+0002e070: 2069 6620 7778 2e49 445f 4f4b 2021 3d20   if wx.ID_OK != 
+0002e080: 646c 672e 5368 6f77 4d6f 6461 6c28 2920  dlg.ShowModal() 
+0002e090: 6f72 206e 6f74 2064 6c67 2e47 6574 5365  or not dlg.GetSe
+0002e0a0: 6c65 6374 696f 6e73 2829 3a20 7265 7475  lections(): retu
+0002e0b0: 726e 0d0a 0d0a 2020 2020 2020 2020 7365  rn....        se
+0002e0c0: 6c63 6861 7473 203d 205b 6368 6174 735b  lchats = [chats[
+0002e0d0: 695d 2066 6f72 2069 2069 6e20 646c 672e  i] for i in dlg.
+0002e0e0: 4765 7453 656c 6563 7469 6f6e 7328 295d  GetSelections()]
+0002e0f0: 0d0a 2020 2020 2020 2020 736c 6162 656c  ..        slabel
+0002e100: 203d 2022 5570 6461 7469 6e67 2025 7320   = "Updating %s 
+0002e110: 2825 7329 2066 726f 6d20 536b 7970 6520  (%s) from Skype 
+0002e120: 6f6e 6c69 6e65 2073 6572 7669 6365 2e2e  online service..
+0002e130: 2220 2520 280d 0a20 2020 2020 2020 2020  " % (..         
+0002e140: 2020 2020 2020 2020 7574 696c 2e70 6c75          util.plu
+0002e150: 7261 6c28 2263 6861 7422 2c20 7365 6c63  ral("chat", selc
+0002e160: 6861 7473 2c20 7365 703d 222c 2229 2c20  hats, sep=","), 
+0002e170: 222c 2022 2e6a 6f69 6e28 785b 2274 6974  ", ".join(x["tit
+0002e180: 6c65 225d 2066 6f72 2078 2069 6e20 7365  le"] for x in se
+0002e190: 6c63 6861 7473 2929 0d0a 2020 2020 2020  lchats))..      
+0002e1a0: 2020 706c 6162 656c 203d 2022 5570 6461    plabel = "Upda
+0002e1b0: 7469 6e67 2025 7320 6672 6f6d 2053 6b79  ting %s from Sky
+0002e1c0: 7065 206f 6e6c 696e 6520 7365 7276 6963  pe online servic
+0002e1d0: 652e 2e22 2025 2075 7469 6c2e 706c 7572  e.." % util.plur
+0002e1e0: 616c 2822 6368 6174 222c 2073 656c 6368  al("chat", selch
+0002e1f0: 6174 732c 2073 6570 3d22 2c22 290d 0a20  ats, sep=",").. 
+0002e200: 2020 2020 2020 2073 656c 662e 6564 6974         self.edit
+0002e210: 5f73 796e 635f 7374 6174 7573 2e56 616c  _sync_status.Val
+0002e220: 7565 202b 3d20 2822 5c6e 5c6e 2220 6966  ue += ("\n\n" if
+0002e230: 2073 656c 662e 6564 6974 5f73 796e 635f   self.edit_sync_
+0002e240: 7374 6174 7573 2e56 616c 7565 2065 6c73  status.Value els
+0002e250: 6520 2222 2920 2b20 736c 6162 656c 0d0a  e "") + slabel..
+0002e260: 2020 2020 2020 2020 7365 6c66 2e65 6469          self.edi
+0002e270: 745f 7379 6e63 5f73 7461 7475 732e 5368  t_sync_status.Sh
+0002e280: 6f77 506f 7369 7469 6f6e 2873 656c 662e  owPosition(self.
+0002e290: 6564 6974 5f73 796e 635f 7374 6174 7573  edit_sync_status
+0002e2a0: 2e4c 6173 7450 6f73 6974 696f 6e29 0d0a  .LastPosition)..
+0002e2b0: 2020 2020 2020 2020 7365 6c66 2e6c 6162          self.lab
+0002e2c0: 656c 5f73 796e 635f 7072 6f67 7265 7373  el_sync_progress
+0002e2d0: 2e4c 6162 656c 203d 2070 6c61 6265 6c0d  .Label = plabel.
+0002e2e0: 0a20 2020 2020 2020 2073 656c 662e 6c69  .        self.li
+0002e2f0: 7374 5f63 6861 7473 5f73 796e 632e 4465  st_chats_sync.De
+0002e300: 6c65 7465 416c 6c49 7465 6d73 2829 0d0a  leteAllItems()..
+0002e310: 2020 2020 2020 2020 7365 6c66 2e65 6469          self.edi
+0002e320: 745f 7379 6e63 5f73 7461 7475 732e 436c  t_sync_status.Cl
+0002e330: 6561 7228 290d 0a20 2020 2020 2020 2073  ear()..        s
+0002e340: 656c 662e 6761 7567 655f 7379 6e63 2e50  elf.gauge_sync.P
+0002e350: 756c 7365 2829 0d0a 2020 2020 2020 2020  ulse()..        
+0002e360: 7365 6c66 2e63 6865 636b 5f73 796e 635f  self.check_sync_
+0002e370: 636f 6e74 6163 7473 2e45 6e61 626c 6564  contacts.Enabled
+0002e380: 203d 2073 656c 662e 6368 6563 6b5f 7379   = self.check_sy
+0002e390: 6e63 5f6f 6c64 6572 2e45 6e61 626c 6564  nc_older.Enabled
+0002e3a0: 203d 2046 616c 7365 0d0a 2020 2020 2020   = False..      
+0002e3b0: 2020 7365 6c66 2e62 7574 746f 6e5f 7379    self.button_sy
+0002e3c0: 6e63 2e45 6e61 626c 6564 203d 2073 656c  nc.Enabled = sel
+0002e3d0: 662e 6275 7474 6f6e 5f73 796e 635f 7365  f.button_sync_se
+0002e3e0: 6c2e 456e 6162 6c65 6420 3d20 4661 6c73  l.Enabled = Fals
+0002e3f0: 650d 0a20 2020 2020 2020 2073 656c 662e  e..        self.
+0002e400: 6275 7474 6f6e 5f73 796e 635f 7374 6f70  button_sync_stop
+0002e410: 2e45 6e61 626c 6528 290d 0a20 2020 2020  .Enable()..     
+0002e420: 2020 2073 656c 662e 6761 7567 655f 7379     self.gauge_sy
+0002e430: 6e63 2e43 6f6e 7461 696e 696e 6753 697a  nc.ContainingSiz
+0002e440: 6572 2e4c 6179 6f75 7428 290d 0a20 2020  er.Layout()..   
+0002e450: 2020 2020 2073 656c 662e 776f 726b 6572       self.worker
+0002e460: 5f6c 6976 652e 776f 726b 287b 2261 6374  _live.work({"act
+0002e470: 696f 6e22 3a20 2270 6f70 756c 6174 6522  ion": "populate"
+0002e480: 2c20 2263 6861 7473 223a 205b 785b 2269  , "chats": [x["i
+0002e490: 6465 6e74 6974 7922 5d20 666f 7220 7820  dentity"] for x 
+0002e4a0: 696e 2073 656c 6368 6174 735d 7d29 0d0a  in selchats]})..
+0002e4b0: 0d0a 0d0a 2020 2020 6465 6620 6f6e 5f6c  ....    def on_l
+0002e4c0: 6976 655f 7379 6e63 5f73 746f 7028 7365  ive_sync_stop(se
+0002e4d0: 6c66 2c20 6576 656e 743d 4e6f 6e65 293a  lf, event=None):
+0002e4e0: 0d0a 2020 2020 2020 2020 2222 2253 746f  ..        """Sto
+0002e4f0: 7073 2073 796e 6368 726f 6e69 7a69 6e67  ps synchronizing
+0002e500: 206c 6f63 616c 2064 6174 6162 6173 6520   local database 
+0002e510: 6672 6f6d 2053 6b79 7065 206f 6e6c 696e  from Skype onlin
+0002e520: 6520 7365 7276 6963 652e 2222 220d 0a20  e service.""".. 
+0002e530: 2020 2020 2020 2069 6620 7778 2e4f 4b20         if wx.OK 
+0002e540: 213d 2077 782e 4d65 7373 6167 6542 6f78  != wx.MessageBox
+0002e550: 2822 4172 6520 796f 7520 7375 7265 2079  ("Are you sure y
+0002e560: 6f75 2077 616e 7420 746f 2073 746f 7020  ou want to stop 
+0002e570: 7379 6e63 6872 6f6e 697a 6174 696f 6e3f  synchronization?
+0002e580: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
+0002e590: 636f 6e66 2e54 6974 6c65 2c20 7778 2e49  conf.Title, wx.I
+0002e5a0: 434f 4e5f 5155 4553 5449 4f4e 207c 2077  CON_QUESTION | w
+0002e5b0: 782e 4f4b 207c 2077 782e 4341 4e43 454c  x.OK | wx.CANCEL
+0002e5c0: 0d0a 2020 2020 2020 2020 2920 6f72 206e  ..        ) or n
+0002e5d0: 6f74 2073 656c 662e 776f 726b 6572 5f6c  ot self.worker_l
+0002e5e0: 6976 652e 6973 5f77 6f72 6b69 6e67 2829  ive.is_working()
+0002e5f0: 3a20 7265 7475 726e 0d0a 2020 2020 2020  : return..      
+0002e600: 2020 7365 6c66 2e67 6175 6765 5f73 796e    self.gauge_syn
+0002e610: 632e 5661 6c75 6520 3d20 7365 6c66 2e67  c.Value = self.g
+0002e620: 6175 6765 5f73 796e 632e 5661 6c75 6520  auge_sync.Value 
+0002e630: 2320 5374 6f70 2070 756c 7365 2c20 6966  # Stop pulse, if
+0002e640: 2061 6e79 0d0a 2020 2020 2020 2020 7365   any..        se
+0002e650: 6c66 2e63 6865 636b 5f73 796e 635f 636f  lf.check_sync_co
+0002e660: 6e74 6163 7473 2e45 6e61 626c 6564 203d  ntacts.Enabled =
+0002e670: 2073 656c 662e 6368 6563 6b5f 7379 6e63   self.check_sync
+0002e680: 5f6f 6c64 6572 2e45 6e61 626c 6564 203d  _older.Enabled =
+0002e690: 2054 7275 650d 0a20 2020 2020 2020 2073   True..        s
+0002e6a0: 656c 662e 6275 7474 6f6e 5f73 796e 632e  elf.button_sync.
+0002e6b0: 456e 6162 6c65 6420 3d20 7365 6c66 2e62  Enabled = self.b
+0002e6c0: 7574 746f 6e5f 7379 6e63 5f73 656c 2e45  utton_sync_sel.E
+0002e6d0: 6e61 626c 6564 203d 2054 7275 650d 0a20  nabled = True.. 
+0002e6e0: 2020 2020 2020 2073 656c 662e 6275 7474         self.butt
+0002e6f0: 6f6e 5f73 796e 635f 7374 6f70 2e44 6973  on_sync_stop.Dis
+0002e700: 6162 6c65 2829 0d0a 2020 2020 2020 2020  able()..        
+0002e710: 7365 6c66 2e67 6175 6765 5f73 796e 632e  self.gauge_sync.
+0002e720: 436f 6e74 6169 6e69 6e67 5369 7a65 722e  ContainingSizer.
+0002e730: 4c61 796f 7574 2829 0d0a 2020 2020 2020  Layout()..      
+0002e740: 2020 7365 6c66 2e77 6f72 6b65 725f 6c69    self.worker_li
+0002e750: 7665 2e73 746f 705f 776f 726b 2829 0d0a  ve.stop_work()..
+0002e760: 0d0a 0d0a 2020 2020 6465 6620 6f6e 5f6c  ....    def on_l
+0002e770: 6976 655f 7379 6e63 5f69 7465 6d73 2873  ive_sync_items(s
+0002e780: 656c 662c 2063 6861 7473 3d28 292c 2063  elf, chats=(), c
+0002e790: 6f6e 7461 6374 733d 2829 2c20 6d65 7373  ontacts=(), mess
+0002e7a0: 6167 6573 3d54 7275 6529 3a0d 0a20 2020  ages=True):..   
+0002e7b0: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
+0002e7c0: 2020 4f70 656e 7320 6f6e 6c69 6e65 2070    Opens online p
+0002e7d0: 6167 652c 206c 6f67 7320 696e 2069 6620  age, logs in if 
+0002e7e0: 6e6f 7420 6c6f 6767 6564 2069 6e2c 2061  not logged in, a
+0002e7f0: 6e64 2073 796e 6368 726f 6e69 7a65 7320  nd synchronizes 
+0002e800: 7370 6563 6966 6965 6420 6974 656d 7320  specified items 
+0002e810: 6672 6f6d 206c 6976 652e 0d0a 0d0a 2020  from live.....  
+0002e820: 2020 2020 2020 4070 6172 616d 2020 2063        @param   c
+0002e830: 6861 7473 2020 2020 206c 6973 7420 6f66  hats     list of
+0002e840: 2063 6861 7473 2074 6f20 7570 6461 7465   chats to update
+0002e850: 0d0a 2020 2020 2020 2020 4070 6172 616d  ..        @param
+0002e860: 2020 2063 6f6e 7461 6374 7320 206c 6973     contacts  lis
+0002e870: 7420 6f66 2063 6f6e 7461 6374 7320 746f  t of contacts to
+0002e880: 2075 7064 6174 6520 7072 6f66 696c 6573   update profiles
+0002e890: 2066 6f72 0d0a 2020 2020 2020 2020 4070   for..        @p
+0002e8a0: 6172 616d 2020 206d 6573 7361 6765 7320  aram   messages 
+0002e8b0: 2077 6865 7468 6572 2074 6f20 7379 6e63   whether to sync
+0002e8c0: 2063 6861 7420 6d65 7373 6167 6573 2069   chat messages i
+0002e8d0: 6620 6368 6174 732c 206f 7220 6f6e 6c79  f chats, or only
+0002e8e0: 2063 6861 7420 7061 7274 6963 6970 616e   chat participan
+0002e8f0: 7420 7072 6f66 696c 6573 0d0a 2020 2020  t profiles..    
+0002e900: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
+0002e910: 2069 6620 6e6f 7420 6368 6174 7320 616e   if not chats an
+0002e920: 6420 6e6f 7420 636f 6e74 6163 7473 3a20  d not contacts: 
+0002e930: 7265 7475 726e 0d0a 2020 2020 2020 2020  return..        
+0002e940: 7365 6c66 2e6e 6f74 6562 6f6f 6b2e 5365  self.notebook.Se
+0002e950: 7453 656c 6563 7469 6f6e 2873 656c 662e  tSelection(self.
+0002e960: 7061 6765 6f72 6465 725b 7365 6c66 2e70  pageorder[self.p
+0002e970: 6167 655f 6c69 7665 5d29 0d0a 2020 2020  age_live])..    
+0002e980: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
+0002e990: 6462 2e6c 6976 652e 6973 5f6c 6f67 6765  db.live.is_logge
+0002e9a0: 645f 696e 2829 2061 6e64 2063 6f6e 662e  d_in() and conf.
+0002e9b0: 4c6f 6769 6e2e 6765 7428 7365 6c66 2e64  Login.get(self.d
+0002e9c0: 622e 6669 6c65 6e61 6d65 2c20 7b7d 292e  b.filename, {}).
+0002e9d0: 6765 7428 2270 6173 7377 6f72 6422 293a  get("password"):
+0002e9e0: 0d0a 2020 2020 2020 2020 2020 2020 7077  ..            pw
+0002e9f0: 6420 3d20 7574 696c 2e64 656f 6266 7573  d = util.deobfus
+0002ea00: 6361 7465 2863 6f6e 662e 4c6f 6769 6e5b  cate(conf.Login[
+0002ea10: 7365 6c66 2e64 622e 6669 6c65 6e61 6d65  self.db.filename
+0002ea20: 5d5b 2270 6173 7377 6f72 6422 5d29 0d0a  ]["password"])..
+0002ea30: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0002ea40: 2e64 622e 6c69 7665 2e6c 6f67 696e 2870  .db.live.login(p
+0002ea50: 6173 7377 6f72 643d 7077 6429 0d0a 2020  assword=pwd)..  
+0002ea60: 2020 2020 2020 2020 2020 7365 6c66 2e6f            self.o
+0002ea70: 6e5f 6c69 7665 5f6c 6f67 696e 5f72 6573  n_live_login_res
+0002ea80: 756c 7428 7b7d 290d 0a20 2020 2020 2020  ult({})..       
+0002ea90: 2069 6620 6e6f 7420 7365 6c66 2e64 622e   if not self.db.
+0002eaa0: 6c69 7665 2e69 735f 6c6f 6767 6564 5f69  live.is_logged_i
+0002eab0: 6e28 293a 0d0a 2020 2020 2020 2020 2020  n():..          
+0002eac0: 2020 7365 6c66 2e65 6469 745f 7077 2e53    self.edit_pw.S
+0002ead0: 6574 466f 6375 7328 290d 0a20 2020 2020  etFocus()..     
+0002eae0: 2020 2020 2020 2072 6574 7572 6e0d 0a0d         return...
+0002eaf0: 0a20 2020 2020 2020 2073 656c 662e 6368  .        self.ch
+0002eb00: 6563 6b5f 7379 6e63 5f63 6f6e 7461 6374  eck_sync_contact
+0002eb10: 732e 456e 6162 6c65 6420 3d20 7365 6c66  s.Enabled = self
+0002eb20: 2e63 6865 636b 5f73 796e 635f 6f6c 6465  .check_sync_olde
+0002eb30: 722e 456e 6162 6c65 6420 3d20 4661 6c73  r.Enabled = Fals
+0002eb40: 650d 0a20 2020 2020 2020 2073 656c 662e  e..        self.
+0002eb50: 6275 7474 6f6e 5f73 796e 632e 456e 6162  button_sync.Enab
+0002eb60: 6c65 6420 3d20 7365 6c66 2e62 7574 746f  led = self.butto
+0002eb70: 6e5f 7379 6e63 5f73 656c 2e45 6e61 626c  n_sync_sel.Enabl
+0002eb80: 6564 203d 2046 616c 7365 0d0a 2020 2020  ed = False..    
+0002eb90: 2020 2020 7365 6c66 2e62 7574 746f 6e5f      self.button_
+0002eba0: 7379 6e63 5f73 746f 702e 456e 6162 6c65  sync_stop.Enable
+0002ebb0: 2829 0d0a 2020 2020 2020 2020 6966 206e  ()..        if n
+0002ebc0: 6f74 2073 656c 662e 776f 726b 6572 5f6c  ot self.worker_l
+0002ebd0: 6976 652e 6973 5f77 6f72 6b69 6e67 2829  ive.is_working()
+0002ebe0: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+0002ebf0: 656c 662e 6c69 7374 5f63 6861 7473 5f73  elf.list_chats_s
+0002ec00: 796e 632e 4465 6c65 7465 416c 6c49 7465  ync.DeleteAllIte
+0002ec10: 6d73 2829 0d0a 2020 2020 2020 2020 2020  ms()..          
+0002ec20: 2020 7365 6c66 2e65 6469 745f 7379 6e63    self.edit_sync
+0002ec30: 5f73 7461 7475 732e 436c 6561 7228 290d  _status.Clear().
+0002ec40: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0002ec50: 662e 6761 7567 655f 7379 6e63 2e50 756c  f.gauge_sync.Pul
+0002ec60: 7365 2829 0d0a 2020 2020 2020 2020 2020  se()..          
+0002ec70: 2020 7365 6c66 2e67 6175 6765 5f73 796e    self.gauge_syn
+0002ec80: 632e 436f 6e74 6169 6e69 6e67 5369 7a65  c.ContainingSize
+0002ec90: 722e 4c61 796f 7574 2829 0d0a 0d0a 2020  r.Layout()....  
+0002eca0: 2020 2020 2020 6163 636f 756e 7420 203d        account  =
+0002ecb0: 206e 6578 7428 2863 2066 6f72 2063 2069   next((c for c i
+0002ecc0: 6e20 636f 6e74 6163 7473 206f 7220 5b5d  n contacts or []
+0002ecd0: 2069 6620 635b 2269 6465 6e74 6974 7922   if c["identity"
+0002ece0: 5d20 3d3d 2073 656c 662e 6462 2e69 6429  ] == self.db.id)
+0002ecf0: 2c20 4e6f 6e65 290d 0a20 2020 2020 2020  , None)..       
+0002ed00: 2069 6620 6163 636f 756e 743a 0d0a 2020   if account:..  
+0002ed10: 2020 2020 2020 2020 2020 636f 6e74 6163            contac
+0002ed20: 7473 203d 205b 6320 666f 7220 6320 696e  ts = [c for c in
+0002ed30: 2063 6f6e 7461 6374 7320 6f72 205b 5d20   contacts or [] 
+0002ed40: 6966 2063 5b22 6964 656e 7469 7479 225d  if c["identity"]
+0002ed50: 2021 3d20 7365 6c66 2e64 622e 6964 5d0d   != self.db.id].
+0002ed60: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0002ed70: 662e 776f 726b 6572 5f6c 6976 652e 776f  f.worker_live.wo
+0002ed80: 726b 287b 2261 6374 696f 6e22 3a20 2261  rk({"action": "a
+0002ed90: 6363 6f75 6e74 227d 290d 0a20 2020 2020  ccount"})..     
+0002eda0: 2020 2069 6620 636f 6e74 6163 7473 3a0d     if contacts:.
+0002edb0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0002edc0: 662e 776f 726b 6572 5f6c 6976 652e 776f  f.worker_live.wo
+0002edd0: 726b 287b 2261 6374 696f 6e22 3a20 2263  rk({"action": "c
+0002ede0: 6f6e 7461 6374 7322 2c20 2263 6f6e 7461  ontacts", "conta
+0002edf0: 6374 7322 3a20 5b78 5b22 6964 656e 7469  cts": [x["identi
+0002ee00: 7479 225d 2066 6f72 2078 2069 6e20 636f  ty"] for x in co
+0002ee10: 6e74 6163 7473 5d7d 290d 0a20 2020 2020  ntacts]})..     
+0002ee20: 2020 2069 6620 6368 6174 7320 616e 6420     if chats and 
+0002ee30: 6d65 7373 6167 6573 3a0d 0a20 2020 2020  messages:..     
+0002ee40: 2020 2020 2020 2073 656c 662e 776f 726b         self.work
+0002ee50: 6572 5f6c 6976 652e 776f 726b 287b 2261  er_live.work({"a
+0002ee60: 6374 696f 6e22 3a20 2268 6973 746f 7279  ction": "history
+0002ee70: 222c 2022 6368 6174 7322 3a20 5b78 5b22  ", "chats": [x["
+0002ee80: 6964 656e 7469 7479 225d 2066 6f72 2078  identity"] for x
+0002ee90: 2069 6e20 6368 6174 735d 7d29 0d0a 2020   in chats]})..  
+0002eea0: 2020 2020 2020 656c 6966 2063 6861 7473        elif chats
+0002eeb0: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+0002eec0: 656c 662e 776f 726b 6572 5f6c 6976 652e  elf.worker_live.
+0002eed0: 776f 726b 287b 2261 6374 696f 6e22 3a20  work({"action": 
+0002eee0: 2263 6861 7473 222c 2022 6368 6174 7322  "chats", "chats"
+0002eef0: 3a20 5b78 5b22 6964 656e 7469 7479 225d  : [x["identity"]
+0002ef00: 2066 6f72 2078 2069 6e20 6368 6174 735d   for x in chats]
+0002ef10: 7d29 0d0a 0d0a 0d0a 2020 2020 6465 6620  })......    def 
+0002ef20: 6f6e 5f6c 6976 655f 7265 7375 6c74 2873  on_live_result(s
+0002ef30: 656c 662c 2072 6573 756c 743d 4e6f 6e65  elf, result=None
+0002ef40: 2c20 2a2a 6b77 6172 6773 293a 0d0a 2020  , **kwargs):..  
+0002ef50: 2020 2020 2020 2222 2243 616c 6c62 6163        """Callbac
+0002ef60: 6b20 666f 7220 776f 726b 6572 732e 4c69  k for workers.Li
+0002ef70: 7665 5468 7265 6164 2072 6573 756c 7473  veThread results
+0002ef80: 2e22 2222 0d0a 0d0a 2020 2020 2020 2020  ."""....        
+0002ef90: 6465 6620 6166 7465 7228 7265 7375 6c74  def after(result
+0002efa0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+0002efb0: 6966 206e 6f74 2073 656c 6620 6f72 206e  if not self or n
+0002efc0: 6f74 2072 6573 756c 7420 6f72 2022 6163  ot result or "ac
+0002efd0: 7469 6f6e 2220 6e6f 7420 696e 2072 6573  tion" not in res
+0002efe0: 756c 743a 2072 6574 7572 6e0d 0a0d 0a20  ult: return.... 
+0002eff0: 2020 2020 2020 2020 2020 2069 6620 226c             if "l
+0002f000: 6f67 696e 2220 203d 3d20 7265 7375 6c74  ogin"  == result
+0002f010: 5b22 6163 7469 6f6e 225d 3a0d 0a20 2020  ["action"]:..   
+0002f020: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0002f030: 662e 6f6e 5f6c 6976 655f 6c6f 6769 6e5f  f.on_live_login_
+0002f040: 7265 7375 6c74 2872 6573 756c 7429 0d0a  result(result)..
+0002f050: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+0002f060: 2022 696e 666f 2220 3d3d 2072 6573 756c   "info" == resul
+0002f070: 745b 2261 6374 696f 6e22 5d20 616e 6420  t["action"] and 
+0002f080: 226d 6573 7361 6765 2220 696e 2072 6573  "message" in res
+0002f090: 756c 743a 0d0a 2020 2020 2020 2020 2020  ult:..          
+0002f0a0: 2020 2020 2020 7365 6c66 2e6c 6162 656c        self.label
+0002f0b0: 5f73 796e 635f 7072 6f67 7265 7373 2e4c  _sync_progress.L
+0002f0c0: 6162 656c 203d 2072 6573 756c 745b 226d  abel = result["m
+0002f0d0: 6573 7361 6765 225d 206f 7220 2222 0d0a  essage"] or ""..
+0002f0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f0f0: 6966 2022 696e 6465 7822 2069 6e20 7265  if "index" in re
+0002f100: 7375 6c74 2061 6e64 2022 636f 756e 7422  sult and "count"
+0002f110: 2069 6e20 7265 7375 6c74 3a0d 0a20 2020   in result:..   
+0002f120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f130: 2070 6572 6365 6e74 203d 206d 696e 2831   percent = min(1
+0002f140: 3030 2c20 6d61 7468 2e63 6569 6c28 3130  00, math.ceil(10
+0002f150: 3020 2a20 7574 696c 2e73 6166 6564 6976  0 * util.safediv
+0002f160: 6628 7265 7375 6c74 5b22 696e 6465 7822  f(result["index"
+0002f170: 5d2c 2072 6573 756c 745b 2263 6f75 6e74  ], result["count
+0002f180: 225d 2929 290d 0a20 2020 2020 2020 2020  "])))..         
+0002f190: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0002f1a0: 6761 7567 655f 7379 6e63 2e56 616c 7565  gauge_sync.Value
+0002f1b0: 203d 2070 6572 6365 6e74 0d0a 2020 2020   = percent..    
+0002f1c0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0002f1d0: 2e67 6175 6765 5f73 796e 632e 436f 6e74  .gauge_sync.Cont
+0002f1e0: 6169 6e69 6e67 5369 7a65 722e 4c61 796f  ainingSizer.Layo
+0002f1f0: 7574 2829 0d0a 2020 2020 2020 2020 2020  ut()..          
+0002f200: 2020 656c 6966 2072 6573 756c 742e 6765    elif result.ge
+0002f210: 7428 2265 7272 6f72 2229 206f 7220 7265  t("error") or re
+0002f220: 7375 6c74 2e67 6574 2822 646f 6e65 2229  sult.get("done")
+0002f230: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0002f240: 2020 2073 656c 662e 6f6e 5f6c 6976 655f     self.on_live_
+0002f250: 776f 726b 5f64 6f6e 6528 7265 7375 6c74  work_done(result
+0002f260: 290d 0a20 2020 2020 2020 2020 2020 2065  )..            e
+0002f270: 6c69 6620 2270 6f70 756c 6174 6522 203d  lif "populate" =
+0002f280: 3d20 7265 7375 6c74 5b22 6163 7469 6f6e  = result["action
+0002f290: 225d 3a0d 0a20 2020 2020 2020 2020 2020  "]:..           
+0002f2a0: 2020 2020 2072 656c 6f61 6473 203d 207b       reloads = {
+0002f2b0: 7d20 2320 7b63 6174 6567 6f72 793a 2077  } # {category: w
+0002f2c0: 6865 7468 6572 2074 6f20 7265 6c6f 6164  hether to reload
+0002f2d0: 2069 6e20 6675 6c6c 206f 7220 7265 6672   in full or refr
+0002f2e0: 6573 6820 5549 206f 6e6c 797d 0d0a 2020  esh UI only}..  
+0002f2f0: 2020 2020 2020 2020 2020 2020 2020 746c                tl
+0002f300: 6162 656c 203d 2028 2261 6363 6f75 6e74  abel = ("account
+0002f310: 2220 6966 2022 6163 636f 756e 7473 2220  " if "accounts" 
+0002f320: 3d3d 2072 6573 756c 745b 2274 6162 6c65  == result["table
+0002f330: 225d 2065 6c73 6520 7265 7375 6c74 5b22  "] else result["
+0002f340: 7461 626c 6522 5d29 0d0a 2020 2020 2020  table"])..      
+0002f350: 2020 2020 2020 2020 2020 706c 6162 656c            plabel
+0002f360: 2c20 736c 6162 656c 2c20 6368 6174 203d  , slabel, chat =
+0002f370: 2075 2253 796e 6368 726f 6e69 7a69 6e67   u"Synchronizing
+0002f380: 2025 7322 2025 2074 6c61 6265 6c2c 204e   %s" % tlabel, N
+0002f390: 6f6e 652c 204e 6f6e 650d 0a20 2020 2020  one, None..     
+0002f3a0: 2020 2020 2020 2020 2020 2069 6620 7265             if re
+0002f3b0: 7375 6c74 2e67 6574 2822 6368 6174 2229  sult.get("chat")
+0002f3c0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0002f3d0: 2020 2020 2020 2063 6861 7420 203d 206e         chat  = n
+0002f3e0: 6578 7428 2863 2066 6f72 2063 2069 6e20  ext((c for c in 
+0002f3f0: 7365 6c66 2e63 6861 7473 2069 6620 635b  self.chats if c[
+0002f400: 2269 6465 6e74 6974 7922 5d20 3d3d 2072  "identity"] == r
+0002f410: 6573 756c 745b 2263 6861 7422 5d29 2c20  esult["chat"]), 
+0002f420: 4e6f 6e65 290d 0a20 2020 2020 2020 2020  None)..         
+0002f430: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+0002f440: 7420 6368 6174 3a0d 0a20 2020 2020 2020  t chat:..       
+0002f450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f460: 2063 6320 3d20 7365 6c66 2e64 622e 6765   cc = self.db.ge
+0002f470: 745f 636f 6e76 6572 7361 7469 6f6e 7328  t_conversations(
+0002f480: 6368 6174 6964 656e 7469 7469 6573 3d5b  chatidentities=[
+0002f490: 7265 7375 6c74 5b22 6368 6174 225d 5d2c  result["chat"]],
+0002f4a0: 2072 656c 6f61 643d 5472 7565 2c20 6c6f   reload=True, lo
+0002f4b0: 673d 4661 6c73 6529 0d0a 2020 2020 2020  g=False)..      
+0002f4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f4d0: 2020 7365 6c66 2e63 6861 7473 2e65 7874    self.chats.ext
+0002f4e0: 656e 6428 6363 290d 0a20 2020 2020 2020  end(cc)..       
+0002f4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f500: 2069 6620 6363 3a20 6368 6174 203d 2063   if cc: chat = c
+0002f510: 635b 305d 0d0a 0d0a 2020 2020 2020 2020  c[0]....        
+0002f520: 2020 2020 2020 2020 6966 2022 6d65 7373          if "mess
+0002f530: 6167 6573 2220 3d3d 2072 6573 756c 745b  ages" == result[
+0002f540: 2274 6162 6c65 225d 2061 6e64 2072 6573  "table"] and res
+0002f550: 756c 742e 6765 7428 2263 6861 7422 293a  ult.get("chat"):
+0002f560: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0002f570: 2020 2020 2020 7469 746c 6520 3d20 6368        title = ch
+0002f580: 6174 5b22 7469 746c 655f 6c6f 6e67 5f6c  at["title_long_l
+0002f590: 6322 5d20 6966 2063 6861 7420 656c 7365  c"] if chat else
+0002f5a0: 2072 6573 756c 745b 2263 6861 7422 5d0d   result["chat"].
+0002f5b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002f5c0: 2020 2020 2069 6620 6c65 6e28 7469 746c       if len(titl
+0002f5d0: 6529 203e 2033 353a 0d0a 2020 2020 2020  e) > 35:..      
+0002f5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f5f0: 2020 7469 746c 6520 3d20 7469 746c 655b    title = title[
+0002f600: 3a33 355d 202b 2022 2e2e 220d 0a20 2020  :35] + ".."..   
+0002f610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f620: 2020 2020 2069 6620 6368 6174 2061 6e64       if chat and
+0002f630: 2073 6b79 7065 6461 7461 2e43 4841 5453   skypedata.CHATS
+0002f640: 5f54 5950 455f 4752 4f55 5020 3d3d 2063  _TYPE_GROUP == c
+0002f650: 6861 745b 2274 7970 6522 5d3a 2074 6974  hat["type"]: tit
+0002f660: 6c65 202b 3d20 2722 270d 0a20 2020 2020  le += '"'..     
+0002f670: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0002f680: 6c61 6265 6c20 2b3d 2022 2069 6e20 2573  label += " in %s
+0002f690: 2220 2520 7469 746c 650d 0a0d 0a20 2020  " % title....   
+0002f6a0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0002f6b0: 7265 7375 6c74 2e67 6574 2822 636f 756e  result.get("coun
+0002f6c0: 7422 293a 0d0a 2020 2020 2020 2020 2020  t"):..          
+0002f6d0: 2020 2020 2020 2020 2020 636c 6162 656c            clabel
+0002f6e0: 203d 2022 2c20 2573 2070 726f 6365 7373   = ", %s process
+0002f6f0: 6564 2220 2520 7265 7375 6c74 5b22 636f  ed" % result["co
+0002f700: 756e 7422 5d0d 0a20 2020 2020 2020 2020  unt"]..         
+0002f710: 2020 2020 2020 2020 2020 2066 6f72 206b             for k
+0002f720: 2069 6e20 226e 6577 222c 2022 7570 6461   in "new", "upda
+0002f730: 7465 6422 3a0d 0a20 2020 2020 2020 2020  ted":..         
+0002f740: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0002f750: 6620 7265 7375 6c74 2e67 6574 286b 293a  f result.get(k):
+0002f760: 2063 6c61 6265 6c20 2b3d 2022 2c20 2573   clabel += ", %s
+0002f770: 2025 7322 2025 2028 7265 7375 6c74 5b6b   %s" % (result[k
+0002f780: 5d2c 206b 290d 0a20 2020 2020 2020 2020  ], k)..         
+0002f790: 2020 2020 2020 2020 2020 2070 6c61 6265             plabe
+0002f7a0: 6c20 2b3d 2063 6c61 6265 6c20 2b20 222e  l += clabel + ".
+0002f7b0: 220d 0a20 2020 2020 2020 2020 2020 2020  "..             
+0002f7c0: 2020 2065 6c69 6620 7265 7375 6c74 2e67     elif result.g
+0002f7d0: 6574 2822 7374 6172 7422 2920 616e 6420  et("start") and 
+0002f7e0: 2263 6861 7473 2220 3d3d 2072 6573 756c  "chats" == resul
+0002f7f0: 745b 2274 6162 6c65 225d 2061 6e64 2022  t["table"] and "
+0002f800: 6369 6465 6e74 6974 7922 2069 6e20 7265  cidentity" in re
+0002f810: 7375 6c74 3a0d 0a20 2020 2020 2020 2020  sult:..         
+0002f820: 2020 2020 2020 2020 2020 2070 6c61 6265             plabe
+0002f830: 6c20 3d20 736c 6162 656c 203d 2022 5379  l = slabel = "Sy
+0002f840: 6e63 6872 6f6e 697a 696e 6720 6d65 7373  nchronizing mess
+0002f850: 6167 6573 2e2e 220d 0a0d 0a20 2020 2020  ages.."....     
+0002f860: 2020 2020 2020 2020 2020 2069 6620 7265             if re
+0002f870: 7375 6c74 2e67 6574 2822 656e 6422 293a  sult.get("end"):
+0002f880: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0002f890: 2020 2020 2020 736c 6162 656c 203d 2022        slabel = "
+0002f8a0: 5379 6e63 6872 6f6e 697a 6564 2025 7322  Synchronized %s"
+0002f8b0: 2025 2074 6c61 6265 6c0d 0a0d 0a20 2020   % tlabel....   
 0002f8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f8d0: 2020 2020 2020 2075 7469 6c2e 706c 7572         util.plur
-0002f8e0: 616c 2822 6368 6174 222c 2072 6573 756c  al("chat", resul
-0002f8f0: 745b 2263 6f75 6e74 225d 2c20 7365 703d  t["count"], sep=
-0002f900: 222c 2229 2069 6620 7265 7375 6c74 5b22  ",") if result["
-0002f910: 636f 756e 7422 5d20 656c 7365 2022 6368  count"] else "ch
-0002f920: 6174 7322 2c0d 0a20 2020 2020 2020 2020  ats",..         
+0002f8d0: 2069 6620 2261 6363 6f75 6e74 7322 203d   if "accounts" =
+0002f8e0: 3d20 7265 7375 6c74 5b22 7461 626c 6522  = result["table"
+0002f8f0: 5d3a 0d0a 2020 2020 2020 2020 2020 2020  ]:..            
+0002f900: 2020 2020 2020 2020 2020 2020 6966 2072              if r
+0002f910: 6573 756c 745b 2269 6465 6e74 6974 6965  esult["identitie
+0002f920: 7322 5d3a 0d0a 2020 2020 2020 2020 2020  s"]:..          
 0002f930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f940: 2020 2022 2028 2573 206e 6577 2922 2025     " (%s new)" %
-0002f950: 2072 6573 756c 745b 226e 6577 225d 2069   result["new"] i
-0002f960: 6620 7265 7375 6c74 5b22 6e65 7722 5d20  f result["new"] 
-0002f970: 656c 7365 2022 220d 0a20 2020 2020 2020  else ""..       
-0002f980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f990: 2029 0d0a 2020 2020 2020 2020 2020 2020   )..            
-0002f9a0: 2020 2020 2020 2020 2020 2020 6966 2022              if "
-0002f9b0: 6d65 7373 6167 655f 636f 756e 745f 6e65  message_count_ne
-0002f9c0: 7722 2069 6e20 7265 7375 6c74 3a20 736c  w" in result: sl
-0002f9d0: 6162 656c 202b 3d20 223a 2025 7320 696e  abel += ": %s in
-0002f9e0: 2074 6f74 616c 2573 2e22 2025 2028 0d0a   total%s." % (..
-0002f9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002fa00: 2020 2020 2020 2020 2020 2020 7574 696c              util
-0002fa10: 2e70 6c75 7261 6c28 226e 6577 206d 6573  .plural("new mes
-0002fa20: 7361 6765 222c 2072 6573 756c 745b 226d  sage", result["m
-0002fa30: 6573 7361 6765 5f63 6f75 6e74 5f6e 6577  essage_count_new
-0002fa40: 225d 2c20 7365 703d 222c 2229 2c0d 0a20  "], sep=","),.. 
-0002fa50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002fa60: 2020 2020 2020 2020 2020 2022 2c20 2573             ", %s
-0002fa70: 2075 7064 6174 6564 2220 2520 7265 7375   updated" % resu
-0002fa80: 6c74 5b22 6d65 7373 6167 655f 636f 756e  lt["message_coun
-0002fa90: 745f 7570 6461 7465 6422 5d20 6966 2072  t_updated"] if r
-0002faa0: 6573 756c 745b 226d 6573 7361 6765 5f63  esult["message_c
-0002fab0: 6f75 6e74 5f75 7064 6174 6564 225d 2065  ount_updated"] e
-0002fac0: 6c73 6520 2222 0d0a 2020 2020 2020 2020  lse ""..        
-0002fad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002fae0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0002faf0: 2020 2020 2020 2020 2020 2069 6620 7265             if re
-0002fb00: 7375 6c74 5b22 636f 6e74 6163 745f 636f  sult["contact_co
-0002fb10: 756e 745f 6e65 7722 5d20 6f72 2072 6573  unt_new"] or res
-0002fb20: 756c 745b 2263 6f6e 7461 6374 5f63 6f75  ult["contact_cou
-0002fb30: 6e74 5f75 7064 6174 6564 225d 3a0d 0a20  nt_updated"]:.. 
-0002fb40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002fb50: 2020 2020 2020 2020 2020 2073 6c61 6265             slabe
-0002fb60: 6c20 2b3d 2022 5c6e 2573 2e22 2025 2022  l += "\n%s." % "
-0002fb70: 2c20 222e 6a6f 696e 2866 696c 7465 7228  , ".join(filter(
-0002fb80: 626f 6f6c 2c20 5b0d 0a20 2020 2020 2020  bool, [..       
-0002fb90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002fba0: 2020 2020 2020 2020 2075 7469 6c2e 706c           util.pl
-0002fbb0: 7572 616c 2822 6e65 7720 636f 6e74 6163  ural("new contac
-0002fbc0: 7422 2c20 7265 7375 6c74 5b22 636f 6e74  t", result["cont
-0002fbd0: 6163 745f 636f 756e 745f 6e65 7722 5d2c  act_count_new"],
-0002fbe0: 2073 6570 3d22 2c22 290d 0a20 2020 2020   sep=",")..     
-0002fbf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002fc00: 2020 2020 2020 2020 2020 2069 6620 7265             if re
-0002fc10: 7375 6c74 5b22 636f 6e74 6163 745f 636f  sult["contact_co
-0002fc20: 756e 745f 6e65 7722 5d20 656c 7365 2022  unt_new"] else "
-0002fc30: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
-0002fc40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002fc50: 2020 2020 7574 696c 2e70 6c75 7261 6c28      util.plural(
-0002fc60: 2263 6f6e 7461 6374 222c 2072 6573 756c  "contact", resul
-0002fc70: 745b 2263 6f6e 7461 6374 5f63 6f75 6e74  t["contact_count
-0002fc80: 5f75 7064 6174 6564 225d 2c20 7365 703d  _updated"], sep=
-0002fc90: 222c 2229 202b 2022 2075 7064 6174 6564  ",") + " updated
+0002f940: 2020 7265 6c6f 6164 732e 7570 6461 7465    reloads.update
+0002f950: 2861 6363 6f75 6e74 733d 5472 7565 2c20  (accounts=True, 
+0002f960: 636f 6e74 6163 7473 3d4e 6f6e 6529 0d0a  contacts=None)..
+0002f970: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0002f980: 2020 2020 2020 6966 2022 636f 6e74 6163        if "contac
+0002f990: 7473 2220 3d3d 2072 6573 756c 745b 2274  ts" == result["t
+0002f9a0: 6162 6c65 225d 3a0d 0a20 2020 2020 2020  able"]:..       
+0002f9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f9c0: 2069 6620 7265 7375 6c74 5b22 6964 656e   if result["iden
+0002f9d0: 7469 7469 6573 225d 3a0d 0a20 2020 2020  tities"]:..     
+0002f9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f9f0: 2020 2020 2020 2072 656c 6f61 6473 2e75         reloads.u
+0002fa00: 7064 6174 6528 636f 6e74 6163 7473 3d72  pdate(contacts=r
+0002fa10: 6573 756c 745b 2269 6465 6e74 6974 6965  esult["identitie
+0002fa20: 7322 5d29 0d0a 0d0a 2020 2020 2020 2020  s"])....        
+0002fa30: 2020 2020 2020 2020 2020 2020 6966 2022              if "
+0002fa40: 6368 6174 7322 203d 3d20 7265 7375 6c74  chats" == result
+0002fa50: 5b22 7461 626c 6522 5d3a 0d0a 2020 2020  ["table"]:..    
+0002fa60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002fa70: 2020 2020 736c 6162 656c 203d 2022 5379      slabel = "Sy
+0002fa80: 6e63 6872 6f6e 697a 6564 2025 7325 7322  nchronized %s%s"
+0002fa90: 2025 2028 0d0a 2020 2020 2020 2020 2020   % (..          
+0002faa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002fab0: 2020 7574 696c 2e70 6c75 7261 6c28 2263    util.plural("c
+0002fac0: 6861 7422 2c20 7265 7375 6c74 5b22 636f  hat", result["co
+0002fad0: 756e 7422 5d2c 2073 6570 3d22 2c22 2920  unt"], sep=",") 
+0002fae0: 6966 2072 6573 756c 745b 2263 6f75 6e74  if result["count
+0002faf0: 225d 2065 6c73 6520 2263 6861 7473 222c  "] else "chats",
+0002fb00: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0002fb10: 2020 2020 2020 2020 2020 2020 2020 2220                " 
+0002fb20: 2825 7320 6e65 7729 2220 2520 7265 7375  (%s new)" % resu
+0002fb30: 6c74 5b22 6e65 7722 5d20 6966 2072 6573  lt["new"] if res
+0002fb40: 756c 745b 226e 6577 225d 2065 6c73 6520  ult["new"] else 
+0002fb50: 2222 0d0a 2020 2020 2020 2020 2020 2020  ""..            
+0002fb60: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
+0002fb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002fb80: 2020 2020 2020 2069 6620 226d 6573 7361         if "messa
+0002fb90: 6765 5f63 6f75 6e74 5f6e 6577 2220 696e  ge_count_new" in
+0002fba0: 2072 6573 756c 743a 2073 6c61 6265 6c20   result: slabel 
+0002fbb0: 2b3d 2022 3a20 2573 2069 6e20 746f 7461  += ": %s in tota
+0002fbc0: 6c25 732e 2220 2520 280d 0a20 2020 2020  l%s." % (..     
+0002fbd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002fbe0: 2020 2020 2020 2075 7469 6c2e 706c 7572         util.plur
+0002fbf0: 616c 2822 6e65 7720 6d65 7373 6167 6522  al("new message"
+0002fc00: 2c20 7265 7375 6c74 5b22 6d65 7373 6167  , result["messag
+0002fc10: 655f 636f 756e 745f 6e65 7722 5d2c 2073  e_count_new"], s
+0002fc20: 6570 3d22 2c22 292c 0d0a 2020 2020 2020  ep=","),..      
+0002fc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002fc40: 2020 2020 2020 222c 2025 7320 7570 6461        ", %s upda
+0002fc50: 7465 6422 2025 2072 6573 756c 745b 226d  ted" % result["m
+0002fc60: 6573 7361 6765 5f63 6f75 6e74 5f75 7064  essage_count_upd
+0002fc70: 6174 6564 225d 2069 6620 7265 7375 6c74  ated"] if result
+0002fc80: 5b22 6d65 7373 6167 655f 636f 756e 745f  ["message_count_
+0002fc90: 7570 6461 7465 6422 5d20 656c 7365 2022  updated"] else "
 0002fca0: 220d 0a20 2020 2020 2020 2020 2020 2020  "..             
-0002fcb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002fcc0: 2020 2069 6620 7265 7375 6c74 5b22 636f     if result["co
-0002fcd0: 6e74 6163 745f 636f 756e 745f 7570 6461  ntact_count_upda
-0002fce0: 7465 6422 5d20 656c 7365 2022 222c 0d0a  ted"] else "",..
-0002fcf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002fd00: 2020 2020 2020 2020 2020 2020 5d29 290d              ])).
-0002fd10: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
-0002fd20: 2020 2020 2020 2020 2020 2069 6620 226d             if "m
-0002fd30: 6573 7361 6765 5f63 6f75 6e74 5f6e 6577  essage_count_new
-0002fd40: 2220 6e6f 7420 696e 2072 6573 756c 743a  " not in result:
-0002fd50: 2023 204d 6573 7361 6765 2073 796e 6320   # Message sync 
-0002fd60: 6973 2061 6c72 6561 6479 2068 616e 646c  is already handl
-0002fd70: 6564 2062 7920 6e6f 770d 0a20 2020 2020  ed by now..     
-0002fd80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002fd90: 2020 2020 2020 2063 6861 7473 203d 205b         chats = [
-0002fda0: 6320 666f 7220 6320 696e 2073 656c 662e  c for c in self.
-0002fdb0: 6368 6174 7320 6966 2063 5b22 6964 656e  chats if c["iden
-0002fdc0: 7469 7479 225d 2069 6e20 7265 7375 6c74  tity"] in result
-0002fdd0: 5b22 6964 656e 7469 7469 6573 225d 5d0d  ["identities"]].
-0002fde0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002fdf0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-0002fe00: 7461 6374 7320 3d20 6c69 7374 2873 6574  tacts = list(set
-0002fe10: 2870 5b22 6964 656e 7469 7479 225d 2066  (p["identity"] f
-0002fe20: 6f72 2063 2069 6e20 6368 6174 7320 666f  or c in chats fo
-0002fe30: 7220 7020 696e 2063 5b22 7061 7274 6963  r p in c["partic
-0002fe40: 6970 616e 7473 225d 2929 0d0a 2020 2020  ipants"]))..    
-0002fe50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002fe60: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-0002fe70: 6462 2e69 6420 696e 2063 6f6e 7461 6374  db.id in contact
-0002fe80: 733a 2063 6f6e 7461 6374 732e 7265 6d6f  s: contacts.remo
-0002fe90: 7665 2873 656c 662e 6462 2e69 6429 0d0a  ve(self.db.id)..
-0002fea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002feb0: 2020 2020 2020 2020 2020 2020 6966 2063              if c
-0002fec0: 6861 7473 3a0d 0a20 2020 2020 2020 2020  hats:..         
+0002fcb0: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
+0002fcc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002fcd0: 2020 2020 2020 6966 2072 6573 756c 745b        if result[
+0002fce0: 2263 6f6e 7461 6374 5f63 6f75 6e74 5f6e  "contact_count_n
+0002fcf0: 6577 225d 206f 7220 7265 7375 6c74 5b22  ew"] or result["
+0002fd00: 636f 6e74 6163 745f 636f 756e 745f 7570  contact_count_up
+0002fd10: 6461 7465 6422 5d3a 0d0a 2020 2020 2020  dated"]:..      
+0002fd20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002fd30: 2020 2020 2020 736c 6162 656c 202b 3d20        slabel += 
+0002fd40: 225c 6e25 732e 2220 2520 222c 2022 2e6a  "\n%s." % ", ".j
+0002fd50: 6f69 6e28 6669 6c74 6572 2862 6f6f 6c2c  oin(filter(bool,
+0002fd60: 205b 0d0a 2020 2020 2020 2020 2020 2020   [..            
+0002fd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002fd80: 2020 2020 7574 696c 2e70 6c75 7261 6c28      util.plural(
+0002fd90: 226e 6577 2063 6f6e 7461 6374 222c 2072  "new contact", r
+0002fda0: 6573 756c 745b 2263 6f6e 7461 6374 5f63  esult["contact_c
+0002fdb0: 6f75 6e74 5f6e 6577 225d 2c20 7365 703d  ount_new"], sep=
+0002fdc0: 222c 2229 0d0a 2020 2020 2020 2020 2020  ",")..          
+0002fdd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002fde0: 2020 2020 2020 6966 2072 6573 756c 745b        if result[
+0002fdf0: 2263 6f6e 7461 6374 5f63 6f75 6e74 5f6e  "contact_count_n
+0002fe00: 6577 225d 2065 6c73 6520 2222 2c0d 0a20  ew"] else "",.. 
+0002fe10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002fe20: 2020 2020 2020 2020 2020 2020 2020 2075                 u
+0002fe30: 7469 6c2e 706c 7572 616c 2822 636f 6e74  til.plural("cont
+0002fe40: 6163 7422 2c20 7265 7375 6c74 5b22 636f  act", result["co
+0002fe50: 6e74 6163 745f 636f 756e 745f 7570 6461  ntact_count_upda
+0002fe60: 7465 6422 5d2c 2073 6570 3d22 2c22 2920  ted"], sep=",") 
+0002fe70: 2b20 2220 7570 6461 7465 6422 0d0a 2020  + " updated"..  
+0002fe80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002fe90: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0002fea0: 2072 6573 756c 745b 2263 6f6e 7461 6374   result["contact
+0002feb0: 5f63 6f75 6e74 5f75 7064 6174 6564 225d  _count_updated"]
+0002fec0: 2065 6c73 6520 2222 2c0d 0a20 2020 2020   else "",..     
 0002fed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002fee0: 2020 2020 2020 2072 656c 6f61 6473 2e75         reloads.u
-0002fef0: 7064 6174 6528 6163 636f 756e 7473 3d54  pdate(accounts=T
-0002ff00: 7275 652c 2063 6861 7473 3d72 6573 756c  rue, chats=resul
-0002ff10: 745b 2269 6465 6e74 6974 6965 7322 5d29  t["identities"])
-0002ff20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0002ff30: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0002ff40: 2063 6f6e 7461 6374 733a 0d0a 2020 2020   contacts:..    
-0002ff50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ff60: 2020 2020 2020 2020 2020 2020 7265 6c6f              relo
-0002ff70: 6164 732e 7570 6461 7465 2861 6363 6f75  ads.update(accou
-0002ff80: 6e74 733d 5472 7565 2c20 636f 6e74 6163  nts=True, contac
-0002ff90: 7473 3d63 6f6e 7461 6374 7329 0d0a 0d0a  ts=contacts)....
-0002ffa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ffb0: 2020 2020 6966 2022 6d65 7373 6167 6573      if "messages
-0002ffc0: 2220 3d3d 2072 6573 756c 745b 2274 6162  " == result["tab
-0002ffd0: 6c65 225d 3a0d 0a20 2020 2020 2020 2020  le"]:..         
-0002ffe0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0002fff0: 6c61 6265 6c20 2b3d 2022 2069 6e20 2573  label += " in %s
-00030000: 2220 2520 2863 6861 745b 2274 6974 6c65  " % (chat["title
-00030010: 5f6c 6f6e 675f 6c63 225d 2069 6620 6368  _long_lc"] if ch
-00030020: 6174 2065 6c73 6520 7265 7375 6c74 5b22  at else result["
-00030030: 6368 6174 225d 290d 0a0d 0a20 2020 2020  chat"])....     
-00030040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030050: 2020 2069 6620 6368 6174 2061 6e64 2028     if chat and (
-00030060: 7265 7375 6c74 2e67 6574 2822 6e65 7722  result.get("new"
-00030070: 2920 6f72 2072 6573 756c 742e 6765 7428  ) or result.get(
-00030080: 2275 7064 6174 6564 2229 293a 0d0a 2020  "updated")):..  
-00030090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000300a0: 2020 2020 2020 2020 2020 726f 7720 3d20            row = 
-000300b0: 6469 6374 2874 6974 6c65 3d63 6861 745b  dict(title=chat[
-000300c0: 2274 6974 6c65 225d 2c20 6964 656e 7469  "title"], identi
-000300d0: 7479 3d63 6861 745b 2269 6465 6e74 6974  ty=chat["identit
-000300e0: 7922 5d2c 0d0a 2020 2020 2020 2020 2020  y"],..          
-000300f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030100: 2020 2020 2020 2020 2020 2020 2066 6972               fir
-00030110: 7374 5f6d 6573 7361 6765 5f64 6174 6574  st_message_datet
-00030120: 696d 653d 7265 7375 6c74 5b22 6669 7273  ime=result["firs
-00030130: 7422 5d2c 0d0a 2020 2020 2020 2020 2020  t"],..          
-00030140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030150: 2020 2020 2020 2020 2020 2020 206c 6173               las
-00030160: 745f 6d65 7373 6167 655f 6461 7465 7469  t_message_dateti
-00030170: 6d65 3d72 6573 756c 745b 226c 6173 7422  me=result["last"
-00030180: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
-00030190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000301a0: 2020 2020 2020 2020 2020 206d 6573 7361             messa
-000301b0: 6765 5f63 6f75 6e74 3d72 6573 756c 745b  ge_count=result[
-000301c0: 226e 6577 225d 202b 2072 6573 756c 745b  "new"] + result[
-000301d0: 2275 7064 6174 6564 225d 290d 0a20 2020  "updated"])..   
-000301e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000301f0: 2020 2020 2020 2020 2073 656c 662e 6c69           self.li
-00030200: 7374 5f63 6861 7473 5f73 796e 632e 4170  st_chats_sync.Ap
-00030210: 7065 6e64 526f 7728 726f 7729 0d0a 2020  pendRow(row)..  
-00030220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030230: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
-00030240: 6973 745f 6368 6174 735f 7379 6e63 2e52  ist_chats_sync.R
-00030250: 6573 6574 436f 6c75 6d6e 5769 6474 6873  esetColumnWidths
-00030260: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+0002fee0: 2020 2020 2020 205d 2929 0d0a 0d0a 2020         ]))....  
+0002fef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ff00: 2020 2020 2020 6966 2022 6d65 7373 6167        if "messag
+0002ff10: 655f 636f 756e 745f 6e65 7722 206e 6f74  e_count_new" not
+0002ff20: 2069 6e20 7265 7375 6c74 3a20 2320 4d65   in result: # Me
+0002ff30: 7373 6167 6520 7379 6e63 2069 7320 616c  ssage sync is al
+0002ff40: 7265 6164 7920 6861 6e64 6c65 6420 6279  ready handled by
+0002ff50: 206e 6f77 0d0a 2020 2020 2020 2020 2020   now..          
+0002ff60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ff70: 2020 6368 6174 7320 3d20 5b63 2066 6f72    chats = [c for
+0002ff80: 2063 2069 6e20 7365 6c66 2e63 6861 7473   c in self.chats
+0002ff90: 2069 6620 635b 2269 6465 6e74 6974 7922   if c["identity"
+0002ffa0: 5d20 696e 2072 6573 756c 745b 2269 6465  ] in result["ide
+0002ffb0: 6e74 6974 6965 7322 5d5d 0d0a 2020 2020  ntities"]]..    
+0002ffc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ffd0: 2020 2020 2020 2020 636f 6e74 6163 7473          contacts
+0002ffe0: 203d 206c 6973 7428 7365 7428 705b 2269   = list(set(p["i
+0002fff0: 6465 6e74 6974 7922 5d20 666f 7220 6320  dentity"] for c 
+00030000: 696e 2063 6861 7473 2066 6f72 2070 2069  in chats for p i
+00030010: 6e20 635b 2270 6172 7469 6369 7061 6e74  n c["participant
+00030020: 7322 5d29 290d 0a20 2020 2020 2020 2020  s"]))..         
+00030030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030040: 2020 2069 6620 7365 6c66 2e64 622e 6964     if self.db.id
+00030050: 2069 6e20 636f 6e74 6163 7473 3a20 636f   in contacts: co
+00030060: 6e74 6163 7473 2e72 656d 6f76 6528 7365  ntacts.remove(se
+00030070: 6c66 2e64 622e 6964 290d 0a20 2020 2020  lf.db.id)..     
+00030080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030090: 2020 2020 2020 2069 6620 6368 6174 733a         if chats:
+000300a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000300b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000300c0: 2020 7265 6c6f 6164 732e 7570 6461 7465    reloads.update
+000300d0: 2861 6363 6f75 6e74 733d 5472 7565 2c20  (accounts=True, 
+000300e0: 6368 6174 733d 7265 7375 6c74 5b22 6964  chats=result["id
+000300f0: 656e 7469 7469 6573 225d 290d 0a20 2020  entities"])..   
+00030100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030110: 2020 2020 2020 2020 2069 6620 636f 6e74           if cont
+00030120: 6163 7473 3a0d 0a20 2020 2020 2020 2020  acts:..         
+00030130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030140: 2020 2020 2020 2072 656c 6f61 6473 2e75         reloads.u
+00030150: 7064 6174 6528 6163 636f 756e 7473 3d54  pdate(accounts=T
+00030160: 7275 652c 2063 6f6e 7461 6374 733d 636f  rue, contacts=co
+00030170: 6e74 6163 7473 290d 0a0d 0a20 2020 2020  ntacts)....     
+00030180: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00030190: 6620 226d 6573 7361 6765 7322 203d 3d20  f "messages" == 
+000301a0: 7265 7375 6c74 5b22 7461 626c 6522 5d3a  result["table"]:
+000301b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000301c0: 2020 2020 2020 2020 2020 736c 6162 656c            slabel
+000301d0: 202b 3d20 2220 696e 2025 7322 2025 2028   += " in %s" % (
+000301e0: 6368 6174 5b22 7469 746c 655f 6c6f 6e67  chat["title_long
+000301f0: 5f6c 6322 5d20 6966 2063 6861 7420 656c  _lc"] if chat el
+00030200: 7365 2072 6573 756c 745b 2263 6861 7422  se result["chat"
+00030210: 5d29 0d0a 0d0a 2020 2020 2020 2020 2020  ])....          
+00030220: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00030230: 2063 6861 7420 616e 6420 2872 6573 756c   chat and (resul
+00030240: 742e 6765 7428 226e 6577 2229 206f 7220  t.get("new") or 
+00030250: 7265 7375 6c74 2e67 6574 2822 7570 6461  result.get("upda
+00030260: 7465 6422 2929 3a0d 0a20 2020 2020 2020  ted")):..       
 00030270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030280: 6368 6174 5b22 6d65 7373 6167 655f 636f  chat["message_co
-00030290: 756e 7422 205d 203d 2028 6368 6174 5b22  unt" ] = (chat["
-000302a0: 6d65 7373 6167 655f 636f 756e 7422 5d20  message_count"] 
-000302b0: 6f72 2030 2920 2b20 7265 7375 6c74 5b22  or 0) + result["
-000302c0: 6e65 7722 5d0d 0a20 2020 2020 2020 2020  new"]..         
+00030280: 2020 2020 2072 6f77 203d 2064 6963 7428       row = dict(
+00030290: 7469 746c 653d 6368 6174 5b22 7469 746c  title=chat["titl
+000302a0: 6522 5d2c 2069 6465 6e74 6974 793d 6368  e"], identity=ch
+000302b0: 6174 5b22 6964 656e 7469 7479 225d 2c0d  at["identity"],.
+000302c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 000302d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000302e0: 2020 2063 6861 745b 2266 6972 7374 5f6d     chat["first_m
-000302f0: 6573 7361 6765 5f64 6174 6574 696d 6522  essage_datetime"
-00030300: 5d20 3d20 6d69 6e28 6368 6174 5b22 6669  ] = min(chat["fi
-00030310: 7273 745f 6d65 7373 6167 655f 6461 7465  rst_message_date
-00030320: 7469 6d65 225d 206f 7220 7265 7375 6c74  time"] or result
-00030330: 5b22 6669 7273 7422 5d2c 2072 6573 756c  ["first"], resul
-00030340: 745b 2266 6972 7374 225d 290d 0a20 2020  t["first"])..   
-00030350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030360: 2020 2020 2020 2020 2063 6861 745b 226c           chat["l
-00030370: 6173 745f 6d65 7373 6167 655f 6461 7465  ast_message_date
-00030380: 7469 6d65 225d 2020 3d20 6d61 7828 6368  time"]  = max(ch
-00030390: 6174 5b22 6c61 7374 5f6d 6573 7361 6765  at["last_message
-000303a0: 5f64 6174 6574 696d 6522 5d20 206f 7220  _datetime"]  or 
-000303b0: 7265 7375 6c74 5b22 6669 7273 7422 5d2c  result["first"],
-000303c0: 2072 6573 756c 745b 226c 6173 7422 5d29   result["last"])
-000303d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000303e0: 2020 2020 2020 2020 2020 2020 2020 6368                ch
-000303f0: 6174 5b22 6c61 7374 5f61 6374 6976 6974  at["last_activit
-00030400: 795f 6461 7465 7469 6d65 225d 203d 206d  y_datetime"] = m
-00030410: 6178 2863 6861 745b 226c 6173 745f 6163  ax(chat["last_ac
-00030420: 7469 7669 7479 5f64 6174 6574 696d 6522  tivity_datetime"
-00030430: 5d20 6f72 2072 6573 756c 745b 226c 6173  ] or result["las
-00030440: 7422 5d2c 2020 7265 7375 6c74 5b22 6c61  t"],  result["la
-00030450: 7374 225d 290d 0a20 2020 2020 2020 2020  st"])..         
-00030460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030470: 2020 2066 6f72 206b 2069 6e20 2266 6972     for k in "fir
-00030480: 7374 5f6d 6573 7361 6765 222c 2022 6c61  st_message", "la
-00030490: 7374 5f6d 6573 7361 6765 222c 2022 6c61  st_message", "la
-000304a0: 7374 5f61 6374 6976 6974 7922 3a0d 0a20  st_activity":.. 
-000304b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000304c0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-000304d0: 6861 745b 6b20 2b20 225f 7469 6d65 7374  hat[k + "_timest
-000304e0: 616d 7022 5d20 3d20 7574 696c 2e64 6174  amp"] = util.dat
-000304f0: 6574 696d 655f 746f 5f65 706f 6368 2863  etime_to_epoch(c
-00030500: 6861 745b 6b20 2b20 225f 6461 7465 7469  hat[k + "_dateti
-00030510: 6d65 225d 290d 0a0d 0a20 2020 2020 2020  me"])....       
-00030520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030530: 2020 2020 2063 6f6e 7461 6374 7320 3d20       contacts = 
-00030540: 5b78 5b22 6964 656e 7469 7479 225d 2066  [x["identity"] f
-00030550: 6f72 2078 2069 6e20 6368 6174 5b22 7061  or x in chat["pa
-00030560: 7274 6963 6970 616e 7473 225d 5d0d 0a20  rticipants"]].. 
-00030570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030580: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-00030590: 6c66 2e64 622e 6964 2069 6e20 636f 6e74  lf.db.id in cont
-000305a0: 6163 7473 3a20 636f 6e74 6163 7473 2e72  acts: contacts.r
-000305b0: 656d 6f76 6528 7365 6c66 2e64 622e 6964  emove(self.db.id
-000305c0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-000305d0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000305e0: 656c 6f61 6473 2e75 7064 6174 6528 6163  eloads.update(ac
-000305f0: 636f 756e 7473 3d54 7275 652c 2063 6861  counts=True, cha
-00030600: 7473 3d5b 6368 6174 5b22 6964 656e 7469  ts=[chat["identi
-00030610: 7479 225d 5d2c 2063 6f6e 7461 6374 733d  ty"]], contacts=
-00030620: 636f 6e74 6163 7473 290d 0a0d 0a20 2020  contacts)....   
-00030630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030640: 2020 2020 2069 6620 6e6f 7420 616e 7928       if not any(
-00030650: 7265 7375 6c74 5b6b 5d20 666f 7220 6b20  result[k] for k 
-00030660: 696e 2028 226e 6577 222c 2022 7570 6461  in ("new", "upda
-00030670: 7465 6422 2929 3a0d 0a20 2020 2020 2020  ted")):..       
-00030680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030690: 2020 2020 2073 6c61 6265 6c20 3d20 4e6f       slabel = No
-000306a0: 6e65 0d0a 2020 2020 2020 2020 2020 2020  ne..            
-000306b0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-000306c0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-000306d0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000306e0: 6c61 6265 6c20 2b3d 2022 3a20 2573 206e  label += ": %s n
-000306f0: 6577 2220 2520 7265 7375 6c74 5b22 6e65  ew" % result["ne
-00030700: 7722 5d0d 0a20 2020 2020 2020 2020 2020  w"]..           
-00030710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030720: 2069 6620 7265 7375 6c74 5b22 7570 6461   if result["upda
-00030730: 7465 6422 5d3a 2073 6c61 6265 6c20 2b3d  ted"]: slabel +=
-00030740: 2022 2c20 2573 2075 7064 6174 6564 2220   ", %s updated" 
-00030750: 2520 7265 7375 6c74 5b22 7570 6461 7465  % result["update
-00030760: 6422 5d0d 0a20 2020 2020 2020 2020 2020  d"]..           
-00030770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030780: 2073 6c61 6265 6c20 2b3d 2022 2e22 0d0a   slabel += "."..
-00030790: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000307a0: 2020 2020 2020 6966 2073 6c61 6265 6c20        if slabel 
-000307b0: 616e 6420 6e6f 7420 736c 6162 656c 2e65  and not slabel.e
-000307c0: 6e64 7377 6974 6828 222e 2229 3a20 736c  ndswith("."): sl
-000307d0: 6162 656c 202b 3d20 222e 220d 0a0d 0a20  abel += ".".... 
-000307e0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-000307f0: 6c69 6620 6e6f 7420 7265 7375 6c74 2e67  lif not result.g
-00030800: 6574 2822 7374 6172 7422 293a 0d0a 2020  et("start"):..  
+000302e0: 2020 2020 2020 2020 6669 7273 745f 6d65          first_me
+000302f0: 7373 6167 655f 6461 7465 7469 6d65 3d72  ssage_datetime=r
+00030300: 6573 756c 745b 2266 6972 7374 225d 2c0d  esult["first"],.
+00030310: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00030320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030330: 2020 2020 2020 2020 6c61 7374 5f6d 6573          last_mes
+00030340: 7361 6765 5f64 6174 6574 696d 653d 7265  sage_datetime=re
+00030350: 7375 6c74 5b22 6c61 7374 225d 2c0d 0a20  sult["last"],.. 
+00030360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030380: 2020 2020 2020 6d65 7373 6167 655f 636f        message_co
+00030390: 756e 743d 7265 7375 6c74 5b22 6e65 7722  unt=result["new"
+000303a0: 5d20 2b20 7265 7375 6c74 5b22 7570 6461  ] + result["upda
+000303b0: 7465 6422 5d29 0d0a 2020 2020 2020 2020  ted"])..        
+000303c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000303d0: 2020 2020 7365 6c66 2e6c 6973 745f 6368      self.list_ch
+000303e0: 6174 735f 7379 6e63 2e41 7070 656e 6452  ats_sync.AppendR
+000303f0: 6f77 2872 6f77 290d 0a20 2020 2020 2020  ow(row)..       
+00030400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030410: 2020 2020 2073 656c 662e 6c69 7374 5f63       self.list_c
+00030420: 6861 7473 5f73 796e 632e 5265 7365 7443  hats_sync.ResetC
+00030430: 6f6c 756d 6e57 6964 7468 7328 290d 0a20  olumnWidths().. 
+00030440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030450: 2020 2020 2020 2020 2020 2063 6861 745b             chat[
+00030460: 226d 6573 7361 6765 5f63 6f75 6e74 2220  "message_count" 
+00030470: 5d20 3d20 2863 6861 745b 226d 6573 7361  ] = (chat["messa
+00030480: 6765 5f63 6f75 6e74 225d 206f 7220 3029  ge_count"] or 0)
+00030490: 202b 2072 6573 756c 745b 226e 6577 225d   + result["new"]
+000304a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000304b0: 2020 2020 2020 2020 2020 2020 2020 6368                ch
+000304c0: 6174 5b22 6669 7273 745f 6d65 7373 6167  at["first_messag
+000304d0: 655f 6461 7465 7469 6d65 225d 203d 206d  e_datetime"] = m
+000304e0: 696e 2863 6861 745b 2266 6972 7374 5f6d  in(chat["first_m
+000304f0: 6573 7361 6765 5f64 6174 6574 696d 6522  essage_datetime"
+00030500: 5d20 6f72 2072 6573 756c 745b 2266 6972  ] or result["fir
+00030510: 7374 225d 2c20 7265 7375 6c74 5b22 6669  st"], result["fi
+00030520: 7273 7422 5d29 0d0a 2020 2020 2020 2020  rst"])..        
+00030530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030540: 2020 2020 6368 6174 5b22 6c61 7374 5f6d      chat["last_m
+00030550: 6573 7361 6765 5f64 6174 6574 696d 6522  essage_datetime"
+00030560: 5d20 203d 206d 6178 2863 6861 745b 226c  ]  = max(chat["l
+00030570: 6173 745f 6d65 7373 6167 655f 6461 7465  ast_message_date
+00030580: 7469 6d65 225d 2020 6f72 2072 6573 756c  time"]  or resul
+00030590: 745b 2266 6972 7374 225d 2c20 7265 7375  t["first"], resu
+000305a0: 6c74 5b22 6c61 7374 225d 290d 0a20 2020  lt["last"])..   
+000305b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000305c0: 2020 2020 2020 2020 2063 6861 745b 226c           chat["l
+000305d0: 6173 745f 6163 7469 7669 7479 5f64 6174  ast_activity_dat
+000305e0: 6574 696d 6522 5d20 3d20 6d61 7828 6368  etime"] = max(ch
+000305f0: 6174 5b22 6c61 7374 5f61 6374 6976 6974  at["last_activit
+00030600: 795f 6461 7465 7469 6d65 225d 206f 7220  y_datetime"] or 
+00030610: 7265 7375 6c74 5b22 6c61 7374 225d 2c20  result["last"], 
+00030620: 2072 6573 756c 745b 226c 6173 7422 5d29   result["last"])
+00030630: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00030640: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+00030650: 7220 6b20 696e 2022 6669 7273 745f 6d65  r k in "first_me
+00030660: 7373 6167 6522 2c20 226c 6173 745f 6d65  ssage", "last_me
+00030670: 7373 6167 6522 2c20 226c 6173 745f 6163  ssage", "last_ac
+00030680: 7469 7669 7479 223a 0d0a 2020 2020 2020  tivity":..      
+00030690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000306a0: 2020 2020 2020 2020 2020 6368 6174 5b6b            chat[k
+000306b0: 202b 2022 5f74 696d 6573 7461 6d70 225d   + "_timestamp"]
+000306c0: 203d 2075 7469 6c2e 6461 7465 7469 6d65   = util.datetime
+000306d0: 5f74 6f5f 6570 6f63 6828 6368 6174 5b6b  _to_epoch(chat[k
+000306e0: 202b 2022 5f64 6174 6574 696d 6522 5d29   + "_datetime"])
+000306f0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+00030700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030710: 636f 6e74 6163 7473 203d 205b 785b 2269  contacts = [x["i
+00030720: 6465 6e74 6974 7922 5d20 666f 7220 7820  dentity"] for x 
+00030730: 696e 2063 6861 745b 2270 6172 7469 6369  in chat["partici
+00030740: 7061 6e74 7322 5d5d 0d0a 2020 2020 2020  pants"]]..      
+00030750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030760: 2020 2020 2020 6966 2073 656c 662e 6462        if self.db
+00030770: 2e69 6420 696e 2063 6f6e 7461 6374 733a  .id in contacts:
+00030780: 2063 6f6e 7461 6374 732e 7265 6d6f 7665   contacts.remove
+00030790: 2873 656c 662e 6462 2e69 6429 0d0a 2020  (self.db.id)..  
+000307a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000307b0: 2020 2020 2020 2020 2020 7265 6c6f 6164            reload
+000307c0: 732e 7570 6461 7465 2861 6363 6f75 6e74  s.update(account
+000307d0: 733d 5472 7565 2c20 6368 6174 733d 5b63  s=True, chats=[c
+000307e0: 6861 745b 2269 6465 6e74 6974 7922 5d5d  hat["identity"]]
+000307f0: 2c20 636f 6e74 6163 7473 3d63 6f6e 7461  , contacts=conta
+00030800: 6374 7329 0d0a 0d0a 2020 2020 2020 2020  cts)....        
 00030810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030820: 2020 6966 2022 6368 6174 7322 203d 3d20    if "chats" == 
-00030830: 7265 7375 6c74 5b22 7461 626c 6522 5d20  result["table"] 
-00030840: 616e 6420 7265 7375 6c74 2e67 6574 2822  and result.get("
-00030850: 6368 6174 2229 3a0d 0a20 2020 2020 2020  chat"):..       
+00030820: 6966 206e 6f74 2061 6e79 2872 6573 756c  if not any(resul
+00030830: 745b 6b5d 2066 6f72 206b 2069 6e20 2822  t[k] for k in ("
+00030840: 6e65 7722 2c20 2275 7064 6174 6564 2229  new", "updated")
+00030850: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
 00030860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030870: 2023 2055 7064 6174 6564 2063 6861 7420   # Updated chat 
-00030880: 6d65 7461 696e 666f 3a20 6c6f 6164 206e  metainfo: load n
-00030890: 6577 2063 6f6e 7461 6374 732c 2069 6620  ew contacts, if 
-000308a0: 616e 790d 0a20 2020 2020 2020 2020 2020  any..           
-000308b0: 2020 2020 2020 2020 2020 2020 2070 6c61               pla
-000308c0: 6265 6c20 3d20 2222 0d0a 2020 2020 2020  bel = ""..      
-000308d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000308e0: 2020 6966 2063 6861 743a 0d0a 2020 2020    if chat:..    
-000308f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030900: 2020 2020 2020 2020 6964 7320 3d20 5b78          ids = [x
-00030910: 5b22 6964 656e 7469 7479 225d 2066 6f72  ["identity"] for
-00030920: 2078 2069 6e20 6368 6174 5b22 7061 7274   x in chat["part
-00030930: 6963 6970 616e 7473 225d 5d0d 0a20 2020  icipants"]]..   
+00030870: 736c 6162 656c 203d 204e 6f6e 650d 0a20  slabel = None.. 
+00030880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030890: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+000308a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000308b0: 2020 2020 2020 2020 2020 736c 6162 656c            slabel
+000308c0: 202b 3d20 223a 2025 7320 6e65 7722 2025   += ": %s new" %
+000308d0: 2072 6573 756c 745b 226e 6577 225d 0d0a   result["new"]..
+000308e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000308f0: 2020 2020 2020 2020 2020 2020 6966 2072              if r
+00030900: 6573 756c 745b 2275 7064 6174 6564 225d  esult["updated"]
+00030910: 3a20 736c 6162 656c 202b 3d20 222c 2025  : slabel += ", %
+00030920: 7320 7570 6461 7465 6422 2025 2072 6573  s updated" % res
+00030930: 756c 745b 2275 7064 6174 6564 225d 0d0a  ult["updated"]..
 00030940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030950: 2020 2020 2020 2020 206e 6577 6964 7320           newids 
-00030960: 3d20 7365 7428 6964 7329 202d 2073 6574  = set(ids) - set
-00030970: 2878 5b22 6964 656e 7469 7479 225d 2066  (x["identity"] f
-00030980: 6f72 2078 2069 6e20 7365 6c66 2e63 6f6e  or x in self.con
-00030990: 7461 6374 7329 0d0a 2020 2020 2020 2020  tacts)..        
-000309a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000309b0: 2020 2020 6e65 7763 6f6e 7461 6374 7320      newcontacts 
-000309c0: 3d20 6c69 7374 2866 696c 7465 7228 626f  = list(filter(bo
-000309d0: 6f6c 2c20 6d61 7028 7365 6c66 2e64 622e  ol, map(self.db.
-000309e0: 6765 745f 636f 6e74 6163 742c 206e 6577  get_contact, new
-000309f0: 6964 7329 2929 0d0a 2020 2020 2020 2020  ids)))..        
-00030a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030a10: 2020 2020 6966 206e 6577 636f 6e74 6163      if newcontac
-00030a20: 7473 3a0d 0a20 2020 2020 2020 2020 2020  ts:..           
-00030a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030a40: 2020 2020 2073 656c 662e 636f 6e74 6163       self.contac
-00030a50: 7473 2e65 7874 656e 6428 6e65 7763 6f6e  ts.extend(newcon
-00030a60: 7461 6374 7329 0d0a 2020 2020 2020 2020  tacts)..        
-00030a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030a80: 2020 2020 2020 2020 7265 6c6f 6164 732e          reloads.
-00030a90: 7570 6461 7465 2863 6f6e 7461 6374 733d  update(contacts=
-00030aa0: 5b78 5b22 6964 656e 7469 7479 225d 2066  [x["identity"] f
-00030ab0: 6f72 2078 2069 6e20 6e65 7763 6f6e 7461  or x in newconta
-00030ac0: 6374 735d 290d 0a0d 0a20 2020 2020 2020  cts])....       
-00030ad0: 2020 2020 2020 2020 2069 6620 706c 6162           if plab
-00030ae0: 656c 3a0d 0a20 2020 2020 2020 2020 2020  el:..           
-00030af0: 2020 2020 2020 2020 2073 656c 662e 6c61           self.la
-00030b00: 6265 6c5f 7379 6e63 5f70 726f 6772 6573  bel_sync_progres
-00030b10: 732e 4c61 6265 6c20 3d20 706c 6162 656c  s.Label = plabel
-00030b20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00030b30: 2020 6966 2073 6c61 6265 6c3a 0d0a 2020    if slabel:..  
-00030b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030b50: 2020 7365 6c66 2e65 6469 745f 7379 6e63    self.edit_sync
-00030b60: 5f73 7461 7475 732e 5661 6c75 6520 2b3d  _status.Value +=
-00030b70: 2028 225c 6e5c 6e22 2069 6620 7365 6c66   ("\n\n" if self
-00030b80: 2e65 6469 745f 7379 6e63 5f73 7461 7475  .edit_sync_statu
-00030b90: 732e 5661 6c75 6520 656c 7365 2022 2229  s.Value else "")
-00030ba0: 202b 2073 6c61 6265 6c0d 0a20 2020 2020   + slabel..     
-00030bb0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00030bc0: 656c 662e 6564 6974 5f73 796e 635f 7374  elf.edit_sync_st
-00030bd0: 6174 7573 2e53 686f 7750 6f73 6974 696f  atus.ShowPositio
-00030be0: 6e28 7365 6c66 2e65 6469 745f 7379 6e63  n(self.edit_sync
-00030bf0: 5f73 7461 7475 732e 4c61 7374 506f 7369  _status.LastPosi
-00030c00: 7469 6f6e 290d 0a20 2020 2020 2020 2020  tion)..         
-00030c10: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
-00030c20: 722e 696e 666f 2873 6c61 6265 6c29 0d0a  r.info(slabel)..
-00030c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030c40: 7365 6c66 2e67 6175 6765 5f73 796e 632e  self.gauge_sync.
-00030c50: 436f 6e74 6169 6e69 6e67 5369 7a65 722e  ContainingSizer.
-00030c60: 4c61 796f 7574 2829 0d0a 0d0a 2020 2020  Layout()....    
-00030c70: 2020 2020 2020 2020 2020 2020 6465 6620              def 
-00030c80: 6166 7465 7232 2872 656c 6f61 6473 293a  after2(reloads):
-00030c90: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00030ca0: 2020 2020 2020 2222 2250 6f70 756c 6174        """Populat
-00030cb0: 6520 7374 6174 6973 7469 6373 2061 6e64  e statistics and
-00030cc0: 2072 656c 6f61 6420 7669 6577 732e 2222   reload views.""
-00030cd0: 220d 0a20 2020 2020 2020 2020 2020 2020  "..             
-00030ce0: 2020 2020 2020 2069 6620 6e6f 7420 7365         if not se
-00030cf0: 6c66 3a20 7265 7475 726e 0d0a 2020 2020  lf: return..    
-00030d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030d10: 636f 6e74 6163 7473 203d 205b 7365 6c66  contacts = [self
-00030d20: 2e64 622e 6163 636f 756e 745d 202b 2073  .db.account] + s
-00030d30: 656c 662e 636f 6e74 6163 7473 0d0a 2020  elf.contacts..  
-00030d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030d50: 2020 6966 2072 656c 6f61 6473 2e67 6574    if reloads.get
-00030d60: 2822 6163 636f 756e 7473 2229 3a0d 0a20  ("accounts"):.. 
-00030d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030d80: 2020 2020 2020 2073 656c 662e 6462 2e75         self.db.u
-00030d90: 7064 6174 655f 6163 636f 756e 7469 6e66  pdate_accountinf
-00030da0: 6f28 290d 0a20 2020 2020 2020 2020 2020  o()..           
-00030db0: 2020 2020 2020 2020 2069 6620 7265 6c6f           if relo
-00030dc0: 6164 732e 6765 7428 2263 6861 7473 2229  ads.get("chats")
-00030dd0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00030de0: 2020 2020 2020 2020 2020 206d 7963 6861             mycha
-00030df0: 7473 203d 2073 656c 662e 6462 2e67 6574  ts = self.db.get
-00030e00: 5f63 6f6e 7665 7273 6174 696f 6e73 2872  _conversations(r
-00030e10: 656c 6f61 643d 5472 7565 2c20 6c6f 673d  eload=True, log=
-00030e20: 4661 6c73 652c 0d0a 2020 2020 2020 2020  False,..        
-00030e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030e60: 2020 6368 6174 6964 656e 7469 7469 6573    chatidentities
-00030e70: 3d72 656c 6f61 6473 5b22 6368 6174 7322  =reloads["chats"
-00030e80: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
-00030e90: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00030ea0: 2e64 622e 6765 745f 636f 6e76 6572 7361  .db.get_conversa
-00030eb0: 7469 6f6e 735f 7374 6174 7328 6d79 6368  tions_stats(mych
-00030ec0: 6174 7329 0d0a 2020 2020 2020 2020 2020  ats)..          
-00030ed0: 2020 2020 2020 2020 2020 2020 2020 636d                cm
-00030ee0: 6170 203d 207b 635b 2269 6465 6e74 6974  ap = {c["identit
-00030ef0: 7922 5d3a 2063 2066 6f72 2063 2069 6e20  y"]: c for c in 
-00030f00: 6d79 6368 6174 737d 0d0a 2020 2020 2020  mychats}..      
-00030f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030f20: 2020 7365 6c66 2e63 6861 7473 203d 205b    self.chats = [
-00030f30: 636d 6170 2e70 6f70 2878 5b22 6964 656e  cmap.pop(x["iden
-00030f40: 7469 7479 225d 2c20 7829 2066 6f72 2078  tity"], x) for x
-00030f50: 2069 6e20 7365 6c66 2e63 6861 7473 5d20   in self.chats] 
-00030f60: 2b20 5c0d 0a20 2020 2020 2020 2020 2020  + \..           
-00030f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030f80: 2020 2020 2020 2020 2020 6c69 7374 2863            list(c
-00030f90: 6d61 702e 7661 6c75 6573 2829 290d 0a20  map.values()).. 
-00030fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030fb0: 2020 2020 2020 2066 6f72 2063 2069 6e20         for c in 
-00030fc0: 6d79 6368 6174 733a 2073 656c 662e 696d  mychats: self.im
-00030fd0: 6167 6563 6163 6865 2e70 6f70 2828 2263  agecache.pop(("c
-00030fe0: 6861 7422 2c20 635b 2269 6422 5d29 2c20  hat", c["id"]), 
-00030ff0: 4e6f 6e65 290d 0a20 2020 2020 2020 2020  None)..         
-00031000: 2020 2020 2020 2020 2020 2069 6620 7265             if re
-00031010: 6c6f 6164 732e 6765 7428 2263 6f6e 7461  loads.get("conta
-00031020: 6374 7322 293a 0d0a 2020 2020 2020 2020  cts"):..        
-00031030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031040: 6d79 636f 6e74 6163 7473 203d 2073 656c  mycontacts = sel
-00031050: 662e 6462 2e67 6574 5f63 6f6e 7461 6374  f.db.get_contact
-00031060: 7328 7265 6c6f 6164 3d54 7275 652c 2069  s(reload=True, i
-00031070: 6465 6e74 6974 6965 733d 7265 6c6f 6164  dentities=reload
-00031080: 735b 2263 6f6e 7461 6374 7322 5d29 0d0a  s["contacts"])..
-00031090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000310a0: 2020 2020 2020 2020 7365 6c66 2e64 622e          self.db.
-000310b0: 6765 745f 636f 6e74 6163 7473 5f73 7461  get_contacts_sta
-000310c0: 7473 286d 7963 6f6e 7461 6374 732c 2073  ts(mycontacts, s
-000310d0: 656c 662e 6368 6174 732c 206c 6f67 3d46  elf.chats, log=F
-000310e0: 616c 7365 290d 0a20 2020 2020 2020 2020  alse)..         
-000310f0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00031100: 6d61 7020 3d20 7b63 5b22 6964 656e 7469  map = {c["identi
-00031110: 7479 225d 3a20 6320 666f 7220 6320 696e  ty"]: c for c in
-00031120: 206d 7963 6f6e 7461 6374 737d 0d0a 2020   mycontacts}..  
-00031130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031140: 2020 2020 2020 7365 6c66 2e63 6f6e 7461        self.conta
-00031150: 6374 7320 3d20 736f 7274 6564 285b 636d  cts = sorted([cm
-00031160: 6170 2e70 6f70 2878 5b22 6964 656e 7469  ap.pop(x["identi
-00031170: 7479 225d 2c20 7829 2066 6f72 2078 2069  ty"], x) for x i
-00031180: 6e20 7365 6c66 2e63 6f6e 7461 6374 735d  n self.contacts]
-00031190: 202b 0d0a 2020 2020 2020 2020 2020 2020   +..            
-000311a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000311b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000311c0: 2020 206c 6973 7428 636d 6170 2e76 616c     list(cmap.val
-000311d0: 7565 7328 2929 2c20 6b65 793d 6c61 6d62  ues()), key=lamb
-000311e0: 6461 2078 3a20 785b 226e 616d 6522 5d2e  da x: x["name"].
-000311f0: 6c6f 7765 7228 2929 0d0a 2020 2020 2020  lower())..      
-00031200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031210: 2020 636f 6e74 6163 7473 203d 205b 7365    contacts = [se
-00031220: 6c66 2e64 622e 6163 636f 756e 745d 202b  lf.db.account] +
-00031230: 2073 656c 662e 636f 6e74 6163 7473 0d0a   self.contacts..
-00031240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031250: 2020 2020 2020 2020 666f 7220 6320 696e          for c in
-00031260: 206d 7963 6f6e 7461 6374 733a 2073 656c   mycontacts: sel
-00031270: 662e 696d 6167 6563 6163 6865 2e70 6f70  f.imagecache.pop
-00031280: 2828 2261 7661 7461 7222 2c20 635b 2269  (("avatar", c["i
-00031290: 6422 5d29 2c20 4e6f 6e65 290d 0a20 2020  d"]), None)..   
-000312a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000312b0: 2069 6620 2261 6363 6f75 6e74 7322 2069   if "accounts" i
-000312c0: 6e20 7265 6c6f 6164 733a 0d0a 2020 2020  n reloads:..    
-000312d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000312e0: 2020 2020 7365 6c66 2e64 622e 6765 745f      self.db.get_
-000312f0: 636f 6e74 6163 7473 5f73 7461 7473 285b  contacts_stats([
-00031300: 7365 6c66 2e64 622e 6163 636f 756e 745d  self.db.account]
-00031310: 2c20 7365 6c66 2e63 6861 7473 2c20 6c6f  , self.chats, lo
-00031320: 673d 4661 6c73 6529 0d0a 2020 2020 2020  g=False)..      
-00031330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031340: 2020 636f 6e74 6163 7473 203d 205b 7365    contacts = [se
-00031350: 6c66 2e64 622e 6163 636f 756e 745d 202b  lf.db.account] +
-00031360: 2073 656c 662e 636f 6e74 6163 7473 0d0a   self.contacts..
+00030950: 2020 2020 2020 2020 2020 2020 736c 6162              slab
+00030960: 656c 202b 3d20 222e 220d 0a0d 0a20 2020  el += "."....   
+00030970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030980: 2069 6620 736c 6162 656c 2061 6e64 206e   if slabel and n
+00030990: 6f74 2073 6c61 6265 6c2e 656e 6473 7769  ot slabel.endswi
+000309a0: 7468 2822 2e22 293a 2073 6c61 6265 6c20  th("."): slabel 
+000309b0: 2b3d 2022 2e22 0d0a 0d0a 2020 2020 2020  += "."....      
+000309c0: 2020 2020 2020 2020 2020 656c 6966 206e            elif n
+000309d0: 6f74 2072 6573 756c 742e 6765 7428 2273  ot result.get("s
+000309e0: 7461 7274 2229 3a0d 0a20 2020 2020 2020  tart"):..       
+000309f0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00030a00: 2263 6861 7473 2220 3d3d 2072 6573 756c  "chats" == resul
+00030a10: 745b 2274 6162 6c65 225d 2061 6e64 2072  t["table"] and r
+00030a20: 6573 756c 742e 6765 7428 2263 6861 7422  esult.get("chat"
+00030a30: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00030a40: 2020 2020 2020 2020 2020 2020 2320 5570              # Up
+00030a50: 6461 7465 6420 6368 6174 206d 6574 6169  dated chat metai
+00030a60: 6e66 6f3a 206c 6f61 6420 6e65 7720 636f  nfo: load new co
+00030a70: 6e74 6163 7473 2c20 6966 2061 6e79 0d0a  ntacts, if any..
+00030a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030a90: 2020 2020 2020 2020 706c 6162 656c 203d          plabel =
+00030aa0: 2022 220d 0a20 2020 2020 2020 2020 2020   ""..           
+00030ab0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00030ac0: 6368 6174 3a0d 0a20 2020 2020 2020 2020  chat:..         
+00030ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030ae0: 2020 2069 6473 203d 205b 785b 2269 6465     ids = [x["ide
+00030af0: 6e74 6974 7922 5d20 666f 7220 7820 696e  ntity"] for x in
+00030b00: 2063 6861 745b 2270 6172 7469 6369 7061   chat["participa
+00030b10: 6e74 7322 5d5d 0d0a 2020 2020 2020 2020  nts"]]..        
+00030b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030b30: 2020 2020 6e65 7769 6473 203d 2073 6574      newids = set
+00030b40: 2869 6473 2920 2d20 7365 7428 785b 2269  (ids) - set(x["i
+00030b50: 6465 6e74 6974 7922 5d20 666f 7220 7820  dentity"] for x 
+00030b60: 696e 2073 656c 662e 636f 6e74 6163 7473  in self.contacts
+00030b70: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00030b80: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00030b90: 6577 636f 6e74 6163 7473 203d 206c 6973  ewcontacts = lis
+00030ba0: 7428 6669 6c74 6572 2862 6f6f 6c2c 206d  t(filter(bool, m
+00030bb0: 6170 2873 656c 662e 6462 2e67 6574 5f63  ap(self.db.get_c
+00030bc0: 6f6e 7461 6374 2c20 6e65 7769 6473 2929  ontact, newids))
+00030bd0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00030be0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00030bf0: 6620 6e65 7763 6f6e 7461 6374 733a 0d0a  f newcontacts:..
+00030c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030c20: 7365 6c66 2e63 6f6e 7461 6374 732e 6578  self.contacts.ex
+00030c30: 7465 6e64 286e 6577 636f 6e74 6163 7473  tend(newcontacts
+00030c40: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00030c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030c60: 2020 2072 656c 6f61 6473 2e75 7064 6174     reloads.updat
+00030c70: 6528 636f 6e74 6163 7473 3d5b 785b 2269  e(contacts=[x["i
+00030c80: 6465 6e74 6974 7922 5d20 666f 7220 7820  dentity"] for x 
+00030c90: 696e 206e 6577 636f 6e74 6163 7473 5d29  in newcontacts])
+00030ca0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+00030cb0: 2020 2020 6966 2070 6c61 6265 6c3a 0d0a      if plabel:..
+00030cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030cd0: 2020 2020 7365 6c66 2e6c 6162 656c 5f73      self.label_s
+00030ce0: 796e 635f 7072 6f67 7265 7373 2e4c 6162  ync_progress.Lab
+00030cf0: 656c 203d 2070 6c61 6265 6c0d 0a20 2020  el = plabel..   
+00030d00: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00030d10: 736c 6162 656c 3a0d 0a20 2020 2020 2020  slabel:..       
+00030d20: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00030d30: 662e 6564 6974 5f73 796e 635f 7374 6174  f.edit_sync_stat
+00030d40: 7573 2e56 616c 7565 202b 3d20 2822 5c6e  us.Value += ("\n
+00030d50: 5c6e 2220 6966 2073 656c 662e 6564 6974  \n" if self.edit
+00030d60: 5f73 796e 635f 7374 6174 7573 2e56 616c  _sync_status.Val
+00030d70: 7565 2065 6c73 6520 2222 2920 2b20 736c  ue else "") + sl
+00030d80: 6162 656c 0d0a 2020 2020 2020 2020 2020  abel..          
+00030d90: 2020 2020 2020 2020 2020 7365 6c66 2e65            self.e
+00030da0: 6469 745f 7379 6e63 5f73 7461 7475 732e  dit_sync_status.
+00030db0: 5368 6f77 506f 7369 7469 6f6e 2873 656c  ShowPosition(sel
+00030dc0: 662e 6564 6974 5f73 796e 635f 7374 6174  f.edit_sync_stat
+00030dd0: 7573 2e4c 6173 7450 6f73 6974 696f 6e29  us.LastPosition)
+00030de0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00030df0: 2020 2020 2020 6c6f 6767 6572 2e69 6e66        logger.inf
+00030e00: 6f28 736c 6162 656c 290d 0a20 2020 2020  o(slabel)..     
+00030e10: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00030e20: 6761 7567 655f 7379 6e63 2e43 6f6e 7461  gauge_sync.Conta
+00030e30: 696e 696e 6753 697a 6572 2e4c 6179 6f75  iningSizer.Layou
+00030e40: 7428 290d 0a0d 0a20 2020 2020 2020 2020  t()....         
+00030e50: 2020 2020 2020 2064 6566 2061 6674 6572         def after
+00030e60: 3228 7265 6c6f 6164 7329 3a0d 0a20 2020  2(reloads):..   
+00030e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030e80: 2022 2222 506f 7075 6c61 7465 2073 7461   """Populate sta
+00030e90: 7469 7374 6963 7320 616e 6420 7265 6c6f  tistics and relo
+00030ea0: 6164 2076 6965 7773 2e22 2222 0d0a 2020  ad views."""..  
+00030eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030ec0: 2020 6966 206e 6f74 2073 656c 663a 2072    if not self: r
+00030ed0: 6574 7572 6e0d 0a20 2020 2020 2020 2020  eturn..         
+00030ee0: 2020 2020 2020 2020 2020 2063 6f6e 7461             conta
+00030ef0: 6374 7320 3d20 5b73 656c 662e 6462 2e61  cts = [self.db.a
+00030f00: 6363 6f75 6e74 5d20 2b20 7365 6c66 2e63  ccount] + self.c
+00030f10: 6f6e 7461 6374 730d 0a20 2020 2020 2020  ontacts..       
+00030f20: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00030f30: 7265 6c6f 6164 732e 6765 7428 2261 6363  reloads.get("acc
+00030f40: 6f75 6e74 7322 293a 0d0a 2020 2020 2020  ounts"):..      
+00030f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030f60: 2020 7365 6c66 2e64 622e 7570 6461 7465    self.db.update
+00030f70: 5f61 6363 6f75 6e74 696e 666f 2829 0d0a  _accountinfo()..
+00030f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030f90: 2020 2020 6966 2072 656c 6f61 6473 2e67      if reloads.g
+00030fa0: 6574 2822 6368 6174 7322 293a 0d0a 2020  et("chats"):..  
+00030fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030fc0: 2020 2020 2020 6d79 6368 6174 7320 3d20        mychats = 
+00030fd0: 7365 6c66 2e64 622e 6765 745f 636f 6e76  self.db.get_conv
+00030fe0: 6572 7361 7469 6f6e 7328 7265 6c6f 6164  ersations(reload
+00030ff0: 3d54 7275 652c 206c 6f67 3d46 616c 7365  =True, log=False
+00031000: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00031010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031030: 2020 2020 2020 2020 2020 2020 2063 6861               cha
+00031040: 7469 6465 6e74 6974 6965 733d 7265 6c6f  tidentities=relo
+00031050: 6164 735b 2263 6861 7473 225d 290d 0a20  ads["chats"]).. 
+00031060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031070: 2020 2020 2020 2073 656c 662e 6462 2e67         self.db.g
+00031080: 6574 5f63 6f6e 7665 7273 6174 696f 6e73  et_conversations
+00031090: 5f73 7461 7473 286d 7963 6861 7473 290d  _stats(mychats).
+000310a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000310b0: 2020 2020 2020 2020 2063 6d61 7020 3d20           cmap = 
+000310c0: 7b63 5b22 6964 656e 7469 7479 225d 3a20  {c["identity"]: 
+000310d0: 6320 666f 7220 6320 696e 206d 7963 6861  c for c in mycha
+000310e0: 7473 7d0d 0a20 2020 2020 2020 2020 2020  ts}..           
+000310f0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00031100: 662e 6368 6174 7320 3d20 5b63 6d61 702e  f.chats = [cmap.
+00031110: 706f 7028 785b 2269 6465 6e74 6974 7922  pop(x["identity"
+00031120: 5d2c 2078 2920 666f 7220 7820 696e 2073  ], x) for x in s
+00031130: 656c 662e 6368 6174 735d 202b 205c 0d0a  elf.chats] + \..
+00031140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031160: 2020 2020 206c 6973 7428 636d 6170 2e76       list(cmap.v
+00031170: 616c 7565 7328 2929 0d0a 2020 2020 2020  alues())..      
+00031180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031190: 2020 666f 7220 6320 696e 206d 7963 6861    for c in mycha
+000311a0: 7473 3a20 7365 6c66 2e69 6d61 6765 6361  ts: self.imageca
+000311b0: 6368 652e 706f 7028 2822 6368 6174 222c  che.pop(("chat",
+000311c0: 2063 5b22 6964 225d 292c 204e 6f6e 6529   c["id"]), None)
+000311d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000311e0: 2020 2020 2020 6966 2072 656c 6f61 6473        if reloads
+000311f0: 2e67 6574 2822 636f 6e74 6163 7473 2229  .get("contacts")
+00031200: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00031210: 2020 2020 2020 2020 2020 206d 7963 6f6e             mycon
+00031220: 7461 6374 7320 3d20 7365 6c66 2e64 622e  tacts = self.db.
+00031230: 6765 745f 636f 6e74 6163 7473 2872 656c  get_contacts(rel
+00031240: 6f61 643d 5472 7565 2c20 6964 656e 7469  oad=True, identi
+00031250: 7469 6573 3d72 656c 6f61 6473 5b22 636f  ties=reloads["co
+00031260: 6e74 6163 7473 225d 290d 0a20 2020 2020  ntacts"])..     
+00031270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031280: 2020 2073 656c 662e 6462 2e67 6574 5f63     self.db.get_c
+00031290: 6f6e 7461 6374 735f 7374 6174 7328 6d79  ontacts_stats(my
+000312a0: 636f 6e74 6163 7473 2c20 7365 6c66 2e63  contacts, self.c
+000312b0: 6861 7473 2c20 6c6f 673d 4661 6c73 6529  hats, log=False)
+000312c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000312d0: 2020 2020 2020 2020 2020 636d 6170 203d            cmap =
+000312e0: 207b 635b 2269 6465 6e74 6974 7922 5d3a   {c["identity"]:
+000312f0: 2063 2066 6f72 2063 2069 6e20 6d79 636f   c for c in myco
+00031300: 6e74 6163 7473 7d0d 0a20 2020 2020 2020  ntacts}..       
+00031310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031320: 2073 656c 662e 636f 6e74 6163 7473 203d   self.contacts =
+00031330: 2073 6f72 7465 6428 5b63 6d61 702e 706f   sorted([cmap.po
+00031340: 7028 785b 2269 6465 6e74 6974 7922 5d2c  p(x["identity"],
+00031350: 2078 2920 666f 7220 7820 696e 2073 656c   x) for x in sel
+00031360: 662e 636f 6e74 6163 7473 5d20 2b0d 0a20  f.contacts] +.. 
 00031370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031380: 2020 2020 6966 2022 6368 6174 7322 2069      if "chats" i
-00031390: 6e20 7265 6c6f 6164 733a 0d0a 2020 2020  n reloads:..    
-000313a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000313b0: 2020 2020 7365 6c66 2e6c 6973 745f 6368      self.list_ch
-000313c0: 6174 732e 506f 7075 6c61 7465 2873 656c  ats.Populate(sel
-000313d0: 662e 6368 6174 7329 0d0a 2020 2020 2020  f.chats)..      
-000313e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000313f0: 2020 6c62 6c20 3d20 2241 266c 6c20 6368    lbl = "A&ll ch
-00031400: 6174 2065 6e74 7269 6573 2069 6e20 6461  at entries in da
-00031410: 7461 6261 7365 2028 2573 293a 2220 2520  tabase (%s):" % 
-00031420: 7365 6c66 2e6c 6973 745f 6368 6174 732e  self.list_chats.
-00031430: 4974 656d 436f 756e 740d 0a20 2020 2020  ItemCount..     
-00031440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031450: 2020 2073 656c 662e 6c61 6265 6c5f 6c69     self.label_li
-00031460: 7374 5f63 6861 7473 2e4c 6162 656c 203d  st_chats.Label =
-00031470: 206c 626c 0d0a 2020 2020 2020 2020 2020   lbl..          
-00031480: 2020 2020 2020 2020 2020 6966 2022 6163            if "ac
-00031490: 636f 756e 7473 2220 696e 2072 656c 6f61  counts" in reloa
-000314a0: 6473 206f 7220 2263 6f6e 7461 6374 7322  ds or "contacts"
-000314b0: 2069 6e20 7265 6c6f 6164 733a 0d0a 2020   in reloads:..  
-000314c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000314d0: 2020 2020 2020 7365 6c66 2e6c 6973 745f        self.list_
-000314e0: 636f 6e74 6163 7473 2e50 6f70 756c 6174  contacts.Populat
-000314f0: 6528 636f 6e74 6163 7473 290d 0a20 2020  e(contacts)..   
-00031500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031510: 2020 2020 206c 626c 203d 2022 4126 6c6c       lbl = "A&ll
-00031520: 2070 726f 6669 6c65 7320 696e 2064 6174   profiles in dat
-00031530: 6162 6173 6520 2825 7329 3a22 2025 2073  abase (%s):" % s
-00031540: 656c 662e 6c69 7374 5f63 6f6e 7461 6374  elf.list_contact
-00031550: 732e 4974 656d 436f 756e 740d 0a20 2020  s.ItemCount..   
-00031560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031570: 2020 2020 2073 656c 662e 6c61 6265 6c5f       self.label_
-00031580: 6c69 7374 5f63 6f6e 7461 6374 732e 4c61  list_contacts.La
-00031590: 6265 6c20 3d20 6c62 6c0d 0a20 2020 2020  bel = lbl..     
-000315a0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000315b0: 6620 7365 6c66 2e63 6861 743a 0d0a 2020  f self.chat:..  
-000315c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000315d0: 2020 2020 2020 7069 6465 6e74 6974 6965        pidentitie
-000315e0: 7320 3d20 7365 7428 785b 2269 6465 6e74  s = set(x["ident
-000315f0: 6974 7922 5d20 666f 7220 7820 696e 2073  ity"] for x in s
-00031600: 656c 662e 6368 6174 5b22 7061 7274 6963  elf.chat["partic
-00031610: 6970 616e 7473 225d 290d 0a20 2020 2020  ipants"])..     
-00031620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031630: 2020 2069 735f 7265 6c61 7465 6420 3d20     is_related = 
-00031640: 7365 6c66 2e63 6861 745b 2269 6465 6e74  self.chat["ident
-00031650: 6974 7922 5d20 696e 2028 7265 6c6f 6164  ity"] in (reload
-00031660: 732e 6765 7428 2263 6861 7473 2229 206f  s.get("chats") o
-00031670: 7220 5b5d 2920 6f72 205c 0d0a 2020 2020  r []) or \..    
-00031680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000316a0: 2070 6964 656e 7469 7469 6573 2026 2073   pidentities & s
-000316b0: 6574 2872 656c 6f61 6473 2e67 6574 2822  et(reloads.get("
-000316c0: 636f 6e74 6163 7473 2229 206f 7220 5b5d  contacts") or []
-000316d0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-000316e0: 2020 2020 2020 2020 2020 2069 735f 7265             is_re
-000316f0: 6c61 7465 6420 616e 6420 7365 6c66 2e6c  lated and self.l
-00031700: 6f61 645f 6368 6174 2873 656c 662e 6368  oad_chat(self.ch
-00031710: 6174 2c20 7265 6c6f 6164 3d54 7275 6529  at, reload=True)
-00031720: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00031730: 2020 2020 2020 6966 2022 636f 6e74 6163        if "contac
-00031740: 7473 2220 696e 2072 656c 6f61 6473 2061  ts" in reloads a
-00031750: 6e64 2073 656c 662e 636f 6e74 6163 743a  nd self.contact:
-00031760: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00031770: 2020 2020 2020 2020 2020 7365 6c66 2e63            self.c
-00031780: 6f6e 7461 6374 203d 206e 6578 7428 2878  ontact = next((x
-00031790: 2066 6f72 2078 2069 6e20 636f 6e74 6163   for x in contac
-000317a0: 7473 0d0a 2020 2020 2020 2020 2020 2020  ts..            
-000317b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000317c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000317d0: 2069 6620 785b 2269 6465 6e74 6974 7922   if x["identity"
-000317e0: 5d20 3d3d 2073 656c 662e 636f 6e74 6163  ] == self.contac
-000317f0: 745b 2269 6465 6e74 6974 7922 5d29 2c20  t["identity"]), 
-00031800: 4e6f 6e65 290d 0a20 2020 2020 2020 2020  None)..         
-00031810: 2020 2020 2020 2020 2020 2069 6620 2261             if "a
-00031820: 6363 6f75 6e74 7322 2069 6e20 7265 6c6f  ccounts" in relo
-00031830: 6164 7320 6f72 2022 636f 6e74 6163 7473  ads or "contacts
-00031840: 2220 696e 2072 656c 6f61 6473 3a0d 0a20  " in reloads:.. 
-00031850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031860: 2020 2020 2020 2073 656c 662e 6c6f 6164         self.load
-00031870: 5f63 6f6e 7461 6374 2873 656c 662e 636f  _contact(self.co
-00031880: 6e74 6163 7429 0d0a 2020 2020 2020 2020  ntact)..        
-00031890: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000318a0: 2e64 622e 7570 6461 7465 5f66 696c 6569  .db.update_filei
-000318b0: 6e66 6f28 290d 0a20 2020 2020 2020 2020  nfo()..         
-000318c0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000318d0: 7570 6461 7465 5f61 6363 6f75 6e74 696e  update_accountin
-000318e0: 666f 2829 0d0a 2020 2020 2020 2020 2020  fo()..          
-000318f0: 2020 2020 2020 2020 2020 7365 6c66 2e75            self.u
-00031900: 7064 6174 655f 696e 666f 5f70 6167 6528  pdate_info_page(
-00031910: 7265 6c6f 6164 3d46 616c 7365 290d 0a0d  reload=False)...
-00031920: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00031930: 2069 6620 7265 6c6f 6164 733a 2077 782e   if reloads: wx.
-00031940: 4361 6c6c 4166 7465 7228 6166 7465 7232  CallAfter(after2
-00031950: 2c20 7265 6c6f 6164 7329 0d0a 0d0a 2020  , reloads)....  
-00031960: 2020 2020 2020 6966 2073 656c 663a 2077        if self: w
-00031970: 782e 4361 6c6c 4166 7465 7228 6166 7465  x.CallAfter(afte
-00031980: 722c 2072 6573 756c 7420 6f72 206b 7761  r, result or kwa
-00031990: 7267 7329 0d0a 2020 2020 2020 2020 7265  rgs)..        re
-000319a0: 7475 726e 2062 6f6f 6c28 7365 6c66 2061  turn bool(self a
-000319b0: 6e64 2073 656c 662e 776f 726b 6572 5f6c  nd self.worker_l
-000319c0: 6976 652e 6973 5f77 6f72 6b69 6e67 2829  ive.is_working()
-000319d0: 290d 0a0d 0a0d 0a20 2020 2064 6566 206f  )......    def o
-000319e0: 6e5f 6c69 7665 5f6c 6f67 696e 5f72 6573  n_live_login_res
-000319f0: 756c 7428 7365 6c66 2c20 7265 7375 6c74  ult(self, result
-00031a00: 293a 0d0a 2020 2020 2020 2020 2222 2248  ):..        """H
-00031a10: 616e 646c 6572 2066 6f72 206c 6976 6520  andler for live 
-00031a20: 6c6f 6769 6e20 7265 7375 6c74 2c20 7570  login result, up
-00031a30: 6461 7465 7320 5549 2e22 2222 0d0a 2020  dates UI."""..  
-00031a40: 2020 2020 2020 666f 7220 6320 696e 2073        for c in s
-00031a50: 656c 662e 7061 6e65 6c5f 6c6f 6769 6e2e  elf.panel_login.
-00031a60: 4368 696c 6472 656e 3a0d 0a20 2020 2020  Children:..     
-00031a70: 2020 2020 2020 2069 6620 6320 6973 2073         if c is s
-00031a80: 656c 662e 6564 6974 5f70 7720 6f72 2069  elf.edit_pw or i
-00031a90: 7369 6e73 7461 6e63 6528 632c 2077 782e  sinstance(c, wx.
-00031aa0: 4368 6563 6b42 6f78 293a 2063 2e45 6e61  CheckBox): c.Ena
-00031ab0: 626c 6528 290d 0a20 2020 2020 2020 2069  ble()..        i
-00031ac0: 6620 2265 7272 6f72 2220 696e 2072 6573  f "error" in res
-00031ad0: 756c 743a 0d0a 2020 2020 2020 2020 2020  ult:..          
-00031ae0: 2020 6c6f 6767 6572 2e65 7272 6f72 2827    logger.error('
-00031af0: 4572 726f 7220 6c6f 6767 696e 6720 696e  Error logging in
-00031b00: 2074 6f20 536b 7970 6520 6173 2022 2573   to Skype as "%s
-00031b10: 223a 5c6e 5c6e 2573 272c 2073 656c 662e  ":\n\n%s', self.
-00031b20: 6462 2e75 7365 726e 616d 652c 2072 6573  db.username, res
-00031b30: 756c 745b 2265 7272 6f72 225d 290d 0a20  ult["error"]).. 
-00031b40: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00031b50: 6564 6974 5f6c 6f67 696e 5f73 7461 7475  edit_login_statu
-00031b60: 732e 5661 6c75 6520 3d20 7265 7375 6c74  s.Value = result
-00031b70: 2e67 6574 2822 6572 726f 725f 7368 6f72  .get("error_shor
-00031b80: 7422 2c20 7265 7375 6c74 5b22 6572 726f  t", result["erro
-00031b90: 7222 5d29 0d0a 2020 2020 2020 2020 2020  r"])..          
-00031ba0: 2020 7365 6c66 2e62 7574 746f 6e5f 7573    self.button_us
-00031bb0: 6572 2e45 6e61 626c 6528 290d 0a20 2020  er.Enable()..   
-00031bc0: 2020 2020 2020 2020 2073 656c 662e 6275           self.bu
-00031bd0: 7474 6f6e 5f6c 6f67 696e 2e45 6e61 626c  tton_login.Enabl
-00031be0: 6528 290d 0a20 2020 2020 2020 2020 2020  e()..           
-00031bf0: 2073 656c 662e 6c61 6265 6c5f 6c6f 6769   self.label_logi
-00031c00: 6e5f 6661 696c 2e53 686f 7728 290d 0a20  n_fail.Show().. 
-00031c10: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00031c20: 6c61 6265 6c5f 6c6f 6769 6e5f 6661 696c  label_login_fail
-00031c30: 2e43 6f6e 7461 696e 696e 6753 697a 6572  .ContainingSizer
-00031c40: 2e4c 6179 6f75 7428 290d 0a20 2020 2020  .Layout()..     
-00031c50: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-00031c60: 2020 2020 2020 7365 6c66 2e65 6469 745f        self.edit_
-00031c70: 6c6f 6769 6e5f 7374 6174 7573 2e56 616c  login_status.Val
-00031c80: 7565 203d 2027 4c6f 6767 6564 2069 6e20  ue = 'Logged in 
-00031c90: 746f 2053 6b79 7065 2061 7320 2225 7322  to Skype as "%s"
-00031ca0: 2720 2520 7365 6c66 2e64 622e 7573 6572  ' % self.db.user
-00031cb0: 6e61 6d65 0d0a 2020 2020 2020 2020 2020  name..          
-00031cc0: 2020 7365 6c66 2e62 7574 746f 6e5f 6c6f    self.button_lo
-00031cd0: 6769 6e2e 4469 7361 626c 6528 290d 0a20  gin.Disable().. 
-00031ce0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00031cf0: 6c61 6265 6c5f 6c6f 6769 6e5f 6661 696c  label_login_fail
-00031d00: 2e48 6964 6528 290d 0a20 2020 2020 2020  .Hide()..       
-00031d10: 2020 2020 2066 6f72 2063 2069 6e20 636f       for c in co
-00031d20: 6e74 726f 6c73 2e67 6574 5f63 6f6e 7472  ntrols.get_contr
-00031d30: 6f6c 7328 7365 6c66 2e70 616e 656c 5f73  ols(self.panel_s
-00031d40: 796e 6329 3a20 632e 456e 6162 6c65 2829  ync): c.Enable()
-00031d50: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00031d60: 6c66 2e62 7574 746f 6e5f 7379 6e63 5f73  lf.button_sync_s
-00031d70: 746f 702e 4469 7361 626c 6528 290d 0a20  top.Disable().. 
-00031d80: 2020 2020 2020 2020 2020 2069 6620 7265             if re
-00031d90: 7375 6c74 2e67 6574 2822 6f70 7473 222c  sult.get("opts",
-00031da0: 207b 7d29 2e67 6574 2822 7379 6e63 2229   {}).get("sync")
-00031db0: 3a20 7778 2e43 616c 6c41 6674 6572 2873  : wx.CallAfter(s
-00031dc0: 656c 662e 6f6e 5f6c 6976 655f 7379 6e63  elf.on_live_sync
-00031dd0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00031de0: 6368 6563 6b5f 6c6f 6769 6e5f 6175 746f  check_login_auto
-00031df0: 2e45 6e61 626c 6528 7365 6c66 2e63 6865  .Enable(self.che
-00031e00: 636b 5f6c 6f67 696e 5f73 746f 7265 2e56  ck_login_store.V
-00031e10: 616c 7565 290d 0a20 2020 2020 2020 2073  alue)..        s
-00031e20: 656c 662e 6368 6563 6b5f 6c6f 6769 6e5f  elf.check_login_
-00031e30: 7379 6e63 2e45 6e61 626c 6528 7365 6c66  sync.Enable(self
-00031e40: 2e63 6865 636b 5f6c 6f67 696e 5f61 7574  .check_login_aut
-00031e50: 6f20 2e56 616c 7565 290d 0a0d 0a0d 0a20  o .Value)...... 
-00031e60: 2020 2064 6566 206f 6e5f 6c69 7665 5f77     def on_live_w
-00031e70: 6f72 6b5f 646f 6e65 2873 656c 662c 2072  ork_done(self, r
-00031e80: 6573 756c 743d 4e6f 6e65 293a 0d0a 2020  esult=None):..  
-00031e90: 2020 2020 2020 2222 2248 616e 646c 6572        """Handler
-00031ea0: 2066 6f72 206c 6976 6520 7379 6e63 2063   for live sync c
-00031eb0: 6f6d 706c 6574 696f 6e2c 2075 7064 6174  ompletion, updat
-00031ec0: 6573 2055 492e 2222 220d 0a20 2020 2020  es UI."""..     
-00031ed0: 2020 2072 6573 756c 7420 3d20 7265 7375     result = resu
-00031ee0: 6c74 206f 7220 7b7d 0d0a 2020 2020 2020  lt or {}..      
-00031ef0: 2020 7365 6c66 2e67 6175 6765 5f73 796e    self.gauge_syn
-00031f00: 632e 5661 6c75 6520 3d20 7365 6c66 2e67  c.Value = self.g
-00031f10: 6175 6765 5f73 796e 632e 5661 6c75 6520  auge_sync.Value 
-00031f20: 2320 5374 6f70 2070 756c 7365 2c20 6966  # Stop pulse, if
-00031f30: 2061 6e79 0d0a 2020 2020 2020 2020 6966   any..        if
-00031f40: 2072 6573 756c 742e 6765 7428 2265 7272   result.get("err
-00031f50: 6f72 2229 3a0d 0a20 2020 2020 2020 2020  or"):..         
-00031f60: 2020 2070 6c61 6265 6c20 3d20 2245 7272     plabel = "Err
-00031f70: 6f72 2073 796e 6369 6e67 2066 726f 6d20  or syncing from 
-00031f80: 536b 7970 6520 6f6e 6c69 6e65 2073 6572  Skype online ser
-00031f90: 7669 6365 2e22 0d0a 2020 2020 2020 2020  vice."..        
-00031fa0: 2020 2020 736c 6162 656c 203d 2022 2573      slabel = "%s
-00031fb0: 3a5c 6e5c 6e25 7322 2025 2028 706c 6162  :\n\n%s" % (plab
-00031fc0: 656c 2c20 7265 7375 6c74 5b22 6572 726f  el, result["erro
-00031fd0: 7222 5d29 0d0a 2020 2020 2020 2020 656c  r"])..        el
-00031fe0: 6966 2072 6573 756c 742e 6765 7428 2273  if result.get("s
-00031ff0: 746f 7022 293a 0d0a 2020 2020 2020 2020  top"):..        
-00032000: 2020 2020 706c 6162 656c 203d 2073 6c61      plabel = sla
-00032010: 6265 6c20 3d20 2253 746f 7070 6564 2062  bel = "Stopped b
-00032020: 7920 7573 6572 2e22 0d0a 2020 2020 2020  y user."..      
-00032030: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-00032040: 2020 2020 2070 6c61 6265 6c20 3d20 736c       plabel = sl
-00032050: 6162 656c 203d 2022 5379 6e63 6872 6f6e  abel = "Synchron
-00032060: 697a 6174 696f 6e20 636f 6d70 6c65 7465  ization complete
-00032070: 2e22 0d0a 2020 2020 2020 2020 2020 2020  ."..            
-00032080: 7365 6c66 2e67 6175 6765 5f73 796e 632e  self.gauge_sync.
-00032090: 5661 6c75 6520 3d20 3130 300d 0a20 2020  Value = 100..   
-000320a0: 2020 2020 2073 656c 662e 6c61 6265 6c5f       self.label_
-000320b0: 7379 6e63 5f70 726f 6772 6573 732e 4c61  sync_progress.La
-000320c0: 6265 6c20 3d20 706c 6162 656c 0d0a 2020  bel = plabel..  
-000320d0: 2020 2020 2020 7365 6c66 2e65 6469 745f        self.edit_
-000320e0: 7379 6e63 5f73 7461 7475 732e 5661 6c75  sync_status.Valu
-000320f0: 6520 2b3d 2028 225c 6e5c 6e22 2069 6620  e += ("\n\n" if 
-00032100: 7365 6c66 2e65 6469 745f 7379 6e63 5f73  self.edit_sync_s
-00032110: 7461 7475 732e 5661 6c75 6520 656c 7365  tatus.Value else
-00032120: 2022 2229 202b 2073 6c61 6265 6c0d 0a20   "") + slabel.. 
-00032130: 2020 2020 2020 2073 656c 662e 6564 6974         self.edit
-00032140: 5f73 796e 635f 7374 6174 7573 2e53 686f  _sync_status.Sho
-00032150: 7750 6f73 6974 696f 6e28 7365 6c66 2e65  wPosition(self.e
-00032160: 6469 745f 7379 6e63 5f73 7461 7475 732e  dit_sync_status.
-00032170: 4c61 7374 506f 7369 7469 6f6e 290d 0a20  LastPosition).. 
-00032180: 2020 2020 2020 2073 656c 662e 6761 7567         self.gaug
-00032190: 655f 7379 6e63 2e43 6f6e 7461 696e 696e  e_sync.Containin
-000321a0: 6753 697a 6572 2e4c 6179 6f75 7428 290d  gSizer.Layout().
-000321b0: 0a20 2020 2020 2020 2073 656c 662e 6368  .        self.ch
-000321c0: 6563 6b5f 7379 6e63 5f63 6f6e 7461 6374  eck_sync_contact
-000321d0: 732e 456e 6162 6c65 6420 3d20 7365 6c66  s.Enabled = self
-000321e0: 2e63 6865 636b 5f73 796e 635f 6f6c 6465  .check_sync_olde
-000321f0: 722e 456e 6162 6c65 6420 3d20 5472 7565  r.Enabled = True
-00032200: 0d0a 2020 2020 2020 2020 7365 6c66 2e62  ..        self.b
-00032210: 7574 746f 6e5f 7379 6e63 2e45 6e61 626c  utton_sync.Enabl
-00032220: 6564 203d 2073 656c 662e 6275 7474 6f6e  ed = self.button
-00032230: 5f73 796e 635f 7365 6c2e 456e 6162 6c65  _sync_sel.Enable
-00032240: 6420 3d20 5472 7565 0d0a 2020 2020 2020  d = True..      
-00032250: 2020 7365 6c66 2e62 7574 746f 6e5f 7379    self.button_sy
-00032260: 6e63 5f73 746f 702e 4469 7361 626c 6528  nc_stop.Disable(
-00032270: 290d 0a20 2020 2020 2020 2069 6620 6e6f  )..        if no
-00032280: 7420 7365 6c66 2e67 6574 5f75 6e73 6176  t self.get_unsav
-00032290: 6564 5f67 7269 6473 2829 3a20 7365 6c66  ed_grids(): self
-000322a0: 2e6f 6e5f 7265 6672 6573 685f 7461 626c  .on_refresh_tabl
-000322b0: 6573 2829 0d0a 2020 2020 2020 2020 7778  es()..        wx
-000322c0: 2e42 656c 6c28 290d 0a20 2020 2020 2020  .Bell()..       
-000322d0: 2073 656c 662e 7570 6461 7465 5f69 6e66   self.update_inf
-000322e0: 6f5f 7061 6765 2829 0d0a 0d0a 0d0a 2020  o_page()......  
-000322f0: 2020 6465 6620 6f6e 5f63 6865 636b 5f69    def on_check_i
-00032300: 6e74 6567 7269 7479 2873 656c 662c 2065  ntegrity(self, e
-00032310: 7665 6e74 293a 0d0a 2020 2020 2020 2020  vent):..        
-00032320: 2222 220d 0a20 2020 2020 2020 2048 616e  """..        Han
-00032330: 646c 6572 2066 6f72 2063 6865 636b 696e  dler for checkin
-00032340: 6720 6461 7461 6261 7365 2069 6e74 6567  g database integ
-00032350: 7269 7479 2c20 6f66 6665 7273 2074 6f20  rity, offers to 
-00032360: 7361 7665 2061 2066 6978 6564 0d0a 2020  save a fixed..  
-00032370: 2020 2020 2020 6461 7461 6261 7365 2069        database i
-00032380: 6620 636f 7272 7570 7469 6f6e 2064 6574  f corruption det
-00032390: 6563 7465 642e 0d0a 2020 2020 2020 2020  ected...        
-000323a0: 2222 220d 0a20 2020 2020 2020 206d 7367  """..        msg
-000323b0: 203d 2022 4368 6563 6b69 6e67 2069 6e74   = "Checking int
-000323c0: 6567 7269 7479 206f 6620 2573 2e22 2025  egrity of %s." %
-000323d0: 2073 656c 662e 6462 2e66 696c 656e 616d   self.db.filenam
-000323e0: 650d 0a20 2020 2020 2020 2067 7569 6261  e..        guiba
-000323f0: 7365 2e73 7461 7475 7328 6d73 6729 0d0a  se.status(msg)..
-00032400: 2020 2020 2020 2020 6275 7379 203d 2063          busy = c
-00032410: 6f6e 7472 6f6c 732e 4275 7379 5061 6e65  ontrols.BusyPane
-00032420: 6c28 7365 6c66 2c20 6d73 6729 0d0a 2020  l(self, msg)..  
-00032430: 2020 2020 2020 7778 2e59 6965 6c64 4966        wx.YieldIf
-00032440: 4e65 6564 6564 2829 0d0a 2020 2020 2020  Needed()..      
-00032450: 2020 7472 793a 0d0a 2020 2020 2020 2020    try:..        
-00032460: 2020 2020 6572 726f 7273 203d 2073 656c      errors = sel
-00032470: 662e 6462 2e63 6865 636b 5f69 6e74 6567  f.db.check_integ
-00032480: 7269 7479 2829 0d0a 2020 2020 2020 2020  rity()..        
-00032490: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
-000324a0: 2061 7320 653a 0d0a 2020 2020 2020 2020   as e:..        
-000324b0: 2020 2020 6572 726f 7273 203d 2065 2e61      errors = e.a
-000324c0: 7267 735b 3a5d 0d0a 2020 2020 2020 2020  rgs[:]..        
-000324d0: 6275 7379 2e43 6c6f 7365 2829 0d0a 2020  busy.Close()..  
-000324e0: 2020 2020 2020 6775 6962 6173 652e 7374        guibase.st
-000324f0: 6174 7573 2829 0d0a 2020 2020 2020 2020  atus()..        
-00032500: 6966 206e 6f74 2065 7272 6f72 733a 0d0a  if not errors:..
-00032510: 2020 2020 2020 2020 2020 2020 7778 2e4d              wx.M
-00032520: 6573 7361 6765 426f 7828 224e 6f20 6461  essageBox("No da
-00032530: 7461 6261 7365 2065 7272 6f72 7320 6465  tabase errors de
-00032540: 7465 6374 6564 2e22 2c0d 0a20 2020 2020  tected.",..     
-00032550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032560: 2020 2020 2063 6f6e 662e 5469 746c 652c       conf.Title,
-00032570: 2077 782e 4943 4f4e 5f49 4e46 4f52 4d41   wx.ICON_INFORMA
-00032580: 5449 4f4e 290d 0a20 2020 2020 2020 2065  TION)..        e
-00032590: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-000325a0: 2020 6572 7220 3d20 225c 6e2d 2022 2e6a    err = "\n- ".j
-000325b0: 6f69 6e28 6572 726f 7273 290d 0a20 2020  oin(errors)..   
-000325c0: 2020 2020 2020 2020 206c 6f67 6765 722e           logger.
-000325d0: 696e 666f 2822 4572 726f 7273 2066 6f75  info("Errors fou
-000325e0: 6e64 2069 6e20 2573 3a20 2573 222c 2073  nd in %s: %s", s
-000325f0: 656c 662e 6462 2c20 6572 7229 0d0a 2020  elf.db, err)..  
-00032600: 2020 2020 2020 2020 2020 6572 7220 3d20            err = 
-00032610: 6572 725b 3a35 3030 5d20 2b20 222e 2e22  err[:500] + ".."
-00032620: 2069 6620 6c65 6e28 6572 7229 203e 2035   if len(err) > 5
-00032630: 3030 2065 6c73 6520 6572 720d 0a20 2020  00 else err..   
-00032640: 2020 2020 2020 2020 206d 7367 203d 2022           msg = "
-00032650: 4120 6e75 6d62 6572 206f 6620 6572 726f  A number of erro
-00032660: 7273 2077 6572 6520 666f 756e 6420 696e  rs were found in
-00032670: 2025 733a 5c6e 5c6e 2d20 2573 5c6e 5c6e   %s:\n\n- %s\n\n
-00032680: 2220 5c0d 0a20 2020 2020 2020 2020 2020  " \..           
-00032690: 2020 2020 2020 2022 5265 636f 7665 7220         "Recover 
-000326a0: 6173 206d 7563 6820 6173 2070 6f73 7369  as much as possi
-000326b0: 626c 6520 746f 2061 206e 6577 2064 6174  ble to a new dat
-000326c0: 6162 6173 653f 2220 2520 5c0d 0a20 2020  abase?" % \..   
-000326d0: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-000326e0: 7365 6c66 2e64 622c 2065 7272 290d 0a20  self.db, err).. 
-000326f0: 2020 2020 2020 2020 2020 2069 6620 7778             if wx
-00032700: 2e59 4553 203d 3d20 7778 2e4d 6573 7361  .YES == wx.Messa
-00032710: 6765 426f 7828 6d73 672c 2063 6f6e 662e  geBox(msg, conf.
-00032720: 5469 746c 652c 0d0a 2020 2020 2020 2020  Title,..        
+00031380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031390: 2020 2020 2020 2020 2020 2020 2020 6c69                li
+000313a0: 7374 2863 6d61 702e 7661 6c75 6573 2829  st(cmap.values()
+000313b0: 292c 206b 6579 3d6c 616d 6264 6120 783a  ), key=lambda x:
+000313c0: 2078 5b22 6e61 6d65 225d 2e6c 6f77 6572   x["name"].lower
+000313d0: 2829 290d 0a20 2020 2020 2020 2020 2020  ())..           
+000313e0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+000313f0: 7461 6374 7320 3d20 5b73 656c 662e 6462  tacts = [self.db
+00031400: 2e61 6363 6f75 6e74 5d20 2b20 7365 6c66  .account] + self
+00031410: 2e63 6f6e 7461 6374 730d 0a20 2020 2020  .contacts..     
+00031420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031430: 2020 2066 6f72 2063 2069 6e20 6d79 636f     for c in myco
+00031440: 6e74 6163 7473 3a20 7365 6c66 2e69 6d61  ntacts: self.ima
+00031450: 6765 6361 6368 652e 706f 7028 2822 6176  gecache.pop(("av
+00031460: 6174 6172 222c 2063 5b22 6964 225d 292c  atar", c["id"]),
+00031470: 204e 6f6e 6529 0d0a 2020 2020 2020 2020   None)..        
+00031480: 2020 2020 2020 2020 2020 2020 6966 2022              if "
+00031490: 6163 636f 756e 7473 2220 696e 2072 656c  accounts" in rel
+000314a0: 6f61 6473 3a0d 0a20 2020 2020 2020 2020  oads:..         
+000314b0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000314c0: 656c 662e 6462 2e67 6574 5f63 6f6e 7461  elf.db.get_conta
+000314d0: 6374 735f 7374 6174 7328 5b73 656c 662e  cts_stats([self.
+000314e0: 6462 2e61 6363 6f75 6e74 5d2c 2073 656c  db.account], sel
+000314f0: 662e 6368 6174 732c 206c 6f67 3d46 616c  f.chats, log=Fal
+00031500: 7365 290d 0a20 2020 2020 2020 2020 2020  se)..           
+00031510: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+00031520: 7461 6374 7320 3d20 5b73 656c 662e 6462  tacts = [self.db
+00031530: 2e61 6363 6f75 6e74 5d20 2b20 7365 6c66  .account] + self
+00031540: 2e63 6f6e 7461 6374 730d 0a20 2020 2020  .contacts..     
+00031550: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00031560: 6620 2263 6861 7473 2220 696e 2072 656c  f "chats" in rel
+00031570: 6f61 6473 3a0d 0a20 2020 2020 2020 2020  oads:..         
+00031580: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00031590: 656c 662e 6c69 7374 5f63 6861 7473 2e50  elf.list_chats.P
+000315a0: 6f70 756c 6174 6528 7365 6c66 2e63 6861  opulate(self.cha
+000315b0: 7473 290d 0a20 2020 2020 2020 2020 2020  ts)..           
+000315c0: 2020 2020 2020 2020 2020 2020 206c 626c               lbl
+000315d0: 203d 2022 4126 6c6c 2063 6861 7420 656e   = "A&ll chat en
+000315e0: 7472 6965 7320 696e 2064 6174 6162 6173  tries in databas
+000315f0: 6520 2825 7329 3a22 2025 2073 656c 662e  e (%s):" % self.
+00031600: 6c69 7374 5f63 6861 7473 2e49 7465 6d43  list_chats.ItemC
+00031610: 6f75 6e74 0d0a 2020 2020 2020 2020 2020  ount..          
+00031620: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00031630: 6c66 2e6c 6162 656c 5f6c 6973 745f 6368  lf.label_list_ch
+00031640: 6174 732e 4c61 6265 6c20 3d20 6c62 6c0d  ats.Label = lbl.
+00031650: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00031660: 2020 2020 2069 6620 2261 6363 6f75 6e74       if "account
+00031670: 7322 2069 6e20 7265 6c6f 6164 7320 6f72  s" in reloads or
+00031680: 2022 636f 6e74 6163 7473 2220 696e 2072   "contacts" in r
+00031690: 656c 6f61 6473 3a0d 0a20 2020 2020 2020  eloads:..       
+000316a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000316b0: 2073 656c 662e 6c69 7374 5f63 6f6e 7461   self.list_conta
+000316c0: 6374 732e 506f 7075 6c61 7465 2863 6f6e  cts.Populate(con
+000316d0: 7461 6374 7329 0d0a 2020 2020 2020 2020  tacts)..        
+000316e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000316f0: 6c62 6c20 3d20 2241 266c 6c20 7072 6f66  lbl = "A&ll prof
+00031700: 696c 6573 2069 6e20 6461 7461 6261 7365  iles in database
+00031710: 2028 2573 293a 2220 2520 7365 6c66 2e6c   (%s):" % self.l
+00031720: 6973 745f 636f 6e74 6163 7473 2e49 7465  ist_contacts.Ite
+00031730: 6d43 6f75 6e74 0d0a 2020 2020 2020 2020  mCount..        
+00031740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031750: 7365 6c66 2e6c 6162 656c 5f6c 6973 745f  self.label_list_
+00031760: 636f 6e74 6163 7473 2e4c 6162 656c 203d  contacts.Label =
+00031770: 206c 626c 0d0a 2020 2020 2020 2020 2020   lbl..          
+00031780: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+00031790: 662e 6368 6174 3a0d 0a20 2020 2020 2020  f.chat:..       
+000317a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000317b0: 2070 6964 656e 7469 7469 6573 203d 2073   pidentities = s
+000317c0: 6574 2878 5b22 6964 656e 7469 7479 225d  et(x["identity"]
+000317d0: 2066 6f72 2078 2069 6e20 7365 6c66 2e63   for x in self.c
+000317e0: 6861 745b 2270 6172 7469 6369 7061 6e74  hat["participant
+000317f0: 7322 5d29 0d0a 2020 2020 2020 2020 2020  s"])..          
+00031800: 2020 2020 2020 2020 2020 2020 2020 6973                is
+00031810: 5f72 656c 6174 6564 203d 2073 656c 662e  _related = self.
+00031820: 6368 6174 5b22 6964 656e 7469 7479 225d  chat["identity"]
+00031830: 2069 6e20 2872 656c 6f61 6473 2e67 6574   in (reloads.get
+00031840: 2822 6368 6174 7322 2920 6f72 205b 5d29  ("chats") or [])
+00031850: 206f 7220 5c0d 0a20 2020 2020 2020 2020   or \..         
+00031860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031870: 2020 2020 2020 2020 2020 2020 7069 6465              pide
+00031880: 6e74 6974 6965 7320 2620 7365 7428 7265  ntities & set(re
+00031890: 6c6f 6164 732e 6765 7428 2263 6f6e 7461  loads.get("conta
+000318a0: 6374 7322 2920 6f72 205b 5d29 0d0a 2020  cts") or [])..  
+000318b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000318c0: 2020 2020 2020 6973 5f72 656c 6174 6564        is_related
+000318d0: 2061 6e64 2073 656c 662e 6c6f 6164 5f63   and self.load_c
+000318e0: 6861 7428 7365 6c66 2e63 6861 742c 2072  hat(self.chat, r
+000318f0: 656c 6f61 643d 5472 7565 290d 0a20 2020  eload=True)..   
+00031900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031910: 2069 6620 2263 6f6e 7461 6374 7322 2069   if "contacts" i
+00031920: 6e20 7265 6c6f 6164 7320 616e 6420 7365  n reloads and se
+00031930: 6c66 2e63 6f6e 7461 6374 3a0d 0a20 2020  lf.contact:..   
+00031940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031950: 2020 2020 2073 656c 662e 636f 6e74 6163       self.contac
+00031960: 7420 3d20 6e65 7874 2828 7820 666f 7220  t = next((x for 
+00031970: 7820 696e 2063 6f6e 7461 6374 730d 0a20  x in contacts.. 
+00031980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000319a0: 2020 2020 2020 2020 2020 2020 6966 2078              if x
+000319b0: 5b22 6964 656e 7469 7479 225d 203d 3d20  ["identity"] == 
+000319c0: 7365 6c66 2e63 6f6e 7461 6374 5b22 6964  self.contact["id
+000319d0: 656e 7469 7479 225d 292c 204e 6f6e 6529  entity"]), None)
+000319e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000319f0: 2020 2020 2020 6966 2022 6163 636f 756e        if "accoun
+00031a00: 7473 2220 696e 2072 656c 6f61 6473 206f  ts" in reloads o
+00031a10: 7220 2263 6f6e 7461 6374 7322 2069 6e20  r "contacts" in 
+00031a20: 7265 6c6f 6164 733a 0d0a 2020 2020 2020  reloads:..      
+00031a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031a40: 2020 7365 6c66 2e6c 6f61 645f 636f 6e74    self.load_cont
+00031a50: 6163 7428 7365 6c66 2e63 6f6e 7461 6374  act(self.contact
+00031a60: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00031a70: 2020 2020 2020 2073 656c 662e 6462 2e75         self.db.u
+00031a80: 7064 6174 655f 6669 6c65 696e 666f 2829  pdate_fileinfo()
+00031a90: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00031aa0: 2020 2020 2020 7365 6c66 2e75 7064 6174        self.updat
+00031ab0: 655f 6163 636f 756e 7469 6e66 6f28 290d  e_accountinfo().
+00031ac0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00031ad0: 2020 2020 2073 656c 662e 7570 6461 7465       self.update
+00031ae0: 5f69 6e66 6f5f 7061 6765 2872 656c 6f61  _info_page(reloa
+00031af0: 643d 4661 6c73 6529 0d0a 0d0a 2020 2020  d=False)....    
+00031b00: 2020 2020 2020 2020 2020 2020 6966 2072              if r
+00031b10: 656c 6f61 6473 3a20 7778 2e43 616c 6c41  eloads: wx.CallA
+00031b20: 6674 6572 2861 6674 6572 322c 2072 656c  fter(after2, rel
+00031b30: 6f61 6473 290d 0a0d 0a20 2020 2020 2020  oads)....       
+00031b40: 2069 6620 7365 6c66 3a20 7778 2e43 616c   if self: wx.Cal
+00031b50: 6c41 6674 6572 2861 6674 6572 2c20 7265  lAfter(after, re
+00031b60: 7375 6c74 206f 7220 6b77 6172 6773 290d  sult or kwargs).
+00031b70: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00031b80: 626f 6f6c 2873 656c 6620 616e 6420 7365  bool(self and se
+00031b90: 6c66 2e77 6f72 6b65 725f 6c69 7665 2e69  lf.worker_live.i
+00031ba0: 735f 776f 726b 696e 6728 2929 0d0a 0d0a  s_working())....
+00031bb0: 0d0a 2020 2020 6465 6620 6f6e 5f6c 6976  ..    def on_liv
+00031bc0: 655f 6c6f 6769 6e5f 7265 7375 6c74 2873  e_login_result(s
+00031bd0: 656c 662c 2072 6573 756c 7429 3a0d 0a20  elf, result):.. 
+00031be0: 2020 2020 2020 2022 2222 4861 6e64 6c65         """Handle
+00031bf0: 7220 666f 7220 6c69 7665 206c 6f67 696e  r for live login
+00031c00: 2072 6573 756c 742c 2075 7064 6174 6573   result, updates
+00031c10: 2055 492e 2222 220d 0a20 2020 2020 2020   UI."""..       
+00031c20: 2066 6f72 2063 2069 6e20 7365 6c66 2e70   for c in self.p
+00031c30: 616e 656c 5f6c 6f67 696e 2e43 6869 6c64  anel_login.Child
+00031c40: 7265 6e3a 0d0a 2020 2020 2020 2020 2020  ren:..          
+00031c50: 2020 6966 2063 2069 7320 7365 6c66 2e65    if c is self.e
+00031c60: 6469 745f 7077 206f 7220 6973 696e 7374  dit_pw or isinst
+00031c70: 616e 6365 2863 2c20 7778 2e43 6865 636b  ance(c, wx.Check
+00031c80: 426f 7829 3a20 632e 456e 6162 6c65 2829  Box): c.Enable()
+00031c90: 0d0a 2020 2020 2020 2020 6966 2022 6572  ..        if "er
+00031ca0: 726f 7222 2069 6e20 7265 7375 6c74 3a0d  ror" in result:.
+00031cb0: 0a20 2020 2020 2020 2020 2020 206c 6f67  .            log
+00031cc0: 6765 722e 6572 726f 7228 2745 7272 6f72  ger.error('Error
+00031cd0: 206c 6f67 6769 6e67 2069 6e20 746f 2053   logging in to S
+00031ce0: 6b79 7065 2061 7320 2225 7322 3a5c 6e5c  kype as "%s":\n\
+00031cf0: 6e25 7327 2c20 7365 6c66 2e64 622e 7573  n%s', self.db.us
+00031d00: 6572 6e61 6d65 2c20 7265 7375 6c74 5b22  ername, result["
+00031d10: 6572 726f 7222 5d29 0d0a 2020 2020 2020  error"])..      
+00031d20: 2020 2020 2020 7365 6c66 2e65 6469 745f        self.edit_
+00031d30: 6c6f 6769 6e5f 7374 6174 7573 2e56 616c  login_status.Val
+00031d40: 7565 203d 2072 6573 756c 742e 6765 7428  ue = result.get(
+00031d50: 2265 7272 6f72 5f73 686f 7274 222c 2072  "error_short", r
+00031d60: 6573 756c 745b 2265 7272 6f72 225d 290d  esult["error"]).
+00031d70: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00031d80: 662e 6275 7474 6f6e 5f75 7365 722e 456e  f.button_user.En
+00031d90: 6162 6c65 2829 0d0a 2020 2020 2020 2020  able()..        
+00031da0: 2020 2020 7365 6c66 2e62 7574 746f 6e5f      self.button_
+00031db0: 6c6f 6769 6e2e 456e 6162 6c65 2829 0d0a  login.Enable()..
+00031dc0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00031dd0: 2e6c 6162 656c 5f6c 6f67 696e 5f66 6169  .label_login_fai
+00031de0: 6c2e 5368 6f77 2829 0d0a 2020 2020 2020  l.Show()..      
+00031df0: 2020 2020 2020 7365 6c66 2e6c 6162 656c        self.label
+00031e00: 5f6c 6f67 696e 5f66 6169 6c2e 436f 6e74  _login_fail.Cont
+00031e10: 6169 6e69 6e67 5369 7a65 722e 4c61 796f  ainingSizer.Layo
+00031e20: 7574 2829 0d0a 2020 2020 2020 2020 656c  ut()..        el
+00031e30: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+00031e40: 2073 656c 662e 6564 6974 5f6c 6f67 696e   self.edit_login
+00031e50: 5f73 7461 7475 732e 5661 6c75 6520 3d20  _status.Value = 
+00031e60: 274c 6f67 6765 6420 696e 2074 6f20 536b  'Logged in to Sk
+00031e70: 7970 6520 6173 2022 2573 2227 2025 2073  ype as "%s"' % s
+00031e80: 656c 662e 6462 2e75 7365 726e 616d 650d  elf.db.username.
+00031e90: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00031ea0: 662e 6275 7474 6f6e 5f6c 6f67 696e 2e44  f.button_login.D
+00031eb0: 6973 6162 6c65 2829 0d0a 2020 2020 2020  isable()..      
+00031ec0: 2020 2020 2020 7365 6c66 2e6c 6162 656c        self.label
+00031ed0: 5f6c 6f67 696e 5f66 6169 6c2e 4869 6465  _login_fail.Hide
+00031ee0: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+00031ef0: 666f 7220 6320 696e 2063 6f6e 7472 6f6c  for c in control
+00031f00: 732e 6765 745f 636f 6e74 726f 6c73 2873  s.get_controls(s
+00031f10: 656c 662e 7061 6e65 6c5f 7379 6e63 293a  elf.panel_sync):
+00031f20: 2063 2e45 6e61 626c 6528 290d 0a20 2020   c.Enable()..   
+00031f30: 2020 2020 2020 2020 2073 656c 662e 6275           self.bu
+00031f40: 7474 6f6e 5f73 796e 635f 7374 6f70 2e44  tton_sync_stop.D
+00031f50: 6973 6162 6c65 2829 0d0a 2020 2020 2020  isable()..      
+00031f60: 2020 2020 2020 6966 2072 6573 756c 742e        if result.
+00031f70: 6765 7428 226f 7074 7322 2c20 7b7d 292e  get("opts", {}).
+00031f80: 6765 7428 2273 796e 6322 293a 2077 782e  get("sync"): wx.
+00031f90: 4361 6c6c 4166 7465 7228 7365 6c66 2e6f  CallAfter(self.o
+00031fa0: 6e5f 6c69 7665 5f73 796e 6329 0d0a 2020  n_live_sync)..  
+00031fb0: 2020 2020 2020 7365 6c66 2e63 6865 636b        self.check
+00031fc0: 5f6c 6f67 696e 5f61 7574 6f2e 456e 6162  _login_auto.Enab
+00031fd0: 6c65 2873 656c 662e 6368 6563 6b5f 6c6f  le(self.check_lo
+00031fe0: 6769 6e5f 7374 6f72 652e 5661 6c75 6529  gin_store.Value)
+00031ff0: 0d0a 2020 2020 2020 2020 7365 6c66 2e63  ..        self.c
+00032000: 6865 636b 5f6c 6f67 696e 5f73 796e 632e  heck_login_sync.
+00032010: 456e 6162 6c65 2873 656c 662e 6368 6563  Enable(self.chec
+00032020: 6b5f 6c6f 6769 6e5f 6175 746f 202e 5661  k_login_auto .Va
+00032030: 6c75 6529 0d0a 0d0a 0d0a 2020 2020 6465  lue)......    de
+00032040: 6620 6f6e 5f6c 6976 655f 776f 726b 5f64  f on_live_work_d
+00032050: 6f6e 6528 7365 6c66 2c20 7265 7375 6c74  one(self, result
+00032060: 3d4e 6f6e 6529 3a0d 0a20 2020 2020 2020  =None):..       
+00032070: 2022 2222 4861 6e64 6c65 7220 666f 7220   """Handler for 
+00032080: 6c69 7665 2073 796e 6320 636f 6d70 6c65  live sync comple
+00032090: 7469 6f6e 2c20 7570 6461 7465 7320 5549  tion, updates UI
+000320a0: 2e22 2222 0d0a 2020 2020 2020 2020 7265  ."""..        re
+000320b0: 7375 6c74 203d 2072 6573 756c 7420 6f72  sult = result or
+000320c0: 207b 7d0d 0a20 2020 2020 2020 2073 656c   {}..        sel
+000320d0: 662e 6761 7567 655f 7379 6e63 2e56 616c  f.gauge_sync.Val
+000320e0: 7565 203d 2073 656c 662e 6761 7567 655f  ue = self.gauge_
+000320f0: 7379 6e63 2e56 616c 7565 2023 2053 746f  sync.Value # Sto
+00032100: 7020 7075 6c73 652c 2069 6620 616e 790d  p pulse, if any.
+00032110: 0a20 2020 2020 2020 2069 6620 7265 7375  .        if resu
+00032120: 6c74 2e67 6574 2822 6572 726f 7222 293a  lt.get("error"):
+00032130: 0d0a 2020 2020 2020 2020 2020 2020 706c  ..            pl
+00032140: 6162 656c 203d 2022 4572 726f 7220 7379  abel = "Error sy
+00032150: 6e63 696e 6720 6672 6f6d 2053 6b79 7065  ncing from Skype
+00032160: 206f 6e6c 696e 6520 7365 7276 6963 652e   online service.
+00032170: 220d 0a20 2020 2020 2020 2020 2020 2073  "..            s
+00032180: 6c61 6265 6c20 3d20 2225 733a 5c6e 5c6e  label = "%s:\n\n
+00032190: 2573 2220 2520 2870 6c61 6265 6c2c 2072  %s" % (plabel, r
+000321a0: 6573 756c 745b 2265 7272 6f72 225d 290d  esult["error"]).
+000321b0: 0a20 2020 2020 2020 2065 6c69 6620 7265  .        elif re
+000321c0: 7375 6c74 2e67 6574 2822 7374 6f70 2229  sult.get("stop")
+000321d0: 3a0d 0a20 2020 2020 2020 2020 2020 2070  :..            p
+000321e0: 6c61 6265 6c20 3d20 736c 6162 656c 203d  label = slabel =
+000321f0: 2022 5374 6f70 7065 6420 6279 2075 7365   "Stopped by use
+00032200: 722e 220d 0a20 2020 2020 2020 2065 6c73  r."..        els
+00032210: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00032220: 706c 6162 656c 203d 2073 6c61 6265 6c20  plabel = slabel 
+00032230: 3d20 2253 796e 6368 726f 6e69 7a61 7469  = "Synchronizati
+00032240: 6f6e 2063 6f6d 706c 6574 652e 220d 0a20  on complete.".. 
+00032250: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00032260: 6761 7567 655f 7379 6e63 2e56 616c 7565  gauge_sync.Value
+00032270: 203d 2031 3030 0d0a 2020 2020 2020 2020   = 100..        
+00032280: 7365 6c66 2e6c 6162 656c 5f73 796e 635f  self.label_sync_
+00032290: 7072 6f67 7265 7373 2e4c 6162 656c 203d  progress.Label =
+000322a0: 2070 6c61 6265 6c0d 0a20 2020 2020 2020   plabel..       
+000322b0: 2073 656c 662e 6564 6974 5f73 796e 635f   self.edit_sync_
+000322c0: 7374 6174 7573 2e56 616c 7565 202b 3d20  status.Value += 
+000322d0: 2822 5c6e 5c6e 2220 6966 2073 656c 662e  ("\n\n" if self.
+000322e0: 6564 6974 5f73 796e 635f 7374 6174 7573  edit_sync_status
+000322f0: 2e56 616c 7565 2065 6c73 6520 2222 2920  .Value else "") 
+00032300: 2b20 736c 6162 656c 0d0a 2020 2020 2020  + slabel..      
+00032310: 2020 7365 6c66 2e65 6469 745f 7379 6e63    self.edit_sync
+00032320: 5f73 7461 7475 732e 5368 6f77 506f 7369  _status.ShowPosi
+00032330: 7469 6f6e 2873 656c 662e 6564 6974 5f73  tion(self.edit_s
+00032340: 796e 635f 7374 6174 7573 2e4c 6173 7450  ync_status.LastP
+00032350: 6f73 6974 696f 6e29 0d0a 2020 2020 2020  osition)..      
+00032360: 2020 7365 6c66 2e67 6175 6765 5f73 796e    self.gauge_syn
+00032370: 632e 436f 6e74 6169 6e69 6e67 5369 7a65  c.ContainingSize
+00032380: 722e 4c61 796f 7574 2829 0d0a 2020 2020  r.Layout()..    
+00032390: 2020 2020 7365 6c66 2e63 6865 636b 5f73      self.check_s
+000323a0: 796e 635f 636f 6e74 6163 7473 2e45 6e61  ync_contacts.Ena
+000323b0: 626c 6564 203d 2073 656c 662e 6368 6563  bled = self.chec
+000323c0: 6b5f 7379 6e63 5f6f 6c64 6572 2e45 6e61  k_sync_older.Ena
+000323d0: 626c 6564 203d 2054 7275 650d 0a20 2020  bled = True..   
+000323e0: 2020 2020 2073 656c 662e 6275 7474 6f6e       self.button
+000323f0: 5f73 796e 632e 456e 6162 6c65 6420 3d20  _sync.Enabled = 
+00032400: 7365 6c66 2e62 7574 746f 6e5f 7379 6e63  self.button_sync
+00032410: 5f73 656c 2e45 6e61 626c 6564 203d 2054  _sel.Enabled = T
+00032420: 7275 650d 0a20 2020 2020 2020 2073 656c  rue..        sel
+00032430: 662e 6275 7474 6f6e 5f73 796e 635f 7374  f.button_sync_st
+00032440: 6f70 2e44 6973 6162 6c65 2829 0d0a 2020  op.Disable()..  
+00032450: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
+00032460: 662e 6765 745f 756e 7361 7665 645f 6772  f.get_unsaved_gr
+00032470: 6964 7328 293a 2073 656c 662e 6f6e 5f72  ids(): self.on_r
+00032480: 6566 7265 7368 5f74 6162 6c65 7328 290d  efresh_tables().
+00032490: 0a20 2020 2020 2020 2077 782e 4265 6c6c  .        wx.Bell
+000324a0: 2829 0d0a 2020 2020 2020 2020 7365 6c66  ()..        self
+000324b0: 2e75 7064 6174 655f 696e 666f 5f70 6167  .update_info_pag
+000324c0: 6528 290d 0a0d 0a0d 0a20 2020 2064 6566  e()......    def
+000324d0: 206f 6e5f 6368 6563 6b5f 696e 7465 6772   on_check_integr
+000324e0: 6974 7928 7365 6c66 2c20 6576 656e 7429  ity(self, event)
+000324f0: 3a0d 0a20 2020 2020 2020 2022 2222 0d0a  :..        """..
+00032500: 2020 2020 2020 2020 4861 6e64 6c65 7220          Handler 
+00032510: 666f 7220 6368 6563 6b69 6e67 2064 6174  for checking dat
+00032520: 6162 6173 6520 696e 7465 6772 6974 792c  abase integrity,
+00032530: 206f 6666 6572 7320 746f 2073 6176 6520   offers to save 
+00032540: 6120 6669 7865 640d 0a20 2020 2020 2020  a fixed..       
+00032550: 2064 6174 6162 6173 6520 6966 2063 6f72   database if cor
+00032560: 7275 7074 696f 6e20 6465 7465 6374 6564  ruption detected
+00032570: 2e0d 0a20 2020 2020 2020 2022 2222 0d0a  ...        """..
+00032580: 2020 2020 2020 2020 6d73 6720 3d20 2243          msg = "C
+00032590: 6865 636b 696e 6720 696e 7465 6772 6974  hecking integrit
+000325a0: 7920 6f66 2025 732e 2220 2520 7365 6c66  y of %s." % self
+000325b0: 2e64 622e 6669 6c65 6e61 6d65 0d0a 2020  .db.filename..  
+000325c0: 2020 2020 2020 6775 6962 6173 652e 7374        guibase.st
+000325d0: 6174 7573 286d 7367 290d 0a20 2020 2020  atus(msg)..     
+000325e0: 2020 2062 7573 7920 3d20 636f 6e74 726f     busy = contro
+000325f0: 6c73 2e42 7573 7950 616e 656c 2873 656c  ls.BusyPanel(sel
+00032600: 662c 206d 7367 290d 0a20 2020 2020 2020  f, msg)..       
+00032610: 2077 782e 5969 656c 6449 664e 6565 6465   wx.YieldIfNeede
+00032620: 6428 290d 0a20 2020 2020 2020 2074 7279  d()..        try
+00032630: 3a0d 0a20 2020 2020 2020 2020 2020 2065  :..            e
+00032640: 7272 6f72 7320 3d20 7365 6c66 2e64 622e  rrors = self.db.
+00032650: 6368 6563 6b5f 696e 7465 6772 6974 7928  check_integrity(
+00032660: 290d 0a20 2020 2020 2020 2065 7863 6570  )..        excep
+00032670: 7420 4578 6365 7074 696f 6e20 6173 2065  t Exception as e
+00032680: 3a0d 0a20 2020 2020 2020 2020 2020 2065  :..            e
+00032690: 7272 6f72 7320 3d20 652e 6172 6773 5b3a  rrors = e.args[:
+000326a0: 5d0d 0a20 2020 2020 2020 2062 7573 792e  ]..        busy.
+000326b0: 436c 6f73 6528 290d 0a20 2020 2020 2020  Close()..       
+000326c0: 2067 7569 6261 7365 2e73 7461 7475 7328   guibase.status(
+000326d0: 290d 0a20 2020 2020 2020 2069 6620 6e6f  )..        if no
+000326e0: 7420 6572 726f 7273 3a0d 0a20 2020 2020  t errors:..     
+000326f0: 2020 2020 2020 2077 782e 4d65 7373 6167         wx.Messag
+00032700: 6542 6f78 2822 4e6f 2064 6174 6162 6173  eBox("No databas
+00032710: 6520 6572 726f 7273 2064 6574 6563 7465  e errors detecte
+00032720: 642e 222c 0d0a 2020 2020 2020 2020 2020  d.",..          
 00032730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032740: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-00032750: 782e 4943 4f4e 5f49 4e46 4f52 4d41 5449  x.ICON_INFORMATI
-00032760: 4f4e 207c 2077 782e 5945 5320 7c20 7778  ON | wx.YES | wx
-00032770: 2e4e 4f29 3a0d 0a20 2020 2020 2020 2020  .NO):..         
-00032780: 2020 2020 2020 2064 6972 6563 746f 7279         directory
-00032790: 2c20 6669 6c65 6e61 6d65 203d 206f 732e  , filename = os.
-000327a0: 7061 7468 2e73 706c 6974 2873 656c 662e  path.split(self.
-000327b0: 6462 2e66 696c 656e 616d 6529 0d0a 2020  db.filename)..  
-000327c0: 2020 2020 2020 2020 2020 2020 2020 6261                ba
-000327d0: 7365 203d 206f 732e 7061 7468 2e73 706c  se = os.path.spl
-000327e0: 6974 6578 7428 6669 6c65 6e61 6d65 295b  itext(filename)[
-000327f0: 305d 0d0a 2020 2020 2020 2020 2020 2020  0]..            
-00032800: 2020 2020 7365 6c66 2e64 6961 6c6f 675f      self.dialog_
-00032810: 7361 7665 6462 2e44 6972 6563 746f 7279  savedb.Directory
-00032820: 203d 2064 6972 6563 746f 7279 0d0a 2020   = directory..  
-00032830: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00032840: 6c66 2e64 6961 6c6f 675f 7361 7665 6462  lf.dialog_savedb
-00032850: 2e46 696c 656e 616d 6520 3d20 2225 7320  .Filename = "%s 
-00032860: 2872 6563 6f76 6572 6564 2922 2025 2062  (recovered)" % b
-00032870: 6173 650d 0a20 2020 2020 2020 2020 2020  ase..           
-00032880: 2020 2020 2069 6620 7778 2e49 445f 4f4b       if wx.ID_OK
-00032890: 203d 3d20 7365 6c66 2e64 6961 6c6f 675f   == self.dialog_
-000328a0: 7361 7665 6462 2e53 686f 774d 6f64 616c  savedb.ShowModal
-000328b0: 2829 3a0d 0a20 2020 2020 2020 2020 2020  ():..           
-000328c0: 2020 2020 2020 2020 206e 6577 6669 6c65           newfile
-000328d0: 203d 2063 6f6e 7472 6f6c 732e 6765 745f   = controls.get_
-000328e0: 6469 616c 6f67 5f70 6174 6828 7365 6c66  dialog_path(self
-000328f0: 2e64 6961 6c6f 675f 7361 7665 6462 290d  .dialog_savedb).
-00032900: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00032910: 2020 2020 2069 6620 6e65 7766 696c 6520       if newfile 
-00032920: 213d 2073 656c 662e 6462 2e66 696c 656e  != self.db.filen
-00032930: 616d 653a 0d0a 2020 2020 2020 2020 2020  ame:..          
-00032940: 2020 2020 2020 2020 2020 2020 2020 6775                gu
-00032950: 6962 6173 652e 7374 6174 7573 2822 5265  ibase.status("Re
-00032960: 636f 7665 7269 6e67 2064 6174 6120 6672  covering data fr
-00032970: 6f6d 2025 7320 746f 2025 732e 222c 0d0a  om %s to %s.",..
-00032980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000329a0: 2020 2020 2020 2073 656c 662e 6462 2e66         self.db.f
-000329b0: 696c 656e 616d 652c 206e 6577 6669 6c65  ilename, newfile
-000329c0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-000329d0: 2020 2020 2020 2020 2020 206d 203d 2022             m = "
-000329e0: 5265 636f 7665 7269 6e67 2064 6174 6120  Recovering data 
-000329f0: 6672 6f6d 2025 735c 6e74 6f20 2573 2e22  from %s\nto %s."
-00032a00: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00032a10: 2020 2020 2020 2020 2020 6275 7379 203d            busy =
-00032a20: 2063 6f6e 7472 6f6c 732e 4275 7379 5061   controls.BusyPa
-00032a30: 6e65 6c28 7365 6c66 2c20 6d20 2520 2873  nel(self, m % (s
-00032a40: 656c 662e 6462 2c20 6e65 7766 696c 6529  elf.db, newfile)
-00032a50: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00032a60: 2020 2020 2020 2020 2020 2077 782e 5969             wx.Yi
-00032a70: 656c 6449 664e 6565 6465 6428 290d 0a20  eldIfNeeded().. 
-00032a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032a90: 2020 2020 2020 2074 7279 3a0d 0a20 2020         try:..   
-00032aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032ab0: 2020 2020 2020 2020 2063 6f70 7965 7272           copyerr
-00032ac0: 6f72 7320 3d20 7365 6c66 2e64 622e 7265  ors = self.db.re
-00032ad0: 636f 7665 725f 6461 7461 286e 6577 6669  cover_data(newfi
-00032ae0: 6c65 290d 0a20 2020 2020 2020 2020 2020  le)..           
-00032af0: 2020 2020 2020 2020 2020 2020 2066 696e               fin
-00032b00: 616c 6c79 3a0d 0a20 2020 2020 2020 2020  ally:..         
-00032b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032b20: 2020 2062 7573 792e 436c 6f73 6528 290d     busy.Close().
-00032b30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00032b40: 2020 2020 2020 2020 2065 7272 203d 2028           err = (
-00032b50: 225c 6e5c 6e45 7272 6f72 7320 6f63 6375  "\n\nErrors occu
-00032b60: 7272 6564 2064 7572 696e 6720 7468 6520  rred during the 
-00032b70: 7265 636f 7665 7279 2c20 220d 0a20 2020  recovery, "..   
-00032b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032b90: 2020 2020 2020 2020 2020 2022 6d6f 7265             "more
-00032ba0: 2064 6574 6169 6c73 2069 6e20 6c6f 6720   details in log 
-00032bb0: 7769 6e64 6f77 3a5c 6e5c 6e2d 2022 0d0a  window:\n\n- "..
-00032bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032bd0: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-00032be0: 225c 6e2d 2022 2e6a 6f69 6e28 636f 7079  "\n- ".join(copy
-00032bf0: 6572 726f 7273 2929 2069 6620 636f 7079  errors)) if copy
-00032c00: 6572 726f 7273 2065 6c73 6520 2222 0d0a  errors else ""..
-00032c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032c20: 2020 2020 2020 2020 6572 7220 3d20 6572          err = er
-00032c30: 725b 3a35 3030 5d20 2b20 222e 2e22 2069  r[:500] + ".." i
-00032c40: 6620 6c65 6e28 6572 7229 203e 2035 3030  f len(err) > 500
-00032c50: 2065 6c73 6520 6572 720d 0a20 2020 2020   else err..     
+00032740: 636f 6e66 2e54 6974 6c65 2c20 7778 2e49  conf.Title, wx.I
+00032750: 434f 4e5f 494e 464f 524d 4154 494f 4e29  CON_INFORMATION)
+00032760: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
+00032770: 0a20 2020 2020 2020 2020 2020 2065 7272  .            err
+00032780: 203d 2022 5c6e 2d20 222e 6a6f 696e 2865   = "\n- ".join(e
+00032790: 7272 6f72 7329 0d0a 2020 2020 2020 2020  rrors)..        
+000327a0: 2020 2020 6c6f 6767 6572 2e69 6e66 6f28      logger.info(
+000327b0: 2245 7272 6f72 7320 666f 756e 6420 696e  "Errors found in
+000327c0: 2025 733a 2025 7322 2c20 7365 6c66 2e64   %s: %s", self.d
+000327d0: 622c 2065 7272 290d 0a20 2020 2020 2020  b, err)..       
+000327e0: 2020 2020 2065 7272 203d 2065 7272 5b3a       err = err[:
+000327f0: 3530 305d 202b 2022 2e2e 2220 6966 206c  500] + ".." if l
+00032800: 656e 2865 7272 2920 3e20 3530 3020 656c  en(err) > 500 el
+00032810: 7365 2065 7272 0d0a 2020 2020 2020 2020  se err..        
+00032820: 2020 2020 6d73 6720 3d20 2241 206e 756d      msg = "A num
+00032830: 6265 7220 6f66 2065 7272 6f72 7320 7765  ber of errors we
+00032840: 7265 2066 6f75 6e64 2069 6e20 2573 3a5c  re found in %s:\
+00032850: 6e5c 6e2d 2025 735c 6e5c 6e22 205c 0d0a  n\n- %s\n\n" \..
+00032860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032870: 2020 2252 6563 6f76 6572 2061 7320 6d75    "Recover as mu
+00032880: 6368 2061 7320 706f 7373 6962 6c65 2074  ch as possible t
+00032890: 6f20 6120 6e65 7720 6461 7461 6261 7365  o a new database
+000328a0: 3f22 2025 205c 0d0a 2020 2020 2020 2020  ?" % \..        
+000328b0: 2020 2020 2020 2020 2020 2873 656c 662e            (self.
+000328c0: 6462 2c20 6572 7229 0d0a 2020 2020 2020  db, err)..      
+000328d0: 2020 2020 2020 6966 2077 782e 5945 5320        if wx.YES 
+000328e0: 3d3d 2077 782e 4d65 7373 6167 6542 6f78  == wx.MessageBox
+000328f0: 286d 7367 2c20 636f 6e66 2e54 6974 6c65  (msg, conf.Title
+00032900: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00032910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032920: 2020 2020 2020 2020 2020 7778 2e49 434f            wx.ICO
+00032930: 4e5f 494e 464f 524d 4154 494f 4e20 7c20  N_INFORMATION | 
+00032940: 7778 2e59 4553 207c 2077 782e 4e4f 293a  wx.YES | wx.NO):
+00032950: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00032960: 2020 6469 7265 6374 6f72 792c 2066 696c    directory, fil
+00032970: 656e 616d 6520 3d20 6f73 2e70 6174 682e  ename = os.path.
+00032980: 7370 6c69 7428 7365 6c66 2e64 622e 6669  split(self.db.fi
+00032990: 6c65 6e61 6d65 290d 0a20 2020 2020 2020  lename)..       
+000329a0: 2020 2020 2020 2020 2062 6173 6520 3d20           base = 
+000329b0: 6f73 2e70 6174 682e 7370 6c69 7465 7874  os.path.splitext
+000329c0: 2866 696c 656e 616d 6529 5b30 5d0d 0a20  (filename)[0].. 
+000329d0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000329e0: 656c 662e 6469 616c 6f67 5f73 6176 6564  elf.dialog_saved
+000329f0: 622e 4469 7265 6374 6f72 7920 3d20 6469  b.Directory = di
+00032a00: 7265 6374 6f72 790d 0a20 2020 2020 2020  rectory..       
+00032a10: 2020 2020 2020 2020 2073 656c 662e 6469           self.di
+00032a20: 616c 6f67 5f73 6176 6564 622e 4669 6c65  alog_savedb.File
+00032a30: 6e61 6d65 203d 2022 2573 2028 7265 636f  name = "%s (reco
+00032a40: 7665 7265 6429 2220 2520 6261 7365 0d0a  vered)" % base..
+00032a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032a60: 6966 2077 782e 4944 5f4f 4b20 3d3d 2073  if wx.ID_OK == s
+00032a70: 656c 662e 6469 616c 6f67 5f73 6176 6564  elf.dialog_saved
+00032a80: 622e 5368 6f77 4d6f 6461 6c28 293a 0d0a  b.ShowModal():..
+00032a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032aa0: 2020 2020 6e65 7766 696c 6520 3d20 636f      newfile = co
+00032ab0: 6e74 726f 6c73 2e67 6574 5f64 6961 6c6f  ntrols.get_dialo
+00032ac0: 675f 7061 7468 2873 656c 662e 6469 616c  g_path(self.dial
+00032ad0: 6f67 5f73 6176 6564 6229 0d0a 2020 2020  og_savedb)..    
+00032ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032af0: 6966 206e 6577 6669 6c65 2021 3d20 7365  if newfile != se
+00032b00: 6c66 2e64 622e 6669 6c65 6e61 6d65 3a0d  lf.db.filename:.
+00032b10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00032b20: 2020 2020 2020 2020 2067 7569 6261 7365           guibase
+00032b30: 2e73 7461 7475 7328 2252 6563 6f76 6572  .status("Recover
+00032b40: 696e 6720 6461 7461 2066 726f 6d20 2573  ing data from %s
+00032b50: 2074 6f20 2573 2e22 2c0d 0a20 2020 2020   to %s.",..     
+00032b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032b80: 2020 7365 6c66 2e64 622e 6669 6c65 6e61    self.db.filena
+00032b90: 6d65 2c20 6e65 7766 696c 6529 0d0a 2020  me, newfile)..  
+00032ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032bb0: 2020 2020 2020 6d20 3d20 2252 6563 6f76        m = "Recov
+00032bc0: 6572 696e 6720 6461 7461 2066 726f 6d20  ering data from 
+00032bd0: 2573 5c6e 746f 2025 732e 220d 0a20 2020  %s\nto %s."..   
+00032be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032bf0: 2020 2020 2062 7573 7920 3d20 636f 6e74       busy = cont
+00032c00: 726f 6c73 2e42 7573 7950 616e 656c 2873  rols.BusyPanel(s
+00032c10: 656c 662c 206d 2025 2028 7365 6c66 2e64  elf, m % (self.d
+00032c20: 622c 206e 6577 6669 6c65 2929 0d0a 2020  b, newfile))..  
+00032c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032c40: 2020 2020 2020 7778 2e59 6965 6c64 4966        wx.YieldIf
+00032c50: 4e65 6564 6564 2829 0d0a 2020 2020 2020  Needed()..      
 00032c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032c70: 2020 2067 7569 6261 7365 2e73 7461 7475     guibase.statu
-00032c80: 7328 2252 6563 6f76 6572 7920 746f 2025  s("Recovery to %
-00032c90: 7320 636f 6d70 6c65 7465 2e22 2025 206e  s complete." % n
-00032ca0: 6577 6669 6c65 290d 0a20 2020 2020 2020  ewfile)..       
-00032cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032cc0: 2077 782e 4d65 7373 6167 6542 6f78 2822   wx.MessageBox("
-00032cd0: 5265 636f 7665 7279 2074 6f20 2573 2063  Recovery to %s c
-00032ce0: 6f6d 706c 6574 652e 2573 2220 250d 0a20  omplete.%s" %.. 
-00032cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032d10: 2020 2020 2028 6e65 7766 696c 652c 2065       (newfile, e
-00032d20: 7272 292c 2063 6f6e 662e 5469 746c 652c  rr), conf.Title,
-00032d30: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00032d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032d50: 2020 2020 2020 2020 7778 2e49 434f 4e5f          wx.ICON_
-00032d60: 494e 464f 524d 4154 494f 4e29 0d0a 2020  INFORMATION)..  
-00032d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032d80: 2020 2020 2020 7574 696c 2e73 7461 7274        util.start
-00032d90: 5f66 696c 6528 6f73 2e70 6174 682e 6469  _file(os.path.di
-00032da0: 726e 616d 6528 6e65 7766 696c 6529 290d  rname(newfile)).
-00032db0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00032dc0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-00032dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032de0: 2020 2020 7778 2e4d 6573 7361 6765 426f      wx.MessageBo
-00032df0: 7828 2243 616e 6e6f 7420 7265 636f 7665  x("Cannot recove
-00032e00: 7220 6461 7461 2066 726f 6d20 2573 2074  r data from %s t
-00032e10: 6f20 6974 7365 6c66 2e22 0d0a 2020 2020  o itself."..    
-00032e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032e40: 2020 2520 7365 6c66 2e64 622c 2063 6f6e    % self.db, con
-00032e50: 662e 5469 746c 652c 2077 782e 4943 4f4e  f.Title, wx.ICON
-00032e60: 5f57 4152 4e49 4e47 290d 0a0d 0a0d 0a20  _WARNING)...... 
-00032e70: 2020 2064 6566 2075 7064 6174 655f 6163     def update_ac
-00032e80: 636f 756e 7469 6e66 6f28 7365 6c66 293a  countinfo(self):
-00032e90: 0d0a 2020 2020 2020 2020 2222 2255 7064  ..        """Upd
-00032ea0: 6174 6573 2074 6865 2061 6363 6f75 6e74  ates the account
-00032eb0: 2069 6e66 6f72 6d61 7469 6f6e 2070 6167   information pag
-00032ec0: 652c 2063 6c65 6172 696e 6720 6974 7320  e, clearing its 
-00032ed0: 666f 726d 6572 2064 6174 612e 2222 220d  former data.""".
-00032ee0: 0a20 2020 2020 2020 2073 697a 6572 2c20  .        sizer, 
-00032ef0: 7061 6e65 6c20 3d20 7365 6c66 2e73 697a  panel = self.siz
-00032f00: 6572 5f61 6363 6f75 6e74 696e 666f 2c20  er_accountinfo, 
-00032f10: 7365 6c66 2e70 616e 656c 5f61 6363 6f75  self.panel_accou
-00032f20: 6e74 696e 666f 0d0a 2020 2020 2020 2020  ntinfo..        
-00032f30: 7061 6e65 6c2e 4672 6565 7a65 2829 0d0a  panel.Freeze()..
-00032f40: 2020 2020 2020 2020 6163 636f 756e 7420          account 
-00032f50: 3d20 7365 6c66 2e64 622e 6163 636f 756e  = self.db.accoun
-00032f60: 7420 6f72 207b 7d0d 0a20 2020 2020 2020  t or {}..       
-00032f70: 2069 6d67 203d 2073 6b79 7065 6461 7461   img = skypedata
-00032f80: 2e67 6574 5f61 7661 7461 7228 6163 636f  .get_avatar(acco
-00032f90: 756e 7429 0d0a 2020 2020 2020 2020 696d  unt)..        im
-00032fa0: 6720 3d20 696d 672e 436f 6e76 6572 7454  g = img.ConvertT
-00032fb0: 6f42 6974 6d61 7028 2920 6966 2069 6d67  oBitmap() if img
-00032fc0: 2065 6c73 6520 696d 6167 6573 2e41 7661   else images.Ava
-00032fd0: 7461 7244 6566 6175 6c74 4c61 7267 652e  tarDefaultLarge.
-00032fe0: 4269 746d 6170 0d0a 2020 2020 2020 2020  Bitmap..        
-00032ff0: 7365 6c66 2e62 6d70 5f61 6363 6f75 6e74  self.bmp_account
-00033000: 2e53 6574 4269 746d 6170 2869 6d67 290d  .SetBitmap(img).
-00033010: 0a20 2020 2020 2020 2063 7472 6c73 203d  .        ctrls =
-00033020: 205b 5d0d 0a20 2020 2020 2020 2066 6f72   []..        for
-00033030: 2078 2069 6e20 7369 7a65 722e 4368 696c   x in sizer.Chil
-00033040: 6472 656e 3a20 6374 726c 732e 6170 7065  dren: ctrls.appe
-00033050: 6e64 2878 2e57 696e 646f 7729 2c20 7369  nd(x.Window), si
-00033060: 7a65 722e 5265 6d6f 7665 2830 290d 0a20  zer.Remove(0).. 
-00033070: 2020 2020 2020 2066 6f72 2078 2069 6e20         for x in 
-00033080: 6374 726c 733a 2078 2e44 6573 7472 6f79  ctrls: x.Destroy
-00033090: 2829 0d0a 0d0a 2020 2020 2020 2020 666f  ()....        fo
-000330a0: 7220 6669 656c 6420 696e 2073 6b79 7065  r field in skype
-000330b0: 6461 7461 2e41 4343 4f55 4e54 5f46 4945  data.ACCOUNT_FIE
-000330c0: 4c44 5f54 4954 4c45 533a 0d0a 2020 2020  LD_TITLES:..    
-000330d0: 2020 2020 2020 2020 7661 6c75 6520 3d20          value = 
-000330e0: 736b 7970 6564 6174 612e 666f 726d 6174  skypedata.format
-000330f0: 5f63 6f6e 7461 6374 5f66 6965 6c64 2861  _contact_field(a
-00033100: 6363 6f75 6e74 2c20 6669 656c 6429 0d0a  ccount, field)..
-00033110: 2020 2020 2020 2020 2020 2020 6966 2076              if v
-00033120: 616c 7565 2069 7320 4e6f 6e65 3a20 636f  alue is None: co
-00033130: 6e74 696e 7565 2023 2066 6f72 2066 6965  ntinue # for fie
-00033140: 6c64 0d0a 0d0a 2020 2020 2020 2020 2020  ld....          
-00033150: 2020 7469 746c 6520 3d20 736b 7970 6564    title = skyped
-00033160: 6174 612e 4143 434f 554e 545f 4649 454c  ata.ACCOUNT_FIEL
-00033170: 445f 5449 544c 4553 2e67 6574 2866 6965  D_TITLES.get(fie
-00033180: 6c64 2c20 6669 656c 6429 0d0a 2020 2020  ld, field)..    
-00033190: 2020 2020 2020 2020 6c62 6c74 6578 7420          lbltext 
-000331a0: 3d20 7778 2e53 7461 7469 6354 6578 7428  = wx.StaticText(
-000331b0: 7061 7265 6e74 3d70 616e 656c 2c20 6c61  parent=panel, la
-000331c0: 6265 6c3d 2225 733a 2220 2520 7469 746c  bel="%s:" % titl
-000331d0: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
-000331e0: 7661 6c74 6578 7420 3d20 7778 2e54 6578  valtext = wx.Tex
-000331f0: 7443 7472 6c28 7061 7265 6e74 3d70 616e  tCtrl(parent=pan
-00033200: 656c 2c20 7661 6c75 653d 7661 6c75 652c  el, value=value,
-00033210: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00033220: 2020 7374 796c 653d 7778 2e4e 4f5f 424f    style=wx.NO_BO
-00033230: 5244 4552 207c 2077 782e 5445 5f4d 554c  RDER | wx.TE_MUL
-00033240: 5449 4c49 4e45 207c 2077 782e 5445 5f52  TILINE | wx.TE_R
-00033250: 4943 4829 0d0a 2020 2020 2020 2020 2020  ICH)..          
-00033260: 2020 436f 6c6f 7572 4d61 6e61 6765 722e    ColourManager.
-00033270: 4d61 6e61 6765 2876 616c 7465 7874 2c20  Manage(valtext, 
-00033280: 2242 6163 6b67 726f 756e 6443 6f6c 6f75  "BackgroundColou
-00033290: 7222 2c20 2242 6743 6f6c 6f75 7222 290d  r", "BgColour").
-000332a0: 0a20 2020 2020 2020 2020 2020 2076 616c  .            val
-000332b0: 7465 7874 2e4d 696e 5369 7a65 203d 2028  text.MinSize = (
-000332c0: 2d31 2c20 3335 290d 0a20 2020 2020 2020  -1, 35)..       
-000332d0: 2020 2020 2076 616c 7465 7874 2e53 6574       valtext.Set
-000332e0: 4564 6974 6162 6c65 2846 616c 7365 290d  Editable(False).
-000332f0: 0a20 2020 2020 2020 2020 2020 2043 6f6c  .            Col
-00033300: 6f75 724d 616e 6167 6572 2e4d 616e 6167  ourManager.Manag
-00033310: 6528 6c62 6c74 6578 742c 2022 466f 7265  e(lbltext, "Fore
-00033320: 6772 6f75 6e64 436f 6c6f 7572 222c 2022  groundColour", "
-00033330: 4469 7361 626c 6564 436f 6c6f 7572 2229  DisabledColour")
-00033340: 0d0a 2020 2020 2020 2020 2020 2020 7369  ..            si
-00033350: 7a65 722e 4164 6428 6c62 6c74 6578 742c  zer.Add(lbltext,
-00033360: 2062 6f72 6465 723d 352c 2066 6c61 673d   border=5, flag=
-00033370: 7778 2e4c 4546 5429 0d0a 2020 2020 2020  wx.LEFT)..      
-00033380: 2020 2020 2020 7369 7a65 722e 4164 6428        sizer.Add(
-00033390: 7661 6c74 6578 742c 2070 726f 706f 7274  valtext, proport
-000333a0: 696f 6e3d 312c 2066 6c61 673d 7778 2e47  ion=1, flag=wx.G
-000333b0: 524f 5729 0d0a 2020 2020 2020 2020 7061  ROW)..        pa
-000333c0: 6e65 6c2e 4c61 796f 7574 2829 0d0a 2020  nel.Layout()..  
-000333d0: 2020 2020 2020 7061 6e65 6c2e 5468 6177        panel.Thaw
-000333e0: 2829 0d0a 0d0a 0d0a 2020 2020 6465 6620  ()......    def 
-000333f0: 7361 7665 5f70 6167 655f 636f 6e66 2873  save_page_conf(s
-00033400: 656c 6629 3a0d 0a20 2020 2020 2020 2022  elf):..        "
-00033410: 2222 5361 7665 7320 7061 6765 206c 6173  ""Saves page las
-00033420: 7420 636f 6e66 6967 7572 6174 696f 6e20  t configuration 
-00033430: 6c69 6b65 2073 6561 7263 6820 7465 7874  like search text
-00033440: 2061 6e64 2072 6573 756c 7473 2e22 2222   and results."""
-00033450: 0d0a 0d0a 2020 2020 2020 2020 2320 5361  ....        # Sa
-00033460: 7665 2073 6561 7263 6820 626f 7820 7374  ve search box st
-00033470: 6174 650d 0a20 2020 2020 2020 2069 6620  ate..        if 
-00033480: 636f 6e66 2e53 6561 7263 6848 6973 746f  conf.SearchHisto
-00033490: 7279 5b2d 313a 5d20 3d3d 205b 2222 5d3a  ry[-1:] == [""]:
-000334a0: 2023 2043 6c65 6172 2065 6d70 7479 2073   # Clear empty s
-000334b0: 6561 7263 6820 666c 6167 0d0a 2020 2020  earch flag..    
-000334c0: 2020 2020 2020 2020 636f 6e66 2e53 6561          conf.Sea
-000334d0: 7263 6848 6973 746f 7279 203d 2063 6f6e  rchHistory = con
-000334e0: 662e 5365 6172 6368 4869 7374 6f72 795b  f.SearchHistory[
-000334f0: 3a2d 315d 0d0a 2020 2020 2020 2020 7574  :-1]..        ut
-00033500: 696c 2e61 6464 5f75 6e69 7175 6528 636f  il.add_unique(co
-00033510: 6e66 2e53 6561 7263 6848 6973 746f 7279  nf.SearchHistory
-00033520: 2c20 7365 6c66 2e65 6469 745f 7365 6172  , self.edit_sear
-00033530: 6368 616c 6c2e 5661 6c75 652c 0d0a 2020  chall.Value,..  
-00033540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033550: 2020 2020 2020 312c 2063 6f6e 662e 4d61        1, conf.Ma
-00033560: 7853 6561 7263 6848 6973 746f 7279 290d  xSearchHistory).
-00033570: 0a0d 0a20 2020 2020 2020 2023 2053 6176  ...        # Sav
-00033580: 6520 6c61 7374 2073 6561 7263 6820 7265  e last search re
-00033590: 7375 6c74 7320 4854 4d4c 0d0a 2020 2020  sults HTML..    
-000335a0: 2020 2020 7365 6172 6368 5f64 6174 6120      search_data 
-000335b0: 3d20 7365 6c66 2e68 746d 6c5f 7365 6172  = self.html_sear
-000335c0: 6368 616c 6c2e 4765 7441 6374 6976 6554  chall.GetActiveT
-000335d0: 6162 4461 7461 2829 0d0a 2020 2020 2020  abData()..      
-000335e0: 2020 6966 2073 6561 7263 685f 6461 7461    if search_data
-000335f0: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
-00033600: 6e66 6f20 3d20 7b7d 0d0a 2020 2020 2020  nfo = {}..      
-00033610: 2020 2020 2020 6966 2073 6561 7263 685f        if search_
-00033620: 6461 7461 2e67 6574 2822 696e 666f 2229  data.get("info")
-00033630: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00033640: 2020 2069 6e66 6f5b 226d 6170 225d 203d     info["map"] =
-00033650: 2073 6561 7263 685f 6461 7461 5b22 696e   search_data["in
-00033660: 666f 225d 2e67 6574 2822 6d61 7022 290d  fo"].get("map").
-00033670: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00033680: 2069 6e66 6f5b 2274 6578 7422 5d20 3d20   info["text"] = 
-00033690: 7365 6172 6368 5f64 6174 615b 2269 6e66  search_data["inf
-000336a0: 6f22 5d2e 6765 7428 2274 6578 7422 290d  o"].get("text").
-000336b0: 0a20 2020 2020 2020 2020 2020 2064 6174  .            dat
-000336c0: 6120 3d20 7b22 636f 6e74 656e 7422 3a20  a = {"content": 
-000336d0: 7365 6172 6368 5f64 6174 615b 2263 6f6e  search_data["con
-000336e0: 7465 6e74 225d 2c0d 0a20 2020 2020 2020  tent"],..       
-000336f0: 2020 2020 2020 2020 2020 2020 2022 6964               "id
-00033700: 223a 2073 6561 7263 685f 6461 7461 5b22  ": search_data["
-00033710: 6964 225d 2c20 2269 6e66 6f22 3a20 696e  id"], "info": in
-00033720: 666f 2c0d 0a20 2020 2020 2020 2020 2020  fo,..           
-00033730: 2020 2020 2020 2020 2022 7469 746c 6522           "title"
-00033740: 3a20 7365 6172 6368 5f64 6174 615b 2274  : search_data["t
-00033750: 6974 6c65 225d 2c20 7d0d 0a20 2020 2020  itle"], }..     
-00033760: 2020 2020 2020 2063 6f6e 662e 4c61 7374         conf.Last
-00033770: 5365 6172 6368 5265 7375 6c74 735b 7365  SearchResults[se
-00033780: 6c66 2e64 622e 6669 6c65 6e61 6d65 5d20  lf.db.filename] 
-00033790: 3d20 6461 7461 0d0a 2020 2020 2020 2020  = data..        
-000337a0: 656c 6966 2073 656c 662e 6462 2e66 696c  elif self.db.fil
-000337b0: 656e 616d 6520 696e 2063 6f6e 662e 4c61  ename in conf.La
-000337c0: 7374 5365 6172 6368 5265 7375 6c74 733a  stSearchResults:
-000337d0: 0d0a 2020 2020 2020 2020 2020 2020 6465  ..            de
-000337e0: 6c20 636f 6e66 2e4c 6173 7453 6561 7263  l conf.LastSearc
-000337f0: 6852 6573 756c 7473 5b73 656c 662e 6462  hResults[self.db
-00033800: 2e66 696c 656e 616d 655d 0d0a 0d0a 2020  .filename]....  
-00033810: 2020 2020 2020 2320 5361 7665 2070 6167        # Save pag
-00033820: 6520 5351 4c20 7769 6e64 6f77 2063 6f6e  e SQL window con
-00033830: 7465 6e74 2c20 6966 2063 6861 6e67 6564  tent, if changed
-00033840: 2066 726f 6d20 7072 6576 696f 7573 2076   from previous v
-00033850: 616c 7565 0d0a 2020 2020 2020 2020 7371  alue..        sq
-00033860: 6c5f 7465 7874 203d 2073 656c 662e 7374  l_text = self.st
-00033870: 635f 7371 6c2e 5465 7874 0d0a 2020 2020  c_sql.Text..    
-00033880: 2020 2020 6966 2073 716c 5f74 6578 7420      if sql_text 
-00033890: 213d 2063 6f6e 662e 5351 4c57 696e 646f  != conf.SQLWindo
-000338a0: 7754 6578 7473 2e67 6574 2873 656c 662e  wTexts.get(self.
-000338b0: 6462 2e66 696c 656e 616d 652c 2022 2229  db.filename, "")
-000338c0: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
-000338d0: 6620 7371 6c5f 7465 7874 3a0d 0a20 2020  f sql_text:..   
-000338e0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-000338f0: 662e 5351 4c57 696e 646f 7754 6578 7473  f.SQLWindowTexts
-00033900: 5b73 656c 662e 6462 2e66 696c 656e 616d  [self.db.filenam
-00033910: 655d 203d 2073 716c 5f74 6578 740d 0a20  e] = sql_text.. 
-00033920: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-00033930: 7365 6c66 2e64 622e 6669 6c65 6e61 6d65  self.db.filename
-00033940: 2069 6e20 636f 6e66 2e53 514c 5769 6e64   in conf.SQLWind
-00033950: 6f77 5465 7874 733a 0d0a 2020 2020 2020  owTexts:..      
-00033960: 2020 2020 2020 2020 2020 6465 6c20 636f            del co
-00033970: 6e66 2e53 514c 5769 6e64 6f77 5465 7874  nf.SQLWindowText
-00033980: 735b 7365 6c66 2e64 622e 6669 6c65 6e61  s[self.db.filena
-00033990: 6d65 5d0d 0a0d 0a0d 0a20 2020 2064 6566  me]......    def
-000339a0: 2075 7064 6174 655f 696e 666f 5f70 6167   update_info_pag
-000339b0: 6528 7365 6c66 2c20 7265 6c6f 6164 3d54  e(self, reload=T
-000339c0: 7275 6529 3a0d 0a20 2020 2020 2020 2022  rue):..        "
-000339d0: 2222 5570 6461 7465 7320 7468 6520 496e  ""Updates the In
-000339e0: 666f 726d 6174 696f 6e20 7061 6765 2077  formation page w
-000339f0: 6974 6820 6375 7272 656e 7420 6461 7461  ith current data
-00033a00: 2e22 2222 0d0a 2020 2020 2020 2020 6966  ."""..        if
-00033a10: 206e 6f74 2073 656c 663a 2072 6574 7572   not self: retur
-00033a20: 6e0d 0a20 2020 2020 2020 2073 656c 662e  n..        self.
-00033a30: 6275 7474 6f6e 5f72 6566 7265 7368 5f66  button_refresh_f
-00033a40: 696c 6569 6e66 6f2e 456e 6162 6c65 6420  ileinfo.Enabled 
-00033a50: 3d20 4661 6c73 650d 0a20 2020 2020 2020  = False..       
-00033a60: 2069 6620 7265 6c6f 6164 3a0d 0a20 2020   if reload:..   
-00033a70: 2020 2020 2020 2020 2073 656c 662e 6462           self.db
-00033a80: 2e63 6c65 6172 5f63 6163 6865 2829 0d0a  .clear_cache()..
-00033a90: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00033aa0: 2e64 622e 7570 6461 7465 5f66 696c 6569  .db.update_filei
-00033ab0: 6e66 6f28 290d 0a20 2020 2020 2020 2020  nfo()..         
-00033ac0: 2020 2073 656c 662e 6462 2e75 7064 6174     self.db.updat
-00033ad0: 655f 6163 636f 756e 7469 6e66 6f28 290d  e_accountinfo().
-00033ae0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00033af0: 662e 7570 6461 7465 5f61 6363 6f75 6e74  f.update_account
-00033b00: 696e 666f 2829 0d0a 2020 2020 2020 2020  info()..        
-00033b10: 666f 7220 6e61 6d65 2069 6e20 5b22 6368  for name in ["ch
-00033b20: 6174 7322 2c20 2263 6f6e 7461 6374 7322  ats", "contacts"
-00033b30: 2c20 226d 6573 7361 6765 7322 2c20 2274  , "messages", "t
-00033b40: 7261 6e73 6665 7273 222c 0d0a 2020 2020  ransfers",..    
-00033b50: 2020 2020 226c 6173 746d 6573 7361 6765      "lastmessage
-00033b60: 222c 2022 6669 7273 746d 6573 7361 6765  ", "firstmessage
-00033b70: 222c 2022 7369 7a65 222c 2022 6d6f 6469  ", "size", "modi
-00033b80: 6669 6564 222c 2022 7368 6131 222c 2022  fied", "sha1", "
-00033b90: 6d64 3522 5d3a 0d0a 2020 2020 2020 2020  md5"]:..        
-00033ba0: 2020 2020 6765 7461 7474 7228 7365 6c66      getattr(self
-00033bb0: 2c20 2265 6469 745f 696e 666f 5f25 7322  , "edit_info_%s"
-00033bc0: 2025 206e 616d 6529 2e56 616c 7565 203d   % name).Value =
-00033bd0: 2022 220d 0a20 2020 2020 2020 2073 7461   ""..        sta
-00033be0: 7473 203d 207b 7d0d 0a20 2020 2020 2020  ts = {}..       
-00033bf0: 2074 7279 3a0d 0a20 2020 2020 2020 2020   try:..         
-00033c00: 2020 2073 7461 7473 203d 2073 656c 662e     stats = self.
-00033c10: 6462 2e67 6574 5f67 656e 6572 616c 5f73  db.get_general_s
-00033c20: 7461 7469 7374 6963 7328 290d 0a20 2020  tatistics()..   
-00033c30: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
-00033c40: 7074 696f 6e3a 2070 6173 730d 0a20 2020  ption: pass..   
-00033c50: 2020 2020 2069 6620 7374 6174 733a 0d0a       if stats:..
-00033c60: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00033c70: 2e65 6469 745f 696e 666f 5f63 6861 7473  .edit_info_chats
-00033c80: 2e56 616c 7565 2020 2020 203d 2027 7b3a  .Value     = '{:
-00033c90: 2c7d 272e 666f 726d 6174 2873 7461 7473  ,}'.format(stats
-00033ca0: 5b22 6368 6174 7322 5d29 0d0a 2020 2020  ["chats"])..    
-00033cb0: 2020 2020 2020 2020 7365 6c66 2e65 6469          self.edi
-00033cc0: 745f 696e 666f 5f63 6f6e 7461 6374 732e  t_info_contacts.
-00033cd0: 5661 6c75 6520 203d 2027 7b3a 2c7d 272e  Value  = '{:,}'.
-00033ce0: 666f 726d 6174 2873 7461 7473 5b22 636f  format(stats["co
-00033cf0: 6e74 6163 7473 225d 290d 0a20 2020 2020  ntacts"])..     
-00033d00: 2020 2020 2020 2073 656c 662e 6564 6974         self.edit
-00033d10: 5f69 6e66 6f5f 6d65 7373 6167 6573 2e56  _info_messages.V
-00033d20: 616c 7565 2020 3d20 277b 3a2c 7d27 2e66  alue  = '{:,}'.f
-00033d30: 6f72 6d61 7428 7374 6174 735b 226d 6573  ormat(stats["mes
-00033d40: 7361 6765 7322 5d29 0d0a 2020 2020 2020  sages"])..      
-00033d50: 2020 2020 2020 7365 6c66 2e65 6469 745f        self.edit_
-00033d60: 696e 666f 5f74 7261 6e73 6665 7273 2e56  info_transfers.V
-00033d70: 616c 7565 203d 2027 7b3a 2c7d 272e 666f  alue = '{:,}'.fo
-00033d80: 726d 6174 2873 7461 7473 5b22 7472 616e  rmat(stats["tran
-00033d90: 7366 6572 7322 5d29 0d0a 2020 2020 2020  sfers"])..      
-00033da0: 2020 6966 2022 6d65 7373 6167 6573 5f66    if "messages_f
-00033db0: 726f 6d22 2069 6e20 7374 6174 733a 0d0a  rom" in stats:..
-00033dc0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00033dd0: 2e65 6469 745f 696e 666f 5f6d 6573 7361  .edit_info_messa
-00033de0: 6765 732e 5661 6c75 6520 2b3d 2022 2028  ges.Value += " (
-00033df0: 7b3a 2c7d 2073 656e 7420 616e 6420 7b3a  {:,} sent and {:
-00033e00: 2c7d 2072 6563 6569 7665 6429 222e 666f  ,} received)".fo
-00033e10: 726d 6174 280d 0a20 2020 2020 2020 2020  rmat(..         
-00033e20: 2020 2020 2020 2073 7461 7473 2e67 6574         stats.get
-00033e30: 2822 6d65 7373 6167 6573 5f66 726f 6d22  ("messages_from"
-00033e40: 2920 6f72 2030 2c20 7374 6174 732e 6765  ) or 0, stats.ge
-00033e50: 7428 226d 6573 7361 6765 735f 746f 2229  t("messages_to")
-00033e60: 206f 7220 3029 0d0a 2020 2020 2020 2020   or 0)..        
-00033e70: 7465 7874 203d 2022 220d 0a20 2020 2020  text = ""..     
-00033e80: 2020 2069 6620 226c 6173 746d 6573 7361     if "lastmessa
-00033e90: 6765 5f64 7422 2069 6e20 7374 6174 733a  ge_dt" in stats:
-00033ea0: 0d0a 2020 2020 2020 2020 2020 2020 7465  ..            te
-00033eb0: 7874 203d 2022 2528 6c61 7374 6d65 7373  xt = "%(lastmess
-00033ec0: 6167 655f 6474 2973 2025 286c 6173 746d  age_dt)s %(lastm
-00033ed0: 6573 7361 6765 5f66 726f 6d29 7322 2025  essage_from)s" %
-00033ee0: 2073 7461 7473 0d0a 2020 2020 2020 2020   stats..        
-00033ef0: 2020 2020 6966 2073 7461 7473 2e67 6574      if stats.get
-00033f00: 2822 6c61 7374 6d65 7373 6167 655f 736b  ("lastmessage_sk
-00033f10: 7970 656e 616d 6522 2920 3d3d 2073 656c  ypename") == sel
-00033f20: 662e 6462 2e69 6420 5c0d 0a20 2020 2020  f.db.id \..     
-00033f30: 2020 2020 2020 206f 7220 736b 7970 6564         or skyped
-00033f40: 6174 612e 4348 4154 535f 5459 5045 5f53  ata.CHATS_TYPE_S
-00033f50: 494e 474c 4520 213d 2073 7461 7473 2e67  INGLE != stats.g
-00033f60: 6574 2822 6c61 7374 6d65 7373 6167 655f  et("lastmessage_
-00033f70: 6368 6174 7479 7065 2229 3a0d 0a20 2020  chattype"):..   
-00033f80: 2020 2020 2020 2020 2020 2020 2074 6578               tex
-00033f90: 7420 2b3d 2022 2069 6e20 2528 6c61 7374  t += " in %(last
-00033fa0: 6d65 7373 6167 655f 6368 6174 2973 2220  message_chat)s" 
-00033fb0: 2520 7374 6174 730d 0a20 2020 2020 2020  % stats..       
-00033fc0: 2073 656c 662e 6564 6974 5f69 6e66 6f5f   self.edit_info_
-00033fd0: 6c61 7374 6d65 7373 6167 652e 5661 6c75  lastmessage.Valu
-00033fe0: 6520 3d20 7465 7874 0d0a 2020 2020 2020  e = text..      
-00033ff0: 2020 7465 7874 203d 2022 220d 0a20 2020    text = ""..   
-00034000: 2020 2020 2069 6620 2266 6972 7374 6d65       if "firstme
-00034010: 7373 6167 655f 6474 2220 696e 2073 7461  ssage_dt" in sta
-00034020: 7473 3a0d 0a20 2020 2020 2020 2020 2020  ts:..           
-00034030: 2074 6578 7420 3d20 2225 2866 6972 7374   text = "%(first
-00034040: 6d65 7373 6167 655f 6474 2973 2025 2866  message_dt)s %(f
-00034050: 6972 7374 6d65 7373 6167 655f 6672 6f6d  irstmessage_from
-00034060: 2973 2220 2520 7374 6174 730d 0a20 2020  )s" % stats..   
-00034070: 2020 2020 2020 2020 2069 6620 7374 6174           if stat
-00034080: 732e 6765 7428 2266 6972 7374 6d65 7373  s.get("firstmess
-00034090: 6167 655f 6368 6174 2229 205c 0d0a 2020  age_chat") \..  
-000340a0: 2020 2020 2020 2020 2020 616e 6420 2873            and (s
-000340b0: 7461 7473 2e67 6574 2822 6669 7273 746d  tats.get("firstm
-000340c0: 6573 7361 6765 5f73 6b79 7065 6e61 6d65  essage_skypename
-000340d0: 2229 203d 3d20 7365 6c66 2e64 622e 6964  ") == self.db.id
-000340e0: 0d0a 2020 2020 2020 2020 2020 2020 6f72  ..            or
-000340f0: 2073 6b79 7065 6461 7461 2e43 4841 5453   skypedata.CHATS
-00034100: 5f54 5950 455f 5349 4e47 4c45 2021 3d20  _TYPE_SINGLE != 
-00034110: 7374 6174 732e 6765 7428 2266 6972 7374  stats.get("first
-00034120: 6d65 7373 6167 655f 6368 6174 7479 7065  message_chattype
-00034130: 2229 293a 0d0a 2020 2020 2020 2020 2020  ")):..          
-00034140: 2020 2020 2020 7465 7874 202b 3d20 2220        text += " 
-00034150: 696e 2025 2866 6972 7374 6d65 7373 6167  in %(firstmessag
-00034160: 655f 6368 6174 2973 2220 2520 7374 6174  e_chat)s" % stat
-00034170: 730d 0a20 2020 2020 2020 2073 656c 662e  s..        self.
-00034180: 6564 6974 5f69 6e66 6f5f 6669 7273 746d  edit_info_firstm
-00034190: 6573 7361 6765 2e56 616c 7565 203d 2074  essage.Value = t
-000341a0: 6578 740d 0a0d 0a20 2020 2020 2020 2073  ext....        s
-000341b0: 656c 662e 6564 6974 5f69 6e66 6f5f 7369  elf.edit_info_si
-000341c0: 7a65 2e56 616c 7565 203d 2022 2573 2028  ze.Value = "%s (
-000341d0: 2573 2922 2025 205c 0d0a 2020 2020 2020  %s)" % \..      
-000341e0: 2020 2020 2020 2875 7469 6c2e 666f 726d        (util.form
-000341f0: 6174 5f62 7974 6573 2873 656c 662e 6462  at_bytes(self.db
-00034200: 2e66 696c 6573 697a 6529 2c0d 0a20 2020  .filesize),..   
-00034210: 2020 2020 2020 2020 2020 7574 696c 2e66            util.f
-00034220: 6f72 6d61 745f 6279 7465 7328 7365 6c66  ormat_bytes(self
-00034230: 2e64 622e 6669 6c65 7369 7a65 2c20 6d61  .db.filesize, ma
-00034240: 785f 756e 6974 733d 4661 6c73 6529 290d  x_units=False)).
-00034250: 0a20 2020 2020 2020 2073 656c 662e 6564  .        self.ed
-00034260: 6974 5f69 6e66 6f5f 6d6f 6469 6669 6564  it_info_modified
-00034270: 2e56 616c 7565 203d 205c 0d0a 2020 2020  .Value = \..    
-00034280: 2020 2020 2020 2020 7365 6c66 2e64 622e          self.db.
-00034290: 6c61 7374 5f6d 6f64 6966 6965 642e 7374  last_modified.st
-000342a0: 7266 7469 6d65 2822 2559 2d25 6d2d 2564  rftime("%Y-%m-%d
-000342b0: 2025 483a 254d 3a25 5322 290d 0a20 2020   %H:%M:%S")..   
-000342c0: 2020 2020 2042 4c4f 434b 5349 5a45 203d       BLOCKSIZE =
-000342d0: 2031 3034 3835 3736 0d0a 2020 2020 2020   1048576..      
-000342e0: 2020 7368 6131 2c20 6d64 3520 3d20 6861    sha1, md5 = ha
-000342f0: 7368 6c69 622e 7368 6131 2829 2c20 6861  shlib.sha1(), ha
-00034300: 7368 6c69 622e 6d64 3528 290d 0a20 2020  shlib.md5()..   
-00034310: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
-00034320: 2020 2020 2020 2077 6974 6820 6f70 656e         with open
-00034330: 2873 656c 662e 6462 2e66 696c 656e 616d  (self.db.filenam
-00034340: 652c 2022 7262 2229 2061 7320 663a 0d0a  e, "rb") as f:..
-00034350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00034360: 6275 6620 3d20 662e 7265 6164 2842 4c4f  buf = f.read(BLO
-00034370: 434b 5349 5a45 290d 0a20 2020 2020 2020  CKSIZE)..       
-00034380: 2020 2020 2020 2020 2077 6869 6c65 206c           while l
-00034390: 656e 2862 7566 293a 0d0a 2020 2020 2020  en(buf):..      
-000343a0: 2020 2020 2020 2020 2020 2020 2020 7368                sh
-000343b0: 6131 2e75 7064 6174 6528 6275 6629 2c20  a1.update(buf), 
-000343c0: 6d64 352e 7570 6461 7465 2862 7566 290d  md5.update(buf).
-000343d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000343e0: 2020 2020 2062 7566 203d 2066 2e72 6561       buf = f.rea
-000343f0: 6428 424c 4f43 4b53 495a 4529 0d0a 2020  d(BLOCKSIZE)..  
-00034400: 2020 2020 2020 2020 2020 7365 6c66 2e65            self.e
-00034410: 6469 745f 696e 666f 5f73 6861 312e 5661  dit_info_sha1.Va
-00034420: 6c75 6520 3d20 7368 6131 2e68 6578 6469  lue = sha1.hexdi
-00034430: 6765 7374 2829 0d0a 2020 2020 2020 2020  gest()..        
-00034440: 2020 2020 7365 6c66 2e65 6469 745f 696e      self.edit_in
-00034450: 666f 5f6d 6435 2e56 616c 7565 203d 206d  fo_md5.Value = m
-00034460: 6435 2e68 6578 6469 6765 7374 2829 0d0a  d5.hexdigest()..
-00034470: 2020 2020 2020 2020 6578 6365 7074 2045          except E
-00034480: 7863 6570 7469 6f6e 2061 7320 653a 0d0a  xception as e:..
-00034490: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000344a0: 2e65 6469 745f 696e 666f 5f73 6861 312e  .edit_info_sha1.
-000344b0: 5661 6c75 6520 3d20 7365 6c66 2e65 6469  Value = self.edi
-000344c0: 745f 696e 666f 5f6d 6435 2e56 616c 7565  t_info_md5.Value
-000344d0: 203d 2075 7469 6c2e 666f 726d 6174 5f65   = util.format_e
-000344e0: 7863 2865 290d 0a20 2020 2020 2020 2073  xc(e)..        s
-000344f0: 656c 662e 6275 7474 6f6e 5f63 6865 636b  elf.button_check
-00034500: 5f69 6e74 6567 7269 7479 2e45 6e61 626c  _integrity.Enabl
-00034510: 6564 203d 2054 7275 650d 0a20 2020 2020  ed = True..     
-00034520: 2020 2073 656c 662e 6275 7474 6f6e 5f72     self.button_r
-00034530: 6566 7265 7368 5f66 696c 6569 6e66 6f2e  efresh_fileinfo.
-00034540: 456e 6162 6c65 6420 3d20 5472 7565 0d0a  Enabled = True..
-00034550: 0d0a 0d0a 2020 2020 6465 6620 6f6e 5f72  ....    def on_r
-00034560: 6566 7265 7368 5f74 6162 6c65 7328 7365  efresh_tables(se
-00034570: 6c66 2c20 6576 656e 743d 4e6f 6e65 293a  lf, event=None):
-00034580: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
-00034590: 2020 2020 2020 2052 6566 7265 7368 6573         Refreshes
-000345a0: 2074 6865 2074 6162 6c65 2074 7265 6520   the table tree 
-000345b0: 616e 6420 6f70 656e 2074 6162 6c65 2064  and open table d
-000345c0: 6174 612e 2041 736b 7320 666f 7220 636f  ata. Asks for co
-000345d0: 6e66 6972 6d61 7469 6f6e 0d0a 2020 2020  nfirmation..    
-000345e0: 2020 2020 6966 2074 6865 7265 2061 7265      if there are
-000345f0: 2075 6e63 6f6d 6d69 7474 6564 2063 6861   uncommitted cha
-00034600: 6e67 6573 2e0d 0a20 2020 2020 2020 2022  nges...        "
-00034610: 2222 0d0a 2020 2020 2020 2020 646f 5f72  ""..        do_r
-00034620: 6566 7265 7368 2c20 756e 7361 7665 6420  efresh, unsaved 
-00034630: 3d20 5472 7565 2c20 7365 6c66 2e67 6574  = True, self.get
-00034640: 5f75 6e73 6176 6564 5f67 7269 6473 2829  _unsaved_grids()
-00034650: 0d0a 2020 2020 2020 2020 6966 2075 6e73  ..        if uns
-00034660: 6176 6564 3a0d 0a20 2020 2020 2020 2020  aved:..         
-00034670: 2020 2072 6573 706f 6e73 6520 3d20 7778     response = wx
-00034680: 2e4d 6573 7361 6765 426f 7828 2253 6f6d  .MessageBox("Som
-00034690: 6520 7461 626c 6573 2068 6176 6520 756e  e tables have un
-000346a0: 7361 7665 6420 6461 7461 2028 2573 292e  saved data (%s).
-000346b0: 5c6e 5c6e 220d 0a20 2020 2020 2020 2020  \n\n"..         
-000346c0: 2020 2020 2020 2022 5361 7665 2062 6566         "Save bef
-000346d0: 6f72 6520 7265 6672 6573 6869 6e67 2028  ore refreshing (
-000346e0: 6368 616e 6765 7320 7769 6c6c 2062 6520  changes will be 
-000346f0: 6c6f 7374 206f 7468 6572 7769 7365 293f  lost otherwise)?
-00034700: 220d 0a20 2020 2020 2020 2020 2020 2020  "..             
-00034710: 2020 2025 2028 222c 2022 2e6a 6f69 6e28     % (", ".join(
-00034720: 736f 7274 6564 2878 2e74 6162 6c65 2066  sorted(x.table f
-00034730: 6f72 2078 2069 6e20 756e 7361 7665 6429  or x in unsaved)
-00034740: 2929 2c20 636f 6e66 2e54 6974 6c65 2c0d  )), conf.Title,.
-00034750: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00034760: 2077 782e 5945 5320 7c20 7778 2e4e 4f20   wx.YES | wx.NO 
-00034770: 7c20 7778 2e43 414e 4345 4c20 7c20 7778  | wx.CANCEL | wx
-00034780: 2e49 434f 4e5f 494e 464f 524d 4154 494f  .ICON_INFORMATIO
-00034790: 4e29 0d0a 2020 2020 2020 2020 2020 2020  N)..            
-000347a0: 6966 2077 782e 5945 5320 3d3d 2072 6573  if wx.YES == res
-000347b0: 706f 6e73 653a 0d0a 2020 2020 2020 2020  ponse:..        
-000347c0: 2020 2020 2020 2020 646f 5f72 6566 7265          do_refre
-000347d0: 7368 203d 2073 656c 662e 7361 7665 5f75  sh = self.save_u
-000347e0: 6e73 6176 6564 5f67 7269 6473 2829 0d0a  nsaved_grids()..
-000347f0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-00034800: 2077 782e 4341 4e43 454c 203d 3d20 7265   wx.CANCEL == re
-00034810: 7370 6f6e 7365 3a0d 0a20 2020 2020 2020  sponse:..       
-00034820: 2020 2020 2020 2020 2064 6f5f 7265 6672           do_refr
-00034830: 6573 6820 3d20 4661 6c73 650d 0a20 2020  esh = False..   
-00034840: 2020 2020 2069 6620 6e6f 7420 646f 5f72       if not do_r
-00034850: 6566 7265 7368 3a20 7265 7475 726e 0d0a  efresh: return..
-00034860: 0d0a 2020 2020 2020 2020 7365 6c66 2e64  ..        self.d
-00034870: 622e 636c 6561 725f 6361 6368 6528 290d  b.clear_cache().
-00034880: 0a20 2020 2020 2020 2073 656c 662e 6c6f  .        self.lo
-00034890: 6164 5f74 6162 6c65 735f 6461 7461 2872  ad_tables_data(r
-000348a0: 656c 6f61 643d 5472 7565 290d 0a20 2020  eload=True)..   
-000348b0: 2020 2020 2069 6620 7365 6c66 2e67 7269       if self.gri
-000348c0: 645f 7461 626c 652e 5461 626c 653a 0d0a  d_table.Table:..
-000348d0: 2020 2020 2020 2020 2020 2020 6772 6964              grid
-000348e0: 2c20 7461 626c 655f 6e61 6d65 203d 2073  , table_name = s
-000348f0: 656c 662e 6772 6964 5f74 6162 6c65 2c20  elf.grid_table, 
-00034900: 7365 6c66 2e67 7269 645f 7461 626c 652e  self.grid_table.
-00034910: 5461 626c 652e 7461 626c 650d 0a20 2020  Table.table..   
-00034920: 2020 2020 2020 2020 2073 6372 6f6c 6c70           scrollp
-00034930: 6f73 203d 206d 6170 2867 7269 642e 4765  os = map(grid.Ge
-00034940: 7453 6372 6f6c 6c50 6f73 2c20 5b77 782e  tScrollPos, [wx.
-00034950: 484f 5249 5a4f 4e54 414c 2c20 7778 2e56  HORIZONTAL, wx.V
-00034960: 4552 5449 4341 4c5d 290d 0a20 2020 2020  ERTICAL])..     
-00034970: 2020 2020 2020 2063 7572 736f 7270 6f73         cursorpos
-00034980: 203d 2067 7269 642e 4772 6964 4375 7273   = grid.GridCurs
-00034990: 6f72 436f 6c2c 2067 7269 642e 4772 6964  orCol, grid.Grid
-000349a0: 4375 7273 6f72 526f 770d 0a20 2020 2020  CursorRow..     
-000349b0: 2020 2020 2020 2073 656c 662e 6f6e 5f63         self.on_c
-000349c0: 6861 6e67 655f 7461 626c 6528 4e6f 6e65  hange_table(None
-000349d0: 290d 0a20 2020 2020 2020 2020 2020 2067  )..            g
-000349e0: 7269 642e 5461 626c 6520 3d20 4e6f 6e65  rid.Table = None
-000349f0: 2023 2052 6573 6574 2067 7269 6420 6461   # Reset grid da
-00034a00: 7461 2074 6f20 656d 7074 790d 0a20 2020  ta to empty..   
-00034a10: 2020 2020 2020 2020 2067 7269 642e 4672           grid.Fr
-00034a20: 6565 7a65 2829 0d0a 2020 2020 2020 2020  eeze()..        
-00034a30: 2020 2020 7365 6c66 2e64 625f 6772 6964      self.db_grid
-00034a40: 732e 636c 6561 7228 290d 0a0d 0a20 2020  s.clear()....   
-00034a50: 2020 2020 2020 2020 2074 6162 6c65 6974           tableit
-00034a60: 656d 203d 204e 6f6e 650d 0a20 2020 2020  em = None..     
-00034a70: 2020 2020 2020 2074 6162 6c65 5f6e 616d         table_nam
-00034a80: 6520 3d20 7461 626c 655f 6e61 6d65 2e6c  e = table_name.l
-00034a90: 6f77 6572 2829 0d0a 2020 2020 2020 2020  ower()..        
-00034aa0: 2020 2020 7461 626c 6520 3d20 6e65 7874      table = next
-00034ab0: 2828 7420 666f 7220 7420 696e 2073 656c  ((t for t in sel
-00034ac0: 662e 6462 2e67 6574 5f74 6162 6c65 7328  f.db.get_tables(
-00034ad0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00034ae0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00034af0: 745b 226e 616d 6522 5d2e 6c6f 7765 7228  t["name"].lower(
-00034b00: 2920 3d3d 2074 6162 6c65 5f6e 616d 6529  ) == table_name)
-00034b10: 2c20 4e6f 6e65 290d 0a20 2020 2020 2020  , None)..       
-00034b20: 2020 2020 2069 7465 6d20 3d20 7365 6c66       item = self
-00034b30: 2e74 7265 655f 7461 626c 6573 2e47 6574  .tree_tables.Get
-00034b40: 4e65 7874 2873 656c 662e 7472 6565 5f74  Next(self.tree_t
-00034b50: 6162 6c65 732e 4765 7452 6f6f 7449 7465  ables.GetRootIte
-00034b60: 6d28 2929 0d0a 2020 2020 2020 2020 2020  m())..          
-00034b70: 2020 7768 696c 6520 7461 626c 6520 616e    while table an
-00034b80: 6420 6974 656d 2061 6e64 2069 7465 6d2e  d item and item.
-00034b90: 4973 4f6b 2829 3a0d 0a20 2020 2020 2020  IsOk():..       
-00034ba0: 2020 2020 2020 2020 2074 6162 6c65 3220           table2 
-00034bb0: 3d20 7365 6c66 2e74 7265 655f 7461 626c  = self.tree_tabl
-00034bc0: 6573 2e47 6574 4974 656d 5079 4461 7461  es.GetItemPyData
-00034bd0: 2869 7465 6d29 0d0a 2020 2020 2020 2020  (item)..        
-00034be0: 2020 2020 2020 2020 6966 2074 6162 6c65          if table
-00034bf0: 3220 616e 6420 7461 626c 6532 2e6c 6f77  2 and table2.low
-00034c00: 6572 2829 203d 3d20 7461 626c 655b 226e  er() == table["n
-00034c10: 616d 6522 5d2e 6c6f 7765 7228 293a 0d0a  ame"].lower():..
-00034c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032c70: 2020 7472 793a 0d0a 2020 2020 2020 2020    try:..        
+00032c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032c90: 2020 2020 636f 7079 6572 726f 7273 203d      copyerrors =
+00032ca0: 2073 656c 662e 6462 2e72 6563 6f76 6572   self.db.recover
+00032cb0: 5f64 6174 6128 6e65 7766 696c 6529 0d0a  _data(newfile)..
+00032cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032cd0: 2020 2020 2020 2020 6669 6e61 6c6c 793a          finally:
+00032ce0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00032cf0: 2020 2020 2020 2020 2020 2020 2020 6275                bu
+00032d00: 7379 2e43 6c6f 7365 2829 0d0a 2020 2020  sy.Close()..    
+00032d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032d20: 2020 2020 6572 7220 3d20 2822 5c6e 5c6e      err = ("\n\n
+00032d30: 4572 726f 7273 206f 6363 7572 7265 6420  Errors occurred 
+00032d40: 6475 7269 6e67 2074 6865 2072 6563 6f76  during the recov
+00032d50: 6572 792c 2022 0d0a 2020 2020 2020 2020  ery, "..        
+00032d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032d70: 2020 2020 2020 226d 6f72 6520 6465 7461        "more deta
+00032d80: 696c 7320 696e 206c 6f67 2077 696e 646f  ils in log windo
+00032d90: 773a 5c6e 5c6e 2d20 220d 0a20 2020 2020  w:\n\n- "..     
+00032da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032db0: 2020 2020 2020 2020 202b 2022 5c6e 2d20           + "\n- 
+00032dc0: 222e 6a6f 696e 2863 6f70 7965 7272 6f72  ".join(copyerror
+00032dd0: 7329 2920 6966 2063 6f70 7965 7272 6f72  s)) if copyerror
+00032de0: 7320 656c 7365 2022 220d 0a20 2020 2020  s else ""..     
+00032df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032e00: 2020 2065 7272 203d 2065 7272 5b3a 3530     err = err[:50
+00032e10: 305d 202b 2022 2e2e 2220 6966 206c 656e  0] + ".." if len
+00032e20: 2865 7272 2920 3e20 3530 3020 656c 7365  (err) > 500 else
+00032e30: 2065 7272 0d0a 2020 2020 2020 2020 2020   err..          
+00032e40: 2020 2020 2020 2020 2020 2020 2020 6775                gu
+00032e50: 6962 6173 652e 7374 6174 7573 2822 5265  ibase.status("Re
+00032e60: 636f 7665 7279 2074 6f20 2573 2063 6f6d  covery to %s com
+00032e70: 706c 6574 652e 2220 2520 6e65 7766 696c  plete." % newfil
+00032e80: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+00032e90: 2020 2020 2020 2020 2020 2020 7778 2e4d              wx.M
+00032ea0: 6573 7361 6765 426f 7828 2252 6563 6f76  essageBox("Recov
+00032eb0: 6572 7920 746f 2025 7320 636f 6d70 6c65  ery to %s comple
+00032ec0: 7465 2e25 7322 2025 0d0a 2020 2020 2020  te.%s" %..      
+00032ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032ef0: 286e 6577 6669 6c65 2c20 6572 7229 2c20  (newfile, err), 
+00032f00: 636f 6e66 2e54 6974 6c65 2c0d 0a20 2020  conf.Title,..   
+00032f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032f30: 2020 2077 782e 4943 4f4e 5f49 4e46 4f52     wx.ICON_INFOR
+00032f40: 4d41 5449 4f4e 290d 0a20 2020 2020 2020  MATION)..       
+00032f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032f60: 2075 7469 6c2e 7374 6172 745f 6669 6c65   util.start_file
+00032f70: 286f 732e 7061 7468 2e64 6972 6e61 6d65  (os.path.dirname
+00032f80: 286e 6577 6669 6c65 2929 0d0a 2020 2020  (newfile))..    
+00032f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032fa0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+00032fb0: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+00032fc0: 782e 4d65 7373 6167 6542 6f78 2822 4361  x.MessageBox("Ca
+00032fd0: 6e6e 6f74 2072 6563 6f76 6572 2064 6174  nnot recover dat
+00032fe0: 6120 6672 6f6d 2025 7320 746f 2069 7473  a from %s to its
+00032ff0: 656c 662e 220d 0a20 2020 2020 2020 2020  elf."..         
+00033000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033010: 2020 2020 2020 2020 2020 2020 2025 2073               % s
+00033020: 656c 662e 6462 2c20 636f 6e66 2e54 6974  elf.db, conf.Tit
+00033030: 6c65 2c20 7778 2e49 434f 4e5f 5741 524e  le, wx.ICON_WARN
+00033040: 494e 4729 0d0a 0d0a 0d0a 2020 2020 6465  ING)......    de
+00033050: 6620 7570 6461 7465 5f61 6363 6f75 6e74  f update_account
+00033060: 696e 666f 2873 656c 6629 3a0d 0a20 2020  info(self):..   
+00033070: 2020 2020 2022 2222 5570 6461 7465 7320       """Updates 
+00033080: 7468 6520 6163 636f 756e 7420 696e 666f  the account info
+00033090: 726d 6174 696f 6e20 7061 6765 2c20 636c  rmation page, cl
+000330a0: 6561 7269 6e67 2069 7473 2066 6f72 6d65  earing its forme
+000330b0: 7220 6461 7461 2e22 2222 0d0a 2020 2020  r data."""..    
+000330c0: 2020 2020 7369 7a65 722c 2070 616e 656c      sizer, panel
+000330d0: 203d 2073 656c 662e 7369 7a65 725f 6163   = self.sizer_ac
+000330e0: 636f 756e 7469 6e66 6f2c 2073 656c 662e  countinfo, self.
+000330f0: 7061 6e65 6c5f 6163 636f 756e 7469 6e66  panel_accountinf
+00033100: 6f0d 0a20 2020 2020 2020 2070 616e 656c  o..        panel
+00033110: 2e46 7265 657a 6528 290d 0a20 2020 2020  .Freeze()..     
+00033120: 2020 2061 6363 6f75 6e74 203d 2073 656c     account = sel
+00033130: 662e 6462 2e61 6363 6f75 6e74 206f 7220  f.db.account or 
+00033140: 7b7d 0d0a 2020 2020 2020 2020 696d 6720  {}..        img 
+00033150: 3d20 736b 7970 6564 6174 612e 6765 745f  = skypedata.get_
+00033160: 6176 6174 6172 2861 6363 6f75 6e74 290d  avatar(account).
+00033170: 0a20 2020 2020 2020 2069 6d67 203d 2069  .        img = i
+00033180: 6d67 2e43 6f6e 7665 7274 546f 4269 746d  mg.ConvertToBitm
+00033190: 6170 2829 2069 6620 696d 6720 656c 7365  ap() if img else
+000331a0: 2069 6d61 6765 732e 4176 6174 6172 4465   images.AvatarDe
+000331b0: 6661 756c 744c 6172 6765 2e42 6974 6d61  faultLarge.Bitma
+000331c0: 700d 0a20 2020 2020 2020 2073 656c 662e  p..        self.
+000331d0: 626d 705f 6163 636f 756e 742e 5365 7442  bmp_account.SetB
+000331e0: 6974 6d61 7028 696d 6729 0d0a 2020 2020  itmap(img)..    
+000331f0: 2020 2020 6374 726c 7320 3d20 5b5d 0d0a      ctrls = []..
+00033200: 2020 2020 2020 2020 666f 7220 7820 696e          for x in
+00033210: 2073 697a 6572 2e43 6869 6c64 7265 6e3a   sizer.Children:
+00033220: 2063 7472 6c73 2e61 7070 656e 6428 782e   ctrls.append(x.
+00033230: 5769 6e64 6f77 292c 2073 697a 6572 2e52  Window), sizer.R
+00033240: 656d 6f76 6528 3029 0d0a 2020 2020 2020  emove(0)..      
+00033250: 2020 666f 7220 7820 696e 2063 7472 6c73    for x in ctrls
+00033260: 3a20 782e 4465 7374 726f 7928 290d 0a0d  : x.Destroy()...
+00033270: 0a20 2020 2020 2020 2066 6f72 2066 6965  .        for fie
+00033280: 6c64 2069 6e20 736b 7970 6564 6174 612e  ld in skypedata.
+00033290: 4143 434f 554e 545f 4649 454c 445f 5449  ACCOUNT_FIELD_TI
+000332a0: 544c 4553 3a0d 0a20 2020 2020 2020 2020  TLES:..         
+000332b0: 2020 2076 616c 7565 203d 2073 6b79 7065     value = skype
+000332c0: 6461 7461 2e66 6f72 6d61 745f 636f 6e74  data.format_cont
+000332d0: 6163 745f 6669 656c 6428 6163 636f 756e  act_field(accoun
+000332e0: 742c 2066 6965 6c64 290d 0a20 2020 2020  t, field)..     
+000332f0: 2020 2020 2020 2069 6620 7661 6c75 6520         if value 
+00033300: 6973 204e 6f6e 653a 2063 6f6e 7469 6e75  is None: continu
+00033310: 6520 2320 666f 7220 6669 656c 640d 0a0d  e # for field...
+00033320: 0a20 2020 2020 2020 2020 2020 2074 6974  .            tit
+00033330: 6c65 203d 2073 6b79 7065 6461 7461 2e41  le = skypedata.A
+00033340: 4343 4f55 4e54 5f46 4945 4c44 5f54 4954  CCOUNT_FIELD_TIT
+00033350: 4c45 532e 6765 7428 6669 656c 642c 2066  LES.get(field, f
+00033360: 6965 6c64 290d 0a20 2020 2020 2020 2020  ield)..         
+00033370: 2020 206c 626c 7465 7874 203d 2077 782e     lbltext = wx.
+00033380: 5374 6174 6963 5465 7874 2870 6172 656e  StaticText(paren
+00033390: 743d 7061 6e65 6c2c 206c 6162 656c 3d22  t=panel, label="
+000333a0: 2573 3a22 2025 2074 6974 6c65 290d 0a20  %s:" % title).. 
+000333b0: 2020 2020 2020 2020 2020 2076 616c 7465             valte
+000333c0: 7874 203d 2077 782e 5465 7874 4374 726c  xt = wx.TextCtrl
+000333d0: 2870 6172 656e 743d 7061 6e65 6c2c 2076  (parent=panel, v
+000333e0: 616c 7565 3d76 616c 7565 2c0d 0a20 2020  alue=value,..   
+000333f0: 2020 2020 2020 2020 2020 2020 2073 7479               sty
+00033400: 6c65 3d77 782e 4e4f 5f42 4f52 4445 5220  le=wx.NO_BORDER 
+00033410: 7c20 7778 2e54 455f 4d55 4c54 494c 494e  | wx.TE_MULTILIN
+00033420: 4520 7c20 7778 2e54 455f 5249 4348 290d  E | wx.TE_RICH).
+00033430: 0a20 2020 2020 2020 2020 2020 2043 6f6c  .            Col
+00033440: 6f75 724d 616e 6167 6572 2e4d 616e 6167  ourManager.Manag
+00033450: 6528 7661 6c74 6578 742c 2022 4261 636b  e(valtext, "Back
+00033460: 6772 6f75 6e64 436f 6c6f 7572 222c 2022  groundColour", "
+00033470: 4267 436f 6c6f 7572 2229 0d0a 2020 2020  BgColour")..    
+00033480: 2020 2020 2020 2020 7661 6c74 6578 742e          valtext.
+00033490: 4d69 6e53 697a 6520 3d20 282d 312c 2033  MinSize = (-1, 3
+000334a0: 3529 0d0a 2020 2020 2020 2020 2020 2020  5)..            
+000334b0: 7661 6c74 6578 742e 5365 7445 6469 7461  valtext.SetEdita
+000334c0: 626c 6528 4661 6c73 6529 0d0a 2020 2020  ble(False)..    
+000334d0: 2020 2020 2020 2020 436f 6c6f 7572 4d61          ColourMa
+000334e0: 6e61 6765 722e 4d61 6e61 6765 286c 626c  nager.Manage(lbl
+000334f0: 7465 7874 2c20 2246 6f72 6567 726f 756e  text, "Foregroun
+00033500: 6443 6f6c 6f75 7222 2c20 2244 6973 6162  dColour", "Disab
+00033510: 6c65 6443 6f6c 6f75 7222 290d 0a20 2020  ledColour")..   
+00033520: 2020 2020 2020 2020 2073 697a 6572 2e41           sizer.A
+00033530: 6464 286c 626c 7465 7874 2c20 626f 7264  dd(lbltext, bord
+00033540: 6572 3d35 2c20 666c 6167 3d77 782e 4c45  er=5, flag=wx.LE
+00033550: 4654 290d 0a20 2020 2020 2020 2020 2020  FT)..           
+00033560: 2073 697a 6572 2e41 6464 2876 616c 7465   sizer.Add(valte
+00033570: 7874 2c20 7072 6f70 6f72 7469 6f6e 3d31  xt, proportion=1
+00033580: 2c20 666c 6167 3d77 782e 4752 4f57 290d  , flag=wx.GROW).
+00033590: 0a20 2020 2020 2020 2070 616e 656c 2e4c  .        panel.L
+000335a0: 6179 6f75 7428 290d 0a20 2020 2020 2020  ayout()..       
+000335b0: 2070 616e 656c 2e54 6861 7728 290d 0a0d   panel.Thaw()...
+000335c0: 0a0d 0a20 2020 2064 6566 2073 6176 655f  ...    def save_
+000335d0: 7061 6765 5f63 6f6e 6628 7365 6c66 293a  page_conf(self):
+000335e0: 0d0a 2020 2020 2020 2020 2222 2253 6176  ..        """Sav
+000335f0: 6573 2070 6167 6520 6c61 7374 2063 6f6e  es page last con
+00033600: 6669 6775 7261 7469 6f6e 206c 696b 6520  figuration like 
+00033610: 7365 6172 6368 2074 6578 7420 616e 6420  search text and 
+00033620: 7265 7375 6c74 732e 2222 220d 0a0d 0a20  results.""".... 
+00033630: 2020 2020 2020 2023 2053 6176 6520 7365         # Save se
+00033640: 6172 6368 2062 6f78 2073 7461 7465 0d0a  arch box state..
+00033650: 2020 2020 2020 2020 6966 2063 6f6e 662e          if conf.
+00033660: 5365 6172 6368 4869 7374 6f72 795b 2d31  SearchHistory[-1
+00033670: 3a5d 203d 3d20 5b22 225d 3a20 2320 436c  :] == [""]: # Cl
+00033680: 6561 7220 656d 7074 7920 7365 6172 6368  ear empty search
+00033690: 2066 6c61 670d 0a20 2020 2020 2020 2020   flag..         
+000336a0: 2020 2063 6f6e 662e 5365 6172 6368 4869     conf.SearchHi
+000336b0: 7374 6f72 7920 3d20 636f 6e66 2e53 6561  story = conf.Sea
+000336c0: 7263 6848 6973 746f 7279 5b3a 2d31 5d0d  rchHistory[:-1].
+000336d0: 0a20 2020 2020 2020 2075 7469 6c2e 6164  .        util.ad
+000336e0: 645f 756e 6971 7565 2863 6f6e 662e 5365  d_unique(conf.Se
+000336f0: 6172 6368 4869 7374 6f72 792c 2073 656c  archHistory, sel
+00033700: 662e 6564 6974 5f73 6561 7263 6861 6c6c  f.edit_searchall
+00033710: 2e56 616c 7565 2c0d 0a20 2020 2020 2020  .Value,..       
+00033720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033730: 2031 2c20 636f 6e66 2e4d 6178 5365 6172   1, conf.MaxSear
+00033740: 6368 4869 7374 6f72 7929 0d0a 0d0a 2020  chHistory)....  
+00033750: 2020 2020 2020 2320 5361 7665 206c 6173        # Save las
+00033760: 7420 7365 6172 6368 2072 6573 756c 7473  t search results
+00033770: 2048 544d 4c0d 0a20 2020 2020 2020 2073   HTML..        s
+00033780: 6561 7263 685f 6461 7461 203d 2073 656c  earch_data = sel
+00033790: 662e 6874 6d6c 5f73 6561 7263 6861 6c6c  f.html_searchall
+000337a0: 2e47 6574 4163 7469 7665 5461 6244 6174  .GetActiveTabDat
+000337b0: 6128 290d 0a20 2020 2020 2020 2069 6620  a()..        if 
+000337c0: 7365 6172 6368 5f64 6174 613a 0d0a 2020  search_data:..  
+000337d0: 2020 2020 2020 2020 2020 696e 666f 203d            info =
+000337e0: 207b 7d0d 0a20 2020 2020 2020 2020 2020   {}..           
+000337f0: 2069 6620 7365 6172 6368 5f64 6174 612e   if search_data.
+00033800: 6765 7428 2269 6e66 6f22 293a 0d0a 2020  get("info"):..  
+00033810: 2020 2020 2020 2020 2020 2020 2020 696e                in
+00033820: 666f 5b22 6d61 7022 5d20 3d20 7365 6172  fo["map"] = sear
+00033830: 6368 5f64 6174 615b 2269 6e66 6f22 5d2e  ch_data["info"].
+00033840: 6765 7428 226d 6170 2229 0d0a 2020 2020  get("map")..    
+00033850: 2020 2020 2020 2020 2020 2020 696e 666f              info
+00033860: 5b22 7465 7874 225d 203d 2073 6561 7263  ["text"] = searc
+00033870: 685f 6461 7461 5b22 696e 666f 225d 2e67  h_data["info"].g
+00033880: 6574 2822 7465 7874 2229 0d0a 2020 2020  et("text")..    
+00033890: 2020 2020 2020 2020 6461 7461 203d 207b          data = {
+000338a0: 2263 6f6e 7465 6e74 223a 2073 6561 7263  "content": searc
+000338b0: 685f 6461 7461 5b22 636f 6e74 656e 7422  h_data["content"
+000338c0: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
+000338d0: 2020 2020 2020 2020 2269 6422 3a20 7365          "id": se
+000338e0: 6172 6368 5f64 6174 615b 2269 6422 5d2c  arch_data["id"],
+000338f0: 2022 696e 666f 223a 2069 6e66 6f2c 0d0a   "info": info,..
+00033900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033910: 2020 2020 2274 6974 6c65 223a 2073 6561      "title": sea
+00033920: 7263 685f 6461 7461 5b22 7469 746c 6522  rch_data["title"
+00033930: 5d2c 207d 0d0a 2020 2020 2020 2020 2020  ], }..          
+00033940: 2020 636f 6e66 2e4c 6173 7453 6561 7263    conf.LastSearc
+00033950: 6852 6573 756c 7473 5b73 656c 662e 6462  hResults[self.db
+00033960: 2e66 696c 656e 616d 655d 203d 2064 6174  .filename] = dat
+00033970: 610d 0a20 2020 2020 2020 2065 6c69 6620  a..        elif 
+00033980: 7365 6c66 2e64 622e 6669 6c65 6e61 6d65  self.db.filename
+00033990: 2069 6e20 636f 6e66 2e4c 6173 7453 6561   in conf.LastSea
+000339a0: 7263 6852 6573 756c 7473 3a0d 0a20 2020  rchResults:..   
+000339b0: 2020 2020 2020 2020 2064 656c 2063 6f6e           del con
+000339c0: 662e 4c61 7374 5365 6172 6368 5265 7375  f.LastSearchResu
+000339d0: 6c74 735b 7365 6c66 2e64 622e 6669 6c65  lts[self.db.file
+000339e0: 6e61 6d65 5d0d 0a0d 0a20 2020 2020 2020  name]....       
+000339f0: 2023 2053 6176 6520 7061 6765 2053 514c   # Save page SQL
+00033a00: 2077 696e 646f 7720 636f 6e74 656e 742c   window content,
+00033a10: 2069 6620 6368 616e 6765 6420 6672 6f6d   if changed from
+00033a20: 2070 7265 7669 6f75 7320 7661 6c75 650d   previous value.
+00033a30: 0a20 2020 2020 2020 2073 716c 5f74 6578  .        sql_tex
+00033a40: 7420 3d20 7365 6c66 2e73 7463 5f73 716c  t = self.stc_sql
+00033a50: 2e54 6578 740d 0a20 2020 2020 2020 2069  .Text..        i
+00033a60: 6620 7371 6c5f 7465 7874 2021 3d20 636f  f sql_text != co
+00033a70: 6e66 2e53 514c 5769 6e64 6f77 5465 7874  nf.SQLWindowText
+00033a80: 732e 6765 7428 7365 6c66 2e64 622e 6669  s.get(self.db.fi
+00033a90: 6c65 6e61 6d65 2c20 2222 293a 0d0a 2020  lename, ""):..  
+00033aa0: 2020 2020 2020 2020 2020 6966 2073 716c            if sql
+00033ab0: 5f74 6578 743a 0d0a 2020 2020 2020 2020  _text:..        
+00033ac0: 2020 2020 2020 2020 636f 6e66 2e53 514c          conf.SQL
+00033ad0: 5769 6e64 6f77 5465 7874 735b 7365 6c66  WindowTexts[self
+00033ae0: 2e64 622e 6669 6c65 6e61 6d65 5d20 3d20  .db.filename] = 
+00033af0: 7371 6c5f 7465 7874 0d0a 2020 2020 2020  sql_text..      
+00033b00: 2020 2020 2020 656c 6966 2073 656c 662e        elif self.
+00033b10: 6462 2e66 696c 656e 616d 6520 696e 2063  db.filename in c
+00033b20: 6f6e 662e 5351 4c57 696e 646f 7754 6578  onf.SQLWindowTex
+00033b30: 7473 3a0d 0a20 2020 2020 2020 2020 2020  ts:..           
+00033b40: 2020 2020 2064 656c 2063 6f6e 662e 5351       del conf.SQ
+00033b50: 4c57 696e 646f 7754 6578 7473 5b73 656c  LWindowTexts[sel
+00033b60: 662e 6462 2e66 696c 656e 616d 655d 0d0a  f.db.filename]..
+00033b70: 0d0a 0d0a 2020 2020 6465 6620 7570 6461  ....    def upda
+00033b80: 7465 5f69 6e66 6f5f 7061 6765 2873 656c  te_info_page(sel
+00033b90: 662c 2072 656c 6f61 643d 5472 7565 293a  f, reload=True):
+00033ba0: 0d0a 2020 2020 2020 2020 2222 2255 7064  ..        """Upd
+00033bb0: 6174 6573 2074 6865 2049 6e66 6f72 6d61  ates the Informa
+00033bc0: 7469 6f6e 2070 6167 6520 7769 7468 2063  tion page with c
+00033bd0: 7572 7265 6e74 2064 6174 612e 2222 220d  urrent data.""".
+00033be0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+00033bf0: 7365 6c66 3a20 7265 7475 726e 0d0a 2020  self: return..  
+00033c00: 2020 2020 2020 7365 6c66 2e62 7574 746f        self.butto
+00033c10: 6e5f 7265 6672 6573 685f 6669 6c65 696e  n_refresh_filein
+00033c20: 666f 2e45 6e61 626c 6564 203d 2046 616c  fo.Enabled = Fal
+00033c30: 7365 0d0a 2020 2020 2020 2020 6966 2072  se..        if r
+00033c40: 656c 6f61 643a 0d0a 2020 2020 2020 2020  eload:..        
+00033c50: 2020 2020 7365 6c66 2e64 622e 636c 6561      self.db.clea
+00033c60: 725f 6361 6368 6528 290d 0a20 2020 2020  r_cache()..     
+00033c70: 2020 2020 2020 2073 656c 662e 6462 2e75         self.db.u
+00033c80: 7064 6174 655f 6669 6c65 696e 666f 2829  pdate_fileinfo()
+00033c90: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00033ca0: 6c66 2e64 622e 7570 6461 7465 5f61 6363  lf.db.update_acc
+00033cb0: 6f75 6e74 696e 666f 2829 0d0a 2020 2020  ountinfo()..    
+00033cc0: 2020 2020 2020 2020 7365 6c66 2e75 7064          self.upd
+00033cd0: 6174 655f 6163 636f 756e 7469 6e66 6f28  ate_accountinfo(
+00033ce0: 290d 0a20 2020 2020 2020 2066 6f72 206e  )..        for n
+00033cf0: 616d 6520 696e 205b 2263 6861 7473 222c  ame in ["chats",
+00033d00: 2022 636f 6e74 6163 7473 222c 2022 6d65   "contacts", "me
+00033d10: 7373 6167 6573 222c 2022 7472 616e 7366  ssages", "transf
+00033d20: 6572 7322 2c0d 0a20 2020 2020 2020 2022  ers",..        "
+00033d30: 6c61 7374 6d65 7373 6167 6522 2c20 2266  lastmessage", "f
+00033d40: 6972 7374 6d65 7373 6167 6522 2c20 2273  irstmessage", "s
+00033d50: 697a 6522 2c20 226d 6f64 6966 6965 6422  ize", "modified"
+00033d60: 2c20 2273 6861 3122 2c20 226d 6435 225d  , "sha1", "md5"]
+00033d70: 3a0d 0a20 2020 2020 2020 2020 2020 2067  :..            g
+00033d80: 6574 6174 7472 2873 656c 662c 2022 6564  etattr(self, "ed
+00033d90: 6974 5f69 6e66 6f5f 2573 2220 2520 6e61  it_info_%s" % na
+00033da0: 6d65 292e 5661 6c75 6520 3d20 2222 0d0a  me).Value = ""..
+00033db0: 2020 2020 2020 2020 7374 6174 7320 3d20          stats = 
+00033dc0: 7b7d 0d0a 2020 2020 2020 2020 7472 793a  {}..        try:
+00033dd0: 0d0a 2020 2020 2020 2020 2020 2020 7374  ..            st
+00033de0: 6174 7320 3d20 7365 6c66 2e64 622e 6765  ats = self.db.ge
+00033df0: 745f 6765 6e65 7261 6c5f 7374 6174 6973  t_general_statis
+00033e00: 7469 6373 2829 0d0a 2020 2020 2020 2020  tics()..        
+00033e10: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
+00033e20: 3a20 7061 7373 0d0a 2020 2020 2020 2020  : pass..        
+00033e30: 6966 2073 7461 7473 3a0d 0a20 2020 2020  if stats:..     
+00033e40: 2020 2020 2020 2073 656c 662e 6564 6974         self.edit
+00033e50: 5f69 6e66 6f5f 6368 6174 732e 5661 6c75  _info_chats.Valu
+00033e60: 6520 2020 2020 3d20 277b 3a2c 7d27 2e66  e     = '{:,}'.f
+00033e70: 6f72 6d61 7428 7374 6174 735b 2263 6861  ormat(stats["cha
+00033e80: 7473 225d 290d 0a20 2020 2020 2020 2020  ts"])..         
+00033e90: 2020 2073 656c 662e 6564 6974 5f69 6e66     self.edit_inf
+00033ea0: 6f5f 636f 6e74 6163 7473 2e56 616c 7565  o_contacts.Value
+00033eb0: 2020 3d20 277b 3a2c 7d27 2e66 6f72 6d61    = '{:,}'.forma
+00033ec0: 7428 7374 6174 735b 2263 6f6e 7461 6374  t(stats["contact
+00033ed0: 7322 5d29 0d0a 2020 2020 2020 2020 2020  s"])..          
+00033ee0: 2020 7365 6c66 2e65 6469 745f 696e 666f    self.edit_info
+00033ef0: 5f6d 6573 7361 6765 732e 5661 6c75 6520  _messages.Value 
+00033f00: 203d 2027 7b3a 2c7d 272e 666f 726d 6174   = '{:,}'.format
+00033f10: 2873 7461 7473 5b22 6d65 7373 6167 6573  (stats["messages
+00033f20: 225d 290d 0a20 2020 2020 2020 2020 2020  "])..           
+00033f30: 2073 656c 662e 6564 6974 5f69 6e66 6f5f   self.edit_info_
+00033f40: 7472 616e 7366 6572 732e 5661 6c75 6520  transfers.Value 
+00033f50: 3d20 277b 3a2c 7d27 2e66 6f72 6d61 7428  = '{:,}'.format(
+00033f60: 7374 6174 735b 2274 7261 6e73 6665 7273  stats["transfers
+00033f70: 225d 290d 0a20 2020 2020 2020 2069 6620  "])..        if 
+00033f80: 226d 6573 7361 6765 735f 6672 6f6d 2220  "messages_from" 
+00033f90: 696e 2073 7461 7473 3a0d 0a20 2020 2020  in stats:..     
+00033fa0: 2020 2020 2020 2073 656c 662e 6564 6974         self.edit
+00033fb0: 5f69 6e66 6f5f 6d65 7373 6167 6573 2e56  _info_messages.V
+00033fc0: 616c 7565 202b 3d20 2220 287b 3a2c 7d20  alue += " ({:,} 
+00033fd0: 7365 6e74 2061 6e64 207b 3a2c 7d20 7265  sent and {:,} re
+00033fe0: 6365 6976 6564 2922 2e66 6f72 6d61 7428  ceived)".format(
+00033ff0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00034000: 2020 7374 6174 732e 6765 7428 226d 6573    stats.get("mes
+00034010: 7361 6765 735f 6672 6f6d 2229 206f 7220  sages_from") or 
+00034020: 302c 2073 7461 7473 2e67 6574 2822 6d65  0, stats.get("me
+00034030: 7373 6167 6573 5f74 6f22 2920 6f72 2030  ssages_to") or 0
+00034040: 290d 0a20 2020 2020 2020 2074 6578 7420  )..        text 
+00034050: 3d20 2222 0d0a 2020 2020 2020 2020 6966  = ""..        if
+00034060: 2022 6c61 7374 6d65 7373 6167 655f 6474   "lastmessage_dt
+00034070: 2220 696e 2073 7461 7473 3a0d 0a20 2020  " in stats:..   
+00034080: 2020 2020 2020 2020 2074 6578 7420 3d20           text = 
+00034090: 2225 286c 6173 746d 6573 7361 6765 5f64  "%(lastmessage_d
+000340a0: 7429 7320 2528 6c61 7374 6d65 7373 6167  t)s %(lastmessag
+000340b0: 655f 6672 6f6d 2973 2220 2520 7374 6174  e_from)s" % stat
+000340c0: 730d 0a20 2020 2020 2020 2020 2020 2069  s..            i
+000340d0: 6620 7374 6174 732e 6765 7428 226c 6173  f stats.get("las
+000340e0: 746d 6573 7361 6765 5f73 6b79 7065 6e61  tmessage_skypena
+000340f0: 6d65 2229 203d 3d20 7365 6c66 2e64 622e  me") == self.db.
+00034100: 6964 205c 0d0a 2020 2020 2020 2020 2020  id \..          
+00034110: 2020 6f72 2073 6b79 7065 6461 7461 2e43    or skypedata.C
+00034120: 4841 5453 5f54 5950 455f 5349 4e47 4c45  HATS_TYPE_SINGLE
+00034130: 2021 3d20 7374 6174 732e 6765 7428 226c   != stats.get("l
+00034140: 6173 746d 6573 7361 6765 5f63 6861 7474  astmessage_chatt
+00034150: 7970 6522 293a 0d0a 2020 2020 2020 2020  ype"):..        
+00034160: 2020 2020 2020 2020 7465 7874 202b 3d20          text += 
+00034170: 2220 696e 2025 286c 6173 746d 6573 7361  " in %(lastmessa
+00034180: 6765 5f63 6861 7429 7322 2025 2073 7461  ge_chat)s" % sta
+00034190: 7473 0d0a 2020 2020 2020 2020 7365 6c66  ts..        self
+000341a0: 2e65 6469 745f 696e 666f 5f6c 6173 746d  .edit_info_lastm
+000341b0: 6573 7361 6765 2e56 616c 7565 203d 2074  essage.Value = t
+000341c0: 6578 740d 0a20 2020 2020 2020 2074 6578  ext..        tex
+000341d0: 7420 3d20 2222 0d0a 2020 2020 2020 2020  t = ""..        
+000341e0: 6966 2022 6669 7273 746d 6573 7361 6765  if "firstmessage
+000341f0: 5f64 7422 2069 6e20 7374 6174 733a 0d0a  _dt" in stats:..
+00034200: 2020 2020 2020 2020 2020 2020 7465 7874              text
+00034210: 203d 2022 2528 6669 7273 746d 6573 7361   = "%(firstmessa
+00034220: 6765 5f64 7429 7320 2528 6669 7273 746d  ge_dt)s %(firstm
+00034230: 6573 7361 6765 5f66 726f 6d29 7322 2025  essage_from)s" %
+00034240: 2073 7461 7473 0d0a 2020 2020 2020 2020   stats..        
+00034250: 2020 2020 6966 2073 7461 7473 2e67 6574      if stats.get
+00034260: 2822 6669 7273 746d 6573 7361 6765 5f63  ("firstmessage_c
+00034270: 6861 7422 2920 5c0d 0a20 2020 2020 2020  hat") \..       
+00034280: 2020 2020 2061 6e64 2028 7374 6174 732e       and (stats.
+00034290: 6765 7428 2266 6972 7374 6d65 7373 6167  get("firstmessag
+000342a0: 655f 736b 7970 656e 616d 6522 2920 3d3d  e_skypename") ==
+000342b0: 2073 656c 662e 6462 2e69 640d 0a20 2020   self.db.id..   
+000342c0: 2020 2020 2020 2020 206f 7220 736b 7970           or skyp
+000342d0: 6564 6174 612e 4348 4154 535f 5459 5045  edata.CHATS_TYPE
+000342e0: 5f53 494e 474c 4520 213d 2073 7461 7473  _SINGLE != stats
+000342f0: 2e67 6574 2822 6669 7273 746d 6573 7361  .get("firstmessa
+00034300: 6765 5f63 6861 7474 7970 6522 2929 3a0d  ge_chattype")):.
+00034310: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00034320: 2074 6578 7420 2b3d 2022 2069 6e20 2528   text += " in %(
+00034330: 6669 7273 746d 6573 7361 6765 5f63 6861  firstmessage_cha
+00034340: 7429 7322 2025 2073 7461 7473 0d0a 2020  t)s" % stats..  
+00034350: 2020 2020 2020 7365 6c66 2e65 6469 745f        self.edit_
+00034360: 696e 666f 5f66 6972 7374 6d65 7373 6167  info_firstmessag
+00034370: 652e 5661 6c75 6520 3d20 7465 7874 0d0a  e.Value = text..
+00034380: 0d0a 2020 2020 2020 2020 7365 6c66 2e65  ..        self.e
+00034390: 6469 745f 696e 666f 5f73 697a 652e 5661  dit_info_size.Va
+000343a0: 6c75 6520 3d20 2225 7320 2825 7329 2220  lue = "%s (%s)" 
+000343b0: 2520 5c0d 0a20 2020 2020 2020 2020 2020  % \..           
+000343c0: 2028 7574 696c 2e66 6f72 6d61 745f 6279   (util.format_by
+000343d0: 7465 7328 7365 6c66 2e64 622e 6669 6c65  tes(self.db.file
+000343e0: 7369 7a65 292c 0d0a 2020 2020 2020 2020  size),..        
+000343f0: 2020 2020 2075 7469 6c2e 666f 726d 6174       util.format
+00034400: 5f62 7974 6573 2873 656c 662e 6462 2e66  _bytes(self.db.f
+00034410: 696c 6573 697a 652c 206d 6178 5f75 6e69  ilesize, max_uni
+00034420: 7473 3d46 616c 7365 2929 0d0a 2020 2020  ts=False))..    
+00034430: 2020 2020 7365 6c66 2e65 6469 745f 696e      self.edit_in
+00034440: 666f 5f6d 6f64 6966 6965 642e 5661 6c75  fo_modified.Valu
+00034450: 6520 3d20 5c0d 0a20 2020 2020 2020 2020  e = \..         
+00034460: 2020 2073 656c 662e 6462 2e6c 6173 745f     self.db.last_
+00034470: 6d6f 6469 6669 6564 2e73 7472 6674 696d  modified.strftim
+00034480: 6528 2225 592d 256d 2d25 6420 2548 3a25  e("%Y-%m-%d %H:%
+00034490: 4d3a 2553 2229 0d0a 2020 2020 2020 2020  M:%S")..        
+000344a0: 424c 4f43 4b53 495a 4520 3d20 3130 3438  BLOCKSIZE = 1048
+000344b0: 3537 360d 0a20 2020 2020 2020 2073 6861  576..        sha
+000344c0: 312c 206d 6435 203d 2068 6173 686c 6962  1, md5 = hashlib
+000344d0: 2e73 6861 3128 292c 2068 6173 686c 6962  .sha1(), hashlib
+000344e0: 2e6d 6435 2829 0d0a 2020 2020 2020 2020  .md5()..        
+000344f0: 7472 793a 0d0a 2020 2020 2020 2020 2020  try:..          
+00034500: 2020 7769 7468 206f 7065 6e28 7365 6c66    with open(self
+00034510: 2e64 622e 6669 6c65 6e61 6d65 2c20 2272  .db.filename, "r
+00034520: 6222 2920 6173 2066 3a0d 0a20 2020 2020  b") as f:..     
+00034530: 2020 2020 2020 2020 2020 2062 7566 203d             buf =
+00034540: 2066 2e72 6561 6428 424c 4f43 4b53 495a   f.read(BLOCKSIZ
+00034550: 4529 0d0a 2020 2020 2020 2020 2020 2020  E)..            
+00034560: 2020 2020 7768 696c 6520 6c65 6e28 6275      while len(bu
+00034570: 6629 3a0d 0a20 2020 2020 2020 2020 2020  f):..           
+00034580: 2020 2020 2020 2020 2073 6861 312e 7570           sha1.up
+00034590: 6461 7465 2862 7566 292c 206d 6435 2e75  date(buf), md5.u
+000345a0: 7064 6174 6528 6275 6629 0d0a 2020 2020  pdate(buf)..    
+000345b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000345c0: 6275 6620 3d20 662e 7265 6164 2842 4c4f  buf = f.read(BLO
+000345d0: 434b 5349 5a45 290d 0a20 2020 2020 2020  CKSIZE)..       
+000345e0: 2020 2020 2073 656c 662e 6564 6974 5f69       self.edit_i
+000345f0: 6e66 6f5f 7368 6131 2e56 616c 7565 203d  nfo_sha1.Value =
+00034600: 2073 6861 312e 6865 7864 6967 6573 7428   sha1.hexdigest(
+00034610: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
+00034620: 656c 662e 6564 6974 5f69 6e66 6f5f 6d64  elf.edit_info_md
+00034630: 352e 5661 6c75 6520 3d20 6d64 352e 6865  5.Value = md5.he
+00034640: 7864 6967 6573 7428 290d 0a20 2020 2020  xdigest()..     
+00034650: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
+00034660: 696f 6e20 6173 2065 3a0d 0a20 2020 2020  ion as e:..     
+00034670: 2020 2020 2020 2073 656c 662e 6564 6974         self.edit
+00034680: 5f69 6e66 6f5f 7368 6131 2e56 616c 7565  _info_sha1.Value
+00034690: 203d 2073 656c 662e 6564 6974 5f69 6e66   = self.edit_inf
+000346a0: 6f5f 6d64 352e 5661 6c75 6520 3d20 7574  o_md5.Value = ut
+000346b0: 696c 2e66 6f72 6d61 745f 6578 6328 6529  il.format_exc(e)
+000346c0: 0d0a 2020 2020 2020 2020 7365 6c66 2e62  ..        self.b
+000346d0: 7574 746f 6e5f 6368 6563 6b5f 696e 7465  utton_check_inte
+000346e0: 6772 6974 792e 456e 6162 6c65 6420 3d20  grity.Enabled = 
+000346f0: 5472 7565 0d0a 2020 2020 2020 2020 7365  True..        se
+00034700: 6c66 2e62 7574 746f 6e5f 7265 6672 6573  lf.button_refres
+00034710: 685f 6669 6c65 696e 666f 2e45 6e61 626c  h_fileinfo.Enabl
+00034720: 6564 203d 2054 7275 650d 0a0d 0a0d 0a20  ed = True...... 
+00034730: 2020 2064 6566 206f 6e5f 7265 6672 6573     def on_refres
+00034740: 685f 7461 626c 6573 2873 656c 662c 2065  h_tables(self, e
+00034750: 7665 6e74 3d4e 6f6e 6529 3a0d 0a20 2020  vent=None):..   
+00034760: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
+00034770: 2020 5265 6672 6573 6865 7320 7468 6520    Refreshes the 
+00034780: 7461 626c 6520 7472 6565 2061 6e64 206f  table tree and o
+00034790: 7065 6e20 7461 626c 6520 6461 7461 2e20  pen table data. 
+000347a0: 4173 6b73 2066 6f72 2063 6f6e 6669 726d  Asks for confirm
+000347b0: 6174 696f 6e0d 0a20 2020 2020 2020 2069  ation..        i
+000347c0: 6620 7468 6572 6520 6172 6520 756e 636f  f there are unco
+000347d0: 6d6d 6974 7465 6420 6368 616e 6765 732e  mmitted changes.
+000347e0: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
+000347f0: 2020 2020 2020 2064 6f5f 7265 6672 6573         do_refres
+00034800: 682c 2075 6e73 6176 6564 203d 2054 7275  h, unsaved = Tru
+00034810: 652c 2073 656c 662e 6765 745f 756e 7361  e, self.get_unsa
+00034820: 7665 645f 6772 6964 7328 290d 0a20 2020  ved_grids()..   
+00034830: 2020 2020 2069 6620 756e 7361 7665 643a       if unsaved:
+00034840: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+00034850: 7370 6f6e 7365 203d 2077 782e 4d65 7373  sponse = wx.Mess
+00034860: 6167 6542 6f78 2822 536f 6d65 2074 6162  ageBox("Some tab
+00034870: 6c65 7320 6861 7665 2075 6e73 6176 6564  les have unsaved
+00034880: 2064 6174 6120 2825 7329 2e5c 6e5c 6e22   data (%s).\n\n"
+00034890: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000348a0: 2020 2253 6176 6520 6265 666f 7265 2072    "Save before r
+000348b0: 6566 7265 7368 696e 6720 2863 6861 6e67  efreshing (chang
+000348c0: 6573 2077 696c 6c20 6265 206c 6f73 7420  es will be lost 
+000348d0: 6f74 6865 7277 6973 6529 3f22 0d0a 2020  otherwise)?"..  
+000348e0: 2020 2020 2020 2020 2020 2020 2020 2520                % 
+000348f0: 2822 2c20 222e 6a6f 696e 2873 6f72 7465  (", ".join(sorte
+00034900: 6428 782e 7461 626c 6520 666f 7220 7820  d(x.table for x 
+00034910: 696e 2075 6e73 6176 6564 2929 292c 2063  in unsaved))), c
+00034920: 6f6e 662e 5469 746c 652c 0d0a 2020 2020  onf.Title,..    
+00034930: 2020 2020 2020 2020 2020 2020 7778 2e59              wx.Y
+00034940: 4553 207c 2077 782e 4e4f 207c 2077 782e  ES | wx.NO | wx.
+00034950: 4341 4e43 454c 207c 2077 782e 4943 4f4e  CANCEL | wx.ICON
+00034960: 5f49 4e46 4f52 4d41 5449 4f4e 290d 0a20  _INFORMATION).. 
+00034970: 2020 2020 2020 2020 2020 2069 6620 7778             if wx
+00034980: 2e59 4553 203d 3d20 7265 7370 6f6e 7365  .YES == response
+00034990: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+000349a0: 2020 2064 6f5f 7265 6672 6573 6820 3d20     do_refresh = 
+000349b0: 7365 6c66 2e73 6176 655f 756e 7361 7665  self.save_unsave
+000349c0: 645f 6772 6964 7328 290d 0a20 2020 2020  d_grids()..     
+000349d0: 2020 2020 2020 2065 6c69 6620 7778 2e43         elif wx.C
+000349e0: 414e 4345 4c20 3d3d 2072 6573 706f 6e73  ANCEL == respons
+000349f0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00034a00: 2020 2020 646f 5f72 6566 7265 7368 203d      do_refresh =
+00034a10: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
+00034a20: 6966 206e 6f74 2064 6f5f 7265 6672 6573  if not do_refres
+00034a30: 683a 2072 6574 7572 6e0d 0a0d 0a20 2020  h: return....   
+00034a40: 2020 2020 2073 656c 662e 6462 2e63 6c65       self.db.cle
+00034a50: 6172 5f63 6163 6865 2829 0d0a 2020 2020  ar_cache()..    
+00034a60: 2020 2020 7365 6c66 2e6c 6f61 645f 7461      self.load_ta
+00034a70: 626c 6573 5f64 6174 6128 7265 6c6f 6164  bles_data(reload
+00034a80: 3d54 7275 6529 0d0a 2020 2020 2020 2020  =True)..        
+00034a90: 6966 2073 656c 662e 6772 6964 5f74 6162  if self.grid_tab
+00034aa0: 6c65 2e54 6162 6c65 3a0d 0a20 2020 2020  le.Table:..     
+00034ab0: 2020 2020 2020 2067 7269 642c 2074 6162         grid, tab
+00034ac0: 6c65 5f6e 616d 6520 3d20 7365 6c66 2e67  le_name = self.g
+00034ad0: 7269 645f 7461 626c 652c 2073 656c 662e  rid_table, self.
+00034ae0: 6772 6964 5f74 6162 6c65 2e54 6162 6c65  grid_table.Table
+00034af0: 2e74 6162 6c65 0d0a 2020 2020 2020 2020  .table..        
+00034b00: 2020 2020 7363 726f 6c6c 706f 7320 3d20      scrollpos = 
+00034b10: 6d61 7028 6772 6964 2e47 6574 5363 726f  map(grid.GetScro
+00034b20: 6c6c 506f 732c 205b 7778 2e48 4f52 495a  llPos, [wx.HORIZ
+00034b30: 4f4e 5441 4c2c 2077 782e 5645 5254 4943  ONTAL, wx.VERTIC
+00034b40: 414c 5d29 0d0a 2020 2020 2020 2020 2020  AL])..          
+00034b50: 2020 6375 7273 6f72 706f 7320 3d20 6772    cursorpos = gr
+00034b60: 6964 2e47 7269 6443 7572 736f 7243 6f6c  id.GridCursorCol
+00034b70: 2c20 6772 6964 2e47 7269 6443 7572 736f  , grid.GridCurso
+00034b80: 7252 6f77 0d0a 2020 2020 2020 2020 2020  rRow..          
+00034b90: 2020 7365 6c66 2e6f 6e5f 6368 616e 6765    self.on_change
+00034ba0: 5f74 6162 6c65 284e 6f6e 6529 0d0a 2020  _table(None)..  
+00034bb0: 2020 2020 2020 2020 2020 6772 6964 2e54            grid.T
+00034bc0: 6162 6c65 203d 204e 6f6e 6520 2320 5265  able = None # Re
+00034bd0: 7365 7420 6772 6964 2064 6174 6120 746f  set grid data to
+00034be0: 2065 6d70 7479 0d0a 2020 2020 2020 2020   empty..        
+00034bf0: 2020 2020 6772 6964 2e46 7265 657a 6528      grid.Freeze(
+00034c00: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
+00034c10: 656c 662e 6462 5f67 7269 6473 2e63 6c65  elf.db_grids.cle
+00034c20: 6172 2829 0d0a 0d0a 2020 2020 2020 2020  ar()....        
 00034c30: 2020 2020 7461 626c 6569 7465 6d20 3d20      tableitem = 
-00034c40: 6974 656d 0d0a 2020 2020 2020 2020 2020  item..          
-00034c50: 2020 2020 2020 2020 2020 6272 6561 6b20            break 
-00034c60: 2320 6272 6561 6b20 7768 696c 6520 7461  # break while ta
-00034c70: 626c 6520 616e 6420 6974 656d 2061 6e64  ble and item and
-00034c80: 2069 7465 6b2e 4973 4f6b 2829 0d0a 2020   itek.IsOk()..  
-00034c90: 2020 2020 2020 2020 2020 2020 2020 6974                it
-00034ca0: 656d 203d 2073 656c 662e 7472 6565 5f74  em = self.tree_t
-00034cb0: 6162 6c65 732e 4765 744e 6578 7453 6962  ables.GetNextSib
-00034cc0: 6c69 6e67 2869 7465 6d29 0d0a 2020 2020  ling(item)..    
-00034cd0: 2020 2020 2020 2020 6966 2074 6162 6c65          if table
-00034ce0: 6974 656d 3a0d 0a20 2020 2020 2020 2020  item:..         
-00034cf0: 2020 2020 2020 2023 204f 6e6c 7920 7761         # Only wa
-00034d00: 7920 746f 2063 7265 6174 6520 7374 6174  y to create stat
-00034d10: 6520 6368 616e 6765 2069 6e20 7778 2e6c  e change in wx.l
-00034d20: 6962 2e67 697a 6d6f 732e 5472 6565 4c69  ib.gizmos.TreeLi
-00034d30: 7374 4374 726c 0d0a 2020 2020 2020 2020  stCtrl..        
-00034d40: 2020 2020 2020 2020 636c 6173 7320 4861          class Ha
-00034d50: 636b 4576 656e 7428 6f62 6a65 6374 293a  ckEvent(object):
-00034d60: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00034d70: 2020 2020 2020 6465 6620 5f5f 696e 6974        def __init
-00034d80: 5f5f 2873 656c 662c 2069 7465 6d29 3a20  __(self, item): 
-00034d90: 7365 6c66 2e5f 6974 656d 203d 2069 7465  self._item = ite
-00034da0: 6d0d 0a20 2020 2020 2020 2020 2020 2020  m..             
-00034db0: 2020 2020 2020 2064 6566 2047 6574 4974         def GetIt
-00034dc0: 656d 2873 656c 6629 3a20 2020 2020 2020  em(self):       
-00034dd0: 2072 6574 7572 6e20 7365 6c66 2e5f 6974   return self._it
-00034de0: 656d 0d0a 2020 2020 2020 2020 2020 2020  em..            
-00034df0: 2020 2020 7365 6c66 2e6f 6e5f 6368 616e      self.on_chan
-00034e00: 6765 5f74 7265 655f 7461 626c 6573 2848  ge_tree_tables(H
-00034e10: 6163 6b45 7665 6e74 2874 6162 6c65 6974  ackEvent(tableit
-00034e20: 656d 2929 0d0a 2020 2020 2020 2020 2020  em))..          
-00034e30: 2020 2020 2020 7365 6c66 2e74 7265 655f        self.tree_
-00034e40: 7461 626c 6573 2e53 656c 6563 7449 7465  tables.SelectIte
-00034e50: 6d28 7461 626c 6569 7465 6d29 0d0a 2020  m(tableitem)..  
-00034e60: 2020 2020 2020 2020 2020 2020 2020 6772                gr
-00034e70: 6964 2e53 6372 6f6c 6c28 2a73 6372 6f6c  id.Scroll(*scrol
-00034e80: 6c70 6f73 290d 0a20 2020 2020 2020 2020  lpos)..         
-00034e90: 2020 2020 2020 2067 7269 642e 5365 7447         grid.SetG
-00034ea0: 7269 6443 7572 736f 7228 2a63 7572 736f  ridCursor(*curso
-00034eb0: 7270 6f73 290d 0a20 2020 2020 2020 2020  rpos)..         
-00034ec0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-00034ed0: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
-00034ee0: 6162 656c 5f74 6162 6c65 2e4c 6162 656c  abel_table.Label
-00034ef0: 203d 2022 220d 0a20 2020 2020 2020 2020   = ""..         
-00034f00: 2020 2020 2020 2066 6f72 2078 2069 6e20         for x in 
-00034f10: 5b77 782e 4944 5f41 4444 2c20 7778 2e49  [wx.ID_ADD, wx.I
-00034f20: 445f 4445 4c45 5445 2c20 7778 2e49 445f  D_DELETE, wx.ID_
-00034f30: 554e 444f 2c20 7778 2e49 445f 5341 5645  UNDO, wx.ID_SAVE
-00034f40: 5d3a 0d0a 2020 2020 2020 2020 2020 2020  ]:..            
-00034f50: 2020 2020 2020 2020 7365 6c66 2e74 625f          self.tb_
-00034f60: 6772 6964 2e45 6e61 626c 6554 6f6f 6c28  grid.EnableTool(
-00034f70: 782c 2046 616c 7365 290d 0a20 2020 2020  x, False)..     
-00034f80: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00034f90: 6275 7474 6f6e 5f72 6573 6574 5f67 7269  button_reset_gri
-00034fa0: 645f 7461 626c 652e 456e 6162 6c65 6420  d_table.Enabled 
-00034fb0: 3d20 4661 6c73 650d 0a20 2020 2020 2020  = False..       
-00034fc0: 2020 2020 2020 2020 2073 656c 662e 6275           self.bu
-00034fd0: 7474 6f6e 5f65 7870 6f72 745f 7461 626c  tton_export_tabl
-00034fe0: 652e 456e 6162 6c65 6420 3d20 4661 6c73  e.Enabled = Fals
-00034ff0: 650d 0a20 2020 2020 2020 2020 2020 2067  e..            g
-00035000: 7269 642e 5468 6177 2829 0d0a 2020 2020  rid.Thaw()..    
-00035010: 2020 2020 2020 2020 7365 6c66 2e70 6167          self.pag
-00035020: 655f 7461 626c 6573 2e52 6566 7265 7368  e_tables.Refresh
-00035030: 2829 0d0a 0d0a 0d0a 2020 2020 6465 6620  ()......    def 
-00035040: 6f6e 5f63 6861 6e67 655f 7261 6e67 655f  on_change_range_
-00035050: 6461 7465 2873 656c 662c 2065 7665 6e74  date(self, event
-00035060: 293a 0d0a 2020 2020 2020 2020 2222 220d  ):..        """.
-00035070: 0a20 2020 2020 2020 2048 616e 646c 6572  .        Handler
-00035080: 2066 6f72 2076 616c 7565 2063 6861 6e67   for value chang
-00035090: 6520 696e 2063 6861 7420 6669 6c74 6572  e in chat filter
-000350a0: 2064 6174 6520 7261 6e67 652c 2075 7064   date range, upd
-000350b0: 6174 6573 2064 6174 650d 0a20 2020 2020  ates date..     
-000350c0: 2020 2065 6469 7462 6f78 6573 2e0d 0a20     editboxes... 
-000350d0: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
-000350e0: 2020 2020 7472 793a 0d0a 2020 2020 2020      try:..      
-000350f0: 2020 2020 2020 7631 2c20 7632 203d 205b        v1, v2 = [
-00035100: 642e 7374 7266 7469 6d65 2822 2559 2d25  d.strftime("%Y-%
-00035110: 6d2d 2564 2229 2066 6f72 2064 2069 6e20  m-%d") for d in 
-00035120: 7365 6c66 2e72 616e 6765 5f64 6174 652e  self.range_date.
-00035130: 5661 6c75 6573 5d0d 0a20 2020 2020 2020  Values]..       
-00035140: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
-00035150: 6e3a 0d0a 2020 2020 2020 2020 2020 2020  n:..            
-00035160: 7631 2c20 7632 203d 2022 222c 2022 220d  v1, v2 = "", "".
-00035170: 0a20 2020 2020 2020 2066 6f72 2065 2c20  .        for e, 
-00035180: 7620 696e 205b 2873 656c 662e 6564 6974  v in [(self.edit
-00035190: 5f66 696c 7465 7264 6174 6531 2c20 7631  _filterdate1, v1
-000351a0: 292c 2028 7365 6c66 2e65 6469 745f 6669  ), (self.edit_fi
-000351b0: 6c74 6572 6461 7465 322c 2076 3229 5d3a  lterdate2, v2)]:
-000351c0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-000351d0: 2076 2061 6e64 2065 2e45 6e61 626c 6564   v and e.Enabled
-000351e0: 2061 6e64 2065 2e56 616c 7565 2021 3d20   and e.Value != 
-000351f0: 763a 0d0a 2020 2020 2020 2020 2020 2020  v:..            
-00035200: 2020 2020 7365 6c20 3d20 652e 4765 7453      sel = e.GetS
-00035210: 656c 6563 7469 6f6e 2829 0d0a 2020 2020  election()..    
-00035220: 2020 2020 2020 2020 2020 2020 652e 5661              e.Va
-00035230: 6c75 6520 3d20 760d 0a20 2020 2020 2020  lue = v..       
-00035240: 2020 2020 2020 2020 2065 2e53 6574 5365           e.SetSe
-00035250: 6c65 6374 696f 6e28 2a73 656c 290d 0a0d  lection(*sel)...
-00035260: 0a0d 0a20 2020 2064 6566 206f 6e5f 6368  ...    def on_ch
-00035270: 616e 6765 5f66 696c 7465 7264 6174 6528  ange_filterdate(
-00035280: 7365 6c66 2c20 6576 656e 7429 3a0d 0a20  self, event):.. 
-00035290: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
-000352a0: 2020 2020 4861 6e64 6c65 7220 666f 7220      Handler for 
-000352b0: 6368 616e 6769 6e67 2061 2063 6861 7420  changing a chat 
-000352c0: 6461 7465 2066 696c 7465 7220 6564 6974  date filter edit
-000352d0: 626f 782c 2075 7064 6174 6573 2064 6174  box, updates dat
-000352e0: 6520 7261 6e67 650d 0a20 2020 2020 2020  e range..       
-000352f0: 2073 6c69 6465 722e 0d0a 2020 2020 2020   slider...      
-00035300: 2020 2222 220d 0a20 2020 2020 2020 2064    """..        d
-00035310: 6174 6573 7472 203d 2072 652e 7375 6228  atestr = re.sub(
-00035320: 225c 5c44 222c 2022 222c 2065 7665 6e74  "\\D", "", event
-00035330: 2e53 7472 696e 6729 5b3a 385d 0d0a 2020  .String)[:8]..  
-00035340: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
-00035350: 2020 2020 2020 2020 6173 7365 7274 206c          assert l
-00035360: 656e 2864 6174 6573 7472 2920 3d3d 2038  en(datestr) == 8
-00035370: 0d0a 2020 2020 2020 2020 2020 2020 6461  ..            da
-00035380: 7465 203d 2064 6174 6574 696d 652e 6461  te = datetime.da
-00035390: 7465 7469 6d65 2e73 7472 7074 696d 6528  tetime.strptime(
-000353a0: 6461 7465 7374 722c 2022 2559 256d 2564  datestr, "%Y%m%d
-000353b0: 2229 2e64 6174 6528 290d 0a20 2020 2020  ").date()..     
-000353c0: 2020 2065 7863 6570 7420 2841 7373 6572     except (Asser
-000353d0: 7469 6f6e 4572 726f 722c 2054 7970 6545  tionError, TypeE
-000353e0: 7272 6f72 2c20 5661 6c75 6545 7272 6f72  rror, ValueError
-000353f0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00035400: 6461 7465 203d 204e 6f6e 650d 0a20 2020  date = None..   
-00035410: 2020 2020 2069 6620 6461 7465 3a0d 0a20       if date:.. 
-00035420: 2020 2020 2020 2020 2020 2073 6964 6520             side 
-00035430: 3d20 2865 7665 6e74 2e45 7665 6e74 4f62  = (event.EventOb
-00035440: 6a65 6374 203d 3d20 7365 6c66 2e65 6469  ject == self.edi
-00035450: 745f 6669 6c74 6572 6461 7465 3229 0d0a  t_filterdate2)..
-00035460: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-00035470: 656c 662e 7261 6e67 655f 6461 7465 2e47  elf.range_date.G
-00035480: 6574 5661 6c75 6528 7369 6465 2920 213d  etValue(side) !=
-00035490: 2064 6174 653a 0d0a 2020 2020 2020 2020   date:..        
-000354a0: 2020 2020 2020 2020 7365 6c66 2e72 616e          self.ran
-000354b0: 6765 5f64 6174 652e 5365 7456 616c 7565  ge_date.SetValue
-000354c0: 2873 6964 652c 2064 6174 6529 0d0a 2020  (side, date)..  
-000354d0: 2020 2020 2020 2020 2020 2020 2020 6461                da
-000354e0: 7465 3220 3d20 7365 6c66 2e72 616e 6765  te2 = self.range
-000354f0: 5f64 6174 652e 4765 7456 616c 7565 2873  _date.GetValue(s
-00035500: 6964 6529 0d0a 2020 2020 2020 2020 2020  ide)..          
-00035510: 2020 2020 2020 6966 2064 6174 6573 7472        if datestr
-00035520: 2021 3d20 6461 7465 322e 7374 7266 7469   != date2.strfti
-00035530: 6d65 2822 2559 256d 2564 2229 3a0d 0a20  me("%Y%m%d"):.. 
-00035540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035550: 2020 2073 656c 203d 2065 7665 6e74 2e45     sel = event.E
-00035560: 7665 6e74 4f62 6a65 6374 2e53 656c 6563  ventObject.Selec
-00035570: 7469 6f6e 0d0a 2020 2020 2020 2020 2020  tion..          
-00035580: 2020 2020 2020 2020 2020 6576 656e 742e            event.
-00035590: 4576 656e 744f 626a 6563 742e 5661 6c75  EventObject.Valu
-000355a0: 6520 3d20 6461 7465 322e 7374 7266 7469  e = date2.strfti
-000355b0: 6d65 2822 2559 2d25 6d2d 2564 2229 0d0a  me("%Y-%m-%d")..
-000355c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000355d0: 2020 2020 6576 656e 742e 4576 656e 744f      event.EventO
-000355e0: 626a 6563 742e 5365 7453 656c 6563 7469  bject.SetSelecti
-000355f0: 6f6e 282a 7365 6c29 0d0a 0d0a 0d0a 2020  on(*sel)......  
-00035600: 2020 6465 6620 6f6e 5f63 6861 6e67 655f    def on_change_
-00035610: 6368 6174 6669 6c74 6572 2873 656c 662c  chatfilter(self,
-00035620: 2065 7665 6e74 293a 0d0a 2020 2020 2020   event):..      
-00035630: 2020 2222 2248 616e 646c 6572 2066 6f72    """Handler for
-00035640: 2063 6861 6e67 696e 6720 7465 7874 2069   changing text i
-00035650: 6e20 6368 6174 2066 696c 7465 7220 626f  n chat filter bo
-00035660: 782c 2066 696c 7465 7273 2063 6861 7420  x, filters chat 
-00035670: 6c69 7374 2e22 2222 0d0a 2020 2020 2020  list."""..      
-00035680: 2020 636c 6973 7420 3d20 7365 6c66 2e6c    clist = self.l
-00035690: 6973 745f 6368 6174 730d 0a20 2020 2020  ist_chats..     
-000356a0: 2020 2063 6c69 7374 2e53 6574 4669 6c74     clist.SetFilt
-000356b0: 6572 2865 7665 6e74 2e53 7472 696e 672e  er(event.String.
-000356c0: 7374 7269 7028 2929 0d0a 2020 2020 2020  strip())..      
-000356d0: 2020 666f 7220 6920 696e 2072 616e 6765    for i in range
-000356e0: 2863 6c69 7374 2e49 7465 6d43 6f75 6e74  (clist.ItemCount
-000356f0: 2920 6966 2073 656c 662e 6368 6174 2065  ) if self.chat e
-00035700: 6c73 6520 2829 3a0d 0a20 2020 2020 2020  lse ():..       
-00035710: 2020 2020 2069 6620 636c 6973 742e 4765       if clist.Ge
-00035720: 7449 7465 6d4d 6170 7065 6444 6174 6128  tItemMappedData(
-00035730: 6929 203d 3d20 7365 6c66 2e63 6861 743a  i) == self.chat:
-00035740: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00035750: 2020 6620 3d20 636c 6973 742e 466f 6e74    f = clist.Font
-00035760: 3b20 662e 5365 7457 6569 6768 7428 7778  ; f.SetWeight(wx
-00035770: 2e46 4f4e 5457 4549 4748 545f 424f 4c44  .FONTWEIGHT_BOLD
-00035780: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00035790: 2020 2063 6c69 7374 2e53 6574 4974 656d     clist.SetItem
-000357a0: 466f 6e74 2869 2c20 6629 0d0a 2020 2020  Font(i, f)..    
-000357b0: 2020 2020 2020 2020 2020 2020 6272 6561              brea
-000357c0: 6b20 2320 666f 7220 690d 0a20 2020 2020  k # for i..     
-000357d0: 2020 206c 626c 203d 2022 4126 6c6c 2063     lbl = "A&ll c
-000357e0: 6861 7420 656e 7472 6965 7320 696e 2064  hat entries in d
-000357f0: 6174 6162 6173 6520 2825 7329 3a22 2025  atabase (%s):" %
-00035800: 2073 656c 662e 6c69 7374 5f63 6861 7473   self.list_chats
-00035810: 2e49 7465 6d43 6f75 6e74 0d0a 2020 2020  .ItemCount..    
-00035820: 2020 2020 7365 6c66 2e6c 6162 656c 5f6c      self.label_l
-00035830: 6973 745f 6368 6174 732e 4c61 6265 6c20  ist_chats.Label 
-00035840: 3d20 6c62 6c0d 0a0d 0a0d 0a20 2020 2064  = lbl......    d
-00035850: 6566 206f 6e5f 6368 616e 6765 5f63 6f6e  ef on_change_con
-00035860: 7461 6374 6669 6c74 6572 2873 656c 662c  tactfilter(self,
-00035870: 2065 7665 6e74 293a 0d0a 2020 2020 2020   event):..      
-00035880: 2020 2222 2248 616e 646c 6572 2066 6f72    """Handler for
-00035890: 2063 6861 6e67 696e 6720 7465 7874 2069   changing text i
-000358a0: 6e20 6368 6174 2066 696c 7465 7220 626f  n chat filter bo
-000358b0: 782c 2066 696c 7465 7273 2063 6861 7420  x, filters chat 
-000358c0: 6c69 7374 2e22 2222 0d0a 2020 2020 2020  list."""..      
-000358d0: 2020 636c 6973 7420 3d20 7365 6c66 2e6c    clist = self.l
-000358e0: 6973 745f 636f 6e74 6163 7473 0d0a 2020  ist_contacts..  
-000358f0: 2020 2020 2020 636c 6973 742e 5365 7446        clist.SetF
-00035900: 696c 7465 7228 6576 656e 742e 5374 7269  ilter(event.Stri
-00035910: 6e67 2e73 7472 6970 2829 290d 0a20 2020  ng.strip())..   
-00035920: 2020 2020 2066 6f72 2069 2069 6e20 7261       for i in ra
-00035930: 6e67 6528 636c 6973 742e 4974 656d 436f  nge(clist.ItemCo
-00035940: 756e 7429 2069 6620 7365 6c66 2e63 6861  unt) if self.cha
-00035950: 7420 656c 7365 2028 293a 0d0a 2020 2020  t else ():..    
-00035960: 2020 2020 2020 2020 6966 2063 6c69 7374          if clist
-00035970: 2e47 6574 4974 656d 4d61 7070 6564 4461  .GetItemMappedDa
-00035980: 7461 2869 2920 3d3d 2073 656c 662e 636f  ta(i) == self.co
-00035990: 6e74 6163 743a 0d0a 2020 2020 2020 2020  ntact:..        
-000359a0: 2020 2020 2020 2020 6620 3d20 636c 6973          f = clis
-000359b0: 742e 466f 6e74 3b20 662e 5365 7457 6569  t.Font; f.SetWei
-000359c0: 6768 7428 7778 2e46 4f4e 5457 4549 4748  ght(wx.FONTWEIGH
-000359d0: 545f 424f 4c44 290d 0a20 2020 2020 2020  T_BOLD)..       
-000359e0: 2020 2020 2020 2020 2063 6c69 7374 2e53           clist.S
-000359f0: 6574 4974 656d 466f 6e74 2869 2c20 6629  etItemFont(i, f)
-00035a00: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00035a10: 2020 6272 6561 6b20 2320 666f 7220 690d    break # for i.
-00035a20: 0a20 2020 2020 2020 206c 626c 203d 2022  .        lbl = "
-00035a30: 4126 6c6c 2070 726f 6669 6c65 7320 696e  A&ll profiles in
-00035a40: 2064 6174 6162 6173 6520 2825 7329 3a22   database (%s):"
-00035a50: 2025 2073 656c 662e 6c69 7374 5f63 6f6e   % self.list_con
-00035a60: 7461 6374 732e 4974 656d 436f 756e 740d  tacts.ItemCount.
-00035a70: 0a20 2020 2020 2020 2073 656c 662e 6c61  .        self.la
-00035a80: 6265 6c5f 6c69 7374 5f63 6f6e 7461 6374  bel_list_contact
-00035a90: 732e 4c61 6265 6c20 3d20 6c62 6c0d 0a0d  s.Label = lbl...
-00035aa0: 0a0d 0a20 2020 2064 6566 206f 6e5f 7265  ...    def on_re
-00035ab0: 6e61 6d65 5f63 6861 7428 7365 6c66 2c20  name_chat(self, 
-00035ac0: 6576 656e 743d 4e6f 6e65 2c20 6368 6174  event=None, chat
-00035ad0: 3d4e 6f6e 6529 3a0d 0a20 2020 2020 2020  =None):..       
-00035ae0: 2022 2222 0d0a 2020 2020 2020 2020 4861   """..        Ha
-00035af0: 6e64 6c65 7220 666f 7220 636c 6963 6b69  ndler for clicki
-00035b00: 6e67 2074 6f20 7265 6e61 6d65 2061 2063  ng to rename a c
-00035b10: 6861 742c 206f 7065 6e73 2061 2074 6578  hat, opens a tex
-00035b20: 7420 656e 7472 7920 6469 616c 6f67 0d0a  t entry dialog..
-00035b30: 2020 2020 2020 2020 616e 6420 7361 7665          and save
-00035b40: 7320 656e 7465 7265 6420 7661 6c75 6520  s entered value 
-00035b50: 6173 2043 6f6e 7665 7273 6174 696f 6e73  as Conversations
-00035b60: 2e67 6976 656e 5f64 6973 706c 6179 6e61  .given_displayna
-00035b70: 6d65 2e0d 0a20 2020 2020 2020 2022 2222  me...        """
-00035b80: 0d0a 2020 2020 2020 2020 6368 6174 203d  ..        chat =
-00035b90: 2063 6861 7420 6f72 2073 656c 662e 6368   chat or self.ch
-00035ba0: 6174 0d0a 2020 2020 2020 2020 646c 6720  at..        dlg 
-00035bb0: 3d20 7778 2e54 6578 7445 6e74 7279 4469  = wx.TextEntryDi
-00035bc0: 616c 6f67 2873 656c 662c 2022 4769 7665  alog(self, "Give
-00035bd0: 206e 6577 2064 6973 706c 6179 206e 616d   new display nam
-00035be0: 6520 666f 7220 7468 6520 636f 6e76 6572  e for the conver
-00035bf0: 7361 7469 6f6e 222c 0d0a 2020 2020 2020  sation",..      
-00035c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035c10: 2020 2020 2020 2020 2020 2063 6f6e 662e             conf.
-00035c20: 5469 746c 652c 2076 616c 7565 3d63 6861  Title, value=cha
-00035c30: 745b 2274 6974 6c65 225d 2c0d 0a20 2020  t["title"],..   
-00035c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035c50: 2020 2020 2020 2020 2020 2020 2020 7374                st
-00035c60: 796c 653d 7778 2e4f 4b20 7c20 7778 2e43  yle=wx.OK | wx.C
-00035c70: 414e 4345 4c29 0d0a 2020 2020 2020 2020  ANCEL)..        
-00035c80: 646c 672e 4365 6e74 6572 4f6e 5061 7265  dlg.CenterOnPare
-00035c90: 6e74 2829 0d0a 2020 2020 2020 2020 6966  nt()..        if
-00035ca0: 2077 782e 4944 5f4f 4b20 213d 2064 6c67   wx.ID_OK != dlg
-00035cb0: 2e53 686f 774d 6f64 616c 2829 3a20 7265  .ShowModal(): re
-00035cc0: 7475 726e 0d0a 0d0a 2020 2020 2020 2020  turn....        
-00035cd0: 7620 3d20 646c 672e 4765 7456 616c 7565  v = dlg.GetValue
-00035ce0: 2829 2e73 7472 6970 2829 0d0a 2020 2020  ().strip()..    
-00035cf0: 2020 2020 6966 2076 203d 3d20 6368 6174      if v == chat
-00035d00: 5b22 7469 746c 6522 5d20 5c0d 0a20 2020  ["title"] \..   
-00035d10: 2020 2020 206f 7220 6e6f 7420 7620 616e       or not v an
-00035d20: 6420 6e6f 7420 6368 6174 2e67 6574 2822  d not chat.get("
-00035d30: 6769 7665 6e5f 6469 7370 6c61 796e 616d  given_displaynam
-00035d40: 6522 293a 2072 6574 7572 6e0d 0a0d 0a20  e"): return.... 
-00035d50: 2020 2020 2020 2050 5245 4653 203d 205b         PREFS = [
-00035d60: 2264 6973 706c 6179 6e61 6d65 222c 2022  "displayname", "
-00035d70: 6d65 7461 5f74 6f70 6963 222c 2022 6964  meta_topic", "id
-00035d80: 656e 7469 7479 225d 0d0a 2020 2020 2020  entity"]..      
-00035d90: 2020 6b65 7930 2c20 6e61 6d65 3020 3d20    key0, name0 = 
-00035da0: 6e65 7874 2828 6b2c 2063 6861 745b 6b5d  next((k, chat[k]
-00035db0: 2920 666f 7220 6b20 696e 2050 5245 4653  ) for k in PREFS
-00035dc0: 2069 6620 6368 6174 2e67 6574 286b 2929   if chat.get(k))
-00035dd0: 0d0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
-00035de0: 2076 3a0d 0a20 2020 2020 2020 2020 2020   v:..           
-00035df0: 2069 6620 7778 2e4f 4b20 213d 2077 782e   if wx.OK != wx.
-00035e00: 4d65 7373 6167 6542 6f78 280d 0a20 2020  MessageBox(..   
-00035e10: 2020 2020 2020 2020 2020 2020 2027 5265               'Re
-00035e20: 6d6f 7665 2067 6976 656e 2064 6973 706c  move given displ
-00035e30: 6179 206e 616d 652c 2066 616c 6c69 6e67  ay name, falling
-00035e40: 2062 6163 6b20 746f 2025 7320 2225 7322   back to %s "%s"
-00035e50: 3f27 2025 0d0a 2020 2020 2020 2020 2020  ?' %..          
-00035e60: 2020 2020 2020 286b 6579 302c 206e 616d        (key0, nam
-00035e70: 6530 292c 2063 6f6e 662e 5469 746c 652c  e0), conf.Title,
-00035e80: 2077 782e 4f4b 207c 2077 782e 4341 4e43   wx.OK | wx.CANC
-00035e90: 454c 0d0a 2020 2020 2020 2020 2020 2020  EL..            
-00035ea0: 293a 2072 6574 7572 6e0d 0a20 2020 2020  ): return..     
-00035eb0: 2020 2020 2020 2076 203d 204e 6f6e 650d         v = None.
-00035ec0: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
-00035ed0: 6462 2e75 7064 6174 655f 726f 7728 2263  db.update_row("c
-00035ee0: 6f6e 7665 7273 6174 696f 6e73 222c 207b  onversations", {
-00035ef0: 2267 6976 656e 5f64 6973 706c 6179 6e61  "given_displayna
-00035f00: 6d65 223a 2076 7d2c 2063 6861 7429 0d0a  me": v}, chat)..
-00035f10: 2020 2020 2020 2020 6368 6174 5b22 6769          chat["gi
-00035f20: 7665 6e5f 6469 7370 6c61 796e 616d 6522  ven_displayname"
-00035f30: 5d20 3d20 760d 0a20 2020 2020 2020 2063  ] = v..        c
-00035f40: 6861 745b 2274 6974 6c65 225d 203d 2076  hat["title"] = v
-00035f50: 206f 7220 6e61 6d65 300d 0a0d 0a20 2020   or name0....   
-00035f60: 2020 2020 206c 7469 746c 6520 3d20 2822       ltitle = ("
-00035f70: 4368 6174 2077 6974 6820 2573 2220 6966  Chat with %s" if
-00035f80: 2073 6b79 7065 6461 7461 2e43 4841 5453   skypedata.CHATS
-00035f90: 5f54 5950 455f 5349 4e47 4c45 203d 3d20  _TYPE_SINGLE == 
-00035fa0: 6368 6174 5b22 7479 7065 225d 0d0a 2020  chat["type"]..  
-00035fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035fc0: 656c 7365 2027 4772 6f75 7020 6368 6174  else 'Group chat
-00035fd0: 2022 2573 2227 2920 2520 2876 206f 7220   "%s"') % (v or 
-00035fe0: 6e61 6d65 3029 0d0a 2020 2020 2020 2020  name0)..        
-00035ff0: 6368 6174 5b22 7469 746c 655f 6c6f 6e67  chat["title_long
-00036000: 225d 203d 206c 7469 746c 650d 0a20 2020  "] = ltitle..   
-00036010: 2020 2020 2063 6861 745b 2274 6974 6c65       chat["title
-00036020: 5f6c 6f6e 675f 6c63 225d 203d 206c 7469  _long_lc"] = lti
-00036030: 746c 655b 305d 2e6c 6f77 6572 2829 202b  tle[0].lower() +
-00036040: 206c 7469 746c 655b 313a 5d0d 0a0d 0a20   ltitle[1:].... 
-00036050: 2020 2020 2020 2073 656c 662e 6c69 7374         self.list
-00036060: 5f63 6861 7473 2e52 6566 7265 7368 526f  _chats.RefreshRo
-00036070: 7773 2829 0d0a 2020 2020 2020 2020 6966  ws()..        if
-00036080: 2063 6861 7420 6973 206e 6f74 2073 656c   chat is not sel
-00036090: 662e 6368 6174 3a20 7265 7475 726e 0d0a  f.chat: return..
-000360a0: 0d0a 2020 2020 2020 2020 2320 4164 6420  ..        # Add 
-000360b0: 7368 6f72 7463 7574 206b 6579 2066 6c61  shortcut key fla
-000360c0: 6720 746f 2063 6861 7420 6c61 6265 6c0d  g to chat label.
-000360d0: 0a20 2020 2020 2020 2073 656c 662e 6c61  .        self.la
-000360e0: 6265 6c5f 6368 6174 2e4c 6162 656c 203d  bel_chat.Label =
-000360f0: 2073 656c 662e 6368 6174 5b22 7469 746c   self.chat["titl
-00036100: 655f 6c6f 6e67 225d 2e72 6570 6c61 6365  e_long"].replace
-00036110: 280d 0a20 2020 2020 2020 2020 2020 2022  (..            "
-00036120: 6368 6174 222c 2022 2663 6861 7422 0d0a  chat", "&chat"..
-00036130: 2020 2020 2020 2020 292e 7265 706c 6163          ).replac
-00036140: 6528 2243 6861 7422 2c20 2226 4368 6174  e("Chat", "&Chat
-00036150: 2229 202b 2022 3a22 0d0a 2020 2020 2020  ") + ":"..      
-00036160: 2020 7365 6c66 2e6c 6162 656c 5f63 6861    self.label_cha
-00036170: 742e 5061 7265 6e74 2e4c 6179 6f75 7428  t.Parent.Layout(
-00036180: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00036190: 706f 7075 6c61 7465 5f63 6861 745f 7374  populate_chat_st
-000361a0: 6174 6973 7469 6373 2829 0d0a 2020 2020  atistics()..    
-000361b0: 2020 2020 6966 2073 656c 662e 6874 6d6c      if self.html
-000361c0: 5f73 7461 7473 2e53 686f 776e 3a0d 0a20  _stats.Shown:.. 
-000361d0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000361e0: 7368 6f77 5f73 7461 7473 2854 7275 6529  show_stats(True)
-000361f0: 2023 2054 6f20 7265 7374 6f72 6520 7363   # To restore sc
-00036200: 726f 6c6c 2070 6f73 6974 696f 6e0d 0a20  roll position.. 
-00036210: 2020 2020 2020 2073 656c 662e 6c6f 6164         self.load
-00036220: 5f63 6f6e 7461 6374 2873 656c 662e 636f  _contact(self.co
-00036230: 6e74 6163 7429 0d0a 0d0a 0d0a 2020 2020  ntact)......    
-00036240: 6465 6620 6f6e 5f72 656e 616d 655f 636f  def on_rename_co
-00036250: 6e74 6163 7428 7365 6c66 2c20 636f 6e74  ntact(self, cont
-00036260: 6163 742c 2065 7665 6e74 3d4e 6f6e 6529  act, event=None)
-00036270: 3a0d 0a20 2020 2020 2020 2022 2222 0d0a  :..        """..
-00036280: 2020 2020 2020 2020 4861 6e64 6c65 7220          Handler 
-00036290: 666f 7220 636c 6963 6b69 6e67 2074 6f20  for clicking to 
-000362a0: 7265 6e61 6d65 2061 2063 6f6e 7461 6374  rename a contact
-000362b0: 2c20 6f70 656e 7320 6120 7465 7874 2065  , opens a text e
-000362c0: 6e74 7279 2064 6961 6c6f 670d 0a20 2020  ntry dialog..   
-000362d0: 2020 2020 2061 6e64 2073 6176 6573 2065       and saves e
-000362e0: 6e74 6572 6564 2076 616c 7565 2061 7320  ntered value as 
-000362f0: 436f 6e74 6163 7473 2e67 6976 656e 5f64  Contacts.given_d
-00036300: 6973 706c 6179 6e61 6d65 2e0d 0a20 2020  isplayname...   
-00036310: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-00036320: 2020 6c61 6265 6c20 3d20 2264 6174 6162    label = "datab
-00036330: 6173 6520 6163 636f 756e 7422 2069 6620  ase account" if 
-00036340: 636f 6e74 6163 745b 2269 6465 6e74 6974  contact["identit
-00036350: 7922 5d20 3d3d 2073 656c 662e 6462 2e69  y"] == self.db.i
-00036360: 6420 656c 7365 2022 636f 6e74 6163 7422  d else "contact"
-00036370: 0d0a 2020 2020 2020 2020 646c 6720 3d20  ..        dlg = 
-00036380: 7778 2e54 6578 7445 6e74 7279 4469 616c  wx.TextEntryDial
-00036390: 6f67 2873 656c 662c 2027 4769 7665 206e  og(self, 'Give n
-000363a0: 6577 2064 6973 706c 6179 206e 616d 6520  ew display name 
-000363b0: 666f 7220 2573 2022 2573 223a 2720 250d  for %s "%s":' %.
-000363c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000363d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000363e0: 2020 286c 6162 656c 2c20 636f 6e74 6163    (label, contac
-000363f0: 745b 2269 6465 6e74 6974 7922 5d29 2c0d  t["identity"]),.
-00036400: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00036410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036420: 2020 636f 6e66 2e54 6974 6c65 2c20 7661    conf.Title, va
-00036430: 6c75 653d 636f 6e74 6163 745b 226e 616d  lue=contact["nam
-00036440: 6522 5d2c 0d0a 2020 2020 2020 2020 2020  e"],..          
-00036450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036460: 2020 2020 2020 2073 7479 6c65 3d77 782e         style=wx.
-00036470: 4f4b 207c 2077 782e 4341 4e43 454c 290d  OK | wx.CANCEL).
-00036480: 0a20 2020 2020 2020 2064 6c67 2e43 656e  .        dlg.Cen
-00036490: 7465 724f 6e50 6172 656e 7428 290d 0a20  terOnParent().. 
-000364a0: 2020 2020 2020 2069 6620 7778 2e49 445f         if wx.ID_
-000364b0: 4f4b 2021 3d20 646c 672e 5368 6f77 4d6f  OK != dlg.ShowMo
-000364c0: 6461 6c28 293a 2072 6574 7572 6e0d 0a0d  dal(): return...
-000364d0: 0a20 2020 2020 2020 2076 203d 2064 6c67  .        v = dlg
-000364e0: 2e47 6574 5661 6c75 6528 292e 7374 7269  .GetValue().stri
-000364f0: 7028 290d 0a20 2020 2020 2020 2069 6620  p()..        if 
-00036500: 7620 3d3d 2063 6f6e 7461 6374 5b22 6e61  v == contact["na
-00036510: 6d65 225d 205c 0d0a 2020 2020 2020 2020  me"] \..        
-00036520: 6f72 206e 6f74 2076 2061 6e64 206e 6f74  or not v and not
-00036530: 2063 6f6e 7461 6374 2e67 6574 2822 6769   contact.get("gi
-00036540: 7665 6e5f 6469 7370 6c61 796e 616d 6522  ven_displayname"
-00036550: 2920 5c0d 0a20 2020 2020 2020 206f 7220  ) \..        or 
-00036560: 6e6f 7420 7620 616e 6420 636f 6e74 6163  not v and contac
-00036570: 745b 2269 6465 6e74 6974 7922 5d20 3d3d  t["identity"] ==
-00036580: 2073 656c 662e 6462 2e69 6420 5c0d 0a20   self.db.id \.. 
-00036590: 2020 2020 2020 2061 6e64 206e 6f74 2073         and not s
-000365a0: 656c 662e 6462 2e61 6363 6f75 6e74 2e67  elf.db.account.g
-000365b0: 6574 2822 6769 7665 6e5f 6469 7370 6c61  et("given_displa
-000365c0: 796e 616d 6522 293a 2072 6574 7572 6e0d  yname"): return.
-000365d0: 0a0d 0a20 2020 2020 2020 2050 5245 4653  ...        PREFS
-000365e0: 203d 205b 2266 756c 6c6e 616d 6522 2c20   = ["fullname", 
-000365f0: 2264 6973 706c 6179 6e61 6d65 222c 2022  "displayname", "
-00036600: 736b 7970 656e 616d 6522 2c20 2270 7374  skypename", "pst
-00036610: 6e6e 756d 6265 7222 5d0d 0a20 2020 2020  nnumber"]..     
-00036620: 2020 206b 6579 302c 206e 616d 6530 203d     key0, name0 =
-00036630: 206e 6578 7428 286b 2c20 636f 6e74 6163   next((k, contac
-00036640: 745b 6b5d 2920 666f 7220 6b20 696e 2050  t[k]) for k in P
-00036650: 5245 4653 2069 6620 636f 6e74 6163 742e  REFS if contact.
-00036660: 6765 7428 6b29 290d 0a20 2020 2020 2020  get(k))..       
-00036670: 2069 6620 6e6f 7420 763a 0d0a 2020 2020   if not v:..    
-00036680: 2020 2020 2020 2020 6966 2077 782e 4f4b          if wx.OK
-00036690: 2021 3d20 7778 2e4d 6573 7361 6765 426f   != wx.MessageBo
-000366a0: 7828 0d0a 2020 2020 2020 2020 2020 2020  x(..            
-000366b0: 2020 2020 2752 656d 6f76 6520 6769 7665      'Remove give
-000366c0: 6e20 6469 7370 6c61 7920 6e61 6d65 2066  n display name f
-000366d0: 726f 6d20 2225 7322 2c20 6661 6c6c 696e  rom "%s", fallin
-000366e0: 6720 6261 636b 2074 6f20 2573 2022 2573  g back to %s "%s
-000366f0: 223f 2720 250d 0a20 2020 2020 2020 2020  "?' %..         
-00036700: 2020 2020 2020 2028 636f 6e74 6163 745b         (contact[
-00036710: 2269 6465 6e74 6974 7922 5d2c 206b 6579  "identity"], key
-00036720: 302c 206e 616d 6530 292c 0d0a 2020 2020  0, name0),..    
-00036730: 2020 2020 2020 2020 2020 2020 636f 6e66              conf
-00036740: 2e54 6974 6c65 2c20 7778 2e4f 4b20 7c20  .Title, wx.OK | 
-00036750: 7778 2e43 414e 4345 4c0d 0a20 2020 2020  wx.CANCEL..     
-00036760: 2020 2020 2020 2029 3a20 7265 7475 726e         ): return
-00036770: 0d0a 2020 2020 2020 2020 2020 2020 7620  ..            v 
-00036780: 3d20 4e6f 6e65 0d0a 0d0a 2020 2020 2020  = None....      
-00036790: 2020 6966 2063 6f6e 7461 6374 5b22 6964    if contact["id
-000367a0: 656e 7469 7479 225d 2021 3d20 7365 6c66  entity"] != self
-000367b0: 2e64 622e 6964 3a0d 0a20 2020 2020 2020  .db.id:..       
-000367c0: 2020 2020 2073 656c 662e 6462 2e75 7064       self.db.upd
-000367d0: 6174 655f 726f 7728 2263 6f6e 7461 6374  ate_row("contact
-000367e0: 7322 2c20 7b22 6769 7665 6e5f 6469 7370  s", {"given_disp
-000367f0: 6c61 796e 616d 6522 3a20 767d 2c20 636f  layname": v}, co
-00036800: 6e74 6163 7429 0d0a 2020 2020 2020 2020  ntact)..        
-00036810: 636f 6e74 6163 745b 2267 6976 656e 5f64  contact["given_d
-00036820: 6973 706c 6179 6e61 6d65 225d 203d 2076  isplayname"] = v
-00036830: 0d0a 2020 2020 2020 2020 636f 6e74 6163  ..        contac
-00036840: 745b 226e 616d 6522 5d20 3d20 7620 6f72  t["name"] = v or
-00036850: 206e 616d 6530 0d0a 0d0a 2020 2020 2020   name0....      
-00036860: 2020 6966 2063 6f6e 7461 6374 5b22 6964    if contact["id
-00036870: 656e 7469 7479 225d 203d 3d20 7365 6c66  entity"] == self
-00036880: 2e64 622e 6964 3a0d 0a20 2020 2020 2020  .db.id:..       
-00036890: 2020 2020 2073 656c 662e 6462 2e75 7064       self.db.upd
-000368a0: 6174 655f 726f 7728 2261 6363 6f75 6e74  ate_row("account
-000368b0: 7322 2c20 7b22 6769 7665 6e5f 6469 7370  s", {"given_disp
-000368c0: 6c61 796e 616d 6522 3a20 767d 2c20 7365  layname": v}, se
-000368d0: 6c66 2e64 622e 6163 636f 756e 7429 0d0a  lf.db.account)..
-000368e0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000368f0: 2e64 622e 6163 636f 756e 745b 2267 6976  .db.account["giv
-00036900: 656e 5f64 6973 706c 6179 6e61 6d65 225d  en_displayname"]
-00036910: 203d 2076 0d0a 2020 2020 2020 2020 2020   = v..          
-00036920: 2020 7365 6c66 2e64 622e 6163 636f 756e    self.db.accoun
-00036930: 745b 226e 616d 6522 5d20 3d20 7620 6f72  t["name"] = v or
-00036940: 206e 616d 6530 0d0a 2020 2020 2020 2020   name0..        
-00036950: 2020 2020 7365 6c66 2e75 7064 6174 655f      self.update_
-00036960: 6163 636f 756e 7469 6e66 6f28 290d 0a0d  accountinfo()...
-00036970: 0a20 2020 2020 2020 2069 6478 203d 206e  .        idx = n
-00036980: 6578 7428 2869 2066 6f72 2069 2069 6e20  ext((i for i in 
-00036990: 7261 6e67 6528 7365 6c66 2e6c 6973 745f  range(self.list_
-000369a0: 7061 7274 6963 6970 616e 7473 2e47 6574  participants.Get
-000369b0: 4974 656d 436f 756e 7428 2929 0d0a 2020  ItemCount())..  
-000369c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000369d0: 2020 6966 2073 656c 662e 6c69 7374 5f70    if self.list_p
-000369e0: 6172 7469 6369 7061 6e74 732e 4765 7449  articipants.GetI
-000369f0: 7465 6d44 6174 6128 6929 5b22 636f 6e74  temData(i)["cont
-00036a00: 6163 7422 5d20 6973 2063 6f6e 7461 6374  act"] is contact
-00036a10: 292c 204e 6f6e 6529 0d0a 2020 2020 2020  ), None)..      
-00036a20: 2020 6966 2069 6478 2069 7320 6e6f 7420    if idx is not 
-00036a30: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
-00036a40: 2020 2073 656c 662e 6c69 7374 5f70 6172     self.list_par
-00036a50: 7469 6369 7061 6e74 732e 5365 7449 7465  ticipants.SetIte
-00036a60: 6d54 6578 7428 6964 782c 2022 2528 6e61  mText(idx, "%(na
-00036a70: 6d65 2973 2028 2528 6964 656e 7469 7479  me)s (%(identity
-00036a80: 2973 2922 2025 2063 6f6e 7461 6374 290d  )s)" % contact).
-00036a90: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00036aa0: 662e 7374 635f 6869 7374 6f72 792e 5265  f.stc_history.Re
-00036ab0: 6672 6573 684d 6573 7361 6765 7328 290d  freshMessages().
-00036ac0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00036ad0: 662e 706f 7075 6c61 7465 5f63 6861 745f  f.populate_chat_
-00036ae0: 7374 6174 6973 7469 6373 2829 0d0a 2020  statistics()..  
-00036af0: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-00036b00: 662e 6874 6d6c 5f73 7461 7473 2e53 686f  f.html_stats.Sho
-00036b10: 776e 3a0d 0a20 2020 2020 2020 2020 2020  wn:..           
-00036b20: 2020 2020 2073 656c 662e 7368 6f77 5f73       self.show_s
-00036b30: 7461 7473 2854 7275 6529 2023 2054 6f20  tats(True) # To 
-00036b40: 7265 7374 6f72 6520 7363 726f 6c6c 2070  restore scroll p
-00036b50: 6f73 6974 696f 6e0d 0a20 2020 2020 2020  osition..       
-00036b60: 2073 656c 662e 6c69 7374 5f63 6f6e 7461   self.list_conta
-00036b70: 6374 732e 5265 6672 6573 6852 6f77 7328  cts.RefreshRows(
-00036b80: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00036b90: 6c6f 6164 5f63 6f6e 7461 6374 2873 656c  load_contact(sel
-00036ba0: 662e 636f 6e74 6163 7429 0d0a 0d0a 0d0a  f.contact)......
-00036bb0: 2020 2020 6465 6620 6f6e 5f65 7870 6f72      def on_expor
-00036bc0: 745f 6368 6174 2873 656c 662c 2065 7665  t_chat(self, eve
-00036bd0: 6e74 293a 0d0a 2020 2020 2020 2020 2222  nt):..        ""
-00036be0: 220d 0a20 2020 2020 2020 2048 616e 646c  "..        Handl
-00036bf0: 6572 2066 6f72 2063 6c69 636b 696e 6720  er for clicking 
-00036c00: 746f 2065 7870 6f72 7420 6120 6368 6174  to export a chat
-00036c10: 2c20 6469 7370 6c61 7973 2061 2073 6176  , displays a sav
-00036c20: 6520 6669 6c65 2064 6961 6c6f 6720 616e  e file dialog an
-00036c30: 640d 0a20 2020 2020 2020 2073 6176 6573  d..        saves
-00036c40: 2074 6865 2063 7572 7265 6e74 206d 6573   the current mes
-00036c50: 7361 6765 7320 746f 2066 696c 652e 0d0a  sages to file...
-00036c60: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
-00036c70: 2020 2020 2066 6f72 6d61 7461 7267 7320       formatargs 
-00036c80: 3d20 636f 6c6c 6563 7469 6f6e 732e 6465  = collections.de
-00036c90: 6661 756c 7464 6963 7428 7374 7229 3b20  faultdict(str); 
-00036ca0: 666f 726d 6174 6172 6773 2e75 7064 6174  formatargs.updat
-00036cb0: 6528 7365 6c66 2e63 6861 7429 0d0a 2020  e(self.chat)..  
-00036cc0: 2020 2020 2020 6465 6661 756c 7420 3d20        default = 
-00036cd0: 7574 696c 2e73 6166 655f 6669 6c65 6e61  util.safe_filena
-00036ce0: 6d65 2863 6f6e 662e 4578 706f 7274 4368  me(conf.ExportCh
-00036cf0: 6174 5465 6d70 6c61 7465 2025 2066 6f72  atTemplate % for
-00036d00: 6d61 7461 7267 7329 0d0a 2020 2020 2020  matargs)..      
-00036d10: 2020 7365 6c66 2e64 6961 6c6f 675f 7361    self.dialog_sa
-00036d20: 7665 6368 6174 2e46 696c 656e 616d 6520  vechat.Filename 
-00036d30: 3d20 6465 6661 756c 740d 0a20 2020 2020  = default..     
-00036d40: 2020 2069 6620 7778 2e49 445f 4f4b 2021     if wx.ID_OK !
-00036d50: 3d20 7365 6c66 2e64 6961 6c6f 675f 7361  = self.dialog_sa
-00036d60: 7665 6368 6174 2e53 686f 774d 6f64 616c  vechat.ShowModal
-00036d70: 2829 3a20 7265 7475 726e 0d0a 0d0a 2020  (): return....  
-00036d80: 2020 2020 2020 6669 6c65 7061 7468 203d        filepath =
-00036d90: 2063 6f6e 7472 6f6c 732e 6765 745f 6469   controls.get_di
-00036da0: 616c 6f67 5f70 6174 6828 7365 6c66 2e64  alog_path(self.d
-00036db0: 6961 6c6f 675f 7361 7665 6368 6174 290d  ialog_savechat).
-00036dc0: 0a20 2020 2020 2020 2066 6f72 6d61 7420  .        format 
-00036dd0: 3d20 6578 706f 7274 2e43 4841 545f 4558  = export.CHAT_EX
-00036de0: 5453 5b73 656c 662e 6469 616c 6f67 5f73  TS[self.dialog_s
-00036df0: 6176 6563 6861 742e 4669 6c74 6572 496e  avechat.FilterIn
-00036e00: 6465 785d 0d0a 2020 2020 2020 2020 6d65  dex]..        me
-00036e10: 6469 615f 666f 6c64 6572 203d 2022 6874  dia_folder = "ht
-00036e20: 6d6c 2220 3d3d 2066 6f72 6d61 7420 616e  ml" == format an
-00036e30: 6420 5c0d 0a20 2020 2020 2020 2020 2020  d \..           
-00036e40: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00036e50: 2e64 6961 6c6f 675f 7361 7665 6368 6174  .dialog_savechat
-00036e60: 2e46 696c 7465 7249 6e64 6578 2021 3d20  .FilterIndex != 
-00036e70: 6578 706f 7274 2e43 4841 545f 4558 5453  export.CHAT_EXTS
-00036e80: 2e69 6e64 6578 2822 6874 6d6c 2229 0d0a  .index("html")..
-00036e90: 2020 2020 2020 2020 6966 206d 6564 6961          if media
-00036ea0: 5f66 6f6c 6465 7220 616e 6420 6e6f 7420  _folder and not 
-00036eb0: 6368 6563 6b5f 6d65 6469 615f 6578 706f  check_media_expo
-00036ec0: 7274 5f6c 6f67 696e 2873 656c 662e 6462  rt_login(self.db
-00036ed0: 293a 2072 6574 7572 6e0d 0a0d 0a20 2020  ): return....   
-00036ee0: 2020 2020 2062 7573 7920 3d20 636f 6e74       busy = cont
-00036ef0: 726f 6c73 2e42 7573 7950 616e 656c 2873  rols.BusyPanel(s
-00036f00: 656c 662c 2027 4578 706f 7274 696e 6720  elf, 'Exporting 
-00036f10: 2225 7322 2e27 2025 2073 656c 662e 6368  "%s".' % self.ch
-00036f20: 6174 5b22 7469 746c 6522 5d29 0d0a 2020  at["title"])..  
-00036f30: 2020 2020 2020 6775 6962 6173 652e 7374        guibase.st
-00036f40: 6174 7573 2822 4578 706f 7274 696e 6720  atus("Exporting 
-00036f50: 746f 2025 732e 222c 2066 696c 6570 6174  to %s.", filepat
-00036f60: 6829 0d0a 2020 2020 2020 2020 7472 793a  h)..        try:
-00036f70: 0d0a 2020 2020 2020 2020 2020 2020 6d65  ..            me
-00036f80: 7373 6167 6573 203d 2073 656c 662e 7374  ssages = self.st
-00036f90: 635f 6869 7374 6f72 792e 4765 744d 6573  c_history.GetMes
-00036fa0: 7361 6765 7328 290d 0a20 2020 2020 2020  sages()..       
-00036fb0: 2020 2020 2070 726f 6772 6573 7366 756e       progressfun
-00036fc0: 6320 3d20 6c61 6d62 6461 202a 6172 6773  c = lambda *args
-00036fd0: 3a20 7778 2e53 6166 6559 6965 6c64 2829  : wx.SafeYield()
-00036fe0: 0d0a 2020 2020 2020 2020 2020 2020 6f70  ..            op
-00036ff0: 7473 203d 2064 6963 7428 7072 6f67 7265  ts = dict(progre
-00037000: 7373 3d70 726f 6772 6573 7366 756e 632c  ss=progressfunc,
-00037010: 206e 6f73 6b69 703d 5472 7565 2c20 6d65   noskip=True, me
-00037020: 7373 6167 6573 3d6d 6573 7361 6765 7329  ssages=messages)
-00037030: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00037040: 206d 6564 6961 5f66 6f6c 6465 723a 206f   media_folder: o
-00037050: 7074 735b 226d 6564 6961 5f66 6f6c 6465  pts["media_folde
-00037060: 7222 5d20 3d20 5472 7565 0d0a 2020 2020  r"] = True..    
-00037070: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
-00037080: 2065 7870 6f72 742e 6578 706f 7274 5f63   export.export_c
-00037090: 6861 7473 285b 7365 6c66 2e63 6861 745d  hats([self.chat]
-000370a0: 2c20 6669 6c65 7061 7468 2c20 666f 726d  , filepath, form
-000370b0: 6174 2c20 7365 6c66 2e64 622c 206f 7074  at, self.db, opt
-000370c0: 7329 0d0a 2020 2020 2020 2020 2020 2020  s)..            
-000370d0: 6669 6c65 732c 2063 6f75 6e74 2c20 6d65  files, count, me
-000370e0: 7373 6167 655f 636f 756e 7420 3d20 7265  ssage_count = re
-000370f0: 7375 6c74 0d0a 2020 2020 2020 2020 2020  sult..          
-00037100: 2020 6775 6962 6173 652e 7374 6174 7573    guibase.status
-00037110: 2822 4578 706f 7274 6564 2025 7320 746f  ("Exported %s to
-00037120: 2025 732e 222c 0d0a 2020 2020 2020 2020   %s.",..        
-00037130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00037140: 2020 2075 7469 6c2e 706c 7572 616c 2822     util.plural("
-00037150: 6d65 7373 6167 6522 2c20 6d65 7373 6167  message", messag
-00037160: 655f 636f 756e 742c 2073 6570 3d22 2c22  e_count, sep=","
-00037170: 292c 2066 696c 6570 6174 682c 206c 6f67  ), filepath, log
-00037180: 3d54 7275 6529 0d0a 2020 2020 2020 2020  =True)..        
-00037190: 2020 2020 7472 793a 2063 6f6e 662e 4578      try: conf.Ex
-000371a0: 706f 7274 4669 6c65 4175 746f 4f70 656e  portFileAutoOpen
-000371b0: 2061 6e64 2075 7469 6c2e 7374 6172 745f   and util.start_
-000371c0: 6669 6c65 2866 696c 6570 6174 6829 0d0a  file(filepath)..
-000371d0: 2020 2020 2020 2020 2020 2020 6578 6365              exce
-000371e0: 7074 2045 7863 6570 7469 6f6e 3a0d 0a20  pt Exception:.. 
-000371f0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-00037200: 6f67 6765 722e 6578 6365 7074 696f 6e28  ogger.exception(
-00037210: 2245 7272 6f72 2073 7461 7274 696e 6720  "Error starting 
-00037220: 2573 2e22 2c20 6669 6c65 7061 7468 290d  %s.", filepath).
-00037230: 0a20 2020 2020 2020 2020 2020 2077 782e  .            wx.
-00037240: 4361 6c6c 4166 7465 7228 7365 6c66 2e75  CallAfter(self.u
-00037250: 7064 6174 655f 6c69 7665 696e 666f 290d  pdate_liveinfo).
-00037260: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-00037270: 4578 6365 7074 696f 6e3a 0d0a 2020 2020  Exception:..    
-00037280: 2020 2020 2020 2020 6c6f 6767 6572 2e65          logger.e
-00037290: 7863 6570 7469 6f6e 2822 4572 726f 7220  xception("Error 
-000372a0: 7361 7669 6e67 2025 732e 222c 2066 696c  saving %s.", fil
-000372b0: 6570 6174 6829 0d0a 2020 2020 2020 2020  epath)..        
-000372c0: 2020 2020 6775 6962 6173 652e 7374 6174      guibase.stat
-000372d0: 7573 2822 4572 726f 7220 7361 7669 6e67  us("Error saving
-000372e0: 2025 732e 222c 2066 696c 6570 6174 6829   %s.", filepath)
-000372f0: 0d0a 2020 2020 2020 2020 2020 2020 6572  ..            er
-00037300: 726f 726d 7367 203d 2022 4572 726f 7220  rormsg = "Error 
-00037310: 7361 7669 6e67 2025 733a 5c6e 5c6e 2573  saving %s:\n\n%s
-00037320: 2220 2520 5c0d 0a20 2020 2020 2020 2020  " % \..         
-00037330: 2020 2020 2020 2020 2020 2020 2020 2866                (f
-00037340: 696c 6570 6174 682c 2074 7261 6365 6261  ilepath, traceba
-00037350: 636b 2e66 6f72 6d61 745f 6578 6328 2929  ck.format_exc())
-00037360: 0d0a 2020 2020 2020 2020 2020 2020 7778  ..            wx
-00037370: 2e4d 6573 7361 6765 426f 7828 6572 726f  .MessageBox(erro
-00037380: 726d 7367 2c20 636f 6e66 2e54 6974 6c65  rmsg, conf.Title
-00037390: 2c20 7778 2e4f 4b20 7c20 7778 2e49 434f  , wx.OK | wx.ICO
-000373a0: 4e5f 5741 524e 494e 4729 0d0a 2020 2020  N_WARNING)..    
-000373b0: 2020 2020 2020 2020 7778 2e43 616c 6c41          wx.CallA
-000373c0: 6674 6572 2875 7469 6c2e 7472 795f 6967  fter(util.try_ig
-000373d0: 6e6f 7265 2c20 6f73 2e75 6e6c 696e 6b2c  nore, os.unlink,
-000373e0: 2066 696c 6570 6174 6829 0d0a 2020 2020   filepath)..    
-000373f0: 2020 2020 6669 6e61 6c6c 793a 0d0a 2020      finally:..  
-00037400: 2020 2020 2020 2020 2020 6275 7379 2e43            busy.C
-00037410: 6c6f 7365 2829 0d0a 0d0a 0d0a 2020 2020  lose()......    
-00037420: 6465 6620 6f6e 5f65 7870 6f72 745f 6368  def on_export_ch
-00037430: 6174 735f 6d65 6e75 2873 656c 662c 2065  ats_menu(self, e
-00037440: 7665 6e74 293a 0d0a 2020 2020 2020 2020  vent):..        
-00037450: 2222 220d 0a20 2020 2020 2020 2048 616e  """..        Han
-00037460: 646c 6572 2066 6f72 2063 6c69 636b 696e  dler for clickin
-00037470: 6720 746f 2065 7870 6f72 7420 7365 6c65  g to export sele
-00037480: 6374 6564 206f 7220 616c 6c20 6368 6174  cted or all chat
-00037490: 732c 2064 6973 706c 6179 7320 610d 0a20  s, displays a.. 
-000374a0: 2020 2020 2020 2073 7562 6d65 6e75 2077         submenu w
-000374b0: 6974 6820 6368 6f69 6365 7320 746f 2065  ith choices to e
-000374c0: 7870 6f72 7420 7365 6c65 6374 6564 2063  xport selected c
-000374d0: 6861 7473 206f 7220 616c 6c20 6368 6174  hats or all chat
-000374e0: 732e 0d0a 2020 2020 2020 2020 2222 220d  s...        """.
-000374f0: 0a20 2020 2020 2020 2073 656c 6563 7465  .        selecte
-00037500: 642c 2073 656c 6563 7465 6473 203d 2073  d, selecteds = s
-00037510: 656c 662e 6c69 7374 5f63 6861 7473 2e47  elf.list_chats.G
-00037520: 6574 4669 7273 7453 656c 6563 7465 6428  etFirstSelected(
-00037530: 292c 205b 5d0d 0a20 2020 2020 2020 2077  ), []..        w
-00037540: 6869 6c65 2073 656c 6563 7465 6420 3e3d  hile selected >=
-00037550: 2030 3a0d 0a20 2020 2020 2020 2020 2020   0:..           
-00037560: 2073 656c 6563 7465 6473 2e61 7070 656e   selecteds.appen
-00037570: 6428 7365 6c65 6374 6564 290d 0a20 2020  d(selected)..   
-00037580: 2020 2020 2020 2020 2073 656c 6563 7465           selecte
-00037590: 6420 3d20 7365 6c66 2e6c 6973 745f 6368  d = self.list_ch
-000375a0: 6174 732e 4765 744e 6578 7453 656c 6563  ats.GetNextSelec
-000375b0: 7465 6428 7365 6c65 6374 6564 290d 0a0d  ted(selected)...
-000375c0: 0a20 2020 2020 2020 2064 6566 2068 616e  .        def han
-000375d0: 646c 6572 2864 6f5f 616c 6c3d 4661 6c73  dler(do_all=Fals
-000375e0: 652c 2064 6f5f 7369 6e67 6c65 6669 6c65  e, do_singlefile
-000375f0: 3d46 616c 7365 2c20 646f 5f74 696d 6572  =False, do_timer
-00037600: 616e 6765 3d46 616c 7365 293a 0d0a 2020  ange=False):..  
-00037610: 2020 2020 2020 2020 2020 6368 6174 7320            chats 
-00037620: 3d20 5b73 656c 662e 6c69 7374 5f63 6861  = [self.list_cha
-00037630: 7473 2e47 6574 4974 656d 4d61 7070 6564  ts.GetItemMapped
-00037640: 4461 7461 2869 290d 0a20 2020 2020 2020  Data(i)..       
-00037650: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00037660: 7220 6920 696e 2028 7261 6e67 6528 7365  r i in (range(se
-00037670: 6c66 2e6c 6973 745f 6368 6174 732e 4974  lf.list_chats.It
-00037680: 656d 436f 756e 7429 2069 6620 646f 5f61  emCount) if do_a
-00037690: 6c6c 2065 6c73 6520 7365 6c65 6374 6564  ll else selected
-000376a0: 7329 5d0d 0a20 2020 2020 2020 2020 2020  s)]..           
-000376b0: 2072 6574 7572 6e20 6675 6e63 746f 6f6c   return functool
-000376c0: 732e 7061 7274 6961 6c28 7365 6c66 2e6f  s.partial(self.o
-000376d0: 6e5f 6578 706f 7274 5f63 6861 7473 2c0d  n_export_chats,.
-000376e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000376f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00037700: 2020 2020 2020 6368 6174 732c 2064 6f5f        chats, do_
-00037710: 616c 6c2c 2064 6f5f 7369 6e67 6c65 6669  all, do_singlefi
-00037720: 6c65 2c20 646f 5f74 696d 6572 616e 6765  le, do_timerange
-00037730: 290d 0a0d 0a20 2020 2020 2020 206d 656e  )....        men
-00037740: 7520 3d20 7778 2e4d 656e 7528 290d 0a20  u = wx.Menu().. 
-00037750: 2020 2020 2020 206d 656e 755f 7365 6c20         menu_sel 
-00037760: 203d 2077 782e 4d65 6e75 2829 0d0a 2020   = wx.Menu()..  
-00037770: 2020 2020 2020 6d65 6e75 5f61 6c6c 2020        menu_all  
-00037780: 3d20 7778 2e4d 656e 7528 290d 0a20 2020  = wx.Menu()..   
-00037790: 2020 2020 206d 656e 755f 6461 7465 203d       menu_date =
-000377a0: 2077 782e 4d65 6e75 2829 0d0a 0d0a 2020   wx.Menu()....  
-000377b0: 2020 2020 2020 6974 656d 5f73 656c 5f6d        item_sel_m
-000377c0: 756c 7469 203d 2077 782e 4d65 6e75 4974  ulti = wx.MenuIt
-000377d0: 656d 286d 656e 755f 7365 6c2c 2077 782e  em(menu_sel, wx.
-000377e0: 4944 5f41 4e59 2c20 2249 6e74 6f20 696e  ID_ANY, "Into in
-000377f0: 6469 7669 6475 616c 2026 6669 6c65 7322  dividual &files"
-00037800: 290d 0a20 2020 2020 2020 206d 656e 755f  )..        menu_
-00037810: 7365 6c2e 4170 7065 6e64 2869 7465 6d5f  sel.Append(item_
-00037820: 7365 6c5f 6d75 6c74 6929 0d0a 2020 2020  sel_multi)..    
-00037830: 2020 2020 7365 6c66 2e42 696e 6428 7778      self.Bind(wx
-00037840: 2e45 5654 5f4d 454e 552c 2068 616e 646c  .EVT_MENU, handl
-00037850: 6572 2829 2c20 6974 656d 5f73 656c 5f6d  er(), item_sel_m
-00037860: 756c 7469 290d 0a20 2020 2020 2020 2069  ulti)..        i
-00037870: 6620 6578 706f 7274 2e78 6c73 7877 7269  f export.xlsxwri
-00037880: 7465 723a 0d0a 2020 2020 2020 2020 2020  ter:..          
-00037890: 2020 6974 656d 5f73 656c 5f73 696e 676c    item_sel_singl
-000378a0: 6520 3d20 7778 2e4d 656e 7549 7465 6d28  e = wx.MenuItem(
-000378b0: 6d65 6e75 5f73 656c 2c20 7778 2e49 445f  menu_sel, wx.ID_
-000378c0: 414e 592c 0d0a 2020 2020 2020 2020 2020  ANY,..          
+00034c40: 4e6f 6e65 0d0a 2020 2020 2020 2020 2020  None..          
+00034c50: 2020 7461 626c 655f 6e61 6d65 203d 2074    table_name = t
+00034c60: 6162 6c65 5f6e 616d 652e 6c6f 7765 7228  able_name.lower(
+00034c70: 290d 0a20 2020 2020 2020 2020 2020 2074  )..            t
+00034c80: 6162 6c65 203d 206e 6578 7428 2874 2066  able = next((t f
+00034c90: 6f72 2074 2069 6e20 7365 6c66 2e64 622e  or t in self.db.
+00034ca0: 6765 745f 7461 626c 6573 2829 0d0a 2020  get_tables()..  
+00034cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034cc0: 2020 2020 2020 2020 6966 2074 5b22 6e61          if t["na
+00034cd0: 6d65 225d 2e6c 6f77 6572 2829 203d 3d20  me"].lower() == 
+00034ce0: 7461 626c 655f 6e61 6d65 292c 204e 6f6e  table_name), Non
+00034cf0: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+00034d00: 6974 656d 203d 2073 656c 662e 7472 6565  item = self.tree
+00034d10: 5f74 6162 6c65 732e 4765 744e 6578 7428  _tables.GetNext(
+00034d20: 7365 6c66 2e74 7265 655f 7461 626c 6573  self.tree_tables
+00034d30: 2e47 6574 526f 6f74 4974 656d 2829 290d  .GetRootItem()).
+00034d40: 0a20 2020 2020 2020 2020 2020 2077 6869  .            whi
+00034d50: 6c65 2074 6162 6c65 2061 6e64 2069 7465  le table and ite
+00034d60: 6d20 616e 6420 6974 656d 2e49 734f 6b28  m and item.IsOk(
+00034d70: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00034d80: 2020 2020 7461 626c 6532 203d 2073 656c      table2 = sel
+00034d90: 662e 7472 6565 5f74 6162 6c65 732e 4765  f.tree_tables.Ge
+00034da0: 7449 7465 6d50 7944 6174 6128 6974 656d  tItemPyData(item
+00034db0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00034dc0: 2020 2069 6620 7461 626c 6532 2061 6e64     if table2 and
+00034dd0: 2074 6162 6c65 322e 6c6f 7765 7228 2920   table2.lower() 
+00034de0: 3d3d 2074 6162 6c65 5b22 6e61 6d65 225d  == table["name"]
+00034df0: 2e6c 6f77 6572 2829 3a0d 0a20 2020 2020  .lower():..     
+00034e00: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00034e10: 6162 6c65 6974 656d 203d 2069 7465 6d0d  ableitem = item.
+00034e20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00034e30: 2020 2020 2062 7265 616b 2023 2062 7265       break # bre
+00034e40: 616b 2077 6869 6c65 2074 6162 6c65 2061  ak while table a
+00034e50: 6e64 2069 7465 6d20 616e 6420 6974 656b  nd item and itek
+00034e60: 2e49 734f 6b28 290d 0a20 2020 2020 2020  .IsOk()..       
+00034e70: 2020 2020 2020 2020 2069 7465 6d20 3d20           item = 
+00034e80: 7365 6c66 2e74 7265 655f 7461 626c 6573  self.tree_tables
+00034e90: 2e47 6574 4e65 7874 5369 626c 696e 6728  .GetNextSibling(
+00034ea0: 6974 656d 290d 0a20 2020 2020 2020 2020  item)..         
+00034eb0: 2020 2069 6620 7461 626c 6569 7465 6d3a     if tableitem:
+00034ec0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00034ed0: 2020 2320 4f6e 6c79 2077 6179 2074 6f20    # Only way to 
+00034ee0: 6372 6561 7465 2073 7461 7465 2063 6861  create state cha
+00034ef0: 6e67 6520 696e 2077 782e 6c69 622e 6769  nge in wx.lib.gi
+00034f00: 7a6d 6f73 2e54 7265 654c 6973 7443 7472  zmos.TreeListCtr
+00034f10: 6c0d 0a20 2020 2020 2020 2020 2020 2020  l..             
+00034f20: 2020 2063 6c61 7373 2048 6163 6b45 7665     class HackEve
+00034f30: 6e74 286f 626a 6563 7429 3a0d 0a20 2020  nt(object):..   
+00034f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034f50: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
+00034f60: 6c66 2c20 6974 656d 293a 2073 656c 662e  lf, item): self.
+00034f70: 5f69 7465 6d20 3d20 6974 656d 0d0a 2020  _item = item..  
+00034f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00034f90: 2020 6465 6620 4765 7449 7465 6d28 7365    def GetItem(se
+00034fa0: 6c66 293a 2020 2020 2020 2020 7265 7475  lf):        retu
+00034fb0: 726e 2073 656c 662e 5f69 7465 6d0d 0a20  rn self._item.. 
+00034fc0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00034fd0: 656c 662e 6f6e 5f63 6861 6e67 655f 7472  elf.on_change_tr
+00034fe0: 6565 5f74 6162 6c65 7328 4861 636b 4576  ee_tables(HackEv
+00034ff0: 656e 7428 7461 626c 6569 7465 6d29 290d  ent(tableitem)).
+00035000: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00035010: 2073 656c 662e 7472 6565 5f74 6162 6c65   self.tree_table
+00035020: 732e 5365 6c65 6374 4974 656d 2874 6162  s.SelectItem(tab
+00035030: 6c65 6974 656d 290d 0a20 2020 2020 2020  leitem)..       
+00035040: 2020 2020 2020 2020 2067 7269 642e 5363           grid.Sc
+00035050: 726f 6c6c 282a 7363 726f 6c6c 706f 7329  roll(*scrollpos)
+00035060: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00035070: 2020 6772 6964 2e53 6574 4772 6964 4375    grid.SetGridCu
+00035080: 7273 6f72 282a 6375 7273 6f72 706f 7329  rsor(*cursorpos)
+00035090: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
+000350a0: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+000350b0: 2020 2020 2073 656c 662e 6c61 6265 6c5f       self.label_
+000350c0: 7461 626c 652e 4c61 6265 6c20 3d20 2222  table.Label = ""
+000350d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000350e0: 2020 666f 7220 7820 696e 205b 7778 2e49    for x in [wx.I
+000350f0: 445f 4144 442c 2077 782e 4944 5f44 454c  D_ADD, wx.ID_DEL
+00035100: 4554 452c 2077 782e 4944 5f55 4e44 4f2c  ETE, wx.ID_UNDO,
+00035110: 2077 782e 4944 5f53 4156 455d 3a0d 0a20   wx.ID_SAVE]:.. 
+00035120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035130: 2020 2073 656c 662e 7462 5f67 7269 642e     self.tb_grid.
+00035140: 456e 6162 6c65 546f 6f6c 2878 2c20 4661  EnableTool(x, Fa
+00035150: 6c73 6529 0d0a 2020 2020 2020 2020 2020  lse)..          
+00035160: 2020 2020 2020 7365 6c66 2e62 7574 746f        self.butto
+00035170: 6e5f 7265 7365 745f 6772 6964 5f74 6162  n_reset_grid_tab
+00035180: 6c65 2e45 6e61 626c 6564 203d 2046 616c  le.Enabled = Fal
+00035190: 7365 0d0a 2020 2020 2020 2020 2020 2020  se..            
+000351a0: 2020 2020 7365 6c66 2e62 7574 746f 6e5f      self.button_
+000351b0: 6578 706f 7274 5f74 6162 6c65 2e45 6e61  export_table.Ena
+000351c0: 626c 6564 203d 2046 616c 7365 0d0a 2020  bled = False..  
+000351d0: 2020 2020 2020 2020 2020 6772 6964 2e54            grid.T
+000351e0: 6861 7728 290d 0a20 2020 2020 2020 2020  haw()..         
+000351f0: 2020 2073 656c 662e 7061 6765 5f74 6162     self.page_tab
+00035200: 6c65 732e 5265 6672 6573 6828 290d 0a0d  les.Refresh()...
+00035210: 0a0d 0a20 2020 2064 6566 206f 6e5f 6368  ...    def on_ch
+00035220: 616e 6765 5f72 616e 6765 5f64 6174 6528  ange_range_date(
+00035230: 7365 6c66 2c20 6576 656e 7429 3a0d 0a20  self, event):.. 
+00035240: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
+00035250: 2020 2020 4861 6e64 6c65 7220 666f 7220      Handler for 
+00035260: 7661 6c75 6520 6368 616e 6765 2069 6e20  value change in 
+00035270: 6368 6174 2066 696c 7465 7220 6461 7465  chat filter date
+00035280: 2072 616e 6765 2c20 7570 6461 7465 7320   range, updates 
+00035290: 6461 7465 0d0a 2020 2020 2020 2020 6564  date..        ed
+000352a0: 6974 626f 7865 732e 0d0a 2020 2020 2020  itboxes...      
+000352b0: 2020 2222 220d 0a20 2020 2020 2020 2074    """..        t
+000352c0: 7279 3a0d 0a20 2020 2020 2020 2020 2020  ry:..           
+000352d0: 2076 312c 2076 3220 3d20 5b64 2e73 7472   v1, v2 = [d.str
+000352e0: 6674 696d 6528 2225 592d 256d 2d25 6422  ftime("%Y-%m-%d"
+000352f0: 2920 666f 7220 6420 696e 2073 656c 662e  ) for d in self.
+00035300: 7261 6e67 655f 6461 7465 2e56 616c 7565  range_date.Value
+00035310: 735d 0d0a 2020 2020 2020 2020 6578 6365  s]..        exce
+00035320: 7074 2045 7863 6570 7469 6f6e 3a0d 0a20  pt Exception:.. 
+00035330: 2020 2020 2020 2020 2020 2076 312c 2076             v1, v
+00035340: 3220 3d20 2222 2c20 2222 0d0a 2020 2020  2 = "", ""..    
+00035350: 2020 2020 666f 7220 652c 2076 2069 6e20      for e, v in 
+00035360: 5b28 7365 6c66 2e65 6469 745f 6669 6c74  [(self.edit_filt
+00035370: 6572 6461 7465 312c 2076 3129 2c20 2873  erdate1, v1), (s
+00035380: 656c 662e 6564 6974 5f66 696c 7465 7264  elf.edit_filterd
+00035390: 6174 6532 2c20 7632 295d 3a0d 0a20 2020  ate2, v2)]:..   
+000353a0: 2020 2020 2020 2020 2069 6620 7620 616e           if v an
+000353b0: 6420 652e 456e 6162 6c65 6420 616e 6420  d e.Enabled and 
+000353c0: 652e 5661 6c75 6520 213d 2076 3a0d 0a20  e.Value != v:.. 
+000353d0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000353e0: 656c 203d 2065 2e47 6574 5365 6c65 6374  el = e.GetSelect
+000353f0: 696f 6e28 290d 0a20 2020 2020 2020 2020  ion()..         
+00035400: 2020 2020 2020 2065 2e56 616c 7565 203d         e.Value =
+00035410: 2076 0d0a 2020 2020 2020 2020 2020 2020   v..            
+00035420: 2020 2020 652e 5365 7453 656c 6563 7469      e.SetSelecti
+00035430: 6f6e 282a 7365 6c29 0d0a 0d0a 0d0a 2020  on(*sel)......  
+00035440: 2020 6465 6620 6f6e 5f63 6861 6e67 655f    def on_change_
+00035450: 6669 6c74 6572 6461 7465 2873 656c 662c  filterdate(self,
+00035460: 2065 7665 6e74 293a 0d0a 2020 2020 2020   event):..      
+00035470: 2020 2222 220d 0a20 2020 2020 2020 2048    """..        H
+00035480: 616e 646c 6572 2066 6f72 2063 6861 6e67  andler for chang
+00035490: 696e 6720 6120 6368 6174 2064 6174 6520  ing a chat date 
+000354a0: 6669 6c74 6572 2065 6469 7462 6f78 2c20  filter editbox, 
+000354b0: 7570 6461 7465 7320 6461 7465 2072 616e  updates date ran
+000354c0: 6765 0d0a 2020 2020 2020 2020 736c 6964  ge..        slid
+000354d0: 6572 2e0d 0a20 2020 2020 2020 2022 2222  er...        """
+000354e0: 0d0a 2020 2020 2020 2020 6461 7465 7374  ..        datest
+000354f0: 7220 3d20 7265 2e73 7562 2822 5c5c 4422  r = re.sub("\\D"
+00035500: 2c20 2222 2c20 6576 656e 742e 5374 7269  , "", event.Stri
+00035510: 6e67 295b 3a38 5d0d 0a20 2020 2020 2020  ng)[:8]..       
+00035520: 2074 7279 3a0d 0a20 2020 2020 2020 2020   try:..         
+00035530: 2020 2061 7373 6572 7420 6c65 6e28 6461     assert len(da
+00035540: 7465 7374 7229 203d 3d20 380d 0a20 2020  testr) == 8..   
+00035550: 2020 2020 2020 2020 2064 6174 6520 3d20           date = 
+00035560: 6461 7465 7469 6d65 2e64 6174 6574 696d  datetime.datetim
+00035570: 652e 7374 7270 7469 6d65 2864 6174 6573  e.strptime(dates
+00035580: 7472 2c20 2225 5925 6d25 6422 292e 6461  tr, "%Y%m%d").da
+00035590: 7465 2829 0d0a 2020 2020 2020 2020 6578  te()..        ex
+000355a0: 6365 7074 2028 4173 7365 7274 696f 6e45  cept (AssertionE
+000355b0: 7272 6f72 2c20 5479 7065 4572 726f 722c  rror, TypeError,
+000355c0: 2056 616c 7565 4572 726f 7229 3a0d 0a20   ValueError):.. 
+000355d0: 2020 2020 2020 2020 2020 2064 6174 6520             date 
+000355e0: 3d20 4e6f 6e65 0d0a 2020 2020 2020 2020  = None..        
+000355f0: 6966 2064 6174 653a 0d0a 2020 2020 2020  if date:..      
+00035600: 2020 2020 2020 7369 6465 203d 2028 6576        side = (ev
+00035610: 656e 742e 4576 656e 744f 626a 6563 7420  ent.EventObject 
+00035620: 3d3d 2073 656c 662e 6564 6974 5f66 696c  == self.edit_fil
+00035630: 7465 7264 6174 6532 290d 0a20 2020 2020  terdate2)..     
+00035640: 2020 2020 2020 2069 6620 7365 6c66 2e72         if self.r
+00035650: 616e 6765 5f64 6174 652e 4765 7456 616c  ange_date.GetVal
+00035660: 7565 2873 6964 6529 2021 3d20 6461 7465  ue(side) != date
+00035670: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00035680: 2020 2073 656c 662e 7261 6e67 655f 6461     self.range_da
+00035690: 7465 2e53 6574 5661 6c75 6528 7369 6465  te.SetValue(side
+000356a0: 2c20 6461 7465 290d 0a20 2020 2020 2020  , date)..       
+000356b0: 2020 2020 2020 2020 2064 6174 6532 203d           date2 =
+000356c0: 2073 656c 662e 7261 6e67 655f 6461 7465   self.range_date
+000356d0: 2e47 6574 5661 6c75 6528 7369 6465 290d  .GetValue(side).
+000356e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000356f0: 2069 6620 6461 7465 7374 7220 213d 2064   if datestr != d
+00035700: 6174 6532 2e73 7472 6674 696d 6528 2225  ate2.strftime("%
+00035710: 5925 6d25 6422 293a 0d0a 2020 2020 2020  Y%m%d"):..      
+00035720: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00035730: 6c20 3d20 6576 656e 742e 4576 656e 744f  l = event.EventO
+00035740: 626a 6563 742e 5365 6c65 6374 696f 6e0d  bject.Selection.
+00035750: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00035760: 2020 2020 2065 7665 6e74 2e45 7665 6e74       event.Event
+00035770: 4f62 6a65 6374 2e56 616c 7565 203d 2064  Object.Value = d
+00035780: 6174 6532 2e73 7472 6674 696d 6528 2225  ate2.strftime("%
+00035790: 592d 256d 2d25 6422 290d 0a20 2020 2020  Y-%m-%d")..     
+000357a0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+000357b0: 7665 6e74 2e45 7665 6e74 4f62 6a65 6374  vent.EventObject
+000357c0: 2e53 6574 5365 6c65 6374 696f 6e28 2a73  .SetSelection(*s
+000357d0: 656c 290d 0a0d 0a0d 0a20 2020 2064 6566  el)......    def
+000357e0: 206f 6e5f 6368 616e 6765 5f63 6861 7466   on_change_chatf
+000357f0: 696c 7465 7228 7365 6c66 2c20 6576 656e  ilter(self, even
+00035800: 7429 3a0d 0a20 2020 2020 2020 2022 2222  t):..        """
+00035810: 4861 6e64 6c65 7220 666f 7220 6368 616e  Handler for chan
+00035820: 6769 6e67 2074 6578 7420 696e 2063 6861  ging text in cha
+00035830: 7420 6669 6c74 6572 2062 6f78 2c20 6669  t filter box, fi
+00035840: 6c74 6572 7320 6368 6174 206c 6973 742e  lters chat list.
+00035850: 2222 220d 0a20 2020 2020 2020 2063 6c69  """..        cli
+00035860: 7374 203d 2073 656c 662e 6c69 7374 5f63  st = self.list_c
+00035870: 6861 7473 0d0a 2020 2020 2020 2020 636c  hats..        cl
+00035880: 6973 742e 5365 7446 696c 7465 7228 6576  ist.SetFilter(ev
+00035890: 656e 742e 5374 7269 6e67 2e73 7472 6970  ent.String.strip
+000358a0: 2829 290d 0a20 2020 2020 2020 2066 6f72  ())..        for
+000358b0: 2069 2069 6e20 7261 6e67 6528 636c 6973   i in range(clis
+000358c0: 742e 4974 656d 436f 756e 7429 2069 6620  t.ItemCount) if 
+000358d0: 7365 6c66 2e63 6861 7420 656c 7365 2028  self.chat else (
+000358e0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+000358f0: 6966 2063 6c69 7374 2e47 6574 4974 656d  if clist.GetItem
+00035900: 4d61 7070 6564 4461 7461 2869 2920 3d3d  MappedData(i) ==
+00035910: 2073 656c 662e 6368 6174 3a0d 0a20 2020   self.chat:..   
+00035920: 2020 2020 2020 2020 2020 2020 2066 203d               f =
+00035930: 2063 6c69 7374 2e46 6f6e 743b 2066 2e53   clist.Font; f.S
+00035940: 6574 5765 6967 6874 2877 782e 464f 4e54  etWeight(wx.FONT
+00035950: 5745 4947 4854 5f42 4f4c 4429 0d0a 2020  WEIGHT_BOLD)..  
+00035960: 2020 2020 2020 2020 2020 2020 2020 636c                cl
+00035970: 6973 742e 5365 7449 7465 6d46 6f6e 7428  ist.SetItemFont(
+00035980: 692c 2066 290d 0a20 2020 2020 2020 2020  i, f)..         
+00035990: 2020 2020 2020 2062 7265 616b 2023 2066         break # f
+000359a0: 6f72 2069 0d0a 2020 2020 2020 2020 6c62  or i..        lb
+000359b0: 6c20 3d20 2241 266c 6c20 6368 6174 2065  l = "A&ll chat e
+000359c0: 6e74 7269 6573 2069 6e20 6461 7461 6261  ntries in databa
+000359d0: 7365 2028 2573 293a 2220 2520 7365 6c66  se (%s):" % self
+000359e0: 2e6c 6973 745f 6368 6174 732e 4974 656d  .list_chats.Item
+000359f0: 436f 756e 740d 0a20 2020 2020 2020 2073  Count..        s
+00035a00: 656c 662e 6c61 6265 6c5f 6c69 7374 5f63  elf.label_list_c
+00035a10: 6861 7473 2e4c 6162 656c 203d 206c 626c  hats.Label = lbl
+00035a20: 0d0a 0d0a 0d0a 2020 2020 6465 6620 6f6e  ......    def on
+00035a30: 5f63 6861 6e67 655f 636f 6e74 6163 7466  _change_contactf
+00035a40: 696c 7465 7228 7365 6c66 2c20 6576 656e  ilter(self, even
+00035a50: 7429 3a0d 0a20 2020 2020 2020 2022 2222  t):..        """
+00035a60: 4861 6e64 6c65 7220 666f 7220 6368 616e  Handler for chan
+00035a70: 6769 6e67 2074 6578 7420 696e 2063 6861  ging text in cha
+00035a80: 7420 6669 6c74 6572 2062 6f78 2c20 6669  t filter box, fi
+00035a90: 6c74 6572 7320 6368 6174 206c 6973 742e  lters chat list.
+00035aa0: 2222 220d 0a20 2020 2020 2020 2063 6c69  """..        cli
+00035ab0: 7374 203d 2073 656c 662e 6c69 7374 5f63  st = self.list_c
+00035ac0: 6f6e 7461 6374 730d 0a20 2020 2020 2020  ontacts..       
+00035ad0: 2063 6c69 7374 2e53 6574 4669 6c74 6572   clist.SetFilter
+00035ae0: 2865 7665 6e74 2e53 7472 696e 672e 7374  (event.String.st
+00035af0: 7269 7028 2929 0d0a 2020 2020 2020 2020  rip())..        
+00035b00: 666f 7220 6920 696e 2072 616e 6765 2863  for i in range(c
+00035b10: 6c69 7374 2e49 7465 6d43 6f75 6e74 2920  list.ItemCount) 
+00035b20: 6966 2073 656c 662e 6368 6174 2065 6c73  if self.chat els
+00035b30: 6520 2829 3a0d 0a20 2020 2020 2020 2020  e ():..         
+00035b40: 2020 2069 6620 636c 6973 742e 4765 7449     if clist.GetI
+00035b50: 7465 6d4d 6170 7065 6444 6174 6128 6929  temMappedData(i)
+00035b60: 203d 3d20 7365 6c66 2e63 6f6e 7461 6374   == self.contact
+00035b70: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00035b80: 2020 2066 203d 2063 6c69 7374 2e46 6f6e     f = clist.Fon
+00035b90: 743b 2066 2e53 6574 5765 6967 6874 2877  t; f.SetWeight(w
+00035ba0: 782e 464f 4e54 5745 4947 4854 5f42 4f4c  x.FONTWEIGHT_BOL
+00035bb0: 4429 0d0a 2020 2020 2020 2020 2020 2020  D)..            
+00035bc0: 2020 2020 636c 6973 742e 5365 7449 7465      clist.SetIte
+00035bd0: 6d46 6f6e 7428 692c 2066 290d 0a20 2020  mFont(i, f)..   
+00035be0: 2020 2020 2020 2020 2020 2020 2062 7265               bre
+00035bf0: 616b 2023 2066 6f72 2069 0d0a 2020 2020  ak # for i..    
+00035c00: 2020 2020 6c62 6c20 3d20 2241 266c 6c20      lbl = "A&ll 
+00035c10: 7072 6f66 696c 6573 2069 6e20 6461 7461  profiles in data
+00035c20: 6261 7365 2028 2573 293a 2220 2520 7365  base (%s):" % se
+00035c30: 6c66 2e6c 6973 745f 636f 6e74 6163 7473  lf.list_contacts
+00035c40: 2e49 7465 6d43 6f75 6e74 0d0a 2020 2020  .ItemCount..    
+00035c50: 2020 2020 7365 6c66 2e6c 6162 656c 5f6c      self.label_l
+00035c60: 6973 745f 636f 6e74 6163 7473 2e4c 6162  ist_contacts.Lab
+00035c70: 656c 203d 206c 626c 0d0a 0d0a 0d0a 2020  el = lbl......  
+00035c80: 2020 6465 6620 6f6e 5f72 656e 616d 655f    def on_rename_
+00035c90: 6368 6174 2873 656c 662c 2065 7665 6e74  chat(self, event
+00035ca0: 3d4e 6f6e 652c 2063 6861 743d 4e6f 6e65  =None, chat=None
+00035cb0: 293a 0d0a 2020 2020 2020 2020 2222 220d  ):..        """.
+00035cc0: 0a20 2020 2020 2020 2048 616e 646c 6572  .        Handler
+00035cd0: 2066 6f72 2063 6c69 636b 696e 6720 746f   for clicking to
+00035ce0: 2072 656e 616d 6520 6120 6368 6174 2c20   rename a chat, 
+00035cf0: 6f70 656e 7320 6120 7465 7874 2065 6e74  opens a text ent
+00035d00: 7279 2064 6961 6c6f 670d 0a20 2020 2020  ry dialog..     
+00035d10: 2020 2061 6e64 2073 6176 6573 2065 6e74     and saves ent
+00035d20: 6572 6564 2076 616c 7565 2061 7320 436f  ered value as Co
+00035d30: 6e76 6572 7361 7469 6f6e 732e 6769 7665  nversations.give
+00035d40: 6e5f 6469 7370 6c61 796e 616d 652e 0d0a  n_displayname...
+00035d50: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
+00035d60: 2020 2020 2063 6861 7420 3d20 6368 6174       chat = chat
+00035d70: 206f 7220 7365 6c66 2e63 6861 740d 0a20   or self.chat.. 
+00035d80: 2020 2020 2020 2064 6c67 203d 2077 782e         dlg = wx.
+00035d90: 5465 7874 456e 7472 7944 6961 6c6f 6728  TextEntryDialog(
+00035da0: 7365 6c66 2c20 2247 6976 6520 6e65 7720  self, "Give new 
+00035db0: 6469 7370 6c61 7920 6e61 6d65 2066 6f72  display name for
+00035dc0: 2074 6865 2063 6f6e 7665 7273 6174 696f   the conversatio
+00035dd0: 6e22 2c0d 0a20 2020 2020 2020 2020 2020  n",..           
+00035de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035df0: 2020 2020 2020 636f 6e66 2e54 6974 6c65        conf.Title
+00035e00: 2c20 7661 6c75 653d 6368 6174 5b22 7469  , value=chat["ti
+00035e10: 746c 6522 5d2c 0d0a 2020 2020 2020 2020  tle"],..        
+00035e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035e30: 2020 2020 2020 2020 2073 7479 6c65 3d77           style=w
+00035e40: 782e 4f4b 207c 2077 782e 4341 4e43 454c  x.OK | wx.CANCEL
+00035e50: 290d 0a20 2020 2020 2020 2064 6c67 2e43  )..        dlg.C
+00035e60: 656e 7465 724f 6e50 6172 656e 7428 290d  enterOnParent().
+00035e70: 0a20 2020 2020 2020 2069 6620 7778 2e49  .        if wx.I
+00035e80: 445f 4f4b 2021 3d20 646c 672e 5368 6f77  D_OK != dlg.Show
+00035e90: 4d6f 6461 6c28 293a 2072 6574 7572 6e0d  Modal(): return.
+00035ea0: 0a0d 0a20 2020 2020 2020 2076 203d 2064  ...        v = d
+00035eb0: 6c67 2e47 6574 5661 6c75 6528 292e 7374  lg.GetValue().st
+00035ec0: 7269 7028 290d 0a20 2020 2020 2020 2069  rip()..        i
+00035ed0: 6620 7620 3d3d 2063 6861 745b 2274 6974  f v == chat["tit
+00035ee0: 6c65 225d 205c 0d0a 2020 2020 2020 2020  le"] \..        
+00035ef0: 6f72 206e 6f74 2076 2061 6e64 206e 6f74  or not v and not
+00035f00: 2063 6861 742e 6765 7428 2267 6976 656e   chat.get("given
+00035f10: 5f64 6973 706c 6179 6e61 6d65 2229 3a20  _displayname"): 
+00035f20: 7265 7475 726e 0d0a 0d0a 2020 2020 2020  return....      
+00035f30: 2020 5052 4546 5320 3d20 5b22 6469 7370    PREFS = ["disp
+00035f40: 6c61 796e 616d 6522 2c20 226d 6574 615f  layname", "meta_
+00035f50: 746f 7069 6322 2c20 2269 6465 6e74 6974  topic", "identit
+00035f60: 7922 5d0d 0a20 2020 2020 2020 206b 6579  y"]..        key
+00035f70: 302c 206e 616d 6530 203d 206e 6578 7428  0, name0 = next(
+00035f80: 286b 2c20 6368 6174 5b6b 5d29 2066 6f72  (k, chat[k]) for
+00035f90: 206b 2069 6e20 5052 4546 5320 6966 2063   k in PREFS if c
+00035fa0: 6861 742e 6765 7428 6b29 290d 0a20 2020  hat.get(k))..   
+00035fb0: 2020 2020 2069 6620 6e6f 7420 763a 0d0a       if not v:..
+00035fc0: 2020 2020 2020 2020 2020 2020 6966 2077              if w
+00035fd0: 782e 4f4b 2021 3d20 7778 2e4d 6573 7361  x.OK != wx.Messa
+00035fe0: 6765 426f 7828 0d0a 2020 2020 2020 2020  geBox(..        
+00035ff0: 2020 2020 2020 2020 2752 656d 6f76 6520          'Remove 
+00036000: 6769 7665 6e20 6469 7370 6c61 7920 6e61  given display na
+00036010: 6d65 2c20 6661 6c6c 696e 6720 6261 636b  me, falling back
+00036020: 2074 6f20 2573 2022 2573 223f 2720 250d   to %s "%s"?' %.
+00036030: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00036040: 2028 6b65 7930 2c20 6e61 6d65 3029 2c20   (key0, name0), 
+00036050: 636f 6e66 2e54 6974 6c65 2c20 7778 2e4f  conf.Title, wx.O
+00036060: 4b20 7c20 7778 2e43 414e 4345 4c0d 0a20  K | wx.CANCEL.. 
+00036070: 2020 2020 2020 2020 2020 2029 3a20 7265             ): re
+00036080: 7475 726e 0d0a 2020 2020 2020 2020 2020  turn..          
+00036090: 2020 7620 3d20 4e6f 6e65 0d0a 0d0a 2020    v = None....  
+000360a0: 2020 2020 2020 7365 6c66 2e64 622e 7570        self.db.up
+000360b0: 6461 7465 5f72 6f77 2822 636f 6e76 6572  date_row("conver
+000360c0: 7361 7469 6f6e 7322 2c20 7b22 6769 7665  sations", {"give
+000360d0: 6e5f 6469 7370 6c61 796e 616d 6522 3a20  n_displayname": 
+000360e0: 767d 2c20 6368 6174 290d 0a20 2020 2020  v}, chat)..     
+000360f0: 2020 2063 6861 745b 2267 6976 656e 5f64     chat["given_d
+00036100: 6973 706c 6179 6e61 6d65 225d 203d 2076  isplayname"] = v
+00036110: 0d0a 2020 2020 2020 2020 6368 6174 5b22  ..        chat["
+00036120: 7469 746c 6522 5d20 3d20 7620 6f72 206e  title"] = v or n
+00036130: 616d 6530 0d0a 0d0a 2020 2020 2020 2020  ame0....        
+00036140: 6c74 6974 6c65 203d 2028 2243 6861 7420  ltitle = ("Chat 
+00036150: 7769 7468 2025 7322 2069 6620 736b 7970  with %s" if skyp
+00036160: 6564 6174 612e 4348 4154 535f 5459 5045  edata.CHATS_TYPE
+00036170: 5f53 494e 474c 4520 3d3d 2063 6861 745b  _SINGLE == chat[
+00036180: 2274 7970 6522 5d0d 0a20 2020 2020 2020  "type"]..       
+00036190: 2020 2020 2020 2020 2020 2065 6c73 6520             else 
+000361a0: 2747 726f 7570 2063 6861 7420 2225 7322  'Group chat "%s"
+000361b0: 2729 2025 2028 7620 6f72 206e 616d 6530  ') % (v or name0
+000361c0: 290d 0a20 2020 2020 2020 2063 6861 745b  )..        chat[
+000361d0: 2274 6974 6c65 5f6c 6f6e 6722 5d20 3d20  "title_long"] = 
+000361e0: 6c74 6974 6c65 0d0a 2020 2020 2020 2020  ltitle..        
+000361f0: 6368 6174 5b22 7469 746c 655f 6c6f 6e67  chat["title_long
+00036200: 5f6c 6322 5d20 3d20 6c74 6974 6c65 5b30  _lc"] = ltitle[0
+00036210: 5d2e 6c6f 7765 7228 2920 2b20 6c74 6974  ].lower() + ltit
+00036220: 6c65 5b31 3a5d 0d0a 0d0a 2020 2020 2020  le[1:]....      
+00036230: 2020 7365 6c66 2e6c 6973 745f 6368 6174    self.list_chat
+00036240: 732e 5265 6672 6573 6852 6f77 7328 290d  s.RefreshRows().
+00036250: 0a20 2020 2020 2020 2069 6620 6368 6174  .        if chat
+00036260: 2069 7320 6e6f 7420 7365 6c66 2e63 6861   is not self.cha
+00036270: 743a 2072 6574 7572 6e0d 0a0d 0a20 2020  t: return....   
+00036280: 2020 2020 2023 2041 6464 2073 686f 7274       # Add short
+00036290: 6375 7420 6b65 7920 666c 6167 2074 6f20  cut key flag to 
+000362a0: 6368 6174 206c 6162 656c 0d0a 2020 2020  chat label..    
+000362b0: 2020 2020 7365 6c66 2e6c 6162 656c 5f63      self.label_c
+000362c0: 6861 742e 4c61 6265 6c20 3d20 7365 6c66  hat.Label = self
+000362d0: 2e63 6861 745b 2274 6974 6c65 5f6c 6f6e  .chat["title_lon
+000362e0: 6722 5d2e 7265 706c 6163 6528 0d0a 2020  g"].replace(..  
+000362f0: 2020 2020 2020 2020 2020 2263 6861 7422            "chat"
+00036300: 2c20 2226 6368 6174 220d 0a20 2020 2020  , "&chat"..     
+00036310: 2020 2029 2e72 6570 6c61 6365 2822 4368     ).replace("Ch
+00036320: 6174 222c 2022 2643 6861 7422 2920 2b20  at", "&Chat") + 
+00036330: 223a 220d 0a20 2020 2020 2020 2073 656c  ":"..        sel
+00036340: 662e 6c61 6265 6c5f 6368 6174 2e50 6172  f.label_chat.Par
+00036350: 656e 742e 4c61 796f 7574 2829 0d0a 2020  ent.Layout()..  
+00036360: 2020 2020 2020 7365 6c66 2e70 6f70 756c        self.popul
+00036370: 6174 655f 6368 6174 5f73 7461 7469 7374  ate_chat_statist
+00036380: 6963 7328 290d 0a20 2020 2020 2020 2069  ics()..        i
+00036390: 6620 7365 6c66 2e68 746d 6c5f 7374 6174  f self.html_stat
+000363a0: 732e 5368 6f77 6e3a 0d0a 2020 2020 2020  s.Shown:..      
+000363b0: 2020 2020 2020 7365 6c66 2e73 686f 775f        self.show_
+000363c0: 7374 6174 7328 5472 7565 2920 2320 546f  stats(True) # To
+000363d0: 2072 6573 746f 7265 2073 6372 6f6c 6c20   restore scroll 
+000363e0: 706f 7369 7469 6f6e 0d0a 2020 2020 2020  position..      
+000363f0: 2020 7365 6c66 2e6c 6f61 645f 636f 6e74    self.load_cont
+00036400: 6163 7428 7365 6c66 2e63 6f6e 7461 6374  act(self.contact
+00036410: 290d 0a0d 0a0d 0a20 2020 2064 6566 206f  )......    def o
+00036420: 6e5f 7265 6e61 6d65 5f63 6f6e 7461 6374  n_rename_contact
+00036430: 2873 656c 662c 2063 6f6e 7461 6374 2c20  (self, contact, 
+00036440: 6576 656e 743d 4e6f 6e65 293a 0d0a 2020  event=None):..  
+00036450: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
+00036460: 2020 2048 616e 646c 6572 2066 6f72 2063     Handler for c
+00036470: 6c69 636b 696e 6720 746f 2072 656e 616d  licking to renam
+00036480: 6520 6120 636f 6e74 6163 742c 206f 7065  e a contact, ope
+00036490: 6e73 2061 2074 6578 7420 656e 7472 7920  ns a text entry 
+000364a0: 6469 616c 6f67 0d0a 2020 2020 2020 2020  dialog..        
+000364b0: 616e 6420 7361 7665 7320 656e 7465 7265  and saves entere
+000364c0: 6420 7661 6c75 6520 6173 2043 6f6e 7461  d value as Conta
+000364d0: 6374 732e 6769 7665 6e5f 6469 7370 6c61  cts.given_displa
+000364e0: 796e 616d 652e 0d0a 2020 2020 2020 2020  yname...        
+000364f0: 2222 220d 0a20 2020 2020 2020 206c 6162  """..        lab
+00036500: 656c 203d 2022 6461 7461 6261 7365 2061  el = "database a
+00036510: 6363 6f75 6e74 2220 6966 2063 6f6e 7461  ccount" if conta
+00036520: 6374 5b22 6964 656e 7469 7479 225d 203d  ct["identity"] =
+00036530: 3d20 7365 6c66 2e64 622e 6964 2065 6c73  = self.db.id els
+00036540: 6520 2263 6f6e 7461 6374 220d 0a20 2020  e "contact"..   
+00036550: 2020 2020 2064 6c67 203d 2077 782e 5465       dlg = wx.Te
+00036560: 7874 456e 7472 7944 6961 6c6f 6728 7365  xtEntryDialog(se
+00036570: 6c66 2c20 2747 6976 6520 6e65 7720 6469  lf, 'Give new di
+00036580: 7370 6c61 7920 6e61 6d65 2066 6f72 2025  splay name for %
+00036590: 7320 2225 7322 3a27 2025 0d0a 2020 2020  s "%s":' %..    
+000365a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000365b0: 2020 2020 2020 2020 2020 2020 2028 6c61               (la
+000365c0: 6265 6c2c 2063 6f6e 7461 6374 5b22 6964  bel, contact["id
+000365d0: 656e 7469 7479 225d 292c 0d0a 2020 2020  entity"]),..    
+000365e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000365f0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+00036600: 662e 5469 746c 652c 2076 616c 7565 3d63  f.Title, value=c
+00036610: 6f6e 7461 6374 5b22 6e61 6d65 225d 2c0d  ontact["name"],.
+00036620: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00036630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036640: 2020 7374 796c 653d 7778 2e4f 4b20 7c20    style=wx.OK | 
+00036650: 7778 2e43 414e 4345 4c29 0d0a 2020 2020  wx.CANCEL)..    
+00036660: 2020 2020 646c 672e 4365 6e74 6572 4f6e      dlg.CenterOn
+00036670: 5061 7265 6e74 2829 0d0a 2020 2020 2020  Parent()..      
+00036680: 2020 6966 2077 782e 4944 5f4f 4b20 213d    if wx.ID_OK !=
+00036690: 2064 6c67 2e53 686f 774d 6f64 616c 2829   dlg.ShowModal()
+000366a0: 3a20 7265 7475 726e 0d0a 0d0a 2020 2020  : return....    
+000366b0: 2020 2020 7620 3d20 646c 672e 4765 7456      v = dlg.GetV
+000366c0: 616c 7565 2829 2e73 7472 6970 2829 0d0a  alue().strip()..
+000366d0: 2020 2020 2020 2020 6966 2076 203d 3d20          if v == 
+000366e0: 636f 6e74 6163 745b 226e 616d 6522 5d20  contact["name"] 
+000366f0: 5c0d 0a20 2020 2020 2020 206f 7220 6e6f  \..        or no
+00036700: 7420 7620 616e 6420 6e6f 7420 636f 6e74  t v and not cont
+00036710: 6163 742e 6765 7428 2267 6976 656e 5f64  act.get("given_d
+00036720: 6973 706c 6179 6e61 6d65 2229 205c 0d0a  isplayname") \..
+00036730: 2020 2020 2020 2020 6f72 206e 6f74 2076          or not v
+00036740: 2061 6e64 2063 6f6e 7461 6374 5b22 6964   and contact["id
+00036750: 656e 7469 7479 225d 203d 3d20 7365 6c66  entity"] == self
+00036760: 2e64 622e 6964 205c 0d0a 2020 2020 2020  .db.id \..      
+00036770: 2020 616e 6420 6e6f 7420 7365 6c66 2e64    and not self.d
+00036780: 622e 6163 636f 756e 742e 6765 7428 2267  b.account.get("g
+00036790: 6976 656e 5f64 6973 706c 6179 6e61 6d65  iven_displayname
+000367a0: 2229 3a20 7265 7475 726e 0d0a 0d0a 2020  "): return....  
+000367b0: 2020 2020 2020 5052 4546 5320 3d20 5b22        PREFS = ["
+000367c0: 6675 6c6c 6e61 6d65 222c 2022 6469 7370  fullname", "disp
+000367d0: 6c61 796e 616d 6522 2c20 2273 6b79 7065  layname", "skype
+000367e0: 6e61 6d65 222c 2022 7073 746e 6e75 6d62  name", "pstnnumb
+000367f0: 6572 225d 0d0a 2020 2020 2020 2020 6b65  er"]..        ke
+00036800: 7930 2c20 6e61 6d65 3020 3d20 6e65 7874  y0, name0 = next
+00036810: 2828 6b2c 2063 6f6e 7461 6374 5b6b 5d29  ((k, contact[k])
+00036820: 2066 6f72 206b 2069 6e20 5052 4546 5320   for k in PREFS 
+00036830: 6966 2063 6f6e 7461 6374 2e67 6574 286b  if contact.get(k
+00036840: 2929 0d0a 2020 2020 2020 2020 6966 206e  ))..        if n
+00036850: 6f74 2076 3a0d 0a20 2020 2020 2020 2020  ot v:..         
+00036860: 2020 2069 6620 7778 2e4f 4b20 213d 2077     if wx.OK != w
+00036870: 782e 4d65 7373 6167 6542 6f78 280d 0a20  x.MessageBox(.. 
+00036880: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00036890: 5265 6d6f 7665 2067 6976 656e 2064 6973  Remove given dis
+000368a0: 706c 6179 206e 616d 6520 6672 6f6d 2022  play name from "
+000368b0: 2573 222c 2066 616c 6c69 6e67 2062 6163  %s", falling bac
+000368c0: 6b20 746f 2025 7320 2225 7322 3f27 2025  k to %s "%s"?' %
+000368d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000368e0: 2020 2863 6f6e 7461 6374 5b22 6964 656e    (contact["iden
+000368f0: 7469 7479 225d 2c20 6b65 7930 2c20 6e61  tity"], key0, na
+00036900: 6d65 3029 2c0d 0a20 2020 2020 2020 2020  me0),..         
+00036910: 2020 2020 2020 2063 6f6e 662e 5469 746c         conf.Titl
+00036920: 652c 2077 782e 4f4b 207c 2077 782e 4341  e, wx.OK | wx.CA
+00036930: 4e43 454c 0d0a 2020 2020 2020 2020 2020  NCEL..          
+00036940: 2020 293a 2072 6574 7572 6e0d 0a20 2020    ): return..   
+00036950: 2020 2020 2020 2020 2076 203d 204e 6f6e           v = Non
+00036960: 650d 0a0d 0a20 2020 2020 2020 2069 6620  e....        if 
+00036970: 636f 6e74 6163 745b 2269 6465 6e74 6974  contact["identit
+00036980: 7922 5d20 213d 2073 656c 662e 6462 2e69  y"] != self.db.i
+00036990: 643a 0d0a 2020 2020 2020 2020 2020 2020  d:..            
+000369a0: 7365 6c66 2e64 622e 7570 6461 7465 5f72  self.db.update_r
+000369b0: 6f77 2822 636f 6e74 6163 7473 222c 207b  ow("contacts", {
+000369c0: 2267 6976 656e 5f64 6973 706c 6179 6e61  "given_displayna
+000369d0: 6d65 223a 2076 7d2c 2063 6f6e 7461 6374  me": v}, contact
+000369e0: 290d 0a20 2020 2020 2020 2063 6f6e 7461  )..        conta
+000369f0: 6374 5b22 6769 7665 6e5f 6469 7370 6c61  ct["given_displa
+00036a00: 796e 616d 6522 5d20 3d20 760d 0a20 2020  yname"] = v..   
+00036a10: 2020 2020 2063 6f6e 7461 6374 5b22 6e61       contact["na
+00036a20: 6d65 225d 203d 2076 206f 7220 6e61 6d65  me"] = v or name
+00036a30: 300d 0a0d 0a20 2020 2020 2020 2069 6620  0....        if 
+00036a40: 636f 6e74 6163 745b 2269 6465 6e74 6974  contact["identit
+00036a50: 7922 5d20 3d3d 2073 656c 662e 6462 2e69  y"] == self.db.i
+00036a60: 643a 0d0a 2020 2020 2020 2020 2020 2020  d:..            
+00036a70: 7365 6c66 2e64 622e 7570 6461 7465 5f72  self.db.update_r
+00036a80: 6f77 2822 6163 636f 756e 7473 222c 207b  ow("accounts", {
+00036a90: 2267 6976 656e 5f64 6973 706c 6179 6e61  "given_displayna
+00036aa0: 6d65 223a 2076 7d2c 2073 656c 662e 6462  me": v}, self.db
+00036ab0: 2e61 6363 6f75 6e74 290d 0a20 2020 2020  .account)..     
+00036ac0: 2020 2020 2020 2073 656c 662e 6462 2e61         self.db.a
+00036ad0: 6363 6f75 6e74 5b22 6769 7665 6e5f 6469  ccount["given_di
+00036ae0: 7370 6c61 796e 616d 6522 5d20 3d20 760d  splayname"] = v.
+00036af0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00036b00: 662e 6462 2e61 6363 6f75 6e74 5b22 6e61  f.db.account["na
+00036b10: 6d65 225d 203d 2076 206f 7220 6e61 6d65  me"] = v or name
+00036b20: 300d 0a20 2020 2020 2020 2020 2020 2073  0..            s
+00036b30: 656c 662e 7570 6461 7465 5f61 6363 6f75  elf.update_accou
+00036b40: 6e74 696e 666f 2829 0d0a 0d0a 2020 2020  ntinfo()....    
+00036b50: 2020 2020 6964 7820 3d20 6e65 7874 2828      idx = next((
+00036b60: 6920 666f 7220 6920 696e 2072 616e 6765  i for i in range
+00036b70: 2873 656c 662e 6c69 7374 5f70 6172 7469  (self.list_parti
+00036b80: 6369 7061 6e74 732e 4765 7449 7465 6d43  cipants.GetItemC
+00036b90: 6f75 6e74 2829 290d 0a20 2020 2020 2020  ount())..       
+00036ba0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00036bb0: 7365 6c66 2e6c 6973 745f 7061 7274 6963  self.list_partic
+00036bc0: 6970 616e 7473 2e47 6574 4974 656d 4461  ipants.GetItemDa
+00036bd0: 7461 2869 295b 2263 6f6e 7461 6374 225d  ta(i)["contact"]
+00036be0: 2069 7320 636f 6e74 6163 7429 2c20 4e6f   is contact), No
+00036bf0: 6e65 290d 0a20 2020 2020 2020 2069 6620  ne)..        if 
+00036c00: 6964 7820 6973 206e 6f74 204e 6f6e 653a  idx is not None:
+00036c10: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00036c20: 6c66 2e6c 6973 745f 7061 7274 6963 6970  lf.list_particip
+00036c30: 616e 7473 2e53 6574 4974 656d 5465 7874  ants.SetItemText
+00036c40: 2869 6478 2c20 2225 286e 616d 6529 7320  (idx, "%(name)s 
+00036c50: 2825 2869 6465 6e74 6974 7929 7329 2220  (%(identity)s)" 
+00036c60: 2520 636f 6e74 6163 7429 0d0a 2020 2020  % contact)..    
+00036c70: 2020 2020 2020 2020 7365 6c66 2e73 7463          self.stc
+00036c80: 5f68 6973 746f 7279 2e52 6566 7265 7368  _history.Refresh
+00036c90: 4d65 7373 6167 6573 2829 0d0a 2020 2020  Messages()..    
+00036ca0: 2020 2020 2020 2020 7365 6c66 2e70 6f70          self.pop
+00036cb0: 756c 6174 655f 6368 6174 5f73 7461 7469  ulate_chat_stati
+00036cc0: 7374 6963 7328 290d 0a20 2020 2020 2020  stics()..       
+00036cd0: 2020 2020 2069 6620 7365 6c66 2e68 746d       if self.htm
+00036ce0: 6c5f 7374 6174 732e 5368 6f77 6e3a 0d0a  l_stats.Shown:..
+00036cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036d00: 7365 6c66 2e73 686f 775f 7374 6174 7328  self.show_stats(
+00036d10: 5472 7565 2920 2320 546f 2072 6573 746f  True) # To resto
+00036d20: 7265 2073 6372 6f6c 6c20 706f 7369 7469  re scroll positi
+00036d30: 6f6e 0d0a 2020 2020 2020 2020 7365 6c66  on..        self
+00036d40: 2e6c 6973 745f 636f 6e74 6163 7473 2e52  .list_contacts.R
+00036d50: 6566 7265 7368 526f 7773 2829 0d0a 2020  efreshRows()..  
+00036d60: 2020 2020 2020 7365 6c66 2e6c 6f61 645f        self.load_
+00036d70: 636f 6e74 6163 7428 7365 6c66 2e63 6f6e  contact(self.con
+00036d80: 7461 6374 290d 0a0d 0a0d 0a20 2020 2064  tact)......    d
+00036d90: 6566 206f 6e5f 6578 706f 7274 5f63 6861  ef on_export_cha
+00036da0: 7428 7365 6c66 2c20 6576 656e 7429 3a0d  t(self, event):.
+00036db0: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
+00036dc0: 2020 2020 2020 4861 6e64 6c65 7220 666f        Handler fo
+00036dd0: 7220 636c 6963 6b69 6e67 2074 6f20 6578  r clicking to ex
+00036de0: 706f 7274 2061 2063 6861 742c 2064 6973  port a chat, dis
+00036df0: 706c 6179 7320 6120 7361 7665 2066 696c  plays a save fil
+00036e00: 6520 6469 616c 6f67 2061 6e64 0d0a 2020  e dialog and..  
+00036e10: 2020 2020 2020 7361 7665 7320 7468 6520        saves the 
+00036e20: 6375 7272 656e 7420 6d65 7373 6167 6573  current messages
+00036e30: 2074 6f20 6669 6c65 2e0d 0a20 2020 2020   to file...     
+00036e40: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
+00036e50: 666f 726d 6174 6172 6773 203d 2063 6f6c  formatargs = col
+00036e60: 6c65 6374 696f 6e73 2e64 6566 6175 6c74  lections.default
+00036e70: 6469 6374 2873 7472 293b 2066 6f72 6d61  dict(str); forma
+00036e80: 7461 7267 732e 7570 6461 7465 2873 656c  targs.update(sel
+00036e90: 662e 6368 6174 290d 0a20 2020 2020 2020  f.chat)..       
+00036ea0: 2064 6566 6175 6c74 203d 2075 7469 6c2e   default = util.
+00036eb0: 7361 6665 5f66 696c 656e 616d 6528 636f  safe_filename(co
+00036ec0: 6e66 2e45 7870 6f72 7443 6861 7454 656d  nf.ExportChatTem
+00036ed0: 706c 6174 6520 2520 666f 726d 6174 6172  plate % formatar
+00036ee0: 6773 290d 0a20 2020 2020 2020 2073 656c  gs)..        sel
+00036ef0: 662e 6469 616c 6f67 5f73 6176 6563 6861  f.dialog_savecha
+00036f00: 742e 4669 6c65 6e61 6d65 203d 2064 6566  t.Filename = def
+00036f10: 6175 6c74 0d0a 2020 2020 2020 2020 6966  ault..        if
+00036f20: 2077 782e 4944 5f4f 4b20 213d 2073 656c   wx.ID_OK != sel
+00036f30: 662e 6469 616c 6f67 5f73 6176 6563 6861  f.dialog_savecha
+00036f40: 742e 5368 6f77 4d6f 6461 6c28 293a 2072  t.ShowModal(): r
+00036f50: 6574 7572 6e0d 0a0d 0a20 2020 2020 2020  eturn....       
+00036f60: 2066 696c 6570 6174 6820 3d20 636f 6e74   filepath = cont
+00036f70: 726f 6c73 2e67 6574 5f64 6961 6c6f 675f  rols.get_dialog_
+00036f80: 7061 7468 2873 656c 662e 6469 616c 6f67  path(self.dialog
+00036f90: 5f73 6176 6563 6861 7429 0d0a 2020 2020  _savechat)..    
+00036fa0: 2020 2020 666f 726d 6174 203d 2065 7870      format = exp
+00036fb0: 6f72 742e 4348 4154 5f45 5854 535b 7365  ort.CHAT_EXTS[se
+00036fc0: 6c66 2e64 6961 6c6f 675f 7361 7665 6368  lf.dialog_savech
+00036fd0: 6174 2e46 696c 7465 7249 6e64 6578 5d0d  at.FilterIndex].
+00036fe0: 0a20 2020 2020 2020 206d 6564 6961 5f66  .        media_f
+00036ff0: 6f6c 6465 7220 3d20 2268 746d 6c22 203d  older = "html" =
+00037000: 3d20 666f 726d 6174 2061 6e64 205c 0d0a  = format and \..
+00037010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00037020: 2020 2020 2020 2073 656c 662e 6469 616c         self.dial
+00037030: 6f67 5f73 6176 6563 6861 742e 4669 6c74  og_savechat.Filt
+00037040: 6572 496e 6465 7820 213d 2065 7870 6f72  erIndex != expor
+00037050: 742e 4348 4154 5f45 5854 532e 696e 6465  t.CHAT_EXTS.inde
+00037060: 7828 2268 746d 6c22 290d 0a20 2020 2020  x("html")..     
+00037070: 2020 2069 6620 6d65 6469 615f 666f 6c64     if media_fold
+00037080: 6572 2061 6e64 206e 6f74 2063 6865 636b  er and not check
+00037090: 5f6d 6564 6961 5f65 7870 6f72 745f 6c6f  _media_export_lo
+000370a0: 6769 6e28 7365 6c66 2e64 6229 3a20 7265  gin(self.db): re
+000370b0: 7475 726e 0d0a 0d0a 2020 2020 2020 2020  turn....        
+000370c0: 6275 7379 203d 2063 6f6e 7472 6f6c 732e  busy = controls.
+000370d0: 4275 7379 5061 6e65 6c28 7365 6c66 2c20  BusyPanel(self, 
+000370e0: 2745 7870 6f72 7469 6e67 2022 2573 222e  'Exporting "%s".
+000370f0: 2720 2520 7365 6c66 2e63 6861 745b 2274  ' % self.chat["t
+00037100: 6974 6c65 225d 290d 0a20 2020 2020 2020  itle"])..       
+00037110: 2067 7569 6261 7365 2e73 7461 7475 7328   guibase.status(
+00037120: 2245 7870 6f72 7469 6e67 2074 6f20 2573  "Exporting to %s
+00037130: 2e22 2c20 6669 6c65 7061 7468 290d 0a20  .", filepath).. 
+00037140: 2020 2020 2020 2074 7279 3a0d 0a20 2020         try:..   
+00037150: 2020 2020 2020 2020 206d 6573 7361 6765           message
+00037160: 7320 3d20 7365 6c66 2e73 7463 5f68 6973  s = self.stc_his
+00037170: 746f 7279 2e47 6574 4d65 7373 6167 6573  tory.GetMessages
+00037180: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+00037190: 7072 6f67 7265 7373 6675 6e63 203d 206c  progressfunc = l
+000371a0: 616d 6264 6120 2a61 7267 733a 2077 782e  ambda *args: wx.
+000371b0: 5361 6665 5969 656c 6428 290d 0a20 2020  SafeYield()..   
+000371c0: 2020 2020 2020 2020 206f 7074 7320 3d20           opts = 
+000371d0: 6469 6374 2870 726f 6772 6573 733d 7072  dict(progress=pr
+000371e0: 6f67 7265 7373 6675 6e63 2c20 6e6f 736b  ogressfunc, nosk
+000371f0: 6970 3d54 7275 652c 206d 6573 7361 6765  ip=True, message
+00037200: 733d 6d65 7373 6167 6573 290d 0a20 2020  s=messages)..   
+00037210: 2020 2020 2020 2020 2069 6620 6d65 6469           if medi
+00037220: 615f 666f 6c64 6572 3a20 6f70 7473 5b22  a_folder: opts["
+00037230: 6d65 6469 615f 666f 6c64 6572 225d 203d  media_folder"] =
+00037240: 2054 7275 650d 0a20 2020 2020 2020 2020   True..         
+00037250: 2020 2072 6573 756c 7420 3d20 6578 706f     result = expo
+00037260: 7274 2e65 7870 6f72 745f 6368 6174 7328  rt.export_chats(
+00037270: 5b73 656c 662e 6368 6174 5d2c 2066 696c  [self.chat], fil
+00037280: 6570 6174 682c 2066 6f72 6d61 742c 2073  epath, format, s
+00037290: 656c 662e 6462 2c20 6f70 7473 290d 0a20  elf.db, opts).. 
+000372a0: 2020 2020 2020 2020 2020 2066 696c 6573             files
+000372b0: 2c20 636f 756e 742c 206d 6573 7361 6765  , count, message
+000372c0: 5f63 6f75 6e74 203d 2072 6573 756c 740d  _count = result.
+000372d0: 0a20 2020 2020 2020 2020 2020 2067 7569  .            gui
+000372e0: 6261 7365 2e73 7461 7475 7328 2245 7870  base.status("Exp
+000372f0: 6f72 7465 6420 2573 2074 6f20 2573 2e22  orted %s to %s."
+00037300: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00037310: 2020 2020 2020 2020 2020 2020 2020 7574                ut
+00037320: 696c 2e70 6c75 7261 6c28 226d 6573 7361  il.plural("messa
+00037330: 6765 222c 206d 6573 7361 6765 5f63 6f75  ge", message_cou
+00037340: 6e74 2c20 7365 703d 222c 2229 2c20 6669  nt, sep=","), fi
+00037350: 6c65 7061 7468 2c20 6c6f 673d 5472 7565  lepath, log=True
+00037360: 290d 0a20 2020 2020 2020 2020 2020 2074  )..            t
+00037370: 7279 3a20 636f 6e66 2e45 7870 6f72 7446  ry: conf.ExportF
+00037380: 696c 6541 7574 6f4f 7065 6e20 616e 6420  ileAutoOpen and 
+00037390: 7574 696c 2e73 7461 7274 5f66 696c 6528  util.start_file(
+000373a0: 6669 6c65 7061 7468 290d 0a20 2020 2020  filepath)..     
+000373b0: 2020 2020 2020 2065 7863 6570 7420 4578         except Ex
+000373c0: 6365 7074 696f 6e3a 0d0a 2020 2020 2020  ception:..      
+000373d0: 2020 2020 2020 2020 2020 6c6f 6767 6572            logger
+000373e0: 2e65 7863 6570 7469 6f6e 2822 4572 726f  .exception("Erro
+000373f0: 7220 7374 6172 7469 6e67 2025 732e 222c  r starting %s.",
+00037400: 2066 696c 6570 6174 6829 0d0a 2020 2020   filepath)..    
+00037410: 2020 2020 2020 2020 7778 2e43 616c 6c41          wx.CallA
+00037420: 6674 6572 2873 656c 662e 7570 6461 7465  fter(self.update
+00037430: 5f6c 6976 6569 6e66 6f29 0d0a 2020 2020  _liveinfo)..    
+00037440: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
+00037450: 7469 6f6e 3a0d 0a20 2020 2020 2020 2020  tion:..         
+00037460: 2020 206c 6f67 6765 722e 6578 6365 7074     logger.except
+00037470: 696f 6e28 2245 7272 6f72 2073 6176 696e  ion("Error savin
+00037480: 6720 2573 2e22 2c20 6669 6c65 7061 7468  g %s.", filepath
+00037490: 290d 0a20 2020 2020 2020 2020 2020 2067  )..            g
+000374a0: 7569 6261 7365 2e73 7461 7475 7328 2245  uibase.status("E
+000374b0: 7272 6f72 2073 6176 696e 6720 2573 2e22  rror saving %s."
+000374c0: 2c20 6669 6c65 7061 7468 290d 0a20 2020  , filepath)..   
+000374d0: 2020 2020 2020 2020 2065 7272 6f72 6d73           errorms
+000374e0: 6720 3d20 2245 7272 6f72 2073 6176 696e  g = "Error savin
+000374f0: 6720 2573 3a5c 6e5c 6e25 7322 2025 205c  g %s:\n\n%s" % \
+00037500: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00037510: 2020 2020 2020 2020 2028 6669 6c65 7061           (filepa
+00037520: 7468 2c20 7472 6163 6562 6163 6b2e 666f  th, traceback.fo
+00037530: 726d 6174 5f65 7863 2829 290d 0a20 2020  rmat_exc())..   
+00037540: 2020 2020 2020 2020 2077 782e 4d65 7373           wx.Mess
+00037550: 6167 6542 6f78 2865 7272 6f72 6d73 672c  ageBox(errormsg,
+00037560: 2063 6f6e 662e 5469 746c 652c 2077 782e   conf.Title, wx.
+00037570: 4f4b 207c 2077 782e 4943 4f4e 5f57 4152  OK | wx.ICON_WAR
+00037580: 4e49 4e47 290d 0a20 2020 2020 2020 2020  NING)..         
+00037590: 2020 2077 782e 4361 6c6c 4166 7465 7228     wx.CallAfter(
+000375a0: 7574 696c 2e74 7279 5f69 676e 6f72 652c  util.try_ignore,
+000375b0: 206f 732e 756e 6c69 6e6b 2c20 6669 6c65   os.unlink, file
+000375c0: 7061 7468 290d 0a20 2020 2020 2020 2066  path)..        f
+000375d0: 696e 616c 6c79 3a0d 0a20 2020 2020 2020  inally:..       
+000375e0: 2020 2020 2062 7573 792e 436c 6f73 6528       busy.Close(
+000375f0: 290d 0a0d 0a0d 0a20 2020 2064 6566 206f  )......    def o
+00037600: 6e5f 6578 706f 7274 5f63 6861 7473 5f6d  n_export_chats_m
+00037610: 656e 7528 7365 6c66 2c20 6576 656e 7429  enu(self, event)
+00037620: 3a0d 0a20 2020 2020 2020 2022 2222 0d0a  :..        """..
+00037630: 2020 2020 2020 2020 4861 6e64 6c65 7220          Handler 
+00037640: 666f 7220 636c 6963 6b69 6e67 2074 6f20  for clicking to 
+00037650: 6578 706f 7274 2073 656c 6563 7465 6420  export selected 
+00037660: 6f72 2061 6c6c 2063 6861 7473 2c20 6469  or all chats, di
+00037670: 7370 6c61 7973 2061 0d0a 2020 2020 2020  splays a..      
+00037680: 2020 7375 626d 656e 7520 7769 7468 2063    submenu with c
+00037690: 686f 6963 6573 2074 6f20 6578 706f 7274  hoices to export
+000376a0: 2073 656c 6563 7465 6420 6368 6174 7320   selected chats 
+000376b0: 6f72 2061 6c6c 2063 6861 7473 2e0d 0a20  or all chats... 
+000376c0: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
+000376d0: 2020 2020 7365 6c65 6374 6564 2c20 7365      selected, se
+000376e0: 6c65 6374 6564 7320 3d20 7365 6c66 2e6c  lecteds = self.l
+000376f0: 6973 745f 6368 6174 732e 4765 7446 6972  ist_chats.GetFir
+00037700: 7374 5365 6c65 6374 6564 2829 2c20 5b5d  stSelected(), []
+00037710: 0d0a 2020 2020 2020 2020 7768 696c 6520  ..        while 
+00037720: 7365 6c65 6374 6564 203e 3d20 303a 0d0a  selected >= 0:..
+00037730: 2020 2020 2020 2020 2020 2020 7365 6c65              sele
+00037740: 6374 6564 732e 6170 7065 6e64 2873 656c  cteds.append(sel
+00037750: 6563 7465 6429 0d0a 2020 2020 2020 2020  ected)..        
+00037760: 2020 2020 7365 6c65 6374 6564 203d 2073      selected = s
+00037770: 656c 662e 6c69 7374 5f63 6861 7473 2e47  elf.list_chats.G
+00037780: 6574 4e65 7874 5365 6c65 6374 6564 2873  etNextSelected(s
+00037790: 656c 6563 7465 6429 0d0a 0d0a 2020 2020  elected)....    
+000377a0: 2020 2020 6465 6620 6861 6e64 6c65 7228      def handler(
+000377b0: 646f 5f61 6c6c 3d46 616c 7365 2c20 646f  do_all=False, do
+000377c0: 5f73 696e 676c 6566 696c 653d 4661 6c73  _singlefile=Fals
+000377d0: 652c 2064 6f5f 7469 6d65 7261 6e67 653d  e, do_timerange=
+000377e0: 4661 6c73 6529 3a0d 0a20 2020 2020 2020  False):..       
+000377f0: 2020 2020 2063 6861 7473 203d 205b 7365       chats = [se
+00037800: 6c66 2e6c 6973 745f 6368 6174 732e 4765  lf.list_chats.Ge
+00037810: 7449 7465 6d4d 6170 7065 6444 6174 6128  tItemMappedData(
+00037820: 6929 0d0a 2020 2020 2020 2020 2020 2020  i)..            
+00037830: 2020 2020 2020 2020 2066 6f72 2069 2069           for i i
+00037840: 6e20 2872 616e 6765 2873 656c 662e 6c69  n (range(self.li
+00037850: 7374 5f63 6861 7473 2e49 7465 6d43 6f75  st_chats.ItemCou
+00037860: 6e74 2920 6966 2064 6f5f 616c 6c20 656c  nt) if do_all el
+00037870: 7365 2073 656c 6563 7465 6473 295d 0d0a  se selecteds)]..
+00037880: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00037890: 726e 2066 756e 6374 6f6f 6c73 2e70 6172  rn functools.par
+000378a0: 7469 616c 2873 656c 662e 6f6e 5f65 7870  tial(self.on_exp
+000378b0: 6f72 745f 6368 6174 732c 0d0a 2020 2020  ort_chats,..    
+000378c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000378d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000378e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000378f0: 2249 6e74 6f20 6120 7369 6e67 6c65 2026  "Into a single &
-00037900: 4578 6365 6c20 776f 726b 626f 6f6b 2c20  Excel workbook, 
-00037910: 7769 7468 2073 6570 6172 6174 6520 7368  with separate sh
-00037920: 6565 7473 2229 0d0a 2020 2020 2020 2020  eets")..        
-00037930: 2020 2020 6d65 6e75 5f73 656c 2e41 7070      menu_sel.App
-00037940: 656e 6428 6974 656d 5f73 656c 5f73 696e  end(item_sel_sin
-00037950: 676c 6529 0d0a 2020 2020 2020 2020 2020  gle)..          
-00037960: 2020 7365 6c66 2e42 696e 6428 7778 2e45    self.Bind(wx.E
-00037970: 5654 5f4d 454e 552c 2068 616e 646c 6572  VT_MENU, handler
-00037980: 2864 6f5f 7369 6e67 6c65 6669 6c65 3d54  (do_singlefile=T
-00037990: 7275 6529 2c20 6974 656d 5f73 656c 5f73  rue), item_sel_s
-000379a0: 696e 676c 6529 0d0a 0d0a 2020 2020 2020  ingle)....      
-000379b0: 2020 6974 656d 5f61 6c6c 5f6d 756c 7469    item_all_multi
-000379c0: 203d 2077 782e 4d65 6e75 4974 656d 286d   = wx.MenuItem(m
-000379d0: 656e 755f 616c 6c2c 2077 782e 4944 5f41  enu_all, wx.ID_A
-000379e0: 4e59 2c20 2249 6e74 6f20 696e 6469 7669  NY, "Into indivi
-000379f0: 6475 616c 2026 6669 6c65 7322 290d 0a20  dual &files").. 
-00037a00: 2020 2020 2020 206d 656e 755f 616c 6c2e         menu_all.
-00037a10: 4170 7065 6e64 2869 7465 6d5f 616c 6c5f  Append(item_all_
-00037a20: 6d75 6c74 6929 0d0a 2020 2020 2020 2020  multi)..        
-00037a30: 7365 6c66 2e42 696e 6428 7778 2e45 5654  self.Bind(wx.EVT
-00037a40: 5f4d 454e 552c 2068 616e 646c 6572 2864  _MENU, handler(d
-00037a50: 6f5f 616c 6c3d 5472 7565 292c 2069 7465  o_all=True), ite
-00037a60: 6d5f 616c 6c5f 6d75 6c74 6929 0d0a 2020  m_all_multi)..  
-00037a70: 2020 2020 2020 6966 2065 7870 6f72 742e        if export.
-00037a80: 786c 7378 7772 6974 6572 3a0d 0a20 2020  xlsxwriter:..   
-00037a90: 2020 2020 2020 2020 2069 7465 6d5f 616c           item_al
-00037aa0: 6c5f 7369 6e67 6c65 203d 2077 782e 4d65  l_single = wx.Me
-00037ab0: 6e75 4974 656d 286d 656e 755f 616c 6c2c  nuItem(menu_all,
-00037ac0: 2077 782e 4944 5f41 4e59 2c0d 0a20 2020   wx.ID_ANY,..   
-00037ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00037ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00037af0: 2020 2020 2020 2022 496e 746f 2061 2073         "Into a s
-00037b00: 696e 676c 6520 2645 7863 656c 2077 6f72  ingle &Excel wor
-00037b10: 6b62 6f6f 6b2c 2077 6974 6820 7365 7061  kbook, with sepa
-00037b20: 7261 7465 2073 6865 6574 7322 290d 0a20  rate sheets").. 
-00037b30: 2020 2020 2020 2020 2020 206d 656e 755f             menu_
-00037b40: 616c 6c2e 4170 7065 6e64 2869 7465 6d5f  all.Append(item_
-00037b50: 616c 6c5f 7369 6e67 6c65 290d 0a20 2020  all_single)..   
-00037b60: 2020 2020 2020 2020 206d 7968 616e 646c           myhandl
-00037b70: 6572 203d 2068 616e 646c 6572 2864 6f5f  er = handler(do_
-00037b80: 616c 6c3d 5472 7565 2c20 646f 5f73 696e  all=True, do_sin
-00037b90: 676c 6566 696c 653d 5472 7565 290d 0a20  glefile=True).. 
-00037ba0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00037bb0: 4269 6e64 2877 782e 4556 545f 4d45 4e55  Bind(wx.EVT_MENU
-00037bc0: 2c20 6d79 6861 6e64 6c65 722c 2069 7465  , myhandler, ite
-00037bd0: 6d5f 616c 6c5f 7369 6e67 6c65 290d 0a0d  m_all_single)...
-00037be0: 0a20 2020 2020 2020 2069 7465 6d5f 7365  .        item_se
-00037bf0: 6c5f 6461 7465 5f6d 756c 7469 203d 2077  l_date_multi = w
-00037c00: 782e 4d65 6e75 4974 656d 286d 656e 755f  x.MenuItem(menu_
-00037c10: 6461 7465 2c20 7778 2e49 445f 414e 592c  date, wx.ID_ANY,
-00037c20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00037c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00037c40: 2020 2020 2020 2020 2020 2020 2253 656c              "Sel
-00037c50: 6563 7465 6420 6368 6174 7320 696e 746f  ected chats into
-00037c60: 2069 6e64 6976 6964 7561 6c20 2666 696c   individual &fil
-00037c70: 6573 2229 0d0a 2020 2020 2020 2020 6d65  es")..        me
-00037c80: 6e75 5f64 6174 652e 4170 7065 6e64 2869  nu_date.Append(i
-00037c90: 7465 6d5f 7365 6c5f 6461 7465 5f6d 756c  tem_sel_date_mul
-00037ca0: 7469 290d 0a20 2020 2020 2020 2069 7465  ti)..        ite
-00037cb0: 6d5f 7365 6c5f 6461 7465 5f6d 756c 7469  m_sel_date_multi
-00037cc0: 2e45 6e61 626c 6528 6c65 6e28 7365 6c65  .Enable(len(sele
-00037cd0: 6374 6564 7329 290d 0a20 2020 2020 2020  cteds))..       
-00037ce0: 2073 656c 662e 4269 6e64 2877 782e 4556   self.Bind(wx.EV
-00037cf0: 545f 4d45 4e55 2c20 6861 6e64 6c65 7228  T_MENU, handler(
-00037d00: 646f 5f74 696d 6572 616e 6765 3d54 7275  do_timerange=Tru
-00037d10: 6529 2c20 6974 656d 5f73 656c 5f64 6174  e), item_sel_dat
-00037d20: 655f 6d75 6c74 6929 0d0a 2020 2020 2020  e_multi)..      
-00037d30: 2020 6966 2065 7870 6f72 742e 786c 7378    if export.xlsx
-00037d40: 7772 6974 6572 3a0d 0a20 2020 2020 2020  writer:..       
-00037d50: 2020 2020 2069 7465 6d5f 7365 6c5f 6461       item_sel_da
-00037d60: 7465 5f73 696e 676c 6520 3d20 7778 2e4d  te_single = wx.M
-00037d70: 656e 7549 7465 6d28 6d65 6e75 5f73 656c  enuItem(menu_sel
-00037d80: 2c20 7778 2e49 445f 414e 592c 0d0a 2020  , wx.ID_ANY,..  
-00037d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00037da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00037db0: 2020 2020 2020 2020 2020 2020 2022 5365               "Se
-00037dc0: 6c65 6374 6564 2063 6861 7473 2069 6e74  lected chats int
-00037dd0: 6f20 6120 7369 6e67 6c65 2026 4578 6365  o a single &Exce
-00037de0: 6c20 776f 726b 626f 6f6b 2c20 220d 0a20  l workbook, ".. 
-00037df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000378e0: 2063 6861 7473 2c20 646f 5f61 6c6c 2c20   chats, do_all, 
+000378f0: 646f 5f73 696e 676c 6566 696c 652c 2064  do_singlefile, d
+00037900: 6f5f 7469 6d65 7261 6e67 6529 0d0a 0d0a  o_timerange)....
+00037910: 2020 2020 2020 2020 6d65 6e75 203d 2077          menu = w
+00037920: 782e 4d65 6e75 2829 0d0a 2020 2020 2020  x.Menu()..      
+00037930: 2020 6d65 6e75 5f73 656c 2020 3d20 7778    menu_sel  = wx
+00037940: 2e4d 656e 7528 290d 0a20 2020 2020 2020  .Menu()..       
+00037950: 206d 656e 755f 616c 6c20 203d 2077 782e   menu_all  = wx.
+00037960: 4d65 6e75 2829 0d0a 2020 2020 2020 2020  Menu()..        
+00037970: 6d65 6e75 5f64 6174 6520 3d20 7778 2e4d  menu_date = wx.M
+00037980: 656e 7528 290d 0a0d 0a20 2020 2020 2020  enu()....       
+00037990: 2069 7465 6d5f 7365 6c5f 6d75 6c74 6920   item_sel_multi 
+000379a0: 3d20 7778 2e4d 656e 7549 7465 6d28 6d65  = wx.MenuItem(me
+000379b0: 6e75 5f73 656c 2c20 7778 2e49 445f 414e  nu_sel, wx.ID_AN
+000379c0: 592c 2022 496e 746f 2069 6e64 6976 6964  Y, "Into individ
+000379d0: 7561 6c20 2666 696c 6573 2229 0d0a 2020  ual &files")..  
+000379e0: 2020 2020 2020 6d65 6e75 5f73 656c 2e41        menu_sel.A
+000379f0: 7070 656e 6428 6974 656d 5f73 656c 5f6d  ppend(item_sel_m
+00037a00: 756c 7469 290d 0a20 2020 2020 2020 2073  ulti)..        s
+00037a10: 656c 662e 4269 6e64 2877 782e 4556 545f  elf.Bind(wx.EVT_
+00037a20: 4d45 4e55 2c20 6861 6e64 6c65 7228 292c  MENU, handler(),
+00037a30: 2069 7465 6d5f 7365 6c5f 6d75 6c74 6929   item_sel_multi)
+00037a40: 0d0a 2020 2020 2020 2020 6966 2065 7870  ..        if exp
+00037a50: 6f72 742e 786c 7378 7772 6974 6572 3a0d  ort.xlsxwriter:.
+00037a60: 0a20 2020 2020 2020 2020 2020 2069 7465  .            ite
+00037a70: 6d5f 7365 6c5f 7369 6e67 6c65 203d 2077  m_sel_single = w
+00037a80: 782e 4d65 6e75 4974 656d 286d 656e 755f  x.MenuItem(menu_
+00037a90: 7365 6c2c 2077 782e 4944 5f41 4e59 2c0d  sel, wx.ID_ANY,.
+00037aa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00037ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00037ac0: 2020 2020 2020 2020 2020 2022 496e 746f             "Into
+00037ad0: 2061 2073 696e 676c 6520 2645 7863 656c   a single &Excel
+00037ae0: 2077 6f72 6b62 6f6f 6b2c 2077 6974 6820   workbook, with 
+00037af0: 7365 7061 7261 7465 2073 6865 6574 7322  separate sheets"
+00037b00: 290d 0a20 2020 2020 2020 2020 2020 206d  )..            m
+00037b10: 656e 755f 7365 6c2e 4170 7065 6e64 2869  enu_sel.Append(i
+00037b20: 7465 6d5f 7365 6c5f 7369 6e67 6c65 290d  tem_sel_single).
+00037b30: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00037b40: 662e 4269 6e64 2877 782e 4556 545f 4d45  f.Bind(wx.EVT_ME
+00037b50: 4e55 2c20 6861 6e64 6c65 7228 646f 5f73  NU, handler(do_s
+00037b60: 696e 676c 6566 696c 653d 5472 7565 292c  inglefile=True),
+00037b70: 2069 7465 6d5f 7365 6c5f 7369 6e67 6c65   item_sel_single
+00037b80: 290d 0a0d 0a20 2020 2020 2020 2069 7465  )....        ite
+00037b90: 6d5f 616c 6c5f 6d75 6c74 6920 3d20 7778  m_all_multi = wx
+00037ba0: 2e4d 656e 7549 7465 6d28 6d65 6e75 5f61  .MenuItem(menu_a
+00037bb0: 6c6c 2c20 7778 2e49 445f 414e 592c 2022  ll, wx.ID_ANY, "
+00037bc0: 496e 746f 2069 6e64 6976 6964 7561 6c20  Into individual 
+00037bd0: 2666 696c 6573 2229 0d0a 2020 2020 2020  &files")..      
+00037be0: 2020 6d65 6e75 5f61 6c6c 2e41 7070 656e    menu_all.Appen
+00037bf0: 6428 6974 656d 5f61 6c6c 5f6d 756c 7469  d(item_all_multi
+00037c00: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00037c10: 4269 6e64 2877 782e 4556 545f 4d45 4e55  Bind(wx.EVT_MENU
+00037c20: 2c20 6861 6e64 6c65 7228 646f 5f61 6c6c  , handler(do_all
+00037c30: 3d54 7275 6529 2c20 6974 656d 5f61 6c6c  =True), item_all
+00037c40: 5f6d 756c 7469 290d 0a20 2020 2020 2020  _multi)..       
+00037c50: 2069 6620 6578 706f 7274 2e78 6c73 7877   if export.xlsxw
+00037c60: 7269 7465 723a 0d0a 2020 2020 2020 2020  riter:..        
+00037c70: 2020 2020 6974 656d 5f61 6c6c 5f73 696e      item_all_sin
+00037c80: 676c 6520 3d20 7778 2e4d 656e 7549 7465  gle = wx.MenuIte
+00037c90: 6d28 6d65 6e75 5f61 6c6c 2c20 7778 2e49  m(menu_all, wx.I
+00037ca0: 445f 414e 592c 0d0a 2020 2020 2020 2020  D_ANY,..        
+00037cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00037cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00037cd0: 2020 2249 6e74 6f20 6120 7369 6e67 6c65    "Into a single
+00037ce0: 2026 4578 6365 6c20 776f 726b 626f 6f6b   &Excel workbook
+00037cf0: 2c20 7769 7468 2073 6570 6172 6174 6520  , with separate 
+00037d00: 7368 6565 7473 2229 0d0a 2020 2020 2020  sheets")..      
+00037d10: 2020 2020 2020 6d65 6e75 5f61 6c6c 2e41        menu_all.A
+00037d20: 7070 656e 6428 6974 656d 5f61 6c6c 5f73  ppend(item_all_s
+00037d30: 696e 676c 6529 0d0a 2020 2020 2020 2020  ingle)..        
+00037d40: 2020 2020 6d79 6861 6e64 6c65 7220 3d20      myhandler = 
+00037d50: 6861 6e64 6c65 7228 646f 5f61 6c6c 3d54  handler(do_all=T
+00037d60: 7275 652c 2064 6f5f 7369 6e67 6c65 6669  rue, do_singlefi
+00037d70: 6c65 3d54 7275 6529 0d0a 2020 2020 2020  le=True)..      
+00037d80: 2020 2020 2020 7365 6c66 2e42 696e 6428        self.Bind(
+00037d90: 7778 2e45 5654 5f4d 454e 552c 206d 7968  wx.EVT_MENU, myh
+00037da0: 616e 646c 6572 2c20 6974 656d 5f61 6c6c  andler, item_all
+00037db0: 5f73 696e 676c 6529 0d0a 0d0a 2020 2020  _single)....    
+00037dc0: 2020 2020 6974 656d 5f73 656c 5f64 6174      item_sel_dat
+00037dd0: 655f 6d75 6c74 6920 3d20 7778 2e4d 656e  e_multi = wx.Men
+00037de0: 7549 7465 6d28 6d65 6e75 5f64 6174 652c  uItem(menu_date,
+00037df0: 2077 782e 4944 5f41 4e59 2c0d 0a20 2020   wx.ID_ANY,..   
 00037e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00037e10: 2020 2020 2020 2020 2020 2020 2020 2277                "w
-00037e20: 6974 6820 7365 7061 7261 7465 2073 6865  ith separate she
-00037e30: 6574 7322 290d 0a20 2020 2020 2020 2020  ets")..         
-00037e40: 2020 206d 656e 755f 6461 7465 2e41 7070     menu_date.App
-00037e50: 656e 6428 6974 656d 5f73 656c 5f64 6174  end(item_sel_dat
-00037e60: 655f 7369 6e67 6c65 290d 0a20 2020 2020  e_single)..     
-00037e70: 2020 2020 2020 2069 7465 6d5f 7365 6c5f         item_sel_
-00037e80: 6461 7465 5f73 696e 676c 652e 456e 6162  date_single.Enab
-00037e90: 6c65 286c 656e 2873 656c 6563 7465 6473  le(len(selecteds
-00037ea0: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
-00037eb0: 6d79 6861 6e64 6c65 7220 3d20 6861 6e64  myhandler = hand
-00037ec0: 6c65 7228 646f 5f73 696e 676c 6566 696c  ler(do_singlefil
-00037ed0: 653d 5472 7565 2c20 646f 5f74 696d 6572  e=True, do_timer
-00037ee0: 616e 6765 3d54 7275 6529 0d0a 2020 2020  ange=True)..    
-00037ef0: 2020 2020 2020 2020 7365 6c66 2e42 696e          self.Bin
-00037f00: 6428 7778 2e45 5654 5f4d 454e 552c 206d  d(wx.EVT_MENU, m
-00037f10: 7968 616e 646c 6572 2c20 6974 656d 5f73  yhandler, item_s
-00037f20: 656c 5f64 6174 655f 7369 6e67 6c65 290d  el_date_single).
-00037f30: 0a20 2020 2020 2020 206d 656e 755f 6461  .        menu_da
-00037f40: 7465 2e41 7070 656e 6453 6570 6172 6174  te.AppendSeparat
-00037f50: 6f72 2829 0d0a 2020 2020 2020 2020 6974  or()..        it
-00037f60: 656d 5f61 6c6c 5f64 6174 655f 6d75 6c74  em_all_date_mult
-00037f70: 6920 3d20 7778 2e4d 656e 7549 7465 6d28  i = wx.MenuItem(
-00037f80: 6d65 6e75 5f64 6174 652c 2077 782e 4944  menu_date, wx.ID
-00037f90: 5f41 4e59 2c20 2241 6c6c 2063 6861 7473  _ANY, "All chats
-00037fa0: 2069 6e74 6f20 2669 6e64 6976 6964 7561   into &individua
-00037fb0: 6c20 6669 6c65 7322 290d 0a20 2020 2020  l files")..     
-00037fc0: 2020 206d 656e 755f 6461 7465 2e41 7070     menu_date.App
-00037fd0: 656e 6428 6974 656d 5f61 6c6c 5f64 6174  end(item_all_dat
-00037fe0: 655f 6d75 6c74 6929 0d0a 2020 2020 2020  e_multi)..      
-00037ff0: 2020 7365 6c66 2e42 696e 6428 7778 2e45    self.Bind(wx.E
-00038000: 5654 5f4d 454e 552c 2068 616e 646c 6572  VT_MENU, handler
-00038010: 2864 6f5f 616c 6c3d 5472 7565 2c20 646f  (do_all=True, do
-00038020: 5f74 696d 6572 616e 6765 3d54 7275 6529  _timerange=True)
-00038030: 2c20 6974 656d 5f61 6c6c 5f64 6174 655f  , item_all_date_
-00038040: 6d75 6c74 6929 0d0a 2020 2020 2020 2020  multi)..        
-00038050: 6966 2065 7870 6f72 742e 786c 7378 7772  if export.xlsxwr
-00038060: 6974 6572 3a0d 0a20 2020 2020 2020 2020  iter:..         
-00038070: 2020 2069 7465 6d5f 616c 6c5f 6461 7465     item_all_date
-00038080: 5f73 696e 676c 6520 3d20 7778 2e4d 656e  _single = wx.Men
-00038090: 7549 7465 6d28 6d65 6e75 5f61 6c6c 2c20  uItem(menu_all, 
-000380a0: 7778 2e49 445f 414e 592c 0d0a 2020 2020  wx.ID_ANY,..    
-000380b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000380c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000380d0: 2020 2020 2020 2020 2020 2022 2641 6c6c             "&All
-000380e0: 2063 6861 7473 2069 6e74 6f20 6120 7369   chats into a si
-000380f0: 6e67 6c65 2045 7863 656c 2077 6f72 6b62  ngle Excel workb
-00038100: 6f6f 6b2c 2022 0d0a 2020 2020 2020 2020  ook, "..        
-00038110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038130: 2020 2020 2020 2022 7769 7468 2073 6570         "with sep
-00038140: 6172 6174 6520 7368 6565 7473 2229 0d0a  arate sheets")..
-00038150: 2020 2020 2020 2020 2020 2020 6d65 6e75              menu
-00038160: 5f64 6174 652e 4170 7065 6e64 2869 7465  _date.Append(ite
-00038170: 6d5f 616c 6c5f 6461 7465 5f73 696e 676c  m_all_date_singl
-00038180: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
-00038190: 6d79 6861 6e64 6c65 7220 3d20 6861 6e64  myhandler = hand
-000381a0: 6c65 7228 646f 5f61 6c6c 3d54 7275 652c  ler(do_all=True,
-000381b0: 2064 6f5f 7369 6e67 6c65 6669 6c65 3d54   do_singlefile=T
-000381c0: 7275 652c 2064 6f5f 7469 6d65 7261 6e67  rue, do_timerang
-000381d0: 653d 5472 7565 290d 0a20 2020 2020 2020  e=True)..       
-000381e0: 2020 2020 2073 656c 662e 4269 6e64 2877       self.Bind(w
-000381f0: 782e 4556 545f 4d45 4e55 2c20 6d79 6861  x.EVT_MENU, myha
-00038200: 6e64 6c65 722c 2069 7465 6d5f 616c 6c5f  ndler, item_all_
-00038210: 6461 7465 5f73 696e 676c 6529 0d0a 0d0a  date_single)....
-00038220: 2020 2020 2020 2020 6974 656d 5f73 656c          item_sel
-00038230: 2020 3d20 6d65 6e75 2e41 7070 656e 6453    = menu.AppendS
-00038240: 7562 4d65 6e75 286d 656e 755f 7365 6c2c  ubMenu(menu_sel,
-00038250: 2020 2245 7870 6f72 7420 2673 656c 6563    "Export &selec
-00038260: 7465 6420 6368 6174 7322 290d 0a20 2020  ted chats")..   
-00038270: 2020 2020 2069 7465 6d5f 616c 6c20 203d       item_all  =
-00038280: 206d 656e 752e 4170 7065 6e64 5375 624d   menu.AppendSubM
-00038290: 656e 7528 6d65 6e75 5f61 6c6c 2c20 2022  enu(menu_all,  "
-000382a0: 4578 706f 7274 2026 616c 6c20 6368 6174  Export &all chat
-000382b0: 7322 290d 0a20 2020 2020 2020 2069 7465  s")..        ite
-000382c0: 6d5f 6461 7465 203d 206d 656e 752e 4170  m_date = menu.Ap
-000382d0: 7065 6e64 5375 624d 656e 7528 6d65 6e75  pendSubMenu(menu
-000382e0: 5f64 6174 652c 2022 4578 706f 7274 2026  _date, "Export &
-000382f0: 6461 7465 2072 616e 6765 2229 0d0a 2020  date range")..  
-00038300: 2020 2020 2020 6974 656d 5f73 656c 2e45        item_sel.E
-00038310: 6e61 626c 6528 6c65 6e28 7365 6c65 6374  nable(len(select
-00038320: 6564 7329 290d 0a20 2020 2020 2020 2069  eds))..        i
-00038330: 7465 6d5f 616c 6c2e 456e 6162 6c65 2862  tem_all.Enable(b
-00038340: 6f6f 6c28 7365 6c66 2e6c 6973 745f 6368  ool(self.list_ch
-00038350: 6174 732e 4765 7449 7465 6d43 6f75 6e74  ats.GetItemCount
-00038360: 2829 2929 0d0a 2020 2020 2020 2020 6974  ()))..        it
-00038370: 656d 5f64 6174 652e 456e 6162 6c65 2862  em_date.Enable(b
-00038380: 6f6f 6c28 7365 6c66 2e6c 6973 745f 6368  ool(self.list_ch
-00038390: 6174 732e 4765 7449 7465 6d43 6f75 6e74  ats.GetItemCount
-000383a0: 2829 2929 0d0a 0d0a 2020 2020 2020 2020  ()))....        
-000383b0: 6576 656e 742e 4576 656e 744f 626a 6563  event.EventObjec
-000383c0: 742e 506f 7075 704d 656e 7528 6d65 6e75  t.PopupMenu(menu
-000383d0: 2c20 2830 2c20 6576 656e 742e 4576 656e  , (0, event.Even
-000383e0: 744f 626a 6563 742e 5369 7a65 5b31 5d29  tObject.Size[1])
-000383f0: 290d 0a0d 0a0d 0a20 2020 2064 6566 206f  )......    def o
-00038400: 6e5f 6578 706f 7274 5f63 6f6e 7461 6374  n_export_contact
-00038410: 735f 6d65 6e75 2873 656c 662c 2065 7665  s_menu(self, eve
-00038420: 6e74 293a 0d0a 2020 2020 2020 2020 2222  nt):..        ""
-00038430: 220d 0a20 2020 2020 2020 2048 616e 646c  "..        Handl
-00038440: 6572 2066 6f72 2063 6c69 636b 696e 6720  er for clicking 
-00038450: 746f 2065 7870 6f72 7420 7365 6c65 6374  to export select
-00038460: 6564 206f 7220 616c 6c20 6368 6174 7320  ed or all chats 
-00038470: 6f66 2063 6f6e 7461 6374 732c 2064 6973  of contacts, dis
-00038480: 706c 6179 7320 610d 0a20 2020 2020 2020  plays a..       
-00038490: 2073 7562 6d65 6e75 2077 6974 6820 6368   submenu with ch
-000384a0: 6f69 6365 7320 746f 2065 7870 6f72 7420  oices to export 
-000384b0: 7365 6c65 6374 6564 2063 6861 7473 206f  selected chats o
-000384c0: 7220 616c 6c20 6368 6174 732e 0d0a 2020  r all chats...  
-000384d0: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
-000384e0: 2020 2073 656c 6563 7465 642c 2073 656c     selected, sel
-000384f0: 6563 7465 6473 203d 2073 656c 662e 6c69  ecteds = self.li
-00038500: 7374 5f63 6f6e 7461 6374 732e 4765 7446  st_contacts.GetF
-00038510: 6972 7374 5365 6c65 6374 6564 2829 2c20  irstSelected(), 
-00038520: 5b5d 0d0a 2020 2020 2020 2020 7768 696c  []..        whil
-00038530: 6520 7365 6c65 6374 6564 203e 3d20 303a  e selected >= 0:
-00038540: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00038550: 6c65 6374 6564 732e 6170 7065 6e64 2873  lecteds.append(s
-00038560: 656c 6563 7465 6429 0d0a 2020 2020 2020  elected)..      
-00038570: 2020 2020 2020 7365 6c65 6374 6564 203d        selected =
-00038580: 2073 656c 662e 6c69 7374 5f63 6f6e 7461   self.list_conta
-00038590: 6374 732e 4765 744e 6578 7453 656c 6563  cts.GetNextSelec
-000385a0: 7465 6428 7365 6c65 6374 6564 290d 0a0d  ted(selected)...
-000385b0: 0a20 2020 2020 2020 2064 6566 2068 616e  .        def han
-000385c0: 646c 6572 2864 6f5f 616c 6c3d 4661 6c73  dler(do_all=Fals
-000385d0: 652c 2064 6f5f 7369 6e67 6c65 6669 6c65  e, do_singlefile
-000385e0: 3d46 616c 7365 2c20 646f 5f74 696d 6572  =False, do_timer
-000385f0: 616e 6765 3d46 616c 7365 293a 0d0a 2020  ange=False):..  
-00038600: 2020 2020 2020 2020 2020 636f 6e74 6163            contac
-00038610: 7473 203d 205b 7365 6c66 2e6c 6973 745f  ts = [self.list_
-00038620: 636f 6e74 6163 7473 2e47 6574 4974 656d  contacts.GetItem
-00038630: 4d61 7070 6564 4461 7461 2869 290d 0a20  MappedData(i).. 
-00038640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038650: 2020 2020 2020 2066 6f72 2069 2069 6e20         for i in 
-00038660: 2872 616e 6765 2873 656c 662e 6c69 7374  (range(self.list
-00038670: 5f63 6f6e 7461 6374 732e 4974 656d 436f  _contacts.ItemCo
-00038680: 756e 7429 2069 6620 646f 5f61 6c6c 2065  unt) if do_all e
-00038690: 6c73 6520 7365 6c65 6374 6564 7329 5d0d  lse selecteds)].
-000386a0: 0a20 2020 2020 2020 2020 2020 2063 6861  .            cha
-000386b0: 7473 2c20 7669 7369 7465 642c 2063 6861  ts, visited, cha
-000386c0: 746d 6170 203d 205b 5d2c 2073 6574 2829  tmap = [], set()
-000386d0: 2c20 7b78 5b22 6964 225d 3a20 7820 666f  , {x["id"]: x fo
-000386e0: 7220 7820 696e 2073 656c 662e 6368 6174  r x in self.chat
-000386f0: 737d 0d0a 2020 2020 2020 2020 2020 2020  s}..            
-00038700: 666f 7220 6320 696e 2063 6f6e 7461 6374  for c in contact
-00038710: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
-00038720: 2020 2020 6368 6174 732e 6578 7465 6e64      chats.extend
-00038730: 2873 6f72 7465 6428 2863 6861 746d 6170  (sorted((chatmap
-00038740: 5b78 5b22 6964 225d 5d20 666f 7220 7820  [x["id"]] for x 
-00038750: 696e 2063 2e67 6574 2822 636f 6e76 6572  in c.get("conver
-00038760: 7361 7469 6f6e 7322 2c20 5b5d 290d 0a20  sations", []).. 
-00038770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038790: 2020 2069 6620 785b 2269 6422 5d20 6e6f     if x["id"] no
-000387a0: 7420 696e 2076 6973 6974 6564 292c 0d0a  t in visited),..
-000387b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000387c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000387d0: 2020 2020 6b65 793d 6c61 6d62 6461 2078      key=lambda x
-000387e0: 3a20 2878 5b22 7479 7065 225d 2c20 785b  : (x["type"], x[
-000387f0: 2274 6974 6c65 5f6c 6f6e 6722 5d2e 6c6f  "title_long"].lo
-00038800: 7765 7228 2929 2929 0d0a 2020 2020 2020  wer())))..      
-00038810: 2020 2020 2020 2020 2020 7669 7369 7465            visite
-00038820: 642e 7570 6461 7465 2878 5b22 6964 225d  d.update(x["id"]
-00038830: 2066 6f72 2078 2069 6e20 6368 6174 7329   for x in chats)
-00038840: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-00038850: 7475 726e 2066 756e 6374 6f6f 6c73 2e70  turn functools.p
-00038860: 6172 7469 616c 2873 656c 662e 6f6e 5f65  artial(self.on_e
-00038870: 7870 6f72 745f 6368 6174 732c 0d0a 2020  xport_chats,..  
-00038880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000388a0: 2020 2063 6861 7473 2c20 646f 5f61 6c6c     chats, do_all
-000388b0: 2c20 646f 5f73 696e 676c 6566 696c 652c  , do_singlefile,
-000388c0: 2064 6f5f 7469 6d65 7261 6e67 6529 0d0a   do_timerange)..
-000388d0: 0d0a 2020 2020 2020 2020 6d65 6e75 203d  ..        menu =
-000388e0: 2077 782e 4d65 6e75 2829 0d0a 2020 2020   wx.Menu()..    
-000388f0: 2020 2020 6d65 6e75 5f73 656c 2020 3d20      menu_sel  = 
-00038900: 7778 2e4d 656e 7528 290d 0a20 2020 2020  wx.Menu()..     
-00038910: 2020 206d 656e 755f 616c 6c20 203d 2077     menu_all  = w
-00038920: 782e 4d65 6e75 2829 0d0a 2020 2020 2020  x.Menu()..      
-00038930: 2020 6d65 6e75 5f64 6174 6520 3d20 7778    menu_date = wx
-00038940: 2e4d 656e 7528 290d 0a0d 0a20 2020 2020  .Menu()....     
-00038950: 2020 2069 7465 6d5f 7365 6c5f 6d75 6c74     item_sel_mult
-00038960: 6920 3d20 7778 2e4d 656e 7549 7465 6d28  i = wx.MenuItem(
-00038970: 6d65 6e75 5f73 656c 2c20 7778 2e49 445f  menu_sel, wx.ID_
-00038980: 414e 592c 2022 496e 746f 2069 6e64 6976  ANY, "Into indiv
-00038990: 6964 7561 6c20 2666 696c 6573 2229 0d0a  idual &files")..
-000389a0: 2020 2020 2020 2020 6d65 6e75 5f73 656c          menu_sel
-000389b0: 2e41 7070 656e 6428 6974 656d 5f73 656c  .Append(item_sel
-000389c0: 5f6d 756c 7469 290d 0a20 2020 2020 2020  _multi)..       
-000389d0: 2073 656c 662e 4269 6e64 2877 782e 4556   self.Bind(wx.EV
-000389e0: 545f 4d45 4e55 2c20 6861 6e64 6c65 7228  T_MENU, handler(
-000389f0: 292c 2069 7465 6d5f 7365 6c5f 6d75 6c74  ), item_sel_mult
-00038a00: 6929 0d0a 2020 2020 2020 2020 6966 2065  i)..        if e
-00038a10: 7870 6f72 742e 786c 7378 7772 6974 6572  xport.xlsxwriter
-00038a20: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
-00038a30: 7465 6d5f 7365 6c5f 7369 6e67 6c65 203d  tem_sel_single =
-00038a40: 2077 782e 4d65 6e75 4974 656d 286d 656e   wx.MenuItem(men
-00038a50: 755f 7365 6c2c 2077 782e 4944 5f41 4e59  u_sel, wx.ID_ANY
-00038a60: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00038a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038a80: 2020 2020 2020 2020 2020 2020 2022 496e               "In
-00038a90: 746f 2061 2073 696e 676c 6520 2645 7863  to a single &Exc
-00038aa0: 656c 2077 6f72 6b62 6f6f 6b2c 2077 6974  el workbook, wit
-00038ab0: 6820 7365 7061 7261 7465 2073 6865 6574  h separate sheet
-00038ac0: 7322 290d 0a20 2020 2020 2020 2020 2020  s")..           
-00038ad0: 206d 656e 755f 7365 6c2e 4170 7065 6e64   menu_sel.Append
-00038ae0: 2869 7465 6d5f 7365 6c5f 7369 6e67 6c65  (item_sel_single
-00038af0: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
-00038b00: 656c 662e 4269 6e64 2877 782e 4556 545f  elf.Bind(wx.EVT_
-00038b10: 4d45 4e55 2c20 6861 6e64 6c65 7228 646f  MENU, handler(do
-00038b20: 5f73 696e 676c 6566 696c 653d 5472 7565  _singlefile=True
-00038b30: 292c 2069 7465 6d5f 7365 6c5f 7369 6e67  ), item_sel_sing
-00038b40: 6c65 290d 0a0d 0a20 2020 2020 2020 2069  le)....        i
-00038b50: 7465 6d5f 616c 6c5f 6d75 6c74 6920 3d20  tem_all_multi = 
-00038b60: 7778 2e4d 656e 7549 7465 6d28 6d65 6e75  wx.MenuItem(menu
-00038b70: 5f61 6c6c 2c20 7778 2e49 445f 414e 592c  _all, wx.ID_ANY,
-00038b80: 2022 496e 746f 2069 6e64 6976 6964 7561   "Into individua
-00038b90: 6c20 2666 696c 6573 2229 0d0a 2020 2020  l &files")..    
-00038ba0: 2020 2020 6d65 6e75 5f61 6c6c 2e41 7070      menu_all.App
-00038bb0: 656e 6428 6974 656d 5f61 6c6c 5f6d 756c  end(item_all_mul
-00038bc0: 7469 290d 0a20 2020 2020 2020 2073 656c  ti)..        sel
-00038bd0: 662e 4269 6e64 2877 782e 4556 545f 4d45  f.Bind(wx.EVT_ME
-00038be0: 4e55 2c20 6861 6e64 6c65 7228 646f 5f61  NU, handler(do_a
-00038bf0: 6c6c 3d54 7275 6529 2c20 6974 656d 5f61  ll=True), item_a
-00038c00: 6c6c 5f6d 756c 7469 290d 0a20 2020 2020  ll_multi)..     
-00038c10: 2020 2069 6620 6578 706f 7274 2e78 6c73     if export.xls
-00038c20: 7877 7269 7465 723a 0d0a 2020 2020 2020  xwriter:..      
-00038c30: 2020 2020 2020 6974 656d 5f61 6c6c 5f73        item_all_s
-00038c40: 696e 676c 6520 3d20 7778 2e4d 656e 7549  ingle = wx.MenuI
-00038c50: 7465 6d28 6d65 6e75 5f61 6c6c 2c20 7778  tem(menu_all, wx
-00038c60: 2e49 445f 414e 592c 0d0a 2020 2020 2020  .ID_ANY,..      
-00038c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038c90: 2020 2020 2249 6e74 6f20 6120 7369 6e67      "Into a sing
-00038ca0: 6c65 2026 4578 6365 6c20 776f 726b 626f  le &Excel workbo
-00038cb0: 6f6b 2c20 7769 7468 2073 6570 6172 6174  ok, with separat
-00038cc0: 6520 7368 6565 7473 2229 0d0a 2020 2020  e sheets")..    
-00038cd0: 2020 2020 2020 2020 6d65 6e75 5f61 6c6c          menu_all
-00038ce0: 2e41 7070 656e 6428 6974 656d 5f61 6c6c  .Append(item_all
-00038cf0: 5f73 696e 676c 6529 0d0a 2020 2020 2020  _single)..      
-00038d00: 2020 2020 2020 6d79 6861 6e64 6c65 7220        myhandler 
-00038d10: 3d20 6861 6e64 6c65 7228 646f 5f61 6c6c  = handler(do_all
-00038d20: 3d54 7275 652c 2064 6f5f 7369 6e67 6c65  =True, do_single
-00038d30: 6669 6c65 3d54 7275 6529 0d0a 2020 2020  file=True)..    
-00038d40: 2020 2020 2020 2020 7365 6c66 2e42 696e          self.Bin
-00038d50: 6428 7778 2e45 5654 5f4d 454e 552c 206d  d(wx.EVT_MENU, m
-00038d60: 7968 616e 646c 6572 2c20 6974 656d 5f61  yhandler, item_a
-00038d70: 6c6c 5f73 696e 676c 6529 0d0a 0d0a 2020  ll_single)....  
-00038d80: 2020 2020 2020 6974 656d 5f73 656c 5f64        item_sel_d
-00038d90: 6174 655f 6d75 6c74 6920 3d20 7778 2e4d  ate_multi = wx.M
-00038da0: 656e 7549 7465 6d28 6d65 6e75 5f64 6174  enuItem(menu_dat
-00038db0: 652c 2077 782e 4944 5f41 4e59 2c0d 0a20  e, wx.ID_ANY,.. 
-00038dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038de0: 2020 2020 2020 2020 2022 4368 6174 7320           "Chats 
-00038df0: 6f66 2073 656c 6563 7465 6420 636f 6e74  of selected cont
-00038e00: 6163 7473 2069 6e74 6f20 696e 6469 7669  acts into indivi
-00038e10: 6475 616c 2026 6669 6c65 7322 290d 0a20  dual &files").. 
-00038e20: 2020 2020 2020 206d 656e 755f 6461 7465         menu_date
-00038e30: 2e41 7070 656e 6428 6974 656d 5f73 656c  .Append(item_sel
-00038e40: 5f64 6174 655f 6d75 6c74 6929 0d0a 2020  _date_multi)..  
-00038e50: 2020 2020 2020 6974 656d 5f73 656c 5f64        item_sel_d
-00038e60: 6174 655f 6d75 6c74 692e 456e 6162 6c65  ate_multi.Enable
-00038e70: 286c 656e 2873 656c 6563 7465 6473 2929  (len(selecteds))
-00038e80: 0d0a 2020 2020 2020 2020 7365 6c66 2e42  ..        self.B
-00038e90: 696e 6428 7778 2e45 5654 5f4d 454e 552c  ind(wx.EVT_MENU,
-00038ea0: 2068 616e 646c 6572 2864 6f5f 7469 6d65   handler(do_time
-00038eb0: 7261 6e67 653d 5472 7565 292c 2069 7465  range=True), ite
-00038ec0: 6d5f 7365 6c5f 6461 7465 5f6d 756c 7469  m_sel_date_multi
-00038ed0: 290d 0a20 2020 2020 2020 2069 6620 6578  )..        if ex
-00038ee0: 706f 7274 2e78 6c73 7877 7269 7465 723a  port.xlsxwriter:
-00038ef0: 0d0a 2020 2020 2020 2020 2020 2020 6974  ..            it
-00038f00: 656d 5f73 656c 5f64 6174 655f 7369 6e67  em_sel_date_sing
-00038f10: 6c65 203d 2077 782e 4d65 6e75 4974 656d  le = wx.MenuItem
-00038f20: 286d 656e 755f 7365 6c2c 2077 782e 4944  (menu_sel, wx.ID
-00038f30: 5f41 4e59 2c0d 0a20 2020 2020 2020 2020  _ANY,..         
-00038f40: 2020 2020 2020 2022 4368 6174 7320 6f66         "Chats of
-00038f50: 2073 656c 6563 7465 6420 636f 6e74 6163   selected contac
-00038f60: 7473 2069 6e74 6f20 6120 7369 6e67 6c65  ts into a single
-00038f70: 2026 4578 6365 6c20 776f 726b 626f 6f6b   &Excel workbook
-00038f80: 2c20 7769 7468 2073 6570 6172 6174 6520  , with separate 
-00038f90: 7368 6565 7473 2229 0d0a 2020 2020 2020  sheets")..      
-00038fa0: 2020 2020 2020 6d65 6e75 5f64 6174 652e        menu_date.
-00038fb0: 4170 7065 6e64 2869 7465 6d5f 7365 6c5f  Append(item_sel_
-00038fc0: 6461 7465 5f73 696e 676c 6529 0d0a 2020  date_single)..  
-00038fd0: 2020 2020 2020 2020 2020 6974 656d 5f73            item_s
-00038fe0: 656c 5f64 6174 655f 7369 6e67 6c65 2e45  el_date_single.E
-00038ff0: 6e61 626c 6528 6c65 6e28 7365 6c65 6374  nable(len(select
-00039000: 6564 7329 290d 0a20 2020 2020 2020 2020  eds))..         
-00039010: 2020 206d 7968 616e 646c 6572 203d 2068     myhandler = h
-00039020: 616e 646c 6572 2864 6f5f 7369 6e67 6c65  andler(do_single
-00039030: 6669 6c65 3d54 7275 652c 2064 6f5f 7469  file=True, do_ti
-00039040: 6d65 7261 6e67 653d 5472 7565 290d 0a20  merange=True).. 
-00039050: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00039060: 4269 6e64 2877 782e 4556 545f 4d45 4e55  Bind(wx.EVT_MENU
-00039070: 2c20 6d79 6861 6e64 6c65 722c 2069 7465  , myhandler, ite
-00039080: 6d5f 7365 6c5f 6461 7465 5f73 696e 676c  m_sel_date_singl
-00039090: 6529 0d0a 2020 2020 2020 2020 6d65 6e75  e)..        menu
-000390a0: 5f64 6174 652e 4170 7065 6e64 5365 7061  _date.AppendSepa
-000390b0: 7261 746f 7228 290d 0a20 2020 2020 2020  rator()..       
-000390c0: 2069 7465 6d5f 616c 6c5f 6461 7465 5f6d   item_all_date_m
-000390d0: 756c 7469 203d 2077 782e 4d65 6e75 4974  ulti = wx.MenuIt
-000390e0: 656d 286d 656e 755f 6461 7465 2c20 7778  em(menu_date, wx
-000390f0: 2e49 445f 414e 592c 0d0a 2020 2020 2020  .ID_ANY,..      
-00039100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039120: 2020 2020 2243 6861 7473 206f 6620 616c      "Chats of al
-00039130: 6c20 636f 6e74 6163 7473 2069 6e74 6f20  l contacts into 
-00039140: 2669 6e64 6976 6964 7561 6c20 6669 6c65  &individual file
-00039150: 7322 290d 0a20 2020 2020 2020 206d 656e  s")..        men
-00039160: 755f 6461 7465 2e41 7070 656e 6428 6974  u_date.Append(it
-00039170: 656d 5f61 6c6c 5f64 6174 655f 6d75 6c74  em_all_date_mult
-00039180: 6929 0d0a 2020 2020 2020 2020 7365 6c66  i)..        self
-00039190: 2e42 696e 6428 7778 2e45 5654 5f4d 454e  .Bind(wx.EVT_MEN
-000391a0: 552c 2068 616e 646c 6572 2864 6f5f 616c  U, handler(do_al
-000391b0: 6c3d 5472 7565 2c20 646f 5f74 696d 6572  l=True, do_timer
-000391c0: 616e 6765 3d54 7275 6529 2c20 6974 656d  ange=True), item
-000391d0: 5f61 6c6c 5f64 6174 655f 6d75 6c74 6929  _all_date_multi)
-000391e0: 0d0a 2020 2020 2020 2020 6966 2065 7870  ..        if exp
-000391f0: 6f72 742e 786c 7378 7772 6974 6572 3a0d  ort.xlsxwriter:.
-00039200: 0a20 2020 2020 2020 2020 2020 2069 7465  .            ite
-00039210: 6d5f 616c 6c5f 6461 7465 5f73 696e 676c  m_all_date_singl
-00039220: 6520 3d20 7778 2e4d 656e 7549 7465 6d28  e = wx.MenuItem(
-00039230: 6d65 6e75 5f61 6c6c 2c20 7778 2e49 445f  menu_all, wx.ID_
-00039240: 414e 592c 0d0a 2020 2020 2020 2020 2020  ANY,..          
-00039250: 2020 2020 2020 2243 6861 7473 206f 6620        "Chats of 
-00039260: 2661 6c6c 2063 6f6e 7461 6374 7320 696e  &all contacts in
-00039270: 746f 2061 2073 696e 676c 6520 4578 6365  to a single Exce
-00039280: 6c20 776f 726b 626f 6f6b 2c20 7769 7468  l workbook, with
-00039290: 2073 6570 6172 6174 6520 7368 6565 7473   separate sheets
-000392a0: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
-000392b0: 6d65 6e75 5f64 6174 652e 4170 7065 6e64  menu_date.Append
-000392c0: 2869 7465 6d5f 616c 6c5f 6461 7465 5f73  (item_all_date_s
-000392d0: 696e 676c 6529 0d0a 2020 2020 2020 2020  ingle)..        
-000392e0: 2020 2020 6d79 6861 6e64 6c65 7220 3d20      myhandler = 
-000392f0: 6861 6e64 6c65 7228 646f 5f61 6c6c 3d54  handler(do_all=T
-00039300: 7275 652c 2064 6f5f 7369 6e67 6c65 6669  rue, do_singlefi
-00039310: 6c65 3d54 7275 652c 2064 6f5f 7469 6d65  le=True, do_time
-00039320: 7261 6e67 653d 5472 7565 290d 0a20 2020  range=True)..   
-00039330: 2020 2020 2020 2020 2073 656c 662e 4269           self.Bi
-00039340: 6e64 2877 782e 4556 545f 4d45 4e55 2c20  nd(wx.EVT_MENU, 
-00039350: 6d79 6861 6e64 6c65 722c 2069 7465 6d5f  myhandler, item_
-00039360: 616c 6c5f 6461 7465 5f73 696e 676c 6529  all_date_single)
-00039370: 0d0a 0d0a 2020 2020 2020 2020 6974 656d  ....        item
-00039380: 5f73 656c 2020 3d20 6d65 6e75 2e41 7070  _sel  = menu.App
-00039390: 656e 6453 7562 4d65 6e75 286d 656e 755f  endSubMenu(menu_
-000393a0: 7365 6c2c 2020 2245 7870 6f72 7420 6368  sel,  "Export ch
-000393b0: 6174 7320 6f66 2026 7365 6c65 6374 6564  ats of &selected
-000393c0: 2063 6f6e 7461 6374 7322 290d 0a20 2020   contacts")..   
-000393d0: 2020 2020 2069 7465 6d5f 616c 6c20 203d       item_all  =
-000393e0: 206d 656e 752e 4170 7065 6e64 5375 624d   menu.AppendSubM
-000393f0: 656e 7528 6d65 6e75 5f61 6c6c 2c20 2022  enu(menu_all,  "
-00039400: 4578 706f 7274 2063 6861 7473 206f 6620  Export chats of 
-00039410: 2661 6c6c 2063 6f6e 7461 6374 7322 290d  &all contacts").
-00039420: 0a20 2020 2020 2020 2069 7465 6d5f 6461  .        item_da
-00039430: 7465 203d 206d 656e 752e 4170 7065 6e64  te = menu.Append
-00039440: 5375 624d 656e 7528 6d65 6e75 5f64 6174  SubMenu(menu_dat
-00039450: 652c 2022 4578 706f 7274 2063 6861 7473  e, "Export chats
-00039460: 2069 6e20 2664 6174 6520 7261 6e67 6522   in &date range"
-00039470: 290d 0a20 2020 2020 2020 2069 7465 6d5f  )..        item_
-00039480: 7365 6c2e 456e 6162 6c65 286c 656e 2873  sel.Enable(len(s
-00039490: 656c 6563 7465 6473 2929 0d0a 2020 2020  electeds))..    
-000394a0: 2020 2020 6974 656d 5f61 6c6c 2e45 6e61      item_all.Ena
-000394b0: 626c 6528 626f 6f6c 2873 656c 662e 6c69  ble(bool(self.li
-000394c0: 7374 5f63 6861 7473 2e47 6574 4974 656d  st_chats.GetItem
-000394d0: 436f 756e 7428 2929 290d 0a20 2020 2020  Count()))..     
-000394e0: 2020 2069 7465 6d5f 6461 7465 2e45 6e61     item_date.Ena
-000394f0: 626c 6528 626f 6f6c 2873 656c 662e 6c69  ble(bool(self.li
-00039500: 7374 5f63 6861 7473 2e47 6574 4974 656d  st_chats.GetItem
-00039510: 436f 756e 7428 2929 290d 0a0d 0a20 2020  Count()))....   
-00039520: 2020 2020 2065 7665 6e74 2e45 7665 6e74       event.Event
-00039530: 4f62 6a65 6374 2e50 6f70 7570 4d65 6e75  Object.PopupMenu
-00039540: 286d 656e 752c 2028 302c 2065 7665 6e74  (menu, (0, event
-00039550: 2e45 7665 6e74 4f62 6a65 6374 2e53 697a  .EventObject.Siz
-00039560: 655b 315d 2929 0d0a 0d0a 0d0a 2020 2020  e[1]))......    
-00039570: 6465 6620 6f6e 5f65 7870 6f72 745f 636f  def on_export_co
-00039580: 6e74 6163 745f 6368 6174 735f 6d65 6e75  ntact_chats_menu
-00039590: 2873 656c 662c 2065 7665 6e74 293a 0d0a  (self, event):..
-000395a0: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
-000395b0: 2020 2020 2048 616e 646c 6572 2066 6f72       Handler for
-000395c0: 2063 6c69 636b 696e 6720 746f 2065 7870   clicking to exp
-000395d0: 6f72 7420 636f 6e74 6163 7420 6368 6174  ort contact chat
-000395e0: 732c 2064 6973 706c 6179 7320 7375 626d  s, displays subm
-000395f0: 656e 7520 7769 7468 2063 686f 6963 6573  enu with choices
-00039600: 2e0d 0a20 2020 2020 2020 2022 2222 0d0a  ...        """..
-00039610: 2020 2020 2020 2020 6465 6620 6861 6e64          def hand
-00039620: 6c65 7228 646f 5f73 696e 676c 6566 696c  ler(do_singlefil
-00039630: 653d 4661 6c73 652c 2064 6f5f 7469 6d65  e=False, do_time
-00039640: 7261 6e67 653d 4661 6c73 6529 3a0d 0a20  range=False):.. 
-00039650: 2020 2020 2020 2020 2020 2063 6861 746d             chatm
-00039660: 6170 203d 207b 785b 2269 6422 5d3a 2078  ap = {x["id"]: x
-00039670: 2066 6f72 2078 2069 6e20 7365 6c66 2e63   for x in self.c
-00039680: 6861 7473 7d0d 0a20 2020 2020 2020 2020  hats}..         
-00039690: 2020 2063 6861 7473 203d 205b 6368 6174     chats = [chat
-000396a0: 6d61 705b 785b 2269 6422 5d5d 2066 6f72  map[x["id"]] for
-000396b0: 2078 2069 6e20 7365 6c66 2e63 6f6e 7461   x in self.conta
-000396c0: 6374 2e67 6574 2822 636f 6e76 6572 7361  ct.get("conversa
-000396d0: 7469 6f6e 7322 2920 6f72 205b 5d5d 0d0a  tions") or []]..
-000396e0: 2020 2020 2020 2020 2020 2020 6966 2064              if d
-000396f0: 6f5f 7369 6e67 6c65 6669 6c65 3a0d 0a20  o_singlefile:.. 
-00039700: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00039710: 6f5f 7369 6e67 6c65 6669 6c65 203d 2022  o_singlefile = "
-00039720: 4368 6174 7320 7769 7468 2025 7322 2025  Chats with %s" %
-00039730: 2028 7365 6c66 2e63 6f6e 7461 6374 5b22   (self.contact["
-00039740: 6e61 6d65 225d 206f 7220 7365 6c66 2e63  name"] or self.c
-00039750: 6f6e 7461 6374 5b22 6964 656e 7469 7479  ontact["identity
-00039760: 225d 290d 0a20 2020 2020 2020 2020 2020  "])..           
-00039770: 2072 6574 7572 6e20 6675 6e63 746f 6f6c   return functool
-00039780: 732e 7061 7274 6961 6c28 7365 6c66 2e6f  s.partial(self.o
-00039790: 6e5f 6578 706f 7274 5f63 6861 7473 2c0d  n_export_chats,.
-000397a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000397b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000397c0: 2020 2020 2020 6368 6174 732c 2046 616c        chats, Fal
-000397d0: 7365 2c20 646f 5f73 696e 676c 6566 696c  se, do_singlefil
-000397e0: 652c 2064 6f5f 7469 6d65 7261 6e67 6529  e, do_timerange)
-000397f0: 0d0a 0d0a 2020 2020 2020 2020 6d65 6e75  ....        menu
-00039800: 2c20 786d 656e 7520 3d20 7778 2e4d 656e  , xmenu = wx.Men
-00039810: 7528 292c 204e 6f6e 650d 0a20 2020 2020  u(), None..     
-00039820: 2020 2069 7465 6d5f 6669 6c65 7320 3d20     item_files = 
-00039830: 7778 2e4d 656e 7549 7465 6d28 6d65 6e75  wx.MenuItem(menu
-00039840: 2c20 7778 2e49 445f 414e 592c 2022 546f  , wx.ID_ANY, "To
-00039850: 2069 6e64 6976 6964 7561 6c20 2666 696c   individual &fil
-00039860: 6573 2229 0d0a 2020 2020 2020 2020 6974  es")..        it
-00039870: 656d 5f64 6174 6573 203d 2077 782e 4d65  em_dates = wx.Me
-00039880: 6e75 4974 656d 286d 656e 752c 2077 782e  nuItem(menu, wx.
-00039890: 4944 5f41 4e59 2c20 2226 4461 7465 2072  ID_ANY, "&Date r
-000398a0: 616e 6765 2074 6f20 696e 6469 7669 6475  ange to individu
-000398b0: 616c 2066 696c 6573 2229 0d0a 2020 2020  al files")..    
-000398c0: 2020 2020 6d65 6e75 2e41 7070 656e 6428      menu.Append(
-000398d0: 6974 656d 5f66 696c 6573 290d 0a20 2020  item_files)..   
-000398e0: 2020 2020 206d 656e 752e 4170 7065 6e64       menu.Append
-000398f0: 2869 7465 6d5f 6461 7465 7329 0d0a 2020  (item_dates)..  
-00039900: 2020 2020 2020 6966 2065 7870 6f72 742e        if export.
-00039910: 786c 7378 7772 6974 6572 3a0d 0a20 2020  xlsxwriter:..   
-00039920: 2020 2020 2020 2020 2078 6d65 6e75 203d           xmenu =
-00039930: 2077 782e 4d65 6e75 2829 0d0a 2020 2020   wx.Menu()..    
-00039940: 2020 2020 2020 2020 6974 656d 5f66 696c          item_fil
-00039950: 6520 3d20 7778 2e4d 656e 7549 7465 6d28  e = wx.MenuItem(
-00039960: 6d65 6e75 2c20 7778 2e49 445f 414e 592c  menu, wx.ID_ANY,
-00039970: 2022 4368 6174 7320 6f6e 2026 7365 7061   "Chats on &sepa
-00039980: 7261 7465 2073 6865 6574 7322 290d 0a20  rate sheets").. 
-00039990: 2020 2020 2020 2020 2020 2069 7465 6d5f             item_
-000399a0: 6461 7465 203d 2077 782e 4d65 6e75 4974  date = wx.MenuIt
-000399b0: 656d 286d 656e 752c 2077 782e 4944 5f41  em(menu, wx.ID_A
-000399c0: 4e59 2c20 2243 6861 7473 2069 6e20 2664  NY, "Chats in &d
-000399d0: 6174 6520 7261 6e67 6520 6f6e 2073 6570  ate range on sep
-000399e0: 6172 6174 6520 7368 6565 7473 2229 0d0a  arate sheets")..
-000399f0: 2020 2020 2020 2020 2020 2020 786d 656e              xmen
-00039a00: 752e 4170 7065 6e64 2869 7465 6d5f 6669  u.Append(item_fi
-00039a10: 6c65 290d 0a20 2020 2020 2020 2020 2020  le)..           
-00039a20: 2078 6d65 6e75 2e41 7070 656e 6428 6974   xmenu.Append(it
-00039a30: 656d 5f64 6174 6529 0d0a 2020 2020 2020  em_date)..      
-00039a40: 2020 2020 2020 7365 6c66 2e42 696e 6428        self.Bind(
-00039a50: 7778 2e45 5654 5f4d 454e 552c 2068 616e  wx.EVT_MENU, han
-00039a60: 646c 6572 2864 6f5f 7369 6e67 6c65 6669  dler(do_singlefi
-00039a70: 6c65 3d54 7275 6529 2c20 6974 656d 5f66  le=True), item_f
-00039a80: 696c 6529 0d0a 2020 2020 2020 2020 2020  ile)..          
-00039a90: 2020 7365 6c66 2e42 696e 6428 7778 2e45    self.Bind(wx.E
-00039aa0: 5654 5f4d 454e 552c 2068 616e 646c 6572  VT_MENU, handler
-00039ab0: 2864 6f5f 7369 6e67 6c65 6669 6c65 3d54  (do_singlefile=T
-00039ac0: 7275 652c 2064 6f5f 7469 6d65 7261 6e67  rue, do_timerang
-00039ad0: 653d 5472 7565 292c 2069 7465 6d5f 6461  e=True), item_da
-00039ae0: 7465 290d 0a20 2020 2020 2020 2020 2020  te)..           
-00039af0: 206d 656e 752e 4170 7065 6e64 5375 624d   menu.AppendSubM
-00039b00: 656e 7528 786d 656e 752c 2022 546f 2061  enu(xmenu, "To a
-00039b10: 2073 696e 676c 6520 4578 6365 6c20 2677   single Excel &w
-00039b20: 6f72 6b62 6f6f 6b22 290d 0a20 2020 2020  orkbook")..     
-00039b30: 2020 2073 656c 662e 4269 6e64 2877 782e     self.Bind(wx.
-00039b40: 4556 545f 4d45 4e55 2c20 6861 6e64 6c65  EVT_MENU, handle
-00039b50: 7228 292c 2069 7465 6d5f 6669 6c65 7329  r(), item_files)
-00039b60: 0d0a 2020 2020 2020 2020 7365 6c66 2e42  ..        self.B
-00039b70: 696e 6428 7778 2e45 5654 5f4d 454e 552c  ind(wx.EVT_MENU,
-00039b80: 2068 616e 646c 6572 2864 6f5f 7469 6d65   handler(do_time
-00039b90: 7261 6e67 653d 5472 7565 292c 2069 7465  range=True), ite
-00039ba0: 6d5f 6461 7465 7329 0d0a 0d0a 2020 2020  m_dates)....    
-00039bb0: 2020 2020 6576 656e 742e 4576 656e 744f      event.EventO
-00039bc0: 626a 6563 742e 506f 7075 704d 656e 7528  bject.PopupMenu(
-00039bd0: 6d65 6e75 2c20 2830 2c20 6576 656e 742e  menu, (0, event.
-00039be0: 4576 656e 744f 626a 6563 742e 5369 7a65  EventObject.Size
-00039bf0: 5b31 5d29 290d 0a0d 0a0d 0a20 2020 2064  [1]))......    d
-00039c00: 6566 206f 6e5f 6578 706f 7274 5f63 6f6e  ef on_export_con
-00039c10: 7461 6374 7328 7365 6c66 2c20 6576 656e  tacts(self, even
-00039c20: 7429 3a0d 0a20 2020 2020 2020 2022 2222  t):..        """
-00039c30: 0d0a 2020 2020 2020 2020 4861 6e64 6c65  ..        Handle
-00039c40: 7220 666f 7220 636c 6963 6b69 6e67 2074  r for clicking t
-00039c50: 6f20 6578 706f 7274 2063 6f6e 7461 6374  o export contact
-00039c60: 732c 2064 6973 706c 6179 2066 696c 6520  s, display file 
-00039c70: 6469 616c 6f67 2061 6e64 2073 6176 6573  dialog and saves
-00039c80: 2073 7072 6561 6473 6865 6574 2e0d 0a20   spreadsheet... 
-00039c90: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
-00039ca0: 2020 2020 636f 6e74 6163 7473 203d 205b      contacts = [
-00039cb0: 7365 6c66 2e6c 6973 745f 636f 6e74 6163  self.list_contac
-00039cc0: 7473 2e47 6574 4974 656d 4d61 7070 6564  ts.GetItemMapped
-00039cd0: 4461 7461 2878 290d 0a20 2020 2020 2020  Data(x)..       
-00039ce0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-00039cf0: 2078 2069 6e20 7261 6e67 6528 7365 6c66   x in range(self
-00039d00: 2e6c 6973 745f 636f 6e74 6163 7473 2e49  .list_contacts.I
-00039d10: 7465 6d43 6f75 6e74 295d 0d0a 2020 2020  temCount)]..    
-00039d20: 2020 2020 6966 206e 6f74 2063 6f6e 7461      if not conta
-00039d30: 6374 733a 2072 6574 7572 6e0d 0a0d 0a20  cts: return.... 
-00039d40: 2020 2020 2020 2066 6f72 6d61 7461 7267         formatarg
-00039d50: 7320 3d20 636f 6c6c 6563 7469 6f6e 732e  s = collections.
-00039d60: 6465 6661 756c 7464 6963 7428 7374 7229  defaultdict(str)
-00039d70: 0d0a 2020 2020 2020 2020 666f 726d 6174  ..        format
-00039d80: 6172 6773 5b22 736b 7970 656e 616d 6522  args["skypename"
-00039d90: 5d20 3d20 6f73 2e70 6174 682e 6261 7365  ] = os.path.base
-00039da0: 6e61 6d65 2873 656c 662e 6462 2e66 696c  name(self.db.fil
-00039db0: 656e 616d 6529 0d0a 2020 2020 2020 2020  ename)..        
-00039dc0: 666f 726d 6174 6172 6773 2e75 7064 6174  formatargs.updat
-00039dd0: 6528 7365 6c66 2e64 622e 6163 636f 756e  e(self.db.accoun
-00039de0: 7420 6f72 207b 7d29 0d0a 2020 2020 2020  t or {})..      
-00039df0: 2020 6e61 6d65 203d 2075 7469 6c2e 7361    name = util.sa
-00039e00: 6665 5f66 696c 656e 616d 6528 636f 6e66  fe_filename(conf
-00039e10: 2e45 7870 6f72 7443 6f6e 7461 6374 7354  .ExportContactsT
-00039e20: 656d 706c 6174 6520 2520 666f 726d 6174  emplate % format
-00039e30: 6172 6773 290d 0a20 2020 2020 2020 2073  args)..        s
-00039e40: 656c 662e 6469 616c 6f67 5f73 6176 6563  elf.dialog_savec
-00039e50: 6f6e 7461 6374 732e 4669 6c65 6e61 6d65  ontacts.Filename
-00039e60: 203d 206e 616d 650d 0a20 2020 2020 2020   = name..       
-00039e70: 2069 6620 7778 2e49 445f 4f4b 2021 3d20   if wx.ID_OK != 
-00039e80: 7365 6c66 2e64 6961 6c6f 675f 7361 7665  self.dialog_save
-00039e90: 636f 6e74 6163 7473 2e53 686f 774d 6f64  contacts.ShowMod
-00039ea0: 616c 2829 3a20 7265 7475 726e 0d0a 0d0a  al(): return....
-00039eb0: 2020 2020 2020 2020 6275 7379 203d 2063          busy = c
-00039ec0: 6f6e 7472 6f6c 732e 4275 7379 5061 6e65  ontrols.BusyPane
-00039ed0: 6c28 7365 6c66 2c20 2245 7870 6f72 7469  l(self, "Exporti
-00039ee0: 6e67 2063 6f6e 7461 6374 732e 2229 0d0a  ng contacts.")..
-00039ef0: 2020 2020 2020 2020 6669 6c65 7061 7468          filepath
-00039f00: 203d 2063 6f6e 7472 6f6c 732e 6765 745f   = controls.get_
-00039f10: 6469 616c 6f67 5f70 6174 6828 7365 6c66  dialog_path(self
-00039f20: 2e64 6961 6c6f 675f 7361 7665 636f 6e74  .dialog_savecont
-00039f30: 6163 7473 290d 0a20 2020 2020 2020 2066  acts)..        f
-00039f40: 6f72 6d61 7420 3d20 6578 706f 7274 2e43  ormat = export.C
-00039f50: 4f4e 5441 4354 5f45 5854 535b 7365 6c66  ONTACT_EXTS[self
-00039f60: 2e64 6961 6c6f 675f 7361 7665 636f 6e74  .dialog_savecont
-00039f70: 6163 7473 2e46 696c 7465 7249 6e64 6578  acts.FilterIndex
-00039f80: 5d0d 0a20 2020 2020 2020 2067 7569 6261  ]..        guiba
-00039f90: 7365 2e73 7461 7475 7328 2245 7870 6f72  se.status("Expor
-00039fa0: 7469 6e67 2025 732e 222c 2066 696c 6570  ting %s.", filep
-00039fb0: 6174 682c 206c 6f67 3d54 7275 6529 0d0a  ath, log=True)..
-00039fc0: 2020 2020 2020 2020 7472 793a 0d0a 2020          try:..  
-00039fd0: 2020 2020 2020 2020 2020 6578 706f 7274            export
-00039fe0: 2e65 7870 6f72 745f 636f 6e74 6163 7473  .export_contacts
-00039ff0: 2863 6f6e 7461 6374 732c 2066 696c 6570  (contacts, filep
-0003a000: 6174 682c 2066 6f72 6d61 742c 2073 656c  ath, format, sel
-0003a010: 662e 6462 290d 0a20 2020 2020 2020 2020  f.db)..         
-0003a020: 2020 2069 6620 636f 6e66 2e45 7870 6f72     if conf.Expor
-0003a030: 7446 696c 6541 7574 6f4f 7065 6e3a 2075  tFileAutoOpen: u
-0003a040: 7469 6c2e 7374 6172 745f 6669 6c65 2866  til.start_file(f
-0003a050: 696c 6570 6174 6829 0d0a 2020 2020 2020  ilepath)..      
-0003a060: 2020 6669 6e61 6c6c 793a 0d0a 2020 2020    finally:..    
-0003a070: 2020 2020 2020 2020 6275 7379 2e43 6c6f          busy.Clo
-0003a080: 7365 2829 0d0a 0d0a 0d0a 2020 2020 6465  se()......    de
-0003a090: 6620 6f6e 5f65 7870 6f72 745f 6368 6174  f on_export_chat
-0003a0a0: 7328 7365 6c66 2c20 6368 6174 732c 2064  s(self, chats, d
-0003a0b0: 6f5f 616c 6c3d 4661 6c73 652c 2064 6f5f  o_all=False, do_
-0003a0c0: 7369 6e67 6c65 6669 6c65 3d46 616c 7365  singlefile=False
-0003a0d0: 2c20 646f 5f74 696d 6572 616e 6765 3d46  , do_timerange=F
-0003a0e0: 616c 7365 2c20 6576 656e 743d 4e6f 6e65  alse, event=None
-0003a0f0: 293a 0d0a 2020 2020 2020 2020 2222 220d  ):..        """.
-0003a100: 0a20 2020 2020 2020 2048 616e 646c 6572  .        Handler
-0003a110: 2066 6f72 2063 6c69 636b 696e 6720 746f   for clicking to
-0003a120: 2065 7870 6f72 7420 7365 6c65 6374 6564   export selected
-0003a130: 206f 7220 616c 6c20 6368 6174 732c 2064   or all chats, d
-0003a140: 6973 706c 6179 7320 6120 7365 6c65 6374  isplays a select
-0003a150: 0d0a 2020 2020 2020 2020 666f 6c64 6572  ..        folder
-0003a160: 2064 6961 6c6f 6720 616e 6420 6578 706f   dialog and expo
-0003a170: 7274 7320 6368 6174 7320 746f 2069 6e64  rts chats to ind
-0003a180: 6976 6964 7561 6c20 6669 6c65 7320 756e  ividual files un
-0003a190: 6465 7220 7468 6520 666f 6c64 6572 2e0d  der the folder..
-0003a1a0: 0a0d 0a20 2020 2020 2020 2040 7061 7261  ...        @para
-0003a1b0: 6d20 2020 6368 6174 7320 2020 2020 2020  m   chats       
-0003a1c0: 2020 206c 6973 7420 6f66 2063 6f6e 7665     list of conve
-0003a1d0: 7273 6174 696f 6e73 2074 6f20 6578 706f  rsations to expo
-0003a1e0: 7274 0d0a 2020 2020 2020 2020 4070 6172  rt..        @par
-0003a1f0: 616d 2020 2064 6f5f 616c 6c20 2020 2020  am   do_all     
-0003a200: 2020 2020 7768 6574 6865 7220 746f 2065      whether to e
-0003a210: 7870 6f72 7420 616c 6c20 6368 6174 732c  xport all chats,
-0003a220: 2065 7665 6e20 7468 6f73 6520 7769 7468   even those with
-0003a230: 206e 6f20 6d65 7373 6167 6573 0d0a 2020   no messages..  
-0003a240: 2020 2020 2020 4070 6172 616d 2020 2064        @param   d
-0003a250: 6f5f 7369 6e67 6c65 6669 6c65 2020 7768  o_singlefile  wh
-0003a260: 6574 6865 7220 746f 2065 7870 6f72 7420  ether to export 
-0003a270: 6120 7369 6e67 6c65 2d66 696c 6520 584c  a single-file XL
-0003a280: 5358 2c0d 0a20 2020 2020 2020 2020 2020  SX,..           
-0003a290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a2a0: 2020 2020 206f 7074 696f 6e61 6c6c 7920       optionally 
-0003a2b0: 636f 6e74 6169 6e69 6e67 2074 6865 2066  containing the f
-0003a2c0: 696c 6520 6e61 6d65 0d0a 2020 2020 2020  ile name..      
-0003a2d0: 2020 4070 6172 616d 2020 2064 6f5f 7469    @param   do_ti
-0003a2e0: 6d65 7261 6e67 6520 2020 7768 6574 6865  merange   whethe
-0003a2f0: 7220 746f 2070 6f70 2075 7020 6469 616c  r to pop up dial
-0003a300: 6f67 7320 746f 2073 656c 6563 7420 6578  ogs to select ex
-0003a310: 706f 7274 2064 6174 6520 7261 6e67 650d  port date range.
-0003a320: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
-0003a330: 2020 2020 2020 6966 206e 6f74 2063 6861        if not cha
-0003a340: 7473 3a20 7265 7475 726e 0d0a 0d0a 2020  ts: return....  
-0003a350: 2020 2020 2020 7469 6d65 7261 6e67 6520        timerange 
-0003a360: 3d20 4e6f 6e65 0d0a 2020 2020 2020 2020  = None..        
-0003a370: 6966 2064 6f5f 7469 6d65 7261 6e67 653a  if do_timerange:
-0003a380: 0d0a 2020 2020 2020 2020 2020 2020 7469  ..            ti
-0003a390: 6d65 7261 6e67 6520 3d20 5b5d 0d0a 2020  merange = []..  
-0003a3a0: 2020 2020 2020 2020 2020 666f 7220 6c61            for la
-0003a3b0: 6265 6c20 696e 2028 2273 7461 7274 222c  bel in ("start",
-0003a3c0: 2022 656e 6422 293a 0d0a 2020 2020 2020   "end"):..      
-0003a3d0: 2020 2020 2020 2020 2020 6578 7472 6120            extra 
-0003a3e0: 3d20 2265 6e64 2061 7420 6c61 7374 2220  = "end at last" 
-0003a3f0: 6966 2022 656e 6422 203d 3d20 6c61 6265  if "end" == labe
-0003a400: 6c20 656c 7365 2022 7374 6172 7420 6672  l else "start fr
-0003a410: 6f6d 2066 6972 7374 220d 0a20 2020 2020  om first"..     
-0003a420: 2020 2020 2020 2020 2020 2064 6961 6c6f             dialo
-0003a430: 6720 3d20 7778 2e54 6578 7445 6e74 7279  g = wx.TextEntry
-0003a440: 4469 616c 6f67 2873 656c 662c 0d0a 2020  Dialog(self,..  
-0003a450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a460: 2020 2245 6e74 6572 2025 7320 6461 7465    "Enter %s date
-0003a470: 2061 7320 5959 5959 2d4d 4d2d 4444 2c20   as YYYY-MM-DD, 
-0003a480: 6f72 206c 6561 7665 2062 6c61 6e6b 2074  or leave blank t
-0003a490: 6f20 2573 3a22 2025 2028 6c61 6265 6c2c  o %s:" % (label,
-0003a4a0: 2065 7874 7261 292c 0d0a 2020 2020 2020   extra),..      
-0003a4b0: 2020 2020 2020 2020 2020 2020 2020 2244                "D
-0003a4c0: 6174 6520 7261 6e67 6522 2c20 7374 796c  ate range", styl
-0003a4d0: 653d 7778 2e4f 4b20 7c20 7778 2e43 414e  e=wx.OK | wx.CAN
-0003a4e0: 4345 4c29 0d0a 2020 2020 2020 2020 2020  CEL)..          
-0003a4f0: 2020 2020 2020 6469 616c 6f67 2e43 656e        dialog.Cen
-0003a500: 7465 724f 6e50 6172 656e 7428 290d 0a20  terOnParent().. 
-0003a510: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0003a520: 6620 7778 2e49 445f 4f4b 2021 3d20 6469  f wx.ID_OK != di
-0003a530: 616c 6f67 2e53 686f 774d 6f64 616c 2829  alog.ShowModal()
-0003a540: 3a20 7265 7475 726e 0d0a 0d0a 2020 2020  : return....    
-0003a550: 2020 2020 2020 2020 2020 2020 762c 2064              v, d
-0003a560: 7420 3d20 6469 616c 6f67 2e47 6574 5661  t = dialog.GetVa
-0003a570: 6c75 6528 292e 7374 7269 7028 292c 204e  lue().strip(), N
-0003a580: 6f6e 650d 0a20 2020 2020 2020 2020 2020  one..           
-0003a590: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
-0003a5a0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0003a5b0: 6620 763a 2064 7420 3d20 6461 7465 7469  f v: dt = dateti
-0003a5c0: 6d65 2e64 6174 6574 696d 652e 7374 7270  me.datetime.strp
-0003a5d0: 7469 6d65 2876 2c20 2225 592d 256d 2d25  time(v, "%Y-%m-%
-0003a5e0: 6422 292e 6461 7465 2829 0d0a 2020 2020  d").date()..    
-0003a5f0: 2020 2020 2020 2020 2020 2020 6578 6365              exce
-0003a600: 7074 2045 7863 6570 7469 6f6e 3a0d 0a20  pt Exception:.. 
-0003a610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a620: 2020 2072 6574 7572 6e20 7778 2e4d 6573     return wx.Mes
-0003a630: 7361 6765 426f 7828 2249 6e76 616c 6964  sageBox("Invalid
-0003a640: 2064 6174 6520 7661 6c75 653a 2027 2573   date value: '%s
-0003a650: 272e 2220 2520 762c 0d0a 2020 2020 2020  '." % v,..      
-0003a660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a680: 2020 2063 6f6e 662e 5469 746c 652c 2077     conf.Title, w
-0003a690: 782e 4f4b 207c 2077 782e 4943 4f4e 5f57  x.OK | wx.ICON_W
-0003a6a0: 4152 4e49 4e47 290d 0a20 2020 2020 2020  ARNING)..       
-0003a6b0: 2020 2020 2020 2020 2074 696d 6572 616e           timeran
-0003a6c0: 6765 2e61 7070 656e 6428 7574 696c 2e64  ge.append(util.d
-0003a6d0: 6174 6574 696d 655f 746f 5f65 706f 6368  atetime_to_epoch
-0003a6e0: 2864 7429 290d 0a0d 0a20 2020 2020 2020  (dt))....       
-0003a6f0: 2064 6961 6c6f 6720 3d20 7365 6c66 2e64   dialog = self.d
-0003a700: 6961 6c6f 675f 7361 7665 6368 6174 735f  ialog_savechats_
-0003a710: 7369 6e67 6c65 6669 6c65 2069 6620 646f  singlefile if do
-0003a720: 5f73 696e 676c 6566 696c 6520 656c 7365  _singlefile else
-0003a730: 205c 0d0a 2020 2020 2020 2020 2020 2020   \..            
-0003a740: 2020 2020 2073 656c 662e 6469 616c 6f67       self.dialog
-0003a750: 5f73 6176 6563 6861 7420 6966 206c 656e  _savechat if len
-0003a760: 2863 6861 7473 2920 3d3d 2031 2065 6c73  (chats) == 1 els
-0003a770: 6520 7365 6c66 2e64 6961 6c6f 675f 7361  e self.dialog_sa
-0003a780: 7665 6368 6174 730d 0a0d 0a20 2020 2020  vechats....     
-0003a790: 2020 2069 6620 646f 5f73 696e 676c 6566     if do_singlef
-0003a7a0: 696c 653a 0d0a 2020 2020 2020 2020 2020  ile:..          
-0003a7b0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-0003a7c0: 646f 5f73 696e 676c 6566 696c 652c 2073  do_singlefile, s
-0003a7d0: 6978 2e73 7472 696e 675f 7479 7065 7329  ix.string_types)
-0003a7e0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0003a7f0: 2020 2064 6566 6175 6c74 203d 2064 6f5f     default = do_
-0003a800: 7369 6e67 6c65 6669 6c65 0d0a 2020 2020  singlefile..    
-0003a810: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-0003a820: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0003a830: 6f72 6d61 7461 7267 7320 3d20 636f 6c6c  ormatargs = coll
-0003a840: 6563 7469 6f6e 732e 6465 6661 756c 7464  ections.defaultd
-0003a850: 6963 7428 7374 7229 0d0a 2020 2020 2020  ict(str)..      
-0003a860: 2020 2020 2020 2020 2020 666f 726d 6174            format
-0003a870: 6172 6773 5b22 736b 7970 656e 616d 6522  args["skypename"
-0003a880: 5d20 3d20 6f73 2e70 6174 682e 6261 7365  ] = os.path.base
-0003a890: 6e61 6d65 2873 656c 662e 6462 2e66 696c  name(self.db.fil
-0003a8a0: 656e 616d 6529 0d0a 2020 2020 2020 2020  ename)..        
-0003a8b0: 2020 2020 2020 2020 666f 726d 6174 6172          formatar
-0003a8c0: 6773 2e75 7064 6174 6528 7365 6c66 2e64  gs.update(self.d
-0003a8d0: 622e 6163 636f 756e 7420 6f72 207b 7d29  b.account or {})
-0003a8e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0003a8f0: 2020 6465 6661 756c 7420 3d20 636f 6e66    default = conf
-0003a900: 2e45 7870 6f72 7444 6254 656d 706c 6174  .ExportDbTemplat
-0003a910: 6520 2520 666f 726d 6174 6172 6773 0d0a  e % formatargs..
-0003a920: 2020 2020 2020 2020 2020 2020 6469 616c              dial
-0003a930: 6f67 2e46 696c 656e 616d 6520 3d20 7574  og.Filename = ut
-0003a940: 696c 2e73 6166 655f 6669 6c65 6e61 6d65  il.safe_filename
-0003a950: 2864 6566 6175 6c74 290d 0a20 2020 2020  (default)..     
-0003a960: 2020 2065 6c69 6620 6c65 6e28 6368 6174     elif len(chat
-0003a970: 7329 203d 3d20 313a 0d0a 2020 2020 2020  s) == 1:..      
-0003a980: 2020 2020 2020 666f 726d 6174 6172 6773        formatargs
-0003a990: 203d 2063 6f6c 6c65 6374 696f 6e73 2e64   = collections.d
-0003a9a0: 6566 6175 6c74 6469 6374 2873 7472 293b  efaultdict(str);
-0003a9b0: 2066 6f72 6d61 7461 7267 732e 7570 6461   formatargs.upda
-0003a9c0: 7465 2863 6861 7473 5b30 5d29 0d0a 2020  te(chats[0])..  
-0003a9d0: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
-0003a9e0: 7420 3d20 7574 696c 2e73 6166 655f 6669  t = util.safe_fi
-0003a9f0: 6c65 6e61 6d65 2863 6f6e 662e 4578 706f  lename(conf.Expo
-0003aa00: 7274 4368 6174 5465 6d70 6c61 7465 2025  rtChatTemplate %
-0003aa10: 2066 6f72 6d61 7461 7267 7329 0d0a 2020   formatargs)..  
-0003aa20: 2020 2020 2020 2020 2020 6469 616c 6f67            dialog
-0003aa30: 2e46 696c 656e 616d 6520 3d20 6465 6661  .Filename = defa
-0003aa40: 756c 740d 0a20 2020 2020 2020 2069 6620  ult..        if 
-0003aa50: 7778 2e49 445f 4f4b 2021 3d20 6469 616c  wx.ID_OK != dial
-0003aa60: 6f67 2e53 686f 774d 6f64 616c 2829 3a20  og.ShowModal(): 
-0003aa70: 7265 7475 726e 0d0a 0d0a 2020 2020 2020  return....      
-0003aa80: 2020 7061 7468 2c20 6d65 6469 615f 666f    path, media_fo
-0003aa90: 6c64 6572 203d 2063 6f6e 7472 6f6c 732e  lder = controls.
-0003aaa0: 6765 745f 6469 616c 6f67 5f70 6174 6828  get_dialog_path(
-0003aab0: 6469 616c 6f67 292c 2046 616c 7365 0d0a  dialog), False..
-0003aac0: 2020 2020 2020 2020 6966 2064 6f5f 7369          if do_si
-0003aad0: 6e67 6c65 6669 6c65 3a0d 0a20 2020 2020  nglefile:..     
-0003aae0: 2020 2020 2020 2066 6f72 6d61 7420 3d20         format = 
-0003aaf0: 6578 706f 7274 2e43 4841 545f 4558 5453  export.CHAT_EXTS
-0003ab00: 5f53 494e 474c 4546 494c 455b 6469 616c  _SINGLEFILE[dial
-0003ab10: 6f67 2e46 696c 7465 7249 6e64 6578 5d0d  og.FilterIndex].
-0003ab20: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
-0003ab30: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-0003ab40: 656e 2863 6861 7473 2920 3e20 313a 2070  en(chats) > 1: p
-0003ab50: 6174 6820 3d20 6f73 2e70 6174 682e 6469  ath = os.path.di
-0003ab60: 726e 616d 6528 7061 7468 290d 0a20 2020  rname(path)..   
-0003ab70: 2020 2020 2020 2020 2066 6f72 6d61 7420           format 
-0003ab80: 3d20 6578 706f 7274 2e43 4841 545f 4558  = export.CHAT_EX
-0003ab90: 5453 5b64 6961 6c6f 672e 4669 6c74 6572  TS[dialog.Filter
-0003aba0: 496e 6465 785d 0d0a 2020 2020 2020 2020  Index]..        
-0003abb0: 2020 2020 6d65 6469 615f 666f 6c64 6572      media_folder
-0003abc0: 203d 2022 6874 6d6c 2220 3d3d 2066 6f72   = "html" == for
-0003abd0: 6d61 7420 616e 6420 5c0d 0a20 2020 2020  mat and \..     
-0003abe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003abf0: 2020 2020 2020 6469 616c 6f67 2e46 696c        dialog.Fil
-0003ac00: 7465 7249 6e64 6578 2021 3d20 6578 706f  terIndex != expo
-0003ac10: 7274 2e43 4841 545f 4558 5453 2e69 6e64  rt.CHAT_EXTS.ind
-0003ac20: 6578 2822 6874 6d6c 2229 0d0a 0d0a 2020  ex("html")....  
-0003ac30: 2020 2020 2020 6966 206d 6564 6961 5f66        if media_f
-0003ac40: 6f6c 6465 7220 616e 6420 6e6f 7420 6368  older and not ch
-0003ac50: 6563 6b5f 6d65 6469 615f 6578 706f 7274  eck_media_export
-0003ac60: 5f6c 6f67 696e 2873 656c 662e 6462 293a  _login(self.db):
-0003ac70: 2072 6574 7572 6e0d 0a0d 0a20 2020 2020   return....     
-0003ac80: 2020 206d 7367 203d 2027 4578 706f 7274     msg = 'Export
-0003ac90: 696e 6720 746f 2025 732e 2720 2520 7061  ing to %s.' % pa
-0003aca0: 7468 2069 6620 6c65 6e28 6368 6174 7329  th if len(chats)
-0003acb0: 203d 3d20 3120 616e 6420 6e6f 7420 646f   == 1 and not do
-0003acc0: 5f73 696e 676c 6566 696c 6520 5c0d 0a20  _singlefile \.. 
-0003acd0: 2020 2020 2020 2065 6c73 6520 2027 4578         else  'Ex
-0003ace0: 706f 7274 696e 6720 2573 6368 6174 7320  porting %schats 
-0003acf0: 6672 6f6d 2022 2573 225c 6e61 7320 2573  from "%s"\nas %s
-0003ad00: 2075 6e64 6572 2025 732e 2720 2520 5c0d   under %s.' % \.
-0003ad10: 0a20 2020 2020 2020 2020 2020 2020 2028  .              (
-0003ad20: 2261 6c6c 2022 2069 6620 646f 5f61 6c6c  "all " if do_all
-0003ad30: 2065 6c73 6520 2222 2c20 7365 6c66 2e64   else "", self.d
-0003ad40: 622e 6669 6c65 6e61 6d65 2c20 666f 726d  b.filename, form
-0003ad50: 6174 2e75 7070 6572 2829 2c20 7061 7468  at.upper(), path
-0003ad60: 290d 0a20 2020 2020 2020 2062 7573 7920  )..        busy 
-0003ad70: 3d20 636f 6e74 726f 6c73 2e42 7573 7950  = controls.BusyP
-0003ad80: 616e 656c 2873 656c 662c 206d 7367 290d  anel(self, msg).
-0003ad90: 0a20 2020 2020 2020 2067 7569 6261 7365  .        guibase
-0003ada0: 2e73 7461 7475 7328 6d73 672c 206c 6f67  .status(msg, log
-0003adb0: 3d54 7275 6529 0d0a 2020 2020 2020 2020  =True)..        
-0003adc0: 6669 6c65 732c 2063 6f75 6e74 2c20 6d65  files, count, me
-0003add0: 7373 6167 655f 636f 756e 742c 2065 7272  ssage_count, err
-0003ade0: 6f72 6d73 672c 2065 7272 6f72 6d73 675f  ormsg, errormsg_
-0003adf0: 7368 6f72 7420 3d20 5b5d 2c20 302c 2030  short = [], 0, 0
-0003ae00: 2c20 4e6f 6e65 2c20 4e6f 6e65 0d0a 2020  , None, None..  
-0003ae10: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
-0003ae20: 2020 2020 2020 2020 7072 6f67 7265 7373          progress
-0003ae30: 6675 6e63 203d 206c 616d 6264 6120 2a61  func = lambda *a
-0003ae40: 7267 733a 2077 782e 5361 6665 5969 656c  rgs: wx.SafeYiel
-0003ae50: 6428 290d 0a20 2020 2020 2020 2020 2020  d()..           
-0003ae60: 206f 7074 7320 3d20 6469 6374 286d 756c   opts = dict(mul
-0003ae70: 7469 3d6e 6f74 2064 6f5f 7369 6e67 6c65  ti=not do_single
-0003ae80: 6669 6c65 2061 6e64 206c 656e 2863 6861  file and len(cha
-0003ae90: 7473 2920 3e20 312c 206e 6f73 6b69 703d  ts) > 1, noskip=
-0003aea0: 6e6f 7420 646f 5f61 6c6c 2c0d 0a20 2020  not do_all,..   
-0003aeb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003aec0: 2020 2020 2070 726f 6772 6573 733d 7072       progress=pr
-0003aed0: 6f67 7265 7373 6675 6e63 2c20 7469 6d65  ogressfunc, time
-0003aee0: 7261 6e67 653d 7469 6d65 7261 6e67 6529  range=timerange)
-0003aef0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-0003af00: 206d 6564 6961 5f66 6f6c 6465 723a 206f   media_folder: o
-0003af10: 7074 735b 226d 6564 6961 5f66 6f6c 6465  pts["media_folde
-0003af20: 7222 5d20 3d20 5472 7565 0d0a 2020 2020  r"] = True..    
-0003af30: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
-0003af40: 2065 7870 6f72 742e 6578 706f 7274 5f63   export.export_c
-0003af50: 6861 7473 2863 6861 7473 2c20 7061 7468  hats(chats, path
-0003af60: 2c20 666f 726d 6174 2c20 7365 6c66 2e64  , format, self.d
-0003af70: 622c 206f 7074 7329 0d0a 2020 2020 2020  b, opts)..      
-0003af80: 2020 2020 2020 6669 6c65 732c 2063 6f75        files, cou
-0003af90: 6e74 2c20 6d65 7373 6167 655f 636f 756e  nt, message_coun
-0003afa0: 7420 3d20 7265 7375 6c74 0d0a 2020 2020  t = result..    
-0003afb0: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
-0003afc0: 7469 6f6e 2061 7320 653a 0d0a 2020 2020  tion as e:..    
-0003afd0: 2020 2020 2020 2020 6572 726f 726d 7367          errormsg
-0003afe0: 5f73 686f 7274 203d 2022 4572 726f 7220  _short = "Error 
-0003aff0: 6578 706f 7274 696e 6720 6368 6174 733a  exporting chats:
-0003b000: 2025 7322 2025 2075 7469 6c2e 666f 726d   %s" % util.form
-0003b010: 6174 5f65 7863 2865 290d 0a20 2020 2020  at_exc(e)..     
-0003b020: 2020 2020 2020 2065 7272 6f72 6d73 6720         errormsg 
-0003b030: 3d20 2245 7272 6f72 2065 7870 6f72 7469  = "Error exporti
-0003b040: 6e67 2063 6861 7473 3a5c 6e5c 6e25 7322  ng chats:\n\n%s"
-0003b050: 2025 205c 0d0a 2020 2020 2020 2020 2020   % \..          
-0003b060: 2020 2020 2020 2020 2020 2020 2074 7261               tra
-0003b070: 6365 6261 636b 2e66 6f72 6d61 745f 6578  ceback.format_ex
-0003b080: 6328 290d 0a20 2020 2020 2020 2062 7573  c()..        bus
-0003b090: 792e 436c 6f73 6528 290d 0a20 2020 2020  y.Close()..     
-0003b0a0: 2020 2077 782e 4361 6c6c 4166 7465 7228     wx.CallAfter(
-0003b0b0: 7365 6c66 2e75 7064 6174 655f 6c69 7665  self.update_live
-0003b0c0: 696e 666f 290d 0a20 2020 2020 2020 2069  info)..        i
-0003b0d0: 6620 6e6f 7420 6572 726f 726d 7367 3a0d  f not errormsg:.
-0003b0e0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0003b0f0: 6c65 6e28 6368 6174 7329 203d 3d20 3120  len(chats) == 1 
-0003b100: 616e 6420 6e6f 7420 646f 5f73 696e 676c  and not do_singl
-0003b110: 6566 696c 653a 0d0a 2020 2020 2020 2020  efile:..        
-0003b120: 2020 2020 2020 2020 6775 6962 6173 652e          guibase.
-0003b130: 7374 6174 7573 2822 4578 706f 7274 6564  status("Exported
-0003b140: 2025 7320 746f 2025 732e 222c 0d0a 2020   %s to %s.",..  
-0003b150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b160: 2020 2020 2020 2020 2020 2020 2075 7469               uti
-0003b170: 6c2e 706c 7572 616c 2822 6d65 7373 6167  l.plural("messag
-0003b180: 6522 2c20 6d65 7373 6167 655f 636f 756e  e", message_coun
-0003b190: 742c 2073 6570 3d22 2c22 292c 0d0a 2020  t, sep=","),..  
-0003b1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b1b0: 2020 2020 2020 2020 2020 2020 2070 6174               pat
-0003b1c0: 682c 206c 6f67 3d54 7275 6529 0d0a 2020  h, log=True)..  
-0003b1d0: 2020 2020 2020 2020 2020 656c 7365 3a20            else: 
-0003b1e0: 6775 6962 6173 652e 7374 6174 7573 2822  guibase.status("
-0003b1f0: 4578 706f 7274 6564 2025 7320 616e 6420  Exported %s and 
-0003b200: 2573 2066 726f 6d20 2573 2061 7320 2573  %s from %s as %s
-0003b210: 2075 6e64 6572 2025 732e 222c 0d0a 2020   under %s.",..  
-0003b220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b230: 2020 2020 2020 2020 2020 2020 2020 2075                 u
-0003b240: 7469 6c2e 706c 7572 616c 2822 6368 6174  til.plural("chat
-0003b250: 222c 2063 6f75 6e74 2c20 7365 703d 222c  ", count, sep=",
-0003b260: 2229 2c0d 0a20 2020 2020 2020 2020 2020  "),..           
-0003b270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b280: 2020 2020 2020 7574 696c 2e70 6c75 7261        util.plura
-0003b290: 6c28 226d 6573 7361 6765 222c 206d 6573  l("message", mes
-0003b2a0: 7361 6765 5f63 6f75 6e74 2c20 7365 703d  sage_count, sep=
-0003b2b0: 222c 2229 2c20 7365 6c66 2e64 622c 0d0a  ","), self.db,..
-0003b2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b2e0: 2066 6f72 6d61 742e 7570 7065 7228 292c   format.upper(),
-0003b2f0: 2070 6174 682c 206c 6f67 3d54 7275 6529   path, log=True)
-0003b300: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-0003b310: 2063 6f6e 662e 4578 706f 7274 4669 6c65   conf.ExportFile
-0003b320: 4175 746f 4f70 656e 3a0d 0a20 2020 2020  AutoOpen:..     
-0003b330: 2020 2020 2020 2020 2020 2075 7469 6c2e             util.
-0003b340: 7374 6172 745f 6669 6c65 2866 696c 6573  start_file(files
-0003b350: 5b30 5d20 6966 2064 6f5f 7369 6e67 6c65  [0] if do_single
-0003b360: 6669 6c65 206f 7220 6c65 6e28 6368 6174  file or len(chat
-0003b370: 7329 203d 3d20 3120 656c 7365 2070 6174  s) == 1 else pat
-0003b380: 6829 0d0a 2020 2020 2020 2020 656c 7365  h)..        else
-0003b390: 3a0d 0a20 2020 2020 2020 2020 2020 2067  :..            g
-0003b3a0: 7569 6261 7365 2e73 7461 7475 7328 6572  uibase.status(er
-0003b3b0: 726f 726d 7367 5f73 686f 7274 206f 7220  rormsg_short or 
-0003b3c0: 6572 726f 726d 7367 290d 0a20 2020 2020  errormsg)..     
-0003b3d0: 2020 2020 2020 2077 782e 4d65 7373 6167         wx.Messag
-0003b3e0: 6542 6f78 2865 7272 6f72 6d73 672c 2063  eBox(errormsg, c
-0003b3f0: 6f6e 662e 5469 746c 652c 2077 782e 4f4b  onf.Title, wx.OK
-0003b400: 207c 2077 782e 4943 4f4e 5f57 4152 4e49   | wx.ICON_WARNI
-0003b410: 4e47 290d 0a0d 0a0d 0a20 2020 2064 6566  NG)......    def
-0003b420: 206f 6e5f 6669 6c74 6572 6578 706f 7274   on_filterexport
-0003b430: 5f63 6861 7428 7365 6c66 2c20 6576 656e  _chat(self, even
-0003b440: 7429 3a0d 0a20 2020 2020 2020 2022 2222  t):..        """
-0003b450: 0d0a 2020 2020 2020 2020 4861 6e64 6c65  ..        Handle
-0003b460: 7220 666f 7220 636c 6963 6b69 6e67 2074  r for clicking t
-0003b470: 6f20 6578 706f 7274 2061 2063 6861 7420  o export a chat 
-0003b480: 6669 6c74 6572 696e 6720 7374 7261 6967  filtering straig
-0003b490: 6874 2074 6f20 6669 6c65 2c0d 0a20 2020  ht to file,..   
-0003b4a0: 2020 2020 2064 6973 706c 6179 7320 6120       displays a 
-0003b4b0: 7361 7665 2066 696c 6520 6469 616c 6f67  save file dialog
-0003b4c0: 2061 6e64 2073 6176 6573 2061 6c6c 2066   and saves all f
-0003b4d0: 696c 7465 7265 6420 6d65 7373 6167 6573  iltered messages
-0003b4e0: 2074 6f20 6669 6c65 2e0d 0a20 2020 2020   to file...     
-0003b4f0: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
-0003b500: 666f 726d 6174 6172 6773 203d 2063 6f6c  formatargs = col
-0003b510: 6c65 6374 696f 6e73 2e64 6566 6175 6c74  lections.default
-0003b520: 6469 6374 2873 7472 293b 2066 6f72 6d61  dict(str); forma
-0003b530: 7461 7267 732e 7570 6461 7465 2873 656c  targs.update(sel
-0003b540: 662e 6368 6174 290d 0a20 2020 2020 2020  f.chat)..       
-0003b550: 2064 6566 6175 6c74 203d 2063 6f6e 662e   default = conf.
-0003b560: 4578 706f 7274 4368 6174 5465 6d70 6c61  ExportChatTempla
-0003b570: 7465 2025 2066 6f72 6d61 7461 7267 730d  te % formatargs.
-0003b580: 0a20 2020 2020 2020 2073 656c 662e 6469  .        self.di
-0003b590: 616c 6f67 5f73 6176 6563 6861 742e 4669  alog_savechat.Fi
-0003b5a0: 6c65 6e61 6d65 203d 2075 7469 6c2e 7361  lename = util.sa
-0003b5b0: 6665 5f66 696c 656e 616d 6528 6465 6661  fe_filename(defa
-0003b5c0: 756c 7429 0d0a 2020 2020 2020 2020 6966  ult)..        if
-0003b5d0: 2077 782e 4944 5f4f 4b20 213d 2073 656c   wx.ID_OK != sel
-0003b5e0: 662e 6469 616c 6f67 5f73 6176 6563 6861  f.dialog_savecha
-0003b5f0: 742e 5368 6f77 4d6f 6461 6c28 293a 2072  t.ShowModal(): r
-0003b600: 6574 7572 6e0d 0a0d 0a20 2020 2020 2020  eturn....       
-0003b610: 2066 696c 6570 6174 6820 3d20 636f 6e74   filepath = cont
-0003b620: 726f 6c73 2e67 6574 5f64 6961 6c6f 675f  rols.get_dialog_
-0003b630: 7061 7468 2873 656c 662e 6469 616c 6f67  path(self.dialog
-0003b640: 5f73 6176 6563 6861 7429 0d0a 2020 2020  _savechat)..    
-0003b650: 2020 2020 666f 726d 6174 203d 2065 7870      format = exp
-0003b660: 6f72 742e 4348 4154 5f45 5854 535b 7365  ort.CHAT_EXTS[se
-0003b670: 6c66 2e64 6961 6c6f 675f 7361 7665 6368  lf.dialog_savech
-0003b680: 6174 2e46 696c 7465 7249 6e64 6578 5d0d  at.FilterIndex].
-0003b690: 0a20 2020 2020 2020 206d 6564 6961 5f66  .        media_f
-0003b6a0: 6f6c 6465 7220 3d20 2268 746d 6c22 203d  older = "html" =
-0003b6b0: 3d20 666f 726d 6174 2061 6e64 205c 0d0a  = format and \..
-0003b6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b6d0: 2020 2020 2020 2073 656c 662e 6469 616c         self.dial
-0003b6e0: 6f67 5f73 6176 6563 6861 742e 4669 6c74  og_savechat.Filt
-0003b6f0: 6572 496e 6465 7820 213d 2065 7870 6f72  erIndex != expor
-0003b700: 742e 4348 4154 5f45 5854 532e 696e 6465  t.CHAT_EXTS.inde
-0003b710: 7828 2268 746d 6c22 290d 0a20 2020 2020  x("html")..     
-0003b720: 2020 2069 6620 6d65 6469 615f 666f 6c64     if media_fold
-0003b730: 6572 2061 6e64 206e 6f74 2063 6865 636b  er and not check
-0003b740: 5f6d 6564 6961 5f65 7870 6f72 745f 6c6f  _media_export_lo
-0003b750: 6769 6e28 7365 6c66 2e64 6229 3a20 7265  gin(self.db): re
-0003b760: 7475 726e 0d0a 0d0a 2020 2020 2020 2020  turn....        
-0003b770: 6275 7379 203d 2063 6f6e 7472 6f6c 732e  busy = controls.
-0003b780: 4275 7379 5061 6e65 6c28 7365 6c66 2c20  BusyPanel(self, 
-0003b790: 2746 696c 7465 7269 6e67 2061 6e64 2065  'Filtering and e
-0003b7a0: 7870 6f72 7469 6e67 2022 2573 222e 2720  xporting "%s".' 
-0003b7b0: 250d 0a20 2020 2020 2020 2020 2020 2020  %..             
-0003b7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b7d0: 2020 2020 2073 656c 662e 6368 6174 5b22       self.chat["
-0003b7e0: 7469 746c 6522 5d29 0d0a 2020 2020 2020  title"])..      
-0003b7f0: 2020 7472 793a 0d0a 2020 2020 2020 2020    try:..        
-0003b800: 2020 2020 6669 6c74 6572 5f6e 6577 203d      filter_new =
-0003b810: 2073 656c 662e 6275 696c 645f 6669 6c74   self.build_filt
-0003b820: 6572 2829 0d0a 2020 2020 2020 2020 2020  er()..          
-0003b830: 2020 6669 6c74 6572 5f62 6163 6b75 7020    filter_backup 
-0003b840: 3d20 7365 6c66 2e73 7463 5f68 6973 746f  = self.stc_histo
-0003b850: 7279 2e47 6574 4669 6c74 6572 2829 0d0a  ry.GetFilter()..
-0003b860: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0003b870: 2e73 7463 5f68 6973 746f 7279 2e53 6574  .stc_history.Set
-0003b880: 4669 6c74 6572 2866 696c 7465 725f 6e65  Filter(filter_ne
-0003b890: 7729 0d0a 2020 2020 2020 2020 2020 2020  w)..            
-0003b8a0: 7365 6c66 2e73 7463 5f68 6973 746f 7279  self.stc_history
-0003b8b0: 2e52 6574 7269 6576 654d 6573 7361 6765  .RetrieveMessage
-0003b8c0: 7349 664e 6565 6465 6428 290d 0a20 2020  sIfNeeded()..   
-0003b8d0: 2020 2020 2020 2020 206d 6573 7361 6765           message
-0003b8e0: 735f 616c 6c20 3d20 7365 6c66 2e73 7463  s_all = self.stc
-0003b8f0: 5f68 6973 746f 7279 2e47 6574 5265 7472  _history.GetRetr
-0003b900: 6965 7665 644d 6573 7361 6765 7328 290d  ievedMessages().
-0003b910: 0a20 2020 2020 2020 2020 2020 206d 6573  .            mes
-0003b920: 7361 6765 7320 3d20 5b6d 2066 6f72 206d  sages = [m for m
-0003b930: 2069 6e20 6d65 7373 6167 6573 5f61 6c6c   in messages_all
-0003b940: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0003b950: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-0003b960: 2073 656c 662e 7374 635f 6869 7374 6f72   self.stc_histor
-0003b970: 792e 4973 4d65 7373 6167 6546 696c 7465  y.IsMessageFilte
-0003b980: 7265 644f 7574 286d 295d 0d0a 2020 2020  redOut(m)]..    
-0003b990: 2020 2020 2020 2020 7365 6c66 2e73 7463          self.stc
-0003b9a0: 5f68 6973 746f 7279 2e53 6574 4669 6c74  _history.SetFilt
-0003b9b0: 6572 2866 696c 7465 725f 6261 636b 7570  er(filter_backup
-0003b9c0: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
-0003b9d0: 6620 6d65 7373 6167 6573 3a0d 0a20 2020  f messages:..   
-0003b9e0: 2020 2020 2020 2020 2020 2020 2067 7569               gui
-0003b9f0: 6261 7365 2e73 7461 7475 7328 2246 696c  base.status("Fil
-0003ba00: 7465 7269 6e67 2061 6e64 2065 7870 6f72  tering and expor
-0003ba10: 7469 6e67 2074 6f20 2573 2e22 2c20 6669  ting to %s.", fi
-0003ba20: 6c65 7061 7468 2c20 6c6f 673d 5472 7565  lepath, log=True
-0003ba30: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0003ba40: 2020 2070 726f 6772 6573 7366 756e 6320     progressfunc 
-0003ba50: 3d20 6c61 6d62 6461 202a 6172 6773 3a20  = lambda *args: 
-0003ba60: 7778 2e53 6166 6559 6965 6c64 2829 0d0a  wx.SafeYield()..
-0003ba70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003ba80: 6f70 7473 203d 2064 6963 7428 6d65 7373  opts = dict(mess
-0003ba90: 6167 6573 3d6d 6573 7361 6765 732c 2070  ages=messages, p
-0003baa0: 726f 6772 6573 733d 7072 6f67 7265 7373  rogress=progress
-0003bab0: 6675 6e63 290d 0a20 2020 2020 2020 2020  func)..         
-0003bac0: 2020 2020 2020 2069 6620 6d65 6469 615f         if media_
-0003bad0: 666f 6c64 6572 3a20 6f70 7473 5b22 6d65  folder: opts["me
-0003bae0: 6469 615f 666f 6c64 6572 225d 203d 2054  dia_folder"] = T
-0003baf0: 7275 650d 0a20 2020 2020 2020 2020 2020  rue..           
-0003bb00: 2020 2020 2072 6573 756c 7420 3d20 6578       result = ex
-0003bb10: 706f 7274 2e65 7870 6f72 745f 6368 6174  port.export_chat
-0003bb20: 7328 5b73 656c 662e 6368 6174 5d2c 2066  s([self.chat], f
-0003bb30: 696c 6570 6174 682c 2066 6f72 6d61 742c  ilepath, format,
-0003bb40: 2073 656c 662e 6462 2c20 6f70 7473 290d   self.db, opts).
-0003bb50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003bb60: 2066 696c 6573 2c20 636f 756e 742c 206d   files, count, m
-0003bb70: 6573 7361 6765 5f63 6f75 6e74 203d 2072  essage_count = r
-0003bb80: 6573 756c 740d 0a20 2020 2020 2020 2020  esult..         
-0003bb90: 2020 2020 2020 2067 7569 6261 7365 2e73         guibase.s
-0003bba0: 7461 7475 7328 2245 7870 6f72 7465 6420  tatus("Exported 
-0003bbb0: 2573 2074 6f20 2573 2e22 2c0d 0a20 2020  %s to %s.",..   
-0003bbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003bbd0: 2020 2020 2020 2020 2020 2020 7574 696c              util
-0003bbe0: 2e70 6c75 7261 6c28 226d 6573 7361 6765  .plural("message
-0003bbf0: 222c 206d 6573 7361 6765 5f63 6f75 6e74  ", message_count
-0003bc00: 2c20 7365 703d 222c 2229 2c0d 0a20 2020  , sep=","),..   
-0003bc10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003bc20: 2020 2020 2020 2020 2020 2020 6669 6c65              file
-0003bc30: 7061 7468 2c20 6c6f 673d 5472 7565 290d  path, log=True).
-0003bc40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003bc50: 2069 6620 636f 6e66 2e45 7870 6f72 7446   if conf.ExportF
-0003bc60: 696c 6541 7574 6f4f 7065 6e3a 2075 7469  ileAutoOpen: uti
-0003bc70: 6c2e 7374 6172 745f 6669 6c65 2866 696c  l.start_file(fil
-0003bc80: 6570 6174 6829 0d0a 2020 2020 2020 2020  epath)..        
-0003bc90: 2020 2020 2020 2020 7778 2e43 616c 6c41          wx.CallA
-0003bca0: 6674 6572 2873 656c 662e 7570 6461 7465  fter(self.update
-0003bcb0: 5f6c 6976 6569 6e66 6f29 0d0a 2020 2020  _liveinfo)..    
-0003bcc0: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-0003bcd0: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-0003bce0: 782e 4d65 7373 6167 6542 6f78 2822 4375  x.MessageBox("Cu
-0003bcf0: 7272 656e 7420 6669 6c74 6572 206c 6561  rrent filter lea
-0003bd00: 7665 7320 6e6f 2064 6174 6120 746f 2065  ves no data to e
-0003bd10: 7870 6f72 742e 222c 0d0a 2020 2020 2020  xport.",..      
-0003bd20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003bd30: 2020 2020 2020 2020 636f 6e66 2e54 6974          conf.Tit
-0003bd40: 6c65 2c20 7778 2e4f 4b20 7c20 7778 2e49  le, wx.OK | wx.I
-0003bd50: 434f 4e5f 494e 464f 524d 4154 494f 4e29  CON_INFORMATION)
-0003bd60: 0d0a 2020 2020 2020 2020 6578 6365 7074  ..        except
-0003bd70: 2045 7863 6570 7469 6f6e 2061 7320 653a   Exception as e:
-0003bd80: 0d0a 2020 2020 2020 2020 2020 2020 6775  ..            gu
-0003bd90: 6962 6173 652e 7374 6174 7573 2822 4572  ibase.status("Er
-0003bda0: 726f 7220 7361 7669 6e67 2025 733a 2025  ror saving %s: %
-0003bdb0: 7322 2c20 6669 6c65 7061 7468 2c20 7574  s", filepath, ut
-0003bdc0: 696c 2e66 6f72 6d61 745f 6578 6328 6529  il.format_exc(e)
-0003bdd0: 290d 0a20 2020 2020 2020 2020 2020 206c  )..            l
-0003bde0: 6f67 6765 722e 6578 6365 7074 696f 6e28  ogger.exception(
-0003bdf0: 2245 7272 6f72 2073 6176 696e 6720 2573  "Error saving %s
-0003be00: 2e22 2c20 6669 6c65 7061 7468 290d 0a20  .", filepath).. 
-0003be10: 2020 2020 2020 2020 2020 2065 7272 6f72             error
-0003be20: 6d73 6720 3d20 2245 7272 6f72 2073 6176  msg = "Error sav
-0003be30: 696e 6720 2573 3a5c 6e5c 6e25 7322 2025  ing %s:\n\n%s" %
-0003be40: 205c 0d0a 2020 2020 2020 2020 2020 2020   \..            
-0003be50: 2020 2020 2020 2020 2020 2028 6669 6c65             (file
-0003be60: 7061 7468 2c20 7472 6163 6562 6163 6b2e  path, traceback.
-0003be70: 666f 726d 6174 5f65 7863 2829 290d 0a20  format_exc()).. 
-0003be80: 2020 2020 2020 2020 2020 2077 782e 4d65             wx.Me
-0003be90: 7373 6167 6542 6f78 2865 7272 6f72 6d73  ssageBox(errorms
-0003bea0: 672c 2063 6f6e 662e 5469 746c 652c 2077  g, conf.Title, w
-0003beb0: 782e 4f4b 207c 2077 782e 4943 4f4e 5f57  x.OK | wx.ICON_W
-0003bec0: 4152 4e49 4e47 290d 0a20 2020 2020 2020  ARNING)..       
-0003bed0: 2066 696e 616c 6c79 3a0d 0a20 2020 2020   finally:..     
-0003bee0: 2020 2020 2020 2062 7573 792e 436c 6f73         busy.Clos
-0003bef0: 6528 290d 0a0d 0a0d 0a20 2020 2064 6566  e()......    def
-0003bf00: 206f 6e5f 7369 7a65 5f68 746d 6c5f 7374   on_size_html_st
-0003bf10: 6174 7328 7365 6c66 2c20 6576 656e 7429  ats(self, event)
-0003bf20: 3a0d 0a20 2020 2020 2020 2022 2222 4861  :..        """Ha
-0003bf30: 6e64 6c65 7220 666f 7220 7369 7a69 6e67  ndler for sizing
-0003bf40: 2068 746d 6c5f 7374 6174 732c 2073 6574   html_stats, set
-0003bf50: 7320 6e65 7720 7363 726f 6c6c 2070 6f73  s new scroll pos
-0003bf60: 6974 696f 6e20 6261 7365 640d 0a20 2020  ition based..   
-0003bf70: 2020 2020 2070 7265 7669 6f75 736c 7920       previously 
-0003bf80: 7374 6f72 6564 206f 6e65 2028 4874 6d6c  stored one (Html
-0003bf90: 5769 6e64 6f77 206c 6f73 6573 2069 7473  Window loses its
-0003bfa0: 2073 6372 6f6c 6c20 706f 7369 7469 6f6e   scroll position
-0003bfb0: 206f 6e20 7265 7369 7a65 292e 0d0a 2020   on resize)...  
-0003bfc0: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
-0003bfd0: 2020 2068 746d 6c20 3d20 7365 6c66 2e68     html = self.h
-0003bfe0: 746d 6c5f 7374 6174 730d 0a20 2020 2020  tml_stats..     
-0003bff0: 2020 2069 6620 6861 7361 7474 7228 6874     if hasattr(ht
-0003c000: 6d6c 2c20 225f 6c61 7374 5f73 6372 6f6c  ml, "_last_scrol
-0003c010: 6c5f 706f 7322 293a 0d0a 2020 2020 2020  l_pos"):..      
-0003c020: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
-0003c030: 616e 6765 2832 293a 0d0a 2020 2020 2020  ange(2):..      
-0003c040: 2020 2020 2020 2020 2020 6f72 6965 6e74            orient
-0003c050: 203d 2077 782e 5645 5254 4943 414c 2069   = wx.VERTICAL i
-0003c060: 6620 6920 656c 7365 2077 782e 484f 5249  f i else wx.HORI
-0003c070: 5a4f 4e54 414c 0d0a 2020 2020 2020 2020  ZONTAL..        
-0003c080: 2020 2020 2020 2020 2320 4469 7669 7369          # Divisi
-0003c090: 6f6e 2063 616e 2062 6520 3e20 3120 6f6e  on can be > 1 on
-0003c0a0: 2066 6972 7374 2072 6573 697a 696e 6773   first resizings
-0003c0b0: 2c20 626f 756e 6420 6974 2074 6f20 312e  , bound it to 1.
-0003c0c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0003c0d0: 2020 7261 7469 6f20 3d20 6d69 6e28 312c    ratio = min(1,
-0003c0e0: 2075 7469 6c2e 7361 6665 6469 7666 2868   util.safedivf(h
-0003c0f0: 746d 6c2e 5f6c 6173 745f 7363 726f 6c6c  tml._last_scroll
-0003c100: 5f70 6f73 5b69 5d2c 0d0a 2020 2020 2020  _pos[i],..      
-0003c110: 2020 2020 2020 2020 2020 2020 2020 6874                ht
-0003c120: 6d6c 2e5f 6c61 7374 5f73 6372 6f6c 6c5f  ml._last_scroll_
-0003c130: 7261 6e67 655b 695d 0d0a 2020 2020 2020  range[i]..      
-0003c140: 2020 2020 2020 2020 2020 2929 0d0a 2020            ))..  
-0003c150: 2020 2020 2020 2020 2020 2020 2020 6874                ht
-0003c160: 6d6c 2e5f 6c61 7374 5f73 6372 6f6c 6c5f  ml._last_scroll_
-0003c170: 706f 735b 695d 203d 2069 6e74 2872 6174  pos[i] = int(rat
-0003c180: 696f 202a 2068 746d 6c2e 4765 7453 6372  io * html.GetScr
-0003c190: 6f6c 6c52 616e 6765 286f 7269 656e 7429  ollRange(orient)
-0003c1a0: 290d 0a20 2020 2020 2020 2020 2020 2023  )..            #
-0003c1b0: 2045 7865 6375 7465 2073 6372 6f6c 6c20   Execute scroll 
-0003c1c0: 6c61 7465 7220 6173 2073 6f6d 6574 6869  later as somethi
-0003c1d0: 6e67 2072 6573 6574 7320 6974 2061 6674  ng resets it aft
-0003c1e0: 6572 2074 6869 7320 6861 6e64 6c65 720d  er this handler.
-0003c1f0: 0a20 2020 2020 2020 2020 2020 2073 6372  .            scr
-0003c200: 6f6c 6c5f 6675 6e63 203d 206c 616d 6264  oll_func = lambd
-0003c210: 613a 2068 746d 6c20 616e 6420 6874 6d6c  a: html and html
-0003c220: 2e53 6372 6f6c 6c28 2a68 746d 6c2e 5f6c  .Scroll(*html._l
-0003c230: 6173 745f 7363 726f 6c6c 5f70 6f73 290d  ast_scroll_pos).
-0003c240: 0a20 2020 2020 2020 2020 2020 2077 782e  .            wx.
-0003c250: 4361 6c6c 4c61 7465 7228 3530 2c20 7363  CallLater(50, sc
-0003c260: 726f 6c6c 5f66 756e 6329 0d0a 2020 2020  roll_func)..    
-0003c270: 2020 2020 6576 656e 742e 536b 6970 2829      event.Skip()
-0003c280: 2023 2041 6c6c 6f77 2065 7665 6e74 2074   # Allow event t
-0003c290: 6f20 7072 6f70 6167 6174 6520 7778 2068  o propagate wx h
-0003c2a0: 616e 646c 6572 0d0a 0d0a 0d0a 2020 2020  andler......    
-0003c2b0: 6465 6620 6f6e 5f73 656c 6563 745f 7061  def on_select_pa
-0003c2c0: 7274 6963 6970 616e 7428 7365 6c66 2c20  rticipant(self, 
-0003c2d0: 6576 656e 7429 3a0d 0a20 2020 2020 2020  event):..       
-0003c2e0: 2022 2222 0d0a 2020 2020 2020 2020 4861   """..        Ha
-0003c2f0: 6e64 6c65 7220 666f 7220 7365 6c65 6374  ndler for select
-0003c300: 696e 6720 616e 2069 7465 6d20 7468 6520  ing an item the 
-0003c310: 696e 2074 6865 2070 6172 7469 6369 7061  in the participa
-0003c320: 6e74 7320 6c69 7374 2c20 746f 6767 6c65  nts list, toggle
-0003c330: 730d 0a20 2020 2020 2020 2069 7473 2063  s..        its c
-0003c340: 6865 636b 6564 2073 7461 7465 2e0d 0a20  hecked state... 
-0003c350: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
-0003c360: 2020 2020 6964 7820 3d20 6576 656e 742e      idx = event.
-0003c370: 4765 7449 6e64 6578 2829 0d0a 2020 2020  GetIndex()..    
-0003c380: 2020 2020 6966 2069 6478 203c 2073 656c      if idx < sel
-0003c390: 662e 6c69 7374 5f70 6172 7469 6369 7061  f.list_participa
-0003c3a0: 6e74 732e 4765 7449 7465 6d43 6f75 6e74  nts.GetItemCount
-0003c3b0: 2829 3a0d 0a20 2020 2020 2020 2020 2020  ():..           
-0003c3c0: 2063 203d 2073 656c 662e 6c69 7374 5f70   c = self.list_p
-0003c3d0: 6172 7469 6369 7061 6e74 732e 4765 7449  articipants.GetI
-0003c3e0: 7465 6d28 6964 7829 0d0a 2020 2020 2020  tem(idx)..      
-0003c3f0: 2020 2020 2020 632e 4368 6563 6b28 6e6f        c.Check(no
-0003c400: 7420 632e 4973 4368 6563 6b65 6428 2929  t c.IsChecked())
-0003c410: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-0003c420: 6c66 2e6c 6973 745f 7061 7274 6963 6970  lf.list_particip
-0003c430: 616e 7473 2e53 6574 4974 656d 2863 290d  ants.SetItem(c).
-0003c440: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0003c450: 662e 6c69 7374 5f70 6172 7469 6369 7061  f.list_participa
-0003c460: 6e74 732e 5265 6672 6573 6828 2920 2320  nts.Refresh() # 
-0003c470: 4e6f 7469 6679 206c 6973 7420 6f66 2064  Notify list of d
-0003c480: 6174 6120 6368 616e 6765 0d0a 0d0a 0d0a  ata change......
-0003c490: 2020 2020 6465 6620 6f6e 5f73 6372 6f6c      def on_scrol
-0003c4a0: 6c5f 6772 6964 5f73 716c 2873 656c 662c  l_grid_sql(self,
-0003c4b0: 2065 7665 6e74 293a 0d0a 2020 2020 2020   event):..      
-0003c4c0: 2020 2222 220d 0a20 2020 2020 2020 2048    """..        H
-0003c4d0: 616e 646c 6572 2066 6f72 2073 6372 6f6c  andler for scrol
-0003c4e0: 6c69 6e67 2074 6865 2053 514c 2067 7269  ling the SQL gri
-0003c4f0: 642c 2073 6565 6b73 2061 6865 6164 2069  d, seeks ahead i
-0003c500: 6620 6e65 6172 696e 6720 7468 6520 656e  f nearing the en
-0003c510: 6420 6f66 0d0a 2020 2020 2020 2020 7265  d of..        re
-0003c520: 7472 6965 7665 6420 726f 7773 2e0d 0a20  trieved rows... 
-0003c530: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
-0003c540: 2020 2020 6576 656e 742e 536b 6970 2829      event.Skip()
-0003c550: 0d0a 2020 2020 2020 2020 2320 4578 6563  ..        # Exec
-0003c560: 7574 6520 7365 656b 206c 6174 6572 2c20  ute seek later, 
-0003c570: 746f 2067 6976 6520 7363 726f 6c6c 2070  to give scroll p
-0003c580: 6f73 6974 696f 6e20 7469 6d65 2074 6f20  osition time to 
-0003c590: 7570 6461 7465 0d0a 2020 2020 2020 2020  update..        
-0003c5a0: 7778 2e43 616c 6c4c 6174 6572 2835 302c  wx.CallLater(50,
-0003c5b0: 2073 656c 662e 7365 656b 6168 6561 645f   self.seekahead_
-0003c5c0: 6772 6964 5f73 716c 290d 0a0d 0a0d 0a20  grid_sql)...... 
-0003c5d0: 2020 2064 6566 2073 6565 6b61 6865 6164     def seekahead
-0003c5e0: 5f67 7269 645f 7371 6c28 7365 6c66 293a  _grid_sql(self):
-0003c5f0: 0d0a 2020 2020 2020 2020 2222 2253 6565  ..        """See
-0003c600: 6b73 2061 6865 6164 206f 6e20 7468 6520  ks ahead on the 
-0003c610: 5351 4c20 6772 6964 2069 6620 7363 726f  SQL grid if scro
-0003c620: 6c6c 2070 6f73 6974 696f 6e20 6e65 6172  ll position near
-0003c630: 696e 6720 7468 6520 656e 642e 2222 220d  ing the end.""".
-0003c640: 0a20 2020 2020 2020 2053 4545 4b41 4845  .        SEEKAHE
-0003c650: 4144 5f50 4f53 5f52 4154 494f 203d 2030  AD_POS_RATIO = 0
-0003c660: 2e38 0d0a 2020 2020 2020 2020 7363 726f  .8..        scro
-0003c670: 6c6c 706f 7320 3d20 7365 6c66 2e67 7269  llpos = self.gri
-0003c680: 645f 7371 6c2e 4765 7453 6372 6f6c 6c50  d_sql.GetScrollP
-0003c690: 6f73 2877 782e 5645 5254 4943 414c 290d  os(wx.VERTICAL).
-0003c6a0: 0a20 2020 2020 2020 2073 6372 6f6c 6c72  .        scrollr
-0003c6b0: 616e 6765 203d 2073 656c 662e 6772 6964  ange = self.grid
-0003c6c0: 5f73 716c 2e47 6574 5363 726f 6c6c 5261  _sql.GetScrollRa
-0003c6d0: 6e67 6528 7778 2e56 4552 5449 4341 4c29  nge(wx.VERTICAL)
-0003c6e0: 0d0a 2020 2020 2020 2020 6966 2073 6372  ..        if scr
-0003c6f0: 6f6c 6c70 6f73 203e 2073 6372 6f6c 6c72  ollpos > scrollr
-0003c700: 616e 6765 202a 2053 4545 4b41 4845 4144  ange * SEEKAHEAD
-0003c710: 5f50 4f53 5f52 4154 494f 3a0d 0a20 2020  _POS_RATIO:..   
-0003c720: 2020 2020 2020 2020 2073 6372 6f6c 6c70           scrollp
-0003c730: 6167 6520 3d20 7365 6c66 2e67 7269 645f  age = self.grid_
-0003c740: 7371 6c2e 4765 7453 6372 6f6c 6c50 6167  sql.GetScrollPag
-0003c750: 6553 697a 6528 7778 2e56 4552 5449 4341  eSize(wx.VERTICA
-0003c760: 4c29 0d0a 2020 2020 2020 2020 2020 2020  L)..            
-0003c770: 746f 5f65 6e64 203d 2028 7363 726f 6c6c  to_end = (scroll
-0003c780: 706f 7320 2b20 7363 726f 6c6c 7061 6765  pos + scrollpage
-0003c790: 203d 3d20 7363 726f 6c6c 7261 6e67 6529   == scrollrange)
-0003c7a0: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-0003c7b0: 5365 656b 2074 6f20 656e 6420 6966 2073  Seek to end if s
-0003c7c0: 6372 6f6c 6c65 6420 746f 2074 6865 2076  crolled to the v
-0003c7d0: 6572 7920 626f 7474 6f6d 0d0a 2020 2020  ery bottom..    
-0003c7e0: 2020 2020 2020 2020 7365 6c66 2e67 7269          self.gri
-0003c7f0: 645f 7371 6c2e 5461 626c 652e 5365 656b  d_sql.Table.Seek
-0003c800: 4168 6561 6428 746f 5f65 6e64 290d 0a0d  Ahead(to_end)...
-0003c810: 0a0d 0a20 2020 2064 6566 206f 6e5f 7363  ...    def on_sc
-0003c820: 726f 6c6c 5f68 746d 6c5f 7374 6174 7328  roll_html_stats(
-0003c830: 7365 6c66 2c20 6576 656e 7429 3a0d 0a20  self, event):.. 
-0003c840: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
-0003c850: 2020 2020 4861 6e64 6c65 7220 666f 7220      Handler for 
-0003c860: 7363 726f 6c6c 696e 6720 7468 6520 4854  scrolling the HT
-0003c870: 4d4c 2073 7461 7473 2c20 7374 6f72 6573  ML stats, stores
-0003c880: 2073 6372 6f6c 6c20 706f 7369 7469 6f6e   scroll position
-0003c890: 0d0a 2020 2020 2020 2020 2848 746d 6c57  ..        (HtmlW
-0003c8a0: 696e 646f 7720 6c6f 7365 7320 6974 206f  indow loses it o
-0003c8b0: 6e20 7265 7369 7a65 292e 0d0a 2020 2020  n resize)...    
-0003c8c0: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
-0003c8d0: 2077 782e 4361 6c6c 4166 7465 7228 7365   wx.CallAfter(se
-0003c8e0: 6c66 2e73 746f 7265 5f68 746d 6c5f 7374  lf.store_html_st
-0003c8f0: 6174 735f 7363 726f 6c6c 290d 0a20 2020  ats_scroll)..   
-0003c900: 2020 2020 2065 7665 6e74 2e53 6b69 7028       event.Skip(
-0003c910: 2920 2320 416c 6c6f 7720 6576 656e 7420  ) # Allow event 
-0003c920: 746f 2070 726f 7061 6761 7465 2077 7820  to propagate wx 
-0003c930: 6861 6e64 6c65 720d 0a0d 0a0d 0a20 2020  handler......   
-0003c940: 2064 6566 2073 746f 7265 5f68 746d 6c5f   def store_html_
-0003c950: 7374 6174 735f 7363 726f 6c6c 2873 656c  stats_scroll(sel
-0003c960: 6629 3a0d 0a20 2020 2020 2020 2022 2222  f):..        """
-0003c970: 0d0a 2020 2020 2020 2020 5374 6f72 6573  ..        Stores
-0003c980: 2074 6865 2073 7461 7469 7374 6963 7320   the statistics 
-0003c990: 4854 4d4c 2073 6372 6f6c 6c20 706f 7369  HTML scroll posi
-0003c9a0: 7469 6f6e 2c20 6e65 6564 6564 2066 6f72  tion, needed for
-0003c9b0: 2067 6574 7469 6e67 2061 726f 756e 640d   getting around.
-0003c9c0: 0a20 2020 2020 2020 2069 7473 2071 7569  .        its qui
-0003c9d0: 726b 7920 7363 726f 6c6c 2075 7064 6174  rky scroll updat
-0003c9e0: 696e 672e 0d0a 2020 2020 2020 2020 2222  ing...        ""
-0003c9f0: 220d 0a20 2020 2020 2020 2069 6620 6e6f  "..        if no
-0003ca00: 7420 7365 6c66 3a0d 0a20 2020 2020 2020  t self:..       
-0003ca10: 2020 2020 2072 6574 7572 6e0d 0a20 2020       return..   
-0003ca20: 2020 2020 2073 656c 662e 6874 6d6c 5f73       self.html_s
-0003ca30: 7461 7473 2e5f 6c61 7374 5f73 6372 6f6c  tats._last_scrol
-0003ca40: 6c5f 706f 7320 3d20 5b0d 0a20 2020 2020  l_pos = [..     
-0003ca50: 2020 2020 2020 2073 656c 662e 6874 6d6c         self.html
-0003ca60: 5f73 7461 7473 2e47 6574 5363 726f 6c6c  _stats.GetScroll
-0003ca70: 506f 7328 7778 2e48 4f52 495a 4f4e 5441  Pos(wx.HORIZONTA
-0003ca80: 4c29 2c0d 0a20 2020 2020 2020 2020 2020  L),..           
-0003ca90: 2073 656c 662e 6874 6d6c 5f73 7461 7473   self.html_stats
-0003caa0: 2e47 6574 5363 726f 6c6c 506f 7328 7778  .GetScrollPos(wx
-0003cab0: 2e56 4552 5449 4341 4c29 0d0a 2020 2020  .VERTICAL)..    
-0003cac0: 2020 2020 5d0d 0a20 2020 2020 2020 2073      ]..        s
-0003cad0: 656c 662e 6874 6d6c 5f73 7461 7473 2e5f  elf.html_stats._
-0003cae0: 6c61 7374 5f73 6372 6f6c 6c5f 7261 6e67  last_scroll_rang
-0003caf0: 6520 3d20 5b0d 0a20 2020 2020 2020 2020  e = [..         
-0003cb00: 2020 2073 656c 662e 6874 6d6c 5f73 7461     self.html_sta
-0003cb10: 7473 2e47 6574 5363 726f 6c6c 5261 6e67  ts.GetScrollRang
-0003cb20: 6528 7778 2e48 4f52 495a 4f4e 5441 4c29  e(wx.HORIZONTAL)
-0003cb30: 2c0d 0a20 2020 2020 2020 2020 2020 2073  ,..            s
-0003cb40: 656c 662e 6874 6d6c 5f73 7461 7473 2e47  elf.html_stats.G
-0003cb50: 6574 5363 726f 6c6c 5261 6e67 6528 7778  etScrollRange(wx
-0003cb60: 2e56 4552 5449 4341 4c29 0d0a 2020 2020  .VERTICAL)..    
-0003cb70: 2020 2020 5d0d 0a0d 0a0d 0a20 2020 2064      ]......    d
-0003cb80: 6566 206f 6e5f 636c 6963 6b5f 6874 6d6c  ef on_click_html
-0003cb90: 5f73 7461 7473 2873 656c 662c 2065 7665  _stats(self, eve
-0003cba0: 6e74 293a 0d0a 2020 2020 2020 2020 2222  nt):..        ""
-0003cbb0: 220d 0a20 2020 2020 2020 2048 616e 646c  "..        Handl
-0003cbc0: 6572 2066 6f72 2063 6c69 636b 696e 6720  er for clicking 
-0003cbd0: 6120 6c69 6e6b 2069 6e20 6368 6174 2068  a link in chat h
-0003cbe0: 6973 746f 7279 2073 7461 7469 7374 6963  istory statistic
-0003cbf0: 732c 2073 6372 6f6c 6c73 2074 6f0d 0a20  s, scrolls to.. 
-0003cc00: 2020 2020 2020 2061 6e63 686f 7220 6966         anchor if
-0003cc10: 2061 6e63 686f 7220 6c69 6e6b 2c20 736f   anchor link, so
-0003cc20: 7274 7320 7468 6520 7374 6174 6973 7469  rts the statisti
-0003cc30: 6373 2069 6620 736f 7274 206c 696e 6b2c  cs if sort link,
-0003cc40: 2067 6f65 7320 746f 0d0a 2020 2020 2020   goes to..      
-0003cc50: 2020 7370 6563 6966 6963 206d 6573 7361    specific messa
-0003cc60: 6765 2069 6620 7472 616e 7366 6572 2061  ge if transfer a
-0003cc70: 7574 686f 7220 6c69 6e6b 2c20 6f74 6865  uthor link, othe
-0003cc80: 7277 6973 6520 7368 6f77 7320 7468 6520  rwise shows the 
-0003cc90: 6869 7374 6f72 790d 0a20 2020 2020 2020  history..       
-0003cca0: 2061 6e64 2066 696e 6473 2074 6865 2077   and finds the w
-0003ccb0: 6f72 6420 636c 6963 6b65 6420 696e 2074  ord clicked in t
-0003ccc0: 6865 2077 6f72 6420 636c 6f75 642e 0d0a  he word cloud...
-0003ccd0: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
-0003cce0: 2020 2020 2068 7265 662c 2068 746d 6c77       href, htmlw
-0003ccf0: 696e 646f 7720 3d20 6576 656e 742e 4765  indow = event.Ge
-0003cd00: 744c 696e 6b49 6e66 6f28 292e 4872 6566  tLinkInfo().Href
-0003cd10: 2c20 6576 656e 742e 4576 656e 744f 626a  , event.EventObj
-0003cd20: 6563 740d 0a20 2020 2020 2020 2069 6620  ect..        if 
-0003cd30: 6765 7461 7474 7228 6874 6d6c 7769 6e64  getattr(htmlwind
-0003cd40: 6f77 2c20 2269 735f 7269 6768 7463 6c69  ow, "is_rightcli
-0003cd50: 636b 222c 2046 616c 7365 293a 0d0a 0d0a  ck", False):....
-0003cd60: 2020 2020 2020 2020 2020 2020 6465 6620              def 
-0003cd70: 6f6e 5f63 6f70 7928 6576 656e 7429 3a0d  on_copy(event):.
-0003cd80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003cd90: 2069 6620 7778 2e54 6865 436c 6970 626f   if wx.TheClipbo
-0003cda0: 6172 642e 4f70 656e 2829 3a0d 0a20 2020  ard.Open():..   
-0003cdb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003cdc0: 2074 6578 7420 3d20 6874 6d6c 7769 6e64   text = htmlwind
-0003cdd0: 6f77 2e53 656c 6563 7469 6f6e 546f 5465  ow.SelectionToTe
-0003cde0: 7874 2829 0d0a 2020 2020 2020 2020 2020  xt()..          
-0003cdf0: 2020 2020 2020 2020 2020 6420 3d20 7778            d = wx
-0003ce00: 2e54 6578 7444 6174 614f 626a 6563 7428  .TextDataObject(
-0003ce10: 7465 7874 290d 0a20 2020 2020 2020 2020  text)..         
-0003ce20: 2020 2020 2020 2020 2020 2077 782e 5468             wx.Th
-0003ce30: 6543 6c69 7062 6f61 7264 2e53 6574 4461  eClipboard.SetDa
-0003ce40: 7461 2864 292c 2077 782e 5468 6543 6c69  ta(d), wx.TheCli
-0003ce50: 7062 6f61 7264 2e43 6c6f 7365 2829 0d0a  pboard.Close()..
-0003ce60: 0d0a 2020 2020 2020 2020 2020 2020 6465  ..            de
-0003ce70: 6620 6f6e 5f73 656c 6563 7461 6c6c 2865  f on_selectall(e
-0003ce80: 7665 6e74 293a 0d0a 2020 2020 2020 2020  vent):..        
-0003ce90: 2020 2020 2020 2020 6874 6d6c 7769 6e64          htmlwind
-0003cea0: 6f77 2e53 656c 6563 7441 6c6c 2829 0d0a  ow.SelectAll()..
-0003ceb0: 0d0a 2020 2020 2020 2020 2020 2020 6874  ..            ht
-0003cec0: 6d6c 7769 6e64 6f77 2e69 735f 7269 6768  mlwindow.is_righ
-0003ced0: 7463 6c69 636b 203d 2046 616c 7365 0d0a  tclick = False..
-0003cee0: 2020 2020 2020 2020 2020 2020 6d65 6e75              menu
-0003cef0: 203d 2077 782e 4d65 6e75 2829 0d0a 2020   = wx.Menu()..  
-0003cf00: 2020 2020 2020 2020 2020 6974 656d 5f73            item_s
-0003cf10: 656c 6563 7469 6f6e 203d 2077 782e 4d65  election = wx.Me
-0003cf20: 6e75 4974 656d 286d 656e 752c 202d 312c  nuItem(menu, -1,
-0003cf30: 2022 2643 6f70 7920 7365 6c65 6374 696f   "&Copy selectio
-0003cf40: 6e22 290d 0a20 2020 2020 2020 2020 2020  n")..           
-0003cf50: 2069 7465 6d5f 7365 6c65 6374 616c 6c20   item_selectall 
-0003cf60: 3d20 7778 2e4d 656e 7549 7465 6d28 6d65  = wx.MenuItem(me
-0003cf70: 6e75 2c20 2d31 2c20 2226 5365 6c65 6374  nu, -1, "&Select
-0003cf80: 2061 6c6c 2229 0d0a 2020 2020 2020 2020   all")..        
-0003cf90: 2020 2020 6d65 6e75 2e41 7070 656e 6428      menu.Append(
-0003cfa0: 6974 656d 5f73 656c 6563 7469 6f6e 290d  item_selection).
-0003cfb0: 0a20 2020 2020 2020 2020 2020 206d 656e  .            men
-0003cfc0: 752e 4170 7065 6e64 2869 7465 6d5f 7365  u.Append(item_se
-0003cfd0: 6c65 6374 616c 6c29 0d0a 2020 2020 2020  lectall)..      
-0003cfe0: 2020 2020 2020 6974 656d 5f73 656c 6563        item_selec
-0003cff0: 7469 6f6e 2e45 6e61 626c 6528 626f 6f6c  tion.Enable(bool
-0003d000: 2868 746d 6c77 696e 646f 772e 5365 6c65  (htmlwindow.Sele
-0003d010: 6374 696f 6e54 6f54 6578 7428 2929 290d  ctionToText())).
-0003d020: 0a20 2020 2020 2020 2020 2020 206d 656e  .            men
-0003d030: 752e 4269 6e64 2877 782e 4556 545f 4d45  u.Bind(wx.EVT_ME
-0003d040: 4e55 2c20 6f6e 5f63 6f70 792c 2020 2020  NU, on_copy,    
-0003d050: 2020 6964 3d69 7465 6d5f 7365 6c65 6374    id=item_select
-0003d060: 696f 6e2e 4765 7449 6428 2929 0d0a 2020  ion.GetId())..  
-0003d070: 2020 2020 2020 2020 2020 6d65 6e75 2e42            menu.B
-0003d080: 696e 6428 7778 2e45 5654 5f4d 454e 552c  ind(wx.EVT_MENU,
-0003d090: 206f 6e5f 7365 6c65 6374 616c 6c2c 2069   on_selectall, i
-0003d0a0: 643d 6974 656d 5f73 656c 6563 7461 6c6c  d=item_selectall
-0003d0b0: 2e47 6574 4964 2829 290d 0a20 2020 2020  .GetId())..     
-0003d0c0: 2020 2020 2020 2068 746d 6c77 696e 646f         htmlwindo
-0003d0d0: 772e 506f 7075 704d 656e 7528 6d65 6e75  w.PopupMenu(menu
-0003d0e0: 290d 0a20 2020 2020 2020 2065 6c69 6620  )..        elif 
-0003d0f0: 6872 6566 2e73 7461 7274 7377 6974 6828  href.startswith(
-0003d100: 2223 2229 3a0d 0a20 2020 2020 2020 2020  "#"):..         
-0003d110: 2020 2073 656c 662e 6874 6d6c 5f73 7461     self.html_sta
-0003d120: 7473 2e53 6372 6f6c 6c54 6f41 6e63 686f  ts.ScrollToAncho
-0003d130: 7228 6872 6566 5b31 3a5d 290d 0a20 2020  r(href[1:])..   
-0003d140: 2020 2020 2020 2020 2077 782e 4361 6c6c           wx.Call
-0003d150: 4166 7465 7228 7365 6c66 2e73 746f 7265  After(self.store
-0003d160: 5f68 746d 6c5f 7374 6174 735f 7363 726f  _html_stats_scro
-0003d170: 6c6c 290d 0a20 2020 2020 2020 2065 6c69  ll)..        eli
-0003d180: 6620 6872 6566 2e73 7461 7274 7377 6974  f href.startswit
-0003d190: 6828 2266 696c 653a 2f2f 2229 3a0d 0a20  h("file://"):.. 
-0003d1a0: 2020 2020 2020 2020 2020 2066 696c 6570             filep
-0003d1b0: 6174 6820 3d20 7572 6c6c 6962 2e72 6571  ath = urllib.req
-0003d1c0: 7565 7374 2e75 726c 3270 6174 686e 616d  uest.url2pathnam
-0003d1d0: 6528 6872 6566 5b35 3a5d 290d 0a20 2020  e(href[5:])..   
-0003d1e0: 2020 2020 2020 2020 2069 6620 6669 6c65           if file
-0003d1f0: 7061 7468 2061 6e64 206f 732e 7061 7468  path and os.path
-0003d200: 2e65 7869 7374 7328 6669 6c65 7061 7468  .exists(filepath
-0003d210: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-0003d220: 2020 2020 7574 696c 2e73 7461 7274 5f66      util.start_f
-0003d230: 696c 6528 6669 6c65 7061 7468 290d 0a20  ile(filepath).. 
-0003d240: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0003d250: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0003d260: 2020 6d65 7373 6167 6542 6f78 280d 0a20    messageBox(.. 
-0003d270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003d280: 2020 2022 5468 6520 6669 6c65 205c 2225     "The file \"%
-0003d290: 735c 2220 6361 6e6e 6f74 2062 6520 666f  s\" cannot be fo
-0003d2a0: 756e 6420 6f6e 2074 6869 7320 636f 6d70  und on this comp
-0003d2b0: 7574 6572 2e22 0d0a 2020 2020 2020 2020  uter."..        
-0003d2c0: 2020 2020 2020 2020 2020 2020 2520 2866              % (f
-0003d2d0: 696c 6570 6174 6829 2c0d 0a20 2020 2020  ilepath),..     
-0003d2e0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0003d2f0: 6f6e 662e 5469 746c 652c 2077 782e 4f4b  onf.Title, wx.OK
-0003d300: 207c 2077 782e 4943 4f4e 5f49 4e46 4f52   | wx.ICON_INFOR
-0003d310: 4d41 5449 4f4e 0d0a 2020 2020 2020 2020  MATION..        
-0003d320: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
-0003d330: 2020 2065 6c69 6620 6872 6566 2e73 7461     elif href.sta
-0003d340: 7274 7377 6974 6828 2268 7474 703a 2229  rtswith("http:")
-0003d350: 206f 7220 6872 6566 2e73 7461 7274 7377   or href.startsw
-0003d360: 6974 6828 2268 7474 7073 3a22 293a 0d0a  ith("https:"):..
-0003d370: 2020 2020 2020 2020 2020 2020 7765 6262              webb
-0003d380: 726f 7773 6572 2e6f 7065 6e28 6872 6566  rowser.open(href
-0003d390: 290d 0a20 2020 2020 2020 2065 6c69 6620  )..        elif 
-0003d3a0: 6872 6566 2e73 7461 7274 7377 6974 6828  href.startswith(
-0003d3b0: 2273 6f72 743a 2f2f 2229 3a0d 0a20 2020  "sort://"):..   
-0003d3c0: 2020 2020 2020 2020 2073 656c 662e 7374           self.st
-0003d3d0: 6174 735f 736f 7274 5f66 6965 6c64 203d  ats_sort_field =
-0003d3e0: 2068 7265 665b 373a 5d0d 0a20 2020 2020   href[7:]..     
-0003d3f0: 2020 2020 2020 2073 656c 662e 706f 7075         self.popu
-0003d400: 6c61 7465 5f63 6861 745f 7374 6174 6973  late_chat_statis
-0003d410: 7469 6373 2829 0d0a 2020 2020 2020 2020  tics()..        
-0003d420: 656c 6966 2068 7265 662e 7374 6172 7473  elif href.starts
-0003d430: 7769 7468 2822 6578 7061 6e64 3a2f 2f22  with("expand://"
-0003d440: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-0003d450: 7365 6374 696f 6e20 3d20 6872 6566 5b39  section = href[9
-0003d460: 3a5d 0d0a 2020 2020 2020 2020 2020 2020  :]..            
-0003d470: 7365 6c66 2e73 7461 7473 5f65 7870 616e  self.stats_expan
-0003d480: 645b 7365 6374 696f 6e5d 203d 206e 6f74  d[section] = not
-0003d490: 2073 656c 662e 7374 6174 735f 6578 7061   self.stats_expa
-0003d4a0: 6e64 5b73 6563 7469 6f6e 5d0d 0a20 2020  nd[section]..   
-0003d4b0: 2020 2020 2020 2020 2073 656c 662e 706f           self.po
-0003d4c0: 7075 6c61 7465 5f63 6861 745f 7374 6174  pulate_chat_stat
-0003d4d0: 6973 7469 6373 2829 0d0a 2020 2020 2020  istics()..      
-0003d4e0: 2020 656c 6966 2068 7265 662e 7374 6172    elif href.star
-0003d4f0: 7473 7769 7468 2822 636f 6e74 6163 743a  tswith("contact:
-0003d500: 2229 3a0d 0a20 2020 2020 2020 2020 2020  "):..           
-0003d510: 2063 6f6e 7461 6374 6964 203d 2069 6e74   contactid = int
-0003d520: 2868 7265 665b 6872 6566 2e69 6e64 6578  (href[href.index
-0003d530: 2822 3a22 2920 2b20 313a 5d29 0d0a 2020  (":") + 1:])..  
-0003d540: 2020 2020 2020 2020 2020 636f 6e74 6163            contac
-0003d550: 7420 3d20 6e65 7874 2828 7820 666f 7220  t = next((x for 
-0003d560: 7820 696e 205b 7365 6c66 2e64 622e 6163  x in [self.db.ac
-0003d570: 636f 756e 745d 202b 2073 656c 662e 636f  count] + self.co
-0003d580: 6e74 6163 7473 2069 6620 785b 2269 6422  ntacts if x["id"
-0003d590: 5d20 3d3d 2063 6f6e 7461 6374 6964 292c  ] == contactid),
-0003d5a0: 204e 6f6e 6529 0d0a 2020 2020 2020 2020   None)..        
-0003d5b0: 2020 2020 6966 2063 6f6e 7461 6374 3a0d      if contact:.
-0003d5c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003d5d0: 2073 656c 662e 6e6f 7465 626f 6f6b 2e53   self.notebook.S
-0003d5e0: 6574 5365 6c65 6374 696f 6e28 7365 6c66  etSelection(self
-0003d5f0: 2e70 6167 656f 7264 6572 5b73 656c 662e  .pageorder[self.
-0003d600: 7061 6765 5f63 6f6e 7461 6374 735d 290d  page_contacts]).
-0003d610: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003d620: 2073 656c 662e 6c6f 6164 5f63 6f6e 7461   self.load_conta
-0003d630: 6374 2863 6f6e 7461 6374 290d 0a20 2020  ct(contact)..   
-0003d640: 2020 2020 2065 6c69 6620 6872 6566 2e73       elif href.s
-0003d650: 7461 7274 7377 6974 6828 226d 6573 7361  tartswith("messa
-0003d660: 6765 3a22 293a 0d0a 2020 2020 2020 2020  ge:"):..        
-0003d670: 2020 2020 7365 6c66 2e73 686f 775f 7374      self.show_st
-0003d680: 6174 7328 4661 6c73 6529 0d0a 2020 2020  ats(False)..    
-0003d690: 2020 2020 2020 2020 7365 6c66 2e73 7463          self.stc
-0003d6a0: 5f68 6973 746f 7279 2e46 6f63 7573 4d65  _history.FocusMe
-0003d6b0: 7373 6167 6528 696e 7428 6872 6566 5b38  ssage(int(href[8
-0003d6c0: 3a5d 2929 0d0a 2020 2020 2020 2020 656c  :]))..        el
-0003d6d0: 6966 2068 7265 6620 3d3d 2022 7069 6374  if href == "pict
-0003d6e0: 7572 6522 3a0d 0a20 2020 2020 2020 2020  ure":..         
-0003d6f0: 2020 2069 6d67 6b65 7920 3d20 2822 6368     imgkey = ("ch
-0003d700: 6174 222c 2073 656c 662e 6368 6174 5b22  at", self.chat["
-0003d710: 6964 225d 290d 0a20 2020 2020 2020 2020  id"])..         
-0003d720: 2020 2069 6d67 203d 2073 656c 662e 696d     img = self.im
-0003d730: 6167 6563 6163 6865 2e67 6574 2869 6d67  agecache.get(img
-0003d740: 6b65 7929 0d0a 2020 2020 2020 2020 2020  key)..          
-0003d750: 2020 6966 206e 6f74 2069 6d67 3a20 7265    if not img: re
-0003d760: 7475 726e 0d0a 0d0a 2020 2020 2020 2020  turn....        
-0003d770: 2020 2020 7365 6c66 2e64 6961 6c6f 675f      self.dialog_
-0003d780: 7361 7665 696d 6167 652e 4669 6c65 6e61  saveimage.Filena
-0003d790: 6d65 203d 2075 7469 6c2e 7361 6665 5f66  me = util.safe_f
-0003d7a0: 696c 656e 616d 6528 7365 6c66 2e63 6861  ilename(self.cha
-0003d7b0: 745b 2274 6974 6c65 5f6c 6f6e 6722 5d29  t["title_long"])
-0003d7c0: 0d0a 2020 2020 2020 2020 2020 2020 666d  ..            fm
-0003d7d0: 7420 3d20 6e65 7874 2828 6b20 666f 7220  t = next((k for 
-0003d7e0: 6b2c 2076 2069 6e20 6578 706f 7274 2e49  k, v in export.I
-0003d7f0: 4d41 4745 5f46 4f52 4d41 5453 2e69 7465  MAGE_FORMATS.ite
-0003d800: 6d73 2829 2069 6620 7620 3d3d 2069 6d67  ms() if v == img
-0003d810: 2e54 7970 6529 2c20 4e6f 6e65 290d 0a20  .Type), None).. 
-0003d820: 2020 2020 2020 2020 2020 2069 6620 666d             if fm
-0003d830: 743a 2073 656c 662e 6469 616c 6f67 5f73  t: self.dialog_s
-0003d840: 6176 6569 6d61 6765 2e46 696c 7465 7249  aveimage.FilterI
-0003d850: 6e64 6578 203d 2065 7870 6f72 742e 494d  ndex = export.IM
-0003d860: 4147 455f 4558 5453 2e69 6e64 6578 2866  AGE_EXTS.index(f
-0003d870: 6d74 290d 0a20 2020 2020 2020 2020 2020  mt)..           
-0003d880: 2069 6620 7778 2e49 445f 4f4b 2021 3d20   if wx.ID_OK != 
-0003d890: 7365 6c66 2e64 6961 6c6f 675f 7361 7665  self.dialog_save
-0003d8a0: 696d 6167 652e 5368 6f77 4d6f 6461 6c28  image.ShowModal(
-0003d8b0: 293a 2072 6574 7572 6e0d 0a0d 0a20 2020  ): return....   
-0003d8c0: 2020 2020 2020 2020 2066 696c 6570 6174           filepat
-0003d8d0: 6820 3d20 636f 6e74 726f 6c73 2e67 6574  h = controls.get
-0003d8e0: 5f64 6961 6c6f 675f 7061 7468 2873 656c  _dialog_path(sel
-0003d8f0: 662e 6469 616c 6f67 5f73 6176 6569 6d61  f.dialog_saveima
-0003d900: 6765 290d 0a20 2020 2020 2020 2020 2020  ge)..           
-0003d910: 2067 7569 6261 7365 2e73 7461 7475 7328   guibase.status(
-0003d920: 2745 7870 6f72 7469 6e67 2022 2573 222e  'Exporting "%s".
-0003d930: 272c 2066 696c 6570 6174 682c 206c 6f67  ', filepath, log
-0003d940: 3d54 7275 6529 0d0a 2020 2020 2020 2020  =True)..        
-0003d950: 2020 2020 6578 7420 3d20 6f73 2e70 6174      ext = os.pat
-0003d960: 682e 7370 6c69 7465 7874 2866 696c 6570  h.splitext(filep
-0003d970: 6174 6829 5b2d 315d 2e6c 7374 7269 7028  ath)[-1].lstrip(
-0003d980: 222e 2229 2e6c 6f77 6572 2829 0d0a 2020  ".").lower()..  
-0003d990: 2020 2020 2020 2020 2020 2320 4d61 6b65            # Make
-0003d9a0: 2063 6f70 7920 6173 2053 6176 6546 696c   copy as SaveFil
-0003d9b0: 6528 2920 636f 6e76 6572 7473 2069 6d61  e() converts ima
-0003d9c0: 6765 2066 6f72 6d61 740d 0a20 2020 2020  ge format..     
-0003d9d0: 2020 2020 2020 2069 6d67 2e43 6f70 7928         img.Copy(
-0003d9e0: 292e 5361 7665 4669 6c65 2866 696c 6570  ).SaveFile(filep
-0003d9f0: 6174 682c 2065 7870 6f72 742e 494d 4147  ath, export.IMAG
-0003da00: 455f 464f 524d 4154 535b 6578 745d 290d  E_FORMATS[ext]).
-0003da10: 0a20 2020 2020 2020 2020 2020 2075 7469  .            uti
-0003da20: 6c2e 7374 6172 745f 6669 6c65 2866 696c  l.start_file(fil
-0003da30: 6570 6174 6829 0d0a 2020 2020 2020 2020  epath)..        
-0003da40: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-0003da50: 2020 2073 656c 662e 7374 635f 6869 7374     self.stc_hist
-0003da60: 6f72 792e 5365 6172 6368 4261 7256 6973  ory.SearchBarVis
-0003da70: 6962 6c65 203d 2054 7275 650d 0a20 2020  ible = True..   
-0003da80: 2020 2020 2020 2020 2073 656c 662e 7368           self.sh
-0003da90: 6f77 5f73 7461 7473 2846 616c 7365 290d  ow_stats(False).
-0003daa0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0003dab0: 662e 7374 635f 6869 7374 6f72 792e 5365  f.stc_history.Se
-0003dac0: 6172 6368 2868 7265 662c 2066 6c61 6773  arch(href, flags
-0003dad0: 3d77 782e 7374 632e 5354 435f 4649 4e44  =wx.stc.STC_FIND
-0003dae0: 5f57 484f 4c45 574f 5244 290d 0a20 2020  _WHOLEWORD)..   
-0003daf0: 2020 2020 2020 2020 2073 656c 662e 7374           self.st
-0003db00: 635f 6869 7374 6f72 792e 5365 7446 6f63  c_history.SetFoc
-0003db10: 7573 5365 6172 6368 2829 0d0a 0d0a 0d0a  usSearch()......
-0003db20: 2020 2020 6465 6620 6f6e 5f63 6c69 636b      def on_click
-0003db30: 5f68 746d 6c5f 636f 6e74 6163 7428 7365  _html_contact(se
-0003db40: 6c66 2c20 6576 656e 7429 3a0d 0a20 2020  lf, event):..   
-0003db50: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-0003db60: 2020 4861 6e64 6c65 7220 666f 7220 636c    Handler for cl
-0003db70: 6963 6b69 6e67 2061 206c 696e 6b20 696e  icking a link in
-0003db80: 2063 6f6e 7461 6374 2070 6167 652c 2073   contact page, s
-0003db90: 6f72 7473 2063 6861 7473 2069 6620 736f  orts chats if so
-0003dba0: 7274 206c 696e 6b2c 2067 6f65 7320 746f  rt link, goes to
-0003dbb0: 0d0a 2020 2020 2020 2020 7370 6563 6966  ..        specif
-0003dbc0: 6963 206d 6573 7361 6765 2069 6620 6368  ic message if ch
-0003dbd0: 6174 206c 696e 6b2c 2073 6176 6573 2069  at link, saves i
-0003dbe0: 6d61 6765 2069 6620 696d 6167 6520 6c69  mage if image li
-0003dbf0: 6e6b 2e0d 0a20 2020 2020 2020 2022 2222  nk...        """
-0003dc00: 0d0a 2020 2020 2020 2020 6872 6566 2c20  ..        href, 
-0003dc10: 6874 6d6c 7769 6e64 6f77 203d 2065 7665  htmlwindow = eve
-0003dc20: 6e74 2e47 6574 4c69 6e6b 496e 666f 2829  nt.GetLinkInfo()
-0003dc30: 2e48 7265 662c 2065 7665 6e74 2e45 7665  .Href, event.Eve
-0003dc40: 6e74 4f62 6a65 6374 0d0a 2020 2020 2020  ntObject..      
-0003dc50: 2020 6966 2067 6574 6174 7472 2868 746d    if getattr(htm
-0003dc60: 6c77 696e 646f 772c 2022 6973 5f72 6967  lwindow, "is_rig
-0003dc70: 6874 636c 6963 6b22 2c20 4661 6c73 6529  htclick", False)
-0003dc80: 3a0d 0a0d 0a20 2020 2020 2020 2020 2020  :....           
-0003dc90: 2064 6566 206f 6e5f 636f 7079 2865 7665   def on_copy(eve
-0003dca0: 6e74 293a 0d0a 2020 2020 2020 2020 2020  nt):..          
-0003dcb0: 2020 2020 2020 6966 2077 782e 5468 6543        if wx.TheC
-0003dcc0: 6c69 7062 6f61 7264 2e4f 7065 6e28 293a  lipboard.Open():
-0003dcd0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0003dce0: 2020 2020 2020 7465 7874 203d 2068 746d        text = htm
-0003dcf0: 6c77 696e 646f 772e 5365 6c65 6374 696f  lwindow.Selectio
-0003dd00: 6e54 6f54 6578 7428 290d 0a20 2020 2020  nToText()..     
-0003dd10: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0003dd20: 203d 2077 782e 5465 7874 4461 7461 4f62   = wx.TextDataOb
-0003dd30: 6a65 6374 2874 6578 7429 0d0a 2020 2020  ject(text)..    
-0003dd40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003dd50: 7778 2e54 6865 436c 6970 626f 6172 642e  wx.TheClipboard.
-0003dd60: 5365 7444 6174 6128 6429 2c20 7778 2e54  SetData(d), wx.T
-0003dd70: 6865 436c 6970 626f 6172 642e 436c 6f73  heClipboard.Clos
-0003dd80: 6528 290d 0a0d 0a20 2020 2020 2020 2020  e()....         
-0003dd90: 2020 2064 6566 206f 6e5f 7365 6c65 6374     def on_select
-0003dda0: 616c 6c28 6576 656e 7429 3a0d 0a20 2020  all(event):..   
-0003ddb0: 2020 2020 2020 2020 2020 2020 2068 746d               htm
-0003ddc0: 6c77 696e 646f 772e 5365 6c65 6374 416c  lwindow.SelectAl
-0003ddd0: 6c28 290d 0a0d 0a20 2020 2020 2020 2020  l()....         
-0003dde0: 2020 2068 746d 6c77 696e 646f 772e 6973     htmlwindow.is
-0003ddf0: 5f72 6967 6874 636c 6963 6b20 3d20 4661  _rightclick = Fa
-0003de00: 6c73 650d 0a20 2020 2020 2020 2020 2020  lse..           
-0003de10: 206d 656e 7520 3d20 7778 2e4d 656e 7528   menu = wx.Menu(
-0003de20: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
-0003de30: 7465 6d5f 7365 6c65 6374 696f 6e20 3d20  tem_selection = 
-0003de40: 7778 2e4d 656e 7549 7465 6d28 6d65 6e75  wx.MenuItem(menu
-0003de50: 2c20 2d31 2c20 2226 436f 7079 2073 656c  , -1, "&Copy sel
-0003de60: 6563 7469 6f6e 2229 0d0a 2020 2020 2020  ection")..      
-0003de70: 2020 2020 2020 6974 656d 5f73 656c 6563        item_selec
-0003de80: 7461 6c6c 203d 2077 782e 4d65 6e75 4974  tall = wx.MenuIt
-0003de90: 656d 286d 656e 752c 202d 312c 2022 2653  em(menu, -1, "&S
-0003dea0: 656c 6563 7420 616c 6c22 290d 0a20 2020  elect all")..   
-0003deb0: 2020 2020 2020 2020 206d 656e 752e 4170           menu.Ap
-0003dec0: 7065 6e64 2869 7465 6d5f 7365 6c65 6374  pend(item_select
-0003ded0: 696f 6e29 0d0a 2020 2020 2020 2020 2020  ion)..          
-0003dee0: 2020 6d65 6e75 2e41 7070 656e 6428 6974    menu.Append(it
-0003def0: 656d 5f73 656c 6563 7461 6c6c 290d 0a20  em_selectall).. 
-0003df00: 2020 2020 2020 2020 2020 2069 7465 6d5f             item_
-0003df10: 7365 6c65 6374 696f 6e2e 456e 6162 6c65  selection.Enable
-0003df20: 2862 6f6f 6c28 6874 6d6c 7769 6e64 6f77  (bool(htmlwindow
-0003df30: 2e53 656c 6563 7469 6f6e 546f 5465 7874  .SelectionToText
-0003df40: 2829 2929 0d0a 2020 2020 2020 2020 2020  ()))..          
-0003df50: 2020 6d65 6e75 2e42 696e 6428 7778 2e45    menu.Bind(wx.E
-0003df60: 5654 5f4d 454e 552c 206f 6e5f 636f 7079  VT_MENU, on_copy
-0003df70: 2c20 2020 2020 2069 643d 6974 656d 5f73  ,      id=item_s
-0003df80: 656c 6563 7469 6f6e 2e47 6574 4964 2829  election.GetId()
-0003df90: 290d 0a20 2020 2020 2020 2020 2020 206d  )..            m
-0003dfa0: 656e 752e 4269 6e64 2877 782e 4556 545f  enu.Bind(wx.EVT_
-0003dfb0: 4d45 4e55 2c20 6f6e 5f73 656c 6563 7461  MENU, on_selecta
-0003dfc0: 6c6c 2c20 6964 3d69 7465 6d5f 7365 6c65  ll, id=item_sele
-0003dfd0: 6374 616c 6c2e 4765 7449 6428 2929 0d0a  ctall.GetId())..
-0003dfe0: 2020 2020 2020 2020 2020 2020 6874 6d6c              html
-0003dff0: 7769 6e64 6f77 2e50 6f70 7570 4d65 6e75  window.PopupMenu
-0003e000: 286d 656e 7529 0d0a 2020 2020 2020 2020  (menu)..        
-0003e010: 656c 6966 2068 7265 6620 3d3d 2022 6176  elif href == "av
-0003e020: 6174 6172 223a 0d0a 2020 2020 2020 2020  atar":..        
-0003e030: 2020 2020 696d 676b 6579 203d 2028 2261      imgkey = ("a
-0003e040: 7661 7461 7222 2c20 7365 6c66 2e63 6f6e  vatar", self.con
-0003e050: 7461 6374 5b22 6964 225d 290d 0a20 2020  tact["id"])..   
-0003e060: 2020 2020 2020 2020 2069 6d67 203d 2073           img = s
-0003e070: 656c 662e 696d 6167 6563 6163 6865 2e67  elf.imagecache.g
-0003e080: 6574 2869 6d67 6b65 7929 0d0a 2020 2020  et(imgkey)..    
-0003e090: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
-0003e0a0: 6d67 3a20 7265 7475 726e 0d0a 0d0a 2020  mg: return....  
-0003e0b0: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
-0003e0c0: 6961 6c6f 675f 7361 7665 696d 6167 652e  ialog_saveimage.
-0003e0d0: 4669 6c65 6e61 6d65 203d 2075 7469 6c2e  Filename = util.
-0003e0e0: 7361 6665 5f66 696c 656e 616d 6528 7365  safe_filename(se
-0003e0f0: 6c66 2e63 6f6e 7461 6374 5b22 6e61 6d65  lf.contact["name
-0003e100: 225d 290d 0a20 2020 2020 2020 2020 2020  "])..           
-0003e110: 2066 6d74 203d 206e 6578 7428 286b 2066   fmt = next((k f
-0003e120: 6f72 206b 2c20 7620 696e 2065 7870 6f72  or k, v in expor
-0003e130: 742e 494d 4147 455f 464f 524d 4154 532e  t.IMAGE_FORMATS.
-0003e140: 6974 656d 7328 2920 6966 2076 203d 3d20  items() if v == 
-0003e150: 696d 672e 5479 7065 292c 204e 6f6e 6529  img.Type), None)
-0003e160: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-0003e170: 2066 6d74 3a20 7365 6c66 2e64 6961 6c6f   fmt: self.dialo
-0003e180: 675f 7361 7665 696d 6167 652e 4669 6c74  g_saveimage.Filt
-0003e190: 6572 496e 6465 7820 3d20 6578 706f 7274  erIndex = export
-0003e1a0: 2e49 4d41 4745 5f45 5854 532e 696e 6465  .IMAGE_EXTS.inde
-0003e1b0: 7828 666d 7429 0d0a 2020 2020 2020 2020  x(fmt)..        
-0003e1c0: 2020 2020 6966 2077 782e 4944 5f4f 4b20      if wx.ID_OK 
-0003e1d0: 213d 2073 656c 662e 6469 616c 6f67 5f73  != self.dialog_s
-0003e1e0: 6176 6569 6d61 6765 2e53 686f 774d 6f64  aveimage.ShowMod
-0003e1f0: 616c 2829 3a20 7265 7475 726e 0d0a 0d0a  al(): return....
-0003e200: 2020 2020 2020 2020 2020 2020 6669 6c65              file
-0003e210: 7061 7468 203d 2063 6f6e 7472 6f6c 732e  path = controls.
-0003e220: 6765 745f 6469 616c 6f67 5f70 6174 6828  get_dialog_path(
-0003e230: 7365 6c66 2e64 6961 6c6f 675f 7361 7665  self.dialog_save
-0003e240: 696d 6167 6529 0d0a 2020 2020 2020 2020  image)..        
-0003e250: 2020 2020 6775 6962 6173 652e 7374 6174      guibase.stat
-0003e260: 7573 2827 4578 706f 7274 696e 6720 2225  us('Exporting "%
-0003e270: 7322 2e27 2c20 6669 6c65 7061 7468 2c20  s".', filepath, 
-0003e280: 6c6f 673d 5472 7565 290d 0a20 2020 2020  log=True)..     
-0003e290: 2020 2020 2020 2065 7874 203d 206f 732e         ext = os.
-0003e2a0: 7061 7468 2e73 706c 6974 6578 7428 6669  path.splitext(fi
-0003e2b0: 6c65 7061 7468 295b 2d31 5d2e 6c73 7472  lepath)[-1].lstr
-0003e2c0: 6970 2822 2e22 292e 6c6f 7765 7228 290d  ip(".").lower().
-0003e2d0: 0a20 2020 2020 2020 2020 2020 2023 204d  .            # M
-0003e2e0: 616b 6520 636f 7079 2061 7320 5361 7665  ake copy as Save
-0003e2f0: 4669 6c65 2829 2063 6f6e 7665 7274 7320  File() converts 
-0003e300: 696d 6167 6520 666f 726d 6174 0d0a 2020  image format..  
-0003e310: 2020 2020 2020 2020 2020 696d 672e 436f            img.Co
-0003e320: 7079 2829 2e53 6176 6546 696c 6528 6669  py().SaveFile(fi
-0003e330: 6c65 7061 7468 2c20 6578 706f 7274 2e49  lepath, export.I
-0003e340: 4d41 4745 5f46 4f52 4d41 5453 5b65 7874  MAGE_FORMATS[ext
-0003e350: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
-0003e360: 7574 696c 2e73 7461 7274 5f66 696c 6528  util.start_file(
-0003e370: 6669 6c65 7061 7468 290d 0a20 2020 2020  filepath)..     
-0003e380: 2020 2065 6c69 6620 6872 6566 2e73 7461     elif href.sta
-0003e390: 7274 7377 6974 6828 2273 6f72 743a 2f2f  rtswith("sort://
-0003e3a0: 2229 3a20 2320 736f 7274 3a2f 2f66 6965  "): # sort://fie
-0003e3b0: 6c64 0d0a 2020 2020 2020 2020 2020 2020  ld..            
-0003e3c0: 7365 6c66 2e63 6f6e 7461 6374 5f73 6f72  self.contact_sor
-0003e3d0: 745f 6669 656c 6420 3d20 6872 6566 5b37  t_field = href[7
-0003e3e0: 3a5d 0d0a 2020 2020 2020 2020 2020 2020  :]..            
-0003e3f0: 7365 6c66 2e6c 6f61 645f 636f 6e74 6163  self.load_contac
-0003e400: 7428 7365 6c66 2e63 6f6e 7461 6374 290d  t(self.contact).
-0003e410: 0a20 2020 2020 2020 2065 6c69 6620 6872  .        elif hr
-0003e420: 6566 2e73 7461 7274 7377 6974 6828 2265  ef.startswith("e
-0003e430: 7870 6f72 743a 2f2f 2229 3a20 2320 6578  xport://"): # ex
-0003e440: 706f 7274 3a2f 2f69 640d 0a20 2020 2020  port://id..     
-0003e450: 2020 2020 2020 2063 6861 7469 6420 3d20         chatid = 
-0003e460: 696e 7428 6872 6566 5b68 7265 662e 696e  int(href[href.in
-0003e470: 6465 7828 223a 2f2f 2229 202b 2033 3a5d  dex("://") + 3:]
-0003e480: 290d 0a20 2020 2020 2020 2020 2020 2063  )..            c
-0003e490: 6861 7420 3d20 6e65 7874 2878 2066 6f72  hat = next(x for
-0003e4a0: 2078 2069 6e20 7365 6c66 2e63 6861 7473   x in self.chats
-0003e4b0: 2069 6620 785b 2269 6422 5d20 3d3d 2063   if x["id"] == c
-0003e4c0: 6861 7469 6429 0d0a 2020 2020 2020 2020  hatid)..        
-0003e4d0: 2020 2020 7365 6c66 2e6f 6e5f 6578 706f      self.on_expo
-0003e4e0: 7274 5f63 6861 7473 285b 6368 6174 5d29  rt_chats([chat])
-0003e4f0: 0d0a 2020 2020 2020 2020 656c 6966 2068  ..        elif h
-0003e500: 7265 662e 7374 6172 7473 7769 7468 2822  ref.startswith("
-0003e510: 6368 6174 3a2f 2f22 293a 2023 2063 6861  chat://"): # cha
-0003e520: 743a 2f2f 6964 206f 7220 6368 6174 3a2f  t://id or chat:/
-0003e530: 2f69 642f 6d65 7373 6167 6569 640d 0a20  /id/messageid.. 
-0003e540: 2020 2020 2020 2020 2020 2070 6174 6820             path 
-0003e550: 3d20 6872 6566 5b68 7265 662e 696e 6465  = href[href.inde
-0003e560: 7828 223a 2f2f 2229 202b 2033 3a5d 0d0a  x("://") + 3:]..
-0003e570: 2020 2020 2020 2020 2020 2020 6966 2022              if "
-0003e580: 2f22 2069 6e20 7061 7468 3a0d 0a20 2020  /" in path:..   
-0003e590: 2020 2020 2020 2020 2020 2020 2063 6861               cha
-0003e5a0: 7469 642c 206d 6573 7361 6765 6964 203d  tid, messageid =
-0003e5b0: 206d 6170 2869 6e74 2c20 7061 7468 2e73   map(int, path.s
-0003e5c0: 706c 6974 2822 2f22 2c20 3129 290d 0a20  plit("/", 1)).. 
-0003e5d0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0003e5e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0003e5f0: 2020 6368 6174 6964 2c20 6d65 7373 6167    chatid, messag
-0003e600: 6569 6420 3d20 696e 7428 7061 7468 292c  eid = int(path),
-0003e610: 204e 6f6e 650d 0a20 2020 2020 2020 2020   None..         
-0003e620: 2020 2063 6861 7420 3d20 6e65 7874 2828     chat = next((
-0003e630: 7820 666f 7220 7820 696e 2073 656c 662e  x for x in self.
-0003e640: 6368 6174 7320 6966 2063 6861 7469 6420  chats if chatid 
-0003e650: 3d3d 2078 5b22 6964 225d 292c 204e 6f6e  == x["id"]), Non
-0003e660: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
-0003e670: 6966 2063 6861 743a 0d0a 2020 2020 2020  if chat:..      
-0003e680: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
-0003e690: 686f 775f 7374 6174 7328 4661 6c73 6529  how_stats(False)
-0003e6a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0003e6b0: 2020 7365 6c66 2e6e 6f74 6562 6f6f 6b2e    self.notebook.
-0003e6c0: 5365 7453 656c 6563 7469 6f6e 2873 656c  SetSelection(sel
-0003e6d0: 662e 7061 6765 6f72 6465 725b 7365 6c66  f.pageorder[self
-0003e6e0: 2e70 6167 655f 6368 6174 735d 290d 0a20  .page_chats]).. 
-0003e6f0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0003e700: 656c 662e 6c6f 6164 5f63 6861 7428 6368  elf.load_chat(ch
-0003e710: 6174 2c20 6365 6e74 6572 5f6d 6573 7361  at, center_messa
-0003e720: 6765 5f69 643d 6d65 7373 6167 6569 6429  ge_id=messageid)
-0003e730: 0d0a 0d0a 0d0a 2020 2020 6465 6620 6f6e  ......    def on
-0003e740: 5f72 6967 6874 636c 6963 6b5f 6874 6d6c  _rightclick_html
-0003e750: 2873 656c 662c 2065 7665 6e74 293a 0d0a  (self, event):..
-0003e760: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
-0003e770: 2020 2020 2048 616e 646c 6572 2066 6f72       Handler for
-0003e780: 2072 6967 6874 2d63 6c69 636b 696e 6720   right-clicking 
-0003e790: 696e 2048 746d 6c57 696e 646f 772c 2073  in HtmlWindow, s
-0003e7a0: 6574 7320 7570 2061 2074 656d 706f 7261  ets up a tempora
-0003e7b0: 7279 2066 6c61 6720 666f 720d 0a20 2020  ry flag for..   
-0003e7c0: 2020 2020 2048 544d 4c20 6c69 6e6b 2063       HTML link c
-0003e7d0: 6c69 636b 2068 616e 646c 6572 2074 6f20  lick handler to 
-0003e7e0: 6368 6563 6b2c 2069 6e20 6f72 6465 7220  check, in order 
-0003e7f0: 746f 2064 6973 706c 6179 2061 2063 6f6e  to display a con
-0003e800: 7465 7874 206d 656e 752e 0d0a 2020 2020  text menu...    
-0003e810: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
-0003e820: 2065 7665 6e74 2e45 7665 6e74 4f62 6a65   event.EventObje
-0003e830: 6374 2e69 735f 7269 6768 7463 6c69 636b  ct.is_rightclick
-0003e840: 203d 2054 7275 650d 0a20 2020 2020 2020   = True..       
-0003e850: 2064 6566 2072 6573 6574 2868 746d 6c77   def reset(htmlw
-0003e860: 696e 646f 7729 3a0d 0a20 2020 2020 2020  indow):..       
-0003e870: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
-0003e880: 206f 7220 6e6f 7420 6874 6d6c 7769 6e64   or not htmlwind
-0003e890: 6f77 2e69 735f 7269 6768 7463 6c69 636b  ow.is_rightclick
-0003e8a0: 3a20 7265 7475 726e 0d0a 2020 2020 2020  : return..      
-0003e8b0: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
-0003e8c0: 2020 2020 2020 2020 6465 6620 6f6e 5f63          def on_c
-0003e8d0: 6f70 7928 6576 656e 7429 3a0d 0a20 2020  opy(event):..   
-0003e8e0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0003e8f0: 7778 2e54 6865 436c 6970 626f 6172 642e  wx.TheClipboard.
-0003e900: 4f70 656e 2829 3a0d 0a20 2020 2020 2020  Open():..       
-0003e910: 2020 2020 2020 2020 2020 2020 2074 6578               tex
-0003e920: 7420 3d20 6874 6d6c 7769 6e64 6f77 2e53  t = htmlwindow.S
-0003e930: 656c 6563 7469 6f6e 546f 5465 7874 2829  electionToText()
-0003e940: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0003e950: 2020 2020 2020 6420 3d20 7778 2e54 6578        d = wx.Tex
-0003e960: 7444 6174 614f 626a 6563 7428 7465 7874  tDataObject(text
-0003e970: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0003e980: 2020 2020 2020 2077 782e 5468 6543 6c69         wx.TheCli
-0003e990: 7062 6f61 7264 2e53 6574 4461 7461 2864  pboard.SetData(d
-0003e9a0: 292c 2077 782e 5468 6543 6c69 7062 6f61  ), wx.TheClipboa
-0003e9b0: 7264 2e43 6c6f 7365 2829 0d0a 0d0a 2020  rd.Close()....  
-0003e9c0: 2020 2020 2020 2020 2020 6465 6620 6f6e            def on
-0003e9d0: 5f73 656c 6563 7461 6c6c 2865 7665 6e74  _selectall(event
-0003e9e0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-0003e9f0: 2020 2020 6874 6d6c 7769 6e64 6f77 2e53      htmlwindow.S
-0003ea00: 656c 6563 7441 6c6c 2829 0d0a 0d0a 2020  electAll()....  
-0003ea10: 2020 2020 2020 2020 2020 2320 466c 6167            # Flag
-0003ea20: 2073 7469 6c6c 2075 703a 2073 686f 7720   still up: show 
-0003ea30: 6d65 6e75 0d0a 2020 2020 2020 2020 2020  menu..          
-0003ea40: 2020 6874 6d6c 7769 6e64 6f77 2e69 735f    htmlwindow.is_
-0003ea50: 7269 6768 7463 6c69 636b 203d 2046 616c  rightclick = Fal
-0003ea60: 7365 0d0a 2020 2020 2020 2020 2020 2020  se..            
-0003ea70: 6d65 6e75 203d 2077 782e 4d65 6e75 2829  menu = wx.Menu()
-0003ea80: 0d0a 2020 2020 2020 2020 2020 2020 6974  ..            it
-0003ea90: 656d 5f73 656c 6563 7469 6f6e 203d 2077  em_selection = w
-0003eaa0: 782e 4d65 6e75 4974 656d 286d 656e 752c  x.MenuItem(menu,
-0003eab0: 202d 312c 2022 2643 6f70 7920 7365 6c65   -1, "&Copy sele
-0003eac0: 6374 696f 6e22 290d 0a20 2020 2020 2020  ction")..       
-0003ead0: 2020 2020 2069 7465 6d5f 7365 6c65 6374       item_select
-0003eae0: 616c 6c20 3d20 7778 2e4d 656e 7549 7465  all = wx.MenuIte
-0003eaf0: 6d28 6d65 6e75 2c20 2d31 2c20 2226 5365  m(menu, -1, "&Se
-0003eb00: 6c65 6374 2061 6c6c 2229 0d0a 2020 2020  lect all")..    
-0003eb10: 2020 2020 2020 2020 6d65 6e75 2e41 7070          menu.App
-0003eb20: 656e 6428 6974 656d 5f73 656c 6563 7469  end(item_selecti
-0003eb30: 6f6e 290d 0a20 2020 2020 2020 2020 2020  on)..           
-0003eb40: 206d 656e 752e 4170 7065 6e64 2869 7465   menu.Append(ite
-0003eb50: 6d5f 7365 6c65 6374 616c 6c29 0d0a 2020  m_selectall)..  
-0003eb60: 2020 2020 2020 2020 2020 6974 656d 5f73            item_s
-0003eb70: 656c 6563 7469 6f6e 2e45 6e61 626c 6528  election.Enable(
-0003eb80: 626f 6f6c 2868 746d 6c77 696e 646f 772e  bool(htmlwindow.
-0003eb90: 5365 6c65 6374 696f 6e54 6f54 6578 7428  SelectionToText(
-0003eba0: 2929 290d 0a20 2020 2020 2020 2020 2020  )))..           
-0003ebb0: 206d 656e 752e 4269 6e64 2877 782e 4556   menu.Bind(wx.EV
-0003ebc0: 545f 4d45 4e55 2c20 6f6e 5f63 6f70 792c  T_MENU, on_copy,
-0003ebd0: 2020 2020 2020 6964 3d69 7465 6d5f 7365        id=item_se
-0003ebe0: 6c65 6374 696f 6e2e 4765 7449 6428 2929  lection.GetId())
-0003ebf0: 0d0a 2020 2020 2020 2020 2020 2020 6d65  ..            me
-0003ec00: 6e75 2e42 696e 6428 7778 2e45 5654 5f4d  nu.Bind(wx.EVT_M
-0003ec10: 454e 552c 206f 6e5f 7365 6c65 6374 616c  ENU, on_selectal
-0003ec20: 6c2c 2069 643d 6974 656d 5f73 656c 6563  l, id=item_selec
-0003ec30: 7461 6c6c 2e47 6574 4964 2829 290d 0a20  tall.GetId()).. 
-0003ec40: 2020 2020 2020 2020 2020 2068 746d 6c77             htmlw
-0003ec50: 696e 646f 772e 506f 7075 704d 656e 7528  indow.PopupMenu(
-0003ec60: 6d65 6e75 290d 0a20 2020 2020 2020 2065  menu)..        e
-0003ec70: 7665 6e74 2e53 6b69 7028 292c 2077 782e  vent.Skip(), wx.
-0003ec80: 4361 6c6c 4166 7465 7228 7265 7365 742c  CallAfter(reset,
-0003ec90: 2065 7665 6e74 2e45 7665 6e74 4f62 6a65   event.EventObje
-0003eca0: 6374 290d 0a0d 0a0d 0a20 2020 2064 6566  ct)......    def
-0003ecb0: 206f 6e5f 636c 6963 6b5f 6874 6d6c 5f6c   on_click_html_l
-0003ecc0: 696e 6b28 7365 6c66 2c20 6576 656e 7429  ink(self, event)
-0003ecd0: 3a0d 0a20 2020 2020 2020 2022 2222 0d0a  :..        """..
-0003ece0: 2020 2020 2020 2020 4861 6e64 6c65 7220          Handler 
-0003ecf0: 666f 7220 636c 6963 6b69 6e67 2061 206c  for clicking a l
-0003ed00: 696e 6b20 696e 2048 746d 6c57 696e 646f  ink in HtmlWindo
-0003ed10: 772c 206f 7065 6e73 2074 6865 206c 696e  w, opens the lin
-0003ed20: 6b20 696e 7369 6465 0d0a 2020 2020 2020  k inside..      
-0003ed30: 2020 7072 6f67 7261 6d20 6f72 2069 6e20    program or in 
-0003ed40: 6465 6661 756c 7420 6272 6f77 7365 722c  default browser,
-0003ed50: 206f 7065 6e73 2061 2070 6f70 7570 6d65   opens a popupme
-0003ed60: 6e75 2069 6620 7269 6768 7420 636c 6963  nu if right clic
-0003ed70: 6b2e 0d0a 2020 2020 2020 2020 2222 220d  k...        """.
-0003ed80: 0a20 2020 2020 2020 2068 7265 662c 2068  .        href, h
-0003ed90: 746d 6c77 696e 646f 7720 3d20 6576 656e  tmlwindow = even
-0003eda0: 742e 4765 744c 696e 6b49 6e66 6f28 292e  t.GetLinkInfo().
-0003edb0: 4872 6566 2c20 6576 656e 742e 4576 656e  Href, event.Even
-0003edc0: 744f 626a 6563 740d 0a20 2020 2020 2020  tObject..       
-0003edd0: 206c 696e 6b5f 6461 7461 2c20 7461 625f   link_data, tab_
-0003ede0: 6461 7461 203d 204e 6f6e 652c 204e 6f6e  data = None, Non
-0003edf0: 650d 0a20 2020 2020 2020 2069 6620 6874  e..        if ht
-0003ee00: 6d6c 7769 6e64 6f77 2069 6e20 2873 656c  mlwindow in (sel
-0003ee10: 662e 6874 6d6c 5f73 6561 7263 6861 6c6c  f.html_searchall
-0003ee20: 2c20 7365 6c66 2e68 746d 6c5f 7365 6172  , self.html_sear
-0003ee30: 6368 616c 6c2e 4874 6d6c 5769 6e64 6f77  chall.HtmlWindow
-0003ee40: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-0003ee50: 7461 625f 6461 7461 203d 2073 656c 662e  tab_data = self.
-0003ee60: 6874 6d6c 5f73 6561 7263 6861 6c6c 2e47  html_searchall.G
-0003ee70: 6574 4163 7469 7665 5461 6244 6174 6128  etActiveTabData(
-0003ee80: 290d 0a20 2020 2020 2020 2069 6620 7461  )..        if ta
-0003ee90: 625f 6461 7461 2061 6e64 2074 6162 5f64  b_data and tab_d
-0003eea0: 6174 612e 6765 7428 2269 6e66 6f22 293a  ata.get("info"):
-0003eeb0: 0d0a 2020 2020 2020 2020 2020 2020 6c69  ..            li
-0003eec0: 6e6b 5f64 6174 6120 3d20 7461 625f 6461  nk_data = tab_da
-0003eed0: 7461 5b22 696e 666f 225d 5b22 6d61 7022  ta["info"]["map"
-0003eee0: 5d2e 6765 7428 6872 6566 2c20 7b7d 290d  ].get(href, {}).
-0003eef0: 0a0d 0a20 2020 2020 2020 2023 2057 6f72  ...        # Wor
-0003ef00: 6b61 726f 756e 6420 666f 7220 6e6f 2073  karound for no s
-0003ef10: 6570 6172 6174 6520 7778 2e68 746d 6c2e  eparate wx.html.
-0003ef20: 4874 6d6c 5769 6e64 6f77 206c 696e 6b20  HtmlWindow link 
-0003ef30: 7269 6768 7420 636c 6963 6b20 6576 656e  right click even
-0003ef40: 740d 0a20 2020 2020 2020 2069 6620 6765  t..        if ge
-0003ef50: 7461 7474 7228 6874 6d6c 7769 6e64 6f77  tattr(htmlwindow
-0003ef60: 2c20 2269 735f 7269 6768 7463 6c69 636b  , "is_rightclick
-0003ef70: 222c 2046 616c 7365 293a 0d0a 2020 2020  ", False):..    
-0003ef80: 2020 2020 2020 2020 2320 4f70 656e 2061          # Open a
-0003ef90: 2070 6f70 2d75 7020 6d65 6e75 2077 6974   pop-up menu wit
-0003efa0: 6820 6f70 7469 6f6e 7320 746f 2063 6f70  h options to cop
-0003efb0: 7920 6f72 2073 656c 6563 7420 7465 7874  y or select text
-0003efc0: 0d0a 2020 2020 2020 2020 2020 2020 6874  ..            ht
-0003efd0: 6d6c 7769 6e64 6f77 2e69 735f 7269 6768  mlwindow.is_righ
-0003efe0: 7463 6c69 636b 203d 2046 616c 7365 0d0a  tclick = False..
-0003eff0: 2020 2020 2020 2020 2020 2020 6465 6620              def 
-0003f000: 636c 6970 626f 6172 6469 7a65 2874 6578  clipboardize(tex
-0003f010: 7429 3a0d 0a20 2020 2020 2020 2020 2020  t):..           
-0003f020: 2020 2020 2069 6620 7778 2e54 6865 436c       if wx.TheCl
-0003f030: 6970 626f 6172 642e 4f70 656e 2829 3a0d  ipboard.Open():.
-0003f040: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003f050: 2020 2020 2064 203d 2077 782e 5465 7874       d = wx.Text
-0003f060: 4461 7461 4f62 6a65 6374 2874 6578 7429  DataObject(text)
-0003f070: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0003f080: 2020 2020 2020 7778 2e54 6865 436c 6970        wx.TheClip
-0003f090: 626f 6172 642e 5365 7444 6174 6128 6429  board.SetData(d)
-0003f0a0: 2c20 7778 2e54 6865 436c 6970 626f 6172  , wx.TheClipboar
-0003f0b0: 642e 436c 6f73 6528 290d 0a20 2020 2020  d.Close()..     
-0003f0c0: 2020 2020 2020 2063 6f70 7974 6974 6c65         copytitle
-0003f0d0: 203d 204e 6f6e 650d 0a20 2020 2020 2020   = None..       
-0003f0e0: 2020 2020 2069 6620 6c69 6e6b 5f64 6174       if link_dat
-0003f0f0: 613a 0d0a 2020 2020 2020 2020 2020 2020  a:..            
-0003f100: 2020 2020 6d73 675f 6964 2c20 6d20 3d20      msg_id, m = 
-0003f110: 6c69 6e6b 5f64 6174 612e 6765 7428 226d  link_data.get("m
-0003f120: 6573 7361 6765 2229 2c20 4e6f 6e65 0d0a  essage"), None..
-0003f130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f140: 6966 206d 7367 5f69 643a 0d0a 2020 2020  if msg_id:..    
-0003f150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f160: 636f 7079 7469 746c 6520 3d20 2243 266f  copytitle = "C&o
-0003f170: 7079 206d 6573 7361 6765 220d 0a20 2020  py message"..   
-0003f180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f190: 2064 6566 2068 616e 646c 6572 2865 293a   def handler(e):
-0003f1a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0003f1b0: 2020 2020 2020 2020 2020 6966 206d 7367            if msg
-0003f1c0: 5f69 643a 0d0a 2020 2020 2020 2020 2020  _id:..          
-0003f1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f1e0: 2020 6d20 3d20 6e65 7874 2873 656c 662e    m = next(self.
-0003f1f0: 6462 2e67 6574 5f6d 6573 7361 6765 7328  db.get_messages(
-0003f200: 6164 6469 7469 6f6e 616c 5f73 716c 3d22  additional_sql="
-0003f210: 6964 203d 203a 6964 222c 0d0a 2020 2020  id = :id",..    
+00037e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00037e20: 2020 2020 2020 2022 5365 6c65 6374 6564         "Selected
+00037e30: 2063 6861 7473 2069 6e74 6f20 696e 6469   chats into indi
+00037e40: 7669 6475 616c 2026 6669 6c65 7322 290d  vidual &files").
+00037e50: 0a20 2020 2020 2020 206d 656e 755f 6461  .        menu_da
+00037e60: 7465 2e41 7070 656e 6428 6974 656d 5f73  te.Append(item_s
+00037e70: 656c 5f64 6174 655f 6d75 6c74 6929 0d0a  el_date_multi)..
+00037e80: 2020 2020 2020 2020 6974 656d 5f73 656c          item_sel
+00037e90: 5f64 6174 655f 6d75 6c74 692e 456e 6162  _date_multi.Enab
+00037ea0: 6c65 286c 656e 2873 656c 6563 7465 6473  le(len(selecteds
+00037eb0: 2929 0d0a 2020 2020 2020 2020 7365 6c66  ))..        self
+00037ec0: 2e42 696e 6428 7778 2e45 5654 5f4d 454e  .Bind(wx.EVT_MEN
+00037ed0: 552c 2068 616e 646c 6572 2864 6f5f 7469  U, handler(do_ti
+00037ee0: 6d65 7261 6e67 653d 5472 7565 292c 2069  merange=True), i
+00037ef0: 7465 6d5f 7365 6c5f 6461 7465 5f6d 756c  tem_sel_date_mul
+00037f00: 7469 290d 0a20 2020 2020 2020 2069 6620  ti)..        if 
+00037f10: 6578 706f 7274 2e78 6c73 7877 7269 7465  export.xlsxwrite
+00037f20: 723a 0d0a 2020 2020 2020 2020 2020 2020  r:..            
+00037f30: 6974 656d 5f73 656c 5f64 6174 655f 7369  item_sel_date_si
+00037f40: 6e67 6c65 203d 2077 782e 4d65 6e75 4974  ngle = wx.MenuIt
+00037f50: 656d 286d 656e 755f 7365 6c2c 2077 782e  em(menu_sel, wx.
+00037f60: 4944 5f41 4e59 2c0d 0a20 2020 2020 2020  ID_ANY,..       
+00037f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00037f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00037f90: 2020 2020 2020 2020 2253 656c 6563 7465          "Selecte
+00037fa0: 6420 6368 6174 7320 696e 746f 2061 2073  d chats into a s
+00037fb0: 696e 676c 6520 2645 7863 656c 2077 6f72  ingle &Excel wor
+00037fc0: 6b62 6f6f 6b2c 2022 0d0a 2020 2020 2020  kbook, "..      
+00037fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00037fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00037ff0: 2020 2020 2020 2020 2022 7769 7468 2073           "with s
+00038000: 6570 6172 6174 6520 7368 6565 7473 2229  eparate sheets")
+00038010: 0d0a 2020 2020 2020 2020 2020 2020 6d65  ..            me
+00038020: 6e75 5f64 6174 652e 4170 7065 6e64 2869  nu_date.Append(i
+00038030: 7465 6d5f 7365 6c5f 6461 7465 5f73 696e  tem_sel_date_sin
+00038040: 676c 6529 0d0a 2020 2020 2020 2020 2020  gle)..          
+00038050: 2020 6974 656d 5f73 656c 5f64 6174 655f    item_sel_date_
+00038060: 7369 6e67 6c65 2e45 6e61 626c 6528 6c65  single.Enable(le
+00038070: 6e28 7365 6c65 6374 6564 7329 290d 0a20  n(selecteds)).. 
+00038080: 2020 2020 2020 2020 2020 206d 7968 616e             myhan
+00038090: 646c 6572 203d 2068 616e 646c 6572 2864  dler = handler(d
+000380a0: 6f5f 7369 6e67 6c65 6669 6c65 3d54 7275  o_singlefile=Tru
+000380b0: 652c 2064 6f5f 7469 6d65 7261 6e67 653d  e, do_timerange=
+000380c0: 5472 7565 290d 0a20 2020 2020 2020 2020  True)..         
+000380d0: 2020 2073 656c 662e 4269 6e64 2877 782e     self.Bind(wx.
+000380e0: 4556 545f 4d45 4e55 2c20 6d79 6861 6e64  EVT_MENU, myhand
+000380f0: 6c65 722c 2069 7465 6d5f 7365 6c5f 6461  ler, item_sel_da
+00038100: 7465 5f73 696e 676c 6529 0d0a 2020 2020  te_single)..    
+00038110: 2020 2020 6d65 6e75 5f64 6174 652e 4170      menu_date.Ap
+00038120: 7065 6e64 5365 7061 7261 746f 7228 290d  pendSeparator().
+00038130: 0a20 2020 2020 2020 2069 7465 6d5f 616c  .        item_al
+00038140: 6c5f 6461 7465 5f6d 756c 7469 203d 2077  l_date_multi = w
+00038150: 782e 4d65 6e75 4974 656d 286d 656e 755f  x.MenuItem(menu_
+00038160: 6461 7465 2c20 7778 2e49 445f 414e 592c  date, wx.ID_ANY,
+00038170: 2022 416c 6c20 6368 6174 7320 696e 746f   "All chats into
+00038180: 2026 696e 6469 7669 6475 616c 2066 696c   &individual fil
+00038190: 6573 2229 0d0a 2020 2020 2020 2020 6d65  es")..        me
+000381a0: 6e75 5f64 6174 652e 4170 7065 6e64 2869  nu_date.Append(i
+000381b0: 7465 6d5f 616c 6c5f 6461 7465 5f6d 756c  tem_all_date_mul
+000381c0: 7469 290d 0a20 2020 2020 2020 2073 656c  ti)..        sel
+000381d0: 662e 4269 6e64 2877 782e 4556 545f 4d45  f.Bind(wx.EVT_ME
+000381e0: 4e55 2c20 6861 6e64 6c65 7228 646f 5f61  NU, handler(do_a
+000381f0: 6c6c 3d54 7275 652c 2064 6f5f 7469 6d65  ll=True, do_time
+00038200: 7261 6e67 653d 5472 7565 292c 2069 7465  range=True), ite
+00038210: 6d5f 616c 6c5f 6461 7465 5f6d 756c 7469  m_all_date_multi
+00038220: 290d 0a20 2020 2020 2020 2069 6620 6578  )..        if ex
+00038230: 706f 7274 2e78 6c73 7877 7269 7465 723a  port.xlsxwriter:
+00038240: 0d0a 2020 2020 2020 2020 2020 2020 6974  ..            it
+00038250: 656d 5f61 6c6c 5f64 6174 655f 7369 6e67  em_all_date_sing
+00038260: 6c65 203d 2077 782e 4d65 6e75 4974 656d  le = wx.MenuItem
+00038270: 286d 656e 755f 616c 6c2c 2077 782e 4944  (menu_all, wx.ID
+00038280: 5f41 4e59 2c0d 0a20 2020 2020 2020 2020  _ANY,..         
+00038290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000382a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000382b0: 2020 2020 2020 2226 416c 6c20 6368 6174        "&All chat
+000382c0: 7320 696e 746f 2061 2073 696e 676c 6520  s into a single 
+000382d0: 4578 6365 6c20 776f 726b 626f 6f6b 2c20  Excel workbook, 
+000382e0: 220d 0a20 2020 2020 2020 2020 2020 2020  "..             
+000382f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038310: 2020 2277 6974 6820 7365 7061 7261 7465    "with separate
+00038320: 2073 6865 6574 7322 290d 0a20 2020 2020   sheets")..     
+00038330: 2020 2020 2020 206d 656e 755f 6461 7465         menu_date
+00038340: 2e41 7070 656e 6428 6974 656d 5f61 6c6c  .Append(item_all
+00038350: 5f64 6174 655f 7369 6e67 6c65 290d 0a20  _date_single).. 
+00038360: 2020 2020 2020 2020 2020 206d 7968 616e             myhan
+00038370: 646c 6572 203d 2068 616e 646c 6572 2864  dler = handler(d
+00038380: 6f5f 616c 6c3d 5472 7565 2c20 646f 5f73  o_all=True, do_s
+00038390: 696e 676c 6566 696c 653d 5472 7565 2c20  inglefile=True, 
+000383a0: 646f 5f74 696d 6572 616e 6765 3d54 7275  do_timerange=Tru
+000383b0: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+000383c0: 7365 6c66 2e42 696e 6428 7778 2e45 5654  self.Bind(wx.EVT
+000383d0: 5f4d 454e 552c 206d 7968 616e 646c 6572  _MENU, myhandler
+000383e0: 2c20 6974 656d 5f61 6c6c 5f64 6174 655f  , item_all_date_
+000383f0: 7369 6e67 6c65 290d 0a0d 0a20 2020 2020  single)....     
+00038400: 2020 2069 7465 6d5f 7365 6c20 203d 206d     item_sel  = m
+00038410: 656e 752e 4170 7065 6e64 5375 624d 656e  enu.AppendSubMen
+00038420: 7528 6d65 6e75 5f73 656c 2c20 2022 4578  u(menu_sel,  "Ex
+00038430: 706f 7274 2026 7365 6c65 6374 6564 2063  port &selected c
+00038440: 6861 7473 2229 0d0a 2020 2020 2020 2020  hats")..        
+00038450: 6974 656d 5f61 6c6c 2020 3d20 6d65 6e75  item_all  = menu
+00038460: 2e41 7070 656e 6453 7562 4d65 6e75 286d  .AppendSubMenu(m
+00038470: 656e 755f 616c 6c2c 2020 2245 7870 6f72  enu_all,  "Expor
+00038480: 7420 2661 6c6c 2063 6861 7473 2229 0d0a  t &all chats")..
+00038490: 2020 2020 2020 2020 6974 656d 5f64 6174          item_dat
+000384a0: 6520 3d20 6d65 6e75 2e41 7070 656e 6453  e = menu.AppendS
+000384b0: 7562 4d65 6e75 286d 656e 755f 6461 7465  ubMenu(menu_date
+000384c0: 2c20 2245 7870 6f72 7420 2664 6174 6520  , "Export &date 
+000384d0: 7261 6e67 6522 290d 0a20 2020 2020 2020  range")..       
+000384e0: 2069 7465 6d5f 7365 6c2e 456e 6162 6c65   item_sel.Enable
+000384f0: 286c 656e 2873 656c 6563 7465 6473 2929  (len(selecteds))
+00038500: 0d0a 2020 2020 2020 2020 6974 656d 5f61  ..        item_a
+00038510: 6c6c 2e45 6e61 626c 6528 626f 6f6c 2873  ll.Enable(bool(s
+00038520: 656c 662e 6c69 7374 5f63 6861 7473 2e47  elf.list_chats.G
+00038530: 6574 4974 656d 436f 756e 7428 2929 290d  etItemCount())).
+00038540: 0a20 2020 2020 2020 2069 7465 6d5f 6461  .        item_da
+00038550: 7465 2e45 6e61 626c 6528 626f 6f6c 2873  te.Enable(bool(s
+00038560: 656c 662e 6c69 7374 5f63 6861 7473 2e47  elf.list_chats.G
+00038570: 6574 4974 656d 436f 756e 7428 2929 290d  etItemCount())).
+00038580: 0a0d 0a20 2020 2020 2020 2065 7665 6e74  ...        event
+00038590: 2e45 7665 6e74 4f62 6a65 6374 2e50 6f70  .EventObject.Pop
+000385a0: 7570 4d65 6e75 286d 656e 752c 2028 302c  upMenu(menu, (0,
+000385b0: 2065 7665 6e74 2e45 7665 6e74 4f62 6a65   event.EventObje
+000385c0: 6374 2e53 697a 655b 315d 2929 0d0a 0d0a  ct.Size[1]))....
+000385d0: 0d0a 2020 2020 6465 6620 6f6e 5f65 7870  ..    def on_exp
+000385e0: 6f72 745f 636f 6e74 6163 7473 5f6d 656e  ort_contacts_men
+000385f0: 7528 7365 6c66 2c20 6576 656e 7429 3a0d  u(self, event):.
+00038600: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
+00038610: 2020 2020 2020 4861 6e64 6c65 7220 666f        Handler fo
+00038620: 7220 636c 6963 6b69 6e67 2074 6f20 6578  r clicking to ex
+00038630: 706f 7274 2073 656c 6563 7465 6420 6f72  port selected or
+00038640: 2061 6c6c 2063 6861 7473 206f 6620 636f   all chats of co
+00038650: 6e74 6163 7473 2c20 6469 7370 6c61 7973  ntacts, displays
+00038660: 2061 0d0a 2020 2020 2020 2020 7375 626d   a..        subm
+00038670: 656e 7520 7769 7468 2063 686f 6963 6573  enu with choices
+00038680: 2074 6f20 6578 706f 7274 2073 656c 6563   to export selec
+00038690: 7465 6420 6368 6174 7320 6f72 2061 6c6c  ted chats or all
+000386a0: 2063 6861 7473 2e0d 0a20 2020 2020 2020   chats...       
+000386b0: 2022 2222 0d0a 2020 2020 2020 2020 7365   """..        se
+000386c0: 6c65 6374 6564 2c20 7365 6c65 6374 6564  lected, selected
+000386d0: 7320 3d20 7365 6c66 2e6c 6973 745f 636f  s = self.list_co
+000386e0: 6e74 6163 7473 2e47 6574 4669 7273 7453  ntacts.GetFirstS
+000386f0: 656c 6563 7465 6428 292c 205b 5d0d 0a20  elected(), [].. 
+00038700: 2020 2020 2020 2077 6869 6c65 2073 656c         while sel
+00038710: 6563 7465 6420 3e3d 2030 3a0d 0a20 2020  ected >= 0:..   
+00038720: 2020 2020 2020 2020 2073 656c 6563 7465           selecte
+00038730: 6473 2e61 7070 656e 6428 7365 6c65 6374  ds.append(select
+00038740: 6564 290d 0a20 2020 2020 2020 2020 2020  ed)..           
+00038750: 2073 656c 6563 7465 6420 3d20 7365 6c66   selected = self
+00038760: 2e6c 6973 745f 636f 6e74 6163 7473 2e47  .list_contacts.G
+00038770: 6574 4e65 7874 5365 6c65 6374 6564 2873  etNextSelected(s
+00038780: 656c 6563 7465 6429 0d0a 0d0a 2020 2020  elected)....    
+00038790: 2020 2020 6465 6620 6861 6e64 6c65 7228      def handler(
+000387a0: 646f 5f61 6c6c 3d46 616c 7365 2c20 646f  do_all=False, do
+000387b0: 5f73 696e 676c 6566 696c 653d 4661 6c73  _singlefile=Fals
+000387c0: 652c 2064 6f5f 7469 6d65 7261 6e67 653d  e, do_timerange=
+000387d0: 4661 6c73 6529 3a0d 0a20 2020 2020 2020  False):..       
+000387e0: 2020 2020 2063 6f6e 7461 6374 7320 3d20       contacts = 
+000387f0: 5b73 656c 662e 6c69 7374 5f63 6f6e 7461  [self.list_conta
+00038800: 6374 732e 4765 7449 7465 6d4d 6170 7065  cts.GetItemMappe
+00038810: 6444 6174 6128 6929 0d0a 2020 2020 2020  dData(i)..      
+00038820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038830: 2020 666f 7220 6920 696e 2028 7261 6e67    for i in (rang
+00038840: 6528 7365 6c66 2e6c 6973 745f 636f 6e74  e(self.list_cont
+00038850: 6163 7473 2e49 7465 6d43 6f75 6e74 2920  acts.ItemCount) 
+00038860: 6966 2064 6f5f 616c 6c20 656c 7365 2073  if do_all else s
+00038870: 656c 6563 7465 6473 295d 0d0a 2020 2020  electeds)]..    
+00038880: 2020 2020 2020 2020 6368 6174 732c 2076          chats, v
+00038890: 6973 6974 6564 2c20 6368 6174 6d61 7020  isited, chatmap 
+000388a0: 3d20 5b5d 2c20 7365 7428 292c 207b 785b  = [], set(), {x[
+000388b0: 2269 6422 5d3a 2078 2066 6f72 2078 2069  "id"]: x for x i
+000388c0: 6e20 7365 6c66 2e63 6861 7473 7d0d 0a20  n self.chats}.. 
+000388d0: 2020 2020 2020 2020 2020 2066 6f72 2063             for c
+000388e0: 2069 6e20 636f 6e74 6163 7473 3a0d 0a20   in contacts:.. 
+000388f0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00038900: 6861 7473 2e65 7874 656e 6428 736f 7274  hats.extend(sort
+00038910: 6564 2828 6368 6174 6d61 705b 785b 2269  ed((chatmap[x["i
+00038920: 6422 5d5d 2066 6f72 2078 2069 6e20 632e  d"]] for x in c.
+00038930: 6765 7428 2263 6f6e 7665 7273 6174 696f  get("conversatio
+00038940: 6e73 222c 205b 5d29 0d0a 2020 2020 2020  ns", [])..      
+00038950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038960: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00038970: 2078 5b22 6964 225d 206e 6f74 2069 6e20   x["id"] not in 
+00038980: 7669 7369 7465 6429 2c0d 0a20 2020 2020  visited),..     
+00038990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000389a0: 2020 2020 2020 2020 2020 2020 2020 206b                 k
+000389b0: 6579 3d6c 616d 6264 6120 783a 2028 785b  ey=lambda x: (x[
+000389c0: 2274 7970 6522 5d2c 2078 5b22 7469 746c  "type"], x["titl
+000389d0: 655f 6c6f 6e67 225d 2e6c 6f77 6572 2829  e_long"].lower()
+000389e0: 2929 290d 0a20 2020 2020 2020 2020 2020  )))..           
+000389f0: 2020 2020 2076 6973 6974 6564 2e75 7064       visited.upd
+00038a00: 6174 6528 785b 2269 6422 5d20 666f 7220  ate(x["id"] for 
+00038a10: 7820 696e 2063 6861 7473 290d 0a20 2020  x in chats)..   
+00038a20: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00038a30: 6675 6e63 746f 6f6c 732e 7061 7274 6961  functools.partia
+00038a40: 6c28 7365 6c66 2e6f 6e5f 6578 706f 7274  l(self.on_export
+00038a50: 5f63 6861 7473 2c0d 0a20 2020 2020 2020  _chats,..       
+00038a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038a70: 2020 2020 2020 2020 2020 2020 2020 6368                ch
+00038a80: 6174 732c 2064 6f5f 616c 6c2c 2064 6f5f  ats, do_all, do_
+00038a90: 7369 6e67 6c65 6669 6c65 2c20 646f 5f74  singlefile, do_t
+00038aa0: 696d 6572 616e 6765 290d 0a0d 0a20 2020  imerange)....   
+00038ab0: 2020 2020 206d 656e 7520 3d20 7778 2e4d       menu = wx.M
+00038ac0: 656e 7528 290d 0a20 2020 2020 2020 206d  enu()..        m
+00038ad0: 656e 755f 7365 6c20 203d 2077 782e 4d65  enu_sel  = wx.Me
+00038ae0: 6e75 2829 0d0a 2020 2020 2020 2020 6d65  nu()..        me
+00038af0: 6e75 5f61 6c6c 2020 3d20 7778 2e4d 656e  nu_all  = wx.Men
+00038b00: 7528 290d 0a20 2020 2020 2020 206d 656e  u()..        men
+00038b10: 755f 6461 7465 203d 2077 782e 4d65 6e75  u_date = wx.Menu
+00038b20: 2829 0d0a 0d0a 2020 2020 2020 2020 6974  ()....        it
+00038b30: 656d 5f73 656c 5f6d 756c 7469 203d 2077  em_sel_multi = w
+00038b40: 782e 4d65 6e75 4974 656d 286d 656e 755f  x.MenuItem(menu_
+00038b50: 7365 6c2c 2077 782e 4944 5f41 4e59 2c20  sel, wx.ID_ANY, 
+00038b60: 2249 6e74 6f20 696e 6469 7669 6475 616c  "Into individual
+00038b70: 2026 6669 6c65 7322 290d 0a20 2020 2020   &files")..     
+00038b80: 2020 206d 656e 755f 7365 6c2e 4170 7065     menu_sel.Appe
+00038b90: 6e64 2869 7465 6d5f 7365 6c5f 6d75 6c74  nd(item_sel_mult
+00038ba0: 6929 0d0a 2020 2020 2020 2020 7365 6c66  i)..        self
+00038bb0: 2e42 696e 6428 7778 2e45 5654 5f4d 454e  .Bind(wx.EVT_MEN
+00038bc0: 552c 2068 616e 646c 6572 2829 2c20 6974  U, handler(), it
+00038bd0: 656d 5f73 656c 5f6d 756c 7469 290d 0a20  em_sel_multi).. 
+00038be0: 2020 2020 2020 2069 6620 6578 706f 7274         if export
+00038bf0: 2e78 6c73 7877 7269 7465 723a 0d0a 2020  .xlsxwriter:..  
+00038c00: 2020 2020 2020 2020 2020 6974 656d 5f73            item_s
+00038c10: 656c 5f73 696e 676c 6520 3d20 7778 2e4d  el_single = wx.M
+00038c20: 656e 7549 7465 6d28 6d65 6e75 5f73 656c  enuItem(menu_sel
+00038c30: 2c20 7778 2e49 445f 414e 592c 0d0a 2020  , wx.ID_ANY,..  
+00038c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038c60: 2020 2020 2020 2020 2249 6e74 6f20 6120          "Into a 
+00038c70: 7369 6e67 6c65 2026 4578 6365 6c20 776f  single &Excel wo
+00038c80: 726b 626f 6f6b 2c20 7769 7468 2073 6570  rkbook, with sep
+00038c90: 6172 6174 6520 7368 6565 7473 2229 0d0a  arate sheets")..
+00038ca0: 2020 2020 2020 2020 2020 2020 6d65 6e75              menu
+00038cb0: 5f73 656c 2e41 7070 656e 6428 6974 656d  _sel.Append(item
+00038cc0: 5f73 656c 5f73 696e 676c 6529 0d0a 2020  _sel_single)..  
+00038cd0: 2020 2020 2020 2020 2020 7365 6c66 2e42            self.B
+00038ce0: 696e 6428 7778 2e45 5654 5f4d 454e 552c  ind(wx.EVT_MENU,
+00038cf0: 2068 616e 646c 6572 2864 6f5f 7369 6e67   handler(do_sing
+00038d00: 6c65 6669 6c65 3d54 7275 6529 2c20 6974  lefile=True), it
+00038d10: 656d 5f73 656c 5f73 696e 676c 6529 0d0a  em_sel_single)..
+00038d20: 0d0a 2020 2020 2020 2020 6974 656d 5f61  ..        item_a
+00038d30: 6c6c 5f6d 756c 7469 203d 2077 782e 4d65  ll_multi = wx.Me
+00038d40: 6e75 4974 656d 286d 656e 755f 616c 6c2c  nuItem(menu_all,
+00038d50: 2077 782e 4944 5f41 4e59 2c20 2249 6e74   wx.ID_ANY, "Int
+00038d60: 6f20 696e 6469 7669 6475 616c 2026 6669  o individual &fi
+00038d70: 6c65 7322 290d 0a20 2020 2020 2020 206d  les")..        m
+00038d80: 656e 755f 616c 6c2e 4170 7065 6e64 2869  enu_all.Append(i
+00038d90: 7465 6d5f 616c 6c5f 6d75 6c74 6929 0d0a  tem_all_multi)..
+00038da0: 2020 2020 2020 2020 7365 6c66 2e42 696e          self.Bin
+00038db0: 6428 7778 2e45 5654 5f4d 454e 552c 2068  d(wx.EVT_MENU, h
+00038dc0: 616e 646c 6572 2864 6f5f 616c 6c3d 5472  andler(do_all=Tr
+00038dd0: 7565 292c 2069 7465 6d5f 616c 6c5f 6d75  ue), item_all_mu
+00038de0: 6c74 6929 0d0a 2020 2020 2020 2020 6966  lti)..        if
+00038df0: 2065 7870 6f72 742e 786c 7378 7772 6974   export.xlsxwrit
+00038e00: 6572 3a0d 0a20 2020 2020 2020 2020 2020  er:..           
+00038e10: 2069 7465 6d5f 616c 6c5f 7369 6e67 6c65   item_all_single
+00038e20: 203d 2077 782e 4d65 6e75 4974 656d 286d   = wx.MenuItem(m
+00038e30: 656e 755f 616c 6c2c 2077 782e 4944 5f41  enu_all, wx.ID_A
+00038e40: 4e59 2c0d 0a20 2020 2020 2020 2020 2020  NY,..           
+00038e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038e60: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00038e70: 496e 746f 2061 2073 696e 676c 6520 2645  Into a single &E
+00038e80: 7863 656c 2077 6f72 6b62 6f6f 6b2c 2077  xcel workbook, w
+00038e90: 6974 6820 7365 7061 7261 7465 2073 6865  ith separate she
+00038ea0: 6574 7322 290d 0a20 2020 2020 2020 2020  ets")..         
+00038eb0: 2020 206d 656e 755f 616c 6c2e 4170 7065     menu_all.Appe
+00038ec0: 6e64 2869 7465 6d5f 616c 6c5f 7369 6e67  nd(item_all_sing
+00038ed0: 6c65 290d 0a20 2020 2020 2020 2020 2020  le)..           
+00038ee0: 206d 7968 616e 646c 6572 203d 2068 616e   myhandler = han
+00038ef0: 646c 6572 2864 6f5f 616c 6c3d 5472 7565  dler(do_all=True
+00038f00: 2c20 646f 5f73 696e 676c 6566 696c 653d  , do_singlefile=
+00038f10: 5472 7565 290d 0a20 2020 2020 2020 2020  True)..         
+00038f20: 2020 2073 656c 662e 4269 6e64 2877 782e     self.Bind(wx.
+00038f30: 4556 545f 4d45 4e55 2c20 6d79 6861 6e64  EVT_MENU, myhand
+00038f40: 6c65 722c 2069 7465 6d5f 616c 6c5f 7369  ler, item_all_si
+00038f50: 6e67 6c65 290d 0a0d 0a20 2020 2020 2020  ngle)....       
+00038f60: 2069 7465 6d5f 7365 6c5f 6461 7465 5f6d   item_sel_date_m
+00038f70: 756c 7469 203d 2077 782e 4d65 6e75 4974  ulti = wx.MenuIt
+00038f80: 656d 286d 656e 755f 6461 7465 2c20 7778  em(menu_date, wx
+00038f90: 2e49 445f 414e 592c 0d0a 2020 2020 2020  .ID_ANY,..      
+00038fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038fc0: 2020 2020 2243 6861 7473 206f 6620 7365      "Chats of se
+00038fd0: 6c65 6374 6564 2063 6f6e 7461 6374 7320  lected contacts 
+00038fe0: 696e 746f 2069 6e64 6976 6964 7561 6c20  into individual 
+00038ff0: 2666 696c 6573 2229 0d0a 2020 2020 2020  &files")..      
+00039000: 2020 6d65 6e75 5f64 6174 652e 4170 7065    menu_date.Appe
+00039010: 6e64 2869 7465 6d5f 7365 6c5f 6461 7465  nd(item_sel_date
+00039020: 5f6d 756c 7469 290d 0a20 2020 2020 2020  _multi)..       
+00039030: 2069 7465 6d5f 7365 6c5f 6461 7465 5f6d   item_sel_date_m
+00039040: 756c 7469 2e45 6e61 626c 6528 6c65 6e28  ulti.Enable(len(
+00039050: 7365 6c65 6374 6564 7329 290d 0a20 2020  selecteds))..   
+00039060: 2020 2020 2073 656c 662e 4269 6e64 2877       self.Bind(w
+00039070: 782e 4556 545f 4d45 4e55 2c20 6861 6e64  x.EVT_MENU, hand
+00039080: 6c65 7228 646f 5f74 696d 6572 616e 6765  ler(do_timerange
+00039090: 3d54 7275 6529 2c20 6974 656d 5f73 656c  =True), item_sel
+000390a0: 5f64 6174 655f 6d75 6c74 6929 0d0a 2020  _date_multi)..  
+000390b0: 2020 2020 2020 6966 2065 7870 6f72 742e        if export.
+000390c0: 786c 7378 7772 6974 6572 3a0d 0a20 2020  xlsxwriter:..   
+000390d0: 2020 2020 2020 2020 2069 7465 6d5f 7365           item_se
+000390e0: 6c5f 6461 7465 5f73 696e 676c 6520 3d20  l_date_single = 
+000390f0: 7778 2e4d 656e 7549 7465 6d28 6d65 6e75  wx.MenuItem(menu
+00039100: 5f73 656c 2c20 7778 2e49 445f 414e 592c  _sel, wx.ID_ANY,
+00039110: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00039120: 2020 2243 6861 7473 206f 6620 7365 6c65    "Chats of sele
+00039130: 6374 6564 2063 6f6e 7461 6374 7320 696e  cted contacts in
+00039140: 746f 2061 2073 696e 676c 6520 2645 7863  to a single &Exc
+00039150: 656c 2077 6f72 6b62 6f6f 6b2c 2077 6974  el workbook, wit
+00039160: 6820 7365 7061 7261 7465 2073 6865 6574  h separate sheet
+00039170: 7322 290d 0a20 2020 2020 2020 2020 2020  s")..           
+00039180: 206d 656e 755f 6461 7465 2e41 7070 656e   menu_date.Appen
+00039190: 6428 6974 656d 5f73 656c 5f64 6174 655f  d(item_sel_date_
+000391a0: 7369 6e67 6c65 290d 0a20 2020 2020 2020  single)..       
+000391b0: 2020 2020 2069 7465 6d5f 7365 6c5f 6461       item_sel_da
+000391c0: 7465 5f73 696e 676c 652e 456e 6162 6c65  te_single.Enable
+000391d0: 286c 656e 2873 656c 6563 7465 6473 2929  (len(selecteds))
+000391e0: 0d0a 2020 2020 2020 2020 2020 2020 6d79  ..            my
+000391f0: 6861 6e64 6c65 7220 3d20 6861 6e64 6c65  handler = handle
+00039200: 7228 646f 5f73 696e 676c 6566 696c 653d  r(do_singlefile=
+00039210: 5472 7565 2c20 646f 5f74 696d 6572 616e  True, do_timeran
+00039220: 6765 3d54 7275 6529 0d0a 2020 2020 2020  ge=True)..      
+00039230: 2020 2020 2020 7365 6c66 2e42 696e 6428        self.Bind(
+00039240: 7778 2e45 5654 5f4d 454e 552c 206d 7968  wx.EVT_MENU, myh
+00039250: 616e 646c 6572 2c20 6974 656d 5f73 656c  andler, item_sel
+00039260: 5f64 6174 655f 7369 6e67 6c65 290d 0a20  _date_single).. 
+00039270: 2020 2020 2020 206d 656e 755f 6461 7465         menu_date
+00039280: 2e41 7070 656e 6453 6570 6172 6174 6f72  .AppendSeparator
+00039290: 2829 0d0a 2020 2020 2020 2020 6974 656d  ()..        item
+000392a0: 5f61 6c6c 5f64 6174 655f 6d75 6c74 6920  _all_date_multi 
+000392b0: 3d20 7778 2e4d 656e 7549 7465 6d28 6d65  = wx.MenuItem(me
+000392c0: 6e75 5f64 6174 652c 2077 782e 4944 5f41  nu_date, wx.ID_A
+000392d0: 4e59 2c0d 0a20 2020 2020 2020 2020 2020  NY,..           
+000392e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000392f0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00039300: 4368 6174 7320 6f66 2061 6c6c 2063 6f6e  Chats of all con
+00039310: 7461 6374 7320 696e 746f 2026 696e 6469  tacts into &indi
+00039320: 7669 6475 616c 2066 696c 6573 2229 0d0a  vidual files")..
+00039330: 2020 2020 2020 2020 6d65 6e75 5f64 6174          menu_dat
+00039340: 652e 4170 7065 6e64 2869 7465 6d5f 616c  e.Append(item_al
+00039350: 6c5f 6461 7465 5f6d 756c 7469 290d 0a20  l_date_multi).. 
+00039360: 2020 2020 2020 2073 656c 662e 4269 6e64         self.Bind
+00039370: 2877 782e 4556 545f 4d45 4e55 2c20 6861  (wx.EVT_MENU, ha
+00039380: 6e64 6c65 7228 646f 5f61 6c6c 3d54 7275  ndler(do_all=Tru
+00039390: 652c 2064 6f5f 7469 6d65 7261 6e67 653d  e, do_timerange=
+000393a0: 5472 7565 292c 2069 7465 6d5f 616c 6c5f  True), item_all_
+000393b0: 6461 7465 5f6d 756c 7469 290d 0a20 2020  date_multi)..   
+000393c0: 2020 2020 2069 6620 6578 706f 7274 2e78       if export.x
+000393d0: 6c73 7877 7269 7465 723a 0d0a 2020 2020  lsxwriter:..    
+000393e0: 2020 2020 2020 2020 6974 656d 5f61 6c6c          item_all
+000393f0: 5f64 6174 655f 7369 6e67 6c65 203d 2077  _date_single = w
+00039400: 782e 4d65 6e75 4974 656d 286d 656e 755f  x.MenuItem(menu_
+00039410: 616c 6c2c 2077 782e 4944 5f41 4e59 2c0d  all, wx.ID_ANY,.
+00039420: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00039430: 2022 4368 6174 7320 6f66 2026 616c 6c20   "Chats of &all 
+00039440: 636f 6e74 6163 7473 2069 6e74 6f20 6120  contacts into a 
+00039450: 7369 6e67 6c65 2045 7863 656c 2077 6f72  single Excel wor
+00039460: 6b62 6f6f 6b2c 2077 6974 6820 7365 7061  kbook, with sepa
+00039470: 7261 7465 2073 6865 6574 7322 290d 0a20  rate sheets").. 
+00039480: 2020 2020 2020 2020 2020 206d 656e 755f             menu_
+00039490: 6461 7465 2e41 7070 656e 6428 6974 656d  date.Append(item
+000394a0: 5f61 6c6c 5f64 6174 655f 7369 6e67 6c65  _all_date_single
+000394b0: 290d 0a20 2020 2020 2020 2020 2020 206d  )..            m
+000394c0: 7968 616e 646c 6572 203d 2068 616e 646c  yhandler = handl
+000394d0: 6572 2864 6f5f 616c 6c3d 5472 7565 2c20  er(do_all=True, 
+000394e0: 646f 5f73 696e 676c 6566 696c 653d 5472  do_singlefile=Tr
+000394f0: 7565 2c20 646f 5f74 696d 6572 616e 6765  ue, do_timerange
+00039500: 3d54 7275 6529 0d0a 2020 2020 2020 2020  =True)..        
+00039510: 2020 2020 7365 6c66 2e42 696e 6428 7778      self.Bind(wx
+00039520: 2e45 5654 5f4d 454e 552c 206d 7968 616e  .EVT_MENU, myhan
+00039530: 646c 6572 2c20 6974 656d 5f61 6c6c 5f64  dler, item_all_d
+00039540: 6174 655f 7369 6e67 6c65 290d 0a0d 0a20  ate_single).... 
+00039550: 2020 2020 2020 2069 7465 6d5f 7365 6c20         item_sel 
+00039560: 203d 206d 656e 752e 4170 7065 6e64 5375   = menu.AppendSu
+00039570: 624d 656e 7528 6d65 6e75 5f73 656c 2c20  bMenu(menu_sel, 
+00039580: 2022 4578 706f 7274 2063 6861 7473 206f   "Export chats o
+00039590: 6620 2673 656c 6563 7465 6420 636f 6e74  f &selected cont
+000395a0: 6163 7473 2229 0d0a 2020 2020 2020 2020  acts")..        
+000395b0: 6974 656d 5f61 6c6c 2020 3d20 6d65 6e75  item_all  = menu
+000395c0: 2e41 7070 656e 6453 7562 4d65 6e75 286d  .AppendSubMenu(m
+000395d0: 656e 755f 616c 6c2c 2020 2245 7870 6f72  enu_all,  "Expor
+000395e0: 7420 6368 6174 7320 6f66 2026 616c 6c20  t chats of &all 
+000395f0: 636f 6e74 6163 7473 2229 0d0a 2020 2020  contacts")..    
+00039600: 2020 2020 6974 656d 5f64 6174 6520 3d20      item_date = 
+00039610: 6d65 6e75 2e41 7070 656e 6453 7562 4d65  menu.AppendSubMe
+00039620: 6e75 286d 656e 755f 6461 7465 2c20 2245  nu(menu_date, "E
+00039630: 7870 6f72 7420 6368 6174 7320 696e 2026  xport chats in &
+00039640: 6461 7465 2072 616e 6765 2229 0d0a 2020  date range")..  
+00039650: 2020 2020 2020 6974 656d 5f73 656c 2e45        item_sel.E
+00039660: 6e61 626c 6528 6c65 6e28 7365 6c65 6374  nable(len(select
+00039670: 6564 7329 290d 0a20 2020 2020 2020 2069  eds))..        i
+00039680: 7465 6d5f 616c 6c2e 456e 6162 6c65 2862  tem_all.Enable(b
+00039690: 6f6f 6c28 7365 6c66 2e6c 6973 745f 6368  ool(self.list_ch
+000396a0: 6174 732e 4765 7449 7465 6d43 6f75 6e74  ats.GetItemCount
+000396b0: 2829 2929 0d0a 2020 2020 2020 2020 6974  ()))..        it
+000396c0: 656d 5f64 6174 652e 456e 6162 6c65 2862  em_date.Enable(b
+000396d0: 6f6f 6c28 7365 6c66 2e6c 6973 745f 6368  ool(self.list_ch
+000396e0: 6174 732e 4765 7449 7465 6d43 6f75 6e74  ats.GetItemCount
+000396f0: 2829 2929 0d0a 0d0a 2020 2020 2020 2020  ()))....        
+00039700: 6576 656e 742e 4576 656e 744f 626a 6563  event.EventObjec
+00039710: 742e 506f 7075 704d 656e 7528 6d65 6e75  t.PopupMenu(menu
+00039720: 2c20 2830 2c20 6576 656e 742e 4576 656e  , (0, event.Even
+00039730: 744f 626a 6563 742e 5369 7a65 5b31 5d29  tObject.Size[1])
+00039740: 290d 0a0d 0a0d 0a20 2020 2064 6566 206f  )......    def o
+00039750: 6e5f 6578 706f 7274 5f63 6f6e 7461 6374  n_export_contact
+00039760: 5f63 6861 7473 5f6d 656e 7528 7365 6c66  _chats_menu(self
+00039770: 2c20 6576 656e 7429 3a0d 0a20 2020 2020  , event):..     
+00039780: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
+00039790: 4861 6e64 6c65 7220 666f 7220 636c 6963  Handler for clic
+000397a0: 6b69 6e67 2074 6f20 6578 706f 7274 2063  king to export c
+000397b0: 6f6e 7461 6374 2063 6861 7473 2c20 6469  ontact chats, di
+000397c0: 7370 6c61 7973 2073 7562 6d65 6e75 2077  splays submenu w
+000397d0: 6974 6820 6368 6f69 6365 732e 0d0a 2020  ith choices...  
+000397e0: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
+000397f0: 2020 2064 6566 2068 616e 646c 6572 2864     def handler(d
+00039800: 6f5f 7369 6e67 6c65 6669 6c65 3d46 616c  o_singlefile=Fal
+00039810: 7365 2c20 646f 5f74 696d 6572 616e 6765  se, do_timerange
+00039820: 3d46 616c 7365 293a 0d0a 2020 2020 2020  =False):..      
+00039830: 2020 2020 2020 6368 6174 6d61 7020 3d20        chatmap = 
+00039840: 7b78 5b22 6964 225d 3a20 7820 666f 7220  {x["id"]: x for 
+00039850: 7820 696e 2073 656c 662e 6368 6174 737d  x in self.chats}
+00039860: 0d0a 2020 2020 2020 2020 2020 2020 6368  ..            ch
+00039870: 6174 7320 3d20 5b63 6861 746d 6170 5b78  ats = [chatmap[x
+00039880: 5b22 6964 225d 5d20 666f 7220 7820 696e  ["id"]] for x in
+00039890: 2073 656c 662e 636f 6e74 6163 742e 6765   self.contact.ge
+000398a0: 7428 2263 6f6e 7665 7273 6174 696f 6e73  t("conversations
+000398b0: 2229 206f 7220 5b5d 5d0d 0a20 2020 2020  ") or []]..     
+000398c0: 2020 2020 2020 2069 6620 646f 5f73 696e         if do_sin
+000398d0: 676c 6566 696c 653a 0d0a 2020 2020 2020  glefile:..      
+000398e0: 2020 2020 2020 2020 2020 646f 5f73 696e            do_sin
+000398f0: 676c 6566 696c 6520 3d20 2243 6861 7473  glefile = "Chats
+00039900: 2077 6974 6820 2573 2220 2520 2873 656c   with %s" % (sel
+00039910: 662e 636f 6e74 6163 745b 226e 616d 6522  f.contact["name"
+00039920: 5d20 6f72 2073 656c 662e 636f 6e74 6163  ] or self.contac
+00039930: 745b 2269 6465 6e74 6974 7922 5d29 0d0a  t["identity"])..
+00039940: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00039950: 726e 2066 756e 6374 6f6f 6c73 2e70 6172  rn functools.par
+00039960: 7469 616c 2873 656c 662e 6f6e 5f65 7870  tial(self.on_exp
+00039970: 6f72 745f 6368 6174 732c 0d0a 2020 2020  ort_chats,..    
+00039980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000399a0: 2063 6861 7473 2c20 4661 6c73 652c 2064   chats, False, d
+000399b0: 6f5f 7369 6e67 6c65 6669 6c65 2c20 646f  o_singlefile, do
+000399c0: 5f74 696d 6572 616e 6765 290d 0a0d 0a20  _timerange).... 
+000399d0: 2020 2020 2020 206d 656e 752c 2078 6d65         menu, xme
+000399e0: 6e75 203d 2077 782e 4d65 6e75 2829 2c20  nu = wx.Menu(), 
+000399f0: 4e6f 6e65 0d0a 2020 2020 2020 2020 6974  None..        it
+00039a00: 656d 5f66 696c 6573 203d 2077 782e 4d65  em_files = wx.Me
+00039a10: 6e75 4974 656d 286d 656e 752c 2077 782e  nuItem(menu, wx.
+00039a20: 4944 5f41 4e59 2c20 2254 6f20 696e 6469  ID_ANY, "To indi
+00039a30: 7669 6475 616c 2026 6669 6c65 7322 290d  vidual &files").
+00039a40: 0a20 2020 2020 2020 2069 7465 6d5f 6461  .        item_da
+00039a50: 7465 7320 3d20 7778 2e4d 656e 7549 7465  tes = wx.MenuIte
+00039a60: 6d28 6d65 6e75 2c20 7778 2e49 445f 414e  m(menu, wx.ID_AN
+00039a70: 592c 2022 2644 6174 6520 7261 6e67 6520  Y, "&Date range 
+00039a80: 746f 2069 6e64 6976 6964 7561 6c20 6669  to individual fi
+00039a90: 6c65 7322 290d 0a20 2020 2020 2020 206d  les")..        m
+00039aa0: 656e 752e 4170 7065 6e64 2869 7465 6d5f  enu.Append(item_
+00039ab0: 6669 6c65 7329 0d0a 2020 2020 2020 2020  files)..        
+00039ac0: 6d65 6e75 2e41 7070 656e 6428 6974 656d  menu.Append(item
+00039ad0: 5f64 6174 6573 290d 0a20 2020 2020 2020  _dates)..       
+00039ae0: 2069 6620 6578 706f 7274 2e78 6c73 7877   if export.xlsxw
+00039af0: 7269 7465 723a 0d0a 2020 2020 2020 2020  riter:..        
+00039b00: 2020 2020 786d 656e 7520 3d20 7778 2e4d      xmenu = wx.M
+00039b10: 656e 7528 290d 0a20 2020 2020 2020 2020  enu()..         
+00039b20: 2020 2069 7465 6d5f 6669 6c65 203d 2077     item_file = w
+00039b30: 782e 4d65 6e75 4974 656d 286d 656e 752c  x.MenuItem(menu,
+00039b40: 2077 782e 4944 5f41 4e59 2c20 2243 6861   wx.ID_ANY, "Cha
+00039b50: 7473 206f 6e20 2673 6570 6172 6174 6520  ts on &separate 
+00039b60: 7368 6565 7473 2229 0d0a 2020 2020 2020  sheets")..      
+00039b70: 2020 2020 2020 6974 656d 5f64 6174 6520        item_date 
+00039b80: 3d20 7778 2e4d 656e 7549 7465 6d28 6d65  = wx.MenuItem(me
+00039b90: 6e75 2c20 7778 2e49 445f 414e 592c 2022  nu, wx.ID_ANY, "
+00039ba0: 4368 6174 7320 696e 2026 6461 7465 2072  Chats in &date r
+00039bb0: 616e 6765 206f 6e20 7365 7061 7261 7465  ange on separate
+00039bc0: 2073 6865 6574 7322 290d 0a20 2020 2020   sheets")..     
+00039bd0: 2020 2020 2020 2078 6d65 6e75 2e41 7070         xmenu.App
+00039be0: 656e 6428 6974 656d 5f66 696c 6529 0d0a  end(item_file)..
+00039bf0: 2020 2020 2020 2020 2020 2020 786d 656e              xmen
+00039c00: 752e 4170 7065 6e64 2869 7465 6d5f 6461  u.Append(item_da
+00039c10: 7465 290d 0a20 2020 2020 2020 2020 2020  te)..           
+00039c20: 2073 656c 662e 4269 6e64 2877 782e 4556   self.Bind(wx.EV
+00039c30: 545f 4d45 4e55 2c20 6861 6e64 6c65 7228  T_MENU, handler(
+00039c40: 646f 5f73 696e 676c 6566 696c 653d 5472  do_singlefile=Tr
+00039c50: 7565 292c 2069 7465 6d5f 6669 6c65 290d  ue), item_file).
+00039c60: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00039c70: 662e 4269 6e64 2877 782e 4556 545f 4d45  f.Bind(wx.EVT_ME
+00039c80: 4e55 2c20 6861 6e64 6c65 7228 646f 5f73  NU, handler(do_s
+00039c90: 696e 676c 6566 696c 653d 5472 7565 2c20  inglefile=True, 
+00039ca0: 646f 5f74 696d 6572 616e 6765 3d54 7275  do_timerange=Tru
+00039cb0: 6529 2c20 6974 656d 5f64 6174 6529 0d0a  e), item_date)..
+00039cc0: 2020 2020 2020 2020 2020 2020 6d65 6e75              menu
+00039cd0: 2e41 7070 656e 6453 7562 4d65 6e75 2878  .AppendSubMenu(x
+00039ce0: 6d65 6e75 2c20 2254 6f20 6120 7369 6e67  menu, "To a sing
+00039cf0: 6c65 2045 7863 656c 2026 776f 726b 626f  le Excel &workbo
+00039d00: 6f6b 2229 0d0a 2020 2020 2020 2020 7365  ok")..        se
+00039d10: 6c66 2e42 696e 6428 7778 2e45 5654 5f4d  lf.Bind(wx.EVT_M
+00039d20: 454e 552c 2068 616e 646c 6572 2829 2c20  ENU, handler(), 
+00039d30: 6974 656d 5f66 696c 6573 290d 0a20 2020  item_files)..   
+00039d40: 2020 2020 2073 656c 662e 4269 6e64 2877       self.Bind(w
+00039d50: 782e 4556 545f 4d45 4e55 2c20 6861 6e64  x.EVT_MENU, hand
+00039d60: 6c65 7228 646f 5f74 696d 6572 616e 6765  ler(do_timerange
+00039d70: 3d54 7275 6529 2c20 6974 656d 5f64 6174  =True), item_dat
+00039d80: 6573 290d 0a0d 0a20 2020 2020 2020 2065  es)....        e
+00039d90: 7665 6e74 2e45 7665 6e74 4f62 6a65 6374  vent.EventObject
+00039da0: 2e50 6f70 7570 4d65 6e75 286d 656e 752c  .PopupMenu(menu,
+00039db0: 2028 302c 2065 7665 6e74 2e45 7665 6e74   (0, event.Event
+00039dc0: 4f62 6a65 6374 2e53 697a 655b 315d 2929  Object.Size[1]))
+00039dd0: 0d0a 0d0a 0d0a 2020 2020 6465 6620 6f6e  ......    def on
+00039de0: 5f65 7870 6f72 745f 636f 6e74 6163 7473  _export_contacts
+00039df0: 2873 656c 662c 2065 7665 6e74 293a 0d0a  (self, event):..
+00039e00: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
+00039e10: 2020 2020 2048 616e 646c 6572 2066 6f72       Handler for
+00039e20: 2063 6c69 636b 696e 6720 746f 2065 7870   clicking to exp
+00039e30: 6f72 7420 636f 6e74 6163 7473 2c20 6469  ort contacts, di
+00039e40: 7370 6c61 7920 6669 6c65 2064 6961 6c6f  splay file dialo
+00039e50: 6720 616e 6420 7361 7665 7320 7370 7265  g and saves spre
+00039e60: 6164 7368 6565 742e 0d0a 2020 2020 2020  adsheet...      
+00039e70: 2020 2222 220d 0a20 2020 2020 2020 2063    """..        c
+00039e80: 6f6e 7461 6374 7320 3d20 5b73 656c 662e  ontacts = [self.
+00039e90: 6c69 7374 5f63 6f6e 7461 6374 732e 4765  list_contacts.Ge
+00039ea0: 7449 7465 6d4d 6170 7065 6444 6174 6128  tItemMappedData(
+00039eb0: 7829 0d0a 2020 2020 2020 2020 2020 2020  x)..            
+00039ec0: 2020 2020 2020 2020 666f 7220 7820 696e          for x in
+00039ed0: 2072 616e 6765 2873 656c 662e 6c69 7374   range(self.list
+00039ee0: 5f63 6f6e 7461 6374 732e 4974 656d 436f  _contacts.ItemCo
+00039ef0: 756e 7429 5d0d 0a20 2020 2020 2020 2069  unt)]..        i
+00039f00: 6620 6e6f 7420 636f 6e74 6163 7473 3a20  f not contacts: 
+00039f10: 7265 7475 726e 0d0a 0d0a 2020 2020 2020  return....      
+00039f20: 2020 666f 726d 6174 6172 6773 203d 2063    formatargs = c
+00039f30: 6f6c 6c65 6374 696f 6e73 2e64 6566 6175  ollections.defau
+00039f40: 6c74 6469 6374 2873 7472 290d 0a20 2020  ltdict(str)..   
+00039f50: 2020 2020 2066 6f72 6d61 7461 7267 735b       formatargs[
+00039f60: 2273 6b79 7065 6e61 6d65 225d 203d 206f  "skypename"] = o
+00039f70: 732e 7061 7468 2e62 6173 656e 616d 6528  s.path.basename(
+00039f80: 7365 6c66 2e64 622e 6669 6c65 6e61 6d65  self.db.filename
+00039f90: 290d 0a20 2020 2020 2020 2066 6f72 6d61  )..        forma
+00039fa0: 7461 7267 732e 7570 6461 7465 2873 656c  targs.update(sel
+00039fb0: 662e 6462 2e61 6363 6f75 6e74 206f 7220  f.db.account or 
+00039fc0: 7b7d 290d 0a20 2020 2020 2020 206e 616d  {})..        nam
+00039fd0: 6520 3d20 7574 696c 2e73 6166 655f 6669  e = util.safe_fi
+00039fe0: 6c65 6e61 6d65 2863 6f6e 662e 4578 706f  lename(conf.Expo
+00039ff0: 7274 436f 6e74 6163 7473 5465 6d70 6c61  rtContactsTempla
+0003a000: 7465 2025 2066 6f72 6d61 7461 7267 7329  te % formatargs)
+0003a010: 0d0a 2020 2020 2020 2020 7365 6c66 2e64  ..        self.d
+0003a020: 6961 6c6f 675f 7361 7665 636f 6e74 6163  ialog_savecontac
+0003a030: 7473 2e46 696c 656e 616d 6520 3d20 6e61  ts.Filename = na
+0003a040: 6d65 0d0a 2020 2020 2020 2020 6966 2077  me..        if w
+0003a050: 782e 4944 5f4f 4b20 213d 2073 656c 662e  x.ID_OK != self.
+0003a060: 6469 616c 6f67 5f73 6176 6563 6f6e 7461  dialog_saveconta
+0003a070: 6374 732e 5368 6f77 4d6f 6461 6c28 293a  cts.ShowModal():
+0003a080: 2072 6574 7572 6e0d 0a0d 0a20 2020 2020   return....     
+0003a090: 2020 2062 7573 7920 3d20 636f 6e74 726f     busy = contro
+0003a0a0: 6c73 2e42 7573 7950 616e 656c 2873 656c  ls.BusyPanel(sel
+0003a0b0: 662c 2022 4578 706f 7274 696e 6720 636f  f, "Exporting co
+0003a0c0: 6e74 6163 7473 2e22 290d 0a20 2020 2020  ntacts.")..     
+0003a0d0: 2020 2066 696c 6570 6174 6820 3d20 636f     filepath = co
+0003a0e0: 6e74 726f 6c73 2e67 6574 5f64 6961 6c6f  ntrols.get_dialo
+0003a0f0: 675f 7061 7468 2873 656c 662e 6469 616c  g_path(self.dial
+0003a100: 6f67 5f73 6176 6563 6f6e 7461 6374 7329  og_savecontacts)
+0003a110: 0d0a 2020 2020 2020 2020 666f 726d 6174  ..        format
+0003a120: 203d 2065 7870 6f72 742e 434f 4e54 4143   = export.CONTAC
+0003a130: 545f 4558 5453 5b73 656c 662e 6469 616c  T_EXTS[self.dial
+0003a140: 6f67 5f73 6176 6563 6f6e 7461 6374 732e  og_savecontacts.
+0003a150: 4669 6c74 6572 496e 6465 785d 0d0a 2020  FilterIndex]..  
+0003a160: 2020 2020 2020 6775 6962 6173 652e 7374        guibase.st
+0003a170: 6174 7573 2822 4578 706f 7274 696e 6720  atus("Exporting 
+0003a180: 2573 2e22 2c20 6669 6c65 7061 7468 2c20  %s.", filepath, 
+0003a190: 6c6f 673d 5472 7565 290d 0a20 2020 2020  log=True)..     
+0003a1a0: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
+0003a1b0: 2020 2020 2065 7870 6f72 742e 6578 706f       export.expo
+0003a1c0: 7274 5f63 6f6e 7461 6374 7328 636f 6e74  rt_contacts(cont
+0003a1d0: 6163 7473 2c20 6669 6c65 7061 7468 2c20  acts, filepath, 
+0003a1e0: 666f 726d 6174 2c20 7365 6c66 2e64 6229  format, self.db)
+0003a1f0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+0003a200: 2063 6f6e 662e 4578 706f 7274 4669 6c65   conf.ExportFile
+0003a210: 4175 746f 4f70 656e 3a20 7574 696c 2e73  AutoOpen: util.s
+0003a220: 7461 7274 5f66 696c 6528 6669 6c65 7061  tart_file(filepa
+0003a230: 7468 290d 0a20 2020 2020 2020 2066 696e  th)..        fin
+0003a240: 616c 6c79 3a0d 0a20 2020 2020 2020 2020  ally:..         
+0003a250: 2020 2062 7573 792e 436c 6f73 6528 290d     busy.Close().
+0003a260: 0a0d 0a0d 0a20 2020 2064 6566 206f 6e5f  .....    def on_
+0003a270: 6578 706f 7274 5f63 6861 7473 2873 656c  export_chats(sel
+0003a280: 662c 2063 6861 7473 2c20 646f 5f61 6c6c  f, chats, do_all
+0003a290: 3d46 616c 7365 2c20 646f 5f73 696e 676c  =False, do_singl
+0003a2a0: 6566 696c 653d 4661 6c73 652c 2064 6f5f  efile=False, do_
+0003a2b0: 7469 6d65 7261 6e67 653d 4661 6c73 652c  timerange=False,
+0003a2c0: 2065 7665 6e74 3d4e 6f6e 6529 3a0d 0a20   event=None):.. 
+0003a2d0: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
+0003a2e0: 2020 2020 4861 6e64 6c65 7220 666f 7220      Handler for 
+0003a2f0: 636c 6963 6b69 6e67 2074 6f20 6578 706f  clicking to expo
+0003a300: 7274 2073 656c 6563 7465 6420 6f72 2061  rt selected or a
+0003a310: 6c6c 2063 6861 7473 2c20 6469 7370 6c61  ll chats, displa
+0003a320: 7973 2061 2073 656c 6563 740d 0a20 2020  ys a select..   
+0003a330: 2020 2020 2066 6f6c 6465 7220 6469 616c       folder dial
+0003a340: 6f67 2061 6e64 2065 7870 6f72 7473 2063  og and exports c
+0003a350: 6861 7473 2074 6f20 696e 6469 7669 6475  hats to individu
+0003a360: 616c 2066 696c 6573 2075 6e64 6572 2074  al files under t
+0003a370: 6865 2066 6f6c 6465 722e 0d0a 0d0a 2020  he folder.....  
+0003a380: 2020 2020 2020 4070 6172 616d 2020 2063        @param   c
+0003a390: 6861 7473 2020 2020 2020 2020 2020 6c69  hats          li
+0003a3a0: 7374 206f 6620 636f 6e76 6572 7361 7469  st of conversati
+0003a3b0: 6f6e 7320 746f 2065 7870 6f72 740d 0a20  ons to export.. 
+0003a3c0: 2020 2020 2020 2040 7061 7261 6d20 2020         @param   
+0003a3d0: 646f 5f61 6c6c 2020 2020 2020 2020 2077  do_all         w
+0003a3e0: 6865 7468 6572 2074 6f20 6578 706f 7274  hether to export
+0003a3f0: 2061 6c6c 2063 6861 7473 2c20 6576 656e   all chats, even
+0003a400: 2074 686f 7365 2077 6974 6820 6e6f 206d   those with no m
+0003a410: 6573 7361 6765 730d 0a20 2020 2020 2020  essages..       
+0003a420: 2040 7061 7261 6d20 2020 646f 5f73 696e   @param   do_sin
+0003a430: 676c 6566 696c 6520 2077 6865 7468 6572  glefile  whether
+0003a440: 2074 6f20 6578 706f 7274 2061 2073 696e   to export a sin
+0003a450: 676c 652d 6669 6c65 2058 4c53 582c 0d0a  gle-file XLSX,..
+0003a460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a480: 6f70 7469 6f6e 616c 6c79 2063 6f6e 7461  optionally conta
+0003a490: 696e 696e 6720 7468 6520 6669 6c65 206e  ining the file n
+0003a4a0: 616d 650d 0a20 2020 2020 2020 2040 7061  ame..        @pa
+0003a4b0: 7261 6d20 2020 646f 5f74 696d 6572 616e  ram   do_timeran
+0003a4c0: 6765 2020 2077 6865 7468 6572 2074 6f20  ge   whether to 
+0003a4d0: 706f 7020 7570 2064 6961 6c6f 6773 2074  pop up dialogs t
+0003a4e0: 6f20 7365 6c65 6374 2065 7870 6f72 7420  o select export 
+0003a4f0: 6461 7465 2072 616e 6765 0d0a 2020 2020  date range..    
+0003a500: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
+0003a510: 2069 6620 6e6f 7420 6368 6174 733a 2072   if not chats: r
+0003a520: 6574 7572 6e0d 0a0d 0a20 2020 2020 2020  eturn....       
+0003a530: 2074 696d 6572 616e 6765 203d 204e 6f6e   timerange = Non
+0003a540: 650d 0a20 2020 2020 2020 2069 6620 646f  e..        if do
+0003a550: 5f74 696d 6572 616e 6765 3a0d 0a20 2020  _timerange:..   
+0003a560: 2020 2020 2020 2020 2074 696d 6572 616e           timeran
+0003a570: 6765 203d 205b 5d0d 0a20 2020 2020 2020  ge = []..       
+0003a580: 2020 2020 2066 6f72 206c 6162 656c 2069       for label i
+0003a590: 6e20 2822 7374 6172 7422 2c20 2265 6e64  n ("start", "end
+0003a5a0: 2229 3a0d 0a20 2020 2020 2020 2020 2020  "):..           
+0003a5b0: 2020 2020 2065 7874 7261 203d 2022 656e       extra = "en
+0003a5c0: 6420 6174 206c 6173 7422 2069 6620 2265  d at last" if "e
+0003a5d0: 6e64 2220 3d3d 206c 6162 656c 2065 6c73  nd" == label els
+0003a5e0: 6520 2273 7461 7274 2066 726f 6d20 6669  e "start from fi
+0003a5f0: 7273 7422 0d0a 2020 2020 2020 2020 2020  rst"..          
+0003a600: 2020 2020 2020 6469 616c 6f67 203d 2077        dialog = w
+0003a610: 782e 5465 7874 456e 7472 7944 6961 6c6f  x.TextEntryDialo
+0003a620: 6728 7365 6c66 2c0d 0a20 2020 2020 2020  g(self,..       
+0003a630: 2020 2020 2020 2020 2020 2020 2022 456e               "En
+0003a640: 7465 7220 2573 2064 6174 6520 6173 2059  ter %s date as Y
+0003a650: 5959 592d 4d4d 2d44 442c 206f 7220 6c65  YYY-MM-DD, or le
+0003a660: 6176 6520 626c 616e 6b20 746f 2025 733a  ave blank to %s:
+0003a670: 2220 2520 286c 6162 656c 2c20 6578 7472  " % (label, extr
+0003a680: 6129 2c0d 0a20 2020 2020 2020 2020 2020  a),..           
+0003a690: 2020 2020 2020 2020 2022 4461 7465 2072           "Date r
+0003a6a0: 616e 6765 222c 2073 7479 6c65 3d77 782e  ange", style=wx.
+0003a6b0: 4f4b 207c 2077 782e 4341 4e43 454c 290d  OK | wx.CANCEL).
+0003a6c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003a6d0: 2064 6961 6c6f 672e 4365 6e74 6572 4f6e   dialog.CenterOn
+0003a6e0: 5061 7265 6e74 2829 0d0a 2020 2020 2020  Parent()..      
+0003a6f0: 2020 2020 2020 2020 2020 6966 2077 782e            if wx.
+0003a700: 4944 5f4f 4b20 213d 2064 6961 6c6f 672e  ID_OK != dialog.
+0003a710: 5368 6f77 4d6f 6461 6c28 293a 2072 6574  ShowModal(): ret
+0003a720: 7572 6e0d 0a0d 0a20 2020 2020 2020 2020  urn....         
+0003a730: 2020 2020 2020 2076 2c20 6474 203d 2064         v, dt = d
+0003a740: 6961 6c6f 672e 4765 7456 616c 7565 2829  ialog.GetValue()
+0003a750: 2e73 7472 6970 2829 2c20 4e6f 6e65 0d0a  .strip(), None..
+0003a760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a770: 7472 793a 0d0a 2020 2020 2020 2020 2020  try:..          
+0003a780: 2020 2020 2020 2020 2020 6966 2076 3a20            if v: 
+0003a790: 6474 203d 2064 6174 6574 696d 652e 6461  dt = datetime.da
+0003a7a0: 7465 7469 6d65 2e73 7472 7074 696d 6528  tetime.strptime(
+0003a7b0: 762c 2022 2559 2d25 6d2d 2564 2229 2e64  v, "%Y-%m-%d").d
+0003a7c0: 6174 6528 290d 0a20 2020 2020 2020 2020  ate()..         
+0003a7d0: 2020 2020 2020 2065 7863 6570 7420 4578         except Ex
+0003a7e0: 6365 7074 696f 6e3a 0d0a 2020 2020 2020  ception:..      
+0003a7f0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0003a800: 7475 726e 2077 782e 4d65 7373 6167 6542  turn wx.MessageB
+0003a810: 6f78 2822 496e 7661 6c69 6420 6461 7465  ox("Invalid date
+0003a820: 2076 616c 7565 3a20 2725 7327 2e22 2025   value: '%s'." %
+0003a830: 2076 2c0d 0a20 2020 2020 2020 2020 2020   v,..           
+0003a840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a850: 2020 2020 2020 2020 2020 2020 2020 636f                co
+0003a860: 6e66 2e54 6974 6c65 2c20 7778 2e4f 4b20  nf.Title, wx.OK 
+0003a870: 7c20 7778 2e49 434f 4e5f 5741 524e 494e  | wx.ICON_WARNIN
+0003a880: 4729 0d0a 2020 2020 2020 2020 2020 2020  G)..            
+0003a890: 2020 2020 7469 6d65 7261 6e67 652e 6170      timerange.ap
+0003a8a0: 7065 6e64 2875 7469 6c2e 6461 7465 7469  pend(util.dateti
+0003a8b0: 6d65 5f74 6f5f 6570 6f63 6828 6474 2929  me_to_epoch(dt))
+0003a8c0: 0d0a 0d0a 2020 2020 2020 2020 6469 616c  ....        dial
+0003a8d0: 6f67 203d 2073 656c 662e 6469 616c 6f67  og = self.dialog
+0003a8e0: 5f73 6176 6563 6861 7473 5f73 696e 676c  _savechats_singl
+0003a8f0: 6566 696c 6520 6966 2064 6f5f 7369 6e67  efile if do_sing
+0003a900: 6c65 6669 6c65 2065 6c73 6520 5c0d 0a20  lefile else \.. 
+0003a910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a920: 7365 6c66 2e64 6961 6c6f 675f 7361 7665  self.dialog_save
+0003a930: 6368 6174 2069 6620 6c65 6e28 6368 6174  chat if len(chat
+0003a940: 7329 203d 3d20 3120 656c 7365 2073 656c  s) == 1 else sel
+0003a950: 662e 6469 616c 6f67 5f73 6176 6563 6861  f.dialog_savecha
+0003a960: 7473 0d0a 0d0a 2020 2020 2020 2020 6966  ts....        if
+0003a970: 2064 6f5f 7369 6e67 6c65 6669 6c65 3a0d   do_singlefile:.
+0003a980: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0003a990: 6973 696e 7374 616e 6365 2864 6f5f 7369  isinstance(do_si
+0003a9a0: 6e67 6c65 6669 6c65 2c20 7369 782e 7374  nglefile, six.st
+0003a9b0: 7269 6e67 5f74 7970 6573 293a 0d0a 2020  ring_types):..  
+0003a9c0: 2020 2020 2020 2020 2020 2020 2020 6465                de
+0003a9d0: 6661 756c 7420 3d20 646f 5f73 696e 676c  fault = do_singl
+0003a9e0: 6566 696c 650d 0a20 2020 2020 2020 2020  efile..         
+0003a9f0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+0003aa00: 2020 2020 2020 2020 2020 666f 726d 6174            format
+0003aa10: 6172 6773 203d 2063 6f6c 6c65 6374 696f  args = collectio
+0003aa20: 6e73 2e64 6566 6175 6c74 6469 6374 2873  ns.defaultdict(s
+0003aa30: 7472 290d 0a20 2020 2020 2020 2020 2020  tr)..           
+0003aa40: 2020 2020 2066 6f72 6d61 7461 7267 735b       formatargs[
+0003aa50: 2273 6b79 7065 6e61 6d65 225d 203d 206f  "skypename"] = o
+0003aa60: 732e 7061 7468 2e62 6173 656e 616d 6528  s.path.basename(
+0003aa70: 7365 6c66 2e64 622e 6669 6c65 6e61 6d65  self.db.filename
+0003aa80: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0003aa90: 2020 2066 6f72 6d61 7461 7267 732e 7570     formatargs.up
+0003aaa0: 6461 7465 2873 656c 662e 6462 2e61 6363  date(self.db.acc
+0003aab0: 6f75 6e74 206f 7220 7b7d 290d 0a20 2020  ount or {})..   
+0003aac0: 2020 2020 2020 2020 2020 2020 2064 6566               def
+0003aad0: 6175 6c74 203d 2063 6f6e 662e 4578 706f  ault = conf.Expo
+0003aae0: 7274 4462 5465 6d70 6c61 7465 2025 2066  rtDbTemplate % f
+0003aaf0: 6f72 6d61 7461 7267 730d 0a20 2020 2020  ormatargs..     
+0003ab00: 2020 2020 2020 2064 6961 6c6f 672e 4669         dialog.Fi
+0003ab10: 6c65 6e61 6d65 203d 2075 7469 6c2e 7361  lename = util.sa
+0003ab20: 6665 5f66 696c 656e 616d 6528 6465 6661  fe_filename(defa
+0003ab30: 756c 7429 0d0a 2020 2020 2020 2020 656c  ult)..        el
+0003ab40: 6966 206c 656e 2863 6861 7473 2920 3d3d  if len(chats) ==
+0003ab50: 2031 3a0d 0a20 2020 2020 2020 2020 2020   1:..           
+0003ab60: 2066 6f72 6d61 7461 7267 7320 3d20 636f   formatargs = co
+0003ab70: 6c6c 6563 7469 6f6e 732e 6465 6661 756c  llections.defaul
+0003ab80: 7464 6963 7428 7374 7229 3b20 666f 726d  tdict(str); form
+0003ab90: 6174 6172 6773 2e75 7064 6174 6528 6368  atargs.update(ch
+0003aba0: 6174 735b 305d 290d 0a20 2020 2020 2020  ats[0])..       
+0003abb0: 2020 2020 2064 6566 6175 6c74 203d 2075       default = u
+0003abc0: 7469 6c2e 7361 6665 5f66 696c 656e 616d  til.safe_filenam
+0003abd0: 6528 636f 6e66 2e45 7870 6f72 7443 6861  e(conf.ExportCha
+0003abe0: 7454 656d 706c 6174 6520 2520 666f 726d  tTemplate % form
+0003abf0: 6174 6172 6773 290d 0a20 2020 2020 2020  atargs)..       
+0003ac00: 2020 2020 2064 6961 6c6f 672e 4669 6c65       dialog.File
+0003ac10: 6e61 6d65 203d 2064 6566 6175 6c74 0d0a  name = default..
+0003ac20: 2020 2020 2020 2020 6966 2077 782e 4944          if wx.ID
+0003ac30: 5f4f 4b20 213d 2064 6961 6c6f 672e 5368  _OK != dialog.Sh
+0003ac40: 6f77 4d6f 6461 6c28 293a 2072 6574 7572  owModal(): retur
+0003ac50: 6e0d 0a0d 0a20 2020 2020 2020 2070 6174  n....        pat
+0003ac60: 682c 206d 6564 6961 5f66 6f6c 6465 7220  h, media_folder 
+0003ac70: 3d20 636f 6e74 726f 6c73 2e67 6574 5f64  = controls.get_d
+0003ac80: 6961 6c6f 675f 7061 7468 2864 6961 6c6f  ialog_path(dialo
+0003ac90: 6729 2c20 4661 6c73 650d 0a20 2020 2020  g), False..     
+0003aca0: 2020 2069 6620 646f 5f73 696e 676c 6566     if do_singlef
+0003acb0: 696c 653a 0d0a 2020 2020 2020 2020 2020  ile:..          
+0003acc0: 2020 666f 726d 6174 203d 2065 7870 6f72    format = expor
+0003acd0: 742e 4348 4154 5f45 5854 535f 5349 4e47  t.CHAT_EXTS_SING
+0003ace0: 4c45 4649 4c45 5b64 6961 6c6f 672e 4669  LEFILE[dialog.Fi
+0003acf0: 6c74 6572 496e 6465 785d 0d0a 2020 2020  lterIndex]..    
+0003ad00: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+0003ad10: 2020 2020 2020 2069 6620 6c65 6e28 6368         if len(ch
+0003ad20: 6174 7329 203e 2031 3a20 7061 7468 203d  ats) > 1: path =
+0003ad30: 206f 732e 7061 7468 2e64 6972 6e61 6d65   os.path.dirname
+0003ad40: 2870 6174 6829 0d0a 2020 2020 2020 2020  (path)..        
+0003ad50: 2020 2020 666f 726d 6174 203d 2065 7870      format = exp
+0003ad60: 6f72 742e 4348 4154 5f45 5854 535b 6469  ort.CHAT_EXTS[di
+0003ad70: 616c 6f67 2e46 696c 7465 7249 6e64 6578  alog.FilterIndex
+0003ad80: 5d0d 0a20 2020 2020 2020 2020 2020 206d  ]..            m
+0003ad90: 6564 6961 5f66 6f6c 6465 7220 3d20 2268  edia_folder = "h
+0003ada0: 746d 6c22 203d 3d20 666f 726d 6174 2061  tml" == format a
+0003adb0: 6e64 205c 0d0a 2020 2020 2020 2020 2020  nd \..          
+0003adc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003add0: 2064 6961 6c6f 672e 4669 6c74 6572 496e   dialog.FilterIn
+0003ade0: 6465 7820 213d 2065 7870 6f72 742e 4348  dex != export.CH
+0003adf0: 4154 5f45 5854 532e 696e 6465 7828 2268  AT_EXTS.index("h
+0003ae00: 746d 6c22 290d 0a0d 0a20 2020 2020 2020  tml")....       
+0003ae10: 2069 6620 6d65 6469 615f 666f 6c64 6572   if media_folder
+0003ae20: 2061 6e64 206e 6f74 2063 6865 636b 5f6d   and not check_m
+0003ae30: 6564 6961 5f65 7870 6f72 745f 6c6f 6769  edia_export_logi
+0003ae40: 6e28 7365 6c66 2e64 6229 3a20 7265 7475  n(self.db): retu
+0003ae50: 726e 0d0a 0d0a 2020 2020 2020 2020 6d73  rn....        ms
+0003ae60: 6720 3d20 2745 7870 6f72 7469 6e67 2074  g = 'Exporting t
+0003ae70: 6f20 2573 2e27 2025 2070 6174 6820 6966  o %s.' % path if
+0003ae80: 206c 656e 2863 6861 7473 2920 3d3d 2031   len(chats) == 1
+0003ae90: 2061 6e64 206e 6f74 2064 6f5f 7369 6e67   and not do_sing
+0003aea0: 6c65 6669 6c65 205c 0d0a 2020 2020 2020  lefile \..      
+0003aeb0: 2020 656c 7365 2020 2745 7870 6f72 7469    else  'Exporti
+0003aec0: 6e67 2025 7363 6861 7473 2066 726f 6d20  ng %schats from 
+0003aed0: 2225 7322 5c6e 6173 2025 7320 756e 6465  "%s"\nas %s unde
+0003aee0: 7220 2573 2e27 2025 205c 0d0a 2020 2020  r %s.' % \..    
+0003aef0: 2020 2020 2020 2020 2020 2822 616c 6c20            ("all 
+0003af00: 2220 6966 2064 6f5f 616c 6c20 656c 7365  " if do_all else
+0003af10: 2022 222c 2073 656c 662e 6462 2e66 696c   "", self.db.fil
+0003af20: 656e 616d 652c 2066 6f72 6d61 742e 7570  ename, format.up
+0003af30: 7065 7228 292c 2070 6174 6829 0d0a 2020  per(), path)..  
+0003af40: 2020 2020 2020 6275 7379 203d 2063 6f6e        busy = con
+0003af50: 7472 6f6c 732e 4275 7379 5061 6e65 6c28  trols.BusyPanel(
+0003af60: 7365 6c66 2c20 6d73 6729 0d0a 2020 2020  self, msg)..    
+0003af70: 2020 2020 6775 6962 6173 652e 7374 6174      guibase.stat
+0003af80: 7573 286d 7367 2c20 6c6f 673d 5472 7565  us(msg, log=True
+0003af90: 290d 0a20 2020 2020 2020 2066 696c 6573  )..        files
+0003afa0: 2c20 636f 756e 742c 206d 6573 7361 6765  , count, message
+0003afb0: 5f63 6f75 6e74 2c20 6572 726f 726d 7367  _count, errormsg
+0003afc0: 2c20 6572 726f 726d 7367 5f73 686f 7274  , errormsg_short
+0003afd0: 203d 205b 5d2c 2030 2c20 302c 204e 6f6e   = [], 0, 0, Non
+0003afe0: 652c 204e 6f6e 650d 0a20 2020 2020 2020  e, None..       
+0003aff0: 2074 7279 3a0d 0a20 2020 2020 2020 2020   try:..         
+0003b000: 2020 2070 726f 6772 6573 7366 756e 6320     progressfunc 
+0003b010: 3d20 6c61 6d62 6461 202a 6172 6773 3a20  = lambda *args: 
+0003b020: 7778 2e53 6166 6559 6965 6c64 2829 0d0a  wx.SafeYield()..
+0003b030: 2020 2020 2020 2020 2020 2020 6f70 7473              opts
+0003b040: 203d 2064 6963 7428 6d75 6c74 693d 6e6f   = dict(multi=no
+0003b050: 7420 646f 5f73 696e 676c 6566 696c 6520  t do_singlefile 
+0003b060: 616e 6420 6c65 6e28 6368 6174 7329 203e  and len(chats) >
+0003b070: 2031 2c20 6e6f 736b 6970 3d6e 6f74 2064   1, noskip=not d
+0003b080: 6f5f 616c 6c2c 0d0a 2020 2020 2020 2020  o_all,..        
+0003b090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003b0a0: 7072 6f67 7265 7373 3d70 726f 6772 6573  progress=progres
+0003b0b0: 7366 756e 632c 2074 696d 6572 616e 6765  sfunc, timerange
+0003b0c0: 3d74 696d 6572 616e 6765 290d 0a20 2020  =timerange)..   
+0003b0d0: 2020 2020 2020 2020 2069 6620 6d65 6469           if medi
+0003b0e0: 615f 666f 6c64 6572 3a20 6f70 7473 5b22  a_folder: opts["
+0003b0f0: 6d65 6469 615f 666f 6c64 6572 225d 203d  media_folder"] =
+0003b100: 2054 7275 650d 0a20 2020 2020 2020 2020   True..         
+0003b110: 2020 2072 6573 756c 7420 3d20 6578 706f     result = expo
+0003b120: 7274 2e65 7870 6f72 745f 6368 6174 7328  rt.export_chats(
+0003b130: 6368 6174 732c 2070 6174 682c 2066 6f72  chats, path, for
+0003b140: 6d61 742c 2073 656c 662e 6462 2c20 6f70  mat, self.db, op
+0003b150: 7473 290d 0a20 2020 2020 2020 2020 2020  ts)..           
+0003b160: 2066 696c 6573 2c20 636f 756e 742c 206d   files, count, m
+0003b170: 6573 7361 6765 5f63 6f75 6e74 203d 2072  essage_count = r
+0003b180: 6573 756c 740d 0a20 2020 2020 2020 2065  esult..        e
+0003b190: 7863 6570 7420 4578 6365 7074 696f 6e20  xcept Exception 
+0003b1a0: 6173 2065 3a0d 0a20 2020 2020 2020 2020  as e:..         
+0003b1b0: 2020 2065 7272 6f72 6d73 675f 7368 6f72     errormsg_shor
+0003b1c0: 7420 3d20 2245 7272 6f72 2065 7870 6f72  t = "Error expor
+0003b1d0: 7469 6e67 2063 6861 7473 3a20 2573 2220  ting chats: %s" 
+0003b1e0: 2520 7574 696c 2e66 6f72 6d61 745f 6578  % util.format_ex
+0003b1f0: 6328 6529 0d0a 2020 2020 2020 2020 2020  c(e)..          
+0003b200: 2020 6572 726f 726d 7367 203d 2022 4572    errormsg = "Er
+0003b210: 726f 7220 6578 706f 7274 696e 6720 6368  ror exporting ch
+0003b220: 6174 733a 5c6e 5c6e 2573 2220 2520 5c0d  ats:\n\n%s" % \.
+0003b230: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003b240: 2020 2020 2020 2020 7472 6163 6562 6163          tracebac
+0003b250: 6b2e 666f 726d 6174 5f65 7863 2829 0d0a  k.format_exc()..
+0003b260: 2020 2020 2020 2020 6275 7379 2e43 6c6f          busy.Clo
+0003b270: 7365 2829 0d0a 2020 2020 2020 2020 7778  se()..        wx
+0003b280: 2e43 616c 6c41 6674 6572 2873 656c 662e  .CallAfter(self.
+0003b290: 7570 6461 7465 5f6c 6976 6569 6e66 6f29  update_liveinfo)
+0003b2a0: 0d0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
+0003b2b0: 2065 7272 6f72 6d73 673a 0d0a 2020 2020   errormsg:..    
+0003b2c0: 2020 2020 2020 2020 6966 206c 656e 2863          if len(c
+0003b2d0: 6861 7473 2920 3d3d 2031 2061 6e64 206e  hats) == 1 and n
+0003b2e0: 6f74 2064 6f5f 7369 6e67 6c65 6669 6c65  ot do_singlefile
+0003b2f0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0003b300: 2020 2067 7569 6261 7365 2e73 7461 7475     guibase.statu
+0003b310: 7328 2245 7870 6f72 7465 6420 2573 2074  s("Exported %s t
+0003b320: 6f20 2573 2e22 2c0d 0a20 2020 2020 2020  o %s.",..       
+0003b330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003b340: 2020 2020 2020 2020 7574 696c 2e70 6c75          util.plu
+0003b350: 7261 6c28 226d 6573 7361 6765 222c 206d  ral("message", m
+0003b360: 6573 7361 6765 5f63 6f75 6e74 2c20 7365  essage_count, se
+0003b370: 703d 222c 2229 2c0d 0a20 2020 2020 2020  p=","),..       
+0003b380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003b390: 2020 2020 2020 2020 7061 7468 2c20 6c6f          path, lo
+0003b3a0: 673d 5472 7565 290d 0a20 2020 2020 2020  g=True)..       
+0003b3b0: 2020 2020 2065 6c73 653a 2067 7569 6261       else: guiba
+0003b3c0: 7365 2e73 7461 7475 7328 2245 7870 6f72  se.status("Expor
+0003b3d0: 7465 6420 2573 2061 6e64 2025 7320 6672  ted %s and %s fr
+0003b3e0: 6f6d 2025 7320 6173 2025 7320 756e 6465  om %s as %s unde
+0003b3f0: 7220 2573 2e22 2c0d 0a20 2020 2020 2020  r %s.",..       
+0003b400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003b410: 2020 2020 2020 2020 2020 7574 696c 2e70            util.p
+0003b420: 6c75 7261 6c28 2263 6861 7422 2c20 636f  lural("chat", co
+0003b430: 756e 742c 2073 6570 3d22 2c22 292c 0d0a  unt, sep=","),..
+0003b440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003b450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003b460: 2075 7469 6c2e 706c 7572 616c 2822 6d65   util.plural("me
+0003b470: 7373 6167 6522 2c20 6d65 7373 6167 655f  ssage", message_
+0003b480: 636f 756e 742c 2073 6570 3d22 2c22 292c  count, sep=","),
+0003b490: 2073 656c 662e 6462 2c0d 0a20 2020 2020   self.db,..     
+0003b4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003b4b0: 2020 2020 2020 2020 2020 2020 666f 726d              form
+0003b4c0: 6174 2e75 7070 6572 2829 2c20 7061 7468  at.upper(), path
+0003b4d0: 2c20 6c6f 673d 5472 7565 290d 0a20 2020  , log=True)..   
+0003b4e0: 2020 2020 2020 2020 2069 6620 636f 6e66           if conf
+0003b4f0: 2e45 7870 6f72 7446 696c 6541 7574 6f4f  .ExportFileAutoO
+0003b500: 7065 6e3a 0d0a 2020 2020 2020 2020 2020  pen:..          
+0003b510: 2020 2020 2020 7574 696c 2e73 7461 7274        util.start
+0003b520: 5f66 696c 6528 6669 6c65 735b 305d 2069  _file(files[0] i
+0003b530: 6620 646f 5f73 696e 676c 6566 696c 6520  f do_singlefile 
+0003b540: 6f72 206c 656e 2863 6861 7473 2920 3d3d  or len(chats) ==
+0003b550: 2031 2065 6c73 6520 7061 7468 290d 0a20   1 else path).. 
+0003b560: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+0003b570: 2020 2020 2020 2020 2020 6775 6962 6173            guibas
+0003b580: 652e 7374 6174 7573 2865 7272 6f72 6d73  e.status(errorms
+0003b590: 675f 7368 6f72 7420 6f72 2065 7272 6f72  g_short or error
+0003b5a0: 6d73 6729 0d0a 2020 2020 2020 2020 2020  msg)..          
+0003b5b0: 2020 7778 2e4d 6573 7361 6765 426f 7828    wx.MessageBox(
+0003b5c0: 6572 726f 726d 7367 2c20 636f 6e66 2e54  errormsg, conf.T
+0003b5d0: 6974 6c65 2c20 7778 2e4f 4b20 7c20 7778  itle, wx.OK | wx
+0003b5e0: 2e49 434f 4e5f 5741 524e 494e 4729 0d0a  .ICON_WARNING)..
+0003b5f0: 0d0a 0d0a 2020 2020 6465 6620 6f6e 5f66  ....    def on_f
+0003b600: 696c 7465 7265 7870 6f72 745f 6368 6174  ilterexport_chat
+0003b610: 2873 656c 662c 2065 7665 6e74 293a 0d0a  (self, event):..
+0003b620: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
+0003b630: 2020 2020 2048 616e 646c 6572 2066 6f72       Handler for
+0003b640: 2063 6c69 636b 696e 6720 746f 2065 7870   clicking to exp
+0003b650: 6f72 7420 6120 6368 6174 2066 696c 7465  ort a chat filte
+0003b660: 7269 6e67 2073 7472 6169 6768 7420 746f  ring straight to
+0003b670: 2066 696c 652c 0d0a 2020 2020 2020 2020   file,..        
+0003b680: 6469 7370 6c61 7973 2061 2073 6176 6520  displays a save 
+0003b690: 6669 6c65 2064 6961 6c6f 6720 616e 6420  file dialog and 
+0003b6a0: 7361 7665 7320 616c 6c20 6669 6c74 6572  saves all filter
+0003b6b0: 6564 206d 6573 7361 6765 7320 746f 2066  ed messages to f
+0003b6c0: 696c 652e 0d0a 2020 2020 2020 2020 2222  ile...        ""
+0003b6d0: 220d 0a20 2020 2020 2020 2066 6f72 6d61  "..        forma
+0003b6e0: 7461 7267 7320 3d20 636f 6c6c 6563 7469  targs = collecti
+0003b6f0: 6f6e 732e 6465 6661 756c 7464 6963 7428  ons.defaultdict(
+0003b700: 7374 7229 3b20 666f 726d 6174 6172 6773  str); formatargs
+0003b710: 2e75 7064 6174 6528 7365 6c66 2e63 6861  .update(self.cha
+0003b720: 7429 0d0a 2020 2020 2020 2020 6465 6661  t)..        defa
+0003b730: 756c 7420 3d20 636f 6e66 2e45 7870 6f72  ult = conf.Expor
+0003b740: 7443 6861 7454 656d 706c 6174 6520 2520  tChatTemplate % 
+0003b750: 666f 726d 6174 6172 6773 0d0a 2020 2020  formatargs..    
+0003b760: 2020 2020 7365 6c66 2e64 6961 6c6f 675f      self.dialog_
+0003b770: 7361 7665 6368 6174 2e46 696c 656e 616d  savechat.Filenam
+0003b780: 6520 3d20 7574 696c 2e73 6166 655f 6669  e = util.safe_fi
+0003b790: 6c65 6e61 6d65 2864 6566 6175 6c74 290d  lename(default).
+0003b7a0: 0a20 2020 2020 2020 2069 6620 7778 2e49  .        if wx.I
+0003b7b0: 445f 4f4b 2021 3d20 7365 6c66 2e64 6961  D_OK != self.dia
+0003b7c0: 6c6f 675f 7361 7665 6368 6174 2e53 686f  log_savechat.Sho
+0003b7d0: 774d 6f64 616c 2829 3a20 7265 7475 726e  wModal(): return
+0003b7e0: 0d0a 0d0a 2020 2020 2020 2020 6669 6c65  ....        file
+0003b7f0: 7061 7468 203d 2063 6f6e 7472 6f6c 732e  path = controls.
+0003b800: 6765 745f 6469 616c 6f67 5f70 6174 6828  get_dialog_path(
+0003b810: 7365 6c66 2e64 6961 6c6f 675f 7361 7665  self.dialog_save
+0003b820: 6368 6174 290d 0a20 2020 2020 2020 2066  chat)..        f
+0003b830: 6f72 6d61 7420 3d20 6578 706f 7274 2e43  ormat = export.C
+0003b840: 4841 545f 4558 5453 5b73 656c 662e 6469  HAT_EXTS[self.di
+0003b850: 616c 6f67 5f73 6176 6563 6861 742e 4669  alog_savechat.Fi
+0003b860: 6c74 6572 496e 6465 785d 0d0a 2020 2020  lterIndex]..    
+0003b870: 2020 2020 6d65 6469 615f 666f 6c64 6572      media_folder
+0003b880: 203d 2022 6874 6d6c 2220 3d3d 2066 6f72   = "html" == for
+0003b890: 6d61 7420 616e 6420 5c0d 0a20 2020 2020  mat and \..     
+0003b8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003b8b0: 2020 7365 6c66 2e64 6961 6c6f 675f 7361    self.dialog_sa
+0003b8c0: 7665 6368 6174 2e46 696c 7465 7249 6e64  vechat.FilterInd
+0003b8d0: 6578 2021 3d20 6578 706f 7274 2e43 4841  ex != export.CHA
+0003b8e0: 545f 4558 5453 2e69 6e64 6578 2822 6874  T_EXTS.index("ht
+0003b8f0: 6d6c 2229 0d0a 2020 2020 2020 2020 6966  ml")..        if
+0003b900: 206d 6564 6961 5f66 6f6c 6465 7220 616e   media_folder an
+0003b910: 6420 6e6f 7420 6368 6563 6b5f 6d65 6469  d not check_medi
+0003b920: 615f 6578 706f 7274 5f6c 6f67 696e 2873  a_export_login(s
+0003b930: 656c 662e 6462 293a 2072 6574 7572 6e0d  elf.db): return.
+0003b940: 0a0d 0a20 2020 2020 2020 2062 7573 7920  ...        busy 
+0003b950: 3d20 636f 6e74 726f 6c73 2e42 7573 7950  = controls.BusyP
+0003b960: 616e 656c 2873 656c 662c 2027 4669 6c74  anel(self, 'Filt
+0003b970: 6572 696e 6720 616e 6420 6578 706f 7274  ering and export
+0003b980: 696e 6720 2225 7322 2e27 2025 0d0a 2020  ing "%s".' %..  
+0003b990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003b9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003b9b0: 7365 6c66 2e63 6861 745b 2274 6974 6c65  self.chat["title
+0003b9c0: 225d 290d 0a20 2020 2020 2020 2074 7279  "])..        try
+0003b9d0: 3a0d 0a20 2020 2020 2020 2020 2020 2066  :..            f
+0003b9e0: 696c 7465 725f 6e65 7720 3d20 7365 6c66  ilter_new = self
+0003b9f0: 2e62 7569 6c64 5f66 696c 7465 7228 290d  .build_filter().
+0003ba00: 0a20 2020 2020 2020 2020 2020 2066 696c  .            fil
+0003ba10: 7465 725f 6261 636b 7570 203d 2073 656c  ter_backup = sel
+0003ba20: 662e 7374 635f 6869 7374 6f72 792e 4765  f.stc_history.Ge
+0003ba30: 7446 696c 7465 7228 290d 0a20 2020 2020  tFilter()..     
+0003ba40: 2020 2020 2020 2073 656c 662e 7374 635f         self.stc_
+0003ba50: 6869 7374 6f72 792e 5365 7446 696c 7465  history.SetFilte
+0003ba60: 7228 6669 6c74 6572 5f6e 6577 290d 0a20  r(filter_new).. 
+0003ba70: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0003ba80: 7374 635f 6869 7374 6f72 792e 5265 7472  stc_history.Retr
+0003ba90: 6965 7665 4d65 7373 6167 6573 4966 4e65  ieveMessagesIfNe
+0003baa0: 6564 6564 2829 0d0a 2020 2020 2020 2020  eded()..        
+0003bab0: 2020 2020 6d65 7373 6167 6573 5f61 6c6c      messages_all
+0003bac0: 203d 2073 656c 662e 7374 635f 6869 7374   = self.stc_hist
+0003bad0: 6f72 792e 4765 7452 6574 7269 6576 6564  ory.GetRetrieved
+0003bae0: 4d65 7373 6167 6573 2829 0d0a 2020 2020  Messages()..    
+0003baf0: 2020 2020 2020 2020 6d65 7373 6167 6573          messages
+0003bb00: 203d 205b 6d20 666f 7220 6d20 696e 206d   = [m for m in m
+0003bb10: 6573 7361 6765 735f 616c 6c0d 0a20 2020  essages_all..   
+0003bb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003bb30: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
+0003bb40: 2e73 7463 5f68 6973 746f 7279 2e49 734d  .stc_history.IsM
+0003bb50: 6573 7361 6765 4669 6c74 6572 6564 4f75  essageFilteredOu
+0003bb60: 7428 6d29 5d0d 0a20 2020 2020 2020 2020  t(m)]..         
+0003bb70: 2020 2073 656c 662e 7374 635f 6869 7374     self.stc_hist
+0003bb80: 6f72 792e 5365 7446 696c 7465 7228 6669  ory.SetFilter(fi
+0003bb90: 6c74 6572 5f62 6163 6b75 7029 0d0a 2020  lter_backup)..  
+0003bba0: 2020 2020 2020 2020 2020 6966 206d 6573            if mes
+0003bbb0: 7361 6765 733a 0d0a 2020 2020 2020 2020  sages:..        
+0003bbc0: 2020 2020 2020 2020 6775 6962 6173 652e          guibase.
+0003bbd0: 7374 6174 7573 2822 4669 6c74 6572 696e  status("Filterin
+0003bbe0: 6720 616e 6420 6578 706f 7274 696e 6720  g and exporting 
+0003bbf0: 746f 2025 732e 222c 2066 696c 6570 6174  to %s.", filepat
+0003bc00: 682c 206c 6f67 3d54 7275 6529 0d0a 2020  h, log=True)..  
+0003bc10: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+0003bc20: 6f67 7265 7373 6675 6e63 203d 206c 616d  ogressfunc = lam
+0003bc30: 6264 6120 2a61 7267 733a 2077 782e 5361  bda *args: wx.Sa
+0003bc40: 6665 5969 656c 6428 290d 0a20 2020 2020  feYield()..     
+0003bc50: 2020 2020 2020 2020 2020 206f 7074 7320             opts 
+0003bc60: 3d20 6469 6374 286d 6573 7361 6765 733d  = dict(messages=
+0003bc70: 6d65 7373 6167 6573 2c20 7072 6f67 7265  messages, progre
+0003bc80: 7373 3d70 726f 6772 6573 7366 756e 6329  ss=progressfunc)
+0003bc90: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0003bca0: 2020 6966 206d 6564 6961 5f66 6f6c 6465    if media_folde
+0003bcb0: 723a 206f 7074 735b 226d 6564 6961 5f66  r: opts["media_f
+0003bcc0: 6f6c 6465 7222 5d20 3d20 5472 7565 0d0a  older"] = True..
+0003bcd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003bce0: 7265 7375 6c74 203d 2065 7870 6f72 742e  result = export.
+0003bcf0: 6578 706f 7274 5f63 6861 7473 285b 7365  export_chats([se
+0003bd00: 6c66 2e63 6861 745d 2c20 6669 6c65 7061  lf.chat], filepa
+0003bd10: 7468 2c20 666f 726d 6174 2c20 7365 6c66  th, format, self
+0003bd20: 2e64 622c 206f 7074 7329 0d0a 2020 2020  .db, opts)..    
+0003bd30: 2020 2020 2020 2020 2020 2020 6669 6c65              file
+0003bd40: 732c 2063 6f75 6e74 2c20 6d65 7373 6167  s, count, messag
+0003bd50: 655f 636f 756e 7420 3d20 7265 7375 6c74  e_count = result
+0003bd60: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0003bd70: 2020 6775 6962 6173 652e 7374 6174 7573    guibase.status
+0003bd80: 2822 4578 706f 7274 6564 2025 7320 746f  ("Exported %s to
+0003bd90: 2025 732e 222c 0d0a 2020 2020 2020 2020   %s.",..        
+0003bda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003bdb0: 2020 2020 2020 2075 7469 6c2e 706c 7572         util.plur
+0003bdc0: 616c 2822 6d65 7373 6167 6522 2c20 6d65  al("message", me
+0003bdd0: 7373 6167 655f 636f 756e 742c 2073 6570  ssage_count, sep
+0003bde0: 3d22 2c22 292c 0d0a 2020 2020 2020 2020  =","),..        
+0003bdf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003be00: 2020 2020 2020 2066 696c 6570 6174 682c         filepath,
+0003be10: 206c 6f67 3d54 7275 6529 0d0a 2020 2020   log=True)..    
+0003be20: 2020 2020 2020 2020 2020 2020 6966 2063              if c
+0003be30: 6f6e 662e 4578 706f 7274 4669 6c65 4175  onf.ExportFileAu
+0003be40: 746f 4f70 656e 3a20 7574 696c 2e73 7461  toOpen: util.sta
+0003be50: 7274 5f66 696c 6528 6669 6c65 7061 7468  rt_file(filepath
+0003be60: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0003be70: 2020 2077 782e 4361 6c6c 4166 7465 7228     wx.CallAfter(
+0003be80: 7365 6c66 2e75 7064 6174 655f 6c69 7665  self.update_live
+0003be90: 696e 666f 290d 0a20 2020 2020 2020 2020  info)..         
+0003bea0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+0003beb0: 2020 2020 2020 2020 2020 7778 2e4d 6573            wx.Mes
+0003bec0: 7361 6765 426f 7828 2243 7572 7265 6e74  sageBox("Current
+0003bed0: 2066 696c 7465 7220 6c65 6176 6573 206e   filter leaves n
+0003bee0: 6f20 6461 7461 2074 6f20 6578 706f 7274  o data to export
+0003bef0: 2e22 2c0d 0a20 2020 2020 2020 2020 2020  .",..           
+0003bf00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003bf10: 2020 2063 6f6e 662e 5469 746c 652c 2077     conf.Title, w
+0003bf20: 782e 4f4b 207c 2077 782e 4943 4f4e 5f49  x.OK | wx.ICON_I
+0003bf30: 4e46 4f52 4d41 5449 4f4e 290d 0a20 2020  NFORMATION)..   
+0003bf40: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
+0003bf50: 7074 696f 6e20 6173 2065 3a0d 0a20 2020  ption as e:..   
+0003bf60: 2020 2020 2020 2020 2067 7569 6261 7365           guibase
+0003bf70: 2e73 7461 7475 7328 2245 7272 6f72 2073  .status("Error s
+0003bf80: 6176 696e 6720 2573 3a20 2573 222c 2066  aving %s: %s", f
+0003bf90: 696c 6570 6174 682c 2075 7469 6c2e 666f  ilepath, util.fo
+0003bfa0: 726d 6174 5f65 7863 2865 2929 0d0a 2020  rmat_exc(e))..  
+0003bfb0: 2020 2020 2020 2020 2020 6c6f 6767 6572            logger
+0003bfc0: 2e65 7863 6570 7469 6f6e 2822 4572 726f  .exception("Erro
+0003bfd0: 7220 7361 7669 6e67 2025 732e 222c 2066  r saving %s.", f
+0003bfe0: 696c 6570 6174 6829 0d0a 2020 2020 2020  ilepath)..      
+0003bff0: 2020 2020 2020 6572 726f 726d 7367 203d        errormsg =
+0003c000: 2022 4572 726f 7220 7361 7669 6e67 2025   "Error saving %
+0003c010: 733a 5c6e 5c6e 2573 2220 2520 5c0d 0a20  s:\n\n%s" % \.. 
+0003c020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003c030: 2020 2020 2020 2866 696c 6570 6174 682c        (filepath,
+0003c040: 2074 7261 6365 6261 636b 2e66 6f72 6d61   traceback.forma
+0003c050: 745f 6578 6328 2929 0d0a 2020 2020 2020  t_exc())..      
+0003c060: 2020 2020 2020 7778 2e4d 6573 7361 6765        wx.Message
+0003c070: 426f 7828 6572 726f 726d 7367 2c20 636f  Box(errormsg, co
+0003c080: 6e66 2e54 6974 6c65 2c20 7778 2e4f 4b20  nf.Title, wx.OK 
+0003c090: 7c20 7778 2e49 434f 4e5f 5741 524e 494e  | wx.ICON_WARNIN
+0003c0a0: 4729 0d0a 2020 2020 2020 2020 6669 6e61  G)..        fina
+0003c0b0: 6c6c 793a 0d0a 2020 2020 2020 2020 2020  lly:..          
+0003c0c0: 2020 6275 7379 2e43 6c6f 7365 2829 0d0a    busy.Close()..
+0003c0d0: 0d0a 0d0a 2020 2020 6465 6620 6f6e 5f73  ....    def on_s
+0003c0e0: 697a 655f 6874 6d6c 5f73 7461 7473 2873  ize_html_stats(s
+0003c0f0: 656c 662c 2065 7665 6e74 293a 0d0a 2020  elf, event):..  
+0003c100: 2020 2020 2020 2222 2248 616e 646c 6572        """Handler
+0003c110: 2066 6f72 2073 697a 696e 6720 6874 6d6c   for sizing html
+0003c120: 5f73 7461 7473 2c20 7365 7473 206e 6577  _stats, sets new
+0003c130: 2073 6372 6f6c 6c20 706f 7369 7469 6f6e   scroll position
+0003c140: 2062 6173 6564 0d0a 2020 2020 2020 2020   based..        
+0003c150: 7072 6576 696f 7573 6c79 2073 746f 7265  previously store
+0003c160: 6420 6f6e 6520 2848 746d 6c57 696e 646f  d one (HtmlWindo
+0003c170: 7720 6c6f 7365 7320 6974 7320 7363 726f  w loses its scro
+0003c180: 6c6c 2070 6f73 6974 696f 6e20 6f6e 2072  ll position on r
+0003c190: 6573 697a 6529 2e0d 0a20 2020 2020 2020  esize)...       
+0003c1a0: 2022 2222 0d0a 2020 2020 2020 2020 6874   """..        ht
+0003c1b0: 6d6c 203d 2073 656c 662e 6874 6d6c 5f73  ml = self.html_s
+0003c1c0: 7461 7473 0d0a 2020 2020 2020 2020 6966  tats..        if
+0003c1d0: 2068 6173 6174 7472 2868 746d 6c2c 2022   hasattr(html, "
+0003c1e0: 5f6c 6173 745f 7363 726f 6c6c 5f70 6f73  _last_scroll_pos
+0003c1f0: 2229 3a0d 0a20 2020 2020 2020 2020 2020  "):..           
+0003c200: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
+0003c210: 3229 3a0d 0a20 2020 2020 2020 2020 2020  2):..           
+0003c220: 2020 2020 206f 7269 656e 7420 3d20 7778       orient = wx
+0003c230: 2e56 4552 5449 4341 4c20 6966 2069 2065  .VERTICAL if i e
+0003c240: 6c73 6520 7778 2e48 4f52 495a 4f4e 5441  lse wx.HORIZONTA
+0003c250: 4c0d 0a20 2020 2020 2020 2020 2020 2020  L..             
+0003c260: 2020 2023 2044 6976 6973 696f 6e20 6361     # Division ca
+0003c270: 6e20 6265 203e 2031 206f 6e20 6669 7273  n be > 1 on firs
+0003c280: 7420 7265 7369 7a69 6e67 732c 2062 6f75  t resizings, bou
+0003c290: 6e64 2069 7420 746f 2031 2e0d 0a20 2020  nd it to 1...   
+0003c2a0: 2020 2020 2020 2020 2020 2020 2072 6174               rat
+0003c2b0: 696f 203d 206d 696e 2831 2c20 7574 696c  io = min(1, util
+0003c2c0: 2e73 6166 6564 6976 6628 6874 6d6c 2e5f  .safedivf(html._
+0003c2d0: 6c61 7374 5f73 6372 6f6c 6c5f 706f 735b  last_scroll_pos[
+0003c2e0: 695d 2c0d 0a20 2020 2020 2020 2020 2020  i],..           
+0003c2f0: 2020 2020 2020 2020 2068 746d 6c2e 5f6c           html._l
+0003c300: 6173 745f 7363 726f 6c6c 5f72 616e 6765  ast_scroll_range
+0003c310: 5b69 5d0d 0a20 2020 2020 2020 2020 2020  [i]..           
+0003c320: 2020 2020 2029 290d 0a20 2020 2020 2020       ))..       
+0003c330: 2020 2020 2020 2020 2068 746d 6c2e 5f6c           html._l
+0003c340: 6173 745f 7363 726f 6c6c 5f70 6f73 5b69  ast_scroll_pos[i
+0003c350: 5d20 3d20 696e 7428 7261 7469 6f20 2a20  ] = int(ratio * 
+0003c360: 6874 6d6c 2e47 6574 5363 726f 6c6c 5261  html.GetScrollRa
+0003c370: 6e67 6528 6f72 6965 6e74 2929 0d0a 2020  nge(orient))..  
+0003c380: 2020 2020 2020 2020 2020 2320 4578 6563            # Exec
+0003c390: 7574 6520 7363 726f 6c6c 206c 6174 6572  ute scroll later
+0003c3a0: 2061 7320 736f 6d65 7468 696e 6720 7265   as something re
+0003c3b0: 7365 7473 2069 7420 6166 7465 7220 7468  sets it after th
+0003c3c0: 6973 2068 616e 646c 6572 0d0a 2020 2020  is handler..    
+0003c3d0: 2020 2020 2020 2020 7363 726f 6c6c 5f66          scroll_f
+0003c3e0: 756e 6320 3d20 6c61 6d62 6461 3a20 6874  unc = lambda: ht
+0003c3f0: 6d6c 2061 6e64 2068 746d 6c2e 5363 726f  ml and html.Scro
+0003c400: 6c6c 282a 6874 6d6c 2e5f 6c61 7374 5f73  ll(*html._last_s
+0003c410: 6372 6f6c 6c5f 706f 7329 0d0a 2020 2020  croll_pos)..    
+0003c420: 2020 2020 2020 2020 7778 2e43 616c 6c4c          wx.CallL
+0003c430: 6174 6572 2835 302c 2073 6372 6f6c 6c5f  ater(50, scroll_
+0003c440: 6675 6e63 290d 0a20 2020 2020 2020 2065  func)..        e
+0003c450: 7665 6e74 2e53 6b69 7028 2920 2320 416c  vent.Skip() # Al
+0003c460: 6c6f 7720 6576 656e 7420 746f 2070 726f  low event to pro
+0003c470: 7061 6761 7465 2077 7820 6861 6e64 6c65  pagate wx handle
+0003c480: 720d 0a0d 0a0d 0a20 2020 2064 6566 206f  r......    def o
+0003c490: 6e5f 7365 6c65 6374 5f70 6172 7469 6369  n_select_partici
+0003c4a0: 7061 6e74 2873 656c 662c 2065 7665 6e74  pant(self, event
+0003c4b0: 293a 0d0a 2020 2020 2020 2020 2222 220d  ):..        """.
+0003c4c0: 0a20 2020 2020 2020 2048 616e 646c 6572  .        Handler
+0003c4d0: 2066 6f72 2073 656c 6563 7469 6e67 2061   for selecting a
+0003c4e0: 6e20 6974 656d 2074 6865 2069 6e20 7468  n item the in th
+0003c4f0: 6520 7061 7274 6963 6970 616e 7473 206c  e participants l
+0003c500: 6973 742c 2074 6f67 676c 6573 0d0a 2020  ist, toggles..  
+0003c510: 2020 2020 2020 6974 7320 6368 6563 6b65        its checke
+0003c520: 6420 7374 6174 652e 0d0a 2020 2020 2020  d state...      
+0003c530: 2020 2222 220d 0a20 2020 2020 2020 2069    """..        i
+0003c540: 6478 203d 2065 7665 6e74 2e47 6574 496e  dx = event.GetIn
+0003c550: 6465 7828 290d 0a20 2020 2020 2020 2069  dex()..        i
+0003c560: 6620 6964 7820 3c20 7365 6c66 2e6c 6973  f idx < self.lis
+0003c570: 745f 7061 7274 6963 6970 616e 7473 2e47  t_participants.G
+0003c580: 6574 4974 656d 436f 756e 7428 293a 0d0a  etItemCount():..
+0003c590: 2020 2020 2020 2020 2020 2020 6320 3d20              c = 
+0003c5a0: 7365 6c66 2e6c 6973 745f 7061 7274 6963  self.list_partic
+0003c5b0: 6970 616e 7473 2e47 6574 4974 656d 2869  ipants.GetItem(i
+0003c5c0: 6478 290d 0a20 2020 2020 2020 2020 2020  dx)..           
+0003c5d0: 2063 2e43 6865 636b 286e 6f74 2063 2e49   c.Check(not c.I
+0003c5e0: 7343 6865 636b 6564 2829 290d 0a20 2020  sChecked())..   
+0003c5f0: 2020 2020 2020 2020 2073 656c 662e 6c69           self.li
+0003c600: 7374 5f70 6172 7469 6369 7061 6e74 732e  st_participants.
+0003c610: 5365 7449 7465 6d28 6329 0d0a 2020 2020  SetItem(c)..    
+0003c620: 2020 2020 2020 2020 7365 6c66 2e6c 6973          self.lis
+0003c630: 745f 7061 7274 6963 6970 616e 7473 2e52  t_participants.R
+0003c640: 6566 7265 7368 2829 2023 204e 6f74 6966  efresh() # Notif
+0003c650: 7920 6c69 7374 206f 6620 6461 7461 2063  y list of data c
+0003c660: 6861 6e67 650d 0a0d 0a0d 0a20 2020 2064  hange......    d
+0003c670: 6566 206f 6e5f 7363 726f 6c6c 5f67 7269  ef on_scroll_gri
+0003c680: 645f 7371 6c28 7365 6c66 2c20 6576 656e  d_sql(self, even
+0003c690: 7429 3a0d 0a20 2020 2020 2020 2022 2222  t):..        """
+0003c6a0: 0d0a 2020 2020 2020 2020 4861 6e64 6c65  ..        Handle
+0003c6b0: 7220 666f 7220 7363 726f 6c6c 696e 6720  r for scrolling 
+0003c6c0: 7468 6520 5351 4c20 6772 6964 2c20 7365  the SQL grid, se
+0003c6d0: 656b 7320 6168 6561 6420 6966 206e 6561  eks ahead if nea
+0003c6e0: 7269 6e67 2074 6865 2065 6e64 206f 660d  ring the end of.
+0003c6f0: 0a20 2020 2020 2020 2072 6574 7269 6576  .        retriev
+0003c700: 6564 2072 6f77 732e 0d0a 2020 2020 2020  ed rows...      
+0003c710: 2020 2222 220d 0a20 2020 2020 2020 2065    """..        e
+0003c720: 7665 6e74 2e53 6b69 7028 290d 0a20 2020  vent.Skip()..   
+0003c730: 2020 2020 2023 2045 7865 6375 7465 2073       # Execute s
+0003c740: 6565 6b20 6c61 7465 722c 2074 6f20 6769  eek later, to gi
+0003c750: 7665 2073 6372 6f6c 6c20 706f 7369 7469  ve scroll positi
+0003c760: 6f6e 2074 696d 6520 746f 2075 7064 6174  on time to updat
+0003c770: 650d 0a20 2020 2020 2020 2077 782e 4361  e..        wx.Ca
+0003c780: 6c6c 4c61 7465 7228 3530 2c20 7365 6c66  llLater(50, self
+0003c790: 2e73 6565 6b61 6865 6164 5f67 7269 645f  .seekahead_grid_
+0003c7a0: 7371 6c29 0d0a 0d0a 0d0a 2020 2020 6465  sql)......    de
+0003c7b0: 6620 7365 656b 6168 6561 645f 6772 6964  f seekahead_grid
+0003c7c0: 5f73 716c 2873 656c 6629 3a0d 0a20 2020  _sql(self):..   
+0003c7d0: 2020 2020 2022 2222 5365 656b 7320 6168       """Seeks ah
+0003c7e0: 6561 6420 6f6e 2074 6865 2053 514c 2067  ead on the SQL g
+0003c7f0: 7269 6420 6966 2073 6372 6f6c 6c20 706f  rid if scroll po
+0003c800: 7369 7469 6f6e 206e 6561 7269 6e67 2074  sition nearing t
+0003c810: 6865 2065 6e64 2e22 2222 0d0a 2020 2020  he end."""..    
+0003c820: 2020 2020 5345 454b 4148 4541 445f 504f      SEEKAHEAD_PO
+0003c830: 535f 5241 5449 4f20 3d20 302e 380d 0a20  S_RATIO = 0.8.. 
+0003c840: 2020 2020 2020 2073 6372 6f6c 6c70 6f73         scrollpos
+0003c850: 203d 2073 656c 662e 6772 6964 5f73 716c   = self.grid_sql
+0003c860: 2e47 6574 5363 726f 6c6c 506f 7328 7778  .GetScrollPos(wx
+0003c870: 2e56 4552 5449 4341 4c29 0d0a 2020 2020  .VERTICAL)..    
+0003c880: 2020 2020 7363 726f 6c6c 7261 6e67 6520      scrollrange 
+0003c890: 3d20 7365 6c66 2e67 7269 645f 7371 6c2e  = self.grid_sql.
+0003c8a0: 4765 7453 6372 6f6c 6c52 616e 6765 2877  GetScrollRange(w
+0003c8b0: 782e 5645 5254 4943 414c 290d 0a20 2020  x.VERTICAL)..   
+0003c8c0: 2020 2020 2069 6620 7363 726f 6c6c 706f       if scrollpo
+0003c8d0: 7320 3e20 7363 726f 6c6c 7261 6e67 6520  s > scrollrange 
+0003c8e0: 2a20 5345 454b 4148 4541 445f 504f 535f  * SEEKAHEAD_POS_
+0003c8f0: 5241 5449 4f3a 0d0a 2020 2020 2020 2020  RATIO:..        
+0003c900: 2020 2020 7363 726f 6c6c 7061 6765 203d      scrollpage =
+0003c910: 2073 656c 662e 6772 6964 5f73 716c 2e47   self.grid_sql.G
+0003c920: 6574 5363 726f 6c6c 5061 6765 5369 7a65  etScrollPageSize
+0003c930: 2877 782e 5645 5254 4943 414c 290d 0a20  (wx.VERTICAL).. 
+0003c940: 2020 2020 2020 2020 2020 2074 6f5f 656e             to_en
+0003c950: 6420 3d20 2873 6372 6f6c 6c70 6f73 202b  d = (scrollpos +
+0003c960: 2073 6372 6f6c 6c70 6167 6520 3d3d 2073   scrollpage == s
+0003c970: 6372 6f6c 6c72 616e 6765 290d 0a20 2020  crollrange)..   
+0003c980: 2020 2020 2020 2020 2023 2053 6565 6b20           # Seek 
+0003c990: 746f 2065 6e64 2069 6620 7363 726f 6c6c  to end if scroll
+0003c9a0: 6564 2074 6f20 7468 6520 7665 7279 2062  ed to the very b
+0003c9b0: 6f74 746f 6d0d 0a20 2020 2020 2020 2020  ottom..         
+0003c9c0: 2020 2073 656c 662e 6772 6964 5f73 716c     self.grid_sql
+0003c9d0: 2e54 6162 6c65 2e53 6565 6b41 6865 6164  .Table.SeekAhead
+0003c9e0: 2874 6f5f 656e 6429 0d0a 0d0a 0d0a 2020  (to_end)......  
+0003c9f0: 2020 6465 6620 6f6e 5f73 6372 6f6c 6c5f    def on_scroll_
+0003ca00: 6874 6d6c 5f73 7461 7473 2873 656c 662c  html_stats(self,
+0003ca10: 2065 7665 6e74 293a 0d0a 2020 2020 2020   event):..      
+0003ca20: 2020 2222 220d 0a20 2020 2020 2020 2048    """..        H
+0003ca30: 616e 646c 6572 2066 6f72 2073 6372 6f6c  andler for scrol
+0003ca40: 6c69 6e67 2074 6865 2048 544d 4c20 7374  ling the HTML st
+0003ca50: 6174 732c 2073 746f 7265 7320 7363 726f  ats, stores scro
+0003ca60: 6c6c 2070 6f73 6974 696f 6e0d 0a20 2020  ll position..   
+0003ca70: 2020 2020 2028 4874 6d6c 5769 6e64 6f77       (HtmlWindow
+0003ca80: 206c 6f73 6573 2069 7420 6f6e 2072 6573   loses it on res
+0003ca90: 697a 6529 2e0d 0a20 2020 2020 2020 2022  ize)...        "
+0003caa0: 2222 0d0a 2020 2020 2020 2020 7778 2e43  ""..        wx.C
+0003cab0: 616c 6c41 6674 6572 2873 656c 662e 7374  allAfter(self.st
+0003cac0: 6f72 655f 6874 6d6c 5f73 7461 7473 5f73  ore_html_stats_s
+0003cad0: 6372 6f6c 6c29 0d0a 2020 2020 2020 2020  croll)..        
+0003cae0: 6576 656e 742e 536b 6970 2829 2023 2041  event.Skip() # A
+0003caf0: 6c6c 6f77 2065 7665 6e74 2074 6f20 7072  llow event to pr
+0003cb00: 6f70 6167 6174 6520 7778 2068 616e 646c  opagate wx handl
+0003cb10: 6572 0d0a 0d0a 0d0a 2020 2020 6465 6620  er......    def 
+0003cb20: 7374 6f72 655f 6874 6d6c 5f73 7461 7473  store_html_stats
+0003cb30: 5f73 6372 6f6c 6c28 7365 6c66 293a 0d0a  _scroll(self):..
+0003cb40: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
+0003cb50: 2020 2020 2053 746f 7265 7320 7468 6520       Stores the 
+0003cb60: 7374 6174 6973 7469 6373 2048 544d 4c20  statistics HTML 
+0003cb70: 7363 726f 6c6c 2070 6f73 6974 696f 6e2c  scroll position,
+0003cb80: 206e 6565 6465 6420 666f 7220 6765 7474   needed for gett
+0003cb90: 696e 6720 6172 6f75 6e64 0d0a 2020 2020  ing around..    
+0003cba0: 2020 2020 6974 7320 7175 6972 6b79 2073      its quirky s
+0003cbb0: 6372 6f6c 6c20 7570 6461 7469 6e67 2e0d  croll updating..
+0003cbc0: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
+0003cbd0: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
+0003cbe0: 663a 0d0a 2020 2020 2020 2020 2020 2020  f:..            
+0003cbf0: 7265 7475 726e 0d0a 2020 2020 2020 2020  return..        
+0003cc00: 7365 6c66 2e68 746d 6c5f 7374 6174 732e  self.html_stats.
+0003cc10: 5f6c 6173 745f 7363 726f 6c6c 5f70 6f73  _last_scroll_pos
+0003cc20: 203d 205b 0d0a 2020 2020 2020 2020 2020   = [..          
+0003cc30: 2020 7365 6c66 2e68 746d 6c5f 7374 6174    self.html_stat
+0003cc40: 732e 4765 7453 6372 6f6c 6c50 6f73 2877  s.GetScrollPos(w
+0003cc50: 782e 484f 5249 5a4f 4e54 414c 292c 0d0a  x.HORIZONTAL),..
+0003cc60: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0003cc70: 2e68 746d 6c5f 7374 6174 732e 4765 7453  .html_stats.GetS
+0003cc80: 6372 6f6c 6c50 6f73 2877 782e 5645 5254  crollPos(wx.VERT
+0003cc90: 4943 414c 290d 0a20 2020 2020 2020 205d  ICAL)..        ]
+0003cca0: 0d0a 2020 2020 2020 2020 7365 6c66 2e68  ..        self.h
+0003ccb0: 746d 6c5f 7374 6174 732e 5f6c 6173 745f  tml_stats._last_
+0003ccc0: 7363 726f 6c6c 5f72 616e 6765 203d 205b  scroll_range = [
+0003ccd0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+0003cce0: 6c66 2e68 746d 6c5f 7374 6174 732e 4765  lf.html_stats.Ge
+0003ccf0: 7453 6372 6f6c 6c52 616e 6765 2877 782e  tScrollRange(wx.
+0003cd00: 484f 5249 5a4f 4e54 414c 292c 0d0a 2020  HORIZONTAL),..  
+0003cd10: 2020 2020 2020 2020 2020 7365 6c66 2e68            self.h
+0003cd20: 746d 6c5f 7374 6174 732e 4765 7453 6372  tml_stats.GetScr
+0003cd30: 6f6c 6c52 616e 6765 2877 782e 5645 5254  ollRange(wx.VERT
+0003cd40: 4943 414c 290d 0a20 2020 2020 2020 205d  ICAL)..        ]
+0003cd50: 0d0a 0d0a 0d0a 2020 2020 6465 6620 6f6e  ......    def on
+0003cd60: 5f63 6c69 636b 5f68 746d 6c5f 7374 6174  _click_html_stat
+0003cd70: 7328 7365 6c66 2c20 6576 656e 7429 3a0d  s(self, event):.
+0003cd80: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
+0003cd90: 2020 2020 2020 4861 6e64 6c65 7220 666f        Handler fo
+0003cda0: 7220 636c 6963 6b69 6e67 2061 206c 696e  r clicking a lin
+0003cdb0: 6b20 696e 2063 6861 7420 6869 7374 6f72  k in chat histor
+0003cdc0: 7920 7374 6174 6973 7469 6373 2c20 7363  y statistics, sc
+0003cdd0: 726f 6c6c 7320 746f 0d0a 2020 2020 2020  rolls to..      
+0003cde0: 2020 616e 6368 6f72 2069 6620 616e 6368    anchor if anch
+0003cdf0: 6f72 206c 696e 6b2c 2073 6f72 7473 2074  or link, sorts t
+0003ce00: 6865 2073 7461 7469 7374 6963 7320 6966  he statistics if
+0003ce10: 2073 6f72 7420 6c69 6e6b 2c20 676f 6573   sort link, goes
+0003ce20: 2074 6f0d 0a20 2020 2020 2020 2073 7065   to..        spe
+0003ce30: 6369 6669 6320 6d65 7373 6167 6520 6966  cific message if
+0003ce40: 2074 7261 6e73 6665 7220 6175 7468 6f72   transfer author
+0003ce50: 206c 696e 6b2c 206f 7468 6572 7769 7365   link, otherwise
+0003ce60: 2073 686f 7773 2074 6865 2068 6973 746f   shows the histo
+0003ce70: 7279 0d0a 2020 2020 2020 2020 616e 6420  ry..        and 
+0003ce80: 6669 6e64 7320 7468 6520 776f 7264 2063  finds the word c
+0003ce90: 6c69 636b 6564 2069 6e20 7468 6520 776f  licked in the wo
+0003cea0: 7264 2063 6c6f 7564 2e0d 0a20 2020 2020  rd cloud...     
+0003ceb0: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
+0003cec0: 6872 6566 2c20 6874 6d6c 7769 6e64 6f77  href, htmlwindow
+0003ced0: 203d 2065 7665 6e74 2e47 6574 4c69 6e6b   = event.GetLink
+0003cee0: 496e 666f 2829 2e48 7265 662c 2065 7665  Info().Href, eve
+0003cef0: 6e74 2e45 7665 6e74 4f62 6a65 6374 0d0a  nt.EventObject..
+0003cf00: 2020 2020 2020 2020 6966 2067 6574 6174          if getat
+0003cf10: 7472 2868 746d 6c77 696e 646f 772c 2022  tr(htmlwindow, "
+0003cf20: 6973 5f72 6967 6874 636c 6963 6b22 2c20  is_rightclick", 
+0003cf30: 4661 6c73 6529 3a0d 0a0d 0a20 2020 2020  False):....     
+0003cf40: 2020 2020 2020 2064 6566 206f 6e5f 636f         def on_co
+0003cf50: 7079 2865 7665 6e74 293a 0d0a 2020 2020  py(event):..    
+0003cf60: 2020 2020 2020 2020 2020 2020 6966 2077              if w
+0003cf70: 782e 5468 6543 6c69 7062 6f61 7264 2e4f  x.TheClipboard.O
+0003cf80: 7065 6e28 293a 0d0a 2020 2020 2020 2020  pen():..        
+0003cf90: 2020 2020 2020 2020 2020 2020 7465 7874              text
+0003cfa0: 203d 2068 746d 6c77 696e 646f 772e 5365   = htmlwindow.Se
+0003cfb0: 6c65 6374 696f 6e54 6f54 6578 7428 290d  lectionToText().
+0003cfc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003cfd0: 2020 2020 2064 203d 2077 782e 5465 7874       d = wx.Text
+0003cfe0: 4461 7461 4f62 6a65 6374 2874 6578 7429  DataObject(text)
+0003cff0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0003d000: 2020 2020 2020 7778 2e54 6865 436c 6970        wx.TheClip
+0003d010: 626f 6172 642e 5365 7444 6174 6128 6429  board.SetData(d)
+0003d020: 2c20 7778 2e54 6865 436c 6970 626f 6172  , wx.TheClipboar
+0003d030: 642e 436c 6f73 6528 290d 0a0d 0a20 2020  d.Close()....   
+0003d040: 2020 2020 2020 2020 2064 6566 206f 6e5f           def on_
+0003d050: 7365 6c65 6374 616c 6c28 6576 656e 7429  selectall(event)
+0003d060: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0003d070: 2020 2068 746d 6c77 696e 646f 772e 5365     htmlwindow.Se
+0003d080: 6c65 6374 416c 6c28 290d 0a0d 0a20 2020  lectAll()....   
+0003d090: 2020 2020 2020 2020 2068 746d 6c77 696e           htmlwin
+0003d0a0: 646f 772e 6973 5f72 6967 6874 636c 6963  dow.is_rightclic
+0003d0b0: 6b20 3d20 4661 6c73 650d 0a20 2020 2020  k = False..     
+0003d0c0: 2020 2020 2020 206d 656e 7520 3d20 7778         menu = wx
+0003d0d0: 2e4d 656e 7528 290d 0a20 2020 2020 2020  .Menu()..       
+0003d0e0: 2020 2020 2069 7465 6d5f 7365 6c65 6374       item_select
+0003d0f0: 696f 6e20 3d20 7778 2e4d 656e 7549 7465  ion = wx.MenuIte
+0003d100: 6d28 6d65 6e75 2c20 2d31 2c20 2226 436f  m(menu, -1, "&Co
+0003d110: 7079 2073 656c 6563 7469 6f6e 2229 0d0a  py selection")..
+0003d120: 2020 2020 2020 2020 2020 2020 6974 656d              item
+0003d130: 5f73 656c 6563 7461 6c6c 203d 2077 782e  _selectall = wx.
+0003d140: 4d65 6e75 4974 656d 286d 656e 752c 202d  MenuItem(menu, -
+0003d150: 312c 2022 2653 656c 6563 7420 616c 6c22  1, "&Select all"
+0003d160: 290d 0a20 2020 2020 2020 2020 2020 206d  )..            m
+0003d170: 656e 752e 4170 7065 6e64 2869 7465 6d5f  enu.Append(item_
+0003d180: 7365 6c65 6374 696f 6e29 0d0a 2020 2020  selection)..    
+0003d190: 2020 2020 2020 2020 6d65 6e75 2e41 7070          menu.App
+0003d1a0: 656e 6428 6974 656d 5f73 656c 6563 7461  end(item_selecta
+0003d1b0: 6c6c 290d 0a20 2020 2020 2020 2020 2020  ll)..           
+0003d1c0: 2069 7465 6d5f 7365 6c65 6374 696f 6e2e   item_selection.
+0003d1d0: 456e 6162 6c65 2862 6f6f 6c28 6874 6d6c  Enable(bool(html
+0003d1e0: 7769 6e64 6f77 2e53 656c 6563 7469 6f6e  window.Selection
+0003d1f0: 546f 5465 7874 2829 2929 0d0a 2020 2020  ToText()))..    
+0003d200: 2020 2020 2020 2020 6d65 6e75 2e42 696e          menu.Bin
+0003d210: 6428 7778 2e45 5654 5f4d 454e 552c 206f  d(wx.EVT_MENU, o
+0003d220: 6e5f 636f 7079 2c20 2020 2020 2069 643d  n_copy,      id=
+0003d230: 6974 656d 5f73 656c 6563 7469 6f6e 2e47  item_selection.G
+0003d240: 6574 4964 2829 290d 0a20 2020 2020 2020  etId())..       
+0003d250: 2020 2020 206d 656e 752e 4269 6e64 2877       menu.Bind(w
+0003d260: 782e 4556 545f 4d45 4e55 2c20 6f6e 5f73  x.EVT_MENU, on_s
+0003d270: 656c 6563 7461 6c6c 2c20 6964 3d69 7465  electall, id=ite
+0003d280: 6d5f 7365 6c65 6374 616c 6c2e 4765 7449  m_selectall.GetI
+0003d290: 6428 2929 0d0a 2020 2020 2020 2020 2020  d())..          
+0003d2a0: 2020 6874 6d6c 7769 6e64 6f77 2e50 6f70    htmlwindow.Pop
+0003d2b0: 7570 4d65 6e75 286d 656e 7529 0d0a 2020  upMenu(menu)..  
+0003d2c0: 2020 2020 2020 656c 6966 2068 7265 662e        elif href.
+0003d2d0: 7374 6172 7473 7769 7468 2822 2322 293a  startswith("#"):
+0003d2e0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+0003d2f0: 6c66 2e68 746d 6c5f 7374 6174 732e 5363  lf.html_stats.Sc
+0003d300: 726f 6c6c 546f 416e 6368 6f72 2868 7265  rollToAnchor(hre
+0003d310: 665b 313a 5d29 0d0a 2020 2020 2020 2020  f[1:])..        
+0003d320: 2020 2020 7778 2e43 616c 6c41 6674 6572      wx.CallAfter
+0003d330: 2873 656c 662e 7374 6f72 655f 6874 6d6c  (self.store_html
+0003d340: 5f73 7461 7473 5f73 6372 6f6c 6c29 0d0a  _stats_scroll)..
+0003d350: 2020 2020 2020 2020 656c 6966 2068 7265          elif hre
+0003d360: 662e 7374 6172 7473 7769 7468 2822 6669  f.startswith("fi
+0003d370: 6c65 3a2f 2f22 293a 0d0a 2020 2020 2020  le://"):..      
+0003d380: 2020 2020 2020 6669 6c65 7061 7468 203d        filepath =
+0003d390: 2075 726c 6c69 622e 7265 7175 6573 742e   urllib.request.
+0003d3a0: 7572 6c32 7061 7468 6e61 6d65 2868 7265  url2pathname(hre
+0003d3b0: 665b 353a 5d29 0d0a 2020 2020 2020 2020  f[5:])..        
+0003d3c0: 2020 2020 6966 2066 696c 6570 6174 6820      if filepath 
+0003d3d0: 616e 6420 6f73 2e70 6174 682e 6578 6973  and os.path.exis
+0003d3e0: 7473 2866 696c 6570 6174 6829 3a0d 0a20  ts(filepath):.. 
+0003d3f0: 2020 2020 2020 2020 2020 2020 2020 2075                 u
+0003d400: 7469 6c2e 7374 6172 745f 6669 6c65 2866  til.start_file(f
+0003d410: 696c 6570 6174 6829 0d0a 2020 2020 2020  ilepath)..      
+0003d420: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+0003d430: 2020 2020 2020 2020 2020 2020 206d 6573               mes
+0003d440: 7361 6765 426f 7828 0d0a 2020 2020 2020  sageBox(..      
+0003d450: 2020 2020 2020 2020 2020 2020 2020 2254                "T
+0003d460: 6865 2066 696c 6520 5c22 2573 5c22 2063  he file \"%s\" c
+0003d470: 616e 6e6f 7420 6265 2066 6f75 6e64 206f  annot be found o
+0003d480: 6e20 7468 6973 2063 6f6d 7075 7465 722e  n this computer.
+0003d490: 220d 0a20 2020 2020 2020 2020 2020 2020  "..             
+0003d4a0: 2020 2020 2020 2025 2028 6669 6c65 7061         % (filepa
+0003d4b0: 7468 292c 0d0a 2020 2020 2020 2020 2020  th),..          
+0003d4c0: 2020 2020 2020 2020 2020 636f 6e66 2e54            conf.T
+0003d4d0: 6974 6c65 2c20 7778 2e4f 4b20 7c20 7778  itle, wx.OK | wx
+0003d4e0: 2e49 434f 4e5f 494e 464f 524d 4154 494f  .ICON_INFORMATIO
+0003d4f0: 4e0d 0a20 2020 2020 2020 2020 2020 2020  N..             
+0003d500: 2020 2029 0d0a 2020 2020 2020 2020 656c     )..        el
+0003d510: 6966 2068 7265 662e 7374 6172 7473 7769  if href.startswi
+0003d520: 7468 2822 6874 7470 3a22 2920 6f72 2068  th("http:") or h
+0003d530: 7265 662e 7374 6172 7473 7769 7468 2822  ref.startswith("
+0003d540: 6874 7470 733a 2229 3a0d 0a20 2020 2020  https:"):..     
+0003d550: 2020 2020 2020 2077 6562 6272 6f77 7365         webbrowse
+0003d560: 722e 6f70 656e 2868 7265 6629 0d0a 2020  r.open(href)..  
+0003d570: 2020 2020 2020 656c 6966 2068 7265 662e        elif href.
+0003d580: 7374 6172 7473 7769 7468 2822 736f 7274  startswith("sort
+0003d590: 3a2f 2f22 293a 0d0a 2020 2020 2020 2020  ://"):..        
+0003d5a0: 2020 2020 7365 6c66 2e73 7461 7473 5f73      self.stats_s
+0003d5b0: 6f72 745f 6669 656c 6420 3d20 6872 6566  ort_field = href
+0003d5c0: 5b37 3a5d 0d0a 2020 2020 2020 2020 2020  [7:]..          
+0003d5d0: 2020 7365 6c66 2e70 6f70 756c 6174 655f    self.populate_
+0003d5e0: 6368 6174 5f73 7461 7469 7374 6963 7328  chat_statistics(
+0003d5f0: 290d 0a20 2020 2020 2020 2065 6c69 6620  )..        elif 
+0003d600: 6872 6566 2e73 7461 7274 7377 6974 6828  href.startswith(
+0003d610: 2265 7870 616e 643a 2f2f 2229 3a0d 0a20  "expand://"):.. 
+0003d620: 2020 2020 2020 2020 2020 2073 6563 7469             secti
+0003d630: 6f6e 203d 2068 7265 665b 393a 5d0d 0a20  on = href[9:].. 
+0003d640: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0003d650: 7374 6174 735f 6578 7061 6e64 5b73 6563  stats_expand[sec
+0003d660: 7469 6f6e 5d20 3d20 6e6f 7420 7365 6c66  tion] = not self
+0003d670: 2e73 7461 7473 5f65 7870 616e 645b 7365  .stats_expand[se
+0003d680: 6374 696f 6e5d 0d0a 2020 2020 2020 2020  ction]..        
+0003d690: 2020 2020 7365 6c66 2e70 6f70 756c 6174      self.populat
+0003d6a0: 655f 6368 6174 5f73 7461 7469 7374 6963  e_chat_statistic
+0003d6b0: 7328 290d 0a20 2020 2020 2020 2065 6c69  s()..        eli
+0003d6c0: 6620 6872 6566 2e73 7461 7274 7377 6974  f href.startswit
+0003d6d0: 6828 2263 6f6e 7461 6374 3a22 293a 0d0a  h("contact:"):..
+0003d6e0: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+0003d6f0: 6163 7469 6420 3d20 696e 7428 6872 6566  actid = int(href
+0003d700: 5b68 7265 662e 696e 6465 7828 223a 2229  [href.index(":")
+0003d710: 202b 2031 3a5d 290d 0a20 2020 2020 2020   + 1:])..       
+0003d720: 2020 2020 2063 6f6e 7461 6374 203d 206e       contact = n
+0003d730: 6578 7428 2878 2066 6f72 2078 2069 6e20  ext((x for x in 
+0003d740: 5b73 656c 662e 6462 2e61 6363 6f75 6e74  [self.db.account
+0003d750: 5d20 2b20 7365 6c66 2e63 6f6e 7461 6374  ] + self.contact
+0003d760: 7320 6966 2078 5b22 6964 225d 203d 3d20  s if x["id"] == 
+0003d770: 636f 6e74 6163 7469 6429 2c20 4e6f 6e65  contactid), None
+0003d780: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
+0003d790: 6620 636f 6e74 6163 743a 0d0a 2020 2020  f contact:..    
+0003d7a0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0003d7b0: 2e6e 6f74 6562 6f6f 6b2e 5365 7453 656c  .notebook.SetSel
+0003d7c0: 6563 7469 6f6e 2873 656c 662e 7061 6765  ection(self.page
+0003d7d0: 6f72 6465 725b 7365 6c66 2e70 6167 655f  order[self.page_
+0003d7e0: 636f 6e74 6163 7473 5d29 0d0a 2020 2020  contacts])..    
+0003d7f0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0003d800: 2e6c 6f61 645f 636f 6e74 6163 7428 636f  .load_contact(co
+0003d810: 6e74 6163 7429 0d0a 2020 2020 2020 2020  ntact)..        
+0003d820: 656c 6966 2068 7265 662e 7374 6172 7473  elif href.starts
+0003d830: 7769 7468 2822 6d65 7373 6167 653a 2229  with("message:")
+0003d840: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+0003d850: 656c 662e 7368 6f77 5f73 7461 7473 2846  elf.show_stats(F
+0003d860: 616c 7365 290d 0a20 2020 2020 2020 2020  alse)..         
+0003d870: 2020 2073 656c 662e 7374 635f 6869 7374     self.stc_hist
+0003d880: 6f72 792e 466f 6375 734d 6573 7361 6765  ory.FocusMessage
+0003d890: 2869 6e74 2868 7265 665b 383a 5d29 290d  (int(href[8:])).
+0003d8a0: 0a20 2020 2020 2020 2065 6c69 6620 6872  .        elif hr
+0003d8b0: 6566 203d 3d20 2270 6963 7475 7265 223a  ef == "picture":
+0003d8c0: 0d0a 2020 2020 2020 2020 2020 2020 696d  ..            im
+0003d8d0: 676b 6579 203d 2028 2263 6861 7422 2c20  gkey = ("chat", 
+0003d8e0: 7365 6c66 2e63 6861 745b 2269 6422 5d29  self.chat["id"])
+0003d8f0: 0d0a 2020 2020 2020 2020 2020 2020 696d  ..            im
+0003d900: 6720 3d20 7365 6c66 2e69 6d61 6765 6361  g = self.imageca
+0003d910: 6368 652e 6765 7428 696d 676b 6579 290d  che.get(imgkey).
+0003d920: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0003d930: 6e6f 7420 696d 673a 2072 6574 7572 6e0d  not img: return.
+0003d940: 0a0d 0a20 2020 2020 2020 2020 2020 2073  ...            s
+0003d950: 656c 662e 6469 616c 6f67 5f73 6176 6569  elf.dialog_savei
+0003d960: 6d61 6765 2e46 696c 656e 616d 6520 3d20  mage.Filename = 
+0003d970: 7574 696c 2e73 6166 655f 6669 6c65 6e61  util.safe_filena
+0003d980: 6d65 2873 656c 662e 6368 6174 5b22 7469  me(self.chat["ti
+0003d990: 746c 655f 6c6f 6e67 225d 290d 0a20 2020  tle_long"])..   
+0003d9a0: 2020 2020 2020 2020 2066 6d74 203d 206e           fmt = n
+0003d9b0: 6578 7428 286b 2066 6f72 206b 2c20 7620  ext((k for k, v 
+0003d9c0: 696e 2065 7870 6f72 742e 494d 4147 455f  in export.IMAGE_
+0003d9d0: 464f 524d 4154 532e 6974 656d 7328 2920  FORMATS.items() 
+0003d9e0: 6966 2076 203d 3d20 696d 672e 5479 7065  if v == img.Type
+0003d9f0: 292c 204e 6f6e 6529 0d0a 2020 2020 2020  ), None)..      
+0003da00: 2020 2020 2020 6966 2066 6d74 3a20 7365        if fmt: se
+0003da10: 6c66 2e64 6961 6c6f 675f 7361 7665 696d  lf.dialog_saveim
+0003da20: 6167 652e 4669 6c74 6572 496e 6465 7820  age.FilterIndex 
+0003da30: 3d20 6578 706f 7274 2e49 4d41 4745 5f45  = export.IMAGE_E
+0003da40: 5854 532e 696e 6465 7828 666d 7429 0d0a  XTS.index(fmt)..
+0003da50: 2020 2020 2020 2020 2020 2020 6966 2077              if w
+0003da60: 782e 4944 5f4f 4b20 213d 2073 656c 662e  x.ID_OK != self.
+0003da70: 6469 616c 6f67 5f73 6176 6569 6d61 6765  dialog_saveimage
+0003da80: 2e53 686f 774d 6f64 616c 2829 3a20 7265  .ShowModal(): re
+0003da90: 7475 726e 0d0a 0d0a 2020 2020 2020 2020  turn....        
+0003daa0: 2020 2020 6669 6c65 7061 7468 203d 2063      filepath = c
+0003dab0: 6f6e 7472 6f6c 732e 6765 745f 6469 616c  ontrols.get_dial
+0003dac0: 6f67 5f70 6174 6828 7365 6c66 2e64 6961  og_path(self.dia
+0003dad0: 6c6f 675f 7361 7665 696d 6167 6529 0d0a  log_saveimage)..
+0003dae0: 2020 2020 2020 2020 2020 2020 6775 6962              guib
+0003daf0: 6173 652e 7374 6174 7573 2827 4578 706f  ase.status('Expo
+0003db00: 7274 696e 6720 2225 7322 2e27 2c20 6669  rting "%s".', fi
+0003db10: 6c65 7061 7468 2c20 6c6f 673d 5472 7565  lepath, log=True
+0003db20: 290d 0a20 2020 2020 2020 2020 2020 2065  )..            e
+0003db30: 7874 203d 206f 732e 7061 7468 2e73 706c  xt = os.path.spl
+0003db40: 6974 6578 7428 6669 6c65 7061 7468 295b  itext(filepath)[
+0003db50: 2d31 5d2e 6c73 7472 6970 2822 2e22 292e  -1].lstrip(".").
+0003db60: 6c6f 7765 7228 290d 0a20 2020 2020 2020  lower()..       
+0003db70: 2020 2020 2023 204d 616b 6520 636f 7079       # Make copy
+0003db80: 2061 7320 5361 7665 4669 6c65 2829 2063   as SaveFile() c
+0003db90: 6f6e 7665 7274 7320 696d 6167 6520 666f  onverts image fo
+0003dba0: 726d 6174 0d0a 2020 2020 2020 2020 2020  rmat..          
+0003dbb0: 2020 696d 672e 436f 7079 2829 2e53 6176    img.Copy().Sav
+0003dbc0: 6546 696c 6528 6669 6c65 7061 7468 2c20  eFile(filepath, 
+0003dbd0: 6578 706f 7274 2e49 4d41 4745 5f46 4f52  export.IMAGE_FOR
+0003dbe0: 4d41 5453 5b65 7874 5d29 0d0a 2020 2020  MATS[ext])..    
+0003dbf0: 2020 2020 2020 2020 7574 696c 2e73 7461          util.sta
+0003dc00: 7274 5f66 696c 6528 6669 6c65 7061 7468  rt_file(filepath
+0003dc10: 290d 0a20 2020 2020 2020 2065 6c73 653a  )..        else:
+0003dc20: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+0003dc30: 6c66 2e73 7463 5f68 6973 746f 7279 2e53  lf.stc_history.S
+0003dc40: 6561 7263 6842 6172 5669 7369 626c 6520  earchBarVisible 
+0003dc50: 3d20 5472 7565 0d0a 2020 2020 2020 2020  = True..        
+0003dc60: 2020 2020 7365 6c66 2e73 686f 775f 7374      self.show_st
+0003dc70: 6174 7328 4661 6c73 6529 0d0a 2020 2020  ats(False)..    
+0003dc80: 2020 2020 2020 2020 7365 6c66 2e73 7463          self.stc
+0003dc90: 5f68 6973 746f 7279 2e53 6561 7263 6828  _history.Search(
+0003dca0: 6872 6566 2c20 666c 6167 733d 7778 2e73  href, flags=wx.s
+0003dcb0: 7463 2e53 5443 5f46 494e 445f 5748 4f4c  tc.STC_FIND_WHOL
+0003dcc0: 4557 4f52 4429 0d0a 2020 2020 2020 2020  EWORD)..        
+0003dcd0: 2020 2020 7365 6c66 2e73 7463 5f68 6973      self.stc_his
+0003dce0: 746f 7279 2e53 6574 466f 6375 7353 6561  tory.SetFocusSea
+0003dcf0: 7263 6828 290d 0a0d 0a0d 0a20 2020 2064  rch()......    d
+0003dd00: 6566 206f 6e5f 636c 6963 6b5f 6874 6d6c  ef on_click_html
+0003dd10: 5f63 6f6e 7461 6374 2873 656c 662c 2065  _contact(self, e
+0003dd20: 7665 6e74 293a 0d0a 2020 2020 2020 2020  vent):..        
+0003dd30: 2222 220d 0a20 2020 2020 2020 2048 616e  """..        Han
+0003dd40: 646c 6572 2066 6f72 2063 6c69 636b 696e  dler for clickin
+0003dd50: 6720 6120 6c69 6e6b 2069 6e20 636f 6e74  g a link in cont
+0003dd60: 6163 7420 7061 6765 2c20 736f 7274 7320  act page, sorts 
+0003dd70: 6368 6174 7320 6966 2073 6f72 7420 6c69  chats if sort li
+0003dd80: 6e6b 2c20 676f 6573 2074 6f0d 0a20 2020  nk, goes to..   
+0003dd90: 2020 2020 2073 7065 6369 6669 6320 6d65       specific me
+0003dda0: 7373 6167 6520 6966 2063 6861 7420 6c69  ssage if chat li
+0003ddb0: 6e6b 2c20 7361 7665 7320 696d 6167 6520  nk, saves image 
+0003ddc0: 6966 2069 6d61 6765 206c 696e 6b2e 0d0a  if image link...
+0003ddd0: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
+0003dde0: 2020 2020 2068 7265 662c 2068 746d 6c77       href, htmlw
+0003ddf0: 696e 646f 7720 3d20 6576 656e 742e 4765  indow = event.Ge
+0003de00: 744c 696e 6b49 6e66 6f28 292e 4872 6566  tLinkInfo().Href
+0003de10: 2c20 6576 656e 742e 4576 656e 744f 626a  , event.EventObj
+0003de20: 6563 740d 0a20 2020 2020 2020 2069 6620  ect..        if 
+0003de30: 6765 7461 7474 7228 6874 6d6c 7769 6e64  getattr(htmlwind
+0003de40: 6f77 2c20 2269 735f 7269 6768 7463 6c69  ow, "is_rightcli
+0003de50: 636b 222c 2046 616c 7365 293a 0d0a 0d0a  ck", False):....
+0003de60: 2020 2020 2020 2020 2020 2020 6465 6620              def 
+0003de70: 6f6e 5f63 6f70 7928 6576 656e 7429 3a0d  on_copy(event):.
+0003de80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003de90: 2069 6620 7778 2e54 6865 436c 6970 626f   if wx.TheClipbo
+0003dea0: 6172 642e 4f70 656e 2829 3a0d 0a20 2020  ard.Open():..   
+0003deb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003dec0: 2074 6578 7420 3d20 6874 6d6c 7769 6e64   text = htmlwind
+0003ded0: 6f77 2e53 656c 6563 7469 6f6e 546f 5465  ow.SelectionToTe
+0003dee0: 7874 2829 0d0a 2020 2020 2020 2020 2020  xt()..          
+0003def0: 2020 2020 2020 2020 2020 6420 3d20 7778            d = wx
+0003df00: 2e54 6578 7444 6174 614f 626a 6563 7428  .TextDataObject(
+0003df10: 7465 7874 290d 0a20 2020 2020 2020 2020  text)..         
+0003df20: 2020 2020 2020 2020 2020 2077 782e 5468             wx.Th
+0003df30: 6543 6c69 7062 6f61 7264 2e53 6574 4461  eClipboard.SetDa
+0003df40: 7461 2864 292c 2077 782e 5468 6543 6c69  ta(d), wx.TheCli
+0003df50: 7062 6f61 7264 2e43 6c6f 7365 2829 0d0a  pboard.Close()..
+0003df60: 0d0a 2020 2020 2020 2020 2020 2020 6465  ..            de
+0003df70: 6620 6f6e 5f73 656c 6563 7461 6c6c 2865  f on_selectall(e
+0003df80: 7665 6e74 293a 0d0a 2020 2020 2020 2020  vent):..        
+0003df90: 2020 2020 2020 2020 6874 6d6c 7769 6e64          htmlwind
+0003dfa0: 6f77 2e53 656c 6563 7441 6c6c 2829 0d0a  ow.SelectAll()..
+0003dfb0: 0d0a 2020 2020 2020 2020 2020 2020 6874  ..            ht
+0003dfc0: 6d6c 7769 6e64 6f77 2e69 735f 7269 6768  mlwindow.is_righ
+0003dfd0: 7463 6c69 636b 203d 2046 616c 7365 0d0a  tclick = False..
+0003dfe0: 2020 2020 2020 2020 2020 2020 6d65 6e75              menu
+0003dff0: 203d 2077 782e 4d65 6e75 2829 0d0a 2020   = wx.Menu()..  
+0003e000: 2020 2020 2020 2020 2020 6974 656d 5f73            item_s
+0003e010: 656c 6563 7469 6f6e 203d 2077 782e 4d65  election = wx.Me
+0003e020: 6e75 4974 656d 286d 656e 752c 202d 312c  nuItem(menu, -1,
+0003e030: 2022 2643 6f70 7920 7365 6c65 6374 696f   "&Copy selectio
+0003e040: 6e22 290d 0a20 2020 2020 2020 2020 2020  n")..           
+0003e050: 2069 7465 6d5f 7365 6c65 6374 616c 6c20   item_selectall 
+0003e060: 3d20 7778 2e4d 656e 7549 7465 6d28 6d65  = wx.MenuItem(me
+0003e070: 6e75 2c20 2d31 2c20 2226 5365 6c65 6374  nu, -1, "&Select
+0003e080: 2061 6c6c 2229 0d0a 2020 2020 2020 2020   all")..        
+0003e090: 2020 2020 6d65 6e75 2e41 7070 656e 6428      menu.Append(
+0003e0a0: 6974 656d 5f73 656c 6563 7469 6f6e 290d  item_selection).
+0003e0b0: 0a20 2020 2020 2020 2020 2020 206d 656e  .            men
+0003e0c0: 752e 4170 7065 6e64 2869 7465 6d5f 7365  u.Append(item_se
+0003e0d0: 6c65 6374 616c 6c29 0d0a 2020 2020 2020  lectall)..      
+0003e0e0: 2020 2020 2020 6974 656d 5f73 656c 6563        item_selec
+0003e0f0: 7469 6f6e 2e45 6e61 626c 6528 626f 6f6c  tion.Enable(bool
+0003e100: 2868 746d 6c77 696e 646f 772e 5365 6c65  (htmlwindow.Sele
+0003e110: 6374 696f 6e54 6f54 6578 7428 2929 290d  ctionToText())).
+0003e120: 0a20 2020 2020 2020 2020 2020 206d 656e  .            men
+0003e130: 752e 4269 6e64 2877 782e 4556 545f 4d45  u.Bind(wx.EVT_ME
+0003e140: 4e55 2c20 6f6e 5f63 6f70 792c 2020 2020  NU, on_copy,    
+0003e150: 2020 6964 3d69 7465 6d5f 7365 6c65 6374    id=item_select
+0003e160: 696f 6e2e 4765 7449 6428 2929 0d0a 2020  ion.GetId())..  
+0003e170: 2020 2020 2020 2020 2020 6d65 6e75 2e42            menu.B
+0003e180: 696e 6428 7778 2e45 5654 5f4d 454e 552c  ind(wx.EVT_MENU,
+0003e190: 206f 6e5f 7365 6c65 6374 616c 6c2c 2069   on_selectall, i
+0003e1a0: 643d 6974 656d 5f73 656c 6563 7461 6c6c  d=item_selectall
+0003e1b0: 2e47 6574 4964 2829 290d 0a20 2020 2020  .GetId())..     
+0003e1c0: 2020 2020 2020 2068 746d 6c77 696e 646f         htmlwindo
+0003e1d0: 772e 506f 7075 704d 656e 7528 6d65 6e75  w.PopupMenu(menu
+0003e1e0: 290d 0a20 2020 2020 2020 2065 6c69 6620  )..        elif 
+0003e1f0: 6872 6566 203d 3d20 2261 7661 7461 7222  href == "avatar"
+0003e200: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
+0003e210: 6d67 6b65 7920 3d20 2822 6176 6174 6172  mgkey = ("avatar
+0003e220: 222c 2073 656c 662e 636f 6e74 6163 745b  ", self.contact[
+0003e230: 2269 6422 5d29 0d0a 2020 2020 2020 2020  "id"])..        
+0003e240: 2020 2020 696d 6720 3d20 7365 6c66 2e69      img = self.i
+0003e250: 6d61 6765 6361 6368 652e 6765 7428 696d  magecache.get(im
+0003e260: 676b 6579 290d 0a20 2020 2020 2020 2020  gkey)..         
+0003e270: 2020 2069 6620 6e6f 7420 696d 673a 2072     if not img: r
+0003e280: 6574 7572 6e0d 0a0d 0a20 2020 2020 2020  eturn....       
+0003e290: 2020 2020 2073 656c 662e 6469 616c 6f67       self.dialog
+0003e2a0: 5f73 6176 6569 6d61 6765 2e46 696c 656e  _saveimage.Filen
+0003e2b0: 616d 6520 3d20 7574 696c 2e73 6166 655f  ame = util.safe_
+0003e2c0: 6669 6c65 6e61 6d65 2873 656c 662e 636f  filename(self.co
+0003e2d0: 6e74 6163 745b 226e 616d 6522 5d29 0d0a  ntact["name"])..
+0003e2e0: 2020 2020 2020 2020 2020 2020 666d 7420              fmt 
+0003e2f0: 3d20 6e65 7874 2828 6b20 666f 7220 6b2c  = next((k for k,
+0003e300: 2076 2069 6e20 6578 706f 7274 2e49 4d41   v in export.IMA
+0003e310: 4745 5f46 4f52 4d41 5453 2e69 7465 6d73  GE_FORMATS.items
+0003e320: 2829 2069 6620 7620 3d3d 2069 6d67 2e54  () if v == img.T
+0003e330: 7970 6529 2c20 4e6f 6e65 290d 0a20 2020  ype), None)..   
+0003e340: 2020 2020 2020 2020 2069 6620 666d 743a           if fmt:
+0003e350: 2073 656c 662e 6469 616c 6f67 5f73 6176   self.dialog_sav
+0003e360: 6569 6d61 6765 2e46 696c 7465 7249 6e64  eimage.FilterInd
+0003e370: 6578 203d 2065 7870 6f72 742e 494d 4147  ex = export.IMAG
+0003e380: 455f 4558 5453 2e69 6e64 6578 2866 6d74  E_EXTS.index(fmt
+0003e390: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
+0003e3a0: 6620 7778 2e49 445f 4f4b 2021 3d20 7365  f wx.ID_OK != se
+0003e3b0: 6c66 2e64 6961 6c6f 675f 7361 7665 696d  lf.dialog_saveim
+0003e3c0: 6167 652e 5368 6f77 4d6f 6461 6c28 293a  age.ShowModal():
+0003e3d0: 2072 6574 7572 6e0d 0a0d 0a20 2020 2020   return....     
+0003e3e0: 2020 2020 2020 2066 696c 6570 6174 6820         filepath 
+0003e3f0: 3d20 636f 6e74 726f 6c73 2e67 6574 5f64  = controls.get_d
+0003e400: 6961 6c6f 675f 7061 7468 2873 656c 662e  ialog_path(self.
+0003e410: 6469 616c 6f67 5f73 6176 6569 6d61 6765  dialog_saveimage
+0003e420: 290d 0a20 2020 2020 2020 2020 2020 2067  )..            g
+0003e430: 7569 6261 7365 2e73 7461 7475 7328 2745  uibase.status('E
+0003e440: 7870 6f72 7469 6e67 2022 2573 222e 272c  xporting "%s".',
+0003e450: 2066 696c 6570 6174 682c 206c 6f67 3d54   filepath, log=T
+0003e460: 7275 6529 0d0a 2020 2020 2020 2020 2020  rue)..          
+0003e470: 2020 6578 7420 3d20 6f73 2e70 6174 682e    ext = os.path.
+0003e480: 7370 6c69 7465 7874 2866 696c 6570 6174  splitext(filepat
+0003e490: 6829 5b2d 315d 2e6c 7374 7269 7028 222e  h)[-1].lstrip(".
+0003e4a0: 2229 2e6c 6f77 6572 2829 0d0a 2020 2020  ").lower()..    
+0003e4b0: 2020 2020 2020 2020 2320 4d61 6b65 2063          # Make c
+0003e4c0: 6f70 7920 6173 2053 6176 6546 696c 6528  opy as SaveFile(
+0003e4d0: 2920 636f 6e76 6572 7473 2069 6d61 6765  ) converts image
+0003e4e0: 2066 6f72 6d61 740d 0a20 2020 2020 2020   format..       
+0003e4f0: 2020 2020 2069 6d67 2e43 6f70 7928 292e       img.Copy().
+0003e500: 5361 7665 4669 6c65 2866 696c 6570 6174  SaveFile(filepat
+0003e510: 682c 2065 7870 6f72 742e 494d 4147 455f  h, export.IMAGE_
+0003e520: 464f 524d 4154 535b 6578 745d 290d 0a20  FORMATS[ext]).. 
+0003e530: 2020 2020 2020 2020 2020 2075 7469 6c2e             util.
+0003e540: 7374 6172 745f 6669 6c65 2866 696c 6570  start_file(filep
+0003e550: 6174 6829 0d0a 2020 2020 2020 2020 656c  ath)..        el
+0003e560: 6966 2068 7265 662e 7374 6172 7473 7769  if href.startswi
+0003e570: 7468 2822 736f 7274 3a2f 2f22 293a 2023  th("sort://"): #
+0003e580: 2073 6f72 743a 2f2f 6669 656c 640d 0a20   sort://field.. 
+0003e590: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0003e5a0: 636f 6e74 6163 745f 736f 7274 5f66 6965  contact_sort_fie
+0003e5b0: 6c64 203d 2068 7265 665b 373a 5d0d 0a20  ld = href[7:].. 
+0003e5c0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0003e5d0: 6c6f 6164 5f63 6f6e 7461 6374 2873 656c  load_contact(sel
+0003e5e0: 662e 636f 6e74 6163 7429 0d0a 2020 2020  f.contact)..    
+0003e5f0: 2020 2020 656c 6966 2068 7265 662e 7374      elif href.st
+0003e600: 6172 7473 7769 7468 2822 6578 706f 7274  artswith("export
+0003e610: 3a2f 2f22 293a 2023 2065 7870 6f72 743a  ://"): # export:
+0003e620: 2f2f 6964 0d0a 2020 2020 2020 2020 2020  //id..          
+0003e630: 2020 6368 6174 6964 203d 2069 6e74 2868    chatid = int(h
+0003e640: 7265 665b 6872 6566 2e69 6e64 6578 2822  ref[href.index("
+0003e650: 3a2f 2f22 2920 2b20 333a 5d29 0d0a 2020  ://") + 3:])..  
+0003e660: 2020 2020 2020 2020 2020 6368 6174 203d            chat =
+0003e670: 206e 6578 7428 7820 666f 7220 7820 696e   next(x for x in
+0003e680: 2073 656c 662e 6368 6174 7320 6966 2078   self.chats if x
+0003e690: 5b22 6964 225d 203d 3d20 6368 6174 6964  ["id"] == chatid
+0003e6a0: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
+0003e6b0: 656c 662e 6f6e 5f65 7870 6f72 745f 6368  elf.on_export_ch
+0003e6c0: 6174 7328 5b63 6861 745d 290d 0a20 2020  ats([chat])..   
+0003e6d0: 2020 2020 2065 6c69 6620 6872 6566 2e73       elif href.s
+0003e6e0: 7461 7274 7377 6974 6828 2263 6861 743a  tartswith("chat:
+0003e6f0: 2f2f 2229 3a20 2320 6368 6174 3a2f 2f69  //"): # chat://i
+0003e700: 6420 6f72 2063 6861 743a 2f2f 6964 2f6d  d or chat://id/m
+0003e710: 6573 7361 6765 6964 0d0a 2020 2020 2020  essageid..      
+0003e720: 2020 2020 2020 7061 7468 203d 2068 7265        path = hre
+0003e730: 665b 6872 6566 2e69 6e64 6578 2822 3a2f  f[href.index(":/
+0003e740: 2f22 2920 2b20 333a 5d0d 0a20 2020 2020  /") + 3:]..     
+0003e750: 2020 2020 2020 2069 6620 222f 2220 696e         if "/" in
+0003e760: 2070 6174 683a 0d0a 2020 2020 2020 2020   path:..        
+0003e770: 2020 2020 2020 2020 6368 6174 6964 2c20          chatid, 
+0003e780: 6d65 7373 6167 6569 6420 3d20 6d61 7028  messageid = map(
+0003e790: 696e 742c 2070 6174 682e 7370 6c69 7428  int, path.split(
+0003e7a0: 222f 222c 2031 2929 0d0a 2020 2020 2020  "/", 1))..      
+0003e7b0: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+0003e7c0: 2020 2020 2020 2020 2020 2020 2063 6861               cha
+0003e7d0: 7469 642c 206d 6573 7361 6765 6964 203d  tid, messageid =
+0003e7e0: 2069 6e74 2870 6174 6829 2c20 4e6f 6e65   int(path), None
+0003e7f0: 0d0a 2020 2020 2020 2020 2020 2020 6368  ..            ch
+0003e800: 6174 203d 206e 6578 7428 2878 2066 6f72  at = next((x for
+0003e810: 2078 2069 6e20 7365 6c66 2e63 6861 7473   x in self.chats
+0003e820: 2069 6620 6368 6174 6964 203d 3d20 785b   if chatid == x[
+0003e830: 2269 6422 5d29 2c20 4e6f 6e65 290d 0a20  "id"]), None).. 
+0003e840: 2020 2020 2020 2020 2020 2069 6620 6368             if ch
+0003e850: 6174 3a0d 0a20 2020 2020 2020 2020 2020  at:..           
+0003e860: 2020 2020 2073 656c 662e 7368 6f77 5f73       self.show_s
+0003e870: 7461 7473 2846 616c 7365 290d 0a20 2020  tats(False)..   
+0003e880: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0003e890: 662e 6e6f 7465 626f 6f6b 2e53 6574 5365  f.notebook.SetSe
+0003e8a0: 6c65 6374 696f 6e28 7365 6c66 2e70 6167  lection(self.pag
+0003e8b0: 656f 7264 6572 5b73 656c 662e 7061 6765  eorder[self.page
+0003e8c0: 5f63 6861 7473 5d29 0d0a 2020 2020 2020  _chats])..      
+0003e8d0: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
+0003e8e0: 6f61 645f 6368 6174 2863 6861 742c 2063  oad_chat(chat, c
+0003e8f0: 656e 7465 725f 6d65 7373 6167 655f 6964  enter_message_id
+0003e900: 3d6d 6573 7361 6765 6964 290d 0a0d 0a0d  =messageid).....
+0003e910: 0a20 2020 2064 6566 206f 6e5f 7269 6768  .    def on_righ
+0003e920: 7463 6c69 636b 5f68 746d 6c28 7365 6c66  tclick_html(self
+0003e930: 2c20 6576 656e 7429 3a0d 0a20 2020 2020  , event):..     
+0003e940: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
+0003e950: 4861 6e64 6c65 7220 666f 7220 7269 6768  Handler for righ
+0003e960: 742d 636c 6963 6b69 6e67 2069 6e20 4874  t-clicking in Ht
+0003e970: 6d6c 5769 6e64 6f77 2c20 7365 7473 2075  mlWindow, sets u
+0003e980: 7020 6120 7465 6d70 6f72 6172 7920 666c  p a temporary fl
+0003e990: 6167 2066 6f72 0d0a 2020 2020 2020 2020  ag for..        
+0003e9a0: 4854 4d4c 206c 696e 6b20 636c 6963 6b20  HTML link click 
+0003e9b0: 6861 6e64 6c65 7220 746f 2063 6865 636b  handler to check
+0003e9c0: 2c20 696e 206f 7264 6572 2074 6f20 6469  , in order to di
+0003e9d0: 7370 6c61 7920 6120 636f 6e74 6578 7420  splay a context 
+0003e9e0: 6d65 6e75 2e0d 0a20 2020 2020 2020 2022  menu...        "
+0003e9f0: 2222 0d0a 2020 2020 2020 2020 6576 656e  ""..        even
+0003ea00: 742e 4576 656e 744f 626a 6563 742e 6973  t.EventObject.is
+0003ea10: 5f72 6967 6874 636c 6963 6b20 3d20 5472  _rightclick = Tr
+0003ea20: 7565 0d0a 2020 2020 2020 2020 6465 6620  ue..        def 
+0003ea30: 7265 7365 7428 6874 6d6c 7769 6e64 6f77  reset(htmlwindow
+0003ea40: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+0003ea50: 6966 206e 6f74 2073 656c 6620 6f72 206e  if not self or n
+0003ea60: 6f74 2068 746d 6c77 696e 646f 772e 6973  ot htmlwindow.is
+0003ea70: 5f72 6967 6874 636c 6963 6b3a 2072 6574  _rightclick: ret
+0003ea80: 7572 6e0d 0a20 2020 2020 2020 2020 2020  urn..           
+0003ea90: 2020 2020 200d 0a20 2020 2020 2020 2020       ..         
+0003eaa0: 2020 2064 6566 206f 6e5f 636f 7079 2865     def on_copy(e
+0003eab0: 7665 6e74 293a 0d0a 2020 2020 2020 2020  vent):..        
+0003eac0: 2020 2020 2020 2020 6966 2077 782e 5468          if wx.Th
+0003ead0: 6543 6c69 7062 6f61 7264 2e4f 7065 6e28  eClipboard.Open(
+0003eae0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+0003eaf0: 2020 2020 2020 2020 7465 7874 203d 2068          text = h
+0003eb00: 746d 6c77 696e 646f 772e 5365 6c65 6374  tmlwindow.Select
+0003eb10: 696f 6e54 6f54 6578 7428 290d 0a20 2020  ionToText()..   
+0003eb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003eb30: 2064 203d 2077 782e 5465 7874 4461 7461   d = wx.TextData
+0003eb40: 4f62 6a65 6374 2874 6578 7429 0d0a 2020  Object(text)..  
+0003eb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003eb60: 2020 7778 2e54 6865 436c 6970 626f 6172    wx.TheClipboar
+0003eb70: 642e 5365 7444 6174 6128 6429 2c20 7778  d.SetData(d), wx
+0003eb80: 2e54 6865 436c 6970 626f 6172 642e 436c  .TheClipboard.Cl
+0003eb90: 6f73 6528 290d 0a0d 0a20 2020 2020 2020  ose()....       
+0003eba0: 2020 2020 2064 6566 206f 6e5f 7365 6c65       def on_sele
+0003ebb0: 6374 616c 6c28 6576 656e 7429 3a0d 0a20  ctall(event):.. 
+0003ebc0: 2020 2020 2020 2020 2020 2020 2020 2068                 h
+0003ebd0: 746d 6c77 696e 646f 772e 5365 6c65 6374  tmlwindow.Select
+0003ebe0: 416c 6c28 290d 0a0d 0a20 2020 2020 2020  All()....       
+0003ebf0: 2020 2020 2023 2046 6c61 6720 7374 696c       # Flag stil
+0003ec00: 6c20 7570 3a20 7368 6f77 206d 656e 750d  l up: show menu.
+0003ec10: 0a20 2020 2020 2020 2020 2020 2068 746d  .            htm
+0003ec20: 6c77 696e 646f 772e 6973 5f72 6967 6874  lwindow.is_right
+0003ec30: 636c 6963 6b20 3d20 4661 6c73 650d 0a20  click = False.. 
+0003ec40: 2020 2020 2020 2020 2020 206d 656e 7520             menu 
+0003ec50: 3d20 7778 2e4d 656e 7528 290d 0a20 2020  = wx.Menu()..   
+0003ec60: 2020 2020 2020 2020 2069 7465 6d5f 7365           item_se
+0003ec70: 6c65 6374 696f 6e20 3d20 7778 2e4d 656e  lection = wx.Men
+0003ec80: 7549 7465 6d28 6d65 6e75 2c20 2d31 2c20  uItem(menu, -1, 
+0003ec90: 2226 436f 7079 2073 656c 6563 7469 6f6e  "&Copy selection
+0003eca0: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
+0003ecb0: 6974 656d 5f73 656c 6563 7461 6c6c 203d  item_selectall =
+0003ecc0: 2077 782e 4d65 6e75 4974 656d 286d 656e   wx.MenuItem(men
+0003ecd0: 752c 202d 312c 2022 2653 656c 6563 7420  u, -1, "&Select 
+0003ece0: 616c 6c22 290d 0a20 2020 2020 2020 2020  all")..         
+0003ecf0: 2020 206d 656e 752e 4170 7065 6e64 2869     menu.Append(i
+0003ed00: 7465 6d5f 7365 6c65 6374 696f 6e29 0d0a  tem_selection)..
+0003ed10: 2020 2020 2020 2020 2020 2020 6d65 6e75              menu
+0003ed20: 2e41 7070 656e 6428 6974 656d 5f73 656c  .Append(item_sel
+0003ed30: 6563 7461 6c6c 290d 0a20 2020 2020 2020  ectall)..       
+0003ed40: 2020 2020 2069 7465 6d5f 7365 6c65 6374       item_select
+0003ed50: 696f 6e2e 456e 6162 6c65 2862 6f6f 6c28  ion.Enable(bool(
+0003ed60: 6874 6d6c 7769 6e64 6f77 2e53 656c 6563  htmlwindow.Selec
+0003ed70: 7469 6f6e 546f 5465 7874 2829 2929 0d0a  tionToText()))..
+0003ed80: 2020 2020 2020 2020 2020 2020 6d65 6e75              menu
+0003ed90: 2e42 696e 6428 7778 2e45 5654 5f4d 454e  .Bind(wx.EVT_MEN
+0003eda0: 552c 206f 6e5f 636f 7079 2c20 2020 2020  U, on_copy,     
+0003edb0: 2069 643d 6974 656d 5f73 656c 6563 7469   id=item_selecti
+0003edc0: 6f6e 2e47 6574 4964 2829 290d 0a20 2020  on.GetId())..   
+0003edd0: 2020 2020 2020 2020 206d 656e 752e 4269           menu.Bi
+0003ede0: 6e64 2877 782e 4556 545f 4d45 4e55 2c20  nd(wx.EVT_MENU, 
+0003edf0: 6f6e 5f73 656c 6563 7461 6c6c 2c20 6964  on_selectall, id
+0003ee00: 3d69 7465 6d5f 7365 6c65 6374 616c 6c2e  =item_selectall.
+0003ee10: 4765 7449 6428 2929 0d0a 2020 2020 2020  GetId())..      
+0003ee20: 2020 2020 2020 6874 6d6c 7769 6e64 6f77        htmlwindow
+0003ee30: 2e50 6f70 7570 4d65 6e75 286d 656e 7529  .PopupMenu(menu)
+0003ee40: 0d0a 2020 2020 2020 2020 6576 656e 742e  ..        event.
+0003ee50: 536b 6970 2829 2c20 7778 2e43 616c 6c41  Skip(), wx.CallA
+0003ee60: 6674 6572 2872 6573 6574 2c20 6576 656e  fter(reset, even
+0003ee70: 742e 4576 656e 744f 626a 6563 7429 0d0a  t.EventObject)..
+0003ee80: 0d0a 0d0a 2020 2020 6465 6620 6f6e 5f63  ....    def on_c
+0003ee90: 6c69 636b 5f68 746d 6c5f 6c69 6e6b 2873  lick_html_link(s
+0003eea0: 656c 662c 2065 7665 6e74 293a 0d0a 2020  elf, event):..  
+0003eeb0: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
+0003eec0: 2020 2048 616e 646c 6572 2066 6f72 2063     Handler for c
+0003eed0: 6c69 636b 696e 6720 6120 6c69 6e6b 2069  licking a link i
+0003eee0: 6e20 4874 6d6c 5769 6e64 6f77 2c20 6f70  n HtmlWindow, op
+0003eef0: 656e 7320 7468 6520 6c69 6e6b 2069 6e73  ens the link ins
+0003ef00: 6964 650d 0a20 2020 2020 2020 2070 726f  ide..        pro
+0003ef10: 6772 616d 206f 7220 696e 2064 6566 6175  gram or in defau
+0003ef20: 6c74 2062 726f 7773 6572 2c20 6f70 656e  lt browser, open
+0003ef30: 7320 6120 706f 7075 706d 656e 7520 6966  s a popupmenu if
+0003ef40: 2072 6967 6874 2063 6c69 636b 2e0d 0a20   right click... 
+0003ef50: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
+0003ef60: 2020 2020 6872 6566 2c20 6874 6d6c 7769      href, htmlwi
+0003ef70: 6e64 6f77 203d 2065 7665 6e74 2e47 6574  ndow = event.Get
+0003ef80: 4c69 6e6b 496e 666f 2829 2e48 7265 662c  LinkInfo().Href,
+0003ef90: 2065 7665 6e74 2e45 7665 6e74 4f62 6a65   event.EventObje
+0003efa0: 6374 0d0a 2020 2020 2020 2020 6c69 6e6b  ct..        link
+0003efb0: 5f64 6174 612c 2074 6162 5f64 6174 6120  _data, tab_data 
+0003efc0: 3d20 4e6f 6e65 2c20 4e6f 6e65 0d0a 2020  = None, None..  
+0003efd0: 2020 2020 2020 6966 2068 746d 6c77 696e        if htmlwin
+0003efe0: 646f 7720 696e 2028 7365 6c66 2e68 746d  dow in (self.htm
+0003eff0: 6c5f 7365 6172 6368 616c 6c2c 2073 656c  l_searchall, sel
+0003f000: 662e 6874 6d6c 5f73 6561 7263 6861 6c6c  f.html_searchall
+0003f010: 2e48 746d 6c57 696e 646f 7729 3a0d 0a20  .HtmlWindow):.. 
+0003f020: 2020 2020 2020 2020 2020 2074 6162 5f64             tab_d
+0003f030: 6174 6120 3d20 7365 6c66 2e68 746d 6c5f  ata = self.html_
+0003f040: 7365 6172 6368 616c 6c2e 4765 7441 6374  searchall.GetAct
+0003f050: 6976 6554 6162 4461 7461 2829 0d0a 2020  iveTabData()..  
+0003f060: 2020 2020 2020 6966 2074 6162 5f64 6174        if tab_dat
+0003f070: 6120 616e 6420 7461 625f 6461 7461 2e67  a and tab_data.g
+0003f080: 6574 2822 696e 666f 2229 3a0d 0a20 2020  et("info"):..   
+0003f090: 2020 2020 2020 2020 206c 696e 6b5f 6461           link_da
+0003f0a0: 7461 203d 2074 6162 5f64 6174 615b 2269  ta = tab_data["i
+0003f0b0: 6e66 6f22 5d5b 226d 6170 225d 2e67 6574  nfo"]["map"].get
+0003f0c0: 2868 7265 662c 207b 7d29 0d0a 0d0a 2020  (href, {})....  
+0003f0d0: 2020 2020 2020 2320 576f 726b 6172 6f75        # Workarou
+0003f0e0: 6e64 2066 6f72 206e 6f20 7365 7061 7261  nd for no separa
+0003f0f0: 7465 2077 782e 6874 6d6c 2e48 746d 6c57  te wx.html.HtmlW
+0003f100: 696e 646f 7720 6c69 6e6b 2072 6967 6874  indow link right
+0003f110: 2063 6c69 636b 2065 7665 6e74 0d0a 2020   click event..  
+0003f120: 2020 2020 2020 6966 2067 6574 6174 7472        if getattr
+0003f130: 2868 746d 6c77 696e 646f 772c 2022 6973  (htmlwindow, "is
+0003f140: 5f72 6967 6874 636c 6963 6b22 2c20 4661  _rightclick", Fa
+0003f150: 6c73 6529 3a0d 0a20 2020 2020 2020 2020  lse):..         
+0003f160: 2020 2023 204f 7065 6e20 6120 706f 702d     # Open a pop-
+0003f170: 7570 206d 656e 7520 7769 7468 206f 7074  up menu with opt
+0003f180: 696f 6e73 2074 6f20 636f 7079 206f 7220  ions to copy or 
+0003f190: 7365 6c65 6374 2074 6578 740d 0a20 2020  select text..   
+0003f1a0: 2020 2020 2020 2020 2068 746d 6c77 696e           htmlwin
+0003f1b0: 646f 772e 6973 5f72 6967 6874 636c 6963  dow.is_rightclic
+0003f1c0: 6b20 3d20 4661 6c73 650d 0a20 2020 2020  k = False..     
+0003f1d0: 2020 2020 2020 2064 6566 2063 6c69 7062         def clipb
+0003f1e0: 6f61 7264 697a 6528 7465 7874 293a 0d0a  oardize(text):..
+0003f1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f200: 6966 2077 782e 5468 6543 6c69 7062 6f61  if wx.TheClipboa
+0003f210: 7264 2e4f 7065 6e28 293a 0d0a 2020 2020  rd.Open():..    
 0003f220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f240: 2061 6464 6974 696f 6e61 6c5f 7061 7261   additional_para
-0003f250: 6d73 3d7b 2269 6422 3a20 6d73 675f 6964  ms={"id": msg_id
-0003f260: 7d29 2c20 4e6f 6e65 290d 0a20 2020 2020  }), None)..     
-0003f270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f280: 2020 2069 6620 6d3a 0d0a 2020 2020 2020     if m:..      
-0003f290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f2a0: 2020 2020 2020 7420 3d20 7374 6570 2e54        t = step.T
-0003f2b0: 656d 706c 6174 6528 7465 6d70 6c61 7465  emplate(template
-0003f2c0: 732e 4d45 5353 4147 455f 434c 4950 424f  s.MESSAGE_CLIPBO
-0003f2d0: 4152 4429 0d0a 2020 2020 2020 2020 2020  ARD)..          
-0003f2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f2f0: 2020 7020 3d20 7b22 6d22 3a20 6d2c 2022    p = {"m": m, "
-0003f300: 7061 7273 6572 223a 2073 6b79 7065 6461  parser": skypeda
-0003f310: 7461 2e4d 6573 7361 6765 5061 7273 6572  ta.MessageParser
-0003f320: 2873 656c 662e 6462 297d 0d0a 2020 2020  (self.db)}..    
-0003f330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f340: 2020 2020 2020 2020 636c 6970 626f 6172          clipboar
-0003f350: 6469 7a65 2874 2e65 7870 616e 6428 7029  dize(t.expand(p)
-0003f360: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0003f370: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-0003f380: 2020 2020 2020 2020 2020 2020 2020 6368                ch
-0003f390: 6174 5f69 642c 2063 6861 7420 3d20 6c69  at_id, chat = li
-0003f3a0: 6e6b 5f64 6174 612e 6765 7428 2263 6861  nk_data.get("cha
-0003f3b0: 7422 292c 204e 6f6e 650d 0a20 2020 2020  t"), None..     
-0003f3c0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0003f3d0: 6620 6368 6174 5f69 643a 0d0a 2020 2020  f chat_id:..    
-0003f3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f3f0: 2020 2020 6368 6174 203d 206e 6578 7428      chat = next(
-0003f400: 2863 2066 6f72 2063 2069 6e20 7365 6c66  (c for c in self
-0003f410: 2e63 6861 7473 2069 6620 635b 2269 6422  .chats if c["id"
-0003f420: 5d20 3d3d 2063 6861 745f 6964 292c 204e  ] == chat_id), N
-0003f430: 6f6e 6529 0d0a 2020 2020 2020 2020 2020  one)..          
-0003f440: 2020 2020 2020 2020 2020 6966 2063 6861            if cha
-0003f450: 743a 0d0a 2020 2020 2020 2020 2020 2020  t:..            
-0003f460: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-0003f470: 6b79 7065 6461 7461 2e43 4841 5453 5f54  kypedata.CHATS_T
-0003f480: 5950 455f 5349 4e47 4c45 203d 3d20 6368  YPE_SINGLE == ch
-0003f490: 6174 5b22 7479 7065 225d 3a0d 0a20 2020  at["type"]:..   
-0003f4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f4b0: 2020 2020 2020 2020 2063 6f70 7974 6974           copytit
-0003f4c0: 6c65 2c20 636c 6970 7465 7874 203d 2022  le, cliptext = "
-0003f4d0: 4326 6f70 7920 636f 6e74 6163 7422 2c20  C&opy contact", 
-0003f4e0: 6368 6174 5b22 6964 656e 7469 7479 225d  chat["identity"]
-0003f4f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0003f500: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
-0003f510: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003f520: 2020 2020 2020 2020 2020 2020 2063 6f70               cop
-0003f530: 7974 6974 6c65 2c20 636c 6970 7465 7874  ytitle, cliptext
-0003f540: 203d 2022 4326 6f70 7920 6368 6174 206e   = "C&opy chat n
-0003f550: 616d 6522 2c20 6368 6174 5b22 7469 746c  ame", chat["titl
-0003f560: 6522 5d0d 0a20 2020 2020 2020 2020 2020  e"]..           
-0003f570: 2020 2020 2020 2020 2020 2020 2064 6566               def
-0003f580: 2068 616e 646c 6572 2865 293a 0d0a 2020   handler(e):..  
-0003f590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f5a0: 2020 2020 2020 2020 2020 636c 6970 626f            clipbo
-0003f5b0: 6172 6469 7a65 2863 6c69 7074 6578 7429  ardize(cliptext)
-0003f5c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0003f5d0: 2020 2020 2020 656c 6966 206c 696e 6b5f        elif link_
-0003f5e0: 6461 7461 2e67 6574 2822 726f 7722 293a  data.get("row"):
-0003f5f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0003f600: 2020 2020 2020 2020 2020 636f 7079 7469            copyti
-0003f610: 746c 6520 3d20 2243 266f 7079 2072 6f77  tle = "C&opy row
-0003f620: 220d 0a20 2020 2020 2020 2020 2020 2020  "..             
-0003f630: 2020 2020 2020 2020 2020 2064 6566 2068             def h
-0003f640: 616e 646c 6572 2865 293a 0d0a 2020 2020  andler(e):..    
-0003f650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f660: 2020 2020 2020 2020 636c 6970 626f 6172          clipboar
-0003f670: 6469 7a65 2872 6570 7228 6c69 6e6b 5f64  dize(repr(link_d
-0003f680: 6174 615b 2272 6f77 225d 2929 0d0a 2020  ata["row"]))..  
-0003f690: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
-0003f6a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003f6b0: 2063 6f70 7974 6974 6c65 203d 2022 4326   copytitle = "C&
-0003f6c0: 6f70 7920 6c69 6e6b 206c 6f63 6174 696f  opy link locatio
-0003f6d0: 6e22 0d0a 2020 2020 2020 2020 2020 2020  n"..            
-0003f6e0: 2020 2020 6966 2068 7265 662e 7374 6172      if href.star
-0003f6f0: 7473 7769 7468 2822 6669 6c65 3a2f 2f22  tswith("file://"
-0003f700: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-0003f710: 2020 2020 2020 2020 6872 6566 203d 2075          href = u
-0003f720: 726c 6c69 622e 7265 7175 6573 742e 7572  rllib.request.ur
-0003f730: 6c32 7061 7468 6e61 6d65 2868 7265 665b  l2pathname(href[
-0003f740: 353a 5d29 0d0a 2020 2020 2020 2020 2020  5:])..          
-0003f750: 2020 2020 2020 2020 2020 6966 2061 6e79            if any
-0003f760: 2868 7265 662e 7374 6172 7473 7769 7468  (href.startswith
-0003f770: 2878 2920 666f 7220 7820 696e 205b 225c  (x) for x in ["\
-0003f780: 5c5c 5c5c 5c22 2c20 222f 2f2f 225d 293a  \\\\\", "///"]):
-0003f790: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0003f7a0: 2020 2020 2020 2020 2020 6872 6566 203d            href =
-0003f7b0: 2068 7265 665b 333a 5d20 2320 5374 7269   href[3:] # Stri
-0003f7c0: 7020 7265 6475 6e64 616e 7420 6669 6c65  p redundant file
-0003f7d0: 6c69 6e6b 2073 6c61 7368 6573 0d0a 2020  link slashes..  
-0003f7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f7f0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-0003f800: 6872 6566 2c20 7369 782e 7465 7874 5f74  href, six.text_t
-0003f810: 7970 6529 3a0d 0a20 2020 2020 2020 2020  ype):..         
-0003f820: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0003f830: 2057 6f72 6b61 726f 756e 6420 666f 7220   Workaround for 
-0003f840: 7778 2e68 746d 6c2e 4874 6d6c 5769 6e64  wx.html.HtmlWind
-0003f850: 6f77 2064 6f75 626c 6520 656e 636f 6469  ow double encodi
-0003f860: 6e67 0d0a 2020 2020 2020 2020 2020 2020  ng..            
-0003f870: 2020 2020 2020 2020 2020 2020 6872 6566              href
-0003f880: 203d 2068 7265 662e 656e 636f 6465 2827   = href.encode('
-0003f890: 6c61 7469 6e31 272c 2065 7272 6f72 733d  latin1', errors=
-0003f8a0: 2278 6d6c 6368 6172 7265 6672 6570 6c61  "xmlcharrefrepla
-0003f8b0: 6365 2229 2e64 6563 6f64 6528 2275 7466  ce").decode("utf
-0003f8c0: 2d38 2229 0d0a 2020 2020 2020 2020 2020  -8")..          
-0003f8d0: 2020 2020 2020 2020 2020 636f 7079 7469            copyti
-0003f8e0: 746c 6520 3d20 2243 266f 7079 2066 696c  tle = "C&opy fil
-0003f8f0: 6520 6c6f 6361 7469 6f6e 220d 0a20 2020  e location"..   
-0003f900: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
-0003f910: 6620 6872 6566 2e73 7461 7274 7377 6974  f href.startswit
-0003f920: 6828 226d 6169 6c74 6f3a 2229 3a0d 0a20  h("mailto:"):.. 
-0003f930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f940: 2020 2068 7265 6620 3d20 6872 6566 5b37     href = href[7
-0003f950: 3a5d 0d0a 2020 2020 2020 2020 2020 2020  :]..            
-0003f960: 2020 2020 2020 2020 636f 7079 7469 746c          copytitl
-0003f970: 6520 3d20 2243 266f 7079 2065 2d6d 6169  e = "C&opy e-mai
-0003f980: 6c20 6164 6472 6573 7322 0d0a 2020 2020  l address"..    
-0003f990: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-0003f9a0: 2061 6e79 2868 7265 662e 7374 6172 7473   any(href.starts
-0003f9b0: 7769 7468 2878 2920 666f 7220 7820 696e  with(x) for x in
-0003f9c0: 205b 2263 616c 6c74 6f3a 222c 2022 736b   ["callto:", "sk
-0003f9d0: 7970 653a 222c 2022 7465 6c3a 225d 293a  ype:", "tel:"]):
-0003f9e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0003f9f0: 2020 2020 2020 6872 6566 203d 2068 7265        href = hre
-0003fa00: 665b 6872 6566 2e69 6e64 6578 2822 3a22  f[href.index(":"
-0003fa10: 2920 2b20 313a 5d0d 0a20 2020 2020 2020  ) + 1:]..       
-0003fa20: 2020 2020 2020 2020 2020 2020 2063 6f70               cop
-0003fa30: 7974 6974 6c65 203d 2022 4326 6f70 7920  ytitle = "C&opy 
-0003fa40: 636f 6e74 6163 7422 0d0a 2020 2020 2020  contact"..      
-0003fa50: 2020 2020 2020 2020 2020 6465 6620 6861            def ha
-0003fa60: 6e64 6c65 7228 6529 3a0d 0a20 2020 2020  ndler(e):..     
-0003fa70: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0003fa80: 6c69 7062 6f61 7264 697a 6528 6872 6566  lipboardize(href
-0003fa90: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
-0003faa0: 6620 636f 7079 7469 746c 653a 0d0a 2020  f copytitle:..  
-0003fab0: 2020 2020 2020 2020 2020 2020 2020 6465                de
-0003fac0: 6620 6f6e 5f63 6f70 7973 656c 6563 7469  f on_copyselecti
-0003fad0: 6f6e 2865 7665 6e74 293a 0d0a 2020 2020  on(event):..    
-0003fae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003faf0: 636c 6970 626f 6172 6469 7a65 2868 746d  clipboardize(htm
-0003fb00: 6c77 696e 646f 772e 5365 6c65 6374 696f  lwindow.Selectio
-0003fb10: 6e54 6f54 6578 7428 2929 0d0a 2020 2020  nToText())..    
-0003fb20: 2020 2020 2020 2020 2020 2020 6465 6620              def 
-0003fb30: 6f6e 5f73 656c 6563 7461 6c6c 2865 7665  on_selectall(eve
-0003fb40: 6e74 293a 0d0a 2020 2020 2020 2020 2020  nt):..          
-0003fb50: 2020 2020 2020 2020 2020 6874 6d6c 7769            htmlwi
-0003fb60: 6e64 6f77 2e53 656c 6563 7441 6c6c 2829  ndow.SelectAll()
-0003fb70: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0003fb80: 2020 6d65 6e75 203d 2077 782e 4d65 6e75    menu = wx.Menu
-0003fb90: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
-0003fba0: 2020 2020 6974 656d 5f73 656c 6563 7469      item_selecti
-0003fbb0: 6f6e 203d 2077 782e 4d65 6e75 4974 656d  on = wx.MenuItem
-0003fbc0: 286d 656e 752c 202d 312c 2022 2643 6f70  (menu, -1, "&Cop
-0003fbd0: 7920 7365 6c65 6374 696f 6e22 290d 0a20  y selection").. 
-0003fbe0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0003fbf0: 7465 6d5f 636f 7079 2020 2020 2020 3d20  tem_copy      = 
-0003fc00: 7778 2e4d 656e 7549 7465 6d28 6d65 6e75  wx.MenuItem(menu
-0003fc10: 2c20 2d31 2c20 636f 7079 7469 746c 6529  , -1, copytitle)
-0003fc20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0003fc30: 2020 6974 656d 5f73 656c 6563 7461 6c6c    item_selectall
-0003fc40: 203d 2077 782e 4d65 6e75 4974 656d 286d   = wx.MenuItem(m
-0003fc50: 656e 752c 202d 312c 2022 2653 656c 6563  enu, -1, "&Selec
-0003fc60: 7420 616c 6c22 290d 0a20 2020 2020 2020  t all")..       
-0003fc70: 2020 2020 2020 2020 206d 656e 752e 4170           menu.Ap
-0003fc80: 7065 6e64 2869 7465 6d5f 7365 6c65 6374  pend(item_select
-0003fc90: 696f 6e29 0d0a 2020 2020 2020 2020 2020  ion)..          
-0003fca0: 2020 2020 2020 6d65 6e75 2e41 7070 656e        menu.Appen
-0003fcb0: 6428 6974 656d 5f63 6f70 7929 0d0a 2020  d(item_copy)..  
-0003fcc0: 2020 2020 2020 2020 2020 2020 2020 6d65                me
-0003fcd0: 6e75 2e41 7070 656e 6428 6974 656d 5f73  nu.Append(item_s
-0003fce0: 656c 6563 7461 6c6c 290d 0a20 2020 2020  electall)..     
-0003fcf0: 2020 2020 2020 2020 2020 2069 7465 6d5f             item_
-0003fd00: 7365 6c65 6374 696f 6e2e 456e 6162 6c65  selection.Enable
-0003fd10: 2862 6f6f 6c28 6874 6d6c 7769 6e64 6f77  (bool(htmlwindow
-0003fd20: 2e53 656c 6563 7469 6f6e 546f 5465 7874  .SelectionToText
-0003fd30: 2829 2929 0d0a 2020 2020 2020 2020 2020  ()))..          
-0003fd40: 2020 2020 2020 6d65 6e75 2e42 696e 6428        menu.Bind(
-0003fd50: 7778 2e45 5654 5f4d 454e 552c 206f 6e5f  wx.EVT_MENU, on_
-0003fd60: 636f 7079 7365 6c65 6374 696f 6e2c 2069  copyselection, i
-0003fd70: 643d 6974 656d 5f73 656c 6563 7469 6f6e  d=item_selection
-0003fd80: 2e47 6574 4964 2829 290d 0a20 2020 2020  .GetId())..     
-0003fd90: 2020 2020 2020 2020 2020 206d 656e 752e             menu.
-0003fda0: 4269 6e64 2877 782e 4556 545f 4d45 4e55  Bind(wx.EVT_MENU
-0003fdb0: 2c20 6861 6e64 6c65 722c 2069 643d 6974  , handler, id=it
-0003fdc0: 656d 5f63 6f70 792e 4765 7449 6428 2929  em_copy.GetId())
-0003fdd0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0003fde0: 2020 6d65 6e75 2e42 696e 6428 7778 2e45    menu.Bind(wx.E
-0003fdf0: 5654 5f4d 454e 552c 206f 6e5f 7365 6c65  VT_MENU, on_sele
-0003fe00: 6374 616c 6c2c 2069 643d 6974 656d 5f73  ctall, id=item_s
-0003fe10: 656c 6563 7461 6c6c 2e47 6574 4964 2829  electall.GetId()
-0003fe20: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0003fe30: 2020 2068 746d 6c77 696e 646f 772e 506f     htmlwindow.Po
-0003fe40: 7075 704d 656e 7528 6d65 6e75 290d 0a20  pupMenu(menu).. 
-0003fe50: 2020 2020 2020 2065 6c69 6620 6c69 6e6b         elif link
-0003fe60: 5f64 6174 6120 6f72 2068 7265 662e 7374  _data or href.st
-0003fe70: 6172 7473 7769 7468 2822 6669 6c65 3a2f  artswith("file:/
-0003fe80: 2f22 293a 0d0a 2020 2020 2020 2020 2020  /"):..          
-0003fe90: 2020 2320 4f70 656e 2074 6865 206c 696e    # Open the lin
-0003fea0: 6b2c 206f 7220 6669 6c65 2c20 6f72 2070  k, or file, or p
-0003feb0: 726f 6772 616d 2069 6e74 6572 6e61 6c20  rogram internal 
-0003fec0: 6c69 6e6b 2074 6f20 6368 6174 206f 7220  link to chat or 
-0003fed0: 7461 626c 650d 0a20 2020 2020 2020 2020  table..         
-0003fee0: 2020 2063 6861 745f 6964 203d 206c 696e     chat_id = lin
-0003fef0: 6b5f 6461 7461 2e67 6574 2822 6368 6174  k_data.get("chat
-0003ff00: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
-0003ff10: 6d73 675f 6964 203d 206c 696e 6b5f 6461  msg_id = link_da
-0003ff20: 7461 2e67 6574 2822 6d65 7373 6167 6522  ta.get("message"
-0003ff30: 290d 0a20 2020 2020 2020 2020 2020 2074  )..            t
-0003ff40: 6162 6c65 5f6e 616d 652c 2072 6f77 203d  able_name, row =
-0003ff50: 206c 696e 6b5f 6461 7461 2e67 6574 2822   link_data.get("
-0003ff60: 7461 626c 6522 292c 206c 696e 6b5f 6461  table"), link_da
-0003ff70: 7461 2e67 6574 2822 726f 7722 290d 0a20  ta.get("row").. 
-0003ff80: 2020 2020 2020 2020 2020 2069 6620 6872             if hr
-0003ff90: 6566 2e73 7461 7274 7377 6974 6828 2266  ef.startswith("f
-0003ffa0: 696c 653a 2f2f 2229 3a0d 0a20 2020 2020  ile://"):..     
-0003ffb0: 2020 2020 2020 2020 2020 2066 696c 656e             filen
-0003ffc0: 616d 6520 3d20 7061 7468 203d 2075 726c  ame = path = url
-0003ffd0: 6c69 622e 7265 7175 6573 742e 7572 6c32  lib.request.url2
-0003ffe0: 7061 7468 6e61 6d65 2868 7265 665b 353a  pathname(href[5:
-0003fff0: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
-00040000: 2020 2020 6966 2061 6e79 2870 6174 682e      if any(path.
-00040010: 7374 6172 7473 7769 7468 2878 2920 666f  startswith(x) fo
-00040020: 7220 7820 696e 205b 225c 5c5c 5c5c 5c22  r x in ["\\\\\\"
-00040030: 2c20 222f 2f2f 225d 293a 0d0a 2020 2020  , "///"]):..    
-00040040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040050: 6669 6c65 6e61 6d65 203d 2068 7265 6620  filename = href 
-00040060: 3d20 7061 7468 5b33 3a5d 0d0a 2020 2020  = path[3:]..    
-00040070: 2020 2020 2020 2020 2020 2020 6966 2070              if p
-00040080: 6174 6820 616e 6420 6f73 2e70 6174 682e  ath and os.path.
-00040090: 6578 6973 7473 2870 6174 6829 3a0d 0a20  exists(path):.. 
-000400a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000400b0: 2020 2075 7469 6c2e 7374 6172 745f 6669     util.start_fi
-000400c0: 6c65 2870 6174 6829 0d0a 2020 2020 2020  le(path)..      
-000400d0: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
-000400e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000400f0: 2020 2020 2065 203d 2022 5468 6520 6669       e = "The fi
-00040100: 6c65 205c 2225 735c 2220 6361 6e6e 6f74  le \"%s\" cannot
-00040110: 2062 6520 666f 756e 6420 6f6e 2074 6869   be found on thi
-00040120: 7320 636f 6d70 7574 6572 2e22 2025 205c  s computer." % \
-00040130: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00040140: 2020 2020 2020 2020 2020 6669 6c65 6e61            filena
-00040150: 6d65 0d0a 2020 2020 2020 2020 2020 2020  me..            
-00040160: 2020 2020 2020 2020 6d65 7373 6167 6542          messageB
-00040170: 6f78 2865 2c20 636f 6e66 2e54 6974 6c65  ox(e, conf.Title
-00040180: 2c20 7778 2e4f 4b20 7c20 7778 2e49 434f  , wx.OK | wx.ICO
-00040190: 4e5f 494e 464f 524d 4154 494f 4e29 0d0a  N_INFORMATION)..
-000401a0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-000401b0: 2063 6861 745f 6964 3a0d 0a20 2020 2020   chat_id:..     
-000401c0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000401d0: 6e6f 7465 626f 6f6b 2e53 6574 5365 6c65  notebook.SetSele
-000401e0: 6374 696f 6e28 7365 6c66 2e70 6167 656f  ction(self.pageo
-000401f0: 7264 6572 5b73 656c 662e 7061 6765 5f63  rder[self.page_c
-00040200: 6861 7473 5d29 0d0a 2020 2020 2020 2020  hats])..        
-00040210: 2020 2020 2020 2020 6320 3d20 6e65 7874          c = next
-00040220: 2828 6320 666f 7220 6320 696e 2073 656c  ((c for c in sel
-00040230: 662e 6368 6174 7320 6966 2063 6861 745f  f.chats if chat_
-00040240: 6964 203d 3d20 635b 2269 6422 5d29 2c20  id == c["id"]), 
-00040250: 4e6f 6e65 290d 0a20 2020 2020 2020 2020  None)..         
-00040260: 2020 2020 2020 2069 6620 633a 0d0a 2020         if c:..  
-00040270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040280: 2020 7365 6c66 2e6c 6f61 645f 6368 6174    self.load_chat
-00040290: 2863 2c20 6365 6e74 6572 5f6d 6573 7361  (c, center_messa
-000402a0: 6765 5f69 643d 6d73 675f 6964 290d 0a20  ge_id=msg_id).. 
-000402b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000402c0: 2020 2073 656c 662e 7368 6f77 5f73 7461     self.show_sta
-000402d0: 7473 2846 616c 7365 290d 0a20 2020 2020  ts(False)..     
-000402e0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000402f0: 656c 662e 7374 635f 6869 7374 6f72 792e  elf.stc_history.
-00040300: 5365 7446 6f63 7573 2829 0d0a 2020 2020  SetFocus()..    
-00040310: 2020 2020 2020 2020 656c 6966 2074 6162          elif tab
-00040320: 6c65 5f6e 616d 6520 616e 6420 726f 773a  le_name and row:
-00040330: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00040340: 2020 7461 626c 6569 7465 6d20 3d20 4e6f    tableitem = No
-00040350: 6e65 0d0a 2020 2020 2020 2020 2020 2020  ne..            
-00040360: 2020 2020 7461 626c 655f 6e61 6d65 203d      table_name =
-00040370: 2074 6162 6c65 5f6e 616d 652e 6c6f 7765   table_name.lowe
-00040380: 7228 290d 0a20 2020 2020 2020 2020 2020  r()..           
-00040390: 2020 2020 2074 6162 6c65 203d 206e 6578       table = nex
-000403a0: 7428 2874 2066 6f72 2074 2069 6e20 7365  t((t for t in se
-000403b0: 6c66 2e64 622e 6765 745f 7461 626c 6573  lf.db.get_tables
-000403c0: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
-000403d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000403e0: 2020 6966 2074 5b22 6e61 6d65 225d 2e6c    if t["name"].l
-000403f0: 6f77 6572 2829 203d 3d20 7461 626c 655f  ower() == table_
-00040400: 6e61 6d65 292c 204e 6f6e 6529 0d0a 2020  name), None)..  
-00040410: 2020 2020 2020 2020 2020 2020 2020 6974                it
-00040420: 656d 203d 2073 656c 662e 7472 6565 5f74  em = self.tree_t
-00040430: 6162 6c65 732e 4765 744e 6578 7428 7365  ables.GetNext(se
-00040440: 6c66 2e74 7265 655f 7461 626c 6573 2e47  lf.tree_tables.G
-00040450: 6574 526f 6f74 4974 656d 2829 290d 0a20  etRootItem()).. 
-00040460: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-00040470: 6869 6c65 2074 6162 6c65 2061 6e64 2069  hile table and i
-00040480: 7465 6d20 616e 6420 6974 656d 2e49 734f  tem and item.IsO
-00040490: 6b28 293a 0d0a 2020 2020 2020 2020 2020  k():..          
-000404a0: 2020 2020 2020 2020 2020 7461 626c 6532            table2
-000404b0: 203d 2073 656c 662e 7472 6565 5f74 6162   = self.tree_tab
-000404c0: 6c65 732e 4765 7449 7465 6d50 7944 6174  les.GetItemPyDat
-000404d0: 6128 6974 656d 290d 0a20 2020 2020 2020  a(item)..       
-000404e0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000404f0: 7461 626c 6532 2061 6e64 2074 6162 6c65  table2 and table
-00040500: 322e 6c6f 7765 7228 2920 3d3d 2074 6162  2.lower() == tab
-00040510: 6c65 5b22 6e61 6d65 225d 2e6c 6f77 6572  le["name"].lower
-00040520: 2829 3a0d 0a20 2020 2020 2020 2020 2020  ():..           
-00040530: 2020 2020 2020 2020 2020 2020 2074 6162               tab
-00040540: 6c65 6974 656d 203d 2069 7465 6d0d 0a20  leitem = item.. 
-00040550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040560: 2020 2020 2020 2062 7265 616b 2023 2062         break # b
-00040570: 7265 616b 2077 6869 6c65 2074 6162 6c65  reak while table
-00040580: 2061 6e64 2069 7465 6d20 616e 6420 6974   and item and it
-00040590: 656b 2e49 734f 6b28 290d 0a20 2020 2020  ek.IsOk()..     
-000405a0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000405b0: 7465 6d20 3d20 7365 6c66 2e74 7265 655f  tem = self.tree_
-000405c0: 7461 626c 6573 2e47 6574 4e65 7874 5369  tables.GetNextSi
-000405d0: 626c 696e 6728 6974 656d 290d 0a20 2020  bling(item)..   
-000405e0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000405f0: 7461 626c 6569 7465 6d3a 0d0a 2020 2020  tableitem:..    
-00040600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040610: 7365 6c66 2e6e 6f74 6562 6f6f 6b2e 5365  self.notebook.Se
-00040620: 7453 656c 6563 7469 6f6e 2873 656c 662e  tSelection(self.
-00040630: 7061 6765 6f72 6465 725b 7365 6c66 2e70  pageorder[self.p
-00040640: 6167 655f 7461 626c 6573 5d29 0d0a 2020  age_tables])..  
-00040650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040660: 2020 7778 2e59 6965 6c64 4966 4e65 6564    wx.YieldIfNeed
-00040670: 6564 2829 0d0a 2020 2020 2020 2020 2020  ed()..          
-00040680: 2020 2020 2020 2020 2020 2320 4f6e 6c79            # Only
-00040690: 2077 6179 2074 6f20 6372 6561 7465 2073   way to create s
-000406a0: 7461 7465 2063 6861 6e67 6520 696e 2077  tate change in w
-000406b0: 782e 6c69 622e 6769 7a6d 6f73 2e54 7265  x.lib.gizmos.Tre
-000406c0: 654c 6973 7443 7472 6c0d 0a20 2020 2020  eListCtrl..     
-000406d0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-000406e0: 6c61 7373 2048 6163 6b45 7665 6e74 286f  lass HackEvent(o
-000406f0: 626a 6563 7429 3a0d 0a20 2020 2020 2020  bject):..       
+0003f230: 6420 3d20 7778 2e54 6578 7444 6174 614f  d = wx.TextDataO
+0003f240: 626a 6563 7428 7465 7874 290d 0a20 2020  bject(text)..   
+0003f250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f260: 2077 782e 5468 6543 6c69 7062 6f61 7264   wx.TheClipboard
+0003f270: 2e53 6574 4461 7461 2864 292c 2077 782e  .SetData(d), wx.
+0003f280: 5468 6543 6c69 7062 6f61 7264 2e43 6c6f  TheClipboard.Clo
+0003f290: 7365 2829 0d0a 2020 2020 2020 2020 2020  se()..          
+0003f2a0: 2020 636f 7079 7469 746c 6520 3d20 4e6f    copytitle = No
+0003f2b0: 6e65 0d0a 2020 2020 2020 2020 2020 2020  ne..            
+0003f2c0: 6966 206c 696e 6b5f 6461 7461 3a0d 0a20  if link_data:.. 
+0003f2d0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0003f2e0: 7367 5f69 642c 206d 203d 206c 696e 6b5f  sg_id, m = link_
+0003f2f0: 6461 7461 2e67 6574 2822 6d65 7373 6167  data.get("messag
+0003f300: 6522 292c 204e 6f6e 650d 0a20 2020 2020  e"), None..     
+0003f310: 2020 2020 2020 2020 2020 2069 6620 6d73             if ms
+0003f320: 675f 6964 3a0d 0a20 2020 2020 2020 2020  g_id:..         
+0003f330: 2020 2020 2020 2020 2020 2063 6f70 7974             copyt
+0003f340: 6974 6c65 203d 2022 4326 6f70 7920 6d65  itle = "C&opy me
+0003f350: 7373 6167 6522 0d0a 2020 2020 2020 2020  ssage"..        
+0003f360: 2020 2020 2020 2020 2020 2020 6465 6620              def 
+0003f370: 6861 6e64 6c65 7228 6529 3a0d 0a20 2020  handler(e):..   
+0003f380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f390: 2020 2020 2069 6620 6d73 675f 6964 3a0d       if msg_id:.
+0003f3a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003f3b0: 2020 2020 2020 2020 2020 2020 206d 203d               m =
+0003f3c0: 206e 6578 7428 7365 6c66 2e64 622e 6765   next(self.db.ge
+0003f3d0: 745f 6d65 7373 6167 6573 2861 6464 6974  t_messages(addit
+0003f3e0: 696f 6e61 6c5f 7371 6c3d 2269 6420 3d20  ional_sql="id = 
+0003f3f0: 3a69 6422 2c0d 0a20 2020 2020 2020 2020  :id",..         
+0003f400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f410: 2020 2020 2020 2020 2020 2020 6164 6469              addi
+0003f420: 7469 6f6e 616c 5f70 6172 616d 733d 7b22  tional_params={"
+0003f430: 6964 223a 206d 7367 5f69 647d 292c 204e  id": msg_id}), N
+0003f440: 6f6e 6529 0d0a 2020 2020 2020 2020 2020  one)..          
+0003f450: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0003f460: 206d 3a0d 0a20 2020 2020 2020 2020 2020   m:..           
+0003f470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f480: 2074 203d 2073 7465 702e 5465 6d70 6c61   t = step.Templa
+0003f490: 7465 2874 656d 706c 6174 6573 2e4d 4553  te(templates.MES
+0003f4a0: 5341 4745 5f43 4c49 5042 4f41 5244 290d  SAGE_CLIPBOARD).
+0003f4b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003f4c0: 2020 2020 2020 2020 2020 2020 2070 203d               p =
+0003f4d0: 207b 226d 223a 206d 2c20 2270 6172 7365   {"m": m, "parse
+0003f4e0: 7222 3a20 736b 7970 6564 6174 612e 4d65  r": skypedata.Me
+0003f4f0: 7373 6167 6550 6172 7365 7228 7365 6c66  ssageParser(self
+0003f500: 2e64 6229 7d0d 0a20 2020 2020 2020 2020  .db)}..         
+0003f510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f520: 2020 2063 6c69 7062 6f61 7264 697a 6528     clipboardize(
+0003f530: 742e 6578 7061 6e64 2870 2929 0d0a 2020  t.expand(p))..  
+0003f540: 2020 2020 2020 2020 2020 2020 2020 656c                el
+0003f550: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+0003f560: 2020 2020 2020 2020 2063 6861 745f 6964           chat_id
+0003f570: 2c20 6368 6174 203d 206c 696e 6b5f 6461  , chat = link_da
+0003f580: 7461 2e67 6574 2822 6368 6174 2229 2c20  ta.get("chat"), 
+0003f590: 4e6f 6e65 0d0a 2020 2020 2020 2020 2020  None..          
+0003f5a0: 2020 2020 2020 2020 2020 6966 2063 6861            if cha
+0003f5b0: 745f 6964 3a0d 0a20 2020 2020 2020 2020  t_id:..         
+0003f5c0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0003f5d0: 6861 7420 3d20 6e65 7874 2828 6320 666f  hat = next((c fo
+0003f5e0: 7220 6320 696e 2073 656c 662e 6368 6174  r c in self.chat
+0003f5f0: 7320 6966 2063 5b22 6964 225d 203d 3d20  s if c["id"] == 
+0003f600: 6368 6174 5f69 6429 2c20 4e6f 6e65 290d  chat_id), None).
+0003f610: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003f620: 2020 2020 2069 6620 6368 6174 3a0d 0a20       if chat:.. 
+0003f630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f640: 2020 2020 2020 2069 6620 736b 7970 6564         if skyped
+0003f650: 6174 612e 4348 4154 535f 5459 5045 5f53  ata.CHATS_TYPE_S
+0003f660: 494e 474c 4520 3d3d 2063 6861 745b 2274  INGLE == chat["t
+0003f670: 7970 6522 5d3a 0d0a 2020 2020 2020 2020  ype"]:..        
+0003f680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f690: 2020 2020 636f 7079 7469 746c 652c 2063      copytitle, c
+0003f6a0: 6c69 7074 6578 7420 3d20 2243 266f 7079  liptext = "C&opy
+0003f6b0: 2063 6f6e 7461 6374 222c 2063 6861 745b   contact", chat[
+0003f6c0: 2269 6465 6e74 6974 7922 5d0d 0a20 2020  "identity"]..   
+0003f6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f6e0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+0003f6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f700: 2020 2020 2020 2020 636f 7079 7469 746c          copytitl
+0003f710: 652c 2063 6c69 7074 6578 7420 3d20 2243  e, cliptext = "C
+0003f720: 266f 7079 2063 6861 7420 6e61 6d65 222c  &opy chat name",
+0003f730: 2063 6861 745b 2274 6974 6c65 225d 0d0a   chat["title"]..
+0003f740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f750: 2020 2020 2020 2020 6465 6620 6861 6e64          def hand
+0003f760: 6c65 7228 6529 3a0d 0a20 2020 2020 2020  ler(e):..       
+0003f770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f780: 2020 2020 2063 6c69 7062 6f61 7264 697a       clipboardiz
+0003f790: 6528 636c 6970 7465 7874 290d 0a20 2020  e(cliptext)..   
+0003f7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f7b0: 2065 6c69 6620 6c69 6e6b 5f64 6174 612e   elif link_data.
+0003f7c0: 6765 7428 2272 6f77 2229 3a0d 0a20 2020  get("row"):..   
+0003f7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f7e0: 2020 2020 2063 6f70 7974 6974 6c65 203d       copytitle =
+0003f7f0: 2022 4326 6f70 7920 726f 7722 0d0a 2020   "C&opy row"..  
+0003f800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f810: 2020 2020 2020 6465 6620 6861 6e64 6c65        def handle
+0003f820: 7228 6529 3a0d 0a20 2020 2020 2020 2020  r(e):..         
+0003f830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f840: 2020 2063 6c69 7062 6f61 7264 697a 6528     clipboardize(
+0003f850: 7265 7072 286c 696e 6b5f 6461 7461 5b22  repr(link_data["
+0003f860: 726f 7722 5d29 290d 0a20 2020 2020 2020  row"]))..       
+0003f870: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+0003f880: 2020 2020 2020 2020 2020 2020 636f 7079              copy
+0003f890: 7469 746c 6520 3d20 2243 266f 7079 206c  title = "C&opy l
+0003f8a0: 696e 6b20 6c6f 6361 7469 6f6e 220d 0a20  ink location".. 
+0003f8b0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0003f8c0: 6620 6872 6566 2e73 7461 7274 7377 6974  f href.startswit
+0003f8d0: 6828 2266 696c 653a 2f2f 2229 3a0d 0a20  h("file://"):.. 
+0003f8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f8f0: 2020 2068 7265 6620 3d20 7572 6c6c 6962     href = urllib
+0003f900: 2e72 6571 7565 7374 2e75 726c 3270 6174  .request.url2pat
+0003f910: 686e 616d 6528 6872 6566 5b35 3a5d 290d  hname(href[5:]).
+0003f920: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003f930: 2020 2020 2069 6620 616e 7928 6872 6566       if any(href
+0003f940: 2e73 7461 7274 7377 6974 6828 7829 2066  .startswith(x) f
+0003f950: 6f72 2078 2069 6e20 5b22 5c5c 5c5c 5c5c  or x in ["\\\\\\
+0003f960: 222c 2022 2f2f 2f22 5d29 3a0d 0a20 2020  ", "///"]):..   
+0003f970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f980: 2020 2020 2068 7265 6620 3d20 6872 6566       href = href
+0003f990: 5b33 3a5d 2023 2053 7472 6970 2072 6564  [3:] # Strip red
+0003f9a0: 756e 6461 6e74 2066 696c 656c 696e 6b20  undant filelink 
+0003f9b0: 736c 6173 6865 730d 0a20 2020 2020 2020  slashes..       
+0003f9c0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0003f9d0: 6973 696e 7374 616e 6365 2868 7265 662c  isinstance(href,
+0003f9e0: 2073 6978 2e74 6578 745f 7479 7065 293a   six.text_type):
+0003f9f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0003fa00: 2020 2020 2020 2020 2020 2320 576f 726b            # Work
+0003fa10: 6172 6f75 6e64 2066 6f72 2077 782e 6874  around for wx.ht
+0003fa20: 6d6c 2e48 746d 6c57 696e 646f 7720 646f  ml.HtmlWindow do
+0003fa30: 7562 6c65 2065 6e63 6f64 696e 670d 0a20  uble encoding.. 
+0003fa40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003fa50: 2020 2020 2020 2068 7265 6620 3d20 6872         href = hr
+0003fa60: 6566 2e65 6e63 6f64 6528 276c 6174 696e  ef.encode('latin
+0003fa70: 3127 2c20 6572 726f 7273 3d22 786d 6c63  1', errors="xmlc
+0003fa80: 6861 7272 6566 7265 706c 6163 6522 292e  harrefreplace").
+0003fa90: 6465 636f 6465 2822 7574 662d 3822 290d  decode("utf-8").
+0003faa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003fab0: 2020 2020 2063 6f70 7974 6974 6c65 203d       copytitle =
+0003fac0: 2022 4326 6f70 7920 6669 6c65 206c 6f63   "C&opy file loc
+0003fad0: 6174 696f 6e22 0d0a 2020 2020 2020 2020  ation"..        
+0003fae0: 2020 2020 2020 2020 656c 6966 2068 7265          elif hre
+0003faf0: 662e 7374 6172 7473 7769 7468 2822 6d61  f.startswith("ma
+0003fb00: 696c 746f 3a22 293a 0d0a 2020 2020 2020  ilto:"):..      
+0003fb10: 2020 2020 2020 2020 2020 2020 2020 6872                hr
+0003fb20: 6566 203d 2068 7265 665b 373a 5d0d 0a20  ef = href[7:].. 
+0003fb30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003fb40: 2020 2063 6f70 7974 6974 6c65 203d 2022     copytitle = "
+0003fb50: 4326 6f70 7920 652d 6d61 696c 2061 6464  C&opy e-mail add
+0003fb60: 7265 7373 220d 0a20 2020 2020 2020 2020  ress"..         
+0003fb70: 2020 2020 2020 2065 6c69 6620 616e 7928         elif any(
+0003fb80: 6872 6566 2e73 7461 7274 7377 6974 6828  href.startswith(
+0003fb90: 7829 2066 6f72 2078 2069 6e20 5b22 6361  x) for x in ["ca
+0003fba0: 6c6c 746f 3a22 2c20 2273 6b79 7065 3a22  llto:", "skype:"
+0003fbb0: 2c20 2274 656c 3a22 5d29 3a0d 0a20 2020  , "tel:"]):..   
+0003fbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003fbd0: 2068 7265 6620 3d20 6872 6566 5b68 7265   href = href[hre
+0003fbe0: 662e 696e 6465 7828 223a 2229 202b 2031  f.index(":") + 1
+0003fbf0: 3a5d 0d0a 2020 2020 2020 2020 2020 2020  :]..            
+0003fc00: 2020 2020 2020 2020 636f 7079 7469 746c          copytitl
+0003fc10: 6520 3d20 2243 266f 7079 2063 6f6e 7461  e = "C&opy conta
+0003fc20: 6374 220d 0a20 2020 2020 2020 2020 2020  ct"..           
+0003fc30: 2020 2020 2064 6566 2068 616e 646c 6572       def handler
+0003fc40: 2865 293a 0d0a 2020 2020 2020 2020 2020  (e):..          
+0003fc50: 2020 2020 2020 2020 2020 636c 6970 626f            clipbo
+0003fc60: 6172 6469 7a65 2868 7265 6629 0d0a 2020  ardize(href)..  
+0003fc70: 2020 2020 2020 2020 2020 6966 2063 6f70            if cop
+0003fc80: 7974 6974 6c65 3a0d 0a20 2020 2020 2020  ytitle:..       
+0003fc90: 2020 2020 2020 2020 2064 6566 206f 6e5f           def on_
+0003fca0: 636f 7079 7365 6c65 6374 696f 6e28 6576  copyselection(ev
+0003fcb0: 656e 7429 3a0d 0a20 2020 2020 2020 2020  ent):..         
+0003fcc0: 2020 2020 2020 2020 2020 2063 6c69 7062             clipb
+0003fcd0: 6f61 7264 697a 6528 6874 6d6c 7769 6e64  oardize(htmlwind
+0003fce0: 6f77 2e53 656c 6563 7469 6f6e 546f 5465  ow.SelectionToTe
+0003fcf0: 7874 2829 290d 0a20 2020 2020 2020 2020  xt())..         
+0003fd00: 2020 2020 2020 2064 6566 206f 6e5f 7365         def on_se
+0003fd10: 6c65 6374 616c 6c28 6576 656e 7429 3a0d  lectall(event):.
+0003fd20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003fd30: 2020 2020 2068 746d 6c77 696e 646f 772e       htmlwindow.
+0003fd40: 5365 6c65 6374 416c 6c28 290d 0a20 2020  SelectAll()..   
+0003fd50: 2020 2020 2020 2020 2020 2020 206d 656e               men
+0003fd60: 7520 3d20 7778 2e4d 656e 7528 290d 0a20  u = wx.Menu().. 
+0003fd70: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0003fd80: 7465 6d5f 7365 6c65 6374 696f 6e20 3d20  tem_selection = 
+0003fd90: 7778 2e4d 656e 7549 7465 6d28 6d65 6e75  wx.MenuItem(menu
+0003fda0: 2c20 2d31 2c20 2226 436f 7079 2073 656c  , -1, "&Copy sel
+0003fdb0: 6563 7469 6f6e 2229 0d0a 2020 2020 2020  ection")..      
+0003fdc0: 2020 2020 2020 2020 2020 6974 656d 5f63            item_c
+0003fdd0: 6f70 7920 2020 2020 203d 2077 782e 4d65  opy      = wx.Me
+0003fde0: 6e75 4974 656d 286d 656e 752c 202d 312c  nuItem(menu, -1,
+0003fdf0: 2063 6f70 7974 6974 6c65 290d 0a20 2020   copytitle)..   
+0003fe00: 2020 2020 2020 2020 2020 2020 2069 7465               ite
+0003fe10: 6d5f 7365 6c65 6374 616c 6c20 3d20 7778  m_selectall = wx
+0003fe20: 2e4d 656e 7549 7465 6d28 6d65 6e75 2c20  .MenuItem(menu, 
+0003fe30: 2d31 2c20 2226 5365 6c65 6374 2061 6c6c  -1, "&Select all
+0003fe40: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
+0003fe50: 2020 2020 6d65 6e75 2e41 7070 656e 6428      menu.Append(
+0003fe60: 6974 656d 5f73 656c 6563 7469 6f6e 290d  item_selection).
+0003fe70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003fe80: 206d 656e 752e 4170 7065 6e64 2869 7465   menu.Append(ite
+0003fe90: 6d5f 636f 7079 290d 0a20 2020 2020 2020  m_copy)..       
+0003fea0: 2020 2020 2020 2020 206d 656e 752e 4170           menu.Ap
+0003feb0: 7065 6e64 2869 7465 6d5f 7365 6c65 6374  pend(item_select
+0003fec0: 616c 6c29 0d0a 2020 2020 2020 2020 2020  all)..          
+0003fed0: 2020 2020 2020 6974 656d 5f73 656c 6563        item_selec
+0003fee0: 7469 6f6e 2e45 6e61 626c 6528 626f 6f6c  tion.Enable(bool
+0003fef0: 2868 746d 6c77 696e 646f 772e 5365 6c65  (htmlwindow.Sele
+0003ff00: 6374 696f 6e54 6f54 6578 7428 2929 290d  ctionToText())).
+0003ff10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003ff20: 206d 656e 752e 4269 6e64 2877 782e 4556   menu.Bind(wx.EV
+0003ff30: 545f 4d45 4e55 2c20 6f6e 5f63 6f70 7973  T_MENU, on_copys
+0003ff40: 656c 6563 7469 6f6e 2c20 6964 3d69 7465  election, id=ite
+0003ff50: 6d5f 7365 6c65 6374 696f 6e2e 4765 7449  m_selection.GetI
+0003ff60: 6428 2929 0d0a 2020 2020 2020 2020 2020  d())..          
+0003ff70: 2020 2020 2020 6d65 6e75 2e42 696e 6428        menu.Bind(
+0003ff80: 7778 2e45 5654 5f4d 454e 552c 2068 616e  wx.EVT_MENU, han
+0003ff90: 646c 6572 2c20 6964 3d69 7465 6d5f 636f  dler, id=item_co
+0003ffa0: 7079 2e47 6574 4964 2829 290d 0a20 2020  py.GetId())..   
+0003ffb0: 2020 2020 2020 2020 2020 2020 206d 656e               men
+0003ffc0: 752e 4269 6e64 2877 782e 4556 545f 4d45  u.Bind(wx.EVT_ME
+0003ffd0: 4e55 2c20 6f6e 5f73 656c 6563 7461 6c6c  NU, on_selectall
+0003ffe0: 2c20 6964 3d69 7465 6d5f 7365 6c65 6374  , id=item_select
+0003fff0: 616c 6c2e 4765 7449 6428 2929 0d0a 2020  all.GetId())..  
+00040000: 2020 2020 2020 2020 2020 2020 2020 6874                ht
+00040010: 6d6c 7769 6e64 6f77 2e50 6f70 7570 4d65  mlwindow.PopupMe
+00040020: 6e75 286d 656e 7529 0d0a 2020 2020 2020  nu(menu)..      
+00040030: 2020 656c 6966 206c 696e 6b5f 6461 7461    elif link_data
+00040040: 206f 7220 6872 6566 2e73 7461 7274 7377   or href.startsw
+00040050: 6974 6828 2266 696c 653a 2f2f 2229 3a0d  ith("file://"):.
+00040060: 0a20 2020 2020 2020 2020 2020 2023 204f  .            # O
+00040070: 7065 6e20 7468 6520 6c69 6e6b 2c20 6f72  pen the link, or
+00040080: 2066 696c 652c 206f 7220 7072 6f67 7261   file, or progra
+00040090: 6d20 696e 7465 726e 616c 206c 696e 6b20  m internal link 
+000400a0: 746f 2063 6861 7420 6f72 2074 6162 6c65  to chat or table
+000400b0: 0d0a 2020 2020 2020 2020 2020 2020 6368  ..            ch
+000400c0: 6174 5f69 6420 3d20 6c69 6e6b 5f64 6174  at_id = link_dat
+000400d0: 612e 6765 7428 2263 6861 7422 290d 0a20  a.get("chat").. 
+000400e0: 2020 2020 2020 2020 2020 206d 7367 5f69             msg_i
+000400f0: 6420 3d20 6c69 6e6b 5f64 6174 612e 6765  d = link_data.ge
+00040100: 7428 226d 6573 7361 6765 2229 0d0a 2020  t("message")..  
+00040110: 2020 2020 2020 2020 2020 7461 626c 655f            table_
+00040120: 6e61 6d65 2c20 726f 7720 3d20 6c69 6e6b  name, row = link
+00040130: 5f64 6174 612e 6765 7428 2274 6162 6c65  _data.get("table
+00040140: 2229 2c20 6c69 6e6b 5f64 6174 612e 6765  "), link_data.ge
+00040150: 7428 2272 6f77 2229 0d0a 2020 2020 2020  t("row")..      
+00040160: 2020 2020 2020 6966 2068 7265 662e 7374        if href.st
+00040170: 6172 7473 7769 7468 2822 6669 6c65 3a2f  artswith("file:/
+00040180: 2f22 293a 0d0a 2020 2020 2020 2020 2020  /"):..          
+00040190: 2020 2020 2020 6669 6c65 6e61 6d65 203d        filename =
+000401a0: 2070 6174 6820 3d20 7572 6c6c 6962 2e72   path = urllib.r
+000401b0: 6571 7565 7374 2e75 726c 3270 6174 686e  equest.url2pathn
+000401c0: 616d 6528 6872 6566 5b35 3a5d 290d 0a20  ame(href[5:]).. 
+000401d0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000401e0: 6620 616e 7928 7061 7468 2e73 7461 7274  f any(path.start
+000401f0: 7377 6974 6828 7829 2066 6f72 2078 2069  swith(x) for x i
+00040200: 6e20 5b22 5c5c 5c5c 5c5c 222c 2022 2f2f  n ["\\\\\\", "//
+00040210: 2f22 5d29 3a0d 0a20 2020 2020 2020 2020  /"]):..         
+00040220: 2020 2020 2020 2020 2020 2066 696c 656e             filen
+00040230: 616d 6520 3d20 6872 6566 203d 2070 6174  ame = href = pat
+00040240: 685b 333a 5d0d 0a20 2020 2020 2020 2020  h[3:]..         
+00040250: 2020 2020 2020 2069 6620 7061 7468 2061         if path a
+00040260: 6e64 206f 732e 7061 7468 2e65 7869 7374  nd os.path.exist
+00040270: 7328 7061 7468 293a 0d0a 2020 2020 2020  s(path):..      
+00040280: 2020 2020 2020 2020 2020 2020 2020 7574                ut
+00040290: 696c 2e73 7461 7274 5f66 696c 6528 7061  il.start_file(pa
+000402a0: 7468 290d 0a20 2020 2020 2020 2020 2020  th)..           
+000402b0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+000402c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000402d0: 6520 3d20 2254 6865 2066 696c 6520 5c22  e = "The file \"
+000402e0: 2573 5c22 2063 616e 6e6f 7420 6265 2066  %s\" cannot be f
+000402f0: 6f75 6e64 206f 6e20 7468 6973 2063 6f6d  ound on this com
+00040300: 7075 7465 722e 2220 2520 5c0d 0a20 2020  puter." % \..   
+00040310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040320: 2020 2020 2066 696c 656e 616d 650d 0a20       filename.. 
+00040330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040340: 2020 206d 6573 7361 6765 426f 7828 652c     messageBox(e,
+00040350: 2063 6f6e 662e 5469 746c 652c 2077 782e   conf.Title, wx.
+00040360: 4f4b 207c 2077 782e 4943 4f4e 5f49 4e46  OK | wx.ICON_INF
+00040370: 4f52 4d41 5449 4f4e 290d 0a20 2020 2020  ORMATION)..     
+00040380: 2020 2020 2020 2065 6c69 6620 6368 6174         elif chat
+00040390: 5f69 643a 0d0a 2020 2020 2020 2020 2020  _id:..          
+000403a0: 2020 2020 2020 7365 6c66 2e6e 6f74 6562        self.noteb
+000403b0: 6f6f 6b2e 5365 7453 656c 6563 7469 6f6e  ook.SetSelection
+000403c0: 2873 656c 662e 7061 6765 6f72 6465 725b  (self.pageorder[
+000403d0: 7365 6c66 2e70 6167 655f 6368 6174 735d  self.page_chats]
+000403e0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+000403f0: 2020 2063 203d 206e 6578 7428 2863 2066     c = next((c f
+00040400: 6f72 2063 2069 6e20 7365 6c66 2e63 6861  or c in self.cha
+00040410: 7473 2069 6620 6368 6174 5f69 6420 3d3d  ts if chat_id ==
+00040420: 2063 5b22 6964 225d 292c 204e 6f6e 6529   c["id"]), None)
+00040430: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00040440: 2020 6966 2063 3a0d 0a20 2020 2020 2020    if c:..       
+00040450: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00040460: 662e 6c6f 6164 5f63 6861 7428 632c 2063  f.load_chat(c, c
+00040470: 656e 7465 725f 6d65 7373 6167 655f 6964  enter_message_id
+00040480: 3d6d 7367 5f69 6429 0d0a 2020 2020 2020  =msg_id)..      
+00040490: 2020 2020 2020 2020 2020 2020 2020 7365                se
+000404a0: 6c66 2e73 686f 775f 7374 6174 7328 4661  lf.show_stats(Fa
+000404b0: 6c73 6529 0d0a 2020 2020 2020 2020 2020  lse)..          
+000404c0: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
+000404d0: 7463 5f68 6973 746f 7279 2e53 6574 466f  tc_history.SetFo
+000404e0: 6375 7328 290d 0a20 2020 2020 2020 2020  cus()..         
+000404f0: 2020 2065 6c69 6620 7461 626c 655f 6e61     elif table_na
+00040500: 6d65 2061 6e64 2072 6f77 3a0d 0a20 2020  me and row:..   
+00040510: 2020 2020 2020 2020 2020 2020 2074 6162               tab
+00040520: 6c65 6974 656d 203d 204e 6f6e 650d 0a20  leitem = None.. 
+00040530: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00040540: 6162 6c65 5f6e 616d 6520 3d20 7461 626c  able_name = tabl
+00040550: 655f 6e61 6d65 2e6c 6f77 6572 2829 0d0a  e_name.lower()..
+00040560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040570: 7461 626c 6520 3d20 6e65 7874 2828 7420  table = next((t 
+00040580: 666f 7220 7420 696e 2073 656c 662e 6462  for t in self.db
+00040590: 2e67 6574 5f74 6162 6c65 7328 290d 0a20  .get_tables().. 
+000405a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000405b0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000405c0: 745b 226e 616d 6522 5d2e 6c6f 7765 7228  t["name"].lower(
+000405d0: 2920 3d3d 2074 6162 6c65 5f6e 616d 6529  ) == table_name)
+000405e0: 2c20 4e6f 6e65 290d 0a20 2020 2020 2020  , None)..       
+000405f0: 2020 2020 2020 2020 2069 7465 6d20 3d20           item = 
+00040600: 7365 6c66 2e74 7265 655f 7461 626c 6573  self.tree_tables
+00040610: 2e47 6574 4e65 7874 2873 656c 662e 7472  .GetNext(self.tr
+00040620: 6565 5f74 6162 6c65 732e 4765 7452 6f6f  ee_tables.GetRoo
+00040630: 7449 7465 6d28 2929 0d0a 2020 2020 2020  tItem())..      
+00040640: 2020 2020 2020 2020 2020 7768 696c 6520            while 
+00040650: 7461 626c 6520 616e 6420 6974 656d 2061  table and item a
+00040660: 6e64 2069 7465 6d2e 4973 4f6b 2829 3a0d  nd item.IsOk():.
+00040670: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00040680: 2020 2020 2074 6162 6c65 3220 3d20 7365       table2 = se
+00040690: 6c66 2e74 7265 655f 7461 626c 6573 2e47  lf.tree_tables.G
+000406a0: 6574 4974 656d 5079 4461 7461 2869 7465  etItemPyData(ite
+000406b0: 6d29 0d0a 2020 2020 2020 2020 2020 2020  m)..            
+000406c0: 2020 2020 2020 2020 6966 2074 6162 6c65          if table
+000406d0: 3220 616e 6420 7461 626c 6532 2e6c 6f77  2 and table2.low
+000406e0: 6572 2829 203d 3d20 7461 626c 655b 226e  er() == table["n
+000406f0: 616d 6522 5d2e 6c6f 7765 7228 293a 0d0a  ame"].lower():..
 00040700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040710: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
-00040720: 6c66 2c20 6974 656d 293a 2073 656c 662e  lf, item): self.
-00040730: 5f69 7465 6d20 3d20 6974 656d 0d0a 2020  _item = item..  
-00040740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040750: 2020 2020 2020 6465 6620 4765 7449 7465        def GetIte
-00040760: 6d28 7365 6c66 293a 2020 2020 2020 2020  m(self):        
-00040770: 7265 7475 726e 2073 656c 662e 5f69 7465  return self._ite
-00040780: 6d0d 0a20 2020 2020 2020 2020 2020 2020  m..             
-00040790: 2020 2020 2020 2073 656c 662e 6f6e 5f63         self.on_c
-000407a0: 6861 6e67 655f 7472 6565 5f74 6162 6c65  hange_tree_table
-000407b0: 7328 4861 636b 4576 656e 7428 7461 626c  s(HackEvent(tabl
-000407c0: 6569 7465 6d29 290d 0a20 2020 2020 2020  eitem))..       
-000407d0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000407e0: 7365 6c66 2e74 7265 655f 7461 626c 6573  self.tree_tables
-000407f0: 2e47 6574 5365 6c65 6374 696f 6e28 2920  .GetSelection() 
-00040800: 213d 2074 6162 6c65 6974 656d 3a0d 0a20  != tableitem:.. 
-00040810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040820: 2020 2020 2020 2073 656c 662e 7472 6565         self.tree
-00040830: 5f74 6162 6c65 732e 5365 6c65 6374 4974  _tables.SelectIt
-00040840: 656d 2874 6162 6c65 6974 656d 290d 0a20  em(tableitem).. 
-00040850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040860: 2020 2020 2020 2077 782e 5969 656c 6449         wx.YieldI
-00040870: 664e 6565 6465 6428 290d 0a20 2020 2020  fNeeded()..     
-00040880: 2020 2020 2020 2020 2020 2020 2020 2067                 g
-00040890: 7269 6420 3d20 7365 6c66 2e67 7269 645f  rid = self.grid_
-000408a0: 7461 626c 650d 0a20 2020 2020 2020 2020  table..         
-000408b0: 2020 2020 2020 2020 2020 2069 6620 6772             if gr
-000408c0: 6964 2e54 6162 6c65 2e66 696c 7465 7273  id.Table.filters
-000408d0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-000408e0: 2020 2020 2020 2020 2020 2067 7269 642e             grid.
-000408f0: 5461 626c 652e 436c 6561 7253 6f72 7428  Table.ClearSort(
-00040900: 7265 6672 6573 683d 4661 6c73 6529 0d0a  refresh=False)..
-00040910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040920: 2020 2020 2020 2020 6772 6964 2e54 6162          grid.Tab
-00040930: 6c65 2e43 6c65 6172 4669 6c74 6572 2829  le.ClearFilter()
-00040940: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00040950: 2020 2020 2020 2320 5365 6172 6368 2066        # Search f
-00040960: 6f72 206d 6174 6368 696e 6720 726f 7720  or matching row 
-00040970: 616e 6420 7363 726f 6c6c 2074 6f20 6974  and scroll to it
-00040980: 2e0d 0a20 2020 2020 2020 2020 2020 2020  ...             
-00040990: 2020 2020 2020 2074 6162 6c65 5b22 636f         table["co
-000409a0: 6c75 6d6e 7322 5d20 3d20 7365 6c66 2e64  lumns"] = self.d
-000409b0: 622e 6765 745f 7461 626c 655f 636f 6c75  b.get_table_colu
-000409c0: 6d6e 7328 7461 626c 655f 6e61 6d65 290d  mns(table_name).
-000409d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000409e0: 2020 2020 2069 645f 6669 656c 6473 203d       id_fields =
-000409f0: 205b 635b 226e 616d 6522 5d20 666f 7220   [c["name"] for 
-00040a00: 6320 696e 2074 6162 6c65 5b22 636f 6c75  c in table["colu
-00040a10: 6d6e 7322 5d20 6966 2063 2e67 6574 2822  mns"] if c.get("
-00040a20: 706b 2229 5d0d 0a20 2020 2020 2020 2020  pk")]..         
-00040a30: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-00040a40: 7420 6964 5f66 6965 6c64 733a 2023 204e  t id_fields: # N
-00040a50: 6f20 7072 696d 6172 7920 6b65 7920 6669  o primary key fi
-00040a60: 656c 6473 3a20 7461 6b65 2061 6c6c 0d0a  elds: take all..
-00040a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040a80: 2020 2020 2020 2020 6964 5f66 6965 6c64          id_field
-00040a90: 7320 3d20 5b63 5b22 6e61 6d65 225d 2066  s = [c["name"] f
-00040aa0: 6f72 2063 2069 6e20 7461 626c 655b 2263  or c in table["c
-00040ab0: 6f6c 756d 6e73 225d 5d0d 0a20 2020 2020  olumns"]]..     
-00040ac0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00040ad0: 6f77 5f69 6420 3d20 5b72 6f77 5b63 5d20  ow_id = [row[c] 
-00040ae0: 666f 7220 6320 696e 2069 645f 6669 656c  for c in id_fiel
-00040af0: 6473 5d0d 0a20 2020 2020 2020 2020 2020  ds]..           
-00040b00: 2020 2020 2020 2020 2066 6f72 2069 2069           for i i
-00040b10: 6e20 7261 6e67 6528 6772 6964 2e54 6162  n range(grid.Tab
-00040b20: 6c65 2e47 6574 4e75 6d62 6572 526f 7773  le.GetNumberRows
-00040b30: 2829 293a 0d0a 2020 2020 2020 2020 2020  ()):..          
-00040b40: 2020 2020 2020 2020 2020 2020 2020 726f                ro
-00040b50: 7732 203d 2067 7269 642e 5461 626c 652e  w2 = grid.Table.
-00040b60: 4765 7452 6f77 2869 290d 0a20 2020 2020  GetRow(i)..     
-00040b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040b80: 2020 2072 6f77 325f 6964 203d 205b 726f     row2_id = [ro
-00040b90: 7732 5b63 5d20 666f 7220 6320 696e 2069  w2[c] for c in i
-00040ba0: 645f 6669 656c 6473 5d0d 0a20 2020 2020  d_fields]..     
+00040710: 2020 2020 2020 2020 7461 626c 6569 7465          tableite
+00040720: 6d20 3d20 6974 656d 0d0a 2020 2020 2020  m = item..      
+00040730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040740: 2020 6272 6561 6b20 2320 6272 6561 6b20    break # break 
+00040750: 7768 696c 6520 7461 626c 6520 616e 6420  while table and 
+00040760: 6974 656d 2061 6e64 2069 7465 6b2e 4973  item and itek.Is
+00040770: 4f6b 2829 0d0a 2020 2020 2020 2020 2020  Ok()..          
+00040780: 2020 2020 2020 2020 2020 6974 656d 203d            item =
+00040790: 2073 656c 662e 7472 6565 5f74 6162 6c65   self.tree_table
+000407a0: 732e 4765 744e 6578 7453 6962 6c69 6e67  s.GetNextSibling
+000407b0: 2869 7465 6d29 0d0a 2020 2020 2020 2020  (item)..        
+000407c0: 2020 2020 2020 2020 6966 2074 6162 6c65          if table
+000407d0: 6974 656d 3a0d 0a20 2020 2020 2020 2020  item:..         
+000407e0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000407f0: 6e6f 7465 626f 6f6b 2e53 6574 5365 6c65  notebook.SetSele
+00040800: 6374 696f 6e28 7365 6c66 2e70 6167 656f  ction(self.pageo
+00040810: 7264 6572 5b73 656c 662e 7061 6765 5f74  rder[self.page_t
+00040820: 6162 6c65 735d 290d 0a20 2020 2020 2020  ables])..       
+00040830: 2020 2020 2020 2020 2020 2020 2077 782e               wx.
+00040840: 5969 656c 6449 664e 6565 6465 6428 290d  YieldIfNeeded().
+00040850: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00040860: 2020 2020 2023 204f 6e6c 7920 7761 7920       # Only way 
+00040870: 746f 2063 7265 6174 6520 7374 6174 6520  to create state 
+00040880: 6368 616e 6765 2069 6e20 7778 2e6c 6962  change in wx.lib
+00040890: 2e67 697a 6d6f 732e 5472 6565 4c69 7374  .gizmos.TreeList
+000408a0: 4374 726c 0d0a 2020 2020 2020 2020 2020  Ctrl..          
+000408b0: 2020 2020 2020 2020 2020 636c 6173 7320            class 
+000408c0: 4861 636b 4576 656e 7428 6f62 6a65 6374  HackEvent(object
+000408d0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+000408e0: 2020 2020 2020 2020 2020 2020 6465 6620              def 
+000408f0: 5f5f 696e 6974 5f5f 2873 656c 662c 2069  __init__(self, i
+00040900: 7465 6d29 3a20 7365 6c66 2e5f 6974 656d  tem): self._item
+00040910: 203d 2069 7465 6d0d 0a20 2020 2020 2020   = item..       
+00040920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040930: 2064 6566 2047 6574 4974 656d 2873 656c   def GetItem(sel
+00040940: 6629 3a20 2020 2020 2020 2072 6574 7572  f):        retur
+00040950: 6e20 7365 6c66 2e5f 6974 656d 0d0a 2020  n self._item..  
+00040960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040970: 2020 7365 6c66 2e6f 6e5f 6368 616e 6765    self.on_change
+00040980: 5f74 7265 655f 7461 626c 6573 2848 6163  _tree_tables(Hac
+00040990: 6b45 7665 6e74 2874 6162 6c65 6974 656d  kEvent(tableitem
+000409a0: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
+000409b0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+000409c0: 7472 6565 5f74 6162 6c65 732e 4765 7453  tree_tables.GetS
+000409d0: 656c 6563 7469 6f6e 2829 2021 3d20 7461  election() != ta
+000409e0: 626c 6569 7465 6d3a 0d0a 2020 2020 2020  bleitem:..      
+000409f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040a00: 2020 7365 6c66 2e74 7265 655f 7461 626c    self.tree_tabl
+00040a10: 6573 2e53 656c 6563 7449 7465 6d28 7461  es.SelectItem(ta
+00040a20: 626c 6569 7465 6d29 0d0a 2020 2020 2020  bleitem)..      
+00040a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040a40: 2020 7778 2e59 6965 6c64 4966 4e65 6564    wx.YieldIfNeed
+00040a50: 6564 2829 0d0a 2020 2020 2020 2020 2020  ed()..          
+00040a60: 2020 2020 2020 2020 2020 6772 6964 203d            grid =
+00040a70: 2073 656c 662e 6772 6964 5f74 6162 6c65   self.grid_table
+00040a80: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00040a90: 2020 2020 2020 6966 2067 7269 642e 5461        if grid.Ta
+00040aa0: 626c 652e 6669 6c74 6572 733a 0d0a 2020  ble.filters:..  
+00040ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040ac0: 2020 2020 2020 6772 6964 2e54 6162 6c65        grid.Table
+00040ad0: 2e43 6c65 6172 536f 7274 2872 6566 7265  .ClearSort(refre
+00040ae0: 7368 3d46 616c 7365 290d 0a20 2020 2020  sh=False)..     
+00040af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040b00: 2020 2067 7269 642e 5461 626c 652e 436c     grid.Table.Cl
+00040b10: 6561 7246 696c 7465 7228 290d 0a20 2020  earFilter()..   
+00040b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040b30: 2023 2053 6561 7263 6820 666f 7220 6d61   # Search for ma
+00040b40: 7463 6869 6e67 2072 6f77 2061 6e64 2073  tching row and s
+00040b50: 6372 6f6c 6c20 746f 2069 742e 0d0a 2020  croll to it...  
+00040b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040b70: 2020 7461 626c 655b 2263 6f6c 756d 6e73    table["columns
+00040b80: 225d 203d 2073 656c 662e 6462 2e67 6574  "] = self.db.get
+00040b90: 5f74 6162 6c65 5f63 6f6c 756d 6e73 2874  _table_columns(t
+00040ba0: 6162 6c65 5f6e 616d 6529 0d0a 2020 2020  able_name)..    
 00040bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040bc0: 2020 2069 6620 726f 775f 6964 203d 3d20     if row_id == 
-00040bd0: 726f 7732 5f69 643a 0d0a 2020 2020 2020  row2_id:..      
-00040be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040bf0: 2020 2020 2020 6772 6964 2e4d 616b 6543        grid.MakeC
-00040c00: 656c 6c56 6973 6962 6c65 2869 2c20 3029  ellVisible(i, 0)
-00040c10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00040c20: 2020 2020 2020 2020 2020 2020 2020 6772                gr
-00040c30: 6964 2e53 656c 6563 7452 6f77 2869 290d  id.SelectRow(i).
-00040c40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00040c50: 2020 2020 2020 2020 2020 2020 2070 6167               pag
-00040c60: 6573 697a 6520 3d20 6772 6964 2e47 6574  esize = grid.Get
-00040c70: 5363 726f 6c6c 5061 6765 5369 7a65 2877  ScrollPageSize(w
-00040c80: 782e 5645 5254 4943 414c 290d 0a20 2020  x.VERTICAL)..   
-00040c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040ca0: 2020 2020 2020 2020 2070 786c 7320 3d20           pxls = 
-00040cb0: 6772 6964 2e47 6574 5363 726f 6c6c 5069  grid.GetScrollPi
-00040cc0: 7865 6c73 5065 7255 6e69 7428 290d 0a20  xelsPerUnit().. 
+00040bc0: 6964 5f66 6965 6c64 7320 3d20 5b63 5b22  id_fields = [c["
+00040bd0: 6e61 6d65 225d 2066 6f72 2063 2069 6e20  name"] for c in 
+00040be0: 7461 626c 655b 2263 6f6c 756d 6e73 225d  table["columns"]
+00040bf0: 2069 6620 632e 6765 7428 2270 6b22 295d   if c.get("pk")]
+00040c00: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00040c10: 2020 2020 2020 6966 206e 6f74 2069 645f        if not id_
+00040c20: 6669 656c 6473 3a20 2320 4e6f 2070 7269  fields: # No pri
+00040c30: 6d61 7279 206b 6579 2066 6965 6c64 733a  mary key fields:
+00040c40: 2074 616b 6520 616c 6c0d 0a20 2020 2020   take all..     
+00040c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040c60: 2020 2069 645f 6669 656c 6473 203d 205b     id_fields = [
+00040c70: 635b 226e 616d 6522 5d20 666f 7220 6320  c["name"] for c 
+00040c80: 696e 2074 6162 6c65 5b22 636f 6c75 6d6e  in table["column
+00040c90: 7322 5d5d 0d0a 2020 2020 2020 2020 2020  s"]]..          
+00040ca0: 2020 2020 2020 2020 2020 726f 775f 6964            row_id
+00040cb0: 203d 205b 726f 775b 635d 2066 6f72 2063   = [row[c] for c
+00040cc0: 2069 6e20 6964 5f66 6965 6c64 735d 0d0a   in id_fields]..
 00040cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040ce0: 2020 2020 2020 2020 2020 2063 656c 6c5f             cell_
-00040cf0: 636f 6f72 6473 203d 2067 7269 642e 4365  coords = grid.Ce
-00040d00: 6c6c 546f 5265 6374 2869 2c20 3029 0d0a  llToRect(i, 0)..
-00040d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040d20: 2020 2020 2020 2020 2020 2020 7920 3d20              y = 
-00040d30: 6365 6c6c 5f63 6f6f 7264 732e 7920 2f2f  cell_coords.y //
-00040d40: 2028 7078 6c73 5b31 5d20 6f72 2031 3529   (pxls[1] or 15)
-00040d50: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00040d60: 2020 2020 2020 2020 2020 2020 2020 782c                x,
-00040d70: 2079 203d 2030 2c20 7920 2d20 7061 6765   y = 0, y - page
-00040d80: 7369 7a65 202f 2f20 320d 0a20 2020 2020  size // 2..     
-00040d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040da0: 2020 2020 2020 2067 7269 642e 5363 726f         grid.Scro
-00040db0: 6c6c 2878 2c20 7929 0d0a 2020 2020 2020  ll(x, y)..      
+00040ce0: 2020 2020 666f 7220 6920 696e 2072 616e      for i in ran
+00040cf0: 6765 2867 7269 642e 5461 626c 652e 4765  ge(grid.Table.Ge
+00040d00: 744e 756d 6265 7252 6f77 7328 2929 3a0d  tNumberRows()):.
+00040d10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00040d20: 2020 2020 2020 2020 2072 6f77 3220 3d20           row2 = 
+00040d30: 6772 6964 2e54 6162 6c65 2e47 6574 526f  grid.Table.GetRo
+00040d40: 7728 6929 0d0a 2020 2020 2020 2020 2020  w(i)..          
+00040d50: 2020 2020 2020 2020 2020 2020 2020 726f                ro
+00040d60: 7732 5f69 6420 3d20 5b72 6f77 325b 635d  w2_id = [row2[c]
+00040d70: 2066 6f72 2063 2069 6e20 6964 5f66 6965   for c in id_fie
+00040d80: 6c64 735d 0d0a 2020 2020 2020 2020 2020  lds]..          
+00040d90: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00040da0: 2072 6f77 5f69 6420 3d3d 2072 6f77 325f   row_id == row2_
+00040db0: 6964 3a0d 0a20 2020 2020 2020 2020 2020  id:..           
 00040dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040dd0: 2020 2020 2020 6272 6561 6b20 2320 666f        break # fo
-00040de0: 7220 690d 0a20 2020 2020 2020 2065 6c69  r i..        eli
-00040df0: 6620 6872 6566 2e73 7461 7274 7377 6974  f href.startswit
-00040e00: 6828 2270 6167 653a 2229 3a0d 0a20 2020  h("page:"):..   
-00040e10: 2020 2020 2020 2020 2023 2047 6f20 746f           # Go to
-00040e20: 2064 6174 6162 6173 6520 7375 6270 6167   database subpag
-00040e30: 650d 0a20 2020 2020 2020 2020 2020 2070  e..            p
-00040e40: 6167 6520 3d20 6872 6566 5b35 3a5d 0d0a  age = href[5:]..
-00040e50: 2020 2020 2020 2020 2020 2020 6966 2022              if "
-00040e60: 2368 656c 7022 203d 3d20 7061 6765 205c  #help" == page \
-00040e70: 0d0a 2020 2020 2020 2020 2020 2020 616e  ..            an
-00040e80: 6420 6874 6d6c 7769 6e64 6f77 2069 6e20  d htmlwindow in 
-00040e90: 2873 656c 662e 6874 6d6c 5f73 6561 7263  (self.html_searc
-00040ea0: 6861 6c6c 2c20 7365 6c66 2e68 746d 6c5f  hall, self.html_
-00040eb0: 7365 6172 6368 616c 6c2e 4874 6d6c 5769  searchall.HtmlWi
-00040ec0: 6e64 6f77 2c20 7365 6c66 2e6c 6162 656c  ndow, self.label
-00040ed0: 5f68 746d 6c29 3a0d 0a20 2020 2020 2020  _html):..       
-00040ee0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-00040ef0: 2e68 746d 6c5f 7365 6172 6368 616c 6c2e  .html_searchall.
-00040f00: 4765 7454 6162 4461 7461 4279 4944 2830  GetTabDataByID(0
-00040f10: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00040f20: 2020 2020 2020 2020 7365 6c66 2e68 746d          self.htm
-00040f30: 6c5f 7365 6172 6368 616c 6c2e 5365 7441  l_searchall.SetA
-00040f40: 6374 6976 6554 6162 4279 4944 2830 290d  ctiveTabByID(0).
-00040f50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00040f60: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-00040f70: 2020 2020 2020 2020 2020 2020 6820 3d20              h = 
-00040f80: 7374 6570 2e54 656d 706c 6174 6528 7465  step.Template(te
-00040f90: 6d70 6c61 7465 732e 5345 4152 4348 5f48  mplates.SEARCH_H
-00040fa0: 454c 505f 4c4f 4e47 292e 6578 7061 6e64  ELP_LONG).expand
-00040fb0: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
-00040fc0: 2020 2020 2020 2020 7365 6c66 2e68 746d          self.htm
-00040fd0: 6c5f 7365 6172 6368 616c 6c2e 496e 7365  l_searchall.Inse
-00040fe0: 7274 5461 6228 0d0a 2020 2020 2020 2020  rtTab(..        
-00040ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041000: 7365 6c66 2e68 746d 6c5f 7365 6172 6368  self.html_search
-00041010: 616c 6c2e 4765 7454 6162 436f 756e 7428  all.GetTabCount(
-00041020: 292c 2022 5365 6172 6368 2068 656c 7022  ), "Search help"
-00041030: 2c20 302c 2068 2c20 4e6f 6e65 0d0a 2020  , 0, h, None..  
-00041040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041050: 2020 290d 0a20 2020 2020 2020 2020 2020    )..           
-00041060: 2065 6c69 6620 2223 7365 6172 6368 2220   elif "#search" 
-00041070: 3d3d 2070 6167 653a 0d0a 2020 2020 2020  == page:..      
-00041080: 2020 2020 2020 2020 2020 7365 6c66 2e65            self.e
-00041090: 6469 745f 7365 6172 6368 616c 6c2e 5365  dit_searchall.Se
-000410a0: 7446 6f63 7573 2829 0d0a 2020 2020 2020  tFocus()..      
-000410b0: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-000410c0: 2020 2020 2020 2020 2020 2020 2074 6865               the
-000410d0: 7061 6765 203d 2067 6574 6174 7472 2873  page = getattr(s
-000410e0: 656c 662c 2022 7061 6765 5f22 202b 2070  elf, "page_" + p
-000410f0: 6167 652c 204e 6f6e 6529 0d0a 2020 2020  age, None)..    
-00041100: 2020 2020 2020 2020 2020 2020 6966 2074              if t
-00041110: 6865 7061 6765 3a0d 0a20 2020 2020 2020  hepage:..       
-00041120: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00041130: 662e 6e6f 7465 626f 6f6b 2e53 6574 5365  f.notebook.SetSe
-00041140: 6c65 6374 696f 6e28 7365 6c66 2e70 6167  lection(self.pag
-00041150: 656f 7264 6572 5b74 6865 7061 6765 5d29  eorder[thepage])
-00041160: 0d0a 2020 2020 2020 2020 656c 6966 2068  ..        elif h
-00041170: 7265 662e 7374 6172 7473 7769 7468 2822  ref.startswith("
-00041180: 636f 6e74 6163 743a 2229 3a0d 0a20 2020  contact:"):..   
-00041190: 2020 2020 2020 2020 2063 6f6e 7461 6374           contact
-000411a0: 6964 203d 2069 6e74 2868 7265 665b 6872  id = int(href[hr
-000411b0: 6566 2e69 6e64 6578 2822 3a22 2920 2b20  ef.index(":") + 
-000411c0: 313a 5d29 0d0a 2020 2020 2020 2020 2020  1:])..          
-000411d0: 2020 636f 6e74 6163 7420 3d20 6e65 7874    contact = next
-000411e0: 2828 7820 666f 7220 7820 696e 205b 7365  ((x for x in [se
-000411f0: 6c66 2e64 622e 6163 636f 756e 745d 202b  lf.db.account] +
-00041200: 2073 656c 662e 636f 6e74 6163 7473 2069   self.contacts i
-00041210: 6620 785b 2269 6422 5d20 3d3d 2063 6f6e  f x["id"] == con
-00041220: 7461 6374 6964 292c 204e 6f6e 6529 0d0a  tactid), None)..
-00041230: 2020 2020 2020 2020 2020 2020 6966 2063              if c
-00041240: 6f6e 7461 6374 3a0d 0a20 2020 2020 2020  ontact:..       
-00041250: 2020 2020 2020 2020 2073 656c 662e 6e6f           self.no
-00041260: 7465 626f 6f6b 2e53 6574 5365 6c65 6374  tebook.SetSelect
-00041270: 696f 6e28 7365 6c66 2e70 6167 656f 7264  ion(self.pageord
-00041280: 6572 5b73 656c 662e 7061 6765 5f63 6f6e  er[self.page_con
-00041290: 7461 6374 735d 290d 0a20 2020 2020 2020  tacts])..       
-000412a0: 2020 2020 2020 2020 2073 656c 662e 6c6f           self.lo
-000412b0: 6164 5f63 6f6e 7461 6374 2863 6f6e 7461  ad_contact(conta
-000412c0: 6374 290d 0a20 2020 2020 2020 2065 6c69  ct)..        eli
-000412d0: 6620 6872 6566 2e73 7461 7274 7377 6974  f href.startswit
-000412e0: 6828 2223 2229 3a20 2320 496e 2d70 6167  h("#"): # In-pag
-000412f0: 6520 6c69 6e6b 0d0a 2020 2020 2020 2020  e link..        
-00041300: 2020 2020 6576 656e 742e 536b 6970 2829      event.Skip()
-00041310: 0d0a 2020 2020 2020 2020 656c 6966 206e  ..        elif n
-00041320: 6f74 2028 6872 6566 2e73 7461 7274 7377  ot (href.startsw
-00041330: 6974 6828 2263 6861 743a 2229 206f 7220  ith("chat:") or 
-00041340: 6872 6566 2e73 7461 7274 7377 6974 6828  href.startswith(
-00041350: 226d 6573 7361 6765 3a22 290d 0a20 2020  "message:")..   
-00041360: 2020 2020 206f 7220 6872 6566 2e73 7461       or href.sta
-00041370: 7274 7377 6974 6828 2266 696c 653a 2229  rtswith("file:")
-00041380: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00041390: 7765 6262 726f 7773 6572 2e6f 7065 6e28  webbrowser.open(
-000413a0: 6872 6566 290d 0a0d 0a0d 0a20 2020 2064  href)......    d
-000413b0: 6566 206f 6e5f 7365 6172 6368 616c 6c5f  ef on_searchall_
-000413c0: 746f 6767 6c65 5f74 6f6f 6c62 6172 2873  toggle_toolbar(s
-000413d0: 656c 662c 2065 7665 6e74 293a 0d0a 2020  elf, event):..  
-000413e0: 2020 2020 2020 2222 2248 616e 646c 6572        """Handler
-000413f0: 2066 6f72 2074 6f67 676c 696e 6720 6120   for toggling a 
-00041400: 7365 7474 696e 6720 696e 2073 6561 7263  setting in searc
-00041410: 6820 746f 6f6c 6261 722e 2222 220d 0a20  h toolbar.""".. 
-00041420: 2020 2020 2020 2069 6620 7778 2e49 445f         if wx.ID_
-00041430: 494e 4445 5820 3d3d 2065 7665 6e74 2e49  INDEX == event.I
-00041440: 643a 0d0a 2020 2020 2020 2020 2020 2020  d:..            
-00041450: 636f 6e66 2e53 6561 7263 6849 6e4d 6573  conf.SearchInMes
-00041460: 7361 6765 7320 3d20 5472 7565 0d0a 2020  sages = True..  
-00041470: 2020 2020 2020 2020 2020 636f 6e66 2e53            conf.S
-00041480: 6561 7263 6849 6e54 6162 6c65 7320 3d20  earchInTables = 
-00041490: 4661 6c73 650d 0a20 2020 2020 2020 2020  False..         
-000414a0: 2020 2063 6f6e 662e 5365 6172 6368 496e     conf.SearchIn
-000414b0: 4368 6174 496e 666f 203d 2063 6f6e 662e  ChatInfo = conf.
-000414c0: 5365 6172 6368 496e 436f 6e74 6163 7473  SearchInContacts
-000414d0: 203d 2046 616c 7365 0d0a 2020 2020 2020   = False..      
-000414e0: 2020 2020 2020 7365 6c66 2e6c 6162 656c        self.label
-000414f0: 5f73 6561 7263 682e 4c61 6265 6c20 3d20  _search.Label = 
-00041500: 2226 5365 6172 6368 2069 6e20 6d65 7373  "&Search in mess
-00041510: 6167 6573 3a22 0d0a 2020 2020 2020 2020  ages:"..        
-00041520: 656c 6966 2077 782e 4944 5f41 424f 5554  elif wx.ID_ABOUT
-00041530: 203d 3d20 6576 656e 742e 4964 3a0d 0a20   == event.Id:.. 
-00041540: 2020 2020 2020 2020 2020 2063 6f6e 662e             conf.
-00041550: 5365 6172 6368 496e 4368 6174 496e 666f  SearchInChatInfo
-00041560: 203d 2054 7275 650d 0a20 2020 2020 2020   = True..       
-00041570: 2020 2020 2063 6f6e 662e 5365 6172 6368       conf.Search
-00041580: 496e 5461 626c 6573 203d 2046 616c 7365  InTables = False
-00041590: 0d0a 2020 2020 2020 2020 2020 2020 636f  ..            co
-000415a0: 6e66 2e53 6561 7263 6849 6e4d 6573 7361  nf.SearchInMessa
-000415b0: 6765 7320 3d20 636f 6e66 2e53 6561 7263  ges = conf.Searc
-000415c0: 6849 6e43 6f6e 7461 6374 7320 3d20 4661  hInContacts = Fa
-000415d0: 6c73 650d 0a20 2020 2020 2020 2020 2020  lse..           
-000415e0: 2073 656c 662e 6c61 6265 6c5f 7365 6172   self.label_sear
-000415f0: 6368 2e4c 6162 656c 203d 2022 2653 6561  ch.Label = "&Sea
-00041600: 7263 6820 696e 2063 6861 7420 696e 666f  rch in chat info
-00041610: 3a22 0d0a 2020 2020 2020 2020 656c 6966  :"..        elif
-00041620: 2077 782e 4944 5f50 5245 5649 4557 203d   wx.ID_PREVIEW =
-00041630: 3d20 6576 656e 742e 4964 3a0d 0a20 2020  = event.Id:..   
-00041640: 2020 2020 2020 2020 2063 6f6e 662e 5365           conf.Se
-00041650: 6172 6368 496e 436f 6e74 6163 7473 203d  archInContacts =
-00041660: 2054 7275 650d 0a20 2020 2020 2020 2020   True..         
-00041670: 2020 2063 6f6e 662e 5365 6172 6368 496e     conf.SearchIn
-00041680: 5461 626c 6573 203d 2046 616c 7365 0d0a  Tables = False..
-00041690: 2020 2020 2020 2020 2020 2020 636f 6e66              conf
-000416a0: 2e53 6561 7263 6849 6e4d 6573 7361 6765  .SearchInMessage
-000416b0: 7320 3d20 636f 6e66 2e53 6561 7263 6849  s = conf.SearchI
-000416c0: 6e43 6861 7449 6e66 6f20 3d20 4661 6c73  nChatInfo = Fals
-000416d0: 650d 0a20 2020 2020 2020 2020 2020 2073  e..            s
-000416e0: 656c 662e 6c61 6265 6c5f 7365 6172 6368  elf.label_search
-000416f0: 2e4c 6162 656c 203d 2022 2653 6561 7263  .Label = "&Searc
-00041700: 6820 696e 2063 6f6e 7461 6374 733a 220d  h in contacts:".
-00041710: 0a20 2020 2020 2020 2065 6c69 6620 7778  .        elif wx
-00041720: 2e49 445f 5354 4154 4943 203d 3d20 6576  .ID_STATIC == ev
-00041730: 656e 742e 4964 3a0d 0a20 2020 2020 2020  ent.Id:..       
-00041740: 2020 2020 2063 6f6e 662e 5365 6172 6368       conf.Search
-00041750: 496e 5461 626c 6573 203d 2054 7275 650d  InTables = True.
-00041760: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
-00041770: 662e 5365 6172 6368 496e 436f 6e74 6163  f.SearchInContac
-00041780: 7473 203d 2046 616c 7365 0d0a 2020 2020  ts = False..    
-00041790: 2020 2020 2020 2020 636f 6e66 2e53 6561          conf.Sea
-000417a0: 7263 6849 6e4d 6573 7361 6765 7320 3d20  rchInMessages = 
-000417b0: 636f 6e66 2e53 6561 7263 6849 6e43 6861  conf.SearchInCha
-000417c0: 7449 6e66 6f20 3d20 4661 6c73 650d 0a20  tInfo = False.. 
-000417d0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000417e0: 6c61 6265 6c5f 7365 6172 6368 2e4c 6162  label_search.Lab
-000417f0: 656c 203d 2022 2653 6561 7263 6820 696e  el = "&Search in
-00041800: 2074 6162 6c65 733a 220d 0a20 2020 2020   tables:"..     
-00041810: 2020 2073 656c 662e 6c61 6265 6c5f 7365     self.label_se
-00041820: 6172 6368 2e43 6f6e 7461 696e 696e 6753  arch.ContainingS
-00041830: 697a 6572 2e4c 6179 6f75 7428 290d 0a20  izer.Layout().. 
-00041840: 2020 2020 2020 2069 6620 7778 2e49 445f         if wx.ID_
-00041850: 4e45 5720 3d3d 2065 7665 6e74 2e49 643a  NEW == event.Id:
-00041860: 0d0a 2020 2020 2020 2020 2020 2020 636f  ..            co
-00041870: 6e66 2e53 6561 7263 6855 7365 4e65 7754  nf.SearchUseNewT
-00041880: 6162 203d 2065 7665 6e74 2e45 7665 6e74  ab = event.Event
-00041890: 4f62 6a65 6374 2e47 6574 546f 6f6c 5374  Object.GetToolSt
-000418a0: 6174 6528 6576 656e 742e 4964 290d 0a20  ate(event.Id).. 
-000418b0: 2020 2020 2020 2065 6c69 6620 6e6f 7420         elif not 
-000418c0: 6576 656e 742e 4576 656e 744f 626a 6563  event.EventObjec
-000418d0: 742e 4765 7454 6f6f 6c53 7461 7465 2865  t.GetToolState(e
-000418e0: 7665 6e74 2e49 6429 3a0d 0a20 2020 2020  vent.Id):..     
-000418f0: 2020 2020 2020 2023 2041 6c6c 206f 7468         # All oth
-00041900: 6572 7320 6172 6520 7261 6469 6f20 746f  ers are radio to
-00041910: 6f6c 7320 616e 6420 7374 6174 6520 6d69  ols and state mi
-00041920: 6768 7420 6265 2074 6f67 676c 6564 206f  ght be toggled o
-00041930: 6666 2062 790d 0a20 2020 2020 2020 2020  ff by..         
-00041940: 2020 2023 2073 686f 7274 6b65 7920 6b65     # shortkey ke
-00041950: 7920 6164 6170 7465 720d 0a20 2020 2020  y adapter..     
-00041960: 2020 2020 2020 2065 7665 6e74 2e45 7665         event.Eve
-00041970: 6e74 4f62 6a65 6374 2e54 6f67 676c 6554  ntObject.ToggleT
-00041980: 6f6f 6c28 6576 656e 742e 4964 2c20 5472  ool(event.Id, Tr
-00041990: 7565 290d 0a0d 0a0d 0a20 2020 2064 6566  ue)......    def
-000419a0: 206f 6e5f 7365 6172 6368 616c 6c5f 7374   on_searchall_st
-000419b0: 6f70 2873 656c 662c 2065 7665 6e74 293a  op(self, event):
-000419c0: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
-000419d0: 2020 2020 2020 2048 616e 646c 6572 2066         Handler f
-000419e0: 6f72 2063 6c69 636b 696e 6720 746f 2073  or clicking to s
-000419f0: 746f 7020 6120 7365 6172 6368 2c20 7369  top a search, si
-00041a00: 676e 616c 7320 7468 6520 7365 6172 6368  gnals the search
-00041a10: 2074 6872 6561 6420 746f 0d0a 2020 2020   thread to..    
-00041a20: 2020 2020 636c 6f73 652e 0d0a 2020 2020      close...    
-00041a30: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
-00041a40: 2074 6162 5f64 6174 6120 3d20 7365 6c66   tab_data = self
-00041a50: 2e68 746d 6c5f 7365 6172 6368 616c 6c2e  .html_searchall.
-00041a60: 4765 7441 6374 6976 6554 6162 4461 7461  GetActiveTabData
-00041a70: 2829 0d0a 2020 2020 2020 2020 6966 2074  ()..        if t
-00041a80: 6162 5f64 6174 6120 616e 6420 7461 625f  ab_data and tab_
-00041a90: 6461 7461 5b22 6964 225d 2069 6e20 7365  data["id"] in se
-00041aa0: 6c66 2e77 6f72 6b65 7273 5f73 6561 7263  lf.workers_searc
-00041ab0: 683a 0d0a 2020 2020 2020 2020 2020 2020  h:..            
-00041ac0: 7365 6c66 2e74 625f 7365 6172 6368 5f73  self.tb_search_s
-00041ad0: 6574 7469 6e67 732e 5365 7454 6f6f 6c4e  ettings.SetToolN
-00041ae0: 6f72 6d61 6c42 6974 6d61 7028 0d0a 2020  ormalBitmap(..  
-00041af0: 2020 2020 2020 2020 2020 2020 2020 7778                wx
-00041b00: 2e49 445f 5354 4f50 2c20 696d 6167 6573  .ID_STOP, images
-00041b10: 2e54 6f6f 6c62 6172 5374 6f70 7065 642e  .ToolbarStopped.
-00041b20: 4269 746d 6170 290d 0a20 2020 2020 2020  Bitmap)..       
-00041b30: 2020 2020 2073 656c 662e 776f 726b 6572       self.worker
-00041b40: 735f 7365 6172 6368 5b74 6162 5f64 6174  s_search[tab_dat
-00041b50: 615b 2269 6422 5d5d 2e73 746f 7028 290d  a["id"]].stop().
-00041b60: 0a20 2020 2020 2020 2020 2020 2064 656c  .            del
-00041b70: 2073 656c 662e 776f 726b 6572 735f 7365   self.workers_se
-00041b80: 6172 6368 5b74 6162 5f64 6174 615b 2269  arch[tab_data["i
-00041b90: 6422 5d5d 0d0a 0d0a 0d0a 2020 2020 6465  d"]]......    de
-00041ba0: 6620 6f6e 5f63 6861 6e67 655f 7365 6172  f on_change_sear
-00041bb0: 6368 616c 6c5f 7461 6228 7365 6c66 2c20  chall_tab(self, 
-00041bc0: 6576 656e 7429 3a0d 0a20 2020 2020 2020  event):..       
-00041bd0: 2022 2222 4861 6e64 6c65 7220 666f 7220   """Handler for 
-00041be0: 6368 616e 6769 6e67 2061 2074 6162 2069  changing a tab i
-00041bf0: 6e20 7365 6172 6368 2077 696e 646f 772c  n search window,
-00041c00: 2075 7064 6174 6573 2073 746f 7020 6275   updates stop bu
-00041c10: 7474 6f6e 2e22 2222 0d0a 2020 2020 2020  tton."""..      
-00041c20: 2020 7461 625f 6461 7461 203d 2073 656c    tab_data = sel
-00041c30: 662e 6874 6d6c 5f73 6561 7263 6861 6c6c  f.html_searchall
-00041c40: 2e47 6574 4163 7469 7665 5461 6244 6174  .GetActiveTabDat
-00041c50: 6128 290d 0a20 2020 2020 2020 2069 6620  a()..        if 
-00041c60: 7461 625f 6461 7461 2061 6e64 2074 6162  tab_data and tab
-00041c70: 5f64 6174 615b 2269 6422 5d20 696e 2073  _data["id"] in s
-00041c80: 656c 662e 776f 726b 6572 735f 7365 6172  elf.workers_sear
-00041c90: 6368 3a0d 0a20 2020 2020 2020 2020 2020  ch:..           
-00041ca0: 2073 656c 662e 7462 5f73 6561 7263 685f   self.tb_search_
-00041cb0: 7365 7474 696e 6773 2e53 6574 546f 6f6c  settings.SetTool
-00041cc0: 4e6f 726d 616c 4269 746d 6170 280d 0a20  NormalBitmap(.. 
-00041cd0: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-00041ce0: 782e 4944 5f53 544f 502c 2069 6d61 6765  x.ID_STOP, image
-00041cf0: 732e 546f 6f6c 6261 7253 746f 702e 4269  s.ToolbarStop.Bi
-00041d00: 746d 6170 290d 0a20 2020 2020 2020 2065  tmap)..        e
-00041d10: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-00041d20: 2020 7365 6c66 2e74 625f 7365 6172 6368    self.tb_search
-00041d30: 5f73 6574 7469 6e67 732e 5365 7454 6f6f  _settings.SetToo
-00041d40: 6c4e 6f72 6d61 6c42 6974 6d61 7028 0d0a  lNormalBitmap(..
-00041d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041d60: 7778 2e49 445f 5354 4f50 2c20 696d 6167  wx.ID_STOP, imag
-00041d70: 6573 2e54 6f6f 6c62 6172 5374 6f70 7065  es.ToolbarStoppe
-00041d80: 642e 4269 746d 6170 290d 0a0d 0a0d 0a20  d.Bitmap)...... 
-00041d90: 2020 2064 6566 206f 6e5f 6463 6c69 636b     def on_dclick
-00041da0: 5f73 6561 7263 6861 6c6c 5f74 6162 2873  _searchall_tab(s
-00041db0: 656c 662c 2065 7665 6e74 293a 0d0a 2020  elf, event):..  
-00041dc0: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
-00041dd0: 2020 2048 616e 646c 6572 2066 6f72 2064     Handler for d
-00041de0: 6f75 626c 652d 636c 6963 6b69 6e67 2061  ouble-clicking a
-00041df0: 2073 6561 7263 6820 7461 6220 6865 6164   search tab head
-00041e00: 6572 2c20 7365 7473 2074 6865 2073 6561  er, sets the sea
-00041e10: 7263 6820 626f 780d 0a20 2020 2020 2020  rch box..       
-00041e20: 2076 616c 7565 2074 6f20 7461 6220 7465   value to tab te
-00041e30: 7874 2e0d 0a20 2020 2020 2020 2022 2222  xt...        """
-00041e40: 0d0a 2020 2020 2020 2020 7465 7874 203d  ..        text =
-00041e50: 2065 7665 6e74 2e44 6174 612e 6765 7428   event.Data.get(
-00041e60: 2269 6e66 6f22 2c20 7b7d 292e 6765 7428  "info", {}).get(
-00041e70: 2274 6578 7422 290d 0a20 2020 2020 2020  "text")..       
-00041e80: 2069 6620 7465 7874 3a0d 0a20 2020 2020   if text:..     
-00041e90: 2020 2020 2020 2073 656c 662e 6564 6974         self.edit
-00041ea0: 5f73 6561 7263 6861 6c6c 2e56 616c 7565  _searchall.Value
-00041eb0: 203d 2074 6578 740d 0a20 2020 2020 2020   = text..       
-00041ec0: 2020 2020 2073 656c 662e 6564 6974 5f73       self.edit_s
-00041ed0: 6561 7263 6861 6c6c 2e53 6574 466f 6375  earchall.SetFocu
-00041ee0: 7328 290d 0a0d 0a0d 0a20 2020 2064 6566  s()......    def
-00041ef0: 206f 6e5f 7365 6172 6368 616c 6c5f 7265   on_searchall_re
-00041f00: 7375 6c74 2873 656c 662c 2065 7665 6e74  sult(self, event
-00041f10: 293a 0d0a 2020 2020 2020 2020 2222 220d  ):..        """.
-00041f20: 0a20 2020 2020 2020 2048 616e 646c 6572  .        Handler
-00041f30: 2066 6f72 2067 6574 7469 6e67 2072 6573   for getting res
-00041f40: 756c 7473 2066 726f 6d20 7365 6172 6368  ults from search
-00041f50: 2074 6872 6561 642c 2061 6464 7320 7468   thread, adds th
-00041f60: 6520 7265 7375 6c74 7320 746f 0d0a 2020  e results to..  
-00041f70: 2020 2020 2020 7468 6520 7365 6172 6368        the search
-00041f80: 2077 696e 646f 772e 0d0a 2020 2020 2020   window...      
-00041f90: 2020 2222 220d 0a20 2020 2020 2020 2072    """..        r
-00041fa0: 6573 756c 7420 3d20 6576 656e 742e 7265  esult = event.re
-00041fb0: 7375 6c74 0d0a 2020 2020 2020 2020 7365  sult..        se
-00041fc0: 6172 6368 5f69 642c 2073 6561 7263 685f  arch_id, search_
-00041fd0: 646f 6e65 203d 2072 6573 756c 742e 6765  done = result.ge
-00041fe0: 7428 2273 6561 7263 6822 2c20 7b7d 292e  t("search", {}).
-00041ff0: 6765 7428 2269 6422 292c 2046 616c 7365  get("id"), False
-00042000: 0d0a 2020 2020 2020 2020 7461 625f 6461  ..        tab_da
-00042010: 7461 203d 2073 656c 662e 6874 6d6c 5f73  ta = self.html_s
-00042020: 6561 7263 6861 6c6c 2e47 6574 5461 6244  earchall.GetTabD
-00042030: 6174 6142 7949 4428 7365 6172 6368 5f69  ataByID(search_i
-00042040: 6429 0d0a 2020 2020 2020 2020 6966 2074  d)..        if t
-00042050: 6162 5f64 6174 613a 0d0a 2020 2020 2020  ab_data:..      
-00042060: 2020 2020 2020 7461 625f 6461 7461 5b22        tab_data["
-00042070: 696e 666f 225d 5b22 6d61 7022 5d2e 7570  info"]["map"].up
-00042080: 6461 7465 2872 6573 756c 742e 6765 7428  date(result.get(
-00042090: 226d 6170 222c 207b 7d29 290d 0a20 2020  "map", {}))..   
-000420a0: 2020 2020 2020 2020 2074 6162 5f64 6174           tab_dat
-000420b0: 615b 2269 6e66 6f22 5d5b 2270 6172 7469  a["info"]["parti
-000420c0: 616c 5f68 746d 6c22 5d20 2b3d 2072 6573  al_html"] += res
-000420d0: 756c 742e 6765 7428 226f 7574 7075 7422  ult.get("output"
-000420e0: 2c20 2222 290d 0a20 2020 2020 2020 2020  , "")..         
-000420f0: 2020 2068 746d 6c20 3d20 7461 625f 6461     html = tab_da
-00042100: 7461 5b22 696e 666f 225d 5b22 7061 7274  ta["info"]["part
-00042110: 6961 6c5f 6874 6d6c 225d 0d0a 2020 2020  ial_html"]..    
-00042120: 2020 2020 2020 2020 6966 2022 646f 6e65          if "done
-00042130: 2220 696e 2072 6573 756c 743a 0d0a 2020  " in result:..  
-00042140: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00042150: 6172 6368 5f64 6f6e 6520 3d20 5472 7565  arch_done = True
-00042160: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
-00042170: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-00042180: 2020 2020 2068 746d 6c20 2b3d 2022 3c2f       html += "</
-00042190: 7461 626c 653e 3c2f 666f 6e74 3e22 0d0a  table></font>"..
-000421a0: 2020 2020 2020 2020 2020 2020 7465 7874              text
-000421b0: 203d 2074 6162 5f64 6174 615b 2269 6e66   = tab_data["inf
-000421c0: 6f22 5d5b 2274 6578 7422 5d0d 0a20 2020  o"]["text"]..   
-000421d0: 2020 2020 2020 2020 2074 6974 6c65 203d           title =
-000421e0: 2074 6578 745b 3a35 305d 202b 2022 2e2e   text[:50] + "..
-000421f0: 2220 6966 206c 656e 2874 6578 7429 203e  " if len(text) >
-00042200: 2035 3020 656c 7365 2074 6578 740d 0a20   50 else text.. 
-00042210: 2020 2020 2020 2020 2020 2074 6974 6c65             title
-00042220: 202b 3d20 2220 2825 7329 2220 2520 7265   += " (%s)" % re
-00042230: 7375 6c74 2e67 6574 2822 636f 756e 7422  sult.get("count"
-00042240: 2c20 3029 0d0a 2020 2020 2020 2020 2020  , 0)..          
-00042250: 2020 7365 6c66 2e68 746d 6c5f 7365 6172    self.html_sear
-00042260: 6368 616c 6c2e 5365 7454 6162 4461 7461  chall.SetTabData
-00042270: 4279 4944 2873 6561 7263 685f 6964 2c20  ByID(search_id, 
-00042280: 7469 746c 652c 2068 746d 6c2c 0d0a 2020  title, html,..  
-00042290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000422a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000422b0: 2020 2020 2020 2020 2020 2020 2074 6162               tab
-000422c0: 5f64 6174 615b 2269 6e66 6f22 5d29 0d0a  _data["info"])..
-000422d0: 2020 2020 2020 2020 6966 2073 6561 7263          if searc
-000422e0: 685f 646f 6e65 3a0d 0a20 2020 2020 2020  h_done:..       
-000422f0: 2020 2020 2067 7569 6261 7365 2e73 7461       guibase.sta
-00042300: 7475 7328 2246 696e 6973 6865 6420 7365  tus("Finished se
-00042310: 6172 6368 696e 6720 666f 7220 5c22 2573  arching for \"%s
-00042320: 5c22 2069 6e20 2573 2e22 2c0d 0a20 2020  \" in %s.",..   
-00042330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042340: 2020 2020 2020 2020 7265 7375 6c74 5b22          result["
-00042350: 7365 6172 6368 225d 5b22 7465 7874 225d  search"]["text"]
-00042360: 2c20 7365 6c66 2e64 622e 6669 6c65 6e61  , self.db.filena
-00042370: 6d65 290d 0a20 2020 2020 2020 2020 2020  me)..           
-00042380: 2073 656c 662e 7462 5f73 6561 7263 685f   self.tb_search_
-00042390: 7365 7474 696e 6773 2e53 6574 546f 6f6c  settings.SetTool
-000423a0: 4e6f 726d 616c 4269 746d 6170 280d 0a20  NormalBitmap(.. 
-000423b0: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-000423c0: 782e 4944 5f53 544f 502c 2069 6d61 6765  x.ID_STOP, image
-000423d0: 732e 546f 6f6c 6261 7253 746f 7070 6564  s.ToolbarStopped
-000423e0: 2e42 6974 6d61 7029 0d0a 2020 2020 2020  .Bitmap)..      
-000423f0: 2020 2020 2020 6966 2073 6561 7263 685f        if search_
-00042400: 6964 2069 6e20 7365 6c66 2e77 6f72 6b65  id in self.worke
-00042410: 7273 5f73 6561 7263 683a 0d0a 2020 2020  rs_search:..    
-00042420: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00042430: 2e77 6f72 6b65 7273 5f73 6561 7263 685b  .workers_search[
-00042440: 7365 6172 6368 5f69 645d 2e73 746f 7028  search_id].stop(
-00042450: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00042460: 2020 2064 656c 2073 656c 662e 776f 726b     del self.work
-00042470: 6572 735f 7365 6172 6368 5b73 6561 7263  ers_search[searc
-00042480: 685f 6964 5d0d 0a20 2020 2020 2020 2069  h_id]..        i
-00042490: 6620 2265 7272 6f72 2220 696e 2072 6573  f "error" in res
-000424a0: 756c 743a 0d0a 2020 2020 2020 2020 2020  ult:..          
-000424b0: 2020 6c6f 6767 6572 2e65 7272 6f72 2822    logger.error("
-000424c0: 4572 726f 7220 7365 6172 6368 696e 6720  Error searching 
-000424d0: 2573 3a5c 6e5c 6e25 7322 2c20 7365 6c66  %s:\n\n%s", self
-000424e0: 2e64 622c 2072 6573 756c 745b 2265 7272  .db, result["err
-000424f0: 6f72 225d 290d 0a20 2020 2020 2020 2020  or"])..         
-00042500: 2020 2065 7272 6f72 6d73 6720 3d20 2245     errormsg = "E
-00042510: 7272 6f72 2073 6561 7263 6869 6e67 2025  rror searching %
-00042520: 733a 5c6e 5c6e 2573 2220 2520 5c0d 0a20  s:\n\n%s" % \.. 
-00042530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042540: 2020 2020 2020 2873 656c 662e 6462 2c20        (self.db, 
-00042550: 7265 7375 6c74 2e67 6574 2822 6572 726f  result.get("erro
-00042560: 725f 7368 6f72 7422 2c20 7265 7375 6c74  r_short", result
-00042570: 5b22 6572 726f 7222 5d29 290d 0a20 2020  ["error"]))..   
-00042580: 2020 2020 2020 2020 2077 782e 4d65 7373           wx.Mess
-00042590: 6167 6542 6f78 2865 7272 6f72 6d73 672c  ageBox(errormsg,
-000425a0: 2063 6f6e 662e 5469 746c 652c 2077 782e   conf.Title, wx.
-000425b0: 4f4b 207c 2077 782e 4943 4f4e 5f57 4152  OK | wx.ICON_WAR
-000425c0: 4e49 4e47 290d 0a0d 0a0d 0a20 2020 2064  NING)......    d
-000425d0: 6566 206f 6e5f 7365 6172 6368 616c 6c5f  ef on_searchall_
-000425e0: 6361 6c6c 6261 636b 2873 656c 662c 2072  callback(self, r
-000425f0: 6573 756c 7429 3a0d 0a20 2020 2020 2020  esult):..       
-00042600: 2022 2222 4361 6c6c 6261 636b 2066 756e   """Callback fun
-00042610: 6374 696f 6e20 666f 7220 5365 6172 6368  ction for Search
-00042620: 5468 7265 6164 2c20 706f 7374 7320 7468  Thread, posts th
-00042630: 6520 6461 7461 2074 6f20 7365 6c66 2e22  e data to self."
-00042640: 2222 0d0a 2020 2020 2020 2020 6966 2073  ""..        if s
-00042650: 656c 663a 2023 2043 6865 636b 2069 6620  elf: # Check if 
-00042660: 696e 7374 616e 6365 2069 7320 7374 696c  instance is stil
-00042670: 6c20 7661 6c69 6420 2869 2e65 2e20 6e6f  l valid (i.e. no
-00042680: 7420 6465 7374 726f 7965 6420 6279 2077  t destroyed by w
-00042690: 7829 0d0a 2020 2020 2020 2020 2020 2020  x)..            
-000426a0: 7778 2e50 6f73 7445 7665 6e74 2873 656c  wx.PostEvent(sel
-000426b0: 662c 2057 6f72 6b65 7245 7665 6e74 2872  f, WorkerEvent(r
-000426c0: 6573 756c 743d 7265 7375 6c74 2929 0d0a  esult=result))..
-000426d0: 0d0a 0d0a 2020 2020 6465 6620 6f6e 5f73  ....    def on_s
-000426e0: 6561 7263 6861 6c6c 2873 656c 662c 2065  earchall(self, e
-000426f0: 7665 6e74 293a 0d0a 2020 2020 2020 2020  vent):..        
-00042700: 2222 220d 0a20 2020 2020 2020 2048 616e  """..        Han
-00042710: 646c 6572 2066 6f72 2063 6c69 636b 696e  dler for clickin
-00042720: 6720 746f 2067 6c6f 6261 6c20 7365 6172  g to global sear
-00042730: 6368 2074 6865 2064 6174 6162 6173 652e  ch the database.
-00042740: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
-00042750: 2020 2020 2020 2074 6578 7420 3d20 7365         text = se
-00042760: 6c66 2e65 6469 745f 7365 6172 6368 616c  lf.edit_searchal
-00042770: 6c2e 5661 6c75 650d 0a20 2020 2020 2020  l.Value..       
-00042780: 2069 6620 7465 7874 2e73 7472 6970 2829   if text.strip()
-00042790: 3a0d 0a20 2020 2020 2020 2020 2020 2067  :..            g
-000427a0: 7569 6261 7365 2e73 7461 7475 7328 2253  uibase.status("S
-000427b0: 6561 7263 6869 6e67 2066 6f72 205c 2225  earching for \"%
-000427c0: 735c 2220 696e 2025 732e 222c 2074 6578  s\" in %s.", tex
-000427d0: 742c 2073 656c 662e 6462 2e66 696c 656e  t, self.db.filen
-000427e0: 616d 6529 0d0a 2020 2020 2020 2020 2020  ame)..          
-000427f0: 2020 6874 6d6c 203d 2073 656c 662e 6874    html = self.ht
-00042800: 6d6c 5f73 6561 7263 6861 6c6c 0d0a 2020  ml_searchall..  
-00042810: 2020 2020 2020 2020 2020 6461 7461 203d            data =
-00042820: 207b 2269 6422 3a20 7365 6c66 2e63 6f75   {"id": self.cou
-00042830: 6e74 6572 2829 2c20 2264 6222 3a20 7365  nter(), "db": se
-00042840: 6c66 2e64 622c 2022 7465 7874 223a 2074  lf.db, "text": t
-00042850: 6578 742c 2022 6d61 7022 3a20 7b7d 2c0d  ext, "map": {},.
-00042860: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00042870: 2020 2020 2022 7769 6474 6822 3a20 6874       "width": ht
-00042880: 6d6c 2e53 697a 652e 7769 6474 6820 2a20  ml.Size.width * 
-00042890: 3520 2f2f 2039 2c20 2274 6162 6c65 223a  5 // 9, "table":
-000428a0: 2022 222c 0d0a 2020 2020 2020 2020 2020   "",..          
-000428b0: 2020 2020 2020 2020 2020 2270 6172 7469            "parti
-000428c0: 616c 5f68 746d 6c22 3a20 2222 7d0d 0a20  al_html": ""}.. 
-000428d0: 2020 2020 2020 2020 2020 2066 726f 6d74             fromt
-000428e0: 6578 7420 3d20 2222 2023 2022 5365 6172  ext = "" # "Sear
-000428f0: 6368 696e 6720 666f 7220 2274 6578 7422  ching for "text"
-00042900: 2069 6e20 6672 6f6d 7465 7874 220d 0a20   in fromtext".. 
-00042910: 2020 2020 2020 2020 2020 2069 6620 636f             if co
-00042920: 6e66 2e53 6561 7263 6849 6e4d 6573 7361  nf.SearchInMessa
-00042930: 6765 733a 0d0a 2020 2020 2020 2020 2020  ges:..          
-00042940: 2020 2020 2020 6461 7461 5b22 7461 626c        data["tabl
-00042950: 6522 5d20 3d20 226d 6573 7361 6765 7322  e"] = "messages"
-00042960: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00042970: 2020 6672 6f6d 7465 7874 203d 2022 6d65    fromtext = "me
-00042980: 7373 6167 6573 220d 0a20 2020 2020 2020  ssages"..       
-00042990: 2020 2020 2065 6c69 6620 636f 6e66 2e53       elif conf.S
-000429a0: 6561 7263 6849 6e43 6861 7449 6e66 6f3a  earchInChatInfo:
-000429b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000429c0: 2020 6461 7461 5b22 7461 626c 6522 5d20    data["table"] 
-000429d0: 3d20 2263 6f6e 7665 7273 6174 696f 6e73  = "conversations
-000429e0: 220d 0a20 2020 2020 2020 2020 2020 2020  "..             
-000429f0: 2020 2066 726f 6d74 6578 7420 3d20 2263     fromtext = "c
-00042a00: 6861 7420 696e 666f 726d 6174 696f 6e22  hat information"
-00042a10: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
-00042a20: 6966 2063 6f6e 662e 5365 6172 6368 496e  if conf.SearchIn
-00042a30: 436f 6e74 6163 7473 3a0d 0a20 2020 2020  Contacts:..     
-00042a40: 2020 2020 2020 2020 2020 2064 6174 615b             data[
-00042a50: 2274 6162 6c65 225d 203d 2022 636f 6e74  "table"] = "cont
-00042a60: 6163 7473 220d 0a20 2020 2020 2020 2020  acts"..         
-00042a70: 2020 2020 2020 2066 726f 6d74 6578 7420         fromtext 
-00042a80: 3d20 2263 6f6e 7461 6374 2069 6e66 6f72  = "contact infor
-00042a90: 6d61 7469 6f6e 220d 0a20 2020 2020 2020  mation"..       
-00042aa0: 2020 2020 2065 6c69 6620 636f 6e66 2e53       elif conf.S
-00042ab0: 6561 7263 6849 6e54 6162 6c65 733a 0d0a  earchInTables:..
-00042ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042ad0: 6672 6f6d 7465 7874 203d 2064 6174 615b  fromtext = data[
-00042ae0: 2274 6162 6c65 225d 203d 2022 616c 6c20  "table"] = "all 
-00042af0: 7461 626c 6573 220d 0a20 2020 2020 2020  tables"..       
-00042b00: 2020 2020 2023 2050 6172 7469 616c 6c79       # Partially
-00042b10: 2061 7373 656d 626c 6564 2048 544d 4c20   assembled HTML 
-00042b20: 666f 7220 6375 7272 656e 7420 7265 7375  for current resu
-00042b30: 6c74 730d 0a20 2020 2020 2020 2020 2020  lts..           
-00042b40: 2074 656d 706c 6174 6520 3d20 7374 6570   template = step
-00042b50: 2e54 656d 706c 6174 6528 7465 6d70 6c61  .Template(templa
-00042b60: 7465 732e 5345 4152 4348 5f48 4541 4445  tes.SEARCH_HEADE
-00042b70: 525f 4854 4d4c 2c20 6573 6361 7065 3d54  R_HTML, escape=T
-00042b80: 7275 6529 0d0a 2020 2020 2020 2020 2020  rue)..          
-00042b90: 2020 6461 7461 5b22 7061 7274 6961 6c5f    data["partial_
-00042ba0: 6874 6d6c 225d 203d 2074 656d 706c 6174  html"] = templat
-00042bb0: 652e 6578 7061 6e64 286c 6f63 616c 7328  e.expand(locals(
-00042bc0: 2929 0d0a 0d0a 2020 2020 2020 2020 2020  ))....          
-00042bd0: 2020 776f 726b 6572 203d 2077 6f72 6b65    worker = worke
-00042be0: 7273 2e53 6561 7263 6854 6872 6561 6428  rs.SearchThread(
-00042bf0: 7365 6c66 2e6f 6e5f 7365 6172 6368 616c  self.on_searchal
-00042c00: 6c5f 6361 6c6c 6261 636b 290d 0a20 2020  l_callback)..   
-00042c10: 2020 2020 2020 2020 2073 656c 662e 776f           self.wo
-00042c20: 726b 6572 735f 7365 6172 6368 5b64 6174  rkers_search[dat
-00042c30: 615b 2269 6422 5d5d 203d 2077 6f72 6b65  a["id"]] = worke
-00042c40: 720d 0a20 2020 2020 2020 2020 2020 2077  r..            w
-00042c50: 6f72 6b65 722e 776f 726b 2864 6174 6129  orker.work(data)
-00042c60: 0d0a 2020 2020 2020 2020 2020 2020 626d  ..            bm
-00042c70: 7020 3d20 696d 6167 6573 2e54 6f6f 6c62  p = images.Toolb
-00042c80: 6172 5374 6f70 2e42 6974 6d61 700d 0a20  arStop.Bitmap.. 
-00042c90: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00042ca0: 7462 5f73 6561 7263 685f 7365 7474 696e  tb_search_settin
-00042cb0: 6773 2e53 6574 546f 6f6c 4e6f 726d 616c  gs.SetToolNormal
-00042cc0: 4269 746d 6170 2877 782e 4944 5f53 544f  Bitmap(wx.ID_STO
-00042cd0: 502c 2062 6d70 290d 0a0d 0a20 2020 2020  P, bmp)....     
-00042ce0: 2020 2020 2020 2074 6974 6c65 203d 2074         title = t
-00042cf0: 6578 745b 3a35 305d 202b 2022 2e2e 2220  ext[:50] + ".." 
-00042d00: 6966 206c 656e 2874 6578 7429 203e 2035  if len(text) > 5
-00042d10: 3020 656c 7365 2074 6578 740d 0a20 2020  0 else text..   
-00042d20: 2020 2020 2020 2020 2063 6f6e 7465 6e74           content
-00042d30: 203d 2064 6174 615b 2270 6172 7469 616c   = data["partial
-00042d40: 5f68 746d 6c22 5d20 2b20 223c 2f74 6162  _html"] + "</tab
-00042d50: 6c65 3e3c 2f66 6f6e 743e 220d 0a20 2020  le></font>"..   
-00042d60: 2020 2020 2020 2020 2069 6620 636f 6e66           if conf
-00042d70: 2e53 6561 7263 6855 7365 4e65 7754 6162  .SearchUseNewTab
-00042d80: 206f 7220 6e6f 7420 6874 6d6c 2e47 6574   or not html.Get
-00042d90: 5461 6243 6f75 6e74 2829 3a0d 0a20 2020  TabCount():..   
-00042da0: 2020 2020 2020 2020 2020 2020 2068 746d               htm
-00042db0: 6c2e 496e 7365 7274 5461 6228 302c 2074  l.InsertTab(0, t
-00042dc0: 6974 6c65 2c20 6461 7461 5b22 6964 225d  itle, data["id"]
-00042dd0: 2c20 636f 6e74 656e 742c 2064 6174 6129  , content, data)
-00042de0: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
-00042df0: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-00042e00: 2020 2020 2023 2053 6574 206e 6577 2049       # Set new I
-00042e10: 4420 666f 7220 7468 6520 6578 6973 7469  D for the existi
-00042e20: 6e67 2072 6575 7365 6420 7461 620d 0a20  ng reused tab.. 
-00042e30: 2020 2020 2020 2020 2020 2020 2020 2068                 h
-00042e40: 746d 6c2e 5365 7454 6162 4461 7461 4279  tml.SetTabDataBy
-00042e50: 4944 2868 746d 6c2e 4765 7441 6374 6976  ID(html.GetActiv
-00042e60: 6554 6162 4461 7461 2829 5b22 6964 225d  eTabData()["id"]
-00042e70: 2c20 7469 746c 652c 0d0a 2020 2020 2020  , title,..      
-00042e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042e90: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00042ea0: 6e74 656e 742c 2064 6174 612c 2064 6174  ntent, data, dat
-00042eb0: 615b 2269 6422 5d29 0d0a 0d0a 2020 2020  a["id"])....    
-00042ec0: 2020 2020 2020 2020 7365 6c66 2e6e 6f74          self.not
-00042ed0: 6562 6f6f 6b2e 5365 7453 656c 6563 7469  ebook.SetSelecti
-00042ee0: 6f6e 2873 656c 662e 7061 6765 6f72 6465  on(self.pageorde
-00042ef0: 725b 7365 6c66 2e70 6167 655f 7365 6172  r[self.page_sear
-00042f00: 6368 5d29 0d0a 2020 2020 2020 2020 2020  ch])..          
-00042f10: 2020 7574 696c 2e61 6464 5f75 6e69 7175    util.add_uniqu
-00042f20: 6528 636f 6e66 2e53 6561 7263 6848 6973  e(conf.SearchHis
-00042f30: 746f 7279 2c20 7465 7874 2e73 7472 6970  tory, text.strip
-00042f40: 2829 2c20 312c 0d0a 2020 2020 2020 2020  (), 1,..        
-00042f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042f60: 2020 2020 636f 6e66 2e4d 6178 5365 6172      conf.MaxSear
-00042f70: 6368 4869 7374 6f72 7929 0d0a 2020 2020  chHistory)..    
-00042f80: 2020 2020 2020 2020 7365 6c66 2e54 6f70          self.Top
-00042f90: 4c65 7665 6c50 6172 656e 742e 6469 616c  LevelParent.dial
-00042fa0: 6f67 5f73 6561 7263 682e 5661 6c75 6520  og_search.Value 
-00042fb0: 3d20 636f 6e66 2e53 6561 7263 6848 6973  = conf.SearchHis
-00042fc0: 746f 7279 5b2d 315d 0d0a 2020 2020 2020  tory[-1]..      
-00042fd0: 2020 2020 2020 7365 6c66 2e54 6f70 4c65        self.TopLe
-00042fe0: 7665 6c50 6172 656e 742e 6469 616c 6f67  velParent.dialog
-00042ff0: 5f73 6561 7263 682e 5365 7443 686f 6963  _search.SetChoic
-00043000: 6573 2863 6f6e 662e 5365 6172 6368 4869  es(conf.SearchHi
-00043010: 7374 6f72 7929 0d0a 2020 2020 2020 2020  story)..        
-00043020: 2020 2020 7365 6c66 2e65 6469 745f 7365      self.edit_se
-00043030: 6172 6368 616c 6c2e 5365 7443 686f 6963  archall.SetChoic
-00043040: 6573 2863 6f6e 662e 5365 6172 6368 4869  es(conf.SearchHi
-00043050: 7374 6f72 7929 0d0a 2020 2020 2020 2020  story)..        
-00043060: 2020 2020 7365 6c66 2e65 6469 745f 7365      self.edit_se
-00043070: 6172 6368 616c 6c2e 5365 7446 6f63 7573  archall.SetFocus
-00043080: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
-00043090: 7574 696c 2e72 756e 5f6f 6e63 6528 636f  util.run_once(co
-000430a0: 6e66 2e73 6176 6529 0d0a 0d0a 0d0a 2020  nf.save)......  
-000430b0: 2020 6465 6620 6f6e 5f64 656c 6574 655f    def on_delete_
-000430c0: 7461 625f 6361 6c6c 6261 636b 2873 656c  tab_callback(sel
-000430d0: 662c 2074 6162 293a 0d0a 2020 2020 2020  f, tab):..      
-000430e0: 2020 2222 220d 0a20 2020 2020 2020 2046    """..        F
-000430f0: 756e 6374 696f 6e20 6361 6c6c 6564 2062  unction called b
-00043100: 7920 6874 6d6c 5f73 6561 7263 6861 6c6c  y html_searchall
-00043110: 2061 6674 6572 2064 656c 6574 696e 6720   after deleting 
-00043120: 6120 7461 622c 2073 746f 7073 2074 6865  a tab, stops the
-00043130: 0d0a 2020 2020 2020 2020 6f6e 676f 696e  ..        ongoin
-00043140: 6720 7365 6172 6368 2c20 6966 2061 6e79  g search, if any
-00043150: 2e0d 0a20 2020 2020 2020 2022 2222 0d0a  ...        """..
-00043160: 2020 2020 2020 2020 7461 625f 6461 7461          tab_data
-00043170: 203d 2073 656c 662e 6874 6d6c 5f73 6561   = self.html_sea
-00043180: 7263 6861 6c6c 2e47 6574 4163 7469 7665  rchall.GetActive
-00043190: 5461 6244 6174 6128 290d 0a20 2020 2020  TabData()..     
-000431a0: 2020 2069 6620 7461 625f 6461 7461 2061     if tab_data a
-000431b0: 6e64 2074 6162 5f64 6174 615b 2269 6422  nd tab_data["id"
-000431c0: 5d20 3d3d 2074 6162 5b22 6964 225d 3a0d  ] == tab["id"]:.
-000431d0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000431e0: 662e 7462 5f73 6561 7263 685f 7365 7474  f.tb_search_sett
-000431f0: 696e 6773 2e53 6574 546f 6f6c 4e6f 726d  ings.SetToolNorm
-00043200: 616c 4269 746d 6170 280d 0a20 2020 2020  alBitmap(..     
-00043210: 2020 2020 2020 2020 2020 2077 782e 4944             wx.ID
-00043220: 5f53 544f 502c 2069 6d61 6765 732e 546f  _STOP, images.To
-00043230: 6f6c 6261 7253 746f 7070 6564 2e42 6974  olbarStopped.Bit
-00043240: 6d61 7029 0d0a 2020 2020 2020 2020 6966  map)..        if
-00043250: 2074 6162 5b22 6964 225d 2069 6e20 7365   tab["id"] in se
-00043260: 6c66 2e77 6f72 6b65 7273 5f73 6561 7263  lf.workers_searc
-00043270: 683a 0d0a 2020 2020 2020 2020 2020 2020  h:..            
-00043280: 7365 6c66 2e77 6f72 6b65 7273 5f73 6561  self.workers_sea
-00043290: 7263 685b 7461 625b 2269 6422 5d5d 2e73  rch[tab["id"]].s
-000432a0: 746f 7028 290d 0a20 2020 2020 2020 2020  top()..         
-000432b0: 2020 2064 656c 2073 656c 662e 776f 726b     del self.work
-000432c0: 6572 735f 7365 6172 6368 5b74 6162 5b22  ers_search[tab["
-000432d0: 6964 225d 5d0d 0a0d 0a0d 0a20 2020 2064  id"]]......    d
-000432e0: 6566 206f 6e5f 6d6f 7573 655f 6f76 6572  ef on_mouse_over
-000432f0: 5f67 7269 6428 7365 6c66 2c20 6576 656e  _grid(self, even
-00043300: 7429 3a0d 0a20 2020 2020 2020 2022 2222  t):..        """
-00043310: 0d0a 2020 2020 2020 2020 4861 6e64 6c65  ..        Handle
-00043320: 7220 666f 7220 6d6f 7669 6e67 2074 6865  r for moving the
-00043330: 206d 6f75 7365 206f 7665 7220 6120 6772   mouse over a gr
-00043340: 6964 2c20 7368 6f77 7320 6461 7465 7469  id, shows dateti
-00043350: 6d65 2074 6f6f 6c74 6970 2066 6f72 0d0a  me tooltip for..
-00043360: 2020 2020 2020 2020 554e 4958 2074 696d          UNIX tim
-00043370: 6573 7461 6d70 2063 656c 6c73 2e0d 0a20  estamp cells... 
-00043380: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
-00043390: 2020 2020 7469 7020 3d20 2222 0d0a 2020      tip = ""..  
-000433a0: 2020 2020 2020 6772 6964 203d 2065 7665        grid = eve
-000433b0: 6e74 2e45 7665 6e74 4f62 6a65 6374 2e50  nt.EventObject.P
-000433c0: 6172 656e 740d 0a20 2020 2020 2020 2070  arent..        p
-000433d0: 7265 765f 6365 6c6c 203d 2067 6574 6174  rev_cell = getat
-000433e0: 7472 2867 7269 642c 2022 5f68 6f76 6572  tr(grid, "_hover
-000433f0: 6564 5f63 656c 6c22 2c20 4e6f 6e65 290d  ed_cell", None).
-00043400: 0a20 2020 2020 2020 2078 2c20 7920 3d20  .        x, y = 
-00043410: 6772 6964 2e43 616c 6355 6e73 6372 6f6c  grid.CalcUnscrol
-00043420: 6c65 6450 6f73 6974 696f 6e28 6576 656e  ledPosition(even
-00043430: 742e 582c 2065 7665 6e74 2e59 290d 0a20  t.X, event.Y).. 
-00043440: 2020 2020 2020 2072 6f77 2c20 636f 6c20         row, col 
-00043450: 3d20 6772 6964 2e58 5954 6f43 656c 6c28  = grid.XYToCell(
-00043460: 782c 2079 290d 0a20 2020 2020 2020 2069  x, y)..        i
-00043470: 6620 726f 7720 3e3d 2030 2061 6e64 2063  f row >= 0 and c
-00043480: 6f6c 203e 3d20 303a 0d0a 2020 2020 2020  ol >= 0:..      
-00043490: 2020 2020 2020 7661 6c75 6520 3d20 6772        value = gr
-000434a0: 6964 2e54 6162 6c65 2e47 6574 5661 6c75  id.Table.GetValu
-000434b0: 6528 726f 772c 2063 6f6c 290d 0a20 2020  e(row, col)..   
-000434c0: 2020 2020 2020 2020 2063 6f6c 5f6e 616d           col_nam
-000434d0: 6520 3d20 6772 6964 2e54 6162 6c65 2e47  e = grid.Table.G
-000434e0: 6574 436f 6c4c 6162 656c 5661 6c75 6528  etColLabelValue(
-000434f0: 636f 6c29 2e6c 6f77 6572 2829 0d0a 2020  col).lower()..  
-00043500: 2020 2020 2020 2020 2020 6966 2074 7970            if typ
-00043510: 6528 7661 6c75 6529 2069 7320 696e 7420  e(value) is int 
-00043520: 616e 6420 7661 6c75 6520 3e20 3130 3030  and value > 1000
-00043530: 3030 3030 3020 5c0d 0a20 2020 2020 2020  00000 \..       
-00043540: 2020 2020 2061 6e64 2028 2274 696d 6522       and ("time"
-00043550: 2069 6e20 636f 6c5f 6e61 6d65 206f 7220   in col_name or 
-00043560: 2268 6973 746f 7279 2220 696e 2063 6f6c  "history" in col
-00043570: 5f6e 616d 6529 3a0d 0a20 2020 2020 2020  _name):..       
-00043580: 2020 2020 2020 2020 2074 7279 3a0d 0a20           try:.. 
-00043590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000435a0: 2020 2074 6970 203d 2073 656c 662e 6462     tip = self.db
-000435b0: 2e73 7461 6d70 5f74 6f5f 6461 7465 2876  .stamp_to_date(v
-000435c0: 616c 7565 292e 7374 7266 7469 6d65 280d  alue).strftime(.
-000435d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000435e0: 2020 2020 2020 2020 2020 2022 2559 2d25             "%Y-%
-000435f0: 6d2d 2564 2025 483a 254d 3a25 5322 290d  m-%d %H:%M:%S").
-00043600: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00043610: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
-00043620: 6e3a 0d0a 2020 2020 2020 2020 2020 2020  n:..            
-00043630: 2020 2020 2020 2020 7469 7020 3d20 7574          tip = ut
-00043640: 696c 2e74 6f5f 756e 6963 6f64 6528 7661  il.to_unicode(va
-00043650: 6c75 6529 0d0a 2020 2020 2020 2020 2020  lue)..          
-00043660: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-00043670: 2020 2020 2020 2020 2074 6970 203d 2075           tip = u
-00043680: 7469 6c2e 746f 5f75 6e69 636f 6465 2876  til.to_unicode(v
-00043690: 616c 7565 290d 0a20 2020 2020 2020 2020  alue)..         
-000436a0: 2020 2074 6970 203d 2074 6970 2069 6620     tip = tip if 
-000436b0: 6c65 6e28 7469 7029 203c 2031 3030 3020  len(tip) < 1000 
-000436c0: 656c 7365 2074 6970 5b3a 3130 3030 5d20  else tip[:1000] 
-000436d0: 2b20 222e 2e22 0d0a 2020 2020 2020 2020  + ".."..        
-000436e0: 6966 2028 726f 772c 2063 6f6c 2920 213d  if (row, col) !=
-000436f0: 2070 7265 765f 6365 6c6c 206f 7220 6e6f   prev_cell or no
-00043700: 7420 2865 7665 6e74 2e45 7665 6e74 4f62  t (event.EventOb
-00043710: 6a65 6374 2e54 6f6f 6c54 6970 2920 5c0d  ject.ToolTip) \.
-00043720: 0a20 2020 2020 2020 206f 7220 6576 656e  .        or even
-00043730: 742e 4576 656e 744f 626a 6563 742e 546f  t.EventObject.To
-00043740: 6f6c 5469 702e 5469 7020 213d 2074 6970  olTip.Tip != tip
-00043750: 3a0d 0a20 2020 2020 2020 2020 2020 2065  :..            e
-00043760: 7665 6e74 2e45 7665 6e74 4f62 6a65 6374  vent.EventObject
-00043770: 2e53 6574 546f 6f6c 5469 7028 7469 7029  .SetToolTip(tip)
-00043780: 0d0a 2020 2020 2020 2020 6772 6964 2e5f  ..        grid._
-00043790: 686f 7665 7265 645f 6365 6c6c 203d 2028  hovered_cell = (
-000437a0: 726f 772c 2063 6f6c 290d 0a0d 0a0d 0a20  row, col)...... 
-000437b0: 2020 2064 6566 206f 6e5f 7061 7274 6963     def on_partic
-000437c0: 6970 616e 7473 5f64 636c 6963 6b28 7365  ipants_dclick(se
-000437d0: 6c66 2c20 6576 656e 7429 3a0d 0a20 2020  lf, event):..   
-000437e0: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-000437f0: 2020 4861 6e64 6c65 7220 666f 7220 646f    Handler for do
-00043800: 7562 6c65 2d63 6c69 636b 696e 6720 616e  uble-clicking an
-00043810: 2069 7465 6d20 696e 2074 6865 2070 6172   item in the par
-00043820: 7469 6369 7061 6e74 7320 6c69 7374 2c0d  ticipants list,.
-00043830: 0a20 2020 2020 2020 2063 6865 636b 732f  .        checks/
-00043840: 756e 6368 6563 6b73 2028 4368 6563 6b4c  unchecks (CheckL
-00043850: 6973 7442 6f78 2063 6865 636b 7320 6f6e  istBox checks on
-00043860: 6c79 2077 6865 6e20 636c 6963 6b69 6e67  ly when clicking
-00043870: 206f 6e20 7468 650d 0a20 2020 2020 2020   on the..       
-00043880: 2063 6865 636b 626f 7820 6963 6f6e 2069   checkbox icon i
-00043890: 7473 656c 6629 2e0d 0a20 2020 2020 2020  tself)...       
-000438a0: 2022 2222 0d0a 2020 2020 2020 2020 6368   """..        ch
-000438b0: 6563 6b65 6473 203d 206c 6973 7428 6576  eckeds = list(ev
-000438c0: 656e 742e 4576 656e 744f 626a 6563 742e  ent.EventObject.
-000438d0: 4368 6563 6b65 6429 0d0a 2020 2020 2020  Checked)..      
-000438e0: 2020 646f 5f63 6865 636b 203d 206e 6f74    do_check = not
-000438f0: 2065 7665 6e74 2e45 7665 6e74 4f62 6a65   event.EventObje
-00043900: 6374 2e49 7343 6865 636b 6564 2865 7665  ct.IsChecked(eve
-00043910: 6e74 2e53 656c 6563 7469 6f6e 290d 0a20  nt.Selection).. 
-00043920: 2020 2020 2020 2069 6620 646f 5f63 6865         if do_che
-00043930: 636b 2061 6e64 2065 7665 6e74 2e53 656c  ck and event.Sel
-00043940: 6563 7469 6f6e 206e 6f74 2069 6e20 6368  ection not in ch
-00043950: 6563 6b65 6473 3a0d 0a20 2020 2020 2020  eckeds:..       
-00043960: 2020 2020 2063 6865 636b 6564 732e 6170       checkeds.ap
-00043970: 7065 6e64 2865 7665 6e74 2e53 656c 6563  pend(event.Selec
-00043980: 7469 6f6e 290d 0a20 2020 2020 2020 2065  tion)..        e
-00043990: 6c69 6620 6e6f 7420 646f 5f63 6865 636b  lif not do_check
-000439a0: 2061 6e64 2065 7665 6e74 2e53 656c 6563   and event.Selec
-000439b0: 7469 6f6e 2069 6e20 6368 6563 6b65 6473  tion in checkeds
-000439c0: 3a0d 0a20 2020 2020 2020 2020 2020 2063  :..            c
-000439d0: 6865 636b 6564 732e 7265 6d6f 7665 2865  heckeds.remove(e
-000439e0: 7665 6e74 2e53 656c 6563 7469 6f6e 290d  vent.Selection).
-000439f0: 0a20 2020 2020 2020 2065 7665 6e74 2e45  .        event.E
-00043a00: 7665 6e74 4f62 6a65 6374 2e53 6574 4368  ventObject.SetCh
-00043a10: 6563 6b65 6428 6368 6563 6b65 6473 290d  ecked(checkeds).
-00043a20: 0a0d 0a0d 0a20 2020 2064 6566 206f 6e5f  .....    def on_
-00043a30: 6669 6c74 6572 7265 7365 745f 6368 6174  filterreset_chat
-00043a40: 2873 656c 662c 2065 7665 6e74 293a 0d0a  (self, event):..
-00043a50: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
-00043a60: 2020 2020 2048 616e 646c 6572 2066 6f72       Handler for
-00043a70: 2063 6c69 636b 696e 6720 746f 2072 6573   clicking to res
-00043a80: 6574 2063 7572 7265 6e74 2063 6861 7420  et current chat 
-00043a90: 6869 7374 6f72 7920 6669 6c74 6572 2c20  history filter, 
-00043aa0: 7265 7374 6f72 6573 0d0a 2020 2020 2020  restores..      
-00043ab0: 2020 696e 6974 6961 6c20 7661 6c75 6573    initial values
-00043ac0: 2074 6f20 6669 6c74 6572 2063 6f6e 7472   to filter contr
-00043ad0: 6f6c 732c 2061 6e64 2072 6561 7070 6c69  ols, and reappli
-00043ae0: 6573 2074 6865 2066 696c 7465 722c 2073  es the filter, s
-00043af0: 6372 6f6c 6c69 6e67 0d0a 2020 2020 2020  crolling..      
-00043b00: 2020 746f 2074 6865 206d 6573 7361 6765    to the message
-00043b10: 2064 6973 706c 6179 6564 206c 6173 742c   displayed last,
-00043b20: 2069 6620 706f 7373 6962 6c65 2e0d 0a20   if possible... 
-00043b30: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
-00043b40: 2020 2020 7365 6c66 2e65 6469 745f 6669      self.edit_fi
-00043b50: 6c74 6572 7465 7874 2e56 616c 7565 203d  ltertext.Value =
-00043b60: 2022 220d 0a20 2020 2020 2020 2073 656c   ""..        sel
-00043b70: 662e 7261 6e67 655f 6461 7465 2e53 6574  f.range_date.Set
-00043b80: 5661 6c75 6573 282a 7365 6c66 2e63 6861  Values(*self.cha
-00043b90: 745f 6669 6c74 6572 5b22 7374 6172 7464  t_filter["startd
-00043ba0: 6174 6572 616e 6765 225d 290d 0a20 2020  aterange"])..   
-00043bb0: 2020 2020 2066 6f72 2069 2069 6e20 7261       for i in ra
-00043bc0: 6e67 6528 7365 6c66 2e6c 6973 745f 7061  nge(self.list_pa
-00043bd0: 7274 6963 6970 616e 7473 2e47 6574 4974  rticipants.GetIt
-00043be0: 656d 436f 756e 7428 2929 3a0d 0a20 2020  emCount()):..   
-00043bf0: 2020 2020 2020 2020 2063 203d 2073 656c           c = sel
-00043c00: 662e 6c69 7374 5f70 6172 7469 6369 7061  f.list_participa
-00043c10: 6e74 732e 4765 7449 7465 6d28 6929 0d0a  nts.GetItem(i)..
-00043c20: 2020 2020 2020 2020 2020 2020 632e 4368              c.Ch
-00043c30: 6563 6b28 5472 7565 290d 0a20 2020 2020  eck(True)..     
-00043c40: 2020 2020 2020 2073 656c 662e 6c69 7374         self.list
-00043c50: 5f70 6172 7469 6369 7061 6e74 732e 5365  _participants.Se
-00043c60: 7449 7465 6d28 6329 0d0a 2020 2020 2020  tItem(c)..      
-00043c70: 2020 7365 6c66 2e6c 6973 745f 7061 7274    self.list_part
-00043c80: 6963 6970 616e 7473 2e52 6566 7265 7368  icipants.Refresh
-00043c90: 2829 0d0a 0d0a 2020 2020 2020 2020 6e65  ()....        ne
-00043ca0: 775f 6669 6c74 6572 203d 2073 656c 662e  w_filter = self.
-00043cb0: 6275 696c 645f 6669 6c74 6572 2829 0d0a  build_filter()..
-00043cc0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00043cd0: 636d 705f 6669 6c74 6572 286e 6577 5f66  cmp_filter(new_f
-00043ce0: 696c 7465 7229 3a20 7265 7475 726e 2023  ilter): return #
-00043cf0: 2046 696c 7465 7220 756e 6368 616e 6765   Filter unchange
-00043d00: 640d 0a0d 0a20 2020 2020 2020 2066 6f63  d....        foc
-00043d10: 7573 5f6d 6573 7361 6765 5f69 642c 2073  us_message_id, s
-00043d20: 656c 6563 7465 6420 3d20 7365 6c66 2e73  elected = self.s
-00043d30: 7463 5f68 6973 746f 7279 2e47 6574 466f  tc_history.GetFo
-00043d40: 6375 7365 644d 6573 7361 6765 2829 0d0a  cusedMessage()..
-00043d50: 2020 2020 2020 2020 7365 6c66 2e6f 6e5f          self.on_
-00043d60: 6669 6c74 6572 5f63 6861 7428 6576 656e  filter_chat(even
-00043d70: 742c 206e 6577 5f66 696c 7465 7229 0d0a  t, new_filter)..
-00043d80: 2020 2020 2020 2020 6966 2066 6f63 7573          if focus
-00043d90: 5f6d 6573 7361 6765 5f69 6420 6973 206e  _message_id is n
-00043da0: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
-00043db0: 2020 2020 2020 7365 6c66 2e73 7463 5f68        self.stc_h
-00043dc0: 6973 746f 7279 2e46 6f63 7573 4d65 7373  istory.FocusMess
-00043dd0: 6167 6528 666f 6375 735f 6d65 7373 6167  age(focus_messag
-00043de0: 655f 6964 2c20 7365 6c65 6374 3d73 656c  e_id, select=sel
-00043df0: 6563 7465 6429 0d0a 0d0a 0d0a 2020 2020  ected)......    
-00043e00: 6465 6620 6f6e 5f66 696c 7465 725f 6368  def on_filter_ch
-00043e10: 6174 2873 656c 662c 2065 7665 6e74 2c20  at(self, event, 
-00043e20: 6e65 775f 6669 6c74 6572 3d4e 6f6e 6529  new_filter=None)
-00043e30: 3a0d 0a20 2020 2020 2020 2022 2222 0d0a  :..        """..
-00043e40: 2020 2020 2020 2020 4861 6e64 6c65 7220          Handler 
-00043e50: 666f 7220 636c 6963 6b69 6e67 2074 6f20  for clicking to 
-00043e60: 6669 6c74 6572 2063 7572 7265 6e74 2063  filter current c
-00043e70: 6861 7420 6869 7374 6f72 792c 2061 7070  hat history, app
-00043e80: 6c69 6573 2074 6865 0d0a 2020 2020 2020  lies the..      
-00043e90: 2020 6375 7272 656e 7420 6669 6c74 6572    current filter
-00043ea0: 2074 6f20 7468 6520 6368 6174 206d 6573   to the chat mes
-00043eb0: 7361 6765 732e 0d0a 2020 2020 2020 2020  sages...        
-00043ec0: 2222 220d 0a20 2020 2020 2020 2066 6f63  """..        foc
-00043ed0: 7573 5f6d 6573 7361 6765 5f69 6420 3d20  us_message_id = 
-00043ee0: 4e6f 6e65 0d0a 2020 2020 2020 2020 6966  None..        if
-00043ef0: 206e 6577 5f66 696c 7465 7220 6973 204e   new_filter is N
-00043f00: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
-00043f10: 2020 6e65 775f 6669 6c74 6572 203d 2073    new_filter = s
-00043f20: 656c 662e 6275 696c 645f 6669 6c74 6572  elf.build_filter
-00043f30: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
-00043f40: 6966 2073 656c 662e 636d 705f 6669 6c74  if self.cmp_filt
-00043f50: 6572 286e 6577 5f66 696c 7465 7229 3a20  er(new_filter): 
-00043f60: 7265 7475 726e 2023 2046 696c 7465 7220  return # Filter 
-00043f70: 756e 6368 616e 6765 640d 0a20 2020 2020  unchanged..     
-00043f80: 2020 2020 2020 2066 6f63 7573 5f6d 6573         focus_mes
-00043f90: 7361 6765 5f69 642c 205f 203d 2073 656c  sage_id, _ = sel
-00043fa0: 662e 7374 635f 6869 7374 6f72 792e 4765  f.stc_history.Ge
-00043fb0: 7446 6f63 7573 6564 4d65 7373 6167 6528  tFocusedMessage(
-00043fc0: 7365 6c65 6374 6564 6f6e 6c79 3d54 7275  selectedonly=Tru
-00043fd0: 6529 0d0a 2020 2020 2020 2020 6275 7379  e)..        busy
-00043fe0: 203d 2063 6f6e 7472 6f6c 732e 4275 7379   = controls.Busy
-00043ff0: 5061 6e65 6c28 7365 6c66 2c20 2246 696c  Panel(self, "Fil
-00044000: 7465 7269 6e67 206d 6573 7361 6765 732e  tering messages.
-00044010: 2229 0d0a 2020 2020 2020 2020 7472 793a  ")..        try:
-00044020: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00044030: 6c66 2e63 6861 745f 6669 6c74 6572 2e75  lf.chat_filter.u
-00044040: 7064 6174 6528 6e65 775f 6669 6c74 6572  pdate(new_filter
-00044050: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
-00044060: 656c 662e 7374 635f 6869 7374 6f72 792e  elf.stc_history.
-00044070: 5365 7446 696c 7465 7228 7365 6c66 2e63  SetFilter(self.c
-00044080: 6861 745f 6669 6c74 6572 290d 0a20 2020  hat_filter)..   
-00044090: 2020 2020 2020 2020 2073 656c 662e 7374           self.st
-000440a0: 635f 6869 7374 6f72 792e 5265 6672 6573  c_history.Refres
-000440b0: 684d 6573 7361 6765 7328 290d 0a20 2020  hMessages()..   
-000440c0: 2020 2020 2020 2020 2073 656c 662e 706f           self.po
-000440d0: 7075 6c61 7465 5f63 6861 745f 7374 6174  pulate_chat_stat
-000440e0: 6973 7469 6373 2829 0d0a 2020 2020 2020  istics()..      
-000440f0: 2020 2020 2020 7365 6c66 2e6c 6973 745f        self.list_
-00044100: 7469 6d65 6c69 6e65 2e50 6f70 756c 6174  timeline.Populat
-00044110: 6528 2a73 656c 662e 7374 635f 6869 7374  e(*self.stc_hist
-00044120: 6f72 792e 4765 7454 696d 656c 696e 6544  ory.GetTimelineD
-00044130: 6174 6128 2929 0d0a 2020 2020 2020 2020  ata())..        
-00044140: 6669 6e61 6c6c 793a 0d0a 2020 2020 2020  finally:..      
-00044150: 2020 2020 2020 6275 7379 2e43 6c6f 7365        busy.Close
-00044160: 2829 0d0a 2020 2020 2020 2020 7365 6c66  ()..        self
-00044170: 2e74 625f 6368 6174 2e45 6e61 626c 6554  .tb_chat.EnableT
-00044180: 6f6f 6c28 7778 2e49 445f 4d4f 5245 2c20  ool(wx.ID_MORE, 
-00044190: 7365 6c66 2e63 6861 745b 226d 6573 7361  self.chat["messa
-000441a0: 6765 5f63 6f75 6e74 225d 203e 2030 290d  ge_count"] > 0).
-000441b0: 0a20 2020 2020 2020 2069 6620 666f 6375  .        if focu
-000441c0: 735f 6d65 7373 6167 655f 6964 2069 7320  s_message_id is 
-000441d0: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
-000441e0: 2020 2020 2020 2073 656c 662e 7374 635f         self.stc_
-000441f0: 6869 7374 6f72 792e 466f 6375 734d 6573  history.FocusMes
-00044200: 7361 6765 2866 6f63 7573 5f6d 6573 7361  sage(focus_messa
-00044210: 6765 5f69 6429 0d0a 0d0a 0d0a 2020 2020  ge_id)......    
-00044220: 6465 6620 6275 696c 645f 6669 6c74 6572  def build_filter
-00044230: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
-00044240: 2022 2222 4275 696c 6473 2063 6861 7420   """Builds chat 
-00044250: 6669 6c74 6572 2064 6174 6120 6672 6f6d  filter data from
-00044260: 2063 7572 7265 6e74 2063 6f6e 7472 6f6c   current control
-00044270: 2073 7461 7465 2e22 2222 0d0a 2020 2020   state."""..    
-00044280: 2020 2020 2320 4174 206c 6561 7374 206f      # At least o
-00044290: 6e65 2070 6172 7469 6369 7061 6e74 206d  ne participant m
-000442a0: 7573 7420 6265 2073 656c 6563 7465 643a  ust be selected:
-000442b0: 2072 6573 6574 2074 6f20 7072 6576 696f   reset to previo
-000442c0: 7573 6c79 0d0a 2020 2020 2020 2020 2320  usly..        # 
-000442d0: 7365 6c65 6374 6564 2070 6172 7469 6369  selected partici
-000442e0: 7061 6e74 7320 696e 7374 6561 6420 6966  pants instead if
-000442f0: 206e 6f74 6869 6e67 2073 656c 6563 7465   nothing selecte
-00044300: 640d 0a20 2020 2020 2020 2072 6573 656c  d..        resel
-00044310: 6563 7465 6473 203d 205b 5d0d 0a20 2020  ecteds = []..   
-00044320: 2020 2020 2066 6f72 2069 2069 6e20 7261       for i in ra
-00044330: 6e67 6528 7365 6c66 2e6c 6973 745f 7061  nge(self.list_pa
-00044340: 7274 6963 6970 616e 7473 2e47 6574 4974  rticipants.GetIt
-00044350: 656d 436f 756e 7428 2929 3a0d 0a20 2020  emCount()):..   
-00044360: 2020 2020 2020 2020 2023 2055 6c74 696d           # Ultim
-00044370: 6174 654c 6973 7443 7472 6c20 646f 6573  ateListCtrl does
-00044380: 206e 6f74 2065 7870 6f73 6520 6368 6563   not expose chec
-00044390: 6b65 6420 7374 6174 652c 2068 6176 6520  ked state, have 
-000443a0: 746f 0d0a 2020 2020 2020 2020 2020 2020  to..            
-000443b0: 2320 7175 6572 7920 6974 2066 726f 6d20  # query it from 
-000443c0: 6561 6368 2069 6e64 6976 6964 7561 6c20  each individual 
-000443d0: 726f 770d 0a20 2020 2020 2020 2020 2020  row..           
-000443e0: 2069 6620 6e6f 7420 7365 6c66 2e6c 6973   if not self.lis
-000443f0: 745f 7061 7274 6963 6970 616e 7473 2e47  t_participants.G
-00044400: 6574 4974 656d 2869 292e 4973 4368 6563  etItem(i).IsChec
-00044410: 6b65 6428 293a 0d0a 2020 2020 2020 2020  ked():..        
-00044420: 2020 2020 2020 2020 6964 656e 7469 7479          identity
-00044430: 203d 2073 656c 662e 6c69 7374 5f70 6172   = self.list_par
-00044440: 7469 6369 7061 6e74 732e 4765 7449 7465  ticipants.GetIte
-00044450: 6d44 6174 6128 6929 5b22 6964 656e 7469  mData(i)["identi
-00044460: 7479 225d 0d0a 2020 2020 2020 2020 2020  ty"]..          
-00044470: 2020 2020 2020 6966 2069 6465 6e74 6974        if identit
-00044480: 7920 696e 2073 656c 662e 6368 6174 5f66  y in self.chat_f
-00044490: 696c 7465 725b 2270 6172 7469 6369 7061  ilter["participa
-000444a0: 6e74 7322 5d3a 0d0a 2020 2020 2020 2020  nts"]:..        
-000444b0: 2020 2020 2020 2020 2020 2020 7265 7365              rese
-000444c0: 6c65 6374 6564 732e 6170 7065 6e64 2869  lecteds.append(i
-000444d0: 290d 0a20 2020 2020 2020 2069 6620 7265  )..        if re
-000444e0: 7365 6c65 6374 6564 733a 0d0a 2020 2020  selecteds:..    
-000444f0: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
-00044500: 2072 616e 6765 2873 656c 662e 6c69 7374   range(self.list
-00044510: 5f70 6172 7469 6369 7061 6e74 732e 4765  _participants.Ge
-00044520: 7449 7465 6d43 6f75 6e74 2829 293a 0d0a  tItemCount()):..
-00044530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044540: 6964 656e 7469 7479 203d 2073 656c 662e  identity = self.
-00044550: 6c69 7374 5f70 6172 7469 6369 7061 6e74  list_participant
-00044560: 732e 4765 7449 7465 6d44 6174 6128 6929  s.GetItemData(i)
-00044570: 5b22 6964 656e 7469 7479 225d 0d0a 2020  ["identity"]..  
-00044580: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00044590: 2069 6465 6e74 6974 7920 696e 2072 6573   identity in res
-000445a0: 656c 6563 7465 6473 3a0d 0a20 2020 2020  electeds:..     
-000445b0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-000445c0: 203d 2073 656c 662e 6c69 7374 5f70 6172   = self.list_par
+00040dd0: 2067 7269 642e 4d61 6b65 4365 6c6c 5669   grid.MakeCellVi
+00040de0: 7369 626c 6528 692c 2030 290d 0a20 2020  sible(i, 0)..   
+00040df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040e00: 2020 2020 2020 2020 2067 7269 642e 5365           grid.Se
+00040e10: 6c65 6374 526f 7728 6929 0d0a 2020 2020  lectRow(i)..    
+00040e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040e30: 2020 2020 2020 2020 7061 6765 7369 7a65          pagesize
+00040e40: 203d 2067 7269 642e 4765 7453 6372 6f6c   = grid.GetScrol
+00040e50: 6c50 6167 6553 697a 6528 7778 2e56 4552  lPageSize(wx.VER
+00040e60: 5449 4341 4c29 0d0a 2020 2020 2020 2020  TICAL)..        
+00040e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040e80: 2020 2020 7078 6c73 203d 2067 7269 642e      pxls = grid.
+00040e90: 4765 7453 6372 6f6c 6c50 6978 656c 7350  GetScrollPixelsP
+00040ea0: 6572 556e 6974 2829 0d0a 2020 2020 2020  erUnit()..      
+00040eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040ec0: 2020 2020 2020 6365 6c6c 5f63 6f6f 7264        cell_coord
+00040ed0: 7320 3d20 6772 6964 2e43 656c 6c54 6f52  s = grid.CellToR
+00040ee0: 6563 7428 692c 2030 290d 0a20 2020 2020  ect(i, 0)..     
+00040ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040f00: 2020 2020 2020 2079 203d 2063 656c 6c5f         y = cell_
+00040f10: 636f 6f72 6473 2e79 202f 2f20 2870 786c  coords.y // (pxl
+00040f20: 735b 315d 206f 7220 3135 290d 0a20 2020  s[1] or 15)..   
+00040f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040f40: 2020 2020 2020 2020 2078 2c20 7920 3d20           x, y = 
+00040f50: 302c 2079 202d 2070 6167 6573 697a 6520  0, y - pagesize 
+00040f60: 2f2f 2032 0d0a 2020 2020 2020 2020 2020  // 2..          
+00040f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040f80: 2020 6772 6964 2e53 6372 6f6c 6c28 782c    grid.Scroll(x,
+00040f90: 2079 290d 0a20 2020 2020 2020 2020 2020   y)..           
+00040fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040fb0: 2062 7265 616b 2023 2066 6f72 2069 0d0a   break # for i..
+00040fc0: 2020 2020 2020 2020 656c 6966 2068 7265          elif hre
+00040fd0: 662e 7374 6172 7473 7769 7468 2822 7061  f.startswith("pa
+00040fe0: 6765 3a22 293a 0d0a 2020 2020 2020 2020  ge:"):..        
+00040ff0: 2020 2020 2320 476f 2074 6f20 6461 7461      # Go to data
+00041000: 6261 7365 2073 7562 7061 6765 0d0a 2020  base subpage..  
+00041010: 2020 2020 2020 2020 2020 7061 6765 203d            page =
+00041020: 2068 7265 665b 353a 5d0d 0a20 2020 2020   href[5:]..     
+00041030: 2020 2020 2020 2069 6620 2223 6865 6c70         if "#help
+00041040: 2220 3d3d 2070 6167 6520 5c0d 0a20 2020  " == page \..   
+00041050: 2020 2020 2020 2020 2061 6e64 2068 746d           and htm
+00041060: 6c77 696e 646f 7720 696e 2028 7365 6c66  lwindow in (self
+00041070: 2e68 746d 6c5f 7365 6172 6368 616c 6c2c  .html_searchall,
+00041080: 2073 656c 662e 6874 6d6c 5f73 6561 7263   self.html_searc
+00041090: 6861 6c6c 2e48 746d 6c57 696e 646f 772c  hall.HtmlWindow,
+000410a0: 2073 656c 662e 6c61 6265 6c5f 6874 6d6c   self.label_html
+000410b0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+000410c0: 2020 2020 6966 2073 656c 662e 6874 6d6c      if self.html
+000410d0: 5f73 6561 7263 6861 6c6c 2e47 6574 5461  _searchall.GetTa
+000410e0: 6244 6174 6142 7949 4428 3029 3a0d 0a20  bDataByID(0):.. 
+000410f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041100: 2020 2073 656c 662e 6874 6d6c 5f73 6561     self.html_sea
+00041110: 7263 6861 6c6c 2e53 6574 4163 7469 7665  rchall.SetActive
+00041120: 5461 6242 7949 4428 3029 0d0a 2020 2020  TabByID(0)..    
+00041130: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00041140: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00041150: 2020 2020 2020 2068 203d 2073 7465 702e         h = step.
+00041160: 5465 6d70 6c61 7465 2874 656d 706c 6174  Template(templat
+00041170: 6573 2e53 4541 5243 485f 4845 4c50 5f4c  es.SEARCH_HELP_L
+00041180: 4f4e 4729 2e65 7870 616e 6428 290d 0a20  ONG).expand().. 
+00041190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000411a0: 2020 2073 656c 662e 6874 6d6c 5f73 6561     self.html_sea
+000411b0: 7263 6861 6c6c 2e49 6e73 6572 7454 6162  rchall.InsertTab
+000411c0: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+000411d0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000411e0: 6874 6d6c 5f73 6561 7263 6861 6c6c 2e47  html_searchall.G
+000411f0: 6574 5461 6243 6f75 6e74 2829 2c20 2253  etTabCount(), "S
+00041200: 6561 7263 6820 6865 6c70 222c 2030 2c20  earch help", 0, 
+00041210: 682c 204e 6f6e 650d 0a20 2020 2020 2020  h, None..       
+00041220: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
+00041230: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+00041240: 2022 2373 6561 7263 6822 203d 3d20 7061   "#search" == pa
+00041250: 6765 3a0d 0a20 2020 2020 2020 2020 2020  ge:..           
+00041260: 2020 2020 2073 656c 662e 6564 6974 5f73       self.edit_s
+00041270: 6561 7263 6861 6c6c 2e53 6574 466f 6375  earchall.SetFocu
+00041280: 7328 290d 0a20 2020 2020 2020 2020 2020  s()..           
+00041290: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+000412a0: 2020 2020 2020 2020 7468 6570 6167 6520          thepage 
+000412b0: 3d20 6765 7461 7474 7228 7365 6c66 2c20  = getattr(self, 
+000412c0: 2270 6167 655f 2220 2b20 7061 6765 2c20  "page_" + page, 
+000412d0: 4e6f 6e65 290d 0a20 2020 2020 2020 2020  None)..         
+000412e0: 2020 2020 2020 2069 6620 7468 6570 6167         if thepag
+000412f0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00041300: 2020 2020 2020 2020 7365 6c66 2e6e 6f74          self.not
+00041310: 6562 6f6f 6b2e 5365 7453 656c 6563 7469  ebook.SetSelecti
+00041320: 6f6e 2873 656c 662e 7061 6765 6f72 6465  on(self.pageorde
+00041330: 725b 7468 6570 6167 655d 290d 0a20 2020  r[thepage])..   
+00041340: 2020 2020 2065 6c69 6620 6872 6566 2e73       elif href.s
+00041350: 7461 7274 7377 6974 6828 2263 6f6e 7461  tartswith("conta
+00041360: 6374 3a22 293a 0d0a 2020 2020 2020 2020  ct:"):..        
+00041370: 2020 2020 636f 6e74 6163 7469 6420 3d20      contactid = 
+00041380: 696e 7428 6872 6566 5b68 7265 662e 696e  int(href[href.in
+00041390: 6465 7828 223a 2229 202b 2031 3a5d 290d  dex(":") + 1:]).
+000413a0: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
+000413b0: 7461 6374 203d 206e 6578 7428 2878 2066  tact = next((x f
+000413c0: 6f72 2078 2069 6e20 5b73 656c 662e 6462  or x in [self.db
+000413d0: 2e61 6363 6f75 6e74 5d20 2b20 7365 6c66  .account] + self
+000413e0: 2e63 6f6e 7461 6374 7320 6966 2078 5b22  .contacts if x["
+000413f0: 6964 225d 203d 3d20 636f 6e74 6163 7469  id"] == contacti
+00041400: 6429 2c20 4e6f 6e65 290d 0a20 2020 2020  d), None)..     
+00041410: 2020 2020 2020 2069 6620 636f 6e74 6163         if contac
+00041420: 743a 0d0a 2020 2020 2020 2020 2020 2020  t:..            
+00041430: 2020 2020 7365 6c66 2e6e 6f74 6562 6f6f      self.noteboo
+00041440: 6b2e 5365 7453 656c 6563 7469 6f6e 2873  k.SetSelection(s
+00041450: 656c 662e 7061 6765 6f72 6465 725b 7365  elf.pageorder[se
+00041460: 6c66 2e70 6167 655f 636f 6e74 6163 7473  lf.page_contacts
+00041470: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
+00041480: 2020 2020 7365 6c66 2e6c 6f61 645f 636f      self.load_co
+00041490: 6e74 6163 7428 636f 6e74 6163 7429 0d0a  ntact(contact)..
+000414a0: 2020 2020 2020 2020 656c 6966 2068 7265          elif hre
+000414b0: 662e 7374 6172 7473 7769 7468 2822 2322  f.startswith("#"
+000414c0: 293a 2023 2049 6e2d 7061 6765 206c 696e  ): # In-page lin
+000414d0: 6b0d 0a20 2020 2020 2020 2020 2020 2065  k..            e
+000414e0: 7665 6e74 2e53 6b69 7028 290d 0a20 2020  vent.Skip()..   
+000414f0: 2020 2020 2065 6c69 6620 6e6f 7420 2868       elif not (h
+00041500: 7265 662e 7374 6172 7473 7769 7468 2822  ref.startswith("
+00041510: 6368 6174 3a22 2920 6f72 2068 7265 662e  chat:") or href.
+00041520: 7374 6172 7473 7769 7468 2822 6d65 7373  startswith("mess
+00041530: 6167 653a 2229 0d0a 2020 2020 2020 2020  age:")..        
+00041540: 6f72 2068 7265 662e 7374 6172 7473 7769  or href.startswi
+00041550: 7468 2822 6669 6c65 3a22 2929 3a0d 0a20  th("file:")):.. 
+00041560: 2020 2020 2020 2020 2020 2077 6562 6272             webbr
+00041570: 6f77 7365 722e 6f70 656e 2868 7265 6629  owser.open(href)
+00041580: 0d0a 0d0a 0d0a 2020 2020 6465 6620 6f6e  ......    def on
+00041590: 5f73 6561 7263 6861 6c6c 5f74 6f67 676c  _searchall_toggl
+000415a0: 655f 746f 6f6c 6261 7228 7365 6c66 2c20  e_toolbar(self, 
+000415b0: 6576 656e 7429 3a0d 0a20 2020 2020 2020  event):..       
+000415c0: 2022 2222 4861 6e64 6c65 7220 666f 7220   """Handler for 
+000415d0: 746f 6767 6c69 6e67 2061 2073 6574 7469  toggling a setti
+000415e0: 6e67 2069 6e20 7365 6172 6368 2074 6f6f  ng in search too
+000415f0: 6c62 6172 2e22 2222 0d0a 2020 2020 2020  lbar."""..      
+00041600: 2020 6966 2077 782e 4944 5f49 4e44 4558    if wx.ID_INDEX
+00041610: 203d 3d20 6576 656e 742e 4964 3a0d 0a20   == event.Id:.. 
+00041620: 2020 2020 2020 2020 2020 2063 6f6e 662e             conf.
+00041630: 5365 6172 6368 496e 4d65 7373 6167 6573  SearchInMessages
+00041640: 203d 2054 7275 650d 0a20 2020 2020 2020   = True..       
+00041650: 2020 2020 2063 6f6e 662e 5365 6172 6368       conf.Search
+00041660: 496e 5461 626c 6573 203d 2046 616c 7365  InTables = False
+00041670: 0d0a 2020 2020 2020 2020 2020 2020 636f  ..            co
+00041680: 6e66 2e53 6561 7263 6849 6e43 6861 7449  nf.SearchInChatI
+00041690: 6e66 6f20 3d20 636f 6e66 2e53 6561 7263  nfo = conf.Searc
+000416a0: 6849 6e43 6f6e 7461 6374 7320 3d20 4661  hInContacts = Fa
+000416b0: 6c73 650d 0a20 2020 2020 2020 2020 2020  lse..           
+000416c0: 2073 656c 662e 6c61 6265 6c5f 7365 6172   self.label_sear
+000416d0: 6368 2e4c 6162 656c 203d 2022 2653 6561  ch.Label = "&Sea
+000416e0: 7263 6820 696e 206d 6573 7361 6765 733a  rch in messages:
+000416f0: 220d 0a20 2020 2020 2020 2065 6c69 6620  "..        elif 
+00041700: 7778 2e49 445f 4142 4f55 5420 3d3d 2065  wx.ID_ABOUT == e
+00041710: 7665 6e74 2e49 643a 0d0a 2020 2020 2020  vent.Id:..      
+00041720: 2020 2020 2020 636f 6e66 2e53 6561 7263        conf.Searc
+00041730: 6849 6e43 6861 7449 6e66 6f20 3d20 5472  hInChatInfo = Tr
+00041740: 7565 0d0a 2020 2020 2020 2020 2020 2020  ue..            
+00041750: 636f 6e66 2e53 6561 7263 6849 6e54 6162  conf.SearchInTab
+00041760: 6c65 7320 3d20 4661 6c73 650d 0a20 2020  les = False..   
+00041770: 2020 2020 2020 2020 2063 6f6e 662e 5365           conf.Se
+00041780: 6172 6368 496e 4d65 7373 6167 6573 203d  archInMessages =
+00041790: 2063 6f6e 662e 5365 6172 6368 496e 436f   conf.SearchInCo
+000417a0: 6e74 6163 7473 203d 2046 616c 7365 0d0a  ntacts = False..
+000417b0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000417c0: 2e6c 6162 656c 5f73 6561 7263 682e 4c61  .label_search.La
+000417d0: 6265 6c20 3d20 2226 5365 6172 6368 2069  bel = "&Search i
+000417e0: 6e20 6368 6174 2069 6e66 6f3a 220d 0a20  n chat info:".. 
+000417f0: 2020 2020 2020 2065 6c69 6620 7778 2e49         elif wx.I
+00041800: 445f 5052 4556 4945 5720 3d3d 2065 7665  D_PREVIEW == eve
+00041810: 6e74 2e49 643a 0d0a 2020 2020 2020 2020  nt.Id:..        
+00041820: 2020 2020 636f 6e66 2e53 6561 7263 6849      conf.SearchI
+00041830: 6e43 6f6e 7461 6374 7320 3d20 5472 7565  nContacts = True
+00041840: 0d0a 2020 2020 2020 2020 2020 2020 636f  ..            co
+00041850: 6e66 2e53 6561 7263 6849 6e54 6162 6c65  nf.SearchInTable
+00041860: 7320 3d20 4661 6c73 650d 0a20 2020 2020  s = False..     
+00041870: 2020 2020 2020 2063 6f6e 662e 5365 6172         conf.Sear
+00041880: 6368 496e 4d65 7373 6167 6573 203d 2063  chInMessages = c
+00041890: 6f6e 662e 5365 6172 6368 496e 4368 6174  onf.SearchInChat
+000418a0: 496e 666f 203d 2046 616c 7365 0d0a 2020  Info = False..  
+000418b0: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
+000418c0: 6162 656c 5f73 6561 7263 682e 4c61 6265  abel_search.Labe
+000418d0: 6c20 3d20 2226 5365 6172 6368 2069 6e20  l = "&Search in 
+000418e0: 636f 6e74 6163 7473 3a22 0d0a 2020 2020  contacts:"..    
+000418f0: 2020 2020 656c 6966 2077 782e 4944 5f53      elif wx.ID_S
+00041900: 5441 5449 4320 3d3d 2065 7665 6e74 2e49  TATIC == event.I
+00041910: 643a 0d0a 2020 2020 2020 2020 2020 2020  d:..            
+00041920: 636f 6e66 2e53 6561 7263 6849 6e54 6162  conf.SearchInTab
+00041930: 6c65 7320 3d20 5472 7565 0d0a 2020 2020  les = True..    
+00041940: 2020 2020 2020 2020 636f 6e66 2e53 6561          conf.Sea
+00041950: 7263 6849 6e43 6f6e 7461 6374 7320 3d20  rchInContacts = 
+00041960: 4661 6c73 650d 0a20 2020 2020 2020 2020  False..         
+00041970: 2020 2063 6f6e 662e 5365 6172 6368 496e     conf.SearchIn
+00041980: 4d65 7373 6167 6573 203d 2063 6f6e 662e  Messages = conf.
+00041990: 5365 6172 6368 496e 4368 6174 496e 666f  SearchInChatInfo
+000419a0: 203d 2046 616c 7365 0d0a 2020 2020 2020   = False..      
+000419b0: 2020 2020 2020 7365 6c66 2e6c 6162 656c        self.label
+000419c0: 5f73 6561 7263 682e 4c61 6265 6c20 3d20  _search.Label = 
+000419d0: 2226 5365 6172 6368 2069 6e20 7461 626c  "&Search in tabl
+000419e0: 6573 3a22 0d0a 2020 2020 2020 2020 7365  es:"..        se
+000419f0: 6c66 2e6c 6162 656c 5f73 6561 7263 682e  lf.label_search.
+00041a00: 436f 6e74 6169 6e69 6e67 5369 7a65 722e  ContainingSizer.
+00041a10: 4c61 796f 7574 2829 0d0a 2020 2020 2020  Layout()..      
+00041a20: 2020 6966 2077 782e 4944 5f4e 4557 203d    if wx.ID_NEW =
+00041a30: 3d20 6576 656e 742e 4964 3a0d 0a20 2020  = event.Id:..   
+00041a40: 2020 2020 2020 2020 2063 6f6e 662e 5365           conf.Se
+00041a50: 6172 6368 5573 654e 6577 5461 6220 3d20  archUseNewTab = 
+00041a60: 6576 656e 742e 4576 656e 744f 626a 6563  event.EventObjec
+00041a70: 742e 4765 7454 6f6f 6c53 7461 7465 2865  t.GetToolState(e
+00041a80: 7665 6e74 2e49 6429 0d0a 2020 2020 2020  vent.Id)..      
+00041a90: 2020 656c 6966 206e 6f74 2065 7665 6e74    elif not event
+00041aa0: 2e45 7665 6e74 4f62 6a65 6374 2e47 6574  .EventObject.Get
+00041ab0: 546f 6f6c 5374 6174 6528 6576 656e 742e  ToolState(event.
+00041ac0: 4964 293a 0d0a 2020 2020 2020 2020 2020  Id):..          
+00041ad0: 2020 2320 416c 6c20 6f74 6865 7273 2061    # All others a
+00041ae0: 7265 2072 6164 696f 2074 6f6f 6c73 2061  re radio tools a
+00041af0: 6e64 2073 7461 7465 206d 6967 6874 2062  nd state might b
+00041b00: 6520 746f 6767 6c65 6420 6f66 6620 6279  e toggled off by
+00041b10: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00041b20: 7368 6f72 746b 6579 206b 6579 2061 6461  shortkey key ada
+00041b30: 7074 6572 0d0a 2020 2020 2020 2020 2020  pter..          
+00041b40: 2020 6576 656e 742e 4576 656e 744f 626a    event.EventObj
+00041b50: 6563 742e 546f 6767 6c65 546f 6f6c 2865  ect.ToggleTool(e
+00041b60: 7665 6e74 2e49 642c 2054 7275 6529 0d0a  vent.Id, True)..
+00041b70: 0d0a 0d0a 2020 2020 6465 6620 6f6e 5f73  ....    def on_s
+00041b80: 6561 7263 6861 6c6c 5f73 746f 7028 7365  earchall_stop(se
+00041b90: 6c66 2c20 6576 656e 7429 3a0d 0a20 2020  lf, event):..   
+00041ba0: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
+00041bb0: 2020 4861 6e64 6c65 7220 666f 7220 636c    Handler for cl
+00041bc0: 6963 6b69 6e67 2074 6f20 7374 6f70 2061  icking to stop a
+00041bd0: 2073 6561 7263 682c 2073 6967 6e61 6c73   search, signals
+00041be0: 2074 6865 2073 6561 7263 6820 7468 7265   the search thre
+00041bf0: 6164 2074 6f0d 0a20 2020 2020 2020 2063  ad to..        c
+00041c00: 6c6f 7365 2e0d 0a20 2020 2020 2020 2022  lose...        "
+00041c10: 2222 0d0a 2020 2020 2020 2020 7461 625f  ""..        tab_
+00041c20: 6461 7461 203d 2073 656c 662e 6874 6d6c  data = self.html
+00041c30: 5f73 6561 7263 6861 6c6c 2e47 6574 4163  _searchall.GetAc
+00041c40: 7469 7665 5461 6244 6174 6128 290d 0a20  tiveTabData().. 
+00041c50: 2020 2020 2020 2069 6620 7461 625f 6461         if tab_da
+00041c60: 7461 2061 6e64 2074 6162 5f64 6174 615b  ta and tab_data[
+00041c70: 2269 6422 5d20 696e 2073 656c 662e 776f  "id"] in self.wo
+00041c80: 726b 6572 735f 7365 6172 6368 3a0d 0a20  rkers_search:.. 
+00041c90: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00041ca0: 7462 5f73 6561 7263 685f 7365 7474 696e  tb_search_settin
+00041cb0: 6773 2e53 6574 546f 6f6c 4e6f 726d 616c  gs.SetToolNormal
+00041cc0: 4269 746d 6170 280d 0a20 2020 2020 2020  Bitmap(..       
+00041cd0: 2020 2020 2020 2020 2077 782e 4944 5f53           wx.ID_S
+00041ce0: 544f 502c 2069 6d61 6765 732e 546f 6f6c  TOP, images.Tool
+00041cf0: 6261 7253 746f 7070 6564 2e42 6974 6d61  barStopped.Bitma
+00041d00: 7029 0d0a 2020 2020 2020 2020 2020 2020  p)..            
+00041d10: 7365 6c66 2e77 6f72 6b65 7273 5f73 6561  self.workers_sea
+00041d20: 7263 685b 7461 625f 6461 7461 5b22 6964  rch[tab_data["id
+00041d30: 225d 5d2e 7374 6f70 2829 0d0a 2020 2020  "]].stop()..    
+00041d40: 2020 2020 2020 2020 6465 6c20 7365 6c66          del self
+00041d50: 2e77 6f72 6b65 7273 5f73 6561 7263 685b  .workers_search[
+00041d60: 7461 625f 6461 7461 5b22 6964 225d 5d0d  tab_data["id"]].
+00041d70: 0a0d 0a0d 0a20 2020 2064 6566 206f 6e5f  .....    def on_
+00041d80: 6368 616e 6765 5f73 6561 7263 6861 6c6c  change_searchall
+00041d90: 5f74 6162 2873 656c 662c 2065 7665 6e74  _tab(self, event
+00041da0: 293a 0d0a 2020 2020 2020 2020 2222 2248  ):..        """H
+00041db0: 616e 646c 6572 2066 6f72 2063 6861 6e67  andler for chang
+00041dc0: 696e 6720 6120 7461 6220 696e 2073 6561  ing a tab in sea
+00041dd0: 7263 6820 7769 6e64 6f77 2c20 7570 6461  rch window, upda
+00041de0: 7465 7320 7374 6f70 2062 7574 746f 6e2e  tes stop button.
+00041df0: 2222 220d 0a20 2020 2020 2020 2074 6162  """..        tab
+00041e00: 5f64 6174 6120 3d20 7365 6c66 2e68 746d  _data = self.htm
+00041e10: 6c5f 7365 6172 6368 616c 6c2e 4765 7441  l_searchall.GetA
+00041e20: 6374 6976 6554 6162 4461 7461 2829 0d0a  ctiveTabData()..
+00041e30: 2020 2020 2020 2020 6966 2074 6162 5f64          if tab_d
+00041e40: 6174 6120 616e 6420 7461 625f 6461 7461  ata and tab_data
+00041e50: 5b22 6964 225d 2069 6e20 7365 6c66 2e77  ["id"] in self.w
+00041e60: 6f72 6b65 7273 5f73 6561 7263 683a 0d0a  orkers_search:..
+00041e70: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00041e80: 2e74 625f 7365 6172 6368 5f73 6574 7469  .tb_search_setti
+00041e90: 6e67 732e 5365 7454 6f6f 6c4e 6f72 6d61  ngs.SetToolNorma
+00041ea0: 6c42 6974 6d61 7028 0d0a 2020 2020 2020  lBitmap(..      
+00041eb0: 2020 2020 2020 2020 2020 7778 2e49 445f            wx.ID_
+00041ec0: 5354 4f50 2c20 696d 6167 6573 2e54 6f6f  STOP, images.Too
+00041ed0: 6c62 6172 5374 6f70 2e42 6974 6d61 7029  lbarStop.Bitmap)
+00041ee0: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
+00041ef0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00041f00: 662e 7462 5f73 6561 7263 685f 7365 7474  f.tb_search_sett
+00041f10: 696e 6773 2e53 6574 546f 6f6c 4e6f 726d  ings.SetToolNorm
+00041f20: 616c 4269 746d 6170 280d 0a20 2020 2020  alBitmap(..     
+00041f30: 2020 2020 2020 2020 2020 2077 782e 4944             wx.ID
+00041f40: 5f53 544f 502c 2069 6d61 6765 732e 546f  _STOP, images.To
+00041f50: 6f6c 6261 7253 746f 7070 6564 2e42 6974  olbarStopped.Bit
+00041f60: 6d61 7029 0d0a 0d0a 0d0a 2020 2020 6465  map)......    de
+00041f70: 6620 6f6e 5f64 636c 6963 6b5f 7365 6172  f on_dclick_sear
+00041f80: 6368 616c 6c5f 7461 6228 7365 6c66 2c20  chall_tab(self, 
+00041f90: 6576 656e 7429 3a0d 0a20 2020 2020 2020  event):..       
+00041fa0: 2022 2222 0d0a 2020 2020 2020 2020 4861   """..        Ha
+00041fb0: 6e64 6c65 7220 666f 7220 646f 7562 6c65  ndler for double
+00041fc0: 2d63 6c69 636b 696e 6720 6120 7365 6172  -clicking a sear
+00041fd0: 6368 2074 6162 2068 6561 6465 722c 2073  ch tab header, s
+00041fe0: 6574 7320 7468 6520 7365 6172 6368 2062  ets the search b
+00041ff0: 6f78 0d0a 2020 2020 2020 2020 7661 6c75  ox..        valu
+00042000: 6520 746f 2074 6162 2074 6578 742e 0d0a  e to tab text...
+00042010: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
+00042020: 2020 2020 2074 6578 7420 3d20 6576 656e       text = even
+00042030: 742e 4461 7461 2e67 6574 2822 696e 666f  t.Data.get("info
+00042040: 222c 207b 7d29 2e67 6574 2822 7465 7874  ", {}).get("text
+00042050: 2229 0d0a 2020 2020 2020 2020 6966 2074  ")..        if t
+00042060: 6578 743a 0d0a 2020 2020 2020 2020 2020  ext:..          
+00042070: 2020 7365 6c66 2e65 6469 745f 7365 6172    self.edit_sear
+00042080: 6368 616c 6c2e 5661 6c75 6520 3d20 7465  chall.Value = te
+00042090: 7874 0d0a 2020 2020 2020 2020 2020 2020  xt..            
+000420a0: 7365 6c66 2e65 6469 745f 7365 6172 6368  self.edit_search
+000420b0: 616c 6c2e 5365 7446 6f63 7573 2829 0d0a  all.SetFocus()..
+000420c0: 0d0a 0d0a 2020 2020 6465 6620 6f6e 5f73  ....    def on_s
+000420d0: 6561 7263 6861 6c6c 5f72 6573 756c 7428  earchall_result(
+000420e0: 7365 6c66 2c20 6576 656e 7429 3a0d 0a20  self, event):.. 
+000420f0: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
+00042100: 2020 2020 4861 6e64 6c65 7220 666f 7220      Handler for 
+00042110: 6765 7474 696e 6720 7265 7375 6c74 7320  getting results 
+00042120: 6672 6f6d 2073 6561 7263 6820 7468 7265  from search thre
+00042130: 6164 2c20 6164 6473 2074 6865 2072 6573  ad, adds the res
+00042140: 756c 7473 2074 6f0d 0a20 2020 2020 2020  ults to..       
+00042150: 2074 6865 2073 6561 7263 6820 7769 6e64   the search wind
+00042160: 6f77 2e0d 0a20 2020 2020 2020 2022 2222  ow...        """
+00042170: 0d0a 2020 2020 2020 2020 7265 7375 6c74  ..        result
+00042180: 203d 2065 7665 6e74 2e72 6573 756c 740d   = event.result.
+00042190: 0a20 2020 2020 2020 2073 6561 7263 685f  .        search_
+000421a0: 6964 2c20 7365 6172 6368 5f64 6f6e 6520  id, search_done 
+000421b0: 3d20 7265 7375 6c74 2e67 6574 2822 7365  = result.get("se
+000421c0: 6172 6368 222c 207b 7d29 2e67 6574 2822  arch", {}).get("
+000421d0: 6964 2229 2c20 4661 6c73 650d 0a20 2020  id"), False..   
+000421e0: 2020 2020 2074 6162 5f64 6174 6120 3d20       tab_data = 
+000421f0: 7365 6c66 2e68 746d 6c5f 7365 6172 6368  self.html_search
+00042200: 616c 6c2e 4765 7454 6162 4461 7461 4279  all.GetTabDataBy
+00042210: 4944 2873 6561 7263 685f 6964 290d 0a20  ID(search_id).. 
+00042220: 2020 2020 2020 2069 6620 7461 625f 6461         if tab_da
+00042230: 7461 3a0d 0a20 2020 2020 2020 2020 2020  ta:..           
+00042240: 2074 6162 5f64 6174 615b 2269 6e66 6f22   tab_data["info"
+00042250: 5d5b 226d 6170 225d 2e75 7064 6174 6528  ]["map"].update(
+00042260: 7265 7375 6c74 2e67 6574 2822 6d61 7022  result.get("map"
+00042270: 2c20 7b7d 2929 0d0a 2020 2020 2020 2020  , {}))..        
+00042280: 2020 2020 7461 625f 6461 7461 5b22 696e      tab_data["in
+00042290: 666f 225d 5b22 7061 7274 6961 6c5f 6874  fo"]["partial_ht
+000422a0: 6d6c 225d 202b 3d20 7265 7375 6c74 2e67  ml"] += result.g
+000422b0: 6574 2822 6f75 7470 7574 222c 2022 2229  et("output", "")
+000422c0: 0d0a 2020 2020 2020 2020 2020 2020 6874  ..            ht
+000422d0: 6d6c 203d 2074 6162 5f64 6174 615b 2269  ml = tab_data["i
+000422e0: 6e66 6f22 5d5b 2270 6172 7469 616c 5f68  nfo"]["partial_h
+000422f0: 746d 6c22 5d0d 0a20 2020 2020 2020 2020  tml"]..         
+00042300: 2020 2069 6620 2264 6f6e 6522 2069 6e20     if "done" in 
+00042310: 7265 7375 6c74 3a0d 0a20 2020 2020 2020  result:..       
+00042320: 2020 2020 2020 2020 2073 6561 7263 685f           search_
+00042330: 646f 6e65 203d 2054 7275 650d 0a20 2020  done = True..   
+00042340: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
+00042350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042360: 6874 6d6c 202b 3d20 223c 2f74 6162 6c65  html += "</table
+00042370: 3e3c 2f66 6f6e 743e 220d 0a20 2020 2020  ></font>"..     
+00042380: 2020 2020 2020 2074 6578 7420 3d20 7461         text = ta
+00042390: 625f 6461 7461 5b22 696e 666f 225d 5b22  b_data["info"]["
+000423a0: 7465 7874 225d 0d0a 2020 2020 2020 2020  text"]..        
+000423b0: 2020 2020 7469 746c 6520 3d20 7465 7874      title = text
+000423c0: 5b3a 3530 5d20 2b20 222e 2e22 2069 6620  [:50] + ".." if 
+000423d0: 6c65 6e28 7465 7874 2920 3e20 3530 2065  len(text) > 50 e
+000423e0: 6c73 6520 7465 7874 0d0a 2020 2020 2020  lse text..      
+000423f0: 2020 2020 2020 7469 746c 6520 2b3d 2022        title += "
+00042400: 2028 2573 2922 2025 2072 6573 756c 742e   (%s)" % result.
+00042410: 6765 7428 2263 6f75 6e74 222c 2030 290d  get("count", 0).
+00042420: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00042430: 662e 6874 6d6c 5f73 6561 7263 6861 6c6c  f.html_searchall
+00042440: 2e53 6574 5461 6244 6174 6142 7949 4428  .SetTabDataByID(
+00042450: 7365 6172 6368 5f69 642c 2074 6974 6c65  search_id, title
+00042460: 2c20 6874 6d6c 2c0d 0a20 2020 2020 2020  , html,..       
+00042470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042490: 2020 2020 2020 2020 7461 625f 6461 7461          tab_data
+000424a0: 5b22 696e 666f 225d 290d 0a20 2020 2020  ["info"])..     
+000424b0: 2020 2069 6620 7365 6172 6368 5f64 6f6e     if search_don
+000424c0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+000424d0: 6775 6962 6173 652e 7374 6174 7573 2822  guibase.status("
+000424e0: 4669 6e69 7368 6564 2073 6561 7263 6869  Finished searchi
+000424f0: 6e67 2066 6f72 205c 2225 735c 2220 696e  ng for \"%s\" in
+00042500: 2025 732e 222c 0d0a 2020 2020 2020 2020   %s.",..        
+00042510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042520: 2020 2072 6573 756c 745b 2273 6561 7263     result["searc
+00042530: 6822 5d5b 2274 6578 7422 5d2c 2073 656c  h"]["text"], sel
+00042540: 662e 6462 2e66 696c 656e 616d 6529 0d0a  f.db.filename)..
+00042550: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00042560: 2e74 625f 7365 6172 6368 5f73 6574 7469  .tb_search_setti
+00042570: 6e67 732e 5365 7454 6f6f 6c4e 6f72 6d61  ngs.SetToolNorma
+00042580: 6c42 6974 6d61 7028 0d0a 2020 2020 2020  lBitmap(..      
+00042590: 2020 2020 2020 2020 2020 7778 2e49 445f            wx.ID_
+000425a0: 5354 4f50 2c20 696d 6167 6573 2e54 6f6f  STOP, images.Too
+000425b0: 6c62 6172 5374 6f70 7065 642e 4269 746d  lbarStopped.Bitm
+000425c0: 6170 290d 0a20 2020 2020 2020 2020 2020  ap)..           
+000425d0: 2069 6620 7365 6172 6368 5f69 6420 696e   if search_id in
+000425e0: 2073 656c 662e 776f 726b 6572 735f 7365   self.workers_se
+000425f0: 6172 6368 3a0d 0a20 2020 2020 2020 2020  arch:..         
+00042600: 2020 2020 2020 2073 656c 662e 776f 726b         self.work
+00042610: 6572 735f 7365 6172 6368 5b73 6561 7263  ers_search[searc
+00042620: 685f 6964 5d2e 7374 6f70 2829 0d0a 2020  h_id].stop()..  
+00042630: 2020 2020 2020 2020 2020 2020 2020 6465                de
+00042640: 6c20 7365 6c66 2e77 6f72 6b65 7273 5f73  l self.workers_s
+00042650: 6561 7263 685b 7365 6172 6368 5f69 645d  earch[search_id]
+00042660: 0d0a 2020 2020 2020 2020 6966 2022 6572  ..        if "er
+00042670: 726f 7222 2069 6e20 7265 7375 6c74 3a0d  ror" in result:.
+00042680: 0a20 2020 2020 2020 2020 2020 206c 6f67  .            log
+00042690: 6765 722e 6572 726f 7228 2245 7272 6f72  ger.error("Error
+000426a0: 2073 6561 7263 6869 6e67 2025 733a 5c6e   searching %s:\n
+000426b0: 5c6e 2573 222c 2073 656c 662e 6462 2c20  \n%s", self.db, 
+000426c0: 7265 7375 6c74 5b22 6572 726f 7222 5d29  result["error"])
+000426d0: 0d0a 2020 2020 2020 2020 2020 2020 6572  ..            er
+000426e0: 726f 726d 7367 203d 2022 4572 726f 7220  rormsg = "Error 
+000426f0: 7365 6172 6368 696e 6720 2573 3a5c 6e5c  searching %s:\n\
+00042700: 6e25 7322 2025 205c 0d0a 2020 2020 2020  n%s" % \..      
+00042710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042720: 2028 7365 6c66 2e64 622c 2072 6573 756c   (self.db, resul
+00042730: 742e 6765 7428 2265 7272 6f72 5f73 686f  t.get("error_sho
+00042740: 7274 222c 2072 6573 756c 745b 2265 7272  rt", result["err
+00042750: 6f72 225d 2929 0d0a 2020 2020 2020 2020  or"]))..        
+00042760: 2020 2020 7778 2e4d 6573 7361 6765 426f      wx.MessageBo
+00042770: 7828 6572 726f 726d 7367 2c20 636f 6e66  x(errormsg, conf
+00042780: 2e54 6974 6c65 2c20 7778 2e4f 4b20 7c20  .Title, wx.OK | 
+00042790: 7778 2e49 434f 4e5f 5741 524e 494e 4729  wx.ICON_WARNING)
+000427a0: 0d0a 0d0a 0d0a 2020 2020 6465 6620 6f6e  ......    def on
+000427b0: 5f73 6561 7263 6861 6c6c 5f63 616c 6c62  _searchall_callb
+000427c0: 6163 6b28 7365 6c66 2c20 7265 7375 6c74  ack(self, result
+000427d0: 293a 0d0a 2020 2020 2020 2020 2222 2243  ):..        """C
+000427e0: 616c 6c62 6163 6b20 6675 6e63 7469 6f6e  allback function
+000427f0: 2066 6f72 2053 6561 7263 6854 6872 6561   for SearchThrea
+00042800: 642c 2070 6f73 7473 2074 6865 2064 6174  d, posts the dat
+00042810: 6120 746f 2073 656c 662e 2222 220d 0a20  a to self.""".. 
+00042820: 2020 2020 2020 2069 6620 7365 6c66 3a20         if self: 
+00042830: 2320 4368 6563 6b20 6966 2069 6e73 7461  # Check if insta
+00042840: 6e63 6520 6973 2073 7469 6c6c 2076 616c  nce is still val
+00042850: 6964 2028 692e 652e 206e 6f74 2064 6573  id (i.e. not des
+00042860: 7472 6f79 6564 2062 7920 7778 290d 0a20  troyed by wx).. 
+00042870: 2020 2020 2020 2020 2020 2077 782e 506f             wx.Po
+00042880: 7374 4576 656e 7428 7365 6c66 2c20 576f  stEvent(self, Wo
+00042890: 726b 6572 4576 656e 7428 7265 7375 6c74  rkerEvent(result
+000428a0: 3d72 6573 756c 7429 290d 0a0d 0a0d 0a20  =result))...... 
+000428b0: 2020 2064 6566 206f 6e5f 7365 6172 6368     def on_search
+000428c0: 616c 6c28 7365 6c66 2c20 6576 656e 7429  all(self, event)
+000428d0: 3a0d 0a20 2020 2020 2020 2022 2222 0d0a  :..        """..
+000428e0: 2020 2020 2020 2020 4861 6e64 6c65 7220          Handler 
+000428f0: 666f 7220 636c 6963 6b69 6e67 2074 6f20  for clicking to 
+00042900: 676c 6f62 616c 2073 6561 7263 6820 7468  global search th
+00042910: 6520 6461 7461 6261 7365 2e0d 0a20 2020  e database...   
+00042920: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
+00042930: 2020 7465 7874 203d 2073 656c 662e 6564    text = self.ed
+00042940: 6974 5f73 6561 7263 6861 6c6c 2e56 616c  it_searchall.Val
+00042950: 7565 0d0a 2020 2020 2020 2020 6966 2074  ue..        if t
+00042960: 6578 742e 7374 7269 7028 293a 0d0a 2020  ext.strip():..  
+00042970: 2020 2020 2020 2020 2020 6775 6962 6173            guibas
+00042980: 652e 7374 6174 7573 2822 5365 6172 6368  e.status("Search
+00042990: 696e 6720 666f 7220 5c22 2573 5c22 2069  ing for \"%s\" i
+000429a0: 6e20 2573 2e22 2c20 7465 7874 2c20 7365  n %s.", text, se
+000429b0: 6c66 2e64 622e 6669 6c65 6e61 6d65 290d  lf.db.filename).
+000429c0: 0a20 2020 2020 2020 2020 2020 2068 746d  .            htm
+000429d0: 6c20 3d20 7365 6c66 2e68 746d 6c5f 7365  l = self.html_se
+000429e0: 6172 6368 616c 6c0d 0a20 2020 2020 2020  archall..       
+000429f0: 2020 2020 2064 6174 6120 3d20 7b22 6964       data = {"id
+00042a00: 223a 2073 656c 662e 636f 756e 7465 7228  ": self.counter(
+00042a10: 292c 2022 6462 223a 2073 656c 662e 6462  ), "db": self.db
+00042a20: 2c20 2274 6578 7422 3a20 7465 7874 2c20  , "text": text, 
+00042a30: 226d 6170 223a 207b 7d2c 0d0a 2020 2020  "map": {},..    
+00042a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042a50: 2277 6964 7468 223a 2068 746d 6c2e 5369  "width": html.Si
+00042a60: 7a65 2e77 6964 7468 202a 2035 202f 2f20  ze.width * 5 // 
+00042a70: 392c 2022 7461 626c 6522 3a20 2222 2c0d  9, "table": "",.
+00042a80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00042a90: 2020 2020 2022 7061 7274 6961 6c5f 6874       "partial_ht
+00042aa0: 6d6c 223a 2022 227d 0d0a 2020 2020 2020  ml": ""}..      
+00042ab0: 2020 2020 2020 6672 6f6d 7465 7874 203d        fromtext =
+00042ac0: 2022 2220 2320 2253 6561 7263 6869 6e67   "" # "Searching
+00042ad0: 2066 6f72 2022 7465 7874 2220 696e 2066   for "text" in f
+00042ae0: 726f 6d74 6578 7422 0d0a 2020 2020 2020  romtext"..      
+00042af0: 2020 2020 2020 6966 2063 6f6e 662e 5365        if conf.Se
+00042b00: 6172 6368 496e 4d65 7373 6167 6573 3a0d  archInMessages:.
+00042b10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00042b20: 2064 6174 615b 2274 6162 6c65 225d 203d   data["table"] =
+00042b30: 2022 6d65 7373 6167 6573 220d 0a20 2020   "messages"..   
+00042b40: 2020 2020 2020 2020 2020 2020 2066 726f               fro
+00042b50: 6d74 6578 7420 3d20 226d 6573 7361 6765  mtext = "message
+00042b60: 7322 0d0a 2020 2020 2020 2020 2020 2020  s"..            
+00042b70: 656c 6966 2063 6f6e 662e 5365 6172 6368  elif conf.Search
+00042b80: 496e 4368 6174 496e 666f 3a0d 0a20 2020  InChatInfo:..   
+00042b90: 2020 2020 2020 2020 2020 2020 2064 6174               dat
+00042ba0: 615b 2274 6162 6c65 225d 203d 2022 636f  a["table"] = "co
+00042bb0: 6e76 6572 7361 7469 6f6e 7322 0d0a 2020  nversations"..  
+00042bc0: 2020 2020 2020 2020 2020 2020 2020 6672                fr
+00042bd0: 6f6d 7465 7874 203d 2022 6368 6174 2069  omtext = "chat i
+00042be0: 6e66 6f72 6d61 7469 6f6e 220d 0a20 2020  nformation"..   
+00042bf0: 2020 2020 2020 2020 2065 6c69 6620 636f           elif co
+00042c00: 6e66 2e53 6561 7263 6849 6e43 6f6e 7461  nf.SearchInConta
+00042c10: 6374 733a 0d0a 2020 2020 2020 2020 2020  cts:..          
+00042c20: 2020 2020 2020 6461 7461 5b22 7461 626c        data["tabl
+00042c30: 6522 5d20 3d20 2263 6f6e 7461 6374 7322  e"] = "contacts"
+00042c40: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00042c50: 2020 6672 6f6d 7465 7874 203d 2022 636f    fromtext = "co
+00042c60: 6e74 6163 7420 696e 666f 726d 6174 696f  ntact informatio
+00042c70: 6e22 0d0a 2020 2020 2020 2020 2020 2020  n"..            
+00042c80: 656c 6966 2063 6f6e 662e 5365 6172 6368  elif conf.Search
+00042c90: 496e 5461 626c 6573 3a0d 0a20 2020 2020  InTables:..     
+00042ca0: 2020 2020 2020 2020 2020 2066 726f 6d74             fromt
+00042cb0: 6578 7420 3d20 6461 7461 5b22 7461 626c  ext = data["tabl
+00042cc0: 6522 5d20 3d20 2261 6c6c 2074 6162 6c65  e"] = "all table
+00042cd0: 7322 0d0a 2020 2020 2020 2020 2020 2020  s"..            
+00042ce0: 2320 5061 7274 6961 6c6c 7920 6173 7365  # Partially asse
+00042cf0: 6d62 6c65 6420 4854 4d4c 2066 6f72 2063  mbled HTML for c
+00042d00: 7572 7265 6e74 2072 6573 756c 7473 0d0a  urrent results..
+00042d10: 2020 2020 2020 2020 2020 2020 7465 6d70              temp
+00042d20: 6c61 7465 203d 2073 7465 702e 5465 6d70  late = step.Temp
+00042d30: 6c61 7465 2874 656d 706c 6174 6573 2e53  late(templates.S
+00042d40: 4541 5243 485f 4845 4144 4552 5f48 544d  EARCH_HEADER_HTM
+00042d50: 4c2c 2065 7363 6170 653d 5472 7565 290d  L, escape=True).
+00042d60: 0a20 2020 2020 2020 2020 2020 2064 6174  .            dat
+00042d70: 615b 2270 6172 7469 616c 5f68 746d 6c22  a["partial_html"
+00042d80: 5d20 3d20 7465 6d70 6c61 7465 2e65 7870  ] = template.exp
+00042d90: 616e 6428 6c6f 6361 6c73 2829 290d 0a0d  and(locals())...
+00042da0: 0a20 2020 2020 2020 2020 2020 2077 6f72  .            wor
+00042db0: 6b65 7220 3d20 776f 726b 6572 732e 5365  ker = workers.Se
+00042dc0: 6172 6368 5468 7265 6164 2873 656c 662e  archThread(self.
+00042dd0: 6f6e 5f73 6561 7263 6861 6c6c 5f63 616c  on_searchall_cal
+00042de0: 6c62 6163 6b29 0d0a 2020 2020 2020 2020  lback)..        
+00042df0: 2020 2020 7365 6c66 2e77 6f72 6b65 7273      self.workers
+00042e00: 5f73 6561 7263 685b 6461 7461 5b22 6964  _search[data["id
+00042e10: 225d 5d20 3d20 776f 726b 6572 0d0a 2020  "]] = worker..  
+00042e20: 2020 2020 2020 2020 2020 776f 726b 6572            worker
+00042e30: 2e77 6f72 6b28 6461 7461 290d 0a20 2020  .work(data)..   
+00042e40: 2020 2020 2020 2020 2062 6d70 203d 2069           bmp = i
+00042e50: 6d61 6765 732e 546f 6f6c 6261 7253 746f  mages.ToolbarSto
+00042e60: 702e 4269 746d 6170 0d0a 2020 2020 2020  p.Bitmap..      
+00042e70: 2020 2020 2020 7365 6c66 2e74 625f 7365        self.tb_se
+00042e80: 6172 6368 5f73 6574 7469 6e67 732e 5365  arch_settings.Se
+00042e90: 7454 6f6f 6c4e 6f72 6d61 6c42 6974 6d61  tToolNormalBitma
+00042ea0: 7028 7778 2e49 445f 5354 4f50 2c20 626d  p(wx.ID_STOP, bm
+00042eb0: 7029 0d0a 0d0a 2020 2020 2020 2020 2020  p)....          
+00042ec0: 2020 7469 746c 6520 3d20 7465 7874 5b3a    title = text[:
+00042ed0: 3530 5d20 2b20 222e 2e22 2069 6620 6c65  50] + ".." if le
+00042ee0: 6e28 7465 7874 2920 3e20 3530 2065 6c73  n(text) > 50 els
+00042ef0: 6520 7465 7874 0d0a 2020 2020 2020 2020  e text..        
+00042f00: 2020 2020 636f 6e74 656e 7420 3d20 6461      content = da
+00042f10: 7461 5b22 7061 7274 6961 6c5f 6874 6d6c  ta["partial_html
+00042f20: 225d 202b 2022 3c2f 7461 626c 653e 3c2f  "] + "</table></
+00042f30: 666f 6e74 3e22 0d0a 2020 2020 2020 2020  font>"..        
+00042f40: 2020 2020 6966 2063 6f6e 662e 5365 6172      if conf.Sear
+00042f50: 6368 5573 654e 6577 5461 6220 6f72 206e  chUseNewTab or n
+00042f60: 6f74 2068 746d 6c2e 4765 7454 6162 436f  ot html.GetTabCo
+00042f70: 756e 7428 293a 0d0a 2020 2020 2020 2020  unt():..        
+00042f80: 2020 2020 2020 2020 6874 6d6c 2e49 6e73          html.Ins
+00042f90: 6572 7454 6162 2830 2c20 7469 746c 652c  ertTab(0, title,
+00042fa0: 2064 6174 615b 2269 6422 5d2c 2063 6f6e   data["id"], con
+00042fb0: 7465 6e74 2c20 6461 7461 290d 0a20 2020  tent, data)..   
+00042fc0: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
+00042fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042fe0: 2320 5365 7420 6e65 7720 4944 2066 6f72  # Set new ID for
+00042ff0: 2074 6865 2065 7869 7374 696e 6720 7265   the existing re
+00043000: 7573 6564 2074 6162 0d0a 2020 2020 2020  used tab..      
+00043010: 2020 2020 2020 2020 2020 6874 6d6c 2e53            html.S
+00043020: 6574 5461 6244 6174 6142 7949 4428 6874  etTabDataByID(ht
+00043030: 6d6c 2e47 6574 4163 7469 7665 5461 6244  ml.GetActiveTabD
+00043040: 6174 6128 295b 2269 6422 5d2c 2074 6974  ata()["id"], tit
+00043050: 6c65 2c0d 0a20 2020 2020 2020 2020 2020  le,..           
+00043060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00043070: 2020 2020 2020 2020 2063 6f6e 7465 6e74           content
+00043080: 2c20 6461 7461 2c20 6461 7461 5b22 6964  , data, data["id
+00043090: 225d 290d 0a0d 0a20 2020 2020 2020 2020  "])....         
+000430a0: 2020 2073 656c 662e 6e6f 7465 626f 6f6b     self.notebook
+000430b0: 2e53 6574 5365 6c65 6374 696f 6e28 7365  .SetSelection(se
+000430c0: 6c66 2e70 6167 656f 7264 6572 5b73 656c  lf.pageorder[sel
+000430d0: 662e 7061 6765 5f73 6561 7263 685d 290d  f.page_search]).
+000430e0: 0a20 2020 2020 2020 2020 2020 2075 7469  .            uti
+000430f0: 6c2e 6164 645f 756e 6971 7565 2863 6f6e  l.add_unique(con
+00043100: 662e 5365 6172 6368 4869 7374 6f72 792c  f.SearchHistory,
+00043110: 2074 6578 742e 7374 7269 7028 292c 2031   text.strip(), 1
+00043120: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00043130: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00043140: 6f6e 662e 4d61 7853 6561 7263 6848 6973  onf.MaxSearchHis
+00043150: 746f 7279 290d 0a20 2020 2020 2020 2020  tory)..         
+00043160: 2020 2073 656c 662e 546f 704c 6576 656c     self.TopLevel
+00043170: 5061 7265 6e74 2e64 6961 6c6f 675f 7365  Parent.dialog_se
+00043180: 6172 6368 2e56 616c 7565 203d 2063 6f6e  arch.Value = con
+00043190: 662e 5365 6172 6368 4869 7374 6f72 795b  f.SearchHistory[
+000431a0: 2d31 5d0d 0a20 2020 2020 2020 2020 2020  -1]..           
+000431b0: 2073 656c 662e 546f 704c 6576 656c 5061   self.TopLevelPa
+000431c0: 7265 6e74 2e64 6961 6c6f 675f 7365 6172  rent.dialog_sear
+000431d0: 6368 2e53 6574 4368 6f69 6365 7328 636f  ch.SetChoices(co
+000431e0: 6e66 2e53 6561 7263 6848 6973 746f 7279  nf.SearchHistory
+000431f0: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
+00043200: 656c 662e 6564 6974 5f73 6561 7263 6861  elf.edit_searcha
+00043210: 6c6c 2e53 6574 4368 6f69 6365 7328 636f  ll.SetChoices(co
+00043220: 6e66 2e53 6561 7263 6848 6973 746f 7279  nf.SearchHistory
+00043230: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
+00043240: 656c 662e 6564 6974 5f73 6561 7263 6861  elf.edit_searcha
+00043250: 6c6c 2e53 6574 466f 6375 7328 290d 0a20  ll.SetFocus().. 
+00043260: 2020 2020 2020 2020 2020 2075 7469 6c2e             util.
+00043270: 7275 6e5f 6f6e 6365 2863 6f6e 662e 7361  run_once(conf.sa
+00043280: 7665 290d 0a0d 0a0d 0a20 2020 2064 6566  ve)......    def
+00043290: 206f 6e5f 6465 6c65 7465 5f74 6162 5f63   on_delete_tab_c
+000432a0: 616c 6c62 6163 6b28 7365 6c66 2c20 7461  allback(self, ta
+000432b0: 6229 3a0d 0a20 2020 2020 2020 2022 2222  b):..        """
+000432c0: 0d0a 2020 2020 2020 2020 4675 6e63 7469  ..        Functi
+000432d0: 6f6e 2063 616c 6c65 6420 6279 2068 746d  on called by htm
+000432e0: 6c5f 7365 6172 6368 616c 6c20 6166 7465  l_searchall afte
+000432f0: 7220 6465 6c65 7469 6e67 2061 2074 6162  r deleting a tab
+00043300: 2c20 7374 6f70 7320 7468 650d 0a20 2020  , stops the..   
+00043310: 2020 2020 206f 6e67 6f69 6e67 2073 6561       ongoing sea
+00043320: 7263 682c 2069 6620 616e 792e 0d0a 2020  rch, if any...  
+00043330: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
+00043340: 2020 2074 6162 5f64 6174 6120 3d20 7365     tab_data = se
+00043350: 6c66 2e68 746d 6c5f 7365 6172 6368 616c  lf.html_searchal
+00043360: 6c2e 4765 7441 6374 6976 6554 6162 4461  l.GetActiveTabDa
+00043370: 7461 2829 0d0a 2020 2020 2020 2020 6966  ta()..        if
+00043380: 2074 6162 5f64 6174 6120 616e 6420 7461   tab_data and ta
+00043390: 625f 6461 7461 5b22 6964 225d 203d 3d20  b_data["id"] == 
+000433a0: 7461 625b 2269 6422 5d3a 0d0a 2020 2020  tab["id"]:..    
+000433b0: 2020 2020 2020 2020 7365 6c66 2e74 625f          self.tb_
+000433c0: 7365 6172 6368 5f73 6574 7469 6e67 732e  search_settings.
+000433d0: 5365 7454 6f6f 6c4e 6f72 6d61 6c42 6974  SetToolNormalBit
+000433e0: 6d61 7028 0d0a 2020 2020 2020 2020 2020  map(..          
+000433f0: 2020 2020 2020 7778 2e49 445f 5354 4f50        wx.ID_STOP
+00043400: 2c20 696d 6167 6573 2e54 6f6f 6c62 6172  , images.Toolbar
+00043410: 5374 6f70 7065 642e 4269 746d 6170 290d  Stopped.Bitmap).
+00043420: 0a20 2020 2020 2020 2069 6620 7461 625b  .        if tab[
+00043430: 2269 6422 5d20 696e 2073 656c 662e 776f  "id"] in self.wo
+00043440: 726b 6572 735f 7365 6172 6368 3a0d 0a20  rkers_search:.. 
+00043450: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00043460: 776f 726b 6572 735f 7365 6172 6368 5b74  workers_search[t
+00043470: 6162 5b22 6964 225d 5d2e 7374 6f70 2829  ab["id"]].stop()
+00043480: 0d0a 2020 2020 2020 2020 2020 2020 6465  ..            de
+00043490: 6c20 7365 6c66 2e77 6f72 6b65 7273 5f73  l self.workers_s
+000434a0: 6561 7263 685b 7461 625b 2269 6422 5d5d  earch[tab["id"]]
+000434b0: 0d0a 0d0a 0d0a 2020 2020 6465 6620 6f6e  ......    def on
+000434c0: 5f6d 6f75 7365 5f6f 7665 725f 6772 6964  _mouse_over_grid
+000434d0: 2873 656c 662c 2065 7665 6e74 293a 0d0a  (self, event):..
+000434e0: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
+000434f0: 2020 2020 2048 616e 646c 6572 2066 6f72       Handler for
+00043500: 206d 6f76 696e 6720 7468 6520 6d6f 7573   moving the mous
+00043510: 6520 6f76 6572 2061 2067 7269 642c 2073  e over a grid, s
+00043520: 686f 7773 2064 6174 6574 696d 6520 746f  hows datetime to
+00043530: 6f6c 7469 7020 666f 720d 0a20 2020 2020  oltip for..     
+00043540: 2020 2055 4e49 5820 7469 6d65 7374 616d     UNIX timestam
+00043550: 7020 6365 6c6c 732e 0d0a 2020 2020 2020  p cells...      
+00043560: 2020 2222 220d 0a20 2020 2020 2020 2074    """..        t
+00043570: 6970 203d 2022 220d 0a20 2020 2020 2020  ip = ""..       
+00043580: 2067 7269 6420 3d20 6576 656e 742e 4576   grid = event.Ev
+00043590: 656e 744f 626a 6563 742e 5061 7265 6e74  entObject.Parent
+000435a0: 0d0a 2020 2020 2020 2020 7072 6576 5f63  ..        prev_c
+000435b0: 656c 6c20 3d20 6765 7461 7474 7228 6772  ell = getattr(gr
+000435c0: 6964 2c20 225f 686f 7665 7265 645f 6365  id, "_hovered_ce
+000435d0: 6c6c 222c 204e 6f6e 6529 0d0a 2020 2020  ll", None)..    
+000435e0: 2020 2020 782c 2079 203d 2067 7269 642e      x, y = grid.
+000435f0: 4361 6c63 556e 7363 726f 6c6c 6564 506f  CalcUnscrolledPo
+00043600: 7369 7469 6f6e 2865 7665 6e74 2e58 2c20  sition(event.X, 
+00043610: 6576 656e 742e 5929 0d0a 2020 2020 2020  event.Y)..      
+00043620: 2020 726f 772c 2063 6f6c 203d 2067 7269    row, col = gri
+00043630: 642e 5859 546f 4365 6c6c 2878 2c20 7929  d.XYToCell(x, y)
+00043640: 0d0a 2020 2020 2020 2020 6966 2072 6f77  ..        if row
+00043650: 203e 3d20 3020 616e 6420 636f 6c20 3e3d   >= 0 and col >=
+00043660: 2030 3a0d 0a20 2020 2020 2020 2020 2020   0:..           
+00043670: 2076 616c 7565 203d 2067 7269 642e 5461   value = grid.Ta
+00043680: 626c 652e 4765 7456 616c 7565 2872 6f77  ble.GetValue(row
+00043690: 2c20 636f 6c29 0d0a 2020 2020 2020 2020  , col)..        
+000436a0: 2020 2020 636f 6c5f 6e61 6d65 203d 2067      col_name = g
+000436b0: 7269 642e 5461 626c 652e 4765 7443 6f6c  rid.Table.GetCol
+000436c0: 4c61 6265 6c56 616c 7565 2863 6f6c 292e  LabelValue(col).
+000436d0: 6c6f 7765 7228 290d 0a20 2020 2020 2020  lower()..       
+000436e0: 2020 2020 2069 6620 7479 7065 2876 616c       if type(val
+000436f0: 7565 2920 6973 2069 6e74 2061 6e64 2076  ue) is int and v
+00043700: 616c 7565 203e 2031 3030 3030 3030 3030  alue > 100000000
+00043710: 205c 0d0a 2020 2020 2020 2020 2020 2020   \..            
+00043720: 616e 6420 2822 7469 6d65 2220 696e 2063  and ("time" in c
+00043730: 6f6c 5f6e 616d 6520 6f72 2022 6869 7374  ol_name or "hist
+00043740: 6f72 7922 2069 6e20 636f 6c5f 6e61 6d65  ory" in col_name
+00043750: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00043760: 2020 2020 7472 793a 0d0a 2020 2020 2020      try:..      
+00043770: 2020 2020 2020 2020 2020 2020 2020 7469                ti
+00043780: 7020 3d20 7365 6c66 2e64 622e 7374 616d  p = self.db.stam
+00043790: 705f 746f 5f64 6174 6528 7661 6c75 6529  p_to_date(value)
+000437a0: 2e73 7472 6674 696d 6528 0d0a 2020 2020  .strftime(..    
+000437b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000437c0: 2020 2020 2020 2225 592d 256d 2d25 6420        "%Y-%m-%d 
+000437d0: 2548 3a25 4d3a 2553 2229 0d0a 2020 2020  %H:%M:%S")..    
+000437e0: 2020 2020 2020 2020 2020 2020 6578 6365              exce
+000437f0: 7074 2045 7863 6570 7469 6f6e 3a0d 0a20  pt Exception:.. 
+00043800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00043810: 2020 2074 6970 203d 2075 7469 6c2e 746f     tip = util.to
+00043820: 5f75 6e69 636f 6465 2876 616c 7565 290d  _unicode(value).
+00043830: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+00043840: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00043850: 2020 2020 7469 7020 3d20 7574 696c 2e74      tip = util.t
+00043860: 6f5f 756e 6963 6f64 6528 7661 6c75 6529  o_unicode(value)
+00043870: 0d0a 2020 2020 2020 2020 2020 2020 7469  ..            ti
+00043880: 7020 3d20 7469 7020 6966 206c 656e 2874  p = tip if len(t
+00043890: 6970 2920 3c20 3130 3030 2065 6c73 6520  ip) < 1000 else 
+000438a0: 7469 705b 3a31 3030 305d 202b 2022 2e2e  tip[:1000] + "..
+000438b0: 220d 0a20 2020 2020 2020 2069 6620 2872  "..        if (r
+000438c0: 6f77 2c20 636f 6c29 2021 3d20 7072 6576  ow, col) != prev
+000438d0: 5f63 656c 6c20 6f72 206e 6f74 2028 6576  _cell or not (ev
+000438e0: 656e 742e 4576 656e 744f 626a 6563 742e  ent.EventObject.
+000438f0: 546f 6f6c 5469 7029 205c 0d0a 2020 2020  ToolTip) \..    
+00043900: 2020 2020 6f72 2065 7665 6e74 2e45 7665      or event.Eve
+00043910: 6e74 4f62 6a65 6374 2e54 6f6f 6c54 6970  ntObject.ToolTip
+00043920: 2e54 6970 2021 3d20 7469 703a 0d0a 2020  .Tip != tip:..  
+00043930: 2020 2020 2020 2020 2020 6576 656e 742e            event.
+00043940: 4576 656e 744f 626a 6563 742e 5365 7454  EventObject.SetT
+00043950: 6f6f 6c54 6970 2874 6970 290d 0a20 2020  oolTip(tip)..   
+00043960: 2020 2020 2067 7269 642e 5f68 6f76 6572       grid._hover
+00043970: 6564 5f63 656c 6c20 3d20 2872 6f77 2c20  ed_cell = (row, 
+00043980: 636f 6c29 0d0a 0d0a 0d0a 2020 2020 6465  col)......    de
+00043990: 6620 6f6e 5f70 6172 7469 6369 7061 6e74  f on_participant
+000439a0: 735f 6463 6c69 636b 2873 656c 662c 2065  s_dclick(self, e
+000439b0: 7665 6e74 293a 0d0a 2020 2020 2020 2020  vent):..        
+000439c0: 2222 220d 0a20 2020 2020 2020 2048 616e  """..        Han
+000439d0: 646c 6572 2066 6f72 2064 6f75 626c 652d  dler for double-
+000439e0: 636c 6963 6b69 6e67 2061 6e20 6974 656d  clicking an item
+000439f0: 2069 6e20 7468 6520 7061 7274 6963 6970   in the particip
+00043a00: 616e 7473 206c 6973 742c 0d0a 2020 2020  ants list,..    
+00043a10: 2020 2020 6368 6563 6b73 2f75 6e63 6865      checks/unche
+00043a20: 636b 7320 2843 6865 636b 4c69 7374 426f  cks (CheckListBo
+00043a30: 7820 6368 6563 6b73 206f 6e6c 7920 7768  x checks only wh
+00043a40: 656e 2063 6c69 636b 696e 6720 6f6e 2074  en clicking on t
+00043a50: 6865 0d0a 2020 2020 2020 2020 6368 6563  he..        chec
+00043a60: 6b62 6f78 2069 636f 6e20 6974 7365 6c66  kbox icon itself
+00043a70: 292e 0d0a 2020 2020 2020 2020 2222 220d  )...        """.
+00043a80: 0a20 2020 2020 2020 2063 6865 636b 6564  .        checked
+00043a90: 7320 3d20 6c69 7374 2865 7665 6e74 2e45  s = list(event.E
+00043aa0: 7665 6e74 4f62 6a65 6374 2e43 6865 636b  ventObject.Check
+00043ab0: 6564 290d 0a20 2020 2020 2020 2064 6f5f  ed)..        do_
+00043ac0: 6368 6563 6b20 3d20 6e6f 7420 6576 656e  check = not even
+00043ad0: 742e 4576 656e 744f 626a 6563 742e 4973  t.EventObject.Is
+00043ae0: 4368 6563 6b65 6428 6576 656e 742e 5365  Checked(event.Se
+00043af0: 6c65 6374 696f 6e29 0d0a 2020 2020 2020  lection)..      
+00043b00: 2020 6966 2064 6f5f 6368 6563 6b20 616e    if do_check an
+00043b10: 6420 6576 656e 742e 5365 6c65 6374 696f  d event.Selectio
+00043b20: 6e20 6e6f 7420 696e 2063 6865 636b 6564  n not in checked
+00043b30: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
+00043b40: 6368 6563 6b65 6473 2e61 7070 656e 6428  checkeds.append(
+00043b50: 6576 656e 742e 5365 6c65 6374 696f 6e29  event.Selection)
+00043b60: 0d0a 2020 2020 2020 2020 656c 6966 206e  ..        elif n
+00043b70: 6f74 2064 6f5f 6368 6563 6b20 616e 6420  ot do_check and 
+00043b80: 6576 656e 742e 5365 6c65 6374 696f 6e20  event.Selection 
+00043b90: 696e 2063 6865 636b 6564 733a 0d0a 2020  in checkeds:..  
+00043ba0: 2020 2020 2020 2020 2020 6368 6563 6b65            checke
+00043bb0: 6473 2e72 656d 6f76 6528 6576 656e 742e  ds.remove(event.
+00043bc0: 5365 6c65 6374 696f 6e29 0d0a 2020 2020  Selection)..    
+00043bd0: 2020 2020 6576 656e 742e 4576 656e 744f      event.EventO
+00043be0: 626a 6563 742e 5365 7443 6865 636b 6564  bject.SetChecked
+00043bf0: 2863 6865 636b 6564 7329 0d0a 0d0a 0d0a  (checkeds)......
+00043c00: 2020 2020 6465 6620 6f6e 5f66 696c 7465      def on_filte
+00043c10: 7272 6573 6574 5f63 6861 7428 7365 6c66  rreset_chat(self
+00043c20: 2c20 6576 656e 7429 3a0d 0a20 2020 2020  , event):..     
+00043c30: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
+00043c40: 4861 6e64 6c65 7220 666f 7220 636c 6963  Handler for clic
+00043c50: 6b69 6e67 2074 6f20 7265 7365 7420 6375  king to reset cu
+00043c60: 7272 656e 7420 6368 6174 2068 6973 746f  rrent chat histo
+00043c70: 7279 2066 696c 7465 722c 2072 6573 746f  ry filter, resto
+00043c80: 7265 730d 0a20 2020 2020 2020 2069 6e69  res..        ini
+00043c90: 7469 616c 2076 616c 7565 7320 746f 2066  tial values to f
+00043ca0: 696c 7465 7220 636f 6e74 726f 6c73 2c20  ilter controls, 
+00043cb0: 616e 6420 7265 6170 706c 6965 7320 7468  and reapplies th
+00043cc0: 6520 6669 6c74 6572 2c20 7363 726f 6c6c  e filter, scroll
+00043cd0: 696e 670d 0a20 2020 2020 2020 2074 6f20  ing..        to 
+00043ce0: 7468 6520 6d65 7373 6167 6520 6469 7370  the message disp
+00043cf0: 6c61 7965 6420 6c61 7374 2c20 6966 2070  layed last, if p
+00043d00: 6f73 7369 626c 652e 0d0a 2020 2020 2020  ossible...      
+00043d10: 2020 2222 220d 0a20 2020 2020 2020 2073    """..        s
+00043d20: 656c 662e 6564 6974 5f66 696c 7465 7274  elf.edit_filtert
+00043d30: 6578 742e 5661 6c75 6520 3d20 2222 0d0a  ext.Value = ""..
+00043d40: 2020 2020 2020 2020 7365 6c66 2e72 616e          self.ran
+00043d50: 6765 5f64 6174 652e 5365 7456 616c 7565  ge_date.SetValue
+00043d60: 7328 2a73 656c 662e 6368 6174 5f66 696c  s(*self.chat_fil
+00043d70: 7465 725b 2273 7461 7274 6461 7465 7261  ter["startdatera
+00043d80: 6e67 6522 5d29 0d0a 2020 2020 2020 2020  nge"])..        
+00043d90: 666f 7220 6920 696e 2072 616e 6765 2873  for i in range(s
+00043da0: 656c 662e 6c69 7374 5f70 6172 7469 6369  elf.list_partici
+00043db0: 7061 6e74 732e 4765 7449 7465 6d43 6f75  pants.GetItemCou
+00043dc0: 6e74 2829 293a 0d0a 2020 2020 2020 2020  nt()):..        
+00043dd0: 2020 2020 6320 3d20 7365 6c66 2e6c 6973      c = self.lis
+00043de0: 745f 7061 7274 6963 6970 616e 7473 2e47  t_participants.G
+00043df0: 6574 4974 656d 2869 290d 0a20 2020 2020  etItem(i)..     
+00043e00: 2020 2020 2020 2063 2e43 6865 636b 2854         c.Check(T
+00043e10: 7275 6529 0d0a 2020 2020 2020 2020 2020  rue)..          
+00043e20: 2020 7365 6c66 2e6c 6973 745f 7061 7274    self.list_part
+00043e30: 6963 6970 616e 7473 2e53 6574 4974 656d  icipants.SetItem
+00043e40: 2863 290d 0a20 2020 2020 2020 2073 656c  (c)..        sel
+00043e50: 662e 6c69 7374 5f70 6172 7469 6369 7061  f.list_participa
+00043e60: 6e74 732e 5265 6672 6573 6828 290d 0a0d  nts.Refresh()...
+00043e70: 0a20 2020 2020 2020 206e 6577 5f66 696c  .        new_fil
+00043e80: 7465 7220 3d20 7365 6c66 2e62 7569 6c64  ter = self.build
+00043e90: 5f66 696c 7465 7228 290d 0a20 2020 2020  _filter()..     
+00043ea0: 2020 2069 6620 7365 6c66 2e63 6d70 5f66     if self.cmp_f
+00043eb0: 696c 7465 7228 6e65 775f 6669 6c74 6572  ilter(new_filter
+00043ec0: 293a 2072 6574 7572 6e20 2320 4669 6c74  ): return # Filt
+00043ed0: 6572 2075 6e63 6861 6e67 6564 0d0a 0d0a  er unchanged....
+00043ee0: 2020 2020 2020 2020 666f 6375 735f 6d65          focus_me
+00043ef0: 7373 6167 655f 6964 2c20 7365 6c65 6374  ssage_id, select
+00043f00: 6564 203d 2073 656c 662e 7374 635f 6869  ed = self.stc_hi
+00043f10: 7374 6f72 792e 4765 7446 6f63 7573 6564  story.GetFocused
+00043f20: 4d65 7373 6167 6528 290d 0a20 2020 2020  Message()..     
+00043f30: 2020 2073 656c 662e 6f6e 5f66 696c 7465     self.on_filte
+00043f40: 725f 6368 6174 2865 7665 6e74 2c20 6e65  r_chat(event, ne
+00043f50: 775f 6669 6c74 6572 290d 0a20 2020 2020  w_filter)..     
+00043f60: 2020 2069 6620 666f 6375 735f 6d65 7373     if focus_mess
+00043f70: 6167 655f 6964 2069 7320 6e6f 7420 4e6f  age_id is not No
+00043f80: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
+00043f90: 2073 656c 662e 7374 635f 6869 7374 6f72   self.stc_histor
+00043fa0: 792e 466f 6375 734d 6573 7361 6765 2866  y.FocusMessage(f
+00043fb0: 6f63 7573 5f6d 6573 7361 6765 5f69 642c  ocus_message_id,
+00043fc0: 2073 656c 6563 743d 7365 6c65 6374 6564   select=selected
+00043fd0: 290d 0a0d 0a0d 0a20 2020 2064 6566 206f  )......    def o
+00043fe0: 6e5f 6669 6c74 6572 5f63 6861 7428 7365  n_filter_chat(se
+00043ff0: 6c66 2c20 6576 656e 742c 206e 6577 5f66  lf, event, new_f
+00044000: 696c 7465 723d 4e6f 6e65 293a 0d0a 2020  ilter=None):..  
+00044010: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
+00044020: 2020 2048 616e 646c 6572 2066 6f72 2063     Handler for c
+00044030: 6c69 636b 696e 6720 746f 2066 696c 7465  licking to filte
+00044040: 7220 6375 7272 656e 7420 6368 6174 2068  r current chat h
+00044050: 6973 746f 7279 2c20 6170 706c 6965 7320  istory, applies 
+00044060: 7468 650d 0a20 2020 2020 2020 2063 7572  the..        cur
+00044070: 7265 6e74 2066 696c 7465 7220 746f 2074  rent filter to t
+00044080: 6865 2063 6861 7420 6d65 7373 6167 6573  he chat messages
+00044090: 2e0d 0a20 2020 2020 2020 2022 2222 0d0a  ...        """..
+000440a0: 2020 2020 2020 2020 666f 6375 735f 6d65          focus_me
+000440b0: 7373 6167 655f 6964 203d 204e 6f6e 650d  ssage_id = None.
+000440c0: 0a20 2020 2020 2020 2069 6620 6e65 775f  .        if new_
+000440d0: 6669 6c74 6572 2069 7320 4e6f 6e65 3a0d  filter is None:.
+000440e0: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
+000440f0: 5f66 696c 7465 7220 3d20 7365 6c66 2e62  _filter = self.b
+00044100: 7569 6c64 5f66 696c 7465 7228 290d 0a20  uild_filter().. 
+00044110: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+00044120: 6c66 2e63 6d70 5f66 696c 7465 7228 6e65  lf.cmp_filter(ne
+00044130: 775f 6669 6c74 6572 293a 2072 6574 7572  w_filter): retur
+00044140: 6e20 2320 4669 6c74 6572 2075 6e63 6861  n # Filter uncha
+00044150: 6e67 6564 0d0a 2020 2020 2020 2020 2020  nged..          
+00044160: 2020 666f 6375 735f 6d65 7373 6167 655f    focus_message_
+00044170: 6964 2c20 5f20 3d20 7365 6c66 2e73 7463  id, _ = self.stc
+00044180: 5f68 6973 746f 7279 2e47 6574 466f 6375  _history.GetFocu
+00044190: 7365 644d 6573 7361 6765 2873 656c 6563  sedMessage(selec
+000441a0: 7465 646f 6e6c 793d 5472 7565 290d 0a20  tedonly=True).. 
+000441b0: 2020 2020 2020 2062 7573 7920 3d20 636f         busy = co
+000441c0: 6e74 726f 6c73 2e42 7573 7950 616e 656c  ntrols.BusyPanel
+000441d0: 2873 656c 662c 2022 4669 6c74 6572 696e  (self, "Filterin
+000441e0: 6720 6d65 7373 6167 6573 2e22 290d 0a20  g messages.").. 
+000441f0: 2020 2020 2020 2074 7279 3a0d 0a20 2020         try:..   
+00044200: 2020 2020 2020 2020 2073 656c 662e 6368           self.ch
+00044210: 6174 5f66 696c 7465 722e 7570 6461 7465  at_filter.update
+00044220: 286e 6577 5f66 696c 7465 7229 0d0a 2020  (new_filter)..  
+00044230: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
+00044240: 7463 5f68 6973 746f 7279 2e53 6574 4669  tc_history.SetFi
+00044250: 6c74 6572 2873 656c 662e 6368 6174 5f66  lter(self.chat_f
+00044260: 696c 7465 7229 0d0a 2020 2020 2020 2020  ilter)..        
+00044270: 2020 2020 7365 6c66 2e73 7463 5f68 6973      self.stc_his
+00044280: 746f 7279 2e52 6566 7265 7368 4d65 7373  tory.RefreshMess
+00044290: 6167 6573 2829 0d0a 2020 2020 2020 2020  ages()..        
+000442a0: 2020 2020 7365 6c66 2e70 6f70 756c 6174      self.populat
+000442b0: 655f 6368 6174 5f73 7461 7469 7374 6963  e_chat_statistic
+000442c0: 7328 290d 0a20 2020 2020 2020 2020 2020  s()..           
+000442d0: 2073 656c 662e 6c69 7374 5f74 696d 656c   self.list_timel
+000442e0: 696e 652e 506f 7075 6c61 7465 282a 7365  ine.Populate(*se
+000442f0: 6c66 2e73 7463 5f68 6973 746f 7279 2e47  lf.stc_history.G
+00044300: 6574 5469 6d65 6c69 6e65 4461 7461 2829  etTimelineData()
+00044310: 290d 0a20 2020 2020 2020 2066 696e 616c  )..        final
+00044320: 6c79 3a0d 0a20 2020 2020 2020 2020 2020  ly:..           
+00044330: 2062 7573 792e 436c 6f73 6528 290d 0a20   busy.Close().. 
+00044340: 2020 2020 2020 2073 656c 662e 7462 5f63         self.tb_c
+00044350: 6861 742e 456e 6162 6c65 546f 6f6c 2877  hat.EnableTool(w
+00044360: 782e 4944 5f4d 4f52 452c 2073 656c 662e  x.ID_MORE, self.
+00044370: 6368 6174 5b22 6d65 7373 6167 655f 636f  chat["message_co
+00044380: 756e 7422 5d20 3e20 3029 0d0a 2020 2020  unt"] > 0)..    
+00044390: 2020 2020 6966 2066 6f63 7573 5f6d 6573      if focus_mes
+000443a0: 7361 6765 5f69 6420 6973 206e 6f74 204e  sage_id is not N
+000443b0: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
+000443c0: 2020 7365 6c66 2e73 7463 5f68 6973 746f    self.stc_histo
+000443d0: 7279 2e46 6f63 7573 4d65 7373 6167 6528  ry.FocusMessage(
+000443e0: 666f 6375 735f 6d65 7373 6167 655f 6964  focus_message_id
+000443f0: 290d 0a0d 0a0d 0a20 2020 2064 6566 2062  )......    def b
+00044400: 7569 6c64 5f66 696c 7465 7228 7365 6c66  uild_filter(self
+00044410: 293a 0d0a 2020 2020 2020 2020 2222 2242  ):..        """B
+00044420: 7569 6c64 7320 6368 6174 2066 696c 7465  uilds chat filte
+00044430: 7220 6461 7461 2066 726f 6d20 6375 7272  r data from curr
+00044440: 656e 7420 636f 6e74 726f 6c20 7374 6174  ent control stat
+00044450: 652e 2222 220d 0a20 2020 2020 2020 2023  e."""..        #
+00044460: 2041 7420 6c65 6173 7420 6f6e 6520 7061   At least one pa
+00044470: 7274 6963 6970 616e 7420 6d75 7374 2062  rticipant must b
+00044480: 6520 7365 6c65 6374 6564 3a20 7265 7365  e selected: rese
+00044490: 7420 746f 2070 7265 7669 6f75 736c 790d  t to previously.
+000444a0: 0a20 2020 2020 2020 2023 2073 656c 6563  .        # selec
+000444b0: 7465 6420 7061 7274 6963 6970 616e 7473  ted participants
+000444c0: 2069 6e73 7465 6164 2069 6620 6e6f 7468   instead if noth
+000444d0: 696e 6720 7365 6c65 6374 6564 0d0a 2020  ing selected..  
+000444e0: 2020 2020 2020 7265 7365 6c65 6374 6564        reselected
+000444f0: 7320 3d20 5b5d 0d0a 2020 2020 2020 2020  s = []..        
+00044500: 666f 7220 6920 696e 2072 616e 6765 2873  for i in range(s
+00044510: 656c 662e 6c69 7374 5f70 6172 7469 6369  elf.list_partici
+00044520: 7061 6e74 732e 4765 7449 7465 6d43 6f75  pants.GetItemCou
+00044530: 6e74 2829 293a 0d0a 2020 2020 2020 2020  nt()):..        
+00044540: 2020 2020 2320 556c 7469 6d61 7465 4c69      # UltimateLi
+00044550: 7374 4374 726c 2064 6f65 7320 6e6f 7420  stCtrl does not 
+00044560: 6578 706f 7365 2063 6865 636b 6564 2073  expose checked s
+00044570: 7461 7465 2c20 6861 7665 2074 6f0d 0a20  tate, have to.. 
+00044580: 2020 2020 2020 2020 2020 2023 2071 7565             # que
+00044590: 7279 2069 7420 6672 6f6d 2065 6163 6820  ry it from each 
+000445a0: 696e 6469 7669 6475 616c 2072 6f77 0d0a  individual row..
+000445b0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+000445c0: 6f74 2073 656c 662e 6c69 7374 5f70 6172  ot self.list_par
 000445d0: 7469 6369 7061 6e74 732e 4765 7449 7465  ticipants.GetIte
-000445e0: 6d28 6929 0d0a 2020 2020 2020 2020 2020  m(i)..          
-000445f0: 2020 2020 2020 2020 2020 632e 4368 6563            c.Chec
-00044600: 6b28 5472 7565 290d 0a20 2020 2020 2020  k(True)..       
-00044610: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00044620: 662e 6c69 7374 5f70 6172 7469 6369 7061  f.list_participa
-00044630: 6e74 732e 5365 7449 7465 6d28 6329 0d0a  nts.SetItem(c)..
-00044640: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00044650: 2e6c 6973 745f 7061 7274 6963 6970 616e  .list_participan
-00044660: 7473 2e52 6566 7265 7368 2829 0d0a 2020  ts.Refresh()..  
-00044670: 2020 2020 2020 7061 7274 6963 6970 616e        participan
-00044680: 7473 203d 205b 5d0d 0a20 2020 2020 2020  ts = []..       
-00044690: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
-000446a0: 7365 6c66 2e6c 6973 745f 7061 7274 6963  self.list_partic
-000446b0: 6970 616e 7473 2e47 6574 4974 656d 436f  ipants.GetItemCo
-000446c0: 756e 7428 2929 3a0d 0a20 2020 2020 2020  unt()):..       
-000446d0: 2020 2020 2069 6620 7365 6c66 2e6c 6973       if self.lis
-000446e0: 745f 7061 7274 6963 6970 616e 7473 2e49  t_participants.I
-000446f0: 7349 7465 6d43 6865 636b 6564 2869 293a  sItemChecked(i):
-00044700: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00044710: 2020 6964 656e 7469 7479 203d 2073 656c    identity = sel
-00044720: 662e 6c69 7374 5f70 6172 7469 6369 7061  f.list_participa
-00044730: 6e74 732e 4765 7449 7465 6d44 6174 6128  nts.GetItemData(
-00044740: 6929 5b22 6964 656e 7469 7479 225d 0d0a  i)["identity"]..
-00044750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044760: 7061 7274 6963 6970 616e 7473 2e61 7070  participants.app
-00044770: 656e 6428 6964 656e 7469 7479 290d 0a20  end(identity).. 
-00044780: 2020 2020 2020 2066 696c 7465 7264 6174         filterdat
-00044790: 6120 3d20 7b0d 0a20 2020 2020 2020 2020  a = {..         
-000447a0: 2020 2022 6461 7465 7261 6e67 6522 3a20     "daterange": 
-000447b0: 7365 6c66 2e72 616e 6765 5f64 6174 652e  self.range_date.
-000447c0: 5661 6c75 6573 2c0d 0a20 2020 2020 2020  Values,..       
-000447d0: 2020 2020 2022 7465 7874 223a 2073 656c       "text": sel
-000447e0: 662e 6564 6974 5f66 696c 7465 7274 6578  f.edit_filtertex
-000447f0: 742e 5661 6c75 652c 0d0a 2020 2020 2020  t.Value,..      
-00044800: 2020 2020 2020 2270 6172 7469 6369 7061        "participa
-00044810: 6e74 7322 3a20 7061 7274 6963 6970 616e  nts": participan
-00044820: 7473 0d0a 2020 2020 2020 2020 7d0d 0a20  ts..        }.. 
-00044830: 2020 2020 2020 2072 6574 7572 6e20 6669         return fi
-00044840: 6c74 6572 6461 7461 0d0a 0d0a 0d0a 2020  lterdata......  
-00044850: 2020 6465 6620 636d 705f 6669 6c74 6572    def cmp_filter
-00044860: 2873 656c 662c 2066 696c 7465 7264 6174  (self, filterdat
-00044870: 6129 3a0d 0a20 2020 2020 2020 2022 2222  a):..        """
-00044880: 5265 7475 726e 7320 7768 6574 6865 7220  Returns whether 
-00044890: 6368 6174 2066 696c 7465 7220 6461 7461  chat filter data
-000448a0: 2069 7320 7361 6d65 2061 7320 6375 7272   is same as curr
-000448b0: 656e 746c 7920 6170 706c 6965 642e 2222  ently applied.""
-000448c0: 220d 0a20 2020 2020 2020 206f 6c64 5f66  "..        old_f
-000448d0: 696c 7465 7220 3d20 7365 6c66 2e73 7463  ilter = self.stc
-000448e0: 5f68 6973 746f 7279 2e46 696c 7465 720d  _history.Filter.
-000448f0: 0a20 2020 2020 2020 2069 6620 2274 6578  .        if "tex
-00044900: 7422 206e 6f74 2069 6e20 6f6c 645f 6669  t" not in old_fi
-00044910: 6c74 6572 3a20 6f6c 645f 6669 6c74 6572  lter: old_filter
-00044920: 5b22 7465 7874 225d 203d 2022 220d 0a20  ["text"] = "".. 
-00044930: 2020 2020 2020 2069 6620 2270 6172 7469         if "parti
-00044940: 6369 7061 6e74 7322 206e 6f74 2069 6e20  cipants" not in 
-00044950: 6f6c 645f 6669 6c74 6572 3a0d 0a20 2020  old_filter:..   
-00044960: 2020 2020 2020 2020 2065 7665 7279 6f6e           everyon
-00044970: 6520 3d20 5b78 5b22 6964 656e 7469 7479  e = [x["identity
-00044980: 225d 2066 6f72 2078 2069 6e20 7365 6c66  "] for x in self
-00044990: 2e63 6861 745b 2270 6172 7469 6369 7061  .chat["participa
-000449a0: 6e74 7322 5d5d 0d0a 2020 2020 2020 2020  nts"]]..        
-000449b0: 2020 2020 6f6c 645f 6669 6c74 6572 5b22      old_filter["
-000449c0: 7061 7274 6963 6970 616e 7473 225d 203d  participants"] =
-000449d0: 2065 7665 7279 6f6e 650d 0a20 2020 2020   everyone..     
-000449e0: 2020 2072 6574 7572 6e20 7574 696c 2e63     return util.c
-000449f0: 6d70 5f64 6963 7473 2866 696c 7465 7264  mp_dicts(filterd
-00044a00: 6174 612c 206f 6c64 5f66 696c 7465 7229  ata, old_filter)
-00044a10: 0d0a 0d0a 0d0a 2020 2020 6465 6620 6f6e  ......    def on
-00044a20: 5f74 6f67 676c 655f 6669 6c74 6572 2873  _toggle_filter(s
-00044a30: 656c 662c 2065 7665 6e74 293a 0d0a 2020  elf, event):..  
-00044a40: 2020 2020 2020 2222 2248 616e 646c 6572        """Handler
-00044a50: 2066 6f72 2063 6c69 636b 696e 6720 746f   for clicking to
-00044a60: 2073 686f 772f 6869 6465 2063 6861 7420   show/hide chat 
-00044a70: 6669 6c74 6572 2e22 2222 0d0a 2020 2020  filter."""..    
-00044a80: 2020 2020 7365 6c66 2e74 6f67 676c 655f      self.toggle_
-00044a90: 6669 6c74 6572 286e 6f74 2073 656c 662e  filter(not self.
-00044aa0: 7370 6c69 7474 6572 5f73 7463 2e49 7353  splitter_stc.IsS
-00044ab0: 706c 6974 2829 290d 0a0d 0a0d 0a20 2020  plit())......   
-00044ac0: 2064 6566 206f 6e5f 746f 6767 6c65 5f73   def on_toggle_s
-00044ad0: 7461 7473 2873 656c 662c 2065 7665 6e74  tats(self, event
-00044ae0: 293a 0d0a 2020 2020 2020 2020 2222 220d  ):..        """.
-00044af0: 0a20 2020 2020 2020 2048 616e 646c 6572  .        Handler
-00044b00: 2066 6f72 2063 6c69 636b 696e 6720 746f   for clicking to
-00044b10: 2073 686f 772f 6869 6465 2073 7461 7469   show/hide stati
-00044b20: 7374 6963 7320 666f 7220 6368 6174 2c20  stics for chat, 
-00044b30: 746f 6767 6c65 7320 6469 7370 6c61 790d  toggles display.
-00044b40: 0a20 2020 2020 2020 2062 6574 7765 656e  .        between
-00044b50: 2063 6861 7420 6869 7374 6f72 7920 7769   chat history wi
-00044b60: 6e64 6f77 2061 6e64 2073 7461 7469 7374  ndow and statist
-00044b70: 6963 7320 7769 6e64 6f77 2e0d 0a20 2020  ics window...   
-00044b80: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-00044b90: 2020 6874 6d6c 2c20 7374 6320 3d20 7365    html, stc = se
-00044ba0: 6c66 2e68 746d 6c5f 7374 6174 732c 2073  lf.html_stats, s
-00044bb0: 656c 662e 7374 635f 6869 7374 6f72 790d  elf.stc_history.
-00044bc0: 0a20 2020 2020 2020 2073 656c 662e 7368  .        self.sh
-00044bd0: 6f77 5f73 7461 7473 286e 6f74 2068 746d  ow_stats(not htm
-00044be0: 6c2e 5368 6f77 6e29 0d0a 2020 2020 2020  l.Shown)..      
-00044bf0: 2020 2868 746d 6c20 6966 2068 746d 6c2e    (html if html.
-00044c00: 5368 6f77 6e20 656c 7365 2073 7463 292e  Shown else stc).
-00044c10: 5365 7446 6f63 7573 2829 0d0a 0d0a 0d0a  SetFocus()......
-00044c20: 2020 2020 6465 6620 6f6e 5f74 6f67 676c      def on_toggl
-00044c30: 655f 6d61 7869 6d69 7a65 2873 656c 662c  e_maximize(self,
-00044c40: 2065 7665 6e74 293a 0d0a 2020 2020 2020   event):..      
-00044c50: 2020 2222 2248 616e 646c 6572 2066 6f72    """Handler for
-00044c60: 2074 6f67 676c 696e 6720 746f 206d 6178   toggling to max
-00044c70: 696d 697a 6520 6368 6174 2077 696e 646f  imize chat windo
-00044c80: 7720 616e 6420 6869 6465 2063 6861 7420  w and hide chat 
-00044c90: 6c69 7374 2e22 2222 0d0a 2020 2020 2020  list."""..      
-00044ca0: 2020 7370 6c69 7474 6572 203d 2073 656c    splitter = sel
-00044cb0: 662e 7370 6c69 7474 6572 5f63 6861 7473  f.splitter_chats
-00044cc0: 0d0a 2020 2020 2020 2020 6966 2073 706c  ..        if spl
-00044cd0: 6974 7465 722e 4973 5370 6c69 7428 293a  itter.IsSplit():
-00044ce0: 0d0a 2020 2020 2020 2020 2020 2020 7370  ..            sp
-00044cf0: 6c69 7474 6572 2e5f 7361 7368 506f 7369  litter._sashPosi
-00044d00: 7469 6f6e 203d 2073 706c 6974 7465 722e  tion = splitter.
-00044d10: 5361 7368 506f 7369 7469 6f6e 0d0a 2020  SashPosition..  
-00044d20: 2020 2020 2020 2020 2020 7370 6c69 7474            splitt
-00044d30: 6572 2e55 6e73 706c 6974 2873 656c 662e  er.Unsplit(self.
-00044d40: 7061 6e65 6c5f 6368 6174 7331 290d 0a20  panel_chats1).. 
-00044d50: 2020 2020 2020 2020 2020 2073 686f 7274             short
-00044d60: 6865 6c70 203d 2022 5265 7374 6f72 6520  help = "Restore 
-00044d70: 6368 6174 2070 616e 656c 2074 6f20 6465  chat panel to de
-00044d80: 6661 756c 7420 7369 7a65 2020 2841 6c74  fault size  (Alt
-00044d90: 2d4d 2922 0d0a 2020 2020 2020 2020 656c  -M)"..        el
-00044da0: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-00044db0: 2070 6f73 203d 2067 6574 6174 7472 2873   pos = getattr(s
-00044dc0: 706c 6974 7465 722c 2022 5f73 6173 6850  plitter, "_sashP
-00044dd0: 6f73 6974 696f 6e22 2c20 7365 6c66 2e53  osition", self.S
-00044de0: 697a 655b 315d 202f 2f20 3329 0d0a 2020  ize[1] // 3)..  
-00044df0: 2020 2020 2020 2020 2020 7370 6c69 7474            splitt
-00044e00: 6572 2e53 706c 6974 486f 7269 7a6f 6e74  er.SplitHorizont
-00044e10: 616c 6c79 2873 656c 662e 7061 6e65 6c5f  ally(self.panel_
-00044e20: 6368 6174 7331 2c20 7365 6c66 2e70 616e  chats1, self.pan
-00044e30: 656c 5f63 6861 7473 322c 0d0a 2020 2020  el_chats2,..    
-00044e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044e60: 2020 2073 6173 6850 6f73 6974 696f 6e3d     sashPosition=
-00044e70: 706f 7329 0d0a 2020 2020 2020 2020 2020  pos)..          
-00044e80: 2020 7368 6f72 7468 656c 7020 3d20 224d    shorthelp = "M
-00044e90: 6178 696d 697a 6520 6368 6174 2070 616e  aximize chat pan
-00044ea0: 656c 2020 2841 6c74 2d4d 2922 0d0a 2020  el  (Alt-M)"..  
-00044eb0: 2020 2020 2020 7365 6c66 2e74 625f 6368        self.tb_ch
-00044ec0: 6174 2e53 6574 546f 6f6c 5368 6f72 7448  at.SetToolShortH
-00044ed0: 656c 7028 7778 2e49 445f 5a4f 4f4d 5f31  elp(wx.ID_ZOOM_1
-00044ee0: 3030 2c20 7368 6f72 7468 656c 7029 0d0a  00, shorthelp)..
-00044ef0: 0d0a 0d0a 2020 2020 6465 6620 6f6e 5f74  ....    def on_t
-00044f00: 6f67 676c 655f 7469 6d65 6c69 6e65 2873  oggle_timeline(s
-00044f10: 656c 662c 2065 7665 6e74 293a 0d0a 2020  elf, event):..  
-00044f20: 2020 2020 2020 2222 2248 616e 646c 6572        """Handler
-00044f30: 2066 6f72 2074 6f67 676c 696e 6720 746f   for toggling to
-00044f40: 2073 686f 772f 6869 6465 2063 6861 7420   show/hide chat 
-00044f50: 7469 6d65 6c69 6e65 2e22 2222 0d0a 2020  timeline."""..  
-00044f60: 2020 2020 2020 7365 6c66 2e70 616e 656c        self.panel
-00044f70: 5f73 7463 312e 4672 6565 7a65 2829 0d0a  _stc1.Freeze()..
-00044f80: 2020 2020 2020 2020 7472 793a 0d0a 2020          try:..  
-00044f90: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
-00044fa0: 6973 745f 7469 6d65 6c69 6e65 2e53 686f  ist_timeline.Sho
-00044fb0: 7728 6e6f 7420 7365 6c66 2e6c 6973 745f  w(not self.list_
-00044fc0: 7469 6d65 6c69 6e65 2e53 686f 776e 290d  timeline.Shown).
-00044fd0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00044fe0: 662e 6c69 7374 5f74 696d 656c 696e 652e  f.list_timeline.
-00044ff0: 436f 6e74 6169 6e69 6e67 5369 7a65 722e  ContainingSizer.
-00045000: 4c61 796f 7574 2829 0d0a 2020 2020 2020  Layout()..      
-00045010: 2020 6669 6e61 6c6c 793a 2073 656c 662e    finally: self.
-00045020: 7061 6e65 6c5f 7374 6331 2e54 6861 7728  panel_stc1.Thaw(
-00045030: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00045040: 6c69 7374 5f74 696d 656c 696e 652e 5265  list_timeline.Re
-00045050: 6672 6573 6849 7465 6d73 2829 0d0a 0d0a  freshItems()....
-00045060: 0d0a 2020 2020 6465 6620 746f 6767 6c65  ..    def toggle
-00045070: 5f66 696c 7465 7228 7365 6c66 2c20 6f6e  _filter(self, on
-00045080: 293a 0d0a 2020 2020 2020 2020 2222 2254  ):..        """T
-00045090: 6f67 676c 6573 2074 6865 2063 6861 7420  oggles the chat 
-000450a0: 6669 6c74 6572 2070 616e 656c 206f 6e2f  filter panel on/
-000450b0: 6f66 662e 2222 220d 0a20 2020 2020 2020  off."""..       
-000450c0: 2069 6620 7365 6c66 2e73 706c 6974 7465   if self.splitte
-000450d0: 725f 7374 632e 4973 5370 6c69 7428 2920  r_stc.IsSplit() 
-000450e0: 616e 6420 6e6f 7420 6f6e 3a0d 0a20 2020  and not on:..   
-000450f0: 2020 2020 2020 2020 2073 656c 662e 7370           self.sp
-00045100: 6c69 7474 6572 5f73 7463 2e5f 7361 7368  litter_stc._sash
-00045110: 506f 7369 7469 6f6e 203d 2073 656c 662e  Position = self.
-00045120: 7370 6c69 7474 6572 5f73 7463 2e53 6173  splitter_stc.Sas
-00045130: 6850 6f73 6974 696f 6e0d 0a20 2020 2020  hPosition..     
-00045140: 2020 2020 2020 2073 656c 662e 7370 6c69         self.spli
-00045150: 7474 6572 5f73 7463 2e55 6e73 706c 6974  tter_stc.Unsplit
-00045160: 2873 656c 662e 7061 6e65 6c5f 7374 6332  (self.panel_stc2
-00045170: 290d 0a20 2020 2020 2020 2065 6c69 6620  )..        elif 
-00045180: 6e6f 7420 7365 6c66 2e73 706c 6974 7465  not self.splitte
-00045190: 725f 7374 632e 4973 5370 6c69 7428 2920  r_stc.IsSplit() 
-000451a0: 616e 6420 6f6e 3a0d 0a20 2020 2020 2020  and on:..       
-000451b0: 2020 2020 2070 203d 2067 6574 6174 7472       p = getattr
-000451c0: 2873 656c 662e 7370 6c69 7474 6572 5f73  (self.splitter_s
-000451d0: 7463 2c20 225f 7361 7368 506f 7369 7469  tc, "_sashPositi
-000451e0: 6f6e 222c 0d0a 2020 2020 2020 2020 2020  on",..          
-000451f0: 2020 2020 2020 7365 6c66 2e73 706c 6974        self.split
-00045200: 7465 725f 7374 632e 5369 7a65 2e77 6964  ter_stc.Size.wid
-00045210: 7468 202d 2073 656c 662e 7061 6e65 6c5f  th - self.panel_
-00045220: 7374 6332 2e42 6573 7453 697a 652e 7769  stc2.BestSize.wi
-00045230: 6474 6829 0d0a 2020 2020 2020 2020 2020  dth)..          
-00045240: 2020 7365 6c66 2e73 706c 6974 7465 725f    self.splitter_
-00045250: 7374 632e 5370 6c69 7456 6572 7469 6361  stc.SplitVertica
-00045260: 6c6c 7928 7365 6c66 2e70 616e 656c 5f73  lly(self.panel_s
-00045270: 7463 312c 2073 656c 662e 7061 6e65 6c5f  tc1, self.panel_
-00045280: 7374 6332 2c0d 0a20 2020 2020 2020 2020  stc2,..         
-00045290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000452a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000452b0: 2020 2020 2073 6173 6850 6f73 6974 696f       sashPositio
-000452c0: 6e3d 7029 0d0a 2020 2020 2020 2020 2020  n=p)..          
-000452d0: 2020 6c69 7374 5f70 6172 7469 6369 7061    list_participa
-000452e0: 6e74 7320 3d20 7365 6c66 2e6c 6973 745f  nts = self.list_
-000452f0: 7061 7274 6963 6970 616e 7473 0d0a 2020  participants..  
-00045300: 2020 2020 2020 2020 2020 6c69 7374 5f70            list_p
-00045310: 6172 7469 6369 7061 6e74 732e 5365 7443  articipants.SetC
-00045320: 6f6c 756d 6e57 6964 7468 2830 2c20 6c69  olumnWidth(0, li
-00045330: 7374 5f70 6172 7469 6369 7061 6e74 732e  st_participants.
-00045340: 5369 7a65 2e77 6964 7468 290d 0a0d 0a0d  Size.width).....
-00045350: 0a20 2020 2064 6566 206f 6e5f 7365 6c65  .    def on_sele
-00045360: 6374 5f74 696d 656c 696e 6528 7365 6c66  ct_timeline(self
-00045370: 2c20 6576 656e 7429 3a0d 0a20 2020 2020  , event):..     
-00045380: 2020 2022 2222 4861 6e64 6c65 7220 666f     """Handler fo
-00045390: 7220 7365 6c65 6374 696e 6720 6120 7469  r selecting a ti
-000453a0: 6d65 2069 6e20 7469 6d65 6c69 6e65 2063  me in timeline c
-000453b0: 6f6e 7472 6f6c 2c20 666f 6375 7365 7320  ontrol, focuses 
-000453c0: 6d65 7373 6167 6520 696e 2053 5443 2222  message in STC""
-000453d0: 220d 0a20 2020 2020 2020 206d 7367 5f69  "..        msg_i
-000453e0: 6420 3d20 7365 6c66 2e6c 6973 745f 7469  d = self.list_ti
-000453f0: 6d65 6c69 6e65 2e47 6574 4d65 7373 6167  meline.GetMessag
-00045400: 6528 6576 656e 742e 5365 6c65 6374 696f  e(event.Selectio
-00045410: 6e29 0d0a 2020 2020 2020 2020 6966 206d  n)..        if m
-00045420: 7367 5f69 6420 6973 206e 6f74 204e 6f6e  sg_id is not Non
-00045430: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00045440: 7365 6c66 2e73 7463 5f68 6973 746f 7279  self.stc_history
-00045450: 2e46 6f63 7573 4d65 7373 6167 6528 6d73  .FocusMessage(ms
-00045460: 675f 6964 2c20 7365 6c65 6374 3d46 616c  g_id, select=Fal
-00045470: 7365 290d 0a0d 0a0d 0a20 2020 2064 6566  se)......    def
-00045480: 206f 6e5f 626c 7572 5f74 696d 656c 696e   on_blur_timelin
-00045490: 6528 7365 6c66 2c20 6576 656e 7429 3a0d  e(self, event):.
-000454a0: 0a20 2020 2020 2020 2022 2222 4861 6e64  .        """Hand
-000454b0: 6c65 7220 666f 7220 636c 6963 6b69 6e67  ler for clicking
-000454c0: 206f 7574 206f 6620 7469 6d65 6c69 6e65   out of timeline
-000454d0: 2c20 636c 6561 7273 2073 656c 6563 7469  , clears selecti
-000454e0: 6f6e 2028 6469 7374 7261 6374 696e 6729  on (distracting)
-000454f0: 2e22 2222 0d0a 2020 2020 2020 2020 7365  ."""..        se
-00045500: 6c66 2e6c 6973 745f 7469 6d65 6c69 6e65  lf.list_timeline
-00045510: 2e53 6574 5365 6c65 6374 696f 6e28 2d31  .SetSelection(-1
-00045520: 290d 0a0d 0a0d 0a20 2020 2064 6566 206f  )......    def o
-00045530: 6e5f 7363 726f 6c6c 5f63 6861 745f 6869  n_scroll_chat_hi
-00045540: 7374 6f72 7928 7365 6c66 2c20 6576 656e  story(self, even
-00045550: 7429 3a0d 0a20 2020 2020 2020 2022 2222  t):..        """
-00045560: 4861 6e64 6c65 7220 666f 7220 7363 726f  Handler for scro
-00045570: 6c6c 696e 6720 6368 6174 2068 6973 746f  lling chat histo
-00045580: 7279 2c20 7570 6461 7465 7320 7469 6d65  ry, updates time
-00045590: 6c69 6e65 2068 6967 686c 6967 6874 2e22  line highlight."
-000455a0: 2222 0d0a 2020 2020 2020 2020 6576 656e  ""..        even
-000455b0: 742e 536b 6970 2829 0d0a 2020 2020 2020  t.Skip()..      
-000455c0: 2020 6966 2073 656c 662e 7469 6d65 6c69    if self.timeli
-000455d0: 6e65 5f74 696d 6572 3a20 7265 7475 726e  ne_timer: return
-000455e0: 0d0a 0d0a 2020 2020 2020 2020 6465 6620  ....        def 
-000455f0: 646f 5f68 6967 686c 6967 6874 2829 3a0d  do_highlight():.
-00045600: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00045610: 6e6f 7420 7365 6c66 3a20 7265 7475 726e  not self: return
-00045620: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00045630: 6c66 2e74 696d 656c 696e 655f 7469 6d65  lf.timeline_time
-00045640: 7220 3d20 4e6f 6e65 0d0a 2020 2020 2020  r = None..      
-00045650: 2020 2020 2020 7365 6c66 2e6c 6973 745f        self.list_
-00045660: 7469 6d65 6c69 6e65 2e48 6967 686c 6967  timeline.Highlig
-00045670: 6874 526f 7773 2873 656c 662e 7374 635f  htRows(self.stc_
-00045680: 6869 7374 6f72 792e 4765 7456 6973 6962  history.GetVisib
-00045690: 6c65 4d65 7373 6167 6573 2829 290d 0a20  leMessages()).. 
-000456a0: 2020 2020 2020 2073 656c 662e 7469 6d65         self.time
-000456b0: 6c69 6e65 5f74 696d 6572 203d 2077 782e  line_timer = wx.
-000456c0: 4361 6c6c 4c61 7465 7228 3230 302c 2064  CallLater(200, d
-000456d0: 6f5f 6869 6768 6c69 6768 7429 0d0a 0d0a  o_highlight)....
-000456e0: 0d0a 2020 2020 6465 6620 6f6e 5f6d 656e  ..    def on_men
-000456f0: 755f 7369 7a65 5f63 6861 7428 7365 6c66  u_size_chat(self
-00045700: 2c20 6576 656e 7429 3a0d 0a20 2020 2020  , event):..     
-00045710: 2020 2022 2222 4861 6e64 6c65 7220 666f     """Handler fo
-00045720: 7220 636c 6963 6b69 6e67 2074 6f20 6368  r clicking to ch
-00045730: 616e 6765 2068 6973 746f 7279 2074 6578  ange history tex
-00045740: 7420 7369 7a65 2c20 6f70 656e 7320 706f  t size, opens po
-00045750: 7075 7020 6d65 6e75 2e22 2222 0d0a 2020  pup menu."""..  
-00045760: 2020 2020 2020 6d65 6e75 203d 2073 656c        menu = sel
-00045770: 662e 7374 635f 6869 7374 6f72 792e 4d61  f.stc_history.Ma
-00045780: 6b65 5a6f 6f6d 4d65 6e75 2829 0d0a 2020  keZoomMenu()..  
-00045790: 2020 2020 2020 7265 6374 203d 2063 6f6e        rect = con
-000457a0: 7472 6f6c 732e 6765 745f 746f 6f6c 5f72  trols.get_tool_r
-000457b0: 6563 7428 6576 656e 742e 4576 656e 744f  ect(event.EventO
-000457c0: 626a 6563 742c 2065 7665 6e74 2e49 6429  bject, event.Id)
-000457d0: 0d0a 2020 2020 2020 2020 6576 656e 742e  ..        event.
-000457e0: 4576 656e 744f 626a 6563 742e 506f 7075  EventObject.Popu
-000457f0: 704d 656e 7528 6d65 6e75 2c20 7265 6374  pMenu(menu, rect
-00045800: 2e4c 6566 742c 2072 6563 742e 4865 6967  .Left, rect.Heig
-00045810: 6874 290d 0a0d 0a0d 0a20 2020 2064 6566  ht)......    def
-00045820: 2073 686f 775f 7374 6174 7328 7365 6c66   show_stats(self
-00045830: 2c20 7368 6f77 3d54 7275 6529 3a0d 0a20  , show=True):.. 
-00045840: 2020 2020 2020 2022 2222 5368 6f77 7320         """Shows 
-00045850: 6f72 2068 6964 6573 2074 6865 2073 7461  or hides the sta
-00045860: 7469 7374 6963 7320 7769 6e64 6f77 2e22  tistics window."
-00045870: 2222 0d0a 2020 2020 2020 2020 6874 6d6c  ""..        html
-00045880: 2c20 7374 6320 3d20 7365 6c66 2e68 746d  , stc = self.htm
-00045890: 6c5f 7374 6174 732c 2073 656c 662e 7374  l_stats, self.st
-000458a0: 635f 6869 7374 6f72 790d 0a20 2020 2020  c_history..     
-000458b0: 2020 2063 6861 6e67 6564 203d 2046 616c     changed = Fal
-000458c0: 7365 0d0a 2020 2020 2020 2020 666f 6375  se..        focu
-000458d0: 7320 3d20 4661 6c73 650d 0a20 2020 2020  s = False..     
-000458e0: 2020 2066 6f72 2069 2069 6e20 5b68 746d     for i in [htm
-000458f0: 6c2c 2073 7463 5d3a 0d0a 2020 2020 2020  l, stc]:..      
-00045900: 2020 2020 2020 666f 6375 7320 3d20 666f        focus = fo
-00045910: 6375 7320 6f72 2028 692e 5368 6f77 6e20  cus or (i.Shown 
-00045920: 616e 6420 692e 4669 6e64 466f 6375 7328  and i.FindFocus(
-00045930: 2920 3d3d 2069 290d 0a20 2020 2020 2020  ) == i)..       
-00045940: 2073 656c 662e 7061 6e65 6c5f 7374 6331   self.panel_stc1
-00045950: 2e46 7265 657a 6528 290d 0a20 2020 2020  .Freeze()..     
-00045960: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
-00045970: 2020 2020 2069 6620 6e6f 7420 7374 632e       if not stc.
-00045980: 5368 6f77 6e20 213d 2073 686f 773a 0d0a  Shown != show:..
-00045990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000459a0: 7374 632e 5368 6f77 286e 6f74 2073 686f  stc.Show(not sho
-000459b0: 7729 0d0a 2020 2020 2020 2020 2020 2020  w)..            
-000459c0: 2020 2020 6368 616e 6765 6420 3d20 5472      changed = Tr
-000459d0: 7565 0d0a 2020 2020 2020 2020 2020 2020  ue..            
-000459e0: 6966 2068 746d 6c2e 5368 6f77 6e20 213d  if html.Shown !=
-000459f0: 2073 686f 773a 0d0a 2020 2020 2020 2020   show:..        
-00045a00: 2020 2020 2020 2020 6874 6d6c 2e53 686f          html.Sho
-00045a10: 7728 7368 6f77 290d 0a20 2020 2020 2020  w(show)..       
-00045a20: 2020 2020 2020 2020 2063 6861 6e67 6564           changed
-00045a30: 203d 2054 7275 650d 0a20 2020 2020 2020   = True..       
-00045a40: 2020 2020 2069 6620 6368 616e 6765 643a       if changed:
-00045a50: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00045a60: 2020 6966 2073 686f 773a 2073 656c 662e    if show: self.
-00045a70: 6c69 7374 5f74 696d 656c 696e 652e 4869  list_timeline.Hi
-00045a80: 6465 2829 0d0a 2020 2020 2020 2020 2020  de()..          
-00045a90: 2020 2020 2020 656c 6966 2073 656c 662e        elif self.
-00045aa0: 7462 5f63 6861 742e 4765 7454 6f6f 6c53  tb_chat.GetToolS
-00045ab0: 7461 7465 2877 782e 4944 5f4a 554d 505f  tate(wx.ID_JUMP_
-00045ac0: 544f 293a 0d0a 2020 2020 2020 2020 2020  TO):..          
-00045ad0: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
-00045ae0: 6973 745f 7469 6d65 6c69 6e65 2e53 686f  ist_timeline.Sho
-00045af0: 7728 290d 0a20 2020 2020 2020 2020 2020  w()..           
-00045b00: 2020 2020 2073 656c 662e 7462 5f63 6861       self.tb_cha
-00045b10: 742e 456e 6162 6c65 546f 6f6c 2877 782e  t.EnableTool(wx.
-00045b20: 4944 5f4a 554d 505f 544f 2c20 6e6f 7420  ID_JUMP_TO, not 
-00045b30: 7368 6f77 290d 0a20 2020 2020 2020 2020  show)..         
-00045b40: 2020 2020 2020 2073 656c 662e 7462 5f63         self.tb_c
-00045b50: 6861 742e 456e 6162 6c65 546f 6f6c 2877  hat.EnableTool(w
-00045b60: 782e 4944 5f53 4554 5550 2c20 2020 6e6f  x.ID_SETUP,   no
-00045b70: 7420 7368 6f77 290d 0a20 2020 2020 2020  t show)..       
-00045b80: 2020 2020 2020 2020 2068 746d 6c2e 436f           html.Co
-00045b90: 6e74 6169 6e69 6e67 5369 7a65 722e 4c61  ntainingSizer.La
-00045ba0: 796f 7574 2829 0d0a 2020 2020 2020 2020  yout()..        
-00045bb0: 2020 2020 2020 2020 7374 632e 436f 6e74          stc.Cont
-00045bc0: 6169 6e69 6e67 5369 7a65 722e 4c61 796f  ainingSizer.Layo
-00045bd0: 7574 2829 0d0a 2020 2020 2020 2020 2020  ut()..          
-00045be0: 2020 6966 2066 6f63 7573 3a20 2320 5377    if focus: # Sw
-00045bf0: 6974 6368 2066 6f63 7573 2074 6f20 7468  itch focus to th
-00045c00: 6520 6f74 6865 7220 636f 6e74 726f 6c20  e other control 
-00045c10: 6966 2070 7265 7669 6f75 7320 6861 6420  if previous had 
-00045c20: 666f 6375 730d 0a20 2020 2020 2020 2020  focus..         
-00045c30: 2020 2020 2020 2028 6874 6d6c 2069 6620         (html if 
-00045c40: 7368 6f77 2065 6c73 6520 7374 6329 2e53  show else stc).S
-00045c50: 6574 466f 6375 7328 290d 0a20 2020 2020  etFocus()..     
-00045c60: 2020 2020 2020 2069 6620 7368 6f77 3a0d         if show:.
-00045c70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00045c80: 2069 6620 6861 7361 7474 7228 6874 6d6c   if hasattr(html
-00045c90: 2c20 225f 6c61 7374 5f73 6372 6f6c 6c5f  , "_last_scroll_
-00045ca0: 706f 7322 293a 0d0a 2020 2020 2020 2020  pos"):..        
-00045cb0: 2020 2020 2020 2020 2020 2020 6874 6d6c              html
-00045cc0: 2e53 6372 6f6c 6c28 2a68 746d 6c2e 5f6c  .Scroll(*html._l
-00045cd0: 6173 745f 7363 726f 6c6c 5f70 6f73 290d  ast_scroll_pos).
-00045ce0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00045cf0: 2065 6c69 6620 6874 6d6c 2e4f 7065 6e65   elif html.Opene
-00045d00: 6441 6e63 686f 723a 2068 746d 6c2e 5363  dAnchor: html.Sc
-00045d10: 726f 6c6c 546f 416e 6368 6f72 2868 746d  rollToAnchor(htm
-00045d20: 6c2e 4f70 656e 6564 416e 6368 6f72 290d  l.OpenedAnchor).
-00045d30: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-00045d40: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00045d50: 2020 2020 7365 6c66 2e6c 6973 745f 7469      self.list_ti
-00045d60: 6d65 6c69 6e65 2e52 6566 7265 7368 4974  meline.RefreshIt
-00045d70: 656d 7328 290d 0a20 2020 2020 2020 2020  ems()..         
-00045d80: 2020 2073 656c 662e 7462 5f63 6861 742e     self.tb_chat.
-00045d90: 546f 6767 6c65 546f 6f6c 2877 782e 4944  ToggleTool(wx.ID
-00045da0: 5f50 524f 5045 5254 4945 532c 2073 686f  _PROPERTIES, sho
-00045db0: 7729 0d0a 2020 2020 2020 2020 6669 6e61  w)..        fina
-00045dc0: 6c6c 793a 2073 656c 662e 7061 6e65 6c5f  lly: self.panel_
-00045dd0: 7374 6331 2e54 6861 7728 290d 0a0d 0a0d  stc1.Thaw().....
-00045de0: 0a20 2020 2064 6566 206f 6e5f 6275 7474  .    def on_butt
-00045df0: 6f6e 5f72 6573 6574 5f67 7269 6428 7365  on_reset_grid(se
-00045e00: 6c66 2c20 6576 656e 7429 3a0d 0a20 2020  lf, event):..   
-00045e10: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-00045e20: 2020 4861 6e64 6c65 7220 666f 7220 636c    Handler for cl
-00045e30: 6963 6b69 6e67 2074 6f20 7265 6d6f 7665  icking to remove
-00045e40: 2073 6f72 7469 6e67 2061 6e64 2066 696c   sorting and fil
-00045e50: 7465 7269 6e67 206f 6e20 6120 6772 6964  tering on a grid
-00045e60: 2c0d 0a20 2020 2020 2020 2072 6573 6574  ,..        reset
-00045e70: 7320 7468 6520 6772 6964 2061 6e64 2069  s the grid and i
-00045e80: 7473 2076 6965 772e 0d0a 2020 2020 2020  ts view...      
-00045e90: 2020 2222 220d 0a20 2020 2020 2020 2069    """..        i
-00045ea0: 735f 7461 626c 6520 3d20 2865 7665 6e74  s_table = (event
-00045eb0: 2e45 7665 6e74 4f62 6a65 6374 203d 3d20  .EventObject == 
-00045ec0: 7365 6c66 2e62 7574 746f 6e5f 7265 7365  self.button_rese
-00045ed0: 745f 6772 6964 5f74 6162 6c65 290d 0a20  t_grid_table).. 
-00045ee0: 2020 2020 2020 2067 7269 6420 3d20 7365         grid = se
-00045ef0: 6c66 2e67 7269 645f 7461 626c 6520 6966  lf.grid_table if
-00045f00: 2069 735f 7461 626c 6520 656c 7365 2073   is_table else s
-00045f10: 656c 662e 6772 6964 5f73 716c 0d0a 2020  elf.grid_sql..  
-00045f20: 2020 2020 2020 6966 2067 7269 642e 5461        if grid.Ta
-00045f30: 626c 6520 616e 6420 6973 696e 7374 616e  ble and isinstan
-00045f40: 6365 2867 7269 642e 5461 626c 652c 2053  ce(grid.Table, S
-00045f50: 716c 6974 6547 7269 6442 6173 6529 3a0d  qliteGridBase):.
-00045f60: 0a20 2020 2020 2020 2020 2020 2067 7269  .            gri
-00045f70: 642e 5461 626c 652e 436c 6561 7253 6f72  d.Table.ClearSor
-00045f80: 7428 7265 6672 6573 683d 4661 6c73 6529  t(refresh=False)
-00045f90: 0d0a 2020 2020 2020 2020 2020 2020 6772  ..            gr
-00045fa0: 6964 2e54 6162 6c65 2e43 6c65 6172 4669  id.Table.ClearFi
-00045fb0: 6c74 6572 2829 0d0a 2020 2020 2020 2020  lter()..        
-00045fc0: 2020 2020 6772 6964 2e43 6f6e 7461 696e      grid.Contain
-00045fd0: 696e 6753 697a 6572 2e4c 6179 6f75 7428  ingSizer.Layout(
-00045fe0: 2920 2320 5265 6163 7420 746f 2067 7269  ) # React to gri
-00045ff0: 6420 7369 7a65 2063 6861 6e67 650d 0a0d  d size change...
-00046000: 0a0d 0a20 2020 2064 6566 206f 6e5f 6275  ...    def on_bu
-00046010: 7474 6f6e 5f65 7870 6f72 745f 6772 6964  tton_export_grid
-00046020: 2873 656c 662c 2065 7665 6e74 293a 0d0a  (self, event):..
-00046030: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
-00046040: 2020 2020 2048 616e 646c 6572 2066 6f72       Handler for
-00046050: 2063 6c69 636b 696e 6720 746f 2065 7870   clicking to exp
-00046060: 6f72 7420 7778 2e47 7269 6420 636f 6e74  ort wx.Grid cont
-00046070: 656e 7473 2074 6f20 6669 6c65 2c20 616c  ents to file, al
-00046080: 6c6f 7773 2074 6865 0d0a 2020 2020 2020  lows the..      
-00046090: 2020 7573 6572 2074 6f20 7365 6c65 6374    user to select
-000460a0: 2066 696c 656e 616d 6520 616e 6420 7479   filename and ty
-000460b0: 7065 2061 6e64 2063 7265 6174 6573 2074  pe and creates t
-000460c0: 6865 2066 696c 652e 0d0a 2020 2020 2020  he file...      
-000460d0: 2020 2222 220d 0a20 2020 2020 2020 2067    """..        g
-000460e0: 7269 645f 736f 7572 6365 203d 2073 656c  rid_source = sel
-000460f0: 662e 6772 6964 5f74 6162 6c65 0d0a 2020  f.grid_table..  
-00046100: 2020 2020 2020 7371 6c20 3d20 2222 0d0a        sql = ""..
-00046110: 2020 2020 2020 2020 7461 626c 6520 3d20          table = 
-00046120: 2222 0d0a 2020 2020 2020 2020 6966 2065  ""..        if e
-00046130: 7665 6e74 2e45 7665 6e74 4f62 6a65 6374  vent.EventObject
-00046140: 2069 7320 7365 6c66 2e62 7574 746f 6e5f   is self.button_
-00046150: 6578 706f 7274 5f73 716c 3a0d 0a20 2020  export_sql:..   
-00046160: 2020 2020 2020 2020 2067 7269 645f 736f           grid_so
-00046170: 7572 6365 203d 2073 656c 662e 6772 6964  urce = self.grid
-00046180: 5f73 716c 0d0a 2020 2020 2020 2020 2020  _sql..          
-00046190: 2020 7371 6c20 3d20 6765 7461 7474 7228    sql = getattr(
-000461a0: 7365 6c66 2c20 226c 6173 745f 7371 6c22  self, "last_sql"
-000461b0: 2c20 2222 290d 0a20 2020 2020 2020 2069  , "")..        i
-000461c0: 6620 6772 6964 5f73 6f75 7263 652e 5461  f grid_source.Ta
-000461d0: 626c 653a 0d0a 2020 2020 2020 2020 2020  ble:..          
-000461e0: 2020 6966 2067 7269 645f 736f 7572 6365    if grid_source
-000461f0: 2069 7320 7365 6c66 2e67 7269 645f 7461   is self.grid_ta
-00046200: 626c 653a 0d0a 2020 2020 2020 2020 2020  ble:..          
-00046210: 2020 2020 2020 7461 626c 6520 3d20 7365        table = se
-00046220: 6c66 2e64 622e 7461 626c 6573 5b67 7269  lf.db.tables[gri
-00046230: 645f 736f 7572 6365 2e54 6162 6c65 2e74  d_source.Table.t
-00046240: 6162 6c65 2e6c 6f77 6572 2829 5d5b 226e  able.lower()]["n
-00046250: 616d 6522 5d0d 0a20 2020 2020 2020 2020  ame"]..         
-00046260: 2020 2020 2020 2074 6974 6c65 203d 2022         title = "
-00046270: 5461 626c 6520 2d20 5c22 2573 5c22 2220  Table - \"%s\"" 
-00046280: 2520 7461 626c 650d 0a20 2020 2020 2020  % table..       
-00046290: 2020 2020 2020 2020 2073 656c 662e 6469           self.di
-000462a0: 616c 6f67 5f73 6176 6567 7269 642e 4d65  alog_savegrid.Me
-000462b0: 7373 6167 6520 3d20 2253 6176 6520 7461  ssage = "Save ta
-000462c0: 626c 6520 6173 220d 0a20 2020 2020 2020  ble as"..       
-000462d0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-000462e0: 2020 2020 2020 2020 2020 2020 7469 746c              titl
-000462f0: 6520 3d20 2253 514c 2071 7565 7279 220d  e = "SQL query".
-00046300: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00046310: 2073 656c 662e 6469 616c 6f67 5f73 6176   self.dialog_sav
-00046320: 6567 7269 642e 4d65 7373 6167 6520 3d20  egrid.Message = 
-00046330: 2253 6176 6520 7175 6572 7920 6173 220d  "Save query as".
-00046340: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00046350: 2067 7269 645f 736f 7572 6365 2e54 6162   grid_source.Tab
-00046360: 6c65 2e53 6565 6b41 6865 6164 2854 7275  le.SeekAhead(Tru
-00046370: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
-00046380: 7365 6c66 2e64 6961 6c6f 675f 7361 7665  self.dialog_save
-00046390: 6772 6964 2e46 696c 656e 616d 6520 3d20  grid.Filename = 
-000463a0: 7574 696c 2e73 6166 655f 6669 6c65 6e61  util.safe_filena
-000463b0: 6d65 2874 6974 6c65 290d 0a20 2020 2020  me(title)..     
-000463c0: 2020 2020 2020 2069 6620 7778 2e49 445f         if wx.ID_
-000463d0: 4f4b 203d 3d20 7365 6c66 2e64 6961 6c6f  OK == self.dialo
-000463e0: 675f 7361 7665 6772 6964 2e53 686f 774d  g_savegrid.ShowM
-000463f0: 6f64 616c 2829 3a0d 0a20 2020 2020 2020  odal():..       
-00046400: 2020 2020 2020 2020 2066 696c 656e 616d           filenam
-00046410: 6520 3d20 636f 6e74 726f 6c73 2e67 6574  e = controls.get
-00046420: 5f64 6961 6c6f 675f 7061 7468 2873 656c  _dialog_path(sel
-00046430: 662e 6469 616c 6f67 5f73 6176 6567 7269  f.dialog_savegri
-00046440: 6429 0d0a 2020 2020 2020 2020 2020 2020  d)..            
-00046450: 2020 2020 666f 726d 6174 203d 2065 7870      format = exp
-00046460: 6f72 742e 4441 5441 5f45 5854 535b 7365  ort.DATA_EXTS[se
-00046470: 6c66 2e64 6961 6c6f 675f 7361 7665 6772  lf.dialog_savegr
-00046480: 6964 2e46 696c 7465 7249 6e64 6578 5d0d  id.FilterIndex].
-00046490: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000464a0: 2062 7573 7920 3d20 636f 6e74 726f 6c73   busy = controls
-000464b0: 2e42 7573 7950 616e 656c 2873 656c 662c  .BusyPanel(self,
-000464c0: 2022 4578 706f 7274 696e 6720 5c22 2573   "Exporting \"%s
-000464d0: 5c22 2e22 2025 2066 696c 656e 616d 6529  \"." % filename)
-000464e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000464f0: 2020 6775 6962 6173 652e 7374 6174 7573    guibase.status
-00046500: 2822 4578 706f 7274 696e 6720 5c22 2573  ("Exporting \"%s
-00046510: 5c22 2e22 2c20 6669 6c65 6e61 6d65 290d  \".", filename).
-00046520: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00046530: 2074 7279 3a0d 0a20 2020 2020 2020 2020   try:..         
-00046540: 2020 2020 2020 2020 2020 2065 7870 6f72             expor
-00046550: 742e 6578 706f 7274 5f67 7269 6428 6772  t.export_grid(gr
-00046560: 6964 5f73 6f75 7263 652c 2066 696c 656e  id_source, filen
-00046570: 616d 652c 2074 6974 6c65 2c0d 0a20 2020  ame, title,..   
-00046580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000465a0: 2020 2020 7365 6c66 2e64 622c 2073 716c      self.db, sql
-000465b0: 2c20 7461 626c 6529 0d0a 2020 2020 2020  , table)..      
-000465c0: 2020 2020 2020 2020 2020 2020 2020 6775                gu
-000465d0: 6962 6173 652e 7374 6174 7573 2822 4578  ibase.status("Ex
-000465e0: 706f 7274 6564 2025 732e 222c 2066 696c  ported %s.", fil
-000465f0: 656e 616d 652c 206c 6f67 3d54 7275 6529  ename, log=True)
-00046600: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00046610: 2020 2020 2020 6966 2063 6f6e 662e 4578        if conf.Ex
-00046620: 706f 7274 4669 6c65 4175 746f 4f70 656e  portFileAutoOpen
-00046630: 3a20 7574 696c 2e73 7461 7274 5f66 696c  : util.start_fil
-00046640: 6528 6669 6c65 6e61 6d65 290d 0a20 2020  e(filename)..   
-00046650: 2020 2020 2020 2020 2020 2020 2065 7863               exc
-00046660: 6570 7420 4578 6365 7074 696f 6e20 6173  ept Exception as
-00046670: 2065 3a0d 0a20 2020 2020 2020 2020 2020   e:..           
-00046680: 2020 2020 2020 2020 2067 7569 6261 7365           guibase
-00046690: 2e73 7461 7475 7328 2245 7272 6f72 2073  .status("Error s
-000466a0: 6176 696e 6720 2573 3a20 2573 222c 2066  aving %s: %s", f
-000466b0: 696c 656e 616d 652c 2075 7469 6c2e 666f  ilename, util.fo
-000466c0: 726d 6174 5f65 7863 2865 2929 0d0a 2020  rmat_exc(e))..  
-000466d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000466e0: 2020 6c6f 6767 6572 2e65 7863 6570 7469    logger.excepti
-000466f0: 6f6e 2822 4572 726f 7220 7361 7669 6e67  on("Error saving
-00046700: 2025 732e 222c 2066 696c 656e 616d 6529   %s.", filename)
+000445e0: 6d28 6929 2e49 7343 6865 636b 6564 2829  m(i).IsChecked()
+000445f0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00044600: 2020 2069 6465 6e74 6974 7920 3d20 7365     identity = se
+00044610: 6c66 2e6c 6973 745f 7061 7274 6963 6970  lf.list_particip
+00044620: 616e 7473 2e47 6574 4974 656d 4461 7461  ants.GetItemData
+00044630: 2869 295b 2269 6465 6e74 6974 7922 5d0d  (i)["identity"].
+00044640: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00044650: 2069 6620 6964 656e 7469 7479 2069 6e20   if identity in 
+00044660: 7365 6c66 2e63 6861 745f 6669 6c74 6572  self.chat_filter
+00044670: 5b22 7061 7274 6963 6970 616e 7473 225d  ["participants"]
+00044680: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00044690: 2020 2020 2020 2072 6573 656c 6563 7465         reselecte
+000446a0: 6473 2e61 7070 656e 6428 6929 0d0a 2020  ds.append(i)..  
+000446b0: 2020 2020 2020 6966 2072 6573 656c 6563        if reselec
+000446c0: 7465 6473 3a0d 0a20 2020 2020 2020 2020  teds:..         
+000446d0: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
+000446e0: 6528 7365 6c66 2e6c 6973 745f 7061 7274  e(self.list_part
+000446f0: 6963 6970 616e 7473 2e47 6574 4974 656d  icipants.GetItem
+00044700: 436f 756e 7428 2929 3a0d 0a20 2020 2020  Count()):..     
+00044710: 2020 2020 2020 2020 2020 2069 6465 6e74             ident
+00044720: 6974 7920 3d20 7365 6c66 2e6c 6973 745f  ity = self.list_
+00044730: 7061 7274 6963 6970 616e 7473 2e47 6574  participants.Get
+00044740: 4974 656d 4461 7461 2869 295b 2269 6465  ItemData(i)["ide
+00044750: 6e74 6974 7922 5d0d 0a20 2020 2020 2020  ntity"]..       
+00044760: 2020 2020 2020 2020 2069 6620 6964 656e           if iden
+00044770: 7469 7479 2069 6e20 7265 7365 6c65 6374  tity in reselect
+00044780: 6564 733a 0d0a 2020 2020 2020 2020 2020  eds:..          
+00044790: 2020 2020 2020 2020 2020 6320 3d20 7365            c = se
+000447a0: 6c66 2e6c 6973 745f 7061 7274 6963 6970  lf.list_particip
+000447b0: 616e 7473 2e47 6574 4974 656d 2869 290d  ants.GetItem(i).
+000447c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000447d0: 2020 2020 2063 2e43 6865 636b 2854 7275       c.Check(Tru
+000447e0: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+000447f0: 2020 2020 2020 2020 7365 6c66 2e6c 6973          self.lis
+00044800: 745f 7061 7274 6963 6970 616e 7473 2e53  t_participants.S
+00044810: 6574 4974 656d 2863 290d 0a20 2020 2020  etItem(c)..     
+00044820: 2020 2020 2020 2073 656c 662e 6c69 7374         self.list
+00044830: 5f70 6172 7469 6369 7061 6e74 732e 5265  _participants.Re
+00044840: 6672 6573 6828 290d 0a20 2020 2020 2020  fresh()..       
+00044850: 2070 6172 7469 6369 7061 6e74 7320 3d20   participants = 
+00044860: 5b5d 0d0a 2020 2020 2020 2020 666f 7220  []..        for 
+00044870: 6920 696e 2072 616e 6765 2873 656c 662e  i in range(self.
+00044880: 6c69 7374 5f70 6172 7469 6369 7061 6e74  list_participant
+00044890: 732e 4765 7449 7465 6d43 6f75 6e74 2829  s.GetItemCount()
+000448a0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+000448b0: 6966 2073 656c 662e 6c69 7374 5f70 6172  if self.list_par
+000448c0: 7469 6369 7061 6e74 732e 4973 4974 656d  ticipants.IsItem
+000448d0: 4368 6563 6b65 6428 6929 3a0d 0a20 2020  Checked(i):..   
+000448e0: 2020 2020 2020 2020 2020 2020 2069 6465               ide
+000448f0: 6e74 6974 7920 3d20 7365 6c66 2e6c 6973  ntity = self.lis
+00044900: 745f 7061 7274 6963 6970 616e 7473 2e47  t_participants.G
+00044910: 6574 4974 656d 4461 7461 2869 295b 2269  etItemData(i)["i
+00044920: 6465 6e74 6974 7922 5d0d 0a20 2020 2020  dentity"]..     
+00044930: 2020 2020 2020 2020 2020 2070 6172 7469             parti
+00044940: 6369 7061 6e74 732e 6170 7065 6e64 2869  cipants.append(i
+00044950: 6465 6e74 6974 7929 0d0a 2020 2020 2020  dentity)..      
+00044960: 2020 6669 6c74 6572 6461 7461 203d 207b    filterdata = {
+00044970: 0d0a 2020 2020 2020 2020 2020 2020 2264  ..            "d
+00044980: 6174 6572 616e 6765 223a 2073 656c 662e  aterange": self.
+00044990: 7261 6e67 655f 6461 7465 2e56 616c 7565  range_date.Value
+000449a0: 732c 0d0a 2020 2020 2020 2020 2020 2020  s,..            
+000449b0: 2274 6578 7422 3a20 7365 6c66 2e65 6469  "text": self.edi
+000449c0: 745f 6669 6c74 6572 7465 7874 2e56 616c  t_filtertext.Val
+000449d0: 7565 2c0d 0a20 2020 2020 2020 2020 2020  ue,..           
+000449e0: 2022 7061 7274 6963 6970 616e 7473 223a   "participants":
+000449f0: 2070 6172 7469 6369 7061 6e74 730d 0a20   participants.. 
+00044a00: 2020 2020 2020 207d 0d0a 2020 2020 2020         }..      
+00044a10: 2020 7265 7475 726e 2066 696c 7465 7264    return filterd
+00044a20: 6174 610d 0a0d 0a0d 0a20 2020 2064 6566  ata......    def
+00044a30: 2063 6d70 5f66 696c 7465 7228 7365 6c66   cmp_filter(self
+00044a40: 2c20 6669 6c74 6572 6461 7461 293a 0d0a  , filterdata):..
+00044a50: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
+00044a60: 6e73 2077 6865 7468 6572 2063 6861 7420  ns whether chat 
+00044a70: 6669 6c74 6572 2064 6174 6120 6973 2073  filter data is s
+00044a80: 616d 6520 6173 2063 7572 7265 6e74 6c79  ame as currently
+00044a90: 2061 7070 6c69 6564 2e22 2222 0d0a 2020   applied."""..  
+00044aa0: 2020 2020 2020 6f6c 645f 6669 6c74 6572        old_filter
+00044ab0: 203d 2073 656c 662e 7374 635f 6869 7374   = self.stc_hist
+00044ac0: 6f72 792e 4669 6c74 6572 0d0a 2020 2020  ory.Filter..    
+00044ad0: 2020 2020 6966 2022 7465 7874 2220 6e6f      if "text" no
+00044ae0: 7420 696e 206f 6c64 5f66 696c 7465 723a  t in old_filter:
+00044af0: 206f 6c64 5f66 696c 7465 725b 2274 6578   old_filter["tex
+00044b00: 7422 5d20 3d20 2222 0d0a 2020 2020 2020  t"] = ""..      
+00044b10: 2020 6966 2022 7061 7274 6963 6970 616e    if "participan
+00044b20: 7473 2220 6e6f 7420 696e 206f 6c64 5f66  ts" not in old_f
+00044b30: 696c 7465 723a 0d0a 2020 2020 2020 2020  ilter:..        
+00044b40: 2020 2020 6576 6572 796f 6e65 203d 205b      everyone = [
+00044b50: 785b 2269 6465 6e74 6974 7922 5d20 666f  x["identity"] fo
+00044b60: 7220 7820 696e 2073 656c 662e 6368 6174  r x in self.chat
+00044b70: 5b22 7061 7274 6963 6970 616e 7473 225d  ["participants"]
+00044b80: 5d0d 0a20 2020 2020 2020 2020 2020 206f  ]..            o
+00044b90: 6c64 5f66 696c 7465 725b 2270 6172 7469  ld_filter["parti
+00044ba0: 6369 7061 6e74 7322 5d20 3d20 6576 6572  cipants"] = ever
+00044bb0: 796f 6e65 0d0a 2020 2020 2020 2020 7265  yone..        re
+00044bc0: 7475 726e 2075 7469 6c2e 636d 705f 6469  turn util.cmp_di
+00044bd0: 6374 7328 6669 6c74 6572 6461 7461 2c20  cts(filterdata, 
+00044be0: 6f6c 645f 6669 6c74 6572 290d 0a0d 0a0d  old_filter).....
+00044bf0: 0a20 2020 2064 6566 206f 6e5f 746f 6767  .    def on_togg
+00044c00: 6c65 5f66 696c 7465 7228 7365 6c66 2c20  le_filter(self, 
+00044c10: 6576 656e 7429 3a0d 0a20 2020 2020 2020  event):..       
+00044c20: 2022 2222 4861 6e64 6c65 7220 666f 7220   """Handler for 
+00044c30: 636c 6963 6b69 6e67 2074 6f20 7368 6f77  clicking to show
+00044c40: 2f68 6964 6520 6368 6174 2066 696c 7465  /hide chat filte
+00044c50: 722e 2222 220d 0a20 2020 2020 2020 2073  r."""..        s
+00044c60: 656c 662e 746f 6767 6c65 5f66 696c 7465  elf.toggle_filte
+00044c70: 7228 6e6f 7420 7365 6c66 2e73 706c 6974  r(not self.split
+00044c80: 7465 725f 7374 632e 4973 5370 6c69 7428  ter_stc.IsSplit(
+00044c90: 2929 0d0a 0d0a 0d0a 2020 2020 6465 6620  ))......    def 
+00044ca0: 6f6e 5f74 6f67 676c 655f 7374 6174 7328  on_toggle_stats(
+00044cb0: 7365 6c66 2c20 6576 656e 7429 3a0d 0a20  self, event):.. 
+00044cc0: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
+00044cd0: 2020 2020 4861 6e64 6c65 7220 666f 7220      Handler for 
+00044ce0: 636c 6963 6b69 6e67 2074 6f20 7368 6f77  clicking to show
+00044cf0: 2f68 6964 6520 7374 6174 6973 7469 6373  /hide statistics
+00044d00: 2066 6f72 2063 6861 742c 2074 6f67 676c   for chat, toggl
+00044d10: 6573 2064 6973 706c 6179 0d0a 2020 2020  es display..    
+00044d20: 2020 2020 6265 7477 6565 6e20 6368 6174      between chat
+00044d30: 2068 6973 746f 7279 2077 696e 646f 7720   history window 
+00044d40: 616e 6420 7374 6174 6973 7469 6373 2077  and statistics w
+00044d50: 696e 646f 772e 0d0a 2020 2020 2020 2020  indow...        
+00044d60: 2222 220d 0a20 2020 2020 2020 2068 746d  """..        htm
+00044d70: 6c2c 2073 7463 203d 2073 656c 662e 6874  l, stc = self.ht
+00044d80: 6d6c 5f73 7461 7473 2c20 7365 6c66 2e73  ml_stats, self.s
+00044d90: 7463 5f68 6973 746f 7279 0d0a 2020 2020  tc_history..    
+00044da0: 2020 2020 7365 6c66 2e73 686f 775f 7374      self.show_st
+00044db0: 6174 7328 6e6f 7420 6874 6d6c 2e53 686f  ats(not html.Sho
+00044dc0: 776e 290d 0a20 2020 2020 2020 2028 6874  wn)..        (ht
+00044dd0: 6d6c 2069 6620 6874 6d6c 2e53 686f 776e  ml if html.Shown
+00044de0: 2065 6c73 6520 7374 6329 2e53 6574 466f   else stc).SetFo
+00044df0: 6375 7328 290d 0a0d 0a0d 0a20 2020 2064  cus()......    d
+00044e00: 6566 206f 6e5f 746f 6767 6c65 5f6d 6178  ef on_toggle_max
+00044e10: 696d 697a 6528 7365 6c66 2c20 6576 656e  imize(self, even
+00044e20: 7429 3a0d 0a20 2020 2020 2020 2022 2222  t):..        """
+00044e30: 4861 6e64 6c65 7220 666f 7220 746f 6767  Handler for togg
+00044e40: 6c69 6e67 2074 6f20 6d61 7869 6d69 7a65  ling to maximize
+00044e50: 2063 6861 7420 7769 6e64 6f77 2061 6e64   chat window and
+00044e60: 2068 6964 6520 6368 6174 206c 6973 742e   hide chat list.
+00044e70: 2222 220d 0a20 2020 2020 2020 2073 706c  """..        spl
+00044e80: 6974 7465 7220 3d20 7365 6c66 2e73 706c  itter = self.spl
+00044e90: 6974 7465 725f 6368 6174 730d 0a20 2020  itter_chats..   
+00044ea0: 2020 2020 2069 6620 7370 6c69 7474 6572       if splitter
+00044eb0: 2e49 7353 706c 6974 2829 3a0d 0a20 2020  .IsSplit():..   
+00044ec0: 2020 2020 2020 2020 2073 706c 6974 7465           splitte
+00044ed0: 722e 5f73 6173 6850 6f73 6974 696f 6e20  r._sashPosition 
+00044ee0: 3d20 7370 6c69 7474 6572 2e53 6173 6850  = splitter.SashP
+00044ef0: 6f73 6974 696f 6e0d 0a20 2020 2020 2020  osition..       
+00044f00: 2020 2020 2073 706c 6974 7465 722e 556e       splitter.Un
+00044f10: 7370 6c69 7428 7365 6c66 2e70 616e 656c  split(self.panel
+00044f20: 5f63 6861 7473 3129 0d0a 2020 2020 2020  _chats1)..      
+00044f30: 2020 2020 2020 7368 6f72 7468 656c 7020        shorthelp 
+00044f40: 3d20 2252 6573 746f 7265 2063 6861 7420  = "Restore chat 
+00044f50: 7061 6e65 6c20 746f 2064 6566 6175 6c74  panel to default
+00044f60: 2073 697a 6520 2028 416c 742d 4d29 220d   size  (Alt-M)".
+00044f70: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
+00044f80: 2020 2020 2020 2020 2020 2020 706f 7320              pos 
+00044f90: 3d20 6765 7461 7474 7228 7370 6c69 7474  = getattr(splitt
+00044fa0: 6572 2c20 225f 7361 7368 506f 7369 7469  er, "_sashPositi
+00044fb0: 6f6e 222c 2073 656c 662e 5369 7a65 5b31  on", self.Size[1
+00044fc0: 5d20 2f2f 2033 290d 0a20 2020 2020 2020  ] // 3)..       
+00044fd0: 2020 2020 2073 706c 6974 7465 722e 5370       splitter.Sp
+00044fe0: 6c69 7448 6f72 697a 6f6e 7461 6c6c 7928  litHorizontally(
+00044ff0: 7365 6c66 2e70 616e 656c 5f63 6861 7473  self.panel_chats
+00045000: 312c 2073 656c 662e 7061 6e65 6c5f 6368  1, self.panel_ch
+00045010: 6174 7332 2c0d 0a20 2020 2020 2020 2020  ats2,..         
+00045020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00045030: 2020 2020 2020 2020 2020 2020 2020 7361                sa
+00045040: 7368 506f 7369 7469 6f6e 3d70 6f73 290d  shPosition=pos).
+00045050: 0a20 2020 2020 2020 2020 2020 2073 686f  .            sho
+00045060: 7274 6865 6c70 203d 2022 4d61 7869 6d69  rthelp = "Maximi
+00045070: 7a65 2063 6861 7420 7061 6e65 6c20 2028  ze chat panel  (
+00045080: 416c 742d 4d29 220d 0a20 2020 2020 2020  Alt-M)"..       
+00045090: 2073 656c 662e 7462 5f63 6861 742e 5365   self.tb_chat.Se
+000450a0: 7454 6f6f 6c53 686f 7274 4865 6c70 2877  tToolShortHelp(w
+000450b0: 782e 4944 5f5a 4f4f 4d5f 3130 302c 2073  x.ID_ZOOM_100, s
+000450c0: 686f 7274 6865 6c70 290d 0a0d 0a0d 0a20  horthelp)...... 
+000450d0: 2020 2064 6566 206f 6e5f 746f 6767 6c65     def on_toggle
+000450e0: 5f74 696d 656c 696e 6528 7365 6c66 2c20  _timeline(self, 
+000450f0: 6576 656e 7429 3a0d 0a20 2020 2020 2020  event):..       
+00045100: 2022 2222 4861 6e64 6c65 7220 666f 7220   """Handler for 
+00045110: 746f 6767 6c69 6e67 2074 6f20 7368 6f77  toggling to show
+00045120: 2f68 6964 6520 6368 6174 2074 696d 656c  /hide chat timel
+00045130: 696e 652e 2222 220d 0a20 2020 2020 2020  ine."""..       
+00045140: 2073 656c 662e 7061 6e65 6c5f 7374 6331   self.panel_stc1
+00045150: 2e46 7265 657a 6528 290d 0a20 2020 2020  .Freeze()..     
+00045160: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
+00045170: 2020 2020 2073 656c 662e 6c69 7374 5f74       self.list_t
+00045180: 696d 656c 696e 652e 5368 6f77 286e 6f74  imeline.Show(not
+00045190: 2073 656c 662e 6c69 7374 5f74 696d 656c   self.list_timel
+000451a0: 696e 652e 5368 6f77 6e29 0d0a 2020 2020  ine.Shown)..    
+000451b0: 2020 2020 2020 2020 7365 6c66 2e6c 6973          self.lis
+000451c0: 745f 7469 6d65 6c69 6e65 2e43 6f6e 7461  t_timeline.Conta
+000451d0: 696e 696e 6753 697a 6572 2e4c 6179 6f75  iningSizer.Layou
+000451e0: 7428 290d 0a20 2020 2020 2020 2066 696e  t()..        fin
+000451f0: 616c 6c79 3a20 7365 6c66 2e70 616e 656c  ally: self.panel
+00045200: 5f73 7463 312e 5468 6177 2829 0d0a 2020  _stc1.Thaw()..  
+00045210: 2020 2020 2020 7365 6c66 2e6c 6973 745f        self.list_
+00045220: 7469 6d65 6c69 6e65 2e52 6566 7265 7368  timeline.Refresh
+00045230: 4974 656d 7328 290d 0a0d 0a0d 0a20 2020  Items()......   
+00045240: 2064 6566 2074 6f67 676c 655f 6669 6c74   def toggle_filt
+00045250: 6572 2873 656c 662c 206f 6e29 3a0d 0a20  er(self, on):.. 
+00045260: 2020 2020 2020 2022 2222 546f 6767 6c65         """Toggle
+00045270: 7320 7468 6520 6368 6174 2066 696c 7465  s the chat filte
+00045280: 7220 7061 6e65 6c20 6f6e 2f6f 6666 2e22  r panel on/off."
+00045290: 2222 0d0a 2020 2020 2020 2020 6966 2073  ""..        if s
+000452a0: 656c 662e 7370 6c69 7474 6572 5f73 7463  elf.splitter_stc
+000452b0: 2e49 7353 706c 6974 2829 2061 6e64 206e  .IsSplit() and n
+000452c0: 6f74 206f 6e3a 0d0a 2020 2020 2020 2020  ot on:..        
+000452d0: 2020 2020 7365 6c66 2e73 706c 6974 7465      self.splitte
+000452e0: 725f 7374 632e 5f73 6173 6850 6f73 6974  r_stc._sashPosit
+000452f0: 696f 6e20 3d20 7365 6c66 2e73 706c 6974  ion = self.split
+00045300: 7465 725f 7374 632e 5361 7368 506f 7369  ter_stc.SashPosi
+00045310: 7469 6f6e 0d0a 2020 2020 2020 2020 2020  tion..          
+00045320: 2020 7365 6c66 2e73 706c 6974 7465 725f    self.splitter_
+00045330: 7374 632e 556e 7370 6c69 7428 7365 6c66  stc.Unsplit(self
+00045340: 2e70 616e 656c 5f73 7463 3229 0d0a 2020  .panel_stc2)..  
+00045350: 2020 2020 2020 656c 6966 206e 6f74 2073        elif not s
+00045360: 656c 662e 7370 6c69 7474 6572 5f73 7463  elf.splitter_stc
+00045370: 2e49 7353 706c 6974 2829 2061 6e64 206f  .IsSplit() and o
+00045380: 6e3a 0d0a 2020 2020 2020 2020 2020 2020  n:..            
+00045390: 7020 3d20 6765 7461 7474 7228 7365 6c66  p = getattr(self
+000453a0: 2e73 706c 6974 7465 725f 7374 632c 2022  .splitter_stc, "
+000453b0: 5f73 6173 6850 6f73 6974 696f 6e22 2c0d  _sashPosition",.
+000453c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000453d0: 2073 656c 662e 7370 6c69 7474 6572 5f73   self.splitter_s
+000453e0: 7463 2e53 697a 652e 7769 6474 6820 2d20  tc.Size.width - 
+000453f0: 7365 6c66 2e70 616e 656c 5f73 7463 322e  self.panel_stc2.
+00045400: 4265 7374 5369 7a65 2e77 6964 7468 290d  BestSize.width).
+00045410: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00045420: 662e 7370 6c69 7474 6572 5f73 7463 2e53  f.splitter_stc.S
+00045430: 706c 6974 5665 7274 6963 616c 6c79 2873  plitVertically(s
+00045440: 656c 662e 7061 6e65 6c5f 7374 6331 2c20  elf.panel_stc1, 
+00045450: 7365 6c66 2e70 616e 656c 5f73 7463 322c  self.panel_stc2,
+00045460: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00045470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00045480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00045490: 7361 7368 506f 7369 7469 6f6e 3d70 290d  sashPosition=p).
+000454a0: 0a20 2020 2020 2020 2020 2020 206c 6973  .            lis
+000454b0: 745f 7061 7274 6963 6970 616e 7473 203d  t_participants =
+000454c0: 2073 656c 662e 6c69 7374 5f70 6172 7469   self.list_parti
+000454d0: 6369 7061 6e74 730d 0a20 2020 2020 2020  cipants..       
+000454e0: 2020 2020 206c 6973 745f 7061 7274 6963       list_partic
+000454f0: 6970 616e 7473 2e53 6574 436f 6c75 6d6e  ipants.SetColumn
+00045500: 5769 6474 6828 302c 206c 6973 745f 7061  Width(0, list_pa
+00045510: 7274 6963 6970 616e 7473 2e53 697a 652e  rticipants.Size.
+00045520: 7769 6474 6829 0d0a 0d0a 0d0a 2020 2020  width)......    
+00045530: 6465 6620 6f6e 5f73 656c 6563 745f 7469  def on_select_ti
+00045540: 6d65 6c69 6e65 2873 656c 662c 2065 7665  meline(self, eve
+00045550: 6e74 293a 0d0a 2020 2020 2020 2020 2222  nt):..        ""
+00045560: 2248 616e 646c 6572 2066 6f72 2073 656c  "Handler for sel
+00045570: 6563 7469 6e67 2061 2074 696d 6520 696e  ecting a time in
+00045580: 2074 696d 656c 696e 6520 636f 6e74 726f   timeline contro
+00045590: 6c2c 2066 6f63 7573 6573 206d 6573 7361  l, focuses messa
+000455a0: 6765 2069 6e20 5354 4322 2222 0d0a 2020  ge in STC"""..  
+000455b0: 2020 2020 2020 6d73 675f 6964 203d 2073        msg_id = s
+000455c0: 656c 662e 6c69 7374 5f74 696d 656c 696e  elf.list_timelin
+000455d0: 652e 4765 744d 6573 7361 6765 2865 7665  e.GetMessage(eve
+000455e0: 6e74 2e53 656c 6563 7469 6f6e 290d 0a20  nt.Selection).. 
+000455f0: 2020 2020 2020 2069 6620 6d73 675f 6964         if msg_id
+00045600: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
+00045610: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00045620: 7374 635f 6869 7374 6f72 792e 466f 6375  stc_history.Focu
+00045630: 734d 6573 7361 6765 286d 7367 5f69 642c  sMessage(msg_id,
+00045640: 2073 656c 6563 743d 4661 6c73 6529 0d0a   select=False)..
+00045650: 0d0a 0d0a 2020 2020 6465 6620 6f6e 5f62  ....    def on_b
+00045660: 6c75 725f 7469 6d65 6c69 6e65 2873 656c  lur_timeline(sel
+00045670: 662c 2065 7665 6e74 293a 0d0a 2020 2020  f, event):..    
+00045680: 2020 2020 2222 2248 616e 646c 6572 2066      """Handler f
+00045690: 6f72 2063 6c69 636b 696e 6720 6f75 7420  or clicking out 
+000456a0: 6f66 2074 696d 656c 696e 652c 2063 6c65  of timeline, cle
+000456b0: 6172 7320 7365 6c65 6374 696f 6e20 2864  ars selection (d
+000456c0: 6973 7472 6163 7469 6e67 292e 2222 220d  istracting).""".
+000456d0: 0a20 2020 2020 2020 2073 656c 662e 6c69  .        self.li
+000456e0: 7374 5f74 696d 656c 696e 652e 5365 7453  st_timeline.SetS
+000456f0: 656c 6563 7469 6f6e 282d 3129 0d0a 0d0a  election(-1)....
+00045700: 0d0a 2020 2020 6465 6620 6f6e 5f73 6372  ..    def on_scr
+00045710: 6f6c 6c5f 6368 6174 5f68 6973 746f 7279  oll_chat_history
+00045720: 2873 656c 662c 2065 7665 6e74 293a 0d0a  (self, event):..
+00045730: 2020 2020 2020 2020 2222 2248 616e 646c          """Handl
+00045740: 6572 2066 6f72 2073 6372 6f6c 6c69 6e67  er for scrolling
+00045750: 2063 6861 7420 6869 7374 6f72 792c 2075   chat history, u
+00045760: 7064 6174 6573 2074 696d 656c 696e 6520  pdates timeline 
+00045770: 6869 6768 6c69 6768 742e 2222 220d 0a20  highlight.""".. 
+00045780: 2020 2020 2020 2065 7665 6e74 2e53 6b69         event.Ski
+00045790: 7028 290d 0a20 2020 2020 2020 2069 6620  p()..        if 
+000457a0: 7365 6c66 2e74 696d 656c 696e 655f 7469  self.timeline_ti
+000457b0: 6d65 723a 2072 6574 7572 6e0d 0a0d 0a20  mer: return.... 
+000457c0: 2020 2020 2020 2064 6566 2064 6f5f 6869         def do_hi
+000457d0: 6768 6c69 6768 7428 293a 0d0a 2020 2020  ghlight():..    
+000457e0: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
+000457f0: 656c 663a 2072 6574 7572 6e0d 0a20 2020  elf: return..   
+00045800: 2020 2020 2020 2020 2073 656c 662e 7469           self.ti
+00045810: 6d65 6c69 6e65 5f74 696d 6572 203d 204e  meline_timer = N
+00045820: 6f6e 650d 0a20 2020 2020 2020 2020 2020  one..           
+00045830: 2073 656c 662e 6c69 7374 5f74 696d 656c   self.list_timel
+00045840: 696e 652e 4869 6768 6c69 6768 7452 6f77  ine.HighlightRow
+00045850: 7328 7365 6c66 2e73 7463 5f68 6973 746f  s(self.stc_histo
+00045860: 7279 2e47 6574 5669 7369 626c 654d 6573  ry.GetVisibleMes
+00045870: 7361 6765 7328 2929 0d0a 2020 2020 2020  sages())..      
+00045880: 2020 7365 6c66 2e74 696d 656c 696e 655f    self.timeline_
+00045890: 7469 6d65 7220 3d20 7778 2e43 616c 6c4c  timer = wx.CallL
+000458a0: 6174 6572 2832 3030 2c20 646f 5f68 6967  ater(200, do_hig
+000458b0: 686c 6967 6874 290d 0a0d 0a0d 0a20 2020  hlight)......   
+000458c0: 2064 6566 206f 6e5f 6d65 6e75 5f73 697a   def on_menu_siz
+000458d0: 655f 6368 6174 2873 656c 662c 2065 7665  e_chat(self, eve
+000458e0: 6e74 293a 0d0a 2020 2020 2020 2020 2222  nt):..        ""
+000458f0: 2248 616e 646c 6572 2066 6f72 2063 6c69  "Handler for cli
+00045900: 636b 696e 6720 746f 2063 6861 6e67 6520  cking to change 
+00045910: 6869 7374 6f72 7920 7465 7874 2073 697a  history text siz
+00045920: 652c 206f 7065 6e73 2070 6f70 7570 206d  e, opens popup m
+00045930: 656e 752e 2222 220d 0a20 2020 2020 2020  enu."""..       
+00045940: 206d 656e 7520 3d20 7365 6c66 2e73 7463   menu = self.stc
+00045950: 5f68 6973 746f 7279 2e4d 616b 655a 6f6f  _history.MakeZoo
+00045960: 6d4d 656e 7528 290d 0a20 2020 2020 2020  mMenu()..       
+00045970: 2072 6563 7420 3d20 636f 6e74 726f 6c73   rect = controls
+00045980: 2e67 6574 5f74 6f6f 6c5f 7265 6374 2865  .get_tool_rect(e
+00045990: 7665 6e74 2e45 7665 6e74 4f62 6a65 6374  vent.EventObject
+000459a0: 2c20 6576 656e 742e 4964 290d 0a20 2020  , event.Id)..   
+000459b0: 2020 2020 2065 7665 6e74 2e45 7665 6e74       event.Event
+000459c0: 4f62 6a65 6374 2e50 6f70 7570 4d65 6e75  Object.PopupMenu
+000459d0: 286d 656e 752c 2072 6563 742e 4c65 6674  (menu, rect.Left
+000459e0: 2c20 7265 6374 2e48 6569 6768 7429 0d0a  , rect.Height)..
+000459f0: 0d0a 0d0a 2020 2020 6465 6620 7368 6f77  ....    def show
+00045a00: 5f73 7461 7473 2873 656c 662c 2073 686f  _stats(self, sho
+00045a10: 773d 5472 7565 293a 0d0a 2020 2020 2020  w=True):..      
+00045a20: 2020 2222 2253 686f 7773 206f 7220 6869    """Shows or hi
+00045a30: 6465 7320 7468 6520 7374 6174 6973 7469  des the statisti
+00045a40: 6373 2077 696e 646f 772e 2222 220d 0a20  cs window.""".. 
+00045a50: 2020 2020 2020 2068 746d 6c2c 2073 7463         html, stc
+00045a60: 203d 2073 656c 662e 6874 6d6c 5f73 7461   = self.html_sta
+00045a70: 7473 2c20 7365 6c66 2e73 7463 5f68 6973  ts, self.stc_his
+00045a80: 746f 7279 0d0a 2020 2020 2020 2020 6368  tory..        ch
+00045a90: 616e 6765 6420 3d20 4661 6c73 650d 0a20  anged = False.. 
+00045aa0: 2020 2020 2020 2066 6f63 7573 203d 2046         focus = F
+00045ab0: 616c 7365 0d0a 2020 2020 2020 2020 666f  alse..        fo
+00045ac0: 7220 6920 696e 205b 6874 6d6c 2c20 7374  r i in [html, st
+00045ad0: 635d 3a0d 0a20 2020 2020 2020 2020 2020  c]:..           
+00045ae0: 2066 6f63 7573 203d 2066 6f63 7573 206f   focus = focus o
+00045af0: 7220 2869 2e53 686f 776e 2061 6e64 2069  r (i.Shown and i
+00045b00: 2e46 696e 6446 6f63 7573 2829 203d 3d20  .FindFocus() == 
+00045b10: 6929 0d0a 2020 2020 2020 2020 7365 6c66  i)..        self
+00045b20: 2e70 616e 656c 5f73 7463 312e 4672 6565  .panel_stc1.Free
+00045b30: 7a65 2829 0d0a 2020 2020 2020 2020 7472  ze()..        tr
+00045b40: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
+00045b50: 6966 206e 6f74 2073 7463 2e53 686f 776e  if not stc.Shown
+00045b60: 2021 3d20 7368 6f77 3a0d 0a20 2020 2020   != show:..     
+00045b70: 2020 2020 2020 2020 2020 2073 7463 2e53             stc.S
+00045b80: 686f 7728 6e6f 7420 7368 6f77 290d 0a20  how(not show).. 
+00045b90: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00045ba0: 6861 6e67 6564 203d 2054 7275 650d 0a20  hanged = True.. 
+00045bb0: 2020 2020 2020 2020 2020 2069 6620 6874             if ht
+00045bc0: 6d6c 2e53 686f 776e 2021 3d20 7368 6f77  ml.Shown != show
+00045bd0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00045be0: 2020 2068 746d 6c2e 5368 6f77 2873 686f     html.Show(sho
+00045bf0: 7729 0d0a 2020 2020 2020 2020 2020 2020  w)..            
+00045c00: 2020 2020 6368 616e 6765 6420 3d20 5472      changed = Tr
+00045c10: 7565 0d0a 2020 2020 2020 2020 2020 2020  ue..            
+00045c20: 6966 2063 6861 6e67 6564 3a0d 0a20 2020  if changed:..   
+00045c30: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00045c40: 7368 6f77 3a20 7365 6c66 2e6c 6973 745f  show: self.list_
+00045c50: 7469 6d65 6c69 6e65 2e48 6964 6528 290d  timeline.Hide().
+00045c60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00045c70: 2065 6c69 6620 7365 6c66 2e74 625f 6368   elif self.tb_ch
+00045c80: 6174 2e47 6574 546f 6f6c 5374 6174 6528  at.GetToolState(
+00045c90: 7778 2e49 445f 4a55 4d50 5f54 4f29 3a0d  wx.ID_JUMP_TO):.
+00045ca0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00045cb0: 2020 2020 2073 656c 662e 6c69 7374 5f74       self.list_t
+00045cc0: 696d 656c 696e 652e 5368 6f77 2829 0d0a  imeline.Show()..
+00045cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00045ce0: 7365 6c66 2e74 625f 6368 6174 2e45 6e61  self.tb_chat.Ena
+00045cf0: 626c 6554 6f6f 6c28 7778 2e49 445f 4a55  bleTool(wx.ID_JU
+00045d00: 4d50 5f54 4f2c 206e 6f74 2073 686f 7729  MP_TO, not show)
+00045d10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00045d20: 2020 7365 6c66 2e74 625f 6368 6174 2e45    self.tb_chat.E
+00045d30: 6e61 626c 6554 6f6f 6c28 7778 2e49 445f  nableTool(wx.ID_
+00045d40: 5345 5455 502c 2020 206e 6f74 2073 686f  SETUP,   not sho
+00045d50: 7729 0d0a 2020 2020 2020 2020 2020 2020  w)..            
+00045d60: 2020 2020 6874 6d6c 2e43 6f6e 7461 696e      html.Contain
+00045d70: 696e 6753 697a 6572 2e4c 6179 6f75 7428  ingSizer.Layout(
+00045d80: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00045d90: 2020 2073 7463 2e43 6f6e 7461 696e 696e     stc.Containin
+00045da0: 6753 697a 6572 2e4c 6179 6f75 7428 290d  gSizer.Layout().
+00045db0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00045dc0: 666f 6375 733a 2023 2053 7769 7463 6820  focus: # Switch 
+00045dd0: 666f 6375 7320 746f 2074 6865 206f 7468  focus to the oth
+00045de0: 6572 2063 6f6e 7472 6f6c 2069 6620 7072  er control if pr
+00045df0: 6576 696f 7573 2068 6164 2066 6f63 7573  evious had focus
+00045e00: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00045e10: 2020 2868 746d 6c20 6966 2073 686f 7720    (html if show 
+00045e20: 656c 7365 2073 7463 292e 5365 7446 6f63  else stc).SetFoc
+00045e30: 7573 2829 0d0a 2020 2020 2020 2020 2020  us()..          
+00045e40: 2020 6966 2073 686f 773a 0d0a 2020 2020    if show:..    
+00045e50: 2020 2020 2020 2020 2020 2020 6966 2068              if h
+00045e60: 6173 6174 7472 2868 746d 6c2c 2022 5f6c  asattr(html, "_l
+00045e70: 6173 745f 7363 726f 6c6c 5f70 6f73 2229  ast_scroll_pos")
+00045e80: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00045e90: 2020 2020 2020 2068 746d 6c2e 5363 726f         html.Scro
+00045ea0: 6c6c 282a 6874 6d6c 2e5f 6c61 7374 5f73  ll(*html._last_s
+00045eb0: 6372 6f6c 6c5f 706f 7329 0d0a 2020 2020  croll_pos)..    
+00045ec0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+00045ed0: 2068 746d 6c2e 4f70 656e 6564 416e 6368   html.OpenedAnch
+00045ee0: 6f72 3a20 6874 6d6c 2e53 6372 6f6c 6c54  or: html.ScrollT
+00045ef0: 6f41 6e63 686f 7228 6874 6d6c 2e4f 7065  oAnchor(html.Ope
+00045f00: 6e65 6441 6e63 686f 7229 0d0a 2020 2020  nedAnchor)..    
+00045f10: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+00045f20: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00045f30: 656c 662e 6c69 7374 5f74 696d 656c 696e  elf.list_timelin
+00045f40: 652e 5265 6672 6573 6849 7465 6d73 2829  e.RefreshItems()
+00045f50: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00045f60: 6c66 2e74 625f 6368 6174 2e54 6f67 676c  lf.tb_chat.Toggl
+00045f70: 6554 6f6f 6c28 7778 2e49 445f 5052 4f50  eTool(wx.ID_PROP
+00045f80: 4552 5449 4553 2c20 7368 6f77 290d 0a20  ERTIES, show).. 
+00045f90: 2020 2020 2020 2066 696e 616c 6c79 3a20         finally: 
+00045fa0: 7365 6c66 2e70 616e 656c 5f73 7463 312e  self.panel_stc1.
+00045fb0: 5468 6177 2829 0d0a 0d0a 0d0a 2020 2020  Thaw()......    
+00045fc0: 6465 6620 6f6e 5f62 7574 746f 6e5f 7265  def on_button_re
+00045fd0: 7365 745f 6772 6964 2873 656c 662c 2065  set_grid(self, e
+00045fe0: 7665 6e74 293a 0d0a 2020 2020 2020 2020  vent):..        
+00045ff0: 2222 220d 0a20 2020 2020 2020 2048 616e  """..        Han
+00046000: 646c 6572 2066 6f72 2063 6c69 636b 696e  dler for clickin
+00046010: 6720 746f 2072 656d 6f76 6520 736f 7274  g to remove sort
+00046020: 696e 6720 616e 6420 6669 6c74 6572 696e  ing and filterin
+00046030: 6720 6f6e 2061 2067 7269 642c 0d0a 2020  g on a grid,..  
+00046040: 2020 2020 2020 7265 7365 7473 2074 6865        resets the
+00046050: 2067 7269 6420 616e 6420 6974 7320 7669   grid and its vi
+00046060: 6577 2e0d 0a20 2020 2020 2020 2022 2222  ew...        """
+00046070: 0d0a 2020 2020 2020 2020 6973 5f74 6162  ..        is_tab
+00046080: 6c65 203d 2028 6576 656e 742e 4576 656e  le = (event.Even
+00046090: 744f 626a 6563 7420 3d3d 2073 656c 662e  tObject == self.
+000460a0: 6275 7474 6f6e 5f72 6573 6574 5f67 7269  button_reset_gri
+000460b0: 645f 7461 626c 6529 0d0a 2020 2020 2020  d_table)..      
+000460c0: 2020 6772 6964 203d 2073 656c 662e 6772    grid = self.gr
+000460d0: 6964 5f74 6162 6c65 2069 6620 6973 5f74  id_table if is_t
+000460e0: 6162 6c65 2065 6c73 6520 7365 6c66 2e67  able else self.g
+000460f0: 7269 645f 7371 6c0d 0a20 2020 2020 2020  rid_sql..       
+00046100: 2069 6620 6772 6964 2e54 6162 6c65 2061   if grid.Table a
+00046110: 6e64 2069 7369 6e73 7461 6e63 6528 6772  nd isinstance(gr
+00046120: 6964 2e54 6162 6c65 2c20 5371 6c69 7465  id.Table, Sqlite
+00046130: 4772 6964 4261 7365 293a 0d0a 2020 2020  GridBase):..    
+00046140: 2020 2020 2020 2020 6772 6964 2e54 6162          grid.Tab
+00046150: 6c65 2e43 6c65 6172 536f 7274 2872 6566  le.ClearSort(ref
+00046160: 7265 7368 3d46 616c 7365 290d 0a20 2020  resh=False)..   
+00046170: 2020 2020 2020 2020 2067 7269 642e 5461           grid.Ta
+00046180: 626c 652e 436c 6561 7246 696c 7465 7228  ble.ClearFilter(
+00046190: 290d 0a20 2020 2020 2020 2020 2020 2067  )..            g
+000461a0: 7269 642e 436f 6e74 6169 6e69 6e67 5369  rid.ContainingSi
+000461b0: 7a65 722e 4c61 796f 7574 2829 2023 2052  zer.Layout() # R
+000461c0: 6561 6374 2074 6f20 6772 6964 2073 697a  eact to grid siz
+000461d0: 6520 6368 616e 6765 0d0a 0d0a 0d0a 2020  e change......  
+000461e0: 2020 6465 6620 6f6e 5f62 7574 746f 6e5f    def on_button_
+000461f0: 6578 706f 7274 5f67 7269 6428 7365 6c66  export_grid(self
+00046200: 2c20 6576 656e 7429 3a0d 0a20 2020 2020  , event):..     
+00046210: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
+00046220: 4861 6e64 6c65 7220 666f 7220 636c 6963  Handler for clic
+00046230: 6b69 6e67 2074 6f20 6578 706f 7274 2077  king to export w
+00046240: 782e 4772 6964 2063 6f6e 7465 6e74 7320  x.Grid contents 
+00046250: 746f 2066 696c 652c 2061 6c6c 6f77 7320  to file, allows 
+00046260: 7468 650d 0a20 2020 2020 2020 2075 7365  the..        use
+00046270: 7220 746f 2073 656c 6563 7420 6669 6c65  r to select file
+00046280: 6e61 6d65 2061 6e64 2074 7970 6520 616e  name and type an
+00046290: 6420 6372 6561 7465 7320 7468 6520 6669  d creates the fi
+000462a0: 6c65 2e0d 0a20 2020 2020 2020 2022 2222  le...        """
+000462b0: 0d0a 2020 2020 2020 2020 6772 6964 5f73  ..        grid_s
+000462c0: 6f75 7263 6520 3d20 7365 6c66 2e67 7269  ource = self.gri
+000462d0: 645f 7461 626c 650d 0a20 2020 2020 2020  d_table..       
+000462e0: 2073 716c 203d 2022 220d 0a20 2020 2020   sql = ""..     
+000462f0: 2020 2074 6162 6c65 203d 2022 220d 0a20     table = "".. 
+00046300: 2020 2020 2020 2069 6620 6576 656e 742e         if event.
+00046310: 4576 656e 744f 626a 6563 7420 6973 2073  EventObject is s
+00046320: 656c 662e 6275 7474 6f6e 5f65 7870 6f72  elf.button_expor
+00046330: 745f 7371 6c3a 0d0a 2020 2020 2020 2020  t_sql:..        
+00046340: 2020 2020 6772 6964 5f73 6f75 7263 6520      grid_source 
+00046350: 3d20 7365 6c66 2e67 7269 645f 7371 6c0d  = self.grid_sql.
+00046360: 0a20 2020 2020 2020 2020 2020 2073 716c  .            sql
+00046370: 203d 2067 6574 6174 7472 2873 656c 662c   = getattr(self,
+00046380: 2022 6c61 7374 5f73 716c 222c 2022 2229   "last_sql", "")
+00046390: 0d0a 2020 2020 2020 2020 6966 2067 7269  ..        if gri
+000463a0: 645f 736f 7572 6365 2e54 6162 6c65 3a0d  d_source.Table:.
+000463b0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000463c0: 6772 6964 5f73 6f75 7263 6520 6973 2073  grid_source is s
+000463d0: 656c 662e 6772 6964 5f74 6162 6c65 3a0d  elf.grid_table:.
+000463e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000463f0: 2074 6162 6c65 203d 2073 656c 662e 6462   table = self.db
+00046400: 2e74 6162 6c65 735b 6772 6964 5f73 6f75  .tables[grid_sou
+00046410: 7263 652e 5461 626c 652e 7461 626c 652e  rce.Table.table.
+00046420: 6c6f 7765 7228 295d 5b22 6e61 6d65 225d  lower()]["name"]
+00046430: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00046440: 2020 7469 746c 6520 3d20 2254 6162 6c65    title = "Table
+00046450: 202d 205c 2225 735c 2222 2025 2074 6162   - \"%s\"" % tab
+00046460: 6c65 0d0a 2020 2020 2020 2020 2020 2020  le..            
+00046470: 2020 2020 7365 6c66 2e64 6961 6c6f 675f      self.dialog_
+00046480: 7361 7665 6772 6964 2e4d 6573 7361 6765  savegrid.Message
+00046490: 203d 2022 5361 7665 2074 6162 6c65 2061   = "Save table a
+000464a0: 7322 0d0a 2020 2020 2020 2020 2020 2020  s"..            
+000464b0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+000464c0: 2020 2020 2020 2074 6974 6c65 203d 2022         title = "
+000464d0: 5351 4c20 7175 6572 7922 0d0a 2020 2020  SQL query"..    
+000464e0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000464f0: 2e64 6961 6c6f 675f 7361 7665 6772 6964  .dialog_savegrid
+00046500: 2e4d 6573 7361 6765 203d 2022 5361 7665  .Message = "Save
+00046510: 2071 7565 7279 2061 7322 0d0a 2020 2020   query as"..    
+00046520: 2020 2020 2020 2020 2020 2020 6772 6964              grid
+00046530: 5f73 6f75 7263 652e 5461 626c 652e 5365  _source.Table.Se
+00046540: 656b 4168 6561 6428 5472 7565 290d 0a20  ekAhead(True).. 
+00046550: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00046560: 6469 616c 6f67 5f73 6176 6567 7269 642e  dialog_savegrid.
+00046570: 4669 6c65 6e61 6d65 203d 2075 7469 6c2e  Filename = util.
+00046580: 7361 6665 5f66 696c 656e 616d 6528 7469  safe_filename(ti
+00046590: 746c 6529 0d0a 2020 2020 2020 2020 2020  tle)..          
+000465a0: 2020 6966 2077 782e 4944 5f4f 4b20 3d3d    if wx.ID_OK ==
+000465b0: 2073 656c 662e 6469 616c 6f67 5f73 6176   self.dialog_sav
+000465c0: 6567 7269 642e 5368 6f77 4d6f 6461 6c28  egrid.ShowModal(
+000465d0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+000465e0: 2020 2020 6669 6c65 6e61 6d65 203d 2063      filename = c
+000465f0: 6f6e 7472 6f6c 732e 6765 745f 6469 616c  ontrols.get_dial
+00046600: 6f67 5f70 6174 6828 7365 6c66 2e64 6961  og_path(self.dia
+00046610: 6c6f 675f 7361 7665 6772 6964 290d 0a20  log_savegrid).. 
+00046620: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00046630: 6f72 6d61 7420 3d20 6578 706f 7274 2e44  ormat = export.D
+00046640: 4154 415f 4558 5453 5b73 656c 662e 6469  ATA_EXTS[self.di
+00046650: 616c 6f67 5f73 6176 6567 7269 642e 4669  alog_savegrid.Fi
+00046660: 6c74 6572 496e 6465 785d 0d0a 2020 2020  lterIndex]..    
+00046670: 2020 2020 2020 2020 2020 2020 6275 7379              busy
+00046680: 203d 2063 6f6e 7472 6f6c 732e 4275 7379   = controls.Busy
+00046690: 5061 6e65 6c28 7365 6c66 2c20 2245 7870  Panel(self, "Exp
+000466a0: 6f72 7469 6e67 205c 2225 735c 222e 2220  orting \"%s\"." 
+000466b0: 2520 6669 6c65 6e61 6d65 290d 0a20 2020  % filename)..   
+000466c0: 2020 2020 2020 2020 2020 2020 2067 7569               gui
+000466d0: 6261 7365 2e73 7461 7475 7328 2245 7870  base.status("Exp
+000466e0: 6f72 7469 6e67 205c 2225 735c 222e 222c  orting \"%s\".",
+000466f0: 2066 696c 656e 616d 6529 0d0a 2020 2020   filename)..    
+00046700: 2020 2020 2020 2020 2020 2020 7472 793a              try:
 00046710: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00046720: 2020 2020 2020 6572 726f 726d 7367 203d        errormsg =
-00046730: 2022 4572 726f 7220 7361 7669 6e67 2025   "Error saving %
-00046740: 733a 5c6e 5c6e 2573 2220 2520 5c0d 0a20  s:\n\n%s" % \.. 
-00046750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046760: 2020 2020 2020 2020 2020 2020 2020 2866                (f
-00046770: 696c 656e 616d 652c 2074 7261 6365 6261  ilename, traceba
-00046780: 636b 2e66 6f72 6d61 745f 6578 6328 2929  ck.format_exc())
-00046790: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000467a0: 2020 2020 2020 7778 2e4d 6573 7361 6765        wx.Message
-000467b0: 426f 7828 6572 726f 726d 7367 2c20 636f  Box(errormsg, co
-000467c0: 6e66 2e54 6974 6c65 2c20 7778 2e4f 4b20  nf.Title, wx.OK 
-000467d0: 7c20 7778 2e49 434f 4e5f 5741 524e 494e  | wx.ICON_WARNIN
-000467e0: 4729 0d0a 2020 2020 2020 2020 2020 2020  G)..            
-000467f0: 2020 2020 6669 6e61 6c6c 793a 0d0a 2020      finally:..  
-00046800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046810: 2020 6275 7379 2e43 6c6f 7365 2829 0d0a    busy.Close()..
-00046820: 0d0a 0d0a 2020 2020 6465 6620 6f6e 5f6b  ....    def on_k
-00046830: 6579 646f 776e 5f73 716c 2873 656c 662c  eydown_sql(self,
-00046840: 2065 7665 6e74 293a 0d0a 2020 2020 2020   event):..      
-00046850: 2020 2222 220d 0a20 2020 2020 2020 2048    """..        H
-00046860: 616e 646c 6572 2066 6f72 2070 7265 7373  andler for press
-00046870: 696e 6720 6120 6b65 7920 696e 2053 514c  ing a key in SQL
-00046880: 2065 6469 746f 722c 206c 6973 7465 6e73   editor, listens
-00046890: 2066 6f72 2041 6c74 2d45 6e74 6572 2061   for Alt-Enter a
-000468a0: 6e64 0d0a 2020 2020 2020 2020 6578 6563  nd..        exec
-000468b0: 7574 6573 2074 6865 2063 7572 7265 6e74  utes the current
-000468c0: 6c79 2073 656c 6563 7465 6420 6c69 6e65  ly selected line
-000468d0: 2c20 6f72 2063 7572 7265 6e74 6c79 2061  , or currently a
-000468e0: 6374 6976 6520 6c69 6e65 2e0d 0a20 2020  ctive line...   
-000468f0: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-00046900: 2020 7374 6320 3d20 6576 656e 742e 4765    stc = event.Ge
-00046910: 7445 7665 6e74 4f62 6a65 6374 2829 0d0a  tEventObject()..
-00046920: 2020 2020 2020 2020 6966 2065 7665 6e74          if event
-00046930: 2e41 6c74 446f 776e 2829 2061 6e64 2077  .AltDown() and w
-00046940: 782e 5758 4b5f 5245 5455 524e 203d 3d20  x.WXK_RETURN == 
-00046950: 6576 656e 742e 4b65 7943 6f64 653a 0d0a  event.KeyCode:..
-00046960: 2020 2020 2020 2020 2020 2020 7371 6c20              sql 
-00046970: 3d20 2873 7463 2e53 656c 6563 7465 6454  = (stc.SelectedT
-00046980: 6578 7420 6f72 2073 7463 2e43 7572 4c69  ext or stc.CurLi
-00046990: 6e65 5b30 5d29 2e73 7472 6970 2829 0d0a  ne[0]).strip()..
-000469a0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-000469b0: 716c 3a0d 0a20 2020 2020 2020 2020 2020  ql:..           
-000469c0: 2020 2020 2073 656c 662e 6578 6563 7574       self.execut
-000469d0: 655f 7371 6c28 7371 6c29 0d0a 2020 2020  e_sql(sql)..    
-000469e0: 2020 2020 6576 656e 742e 536b 6970 2829      event.Skip()
-000469f0: 2023 2041 6c6c 6f77 2074 6f20 7072 6f70   # Allow to prop
-00046a00: 6167 6174 6520 746f 206f 7468 6572 2068  agate to other h
-00046a10: 616e 646c 6572 730d 0a0d 0a0d 0a20 2020  andlers......   
-00046a20: 2064 6566 206f 6e5f 6275 7474 6f6e 5f73   def on_button_s
-00046a30: 716c 2873 656c 662c 2065 7665 6e74 293a  ql(self, event):
-00046a40: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
-00046a50: 2020 2020 2020 2048 616e 646c 6572 2066         Handler f
-00046a60: 6f72 2063 6c69 636b 696e 6720 746f 2072  or clicking to r
-00046a70: 756e 2061 6e20 5351 4c20 7175 6572 792c  un an SQL query,
-00046a80: 2072 756e 7320 7468 6520 7365 6c65 6374   runs the select
-00046a90: 6564 2074 6578 7420 6f72 0d0a 2020 2020  ed text or..    
-00046aa0: 2020 2020 7768 6f6c 6520 636f 6e74 656e      whole conten
-00046ab0: 7473 2c20 6469 7370 6c61 7973 2069 7473  ts, displays its
-00046ac0: 2072 6573 756c 7473 2c20 6966 2061 6e79   results, if any
-00046ad0: 2c20 616e 6420 636f 6d6d 6974 7320 6368  , and commits ch
-00046ae0: 616e 6765 730d 0a20 2020 2020 2020 2064  anges..        d
-00046af0: 6f6e 652c 2069 6620 616e 792e 0d0a 2020  one, if any...  
-00046b00: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
-00046b10: 2020 2073 716c 203d 2073 656c 662e 7374     sql = self.st
-00046b20: 635f 7371 6c2e 5365 6c65 6374 6564 5465  c_sql.SelectedTe
-00046b30: 7874 2e73 7472 6970 2829 206f 7220 7365  xt.strip() or se
-00046b40: 6c66 2e73 7463 5f73 716c 2e54 6578 742e  lf.stc_sql.Text.
-00046b50: 7374 7269 7028 290d 0a20 2020 2020 2020  strip()..       
-00046b60: 2069 6620 7371 6c3a 0d0a 2020 2020 2020   if sql:..      
-00046b70: 2020 2020 2020 7365 6c66 2e65 7865 6375        self.execu
-00046b80: 7465 5f73 716c 2873 716c 290d 0a0d 0a0d  te_sql(sql).....
-00046b90: 0a20 2020 2064 6566 206f 6e5f 6275 7474  .    def on_butt
-00046ba0: 6f6e 5f73 6372 6970 7428 7365 6c66 2c20  on_script(self, 
-00046bb0: 6576 656e 7429 3a0d 0a20 2020 2020 2020  event):..       
-00046bc0: 2022 2222 0d0a 2020 2020 2020 2020 4861   """..        Ha
-00046bd0: 6e64 6c65 7220 666f 7220 636c 6963 6b69  ndler for clicki
-00046be0: 6e67 2074 6f20 7275 6e20 6d75 6c74 6970  ng to run multip
-00046bf0: 6c65 2053 514c 2073 7461 7465 6d65 6e74  le SQL statement
-00046c00: 732c 2072 756e 7320 7468 6520 7365 6c65  s, runs the sele
-00046c10: 6374 6564 0d0a 2020 2020 2020 2020 7465  cted..        te
-00046c20: 7874 206f 7220 7768 6f6c 6520 636f 6e74  xt or whole cont
-00046c30: 656e 7473 2061 7320 616e 2053 514c 2073  ents as an SQL s
-00046c40: 6372 6970 742e 0d0a 2020 2020 2020 2020  cript...        
-00046c50: 2222 220d 0a20 2020 2020 2020 2073 716c  """..        sql
-00046c60: 203d 2073 656c 662e 7374 635f 7371 6c2e   = self.stc_sql.
-00046c70: 5365 6c65 6374 6564 5465 7874 2e73 7472  SelectedText.str
-00046c80: 6970 2829 206f 7220 7365 6c66 2e73 7463  ip() or self.stc
-00046c90: 5f73 716c 2e54 6578 742e 7374 7269 7028  _sql.Text.strip(
-00046ca0: 290d 0a20 2020 2020 2020 2074 7279 3a0d  )..        try:.
-00046cb0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00046cc0: 7371 6c3a 0d0a 2020 2020 2020 2020 2020  sql:..          
-00046cd0: 2020 2020 2020 6c6f 6767 6572 2e69 6e66        logger.inf
-00046ce0: 6f28 2245 7865 6375 7469 6e67 2053 514c  o("Executing SQL
-00046cf0: 2073 6372 6970 7420 5c22 2573 5c22 2e22   script \"%s\"."
-00046d00: 2c20 7371 6c29 0d0a 2020 2020 2020 2020  , sql)..        
-00046d10: 2020 2020 2020 2020 7365 6c66 2e64 622e          self.db.
-00046d20: 636f 6e6e 6563 7469 6f6e 2e65 7865 6375  connection.execu
-00046d30: 7465 7363 7269 7074 2873 716c 290d 0a20  tescript(sql).. 
-00046d40: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00046d50: 656c 662e 6772 6964 5f73 716c 2e53 6574  elf.grid_sql.Set
-00046d60: 5461 626c 6528 4e6f 6e65 290d 0a20 2020  Table(None)..   
-00046d70: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00046d80: 662e 6772 6964 5f73 716c 2e43 7265 6174  f.grid_sql.Creat
-00046d90: 6547 7269 6428 312c 2031 290d 0a20 2020  eGrid(1, 1)..   
-00046da0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00046db0: 662e 6772 6964 5f73 716c 2e53 6574 436f  f.grid_sql.SetCo
-00046dc0: 6c4c 6162 656c 5661 6c75 6528 302c 2022  lLabelValue(0, "
-00046dd0: 4166 6665 6374 6564 2072 6f77 7322 290d  Affected rows").
-00046de0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00046df0: 2073 656c 662e 6772 6964 5f73 716c 2e53   self.grid_sql.S
-00046e00: 6574 4365 6c6c 5661 6c75 6528 302c 2030  etCellValue(0, 0
-00046e10: 2c20 222d 3122 290d 0a20 2020 2020 2020  , "-1")..       
-00046e20: 2020 2020 2020 2020 2073 656c 662e 6275           self.bu
-00046e30: 7474 6f6e 5f72 6573 6574 5f67 7269 645f  tton_reset_grid_
-00046e40: 7371 6c2e 456e 6162 6c65 6420 3d20 4661  sql.Enabled = Fa
-00046e50: 6c73 650d 0a20 2020 2020 2020 2020 2020  lse..           
-00046e60: 2020 2020 2073 656c 662e 6275 7474 6f6e       self.button
-00046e70: 5f65 7870 6f72 745f 7371 6c2e 456e 6162  _export_sql.Enab
-00046e80: 6c65 6420 3d20 4661 6c73 650d 0a20 2020  led = False..   
-00046e90: 2020 2020 2020 2020 2020 2020 2073 697a               siz
-00046ea0: 6520 3d20 7365 6c66 2e67 7269 645f 7371  e = self.grid_sq
-00046eb0: 6c2e 5369 7a65 0d0a 2020 2020 2020 2020  l.Size..        
-00046ec0: 2020 2020 2020 2020 7365 6c66 2e67 7269          self.gri
-00046ed0: 645f 7371 6c2e 4669 7428 290d 0a20 2020  d_sql.Fit()..   
-00046ee0: 2020 2020 2020 2020 2020 2020 2023 204a               # J
-00046ef0: 6967 676c 6520 7369 7a65 2062 7920 3120  iggle size by 1 
-00046f00: 7069 7865 6c20 746f 2072 6566 7265 7368  pixel to refresh
-00046f10: 2073 6372 6f6c 6c62 6172 730d 0a20 2020   scrollbars..   
-00046f20: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00046f30: 662e 6772 6964 5f73 716c 2e53 697a 6520  f.grid_sql.Size 
-00046f40: 3d20 7369 7a65 5b30 5d2c 2073 697a 655b  = size[0], size[
-00046f50: 315d 2d31 0d0a 2020 2020 2020 2020 2020  1]-1..          
-00046f60: 2020 2020 2020 7365 6c66 2e67 7269 645f        self.grid_
-00046f70: 7371 6c2e 5369 7a65 203d 2073 697a 655b  sql.Size = size[
-00046f80: 305d 2c20 7369 7a65 5b31 5d0d 0a20 2020  0], size[1]..   
-00046f90: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
-00046fa0: 7074 696f 6e20 6173 2065 3a0d 0a20 2020  ption as e:..   
-00046fb0: 2020 2020 2020 2020 206d 7367 203d 2075           msg = u
-00046fc0: 7469 6c2e 666f 726d 6174 5f65 7863 2865  til.format_exc(e
-00046fd0: 290d 0a20 2020 2020 2020 2020 2020 2067  )..            g
-00046fe0: 7569 6261 7365 2e73 7461 7475 7328 6d73  uibase.status(ms
-00046ff0: 672c 206c 6f67 3d54 7275 6529 0d0a 2020  g, log=True)..  
-00047000: 2020 2020 2020 2020 2020 7778 2e4d 6573            wx.Mes
-00047010: 7361 6765 426f 7828 6d73 672c 2063 6f6e  sageBox(msg, con
-00047020: 662e 5469 746c 652c 2077 782e 4f4b 207c  f.Title, wx.OK |
-00047030: 2077 782e 4943 4f4e 5f57 4152 4e49 4e47   wx.ICON_WARNING
-00047040: 290d 0a0d 0a0d 0a20 2020 2064 6566 2065  )......    def e
-00047050: 7865 6375 7465 5f73 716c 2873 656c 662c  xecute_sql(self,
-00047060: 2073 716c 293a 0d0a 2020 2020 2020 2020   sql):..        
-00047070: 2222 2245 7865 6375 7465 7320 7468 6520  """Executes the 
-00047080: 5351 4c20 7175 6572 7920 616e 6420 706f  SQL query and po
-00047090: 7075 6c61 7465 7320 7468 6520 5351 4c20  pulates the SQL 
-000470a0: 6772 6964 2077 6974 6820 7265 7375 6c74  grid with result
-000470b0: 732e 2222 220d 0a20 2020 2020 2020 2074  s."""..        t
-000470c0: 7279 3a0d 0a20 2020 2020 2020 2020 2020  ry:..           
-000470d0: 2067 7269 645f 6461 7461 203d 204e 6f6e   grid_data = Non
-000470e0: 650d 0a20 2020 2020 2020 2020 2020 2069  e..            i
-000470f0: 6620 7371 6c2e 6c6f 7765 7228 292e 7374  f sql.lower().st
-00047100: 6172 7473 7769 7468 2828 2273 656c 6563  artswith(("selec
-00047110: 7422 2c20 2270 7261 676d 6122 2c20 2265  t", "pragma", "e
-00047120: 7870 6c61 696e 2229 293a 0d0a 2020 2020  xplain")):..    
-00047130: 2020 2020 2020 2020 2020 2020 2320 5345              # SE
-00047140: 4c45 4354 2073 7461 7465 6d65 6e74 3a20  LECT statement: 
-00047150: 706f 7075 6c61 7465 2067 7269 6420 7769  populate grid wi
-00047160: 7468 2072 6f77 730d 0a20 2020 2020 2020  th rows..       
-00047170: 2020 2020 2020 2020 2067 7269 645f 6461           grid_da
-00047180: 7461 203d 2053 716c 6974 6547 7269 6442  ta = SqliteGridB
-00047190: 6173 6528 7365 6c66 2e64 622c 2073 716c  ase(self.db, sql
-000471a0: 3d73 716c 290d 0a20 2020 2020 2020 2020  =sql)..         
-000471b0: 2020 2020 2020 2073 656c 662e 6772 6964         self.grid
-000471c0: 5f73 716c 2e53 6574 5461 626c 6528 6772  _sql.SetTable(gr
-000471d0: 6964 5f64 6174 612c 2074 616b 654f 776e  id_data, takeOwn
-000471e0: 6572 7368 6970 3d54 7275 6529 0d0a 2020  ership=True)..  
-000471f0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00047200: 6c66 2e62 7574 746f 6e5f 7265 7365 745f  lf.button_reset_
-00047210: 6772 6964 5f73 716c 2e45 6e61 626c 6564  grid_sql.Enabled
-00047220: 203d 2054 7275 650d 0a20 2020 2020 2020   = True..       
-00047230: 2020 2020 2020 2020 2073 656c 662e 6275           self.bu
-00047240: 7474 6f6e 5f65 7870 6f72 745f 7371 6c2e  tton_export_sql.
-00047250: 456e 6162 6c65 6420 3d20 5472 7565 0d0a  Enabled = True..
-00047260: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00047270: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00047280: 2020 2023 2041 7373 756d 6520 6163 7469     # Assume acti
-00047290: 6f6e 2071 7565 7279 0d0a 2020 2020 2020  on query..      
-000472a0: 2020 2020 2020 2020 2020 6166 6665 6374            affect
-000472b0: 6564 5f72 6f77 7320 3d20 7365 6c66 2e64  ed_rows = self.d
-000472c0: 622e 6578 6563 7574 655f 6163 7469 6f6e  b.execute_action
-000472d0: 2873 716c 290d 0a20 2020 2020 2020 2020  (sql)..         
-000472e0: 2020 2020 2020 2073 656c 662e 6772 6964         self.grid
-000472f0: 5f73 716c 2e53 6574 5461 626c 6528 4e6f  _sql.SetTable(No
-00047300: 6e65 290d 0a20 2020 2020 2020 2020 2020  ne)..           
-00047310: 2020 2020 2073 656c 662e 6772 6964 5f73       self.grid_s
-00047320: 716c 2e43 7265 6174 6547 7269 6428 312c  ql.CreateGrid(1,
-00047330: 2031 290d 0a20 2020 2020 2020 2020 2020   1)..           
-00047340: 2020 2020 2073 656c 662e 6772 6964 5f73       self.grid_s
-00047350: 716c 2e53 6574 436f 6c4c 6162 656c 5661  ql.SetColLabelVa
-00047360: 6c75 6528 302c 2022 4166 6665 6374 6564  lue(0, "Affected
-00047370: 2072 6f77 7322 290d 0a20 2020 2020 2020   rows")..       
-00047380: 2020 2020 2020 2020 2073 656c 662e 6772           self.gr
-00047390: 6964 5f73 716c 2e53 6574 4365 6c6c 5661  id_sql.SetCellVa
-000473a0: 6c75 6528 302c 2030 2c20 7374 7228 6166  lue(0, 0, str(af
-000473b0: 6665 6374 6564 5f72 6f77 7329 290d 0a20  fected_rows)).. 
-000473c0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000473d0: 656c 662e 6275 7474 6f6e 5f72 6573 6574  elf.button_reset
-000473e0: 5f67 7269 645f 7371 6c2e 456e 6162 6c65  _grid_sql.Enable
-000473f0: 6420 3d20 4661 6c73 650d 0a20 2020 2020  d = False..     
-00047400: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00047410: 6275 7474 6f6e 5f65 7870 6f72 745f 7371  button_export_sq
-00047420: 6c2e 456e 6162 6c65 6420 3d20 4661 6c73  l.Enabled = Fals
-00047430: 650d 0a20 2020 2020 2020 2020 2020 2067  e..            g
-00047440: 7569 6261 7365 2e73 7461 7475 7328 2245  uibase.status("E
-00047450: 7865 6375 7465 6420 5351 4c20 5c22 2573  xecuted SQL \"%s
-00047460: 5c22 2028 2573 292e 222c 2073 716c 2c20  \" (%s).", sql, 
-00047470: 7365 6c66 2e64 622c 206c 6f67 3d54 7275  self.db, log=Tru
-00047480: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
-00047490: 7369 7a65 203d 2073 656c 662e 6772 6964  size = self.grid
-000474a0: 5f73 716c 2e53 697a 650d 0a20 2020 2020  _sql.Size..     
-000474b0: 2020 2020 2020 2073 656c 662e 6772 6964         self.grid
-000474c0: 5f73 716c 2e46 6974 2829 0d0a 2020 2020  _sql.Fit()..    
-000474d0: 2020 2020 2020 2020 2320 4a69 6767 6c65          # Jiggle
-000474e0: 2073 697a 6520 6279 2031 2070 6978 656c   size by 1 pixel
-000474f0: 2074 6f20 7265 6672 6573 6820 7363 726f   to refresh scro
-00047500: 6c6c 6261 7273 0d0a 2020 2020 2020 2020  llbars..        
-00047510: 2020 2020 7365 6c66 2e67 7269 645f 7371      self.grid_sq
-00047520: 6c2e 5369 7a65 203d 2073 697a 655b 305d  l.Size = size[0]
-00047530: 2c20 7369 7a65 5b31 5d2d 310d 0a20 2020  , size[1]-1..   
-00047540: 2020 2020 2020 2020 2073 656c 662e 6772           self.gr
-00047550: 6964 5f73 716c 2e53 697a 6520 3d20 7369  id_sql.Size = si
-00047560: 7a65 5b30 5d2c 2073 697a 655b 315d 0d0a  ze[0], size[1]..
-00047570: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00047580: 2e6c 6173 745f 7371 6c20 3d20 7371 6c0d  .last_sql = sql.
-00047590: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000475a0: 662e 6772 6964 5f73 716c 2e53 6574 436f  f.grid_sql.SetCo
-000475b0: 6c4d 696e 696d 616c 4163 6365 7074 6162  lMinimalAcceptab
-000475c0: 6c65 5769 6474 6828 3130 3029 0d0a 2020  leWidth(100)..  
-000475d0: 2020 2020 2020 2020 2020 6966 2067 7269            if gri
-000475e0: 645f 6461 7461 3a0d 0a20 2020 2020 2020  d_data:..       
-000475f0: 2020 2020 2020 2020 2063 6f6c 5f72 616e           col_ran
-00047600: 6765 203d 2072 616e 6765 2867 7269 645f  ge = range(grid_
-00047610: 6461 7461 2e47 6574 4e75 6d62 6572 436f  data.GetNumberCo
-00047620: 6c73 2829 290d 0a20 2020 2020 2020 2020  ls())..         
-00047630: 2020 2020 2020 205b 7365 6c66 2e67 7269         [self.gri
-00047640: 645f 7371 6c2e 4175 746f 5369 7a65 436f  d_sql.AutoSizeCo
-00047650: 6c4c 6162 656c 5369 7a65 2878 2920 666f  lLabelSize(x) fo
-00047660: 7220 7820 696e 2063 6f6c 5f72 616e 6765  r x in col_range
-00047670: 5d0d 0a20 2020 2020 2020 2065 7863 6570  ]..        excep
-00047680: 7420 4578 6365 7074 696f 6e20 6173 2065  t Exception as e
-00047690: 3a0d 0a20 2020 2020 2020 2020 2020 206d  :..            m
-000476a0: 7367 203d 2075 7469 6c2e 666f 726d 6174  sg = util.format
-000476b0: 5f65 7863 2865 290d 0a20 2020 2020 2020  _exc(e)..       
-000476c0: 2020 2020 2067 7569 6261 7365 2e73 7461       guibase.sta
-000476d0: 7475 7328 6d73 672c 206c 6f67 3d54 7275  tus(msg, log=Tru
-000476e0: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
-000476f0: 7778 2e4d 6573 7361 6765 426f 7828 6d73  wx.MessageBox(ms
-00047700: 672c 2063 6f6e 662e 5469 746c 652c 2077  g, conf.Title, w
-00047710: 782e 4f4b 207c 2077 782e 4943 4f4e 5f57  x.OK | wx.ICON_W
-00047720: 4152 4e49 4e47 290d 0a0d 0a0d 0a20 2020  ARNING)......   
-00047730: 2064 6566 2067 6574 5f75 6e73 6176 6564   def get_unsaved
-00047740: 5f67 7269 6473 2873 656c 6629 3a0d 0a20  _grids(self):.. 
-00047750: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
-00047760: 2020 2020 5265 7475 726e 7320 6120 6c69      Returns a li
-00047770: 7374 206f 6620 5371 6c69 7465 4772 6964  st of SqliteGrid
-00047780: 4261 7365 2067 7269 6473 2077 6865 7265  Base grids where
-00047790: 2063 6861 6e67 6573 2068 6176 6520 6e6f   changes have no
-000477a0: 7420 6265 656e 0d0a 2020 2020 2020 2020  t been..        
-000477b0: 7361 7665 6420 6166 7465 7220 6368 616e  saved after chan
-000477c0: 6769 6e67 2e0d 0a20 2020 2020 2020 2022  ging...        "
-000477d0: 2222 0d0a 2020 2020 2020 2020 7265 7475  ""..        retu
-000477e0: 726e 205b 6720 666f 7220 6720 696e 2073  rn [g for g in s
-000477f0: 656c 662e 6462 5f67 7269 6473 2e76 616c  elf.db_grids.val
-00047800: 7565 7328 2920 6966 2067 2e49 7343 6861  ues() if g.IsCha
-00047810: 6e67 6564 2829 5d0d 0a0d 0a0d 0a20 2020  nged()]......   
-00047820: 2064 6566 2073 6176 655f 756e 7361 7665   def save_unsave
-00047830: 645f 6772 6964 7328 7365 6c66 293a 0d0a  d_grids(self):..
-00047840: 2020 2020 2020 2020 2222 2253 6176 6573          """Saves
-00047850: 2061 6c6c 2064 6174 6120 696e 2075 6e73   all data in uns
-00047860: 6176 6564 2074 6162 6c65 2067 7269 6473  aved table grids
-00047870: 2c20 7265 7475 726e 7320 7375 6363 6573  , returns succes
-00047880: 732f 6661 696c 7572 652e 2222 220d 0a20  s/failure.""".. 
-00047890: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
-000478a0: 5472 7565 0d0a 2020 2020 2020 2020 666f  True..        fo
-000478b0: 7220 6772 6964 2069 6e20 2878 2066 6f72  r grid in (x for
-000478c0: 2078 2069 6e20 7365 6c66 2e64 625f 6772   x in self.db_gr
-000478d0: 6964 732e 7661 6c75 6573 2829 2069 6620  ids.values() if 
-000478e0: 782e 4973 4368 616e 6765 6428 2929 3a0d  x.IsChanged()):.
-000478f0: 0a20 2020 2020 2020 2020 2020 2074 7279  .            try
-00047900: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00047910: 2020 2067 7269 642e 5361 7665 4368 616e     grid.SaveChan
-00047920: 6765 7328 290d 0a20 2020 2020 2020 2020  ges()..         
-00047930: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
-00047940: 696f 6e20 6173 2065 3a0d 0a20 2020 2020  ion as e:..     
-00047950: 2020 2020 2020 2020 2020 2072 6573 756c             resul
-00047960: 7420 3d20 4661 6c73 650d 0a20 2020 2020  t = False..     
-00047970: 2020 2020 2020 2020 2020 2067 7569 6261             guiba
-00047980: 7365 2e73 7461 7475 7328 2745 7272 6f72  se.status('Error
-00047990: 2073 6176 696e 6720 7461 626c 6520 2573   saving table %s
-000479a0: 2069 6e20 2225 7322 3a20 2573 272c 0d0a   in "%s": %s',..
-000479b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000479c0: 2020 2020 2020 2020 2020 2020 2020 2067                 g
-000479d0: 7269 642e 7461 626c 652c 2073 656c 662e  rid.table, self.
-000479e0: 6462 2c20 7574 696c 2e66 6f72 6d61 745f  db, util.format_
-000479f0: 6578 6328 6529 290d 0a20 2020 2020 2020  exc(e))..       
-00047a00: 2020 2020 2020 2020 206c 6f67 6765 722e           logger.
-00047a10: 6578 6365 7074 696f 6e28 2745 7272 6f72  exception('Error
-00047a20: 2073 6176 696e 6720 7461 626c 6520 2573   saving table %s
-00047a30: 2069 6e20 2225 7322 2e27 2c0d 0a20 2020   in "%s".',..   
-00047a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047a50: 2020 2020 2020 2020 2020 2020 2020 6772                gr
-00047a60: 6964 2e74 6162 6c65 2c20 7365 6c66 2e64  id.table, self.d
-00047a70: 6229 0d0a 2020 2020 2020 2020 2020 2020  b)..            
-00047a80: 2020 2020 6572 726f 726d 7367 203d 2027      errormsg = '
-00047a90: 4572 726f 7220 7361 7669 6e67 2074 6162  Error saving tab
-00047aa0: 6c65 2025 7320 696e 2022 2573 223a 5c6e  le %s in "%s":\n
-00047ab0: 5c6e 2573 2720 2520 280d 0a20 2020 2020  \n%s' % (..     
-00047ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047ad0: 2020 2020 2020 6772 6964 2e74 6162 6c65        grid.table
-00047ae0: 2c20 7365 6c66 2e64 622c 2074 7261 6365  , self.db, trace
-00047af0: 6261 636b 2e66 6f72 6d61 745f 6578 6328  back.format_exc(
-00047b00: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
-00047b10: 2020 2020 7778 2e4d 6573 7361 6765 426f      wx.MessageBo
-00047b20: 7828 6572 726f 726d 7367 2c20 636f 6e66  x(errormsg, conf
-00047b30: 2e54 6974 6c65 2c20 7778 2e4f 4b20 7c20  .Title, wx.OK | 
-00047b40: 7778 2e49 434f 4e5f 5741 524e 494e 4729  wx.ICON_WARNING)
-00047b50: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00047b60: 2020 6272 6561 6b20 2320 666f 7220 6772    break # for gr
-00047b70: 6964 0d0a 2020 2020 2020 2020 7265 7475  id..        retu
-00047b80: 726e 2072 6573 756c 740d 0a0d 0a0d 0a20  rn result...... 
-00047b90: 2020 2064 6566 206f 6e5f 6368 616e 6765     def on_change
-00047ba0: 5f74 6162 6c65 2873 656c 662c 2065 7665  _table(self, eve
-00047bb0: 6e74 293a 0d0a 2020 2020 2020 2020 2222  nt):..        ""
-00047bc0: 220d 0a20 2020 2020 2020 2048 616e 646c  "..        Handl
-00047bd0: 6572 2077 6865 6e20 7461 626c 6520 6772  er when table gr
-00047be0: 6964 2064 6174 6120 6973 2063 6861 6e67  id data is chang
-00047bf0: 6564 2c20 7265 6672 6573 6865 7320 6963  ed, refreshes ic
-00047c00: 6f6e 732c 0d0a 2020 2020 2020 2020 7461  ons,..        ta
-00047c10: 626c 6520 6c69 7374 7320 616e 6420 6461  ble lists and da
-00047c20: 7461 6261 7365 2064 6973 706c 6179 2e0d  tabase display..
-00047c30: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
-00047c40: 2020 2020 2020 6772 6964 5f64 6174 6120        grid_data 
-00047c50: 3d20 7365 6c66 2e67 7269 645f 7461 626c  = self.grid_tabl
-00047c60: 652e 5461 626c 650d 0a20 2020 2020 2020  e.Table..       
-00047c70: 2023 2045 6e61 626c 652f 6469 7361 626c   # Enable/disabl
-00047c80: 6520 636f 6d6d 6974 2061 6e64 2072 6f6c  e commit and rol
-00047c90: 6c62 6163 6b20 6963 6f6e 730d 0a20 2020  lback icons..   
-00047ca0: 2020 2020 2073 656c 662e 7462 5f67 7269       self.tb_gri
-00047cb0: 642e 456e 6162 6c65 546f 6f6c 2877 782e  d.EnableTool(wx.
-00047cc0: 4944 5f53 4156 452c 2067 7269 645f 6461  ID_SAVE, grid_da
-00047cd0: 7461 2e49 7343 6861 6e67 6564 2829 290d  ta.IsChanged()).
-00047ce0: 0a20 2020 2020 2020 2073 656c 662e 7462  .        self.tb
-00047cf0: 5f67 7269 642e 456e 6162 6c65 546f 6f6c  _grid.EnableTool
-00047d00: 2877 782e 4944 5f55 4e44 4f2c 2067 7269  (wx.ID_UNDO, gri
-00047d10: 645f 6461 7461 2e49 7343 6861 6e67 6564  d_data.IsChanged
-00047d20: 2829 290d 0a20 2020 2020 2020 2023 2048  ())..        # H
-00047d30: 6967 686c 6967 6874 2063 6861 6e67 6564  ighlight changed
-00047d40: 2074 6162 6c65 7320 696e 2074 6865 2074   tables in the t
-00047d50: 6162 6c65 206c 6973 740d 0a20 2020 2020  able list..     
-00047d60: 2020 2063 6f6c 6f75 7220 3d20 636f 6e66     colour = conf
-00047d70: 2e44 4254 6162 6c65 4368 616e 6765 6443  .DBTableChangedC
-00047d80: 6f6c 6f75 7220 6966 2067 7269 645f 6461  olour if grid_da
-00047d90: 7461 2e49 7343 6861 6e67 6564 2829 205c  ta.IsChanged() \
-00047da0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00047db0: 2020 2065 6c73 6520 7365 6c66 2e74 7265     else self.tre
-00047dc0: 655f 7461 626c 6573 2e46 6f72 6567 726f  e_tables.Foregro
-00047dd0: 756e 6443 6f6c 6f75 720d 0a20 2020 2020  undColour..     
-00047de0: 2020 2069 7465 6d20 3d20 7365 6c66 2e74     item = self.t
-00047df0: 7265 655f 7461 626c 6573 2e47 6574 4e65  ree_tables.GetNe
-00047e00: 7874 2873 656c 662e 7472 6565 5f74 6162  xt(self.tree_tab
-00047e10: 6c65 732e 4765 7452 6f6f 7449 7465 6d28  les.GetRootItem(
-00047e20: 2929 0d0a 2020 2020 2020 2020 7768 696c  ))..        whil
-00047e30: 6520 6974 656d 2061 6e64 2069 7465 6d2e  e item and item.
-00047e40: 4973 4f6b 2829 3a0d 0a20 2020 2020 2020  IsOk():..       
-00047e50: 2020 2020 206c 6973 745f 7461 626c 6520       list_table 
-00047e60: 3d20 7365 6c66 2e74 7265 655f 7461 626c  = self.tree_tabl
-00047e70: 6573 2e47 6574 4974 656d 5079 4461 7461  es.GetItemPyData
-00047e80: 2869 7465 6d29 0d0a 2020 2020 2020 2020  (item)..        
-00047e90: 2020 2020 6966 206c 6973 745f 7461 626c      if list_tabl
-00047ea0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00047eb0: 2020 2020 6966 206c 6973 745f 7461 626c      if list_tabl
-00047ec0: 652e 6c6f 7765 7228 2920 3d3d 2067 7269  e.lower() == gri
-00047ed0: 645f 6461 7461 2e74 6162 6c65 2e6c 6f77  d_data.table.low
-00047ee0: 6572 2829 3a0d 0a20 2020 2020 2020 2020  er():..         
-00047ef0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00047f00: 7472 6565 5f74 6162 6c65 732e 5365 7449  tree_tables.SetI
-00047f10: 7465 6d54 6578 7443 6f6c 6f75 7228 6974  temTextColour(it
-00047f20: 656d 2c20 636f 6c6f 7572 290d 0a0d 0a20  em, colour).... 
-00047f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047f40: 2020 2062 7265 616b 2023 2062 7265 616b     break # break
-00047f50: 2077 6869 6c65 2069 7465 6d20 616e 6420   while item and 
-00047f60: 6974 656d 2e49 734f 6b28 290d 0a20 2020  item.IsOk()..   
-00047f70: 2020 2020 2020 2020 2069 7465 6d20 3d20           item = 
-00047f80: 7365 6c66 2e74 7265 655f 7461 626c 6573  self.tree_tables
-00047f90: 2e47 6574 4e65 7874 5369 626c 696e 6728  .GetNextSibling(
-00047fa0: 6974 656d 290d 0a0d 0a20 2020 2020 2020  item)....       
-00047fb0: 2023 204d 6172 6b20 6461 7461 6261 7365   # Mark database
-00047fc0: 2061 7320 6368 616e 6765 642f 7072 6973   as changed/pris
-00047fd0: 7469 6e65 2069 6e20 7468 6520 7061 7265  tine in the pare
-00047fe0: 6e74 206e 6f74 6562 6f6f 6b20 7461 6273  nt notebook tabs
-00047ff0: 0d0a 2020 2020 2020 2020 666f 7220 6920  ..        for i 
-00048000: 696e 2072 616e 6765 2873 656c 662e 7061  in range(self.pa
-00048010: 7265 6e74 5f6e 6f74 6562 6f6f 6b2e 4765  rent_notebook.Ge
-00048020: 7450 6167 6543 6f75 6e74 2829 293a 0d0a  tPageCount()):..
-00048030: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-00048040: 656c 662e 7061 7265 6e74 5f6e 6f74 6562  elf.parent_noteb
-00048050: 6f6f 6b2e 4765 7450 6167 6528 6929 203d  ook.GetPage(i) =
-00048060: 3d20 7365 6c66 3a0d 0a20 2020 2020 2020  = self:..       
-00048070: 2020 2020 2020 2020 2073 7566 6669 7820           suffix 
-00048080: 3d20 222a 2220 6966 2073 656c 662e 6765  = "*" if self.ge
-00048090: 745f 756e 7361 7665 645f 6772 6964 7328  t_unsaved_grids(
-000480a0: 2920 656c 7365 2022 220d 0a20 2020 2020  ) else ""..     
-000480b0: 2020 2020 2020 2020 2020 2074 6974 6c65             title
-000480c0: 203d 2073 656c 662e 7469 746c 6520 2b20   = self.title + 
-000480d0: 7375 6666 6978 0d0a 2020 2020 2020 2020  suffix..        
-000480e0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-000480f0: 7061 7265 6e74 5f6e 6f74 6562 6f6f 6b2e  parent_notebook.
-00048100: 4765 7450 6167 6554 6578 7428 6929 2021  GetPageText(i) !
-00048110: 3d20 7469 746c 653a 0d0a 2020 2020 2020  = title:..      
-00048120: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00048130: 6c66 2e70 6172 656e 745f 6e6f 7465 626f  lf.parent_notebo
-00048140: 6f6b 2e53 6574 5061 6765 5465 7874 2869  ok.SetPageText(i
-00048150: 2c20 7469 746c 6529 0d0a 2020 2020 2020  , title)..      
-00048160: 2020 2020 2020 2020 2020 6272 6561 6b20            break 
-00048170: 2320 666f 7220 690d 0a0d 0a0d 0a20 2020  # for i......   
-00048180: 2064 6566 206f 6e5f 636f 6d6d 6974 5f74   def on_commit_t
-00048190: 6162 6c65 2873 656c 662c 2065 7665 6e74  able(self, event
-000481a0: 293a 0d0a 2020 2020 2020 2020 2222 2248  ):..        """H
-000481b0: 616e 646c 6572 2066 6f72 2063 6c69 636b  andler for click
-000481c0: 696e 6720 746f 2063 6f6d 6d69 7420 7468  ing to commit th
-000481d0: 6520 6368 616e 6765 6420 6461 7461 6261  e changed databa
-000481e0: 7365 2074 6162 6c65 2e22 2222 0d0a 2020  se table."""..  
-000481f0: 2020 2020 2020 696e 666f 203d 2073 656c        info = sel
-00048200: 662e 6772 6964 5f74 6162 6c65 2e54 6162  f.grid_table.Tab
-00048210: 6c65 2e47 6574 4368 616e 6765 6449 6e66  le.GetChangedInf
-00048220: 6f28 290d 0a20 2020 2020 2020 2069 6620  o()..        if 
-00048230: 7778 2e4f 4b20 3d3d 2077 782e 4d65 7373  wx.OK == wx.Mess
-00048240: 6167 6542 6f78 280d 0a20 2020 2020 2020  ageBox(..       
-00048250: 2020 2020 2022 4172 6520 796f 7520 7375       "Are you su
-00048260: 7265 2079 6f75 2077 616e 7420 746f 2063  re you want to c
-00048270: 6f6d 6d69 7420 7468 6573 6520 6368 616e  ommit these chan
-00048280: 6765 7320 2825 7329 3f22 2025 0d0a 2020  ges (%s)?" %..  
-00048290: 2020 2020 2020 2020 2020 696e 666f 2c20            info, 
-000482a0: 636f 6e66 2e54 6974 6c65 2c20 7778 2e4f  conf.Title, wx.O
-000482b0: 4b20 7c20 7778 2e43 414e 4345 4c20 7c20  K | wx.CANCEL | 
-000482c0: 7778 2e49 434f 4e5f 5155 4553 5449 4f4e  wx.ICON_QUESTION
-000482d0: 0d0a 2020 2020 2020 2020 293a 0d0a 2020  ..        ):..  
-000482e0: 2020 2020 2020 2020 2020 6c6f 6767 6572            logger
-000482f0: 2e69 6e66 6f28 2243 6f6d 6d69 7474 696e  .info("Committin
-00048300: 6720 2573 2069 6e20 7461 626c 6520 2573  g %s in table %s
-00048310: 2028 2573 292e 222c 2069 6e66 6f2c 0d0a   (%s).", info,..
-00048320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048330: 2020 2020 2020 2020 7365 6c66 2e67 7269          self.gri
-00048340: 645f 7461 626c 652e 5461 626c 652e 7461  d_table.Table.ta
-00048350: 626c 652c 2073 656c 662e 6462 290d 0a20  ble, self.db).. 
-00048360: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00048370: 6772 6964 5f74 6162 6c65 2e54 6162 6c65  grid_table.Table
-00048380: 2e53 6176 6543 6861 6e67 6573 2829 0d0a  .SaveChanges()..
-00048390: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000483a0: 2e6f 6e5f 6368 616e 6765 5f74 6162 6c65  .on_change_table
-000483b0: 284e 6f6e 6529 0d0a 2020 2020 2020 2020  (None)..        
-000483c0: 2020 2020 2320 5265 6672 6573 6820 7461      # Refresh ta
-000483d0: 626c 6573 206c 6973 7420 7769 7468 2075  bles list with u
-000483e0: 7064 6174 6564 2072 6f77 2063 6f75 6e74  pdated row count
-000483f0: 730d 0a20 2020 2020 2020 2020 2020 2074  s..            t
-00048400: 6162 6c65 6d61 7020 3d20 6469 6374 2828  ablemap = dict((
-00048410: 745b 226e 616d 6522 5d2c 2074 2920 666f  t["name"], t) fo
-00048420: 7220 7420 696e 2073 656c 662e 6462 2e67  r t in self.db.g
-00048430: 6574 5f74 6162 6c65 7328 5472 7565 2929  et_tables(True))
-00048440: 0d0a 2020 2020 2020 2020 2020 2020 6974  ..            it
-00048450: 656d 203d 2073 656c 662e 7472 6565 5f74  em = self.tree_t
-00048460: 6162 6c65 732e 4765 744e 6578 7428 7365  ables.GetNext(se
-00048470: 6c66 2e74 7265 655f 7461 626c 6573 2e47  lf.tree_tables.G
-00048480: 6574 526f 6f74 4974 656d 2829 290d 0a20  etRootItem()).. 
-00048490: 2020 2020 2020 2020 2020 2077 6869 6c65             while
-000484a0: 2069 7465 6d20 616e 6420 6974 656d 2e49   item and item.I
-000484b0: 734f 6b28 293a 0d0a 2020 2020 2020 2020  sOk():..        
-000484c0: 2020 2020 2020 2020 7461 626c 6520 3d20          table = 
-000484d0: 7365 6c66 2e74 7265 655f 7461 626c 6573  self.tree_tables
-000484e0: 2e47 6574 4974 656d 5079 4461 7461 2869  .GetItemPyData(i
-000484f0: 7465 6d29 0d0a 2020 2020 2020 2020 2020  tem)..          
-00048500: 2020 2020 2020 6966 2074 6162 6c65 3a0d        if table:.
-00048510: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00048520: 2020 2020 2073 656c 662e 7472 6565 5f74       self.tree_t
-00048530: 6162 6c65 732e 5365 7449 7465 6d54 6578  ables.SetItemTex
-00048540: 7428 6974 656d 2c20 2225 6420 726f 7725  t(item, "%d row%
-00048550: 7322 2025 2028 0d0a 2020 2020 2020 2020  s" % (..        
-00048560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048570: 7461 626c 656d 6170 5b74 6162 6c65 5d5b  tablemap[table][
-00048580: 2272 6f77 7322 5d2c 0d0a 2020 2020 2020  "rows"],..      
-00048590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000485a0: 2020 2273 2220 6966 2074 6162 6c65 6d61    "s" if tablema
-000485b0: 705b 7461 626c 655d 5b22 726f 7773 225d  p[table]["rows"]
-000485c0: 2021 3d20 3120 656c 7365 2022 2022 0d0a   != 1 else " "..
-000485d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000485e0: 2020 2020 292c 2031 290d 0a20 2020 2020      ), 1)..     
-000485f0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00048600: 6620 7461 626c 6520 3d3d 2073 656c 662e  f table == self.
-00048610: 6772 6964 5f74 6162 6c65 2e54 6162 6c65  grid_table.Table
-00048620: 2e74 6162 6c65 3a0d 0a20 2020 2020 2020  .table:..       
-00048630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048640: 2073 656c 662e 7472 6565 5f74 6162 6c65   self.tree_table
-00048650: 732e 5365 7449 7465 6d42 6f6c 6428 6974  s.SetItemBold(it
-00048660: 656d 2c0d 0a20 2020 2020 2020 2020 2020  em,..           
-00048670: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00048680: 662e 6772 6964 5f74 6162 6c65 2e54 6162  f.grid_table.Tab
-00048690: 6c65 2e49 7343 6861 6e67 6564 2829 290d  le.IsChanged()).
-000486a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000486b0: 2069 7465 6d20 3d20 7365 6c66 2e74 7265   item = self.tre
-000486c0: 655f 7461 626c 6573 2e47 6574 4e65 7874  e_tables.GetNext
-000486d0: 5369 626c 696e 6728 6974 656d 290d 0a20  Sibling(item).. 
-000486e0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000486f0: 6772 6964 5f74 6162 6c65 2e46 6f72 6365  grid_table.Force
-00048700: 5265 6672 6573 6828 2920 2023 2052 6566  Refresh()  # Ref
-00048710: 7265 7368 2063 656c 6c20 636f 6c6f 7572  resh cell colour
-00048720: 730d 0a0d 0a0d 0a20 2020 2064 6566 206f  s......    def o
-00048730: 6e5f 726f 6c6c 6261 636b 5f74 6162 6c65  n_rollback_table
-00048740: 2873 656c 662c 2065 7665 6e74 293a 0d0a  (self, event):..
-00048750: 2020 2020 2020 2020 2222 2248 616e 646c          """Handl
-00048760: 6572 2066 6f72 2063 6c69 636b 696e 6720  er for clicking 
-00048770: 746f 2072 6f6c 6c62 6163 6b20 7468 6520  to rollback the 
-00048780: 6368 616e 6765 6420 6461 7461 6261 7365  changed database
-00048790: 2074 6162 6c65 2e22 2222 0d0a 2020 2020   table."""..    
-000487a0: 2020 2020 7365 6c66 2e67 7269 645f 7461      self.grid_ta
-000487b0: 626c 652e 5461 626c 652e 556e 646f 4368  ble.Table.UndoCh
-000487c0: 616e 6765 7328 290d 0a20 2020 2020 2020  anges()..       
-000487d0: 2073 656c 662e 6f6e 5f63 6861 6e67 655f   self.on_change_
-000487e0: 7461 626c 6528 4e6f 6e65 290d 0a20 2020  table(None)..   
-000487f0: 2020 2020 2073 656c 662e 6772 6964 5f74       self.grid_t
-00048800: 6162 6c65 2e43 6f6e 7461 696e 696e 6753  able.ContainingS
-00048810: 697a 6572 2e4c 6179 6f75 7428 2920 2023  izer.Layout()  #
-00048820: 2052 6566 7265 7368 2073 6372 6f6c 6c62   Refresh scrollb
-00048830: 6172 730d 0a20 2020 2020 2020 2073 656c  ars..        sel
-00048840: 662e 6772 6964 5f74 6162 6c65 2e46 6f72  f.grid_table.For
-00048850: 6365 5265 6672 6573 6828 2920 2320 5265  ceRefresh() # Re
-00048860: 6672 6573 6820 6365 6c6c 2063 6f6c 6f75  fresh cell colou
-00048870: 7273 0d0a 0d0a 0d0a 2020 2020 6465 6620  rs......    def 
-00048880: 6f6e 5f69 6e73 6572 745f 726f 7728 7365  on_insert_row(se
-00048890: 6c66 2c20 6576 656e 7429 3a0d 0a20 2020  lf, event):..   
-000488a0: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-000488b0: 2020 4861 6e64 6c65 7220 666f 7220 636c    Handler for cl
-000488c0: 6963 6b69 6e67 2074 6f20 696e 7365 7274  icking to insert
-000488d0: 2061 2074 6162 6c65 2072 6f77 2c20 6c65   a table row, le
-000488e0: 7473 2074 6865 2075 7365 7220 6564 6974  ts the user edit
-000488f0: 2061 206e 6577 0d0a 2020 2020 2020 2020   a new..        
-00048900: 6772 6964 206c 696e 652e 0d0a 2020 2020  grid line...    
-00048910: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
-00048920: 2073 656c 662e 6772 6964 5f74 6162 6c65   self.grid_table
-00048930: 2e49 6e73 6572 7452 6f77 7328 706f 733d  .InsertRows(pos=
-00048940: 302c 206e 756d 526f 7773 3d31 290d 0a20  0, numRows=1).. 
-00048950: 2020 2020 2020 2073 656c 662e 6772 6964         self.grid
-00048960: 5f74 6162 6c65 2e53 6574 4772 6964 4375  _table.SetGridCu
-00048970: 7273 6f72 2830 2c20 7365 6c66 2e67 7269  rsor(0, self.gri
-00048980: 645f 7461 626c 652e 4765 7447 7269 6443  d_table.GetGridC
-00048990: 7572 736f 7243 6f6c 2829 290d 0a20 2020  ursorCol())..   
-000489a0: 2020 2020 2073 656c 662e 6772 6964 5f74       self.grid_t
-000489b0: 6162 6c65 2e53 6372 6f6c 6c28 7365 6c66  able.Scroll(self
-000489c0: 2e67 7269 645f 7461 626c 652e 4765 7453  .grid_table.GetS
-000489d0: 6372 6f6c 6c50 6f73 2877 782e 484f 5249  crollPos(wx.HORI
-000489e0: 5a4f 4e54 414c 292c 2030 290d 0a20 2020  ZONTAL), 0)..   
-000489f0: 2020 2020 2073 656c 662e 6772 6964 5f74       self.grid_t
-00048a00: 6162 6c65 2e52 6566 7265 7368 2829 0d0a  able.Refresh()..
-00048a10: 2020 2020 2020 2020 7365 6c66 2e6f 6e5f          self.on_
-00048a20: 6368 616e 6765 5f74 6162 6c65 284e 6f6e  change_table(Non
-00048a30: 6529 0d0a 2020 2020 2020 2020 7365 6c66  e)..        self
-00048a40: 2e67 7269 645f 7461 626c 652e 436f 6e74  .grid_table.Cont
-00048a50: 6169 6e69 6e67 5369 7a65 722e 4c61 796f  ainingSizer.Layo
-00048a60: 7574 2829 2020 2320 5265 6672 6573 6820  ut()  # Refresh 
-00048a70: 7363 726f 6c6c 6261 7273 0d0a 0d0a 0d0a  scrollbars......
-00048a80: 2020 2020 6465 6620 6f6e 5f64 656c 6574      def on_delet
-00048a90: 655f 726f 7728 7365 6c66 2c20 6576 656e  e_row(self, even
-00048aa0: 7429 3a0d 0a20 2020 2020 2020 2022 2222  t):..        """
-00048ab0: 0d0a 2020 2020 2020 2020 4861 6e64 6c65  ..        Handle
-00048ac0: 7220 666f 7220 636c 6963 6b69 6e67 2074  r for clicking t
-00048ad0: 6f20 6465 6c65 7465 2061 2074 6162 6c65  o delete a table
-00048ae0: 2072 6f77 2c20 7265 6d6f 7665 7320 7468   row, removes th
-00048af0: 6520 726f 7720 6672 6f6d 2067 7269 642e  e row from grid.
-00048b00: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
-00048b10: 2020 2020 2020 2073 656c 6563 7465 645f         selected_
-00048b20: 726f 7773 203d 2073 656c 662e 6772 6964  rows = self.grid
-00048b30: 5f74 6162 6c65 2e47 6574 5365 6c65 6374  _table.GetSelect
-00048b40: 6564 526f 7773 2829 0d0a 2020 2020 2020  edRows()..      
-00048b50: 2020 6375 7273 6f72 5f72 6f77 203d 2073    cursor_row = s
-00048b60: 656c 662e 6772 6964 5f74 6162 6c65 2e47  elf.grid_table.G
-00048b70: 6574 4772 6964 4375 7273 6f72 526f 7728  etGridCursorRow(
-00048b80: 290d 0a20 2020 2020 2020 2069 6620 6375  )..        if cu
-00048b90: 7273 6f72 5f72 6f77 203e 3d20 303a 0d0a  rsor_row >= 0:..
-00048ba0: 2020 2020 2020 2020 2020 2020 7365 6c65              sele
-00048bb0: 6374 6564 5f72 6f77 732e 6170 7065 6e64  cted_rows.append
-00048bc0: 2863 7572 736f 725f 726f 7729 0d0a 2020  (cursor_row)..  
-00048bd0: 2020 2020 2020 666f 7220 726f 7720 696e        for row in
-00048be0: 2073 656c 6563 7465 645f 726f 7773 3a0d   selected_rows:.
-00048bf0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00048c00: 662e 6772 6964 5f74 6162 6c65 2e44 656c  f.grid_table.Del
-00048c10: 6574 6552 6f77 7328 726f 7729 0d0a 2020  eteRows(row)..  
-00048c20: 2020 2020 2020 7365 6c66 2e67 7269 645f        self.grid_
-00048c30: 7461 626c 652e 436f 6e74 6169 6e69 6e67  table.Containing
-00048c40: 5369 7a65 722e 4c61 796f 7574 2829 2023  Sizer.Layout() #
-00048c50: 2052 6566 7265 7368 2073 6372 6f6c 6c62   Refresh scrollb
-00048c60: 6172 730d 0a20 2020 2020 2020 2073 656c  ars..        sel
-00048c70: 662e 6f6e 5f63 6861 6e67 655f 7461 626c  f.on_change_tabl
-00048c80: 6528 4e6f 6e65 290d 0a0d 0a0d 0a20 2020  e(None)......   
-00048c90: 2064 6566 206f 6e5f 7570 6461 7465 5f67   def on_update_g
-00048ca0: 7269 645f 7461 626c 6528 7365 6c66 2c20  rid_table(self, 
-00048cb0: 6576 656e 7429 3a0d 0a20 2020 2020 2020  event):..       
-00048cc0: 2022 2222 5265 6672 6573 6865 7320 7468   """Refreshes th
-00048cd0: 6520 7461 626c 6520 6772 6964 2055 4920  e table grid UI 
-00048ce0: 636f 6d70 6f6e 656e 7473 2c20 6c69 6b65  components, like
-00048cf0: 2074 6f6f 6c62 6172 2069 636f 6e73 2e22   toolbar icons."
-00048d00: 2222 0d0a 2020 2020 2020 2020 7365 6c66  ""..        self
-00048d10: 2e74 625f 6772 6964 2e45 6e61 626c 6554  .tb_grid.EnableT
-00048d20: 6f6f 6c28 7778 2e49 445f 5341 5645 2c20  ool(wx.ID_SAVE, 
-00048d30: 7365 6c66 2e67 7269 645f 7461 626c 652e  self.grid_table.
-00048d40: 5461 626c 652e 4973 4368 616e 6765 6428  Table.IsChanged(
-00048d50: 2929 0d0a 2020 2020 2020 2020 7365 6c66  ))..        self
-00048d60: 2e74 625f 6772 6964 2e45 6e61 626c 6554  .tb_grid.EnableT
-00048d70: 6f6f 6c28 7778 2e49 445f 554e 444f 2c20  ool(wx.ID_UNDO, 
-00048d80: 7365 6c66 2e67 7269 645f 7461 626c 652e  self.grid_table.
-00048d90: 5461 626c 652e 4973 4368 616e 6765 6428  Table.IsChanged(
-00048da0: 2929 0d0a 0d0a 0d0a 2020 2020 6465 6620  ))......    def 
-00048db0: 6f6e 5f63 6861 6e67 655f 7472 6565 5f74  on_change_tree_t
-00048dc0: 6162 6c65 7328 7365 6c66 2c20 6576 656e  ables(self, even
-00048dd0: 7429 3a0d 0a20 2020 2020 2020 2022 2222  t):..        """
-00048de0: 0d0a 2020 2020 2020 2020 4861 6e64 6c65  ..        Handle
-00048df0: 7220 666f 7220 7365 6c65 6374 696e 6720  r for selecting 
-00048e00: 616e 2069 7465 6d20 696e 2074 6865 2074  an item in the t
-00048e10: 6162 6c65 7320 6c69 7374 2c20 6c6f 6164  ables list, load
-00048e20: 7320 7468 6520 7461 626c 6520 6461 7461  s the table data
-00048e30: 0d0a 2020 2020 2020 2020 696e 746f 2074  ..        into t
-00048e40: 6865 2074 6162 6c65 2067 7269 642e 0d0a  he table grid...
-00048e50: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
-00048e60: 2020 2020 2074 6162 6c65 203d 204e 6f6e       table = Non
-00048e70: 650d 0a20 2020 2020 2020 2069 7465 6d20  e..        item 
-00048e80: 3d20 6576 656e 742e 4765 7449 7465 6d28  = event.GetItem(
-00048e90: 290d 0a20 2020 2020 2020 2069 6620 6974  )..        if it
-00048ea0: 656d 2061 6e64 2069 7465 6d2e 4973 4f6b  em and item.IsOk
-00048eb0: 2829 3a0d 0a20 2020 2020 2020 2020 2020  ():..           
-00048ec0: 2074 6162 6c65 203d 2073 656c 662e 7472   table = self.tr
-00048ed0: 6565 5f74 6162 6c65 732e 4765 7449 7465  ee_tables.GetIte
-00048ee0: 6d50 7944 6174 6128 6974 656d 290d 0a20  mPyData(item).. 
-00048ef0: 2020 2020 2020 2020 2020 206c 6f77 6572             lower
-00048f00: 203d 2074 6162 6c65 2e6c 6f77 6572 2829   = table.lower()
-00048f10: 2069 6620 7461 626c 6520 656c 7365 204e   if table else N
-00048f20: 6f6e 650d 0a20 2020 2020 2020 2069 6620  one..        if 
-00048f30: 7461 626c 6520 616e 6420 5c0d 0a20 2020  table and \..   
-00048f40: 2020 2020 2028 6e6f 7420 7365 6c66 2e67       (not self.g
-00048f50: 7269 645f 7461 626c 652e 5461 626c 650d  rid_table.Table.
-00048f60: 0a20 2020 2020 2020 2020 6f72 2073 656c  .         or sel
-00048f70: 662e 6772 6964 5f74 6162 6c65 2e54 6162  f.grid_table.Tab
-00048f80: 6c65 2e74 6162 6c65 2e6c 6f77 6572 2829  le.table.lower()
-00048f90: 2021 3d20 6c6f 7765 7229 3a0d 0a20 2020   != lower):..   
-00048fa0: 2020 2020 2020 2020 2069 203d 2073 656c           i = sel
-00048fb0: 662e 7472 6565 5f74 6162 6c65 732e 4765  f.tree_tables.Ge
-00048fc0: 744e 6578 7428 7365 6c66 2e74 7265 655f  tNext(self.tree_
-00048fd0: 7461 626c 6573 2e47 6574 526f 6f74 4974  tables.GetRootIt
-00048fe0: 656d 2829 290d 0a20 2020 2020 2020 2020  em())..         
-00048ff0: 2020 2077 6869 6c65 2069 3a0d 0a20 2020     while i:..   
-00049000: 2020 2020 2020 2020 2020 2020 2074 6578               tex
-00049010: 7420 3d20 7365 6c66 2e74 7265 655f 7461  t = self.tree_ta
-00049020: 626c 6573 2e47 6574 4974 656d 5465 7874  bles.GetItemText
-00049030: 2869 292e 6c6f 7765 7228 290d 0a20 2020  (i).lower()..   
-00049040: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00049050: 662e 7472 6565 5f74 6162 6c65 732e 5365  f.tree_tables.Se
-00049060: 7449 7465 6d42 6f6c 6428 692c 2074 6578  tItemBold(i, tex
-00049070: 7420 3d3d 206c 6f77 6572 290d 0a20 2020  t == lower)..   
-00049080: 2020 2020 2020 2020 2020 2020 2069 203d               i =
-00049090: 2073 656c 662e 7472 6565 5f74 6162 6c65   self.tree_table
-000490a0: 732e 4765 744e 6578 7453 6962 6c69 6e67  s.GetNextSibling
-000490b0: 2869 290d 0a20 2020 2020 2020 2020 2020  (i)..           
-000490c0: 206c 6f67 6765 722e 696e 666f 2822 4c6f   logger.info("Lo
-000490d0: 6164 696e 6720 7461 626c 6520 2573 2028  ading table %s (
-000490e0: 2573 292e 222c 2074 6162 6c65 2c20 7365  %s).", table, se
-000490f0: 6c66 2e64 6229 0d0a 2020 2020 2020 2020  lf.db)..        
-00049100: 2020 2020 6275 7379 203d 2063 6f6e 7472      busy = contr
-00049110: 6f6c 732e 4275 7379 5061 6e65 6c28 7365  ols.BusyPanel(se
-00049120: 6c66 2c20 224c 6f61 6469 6e67 2074 6162  lf, "Loading tab
-00049130: 6c65 205c 2225 735c 222e 2220 2520 7461  le \"%s\"." % ta
-00049140: 626c 6529 0d0a 2020 2020 2020 2020 2020  ble)..          
-00049150: 2020 7472 793a 0d0a 2020 2020 2020 2020    try:..        
-00049160: 2020 2020 2020 2020 6772 6964 5f64 6174          grid_dat
-00049170: 6120 3d20 7365 6c66 2e64 625f 6772 6964  a = self.db_grid
-00049180: 732e 6765 7428 6c6f 7765 7229 0d0a 2020  s.get(lower)..  
-00049190: 2020 2020 2020 2020 2020 2020 2020 6966                if
-000491a0: 206e 6f74 2067 7269 645f 6461 7461 3a0d   not grid_data:.
-000491b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000491c0: 2020 2020 2067 7269 645f 6461 7461 203d       grid_data =
-000491d0: 2053 716c 6974 6547 7269 6442 6173 6528   SqliteGridBase(
-000491e0: 7365 6c66 2e64 622c 2074 6162 6c65 3d74  self.db, table=t
-000491f0: 6162 6c65 290d 0a20 2020 2020 2020 2020  able)..         
-00049200: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00049210: 6462 5f67 7269 6473 5b6c 6f77 6572 5d20  db_grids[lower] 
-00049220: 3d20 6772 6964 5f64 6174 610d 0a20 2020  = grid_data..   
-00049230: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00049240: 662e 6c61 6265 6c5f 7461 626c 652e 4c61  f.label_table.La
-00049250: 6265 6c20 3d20 2254 6162 6c65 205c 2225  bel = "Table \"%
-00049260: 735c 223a 2220 2520 7461 626c 650d 0a20  s\":" % table.. 
-00049270: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00049280: 656c 662e 6772 6964 5f74 6162 6c65 2e53  elf.grid_table.S
-00049290: 6574 5461 626c 6528 4e6f 6e65 290d 0a20  etTable(None).. 
-000492a0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000492b0: 656c 662e 6772 6964 5f74 6162 6c65 2e53  elf.grid_table.S
-000492c0: 6574 5461 626c 6528 6772 6964 5f64 6174  etTable(grid_dat
-000492d0: 6129 0d0a 2020 2020 2020 2020 2020 2020  a)..            
-000492e0: 2020 2020 7365 6c66 2e70 6167 655f 7461      self.page_ta
-000492f0: 626c 6573 2e4c 6179 6f75 7428 2920 2320  bles.Layout() # 
-00049300: 5265 6163 7420 746f 2067 7269 6420 7369  React to grid si
-00049310: 7a65 2063 6861 6e67 650d 0a20 2020 2020  ze change..     
-00049320: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00049330: 6772 6964 5f74 6162 6c65 2e53 6372 6f6c  grid_table.Scrol
-00049340: 6c28 302c 2030 290d 0a20 2020 2020 2020  l(0, 0)..       
-00049350: 2020 2020 2020 2020 2073 656c 662e 6772           self.gr
-00049360: 6964 5f74 6162 6c65 2e53 6574 436f 6c4d  id_table.SetColM
-00049370: 696e 696d 616c 4163 6365 7074 6162 6c65  inimalAcceptable
-00049380: 5769 6474 6828 3130 3029 0d0a 2020 2020  Width(100)..    
-00049390: 2020 2020 2020 2020 2020 2020 636f 6c5f              col_
-000493a0: 7261 6e67 6520 3d20 7261 6e67 6528 6772  range = range(gr
-000493b0: 6964 5f64 6174 612e 4765 744e 756d 6265  id_data.GetNumbe
-000493c0: 7243 6f6c 7328 2929 0d0a 2020 2020 2020  rCols())..      
-000493d0: 2020 2020 2020 2020 2020 5b73 656c 662e            [self.
-000493e0: 6772 6964 5f74 6162 6c65 2e41 7574 6f53  grid_table.AutoS
-000493f0: 697a 6543 6f6c 4c61 6265 6c53 697a 6528  izeColLabelSize(
-00049400: 7829 2066 6f72 2078 2069 6e20 636f 6c5f  x) for x in col_
-00049410: 7261 6e67 655d 0d0a 2020 2020 2020 2020  range]..        
-00049420: 2020 2020 2020 2020 7365 6c66 2e6f 6e5f          self.on_
-00049430: 6368 616e 6765 5f74 6162 6c65 284e 6f6e  change_table(Non
-00049440: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
-00049450: 2020 2020 7365 6c66 2e74 625f 6772 6964      self.tb_grid
-00049460: 2e45 6e61 626c 6554 6f6f 6c28 7778 2e49  .EnableTool(wx.I
-00049470: 445f 4144 442c 2054 7275 6529 0d0a 2020  D_ADD, True)..  
-00049480: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00049490: 6c66 2e74 625f 6772 6964 2e45 6e61 626c  lf.tb_grid.Enabl
-000494a0: 6554 6f6f 6c28 7778 2e49 445f 4445 4c45  eTool(wx.ID_DELE
-000494b0: 5445 2c20 5472 7565 290d 0a20 2020 2020  TE, True)..     
-000494c0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000494d0: 6275 7474 6f6e 5f65 7870 6f72 745f 7461  button_export_ta
-000494e0: 626c 652e 456e 6162 6c65 6420 3d20 5472  ble.Enabled = Tr
-000494f0: 7565 0d0a 2020 2020 2020 2020 2020 2020  ue..            
-00049500: 2020 2020 7365 6c66 2e62 7574 746f 6e5f      self.button_
-00049510: 7265 7365 745f 6772 6964 5f74 6162 6c65  reset_grid_table
-00049520: 2e45 6e61 626c 6564 203d 2054 7275 650d  .Enabled = True.
-00049530: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00049540: 2062 7573 792e 436c 6f73 6528 290d 0a20   busy.Close().. 
-00049550: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-00049560: 7420 4578 6365 7074 696f 6e20 6173 2065  t Exception as e
-00049570: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00049580: 2020 2062 7573 792e 436c 6f73 6528 290d     busy.Close().
-00049590: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000495a0: 2067 7569 6261 7365 2e73 7461 7475 7328   guibase.status(
-000495b0: 2243 6f75 6c64 206e 6f74 206c 6f61 6420  "Could not load 
-000495c0: 7461 626c 6520 2573 3a20 2573 222c 2074  table %s: %s", t
-000495d0: 6162 6c65 2c20 7574 696c 2e66 6f72 6d61  able, util.forma
-000495e0: 745f 6578 6328 6529 290d 0a20 2020 2020  t_exc(e))..     
-000495f0: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
-00049600: 722e 6578 6365 7074 696f 6e28 2243 6f75  r.exception("Cou
-00049610: 6c64 206e 6f74 206c 6f61 6420 7461 626c  ld not load tabl
-00049620: 6520 2573 2e22 2c20 7461 626c 6529 0d0a  e %s.", table)..
-00049630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049640: 6572 726f 726d 7367 203d 2022 436f 756c  errormsg = "Coul
-00049650: 6420 6e6f 7420 6c6f 6164 2074 6162 6c65  d not load table
-00049660: 2025 732e 5c6e 5c6e 2573 2220 2520 5c0d   %s.\n\n%s" % \.
-00049670: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00049680: 2020 2020 2020 2020 2020 2020 2874 6162              (tab
-00049690: 6c65 2c20 7472 6163 6562 6163 6b2e 666f  le, traceback.fo
-000496a0: 726d 6174 5f65 7863 2829 290d 0a20 2020  rmat_exc())..   
-000496b0: 2020 2020 2020 2020 2020 2020 2077 782e               wx.
-000496c0: 4d65 7373 6167 6542 6f78 2865 7272 6f72  MessageBox(error
-000496d0: 6d73 672c 2063 6f6e 662e 5469 746c 652c  msg, conf.Title,
-000496e0: 2077 782e 4f4b 207c 2077 782e 4943 4f4e   wx.OK | wx.ICON
-000496f0: 5f57 4152 4e49 4e47 290d 0a0d 0a0d 0a20  _WARNING)...... 
-00049700: 2020 2064 6566 206f 6e5f 6368 616e 6765     def on_change
-00049710: 5f6c 6973 745f 6368 6174 7328 7365 6c66  _list_chats(self
-00049720: 2c20 6576 656e 7429 3a0d 0a20 2020 2020  , event):..     
-00049730: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
-00049740: 4861 6e64 6c65 7220 666f 7220 7365 6c65  Handler for sele
-00049750: 6374 696e 6720 616e 2069 7465 6d20 696e  cting an item in
-00049760: 2074 6865 2063 6861 7473 206c 6973 742c   the chats list,
-00049770: 206c 6f61 6473 2074 6865 0d0a 2020 2020   loads the..    
-00049780: 2020 2020 6d65 7373 6167 6573 2069 6e74      messages int
-00049790: 6f20 7468 6520 6d65 7373 6167 6520 6c6f  o the message lo
-000497a0: 672e 0d0a 2020 2020 2020 2020 2222 220d  g...        """.
-000497b0: 0a20 2020 2020 2020 2073 656c 662e 6c6f  .        self.lo
-000497c0: 6164 5f63 6861 7428 7365 6c66 2e6c 6973  ad_chat(self.lis
-000497d0: 745f 6368 6174 732e 4765 7449 7465 6d4d  t_chats.GetItemM
-000497e0: 6170 7065 6444 6174 6128 6576 656e 742e  appedData(event.
-000497f0: 496e 6465 7829 290d 0a20 2020 2020 2020  Index))..       
-00049800: 2073 656c 662e 7374 635f 6869 7374 6f72   self.stc_histor
-00049810: 792e 5365 7446 6f63 7573 2829 0d0a 0d0a  y.SetFocus()....
-00049820: 0d0a 2020 2020 6465 6620 6f6e 5f63 6861  ..    def on_cha
-00049830: 6e67 655f 6c69 7374 5f63 6f6e 7461 6374  nge_list_contact
-00049840: 7328 7365 6c66 2c20 6576 656e 7429 3a0d  s(self, event):.
-00049850: 0a20 2020 2020 2020 2022 2222 4861 6e64  .        """Hand
-00049860: 6c65 7220 666f 7220 7365 6c65 6374 696e  ler for selectin
-00049870: 6720 616e 2069 7465 6d20 696e 2074 6865  g an item in the
-00049880: 2063 6f6e 7461 6374 7320 6c69 7374 2c20   contacts list, 
-00049890: 6c6f 6164 7320 636f 6e74 6163 7420 696e  loads contact in
-000498a0: 666f 2e22 2222 0d0a 2020 2020 2020 2020  fo."""..        
-000498b0: 7365 6c66 2e6c 6f61 645f 636f 6e74 6163  self.load_contac
-000498c0: 7428 7365 6c66 2e6c 6973 745f 636f 6e74  t(self.list_cont
-000498d0: 6163 7473 2e47 6574 4974 656d 4d61 7070  acts.GetItemMapp
-000498e0: 6564 4461 7461 2865 7665 6e74 2e49 6e64  edData(event.Ind
-000498f0: 6578 2929 0d0a 0d0a 0d0a 2020 2020 6465  ex))......    de
-00049900: 6620 6c6f 6164 5f63 6861 7428 7365 6c66  f load_chat(self
-00049910: 2c20 6368 6174 2c20 6365 6e74 6572 5f6d  , chat, center_m
-00049920: 6573 7361 6765 5f69 643d 4e6f 6e65 2c20  essage_id=None, 
-00049930: 7265 6c6f 6164 3d46 616c 7365 293a 0d0a  reload=False):..
-00049940: 2020 2020 2020 2020 2222 224c 6f61 6473          """Loads
-00049950: 2068 6973 746f 7279 206f 6620 7468 6520   history of the 
-00049960: 7370 6563 6966 6965 6420 6368 6174 2028  specified chat (
-00049970: 6173 2072 6574 7572 6e65 6420 6672 6f6d  as returned from
-00049980: 2064 6229 2e22 2222 0d0a 2020 2020 2020   db)."""..      
-00049990: 2020 6966 206e 6f74 2063 6861 7420 6f72    if not chat or
-000499a0: 2028 6368 6174 203d 3d20 7365 6c66 2e63   (chat == self.c
-000499b0: 6861 7420 616e 6420 6e6f 7420 6365 6e74  hat and not cent
-000499c0: 6572 5f6d 6573 7361 6765 5f69 6420 616e  er_message_id an
-000499d0: 6420 6e6f 7420 7265 6c6f 6164 293a 0d0a  d not reload):..
-000499e0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000499f0: 726e 0d0a 0d0a 2020 2020 2020 2020 6275  rn....        bu
-00049a00: 7379 2c20 636c 6973 742c 2070 6c69 7374  sy, clist, plist
-00049a10: 203d 204e 6f6e 652c 2073 656c 662e 6c69   = None, self.li
-00049a20: 7374 5f63 6861 7473 2c20 7365 6c66 2e6c  st_chats, self.l
-00049a30: 6973 745f 7061 7274 6963 6970 616e 7473  ist_participants
-00049a40: 0d0a 2020 2020 2020 2020 6966 2063 6861  ..        if cha
-00049a50: 7420 213d 2073 656c 662e 6368 6174 3a0d  t != self.chat:.
-00049a60: 0a20 2020 2020 2020 2020 2020 2023 2055  .            # U
-00049a70: 7064 6174 6520 6368 6174 206c 6973 7420  pdate chat list 
-00049a80: 636f 6c6f 7572 7320 616e 6420 7363 726f  colours and scro
-00049a90: 6c6c 2074 6f20 7468 6520 6f70 656e 6564  ll to the opened
-00049aa0: 2063 6861 740d 0a20 2020 2020 2020 2020   chat..         
-00049ab0: 2020 206c 6f67 6765 722e 696e 666f 2822     logger.info("
-00049ac0: 4f70 656e 696e 6720 2573 2e22 2c20 6368  Opening %s.", ch
-00049ad0: 6174 5b22 7469 746c 655f 6c6f 6e67 5f6c  at["title_long_l
-00049ae0: 6322 5d29 0d0a 2020 2020 2020 2020 2020  c"])..          
-00049af0: 2020 636c 6973 742e 4672 6565 7a65 2829    clist.Freeze()
-00049b00: 0d0a 2020 2020 2020 2020 2020 2020 7363  ..            sc
-00049b10: 726f 6c6c 706f 7320 3d20 636c 6973 742e  rollpos = clist.
-00049b20: 4765 7453 6372 6f6c 6c50 6f73 2877 782e  GetScrollPos(wx.
-00049b30: 5645 5254 4943 414c 290d 0a20 2020 2020  VERTICAL)..     
-00049b40: 2020 2020 2020 2069 6e64 6578 5f73 656c         index_sel
-00049b50: 6563 7465 6420 3d20 2d31 0d0a 2020 2020  ected = -1..    
-00049b60: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
-00049b70: 2072 616e 6765 2863 6c69 7374 2e49 7465   range(clist.Ite
-00049b80: 6d43 6f75 6e74 293a 0d0a 2020 2020 2020  mCount):..      
-00049b90: 2020 2020 2020 2020 2020 6966 2063 6c69            if cli
-00049ba0: 7374 2e47 6574 4974 656d 4d61 7070 6564  st.GetItemMapped
-00049bb0: 4461 7461 2869 2920 3d3d 2073 656c 662e  Data(i) == self.
-00049bc0: 6368 6174 3a0d 0a20 2020 2020 2020 2020  chat:..         
-00049bd0: 2020 2020 2020 2020 2020 2063 6c69 7374             clist
-00049be0: 2e53 6574 4974 656d 466f 6e74 2869 2c20  .SetItemFont(i, 
-00049bf0: 636c 6973 742e 466f 6e74 290d 0a20 2020  clist.Font)..   
-00049c00: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
-00049c10: 6620 636c 6973 742e 4765 7449 7465 6d4d  f clist.GetItemM
-00049c20: 6170 7065 6444 6174 6128 6929 203d 3d20  appedData(i) == 
-00049c30: 6368 6174 3a0d 0a20 2020 2020 2020 2020  chat:..         
-00049c40: 2020 2020 2020 2020 2020 2069 6e64 6578             index
-00049c50: 5f73 656c 6563 7465 6420 3d20 690d 0a20  _selected = i.. 
-00049c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049c70: 2020 2066 203d 2063 6c69 7374 2e46 6f6e     f = clist.Fon
-00049c80: 743b 2066 2e53 6574 5765 6967 6874 2877  t; f.SetWeight(w
-00049c90: 782e 464f 4e54 5745 4947 4854 5f42 4f4c  x.FONTWEIGHT_BOL
-00049ca0: 4429 0d0a 2020 2020 2020 2020 2020 2020  D)..            
-00049cb0: 2020 2020 2020 2020 636c 6973 742e 5365          clist.Se
-00049cc0: 7449 7465 6d46 6f6e 7428 692c 2066 290d  tItemFont(i, f).
-00049cd0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00049ce0: 696e 6465 785f 7365 6c65 6374 6564 203e  index_selected >
-00049cf0: 3d20 303a 0d0a 2020 2020 2020 2020 2020  = 0:..          
-00049d00: 2020 2020 2020 6465 6c74 6120 3d20 696e        delta = in
-00049d10: 6465 785f 7365 6c65 6374 6564 202d 2073  dex_selected - s
-00049d20: 6372 6f6c 6c70 6f73 0d0a 2020 2020 2020  crollpos..      
-00049d30: 2020 2020 2020 2020 2020 6966 2064 656c            if del
-00049d40: 7461 203c 2030 206f 7220 6162 7328 6465  ta < 0 or abs(de
-00049d50: 6c74 6129 203e 3d20 636c 6973 742e 436f  lta) >= clist.Co
-00049d60: 756e 7450 6572 5061 6765 3a0d 0a20 2020  untPerPage:..   
-00049d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049d80: 206e 7564 6765 203d 202d 636c 6973 742e   nudge = -clist.
-00049d90: 436f 756e 7450 6572 5061 6765 202f 2f20  CountPerPage // 
-00049da0: 320d 0a20 2020 2020 2020 2020 2020 2020  2..             
-00049db0: 2020 2020 2020 2063 6c69 7374 2e53 6372         clist.Scr
-00049dc0: 6f6c 6c4c 696e 6573 2864 656c 7461 202b  ollLines(delta +
-00049dd0: 206e 7564 6765 290d 0a20 2020 2020 2020   nudge)..       
-00049de0: 2020 2020 2063 6c69 7374 2e54 6861 7728       clist.Thaw(
-00049df0: 290d 0a20 2020 2020 2020 2020 2020 2077  )..            w
-00049e00: 782e 5969 656c 6449 664e 6565 6465 6428  x.YieldIfNeeded(
-00049e10: 2920 2320 416c 6c6f 7720 6469 7370 6c61  ) # Allow displa
-00049e20: 7920 746f 2072 6566 7265 7368 0d0a 2020  y to refresh..  
-00049e30: 2020 2020 2020 2020 2020 2320 4164 6420            # Add 
-00049e40: 7368 6f72 7463 7574 206b 6579 2066 6c61  shortcut key fla
-00049e50: 6720 746f 2063 6861 7420 6c61 6265 6c0d  g to chat label.
-00049e60: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00049e70: 662e 6c61 6265 6c5f 6368 6174 2e4c 6162  f.label_chat.Lab
-00049e80: 656c 203d 2063 6861 745b 2274 6974 6c65  el = chat["title
-00049e90: 5f6c 6f6e 6722 5d2e 7265 706c 6163 6528  _long"].replace(
-00049ea0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00049eb0: 2020 2263 6861 7422 2c20 2226 6368 6174    "chat", "&chat
-00049ec0: 220d 0a20 2020 2020 2020 2020 2020 2029  "..            )
-00049ed0: 2e72 6570 6c61 6365 2822 4368 6174 222c  .replace("Chat",
-00049ee0: 2022 2643 6861 7422 2920 2b20 223a 220d   "&Chat") + ":".
-00049ef0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00049f00: 662e 6c61 6265 6c5f 6368 6174 2e50 6172  f.label_chat.Par
-00049f10: 656e 742e 4c61 796f 7574 2829 0d0a 0d0a  ent.Layout()....
-00049f20: 2020 2020 2020 2020 6461 7465 735f 7261          dates_ra
-00049f30: 6e67 6520 203d 205b 4e6f 6e65 2c20 4e6f  nge  = [None, No
-00049f40: 6e65 5d20 2320 746f 7461 6c20 6176 6169  ne] # total avai
-00049f50: 6c61 626c 6520 6461 7465 2072 616e 6765  lable date range
-00049f60: 0d0a 2020 2020 2020 2020 6461 7465 735f  ..        dates_
-00049f70: 7661 6c75 6573 203d 205b 4e6f 6e65 2c20  values = [None, 
-00049f80: 4e6f 6e65 5d20 2320 6375 7272 656e 746c  None] # currentl
-00049f90: 7920 6669 6c74 6572 6564 2064 6174 6520  y filtered date 
-00049fa0: 7261 6e67 650d 0a20 2020 2020 2020 2069  range..        i
-00049fb0: 6620 6368 6174 2021 3d20 7365 6c66 2e63  f chat != self.c
-00049fc0: 6861 7420 6f72 2072 656c 6f61 6420 6f72  hat or reload or
-00049fd0: 2028 6365 6e74 6572 5f6d 6573 7361 6765   (center_message
-00049fe0: 5f69 640d 0a20 2020 2020 2020 2061 6e64  _id..        and
-00049ff0: 206e 6f74 2073 656c 662e 7374 635f 6869   not self.stc_hi
-0004a000: 7374 6f72 792e 4973 4d65 7373 6167 6553  story.IsMessageS
-0004a010: 686f 776e 2863 656e 7465 725f 6d65 7373  hown(center_mess
-0004a020: 6167 655f 6964 2929 3a0d 0a20 2020 2020  age_id)):..     
-0004a030: 2020 2020 2020 2062 7573 7920 3d20 636f         busy = co
-0004a040: 6e74 726f 6c73 2e42 7573 7950 616e 656c  ntrols.BusyPanel
-0004a050: 2873 656c 662c 0d0a 2020 2020 2020 2020  (self,..        
-0004a060: 2020 2020 2020 2020 224c 6f61 6469 6e67          "Loading
-0004a070: 2068 6973 746f 7279 2066 6f72 2025 732e   history for %s.
-0004a080: 2220 2520 6368 6174 5b22 7469 746c 655f  " % chat["title_
-0004a090: 6c6f 6e67 5f6c 6322 5d29 0d0a 2020 2020  long_lc"])..    
-0004a0a0: 2020 2020 2020 2020 7472 793a 0d0a 2020          try:..  
-0004a0b0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0004a0c0: 5265 6672 6573 6820 6c61 7374 206d 6573  Refresh last mes
-0004a0d0: 7361 6765 732c 2069 6e20 6361 7365 2064  sages, in case d
-0004a0e0: 6174 6162 6173 6520 6861 7320 7570 6461  atabase has upda
-0004a0f0: 7465 640d 0a20 2020 2020 2020 2020 2020  ted..           
-0004a100: 2020 2020 2073 656c 662e 6462 2e67 6574       self.db.get
-0004a110: 5f63 6f6e 7665 7273 6174 696f 6e73 5f73  _conversations_s
-0004a120: 7461 7473 285b 6368 6174 5d2c 206c 6f67  tats([chat], log
-0004a130: 3d46 616c 7365 290d 0a20 2020 2020 2020  =False)..       
-0004a140: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
-0004a150: 7074 696f 6e3a 0d0a 2020 2020 2020 2020  ption:..        
-0004a160: 2020 2020 2020 2020 6775 6962 6173 652e          guibase.
-0004a170: 7374 6174 7573 2822 4e6f 7469 6365 3a20  status("Notice: 
-0004a180: 6661 696c 6564 2074 6f20 7265 6672 6573  failed to refres
-0004a190: 6820 2573 2e22 2c0d 0a20 2020 2020 2020  h %s.",..       
-0004a1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a1b0: 2020 2020 2020 2020 6368 6174 5b22 7469          chat["ti
-0004a1c0: 746c 655f 6c6f 6e67 5f6c 6322 5d29 0d0a  tle_long_lc"])..
-0004a1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a1e0: 6c6f 6767 6572 2e65 7863 6570 7469 6f6e  logger.exception
-0004a1f0: 2822 4e6f 7469 6365 3a20 6661 696c 6564  ("Notice: failed
-0004a200: 2074 6f20 7265 6672 6573 6820 2573 2e22   to refresh %s."
-0004a210: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0004a220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a230: 2020 2020 6368 6174 5b22 7469 746c 655f      chat["title_
-0004a240: 6c6f 6e67 5f6c 6322 5d29 0d0a 2020 2020  long_lc"])..    
-0004a250: 2020 2020 2020 2020 7365 6c66 2e65 6469          self.edi
-0004a260: 745f 6669 6c74 6572 7465 7874 2e56 616c  t_filtertext.Val
-0004a270: 7565 203d 2073 656c 662e 6368 6174 5f66  ue = self.chat_f
-0004a280: 696c 7465 725b 2274 6578 7422 5d20 3d20  ilter["text"] = 
-0004a290: 2222 0d0a 2020 2020 2020 2020 2020 2020  ""..            
-0004a2a0: 6474 7320 3d20 2266 6972 7374 5f6d 6573  dts = "first_mes
-0004a2b0: 7361 6765 5f64 6174 6574 696d 6522 2c20  sage_datetime", 
-0004a2c0: 226c 6173 745f 6d65 7373 6167 655f 6461  "last_message_da
-0004a2d0: 7465 7469 6d65 220d 0a20 2020 2020 2020  tetime"..       
-0004a2e0: 2020 2020 2064 6174 655f 7261 6e67 6520       date_range 
-0004a2f0: 3d20 5b63 6861 745b 6e5d 2e64 6174 6528  = [chat[n].date(
-0004a300: 2920 6966 2063 6861 745b 6e5d 2065 6c73  ) if chat[n] els
-0004a310: 6520 4e6f 6e65 2066 6f72 206e 2069 6e20  e None for n in 
-0004a320: 6474 735d 0d0a 2020 2020 2020 2020 2020  dts]..          
-0004a330: 2020 7365 6c66 2e63 6861 745f 6669 6c74    self.chat_filt
-0004a340: 6572 5b22 6461 7465 7261 6e67 6522 5d20  er["daterange"] 
-0004a350: 3d20 6461 7465 5f72 616e 6765 0d0a 2020  = date_range..  
-0004a360: 2020 2020 2020 2020 2020 6966 2063 6861            if cha
-0004a370: 7420 213d 2073 656c 662e 6368 6174 3a0d  t != self.chat:.
-0004a380: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004a390: 2073 656c 662e 6368 6174 5f66 696c 7465   self.chat_filte
-0004a3a0: 725b 2273 7461 7274 6461 7465 7261 6e67  r["startdaterang
-0004a3b0: 6522 5d20 3d20 6461 7465 5f72 616e 6765  e"] = date_range
-0004a3c0: 0d0a 2020 2020 2020 2020 2020 2020 6461  ..            da
-0004a3d0: 7465 735f 7261 6e67 6520 3d20 6461 7465  tes_range = date
-0004a3e0: 735f 7661 6c75 6573 203d 2064 6174 655f  s_values = date_
-0004a3f0: 7261 6e67 650d 0a20 2020 2020 2020 2020  range..         
-0004a400: 2020 2061 7661 7461 725f 6465 6661 756c     avatar_defaul
-0004a410: 7420 3d20 696d 6167 6573 2e41 7661 7461  t = images.Avata
-0004a420: 7244 6566 6175 6c74 2e42 6974 6d61 700d  rDefault.Bitmap.
-0004a430: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0004a440: 6368 6174 2021 3d20 7365 6c66 2e63 6861  chat != self.cha
-0004a450: 743a 0d0a 2020 2020 2020 2020 2020 2020  t:..            
-0004a460: 2020 2020 2320 4966 2063 6861 7420 6861      # If chat ha
-0004a470: 7320 6368 616e 6765 642c 206c 6f61 6420  s changed, load 
-0004a480: 6176 6174 6172 2069 6d61 6765 7320 666f  avatar images fo
-0004a490: 7220 7468 6520 636f 6e74 6163 7473 0d0a  r the contacts..
-0004a4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a4b0: 706c 6973 742e 436c 6561 7241 6c6c 2829  plist.ClearAll()
-0004a4c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004a4d0: 2020 706c 6973 742e 496e 7365 7274 436f    plist.InsertCo
-0004a4e0: 6c75 6d6e 2830 2c20 2222 290d 0a20 2020  lumn(0, "")..   
-0004a4f0: 2020 2020 2020 2020 2020 2020 2073 7a5f               sz_
-0004a500: 6176 6174 6172 203d 2063 6f6e 662e 4176  avatar = conf.Av
-0004a510: 6174 6172 496d 6167 6553 697a 650d 0a20  atarImageSize.. 
-0004a520: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0004a530: 6c20 3d20 7778 2e49 6d61 6765 4c69 7374  l = wx.ImageList
-0004a540: 282a 737a 5f61 7661 7461 7229 0d0a 2020  (*sz_avatar)..  
-0004a550: 2020 2020 2020 2020 2020 2020 2020 696c                il
-0004a560: 2e41 6464 2861 7661 7461 725f 6465 6661  .Add(avatar_defa
-0004a570: 756c 7429 0d0a 2020 2020 2020 2020 2020  ult)..          
-0004a580: 2020 2020 2020 706c 6973 742e 4173 7369        plist.Assi
-0004a590: 676e 496d 6167 654c 6973 7428 2069 6c2c  gnImageList( il,
-0004a5a0: 2077 782e 494d 4147 455f 4c49 5354 5f53   wx.IMAGE_LIST_S
-0004a5b0: 4d41 4c4c 290d 0a20 2020 2020 2020 2020  MALL)..         
-0004a5c0: 2020 2020 2020 2069 6e64 6578 203d 2030         index = 0
-0004a5d0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-0004a5e0: 2020 2020 6e6f 6c6f 6720 3d20 7778 2e4c      nolog = wx.L
-0004a5f0: 6f67 4e75 6c6c 2829 2023 2077 7820 7769  ogNull() # wx wi
-0004a600: 6c6c 206f 7468 6572 7769 7365 206f 7065  ll otherwise ope
-0004a610: 6e20 6120 7761 726e 696e 6720 6469 616c  n a warning dial
-0004a620: 6f67 206f 6e20 696d 6167 6520 6572 726f  og on image erro
-0004a630: 720d 0a20 2020 2020 2020 2020 2020 2020  r..             
-0004a640: 2020 2066 6f72 2070 2069 6e20 6368 6174     for p in chat
-0004a650: 5b22 7061 7274 6963 6970 616e 7473 225d  ["participants"]
-0004a660: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0004a670: 2020 2020 2020 2062 203d 2030 0d0a 2020         b = 0..  
-0004a680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a690: 2020 6966 206e 6f74 2070 5b22 636f 6e74    if not p["cont
-0004a6a0: 6163 7422 5d2e 6765 7428 2261 7661 7461  act"].get("avata
-0004a6b0: 725f 6269 746d 6170 2229 3a0d 0a20 2020  r_bitmap"):..   
-0004a6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a6d0: 2020 2020 2069 6d67 203d 2073 6b79 7065       img = skype
-0004a6e0: 6461 7461 2e67 6574 5f61 7661 7461 7228  data.get_avatar(
-0004a6f0: 705b 2263 6f6e 7461 6374 225d 2c20 737a  p["contact"], sz
-0004a700: 5f61 7661 7461 7229 0d0a 2020 2020 2020  _avatar)..      
-0004a710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a720: 2020 6966 2069 6d67 3a0d 0a20 2020 2020    if img:..     
-0004a730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a740: 2020 2020 2020 2070 5b22 636f 6e74 6163         p["contac
-0004a750: 7422 5d5b 2261 7661 7461 725f 6269 746d  t"]["avatar_bitm
-0004a760: 6170 225d 203d 2069 6d67 2e43 6f6e 7665  ap"] = img.Conve
-0004a770: 7274 546f 4269 746d 6170 2829 0d0a 2020  rtToBitmap()..  
-0004a780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a790: 2020 6966 2022 6176 6174 6172 5f62 6974    if "avatar_bit
-0004a7a0: 6d61 7022 2069 6e20 705b 2263 6f6e 7461  map" in p["conta
-0004a7b0: 6374 225d 3a0d 0a20 2020 2020 2020 2020  ct"]:..         
-0004a7c0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-0004a7d0: 203d 2069 6c2e 4164 6428 705b 2263 6f6e   = il.Add(p["con
-0004a7e0: 7461 6374 225d 5b22 6176 6174 6172 5f62  tact"]["avatar_b
-0004a7f0: 6974 6d61 7022 5d29 0d0a 2020 2020 2020  itmap"])..      
-0004a800: 2020 2020 2020 2020 2020 2020 2020 7420                t 
-0004a810: 3d20 705b 2263 6f6e 7461 6374 225d 5b22  = p["contact"]["
-0004a820: 6e61 6d65 225d 0d0a 2020 2020 2020 2020  name"]..        
-0004a830: 2020 2020 2020 2020 2020 2020 6966 2070              if p
-0004a840: 5b22 6964 656e 7469 7479 225d 2021 3d20  ["identity"] != 
-0004a850: 705b 2263 6f6e 7461 6374 225d 5b22 6e61  p["contact"]["na
-0004a860: 6d65 225d 3a0d 0a20 2020 2020 2020 2020  me"]:..         
-0004a870: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0004a880: 202b 3d20 2220 2825 7329 2220 2520 705b   += " (%s)" % p[
-0004a890: 2269 6465 6e74 6974 7922 5d0d 0a20 2020  "identity"]..   
+00046720: 2020 2020 2020 6578 706f 7274 2e65 7870        export.exp
+00046730: 6f72 745f 6772 6964 2867 7269 645f 736f  ort_grid(grid_so
+00046740: 7572 6365 2c20 6669 6c65 6e61 6d65 2c20  urce, filename, 
+00046750: 7469 746c 652c 0d0a 2020 2020 2020 2020  title,..        
+00046760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046770: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00046780: 656c 662e 6462 2c20 7371 6c2c 2074 6162  elf.db, sql, tab
+00046790: 6c65 290d 0a20 2020 2020 2020 2020 2020  le)..           
+000467a0: 2020 2020 2020 2020 2067 7569 6261 7365           guibase
+000467b0: 2e73 7461 7475 7328 2245 7870 6f72 7465  .status("Exporte
+000467c0: 6420 2573 2e22 2c20 6669 6c65 6e61 6d65  d %s.", filename
+000467d0: 2c20 6c6f 673d 5472 7565 290d 0a20 2020  , log=True)..   
+000467e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000467f0: 2069 6620 636f 6e66 2e45 7870 6f72 7446   if conf.ExportF
+00046800: 696c 6541 7574 6f4f 7065 6e3a 2075 7469  ileAutoOpen: uti
+00046810: 6c2e 7374 6172 745f 6669 6c65 2866 696c  l.start_file(fil
+00046820: 656e 616d 6529 0d0a 2020 2020 2020 2020  ename)..        
+00046830: 2020 2020 2020 2020 6578 6365 7074 2045          except E
+00046840: 7863 6570 7469 6f6e 2061 7320 653a 0d0a  xception as e:..
+00046850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046860: 2020 2020 6775 6962 6173 652e 7374 6174      guibase.stat
+00046870: 7573 2822 4572 726f 7220 7361 7669 6e67  us("Error saving
+00046880: 2025 733a 2025 7322 2c20 6669 6c65 6e61   %s: %s", filena
+00046890: 6d65 2c20 7574 696c 2e66 6f72 6d61 745f  me, util.format_
+000468a0: 6578 6328 6529 290d 0a20 2020 2020 2020  exc(e))..       
+000468b0: 2020 2020 2020 2020 2020 2020 206c 6f67               log
+000468c0: 6765 722e 6578 6365 7074 696f 6e28 2245  ger.exception("E
+000468d0: 7272 6f72 2073 6176 696e 6720 2573 2e22  rror saving %s."
+000468e0: 2c20 6669 6c65 6e61 6d65 290d 0a20 2020  , filename)..   
+000468f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046900: 2065 7272 6f72 6d73 6720 3d20 2245 7272   errormsg = "Err
+00046910: 6f72 2073 6176 696e 6720 2573 3a5c 6e5c  or saving %s:\n\
+00046920: 6e25 7322 2025 205c 0d0a 2020 2020 2020  n%s" % \..      
+00046930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046940: 2020 2020 2020 2020 2028 6669 6c65 6e61           (filena
+00046950: 6d65 2c20 7472 6163 6562 6163 6b2e 666f  me, traceback.fo
+00046960: 726d 6174 5f65 7863 2829 290d 0a20 2020  rmat_exc())..   
+00046970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046980: 2077 782e 4d65 7373 6167 6542 6f78 2865   wx.MessageBox(e
+00046990: 7272 6f72 6d73 672c 2063 6f6e 662e 5469  rrormsg, conf.Ti
+000469a0: 746c 652c 2077 782e 4f4b 207c 2077 782e  tle, wx.OK | wx.
+000469b0: 4943 4f4e 5f57 4152 4e49 4e47 290d 0a20  ICON_WARNING).. 
+000469c0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+000469d0: 696e 616c 6c79 3a0d 0a20 2020 2020 2020  inally:..       
+000469e0: 2020 2020 2020 2020 2020 2020 2062 7573               bus
+000469f0: 792e 436c 6f73 6528 290d 0a0d 0a0d 0a20  y.Close()...... 
+00046a00: 2020 2064 6566 206f 6e5f 6b65 7964 6f77     def on_keydow
+00046a10: 6e5f 7371 6c28 7365 6c66 2c20 6576 656e  n_sql(self, even
+00046a20: 7429 3a0d 0a20 2020 2020 2020 2022 2222  t):..        """
+00046a30: 0d0a 2020 2020 2020 2020 4861 6e64 6c65  ..        Handle
+00046a40: 7220 666f 7220 7072 6573 7369 6e67 2061  r for pressing a
+00046a50: 206b 6579 2069 6e20 5351 4c20 6564 6974   key in SQL edit
+00046a60: 6f72 2c20 6c69 7374 656e 7320 666f 7220  or, listens for 
+00046a70: 416c 742d 456e 7465 7220 616e 640d 0a20  Alt-Enter and.. 
+00046a80: 2020 2020 2020 2065 7865 6375 7465 7320         executes 
+00046a90: 7468 6520 6375 7272 656e 746c 7920 7365  the currently se
+00046aa0: 6c65 6374 6564 206c 696e 652c 206f 7220  lected line, or 
+00046ab0: 6375 7272 656e 746c 7920 6163 7469 7665  currently active
+00046ac0: 206c 696e 652e 0d0a 2020 2020 2020 2020   line...        
+00046ad0: 2222 220d 0a20 2020 2020 2020 2073 7463  """..        stc
+00046ae0: 203d 2065 7665 6e74 2e47 6574 4576 656e   = event.GetEven
+00046af0: 744f 626a 6563 7428 290d 0a20 2020 2020  tObject()..     
+00046b00: 2020 2069 6620 6576 656e 742e 416c 7444     if event.AltD
+00046b10: 6f77 6e28 2920 616e 6420 7778 2e57 584b  own() and wx.WXK
+00046b20: 5f52 4554 5552 4e20 3d3d 2065 7665 6e74  _RETURN == event
+00046b30: 2e4b 6579 436f 6465 3a0d 0a20 2020 2020  .KeyCode:..     
+00046b40: 2020 2020 2020 2073 716c 203d 2028 7374         sql = (st
+00046b50: 632e 5365 6c65 6374 6564 5465 7874 206f  c.SelectedText o
+00046b60: 7220 7374 632e 4375 724c 696e 655b 305d  r stc.CurLine[0]
+00046b70: 292e 7374 7269 7028 290d 0a20 2020 2020  ).strip()..     
+00046b80: 2020 2020 2020 2069 6620 7371 6c3a 0d0a         if sql:..
+00046b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046ba0: 7365 6c66 2e65 7865 6375 7465 5f73 716c  self.execute_sql
+00046bb0: 2873 716c 290d 0a20 2020 2020 2020 2065  (sql)..        e
+00046bc0: 7665 6e74 2e53 6b69 7028 2920 2320 416c  vent.Skip() # Al
+00046bd0: 6c6f 7720 746f 2070 726f 7061 6761 7465  low to propagate
+00046be0: 2074 6f20 6f74 6865 7220 6861 6e64 6c65   to other handle
+00046bf0: 7273 0d0a 0d0a 0d0a 2020 2020 6465 6620  rs......    def 
+00046c00: 6f6e 5f62 7574 746f 6e5f 7371 6c28 7365  on_button_sql(se
+00046c10: 6c66 2c20 6576 656e 7429 3a0d 0a20 2020  lf, event):..   
+00046c20: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
+00046c30: 2020 4861 6e64 6c65 7220 666f 7220 636c    Handler for cl
+00046c40: 6963 6b69 6e67 2074 6f20 7275 6e20 616e  icking to run an
+00046c50: 2053 514c 2071 7565 7279 2c20 7275 6e73   SQL query, runs
+00046c60: 2074 6865 2073 656c 6563 7465 6420 7465   the selected te
+00046c70: 7874 206f 720d 0a20 2020 2020 2020 2077  xt or..        w
+00046c80: 686f 6c65 2063 6f6e 7465 6e74 732c 2064  hole contents, d
+00046c90: 6973 706c 6179 7320 6974 7320 7265 7375  isplays its resu
+00046ca0: 6c74 732c 2069 6620 616e 792c 2061 6e64  lts, if any, and
+00046cb0: 2063 6f6d 6d69 7473 2063 6861 6e67 6573   commits changes
+00046cc0: 0d0a 2020 2020 2020 2020 646f 6e65 2c20  ..        done, 
+00046cd0: 6966 2061 6e79 2e0d 0a20 2020 2020 2020  if any...       
+00046ce0: 2022 2222 0d0a 2020 2020 2020 2020 7371   """..        sq
+00046cf0: 6c20 3d20 7365 6c66 2e73 7463 5f73 716c  l = self.stc_sql
+00046d00: 2e53 656c 6563 7465 6454 6578 742e 7374  .SelectedText.st
+00046d10: 7269 7028 2920 6f72 2073 656c 662e 7374  rip() or self.st
+00046d20: 635f 7371 6c2e 5465 7874 2e73 7472 6970  c_sql.Text.strip
+00046d30: 2829 0d0a 2020 2020 2020 2020 6966 2073  ()..        if s
+00046d40: 716c 3a0d 0a20 2020 2020 2020 2020 2020  ql:..           
+00046d50: 2073 656c 662e 6578 6563 7574 655f 7371   self.execute_sq
+00046d60: 6c28 7371 6c29 0d0a 0d0a 0d0a 2020 2020  l(sql)......    
+00046d70: 6465 6620 6f6e 5f62 7574 746f 6e5f 7363  def on_button_sc
+00046d80: 7269 7074 2873 656c 662c 2065 7665 6e74  ript(self, event
+00046d90: 293a 0d0a 2020 2020 2020 2020 2222 220d  ):..        """.
+00046da0: 0a20 2020 2020 2020 2048 616e 646c 6572  .        Handler
+00046db0: 2066 6f72 2063 6c69 636b 696e 6720 746f   for clicking to
+00046dc0: 2072 756e 206d 756c 7469 706c 6520 5351   run multiple SQ
+00046dd0: 4c20 7374 6174 656d 656e 7473 2c20 7275  L statements, ru
+00046de0: 6e73 2074 6865 2073 656c 6563 7465 640d  ns the selected.
+00046df0: 0a20 2020 2020 2020 2074 6578 7420 6f72  .        text or
+00046e00: 2077 686f 6c65 2063 6f6e 7465 6e74 7320   whole contents 
+00046e10: 6173 2061 6e20 5351 4c20 7363 7269 7074  as an SQL script
+00046e20: 2e0d 0a20 2020 2020 2020 2022 2222 0d0a  ...        """..
+00046e30: 2020 2020 2020 2020 7371 6c20 3d20 7365          sql = se
+00046e40: 6c66 2e73 7463 5f73 716c 2e53 656c 6563  lf.stc_sql.Selec
+00046e50: 7465 6454 6578 742e 7374 7269 7028 2920  tedText.strip() 
+00046e60: 6f72 2073 656c 662e 7374 635f 7371 6c2e  or self.stc_sql.
+00046e70: 5465 7874 2e73 7472 6970 2829 0d0a 2020  Text.strip()..  
+00046e80: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
+00046e90: 2020 2020 2020 2020 6966 2073 716c 3a0d          if sql:.
+00046ea0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00046eb0: 206c 6f67 6765 722e 696e 666f 2822 4578   logger.info("Ex
+00046ec0: 6563 7574 696e 6720 5351 4c20 7363 7269  ecuting SQL scri
+00046ed0: 7074 205c 2225 735c 222e 222c 2073 716c  pt \"%s\".", sql
+00046ee0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00046ef0: 2020 2073 656c 662e 6462 2e63 6f6e 6e65     self.db.conne
+00046f00: 6374 696f 6e2e 6578 6563 7574 6573 6372  ction.executescr
+00046f10: 6970 7428 7371 6c29 0d0a 2020 2020 2020  ipt(sql)..      
+00046f20: 2020 2020 2020 2020 2020 7365 6c66 2e67            self.g
+00046f30: 7269 645f 7371 6c2e 5365 7454 6162 6c65  rid_sql.SetTable
+00046f40: 284e 6f6e 6529 0d0a 2020 2020 2020 2020  (None)..        
+00046f50: 2020 2020 2020 2020 7365 6c66 2e67 7269          self.gri
+00046f60: 645f 7371 6c2e 4372 6561 7465 4772 6964  d_sql.CreateGrid
+00046f70: 2831 2c20 3129 0d0a 2020 2020 2020 2020  (1, 1)..        
+00046f80: 2020 2020 2020 2020 7365 6c66 2e67 7269          self.gri
+00046f90: 645f 7371 6c2e 5365 7443 6f6c 4c61 6265  d_sql.SetColLabe
+00046fa0: 6c56 616c 7565 2830 2c20 2241 6666 6563  lValue(0, "Affec
+00046fb0: 7465 6420 726f 7773 2229 0d0a 2020 2020  ted rows")..    
+00046fc0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00046fd0: 2e67 7269 645f 7371 6c2e 5365 7443 656c  .grid_sql.SetCel
+00046fe0: 6c56 616c 7565 2830 2c20 302c 2022 2d31  lValue(0, 0, "-1
+00046ff0: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
+00047000: 2020 2020 7365 6c66 2e62 7574 746f 6e5f      self.button_
+00047010: 7265 7365 745f 6772 6964 5f73 716c 2e45  reset_grid_sql.E
+00047020: 6e61 626c 6564 203d 2046 616c 7365 0d0a  nabled = False..
+00047030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047040: 7365 6c66 2e62 7574 746f 6e5f 6578 706f  self.button_expo
+00047050: 7274 5f73 716c 2e45 6e61 626c 6564 203d  rt_sql.Enabled =
+00047060: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
+00047070: 2020 2020 2020 2020 7369 7a65 203d 2073          size = s
+00047080: 656c 662e 6772 6964 5f73 716c 2e53 697a  elf.grid_sql.Siz
+00047090: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
+000470a0: 2020 2073 656c 662e 6772 6964 5f73 716c     self.grid_sql
+000470b0: 2e46 6974 2829 0d0a 2020 2020 2020 2020  .Fit()..        
+000470c0: 2020 2020 2020 2020 2320 4a69 6767 6c65          # Jiggle
+000470d0: 2073 697a 6520 6279 2031 2070 6978 656c   size by 1 pixel
+000470e0: 2074 6f20 7265 6672 6573 6820 7363 726f   to refresh scro
+000470f0: 6c6c 6261 7273 0d0a 2020 2020 2020 2020  llbars..        
+00047100: 2020 2020 2020 2020 7365 6c66 2e67 7269          self.gri
+00047110: 645f 7371 6c2e 5369 7a65 203d 2073 697a  d_sql.Size = siz
+00047120: 655b 305d 2c20 7369 7a65 5b31 5d2d 310d  e[0], size[1]-1.
+00047130: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00047140: 2073 656c 662e 6772 6964 5f73 716c 2e53   self.grid_sql.S
+00047150: 697a 6520 3d20 7369 7a65 5b30 5d2c 2073  ize = size[0], s
+00047160: 697a 655b 315d 0d0a 2020 2020 2020 2020  ize[1]..        
+00047170: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
+00047180: 2061 7320 653a 0d0a 2020 2020 2020 2020   as e:..        
+00047190: 2020 2020 6d73 6720 3d20 7574 696c 2e66      msg = util.f
+000471a0: 6f72 6d61 745f 6578 6328 6529 0d0a 2020  ormat_exc(e)..  
+000471b0: 2020 2020 2020 2020 2020 6775 6962 6173            guibas
+000471c0: 652e 7374 6174 7573 286d 7367 2c20 6c6f  e.status(msg, lo
+000471d0: 673d 5472 7565 290d 0a20 2020 2020 2020  g=True)..       
+000471e0: 2020 2020 2077 782e 4d65 7373 6167 6542       wx.MessageB
+000471f0: 6f78 286d 7367 2c20 636f 6e66 2e54 6974  ox(msg, conf.Tit
+00047200: 6c65 2c20 7778 2e4f 4b20 7c20 7778 2e49  le, wx.OK | wx.I
+00047210: 434f 4e5f 5741 524e 494e 4729 0d0a 0d0a  CON_WARNING)....
+00047220: 0d0a 2020 2020 6465 6620 6578 6563 7574  ..    def execut
+00047230: 655f 7371 6c28 7365 6c66 2c20 7371 6c29  e_sql(self, sql)
+00047240: 3a0d 0a20 2020 2020 2020 2022 2222 4578  :..        """Ex
+00047250: 6563 7574 6573 2074 6865 2053 514c 2071  ecutes the SQL q
+00047260: 7565 7279 2061 6e64 2070 6f70 756c 6174  uery and populat
+00047270: 6573 2074 6865 2053 514c 2067 7269 6420  es the SQL grid 
+00047280: 7769 7468 2072 6573 756c 7473 2e22 2222  with results."""
+00047290: 0d0a 2020 2020 2020 2020 7472 793a 0d0a  ..        try:..
+000472a0: 2020 2020 2020 2020 2020 2020 6772 6964              grid
+000472b0: 5f64 6174 6120 3d20 4e6f 6e65 0d0a 2020  _data = None..  
+000472c0: 2020 2020 2020 2020 2020 6966 2073 716c            if sql
+000472d0: 2e6c 6f77 6572 2829 2e73 7461 7274 7377  .lower().startsw
+000472e0: 6974 6828 2822 7365 6c65 6374 222c 2022  ith(("select", "
+000472f0: 7072 6167 6d61 222c 2022 6578 706c 6169  pragma", "explai
+00047300: 6e22 2929 3a0d 0a20 2020 2020 2020 2020  n")):..         
+00047310: 2020 2020 2020 2023 2053 454c 4543 5420         # SELECT 
+00047320: 7374 6174 656d 656e 743a 2070 6f70 756c  statement: popul
+00047330: 6174 6520 6772 6964 2077 6974 6820 726f  ate grid with ro
+00047340: 7773 0d0a 2020 2020 2020 2020 2020 2020  ws..            
+00047350: 2020 2020 6772 6964 5f64 6174 6120 3d20      grid_data = 
+00047360: 5371 6c69 7465 4772 6964 4261 7365 2873  SqliteGridBase(s
+00047370: 656c 662e 6462 2c20 7371 6c3d 7371 6c29  elf.db, sql=sql)
+00047380: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00047390: 2020 7365 6c66 2e67 7269 645f 7371 6c2e    self.grid_sql.
+000473a0: 5365 7454 6162 6c65 2867 7269 645f 6461  SetTable(grid_da
+000473b0: 7461 2c20 7461 6b65 4f77 6e65 7273 6869  ta, takeOwnershi
+000473c0: 703d 5472 7565 290d 0a20 2020 2020 2020  p=True)..       
+000473d0: 2020 2020 2020 2020 2073 656c 662e 6275           self.bu
+000473e0: 7474 6f6e 5f72 6573 6574 5f67 7269 645f  tton_reset_grid_
+000473f0: 7371 6c2e 456e 6162 6c65 6420 3d20 5472  sql.Enabled = Tr
+00047400: 7565 0d0a 2020 2020 2020 2020 2020 2020  ue..            
+00047410: 2020 2020 7365 6c66 2e62 7574 746f 6e5f      self.button_
+00047420: 6578 706f 7274 5f73 716c 2e45 6e61 626c  export_sql.Enabl
+00047430: 6564 203d 2054 7275 650d 0a20 2020 2020  ed = True..     
+00047440: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+00047450: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00047460: 4173 7375 6d65 2061 6374 696f 6e20 7175  Assume action qu
+00047470: 6572 790d 0a20 2020 2020 2020 2020 2020  ery..           
+00047480: 2020 2020 2061 6666 6563 7465 645f 726f       affected_ro
+00047490: 7773 203d 2073 656c 662e 6462 2e65 7865  ws = self.db.exe
+000474a0: 6375 7465 5f61 6374 696f 6e28 7371 6c29  cute_action(sql)
+000474b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000474c0: 2020 7365 6c66 2e67 7269 645f 7371 6c2e    self.grid_sql.
+000474d0: 5365 7454 6162 6c65 284e 6f6e 6529 0d0a  SetTable(None)..
+000474e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000474f0: 7365 6c66 2e67 7269 645f 7371 6c2e 4372  self.grid_sql.Cr
+00047500: 6561 7465 4772 6964 2831 2c20 3129 0d0a  eateGrid(1, 1)..
+00047510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047520: 7365 6c66 2e67 7269 645f 7371 6c2e 5365  self.grid_sql.Se
+00047530: 7443 6f6c 4c61 6265 6c56 616c 7565 2830  tColLabelValue(0
+00047540: 2c20 2241 6666 6563 7465 6420 726f 7773  , "Affected rows
+00047550: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
+00047560: 2020 2020 7365 6c66 2e67 7269 645f 7371      self.grid_sq
+00047570: 6c2e 5365 7443 656c 6c56 616c 7565 2830  l.SetCellValue(0
+00047580: 2c20 302c 2073 7472 2861 6666 6563 7465  , 0, str(affecte
+00047590: 645f 726f 7773 2929 0d0a 2020 2020 2020  d_rows))..      
+000475a0: 2020 2020 2020 2020 2020 7365 6c66 2e62            self.b
+000475b0: 7574 746f 6e5f 7265 7365 745f 6772 6964  utton_reset_grid
+000475c0: 5f73 716c 2e45 6e61 626c 6564 203d 2046  _sql.Enabled = F
+000475d0: 616c 7365 0d0a 2020 2020 2020 2020 2020  alse..          
+000475e0: 2020 2020 2020 7365 6c66 2e62 7574 746f        self.butto
+000475f0: 6e5f 6578 706f 7274 5f73 716c 2e45 6e61  n_export_sql.Ena
+00047600: 626c 6564 203d 2046 616c 7365 0d0a 2020  bled = False..  
+00047610: 2020 2020 2020 2020 2020 6775 6962 6173            guibas
+00047620: 652e 7374 6174 7573 2822 4578 6563 7574  e.status("Execut
+00047630: 6564 2053 514c 205c 2225 735c 2220 2825  ed SQL \"%s\" (%
+00047640: 7329 2e22 2c20 7371 6c2c 2073 656c 662e  s).", sql, self.
+00047650: 6462 2c20 6c6f 673d 5472 7565 290d 0a20  db, log=True).. 
+00047660: 2020 2020 2020 2020 2020 2073 697a 6520             size 
+00047670: 3d20 7365 6c66 2e67 7269 645f 7371 6c2e  = self.grid_sql.
+00047680: 5369 7a65 0d0a 2020 2020 2020 2020 2020  Size..          
+00047690: 2020 7365 6c66 2e67 7269 645f 7371 6c2e    self.grid_sql.
+000476a0: 4669 7428 290d 0a20 2020 2020 2020 2020  Fit()..         
+000476b0: 2020 2023 204a 6967 676c 6520 7369 7a65     # Jiggle size
+000476c0: 2062 7920 3120 7069 7865 6c20 746f 2072   by 1 pixel to r
+000476d0: 6566 7265 7368 2073 6372 6f6c 6c62 6172  efresh scrollbar
+000476e0: 730d 0a20 2020 2020 2020 2020 2020 2073  s..            s
+000476f0: 656c 662e 6772 6964 5f73 716c 2e53 697a  elf.grid_sql.Siz
+00047700: 6520 3d20 7369 7a65 5b30 5d2c 2073 697a  e = size[0], siz
+00047710: 655b 315d 2d31 0d0a 2020 2020 2020 2020  e[1]-1..        
+00047720: 2020 2020 7365 6c66 2e67 7269 645f 7371      self.grid_sq
+00047730: 6c2e 5369 7a65 203d 2073 697a 655b 305d  l.Size = size[0]
+00047740: 2c20 7369 7a65 5b31 5d0d 0a20 2020 2020  , size[1]..     
+00047750: 2020 2020 2020 2073 656c 662e 6c61 7374         self.last
+00047760: 5f73 716c 203d 2073 716c 0d0a 2020 2020  _sql = sql..    
+00047770: 2020 2020 2020 2020 7365 6c66 2e67 7269          self.gri
+00047780: 645f 7371 6c2e 5365 7443 6f6c 4d69 6e69  d_sql.SetColMini
+00047790: 6d61 6c41 6363 6570 7461 626c 6557 6964  malAcceptableWid
+000477a0: 7468 2831 3030 290d 0a20 2020 2020 2020  th(100)..       
+000477b0: 2020 2020 2069 6620 6772 6964 5f64 6174       if grid_dat
+000477c0: 613a 0d0a 2020 2020 2020 2020 2020 2020  a:..            
+000477d0: 2020 2020 636f 6c5f 7261 6e67 6520 3d20      col_range = 
+000477e0: 7261 6e67 6528 6772 6964 5f64 6174 612e  range(grid_data.
+000477f0: 4765 744e 756d 6265 7243 6f6c 7328 2929  GetNumberCols())
+00047800: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00047810: 2020 5b73 656c 662e 6772 6964 5f73 716c    [self.grid_sql
+00047820: 2e41 7574 6f53 697a 6543 6f6c 4c61 6265  .AutoSizeColLabe
+00047830: 6c53 697a 6528 7829 2066 6f72 2078 2069  lSize(x) for x i
+00047840: 6e20 636f 6c5f 7261 6e67 655d 0d0a 2020  n col_range]..  
+00047850: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
+00047860: 6570 7469 6f6e 2061 7320 653a 0d0a 2020  eption as e:..  
+00047870: 2020 2020 2020 2020 2020 6d73 6720 3d20            msg = 
+00047880: 7574 696c 2e66 6f72 6d61 745f 6578 6328  util.format_exc(
+00047890: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+000478a0: 6775 6962 6173 652e 7374 6174 7573 286d  guibase.status(m
+000478b0: 7367 2c20 6c6f 673d 5472 7565 290d 0a20  sg, log=True).. 
+000478c0: 2020 2020 2020 2020 2020 2077 782e 4d65             wx.Me
+000478d0: 7373 6167 6542 6f78 286d 7367 2c20 636f  ssageBox(msg, co
+000478e0: 6e66 2e54 6974 6c65 2c20 7778 2e4f 4b20  nf.Title, wx.OK 
+000478f0: 7c20 7778 2e49 434f 4e5f 5741 524e 494e  | wx.ICON_WARNIN
+00047900: 4729 0d0a 0d0a 0d0a 2020 2020 6465 6620  G)......    def 
+00047910: 6765 745f 756e 7361 7665 645f 6772 6964  get_unsaved_grid
+00047920: 7328 7365 6c66 293a 0d0a 2020 2020 2020  s(self):..      
+00047930: 2020 2222 220d 0a20 2020 2020 2020 2052    """..        R
+00047940: 6574 7572 6e73 2061 206c 6973 7420 6f66  eturns a list of
+00047950: 2053 716c 6974 6547 7269 6442 6173 6520   SqliteGridBase 
+00047960: 6772 6964 7320 7768 6572 6520 6368 616e  grids where chan
+00047970: 6765 7320 6861 7665 206e 6f74 2062 6565  ges have not bee
+00047980: 6e0d 0a20 2020 2020 2020 2073 6176 6564  n..        saved
+00047990: 2061 6674 6572 2063 6861 6e67 696e 672e   after changing.
+000479a0: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
+000479b0: 2020 2020 2020 2072 6574 7572 6e20 5b67         return [g
+000479c0: 2066 6f72 2067 2069 6e20 7365 6c66 2e64   for g in self.d
+000479d0: 625f 6772 6964 732e 7661 6c75 6573 2829  b_grids.values()
+000479e0: 2069 6620 672e 4973 4368 616e 6765 6428   if g.IsChanged(
+000479f0: 295d 0d0a 0d0a 0d0a 2020 2020 6465 6620  )]......    def 
+00047a00: 7361 7665 5f75 6e73 6176 6564 5f67 7269  save_unsaved_gri
+00047a10: 6473 2873 656c 6629 3a0d 0a20 2020 2020  ds(self):..     
+00047a20: 2020 2022 2222 5361 7665 7320 616c 6c20     """Saves all 
+00047a30: 6461 7461 2069 6e20 756e 7361 7665 6420  data in unsaved 
+00047a40: 7461 626c 6520 6772 6964 732c 2072 6574  table grids, ret
+00047a50: 7572 6e73 2073 7563 6365 7373 2f66 6169  urns success/fai
+00047a60: 6c75 7265 2e22 2222 0d0a 2020 2020 2020  lure."""..      
+00047a70: 2020 7265 7375 6c74 203d 2054 7275 650d    result = True.
+00047a80: 0a20 2020 2020 2020 2066 6f72 2067 7269  .        for gri
+00047a90: 6420 696e 2028 7820 666f 7220 7820 696e  d in (x for x in
+00047aa0: 2073 656c 662e 6462 5f67 7269 6473 2e76   self.db_grids.v
+00047ab0: 616c 7565 7328 2920 6966 2078 2e49 7343  alues() if x.IsC
+00047ac0: 6861 6e67 6564 2829 293a 0d0a 2020 2020  hanged()):..    
+00047ad0: 2020 2020 2020 2020 7472 793a 0d0a 2020          try:..  
+00047ae0: 2020 2020 2020 2020 2020 2020 2020 6772                gr
+00047af0: 6964 2e53 6176 6543 6861 6e67 6573 2829  id.SaveChanges()
+00047b00: 0d0a 2020 2020 2020 2020 2020 2020 6578  ..            ex
+00047b10: 6365 7074 2045 7863 6570 7469 6f6e 2061  cept Exception a
+00047b20: 7320 653a 0d0a 2020 2020 2020 2020 2020  s e:..          
+00047b30: 2020 2020 2020 7265 7375 6c74 203d 2046        result = F
+00047b40: 616c 7365 0d0a 2020 2020 2020 2020 2020  alse..          
+00047b50: 2020 2020 2020 6775 6962 6173 652e 7374        guibase.st
+00047b60: 6174 7573 2827 4572 726f 7220 7361 7669  atus('Error savi
+00047b70: 6e67 2074 6162 6c65 2025 7320 696e 2022  ng table %s in "
+00047b80: 2573 223a 2025 7327 2c0d 0a20 2020 2020  %s": %s',..     
+00047b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047ba0: 2020 2020 2020 2020 2020 6772 6964 2e74            grid.t
+00047bb0: 6162 6c65 2c20 7365 6c66 2e64 622c 2075  able, self.db, u
+00047bc0: 7469 6c2e 666f 726d 6174 5f65 7863 2865  til.format_exc(e
+00047bd0: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
+00047be0: 2020 2020 6c6f 6767 6572 2e65 7863 6570      logger.excep
+00047bf0: 7469 6f6e 2827 4572 726f 7220 7361 7669  tion('Error savi
+00047c00: 6e67 2074 6162 6c65 2025 7320 696e 2022  ng table %s in "
+00047c10: 2573 222e 272c 0d0a 2020 2020 2020 2020  %s".',..        
+00047c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047c30: 2020 2020 2020 2020 2067 7269 642e 7461           grid.ta
+00047c40: 626c 652c 2073 656c 662e 6462 290d 0a20  ble, self.db).. 
+00047c50: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00047c60: 7272 6f72 6d73 6720 3d20 2745 7272 6f72  rrormsg = 'Error
+00047c70: 2073 6176 696e 6720 7461 626c 6520 2573   saving table %s
+00047c80: 2069 6e20 2225 7322 3a5c 6e5c 6e25 7327   in "%s":\n\n%s'
+00047c90: 2025 2028 0d0a 2020 2020 2020 2020 2020   % (..          
+00047ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047cb0: 2067 7269 642e 7461 626c 652c 2073 656c   grid.table, sel
+00047cc0: 662e 6462 2c20 7472 6163 6562 6163 6b2e  f.db, traceback.
+00047cd0: 666f 726d 6174 5f65 7863 2829 290d 0a20  format_exc()).. 
+00047ce0: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+00047cf0: 782e 4d65 7373 6167 6542 6f78 2865 7272  x.MessageBox(err
+00047d00: 6f72 6d73 672c 2063 6f6e 662e 5469 746c  ormsg, conf.Titl
+00047d10: 652c 2077 782e 4f4b 207c 2077 782e 4943  e, wx.OK | wx.IC
+00047d20: 4f4e 5f57 4152 4e49 4e47 290d 0a20 2020  ON_WARNING)..   
+00047d30: 2020 2020 2020 2020 2020 2020 2062 7265               bre
+00047d40: 616b 2023 2066 6f72 2067 7269 640d 0a20  ak # for grid.. 
+00047d50: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
+00047d60: 7375 6c74 0d0a 0d0a 0d0a 2020 2020 6465  sult......    de
+00047d70: 6620 6f6e 5f63 6861 6e67 655f 7461 626c  f on_change_tabl
+00047d80: 6528 7365 6c66 2c20 6576 656e 7429 3a0d  e(self, event):.
+00047d90: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
+00047da0: 2020 2020 2020 4861 6e64 6c65 7220 7768        Handler wh
+00047db0: 656e 2074 6162 6c65 2067 7269 6420 6461  en table grid da
+00047dc0: 7461 2069 7320 6368 616e 6765 642c 2072  ta is changed, r
+00047dd0: 6566 7265 7368 6573 2069 636f 6e73 2c0d  efreshes icons,.
+00047de0: 0a20 2020 2020 2020 2074 6162 6c65 206c  .        table l
+00047df0: 6973 7473 2061 6e64 2064 6174 6162 6173  ists and databas
+00047e00: 6520 6469 7370 6c61 792e 0d0a 2020 2020  e display...    
+00047e10: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
+00047e20: 2067 7269 645f 6461 7461 203d 2073 656c   grid_data = sel
+00047e30: 662e 6772 6964 5f74 6162 6c65 2e54 6162  f.grid_table.Tab
+00047e40: 6c65 0d0a 2020 2020 2020 2020 2320 456e  le..        # En
+00047e50: 6162 6c65 2f64 6973 6162 6c65 2063 6f6d  able/disable com
+00047e60: 6d69 7420 616e 6420 726f 6c6c 6261 636b  mit and rollback
+00047e70: 2069 636f 6e73 0d0a 2020 2020 2020 2020   icons..        
+00047e80: 7365 6c66 2e74 625f 6772 6964 2e45 6e61  self.tb_grid.Ena
+00047e90: 626c 6554 6f6f 6c28 7778 2e49 445f 5341  bleTool(wx.ID_SA
+00047ea0: 5645 2c20 6772 6964 5f64 6174 612e 4973  VE, grid_data.Is
+00047eb0: 4368 616e 6765 6428 2929 0d0a 2020 2020  Changed())..    
+00047ec0: 2020 2020 7365 6c66 2e74 625f 6772 6964      self.tb_grid
+00047ed0: 2e45 6e61 626c 6554 6f6f 6c28 7778 2e49  .EnableTool(wx.I
+00047ee0: 445f 554e 444f 2c20 6772 6964 5f64 6174  D_UNDO, grid_dat
+00047ef0: 612e 4973 4368 616e 6765 6428 2929 0d0a  a.IsChanged())..
+00047f00: 2020 2020 2020 2020 2320 4869 6768 6c69          # Highli
+00047f10: 6768 7420 6368 616e 6765 6420 7461 626c  ght changed tabl
+00047f20: 6573 2069 6e20 7468 6520 7461 626c 6520  es in the table 
+00047f30: 6c69 7374 0d0a 2020 2020 2020 2020 636f  list..        co
+00047f40: 6c6f 7572 203d 2063 6f6e 662e 4442 5461  lour = conf.DBTa
+00047f50: 626c 6543 6861 6e67 6564 436f 6c6f 7572  bleChangedColour
+00047f60: 2069 6620 6772 6964 5f64 6174 612e 4973   if grid_data.Is
+00047f70: 4368 616e 6765 6428 2920 5c0d 0a20 2020  Changed() \..   
+00047f80: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00047f90: 7365 2073 656c 662e 7472 6565 5f74 6162  se self.tree_tab
+00047fa0: 6c65 732e 466f 7265 6772 6f75 6e64 436f  les.ForegroundCo
+00047fb0: 6c6f 7572 0d0a 2020 2020 2020 2020 6974  lour..        it
+00047fc0: 656d 203d 2073 656c 662e 7472 6565 5f74  em = self.tree_t
+00047fd0: 6162 6c65 732e 4765 744e 6578 7428 7365  ables.GetNext(se
+00047fe0: 6c66 2e74 7265 655f 7461 626c 6573 2e47  lf.tree_tables.G
+00047ff0: 6574 526f 6f74 4974 656d 2829 290d 0a20  etRootItem()).. 
+00048000: 2020 2020 2020 2077 6869 6c65 2069 7465         while ite
+00048010: 6d20 616e 6420 6974 656d 2e49 734f 6b28  m and item.IsOk(
+00048020: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00048030: 6c69 7374 5f74 6162 6c65 203d 2073 656c  list_table = sel
+00048040: 662e 7472 6565 5f74 6162 6c65 732e 4765  f.tree_tables.Ge
+00048050: 7449 7465 6d50 7944 6174 6128 6974 656d  tItemPyData(item
+00048060: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
+00048070: 6620 6c69 7374 5f74 6162 6c65 3a0d 0a20  f list_table:.. 
+00048080: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00048090: 6620 6c69 7374 5f74 6162 6c65 2e6c 6f77  f list_table.low
+000480a0: 6572 2829 203d 3d20 6772 6964 5f64 6174  er() == grid_dat
+000480b0: 612e 7461 626c 652e 6c6f 7765 7228 293a  a.table.lower():
+000480c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000480d0: 2020 2020 2020 7365 6c66 2e74 7265 655f        self.tree_
+000480e0: 7461 626c 6573 2e53 6574 4974 656d 5465  tables.SetItemTe
+000480f0: 7874 436f 6c6f 7572 2869 7465 6d2c 2063  xtColour(item, c
+00048100: 6f6c 6f75 7229 0d0a 0d0a 2020 2020 2020  olour)....      
+00048110: 2020 2020 2020 2020 2020 2020 2020 6272                br
+00048120: 6561 6b20 2320 6272 6561 6b20 7768 696c  eak # break whil
+00048130: 6520 6974 656d 2061 6e64 2069 7465 6d2e  e item and item.
+00048140: 4973 4f6b 2829 0d0a 2020 2020 2020 2020  IsOk()..        
+00048150: 2020 2020 6974 656d 203d 2073 656c 662e      item = self.
+00048160: 7472 6565 5f74 6162 6c65 732e 4765 744e  tree_tables.GetN
+00048170: 6578 7453 6962 6c69 6e67 2869 7465 6d29  extSibling(item)
+00048180: 0d0a 0d0a 2020 2020 2020 2020 2320 4d61  ....        # Ma
+00048190: 726b 2064 6174 6162 6173 6520 6173 2063  rk database as c
+000481a0: 6861 6e67 6564 2f70 7269 7374 696e 6520  hanged/pristine 
+000481b0: 696e 2074 6865 2070 6172 656e 7420 6e6f  in the parent no
+000481c0: 7465 626f 6f6b 2074 6162 730d 0a20 2020  tebook tabs..   
+000481d0: 2020 2020 2066 6f72 2069 2069 6e20 7261       for i in ra
+000481e0: 6e67 6528 7365 6c66 2e70 6172 656e 745f  nge(self.parent_
+000481f0: 6e6f 7465 626f 6f6b 2e47 6574 5061 6765  notebook.GetPage
+00048200: 436f 756e 7428 2929 3a0d 0a20 2020 2020  Count()):..     
+00048210: 2020 2020 2020 2069 6620 7365 6c66 2e70         if self.p
+00048220: 6172 656e 745f 6e6f 7465 626f 6f6b 2e47  arent_notebook.G
+00048230: 6574 5061 6765 2869 2920 3d3d 2073 656c  etPage(i) == sel
+00048240: 663a 0d0a 2020 2020 2020 2020 2020 2020  f:..            
+00048250: 2020 2020 7375 6666 6978 203d 2022 2a22      suffix = "*"
+00048260: 2069 6620 7365 6c66 2e67 6574 5f75 6e73   if self.get_uns
+00048270: 6176 6564 5f67 7269 6473 2829 2065 6c73  aved_grids() els
+00048280: 6520 2222 0d0a 2020 2020 2020 2020 2020  e ""..          
+00048290: 2020 2020 2020 7469 746c 6520 3d20 7365        title = se
+000482a0: 6c66 2e74 6974 6c65 202b 2073 7566 6669  lf.title + suffi
+000482b0: 780d 0a20 2020 2020 2020 2020 2020 2020  x..             
+000482c0: 2020 2069 6620 7365 6c66 2e70 6172 656e     if self.paren
+000482d0: 745f 6e6f 7465 626f 6f6b 2e47 6574 5061  t_notebook.GetPa
+000482e0: 6765 5465 7874 2869 2920 213d 2074 6974  geText(i) != tit
+000482f0: 6c65 3a0d 0a20 2020 2020 2020 2020 2020  le:..           
+00048300: 2020 2020 2020 2020 2073 656c 662e 7061           self.pa
+00048310: 7265 6e74 5f6e 6f74 6562 6f6f 6b2e 5365  rent_notebook.Se
+00048320: 7450 6167 6554 6578 7428 692c 2074 6974  tPageText(i, tit
+00048330: 6c65 290d 0a20 2020 2020 2020 2020 2020  le)..           
+00048340: 2020 2020 2062 7265 616b 2023 2066 6f72       break # for
+00048350: 2069 0d0a 0d0a 0d0a 2020 2020 6465 6620   i......    def 
+00048360: 6f6e 5f63 6f6d 6d69 745f 7461 626c 6528  on_commit_table(
+00048370: 7365 6c66 2c20 6576 656e 7429 3a0d 0a20  self, event):.. 
+00048380: 2020 2020 2020 2022 2222 4861 6e64 6c65         """Handle
+00048390: 7220 666f 7220 636c 6963 6b69 6e67 2074  r for clicking t
+000483a0: 6f20 636f 6d6d 6974 2074 6865 2063 6861  o commit the cha
+000483b0: 6e67 6564 2064 6174 6162 6173 6520 7461  nged database ta
+000483c0: 626c 652e 2222 220d 0a20 2020 2020 2020  ble."""..       
+000483d0: 2069 6e66 6f20 3d20 7365 6c66 2e67 7269   info = self.gri
+000483e0: 645f 7461 626c 652e 5461 626c 652e 4765  d_table.Table.Ge
+000483f0: 7443 6861 6e67 6564 496e 666f 2829 0d0a  tChangedInfo()..
+00048400: 2020 2020 2020 2020 6966 2077 782e 4f4b          if wx.OK
+00048410: 203d 3d20 7778 2e4d 6573 7361 6765 426f   == wx.MessageBo
+00048420: 7828 0d0a 2020 2020 2020 2020 2020 2020  x(..            
+00048430: 2241 7265 2079 6f75 2073 7572 6520 796f  "Are you sure yo
+00048440: 7520 7761 6e74 2074 6f20 636f 6d6d 6974  u want to commit
+00048450: 2074 6865 7365 2063 6861 6e67 6573 2028   these changes (
+00048460: 2573 293f 2220 250d 0a20 2020 2020 2020  %s)?" %..       
+00048470: 2020 2020 2069 6e66 6f2c 2063 6f6e 662e       info, conf.
+00048480: 5469 746c 652c 2077 782e 4f4b 207c 2077  Title, wx.OK | w
+00048490: 782e 4341 4e43 454c 207c 2077 782e 4943  x.CANCEL | wx.IC
+000484a0: 4f4e 5f51 5545 5354 494f 4e0d 0a20 2020  ON_QUESTION..   
+000484b0: 2020 2020 2029 3a0d 0a20 2020 2020 2020       ):..       
+000484c0: 2020 2020 206c 6f67 6765 722e 696e 666f       logger.info
+000484d0: 2822 436f 6d6d 6974 7469 6e67 2025 7320  ("Committing %s 
+000484e0: 696e 2074 6162 6c65 2025 7320 2825 7329  in table %s (%s)
+000484f0: 2e22 2c20 696e 666f 2c0d 0a20 2020 2020  .", info,..     
+00048500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048510: 2020 2073 656c 662e 6772 6964 5f74 6162     self.grid_tab
+00048520: 6c65 2e54 6162 6c65 2e74 6162 6c65 2c20  le.Table.table, 
+00048530: 7365 6c66 2e64 6229 0d0a 2020 2020 2020  self.db)..      
+00048540: 2020 2020 2020 7365 6c66 2e67 7269 645f        self.grid_
+00048550: 7461 626c 652e 5461 626c 652e 5361 7665  table.Table.Save
+00048560: 4368 616e 6765 7328 290d 0a20 2020 2020  Changes()..     
+00048570: 2020 2020 2020 2073 656c 662e 6f6e 5f63         self.on_c
+00048580: 6861 6e67 655f 7461 626c 6528 4e6f 6e65  hange_table(None
+00048590: 290d 0a20 2020 2020 2020 2020 2020 2023  )..            #
+000485a0: 2052 6566 7265 7368 2074 6162 6c65 7320   Refresh tables 
+000485b0: 6c69 7374 2077 6974 6820 7570 6461 7465  list with update
+000485c0: 6420 726f 7720 636f 756e 7473 0d0a 2020  d row counts..  
+000485d0: 2020 2020 2020 2020 2020 7461 626c 656d            tablem
+000485e0: 6170 203d 2064 6963 7428 2874 5b22 6e61  ap = dict((t["na
+000485f0: 6d65 225d 2c20 7429 2066 6f72 2074 2069  me"], t) for t i
+00048600: 6e20 7365 6c66 2e64 622e 6765 745f 7461  n self.db.get_ta
+00048610: 626c 6573 2854 7275 6529 290d 0a20 2020  bles(True))..   
+00048620: 2020 2020 2020 2020 2069 7465 6d20 3d20           item = 
+00048630: 7365 6c66 2e74 7265 655f 7461 626c 6573  self.tree_tables
+00048640: 2e47 6574 4e65 7874 2873 656c 662e 7472  .GetNext(self.tr
+00048650: 6565 5f74 6162 6c65 732e 4765 7452 6f6f  ee_tables.GetRoo
+00048660: 7449 7465 6d28 2929 0d0a 2020 2020 2020  tItem())..      
+00048670: 2020 2020 2020 7768 696c 6520 6974 656d        while item
+00048680: 2061 6e64 2069 7465 6d2e 4973 4f6b 2829   and item.IsOk()
+00048690: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+000486a0: 2020 2074 6162 6c65 203d 2073 656c 662e     table = self.
+000486b0: 7472 6565 5f74 6162 6c65 732e 4765 7449  tree_tables.GetI
+000486c0: 7465 6d50 7944 6174 6128 6974 656d 290d  temPyData(item).
+000486d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000486e0: 2069 6620 7461 626c 653a 0d0a 2020 2020   if table:..    
+000486f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048700: 7365 6c66 2e74 7265 655f 7461 626c 6573  self.tree_tables
+00048710: 2e53 6574 4974 656d 5465 7874 2869 7465  .SetItemText(ite
+00048720: 6d2c 2022 2564 2072 6f77 2573 2220 2520  m, "%d row%s" % 
+00048730: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+00048740: 2020 2020 2020 2020 2020 2074 6162 6c65             table
+00048750: 6d61 705b 7461 626c 655d 5b22 726f 7773  map[table]["rows
+00048760: 225d 2c0d 0a20 2020 2020 2020 2020 2020  "],..           
+00048770: 2020 2020 2020 2020 2020 2020 2022 7322               "s"
+00048780: 2069 6620 7461 626c 656d 6170 5b74 6162   if tablemap[tab
+00048790: 6c65 5d5b 2272 6f77 7322 5d20 213d 2031  le]["rows"] != 1
+000487a0: 2065 6c73 6520 2220 220d 0a20 2020 2020   else " "..     
+000487b0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+000487c0: 2c20 3129 0d0a 2020 2020 2020 2020 2020  , 1)..          
+000487d0: 2020 2020 2020 2020 2020 6966 2074 6162            if tab
+000487e0: 6c65 203d 3d20 7365 6c66 2e67 7269 645f  le == self.grid_
+000487f0: 7461 626c 652e 5461 626c 652e 7461 626c  table.Table.tabl
+00048800: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00048810: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00048820: 2e74 7265 655f 7461 626c 6573 2e53 6574  .tree_tables.Set
+00048830: 4974 656d 426f 6c64 2869 7465 6d2c 0d0a  ItemBold(item,..
+00048840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048850: 2020 2020 2020 2020 7365 6c66 2e67 7269          self.gri
+00048860: 645f 7461 626c 652e 5461 626c 652e 4973  d_table.Table.Is
+00048870: 4368 616e 6765 6428 2929 0d0a 2020 2020  Changed())..    
+00048880: 2020 2020 2020 2020 2020 2020 6974 656d              item
+00048890: 203d 2073 656c 662e 7472 6565 5f74 6162   = self.tree_tab
+000488a0: 6c65 732e 4765 744e 6578 7453 6962 6c69  les.GetNextSibli
+000488b0: 6e67 2869 7465 6d29 0d0a 2020 2020 2020  ng(item)..      
+000488c0: 2020 2020 2020 7365 6c66 2e67 7269 645f        self.grid_
+000488d0: 7461 626c 652e 466f 7263 6552 6566 7265  table.ForceRefre
+000488e0: 7368 2829 2020 2320 5265 6672 6573 6820  sh()  # Refresh 
+000488f0: 6365 6c6c 2063 6f6c 6f75 7273 0d0a 0d0a  cell colours....
+00048900: 0d0a 2020 2020 6465 6620 6f6e 5f72 6f6c  ..    def on_rol
+00048910: 6c62 6163 6b5f 7461 626c 6528 7365 6c66  lback_table(self
+00048920: 2c20 6576 656e 7429 3a0d 0a20 2020 2020  , event):..     
+00048930: 2020 2022 2222 4861 6e64 6c65 7220 666f     """Handler fo
+00048940: 7220 636c 6963 6b69 6e67 2074 6f20 726f  r clicking to ro
+00048950: 6c6c 6261 636b 2074 6865 2063 6861 6e67  llback the chang
+00048960: 6564 2064 6174 6162 6173 6520 7461 626c  ed database tabl
+00048970: 652e 2222 220d 0a20 2020 2020 2020 2073  e."""..        s
+00048980: 656c 662e 6772 6964 5f74 6162 6c65 2e54  elf.grid_table.T
+00048990: 6162 6c65 2e55 6e64 6f43 6861 6e67 6573  able.UndoChanges
+000489a0: 2829 0d0a 2020 2020 2020 2020 7365 6c66  ()..        self
+000489b0: 2e6f 6e5f 6368 616e 6765 5f74 6162 6c65  .on_change_table
+000489c0: 284e 6f6e 6529 0d0a 2020 2020 2020 2020  (None)..        
+000489d0: 7365 6c66 2e67 7269 645f 7461 626c 652e  self.grid_table.
+000489e0: 436f 6e74 6169 6e69 6e67 5369 7a65 722e  ContainingSizer.
+000489f0: 4c61 796f 7574 2829 2020 2320 5265 6672  Layout()  # Refr
+00048a00: 6573 6820 7363 726f 6c6c 6261 7273 0d0a  esh scrollbars..
+00048a10: 2020 2020 2020 2020 7365 6c66 2e67 7269          self.gri
+00048a20: 645f 7461 626c 652e 466f 7263 6552 6566  d_table.ForceRef
+00048a30: 7265 7368 2829 2023 2052 6566 7265 7368  resh() # Refresh
+00048a40: 2063 656c 6c20 636f 6c6f 7572 730d 0a0d   cell colours...
+00048a50: 0a0d 0a20 2020 2064 6566 206f 6e5f 696e  ...    def on_in
+00048a60: 7365 7274 5f72 6f77 2873 656c 662c 2065  sert_row(self, e
+00048a70: 7665 6e74 293a 0d0a 2020 2020 2020 2020  vent):..        
+00048a80: 2222 220d 0a20 2020 2020 2020 2048 616e  """..        Han
+00048a90: 646c 6572 2066 6f72 2063 6c69 636b 696e  dler for clickin
+00048aa0: 6720 746f 2069 6e73 6572 7420 6120 7461  g to insert a ta
+00048ab0: 626c 6520 726f 772c 206c 6574 7320 7468  ble row, lets th
+00048ac0: 6520 7573 6572 2065 6469 7420 6120 6e65  e user edit a ne
+00048ad0: 770d 0a20 2020 2020 2020 2067 7269 6420  w..        grid 
+00048ae0: 6c69 6e65 2e0d 0a20 2020 2020 2020 2022  line...        "
+00048af0: 2222 0d0a 2020 2020 2020 2020 7365 6c66  ""..        self
+00048b00: 2e67 7269 645f 7461 626c 652e 496e 7365  .grid_table.Inse
+00048b10: 7274 526f 7773 2870 6f73 3d30 2c20 6e75  rtRows(pos=0, nu
+00048b20: 6d52 6f77 733d 3129 0d0a 2020 2020 2020  mRows=1)..      
+00048b30: 2020 7365 6c66 2e67 7269 645f 7461 626c    self.grid_tabl
+00048b40: 652e 5365 7447 7269 6443 7572 736f 7228  e.SetGridCursor(
+00048b50: 302c 2073 656c 662e 6772 6964 5f74 6162  0, self.grid_tab
+00048b60: 6c65 2e47 6574 4772 6964 4375 7273 6f72  le.GetGridCursor
+00048b70: 436f 6c28 2929 0d0a 2020 2020 2020 2020  Col())..        
+00048b80: 7365 6c66 2e67 7269 645f 7461 626c 652e  self.grid_table.
+00048b90: 5363 726f 6c6c 2873 656c 662e 6772 6964  Scroll(self.grid
+00048ba0: 5f74 6162 6c65 2e47 6574 5363 726f 6c6c  _table.GetScroll
+00048bb0: 506f 7328 7778 2e48 4f52 495a 4f4e 5441  Pos(wx.HORIZONTA
+00048bc0: 4c29 2c20 3029 0d0a 2020 2020 2020 2020  L), 0)..        
+00048bd0: 7365 6c66 2e67 7269 645f 7461 626c 652e  self.grid_table.
+00048be0: 5265 6672 6573 6828 290d 0a20 2020 2020  Refresh()..     
+00048bf0: 2020 2073 656c 662e 6f6e 5f63 6861 6e67     self.on_chang
+00048c00: 655f 7461 626c 6528 4e6f 6e65 290d 0a20  e_table(None).. 
+00048c10: 2020 2020 2020 2073 656c 662e 6772 6964         self.grid
+00048c20: 5f74 6162 6c65 2e43 6f6e 7461 696e 696e  _table.Containin
+00048c30: 6753 697a 6572 2e4c 6179 6f75 7428 2920  gSizer.Layout() 
+00048c40: 2023 2052 6566 7265 7368 2073 6372 6f6c   # Refresh scrol
+00048c50: 6c62 6172 730d 0a0d 0a0d 0a20 2020 2064  lbars......    d
+00048c60: 6566 206f 6e5f 6465 6c65 7465 5f72 6f77  ef on_delete_row
+00048c70: 2873 656c 662c 2065 7665 6e74 293a 0d0a  (self, event):..
+00048c80: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
+00048c90: 2020 2020 2048 616e 646c 6572 2066 6f72       Handler for
+00048ca0: 2063 6c69 636b 696e 6720 746f 2064 656c   clicking to del
+00048cb0: 6574 6520 6120 7461 626c 6520 726f 772c  ete a table row,
+00048cc0: 2072 656d 6f76 6573 2074 6865 2072 6f77   removes the row
+00048cd0: 2066 726f 6d20 6772 6964 2e0d 0a20 2020   from grid...   
+00048ce0: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
+00048cf0: 2020 7365 6c65 6374 6564 5f72 6f77 7320    selected_rows 
+00048d00: 3d20 7365 6c66 2e67 7269 645f 7461 626c  = self.grid_tabl
+00048d10: 652e 4765 7453 656c 6563 7465 6452 6f77  e.GetSelectedRow
+00048d20: 7328 290d 0a20 2020 2020 2020 2063 7572  s()..        cur
+00048d30: 736f 725f 726f 7720 3d20 7365 6c66 2e67  sor_row = self.g
+00048d40: 7269 645f 7461 626c 652e 4765 7447 7269  rid_table.GetGri
+00048d50: 6443 7572 736f 7252 6f77 2829 0d0a 2020  dCursorRow()..  
+00048d60: 2020 2020 2020 6966 2063 7572 736f 725f        if cursor_
+00048d70: 726f 7720 3e3d 2030 3a0d 0a20 2020 2020  row >= 0:..     
+00048d80: 2020 2020 2020 2073 656c 6563 7465 645f         selected_
+00048d90: 726f 7773 2e61 7070 656e 6428 6375 7273  rows.append(curs
+00048da0: 6f72 5f72 6f77 290d 0a20 2020 2020 2020  or_row)..       
+00048db0: 2066 6f72 2072 6f77 2069 6e20 7365 6c65   for row in sele
+00048dc0: 6374 6564 5f72 6f77 733a 0d0a 2020 2020  cted_rows:..    
+00048dd0: 2020 2020 2020 2020 7365 6c66 2e67 7269          self.gri
+00048de0: 645f 7461 626c 652e 4465 6c65 7465 526f  d_table.DeleteRo
+00048df0: 7773 2872 6f77 290d 0a20 2020 2020 2020  ws(row)..       
+00048e00: 2073 656c 662e 6772 6964 5f74 6162 6c65   self.grid_table
+00048e10: 2e43 6f6e 7461 696e 696e 6753 697a 6572  .ContainingSizer
+00048e20: 2e4c 6179 6f75 7428 2920 2320 5265 6672  .Layout() # Refr
+00048e30: 6573 6820 7363 726f 6c6c 6261 7273 0d0a  esh scrollbars..
+00048e40: 2020 2020 2020 2020 7365 6c66 2e6f 6e5f          self.on_
+00048e50: 6368 616e 6765 5f74 6162 6c65 284e 6f6e  change_table(Non
+00048e60: 6529 0d0a 0d0a 0d0a 2020 2020 6465 6620  e)......    def 
+00048e70: 6f6e 5f75 7064 6174 655f 6772 6964 5f74  on_update_grid_t
+00048e80: 6162 6c65 2873 656c 662c 2065 7665 6e74  able(self, event
+00048e90: 293a 0d0a 2020 2020 2020 2020 2222 2252  ):..        """R
+00048ea0: 6566 7265 7368 6573 2074 6865 2074 6162  efreshes the tab
+00048eb0: 6c65 2067 7269 6420 5549 2063 6f6d 706f  le grid UI compo
+00048ec0: 6e65 6e74 732c 206c 696b 6520 746f 6f6c  nents, like tool
+00048ed0: 6261 7220 6963 6f6e 732e 2222 220d 0a20  bar icons.""".. 
+00048ee0: 2020 2020 2020 2073 656c 662e 7462 5f67         self.tb_g
+00048ef0: 7269 642e 456e 6162 6c65 546f 6f6c 2877  rid.EnableTool(w
+00048f00: 782e 4944 5f53 4156 452c 2073 656c 662e  x.ID_SAVE, self.
+00048f10: 6772 6964 5f74 6162 6c65 2e54 6162 6c65  grid_table.Table
+00048f20: 2e49 7343 6861 6e67 6564 2829 290d 0a20  .IsChanged()).. 
+00048f30: 2020 2020 2020 2073 656c 662e 7462 5f67         self.tb_g
+00048f40: 7269 642e 456e 6162 6c65 546f 6f6c 2877  rid.EnableTool(w
+00048f50: 782e 4944 5f55 4e44 4f2c 2073 656c 662e  x.ID_UNDO, self.
+00048f60: 6772 6964 5f74 6162 6c65 2e54 6162 6c65  grid_table.Table
+00048f70: 2e49 7343 6861 6e67 6564 2829 290d 0a0d  .IsChanged())...
+00048f80: 0a0d 0a20 2020 2064 6566 206f 6e5f 6368  ...    def on_ch
+00048f90: 616e 6765 5f74 7265 655f 7461 626c 6573  ange_tree_tables
+00048fa0: 2873 656c 662c 2065 7665 6e74 293a 0d0a  (self, event):..
+00048fb0: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
+00048fc0: 2020 2020 2048 616e 646c 6572 2066 6f72       Handler for
+00048fd0: 2073 656c 6563 7469 6e67 2061 6e20 6974   selecting an it
+00048fe0: 656d 2069 6e20 7468 6520 7461 626c 6573  em in the tables
+00048ff0: 206c 6973 742c 206c 6f61 6473 2074 6865   list, loads the
+00049000: 2074 6162 6c65 2064 6174 610d 0a20 2020   table data..   
+00049010: 2020 2020 2069 6e74 6f20 7468 6520 7461       into the ta
+00049020: 626c 6520 6772 6964 2e0d 0a20 2020 2020  ble grid...     
+00049030: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
+00049040: 7461 626c 6520 3d20 4e6f 6e65 0d0a 2020  table = None..  
+00049050: 2020 2020 2020 6974 656d 203d 2065 7665        item = eve
+00049060: 6e74 2e47 6574 4974 656d 2829 0d0a 2020  nt.GetItem()..  
+00049070: 2020 2020 2020 6966 2069 7465 6d20 616e        if item an
+00049080: 6420 6974 656d 2e49 734f 6b28 293a 0d0a  d item.IsOk():..
+00049090: 2020 2020 2020 2020 2020 2020 7461 626c              tabl
+000490a0: 6520 3d20 7365 6c66 2e74 7265 655f 7461  e = self.tree_ta
+000490b0: 626c 6573 2e47 6574 4974 656d 5079 4461  bles.GetItemPyDa
+000490c0: 7461 2869 7465 6d29 0d0a 2020 2020 2020  ta(item)..      
+000490d0: 2020 2020 2020 6c6f 7765 7220 3d20 7461        lower = ta
+000490e0: 626c 652e 6c6f 7765 7228 2920 6966 2074  ble.lower() if t
+000490f0: 6162 6c65 2065 6c73 6520 4e6f 6e65 0d0a  able else None..
+00049100: 2020 2020 2020 2020 6966 2074 6162 6c65          if table
+00049110: 2061 6e64 205c 0d0a 2020 2020 2020 2020   and \..        
+00049120: 286e 6f74 2073 656c 662e 6772 6964 5f74  (not self.grid_t
+00049130: 6162 6c65 2e54 6162 6c65 0d0a 2020 2020  able.Table..    
+00049140: 2020 2020 206f 7220 7365 6c66 2e67 7269       or self.gri
+00049150: 645f 7461 626c 652e 5461 626c 652e 7461  d_table.Table.ta
+00049160: 626c 652e 6c6f 7765 7228 2920 213d 206c  ble.lower() != l
+00049170: 6f77 6572 293a 0d0a 2020 2020 2020 2020  ower):..        
+00049180: 2020 2020 6920 3d20 7365 6c66 2e74 7265      i = self.tre
+00049190: 655f 7461 626c 6573 2e47 6574 4e65 7874  e_tables.GetNext
+000491a0: 2873 656c 662e 7472 6565 5f74 6162 6c65  (self.tree_table
+000491b0: 732e 4765 7452 6f6f 7449 7465 6d28 2929  s.GetRootItem())
+000491c0: 0d0a 2020 2020 2020 2020 2020 2020 7768  ..            wh
+000491d0: 696c 6520 693a 0d0a 2020 2020 2020 2020  ile i:..        
+000491e0: 2020 2020 2020 2020 7465 7874 203d 2073          text = s
+000491f0: 656c 662e 7472 6565 5f74 6162 6c65 732e  elf.tree_tables.
+00049200: 4765 7449 7465 6d54 6578 7428 6929 2e6c  GetItemText(i).l
+00049210: 6f77 6572 2829 0d0a 2020 2020 2020 2020  ower()..        
+00049220: 2020 2020 2020 2020 7365 6c66 2e74 7265          self.tre
+00049230: 655f 7461 626c 6573 2e53 6574 4974 656d  e_tables.SetItem
+00049240: 426f 6c64 2869 2c20 7465 7874 203d 3d20  Bold(i, text == 
+00049250: 6c6f 7765 7229 0d0a 2020 2020 2020 2020  lower)..        
+00049260: 2020 2020 2020 2020 6920 3d20 7365 6c66          i = self
+00049270: 2e74 7265 655f 7461 626c 6573 2e47 6574  .tree_tables.Get
+00049280: 4e65 7874 5369 626c 696e 6728 6929 0d0a  NextSibling(i)..
+00049290: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
+000492a0: 6572 2e69 6e66 6f28 224c 6f61 6469 6e67  er.info("Loading
+000492b0: 2074 6162 6c65 2025 7320 2825 7329 2e22   table %s (%s)."
+000492c0: 2c20 7461 626c 652c 2073 656c 662e 6462  , table, self.db
+000492d0: 290d 0a20 2020 2020 2020 2020 2020 2062  )..            b
+000492e0: 7573 7920 3d20 636f 6e74 726f 6c73 2e42  usy = controls.B
+000492f0: 7573 7950 616e 656c 2873 656c 662c 2022  usyPanel(self, "
+00049300: 4c6f 6164 696e 6720 7461 626c 6520 5c22  Loading table \"
+00049310: 2573 5c22 2e22 2025 2074 6162 6c65 290d  %s\"." % table).
+00049320: 0a20 2020 2020 2020 2020 2020 2074 7279  .            try
+00049330: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00049340: 2020 2067 7269 645f 6461 7461 203d 2073     grid_data = s
+00049350: 656c 662e 6462 5f67 7269 6473 2e67 6574  elf.db_grids.get
+00049360: 286c 6f77 6572 290d 0a20 2020 2020 2020  (lower)..       
+00049370: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+00049380: 6772 6964 5f64 6174 613a 0d0a 2020 2020  grid_data:..    
+00049390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000493a0: 6772 6964 5f64 6174 6120 3d20 5371 6c69  grid_data = Sqli
+000493b0: 7465 4772 6964 4261 7365 2873 656c 662e  teGridBase(self.
+000493c0: 6462 2c20 7461 626c 653d 7461 626c 6529  db, table=table)
+000493d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000493e0: 2020 2020 2020 7365 6c66 2e64 625f 6772        self.db_gr
+000493f0: 6964 735b 6c6f 7765 725d 203d 2067 7269  ids[lower] = gri
+00049400: 645f 6461 7461 0d0a 2020 2020 2020 2020  d_data..        
+00049410: 2020 2020 2020 2020 7365 6c66 2e6c 6162          self.lab
+00049420: 656c 5f74 6162 6c65 2e4c 6162 656c 203d  el_table.Label =
+00049430: 2022 5461 626c 6520 5c22 2573 5c22 3a22   "Table \"%s\":"
+00049440: 2025 2074 6162 6c65 0d0a 2020 2020 2020   % table..      
+00049450: 2020 2020 2020 2020 2020 7365 6c66 2e67            self.g
+00049460: 7269 645f 7461 626c 652e 5365 7454 6162  rid_table.SetTab
+00049470: 6c65 284e 6f6e 6529 0d0a 2020 2020 2020  le(None)..      
+00049480: 2020 2020 2020 2020 2020 7365 6c66 2e67            self.g
+00049490: 7269 645f 7461 626c 652e 5365 7454 6162  rid_table.SetTab
+000494a0: 6c65 2867 7269 645f 6461 7461 290d 0a20  le(grid_data).. 
+000494b0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000494c0: 656c 662e 7061 6765 5f74 6162 6c65 732e  elf.page_tables.
+000494d0: 4c61 796f 7574 2829 2023 2052 6561 6374  Layout() # React
+000494e0: 2074 6f20 6772 6964 2073 697a 6520 6368   to grid size ch
+000494f0: 616e 6765 0d0a 2020 2020 2020 2020 2020  ange..          
+00049500: 2020 2020 2020 7365 6c66 2e67 7269 645f        self.grid_
+00049510: 7461 626c 652e 5363 726f 6c6c 2830 2c20  table.Scroll(0, 
+00049520: 3029 0d0a 2020 2020 2020 2020 2020 2020  0)..            
+00049530: 2020 2020 7365 6c66 2e67 7269 645f 7461      self.grid_ta
+00049540: 626c 652e 5365 7443 6f6c 4d69 6e69 6d61  ble.SetColMinima
+00049550: 6c41 6363 6570 7461 626c 6557 6964 7468  lAcceptableWidth
+00049560: 2831 3030 290d 0a20 2020 2020 2020 2020  (100)..         
+00049570: 2020 2020 2020 2063 6f6c 5f72 616e 6765         col_range
+00049580: 203d 2072 616e 6765 2867 7269 645f 6461   = range(grid_da
+00049590: 7461 2e47 6574 4e75 6d62 6572 436f 6c73  ta.GetNumberCols
+000495a0: 2829 290d 0a20 2020 2020 2020 2020 2020  ())..           
+000495b0: 2020 2020 205b 7365 6c66 2e67 7269 645f       [self.grid_
+000495c0: 7461 626c 652e 4175 746f 5369 7a65 436f  table.AutoSizeCo
+000495d0: 6c4c 6162 656c 5369 7a65 2878 2920 666f  lLabelSize(x) fo
+000495e0: 7220 7820 696e 2063 6f6c 5f72 616e 6765  r x in col_range
+000495f0: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
+00049600: 2020 2073 656c 662e 6f6e 5f63 6861 6e67     self.on_chang
+00049610: 655f 7461 626c 6528 4e6f 6e65 290d 0a20  e_table(None).. 
+00049620: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00049630: 656c 662e 7462 5f67 7269 642e 456e 6162  elf.tb_grid.Enab
+00049640: 6c65 546f 6f6c 2877 782e 4944 5f41 4444  leTool(wx.ID_ADD
+00049650: 2c20 5472 7565 290d 0a20 2020 2020 2020  , True)..       
+00049660: 2020 2020 2020 2020 2073 656c 662e 7462           self.tb
+00049670: 5f67 7269 642e 456e 6162 6c65 546f 6f6c  _grid.EnableTool
+00049680: 2877 782e 4944 5f44 454c 4554 452c 2054  (wx.ID_DELETE, T
+00049690: 7275 6529 0d0a 2020 2020 2020 2020 2020  rue)..          
+000496a0: 2020 2020 2020 7365 6c66 2e62 7574 746f        self.butto
+000496b0: 6e5f 6578 706f 7274 5f74 6162 6c65 2e45  n_export_table.E
+000496c0: 6e61 626c 6564 203d 2054 7275 650d 0a20  nabled = True.. 
+000496d0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000496e0: 656c 662e 6275 7474 6f6e 5f72 6573 6574  elf.button_reset
+000496f0: 5f67 7269 645f 7461 626c 652e 456e 6162  _grid_table.Enab
+00049700: 6c65 6420 3d20 5472 7565 0d0a 2020 2020  led = True..    
+00049710: 2020 2020 2020 2020 2020 2020 6275 7379              busy
+00049720: 2e43 6c6f 7365 2829 0d0a 2020 2020 2020  .Close()..      
+00049730: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
+00049740: 6570 7469 6f6e 2061 7320 653a 0d0a 2020  eption as e:..  
+00049750: 2020 2020 2020 2020 2020 2020 2020 6275                bu
+00049760: 7379 2e43 6c6f 7365 2829 0d0a 2020 2020  sy.Close()..    
+00049770: 2020 2020 2020 2020 2020 2020 6775 6962              guib
+00049780: 6173 652e 7374 6174 7573 2822 436f 756c  ase.status("Coul
+00049790: 6420 6e6f 7420 6c6f 6164 2074 6162 6c65  d not load table
+000497a0: 2025 733a 2025 7322 2c20 7461 626c 652c   %s: %s", table,
+000497b0: 2075 7469 6c2e 666f 726d 6174 5f65 7863   util.format_exc
+000497c0: 2865 2929 0d0a 2020 2020 2020 2020 2020  (e))..          
+000497d0: 2020 2020 2020 6c6f 6767 6572 2e65 7863        logger.exc
+000497e0: 6570 7469 6f6e 2822 436f 756c 6420 6e6f  eption("Could no
+000497f0: 7420 6c6f 6164 2074 6162 6c65 2025 732e  t load table %s.
+00049800: 222c 2074 6162 6c65 290d 0a20 2020 2020  ", table)..     
+00049810: 2020 2020 2020 2020 2020 2065 7272 6f72             error
+00049820: 6d73 6720 3d20 2243 6f75 6c64 206e 6f74  msg = "Could not
+00049830: 206c 6f61 6420 7461 626c 6520 2573 2e5c   load table %s.\
+00049840: 6e5c 6e25 7322 2025 205c 0d0a 2020 2020  n\n%s" % \..    
+00049850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049860: 2020 2020 2020 2028 7461 626c 652c 2074         (table, t
+00049870: 7261 6365 6261 636b 2e66 6f72 6d61 745f  raceback.format_
+00049880: 6578 6328 2929 0d0a 2020 2020 2020 2020  exc())..        
+00049890: 2020 2020 2020 2020 7778 2e4d 6573 7361          wx.Messa
+000498a0: 6765 426f 7828 6572 726f 726d 7367 2c20  geBox(errormsg, 
+000498b0: 636f 6e66 2e54 6974 6c65 2c20 7778 2e4f  conf.Title, wx.O
+000498c0: 4b20 7c20 7778 2e49 434f 4e5f 5741 524e  K | wx.ICON_WARN
+000498d0: 494e 4729 0d0a 0d0a 0d0a 2020 2020 6465  ING)......    de
+000498e0: 6620 6f6e 5f63 6861 6e67 655f 6c69 7374  f on_change_list
+000498f0: 5f63 6861 7473 2873 656c 662c 2065 7665  _chats(self, eve
+00049900: 6e74 293a 0d0a 2020 2020 2020 2020 2222  nt):..        ""
+00049910: 220d 0a20 2020 2020 2020 2048 616e 646c  "..        Handl
+00049920: 6572 2066 6f72 2073 656c 6563 7469 6e67  er for selecting
+00049930: 2061 6e20 6974 656d 2069 6e20 7468 6520   an item in the 
+00049940: 6368 6174 7320 6c69 7374 2c20 6c6f 6164  chats list, load
+00049950: 7320 7468 650d 0a20 2020 2020 2020 206d  s the..        m
+00049960: 6573 7361 6765 7320 696e 746f 2074 6865  essages into the
+00049970: 206d 6573 7361 6765 206c 6f67 2e0d 0a20   message log... 
+00049980: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
+00049990: 2020 2020 7365 6c66 2e6c 6f61 645f 6368      self.load_ch
+000499a0: 6174 2873 656c 662e 6c69 7374 5f63 6861  at(self.list_cha
+000499b0: 7473 2e47 6574 4974 656d 4d61 7070 6564  ts.GetItemMapped
+000499c0: 4461 7461 2865 7665 6e74 2e49 6e64 6578  Data(event.Index
+000499d0: 2929 0d0a 2020 2020 2020 2020 7365 6c66  ))..        self
+000499e0: 2e73 7463 5f68 6973 746f 7279 2e53 6574  .stc_history.Set
+000499f0: 466f 6375 7328 290d 0a0d 0a0d 0a20 2020  Focus()......   
+00049a00: 2064 6566 206f 6e5f 6368 616e 6765 5f6c   def on_change_l
+00049a10: 6973 745f 636f 6e74 6163 7473 2873 656c  ist_contacts(sel
+00049a20: 662c 2065 7665 6e74 293a 0d0a 2020 2020  f, event):..    
+00049a30: 2020 2020 2222 2248 616e 646c 6572 2066      """Handler f
+00049a40: 6f72 2073 656c 6563 7469 6e67 2061 6e20  or selecting an 
+00049a50: 6974 656d 2069 6e20 7468 6520 636f 6e74  item in the cont
+00049a60: 6163 7473 206c 6973 742c 206c 6f61 6473  acts list, loads
+00049a70: 2063 6f6e 7461 6374 2069 6e66 6f2e 2222   contact info.""
+00049a80: 220d 0a20 2020 2020 2020 2073 656c 662e  "..        self.
+00049a90: 6c6f 6164 5f63 6f6e 7461 6374 2873 656c  load_contact(sel
+00049aa0: 662e 6c69 7374 5f63 6f6e 7461 6374 732e  f.list_contacts.
+00049ab0: 4765 7449 7465 6d4d 6170 7065 6444 6174  GetItemMappedDat
+00049ac0: 6128 6576 656e 742e 496e 6465 7829 290d  a(event.Index)).
+00049ad0: 0a0d 0a0d 0a20 2020 2064 6566 206c 6f61  .....    def loa
+00049ae0: 645f 6368 6174 2873 656c 662c 2063 6861  d_chat(self, cha
+00049af0: 742c 2063 656e 7465 725f 6d65 7373 6167  t, center_messag
+00049b00: 655f 6964 3d4e 6f6e 652c 2072 656c 6f61  e_id=None, reloa
+00049b10: 643d 4661 6c73 6529 3a0d 0a20 2020 2020  d=False):..     
+00049b20: 2020 2022 2222 4c6f 6164 7320 6869 7374     """Loads hist
+00049b30: 6f72 7920 6f66 2074 6865 2073 7065 6369  ory of the speci
+00049b40: 6669 6564 2063 6861 7420 2861 7320 7265  fied chat (as re
+00049b50: 7475 726e 6564 2066 726f 6d20 6462 292e  turned from db).
+00049b60: 2222 220d 0a20 2020 2020 2020 2069 6620  """..        if 
+00049b70: 6e6f 7420 6368 6174 206f 7220 2863 6861  not chat or (cha
+00049b80: 7420 3d3d 2073 656c 662e 6368 6174 2061  t == self.chat a
+00049b90: 6e64 206e 6f74 2063 656e 7465 725f 6d65  nd not center_me
+00049ba0: 7373 6167 655f 6964 2061 6e64 206e 6f74  ssage_id and not
+00049bb0: 2072 656c 6f61 6429 3a0d 0a20 2020 2020   reload):..     
+00049bc0: 2020 2020 2020 2072 6574 7572 6e0d 0a0d         return...
+00049bd0: 0a20 2020 2020 2020 2062 7573 792c 2063  .        busy, c
+00049be0: 6c69 7374 2c20 706c 6973 7420 3d20 4e6f  list, plist = No
+00049bf0: 6e65 2c20 7365 6c66 2e6c 6973 745f 6368  ne, self.list_ch
+00049c00: 6174 732c 2073 656c 662e 6c69 7374 5f70  ats, self.list_p
+00049c10: 6172 7469 6369 7061 6e74 730d 0a20 2020  articipants..   
+00049c20: 2020 2020 2069 6620 6368 6174 2021 3d20       if chat != 
+00049c30: 7365 6c66 2e63 6861 743a 0d0a 2020 2020  self.chat:..    
+00049c40: 2020 2020 2020 2020 2320 5570 6461 7465          # Update
+00049c50: 2063 6861 7420 6c69 7374 2063 6f6c 6f75   chat list colou
+00049c60: 7273 2061 6e64 2073 6372 6f6c 6c20 746f  rs and scroll to
+00049c70: 2074 6865 206f 7065 6e65 6420 6368 6174   the opened chat
+00049c80: 0d0a 2020 2020 2020 2020 2020 2020 6c6f  ..            lo
+00049c90: 6767 6572 2e69 6e66 6f28 224f 7065 6e69  gger.info("Openi
+00049ca0: 6e67 2025 732e 222c 2063 6861 745b 2274  ng %s.", chat["t
+00049cb0: 6974 6c65 5f6c 6f6e 675f 6c63 225d 290d  itle_long_lc"]).
+00049cc0: 0a20 2020 2020 2020 2020 2020 2063 6c69  .            cli
+00049cd0: 7374 2e46 7265 657a 6528 290d 0a20 2020  st.Freeze()..   
+00049ce0: 2020 2020 2020 2020 2073 6372 6f6c 6c70           scrollp
+00049cf0: 6f73 203d 2063 6c69 7374 2e47 6574 5363  os = clist.GetSc
+00049d00: 726f 6c6c 506f 7328 7778 2e56 4552 5449  rollPos(wx.VERTI
+00049d10: 4341 4c29 0d0a 2020 2020 2020 2020 2020  CAL)..          
+00049d20: 2020 696e 6465 785f 7365 6c65 6374 6564    index_selected
+00049d30: 203d 202d 310d 0a20 2020 2020 2020 2020   = -1..         
+00049d40: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
+00049d50: 6528 636c 6973 742e 4974 656d 436f 756e  e(clist.ItemCoun
+00049d60: 7429 3a0d 0a20 2020 2020 2020 2020 2020  t):..           
+00049d70: 2020 2020 2069 6620 636c 6973 742e 4765       if clist.Ge
+00049d80: 7449 7465 6d4d 6170 7065 6444 6174 6128  tItemMappedData(
+00049d90: 6929 203d 3d20 7365 6c66 2e63 6861 743a  i) == self.chat:
+00049da0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00049db0: 2020 2020 2020 636c 6973 742e 5365 7449        clist.SetI
+00049dc0: 7465 6d46 6f6e 7428 692c 2063 6c69 7374  temFont(i, clist
+00049dd0: 2e46 6f6e 7429 0d0a 2020 2020 2020 2020  .Font)..        
+00049de0: 2020 2020 2020 2020 656c 6966 2063 6c69          elif cli
+00049df0: 7374 2e47 6574 4974 656d 4d61 7070 6564  st.GetItemMapped
+00049e00: 4461 7461 2869 2920 3d3d 2063 6861 743a  Data(i) == chat:
+00049e10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00049e20: 2020 2020 2020 696e 6465 785f 7365 6c65        index_sele
+00049e30: 6374 6564 203d 2069 0d0a 2020 2020 2020  cted = i..      
+00049e40: 2020 2020 2020 2020 2020 2020 2020 6620                f 
+00049e50: 3d20 636c 6973 742e 466f 6e74 3b20 662e  = clist.Font; f.
+00049e60: 5365 7457 6569 6768 7428 7778 2e46 4f4e  SetWeight(wx.FON
+00049e70: 5457 4549 4748 545f 424f 4c44 290d 0a20  TWEIGHT_BOLD).. 
+00049e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049e90: 2020 2063 6c69 7374 2e53 6574 4974 656d     clist.SetItem
+00049ea0: 466f 6e74 2869 2c20 6629 0d0a 2020 2020  Font(i, f)..    
+00049eb0: 2020 2020 2020 2020 6966 2069 6e64 6578          if index
+00049ec0: 5f73 656c 6563 7465 6420 3e3d 2030 3a0d  _selected >= 0:.
+00049ed0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00049ee0: 2064 656c 7461 203d 2069 6e64 6578 5f73   delta = index_s
+00049ef0: 656c 6563 7465 6420 2d20 7363 726f 6c6c  elected - scroll
+00049f00: 706f 730d 0a20 2020 2020 2020 2020 2020  pos..           
+00049f10: 2020 2020 2069 6620 6465 6c74 6120 3c20       if delta < 
+00049f20: 3020 6f72 2061 6273 2864 656c 7461 2920  0 or abs(delta) 
+00049f30: 3e3d 2063 6c69 7374 2e43 6f75 6e74 5065  >= clist.CountPe
+00049f40: 7250 6167 653a 0d0a 2020 2020 2020 2020  rPage:..        
+00049f50: 2020 2020 2020 2020 2020 2020 6e75 6467              nudg
+00049f60: 6520 3d20 2d63 6c69 7374 2e43 6f75 6e74  e = -clist.Count
+00049f70: 5065 7250 6167 6520 2f2f 2032 0d0a 2020  PerPage // 2..  
+00049f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049f90: 2020 636c 6973 742e 5363 726f 6c6c 4c69    clist.ScrollLi
+00049fa0: 6e65 7328 6465 6c74 6120 2b20 6e75 6467  nes(delta + nudg
+00049fb0: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+00049fc0: 636c 6973 742e 5468 6177 2829 0d0a 2020  clist.Thaw()..  
+00049fd0: 2020 2020 2020 2020 2020 7778 2e59 6965            wx.Yie
+00049fe0: 6c64 4966 4e65 6564 6564 2829 2023 2041  ldIfNeeded() # A
+00049ff0: 6c6c 6f77 2064 6973 706c 6179 2074 6f20  llow display to 
+0004a000: 7265 6672 6573 680d 0a20 2020 2020 2020  refresh..       
+0004a010: 2020 2020 2023 2041 6464 2073 686f 7274       # Add short
+0004a020: 6375 7420 6b65 7920 666c 6167 2074 6f20  cut key flag to 
+0004a030: 6368 6174 206c 6162 656c 0d0a 2020 2020  chat label..    
+0004a040: 2020 2020 2020 2020 7365 6c66 2e6c 6162          self.lab
+0004a050: 656c 5f63 6861 742e 4c61 6265 6c20 3d20  el_chat.Label = 
+0004a060: 6368 6174 5b22 7469 746c 655f 6c6f 6e67  chat["title_long
+0004a070: 225d 2e72 6570 6c61 6365 280d 0a20 2020  "].replace(..   
+0004a080: 2020 2020 2020 2020 2020 2020 2022 6368               "ch
+0004a090: 6174 222c 2022 2663 6861 7422 0d0a 2020  at", "&chat"..  
+0004a0a0: 2020 2020 2020 2020 2020 292e 7265 706c            ).repl
+0004a0b0: 6163 6528 2243 6861 7422 2c20 2226 4368  ace("Chat", "&Ch
+0004a0c0: 6174 2229 202b 2022 3a22 0d0a 2020 2020  at") + ":"..    
+0004a0d0: 2020 2020 2020 2020 7365 6c66 2e6c 6162          self.lab
+0004a0e0: 656c 5f63 6861 742e 5061 7265 6e74 2e4c  el_chat.Parent.L
+0004a0f0: 6179 6f75 7428 290d 0a0d 0a20 2020 2020  ayout()....     
+0004a100: 2020 2064 6174 6573 5f72 616e 6765 2020     dates_range  
+0004a110: 3d20 5b4e 6f6e 652c 204e 6f6e 655d 2023  = [None, None] #
+0004a120: 2074 6f74 616c 2061 7661 696c 6162 6c65   total available
+0004a130: 2064 6174 6520 7261 6e67 650d 0a20 2020   date range..   
+0004a140: 2020 2020 2064 6174 6573 5f76 616c 7565       dates_value
+0004a150: 7320 3d20 5b4e 6f6e 652c 204e 6f6e 655d  s = [None, None]
+0004a160: 2023 2063 7572 7265 6e74 6c79 2066 696c   # currently fil
+0004a170: 7465 7265 6420 6461 7465 2072 616e 6765  tered date range
+0004a180: 0d0a 2020 2020 2020 2020 6966 2063 6861  ..        if cha
+0004a190: 7420 213d 2073 656c 662e 6368 6174 206f  t != self.chat o
+0004a1a0: 7220 7265 6c6f 6164 206f 7220 2863 656e  r reload or (cen
+0004a1b0: 7465 725f 6d65 7373 6167 655f 6964 0d0a  ter_message_id..
+0004a1c0: 2020 2020 2020 2020 616e 6420 6e6f 7420          and not 
+0004a1d0: 7365 6c66 2e73 7463 5f68 6973 746f 7279  self.stc_history
+0004a1e0: 2e49 734d 6573 7361 6765 5368 6f77 6e28  .IsMessageShown(
+0004a1f0: 6365 6e74 6572 5f6d 6573 7361 6765 5f69  center_message_i
+0004a200: 6429 293a 0d0a 2020 2020 2020 2020 2020  d)):..          
+0004a210: 2020 6275 7379 203d 2063 6f6e 7472 6f6c    busy = control
+0004a220: 732e 4275 7379 5061 6e65 6c28 7365 6c66  s.BusyPanel(self
+0004a230: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0004a240: 2020 2022 4c6f 6164 696e 6720 6869 7374     "Loading hist
+0004a250: 6f72 7920 666f 7220 2573 2e22 2025 2063  ory for %s." % c
+0004a260: 6861 745b 2274 6974 6c65 5f6c 6f6e 675f  hat["title_long_
+0004a270: 6c63 225d 290d 0a20 2020 2020 2020 2020  lc"])..         
+0004a280: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
+0004a290: 2020 2020 2020 2020 2023 2052 6566 7265           # Refre
+0004a2a0: 7368 206c 6173 7420 6d65 7373 6167 6573  sh last messages
+0004a2b0: 2c20 696e 2063 6173 6520 6461 7461 6261  , in case databa
+0004a2c0: 7365 2068 6173 2075 7064 6174 6564 0d0a  se has updated..
+0004a2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004a2e0: 7365 6c66 2e64 622e 6765 745f 636f 6e76  self.db.get_conv
+0004a2f0: 6572 7361 7469 6f6e 735f 7374 6174 7328  ersations_stats(
+0004a300: 5b63 6861 745d 2c20 6c6f 673d 4661 6c73  [chat], log=Fals
+0004a310: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+0004a320: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
+0004a330: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0004a340: 2020 2067 7569 6261 7365 2e73 7461 7475     guibase.statu
+0004a350: 7328 224e 6f74 6963 653a 2066 6169 6c65  s("Notice: faile
+0004a360: 6420 746f 2072 6566 7265 7368 2025 732e  d to refresh %s.
+0004a370: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
+0004a380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004a390: 2020 2063 6861 745b 2274 6974 6c65 5f6c     chat["title_l
+0004a3a0: 6f6e 675f 6c63 225d 290d 0a20 2020 2020  ong_lc"])..     
+0004a3b0: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
+0004a3c0: 722e 6578 6365 7074 696f 6e28 224e 6f74  r.exception("Not
+0004a3d0: 6963 653a 2066 6169 6c65 6420 746f 2072  ice: failed to r
+0004a3e0: 6566 7265 7368 2025 732e 222c 0d0a 2020  efresh %s.",..  
+0004a3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004a400: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0004a410: 6861 745b 2274 6974 6c65 5f6c 6f6e 675f  hat["title_long_
+0004a420: 6c63 225d 290d 0a20 2020 2020 2020 2020  lc"])..         
+0004a430: 2020 2073 656c 662e 6564 6974 5f66 696c     self.edit_fil
+0004a440: 7465 7274 6578 742e 5661 6c75 6520 3d20  tertext.Value = 
+0004a450: 7365 6c66 2e63 6861 745f 6669 6c74 6572  self.chat_filter
+0004a460: 5b22 7465 7874 225d 203d 2022 220d 0a20  ["text"] = "".. 
+0004a470: 2020 2020 2020 2020 2020 2064 7473 203d             dts =
+0004a480: 2022 6669 7273 745f 6d65 7373 6167 655f   "first_message_
+0004a490: 6461 7465 7469 6d65 222c 2022 6c61 7374  datetime", "last
+0004a4a0: 5f6d 6573 7361 6765 5f64 6174 6574 696d  _message_datetim
+0004a4b0: 6522 0d0a 2020 2020 2020 2020 2020 2020  e"..            
+0004a4c0: 6461 7465 5f72 616e 6765 203d 205b 6368  date_range = [ch
+0004a4d0: 6174 5b6e 5d2e 6461 7465 2829 2069 6620  at[n].date() if 
+0004a4e0: 6368 6174 5b6e 5d20 656c 7365 204e 6f6e  chat[n] else Non
+0004a4f0: 6520 666f 7220 6e20 696e 2064 7473 5d0d  e for n in dts].
+0004a500: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0004a510: 662e 6368 6174 5f66 696c 7465 725b 2264  f.chat_filter["d
+0004a520: 6174 6572 616e 6765 225d 203d 2064 6174  aterange"] = dat
+0004a530: 655f 7261 6e67 650d 0a20 2020 2020 2020  e_range..       
+0004a540: 2020 2020 2069 6620 6368 6174 2021 3d20       if chat != 
+0004a550: 7365 6c66 2e63 6861 743a 0d0a 2020 2020  self.chat:..    
+0004a560: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0004a570: 2e63 6861 745f 6669 6c74 6572 5b22 7374  .chat_filter["st
+0004a580: 6172 7464 6174 6572 616e 6765 225d 203d  artdaterange"] =
+0004a590: 2064 6174 655f 7261 6e67 650d 0a20 2020   date_range..   
+0004a5a0: 2020 2020 2020 2020 2064 6174 6573 5f72           dates_r
+0004a5b0: 616e 6765 203d 2064 6174 6573 5f76 616c  ange = dates_val
+0004a5c0: 7565 7320 3d20 6461 7465 5f72 616e 6765  ues = date_range
+0004a5d0: 0d0a 2020 2020 2020 2020 2020 2020 6176  ..            av
+0004a5e0: 6174 6172 5f64 6566 6175 6c74 203d 2069  atar_default = i
+0004a5f0: 6d61 6765 732e 4176 6174 6172 4465 6661  mages.AvatarDefa
+0004a600: 756c 742e 4269 746d 6170 0d0a 2020 2020  ult.Bitmap..    
+0004a610: 2020 2020 2020 2020 6966 2063 6861 7420          if chat 
+0004a620: 213d 2073 656c 662e 6368 6174 3a0d 0a20  != self.chat:.. 
+0004a630: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0004a640: 2049 6620 6368 6174 2068 6173 2063 6861   If chat has cha
+0004a650: 6e67 6564 2c20 6c6f 6164 2061 7661 7461  nged, load avata
+0004a660: 7220 696d 6167 6573 2066 6f72 2074 6865  r images for the
+0004a670: 2063 6f6e 7461 6374 730d 0a20 2020 2020   contacts..     
+0004a680: 2020 2020 2020 2020 2020 2070 6c69 7374             plist
+0004a690: 2e43 6c65 6172 416c 6c28 290d 0a20 2020  .ClearAll()..   
+0004a6a0: 2020 2020 2020 2020 2020 2020 2070 6c69               pli
+0004a6b0: 7374 2e49 6e73 6572 7443 6f6c 756d 6e28  st.InsertColumn(
+0004a6c0: 302c 2022 2229 0d0a 2020 2020 2020 2020  0, "")..        
+0004a6d0: 2020 2020 2020 2020 737a 5f61 7661 7461          sz_avata
+0004a6e0: 7220 3d20 636f 6e66 2e41 7661 7461 7249  r = conf.AvatarI
+0004a6f0: 6d61 6765 5369 7a65 0d0a 2020 2020 2020  mageSize..      
+0004a700: 2020 2020 2020 2020 2020 696c 203d 2077            il = w
+0004a710: 782e 496d 6167 654c 6973 7428 2a73 7a5f  x.ImageList(*sz_
+0004a720: 6176 6174 6172 290d 0a20 2020 2020 2020  avatar)..       
+0004a730: 2020 2020 2020 2020 2069 6c2e 4164 6428           il.Add(
+0004a740: 6176 6174 6172 5f64 6566 6175 6c74 290d  avatar_default).
+0004a750: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004a760: 2070 6c69 7374 2e41 7373 6967 6e49 6d61   plist.AssignIma
+0004a770: 6765 4c69 7374 2820 696c 2c20 7778 2e49  geList( il, wx.I
+0004a780: 4d41 4745 5f4c 4953 545f 534d 414c 4c29  MAGE_LIST_SMALL)
+0004a790: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0004a7a0: 2020 696e 6465 7820 3d20 300d 0a0d 0a20    index = 0.... 
+0004a7b0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+0004a7c0: 6f6c 6f67 203d 2077 782e 4c6f 674e 756c  olog = wx.LogNul
+0004a7d0: 6c28 2920 2320 7778 2077 696c 6c20 6f74  l() # wx will ot
+0004a7e0: 6865 7277 6973 6520 6f70 656e 2061 2077  herwise open a w
+0004a7f0: 6172 6e69 6e67 2064 6961 6c6f 6720 6f6e  arning dialog on
+0004a800: 2069 6d61 6765 2065 7272 6f72 0d0a 2020   image error..  
+0004a810: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+0004a820: 7220 7020 696e 2063 6861 745b 2270 6172  r p in chat["par
+0004a830: 7469 6369 7061 6e74 7322 5d3a 0d0a 2020  ticipants"]:..  
+0004a840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004a850: 2020 6220 3d20 300d 0a20 2020 2020 2020    b = 0..       
+0004a860: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0004a870: 6e6f 7420 705b 2263 6f6e 7461 6374 225d  not p["contact"]
+0004a880: 2e67 6574 2822 6176 6174 6172 5f62 6974  .get("avatar_bit
+0004a890: 6d61 7022 293a 0d0a 2020 2020 2020 2020  map"):..        
 0004a8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a8b0: 2074 203d 2074 2e72 6570 6c61 6365 2822   t = t.replace("
-0004a8c0: 5c6e 222c 2022 2022 290d 0a20 2020 2020  \n", " ")..     
-0004a8d0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0004a8e0: 7279 3a20 706c 6973 742e 496e 7365 7274  ry: plist.Insert
-0004a8f0: 496d 6167 6553 7472 696e 6749 7465 6d28  ImageStringItem(
-0004a900: 696e 6465 782c 2074 2c20 622c 2069 745f  index, t, b, it_
-0004a910: 6b69 6e64 3d31 290d 0a20 2020 2020 2020  kind=1)..       
-0004a920: 2020 2020 2020 2020 2020 2020 2065 7863               exc
-0004a930: 6570 7420 4578 6365 7074 696f 6e3a 0d0a  ept Exception:..
-0004a940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a950: 2020 2020 2020 2020 7420 3d20 7265 2e73          t = re.s
-0004a960: 7562 2872 225b 5e5c 7720 2573 5d22 2025  ub(r"[^\w %s]" %
-0004a970: 2072 652e 6573 6361 7065 2873 7472 696e   re.escape(strin
-0004a980: 672e 7075 6e63 7475 6174 696f 6e29 2c0d  g.punctuation),.
-0004a990: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004a9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a9b0: 2020 2020 6c61 6d62 6461 206d 3a20 2223      lambda m: "#
-0004a9c0: 2573 2220 2520 6f72 6428 6d2e 6772 6f75  %s" % ord(m.grou
-0004a9d0: 7028 3029 292c 2074 2c20 7265 2e55 290d  p(0)), t, re.U).
-0004a9e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004a9f0: 2020 2020 2020 2020 2070 6c69 7374 2e49           plist.I
-0004aa00: 6e73 6572 7449 6d61 6765 5374 7269 6e67  nsertImageString
-0004aa10: 4974 656d 2869 6e64 6578 2c20 742c 2062  Item(index, t, b
-0004aa20: 2c20 6974 5f6b 696e 643d 3129 0d0a 2020  , it_kind=1)..  
-0004aa30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004aa40: 2020 706c 6973 742e 5365 7449 7465 6d54    plist.SetItemT
-0004aa50: 6578 7443 6f6c 6f75 7228 696e 6465 782c  extColour(index,
-0004aa60: 2020 2020 2020 2070 6c69 7374 2e46 6f72         plist.For
-0004aa70: 6567 726f 756e 6443 6f6c 6f75 7229 0d0a  egroundColour)..
-0004aa80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004aa90: 2020 2020 706c 6973 742e 5365 7449 7465      plist.SetIte
-0004aaa0: 6d42 6163 6b67 726f 756e 6443 6f6c 6f75  mBackgroundColou
-0004aab0: 7228 696e 6465 782c 2070 6c69 7374 2e42  r(index, plist.B
-0004aac0: 6163 6b67 726f 756e 6443 6f6c 6f75 7229  ackgroundColour)
-0004aad0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004aae0: 2020 2020 2020 6320 3d20 706c 6973 742e        c = plist.
-0004aaf0: 4765 7449 7465 6d28 696e 6465 7829 0d0a  GetItem(index)..
-0004ab00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ab10: 2020 2020 632e 4368 6563 6b28 5472 7565      c.Check(True
-0004ab20: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0004ab30: 2020 2020 2020 2070 6c69 7374 2e53 6574         plist.Set
-0004ab40: 4974 656d 2863 290d 0a20 2020 2020 2020  Item(c)..       
-0004ab50: 2020 2020 2020 2020 2020 2020 2070 6c69               pli
-0004ab60: 7374 2e53 6574 4974 656d 4461 7461 2869  st.SetItemData(i
-0004ab70: 6e64 6578 2c20 7029 0d0a 2020 2020 2020  ndex, p)..      
-0004ab80: 2020 2020 2020 2020 2020 2020 2020 696e                in
-0004ab90: 6465 7820 2b3d 2031 0d0a 2020 2020 2020  dex += 1..      
-0004aba0: 2020 2020 2020 2020 2020 6465 6c20 6e6f            del no
-0004abb0: 6c6f 6720 2320 5265 7374 6f72 6520 6465  log # Restore de
-0004abc0: 6661 756c 7420 7778 206d 6573 7361 6765  fault wx message
-0004abd0: 206c 6f67 6765 720d 0a20 2020 2020 2020   logger..       
-0004abe0: 2020 2020 2020 2020 2070 6c69 7374 2e53           plist.S
-0004abf0: 6574 436f 6c75 6d6e 5769 6474 6828 302c  etColumnWidth(0,
-0004ac00: 2077 782e 4c49 5354 5f41 5554 4f53 495a   wx.LIST_AUTOSIZ
-0004ac10: 4529 0d0a 2020 2020 2020 2020 2020 2020  E)..            
-0004ac20: 7365 6c66 2e63 6861 745f 6669 6c74 6572  self.chat_filter
-0004ac30: 5b22 7061 7274 6963 6970 616e 7473 225d  ["participants"]
-0004ac40: 203d 205b 0d0a 2020 2020 2020 2020 2020   = [..          
-0004ac50: 2020 2020 2020 705b 2269 6465 6e74 6974        p["identit
-0004ac60: 7922 5d20 666f 7220 7020 696e 2063 6861  y"] for p in cha
-0004ac70: 745b 2270 6172 7469 6369 7061 6e74 7322  t["participants"
-0004ac80: 5d5d 0d0a 0d0a 2020 2020 2020 2020 6966  ]]....        if
-0004ac90: 2063 656e 7465 725f 6d65 7373 6167 655f   center_message_
-0004aca0: 6964 2061 6e64 2073 656c 662e 6368 6174  id and self.chat
-0004acb0: 203d 3d20 6368 6174 3a0d 0a20 2020 2020   == chat:..     
-0004acc0: 2020 2020 2020 2069 6620 6e6f 7420 7365         if not se
-0004acd0: 6c66 2e73 7463 5f68 6973 746f 7279 2e49  lf.stc_history.I
-0004ace0: 734d 6573 7361 6765 5368 6f77 6e28 6365  sMessageShown(ce
-0004acf0: 6e74 6572 5f6d 6573 7361 6765 5f69 6429  nter_message_id)
-0004ad00: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0004ad10: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
-0004ad20: 6528 706c 6973 742e 4765 7449 7465 6d43  e(plist.GetItemC
-0004ad30: 6f75 6e74 2829 293a 0d0a 2020 2020 2020  ount()):..      
-0004ad40: 2020 2020 2020 2020 2020 2020 2020 6320                c 
-0004ad50: 3d20 706c 6973 742e 4765 7449 7465 6d28  = plist.GetItem(
-0004ad60: 6929 0d0a 2020 2020 2020 2020 2020 2020  i)..            
-0004ad70: 2020 2020 2020 2020 632e 4368 6563 6b28          c.Check(
-0004ad80: 5472 7565 290d 0a20 2020 2020 2020 2020  True)..         
-0004ad90: 2020 2020 2020 2020 2020 2070 6c69 7374             plist
-0004ada0: 2e53 6574 4974 656d 2863 290d 0a20 2020  .SetItem(c)..   
-0004adb0: 2020 2020 2020 2020 2020 2020 2070 6c69               pli
-0004adc0: 7374 2e52 6566 7265 7368 2829 0d0a 2020  st.Refresh()..  
-0004add0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0004ade0: 6c66 2e73 7463 5f68 6973 746f 7279 2e53  lf.stc_history.S
-0004adf0: 6574 4669 6c74 6572 2873 656c 662e 6368  etFilter(self.ch
-0004ae00: 6174 5f66 696c 7465 7229 0d0a 2020 2020  at_filter)..    
-0004ae10: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0004ae20: 2e73 7463 5f68 6973 746f 7279 2e52 6566  .stc_history.Ref
-0004ae30: 7265 7368 4d65 7373 6167 6573 2863 656e  reshMessages(cen
-0004ae40: 7465 725f 6d65 7373 6167 655f 6964 290d  ter_message_id).
-0004ae50: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-0004ae60: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-0004ae70: 2020 2020 7365 6c66 2e73 7463 5f68 6973      self.stc_his
-0004ae80: 746f 7279 2e46 6f63 7573 4d65 7373 6167  tory.FocusMessag
-0004ae90: 6528 6365 6e74 6572 5f6d 6573 7361 6765  e(center_message
-0004aea0: 5f69 6429 0d0a 2020 2020 2020 2020 656c  _id)..        el
-0004aeb0: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-0004aec0: 2073 656c 662e 7374 635f 6869 7374 6f72   self.stc_histor
-0004aed0: 792e 5365 7446 696c 7465 7228 7365 6c66  y.SetFilter(self
-0004aee0: 2e63 6861 745f 6669 6c74 6572 290d 0a20  .chat_filter).. 
-0004aef0: 2020 2020 2020 2020 2020 2074 7279 3a0d             try:.
-0004af00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004af10: 2073 656c 662e 7374 635f 6869 7374 6f72   self.stc_histor
-0004af20: 792e 506f 7075 6c61 7465 2863 6861 742c  y.Populate(chat,
-0004af30: 2073 656c 662e 6462 2c0d 0a20 2020 2020   self.db,..     
-0004af40: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0004af50: 656e 7465 725f 6d65 7373 6167 655f 6964  enter_message_id
-0004af60: 3d63 656e 7465 725f 6d65 7373 6167 655f  =center_message_
-0004af70: 6964 290d 0a20 2020 2020 2020 2020 2020  id)..           
-0004af80: 2020 2020 2069 6620 6365 6e74 6572 5f6d       if center_m
-0004af90: 6573 7361 6765 5f69 6420 5c0d 0a20 2020  essage_id \..   
-0004afa0: 2020 2020 2020 2020 2020 2020 2061 6e64               and
-0004afb0: 206e 6f74 2073 656c 662e 7374 635f 6869   not self.stc_hi
-0004afc0: 7374 6f72 792e 4973 4d65 7373 6167 6553  story.IsMessageS
-0004afd0: 686f 776e 2863 656e 7465 725f 6d65 7373  hown(center_mess
-0004afe0: 6167 655f 6964 293a 0d0a 2020 2020 2020  age_id):..      
-0004aff0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0004b000: 6c66 2e73 7463 5f68 6973 746f 7279 2e53  lf.stc_history.S
-0004b010: 6574 4669 6c74 6572 2873 656c 662e 6368  etFilter(self.ch
-0004b020: 6174 5f66 696c 7465 7229 0d0a 2020 2020  at_filter)..    
-0004b030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b040: 7365 6c66 2e73 7463 5f68 6973 746f 7279  self.stc_history
-0004b050: 2e52 6566 7265 7368 4d65 7373 6167 6573  .RefreshMessages
-0004b060: 2863 656e 7465 725f 6d65 7373 6167 655f  (center_message_
-0004b070: 6964 290d 0a20 2020 2020 2020 2020 2020  id)..           
-0004b080: 2020 2020 2020 2020 2073 656c 662e 7374           self.st
-0004b090: 635f 6869 7374 6f72 792e 466f 6375 734d  c_history.FocusM
-0004b0a0: 6573 7361 6765 2863 656e 7465 725f 6d65  essage(center_me
-0004b0b0: 7373 6167 655f 6964 290d 0a20 2020 2020  ssage_id)..     
-0004b0c0: 2020 2020 2020 2065 7863 6570 7420 4578         except Ex
-0004b0d0: 6365 7074 696f 6e20 6173 2065 3a0d 0a20  ception as e:.. 
-0004b0e0: 2020 2020 2020 2020 2020 2020 2020 2067                 g
-0004b0f0: 7569 6261 7365 2e73 7461 7475 7328 2245  uibase.status("E
-0004b100: 7272 6f72 206c 6f61 6469 6e67 2025 733a  rror loading %s:
-0004b110: 2025 7322 2c0d 0a20 2020 2020 2020 2020   %s",..         
-0004b120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b130: 2020 2020 2020 6368 6174 5b22 7469 746c        chat["titl
-0004b140: 655f 6c6f 6e67 5f6c 6322 5d2c 2075 7469  e_long_lc"], uti
-0004b150: 6c2e 666f 726d 6174 5f65 7863 2865 2929  l.format_exc(e))
-0004b160: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004b170: 2020 6c6f 6767 6572 2e65 7863 6570 7469    logger.excepti
-0004b180: 6f6e 2822 4572 726f 7220 6c6f 6164 696e  on("Error loadin
-0004b190: 6720 2573 2e22 2c20 6368 6174 5b22 7469  g %s.", chat["ti
-0004b1a0: 746c 655f 6c6f 6e67 5f6c 6322 5d29 0d0a  tle_long_lc"])..
-0004b1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b1c0: 6572 726f 726d 7367 203d 2022 4572 726f  errormsg = "Erro
-0004b1d0: 7220 6c6f 6164 696e 6720 2573 3a5c 6e5c  r loading %s:\n\
-0004b1e0: 6e25 7322 2025 205c 0d0a 2020 2020 2020  n%s" % \..      
-0004b1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b200: 2020 2020 2028 6368 6174 5b22 7469 746c       (chat["titl
-0004b210: 655f 6c6f 6e67 5f6c 6322 5d2c 2074 7261  e_long_lc"], tra
-0004b220: 6365 6261 636b 2e66 6f72 6d61 745f 6578  ceback.format_ex
-0004b230: 6328 2929 0d0a 2020 2020 2020 2020 2020  c())..          
-0004b240: 2020 2020 2020 7778 2e4d 6573 7361 6765        wx.Message
-0004b250: 426f 7828 6572 726f 726d 7367 2c20 636f  Box(errormsg, co
-0004b260: 6e66 2e54 6974 6c65 2c20 7778 2e4f 4b20  nf.Title, wx.OK 
-0004b270: 7c20 7778 2e49 434f 4e5f 5741 524e 494e  | wx.ICON_WARNIN
-0004b280: 4729 0d0a 0d0a 2020 2020 2020 2020 6966  G)....        if
-0004b290: 2073 656c 662e 7374 635f 6869 7374 6f72   self.stc_histor
-0004b2a0: 792e 4765 744d 6573 7361 6765 2830 293a  y.GetMessage(0):
-0004b2b0: 0d0a 2020 2020 2020 2020 2020 2020 7661  ..            va
-0004b2c0: 6c75 6573 203d 205b 7365 6c66 2e73 7463  lues = [self.stc
-0004b2d0: 5f68 6973 746f 7279 2e47 6574 4d65 7373  _history.GetMess
-0004b2e0: 6167 6528 3029 5b22 6461 7465 7469 6d65  age(0)["datetime
-0004b2f0: 225d 2c0d 0a20 2020 2020 2020 2020 2020  "],..           
-0004b300: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0004b310: 7374 635f 6869 7374 6f72 792e 4765 744d  stc_history.GetM
-0004b320: 6573 7361 6765 282d 3129 5b22 6461 7465  essage(-1)["date
-0004b330: 7469 6d65 225d 5d0d 0a20 2020 2020 2020  time"]]..       
-0004b340: 2020 2020 2064 6174 6573 5f76 616c 7565       dates_value
-0004b350: 7320 3d20 5b69 2e64 6174 6528 2920 666f  s = [i.date() fo
-0004b360: 7220 6920 696e 2076 616c 7565 735d 0d0a  r i in values]..
-0004b370: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-0004b380: 6f74 2061 6e79 2866 696c 7465 7228 626f  ot any(filter(bo
-0004b390: 6f6c 2c20 6461 7465 735f 7261 6e67 6529  ol, dates_range)
-0004b3a0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-0004b3b0: 2020 2020 6474 7320 3d20 2266 6972 7374      dts = "first
-0004b3c0: 5f6d 6573 7361 6765 5f64 6174 6574 696d  _message_datetim
-0004b3d0: 6522 2c20 226c 6173 745f 6d65 7373 6167  e", "last_messag
-0004b3e0: 655f 6461 7465 7469 6d65 220d 0a20 2020  e_datetime"..   
-0004b3f0: 2020 2020 2020 2020 2020 2020 2064 6174               dat
-0004b400: 6573 5f72 616e 6765 203d 205b 6368 6174  es_range = [chat
-0004b410: 5b6e 5d2e 6461 7465 2829 2069 6620 6368  [n].date() if ch
-0004b420: 6174 5b6e 5d20 656c 7365 204e 6f6e 6520  at[n] else None 
-0004b430: 666f 7220 6e20 696e 2064 7473 5d0d 0a20  for n in dts].. 
-0004b440: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-0004b450: 7420 616e 7928 6669 6c74 6572 2862 6f6f  t any(filter(boo
-0004b460: 6c2c 2064 6174 6573 5f72 616e 6765 2929  l, dates_range))
-0004b470: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0004b480: 2020 2064 6174 6573 5f72 616e 6765 203d     dates_range =
-0004b490: 2064 6174 6573 5f76 616c 7565 730d 0a20   dates_values.. 
-0004b4a0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0004b4b0: 6368 6174 5f66 696c 7465 725b 2264 6174  chat_filter["dat
-0004b4c0: 6572 616e 6765 225d 203d 2064 6174 6573  erange"] = dates
-0004b4d0: 5f72 616e 6765 0d0a 2020 2020 2020 2020  _range..        
-0004b4e0: 2020 2020 6966 2063 6861 7420 213d 2073      if chat != s
-0004b4f0: 656c 662e 6368 6174 206f 7220 6e6f 7420  elf.chat or not 
-0004b500: 616c 6c28 7365 6c66 2e63 6861 745f 6669  all(self.chat_fi
-0004b510: 6c74 6572 5b22 7374 6172 7464 6174 6572  lter["startdater
-0004b520: 616e 6765 225d 293a 0d0a 2020 2020 2020  ange"]):..      
-0004b530: 2020 2020 2020 2020 2020 7365 6c66 2e63            self.c
-0004b540: 6861 745f 6669 6c74 6572 5b22 7374 6172  hat_filter["star
-0004b550: 7464 6174 6572 616e 6765 225d 203d 2064  tdaterange"] = d
-0004b560: 6174 6573 5f76 616c 7565 730d 0a20 2020  ates_values..   
-0004b570: 2020 2020 2073 656c 662e 7261 6e67 655f       self.range_
-0004b580: 6461 7465 2e53 6574 5261 6e67 6528 2a64  date.SetRange(*d
-0004b590: 6174 6573 5f72 616e 6765 290d 0a20 2020  ates_range)..   
-0004b5a0: 2020 2020 2073 656c 662e 6564 6974 5f66       self.edit_f
-0004b5b0: 696c 7465 7264 6174 6531 2e52 616e 6765  ilterdate1.Range
-0004b5c0: 203d 2073 656c 662e 6564 6974 5f66 696c   = self.edit_fil
-0004b5d0: 7465 7264 6174 6532 2e52 616e 6765 203d  terdate2.Range =
-0004b5e0: 2064 6174 6573 5f72 616e 6765 0d0a 2020   dates_range..  
-0004b5f0: 2020 2020 2020 7365 6c66 2e72 616e 6765        self.range
-0004b600: 5f64 6174 652e 5365 7456 616c 7565 7328  _date.SetValues(
-0004b610: 2a64 6174 6573 5f76 616c 7565 7329 0d0a  *dates_values)..
-0004b620: 2020 2020 2020 2020 6861 735f 6d65 7373          has_mess
-0004b630: 6167 6573 203d 2062 6f6f 6c28 7365 6c66  ages = bool(self
-0004b640: 2e73 7463 5f68 6973 746f 7279 2e47 6574  .stc_history.Get
-0004b650: 4d65 7373 6167 6528 3029 290d 0a20 2020  Message(0))..   
-0004b660: 2020 2020 2073 656c 662e 7462 5f63 6861       self.tb_cha
-0004b670: 742e 456e 6162 6c65 546f 6f6c 2877 782e  t.EnableTool(wx.
-0004b680: 4944 5f4d 4f52 452c 2068 6173 5f6d 6573  ID_MORE, has_mes
-0004b690: 7361 6765 7329 0d0a 2020 2020 2020 2020  sages)..        
-0004b6a0: 6966 206e 6f74 2073 656c 662e 6368 6174  if not self.chat
-0004b6b0: 3a0d 0a20 2020 2020 2020 2020 2020 2023  :..            #
-0004b6c0: 2056 6572 7920 6669 7273 7420 6c6f 6164   Very first load
-0004b6d0: 2c20 746f 6767 6c65 2066 696c 7465 7220  , toggle filter 
-0004b6e0: 746f 6f6c 2062 7574 746f 6e20 6f6e 0d0a  tool button on..
-0004b6f0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0004b700: 2e74 625f 6368 6174 2e54 6f67 676c 6554  .tb_chat.ToggleT
-0004b710: 6f6f 6c28 7778 2e49 445f 4d4f 5245 2c20  ool(wx.ID_MORE, 
-0004b720: 7365 6c66 2e73 706c 6974 7465 725f 7374  self.splitter_st
-0004b730: 632e 4973 5370 6c69 7428 2929 0d0a 2020  c.IsSplit())..  
-0004b740: 2020 2020 2020 6966 2073 656c 662e 6368        if self.ch
-0004b750: 6174 2021 3d20 6368 6174 3a0d 0a20 2020  at != chat:..   
-0004b760: 2020 2020 2020 2020 2073 656c 662e 6368           self.ch
-0004b770: 6174 203d 2063 6861 740d 0a20 2020 2020  at = chat..     
-0004b780: 2020 2069 6620 6275 7379 3a0d 0a20 2020     if busy:..   
-0004b790: 2020 2020 2020 2020 2062 7573 792e 436c           busy.Cl
-0004b7a0: 6f73 6528 290d 0a20 2020 2020 2020 2073  ose()..        s
-0004b7b0: 656c 662e 7061 6e65 6c5f 6368 6174 7332  elf.panel_chats2
-0004b7c0: 2e45 6e61 626c 6564 203d 2054 7275 650d  .Enabled = True.
-0004b7d0: 0a20 2020 2020 2020 2073 656c 662e 6c69  .        self.li
-0004b7e0: 7374 5f74 696d 656c 696e 652e 506f 7075  st_timeline.Popu
-0004b7f0: 6c61 7465 282a 7365 6c66 2e73 7463 5f68  late(*self.stc_h
-0004b800: 6973 746f 7279 2e47 6574 5469 6d65 6c69  istory.GetTimeli
-0004b810: 6e65 4461 7461 2829 290d 0a20 2020 2020  neData())..     
-0004b820: 2020 2073 656c 662e 706f 7075 6c61 7465     self.populate
-0004b830: 5f63 6861 745f 7374 6174 6973 7469 6373  _chat_statistics
-0004b840: 2829 0d0a 2020 2020 2020 2020 6966 2073  ()..        if s
-0004b850: 656c 662e 6874 6d6c 5f73 7461 7473 2e53  elf.html_stats.S
-0004b860: 686f 776e 3a0d 0a20 2020 2020 2020 2020  hown:..         
-0004b870: 2020 2073 656c 662e 7368 6f77 5f73 7461     self.show_sta
-0004b880: 7473 2854 7275 6529 2023 2054 6f20 7265  ts(True) # To re
-0004b890: 7374 6f72 6520 7363 726f 6c6c 2070 6f73  store scroll pos
-0004b8a0: 6974 696f 6e0d 0a0d 0a0d 0a20 2020 2064  ition......    d
-0004b8b0: 6566 206c 6f61 645f 636f 6e74 6163 7428  ef load_contact(
-0004b8c0: 7365 6c66 2c20 636f 6e74 6163 7429 3a0d  self, contact):.
-0004b8d0: 0a20 2020 2020 2020 2022 2222 4c6f 6164  .        """Load
-0004b8e0: 7320 636f 6e74 6163 7420 696e 666f 726d  s contact inform
-0004b8f0: 6174 696f 6e3a 2061 7661 7461 722c 2070  ation: avatar, p
-0004b900: 726f 6669 6c65 2c20 616e 6420 6368 6174  rofile, and chat
-0004b910: 7320 6461 7461 2e22 2222 0d0a 2020 2020  s data."""..    
-0004b920: 2020 2020 6275 7379 2c20 636c 6973 7420      busy, clist 
-0004b930: 3d20 4e6f 6e65 2c20 7365 6c66 2e6c 6973  = None, self.lis
-0004b940: 745f 636f 6e74 6163 7473 0d0a 2020 2020  t_contacts..    
-0004b950: 2020 2020 6966 206e 6f74 2063 6f6e 7461      if not conta
-0004b960: 6374 3a0d 0a20 2020 2020 2020 2020 2020  ct:..           
-0004b970: 2073 656c 662e 6c61 6265 6c5f 636f 6e74   self.label_cont
-0004b980: 6163 742e 4c61 6265 6c20 3d20 2226 436f  act.Label = "&Co
-0004b990: 6e74 6163 743a 220d 0a20 2020 2020 2020  ntact:"..       
-0004b9a0: 2020 2020 2073 656c 662e 6874 6d6c 5f63       self.html_c
-0004b9b0: 6f6e 7461 6374 2e53 6574 5061 6765 2822  ontact.SetPage("
-0004b9c0: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
-0004b9d0: 7365 6c66 2e68 746d 6c5f 636f 6e74 6163  self.html_contac
-0004b9e0: 742e 4261 636b 6772 6f75 6e64 436f 6c6f  t.BackgroundColo
-0004b9f0: 7572 203d 2043 6f6c 6f75 724d 616e 6167  ur = ColourManag
-0004ba00: 6572 2e47 6574 436f 6c6f 7572 2877 782e  er.GetColour(wx.
-0004ba10: 5359 535f 434f 4c4f 5552 5f57 494e 444f  SYS_COLOUR_WINDO
-0004ba20: 5729 0d0a 2020 2020 2020 2020 2020 2020  W)..            
-0004ba30: 7365 6c66 2e68 746d 6c5f 636f 6e74 6163  self.html_contac
-0004ba40: 742e 5061 7265 6e74 2e44 6973 6162 6c65  t.Parent.Disable
-0004ba50: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
-0004ba60: 666f 7220 6920 696e 2072 616e 6765 2863  for i in range(c
-0004ba70: 6c69 7374 2e49 7465 6d43 6f75 6e74 2920  list.ItemCount) 
-0004ba80: 6966 2073 656c 662e 636f 6e74 6163 7420  if self.contact 
-0004ba90: 656c 7365 2028 293a 0d0a 2020 2020 2020  else ():..      
-0004baa0: 2020 2020 2020 2020 2020 6966 2063 6c69            if cli
-0004bab0: 7374 2e47 6574 4974 656d 4d61 7070 6564  st.GetItemMapped
-0004bac0: 4461 7461 2869 2920 3d3d 2073 656c 662e  Data(i) == self.
-0004bad0: 636f 6e74 6163 743a 0d0a 2020 2020 2020  contact:..      
-0004bae0: 2020 2020 2020 2020 2020 2020 2020 636c                cl
-0004baf0: 6973 742e 5365 7449 7465 6d46 6f6e 7428  ist.SetItemFont(
-0004bb00: 692c 2063 6c69 7374 2e46 6f6e 7429 0d0a  i, clist.Font)..
-0004bb10: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0004bb20: 2e63 6f6e 7461 6374 203d 204e 6f6e 650d  .contact = None.
-0004bb30: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0004bb40: 7572 6e0d 0a0d 0a20 2020 2020 2020 2023  urn....        #
-0004bb50: 2055 7064 6174 6520 636f 6e74 6163 7420   Update contact 
-0004bb60: 6c69 7374 2063 6f6c 6f75 7273 2061 6e64  list colours and
-0004bb70: 2073 6372 6f6c 6c20 746f 2074 6865 206f   scroll to the o
-0004bb80: 7065 6e65 6420 636f 6e74 6163 740d 0a20  pened contact.. 
-0004bb90: 2020 2020 2020 2063 6174 6567 6f72 7920         category 
-0004bba0: 3d20 2264 6174 6162 6173 6520 6163 636f  = "database acco
-0004bbb0: 756e 7422 2069 6620 636f 6e74 6163 745b  unt" if contact[
-0004bbc0: 2269 6465 6e74 6974 7922 5d20 3d3d 2073  "identity"] == s
-0004bbd0: 656c 662e 6462 2e69 6420 656c 7365 2022  elf.db.id else "
-0004bbe0: 636f 6e74 6163 7422 0d0a 2020 2020 2020  contact"..      
-0004bbf0: 2020 6966 2063 6f6e 7461 6374 2021 3d20    if contact != 
-0004bc00: 7365 6c66 2e63 6f6e 7461 6374 3a0d 0a20  self.contact:.. 
-0004bc10: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
-0004bc20: 722e 696e 666f 2822 4f70 656e 696e 6720  r.info("Opening 
-0004bc30: 2573 2025 732e 222c 2063 6174 6567 6f72  %s %s.", categor
-0004bc40: 792c 2063 6f6e 7461 6374 5b22 6e61 6d65  y, contact["name
-0004bc50: 225d 290d 0a20 2020 2020 2020 2063 6c69  "])..        cli
-0004bc60: 7374 2e46 7265 657a 6528 290d 0a20 2020  st.Freeze()..   
-0004bc70: 2020 2020 2073 6372 6f6c 6c70 6f73 203d       scrollpos =
-0004bc80: 2063 6c69 7374 2e47 6574 5363 726f 6c6c   clist.GetScroll
-0004bc90: 506f 7328 7778 2e56 4552 5449 4341 4c29  Pos(wx.VERTICAL)
-0004bca0: 0d0a 2020 2020 2020 2020 696e 6465 785f  ..        index_
-0004bcb0: 7365 6c65 6374 6564 203d 202d 310d 0a20  selected = -1.. 
-0004bcc0: 2020 2020 2020 2066 6f72 2069 2069 6e20         for i in 
-0004bcd0: 7261 6e67 6528 636c 6973 742e 4974 656d  range(clist.Item
-0004bce0: 436f 756e 7429 3a0d 0a20 2020 2020 2020  Count):..       
-0004bcf0: 2020 2020 206d 7969 6420 3d20 636c 6973       myid = clis
-0004bd00: 742e 4765 7449 7465 6d4d 6170 7065 6444  t.GetItemMappedD
-0004bd10: 6174 6128 6929 5b22 6964 225d 0d0a 2020  ata(i)["id"]..  
-0004bd20: 2020 2020 2020 2020 2020 6966 206d 7969            if myi
-0004bd30: 6420 3d3d 2063 6f6e 7461 6374 5b22 6964  d == contact["id
-0004bd40: 225d 3a0d 0a20 2020 2020 2020 2020 2020  "]:..           
-0004bd50: 2020 2020 2069 6e64 6578 5f73 656c 6563       index_selec
-0004bd60: 7465 6420 3d20 690d 0a20 2020 2020 2020  ted = i..       
-0004bd70: 2020 2020 2020 2020 2066 203d 2063 6c69           f = cli
-0004bd80: 7374 2e46 6f6e 743b 2066 2e53 6574 5765  st.Font; f.SetWe
-0004bd90: 6967 6874 2877 782e 464f 4e54 5745 4947  ight(wx.FONTWEIG
-0004bda0: 4854 5f42 4f4c 4429 0d0a 2020 2020 2020  HT_BOLD)..      
-0004bdb0: 2020 2020 2020 2020 2020 636c 6973 742e            clist.
-0004bdc0: 5365 7449 7465 6d46 6f6e 7428 692c 2066  SetItemFont(i, f
-0004bdd0: 290d 0a20 2020 2020 2020 2020 2020 2065  )..            e
-0004bde0: 6c69 6620 7365 6c66 2e63 6f6e 7461 6374  lif self.contact
-0004bdf0: 2061 6e64 206d 7969 6420 3d3d 2073 656c   and myid == sel
-0004be00: 662e 636f 6e74 6163 745b 2269 6422 5d3a  f.contact["id"]:
-0004be10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004be20: 2020 636c 6973 742e 5365 7449 7465 6d46    clist.SetItemF
-0004be30: 6f6e 7428 692c 2063 6c69 7374 2e46 6f6e  ont(i, clist.Fon
-0004be40: 7429 0d0a 2020 2020 2020 2020 6966 2069  t)..        if i
-0004be50: 6e64 6578 5f73 656c 6563 7465 6420 3e3d  ndex_selected >=
-0004be60: 2030 3a0d 0a20 2020 2020 2020 2020 2020   0:..           
-0004be70: 2064 656c 7461 203d 2069 6e64 6578 5f73   delta = index_s
-0004be80: 656c 6563 7465 6420 2d20 7363 726f 6c6c  elected - scroll
-0004be90: 706f 730d 0a20 2020 2020 2020 2020 2020  pos..           
-0004bea0: 2069 6620 6465 6c74 6120 3c20 3020 6f72   if delta < 0 or
-0004beb0: 2061 6273 2864 656c 7461 2920 3e3d 2063   abs(delta) >= c
-0004bec0: 6c69 7374 2e43 6f75 6e74 5065 7250 6167  list.CountPerPag
-0004bed0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-0004bee0: 2020 2020 6e75 6467 6520 3d20 2d63 6c69      nudge = -cli
-0004bef0: 7374 2e43 6f75 6e74 5065 7250 6167 6520  st.CountPerPage 
-0004bf00: 2f2f 2032 0d0a 2020 2020 2020 2020 2020  // 2..          
-0004bf10: 2020 2020 2020 636c 6973 742e 5363 726f        clist.Scro
-0004bf20: 6c6c 4c69 6e65 7328 6465 6c74 6120 2b20  llLines(delta + 
-0004bf30: 6e75 6467 6529 0d0a 2020 2020 2020 2020  nudge)..        
-0004bf40: 636c 6973 742e 5468 6177 2829 0d0a 2020  clist.Thaw()..  
-0004bf50: 2020 2020 2020 7778 2e59 6965 6c64 4966        wx.YieldIf
-0004bf60: 4e65 6564 6564 2829 2023 2041 6c6c 6f77  Needed() # Allow
-0004bf70: 2064 6973 706c 6179 2074 6f20 7265 6672   display to refr
-0004bf80: 6573 680d 0a20 2020 2020 2020 2070 7265  esh..        pre
-0004bf90: 6669 7820 3d20 2244 6174 6162 6173 6520  fix = "Database 
-0004bfa0: 6126 6363 6f75 6e74 2220 6966 2063 6f6e  a&ccount" if con
-0004bfb0: 7461 6374 5b22 6964 656e 7469 7479 225d  tact["identity"]
-0004bfc0: 203d 3d20 7365 6c66 2e64 622e 6964 2065   == self.db.id e
-0004bfd0: 6c73 6520 2226 436f 6e74 6163 7422 0d0a  lse "&Contact"..
-0004bfe0: 2020 2020 2020 2020 7365 6c66 2e62 7574          self.but
-0004bff0: 746f 6e5f 6578 706f 7274 5f63 6f6e 7461  ton_export_conta
-0004c000: 6374 5f63 6861 7473 2e4c 6162 656c 203d  ct_chats.Label =
-0004c010: 2022 2645 7870 6f72 7420 2573 2063 6861   "&Export %s cha
-0004c020: 7473 2220 2520 6361 7465 676f 7279 2e73  ts" % category.s
-0004c030: 706c 6974 2829 5b2d 315d 0d0a 2020 2020  plit()[-1]..    
-0004c040: 2020 2020 7365 6c66 2e62 7574 746f 6e5f      self.button_
-0004c050: 6578 706f 7274 5f63 6f6e 7461 6374 5f63  export_contact_c
-0004c060: 6861 7473 2e45 6e61 626c 6564 203d 2062  hats.Enabled = b
-0004c070: 6f6f 6c28 636f 6e74 6163 742e 6765 7428  ool(contact.get(
-0004c080: 2263 6f6e 7665 7273 6174 696f 6e73 222c  "conversations",
-0004c090: 205b 5d29 290d 0a20 2020 2020 2020 2073   []))..        s
-0004c0a0: 656c 662e 6c61 6265 6c5f 636f 6e74 6163  elf.label_contac
-0004c0b0: 742e 4c61 6265 6c20 3d20 7072 6566 6978  t.Label = prefix
-0004c0c0: 202b 2022 2025 286e 616d 6529 7320 2825   + " %(name)s (%
-0004c0d0: 2869 6465 6e74 6974 7929 7329 3a22 2025  (identity)s):" %
-0004c0e0: 2063 6f6e 7461 6374 0d0a 2020 2020 2020   contact..      
-0004c0f0: 2020 7365 6c66 2e6c 6162 656c 5f63 6f6e    self.label_con
-0004c100: 7461 6374 2e50 6172 656e 742e 4c61 796f  tact.Parent.Layo
-0004c110: 7574 2829 0d0a 0d0a 2020 2020 2020 2020  ut()....        
-0004c120: 7469 746c 656d 6170 203d 207b 785b 2269  titlemap = {x["i
-0004c130: 6422 5d3a 2078 5b22 7469 746c 655f 6c6f  d"]: x["title_lo
-0004c140: 6e67 225d 2066 6f72 2078 2069 6e20 7365  ng"] for x in se
-0004c150: 6c66 2e63 6861 7473 7d0d 0a20 2020 2020  lf.chats}..     
-0004c160: 2020 2066 6f72 2064 6174 6120 696e 2063     for data in c
-0004c170: 6f6e 7461 6374 2e67 6574 2822 636f 6e76  ontact.get("conv
-0004c180: 6572 7361 7469 6f6e 7322 2c20 5b5d 293a  ersations", []):
-0004c190: 0d0a 2020 2020 2020 2020 2020 2020 6461  ..            da
-0004c1a0: 7461 5b22 7469 746c 655f 6c6f 6e67 225d  ta["title_long"]
-0004c1b0: 203d 2074 6974 6c65 6d61 705b 6461 7461   = titlemap[data
-0004c1c0: 5b22 6964 225d 5d0d 0a20 2020 2020 2020  ["id"]]..       
-0004c1d0: 204d 494e 5320 3d20 7b22 6d65 7373 6167   MINS = {"messag
-0004c1e0: 655f 636f 756e 7422 3a20 2d73 7973 2e6d  e_count": -sys.m
-0004c1f0: 6178 7369 7a65 2c20 2272 6174 696f 223a  axsize, "ratio":
-0004c200: 202d 7379 732e 6d61 7873 697a 652c 0d0a   -sys.maxsize,..
-0004c210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c220: 2266 6972 7374 5f6d 6573 7361 6765 5f64  "first_message_d
-0004c230: 6174 6574 696d 6522 3a20 6461 7465 7469  atetime": dateti
-0004c240: 6d65 2e64 6174 6574 696d 652e 6d69 6e2c  me.datetime.min,
-0004c250: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004c260: 2020 226c 6173 745f 6d65 7373 6167 655f    "last_message_
-0004c270: 6461 7465 7469 6d65 223a 2064 6174 6574  datetime": datet
-0004c280: 696d 652e 6461 7465 7469 6d65 2e6d 696e  ime.datetime.min
-0004c290: 7d0d 0a20 2020 2020 2020 2073 6f72 746b  }..        sortk
-0004c2a0: 6579 203d 206c 616d 6264 6120 783a 2075  ey = lambda x: u
-0004c2b0: 7469 6c2e 636f 616c 6573 6365 2878 5b73  til.coalesce(x[s
-0004c2c0: 656c 662e 636f 6e74 6163 745f 736f 7274  elf.contact_sort
-0004c2d0: 5f66 6965 6c64 5d2c 204d 494e 532e 6765  _field], MINS.ge
-0004c2e0: 7428 7365 6c66 2e63 6f6e 7461 6374 5f73  t(self.contact_s
-0004c2f0: 6f72 745f 6669 656c 642c 2022 2229 290d  ort_field, "")).
-0004c300: 0a20 2020 2020 2020 2063 6f6e 7461 6374  .        contact
-0004c310: 2e67 6574 2822 636f 6e76 6572 7361 7469  .get("conversati
-0004c320: 6f6e 7322 2c20 5b5d 292e 736f 7274 286b  ons", []).sort(k
-0004c330: 6579 3d73 6f72 746b 6579 2c20 7265 7665  ey=sortkey, reve
-0004c340: 7273 653d 5472 7565 290d 0a0d 0a20 2020  rse=True)....   
-0004c350: 2020 2020 2061 7661 7461 725f 7061 7468       avatar_path
-0004c360: 2c20 6176 6174 6172 5f73 697a 652c 2061  , avatar_size, a
-0004c370: 7661 7461 725f 7261 7720 3d20 4e6f 6e65  vatar_raw = None
-0004c380: 2c20 4e6f 6e65 2c20 736b 7970 6564 6174  , None, skypedat
-0004c390: 612e 6765 745f 6176 6174 6172 5f72 6177  a.get_avatar_raw
-0004c3a0: 2863 6f6e 7461 6374 290d 0a20 2020 2020  (contact)..     
-0004c3b0: 2020 2069 6620 736b 7970 6564 6174 612e     if skypedata.
-0004c3c0: 6765 745f 6176 6174 6172 5f64 6174 6128  get_avatar_data(
-0004c3d0: 636f 6e74 6163 7429 3a0d 0a20 2020 2020  contact):..     
-0004c3e0: 2020 2020 2020 2069 6d67 6b65 7920 3d20         imgkey = 
-0004c3f0: 2822 6176 6174 6172 222c 2063 6f6e 7461  ("avatar", conta
-0004c400: 6374 5b22 6964 225d 290d 0a20 2020 2020  ct["id"])..     
-0004c410: 2020 2020 2020 2069 6d67 203d 2073 656c         img = sel
-0004c420: 662e 696d 6167 6563 6163 6865 2e67 6574  f.imagecache.get
-0004c430: 2869 6d67 6b65 7929 206f 7220 736b 7970  (imgkey) or skyp
-0004c440: 6564 6174 612e 6765 745f 6176 6174 6172  edata.get_avatar
-0004c450: 2863 6f6e 7461 6374 290d 0a20 2020 2020  (contact)..     
-0004c460: 2020 2020 2020 2065 7874 203d 206e 6578         ext = nex
-0004c470: 7428 286b 2066 6f72 206b 2c20 7620 696e  t((k for k, v in
-0004c480: 2065 7870 6f72 742e 494d 4147 455f 464f   export.IMAGE_FO
-0004c490: 524d 4154 532e 6974 656d 7328 2920 6966  RMATS.items() if
-0004c4a0: 2069 6d67 2061 6e64 2076 203d 3d20 696d   img and v == im
-0004c4b0: 672e 5479 7065 292c 2022 6a70 6722 290d  g.Type), "jpg").
-0004c4c0: 0a20 2020 2020 2020 2020 2020 2076 616c  .            val
-0004c4d0: 7320 3d20 2863 6f6e 7461 6374 5b22 6964  s = (contact["id
-0004c4e0: 656e 7469 7479 225d 2c20 7365 6c66 2e64  entity"], self.d
-0004c4f0: 622e 6669 6c65 6e61 6d65 2e65 6e63 6f64  b.filename.encod
-0004c500: 6528 2275 7466 2d38 2229 2c20 6578 7429  e("utf-8"), ext)
-0004c510: 0d0a 2020 2020 2020 2020 2020 2020 666e  ..            fn
-0004c520: 203d 2022 2573 5f25 735f 6675 6c6c 7369   = "%s_%s_fullsi
-0004c530: 7a65 2e25 7322 2025 2074 7570 6c65 286d  ze.%s" % tuple(m
-0004c540: 6170 2875 726c 6c69 622e 7061 7273 652e  ap(urllib.parse.
-0004c550: 7175 6f74 652c 2076 616c 7329 290d 0a20  quote, vals)).. 
-0004c560: 2020 2020 2020 2020 2020 2069 6620 696d             if im
-0004c570: 6720 616e 6420 666e 206e 6f74 2069 6e20  g and fn not in 
-0004c580: 7365 6c66 2e6d 656d 6f72 7966 735b 2266  self.memoryfs["f
-0004c590: 696c 6573 225d 3a0d 0a20 2020 2020 2020  iles"]:..       
-0004c5a0: 2020 2020 2020 2020 2073 656c 662e 6d65           self.me
-0004c5b0: 6d6f 7279 6673 5b22 6861 6e64 6c65 7222  moryfs["handler"
-0004c5c0: 5d2e 4164 6446 696c 6528 666e 2c20 696d  ].AddFile(fn, im
-0004c5d0: 672c 2069 6d67 2e54 7970 6529 0d0a 2020  g, img.Type)..  
-0004c5e0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0004c5f0: 6c66 2e6d 656d 6f72 7966 735b 2266 696c  lf.memoryfs["fil
-0004c600: 6573 225d 5b66 6e5d 203d 2031 0d0a 2020  es"][fn] = 1..  
-0004c610: 2020 2020 2020 2020 2020 6966 2066 6e20            if fn 
-0004c620: 696e 2073 656c 662e 6d65 6d6f 7279 6673  in self.memoryfs
-0004c630: 5b22 6669 6c65 7322 5d3a 0d0a 2020 2020  ["files"]:..    
-0004c640: 2020 2020 2020 2020 2020 2020 6176 6174              avat
-0004c650: 6172 5f70 6174 6820 3d20 666e 0d0a 2020  ar_path = fn..  
-0004c660: 2020 2020 2020 2020 2020 6966 2069 6d67            if img
-0004c670: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0004c680: 2020 2073 656c 662e 696d 6167 6563 6163     self.imagecac
-0004c690: 6865 5b69 6d67 6b65 795d 203d 2069 6d67  he[imgkey] = img
-0004c6a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004c6b0: 2020 6176 6174 6172 5f73 697a 6520 3d20    avatar_size = 
-0004c6c0: 7475 706c 6528 696d 672e 4765 7453 697a  tuple(img.GetSiz
-0004c6d0: 6528 2929 0d0a 2020 2020 2020 2020 2020  e())..          
-0004c6e0: 2020 6465 6661 756c 7461 7661 7461 7220    defaultavatar 
-0004c6f0: 3d20 2261 7661 7461 725f 5f64 6566 6175  = "avatar__defau
-0004c700: 6c74 5f5f 6c61 7267 652e 706e 6722 0d0a  lt__large.png"..
-0004c710: 2020 2020 2020 2020 2020 2020 6966 2064              if d
-0004c720: 6566 6175 6c74 6176 6174 6172 206e 6f74  efaultavatar not
-0004c730: 2069 6e20 7365 6c66 2e6d 656d 6f72 7966   in self.memoryf
-0004c740: 735b 2266 696c 6573 225d 3a0d 0a20 2020  s["files"]:..   
-0004c750: 2020 2020 2020 2020 2020 2020 2069 6d67               img
-0004c760: 203d 2069 6d61 6765 732e 4176 6174 6172   = images.Avatar
-0004c770: 4465 6661 756c 744c 6172 6765 2e49 6d61  DefaultLarge.Ima
-0004c780: 6765 0d0a 2020 2020 2020 2020 2020 2020  ge..            
-0004c790: 2020 2020 7365 6c66 2e6d 656d 6f72 7966      self.memoryf
-0004c7a0: 735b 2268 616e 646c 6572 225d 2e41 6464  s["handler"].Add
-0004c7b0: 4669 6c65 2864 6566 6175 6c74 6176 6174  File(defaultavat
-0004c7c0: 6172 2c20 696d 672c 2077 782e 4249 544d  ar, img, wx.BITM
-0004c7d0: 4150 5f54 5950 455f 504e 4729 0d0a 2020  AP_TYPE_PNG)..  
-0004c7e0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0004c7f0: 6c66 2e6d 656d 6f72 7966 735b 2266 696c  lf.memoryfs["fil
-0004c800: 6573 225d 5b64 6566 6175 6c74 6176 6174  es"][defaultavat
-0004c810: 6172 5d20 3d20 310d 0a0d 0a20 2020 2020  ar] = 1....     
-0004c820: 2020 2064 6174 6120 3d20 7b22 636f 6e74     data = {"cont
-0004c830: 6163 7422 3a20 636f 6e74 6163 742c 2022  act": contact, "
-0004c840: 6176 6174 6172 223a 2061 7661 7461 725f  avatar": avatar_
-0004c850: 7061 7468 2c20 2261 7661 7461 725f 7369  path, "avatar_si
-0004c860: 7a65 223a 2061 7661 7461 725f 7369 7a65  ze": avatar_size
-0004c870: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0004c880: 2020 2022 6462 223a 2073 656c 662e 6462     "db": self.db
-0004c890: 2c20 2273 6f72 745f 6279 223a 2073 656c  , "sort_by": sel
-0004c8a0: 662e 636f 6e74 6163 745f 736f 7274 5f66  f.contact_sort_f
-0004c8b0: 6965 6c64 7d0d 0a20 2020 2020 2020 2068  ield}..        h
-0004c8c0: 746d 6c20 3d20 7374 6570 2e54 656d 706c  tml = step.Templ
-0004c8d0: 6174 6528 7465 6d70 6c61 7465 732e 434f  ate(templates.CO
-0004c8e0: 4e54 4143 545f 4854 4d4c 2c20 6573 6361  NTACT_HTML, esca
-0004c8f0: 7065 3d54 7275 6529 2e65 7870 616e 6428  pe=True).expand(
-0004c900: 6461 7461 290d 0a20 2020 2020 2020 2073  data)..        s
-0004c910: 6372 6f6c 6c70 6f73 203d 205b 7365 6c66  crollpos = [self
-0004c920: 2e68 746d 6c5f 636f 6e74 6163 742e 4765  .html_contact.Ge
-0004c930: 7453 6372 6f6c 6c50 6f73 2878 2920 666f  tScrollPos(x) fo
-0004c940: 7220 7820 696e 2028 7778 2e48 4f52 495a  r x in (wx.HORIZ
-0004c950: 4f4e 5441 4c2c 2077 782e 5645 5254 4943  ONTAL, wx.VERTIC
-0004c960: 414c 295d 0d0a 2020 2020 2020 2020 7365  AL)]..        se
-0004c970: 6c66 2e68 746d 6c5f 636f 6e74 6163 742e  lf.html_contact.
-0004c980: 5365 7450 6167 6528 6874 6d6c 290d 0a20  SetPage(html).. 
-0004c990: 2020 2020 2020 2073 656c 662e 6874 6d6c         self.html
-0004c9a0: 5f63 6f6e 7461 6374 2e53 6372 6f6c 6c28  _contact.Scroll(
-0004c9b0: 2a73 6372 6f6c 6c70 6f73 290d 0a20 2020  *scrollpos)..   
-0004c9c0: 2020 2020 2073 656c 662e 6874 6d6c 5f63       self.html_c
-0004c9d0: 6f6e 7461 6374 2e42 6163 6b67 726f 756e  ontact.Backgroun
-0004c9e0: 6443 6f6c 6f75 7220 3d20 436f 6c6f 7572  dColour = Colour
-0004c9f0: 4d61 6e61 6765 722e 4765 7443 6f6c 6f75  Manager.GetColou
-0004ca00: 7228 7778 2e53 5953 5f43 4f4c 4f55 525f  r(wx.SYS_COLOUR_
-0004ca10: 5749 4e44 4f57 290d 0a20 2020 2020 2020  WINDOW)..       
-0004ca20: 2073 656c 662e 6874 6d6c 5f63 6f6e 7461   self.html_conta
-0004ca30: 6374 2e50 6172 656e 742e 456e 6162 6c65  ct.Parent.Enable
-0004ca40: 2829 0d0a 2020 2020 2020 2020 7365 6c66  ()..        self
-0004ca50: 2e68 746d 6c5f 636f 6e74 6163 742e 5061  .html_contact.Pa
-0004ca60: 7265 6e74 2e4c 6179 6f75 7428 290d 0a20  rent.Layout().. 
-0004ca70: 2020 2020 2020 2073 656c 662e 636f 6e74         self.cont
-0004ca80: 6163 7420 3d20 636f 6e74 6163 740d 0a20  act = contact.. 
-0004ca90: 2020 2020 2020 2069 6620 6275 7379 3a0d         if busy:.
-0004caa0: 0a20 2020 2020 2020 2020 2020 2062 7573  .            bus
-0004cab0: 792e 436c 6f73 6528 290d 0a0d 0a0d 0a20  y.Close()...... 
-0004cac0: 2020 2064 6566 2070 6f70 756c 6174 655f     def populate_
-0004cad0: 6368 6174 5f73 7461 7469 7374 6963 7328  chat_statistics(
-0004cae0: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
-0004caf0: 2222 2250 6f70 756c 6174 6573 2068 746d  """Populates htm
-0004cb00: 6c5f 7374 6174 7320 7769 7468 2063 6861  l_stats with cha
-0004cb10: 7420 7374 6174 6973 7469 6373 2061 6e64  t statistics and
-0004cb20: 2077 6f72 6420 636c 6f75 642e 2222 220d   word cloud.""".
-0004cb30: 0a20 2020 2020 2020 2073 7461 7473 2c20  .        stats, 
-0004cb40: 6874 6d6c 203d 2073 656c 662e 7374 635f  html = self.stc_
-0004cb50: 6869 7374 6f72 792e 4765 7453 7461 7469  history.GetStati
-0004cb60: 7374 6963 7344 6174 6128 292c 2022 220d  sticsData(), "".
-0004cb70: 0a20 2020 2020 2020 2069 6620 7374 6174  .        if stat
-0004cb80: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
-0004cb90: 6461 7461 203d 207b 2264 6222 3a20 7365  data = {"db": se
-0004cba0: 6c66 2e64 622c 2022 7061 7274 6963 6970  lf.db, "particip
-0004cbb0: 616e 7473 223a 205b 5d2c 0d0a 2020 2020  ants": [],..    
-0004cbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004cbd0: 2263 6861 7422 3a20 7365 6c66 2e63 6861  "chat": self.cha
-0004cbe0: 742c 2022 736f 7274 5f62 7922 3a20 7365  t, "sort_by": se
-0004cbf0: 6c66 2e73 7461 7473 5f73 6f72 745f 6669  lf.stats_sort_fi
-0004cc00: 656c 642c 0d0a 2020 2020 2020 2020 2020  eld,..          
-0004cc10: 2020 2020 2020 2020 2020 2263 6861 745f            "chat_
-0004cc20: 696d 6167 6522 3a20 4e6f 6e65 2c20 2263  image": None, "c
-0004cc30: 6861 745f 696d 6167 655f 7369 7a65 223a  hat_image_size":
-0004cc40: 204e 6f6e 652c 0d0a 2020 2020 2020 2020   None,..        
-0004cc50: 2020 2020 2020 2020 2020 2020 2273 7461              "sta
-0004cc60: 7473 223a 2073 7461 7473 2c20 2269 6d61  ts": stats, "ima
-0004cc70: 6765 7322 3a20 7b7d 2c20 2261 7574 686f  ges": {}, "autho
-0004cc80: 7269 6d61 6765 7322 3a20 7b7d 2c0d 0a20  rimages": {},.. 
-0004cc90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004cca0: 2020 2022 696d 6167 656d 6170 7322 3a20     "imagemaps": 
-0004ccb0: 7b7d 2c20 2261 7574 686f 7269 6d61 6765  {}, "authorimage
-0004ccc0: 6d61 7073 223a 207b 7d2c 0d0a 2020 2020  maps": {},..    
-0004ccd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004cce0: 2265 7870 616e 6422 3a20 7365 6c66 2e73  "expand": self.s
-0004ccf0: 7461 7473 5f65 7870 616e 647d 0d0a 2020  tats_expand}..  
-0004cd00: 2020 2020 2020 2020 2020 2320 4669 6c6c            # Fill
-0004cd10: 2061 7661 7461 7220 696d 6167 6573 0d0a   avatar images..
-0004cd20: 2020 2020 2020 2020 2020 2020 6673 2c20              fs, 
-0004cd30: 6465 6661 756c 7461 7661 7461 7220 3d20  defaultavatar = 
-0004cd40: 7365 6c66 2e6d 656d 6f72 7966 732c 2022  self.memoryfs, "
-0004cd50: 6176 6174 6172 5f5f 6465 6661 756c 742e  avatar__default.
-0004cd60: 706e 6722 0d0a 2020 2020 2020 2020 2020  png"..          
-0004cd70: 2020 6966 2064 6566 6175 6c74 6176 6174    if defaultavat
-0004cd80: 6172 206e 6f74 2069 6e20 6673 5b22 6669  ar not in fs["fi
-0004cd90: 6c65 7322 5d3a 0d0a 2020 2020 2020 2020  les"]:..        
-0004cda0: 2020 2020 2020 2020 696d 6720 3d20 696d          img = im
-0004cdb0: 6167 6573 2e41 7661 7461 7244 6566 6175  ages.AvatarDefau
-0004cdc0: 6c74 2e49 6d61 6765 0d0a 2020 2020 2020  lt.Image..      
-0004cdd0: 2020 2020 2020 2020 2020 6673 5b22 6861            fs["ha
-0004cde0: 6e64 6c65 7222 5d2e 4164 6446 696c 6528  ndler"].AddFile(
-0004cdf0: 6465 6661 756c 7461 7661 7461 722c 2069  defaultavatar, i
-0004ce00: 6d67 2c20 7778 2e42 4954 4d41 505f 5459  mg, wx.BITMAP_TY
-0004ce10: 5045 5f50 4e47 290d 0a20 2020 2020 2020  PE_PNG)..       
-0004ce20: 2020 2020 2020 2020 2066 735b 2266 696c           fs["fil
-0004ce30: 6573 225d 5b64 6566 6175 6c74 6176 6174  es"][defaultavat
-0004ce40: 6172 5d20 3d20 310d 0a20 2020 2020 2020  ar] = 1..       
-0004ce50: 2020 2020 2063 6f6e 7461 6374 7320 3d20       contacts = 
-0004ce60: 6469 6374 2828 635b 2273 6b79 7065 6e61  dict((c["skypena
-0004ce70: 6d65 225d 2c20 6329 2066 6f72 2063 2069  me"], c) for c i
-0004ce80: 6e20 7365 6c66 2e64 622e 6765 745f 636f  n self.db.get_co
-0004ce90: 6e74 6163 7473 2829 290d 0a20 2020 2020  ntacts())..     
-0004cea0: 2020 2020 2020 2070 6172 7469 6373 203d         partics =
-0004ceb0: 2064 6963 7428 2870 5b22 6964 656e 7469   dict((p["identi
-0004cec0: 7479 225d 2c20 7029 2066 6f72 2070 2069  ty"], p) for p i
-0004ced0: 6e20 7365 6c66 2e63 6861 745b 2270 6172  n self.chat["par
-0004cee0: 7469 6369 7061 6e74 7322 5d29 0d0a 2020  ticipants"])..  
-0004cef0: 2020 2020 2020 2020 2020 2320 5468 6572            # Ther
-0004cf00: 6520 6361 6e20 6265 2061 7574 686f 7273  e can be authors
-0004cf10: 206e 6f74 2061 6d6f 6e67 2070 6172 7469   not among parti
-0004cf20: 6369 7061 6e74 732c 2061 6e64 2076 6963  cipants, and vic
-0004cf30: 6520 7665 7273 610d 0a20 2020 2020 2020  e versa..       
-0004cf40: 2020 2020 2066 6f72 2061 7574 686f 7220       for author 
-0004cf50: 696e 2073 7461 7473 5b22 6175 7468 6f72  in stats["author
-0004cf60: 7322 5d2e 756e 696f 6e28 7061 7274 6963  s"].union(partic
-0004cf70: 7329 3a0d 0a20 2020 2020 2020 2020 2020  s):..           
-0004cf80: 2020 2020 2063 6f6e 7461 6374 203d 2070       contact = p
-0004cf90: 6172 7469 6373 2e67 6574 2861 7574 686f  artics.get(autho
-0004cfa0: 722c 207b 7d29 2e67 6574 2822 636f 6e74  r, {}).get("cont
-0004cfb0: 6163 7422 290d 0a20 2020 2020 2020 2020  act")..         
-0004cfc0: 2020 2020 2020 2063 6f6e 7461 6374 203d         contact =
-0004cfd0: 2063 6f6e 7461 6374 206f 7220 636f 6e74   contact or cont
-0004cfe0: 6163 7473 2e67 6574 2861 7574 686f 722c  acts.get(author,
-0004cff0: 207b 7d29 0d0a 2020 2020 2020 2020 2020   {})..          
-0004d000: 2020 2020 2020 636f 6e74 6163 7420 3d20        contact = 
-0004d010: 636f 6e74 6163 7420 6f72 207b 2269 6465  contact or {"ide
-0004d020: 6e74 6974 7922 3a20 6175 7468 6f72 2c20  ntity": author, 
-0004d030: 226e 616d 6522 3a20 6175 7468 6f72 7d0d  "name": author}.
-0004d040: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004d050: 2069 6620 2261 7661 7461 725f 6269 746d   if "avatar_bitm
-0004d060: 6170 2220 696e 2063 6f6e 7461 6374 3a0d  ap" in contact:.
-0004d070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004d080: 2020 2020 2076 616c 7320 3d20 2861 7574       vals = (aut
-0004d090: 686f 722c 2073 656c 662e 6462 2e66 696c  hor, self.db.fil
-0004d0a0: 656e 616d 652e 656e 636f 6465 2822 7574  ename.encode("ut
-0004d0b0: 662d 3822 2929 0d0a 2020 2020 2020 2020  f-8"))..        
-0004d0c0: 2020 2020 2020 2020 2020 2020 666e 203d              fn =
-0004d0d0: 2022 2573 5f25 732e 626d 7022 2025 2074   "%s_%s.bmp" % t
-0004d0e0: 7570 6c65 286d 6170 2875 726c 6c69 622e  uple(map(urllib.
-0004d0f0: 7061 7273 652e 7175 6f74 652c 2076 616c  parse.quote, val
-0004d100: 7329 290d 0a20 2020 2020 2020 2020 2020  s))..           
-0004d110: 2020 2020 2020 2020 2069 6620 666e 206e           if fn n
-0004d120: 6f74 2069 6e20 6673 5b22 6669 6c65 7322  ot in fs["files"
-0004d130: 5d3a 0d0a 2020 2020 2020 2020 2020 2020  ]:..            
-0004d140: 2020 2020 2020 2020 2020 2020 626d 7020              bmp 
-0004d150: 3d20 636f 6e74 6163 745b 2261 7661 7461  = contact["avata
-0004d160: 725f 6269 746d 6170 225d 0d0a 2020 2020  r_bitmap"]..    
-0004d170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d180: 2020 2020 6673 5b22 6861 6e64 6c65 7222      fs["handler"
-0004d190: 5d2e 4164 6446 696c 6528 666e 2c20 626d  ].AddFile(fn, bm
-0004d1a0: 702c 2077 782e 4249 544d 4150 5f54 5950  p, wx.BITMAP_TYP
-0004d1b0: 455f 424d 5029 0d0a 2020 2020 2020 2020  E_BMP)..        
-0004d1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d1d0: 6673 5b22 6669 6c65 7322 5d5b 666e 5d20  fs["files"][fn] 
-0004d1e0: 3d20 310d 0a20 2020 2020 2020 2020 2020  = 1..           
-0004d1f0: 2020 2020 2020 2020 2064 6174 615b 2261           data["a
-0004d200: 7574 686f 7269 6d61 6765 7322 5d5b 6175  uthorimages"][au
-0004d210: 7468 6f72 5d20 3d20 7b22 6176 6174 6172  thor] = {"avatar
-0004d220: 223a 2066 6e7d 0d0a 2020 2020 2020 2020  ": fn}..        
-0004d230: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-0004d240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d250: 2020 2064 6174 615b 2261 7574 686f 7269     data["authori
-0004d260: 6d61 6765 7322 5d5b 6175 7468 6f72 5d20  mages"][author] 
-0004d270: 3d20 7b22 6176 6174 6172 223a 2064 6566  = {"avatar": def
-0004d280: 6175 6c74 6176 6174 6172 7d0d 0a20 2020  aultavatar}..   
-0004d290: 2020 2020 2020 2020 2020 2020 2064 6174               dat
-0004d2a0: 615b 2270 6172 7469 6369 7061 6e74 7322  a["participants"
-0004d2b0: 5d2e 6170 7065 6e64 2863 6f6e 7461 6374  ].append(contact
-0004d2c0: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
-0004d2d0: 2023 2046 696c 6c20 6368 6174 2074 6f74   # Fill chat tot
-0004d2e0: 616c 2068 6973 746f 6772 616d 2070 6c6f  al histogram plo
-0004d2f0: 7420 696d 6167 6573 0d0a 2020 2020 2020  t images..      
-0004d300: 2020 2020 2020 504c 4f54 434f 4e46 203d        PLOTCONF =
-0004d310: 207b 2264 6179 7322 3a20 2863 6f6e 662e   {"days": (conf.
-0004d320: 506c 6f74 4461 7973 556e 6974 5369 7a65  PlotDaysUnitSize
-0004d330: 2c20 636f 6e66 2e50 6c6f 7444 6179 7343  , conf.PlotDaysC
-0004d340: 6f6c 6f75 722c 0d0a 2020 2020 2020 2020  olour,..        
-0004d350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d360: 2020 2020 2020 2020 206d 6178 2873 7461           max(sta
-0004d370: 7473 5b22 746f 7461 6c68 6973 7422 5d5b  ts["totalhist"][
-0004d380: 2264 6179 7322 5d2e 7661 6c75 6573 2829  "days"].values()
-0004d390: 2929 2c0d 0a20 2020 2020 2020 2020 2020  )),..           
-0004d3a0: 2020 2020 2020 2020 2020 2020 2022 686f               "ho
-0004d3b0: 7572 7322 3a20 2863 6f6e 662e 506c 6f74  urs": (conf.Plot
-0004d3c0: 486f 7572 7355 6e69 7453 697a 652c 2063  HoursUnitSize, c
-0004d3d0: 6f6e 662e 506c 6f74 486f 7572 7343 6f6c  onf.PlotHoursCol
-0004d3e0: 6f75 722c 0d0a 2020 2020 2020 2020 2020  our,..          
-0004d3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d400: 2020 2020 2020 2020 6d61 7828 7374 6174          max(stat
-0004d410: 735b 2274 6f74 616c 6869 7374 225d 5b22  s["totalhist"]["
-0004d420: 686f 7572 7322 5d2e 7661 6c75 6573 2829  hours"].values()
-0004d430: 2929 2c0d 0a20 2020 2020 2020 2020 2020  )),..           
-0004d440: 2020 2020 2020 2020 2020 2020 7d20 6966              } if
-0004d450: 2073 7461 7473 5b22 6869 7374 7322 5d20   stats["hists"] 
-0004d460: 656c 7365 207b 7d0d 0a20 2020 2020 2020  else {}..       
-0004d470: 2020 2020 2066 6f72 2068 6973 7474 7970       for histtyp
-0004d480: 652c 2068 6973 7464 6174 6120 696e 2073  e, histdata in s
-0004d490: 7461 7473 5b22 746f 7461 6c68 6973 7422  tats["totalhist"
-0004d4a0: 5d2e 6974 656d 7328 293a 0d0a 2020 2020  ].items():..    
-0004d4b0: 2020 2020 2020 2020 2020 2020 6966 2068              if h
-0004d4c0: 6973 7474 7970 6520 6e6f 7420 696e 2028  isttype not in (
-0004d4d0: 2268 6f75 7273 222c 2022 6461 7973 2229  "hours", "days")
-0004d4e0: 3a20 636f 6e74 696e 7565 2023 2066 6f72  : continue # for
-0004d4f0: 2068 6973 7474 7970 652e 2e0d 0a20 2020   histtype....   
-0004d500: 2020 2020 2020 2020 2020 2020 2076 616c               val
-0004d510: 7320 3d20 2873 656c 662e 6368 6174 5b22  s = (self.chat["
-0004d520: 6964 656e 7469 7479 225d 2c20 6869 7374  identity"], hist
-0004d530: 7479 7065 2c0d 0a20 2020 2020 2020 2020  type,..         
-0004d540: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0004d550: 656c 662e 6462 2e66 696c 656e 616d 652e  elf.db.filename.
-0004d560: 656e 636f 6465 2822 7574 662d 3822 2929  encode("utf-8"))
-0004d570: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004d580: 2020 666e 203d 2022 2573 5f25 735f 2573    fn = "%s_%s_%s
-0004d590: 2e70 6e67 2220 2520 7475 706c 6528 6d61  .png" % tuple(ma
-0004d5a0: 7028 7572 6c6c 6962 2e70 6172 7365 2e71  p(urllib.parse.q
-0004d5b0: 756f 7465 2c20 7661 6c73 2929 0d0a 2020  uote, vals))..  
-0004d5c0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0004d5d0: 2066 6e20 696e 2066 735b 2266 696c 6573   fn in fs["files
-0004d5e0: 225d 3a0d 0a20 2020 2020 2020 2020 2020  "]:..           
-0004d5f0: 2020 2020 2020 2020 2066 735b 2268 616e           fs["han
-0004d600: 646c 6572 225d 2e52 656d 6f76 6546 696c  dler"].RemoveFil
-0004d610: 6528 666e 290d 0a20 2020 2020 2020 2020  e(fn)..         
-0004d620: 2020 2020 2020 2062 6172 6461 7461 203d         bardata =
-0004d630: 2073 6f72 7465 6428 6869 7374 6461 7461   sorted(histdata
-0004d640: 2e69 7465 6d73 2829 290d 0a20 2020 2020  .items())..     
-0004d650: 2020 2020 2020 2020 2020 2069 6d67 2c20             img, 
-0004d660: 7265 6374 7320 3d20 636f 6e74 726f 6c73  rects = controls
-0004d670: 2e42 7569 6c64 4869 7374 6f67 7261 6d28  .BuildHistogram(
-0004d680: 6261 7264 6174 612c 202a 504c 4f54 434f  bardata, *PLOTCO
-0004d690: 4e46 5b68 6973 7474 7970 655d 290d 0a20  NF[histtype]).. 
-0004d6a0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0004d6b0: 735b 2268 616e 646c 6572 225d 2e41 6464  s["handler"].Add
-0004d6c0: 4669 6c65 2866 6e2c 2069 6d67 2c20 7778  File(fn, img, wx
-0004d6d0: 2e42 4954 4d41 505f 5459 5045 5f50 4e47  .BITMAP_TYPE_PNG
-0004d6e0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0004d6f0: 2020 2066 735b 2266 696c 6573 225d 5b66     fs["files"][f
-0004d700: 6e5d 203d 2031 0d0a 2020 2020 2020 2020  n] = 1..        
-0004d710: 2020 2020 2020 2020 6461 7461 5b22 696d          data["im
-0004d720: 6167 6573 225d 5b68 6973 7474 7970 655d  ages"][histtype]
-0004d730: 203d 2066 6e0d 0a20 2020 2020 2020 2020   = fn..         
-0004d740: 2020 2020 2020 2061 7265 6173 2c20 6d73         areas, ms
-0004d750: 6773 203d 205b 5d2c 2073 7461 7473 5b22  gs = [], stats["
-0004d760: 746f 7461 6c68 6973 7422 5d5b 2225 732d  totalhist"]["%s-
-0004d770: 6669 7273 7473 2220 2520 6869 7374 7479  firsts" % histty
-0004d780: 7065 5d0d 0a20 2020 2020 2020 2020 2020  pe]..           
-0004d790: 2020 2020 2066 6f72 2069 2c20 2869 6e74       for i, (int
-0004d7a0: 6572 7661 6c2c 2076 616c 2920 696e 2065  erval, val) in e
-0004d7b0: 6e75 6d65 7261 7465 2862 6172 6461 7461  numerate(bardata
-0004d7c0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-0004d7d0: 2020 2020 2020 2020 6966 2069 6e74 6572          if inter
-0004d7e0: 7661 6c20 696e 206d 7367 733a 0d0a 2020  val in msgs:..  
-0004d7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d800: 2020 2020 2020 6172 6561 732e 6170 7065        areas.appe
-0004d810: 6e64 2828 7265 6374 735b 695d 2c20 226d  nd((rects[i], "m
-0004d820: 6573 7361 6765 3a25 7322 2025 206d 7367  essage:%s" % msg
-0004d830: 735b 696e 7465 7276 616c 5d29 290d 0a20  s[interval])).. 
-0004d840: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0004d850: 6174 615b 2269 6d61 6765 6d61 7073 225d  ata["imagemaps"]
-0004d860: 5b68 6973 7474 7970 655d 203d 2061 7265  [histtype] = are
-0004d870: 6173 0d0a 2020 2020 2020 2020 2020 2020  as..            
-0004d880: 2320 4669 6c6c 2061 7574 686f 7220 6869  # Fill author hi
-0004d890: 7374 6f67 7261 6d20 706c 6f74 2069 6d61  stogram plot ima
-0004d8a0: 6765 730d 0a20 2020 2020 2020 2020 2020  ges..           
-0004d8b0: 2066 6f72 2061 7574 686f 722c 2068 6973   for author, his
-0004d8c0: 7473 2069 6e20 7374 6174 735b 2268 6973  ts in stats["his
-0004d8d0: 7473 225d 2e69 7465 6d73 2829 3a0d 0a20  ts"].items():.. 
-0004d8e0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0004d8f0: 6f72 2068 6973 7474 7970 652c 2068 6973  or histtype, his
-0004d900: 7464 6174 6120 696e 2068 6973 7473 2e69  tdata in hists.i
-0004d910: 7465 6d73 2829 3a0d 0a20 2020 2020 2020  tems():..       
-0004d920: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0004d930: 6869 7374 7479 7065 206e 6f74 2069 6e20  histtype not in 
-0004d940: 2822 686f 7572 7322 2c20 2264 6179 7322  ("hours", "days"
-0004d950: 293a 2063 6f6e 7469 6e75 6520 2320 666f  ): continue # fo
-0004d960: 7220 6869 7374 7479 7065 2e2e 0d0a 2020  r histtype....  
-0004d970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d980: 2020 7661 6c73 203d 2028 6175 7468 6f72    vals = (author
-0004d990: 2c20 6869 7374 7479 7065 2c20 7365 6c66  , histtype, self
-0004d9a0: 2e63 6861 745b 2269 6465 6e74 6974 7922  .chat["identity"
-0004d9b0: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
-0004d9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d9d0: 7365 6c66 2e64 622e 6669 6c65 6e61 6d65  self.db.filename
-0004d9e0: 2e65 6e63 6f64 6528 2275 7466 2d38 2229  .encode("utf-8")
-0004d9f0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0004da00: 2020 2020 2020 2066 6e20 3d20 2225 735f         fn = "%s_
-0004da10: 2573 5f25 735f 2573 2e70 6e67 2220 2520  %s_%s_%s.png" % 
-0004da20: 7475 706c 6528 6d61 7028 7572 6c6c 6962  tuple(map(urllib
-0004da30: 2e70 6172 7365 2e71 756f 7465 2c20 7661  .parse.quote, va
-0004da40: 6c73 2929 0d0a 2020 2020 2020 2020 2020  ls))..          
-0004da50: 2020 2020 2020 2020 2020 6966 2066 6e20            if fn 
-0004da60: 696e 2066 735b 2266 696c 6573 225d 3a0d  in fs["files"]:.
-0004da70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004da80: 2020 2020 2020 2020 2066 735b 2268 616e           fs["han
-0004da90: 646c 6572 225d 2e52 656d 6f76 6546 696c  dler"].RemoveFil
-0004daa0: 6528 666e 290d 0a20 2020 2020 2020 2020  e(fn)..         
-0004dab0: 2020 2020 2020 2020 2020 2062 6172 6461             barda
-0004dac0: 7461 203d 2073 6f72 7465 6428 6869 7374  ta = sorted(hist
-0004dad0: 6461 7461 2e69 7465 6d73 2829 290d 0a20  data.items()).. 
-0004dae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004daf0: 2020 2069 6d67 2c20 7265 6374 7320 3d20     img, rects = 
-0004db00: 636f 6e74 726f 6c73 2e42 7569 6c64 4869  controls.BuildHi
-0004db10: 7374 6f67 7261 6d28 6261 7264 6174 612c  stogram(bardata,
-0004db20: 202a 504c 4f54 434f 4e46 5b68 6973 7474   *PLOTCONF[histt
-0004db30: 7970 655d 290d 0a20 2020 2020 2020 2020  ype])..         
-0004db40: 2020 2020 2020 2020 2020 2066 735b 2268             fs["h
-0004db50: 616e 646c 6572 225d 2e41 6464 4669 6c65  andler"].AddFile
-0004db60: 2866 6e2c 2069 6d67 2c20 7778 2e42 4954  (fn, img, wx.BIT
-0004db70: 4d41 505f 5459 5045 5f50 4e47 290d 0a20  MAP_TYPE_PNG).. 
-0004db80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004db90: 2020 2066 735b 2266 696c 6573 225d 5b66     fs["files"][f
-0004dba0: 6e5d 203d 2031 0d0a 2020 2020 2020 2020  n] = 1..        
-0004dbb0: 2020 2020 2020 2020 2020 2020 6461 7461              data
-0004dbc0: 5b22 6175 7468 6f72 696d 6167 6573 225d  ["authorimages"]
-0004dbd0: 5b61 7574 686f 725d 5b68 6973 7474 7970  [author][histtyp
-0004dbe0: 655d 203d 2066 6e0d 0a20 2020 2020 2020  e] = fn..       
-0004dbf0: 2020 2020 2020 2020 2020 2020 2061 7265               are
-0004dc00: 6173 2c20 6d73 6773 203d 205b 5d2c 2068  as, msgs = [], h
-0004dc10: 6973 7473 5b22 2573 2d66 6972 7374 7322  ists["%s-firsts"
-0004dc20: 2025 2068 6973 7474 7970 655d 0d0a 2020   % histtype]..  
-0004dc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004dc40: 2020 666f 7220 692c 2028 696e 7465 7276    for i, (interv
-0004dc50: 616c 2c20 7661 6c29 2069 6e20 656e 756d  al, val) in enum
-0004dc60: 6572 6174 6528 6261 7264 6174 6129 3a0d  erate(bardata):.
-0004dc70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004dc80: 2020 2020 2020 2020 2069 6620 696e 7465           if inte
-0004dc90: 7276 616c 2069 6e20 6d73 6773 3a0d 0a20  rval in msgs:.. 
-0004dca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004dcb0: 2020 2020 2020 2020 2020 2061 7265 6173             areas
-0004dcc0: 2e61 7070 656e 6428 2872 6563 7473 5b69  .append((rects[i
-0004dcd0: 5d2c 2022 6d65 7373 6167 653a 2573 2220  ], "message:%s" 
-0004dce0: 2520 6d73 6773 5b69 6e74 6572 7661 6c5d  % msgs[interval]
-0004dcf0: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
-0004dd00: 2020 2020 2020 2020 6966 2061 7574 686f          if autho
-0004dd10: 7220 6e6f 7420 696e 2064 6174 615b 2261  r not in data["a
-0004dd20: 7574 686f 7269 6d61 6765 6d61 7073 225d  uthorimagemaps"]
-0004dd30: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0004dd40: 2020 2020 2020 2020 2020 2064 6174 615b             data[
-0004dd50: 2261 7574 686f 7269 6d61 6765 6d61 7073  "authorimagemaps
-0004dd60: 225d 5b61 7574 686f 725d 203d 207b 7d0d  "][author] = {}.
-0004dd70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004dd80: 2020 2020 2064 6174 615b 2261 7574 686f       data["autho
-0004dd90: 7269 6d61 6765 6d61 7073 225d 5b61 7574  rimagemaps"][aut
-0004dda0: 686f 725d 5b68 6973 7474 7970 655d 203d  hor][histtype] =
-0004ddb0: 2061 7265 6173 0d0a 2020 2020 2020 2020   areas..        
-0004ddc0: 2020 2020 2320 4669 6c6c 2065 6d6f 7469      # Fill emoti
-0004ddd0: 636f 6e20 696d 6167 6573 0d0a 2020 2020  con images..    
-0004dde0: 2020 2020 2020 2020 666e 203d 2022 656d          fn = "em
-0004ddf0: 6f74 6963 6f6e 5f74 7261 6e73 7061 7265  oticon_transpare
-0004de00: 6e74 2e67 6966 220d 0a20 2020 2020 2020  nt.gif"..       
-0004de10: 2020 2020 2069 6620 666e 206e 6f74 2069       if fn not i
-0004de20: 6e20 6673 5b22 6669 6c65 7322 5d3a 0d0a  n fs["files"]:..
-0004de30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004de40: 696d 6720 3d20 696d 6167 6573 2e54 7261  img = images.Tra
-0004de50: 6e73 7061 7265 6e74 5069 7865 6c2e 496d  nsparentPixel.Im
-0004de60: 6167 650d 0a20 2020 2020 2020 2020 2020  age..           
-0004de70: 2020 2020 2066 735b 2268 616e 646c 6572       fs["handler
-0004de80: 225d 2e41 6464 4669 6c65 2866 6e2c 2069  "].AddFile(fn, i
-0004de90: 6d67 2c20 7778 2e42 4954 4d41 505f 5459  mg, wx.BITMAP_TY
-0004dea0: 5045 5f47 4946 290d 0a20 2020 2020 2020  PE_GIF)..       
-0004deb0: 2020 2020 2020 2020 2066 735b 2266 696c           fs["fil
-0004dec0: 6573 225d 5b66 6e5d 203d 2031 0d0a 2020  es"][fn] = 1..  
-0004ded0: 2020 2020 2020 2020 2020 666f 7220 656d            for em
-0004dee0: 6f74 6963 6f6e 2069 6e20 7374 6174 735b  oticon in stats[
-0004def0: 2265 6d6f 7469 636f 6e73 225d 3a0d 0a20  "emoticons"]:.. 
-0004df00: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0004df10: 6620 6e6f 7420 6861 7361 7474 7228 656d  f not hasattr(em
-0004df20: 6f74 6963 6f6e 732c 2065 6d6f 7469 636f  oticons, emotico
-0004df30: 6e29 3a20 636f 6e74 696e 7565 2023 2066  n): continue # f
-0004df40: 6f72 2065 6d6f 7469 636f 6e0d 0a20 2020  or emoticon..   
-0004df50: 2020 2020 2020 2020 2020 2020 2069 6d67               img
-0004df60: 203d 2067 6574 6174 7472 2865 6d6f 7469   = getattr(emoti
-0004df70: 636f 6e73 2c20 656d 6f74 6963 6f6e 290d  cons, emoticon).
-0004df80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004df90: 2066 6e20 3d20 2265 6d6f 7469 636f 6e5f   fn = "emoticon_
-0004dfa0: 2573 2e67 6966 2220 2520 656d 6f74 6963  %s.gif" % emotic
-0004dfb0: 6f6e 0d0a 2020 2020 2020 2020 2020 2020  on..            
-0004dfc0: 2020 2020 6966 2069 6d67 2061 6e64 2066      if img and f
-0004dfd0: 6e20 6e6f 7420 696e 2066 735b 2266 696c  n not in fs["fil
-0004dfe0: 6573 225d 3a0d 0a20 2020 2020 2020 2020  es"]:..         
-0004dff0: 2020 2020 2020 2020 2020 2066 735b 2268             fs["h
-0004e000: 616e 646c 6572 225d 2e41 6464 4669 6c65  andler"].AddFile
-0004e010: 2866 6e2c 2069 6d67 2e49 6d61 6765 2c20  (fn, img.Image, 
-0004e020: 7778 2e42 4954 4d41 505f 5459 5045 5f47  wx.BITMAP_TYPE_G
-0004e030: 4946 290d 0a20 2020 2020 2020 2020 2020  IF)..           
-0004e040: 2020 2020 2020 2020 2066 735b 2266 696c           fs["fil
-0004e050: 6573 225d 5b66 6e5d 203d 2031 0d0a 2020  es"][fn] = 1..  
-0004e060: 2020 2020 2020 2020 2020 2320 4669 6c6c            # Fill
-0004e070: 2063 6861 7420 696d 6167 650d 0a20 2020   chat image..   
-0004e080: 2020 2020 2020 2020 2070 6963 203d 2073           pic = s
-0004e090: 656c 662e 6368 6174 5b22 6d65 7461 5f70  elf.chat["meta_p
-0004e0a0: 6963 7475 7265 225d 206f 7220 7365 6c66  icture"] or self
-0004e0b0: 2e63 6861 742e 6765 7428 225f 5f6c 696e  .chat.get("__lin
-0004e0c0: 6b22 2c20 7b7d 292e 6765 7428 226d 6574  k", {}).get("met
-0004e0d0: 615f 7069 6374 7572 6522 290d 0a20 2020  a_picture")..   
-0004e0e0: 2020 2020 2020 2020 2069 6d67 2c20 696d           img, im
-0004e0f0: 676b 6579 203d 2073 656c 662e 696d 6167  gkey = self.imag
-0004e100: 6563 6163 6865 2e67 6574 2828 2263 6861  ecache.get(("cha
-0004e110: 7422 2c20 7365 6c66 2e63 6861 745b 2269  t", self.chat["i
-0004e120: 6422 5d29 292c 2028 2263 6861 7422 2c20  d"])), ("chat", 
-0004e130: 7365 6c66 2e63 6861 745b 2269 6422 5d29  self.chat["id"])
-0004e140: 0d0a 2020 2020 2020 2020 2020 2020 7472  ..            tr
-0004e150: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
-0004e160: 2020 2020 7261 7720 3d20 736b 7970 6564      raw = skyped
-0004e170: 6174 612e 6669 785f 696d 6167 655f 7261  ata.fix_image_ra
-0004e180: 7728 7069 6329 2069 6620 7069 6320 616e  w(pic) if pic an
-0004e190: 6420 6e6f 7420 696d 6720 656c 7365 204e  d not img else N
-0004e1a0: 6f6e 650d 0a20 2020 2020 2020 2020 2020  one..           
-0004e1b0: 2020 2020 2069 6d67 203d 2069 6d67 206f       img = img o
-0004e1c0: 7220 7778 2e49 6d61 6765 2869 6f2e 4279  r wx.Image(io.By
-0004e1d0: 7465 7349 4f28 7261 772e 656e 636f 6465  tesIO(raw.encode
-0004e1e0: 2822 6c61 7469 6e31 2229 2929 0d0a 2020  ("latin1")))..  
-0004e1f0: 2020 2020 2020 2020 2020 6578 6365 7074            except
-0004e200: 2045 7863 6570 7469 6f6e 3a0d 0a20 2020   Exception:..   
-0004e210: 2020 2020 2020 2020 2020 2020 206c 6f67               log
-0004e220: 6765 722e 6578 6365 7074 696f 6e28 2245  ger.exception("E
-0004e230: 7272 6f72 206c 6f61 6469 6e67 2069 6d61  rror loading ima
-0004e240: 6765 2066 6f72 2025 732e 222c 2073 656c  ge for %s.", sel
-0004e250: 662e 6368 6174 5b22 7469 746c 655f 6c6f  f.chat["title_lo
-0004e260: 6e67 5f6c 6322 5d29 0d0a 2020 2020 2020  ng_lc"])..      
-0004e270: 2020 2020 2020 6966 2069 6d67 3a0d 0a20        if img:.. 
-0004e280: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-0004e290: 616c 7320 3d20 2873 7472 2873 656c 662e  als = (str(self.
-0004e2a0: 6368 6174 5b22 6964 225d 292e 656e 636f  chat["id"]).enco
-0004e2b0: 6465 2822 7574 662d 3822 292c 2073 656c  de("utf-8"), sel
-0004e2c0: 662e 6462 2e66 696c 656e 616d 652e 656e  f.db.filename.en
-0004e2d0: 636f 6465 2822 7574 662d 3822 2929 0d0a  code("utf-8"))..
-0004e2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e2f0: 666e 203d 2022 2573 5f25 732e 626d 7022  fn = "%s_%s.bmp"
-0004e300: 2025 2074 7570 6c65 286d 6170 2875 726c   % tuple(map(url
-0004e310: 6c69 622e 7061 7273 652e 7175 6f74 652c  lib.parse.quote,
-0004e320: 2076 616c 7329 290d 0a20 2020 2020 2020   vals))..       
-0004e330: 2020 2020 2020 2020 2069 6620 666e 206e           if fn n
-0004e340: 6f74 2069 6e20 6673 5b22 6669 6c65 7322  ot in fs["files"
-0004e350: 5d3a 0d0a 2020 2020 2020 2020 2020 2020  ]:..            
-0004e360: 2020 2020 2020 2020 6673 5b22 6861 6e64          fs["hand
-0004e370: 6c65 7222 5d2e 4164 6446 696c 6528 666e  ler"].AddFile(fn
-0004e380: 2c20 696d 672e 436f 7079 2829 2c20 7778  , img.Copy(), wx
-0004e390: 2e42 4954 4d41 505f 5459 5045 5f42 4d50  .BITMAP_TYPE_BMP
-0004e3a0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0004e3b0: 2020 2020 2020 2066 735b 2266 696c 6573         fs["files
-0004e3c0: 225d 5b66 6e5d 203d 2031 0d0a 2020 2020  "][fn] = 1..    
-0004e3d0: 2020 2020 2020 2020 2020 2020 6461 7461              data
-0004e3e0: 5b22 6368 6174 5f69 6d61 6765 225d 2c20  ["chat_image"], 
-0004e3f0: 6461 7461 5b22 6368 6174 5f69 6d61 6765  data["chat_image
-0004e400: 5f73 697a 6522 5d20 3d20 666e 2c20 7475  _size"] = fn, tu
-0004e410: 706c 6528 696d 672e 4765 7453 697a 6528  ple(img.GetSize(
-0004e420: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
-0004e430: 2020 2020 7365 6c66 2e69 6d61 6765 6361      self.imageca
-0004e440: 6368 655b 696d 676b 6579 5d20 3d20 696d  che[imgkey] = im
-0004e450: 670d 0a0d 0a20 2020 2020 2020 2020 2020  g....           
-0004e460: 2068 746d 6c20 3d20 7374 6570 2e54 656d   html = step.Tem
-0004e470: 706c 6174 6528 7465 6d70 6c61 7465 732e  plate(templates.
-0004e480: 5354 4154 535f 4854 4d4c 2c20 6573 6361  STATS_HTML, esca
-0004e490: 7065 3d54 7275 6529 2e65 7870 616e 6428  pe=True).expand(
-0004e4a0: 6461 7461 290d 0a0d 0a20 2020 2020 2020  data)....       
-0004e4b0: 2070 7265 7669 6f75 735f 616e 6368 6f72   previous_anchor
-0004e4c0: 203d 2073 656c 662e 6874 6d6c 5f73 7461   = self.html_sta
-0004e4d0: 7473 2e4f 7065 6e65 6441 6e63 686f 720d  ts.OpenedAnchor.
-0004e4e0: 0a20 2020 2020 2020 2070 7265 7669 6f75  .        previou
-0004e4f0: 735f 7363 726f 6c6c 706f 7320 3d20 6765  s_scrollpos = ge
-0004e500: 7461 7474 7228 7365 6c66 2e68 746d 6c5f  tattr(self.html_
-0004e510: 7374 6174 732c 2022 5f6c 6173 745f 7363  stats, "_last_sc
-0004e520: 726f 6c6c 5f70 6f73 222c 204e 6f6e 6529  roll_pos", None)
-0004e530: 0d0a 2020 2020 2020 2020 7365 6c66 2e68  ..        self.h
-0004e540: 746d 6c5f 7374 6174 732e 4672 6565 7a65  tml_stats.Freeze
-0004e550: 2829 0d0a 2020 2020 2020 2020 7365 6c66  ()..        self
-0004e560: 2e68 746d 6c5f 7374 6174 732e 5365 7450  .html_stats.SetP
-0004e570: 6167 6528 6874 6d6c 290d 0a20 2020 2020  age(html)..     
-0004e580: 2020 2073 656c 662e 6874 6d6c 5f73 7461     self.html_sta
-0004e590: 7473 2e42 6163 6b67 726f 756e 6443 6f6c  ts.BackgroundCol
-0004e5a0: 6f75 7220 3d20 436f 6c6f 7572 4d61 6e61  our = ColourMana
-0004e5b0: 6765 722e 4765 7443 6f6c 6f75 7228 7778  ger.GetColour(wx
-0004e5c0: 2e53 5953 5f43 4f4c 4f55 525f 5749 4e44  .SYS_COLOUR_WIND
-0004e5d0: 4f57 290d 0a20 2020 2020 2020 2069 6620  OW)..        if 
-0004e5e0: 7072 6576 696f 7573 5f73 6372 6f6c 6c70  previous_scrollp
-0004e5f0: 6f73 3a0d 0a20 2020 2020 2020 2020 2020  os:..           
-0004e600: 2073 656c 662e 6874 6d6c 5f73 7461 7473   self.html_stats
-0004e610: 2e53 6372 6f6c 6c28 2a70 7265 7669 6f75  .Scroll(*previou
-0004e620: 735f 7363 726f 6c6c 706f 7329 0d0a 2020  s_scrollpos)..  
-0004e630: 2020 2020 2020 656c 6966 2070 7265 7669        elif previ
-0004e640: 6f75 735f 616e 6368 6f72 3a0d 0a20 2020  ous_anchor:..   
-0004e650: 2020 2020 2020 2020 2073 656c 662e 6874           self.ht
-0004e660: 6d6c 5f73 7461 7473 2e53 6372 6f6c 6c54  ml_stats.ScrollT
-0004e670: 6f41 6e63 686f 7228 7072 6576 696f 7573  oAnchor(previous
-0004e680: 5f61 6e63 686f 7229 0d0a 2020 2020 2020  _anchor)..      
-0004e690: 2020 7365 6c66 2e68 746d 6c5f 7374 6174    self.html_stat
-0004e6a0: 732e 5468 6177 2829 0d0a 0d0a 0d0a 2020  s.Thaw()......  
-0004e6b0: 2020 6465 6620 636c 6f73 655f 6368 6174    def close_chat
-0004e6c0: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
-0004e6d0: 2022 2222 436c 6f73 6573 2074 6865 2063   """Closes the c
-0004e6e0: 7572 7265 6e74 6c79 206f 7065 6e20 6368  urrently open ch
-0004e6f0: 6174 2069 6e20 4368 6174 436f 6e74 656e  at in ChatConten
-0004e700: 7453 5443 2e22 2222 0d0a 2020 2020 2020  tSTC."""..      
-0004e710: 2020 6966 206e 6f74 2073 656c 662e 6368    if not self.ch
-0004e720: 6174 3a20 7265 7475 726e 0d0a 0d0a 2020  at: return....  
-0004e730: 2020 2020 2020 6368 6174 2c20 7365 6c66        chat, self
-0004e740: 2e63 6861 7420 3d20 7365 6c66 2e63 6861  .chat = self.cha
-0004e750: 742c 204e 6f6e 650d 0a20 2020 2020 2020  t, None..       
-0004e760: 2073 656c 662e 6368 6174 5f66 696c 7465   self.chat_filte
-0004e770: 7220 3d20 7b22 6461 7465 7261 6e67 6522  r = {"daterange"
-0004e780: 3a20 4e6f 6e65 2c20 2273 7461 7274 6461  : None, "startda
-0004e790: 7465 7261 6e67 6522 3a20 4e6f 6e65 2c0d  terange": None,.
-0004e7a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004e7b0: 2020 2020 2020 2020 2020 2020 2022 7465               "te
-0004e7c0: 7874 223a 2022 222c 2022 7061 7274 6963  xt": "", "partic
-0004e7d0: 6970 616e 7473 223a 204e 6f6e 657d 0d0a  ipants": None}..
-0004e7e0: 2020 2020 2020 2020 2320 5570 6461 7465          # Update
-0004e7f0: 2063 6861 7420 6c69 7374 2063 6f6c 6f75   chat list colou
-0004e800: 7273 0d0a 2020 2020 2020 2020 666f 7220  rs..        for 
-0004e810: 6920 696e 2072 616e 6765 2873 656c 662e  i in range(self.
-0004e820: 6c69 7374 5f63 6861 7473 2e49 7465 6d43  list_chats.ItemC
-0004e830: 6f75 6e74 293a 0d0a 2020 2020 2020 2020  ount):..        
-0004e840: 2020 2020 6966 2073 656c 662e 6c69 7374      if self.list
-0004e850: 5f63 6861 7473 2e47 6574 4974 656d 4d61  _chats.GetItemMa
-0004e860: 7070 6564 4461 7461 2869 2920 3d3d 2063  ppedData(i) == c
-0004e870: 6861 743a 0d0a 2020 2020 2020 2020 2020  hat:..          
-0004e880: 2020 2020 2020 7365 6c66 2e6c 6973 745f        self.list_
-0004e890: 6368 6174 732e 5365 7449 7465 6d46 6f6e  chats.SetItemFon
-0004e8a0: 7428 692c 2073 656c 662e 6c69 7374 5f63  t(i, self.list_c
-0004e8b0: 6861 7473 2e46 6f6e 7429 0d0a 0d0a 2020  hats.Font)....  
-0004e8c0: 2020 2020 2020 2320 436c 6561 7220 6669        # Clear fi
-0004e8d0: 6c74 6572 2063 6f6e 7472 6f6c 730d 0a20  lter controls.. 
-0004e8e0: 2020 2020 2020 2073 656c 662e 6c61 6265         self.labe
-0004e8f0: 6c5f 6368 6174 2e4c 6162 656c 203d 2022  l_chat.Label = "
-0004e900: 220d 0a20 2020 2020 2020 2073 656c 662e  "..        self.
-0004e910: 6564 6974 5f66 696c 7465 7274 6578 742e  edit_filtertext.
-0004e920: 5661 6c75 6520 3d20 2222 0d0a 2020 2020  Value = ""..    
-0004e930: 2020 2020 7365 6c66 2e65 6469 745f 6669      self.edit_fi
-0004e940: 6c74 6572 6461 7465 312e 5661 6c75 6520  lterdate1.Value 
-0004e950: 3d20 7365 6c66 2e65 6469 745f 6669 6c74  = self.edit_filt
-0004e960: 6572 6461 7465 322e 5661 6c75 6520 3d20  erdate2.Value = 
-0004e970: 4e6f 6e65 0d0a 2020 2020 2020 2020 7365  None..        se
-0004e980: 6c66 2e72 616e 6765 5f64 6174 652e 5365  lf.range_date.Se
-0004e990: 7452 616e 6765 284e 6f6e 652c 204e 6f6e  tRange(None, Non
-0004e9a0: 6529 0d0a 2020 2020 2020 2020 7365 6c66  e)..        self
-0004e9b0: 2e73 7463 5f68 6973 746f 7279 2e50 6f70  .stc_history.Pop
-0004e9c0: 756c 6174 6528 4e6f 6e65 2c20 7365 6c66  ulate(None, self
-0004e9d0: 2e64 6229 0d0a 2020 2020 2020 2020 7365  .db)..        se
-0004e9e0: 6c66 2e73 7463 5f68 6973 746f 7279 2e53  lf.stc_history.S
-0004e9f0: 6574 4669 6c74 6572 2873 656c 662e 6368  etFilter(self.ch
-0004ea00: 6174 5f66 696c 7465 7229 0d0a 2020 2020  at_filter)..    
-0004ea10: 2020 2020 7365 6c66 2e73 7463 5f68 6973      self.stc_his
-0004ea20: 746f 7279 2e43 6c65 6172 416c 6c28 290d  tory.ClearAll().
-0004ea30: 0a20 2020 2020 2020 2073 656c 662e 6c69  .        self.li
-0004ea40: 7374 5f70 6172 7469 6369 7061 6e74 732e  st_participants.
-0004ea50: 436c 6561 7241 6c6c 2829 0d0a 2020 2020  ClearAll()..    
-0004ea60: 2020 2020 7365 6c66 2e74 625f 6368 6174      self.tb_chat
-0004ea70: 2e54 6f67 676c 6554 6f6f 6c28 7778 2e49  .ToggleTool(wx.I
-0004ea80: 445f 4d4f 5245 2c20 4661 6c73 6529 0d0a  D_MORE, False)..
-0004ea90: 0d0a 2020 2020 2020 2020 2320 436c 6561  ..        # Clea
-0004eaa0: 7220 616e 6420 6869 6465 2074 696d 656c  r and hide timel
-0004eab0: 696e 650d 0a20 2020 2020 2020 2069 6620  ine..        if 
-0004eac0: 7365 6c66 2e6c 6973 745f 7469 6d65 6c69  self.list_timeli
-0004ead0: 6e65 2e53 686f 776e 3a0d 0a20 2020 2020  ne.Shown:..     
-0004eae0: 2020 2020 2020 2073 656c 662e 6c69 7374         self.list
-0004eaf0: 5f74 696d 656c 696e 652e 4869 6465 2829  _timeline.Hide()
-0004eb00: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-0004eb10: 6c66 2e6c 6973 745f 7469 6d65 6c69 6e65  lf.list_timeline
-0004eb20: 2e43 6f6e 7461 696e 696e 6753 697a 6572  .ContainingSizer
-0004eb30: 2e4c 6179 6f75 7428 290d 0a20 2020 2020  .Layout()..     
-0004eb40: 2020 2020 2020 2073 656c 662e 7462 5f63         self.tb_c
-0004eb50: 6861 742e 546f 6767 6c65 546f 6f6c 2877  hat.ToggleTool(w
-0004eb60: 782e 4944 5f4a 554d 505f 544f 2c20 4661  x.ID_JUMP_TO, Fa
-0004eb70: 6c73 6529 0d0a 2020 2020 2020 2020 7365  lse)..        se
-0004eb80: 6c66 2e6c 6973 745f 7469 6d65 6c69 6e65  lf.list_timeline
-0004eb90: 2e50 6f70 756c 6174 6528 5b5d 2c20 4e6f  .Populate([], No
-0004eba0: 6e65 290d 0a0d 0a20 2020 2020 2020 2023  ne)....        #
-0004ebb0: 2043 6c65 6172 2061 6e64 2068 6964 6520   Clear and hide 
-0004ebc0: 7374 6174 6973 7469 6373 0d0a 2020 2020  statistics..    
-0004ebd0: 2020 2020 7365 6c66 2e68 746d 6c5f 7374      self.html_st
-0004ebe0: 6174 732e 5365 7450 6167 6528 2222 290d  ats.SetPage("").
-0004ebf0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-0004ec00: 2e68 746d 6c5f 7374 6174 732e 5368 6f77  .html_stats.Show
-0004ec10: 6e3a 0d0a 2020 2020 2020 2020 2020 2020  n:..            
-0004ec20: 7365 6c66 2e68 746d 6c5f 7374 6174 732e  self.html_stats.
-0004ec30: 4869 6465 2829 0d0a 2020 2020 2020 2020  Hide()..        
-0004ec40: 2020 2020 7365 6c66 2e73 7463 5f68 6973      self.stc_his
-0004ec50: 746f 7279 2e53 686f 7728 290d 0a20 2020  tory.Show()..   
-0004ec60: 2020 2020 2020 2020 2073 656c 662e 6874           self.ht
-0004ec70: 6d6c 5f73 7461 7473 2e43 6f6e 7461 696e  ml_stats.Contain
-0004ec80: 696e 6753 697a 6572 2e4c 6179 6f75 7428  ingSizer.Layout(
-0004ec90: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
-0004eca0: 656c 662e 7374 635f 6869 7374 6f72 792e  elf.stc_history.
-0004ecb0: 436f 6e74 6169 6e69 6e67 5369 7a65 722e  ContainingSizer.
-0004ecc0: 4c61 796f 7574 2829 0d0a 2020 2020 2020  Layout()..      
-0004ecd0: 2020 2020 2020 7365 6c66 2e74 625f 6368        self.tb_ch
-0004ece0: 6174 2e54 6f67 676c 6554 6f6f 6c28 7778  at.ToggleTool(wx
-0004ecf0: 2e49 445f 5052 4f50 4552 5449 4553 2c20  .ID_PROPERTIES, 
-0004ed00: 4661 6c73 6529 0d0a 0d0a 2020 2020 2020  False)....      
-0004ed10: 2020 7365 6c66 2e70 616e 656c 5f63 6861    self.panel_cha
-0004ed20: 7473 322e 456e 6162 6c65 6420 3d20 4661  ts2.Enabled = Fa
-0004ed30: 6c73 650d 0a0d 0a0d 0a20 2020 2064 6566  lse......    def
-0004ed40: 2064 656c 6574 655f 6368 6174 7328 7365   delete_chats(se
-0004ed50: 6c66 2c20 6368 6174 7329 3a0d 0a20 2020  lf, chats):..   
-0004ed60: 2020 2020 2022 2222 4173 6b73 2066 6f72       """Asks for
-0004ed70: 2063 6f6e 6669 726d 6174 696f 6e20 616e   confirmation an
-0004ed80: 6420 6465 6c65 7465 7320 7370 6563 6966  d deletes specif
-0004ed90: 6965 6420 6368 6174 7320 6672 6f6d 2064  ied chats from d
-0004eda0: 6174 6162 6173 652e 2222 220d 0a20 2020  atabase."""..   
-0004edb0: 2020 2020 2069 6620 6e6f 7420 6368 6174       if not chat
-0004edc0: 733a 2072 6574 7572 6e0d 0a20 2020 2020  s: return..     
-0004edd0: 2020 206f 6e67 6f69 6e67 7320 3d20 6c69     ongoings = li
-0004ede0: 7374 2866 696c 7465 7228 626f 6f6c 2c20  st(filter(bool, 
-0004edf0: 5b73 656c 662e 776f 726b 6572 5f6c 6976  [self.worker_liv
-0004ee00: 652e 6973 5f77 6f72 6b69 6e67 2829 2061  e.is_working() a
-0004ee10: 6e64 2022 6c69 7665 2073 796e 6322 2c0d  nd "live sync",.
-0004ee20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004ee30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ee40: 2020 2020 2020 7365 6c66 2e77 6f72 6b65        self.worke
-0004ee50: 7273 5f73 6561 7263 6820 616e 6420 2273  rs_search and "s
-0004ee60: 6561 7263 6822 5d29 290d 0a20 2020 2020  earch"]))..     
-0004ee70: 2020 2069 6620 6f6e 676f 696e 6773 3a20     if ongoings: 
-0004ee80: 7265 7475 726e 2077 782e 4d65 7373 6167  return wx.Messag
-0004ee90: 6542 6f78 2822 2573 2069 7320 6375 7272  eBox("%s is curr
-0004eea0: 656e 746c 7920 6f6e 676f 696e 672c 2063  ently ongoing, c
-0004eeb0: 616e 6e6f 7420 6465 6c65 7465 2e22 2025  annot delete." %
-0004eec0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004eed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004eee0: 2020 2020 2020 2020 2020 2020 2220 616e              " an
-0004eef0: 6420 222e 6a6f 696e 286f 6e67 6f69 6e67  d ".join(ongoing
-0004ef00: 7329 2e63 6170 6974 616c 697a 6528 292c  s).capitalize(),
-0004ef10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004ef20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ef30: 2020 2020 2020 2020 2020 2020 636f 6e66              conf
-0004ef40: 2e54 6974 6c65 2c20 7778 2e49 434f 4e5f  .Title, wx.ICON_
-0004ef50: 494e 464f 524d 4154 494f 4e20 7c20 7778  INFORMATION | wx
-0004ef60: 2e4f 4b29 0d0a 0d0a 2020 2020 2020 2020  .OK)....        
-0004ef70: 6d73 6720 3d20 2241 7265 2079 6f75 2073  msg = "Are you s
-0004ef80: 7572 6520 796f 7520 7761 6e74 2074 6f20  ure you want to 
-0004ef90: 6465 6c65 7465 2025 7320 2573 3f5c 6e5c  delete %s %s?\n\
-0004efa0: 6e20 2025 7322 2025 2028 0d0a 2020 2020  n  %s" % (..    
-0004efb0: 2020 2020 2020 2020 2020 2274 6865 7365            "these
-0004efc0: 2220 6966 206c 656e 2863 6861 7473 2920  " if len(chats) 
-0004efd0: 3e20 3120 656c 7365 2022 7468 6973 222c  > 1 else "this",
-0004efe0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004eff0: 7574 696c 2e70 6c75 7261 6c28 2263 6861  util.plural("cha
-0004f000: 7422 2c20 6368 6174 732c 2073 696e 676c  t", chats, singl
-0004f010: 653d 2222 292c 0d0a 2020 2020 2020 2020  e=""),..        
-0004f020: 2020 2020 2020 7574 696c 2e65 6c6c 6970        util.ellip
-0004f030: 7369 7a65 2822 5c6e 2020 222e 6a6f 696e  size("\n  ".join
-0004f040: 2863 5b22 7469 746c 655f 6c6f 6e67 225d  (c["title_long"]
-0004f050: 2066 6f72 2063 2069 6e20 6368 6174 7329   for c in chats)
-0004f060: 2c20 3530 3029 290d 0a20 2020 2020 2020  , 500))..       
-0004f070: 2069 6620 7778 2e4f 4b20 213d 2077 782e   if wx.OK != wx.
-0004f080: 4d65 7373 6167 6542 6f78 286d 7367 2c20  MessageBox(msg, 
-0004f090: 636f 6e66 2e54 6974 6c65 2c20 7778 2e49  conf.Title, wx.I
-0004f0a0: 434f 4e5f 494e 464f 524d 4154 494f 4e20  CON_INFORMATION 
-0004f0b0: 7c20 7778 2e4f 4b20 7c20 7778 2e43 414e  | wx.OK | wx.CAN
-0004f0c0: 4345 4c29 3a20 7265 7475 726e 0d0a 0d0a  CEL): return....
-0004f0d0: 2020 2020 2020 2020 6966 2077 782e 4f4b          if wx.OK
-0004f0e0: 2021 3d20 7778 2e4d 6573 7361 6765 426f   != wx.MessageBo
-0004f0f0: 7828 0d0a 2020 2020 2020 2020 2020 2020  x(..            
-0004f100: 2241 7265 2079 6f75 2072 6561 6c6c 7920  "Are you really 
-0004f110: 7375 7265 2079 6f75 2077 616e 7420 746f  sure you want to
-0004f120: 2064 656c 6574 6520 2573 2025 7320 220d   delete %s %s ".
-0004f130: 0a20 2020 2020 2020 2020 2020 2022 616e  .            "an
-0004f140: 6420 616c 6c20 7468 6569 7220 7265 6c61  d all their rela
-0004f150: 7465 6420 6461 7461 2066 726f 6d20 7468  ted data from th
-0004f160: 6520 6461 7461 6261 7365 3f5c 6e5c 6e22  e database?\n\n"
-0004f170: 0d0a 2020 2020 2020 2020 2020 2020 2254  ..            "T
-0004f180: 6869 7320 6163 7469 6f6e 2069 7320 6e6f  his action is no
-0004f190: 7420 756e 646f 6162 6c65 2e22 2025 2028  t undoable." % (
-0004f1a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004f1b0: 2020 2274 6869 7322 2069 6620 6c65 6e28    "this" if len(
-0004f1c0: 6368 6174 7329 203d 3d20 3120 656c 7365  chats) == 1 else
-0004f1d0: 2022 7468 6573 6522 2c0d 0a20 2020 2020   "these",..     
-0004f1e0: 2020 2020 2020 2020 2020 2075 7469 6c2e             util.
-0004f1f0: 706c 7572 616c 2822 6368 6174 222c 2063  plural("chat", c
-0004f200: 6861 7473 2c20 6e75 6d62 6572 733d 4661  hats, numbers=Fa
-0004f210: 6c73 6529 2c0d 0a20 2020 2020 2020 2020  lse),..         
-0004f220: 2020 2029 2c20 636f 6e66 2e54 6974 6c65     ), conf.Title
-0004f230: 2c20 7778 2e49 434f 4e5f 5741 524e 494e  , wx.ICON_WARNIN
-0004f240: 4720 7c20 7778 2e4f 4b20 7c20 7778 2e43  G | wx.OK | wx.C
-0004f250: 414e 4345 4c0d 0a20 2020 2020 2020 2029  ANCEL..        )
-0004f260: 3a20 7265 7475 726e 0d0a 0d0a 2020 2020  : return....    
-0004f270: 2020 2020 636d 6170 203d 207b 705b 2263      cmap = {p["c
-0004f280: 6f6e 7461 6374 225d 5b22 6964 656e 7469  ontact"]["identi
-0004f290: 7479 225d 3a20 705b 2263 6f6e 7461 6374  ty"]: p["contact
-0004f2a0: 225d 0d0a 2020 2020 2020 2020 2020 2020  "]..            
-0004f2b0: 2020 2020 666f 7220 6320 696e 2063 6861      for c in cha
-0004f2c0: 7473 2066 6f72 2070 2069 6e20 635b 2270  ts for p in c["p
-0004f2d0: 6172 7469 6369 7061 6e74 7322 5d0d 0a20  articipants"].. 
-0004f2e0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0004f2f0: 6620 705b 2269 6465 6e74 6974 7922 5d20  f p["identity"] 
-0004f300: 213d 2073 656c 662e 6462 2e69 6420 616e  != self.db.id an
-0004f310: 6420 705b 2263 6f6e 7461 6374 225d 2e67  d p["contact"].g
-0004f320: 6574 2822 6964 2229 7d0d 0a20 2020 2020  et("id")}..     
-0004f330: 2020 2063 6f6e 7461 6374 7320 3d20 736f     contacts = so
-0004f340: 7274 6564 2863 6d61 702e 7661 6c75 6573  rted(cmap.values
-0004f350: 2829 2c20 6b65 793d 6c61 6d62 6461 2078  (), key=lambda x
-0004f360: 3a20 785b 226e 616d 6522 5d2e 6c6f 7765  : x["name"].lowe
-0004f370: 7228 2929 0d0a 0d0a 2020 2020 2020 2020  r())....        
-0004f380: 6368 6174 6964 7320 3d20 5b63 5b22 6964  chatids = [c["id
-0004f390: 225d 2066 6f72 2063 2069 6e20 6368 6174  "] for c in chat
-0004f3a0: 735d 0d0a 2020 2020 2020 2020 6f74 6865  s]..        othe
-0004f3b0: 7263 6861 7473 203d 205b 6320 666f 7220  rchats = [c for 
-0004f3c0: 6320 696e 2073 656c 662e 6462 2e67 6574  c in self.db.get
-0004f3d0: 5f63 6f6e 7665 7273 6174 696f 6e73 2829  _conversations()
-0004f3e0: 2069 6620 635b 2269 6422 5d20 6e6f 7420   if c["id"] not 
-0004f3f0: 696e 2063 6861 7469 6473 5d0d 0a20 2020  in chatids]..   
-0004f400: 2020 2020 2070 7572 6761 626c 6573 203d       purgables =
-0004f410: 205b 7820 666f 7220 7820 696e 2063 6f6e   [x for x in con
-0004f420: 7461 6374 7320 6966 206e 6f74 2061 6e79  tacts if not any
-0004f430: 280d 0a20 2020 2020 2020 2020 2020 2061  (..            a
-0004f440: 6e79 2870 5b22 636f 6e74 6163 7422 5d5b  ny(p["contact"][
-0004f450: 2269 6465 6e74 6974 7922 5d20 3d3d 2078  "identity"] == x
-0004f460: 5b22 6964 656e 7469 7479 225d 2066 6f72  ["identity"] for
-0004f470: 2070 2069 6e20 635b 2270 6172 7469 6369   p in c["partici
-0004f480: 7061 6e74 7322 5d29 0d0a 2020 2020 2020  pants"])..      
-0004f490: 2020 2020 2020 666f 7220 6320 696e 206f        for c in o
-0004f4a0: 7468 6572 6368 6174 730d 0a20 2020 2020  therchats..     
-0004f4b0: 2020 2029 5d0d 0a0d 0a20 2020 2020 2020     )]....       
-0004f4c0: 2069 6620 7075 7267 6162 6c65 733a 0d0a   if purgables:..
-0004f4d0: 2020 2020 2020 2020 2020 2020 6d73 6720              msg 
-0004f4e0: 3d20 2225 7320 7769 6c6c 2068 6176 6520  = "%s will have 
-0004f4f0: 6e6f 206d 6f72 6520 6d65 7373 6167 6573  no more messages
-0004f500: 2069 6e20 7468 6520 6461 7461 6261 7365   in the database
-0004f510: 2022 205c 0d0a 2020 2020 2020 2020 2020   " \..          
-0004f520: 2020 2020 2020 2020 2261 6674 6572 2064          "after d
-0004f530: 656c 6574 696e 6720 2573 2025 732e 2044  eleting %s %s. D
-0004f540: 656c 6574 6520 2573 2025 7320 616c 736f  elete %s %s also
-0004f550: 3f5c 6e5c 6e20 2025 7322 2025 2028 0d0a  ?\n\n  %s" % (..
-0004f560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f570: 2020 7574 696c 2e70 6c75 7261 6c28 2263    util.plural("c
-0004f580: 6f6e 7461 6374 222c 2070 7572 6761 626c  ontact", purgabl
-0004f590: 6573 2c20 7369 6e67 6c65 3d22 5468 6973  es, single="This
-0004f5a0: 2229 2c0d 0a20 2020 2020 2020 2020 2020  "),..           
-0004f5b0: 2020 2020 2020 2022 7468 6573 6522 2069         "these" i
-0004f5c0: 6620 6c65 6e28 6368 6174 7329 203e 2031  f len(chats) > 1
-0004f5d0: 2065 6c73 6520 2274 6869 7322 2c0d 0a20   else "this",.. 
-0004f5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f5f0: 2075 7469 6c2e 706c 7572 616c 2822 6368   util.plural("ch
-0004f600: 6174 222c 2063 6861 7473 2c20 7369 6e67  at", chats, sing
-0004f610: 6c65 3d22 2229 2c0d 0a20 2020 2020 2020  le=""),..       
-0004f620: 2020 2020 2020 2020 2020 2022 7468 6573             "thes
-0004f630: 6522 2069 6620 6c65 6e28 7075 7267 6162  e" if len(purgab
-0004f640: 6c65 7329 203e 2031 2065 6c73 6520 2274  les) > 1 else "t
-0004f650: 6865 222c 0d0a 2020 2020 2020 2020 2020  he",..          
-0004f660: 2020 2020 2020 2020 7574 696c 2e70 6c75          util.plu
-0004f670: 7261 6c28 2263 6f6e 7461 6374 222c 2070  ral("contact", p
-0004f680: 7572 6761 626c 6573 2c20 7369 6e67 6c65  urgables, single
-0004f690: 3d22 2229 2c0d 0a20 2020 2020 2020 2020  =""),..         
-0004f6a0: 2020 2020 2020 2020 2022 5c6e 2020 222e           "\n  ".
-0004f6b0: 6a6f 696e 2878 5b22 6964 656e 7469 7479  join(x["identity
-0004f6c0: 225d 2069 6620 785b 2269 6465 6e74 6974  "] if x["identit
-0004f6d0: 7922 5d20 3d3d 2078 5b22 6e61 6d65 225d  y"] == x["name"]
-0004f6e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004f6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f700: 656c 7365 2022 2573 2028 2573 2922 2025  else "%s (%s)" %
-0004f710: 2028 785b 226e 616d 6522 5d2c 2078 5b22   (x["name"], x["
-0004f720: 6964 656e 7469 7479 225d 290d 0a20 2020  identity"])..   
-0004f730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f740: 2020 2020 2020 2020 2020 2066 6f72 2078             for x
-0004f750: 2069 6e20 7075 7267 6162 6c65 7329 290d   in purgables)).
-0004f760: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-0004f770: 7020 3d20 7778 2e4d 6573 7361 6765 426f  p = wx.MessageBo
-0004f780: 7828 6d73 672c 2063 6f6e 662e 5469 746c  x(msg, conf.Titl
-0004f790: 652c 2077 782e 4943 4f4e 5f49 4e46 4f52  e, wx.ICON_INFOR
-0004f7a0: 4d41 5449 4f4e 207c 2077 782e 5945 5320  MATION | wx.YES 
-0004f7b0: 7c20 7778 2e4e 4f20 7c20 7778 2e43 414e  | wx.NO | wx.CAN
-0004f7c0: 4345 4c29 0d0a 2020 2020 2020 2020 2020  CEL)..          
-0004f7d0: 2020 6966 2077 782e 4341 4e43 454c 203d    if wx.CANCEL =
-0004f7e0: 3d20 7265 7370 3a20 7265 7475 726e 0d0a  = resp: return..
-0004f7f0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-0004f800: 2020 2077 782e 4e4f 203d 3d20 7265 7370     wx.NO == resp
-0004f810: 3a20 6465 6c20 7075 7267 6162 6c65 735b  : del purgables[
-0004f820: 3a5d 0d0a 0d0a 2020 2020 2020 2020 5441  :]....        TA
-0004f830: 424c 4553 203d 205b 2243 616c 6c73 222c  BLES = ["Calls",
-0004f840: 2022 4368 6174 7322 2c20 2243 6f6e 7665   "Chats", "Conve
-0004f850: 7273 6174 696f 6e73 222c 2022 4d65 6469  rsations", "Medi
-0004f860: 6144 6f63 756d 656e 7473 222c 2022 4d65  aDocuments", "Me
-0004f870: 7373 6167 6573 222c 0d0a 2020 2020 2020  ssages",..      
-0004f880: 2020 2020 2020 2020 2020 2020 2250 6172              "Par
-0004f890: 7469 6369 7061 6e74 7322 2c20 2254 7261  ticipants", "Tra
-0004f8a0: 6e73 6665 7273 222c 2022 5669 6465 6f73  nsfers", "Videos
-0004f8b0: 222c 2022 566f 6963 656d 6169 6c73 225d  ", "Voicemails"]
-0004f8c0: 0d0a 2020 2020 2020 2020 6966 2070 7572  ..        if pur
-0004f8d0: 6761 626c 6573 3a20 5441 424c 4553 2e65  gables: TABLES.e
-0004f8e0: 7874 656e 6428 5b22 436f 6e74 6163 7473  xtend(["Contacts
-0004f8f0: 222c 2022 436f 6e74 6163 7447 726f 7570  ", "ContactGroup
-0004f900: 7322 5d29 0d0a 2020 2020 2020 2020 6f70  s"])..        op
-0004f910: 656e 6564 732c 2063 6861 6e67 6564 7320  eneds, changeds 
-0004f920: 3d20 5b5d 2c20 5b5d 0d0a 2020 2020 2020  = [], []..      
-0004f930: 2020 666f 7220 7420 696e 2054 4142 4c45    for t in TABLE
-0004f940: 533a 0d0a 2020 2020 2020 2020 2020 2020  S:..            
-0004f950: 6966 2074 2e6c 6f77 6572 2829 2069 6e20  if t.lower() in 
-0004f960: 7365 6c66 2e64 625f 6772 6964 733a 0d0a  self.db_grids:..
-0004f970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f980: 6f70 656e 6564 732e 6170 7065 6e64 2874  openeds.append(t
-0004f990: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0004f9a0: 2020 2069 6620 7365 6c66 2e64 625f 6772     if self.db_gr
-0004f9b0: 6964 735b 742e 6c6f 7765 7228 295d 2e49  ids[t.lower()].I
-0004f9c0: 7343 6861 6e67 6564 2829 3a20 6368 616e  sChanged(): chan
-0004f9d0: 6765 6473 2e61 7070 656e 6428 7429 0d0a  geds.append(t)..
-0004f9e0: 0d0a 2020 2020 2020 2020 6966 2063 6861  ..        if cha
-0004f9f0: 6e67 6564 7320 616e 6420 7778 2e4f 4b20  ngeds and wx.OK 
-0004fa00: 213d 2077 782e 4d65 7373 6167 6542 6f78  != wx.MessageBox
-0004fa10: 2822 5468 6572 6520 6172 6520 756e 7361  ("There are unsa
-0004fa20: 7665 6420 6368 616e 6765 7320 220d 0a20  ved changes ".. 
-0004fa30: 2020 2020 2020 2020 2020 2022 696e 206f             "in o
-0004fa40: 7065 6e20 6461 7461 2067 7269 6473 2066  pen data grids f
-0004fa50: 6f72 2074 6865 2066 6f6c 6c6f 7769 6e67  or the following
-0004fa60: 2074 6162 6c65 733a 5c6e 2020 2573 5c6e   tables:\n  %s\n
-0004fa70: 5c6e 220d 0a20 2020 2020 2020 2020 2020  \n"..           
-0004fa80: 2022 4469 7363 6172 6420 6368 616e 6765   "Discard change
-0004fa90: 7320 616e 6420 636f 6e74 696e 7565 3f22  s and continue?"
-0004faa0: 2025 2022 5c6e 2020 222e 6a6f 696e 2863   % "\n  ".join(c
-0004fab0: 6861 6e67 6564 7329 2c0d 0a20 2020 2020  hangeds),..     
-0004fac0: 2020 2020 2020 2063 6f6e 662e 5469 746c         conf.Titl
-0004fad0: 652c 2077 782e 4943 4f4e 5f57 4152 4e49  e, wx.ICON_WARNI
-0004fae0: 4e47 207c 2077 782e 4f4b 207c 2077 782e  NG | wx.OK | wx.
-0004faf0: 4341 4e43 454c 293a 2072 6574 7572 6e0d  CANCEL): return.
-0004fb00: 0a0d 0a20 2020 2020 2020 2023 2043 6c6f  ...        # Clo
-0004fb10: 7365 2071 7565 7279 2063 7572 736f 7273  se query cursors
-0004fb20: 2c20 6469 7363 6172 6420 7461 626c 6520  , discard table 
-0004fb30: 6772 6964 7320 6375 7272 656e 746c 7920  grids currently 
-0004fb40: 6e6f 7420 7669 7369 626c 650d 0a20 2020  not visible..   
-0004fb50: 2020 2020 2069 6620 7365 6c66 2e67 7269       if self.gri
-0004fb60: 645f 7371 6c2e 5461 626c 653a 2073 656c  d_sql.Table: sel
-0004fb70: 662e 6772 6964 5f73 716c 2e54 6162 6c65  f.grid_sql.Table
-0004fb80: 2e43 6c6f 7365 2829 0d0a 2020 2020 2020  .Close()..      
-0004fb90: 2020 6966 2073 656c 662e 6772 6964 5f74    if self.grid_t
-0004fba0: 6162 6c65 2e54 6162 6c65 2061 6e64 2073  able.Table and s
-0004fbb0: 656c 662e 6772 6964 5f74 6162 6c65 2e54  elf.grid_table.T
-0004fbc0: 6162 6c65 2e49 7343 6861 6e67 6564 2829  able.IsChanged()
-0004fbd0: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
-0004fbe0: 656c 662e 6772 6964 5f74 6162 6c65 2e54  elf.grid_table.T
-0004fbf0: 6162 6c65 2e55 6e64 6f43 6861 6e67 6573  able.UndoChanges
-0004fc00: 2829 0d0a 2020 2020 2020 2020 666f 7220  ()..        for 
-0004fc10: 7420 696e 206f 7065 6e65 6473 3a0d 0a20  t in openeds:.. 
-0004fc20: 2020 2020 2020 2020 2020 2067 7269 6420             grid 
-0004fc30: 3d20 7365 6c66 2e64 625f 6772 6964 735b  = self.db_grids[
-0004fc40: 742e 6c6f 7765 7228 295d 0d0a 2020 2020  t.lower()]..    
-0004fc50: 2020 2020 2020 2020 6772 6964 2e43 6c6f          grid.Clo
-0004fc60: 7365 2829 0d0a 2020 2020 2020 2020 2020  se()..          
-0004fc70: 2020 6966 2067 7269 6420 6973 206e 6f74    if grid is not
-0004fc80: 2073 656c 662e 6772 6964 5f74 6162 6c65   self.grid_table
-0004fc90: 2e54 6162 6c65 3a20 7365 6c66 2e64 625f  .Table: self.db_
-0004fca0: 6772 6964 732e 706f 7028 742e 6c6f 7765  grids.pop(t.lowe
-0004fcb0: 7228 2929 0d0a 2020 2020 2020 2020 7365  r())..        se
-0004fcc0: 6c66 2e75 7064 6174 655f 7461 6268 6561  lf.update_tabhea
-0004fcd0: 6465 7228 290d 0a0d 0a20 2020 2020 2020  der()....       
-0004fce0: 2062 7573 7920 3d20 636f 6e74 726f 6c73   busy = controls
-0004fcf0: 2e42 7573 7950 616e 656c 2873 656c 662c  .BusyPanel(self,
-0004fd00: 2022 4465 6c65 7469 6e67 2e2e 2229 0d0a   "Deleting..")..
-0004fd10: 2020 2020 2020 2020 7472 793a 0d0a 2020          try:..  
-0004fd20: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-0004fd30: 662e 6368 6174 2069 6e20 6368 6174 733a  f.chat in chats:
-0004fd40: 2073 656c 662e 636c 6f73 655f 6368 6174   self.close_chat
-0004fd50: 2829 0d0a 0d0a 2020 2020 2020 2020 2020  ()....          
-0004fd60: 2020 7265 7375 6c74 203d 2073 656c 662e    result = self.
-0004fd70: 6462 2e64 656c 6574 655f 6461 7461 2863  db.delete_data(c
-0004fd80: 6861 7473 2c20 7075 7267 6162 6c65 7329  hats, purgables)
-0004fd90: 0d0a 2020 2020 2020 2020 2020 2020 6275  ..            bu
-0004fda0: 7379 2e43 6c6f 7365 2829 0d0a 2020 2020  sy.Close()..    
-0004fdb0: 2020 2020 2020 2020 6275 7379 203d 2063          busy = c
-0004fdc0: 6f6e 7472 6f6c 732e 4275 7379 5061 6e65  ontrols.BusyPane
-0004fdd0: 6c28 7365 6c66 2c20 2252 6566 7265 7368  l(self, "Refresh
-0004fde0: 696e 672e 2e22 290d 0a0d 0a20 2020 2020  ing..")....     
-0004fdf0: 2020 2020 2020 2069 6478 7320 3d20 5b69         idxs = [i
-0004fe00: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
-0004fe10: 7365 6c66 2e6c 6973 745f 6368 6174 732e  self.list_chats.
-0004fe20: 4765 7449 7465 6d43 6f75 6e74 2829 290d  GetItemCount()).
-0004fe30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004fe40: 2020 2020 2069 6620 7365 6c66 2e6c 6973       if self.lis
-0004fe50: 745f 6368 6174 732e 4765 7449 7465 6d4d  t_chats.GetItemM
-0004fe60: 6170 7065 6444 6174 6128 6929 2069 6e20  appedData(i) in 
-0004fe70: 6368 6174 735d 0d0a 2020 2020 2020 2020  chats]..        
-0004fe80: 2020 2020 666f 7220 6964 7820 696e 2069      for idx in i
-0004fe90: 6478 735b 3a3a 2d31 5d3a 2073 656c 662e  dxs[::-1]: self.
-0004fea0: 6c69 7374 5f63 6861 7473 2e44 656c 6574  list_chats.Delet
-0004feb0: 6549 7465 6d28 6964 7829 0d0a 2020 2020  eItem(idx)..    
-0004fec0: 2020 2020 2020 2020 7365 6c66 2e63 6861          self.cha
-0004fed0: 7473 203d 205b 6320 666f 7220 6320 696e  ts = [c for c in
-0004fee0: 2073 656c 662e 6368 6174 7320 6966 2063   self.chats if c
-0004fef0: 206e 6f74 2069 6e20 6368 6174 735d 0d0a   not in chats]..
-0004ff00: 0d0a 2020 2020 2020 2020 2020 2020 6964  ..            id
-0004ff10: 7873 203d 205b 6920 666f 7220 6920 696e  xs = [i for i in
-0004ff20: 2072 616e 6765 2873 656c 662e 6c69 7374   range(self.list
-0004ff30: 5f63 6f6e 7461 6374 732e 4765 7449 7465  _contacts.GetIte
-0004ff40: 6d43 6f75 6e74 2829 290d 0a20 2020 2020  mCount())..     
-0004ff50: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0004ff60: 6620 7365 6c66 2e6c 6973 745f 636f 6e74  f self.list_cont
-0004ff70: 6163 7473 2e47 6574 4974 656d 4d61 7070  acts.GetItemMapp
-0004ff80: 6564 4461 7461 2869 2920 696e 2070 7572  edData(i) in pur
-0004ff90: 6761 626c 6573 5d0d 0a20 2020 2020 2020  gables]..       
-0004ffa0: 2020 2020 2066 6f72 2069 6478 2069 6e20       for idx in 
-0004ffb0: 6964 7873 5b3a 3a2d 315d 3a20 7365 6c66  idxs[::-1]: self
-0004ffc0: 2e6c 6973 745f 636f 6e74 6163 7473 2e44  .list_contacts.D
-0004ffd0: 656c 6574 6549 7465 6d28 6964 7829 0d0a  eleteItem(idx)..
-0004ffe0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0004fff0: 2e63 6f6e 7461 6374 7320 3d20 5b63 2066  .contacts = [c f
-00050000: 6f72 2063 2069 6e20 7365 6c66 2e63 6f6e  or c in self.con
-00050010: 7461 6374 7320 6966 2063 206e 6f74 2069  tacts if c not i
-00050020: 6e20 7075 7267 6162 6c65 735d 0d0a 0d0a  n purgables]....
-00050030: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-00050040: 6163 7473 5f61 6666 6563 7465 6420 3d20  acts_affected = 
-00050050: 5b63 2066 6f72 2063 2069 6e20 7365 6c66  [c for c in self
-00050060: 2e63 6f6e 7461 6374 7320 6966 2061 6e79  .contacts if any
-00050070: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-00050080: 2020 2078 5b22 6964 225d 2069 6e20 5b79     x["id"] in [y
-00050090: 5b22 6964 225d 2066 6f72 2079 2069 6e20  ["id"] for y in 
-000500a0: 6368 6174 735d 2066 6f72 2078 2069 6e20  chats] for x in 
-000500b0: 632e 6765 7428 2263 6f6e 7665 7273 6174  c.get("conversat
-000500c0: 696f 6e73 2229 206f 7220 5b5d 0d0a 2020  ions") or []..  
-000500d0: 2020 2020 2020 2020 2020 295d 0d0a 2020            )]..  
-000500e0: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
-000500f0: 622e 6765 745f 636f 6e74 6163 7473 5f73  b.get_contacts_s
-00050100: 7461 7473 285b 7365 6c66 2e64 622e 6163  tats([self.db.ac
-00050110: 636f 756e 745d 202b 2063 6f6e 7461 6374  count] + contact
-00050120: 735f 6166 6665 6374 6564 2c20 7365 6c66  s_affected, self
-00050130: 2e63 6861 7473 290d 0a20 2020 2020 2020  .chats)..       
-00050140: 2020 2020 2073 656c 662e 6c69 7374 5f63       self.list_c
-00050150: 6f6e 7461 6374 732e 5265 6672 6573 6852  ontacts.RefreshR
-00050160: 6f77 7328 290d 0a20 2020 2020 2020 2020  ows()..         
-00050170: 2020 2073 656c 662e 6c6f 6164 5f63 6f6e     self.load_con
-00050180: 7461 6374 284e 6f6e 6520 6966 2073 656c  tact(None if sel
-00050190: 662e 636f 6e74 6163 7420 696e 2070 7572  f.contact in pur
-000501a0: 6761 626c 6573 2065 6c73 6520 7365 6c66  gables else self
-000501b0: 2e63 6f6e 7461 6374 290d 0a0d 0a20 2020  .contact)....   
-000501c0: 2020 2020 2020 2020 206c 626c 203d 2022           lbl = "
-000501d0: 4126 6c6c 2063 6861 7420 656e 7472 6965  A&ll chat entrie
-000501e0: 7320 696e 2064 6174 6162 6173 6520 2825  s in database (%
-000501f0: 7329 3a22 2025 2073 656c 662e 6c69 7374  s):" % self.list
-00050200: 5f63 6861 7473 2e49 7465 6d43 6f75 6e74  _chats.ItemCount
-00050210: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00050220: 6c66 2e6c 6162 656c 5f6c 6973 745f 6368  lf.label_list_ch
-00050230: 6174 732e 4c61 6265 6c20 3d20 6c62 6c0d  ats.Label = lbl.
-00050240: 0a20 2020 2020 2020 2020 2020 206c 626c  .            lbl
-00050250: 203d 2022 4126 6c6c 2070 726f 6669 6c65   = "A&ll profile
-00050260: 7320 696e 2064 6174 6162 6173 6520 2825  s in database (%
-00050270: 7329 3a22 2025 2073 656c 662e 6c69 7374  s):" % self.list
-00050280: 5f63 6f6e 7461 6374 732e 4974 656d 436f  _contacts.ItemCo
-00050290: 756e 740d 0a20 2020 2020 2020 2020 2020  unt..           
-000502a0: 2073 656c 662e 6c61 6265 6c5f 6c69 7374   self.label_list
-000502b0: 5f63 6f6e 7461 6374 732e 4c61 6265 6c20  _contacts.Label 
-000502c0: 3d20 6c62 6c0d 0a0d 0a20 2020 2020 2020  = lbl....       
-000502d0: 2020 2020 2073 656c 662e 6f6e 5f72 6566       self.on_ref
-000502e0: 7265 7368 5f74 6162 6c65 7328 290d 0a20  resh_tables().. 
-000502f0: 2020 2020 2020 2020 2020 2077 782e 4361             wx.Ca
-00050300: 6c6c 4166 7465 7228 7365 6c66 2e75 7064  llAfter(self.upd
-00050310: 6174 655f 696e 666f 5f70 6167 6529 0d0a  ate_info_page)..
-00050320: 2020 2020 2020 2020 2020 2020 7778 2e43              wx.C
-00050330: 616c 6c41 6674 6572 2873 656c 662e 546f  allAfter(self.To
-00050340: 704c 6576 656c 5061 7265 6e74 2e75 7064  pLevelParent.upd
-00050350: 6174 655f 6461 7461 6261 7365 5f64 6574  ate_database_det
-00050360: 6169 6c29 0d0a 2020 2020 2020 2020 2020  ail)..          
-00050370: 2020 6275 7379 2e43 6c6f 7365 2829 0d0a    busy.Close()..
-00050380: 0d0a 2020 2020 2020 2020 2020 2020 4d41  ..            MA
-00050390: 494e 5320 3d20 5b22 436f 6e76 6572 7361  INS = ["Conversa
-000503a0: 7469 6f6e 7322 2c20 224d 6573 7361 6765  tions", "Message
-000503b0: 7322 2c20 2243 6f6e 7461 6374 7322 5d0d  s", "Contacts"].
-000503c0: 0a20 2020 2020 2020 2020 2020 2069 6e66  .            inf
-000503d0: 6f74 6578 7420 3d20 2220 616e 6420 222e  otext = " and ".
-000503e0: 6a6f 696e 2875 7469 6c2e 706c 7572 616c  join(util.plural
-000503f0: 2874 2e6c 6f77 6572 2829 5b3a 2d31 5d2c  (t.lower()[:-1],
-00050400: 2072 6573 756c 745b 745d 290d 0a20 2020   result[t])..   
-00050410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050430: 2066 6f72 2074 2069 6e20 4d41 494e 5320   for t in MAINS 
-00050440: 6966 2072 6573 756c 742e 6765 7428 7429  if result.get(t)
-00050450: 290d 0a20 2020 2020 2020 2020 2020 206f  )..            o
-00050460: 7468 6572 636f 756e 7420 3d20 7375 6d28  thercount = sum(
-00050470: 7265 7375 6c74 5b74 5d20 666f 7220 7420  result[t] for t 
-00050480: 696e 2072 6573 756c 7420 6966 2074 206e  in result if t n
-00050490: 6f74 2069 6e20 4d41 494e 5329 0d0a 2020  ot in MAINS)..  
-000504a0: 2020 2020 2020 2020 2020 6966 206f 7468            if oth
-000504b0: 6572 636f 756e 743a 0d0a 2020 2020 2020  ercount:..      
-000504c0: 2020 2020 2020 2020 2020 696e 666f 7465            infote
-000504d0: 7874 202b 3d20 2220 2861 6e64 2025 7329  xt += " (and %s)
-000504e0: 2220 2520 7574 696c 2e70 6c75 7261 6c28  " % util.plural(
-000504f0: 2272 656c 6174 6564 2072 6f77 222c 206f  "related row", o
-00050500: 7468 6572 636f 756e 7429 0d0a 2020 2020  thercount)..    
-00050510: 2020 2020 2020 2020 6775 6962 6173 652e          guibase.
-00050520: 7374 6174 7573 2822 4465 6c65 7465 6420  status("Deleted 
-00050530: 2573 2066 726f 6d20 2573 2e22 2c20 696e  %s from %s.", in
-00050540: 666f 7465 7874 2c20 7365 6c66 2e64 622c  fotext, self.db,
-00050550: 206c 6f67 3d54 7275 6529 0d0a 2020 2020   log=True)..    
-00050560: 2020 2020 2020 2020 7778 2e4d 6573 7361          wx.Messa
-00050570: 6765 426f 7828 2244 656c 6574 6564 2025  geBox("Deleted %
-00050580: 732e 2220 2520 696e 666f 7465 7874 2c20  s." % infotext, 
-00050590: 636f 6e66 2e54 6974 6c65 2c20 7778 2e49  conf.Title, wx.I
-000505a0: 434f 4e5f 494e 464f 524d 4154 494f 4e29  CON_INFORMATION)
-000505b0: 0d0a 2020 2020 2020 2020 6669 6e61 6c6c  ..        finall
-000505c0: 793a 2062 7573 792e 436c 6f73 6528 290d  y: busy.Close().
-000505d0: 0a0d 0a0d 0a20 2020 2064 6566 206f 6e5f  .....    def on_
-000505e0: 6465 6c65 7465 5f63 6f6e 7461 6374 7328  delete_contacts(
-000505f0: 7365 6c66 2c20 6576 656e 743d 4e6f 6e65  self, event=None
-00050600: 2c20 636f 6e74 6163 7473 3d28 2929 3a0d  , contacts=()):.
-00050610: 0a20 2020 2020 2020 2022 2222 4861 6e64  .        """Hand
-00050620: 6c65 7220 666f 7220 6465 6c65 7469 6e67  ler for deleting
-00050630: 2063 6f6e 7461 6374 732c 2061 736b 7320   contacts, asks 
-00050640: 666f 7220 636f 6e66 6972 6d61 7469 6f6e  for confirmation
-00050650: 2e22 2222 0d0a 2020 2020 2020 2020 636f  ."""..        co
-00050660: 6e74 6163 7473 203d 2073 6f72 7465 6428  ntacts = sorted(
-00050670: 2863 2066 6f72 2063 2069 6e20 636f 6e74  (c for c in cont
-00050680: 6163 7473 2069 6620 635b 2269 6465 6e74  acts if c["ident
-00050690: 6974 7922 5d20 213d 2073 656c 662e 6462  ity"] != self.db
-000506a0: 2e69 6429 2c0d 0a20 2020 2020 2020 2020  .id),..         
-000506b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000506c0: 206b 6579 3d6c 616d 6264 6120 633a 2063   key=lambda c: c
-000506d0: 5b22 6e61 6d65 225d 2e6c 6f77 6572 2829  ["name"].lower()
-000506e0: 290d 0a20 2020 2020 2020 2069 6620 7778  )..        if wx
-000506f0: 2e4f 4b20 213d 2077 782e 4d65 7373 6167  .OK != wx.Messag
-00050700: 6542 6f78 280d 0a20 2020 2020 2020 2020  eBox(..         
-00050710: 2020 2022 4172 6520 796f 7520 7375 7265     "Are you sure
-00050720: 2079 6f75 2077 616e 7420 746f 2064 656c   you want to del
-00050730: 6574 6520 2573 2066 726f 6d20 7468 6520  ete %s from the 
-00050740: 6461 7461 6261 7365 3f5c 6e5c 6e22 0d0a  database?\n\n"..
-00050750: 2020 2020 2020 2020 2020 2020 2225 735c              "%s\
-00050760: 6e5c 6e22 0d0a 2020 2020 2020 2020 2020  n\n"..          
-00050770: 2020 2254 6869 7320 7769 6c6c 2064 656c    "This will del
-00050780: 6574 6520 7468 6569 7220 313a 3120 2573  ete their 1:1 %s
-00050790: 2c20 616c 6c20 7468 6569 7220 6f74 6865  , all their othe
-000507a0: 7220 6d65 7373 6167 6573 2c20 220d 0a20  r messages, ".. 
-000507b0: 2020 2020 2020 2020 2020 2022 616e 6420             "and 
-000507c0: 616e 7920 6f74 6865 7220 7265 6c61 7465  any other relate
-000507d0: 6420 6461 7461 2e22 2025 2028 0d0a 2020  d data." % (..  
-000507e0: 2020 2020 2020 2020 2020 2020 2020 7574                ut
-000507f0: 696c 2e70 6c75 7261 6c28 2263 6f6e 7461  il.plural("conta
-00050800: 6374 222c 2063 6f6e 7461 6374 732c 2073  ct", contacts, s
-00050810: 696e 676c 653d 2274 6869 7322 292c 0d0a  ingle="this"),..
-00050820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050830: 7574 696c 2e65 6c6c 6970 7369 7a65 2822  util.ellipsize("
-00050840: 5c6e 222e 6a6f 696e 2822 2573 2028 2573  \n".join("%s (%s
-00050850: 2922 2025 2028 635b 226e 616d 6522 5d2c  )" % (c["name"],
-00050860: 2063 5b22 6964 656e 7469 7479 225d 2920   c["identity"]) 
-00050870: 666f 7220 6320 696e 2063 6f6e 7461 6374  for c in contact
-00050880: 7329 2c20 3530 3029 2c0d 0a20 2020 2020  s), 500),..     
-00050890: 2020 2020 2020 2020 2020 2075 7469 6c2e             util.
-000508a0: 706c 7572 616c 2822 6368 6174 222c 2063  plural("chat", c
-000508b0: 6f6e 7461 6374 732c 206e 756d 6265 7273  ontacts, numbers
-000508c0: 3d46 616c 7365 292c 0d0a 2020 2020 2020  =False),..      
-000508d0: 2020 2020 2020 292c 2063 6f6e 662e 5469        ), conf.Ti
-000508e0: 746c 652c 2077 782e 4943 4f4e 5f49 4e46  tle, wx.ICON_INF
-000508f0: 4f52 4d41 5449 4f4e 207c 2077 782e 4f4b  ORMATION | wx.OK
-00050900: 207c 2077 782e 4341 4e43 454c 0d0a 2020   | wx.CANCEL..  
-00050910: 2020 2020 2020 293a 2072 6574 7572 6e0d        ): return.
-00050920: 0a0d 0a20 2020 2020 2020 2069 6620 7778  ...        if wx
-00050930: 2e4f 4b20 213d 2077 782e 4d65 7373 6167  .OK != wx.Messag
-00050940: 6542 6f78 280d 0a20 2020 2020 2020 2020  eBox(..         
-00050950: 2020 2022 4172 6520 796f 7520 7265 616c     "Are you real
-00050960: 6c79 2073 7572 6520 796f 7520 7761 6e74  ly sure you want
-00050970: 2074 6f20 6465 6c65 7465 2025 7320 2573   to delete %s %s
-00050980: 2022 0d0a 2020 2020 2020 2020 2020 2020   "..            
-00050990: 2261 6e64 2061 6c6c 2072 656c 6174 6564  "and all related
-000509a0: 2064 6174 6120 6672 6f6d 2074 6865 2064   data from the d
-000509b0: 6174 6162 6173 653f 5c6e 5c6e 220d 0a20  atabase?\n\n".. 
-000509c0: 2020 2020 2020 2020 2020 2022 5468 6973             "This
-000509d0: 2061 6374 696f 6e20 6973 206e 6f74 2075   action is not u
-000509e0: 6e64 6f61 626c 652e 2220 2520 280d 0a20  ndoable." % (.. 
-000509f0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00050a00: 7468 6973 2220 6966 206c 656e 2863 6f6e  this" if len(con
-00050a10: 7461 6374 7329 203d 3d20 3120 656c 7365  tacts) == 1 else
-00050a20: 2022 7468 6573 6522 2c0d 0a20 2020 2020   "these",..     
-00050a30: 2020 2020 2020 2020 2020 2075 7469 6c2e             util.
-00050a40: 706c 7572 616c 2822 636f 6e74 6163 7422  plural("contact"
-00050a50: 2c20 636f 6e74 6163 7473 2c20 6e75 6d62  , contacts, numb
-00050a60: 6572 733d 4661 6c73 6529 2c0d 0a20 2020  ers=False),..   
-00050a70: 2020 2020 2020 2020 2029 2c20 636f 6e66           ), conf
-00050a80: 2e54 6974 6c65 2c20 7778 2e49 434f 4e5f  .Title, wx.ICON_
-00050a90: 5741 524e 494e 4720 7c20 7778 2e4f 4b20  WARNING | wx.OK 
-00050aa0: 7c20 7778 2e43 414e 4345 4c0d 0a20 2020  | wx.CANCEL..   
-00050ab0: 2020 2020 2029 3a20 7265 7475 726e 0d0a       ): return..
-00050ac0: 0d0a 2020 2020 2020 2020 5441 424c 4553  ..        TABLES
-00050ad0: 203d 205b 2241 6c65 7274 7322 2c20 2243   = ["Alerts", "C
-00050ae0: 616c 6c4d 656d 6265 7273 222c 2022 4361  allMembers", "Ca
-00050af0: 6c6c 7322 2c20 2243 6861 744d 656d 6265  lls", "ChatMembe
-00050b00: 7273 222c 2022 4368 6174 7322 2c20 2243  rs", "Chats", "C
-00050b10: 6f6e 7461 6374 7322 2c0d 0a20 2020 2020  ontacts",..     
-00050b20: 2020 2020 2020 2020 2020 2020 2022 436f               "Co
-00050b30: 6e74 6163 7447 726f 7570 7322 2c20 2243  ntactGroups", "C
-00050b40: 6f6e 7665 7273 6174 696f 6e73 222c 2022  onversations", "
-00050b50: 4d65 6469 6144 6f63 756d 656e 7473 222c  MediaDocuments",
-00050b60: 2022 4d65 7373 6167 6541 6e6e 6f74 6174   "MessageAnnotat
-00050b70: 696f 6e73 222c 0d0a 2020 2020 2020 2020  ions",..        
-00050b80: 2020 2020 2020 2020 2020 224d 6573 7361            "Messa
-00050b90: 6765 7322 2c20 2250 6172 7469 6369 7061  ges", "Participa
-00050ba0: 6e74 7322 2c20 2254 7261 6e73 6665 7273  nts", "Transfers
-00050bb0: 222c 2022 5669 6465 6f4d 6573 7361 6765  ", "VideoMessage
-00050bc0: 7322 2c20 2256 6964 656f 7322 2c0d 0a20  s", "Videos",.. 
-00050bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050be0: 2022 566f 6963 656d 6169 6c73 225d 0d0a   "Voicemails"]..
-00050bf0: 2020 2020 2020 2020 6f70 656e 6564 732c          openeds,
-00050c00: 2063 6861 6e67 6564 7320 3d20 5b5d 2c20   changeds = [], 
-00050c10: 5b5d 0d0a 2020 2020 2020 2020 666f 7220  []..        for 
-00050c20: 7420 696e 2054 4142 4c45 533a 0d0a 2020  t in TABLES:..  
-00050c30: 2020 2020 2020 2020 2020 6966 2074 2e6c            if t.l
-00050c40: 6f77 6572 2829 2069 6e20 7365 6c66 2e64  ower() in self.d
-00050c50: 625f 6772 6964 733a 0d0a 2020 2020 2020  b_grids:..      
-00050c60: 2020 2020 2020 2020 2020 6f70 656e 6564            opened
-00050c70: 732e 6170 7065 6e64 2874 290d 0a20 2020  s.append(t)..   
-00050c80: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00050c90: 7365 6c66 2e64 625f 6772 6964 735b 742e  self.db_grids[t.
-00050ca0: 6c6f 7765 7228 295d 2e49 7343 6861 6e67  lower()].IsChang
-00050cb0: 6564 2829 3a20 6368 616e 6765 6473 2e61  ed(): changeds.a
-00050cc0: 7070 656e 6428 7429 0d0a 0d0a 2020 2020  ppend(t)....    
-00050cd0: 2020 2020 6966 2063 6861 6e67 6564 7320      if changeds 
-00050ce0: 616e 6420 7778 2e4f 4b20 213d 2077 782e  and wx.OK != wx.
-00050cf0: 4d65 7373 6167 6542 6f78 2822 5468 6572  MessageBox("Ther
-00050d00: 6520 6172 6520 756e 7361 7665 6420 6368  e are unsaved ch
-00050d10: 616e 6765 7320 220d 0a20 2020 2020 2020  anges "..       
-00050d20: 2020 2020 2022 696e 206f 7065 6e20 6461       "in open da
-00050d30: 7461 2067 7269 6473 2066 6f72 2074 6865  ta grids for the
-00050d40: 2066 6f6c 6c6f 7769 6e67 2074 6162 6c65   following table
-00050d50: 733a 5c6e 2020 2573 5c6e 5c6e 220d 0a20  s:\n  %s\n\n".. 
-00050d60: 2020 2020 2020 2020 2020 2022 4469 7363             "Disc
-00050d70: 6172 6420 6368 616e 6765 7320 616e 6420  ard changes and 
-00050d80: 636f 6e74 696e 7565 3f22 2025 2022 5c6e  continue?" % "\n
-00050d90: 2020 222e 6a6f 696e 2863 6861 6e67 6564    ".join(changed
-00050da0: 7329 2c0d 0a20 2020 2020 2020 2020 2020  s),..           
-00050db0: 2063 6f6e 662e 5469 746c 652c 2077 782e   conf.Title, wx.
-00050dc0: 4943 4f4e 5f57 4152 4e49 4e47 207c 2077  ICON_WARNING | w
-00050dd0: 782e 4f4b 207c 2077 782e 4341 4e43 454c  x.OK | wx.CANCEL
-00050de0: 293a 2072 6574 7572 6e0d 0a0d 0a20 2020  ): return....   
-00050df0: 2020 2020 2023 2043 6c6f 7365 2071 7565       # Close que
-00050e00: 7279 2063 7572 736f 7273 2c20 6469 7363  ry cursors, disc
-00050e10: 6172 6420 7461 626c 6520 6772 6964 7320  ard table grids 
-00050e20: 6375 7272 656e 746c 7920 6e6f 7420 7669  currently not vi
-00050e30: 7369 626c 650d 0a20 2020 2020 2020 2069  sible..        i
-00050e40: 6620 7365 6c66 2e67 7269 645f 7371 6c2e  f self.grid_sql.
-00050e50: 5461 626c 653a 2073 656c 662e 6772 6964  Table: self.grid
-00050e60: 5f73 716c 2e54 6162 6c65 2e43 6c6f 7365  _sql.Table.Close
-00050e70: 2829 0d0a 2020 2020 2020 2020 6966 2073  ()..        if s
-00050e80: 656c 662e 6772 6964 5f74 6162 6c65 2e54  elf.grid_table.T
-00050e90: 6162 6c65 2061 6e64 2073 656c 662e 6772  able and self.gr
-00050ea0: 6964 5f74 6162 6c65 2e54 6162 6c65 2e49  id_table.Table.I
-00050eb0: 7343 6861 6e67 6564 2829 3a0d 0a20 2020  sChanged():..   
-00050ec0: 2020 2020 2020 2020 2073 656c 662e 6772           self.gr
-00050ed0: 6964 5f74 6162 6c65 2e54 6162 6c65 2e55  id_table.Table.U
-00050ee0: 6e64 6f43 6861 6e67 6573 2829 0d0a 2020  ndoChanges()..  
-00050ef0: 2020 2020 2020 666f 7220 7420 696e 206f        for t in o
-00050f00: 7065 6e65 6473 3a0d 0a20 2020 2020 2020  peneds:..       
-00050f10: 2020 2020 2067 7269 6420 3d20 7365 6c66       grid = self
-00050f20: 2e64 625f 6772 6964 735b 742e 6c6f 7765  .db_grids[t.lowe
-00050f30: 7228 295d 0d0a 2020 2020 2020 2020 2020  r()]..          
-00050f40: 2020 6772 6964 2e43 6c6f 7365 2829 0d0a    grid.Close()..
-00050f50: 2020 2020 2020 2020 2020 2020 6966 2067              if g
-00050f60: 7269 6420 6973 206e 6f74 2073 656c 662e  rid is not self.
-00050f70: 6772 6964 5f74 6162 6c65 2e54 6162 6c65  grid_table.Table
-00050f80: 3a20 7365 6c66 2e64 625f 6772 6964 732e  : self.db_grids.
-00050f90: 706f 7028 742e 6c6f 7765 7228 2929 0d0a  pop(t.lower())..
-00050fa0: 2020 2020 2020 2020 7365 6c66 2e75 7064          self.upd
-00050fb0: 6174 655f 7461 6268 6561 6465 7228 290d  ate_tabheader().
-00050fc0: 0a0d 0a20 2020 2020 2020 2063 6861 746d  ...        chatm
-00050fd0: 6170 203d 207b 785b 2269 6422 5d3a 2078  ap = {x["id"]: x
-00050fe0: 2066 6f72 2078 2069 6e20 7365 6c66 2e63   for x in self.c
-00050ff0: 6861 7473 7d0d 0a20 2020 2020 2020 2063  hats}..        c
-00051000: 6861 7473 203d 207b 785b 2269 6422 5d3a  hats = {x["id"]:
-00051010: 2063 6861 746d 6170 5b78 5b22 6964 225d   chatmap[x["id"]
-00051020: 5d20 666f 7220 6320 696e 2063 6f6e 7461  ] for c in conta
-00051030: 6374 730d 0a20 2020 2020 2020 2020 2020  cts..           
-00051040: 2020 2020 2020 666f 7220 7820 696e 2063        for x in c
-00051050: 2e67 6574 2822 636f 6e76 6572 7361 7469  .get("conversati
-00051060: 6f6e 7322 2920 6f72 205b 5d20 6966 2078  ons") or [] if x
-00051070: 5b22 6964 225d 2069 6e20 6368 6174 6d61  ["id"] in chatma
-00051080: 707d 0d0a 2020 2020 2020 2020 6d75 6c74  p}..        mult
-00051090: 6963 6861 7473 2020 3d20 5b78 2066 6f72  ichats  = [x for
-000510a0: 2078 2069 6e20 6368 6174 732e 7661 6c75   x in chats.valu
-000510b0: 6573 2829 2069 6620 736b 7970 6564 6174  es() if skypedat
-000510c0: 612e 4348 4154 535f 5459 5045 5f53 494e  a.CHATS_TYPE_SIN
-000510d0: 474c 4520 213d 2078 5b22 7479 7065 225d  GLE != x["type"]
-000510e0: 5d0d 0a20 2020 2020 2020 2073 696e 676c  ]..        singl
-000510f0: 6563 6861 7473 203d 205b 7820 666f 7220  echats = [x for 
-00051100: 7820 696e 2063 6861 7473 2e76 616c 7565  x in chats.value
-00051110: 7328 2920 6966 2073 6b79 7065 6461 7461  s() if skypedata
-00051120: 2e43 4841 5453 5f54 5950 455f 5349 4e47  .CHATS_TYPE_SING
-00051130: 4c45 203d 3d20 785b 2274 7970 6522 5d5d  LE == x["type"]]
-00051140: 0d0a 2020 2020 2020 2020 6c6f 6767 6572  ..        logger
-00051150: 2e69 6e66 6f28 2243 433a 2025 7322 2c20  .info("CC: %s", 
-00051160: 5b28 785b 2269 6422 5d2c 2078 5b22 7469  [(x["id"], x["ti
-00051170: 746c 6522 5d29 2066 6f72 2078 2069 6e20  tle"]) for x in 
-00051180: 6368 6174 732e 7661 6c75 6573 2829 5d29  chats.values()])
-00051190: 0d0a 0d0a 2020 2020 2020 2020 6275 7379  ....        busy
-000511a0: 203d 2063 6f6e 7472 6f6c 732e 4275 7379   = controls.Busy
-000511b0: 5061 6e65 6c28 7365 6c66 2c20 2244 656c  Panel(self, "Del
-000511c0: 6574 696e 672e 2e22 290d 0a20 2020 2020  eting..")..     
-000511d0: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
-000511e0: 2020 2020 2069 6620 7365 6c66 2e63 6861       if self.cha
-000511f0: 7420 616e 6420 7365 6c66 2e63 6861 745b  t and self.chat[
-00051200: 2269 6422 5d20 696e 2063 6861 7473 3a0d  "id"] in chats:.
-00051210: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00051220: 2073 656c 662e 636c 6f73 655f 6368 6174   self.close_chat
-00051230: 2829 0d0a 0d0a 2020 2020 2020 2020 2020  ()....          
-00051240: 2020 7265 7375 6c74 203d 2073 656c 662e    result = self.
-00051250: 6462 2e64 656c 6574 655f 6461 7461 2873  db.delete_data(s
-00051260: 696e 676c 6563 6861 7473 2c20 636f 6e74  inglechats, cont
-00051270: 6163 7473 290d 0a20 2020 2020 2020 2020  acts)..         
-00051280: 2020 2062 7573 792e 436c 6f73 6528 290d     busy.Close().
-00051290: 0a20 2020 2020 2020 2020 2020 2062 7573  .            bus
-000512a0: 7920 3d20 636f 6e74 726f 6c73 2e42 7573  y = controls.Bus
-000512b0: 7950 616e 656c 2873 656c 662c 2022 5265  yPanel(self, "Re
-000512c0: 6672 6573 6869 6e67 2e2e 2229 0d0a 0d0a  freshing..")....
-000512d0: 2020 2020 2020 2020 2020 2020 6964 7873              idxs
-000512e0: 203d 205b 6920 666f 7220 6920 696e 2072   = [i for i in r
-000512f0: 616e 6765 2873 656c 662e 6c69 7374 5f63  ange(self.list_c
-00051300: 6861 7473 2e47 6574 4974 656d 436f 756e  hats.GetItemCoun
-00051310: 7428 2929 0d0a 2020 2020 2020 2020 2020  t())..          
-00051320: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-00051330: 662e 6c69 7374 5f63 6861 7473 2e47 6574  f.list_chats.Get
-00051340: 4974 656d 4d61 7070 6564 4461 7461 2869  ItemMappedData(i
-00051350: 2920 696e 2073 696e 676c 6563 6861 7473  ) in singlechats
-00051360: 5d0d 0a20 2020 2020 2020 2020 2020 2066  ]..            f
-00051370: 6f72 2069 6478 2069 6e20 6964 7873 5b3a  or idx in idxs[:
-00051380: 3a2d 315d 3a20 7365 6c66 2e6c 6973 745f  :-1]: self.list_
-00051390: 6368 6174 732e 4465 6c65 7465 4974 656d  chats.DeleteItem
-000513a0: 2869 6478 290d 0a20 2020 2020 2020 2020  (idx)..         
-000513b0: 2020 2073 656c 662e 6368 6174 7320 3d20     self.chats = 
-000513c0: 5b63 2066 6f72 2063 2069 6e20 7365 6c66  [c for c in self
-000513d0: 2e63 6861 7473 2069 6620 6320 6e6f 7420  .chats if c not 
-000513e0: 696e 2073 696e 676c 6563 6861 7473 5d0d  in singlechats].
-000513f0: 0a0d 0a20 2020 2020 2020 2020 2020 2069  ...            i
-00051400: 6478 7320 3d20 5b69 2066 6f72 2069 2069  dxs = [i for i i
-00051410: 6e20 7261 6e67 6528 7365 6c66 2e6c 6973  n range(self.lis
-00051420: 745f 636f 6e74 6163 7473 2e47 6574 4974  t_contacts.GetIt
-00051430: 656d 436f 756e 7428 2929 0d0a 2020 2020  emCount())..    
-00051440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051450: 6966 2073 656c 662e 6c69 7374 5f63 6f6e  if self.list_con
-00051460: 7461 6374 732e 4765 7449 7465 6d4d 6170  tacts.GetItemMap
-00051470: 7065 6444 6174 6128 6929 2069 6e20 636f  pedData(i) in co
-00051480: 6e74 6163 7473 5d0d 0a20 2020 2020 2020  ntacts]..       
-00051490: 2020 2020 2066 6f72 2069 6478 2069 6e20       for idx in 
-000514a0: 6964 7873 5b3a 3a2d 315d 3a20 7365 6c66  idxs[::-1]: self
-000514b0: 2e6c 6973 745f 636f 6e74 6163 7473 2e44  .list_contacts.D
-000514c0: 656c 6574 6549 7465 6d28 6964 7829 0d0a  eleteItem(idx)..
-000514d0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000514e0: 2e63 6f6e 7461 6374 7320 3d20 5b63 2066  .contacts = [c f
-000514f0: 6f72 2063 2069 6e20 7365 6c66 2e63 6f6e  or c in self.con
-00051500: 7461 6374 7320 6966 2063 206e 6f74 2069  tacts if c not i
-00051510: 6e20 636f 6e74 6163 7473 5d0d 0a0d 0a20  n contacts].... 
-00051520: 2020 2020 2020 2020 2020 2069 6620 6d75             if mu
-00051530: 6c74 6963 6861 7473 3a0d 0a20 2020 2020  ltichats:..     
-00051540: 2020 2020 2020 2020 2020 2069 6465 6e74             ident
-00051550: 6974 6965 7320 3d20 5b78 5b22 6964 656e  ities = [x["iden
-00051560: 7469 7479 225d 2066 6f72 2078 2069 6e20  tity"] for x in 
-00051570: 636f 6e74 6163 7473 5d0d 0a20 2020 2020  contacts]..     
-00051580: 2020 2020 2020 2020 2020 2066 6f72 2063             for c
-00051590: 6861 7420 696e 206d 756c 7469 6368 6174  hat in multichat
-000515a0: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
-000515b0: 2020 2020 2020 2020 6368 6174 5b22 7061          chat["pa
-000515c0: 7274 6963 6970 616e 7473 225d 203d 205b  rticipants"] = [
-000515d0: 7820 666f 7220 7820 696e 2063 6861 745b  x for x in chat[
-000515e0: 2270 6172 7469 6369 7061 6e74 7322 5d0d  "participants"].
-000515f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00051600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051610: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00051620: 785b 2269 6465 6e74 6974 7922 5d20 6e6f  x["identity"] no
-00051630: 7420 696e 2069 6465 6e74 6974 6965 735d  t in identities]
-00051640: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00051650: 2020 2020 2020 7065 6f70 6c65 203d 2073        people = s
-00051660: 6f72 7465 6428 5b70 5b22 6964 656e 7469  orted([p["identi
-00051670: 7479 225d 2066 6f72 2070 2069 6e20 6368  ty"] for p in ch
-00051680: 6174 5b22 7061 7274 6963 6970 616e 7473  at["participants
-00051690: 225d 5d29 0d0a 2020 2020 2020 2020 2020  "]])..          
-000516a0: 2020 2020 2020 2020 2020 6368 6174 5b22            chat["
-000516b0: 7065 6f70 6c65 225d 203d 2022 2573 2028  people"] = "%s (
-000516c0: 2573 2922 2025 2028 6c65 6e28 7065 6f70  %s)" % (len(peop
-000516d0: 6c65 292c 2022 2c20 222e 6a6f 696e 2870  le), ", ".join(p
-000516e0: 656f 706c 6529 290d 0a20 2020 2020 2020  eople))..       
-000516f0: 2020 2020 2020 2020 2073 656c 662e 6462           self.db
-00051700: 2e67 6574 5f63 6f6e 7665 7273 6174 696f  .get_conversatio
-00051710: 6e73 5f73 7461 7473 286d 756c 7469 6368  ns_stats(multich
-00051720: 6174 7329 0d0a 2020 2020 2020 2020 2020  ats)..          
-00051730: 2020 2020 2020 7365 6c66 2e6c 6973 745f        self.list_
-00051740: 6368 6174 732e 5265 6672 6573 6852 6f77  chats.RefreshRow
-00051750: 7328 290d 0a0d 0a20 2020 2020 2020 2020  s()....         
-00051760: 2020 2063 6f6e 7461 6374 735f 6166 6665     contacts_affe
-00051770: 6374 6564 203d 205b 6320 666f 7220 6320  cted = [c for c 
-00051780: 696e 205b 7365 6c66 2e64 622e 6163 636f  in [self.db.acco
-00051790: 756e 745d 202b 2073 656c 662e 636f 6e74  unt] + self.cont
-000517a0: 6163 7473 2069 6620 616e 7928 0d0a 2020  acts if any(..  
-000517b0: 2020 2020 2020 2020 2020 2020 2020 785b                x[
-000517c0: 2269 6422 5d20 696e 205b 795b 2269 6422  "id"] in [y["id"
-000517d0: 5d20 666f 7220 7920 696e 206d 756c 7469  ] for y in multi
-000517e0: 6368 6174 735d 2066 6f72 2078 2069 6e20  chats] for x in 
-000517f0: 632e 6765 7428 2263 6f6e 7665 7273 6174  c.get("conversat
-00051800: 696f 6e73 2229 206f 7220 5b5d 0d0a 2020  ions") or []..  
-00051810: 2020 2020 2020 2020 2020 295d 0d0a 2020            )]..  
-00051820: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
-00051830: 622e 6765 745f 636f 6e74 6163 7473 5f73  b.get_contacts_s
-00051840: 7461 7473 2863 6f6e 7461 6374 735f 6166  tats(contacts_af
-00051850: 6665 6374 6564 2c20 7365 6c66 2e63 6861  fected, self.cha
-00051860: 7473 290d 0a20 2020 2020 2020 2020 2020  ts)..           
-00051870: 2073 656c 662e 6c69 7374 5f63 6f6e 7461   self.list_conta
-00051880: 6374 732e 5265 6672 6573 6852 6f77 7328  cts.RefreshRows(
-00051890: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
-000518a0: 206c 626c 203d 2022 4126 6c6c 2063 6861   lbl = "A&ll cha
-000518b0: 7420 656e 7472 6965 7320 696e 2064 6174  t entries in dat
-000518c0: 6162 6173 6520 2825 7329 3a22 2025 2073  abase (%s):" % s
-000518d0: 656c 662e 6c69 7374 5f63 6861 7473 2e49  elf.list_chats.I
-000518e0: 7465 6d43 6f75 6e74 0d0a 2020 2020 2020  temCount..      
-000518f0: 2020 2020 2020 7365 6c66 2e6c 6162 656c        self.label
-00051900: 5f6c 6973 745f 6368 6174 732e 4c61 6265  _list_chats.Labe
-00051910: 6c20 3d20 6c62 6c0d 0a20 2020 2020 2020  l = lbl..       
-00051920: 2020 2020 206c 626c 203d 2022 4126 6c6c       lbl = "A&ll
-00051930: 2070 726f 6669 6c65 7320 696e 2064 6174   profiles in dat
-00051940: 6162 6173 6520 2825 7329 3a22 2025 2073  abase (%s):" % s
-00051950: 656c 662e 6c69 7374 5f63 6f6e 7461 6374  elf.list_contact
-00051960: 732e 4974 656d 436f 756e 740d 0a20 2020  s.ItemCount..   
-00051970: 2020 2020 2020 2020 2073 656c 662e 6c61           self.la
-00051980: 6265 6c5f 6c69 7374 5f63 6f6e 7461 6374  bel_list_contact
-00051990: 732e 4c61 6265 6c20 3d20 6c62 6c0d 0a0d  s.Label = lbl...
-000519a0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000519b0: 662e 6c6f 6164 5f63 6f6e 7461 6374 284e  f.load_contact(N
-000519c0: 6f6e 6520 6966 2073 656c 662e 636f 6e74  one if self.cont
-000519d0: 6163 7420 696e 2063 6f6e 7461 6374 7320  act in contacts 
-000519e0: 656c 7365 2073 656c 662e 636f 6e74 6163  else self.contac
-000519f0: 7429 0d0a 2020 2020 2020 2020 2020 2020  t)..            
-00051a00: 7365 6c66 2e6f 6e5f 7265 6672 6573 685f  self.on_refresh_
-00051a10: 7461 626c 6573 2829 0d0a 2020 2020 2020  tables()..      
-00051a20: 2020 2020 2020 7778 2e43 616c 6c41 6674        wx.CallAft
-00051a30: 6572 2873 656c 662e 7570 6461 7465 5f69  er(self.update_i
-00051a40: 6e66 6f5f 7061 6765 290d 0a20 2020 2020  nfo_page)..     
-00051a50: 2020 2020 2020 2077 782e 4361 6c6c 4166         wx.CallAf
-00051a60: 7465 7228 7365 6c66 2e54 6f70 4c65 7665  ter(self.TopLeve
-00051a70: 6c50 6172 656e 742e 7570 6461 7465 5f64  lParent.update_d
-00051a80: 6174 6162 6173 655f 6465 7461 696c 290d  atabase_detail).
-00051a90: 0a20 2020 2020 2020 2020 2020 2062 7573  .            bus
-00051aa0: 792e 436c 6f73 6528 290d 0a0d 0a20 2020  y.Close()....   
-00051ab0: 2020 2020 2020 2020 204d 4149 4e53 203d           MAINS =
-00051ac0: 205b 2243 6f6e 7461 6374 7322 2c20 2243   ["Contacts", "C
-00051ad0: 6f6e 7665 7273 6174 696f 6e73 222c 2022  onversations", "
-00051ae0: 4d65 7373 6167 6573 225d 0d0a 2020 2020  Messages"]..    
-00051af0: 2020 2020 2020 2020 696e 666f 7465 7874          infotext
-00051b00: 203d 2022 2061 6e64 2022 2e6a 6f69 6e28   = " and ".join(
-00051b10: 7574 696c 2e70 6c75 7261 6c28 742e 6c6f  util.plural(t.lo
-00051b20: 7765 7228 295b 3a2d 315d 2c20 7265 7375  wer()[:-1], resu
-00051b30: 6c74 5b74 5d29 0d0a 2020 2020 2020 2020  lt[t])..        
-00051b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051b50: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00051b60: 7420 696e 204d 4149 4e53 2069 6620 7265  t in MAINS if re
-00051b70: 7375 6c74 2e67 6574 2874 2929 0d0a 2020  sult.get(t))..  
-00051b80: 2020 2020 2020 2020 2020 6f74 6865 7263            otherc
-00051b90: 6f75 6e74 203d 2073 756d 2872 6573 756c  ount = sum(resul
-00051ba0: 745b 745d 2066 6f72 2074 2069 6e20 7265  t[t] for t in re
-00051bb0: 7375 6c74 2069 6620 7420 6e6f 7420 696e  sult if t not in
-00051bc0: 204d 4149 4e53 290d 0a20 2020 2020 2020   MAINS)..       
-00051bd0: 2020 2020 2069 6620 6f74 6865 7263 6f75       if othercou
-00051be0: 6e74 3a0d 0a20 2020 2020 2020 2020 2020  nt:..           
-00051bf0: 2020 2020 2069 6e66 6f74 6578 7420 2b3d       infotext +=
-00051c00: 2022 2028 616e 6420 2573 2922 2025 2075   " (and %s)" % u
-00051c10: 7469 6c2e 706c 7572 616c 2822 7265 6c61  til.plural("rela
-00051c20: 7465 6420 726f 7722 2c20 6f74 6865 7263  ted row", otherc
-00051c30: 6f75 6e74 290d 0a20 2020 2020 2020 2020  ount)..         
-00051c40: 2020 2067 7569 6261 7365 2e73 7461 7475     guibase.statu
-00051c50: 7328 2244 656c 6574 6564 2025 7320 6672  s("Deleted %s fr
-00051c60: 6f6d 2025 732e 222c 2069 6e66 6f74 6578  om %s.", infotex
-00051c70: 742c 2073 656c 662e 6462 2c20 6c6f 673d  t, self.db, log=
-00051c80: 5472 7565 290d 0a20 2020 2020 2020 2020  True)..         
-00051c90: 2020 2077 782e 4d65 7373 6167 6542 6f78     wx.MessageBox
-00051ca0: 2822 4465 6c65 7465 6420 2573 2e22 2025  ("Deleted %s." %
-00051cb0: 2069 6e66 6f74 6578 742c 2063 6f6e 662e   infotext, conf.
-00051cc0: 5469 746c 652c 2077 782e 4943 4f4e 5f49  Title, wx.ICON_I
-00051cd0: 4e46 4f52 4d41 5449 4f4e 290d 0a20 2020  NFORMATION)..   
-00051ce0: 2020 2020 2066 696e 616c 6c79 3a20 6275       finally: bu
-00051cf0: 7379 2e43 6c6f 7365 2829 0d0a 0d0a 0d0a  sy.Close()......
-00051d00: 2020 2020 6465 6620 6f6e 5f73 6f72 745f      def on_sort_
-00051d10: 6772 6964 5f63 6f6c 756d 6e28 7365 6c66  grid_column(self
-00051d20: 2c20 6576 656e 7429 3a0d 0a20 2020 2020  , event):..     
-00051d30: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
-00051d40: 4861 6e64 6c65 7220 666f 7220 636c 6963  Handler for clic
-00051d50: 6b69 6e67 2061 2074 6162 6c65 2067 7269  king a table gri
-00051d60: 6420 636f 6c75 6d6e 2c20 736f 7274 7320  d column, sorts 
-00051d70: 7461 626c 6520 6279 2074 6865 2063 6f6c  table by the col
-00051d80: 756d 6e2e 0d0a 2020 2020 2020 2020 2222  umn...        ""
-00051d90: 220d 0a20 2020 2020 2020 2067 7269 6420  "..        grid 
-00051da0: 3d20 6576 656e 742e 4765 7445 7665 6e74  = event.GetEvent
-00051db0: 4f62 6a65 6374 2829 0d0a 2020 2020 2020  Object()..      
-00051dc0: 2020 6966 2067 7269 642e 5461 626c 6520    if grid.Table 
-00051dd0: 616e 6420 6973 696e 7374 616e 6365 2867  and isinstance(g
-00051de0: 7269 642e 5461 626c 652c 2053 716c 6974  rid.Table, Sqlit
-00051df0: 6547 7269 6442 6173 6529 3a0d 0a20 2020  eGridBase):..   
-00051e00: 2020 2020 2020 2020 2072 6f77 2c20 636f           row, co
-00051e10: 6c20 3d20 6576 656e 742e 4765 7452 6f77  l = event.GetRow
-00051e20: 2829 2c20 6576 656e 742e 4765 7443 6f6c  (), event.GetCol
-00051e30: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
-00051e40: 2320 5265 6d65 6d62 6572 2073 6372 6f6c  # Remember scrol
-00051e50: 6c20 706f 7369 7469 6f6e 732c 2061 7320  l positions, as 
-00051e60: 6772 6964 2075 7064 6174 6520 6c6f 7365  grid update lose
-00051e70: 7320 7468 656d 0d0a 2020 2020 2020 2020  s them..        
-00051e80: 2020 2020 7363 726f 6c6c 5f68 6f72 203d      scroll_hor =
-00051e90: 2067 7269 642e 4765 7453 6372 6f6c 6c50   grid.GetScrollP
-00051ea0: 6f73 2877 782e 484f 5249 5a4f 4e54 414c  os(wx.HORIZONTAL
-00051eb0: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
-00051ec0: 6372 6f6c 6c5f 7665 7220 3d20 6772 6964  croll_ver = grid
-00051ed0: 2e47 6574 5363 726f 6c6c 506f 7328 7778  .GetScrollPos(wx
-00051ee0: 2e56 4552 5449 4341 4c29 0d0a 2020 2020  .VERTICAL)..    
-00051ef0: 2020 2020 2020 2020 6966 2072 6f77 203c          if row <
-00051f00: 2030 3a20 2320 4f6e 6c79 2072 6561 6374   0: # Only react
-00051f10: 2074 6f20 636c 6963 6b73 2069 6e20 7468   to clicks in th
-00051f20: 6520 6865 6164 6572 0d0a 2020 2020 2020  e header..      
-00051f30: 2020 2020 2020 2020 2020 6772 6964 2e54            grid.T
-00051f40: 6162 6c65 2e53 6f72 7443 6f6c 756d 6e28  able.SortColumn(
-00051f50: 636f 6c29 0d0a 2020 2020 2020 2020 2020  col)..          
-00051f60: 2020 6772 6964 2e43 6f6e 7461 696e 696e    grid.Containin
-00051f70: 6753 697a 6572 2e4c 6179 6f75 7428 2920  gSizer.Layout() 
-00051f80: 2320 5265 6163 7420 746f 2067 7269 6420  # React to grid 
-00051f90: 7369 7a65 2063 6861 6e67 650d 0a20 2020  size change..   
-00051fa0: 2020 2020 2020 2020 2067 7269 642e 5363           grid.Sc
-00051fb0: 726f 6c6c 2873 6372 6f6c 6c5f 686f 722c  roll(scroll_hor,
-00051fc0: 2073 6372 6f6c 6c5f 7665 7229 0d0a 0d0a   scroll_ver)....
-00051fd0: 0d0a 2020 2020 6465 6620 6f6e 5f66 696c  ..    def on_fil
-00051fe0: 7465 725f 6772 6964 5f63 6f6c 756d 6e28  ter_grid_column(
-00051ff0: 7365 6c66 2c20 6576 656e 7429 3a0d 0a20  self, event):.. 
-00052000: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
-00052010: 2020 2020 4861 6e64 6c65 7220 666f 7220      Handler for 
-00052020: 7269 6768 742d 636c 6963 6b69 6e67 2061  right-clicking a
-00052030: 2074 6162 6c65 2067 7269 6420 636f 6c75   table grid colu
-00052040: 6d6e 2c20 6c65 7473 2074 6865 2075 7365  mn, lets the use
-00052050: 720d 0a20 2020 2020 2020 2063 6861 6e67  r..        chang
-00052060: 6520 7468 6520 636f 6c75 6d6e 2066 696c  e the column fil
-00052070: 7465 722e 0d0a 2020 2020 2020 2020 2222  ter...        ""
-00052080: 220d 0a20 2020 2020 2020 2067 7269 6420  "..        grid 
-00052090: 3d20 6576 656e 742e 4765 7445 7665 6e74  = event.GetEvent
-000520a0: 4f62 6a65 6374 2829 0d0a 2020 2020 2020  Object()..      
-000520b0: 2020 6966 2067 7269 642e 5461 626c 6520    if grid.Table 
-000520c0: 616e 6420 6973 696e 7374 616e 6365 2867  and isinstance(g
-000520d0: 7269 642e 5461 626c 652c 2053 716c 6974  rid.Table, Sqlit
-000520e0: 6547 7269 6442 6173 6529 3a0d 0a20 2020  eGridBase):..   
-000520f0: 2020 2020 2020 2020 2072 6f77 2c20 636f           row, co
-00052100: 6c20 3d20 6576 656e 742e 4765 7452 6f77  l = event.GetRow
-00052110: 2829 2c20 6576 656e 742e 4765 7443 6f6c  (), event.GetCol
-00052120: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
-00052130: 2320 5265 6d65 6d62 6572 2073 6372 6f6c  # Remember scrol
-00052140: 6c20 706f 7369 7469 6f6e 732c 2061 7320  l positions, as 
-00052150: 6772 6964 2075 7064 6174 6520 6c6f 7365  grid update lose
-00052160: 7320 7468 656d 0d0a 2020 2020 2020 2020  s them..        
-00052170: 2020 2020 6966 2072 6f77 203c 2030 3a20      if row < 0: 
-00052180: 2320 4f6e 6c79 2072 6561 6374 2074 6f20  # Only react to 
-00052190: 636c 6963 6b73 2069 6e20 7468 6520 6865  clicks in the he
-000521a0: 6164 6572 0d0a 2020 2020 2020 2020 2020  ader..          
-000521b0: 2020 2020 2020 6772 6964 5f64 6174 6120        grid_data 
-000521c0: 3d20 6772 6964 2e54 6162 6c65 0d0a 2020  = grid.Table..  
-000521d0: 2020 2020 2020 2020 2020 2020 2020 6375                cu
-000521e0: 7272 656e 745f 6669 6c74 6572 203d 2075  rrent_filter = u
-000521f0: 7469 6c2e 746f 5f75 6e69 636f 6465 2867  til.to_unicode(g
-00052200: 7269 645f 6461 7461 2e66 696c 7465 7273  rid_data.filters
-00052210: 5b63 6f6c 5d29 205c 0d0a 2020 2020 2020  [col]) \..      
-00052220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052230: 2020 2020 2020 2020 2020 2069 6620 636f             if co
-00052240: 6c20 696e 2067 7269 645f 6461 7461 2e66  l in grid_data.f
-00052250: 696c 7465 7273 2065 6c73 6520 2222 0d0a  ilters else ""..
-00052260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052270: 6469 616c 6f67 203d 2077 782e 5465 7874  dialog = wx.Text
-00052280: 456e 7472 7944 6961 6c6f 6728 7365 6c66  EntryDialog(self
-00052290: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-000522a0: 2020 2020 2020 2022 4669 6c74 6572 2063         "Filter c
-000522b0: 6f6c 756d 6e20 5c22 2573 5c22 2062 793a  olumn \"%s\" by:
-000522c0: 2220 2520 6772 6964 5f64 6174 612e 636f  " % grid_data.co
-000522d0: 6c75 6d6e 735b 636f 6c5d 5b22 6e61 6d65  lumns[col]["name
-000522e0: 225d 2c0d 0a20 2020 2020 2020 2020 2020  "],..           
-000522f0: 2020 2020 2020 2020 2022 4669 6c74 6572           "Filter
-00052300: 222c 2076 616c 7565 3d63 7572 7265 6e74  ", value=current
-00052310: 5f66 696c 7465 722c 0d0a 2020 2020 2020  _filter,..      
-00052320: 2020 2020 2020 2020 2020 2020 2020 7374                st
-00052330: 796c 653d 7778 2e4f 4b20 7c20 7778 2e43  yle=wx.OK | wx.C
-00052340: 414e 4345 4c29 0d0a 2020 2020 2020 2020  ANCEL)..        
-00052350: 2020 2020 2020 2020 6966 2077 782e 4944          if wx.ID
-00052360: 5f4f 4b20 3d3d 2064 6961 6c6f 672e 5368  _OK == dialog.Sh
-00052370: 6f77 4d6f 6461 6c28 293a 0d0a 2020 2020  owModal():..    
-00052380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052390: 6e65 775f 6669 6c74 6572 203d 2064 6961  new_filter = dia
-000523a0: 6c6f 672e 4765 7456 616c 7565 2829 0d0a  log.GetValue()..
-000523b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000523c0: 2020 2020 6966 206c 656e 286e 6577 5f66      if len(new_f
-000523d0: 696c 7465 7229 3a0d 0a20 2020 2020 2020  ilter):..       
-000523e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000523f0: 2062 7573 7920 3d20 636f 6e74 726f 6c73   busy = controls
-00052400: 2e42 7573 7950 616e 656c 2873 656c 662e  .BusyPanel(self.
-00052410: 7061 6765 5f74 6162 6c65 732c 0d0a 2020  page_tables,..  
-00052420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052430: 2020 2020 2020 2020 2020 2246 696c 7465            "Filte
-00052440: 7269 6e67 2063 6f6c 756d 6e20 5c22 2573  ring column \"%s
-00052450: 5c22 2062 7920 5c22 2573 5c22 2e22 2025  \" by \"%s\"." %
-00052460: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00052470: 2020 2020 2020 2020 2020 2020 2020 2867                (g
-00052480: 7269 645f 6461 7461 2e63 6f6c 756d 6e73  rid_data.columns
-00052490: 5b63 6f6c 5d5b 226e 616d 6522 5d2c 206e  [col]["name"], n
-000524a0: 6577 5f66 696c 7465 7229 290d 0a20 2020  ew_filter))..   
-000524b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000524c0: 2020 2020 2067 7269 645f 6461 7461 2e41       grid_data.A
-000524d0: 6464 4669 6c74 6572 2863 6f6c 2c20 6e65  ddFilter(col, ne
-000524e0: 775f 6669 6c74 6572 290d 0a20 2020 2020  w_filter)..     
-000524f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052500: 2020 2062 7573 792e 436c 6f73 6528 290d     busy.Close().
-00052510: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00052520: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-00052530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052540: 2020 2020 6772 6964 5f64 6174 612e 5265      grid_data.Re
-00052550: 6d6f 7665 4669 6c74 6572 2863 6f6c 290d  moveFilter(col).
-00052560: 0a20 2020 2020 2020 2020 2020 2067 7269  .            gri
-00052570: 642e 436f 6e74 6169 6e69 6e67 5369 7a65  d.ContainingSize
-00052580: 722e 4c61 796f 7574 2829 2023 2052 6561  r.Layout() # Rea
-00052590: 6374 2074 6f20 6772 6964 2073 697a 6520  ct to grid size 
-000525a0: 6368 616e 6765 0d0a 0d0a 0d0a 2020 2020  change......    
-000525b0: 6465 6620 6c6f 6164 5f64 6174 6128 7365  def load_data(se
-000525c0: 6c66 293a 0d0a 2020 2020 2020 2020 2222  lf):..        ""
-000525d0: 224c 6f61 6473 2064 6174 6120 6672 6f6d  "Loads data from
-000525e0: 206f 7572 2053 6b79 7065 4461 7461 6261   our SkypeDataba
-000525f0: 7365 2e22 2222 0d0a 2020 2020 2020 2020  se."""..        
-00052600: 7365 6c66 2e6c 6162 656c 5f74 6974 6c65  self.label_title
-00052610: 2e4c 6162 656c 203d 2022 4461 7461 6261  .Label = "Databa
-00052620: 7365 205c 2225 735c 223a 2220 2520 7365  se \"%s\":" % se
-00052630: 6c66 2e64 620d 0a0d 0a20 2020 2020 2020  lf.db....       
-00052640: 2074 7279 3a0d 0a20 2020 2020 2020 2020   try:..         
-00052650: 2020 2023 2052 6573 746f 7265 206c 6173     # Restore las
-00052660: 7420 7365 6172 6368 2074 6578 742c 2069  t search text, i
-00052670: 6620 616e 790d 0a20 2020 2020 2020 2020  f any..         
-00052680: 2020 2069 6620 636f 6e66 2e53 6561 7263     if conf.Searc
-00052690: 6848 6973 746f 7279 2061 6e64 2063 6f6e  hHistory and con
-000526a0: 662e 5365 6172 6368 4869 7374 6f72 795b  f.SearchHistory[
-000526b0: 2d31 5d20 213d 2022 223a 0d0a 2020 2020  -1] != "":..    
-000526c0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000526d0: 2e65 6469 745f 7365 6172 6368 616c 6c2e  .edit_searchall.
-000526e0: 5661 6c75 6520 3d20 636f 6e66 2e53 6561  Value = conf.Sea
-000526f0: 7263 6848 6973 746f 7279 5b2d 315d 0d0a  rchHistory[-1]..
-00052700: 2020 2020 2020 2020 2020 2020 6966 2063              if c
-00052710: 6f6e 662e 5365 6172 6368 4869 7374 6f72  onf.SearchHistor
-00052720: 7920 616e 6420 636f 6e66 2e53 6561 7263  y and conf.Searc
-00052730: 6848 6973 746f 7279 5b2d 315d 203d 3d20  hHistory[-1] == 
-00052740: 2222 3a0d 0a20 2020 2020 2020 2020 2020  "":..           
-00052750: 2020 2020 2023 2043 6c65 6172 2074 6865       # Clear the
-00052760: 2065 6d70 7479 2073 6561 7263 6820 666c   empty search fl
-00052770: 6167 0d0a 2020 2020 2020 2020 2020 2020  ag..            
-00052780: 2020 2020 636f 6e66 2e53 6561 7263 6848      conf.SearchH
-00052790: 6973 746f 7279 203d 2063 6f6e 662e 5365  istory = conf.Se
-000527a0: 6172 6368 4869 7374 6f72 795b 3a2d 315d  archHistory[:-1]
-000527b0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-000527c0: 6c66 2e65 6469 745f 7365 6172 6368 616c  lf.edit_searchal
-000527d0: 6c2e 5365 7443 686f 6963 6573 2863 6f6e  l.SetChoices(con
-000527e0: 662e 5365 6172 6368 4869 7374 6f72 7929  f.SearchHistory)
-000527f0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-00052800: 2320 5265 7374 6f72 6520 6c61 7374 2063  # Restore last c
-00052810: 6163 6865 6420 7365 6172 6368 2072 6573  ached search res
-00052820: 756c 7473 2070 6167 650d 0a20 2020 2020  ults page..     
-00052830: 2020 2020 2020 206c 6173 745f 7365 6172         last_sear
-00052840: 6368 203d 2063 6f6e 662e 4c61 7374 5365  ch = conf.LastSe
-00052850: 6172 6368 5265 7375 6c74 732e 6765 7428  archResults.get(
-00052860: 7365 6c66 2e64 622e 6669 6c65 6e61 6d65  self.db.filename
-00052870: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
-00052880: 6620 6c61 7374 5f73 6561 7263 683a 0d0a  f last_search:..
-00052890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000528a0: 7469 746c 6520 3d20 6c61 7374 5f73 6561  title = last_sea
-000528b0: 7263 682e 6765 7428 2274 6974 6c65 222c  rch.get("title",
-000528c0: 2022 2229 0d0a 2020 2020 2020 2020 2020   "")..          
-000528d0: 2020 2020 2020 6874 6d6c 203d 206c 6173        html = las
-000528e0: 745f 7365 6172 6368 2e67 6574 2822 636f  t_search.get("co
-000528f0: 6e74 656e 7422 2c20 2222 290d 0a20 2020  ntent", "")..   
-00052900: 2020 2020 2020 2020 2020 2020 2069 6e66               inf
-00052910: 6f20 3d20 6c61 7374 5f73 6561 7263 682e  o = last_search.
-00052920: 6765 7428 2269 6e66 6f22 290d 0a20 2020  get("info")..   
-00052930: 2020 2020 2020 2020 2020 2020 2074 6162               tab
-00052940: 6964 203d 2073 656c 662e 636f 756e 7465  id = self.counte
-00052950: 7228 2920 6966 2030 2021 3d20 6c61 7374  r() if 0 != last
-00052960: 5f73 6561 7263 682e 6765 7428 2269 6422  _search.get("id"
-00052970: 2920 656c 7365 2030 0d0a 2020 2020 2020  ) else 0..      
-00052980: 2020 2020 2020 2020 2020 7365 6c66 2e68            self.h
-00052990: 746d 6c5f 7365 6172 6368 616c 6c2e 496e  tml_searchall.In
-000529a0: 7365 7274 5461 6228 302c 2074 6974 6c65  sertTab(0, title
-000529b0: 2c20 7461 6269 642c 2068 746d 6c2c 2069  , tabid, html, i
-000529c0: 6e66 6f29 0d0a 0d0a 2020 2020 2020 2020  nfo)....        
-000529d0: 2020 2020 2320 4869 6465 2072 656e 616d      # Hide renam
-000529e0: 652d 6275 7474 6f6e 2069 6620 6769 7665  e-button if give
-000529f0: 6e5f 6469 7370 6c61 796e 616d 6520 6e6f  n_displayname no
-00052a00: 7420 6176 6169 6c61 626c 650d 0a20 2020  t available..   
-00052a10: 2020 2020 2020 2020 2063 6861 745f 636f           chat_co
-00052a20: 6c73 203d 2073 656c 662e 6462 2e67 6574  ls = self.db.get
-00052a30: 5f74 6162 6c65 5f63 6f6c 756d 6e73 2822  _table_columns("
-00052a40: 636f 6e76 6572 7361 7469 6f6e 7322 290d  conversations").
-00052a50: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
-00052a60: 7461 6374 5f63 6f6c 7320 3d20 7365 6c66  tact_cols = self
-00052a70: 2e64 622e 6765 745f 7461 626c 655f 636f  .db.get_table_co
-00052a80: 6c75 6d6e 7328 2263 6f6e 7461 6374 7322  lumns("contacts"
-00052a90: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
-00052aa0: 6620 206e 6f74 2061 6e79 2878 5b22 6e61  f  not any(x["na
-00052ab0: 6d65 225d 203d 3d20 2267 6976 656e 5f64  me"] == "given_d
-00052ac0: 6973 706c 6179 6e61 6d65 2220 666f 7220  isplayname" for 
-00052ad0: 7820 696e 2063 6861 745f 636f 6c73 2920  x in chat_cols) 
-00052ae0: 5c0d 0a20 2020 2020 2020 2020 2020 2061  \..            a
-00052af0: 6e64 206e 6f74 2061 6e79 2878 5b22 6e61  nd not any(x["na
-00052b00: 6d65 225d 203d 3d20 2267 6976 656e 5f64  me"] == "given_d
-00052b10: 6973 706c 6179 6e61 6d65 2220 666f 7220  isplayname" for 
-00052b20: 7820 696e 2063 6f6e 7461 6374 5f63 6f6c  x in contact_col
-00052b30: 7329 3a0d 0a20 2020 2020 2020 2020 2020  s):..           
-00052b40: 2020 2020 2073 656c 662e 6275 7474 6f6e       self.button
-00052b50: 5f72 656e 616d 652e 4469 7361 626c 6528  _rename.Disable(
-00052b60: 292c 2073 656c 662e 6275 7474 6f6e 5f72  ), self.button_r
-00052b70: 656e 616d 652e 4869 6465 2829 0d0a 0d0a  ename.Hide()....
-00052b80: 2020 2020 2020 2020 2020 2020 2320 506f              # Po
-00052b90: 7075 6c61 7465 2074 6865 2063 6861 7473  pulate the chats
-00052ba0: 206c 6973 740d 0a20 2020 2020 2020 2020   list..         
-00052bb0: 2020 2073 656c 662e 6368 6174 7320 3d20     self.chats = 
-00052bc0: 7365 6c66 2e64 622e 6765 745f 636f 6e76  self.db.get_conv
-00052bd0: 6572 7361 7469 6f6e 7328 290d 0a20 2020  ersations()..   
-00052be0: 2020 2020 2020 2020 2073 656c 662e 6c69           self.li
-00052bf0: 7374 5f63 6861 7473 2e50 6f70 756c 6174  st_chats.Populat
-00052c00: 6528 7365 6c66 2e63 6861 7473 290d 0a20  e(self.chats).. 
-00052c10: 2020 2020 2020 2020 2020 206c 626c 203d             lbl =
-00052c20: 2022 4126 6c6c 2063 6861 7420 656e 7472   "A&ll chat entr
-00052c30: 6965 7320 696e 2064 6174 6162 6173 6520  ies in database 
-00052c40: 2825 7329 3a22 2025 2073 656c 662e 6c69  (%s):" % self.li
-00052c50: 7374 5f63 6861 7473 2e49 7465 6d43 6f75  st_chats.ItemCou
-00052c60: 6e74 0d0a 2020 2020 2020 2020 2020 2020  nt..            
-00052c70: 7365 6c66 2e6c 6162 656c 5f6c 6973 745f  self.label_list_
-00052c80: 6368 6174 732e 4c61 6265 6c20 3d20 6c62  chats.Label = lb
-00052c90: 6c0d 0a0d 0a20 2020 2020 2020 2020 2020  l....           
-00052ca0: 2023 2050 6f70 756c 6174 6520 7468 6520   # Populate the 
-00052cb0: 636f 6e74 6163 7473 206c 6973 740d 0a20  contacts list.. 
-00052cc0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00052cd0: 636f 6e74 6163 7473 203d 2073 656c 662e  contacts = self.
-00052ce0: 6462 2e67 6574 5f63 6f6e 7461 6374 7328  db.get_contacts(
-00052cf0: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
-00052d00: 656c 662e 6c69 7374 5f63 6f6e 7461 6374  elf.list_contact
-00052d10: 732e 506f 7075 6c61 7465 285b 7365 6c66  s.Populate([self
-00052d20: 2e64 622e 6163 636f 756e 745d 202b 2073  .db.account] + s
-00052d30: 656c 662e 636f 6e74 6163 7473 290d 0a20  elf.contacts).. 
-00052d40: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00052d50: 6c69 7374 5f63 6f6e 7461 6374 732e 5365  list_contacts.Se
-00052d60: 7443 6f6c 756d 6e57 6964 7468 2830 2c20  tColumnWidth(0, 
-00052d70: 3135 3029 0d0a 2020 2020 2020 2020 2020  150)..          
-00052d80: 2020 7365 6c66 2e6c 6973 745f 636f 6e74    self.list_cont
-00052d90: 6163 7473 2e53 6574 436f 6c75 6d6e 5769  acts.SetColumnWi
-00052da0: 6474 6828 312c 2032 3530 290d 0a20 2020  dth(1, 250)..   
-00052db0: 2020 2020 2020 2020 206c 626c 203d 2022           lbl = "
-00052dc0: 4126 6c6c 2070 726f 6669 6c65 7320 696e  A&ll profiles in
-00052dd0: 2064 6174 6162 6173 6520 2825 7329 3a22   database (%s):"
-00052de0: 2025 2073 656c 662e 6c69 7374 5f63 6f6e   % self.list_con
-00052df0: 7461 6374 732e 4974 656d 436f 756e 740d  tacts.ItemCount.
-00052e00: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00052e10: 662e 6c61 6265 6c5f 6c69 7374 5f63 6f6e  f.label_list_con
-00052e20: 7461 6374 732e 4c61 6265 6c20 3d20 6c62  tacts.Label = lb
-00052e30: 6c0d 0a0d 0a20 2020 2020 2020 2020 2020  l....           
-00052e40: 2077 782e 4361 6c6c 4c61 7465 7228 3130   wx.CallLater(10
-00052e50: 302c 2073 656c 662e 6c6f 6164 5f6c 6174  0, self.load_lat
-00052e60: 6572 5f64 6174 6129 0d0a 2020 2020 2020  er_data)..      
-00052e70: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
-00052e80: 6f6e 3a0d 0a20 2020 2020 2020 2020 2020  on:..           
-00052e90: 2077 782e 4361 6c6c 4166 7465 7228 7365   wx.CallAfter(se
-00052ea0: 6c66 2e75 7064 6174 655f 7461 6268 6561  lf.update_tabhea
-00052eb0: 6465 7229 0d0a 2020 2020 2020 2020 2020  der)..          
-00052ec0: 2020 6775 6962 6173 652e 7374 6174 7573    guibase.status
-00052ed0: 2822 436f 756c 6420 6e6f 7420 6c6f 6164  ("Could not load
-00052ee0: 2063 6861 7420 6c69 7374 2066 726f 6d20   chat list from 
-00052ef0: 2573 2e22 2c20 7365 6c66 2e64 6229 0d0a  %s.", self.db)..
-00052f00: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
-00052f10: 6572 2e65 7863 6570 7469 6f6e 2822 436f  er.exception("Co
-00052f20: 756c 6420 6e6f 7420 6c6f 6164 2063 6861  uld not load cha
-00052f30: 7420 6c69 7374 2066 726f 6d20 2573 2e22  t list from %s."
-00052f40: 2c20 7365 6c66 2e64 6229 0d0a 2020 2020  , self.db)..    
-00052f50: 2020 2020 7778 2e43 616c 6c4c 6174 6572      wx.CallLater
-00052f60: 2835 3030 2c20 7365 6c66 2e75 7064 6174  (500, self.updat
-00052f70: 655f 696e 666f 5f70 6167 652c 2046 616c  e_info_page, Fal
-00052f80: 7365 290d 0a20 2020 2020 2020 2077 782e  se)..        wx.
-00052f90: 4361 6c6c 4c61 7465 7228 3230 302c 2073  CallLater(200, s
-00052fa0: 656c 662e 6c6f 6164 5f74 6162 6c65 735f  elf.load_tables_
-00052fb0: 6461 7461 290d 0a20 2020 2020 2020 2073  data)..        s
-00052fc0: 656c 662e 7570 6461 7465 5f6c 6976 6569  elf.update_livei
-00052fd0: 6e66 6f28 290d 0a20 2020 2020 2020 2069  nfo()..        i
-00052fe0: 6620 636f 6e66 2e4c 6f67 696e 2e67 6574  f conf.Login.get
-00052ff0: 2873 656c 662e 6462 2e66 696c 656e 616d  (self.db.filenam
-00053000: 652c 207b 7d29 2e67 6574 2822 6175 746f  e, {}).get("auto
-00053010: 2229 3a0d 0a20 2020 2020 2020 2020 2020  "):..           
-00053020: 2077 782e 4361 6c6c 4c61 7465 7228 3130   wx.CallLater(10
-00053030: 3030 2c20 7365 6c66 2e6f 6e5f 6c69 7665  00, self.on_live
-00053040: 5f6c 6f67 696e 2c20 7379 6e63 3d63 6f6e  _login, sync=con
-00053050: 662e 4c6f 6769 6e5b 7365 6c66 2e64 622e  f.Login[self.db.
-00053060: 6669 6c65 6e61 6d65 5d2e 6765 7428 2273  filename].get("s
-00053070: 796e 6322 2929 0d0a 0d0a 0d0a 2020 2020  ync"))......    
-00053080: 6465 6620 6c6f 6164 5f6c 6174 6572 5f64  def load_later_d
-00053090: 6174 6128 7365 6c66 293a 0d0a 2020 2020  ata(self):..    
-000530a0: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
-000530b0: 204c 6f61 6473 206c 6174 6572 2064 6174   Loads later dat
-000530c0: 6120 6672 6f6d 2074 6865 2064 6174 6162  a from the datab
-000530d0: 6173 652c 206c 696b 6520 7461 626c 6520  ase, like table 
-000530e0: 6d65 7461 696e 666f 726d 6174 696f 6e20  metainformation 
-000530f0: 616e 640d 0a20 2020 2020 2020 2073 7461  and..        sta
-00053100: 7469 7374 6963 7320 666f 7220 616c 6c20  tistics for all 
-00053110: 6368 6174 732c 2075 7365 6420 6173 2061  chats, used as a
-00053120: 2062 6163 6b67 726f 756e 6420 6361 6c6c   background call
-00053130: 6261 636b 2074 6f20 7370 6565 640d 0a20  back to speed.. 
-00053140: 2020 2020 2020 2075 7020 7061 6765 206f         up page o
-00053150: 7065 6e69 6e67 2e0d 0a20 2020 2020 2020  pening...       
-00053160: 2022 2222 0d0a 2020 2020 2020 2020 6966   """..        if
-00053170: 206e 6f74 2073 656c 663a 2072 6574 7572   not self: retur
-00053180: 6e0d 0a0d 0a20 2020 2020 2020 2074 7279  n....        try
-00053190: 3a0d 0a20 2020 2020 2020 2020 2020 2023  :..            #
-000531a0: 204c 6f61 6420 6368 6174 2073 7461 7469   Load chat stati
-000531b0: 7374 6963 7320 616e 6420 7570 6461 7465  stics and update
-000531c0: 2074 6865 2063 6861 7420 6c69 7374 0d0a   the chat list..
-000531d0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000531e0: 2e64 622e 6765 745f 636f 6e76 6572 7361  .db.get_conversa
-000531f0: 7469 6f6e 735f 7374 6174 7328 7365 6c66  tions_stats(self
-00053200: 2e63 6861 7473 290d 0a20 2020 2020 2020  .chats)..       
-00053210: 2020 2020 2069 6620 7365 6c66 2e63 6861       if self.cha
-00053220: 743a 0d0a 2020 2020 2020 2020 2020 2020  t:..            
-00053230: 2020 2020 2320 4966 2074 6865 2075 7365      # If the use
-00053240: 7220 616c 7265 6164 7920 6f70 656e 6564  r already opened
-00053250: 2061 2063 6861 7420 7768 696c 6520 6c61   a chat while la
-00053260: 7465 7220 6461 7461 0d0a 2020 2020 2020  ter data..      
-00053270: 2020 2020 2020 2020 2020 2320 7761 7320            # was 
-00053280: 6c6f 6164 696e 672c 2075 7064 6174 6520  loading, update 
-00053290: 7468 6520 6461 7465 2072 616e 6765 2063  the date range c
-000532a0: 6f6e 7472 6f6c 2076 616c 7565 732e 0d0a  ontrol values...
-000532b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000532c0: 6461 7465 5f72 616e 6765 203d 205b 7365  date_range = [se
-000532d0: 6c66 2e63 6861 745b 2266 6972 7374 5f6d  lf.chat["first_m
-000532e0: 6573 7361 6765 5f64 6174 6574 696d 6522  essage_datetime"
-000532f0: 5d2e 6461 7465 2829 0d0a 2020 2020 2020  ].date()..      
-00053300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053310: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00053320: 6368 6174 5b22 6669 7273 745f 6d65 7373  chat["first_mess
-00053330: 6167 655f 6461 7465 7469 6d65 225d 2065  age_datetime"] e
-00053340: 6c73 6520 4e6f 6e65 2c0d 0a20 2020 2020  lse None,..     
-00053350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053360: 2020 2020 2020 2020 2073 656c 662e 6368           self.ch
-00053370: 6174 5b22 6c61 7374 5f6d 6573 7361 6765  at["last_message
-00053380: 5f64 6174 6574 696d 6522 5d2e 6461 7465  _datetime"].date
-00053390: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
-000533a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000533b0: 2020 6966 2073 656c 662e 6368 6174 5b22    if self.chat["
-000533c0: 6c61 7374 5f6d 6573 7361 6765 5f64 6174  last_message_dat
-000533d0: 6574 696d 6522 5d20 656c 7365 204e 6f6e  etime"] else Non
-000533e0: 6520 5d0d 0a20 2020 2020 2020 2020 2020  e ]..           
-000533f0: 2020 2020 2073 656c 662e 7261 6e67 655f       self.range_
-00053400: 6461 7465 2e53 6574 5261 6e67 6528 2a64  date.SetRange(*d
-00053410: 6174 655f 7261 6e67 6529 0d0a 2020 2020  ate_range)..    
-00053420: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00053430: 2e65 6469 745f 6669 6c74 6572 6461 7465  .edit_filterdate
-00053440: 312e 5261 6e67 6520 3d20 6461 7465 5f72  1.Range = date_r
-00053450: 616e 6765 0d0a 2020 2020 2020 2020 2020  ange..          
-00053460: 2020 2020 2020 7365 6c66 2e65 6469 745f        self.edit_
-00053470: 6669 6c74 6572 6461 7465 322e 5261 6e67  filterdate2.Rang
-00053480: 6520 3d20 6461 7465 5f72 616e 6765 0d0a  e = date_range..
-00053490: 2020 2020 2020 2020 2020 2020 2320 4c6f              # Lo
-000534a0: 6164 2063 6f6e 7461 6374 2073 7461 7469  ad contact stati
-000534b0: 7374 6963 7320 616e 6420 7570 6461 7465  stics and update
-000534c0: 2074 6865 2063 6f6e 7461 6374 206c 6973   the contact lis
-000534d0: 740d 0a20 2020 2020 2020 2020 2020 2073  t..            s
-000534e0: 656c 662e 6462 2e67 6574 5f63 6f6e 7461  elf.db.get_conta
-000534f0: 6374 735f 7374 6174 7328 5b73 656c 662e  cts_stats([self.
-00053500: 6462 2e61 6363 6f75 6e74 5d20 2b20 7365  db.account] + se
-00053510: 6c66 2e63 6f6e 7461 6374 732c 2073 656c  lf.contacts, sel
-00053520: 662e 6368 6174 7329 0d0a 2020 2020 2020  f.chats)..      
-00053530: 2020 2020 2020 6966 2073 656c 662e 636f        if self.co
-00053540: 6e74 6163 743a 0d0a 2020 2020 2020 2020  ntact:..        
-00053550: 2020 2020 2020 2020 2320 4966 2074 6865          # If the
-00053560: 2075 7365 7220 616c 7265 6164 7920 6f70   user already op
-00053570: 656e 6564 2061 2063 6f6e 7461 6374 2077  ened a contact w
-00053580: 6869 6c65 206c 6174 6572 2064 6174 610d  hile later data.
-00053590: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000535a0: 2023 2077 6173 206c 6f61 6469 6e67 2c20   # was loading, 
-000535b0: 7570 6461 7465 2074 6865 2070 6167 650d  update the page.
-000535c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000535d0: 2063 6f6e 7461 6374 203d 206e 6578 7428   contact = next(
-000535e0: 2878 2066 6f72 2078 2069 6e20 5b73 656c  (x for x in [sel
-000535f0: 662e 6462 2e61 6363 6f75 6e74 5d20 2b20  f.db.account] + 
-00053600: 7365 6c66 2e63 6f6e 7461 6374 730d 0a20  self.contacts.. 
-00053610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053620: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00053630: 6620 785b 2269 6465 6e74 6974 7922 5d20  f x["identity"] 
-00053640: 3d3d 2073 656c 662e 636f 6e74 6163 745b  == self.contact[
-00053650: 2269 6465 6e74 6974 7922 5d29 2c20 4e6f  "identity"]), No
-00053660: 6e65 290d 0a20 2020 2020 2020 2020 2020  ne)..           
-00053670: 2020 2020 2069 6620 636f 6e74 6163 743a       if contact:
-00053680: 2073 656c 662e 6c6f 6164 5f63 6f6e 7461   self.load_conta
-00053690: 6374 2863 6f6e 7461 6374 290d 0a20 2020  ct(contact)..   
-000536a0: 2020 2020 2020 2020 2067 7569 6261 7365           guibase
-000536b0: 2e73 7461 7475 7328 224f 7065 6e65 6420  .status("Opened 
-000536c0: 536b 7970 6520 6461 7461 6261 7365 2025  Skype database %
-000536d0: 732e 222c 2073 656c 662e 6462 290d 0a20  s.", self.db).. 
-000536e0: 2020 2020 2020 2065 7863 6570 7420 4578         except Ex
-000536f0: 6365 7074 696f 6e20 6173 2065 3a0d 0a20  ception as e:.. 
-00053700: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-00053710: 6c66 3a0d 0a20 2020 2020 2020 2020 2020  lf:..           
-00053720: 2020 2020 2067 7569 6261 7365 2e73 7461       guibase.sta
-00053730: 7475 7328 2245 7272 6f72 206c 6f61 6469  tus("Error loadi
-00053740: 6e67 2061 6464 6974 696f 6e61 6c20 6461  ng additional da
-00053750: 7461 2066 726f 6d20 2573 3a20 2573 222c  ta from %s: %s",
-00053760: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00053770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053780: 2073 656c 662e 6462 2c20 7574 696c 2e66   self.db, util.f
-00053790: 6f72 6d61 745f 6578 6328 6529 290d 0a20  ormat_exc(e)).. 
-000537a0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-000537b0: 6f67 6765 722e 6578 6365 7074 696f 6e28  ogger.exception(
-000537c0: 2245 7272 6f72 206c 6f61 6469 6e67 2061  "Error loading a
-000537d0: 6464 6974 696f 6e61 6c20 6461 7461 2066  dditional data f
-000537e0: 726f 6d20 2573 2e22 2c20 7365 6c66 2e64  rom %s.", self.d
-000537f0: 6229 0d0a 2020 2020 2020 2020 6966 2073  b)..        if s
-00053800: 656c 663a 0d0a 2020 2020 2020 2020 2020  elf:..          
-00053810: 2020 2320 5265 6672 6573 6820 6c69 7374    # Refresh list
-00053820: 2066 726f 6d20 6c6f 6164 6564 2064 6174   from loaded dat
-00053830: 612c 2073 6f72 7420 6279 206c 6173 7420  a, sort by last 
-00053840: 6d65 7373 6167 6520 6461 7465 7469 6d65  message datetime
-00053850: 0d0a 2020 2020 2020 2020 2020 2020 736f  ..            so
-00053860: 7274 6675 6e63 203d 206c 616d 6264 6120  rtfunc = lambda 
-00053870: 6c3a 206c 2061 6e64 2028 6c2e 5265 7365  l: l and (l.Rese
-00053880: 7443 6f6c 756d 6e57 6964 7468 7328 292c  tColumnWidths(),
-00053890: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000538a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000538b0: 2020 2020 2020 2020 2020 6c2e 536f 7274            l.Sort
-000538c0: 4c69 7374 4974 656d 7328 342c 2030 292c  ListItems(4, 0),
-000538d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000538e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000538f0: 2020 2020 2020 2020 2020 286c 2e53 6574            (l.Set
-00053900: 436f 6c75 6d6e 5769 6474 6828 302c 2031  ColumnWidth(0, 1
-00053910: 3530 292c 206c 2e53 6574 436f 6c75 6d6e  50), l.SetColumn
-00053920: 5769 6474 6828 312c 2032 3530 2929 0d0a  Width(1, 250))..
-00053930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053950: 2020 2020 2020 2020 2069 6620 6c20 6973           if l is
-00053960: 2073 656c 662e 6c69 7374 5f63 6f6e 7461   self.list_conta
-00053970: 6374 7320 656c 7365 204e 6f6e 6529 0d0a  cts else None)..
-00053980: 2020 2020 2020 2020 2020 2020 7778 2e43              wx.C
-00053990: 616c 6c4c 6174 6572 2831 2c20 736f 7274  allLater(1, sort
-000539a0: 6675 6e63 2c20 7365 6c66 2e6c 6973 745f  func, self.list_
-000539b0: 6368 6174 7329 0d0a 2020 2020 2020 2020  chats)..        
-000539c0: 2020 2020 7778 2e43 616c 6c4c 6174 6572      wx.CallLater
-000539d0: 2831 2c20 736f 7274 6675 6e63 2c20 7365  (1, sortfunc, se
-000539e0: 6c66 2e6c 6973 745f 636f 6e74 6163 7473  lf.list_contacts
-000539f0: 290d 0a20 2020 2020 2020 2020 2020 2077  )..            w
-00053a00: 782e 4361 6c6c 4166 7465 7228 7365 6c66  x.CallAfter(self
-00053a10: 2e75 7064 6174 655f 7461 6268 6561 6465  .update_tabheade
-00053a20: 7229 0d0a 0d0a 0d0a 2020 2020 6465 6620  r)......    def 
-00053a30: 6c6f 6164 5f74 6162 6c65 735f 6461 7461  load_tables_data
-00053a40: 2873 656c 662c 2072 656c 6f61 643d 4661  (self, reload=Fa
-00053a50: 6c73 6529 3a0d 0a20 2020 2020 2020 2022  lse):..        "
-00053a60: 2222 0d0a 2020 2020 2020 2020 4c6f 6164  ""..        Load
-00053a70: 7320 7461 626c 6520 6461 7461 2069 6e74  s table data int
-00053a80: 6f20 7461 626c 6520 7472 6565 2061 6e64  o table tree and
-00053a90: 2053 514c 2065 6469 746f 722c 0d0a 2020   SQL editor,..  
-00053aa0: 2020 2020 2020 7265 6c6f 6164 696e 6720        reloading 
-00053ab0: 7363 6865 6d61 2061 6e64 2072 6f77 2063  schema and row c
-00053ac0: 6f75 6e74 7320 6966 2073 7065 6369 6669  ounts if specifi
-00053ad0: 6564 2e0d 0a20 2020 2020 2020 2022 2222  ed...        """
-00053ae0: 0d0a 2020 2020 2020 2020 7472 793a 0d0a  ..        try:..
-00053af0: 2020 2020 2020 2020 2020 2020 7461 626c              tabl
-00053b00: 6573 203d 2073 656c 662e 6462 2e67 6574  es = self.db.get
-00053b10: 5f74 6162 6c65 7328 7265 6672 6573 683d  _tables(refresh=
-00053b20: 7265 6c6f 6164 290d 0a20 2020 2020 2020  reload)..       
-00053b30: 2020 2020 2023 2046 696c 6c20 7461 626c       # Fill tabl
-00053b40: 6520 7472 6565 2077 6974 6820 696e 666f  e tree with info
-00053b50: 726d 6174 696f 6e20 6f6e 2072 6f77 2063  rmation on row c
-00053b60: 6f75 6e74 7320 616e 6420 636f 6c75 6d6e  ounts and column
-00053b70: 730d 0a20 2020 2020 2020 2020 2020 2073  s..            s
-00053b80: 656c 662e 7472 6565 5f74 6162 6c65 732e  elf.tree_tables.
-00053b90: 4465 6c65 7465 416c 6c49 7465 6d73 2829  DeleteAllItems()
-00053ba0: 0d0a 2020 2020 2020 2020 2020 2020 726f  ..            ro
-00053bb0: 6f74 203d 2073 656c 662e 7472 6565 5f74  ot = self.tree_t
-00053bc0: 6162 6c65 732e 4164 6452 6f6f 7428 2253  ables.AddRoot("S
-00053bd0: 514c 4954 4522 290d 0a20 2020 2020 2020  QLITE")..       
-00053be0: 2020 2020 2063 6869 6c64 203d 204e 6f6e       child = Non
-00053bf0: 650d 0a20 2020 2020 2020 2020 2020 2066  e..            f
-00053c00: 6f72 2074 6162 6c65 2069 6e20 7461 626c  or table in tabl
-00053c10: 6573 3a0d 0a20 2020 2020 2020 2020 2020  es:..           
-00053c20: 2020 2020 2063 6869 6c64 203d 2073 656c       child = sel
-00053c30: 662e 7472 6565 5f74 6162 6c65 732e 4170  f.tree_tables.Ap
-00053c40: 7065 6e64 4974 656d 2872 6f6f 742c 2074  pendItem(root, t
-00053c50: 6162 6c65 5b22 6e61 6d65 225d 290d 0a20  able["name"]).. 
-00053c60: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00053c70: 656c 662e 7472 6565 5f74 6162 6c65 732e  elf.tree_tables.
-00053c80: 5365 7449 7465 6d54 6578 7428 6368 696c  SetItemText(chil
-00053c90: 642c 2022 2564 2072 6f77 2573 2220 2520  d, "%d row%s" % 
-00053ca0: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-00053cb0: 2020 2020 2020 2074 6162 6c65 5b22 726f         table["ro
-00053cc0: 7773 225d 2c20 2273 2220 6966 2074 6162  ws"], "s" if tab
-00053cd0: 6c65 5b22 726f 7773 225d 2021 3d20 3120  le["rows"] != 1 
-00053ce0: 656c 7365 2022 2022 0d0a 2020 2020 2020  else " "..      
-00053cf0: 2020 2020 2020 2020 2020 292c 2031 290d            ), 1).
-00053d00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00053d10: 2073 656c 662e 7472 6565 5f74 6162 6c65   self.tree_table
-00053d20: 732e 5365 7449 7465 6d50 7944 6174 6128  s.SetItemPyData(
-00053d30: 6368 696c 642c 2074 6162 6c65 5b22 6e61  child, table["na
-00053d40: 6d65 225d 290d 0a20 2020 2020 2020 2020  me"])..         
-00053d50: 2020 2020 2020 2073 656c 662e 7472 6565         self.tree
-00053d60: 5f74 6162 6c65 732e 5365 7449 7465 6d54  _tables.SetItemT
-00053d70: 6578 7443 6f6c 6f75 7228 6368 696c 642c  extColour(child,
-00053d80: 2073 656c 662e 7472 6565 5f74 6162 6c65   self.tree_table
-00053d90: 732e 466f 7265 6772 6f75 6e64 436f 6c6f  s.ForegroundColo
-00053da0: 7572 290d 0a0d 0a20 2020 2020 2020 2020  ur)....         
-00053db0: 2020 2020 2020 2066 6f72 2063 6f6c 2069         for col i
-00053dc0: 6e20 7365 6c66 2e64 622e 6765 745f 7461  n self.db.get_ta
-00053dd0: 626c 655f 636f 6c75 6d6e 7328 7461 626c  ble_columns(tabl
-00053de0: 655b 226e 616d 6522 5d29 3a0d 0a20 2020  e["name"]):..   
-00053df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053e00: 2073 7562 6368 696c 6420 3d20 7365 6c66   subchild = self
-00053e10: 2e74 7265 655f 7461 626c 6573 2e41 7070  .tree_tables.App
-00053e20: 656e 6449 7465 6d28 6368 696c 642c 2063  endItem(child, c
-00053e30: 6f6c 5b22 6e61 6d65 225d 290d 0a20 2020  ol["name"])..   
-00053e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053e50: 2073 656c 662e 7472 6565 5f74 6162 6c65   self.tree_table
-00053e60: 732e 5365 7449 7465 6d54 6578 7428 7375  s.SetItemText(su
-00053e70: 6263 6869 6c64 2c20 636f 6c5b 2274 7970  bchild, col["typ
-00053e80: 6522 5d2c 2031 290d 0a20 2020 2020 2020  e"], 1)..       
-00053e90: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00053ea0: 662e 7472 6565 5f74 6162 6c65 732e 5365  f.tree_tables.Se
-00053eb0: 7449 7465 6d54 6578 7443 6f6c 6f75 7228  tItemTextColour(
-00053ec0: 7375 6263 6869 6c64 2c20 7365 6c66 2e74  subchild, self.t
-00053ed0: 7265 655f 7461 626c 6573 2e46 6f72 6567  ree_tables.Foreg
-00053ee0: 726f 756e 6443 6f6c 6f75 7229 0d0a 2020  roundColour)..  
-00053ef0: 2020 2020 2020 2020 2020 7365 6c66 2e74            self.t
-00053f00: 7265 655f 7461 626c 6573 2e45 7870 616e  ree_tables.Expan
-00053f10: 6428 726f 6f74 290d 0a20 2020 2020 2020  d(root)..       
-00053f20: 2020 2020 2069 6620 6368 696c 643a 0d0a       if child:..
-00053f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00053f40: 2320 4e75 6467 6520 636f 6c75 6d6e 7320  # Nudge columns 
-00053f50: 746f 2066 6974 2061 6e64 2066 696c 6c20  to fit and fill 
-00053f60: 7468 6520 6865 6164 6572 2065 7861 6374  the header exact
-00053f70: 6c79 2e0d 0a20 2020 2020 2020 2020 2020  ly...           
-00053f80: 2020 2020 2073 656c 662e 7472 6565 5f74       self.tree_t
-00053f90: 6162 6c65 732e 4578 7061 6e64 2863 6869  ables.Expand(chi
-00053fa0: 6c64 290d 0a20 2020 2020 2020 2020 2020  ld)..           
-00053fb0: 2020 2020 2073 656c 662e 7472 6565 5f74       self.tree_t
-00053fc0: 6162 6c65 732e 5365 7443 6f6c 756d 6e57  ables.SetColumnW
-00053fd0: 6964 7468 2830 2c20 2d31 290d 0a20 2020  idth(0, -1)..   
-00053fe0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00053ff0: 662e 7472 6565 5f74 6162 6c65 732e 5365  f.tree_tables.Se
-00054000: 7443 6f6c 756d 6e57 6964 7468 2831 2c20  tColumnWidth(1, 
-00054010: 6d69 6e28 3730 2c0d 0a20 2020 2020 2020  min(70,..       
-00054020: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00054030: 662e 7472 6565 5f74 6162 6c65 732e 5369  f.tree_tables.Si
-00054040: 7a65 2e77 6964 7468 202d 0d0a 2020 2020  ze.width -..    
-00054050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00054060: 7365 6c66 2e74 7265 655f 7461 626c 6573  self.tree_tables
-00054070: 2e47 6574 436f 6c75 6d6e 5769 6474 6828  .GetColumnWidth(
-00054080: 3029 202d 2035 2929 0d0a 2020 2020 2020  0) - 5))..      
-00054090: 2020 2020 2020 2020 2020 7365 6c66 2e74            self.t
-000540a0: 7265 655f 7461 626c 6573 2e43 6f6c 6c61  ree_tables.Colla
-000540b0: 7073 6528 6368 696c 6429 0d0a 0d0a 2020  pse(child)....  
-000540c0: 2020 2020 2020 2020 2020 2320 4164 6420            # Add 
-000540d0: 7461 626c 6520 616e 6420 636f 6c75 6d6e  table and column
-000540e0: 206e 616d 6573 2074 6f20 5351 4c20 6564   names to SQL ed
-000540f0: 6974 6f72 2061 7574 6f63 6f6d 706c 6574  itor autocomplet
-00054100: 650d 0a20 2020 2020 2020 2020 2020 2066  e..            f
-00054110: 6f72 2074 2069 6e20 7461 626c 6573 3a0d  or t in tables:.
-00054120: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00054130: 2063 6f6c 6461 7461 203d 2073 656c 662e   coldata = self.
-00054140: 6462 2e67 6574 5f74 6162 6c65 5f63 6f6c  db.get_table_col
-00054150: 756d 6e73 2874 5b22 6e61 6d65 225d 290d  umns(t["name"]).
-00054160: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00054170: 2066 6965 6c64 7320 3d20 5b63 5b22 6e61   fields = [c["na
-00054180: 6d65 225d 2066 6f72 2063 2069 6e20 636f  me"] for c in co
-00054190: 6c64 6174 615d 0d0a 2020 2020 2020 2020  ldata]..        
-000541a0: 2020 2020 2020 2020 7365 6c66 2e73 7463          self.stc
-000541b0: 5f73 716c 2e41 7574 6f43 6f6d 7041 6464  _sql.AutoCompAdd
-000541c0: 5375 6257 6f72 6473 2874 5b22 6e61 6d65  SubWords(t["name
-000541d0: 225d 2c20 6669 656c 6473 290d 0a20 2020  "], fields)..   
-000541e0: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
-000541f0: 7074 696f 6e3a 0d0a 2020 2020 2020 2020  ption:..        
-00054200: 2020 2020 6966 2073 656c 663a 0d0a 2020      if self:..  
-00054210: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
-00054220: 6767 6572 2e65 7863 6570 7469 6f6e 2822  gger.exception("
-00054230: 4572 726f 7220 6c6f 6164 696e 6720 7461  Error loading ta
-00054240: 626c 6520 6461 7461 2066 726f 6d20 2573  ble data from %s
-00054250: 2e22 2c20 7365 6c66 2e64 6229 0d0a 0d0a  .", self.db)....
-00054260: 0d0a 2020 2020 6465 6620 7570 6461 7465  ..    def update
-00054270: 5f74 6162 6865 6164 6572 2873 656c 6629  _tabheader(self)
-00054280: 3a0d 0a20 2020 2020 2020 2022 2222 5570  :..        """Up
-00054290: 6461 7465 7320 7061 6765 2074 6162 2068  dates page tab h
-000542a0: 6561 6465 7220 7769 7468 206f 7074 696f  eader with optio
-000542b0: 6e20 746f 2063 6c6f 7365 2070 6167 652e  n to close page.
-000542c0: 2222 220d 0a20 2020 2020 2020 2069 6620  """..        if 
-000542d0: 7365 6c66 3a0d 0a20 2020 2020 2020 2020  self:..         
-000542e0: 2020 2073 656c 662e 7265 6164 795f 746f     self.ready_to
-000542f0: 5f63 6c6f 7365 203d 2054 7275 650d 0a20  _close = True.. 
-00054300: 2020 2020 2020 2069 6620 7365 6c66 3a0d         if self:.
-00054310: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00054320: 662e 546f 704c 6576 656c 5061 7265 6e74  f.TopLevelParent
-00054330: 2e75 7064 6174 655f 6e6f 7465 626f 6f6b  .update_notebook
-00054340: 5f68 6561 6465 7228 290d 0a0d 0a0d 0a0d  _header().......
-00054350: 0a63 6c61 7373 204d 6572 6765 7250 6167  .class MergerPag
-00054360: 6528 7778 2e50 616e 656c 293a 0d0a 2020  e(wx.Panel):..  
-00054370: 2020 2222 220d 0a20 2020 2041 2077 782e    """..    A wx.
-00054380: 4e6f 7465 626f 6f6b 2070 6167 6520 666f  Notebook page fo
-00054390: 7220 636f 6d70 6172 696e 6720 7477 6f20  r comparing two 
-000543a0: 536b 7970 6520 6461 7461 6261 7365 732c  Skype databases,
-000543b0: 2068 6173 2069 7473 206f 776e 204e 6f74   has its own Not
-000543c0: 6562 6f6f 6b0d 0a20 2020 2077 6974 6820  ebook..    with 
-000543d0: 6f6e 6520 7061 6765 2066 6f72 2064 6966  one page for dif
-000543e0: 6669 6e67 2f6d 6572 6769 6e67 2063 6861  fing/merging cha
-000543f0: 7473 2c20 616e 6420 616e 6f74 6865 7220  ts, and another 
-00054400: 666f 7220 636f 6e74 6163 7473 2e0d 0a20  for contacts... 
-00054410: 2020 2022 2222 0d0a 0d0a 2020 2020 2222     """....    ""
-00054420: 224e 6f74 6573 2066 6f72 206d 6572 6765  "Notes for merge
-00054430: 2062 7574 746f 6e73 2077 6865 7265 206e   buttons where n
-00054440: 6f74 6520 6368 616e 6765 7320 7769 7468  ote changes with
-00054450: 2064 6174 612e 2222 220d 0a20 2020 204d   data."""..    M
-00054460: 4552 4745 5f42 5554 544f 4e5f 4e4f 5445  ERGE_BUTTON_NOTE
-00054470: 203d 2028 2253 6361 6e20 7468 726f 7567   = ("Scan throug
-00054480: 6820 7468 6520 6c65 6674 2064 6174 6162  h the left datab
-00054490: 6173 652c 2066 696e 6420 6d65 7373 6167  ase, find messag
-000544a0: 6573 206e 6f74 2022 0d0a 2020 2020 2020  es not "..      
-000544b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000544c0: 2020 2022 7072 6573 656e 7420 6f6e 2074     "present on t
-000544d0: 6865 2072 6967 6874 2c20 616e 6420 636f  he right, and co
-000544e0: 7079 2074 6865 6d20 746f 2074 6865 2064  py them to the d
-000544f0: 6174 6162 6173 6520 220d 0a20 2020 2020  atabase "..     
-00054500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00054510: 2020 2020 226f 6e20 7468 6520 7269 6768      "on the righ
-00054520: 742e 2229 0d0a 2020 2020 4d45 5247 455f  t.")..    MERGE_
-00054530: 4348 4154 5f42 5554 544f 4e5f 4e4f 5445  CHAT_BUTTON_NOTE
-00054540: 203d 2022 436f 7079 206e 6577 206d 6573   = "Copy new mes
-00054550: 7361 6765 7320 746f 2074 6865 2064 6174  sages to the dat
-00054560: 6162 6173 6520 6f6e 2074 6865 2072 6967  abase on the rig
-00054570: 6874 2e22 0d0a 0d0a 2020 2020 6465 6620  ht."....    def 
-00054580: 5f5f 696e 6974 5f5f 2873 656c 662c 2070  __init__(self, p
-00054590: 6172 656e 745f 6e6f 7465 626f 6f6b 2c20  arent_notebook, 
-000545a0: 6462 312c 2064 6232 2c20 7469 746c 6529  db1, db2, title)
-000545b0: 3a0d 0a20 2020 2020 2020 2077 782e 5061  :..        wx.Pa
-000545c0: 6e65 6c2e 5f5f 696e 6974 5f5f 2873 656c  nel.__init__(sel
-000545d0: 662c 2070 6172 656e 743d 7061 7265 6e74  f, parent=parent
-000545e0: 5f6e 6f74 6562 6f6f 6b29 0d0a 2020 2020  _notebook)..    
-000545f0: 2020 2020 7365 6c66 2e70 6167 656f 7264      self.pageord
-00054600: 6572 203d 207b 7d20 2320 7b70 6167 653a  er = {} # {page:
-00054610: 206e 6f74 6562 6f6f 6b20 696e 6465 782c   notebook index,
-00054620: 207d 0d0a 2020 2020 2020 2020 7365 6c66   }..        self
-00054630: 2e70 6172 656e 745f 6e6f 7465 626f 6f6b  .parent_notebook
-00054640: 203d 2070 6172 656e 745f 6e6f 7465 626f   = parent_notebo
-00054650: 6f6b 0d0a 2020 2020 2020 2020 7365 6c66  ok..        self
-00054660: 2e72 6561 6479 5f74 6f5f 636c 6f73 6520  .ready_to_close 
-00054670: 3d20 4661 6c73 650d 0a20 2020 2020 2020  = False..       
-00054680: 2073 656c 662e 6973 5f6d 6572 6769 6e67   self.is_merging
-00054690: 203d 2046 616c 7365 2023 2057 6865 7468   = False # Wheth
-000546a0: 6572 206d 6572 6769 6e67 2069 7320 6375  er merging is cu
-000546b0: 7272 656e 746c 7920 756e 6465 7277 6179  rrently underway
-000546c0: 0d0a 2020 2020 2020 2020 7365 6c66 2e69  ..        self.i
-000546d0: 735f 7363 616e 6e69 6e67 203d 2046 616c  s_scanning = Fal
-000546e0: 7365 2023 2057 6865 7468 6572 2073 6361  se # Whether sca
-000546f0: 6e6e 696e 6720 6973 2063 7572 7265 6e74  nning is current
-00054700: 6c79 2075 6e64 6572 7761 790d 0a20 2020  ly underway..   
-00054710: 2020 2020 2073 656c 662e 6973 5f73 6361       self.is_sca
-00054720: 6e6e 6564 203d 2046 616c 7365 2023 2057  nned = False # W
-00054730: 6865 7468 6572 2067 6c6f 6261 6c20 7363  hether global sc
-00054740: 616e 2068 6173 2062 6565 6e20 7275 6e0d  an has been run.
-00054750: 0a20 2020 2020 2020 2073 656c 662e 6462  .        self.db
-00054760: 3120 3d20 6462 310d 0a20 2020 2020 2020  1 = db1..       
-00054770: 2073 656c 662e 6462 3220 3d20 6462 320d   self.db2 = db2.
-00054780: 0a20 2020 2020 2020 2067 7569 6261 7365  .        guibase
-00054790: 2e73 7461 7475 7328 224f 7065 6e69 6e67  .status("Opening
-000547a0: 2025 7320 616e 6420 2573 2e22 2c20 7365   %s and %s.", se
-000547b0: 6c66 2e64 6231 2c20 7365 6c66 2e64 6232  lf.db1, self.db2
-000547c0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-000547d0: 6462 312e 7265 6769 7374 6572 5f63 6f6e  db1.register_con
-000547e0: 7375 6d65 7228 7365 6c66 292c 2073 656c  sumer(self), sel
-000547f0: 662e 6462 322e 7265 6769 7374 6572 5f63  f.db2.register_c
-00054800: 6f6e 7375 6d65 7228 7365 6c66 290d 0a20  onsumer(self).. 
-00054810: 2020 2020 2020 2073 656c 662e 7469 746c         self.titl
-00054820: 6520 3d20 7469 746c 650d 0a20 2020 2020  e = title..     
-00054830: 2020 2070 6172 656e 745f 6e6f 7465 626f     parent_notebo
-00054840: 6f6b 2e49 6e73 6572 7450 6167 6528 312c  ok.InsertPage(1,
-00054850: 2073 656c 662c 2074 6974 6c65 290d 0a20   self, title).. 
-00054860: 2020 2020 2020 2043 6f6c 6f75 724d 616e         ColourMan
-00054870: 6167 6572 2e4d 616e 6167 6528 7365 6c66  ager.Manage(self
-00054880: 2c20 2242 6163 6b67 726f 756e 6443 6f6c  , "BackgroundCol
-00054890: 6f75 7222 2c20 7778 2e53 5953 5f43 4f4c  our", wx.SYS_COL
-000548a0: 4f55 525f 4254 4e46 4143 4529 0d0a 2020  OUR_BTNFACE)..  
-000548b0: 2020 2020 2020 6275 7379 203d 2063 6f6e        busy = con
-000548c0: 7472 6f6c 732e 4275 7379 5061 6e65 6c28  trols.BusyPanel(
-000548d0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-000548e0: 6c66 2c20 2243 6f6d 7061 7269 6e67 205c  lf, "Comparing \
-000548f0: 2225 735c 225c 6e20 616e 6420 5c22 2573  "%s\"\n and \"%s
-00054900: 5c22 2e22 2025 2028 6462 312c 2064 6232  \"." % (db1, db2
-00054910: 2929 0d0a 0d0a 2020 2020 2020 2020 7365  ))....        se
-00054920: 6c66 2e63 6861 7473 3120 3d20 4e6f 6e65  lf.chats1 = None
-00054930: 2020 2020 2020 2020 2320 5b63 6861 7473          # [chats
-00054940: 2069 6e20 6c65 6674 2064 6174 6162 6173   in left databas
-00054950: 655d 0d0a 2020 2020 2020 2020 7365 6c66  e]..        self
-00054960: 2e63 6861 7473 3220 3d20 4e6f 6e65 2020  .chats2 = None  
-00054970: 2020 2020 2020 2320 5b63 6861 7473 2069        # [chats i
-00054980: 6e20 7269 6768 7420 6461 7461 6261 7365  n right database
-00054990: 5d0d 0a20 2020 2020 2020 2073 656c 662e  ]..        self.
-000549a0: 6368 6174 203d 204e 6f6e 6520 2020 2020  chat = None     
-000549b0: 2020 2020 2023 2043 6861 7420 6f70 656e       # Chat open
-000549c0: 6564 206f 6e20 6368 6174 7320 7061 6765  ed on chats page
-000549d0: 0d0a 2020 2020 2020 2020 7365 6c66 2e63  ..        self.c
-000549e0: 6861 745f 6469 6666 203d 204e 6f6e 6520  hat_diff = None 
-000549f0: 2020 2020 2320 4f70 656e 2064 6966 6620      # Open diff 
-00054a00: 7b22 6d65 7373 6167 6573 223a 205b 5d2c  {"messages": [],
-00054a10: 2022 7061 7274 6963 6970 616e 7473 223a   "participants":
-00054a20: 205b 5d7d 0d0a 2020 2020 2020 2020 7365   []}..        se
-00054a30: 6c66 2e63 6f6d 7061 7265 6420 3d20 4e6f  lf.compared = No
-00054a40: 6e65 2020 2020 2020 2320 4368 6174 206c  ne      # Chat l
-00054a50: 6973 742c 206c 6566 742d 7269 6768 7420  ist, left-right 
-00054a60: 6461 7461 2069 6e20 6b65 7973 2022 6331  data in keys "c1
-00054a70: 2220 2620 2263 3222 0d0a 2020 2020 2020  " & "c2"..      
-00054a80: 2020 7365 6c66 2e63 6f6e 3164 6966 666c    self.con1diffl
-00054a90: 6973 7420 3d20 4e6f 6e65 2020 2320 436f  ist = None  # Co
-00054aa0: 6e74 6163 7420 616e 6420 636f 6e74 6163  ntact and contac
-00054ab0: 7420 6772 6f75 7020 6469 6666 6572 656e  t group differen
-00054ac0: 6365 730d 0a20 2020 2020 2020 2073 656c  ces..        sel
-00054ad0: 662e 636f 6e32 6469 6666 6c69 7374 203d  f.con2difflist =
-00054ae0: 204e 6f6e 6520 2023 2043 6f6e 7461 6374   None  # Contact
-00054af0: 2061 6e64 2063 6f6e 7461 6374 2067 726f   and contact gro
-00054b00: 7570 2064 6966 6665 7265 6e63 6573 0d0a  up differences..
-00054b10: 2020 2020 2020 2020 7365 6c66 2e63 6f6e          self.con
-00054b20: 3164 6966 6620 3d20 4e6f 6e65 2020 2020  1diff = None    
-00054b30: 2020 2320 436f 6e74 6163 7420 6469 6666    # Contact diff
-00054b40: 6572 656e 6365 7320 666f 7220 6c65 6674  erences for left
-00054b50: 0d0a 2020 2020 2020 2020 7365 6c66 2e63  ..        self.c
-00054b60: 6f6e 3264 6966 6620 3d20 4e6f 6e65 2020  on2diff = None  
-00054b70: 2020 2020 2320 436f 6e74 6163 7420 6469      # Contact di
-00054b80: 6666 6572 656e 6365 7320 666f 7220 7269  fferences for ri
-00054b90: 6768 740d 0a20 2020 2020 2020 2073 656c  ght..        sel
-00054ba0: 662e 636f 6e67 726f 7570 3164 6966 6620  f.congroup1diff 
-00054bb0: 3d20 4e6f 6e65 2023 2043 6f6e 7461 6374  = None # Contact
-00054bc0: 2067 726f 7570 2064 6966 6665 7265 6e63   group differenc
-00054bd0: 6573 2066 6f72 206c 6566 740d 0a20 2020  es for left..   
-00054be0: 2020 2020 2073 656c 662e 636f 6e67 726f       self.congro
-00054bf0: 7570 3264 6966 6620 3d20 4e6f 6e65 2023  up2diff = None #
-00054c00: 2043 6f6e 7461 6374 2067 726f 7570 2064   Contact group d
-00054c10: 6966 6665 7265 6e63 6573 2066 6f72 2072  ifferences for r
-00054c20: 6967 6874 0d0a 2020 2020 2020 2020 7365  ight..        se
-00054c30: 6c66 2e63 6861 7473 5f6e 6f64 6966 6620  lf.chats_nodiff 
-00054c40: 3d20 7b7d 2020 2020 2320 7b69 6465 6e74  = {}    # {ident
-00054c50: 6974 7920 6f66 2075 6e63 6861 6e67 6564  ity of unchanged
-00054c60: 2063 6861 743a 207b 6368 6174 7d2c 207d   chat: {chat}, }
-00054c70: 0d0a 2020 2020 2020 2020 2320 7b69 6465  ..        # {ide
-00054c80: 6e74 6974 7920 6f66 2063 6861 6e67 6564  ntity of changed
-00054c90: 2063 6861 743a 207b 2263 6861 7422 3a20   chat: {"chat": 
-00054ca0: 7b7d 2c20 2264 6966 6622 3a20 5b6d 6573  {}, "diff": [mes
-00054cb0: 7361 6765 2049 442c 205d 7d2c 207d 0d0a  sage ID, ]}, }..
-00054cc0: 2020 2020 2020 2020 7365 6c66 2e63 6861          self.cha
-00054cd0: 7473 5f64 6966 6664 6174 6120 3d20 7b7d  ts_diffdata = {}
-00054ce0: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
-00054cf0: 2e63 6f6e 7461 6374 735f 6c69 7374 5f63  .contacts_list_c
-00054d00: 6f6c 756d 6e73 203d 205b 0d0a 2020 2020  olumns = [..    
-00054d10: 2020 2020 2020 2020 2822 6964 656e 7469          ("identi
-00054d20: 7479 222c 2022 4163 636f 756e 7422 292c  ty", "Account"),
-00054d30: 2028 226e 616d 6522 2c20 224e 616d 6522   ("name", "Name"
-00054d40: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
-00054d50: 2822 7068 6f6e 655f 6d6f 6269 6c65 5f6e  ("phone_mobile_n
-00054d60: 6f72 6d61 6c69 7a65 6422 2c20 224d 6f62  ormalized", "Mob
-00054d70: 696c 6520 7068 6f6e 6522 292c 0d0a 2020  ile phone"),..  
-00054d80: 2020 2020 2020 2020 2020 2822 636f 756e            ("coun
-00054d90: 7472 7922 2c20 2243 6f75 6e74 7279 2229  try", "Country")
-00054da0: 2c20 2822 6369 7479 222c 2022 4369 7479  , ("city", "City
-00054db0: 2229 2c20 2822 6162 6f75 7422 2c20 2241  "), ("about", "A
-00054dc0: 626f 7574 2229 2c0d 0a20 2020 2020 2020  bout"),..       
-00054dd0: 2020 2020 2028 225f 5f74 7970 6522 2c20       ("__type", 
-00054de0: 2254 7970 6522 292c 205d 0d0a 2020 2020  "Type"), ]..    
-00054df0: 2020 2020 7365 6c66 2e63 6861 7473 5f6c      self.chats_l
-00054e00: 6973 745f 636f 6c75 6d6e 7320 3d20 5b0d  ist_columns = [.
-00054e10: 0a20 2020 2020 2020 2020 2020 2028 2274  .            ("t
-00054e20: 6974 6c65 222c 2022 4368 6174 2229 2c20  itle", "Chat"), 
-00054e30: 2822 6d65 7373 6167 6573 3122 2c20 224d  ("messages1", "M
-00054e40: 6573 7361 6765 7320 696e 206c 6566 7422  essages in left"
-00054e50: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
-00054e60: 2822 6d65 7373 6167 6573 3222 2c20 224d  ("messages2", "M
-00054e70: 6573 7361 6765 7320 696e 2072 6967 6874  essages in right
-00054e80: 2229 2c0d 0a20 2020 2020 2020 2020 2020  "),..           
-00054e90: 2028 226c 6173 745f 6d65 7373 6167 655f   ("last_message_
-00054ea0: 6461 7465 7469 6d65 3122 2c20 224c 6173  datetime1", "Las
-00054eb0: 7420 6d65 7373 6167 6520 696e 206c 6566  t message in lef
-00054ec0: 7422 292c 0d0a 2020 2020 2020 2020 2020  t"),..          
-00054ed0: 2020 2822 6c61 7374 5f6d 6573 7361 6765    ("last_message
-00054ee0: 5f64 6174 6574 696d 6532 222c 2022 4c61  _datetime2", "La
-00054ef0: 7374 206d 6573 7361 6765 2069 6e20 7269  st message in ri
-00054f00: 6768 7422 292c 0d0a 2020 2020 2020 2020  ght"),..        
-00054f10: 2020 2020 2822 7479 7065 5f6e 616d 6522      ("type_name"
-00054f20: 2c20 2254 7970 6522 292c 2028 2270 656f  , "Type"), ("peo
-00054f30: 706c 6522 2c20 2250 656f 706c 6522 292c  ple", "People"),
-00054f40: 205d 0d0a 2020 2020 2020 2020 7365 6c66   ]..        self
-00054f50: 2e42 696e 6428 4556 545f 574f 524b 4552  .Bind(EVT_WORKER
-00054f60: 2c20 7365 6c66 2e6f 6e5f 776f 726b 6572  , self.on_worker
-00054f70: 5f6d 6572 6765 5f72 6573 756c 7429 0d0a  _merge_result)..
-00054f80: 2020 2020 2020 2020 7365 6c66 2e77 6f72          self.wor
-00054f90: 6b65 725f 6d65 7267 6520 3d20 776f 726b  ker_merge = work
-00054fa0: 6572 732e 4d65 7267 6554 6872 6561 6428  ers.MergeThread(
-00054fb0: 7365 6c66 2e6f 6e5f 776f 726b 6572 5f6d  self.on_worker_m
-00054fc0: 6572 6765 5f63 616c 6c62 6163 6b29 0d0a  erge_callback)..
-00054fd0: 2020 2020 2020 2020 7365 6c66 2e77 6f72          self.wor
-00054fe0: 6b65 725f 696d 706f 7274 203d 2077 6f72  ker_import = wor
-00054ff0: 6b65 7273 2e53 6b79 7065 4172 6368 6976  kers.SkypeArchiv
-00055000: 6554 6872 6561 6428 7365 6c66 2e6f 6e5f  eThread(self.on_
-00055010: 776f 726b 6572 5f69 6d70 6f72 745f 6361  worker_import_ca
-00055020: 6c6c 6261 636b 290d 0a0d 0a20 2020 2020  llback)....     
-00055030: 2020 2073 697a 6572 203d 2073 656c 662e     sizer = self.
-00055040: 5369 7a65 7220 3d20 7778 2e42 6f78 5369  Sizer = wx.BoxSi
-00055050: 7a65 7228 7778 2e56 4552 5449 4341 4c29  zer(wx.VERTICAL)
-00055060: 0d0a 0d0a 2020 2020 2020 2020 7369 7a65  ....        size
-00055070: 725f 6865 6164 6572 203d 2077 782e 426f  r_header = wx.Bo
-00055080: 7853 697a 6572 2877 782e 484f 5249 5a4f  xSizer(wx.HORIZO
-00055090: 4e54 414c 290d 0a20 2020 2020 2020 206c  NTAL)..        l
-000550a0: 6162 656c 203d 2073 656c 662e 6874 6d6c  abel = self.html
-000550b0: 5f64 626c 6162 656c 203d 2077 782e 6874  _dblabel = wx.ht
-000550c0: 6d6c 2e48 746d 6c57 696e 646f 7728 7061  ml.HtmlWindow(pa
-000550d0: 7265 6e74 3d73 656c 662c 0d0a 2020 2020  rent=self,..    
-000550e0: 2020 2020 2020 2020 7369 7a65 3d28 2d31          size=(-1
-000550f0: 2c20 3336 292c 2073 7479 6c65 3d77 782e  , 36), style=wx.
-00055100: 6874 6d6c 2e48 575f 5343 524f 4c4c 4241  html.HW_SCROLLBA
-00055110: 525f 4e45 5645 5229 0d0a 2020 2020 2020  R_NEVER)..      
-00055120: 2020 6c61 6265 6c2e 5365 7446 6f6e 7473    label.SetFonts
-00055130: 286e 6f72 6d61 6c5f 6661 6365 3d73 656c  (normal_face=sel
-00055140: 662e 466f 6e74 2e46 6163 654e 616d 652c  f.Font.FaceName,
-00055150: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00055160: 2020 2020 2020 2020 2066 6978 6564 5f66           fixed_f
-00055170: 6163 653d 7365 6c66 2e46 6f6e 742e 4661  ace=self.Font.Fa
-00055180: 6365 4e61 6d65 2c20 7369 7a65 733d 5b38  ceName, sizes=[8
-00055190: 5d20 2a20 3729 0d0a 2020 2020 2020 2020  ] * 7)..        
-000551a0: 7365 6c66 2e42 696e 6428 7778 2e68 746d  self.Bind(wx.htm
-000551b0: 6c2e 4556 545f 4854 4d4c 5f4c 494e 4b5f  l.EVT_HTML_LINK_
-000551c0: 434c 4943 4b45 442c 2073 656c 662e 6f6e  CLICKED, self.on
-000551d0: 5f6c 696e 6b5f 6462 2c20 6c61 6265 6c29  _link_db, label)
-000551e0: 0d0a 2020 2020 2020 2020 6275 7474 6f6e  ..        button
-000551f0: 5f73 7761 7020 3d20 7365 6c66 2e62 7574  _swap = self.but
-00055200: 746f 6e5f 7377 6170 203d 205c 0d0a 2020  ton_swap = \..  
-00055210: 2020 2020 2020 2020 2020 7778 2e42 7574            wx.But
-00055220: 746f 6e28 7061 7265 6e74 3d73 656c 662c  ton(parent=self,
-00055230: 206c 6162 656c 3d22 5326 7761 7020 6c65   label="S&wap le
-00055240: 6674 2d72 6967 6874 2229 0d0a 2020 2020  ft-right")..    
-00055250: 2020 2020 6275 7474 6f6e 5f73 7761 702e      button_swap.
-00055260: 456e 6162 6c65 6420 3d20 4661 6c73 650d  Enabled = False.
-00055270: 0a20 2020 2020 2020 2062 7574 746f 6e5f  .        button_
-00055280: 7377 6170 2e53 6574 546f 6f6c 5469 7028  swap.SetToolTip(
-00055290: 2253 7761 7073 206c 6566 7420 616e 6420  "Swaps left and 
-000552a0: 7269 6768 7420 6461 7461 6261 7365 2c20  right database, 
-000552b0: 220d 0a20 2020 2020 2020 2020 2020 2020  "..             
-000552c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000552d0: 2020 2263 6861 6e67 696e 6720 6d65 7267    "changing merg
-000552e0: 6520 6469 7265 6374 696f 6e2e 2229 0d0a  e direction.")..
-000552f0: 2020 2020 2020 2020 7365 6c66 2e42 696e          self.Bin
-00055300: 6428 7778 2e45 5654 5f42 5554 544f 4e2c  d(wx.EVT_BUTTON,
-00055310: 2073 656c 662e 6f6e 5f73 7761 702c 2062   self.on_swap, b
-00055320: 7574 746f 6e5f 7377 6170 290d 0a20 2020  utton_swap)..   
-00055330: 2020 2020 2073 697a 6572 5f68 6561 6465       sizer_heade
-00055340: 722e 4164 6428 6c61 6265 6c2c 2062 6f72  r.Add(label, bor
-00055350: 6465 723d 352c 2070 726f 706f 7274 696f  der=5, proportio
-00055360: 6e3d 312c 0d0a 2020 2020 2020 2020 2020  n=1,..          
-00055370: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00055380: 6c61 673d 7778 2e47 524f 5720 7c20 7778  lag=wx.GROW | wx
-00055390: 2e54 4f50 207c 2077 782e 424f 5454 4f4d  .TOP | wx.BOTTOM
-000553a0: 290d 0a20 2020 2020 2020 2073 697a 6572  )..        sizer
-000553b0: 5f68 6561 6465 722e 4164 6428 6275 7474  _header.Add(butt
-000553c0: 6f6e 5f73 7761 702c 2062 6f72 6465 723d  on_swap, border=
-000553d0: 352c 2066 6c61 673d 7778 2e4c 4546 5420  5, flag=wx.LEFT 
-000553e0: 7c20 7778 2e52 4947 4854 207c 0d0a 2020  | wx.RIGHT |..  
-000553f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00055400: 2020 2020 2020 2077 782e 414c 4947 4e5f         wx.ALIGN_
-00055410: 4345 4e54 4552 5f56 4552 5449 4341 4c29  CENTER_VERTICAL)
-00055420: 0d0a 2020 2020 2020 2020 7369 7a65 722e  ..        sizer.
-00055430: 4164 6428 7369 7a65 725f 6865 6164 6572  Add(sizer_header
-00055440: 2c20 666c 6167 3d77 782e 4752 4f57 290d  , flag=wx.GROW).
-00055450: 0a20 2020 2020 2020 2073 697a 6572 2e4c  .        sizer.L
-00055460: 6179 6f75 7428 2920 2320 546f 2061 766f  ayout() # To avo
-00055470: 6964 2068 6561 6465 7220 6d6f 7669 6e67  id header moving
-00055480: 2061 726f 756e 6420 6475 7269 6e67 2070   around during p
-00055490: 6167 6520 6372 6561 7469 6f6e 0d0a 0d0a  age creation....
-000554a0: 2020 2020 2020 2020 6e6f 7465 626f 6f6b          notebook
-000554b0: 203d 2073 656c 662e 6e6f 7465 626f 6f6b   = self.notebook
-000554c0: 203d 2077 782e 6c69 622e 6167 772e 6c61   = wx.lib.agw.la
-000554d0: 6265 6c62 6f6f 6b2e 466c 6174 496d 6167  belbook.FlatImag
-000554e0: 6542 6f6f 6b28 0d0a 2020 2020 2020 2020  eBook(..        
-000554f0: 2020 2020 7061 7265 6e74 3d73 656c 662c      parent=self,
-00055500: 2061 6777 5374 796c 653d 7778 2e6c 6962   agwStyle=wx.lib
-00055510: 2e61 6777 2e66 6d72 6573 6f75 7263 6573  .agw.fmresources
-00055520: 2e49 4e42 5f4c 4546 542c 2073 7479 6c65  .INB_LEFT, style
-00055530: 3d77 782e 424f 5244 4552 5f53 5441 5449  =wx.BORDER_STATI
-00055540: 4329 0d0a 2020 2020 2020 2020 7369 7a65  C)..        size
-00055550: 722e 4164 6428 6e6f 7465 626f 6f6b 2c20  r.Add(notebook, 
-00055560: 7072 6f70 6f72 7469 6f6e 3d31 302c 2062  proportion=10, b
-00055570: 6f72 6465 723d 352c 0d0a 2020 2020 2020  order=5,..      
-00055580: 2020 2020 2020 2020 2020 2020 666c 6167              flag
-00055590: 3d77 782e 4752 4f57 207c 2077 782e 4c45  =wx.GROW | wx.LE
-000555a0: 4654 207c 2077 782e 5249 4748 5420 7c20  FT | wx.RIGHT | 
-000555b0: 7778 2e42 4f54 544f 4d29 0d0a 0d0a 2020  wx.BOTTOM)....  
-000555c0: 2020 2020 2020 696c 203d 2077 782e 496d        il = wx.Im
-000555d0: 6167 654c 6973 7428 3332 2c20 3332 290d  ageList(32, 32).
-000555e0: 0a20 2020 2020 2020 2069 6478 3120 3d20  .        idx1 = 
-000555f0: 696c 2e41 6464 2869 6d61 6765 732e 5061  il.Add(images.Pa
-00055600: 6765 4d65 7267 6541 6c6c 2e42 6974 6d61  geMergeAll.Bitma
-00055610: 7029 0d0a 2020 2020 2020 2020 6964 7832  p)..        idx2
-00055620: 203d 2069 6c2e 4164 6428 696d 6167 6573   = il.Add(images
-00055630: 2e50 6167 654d 6572 6765 4368 6174 732e  .PageMergeChats.
-00055640: 4269 746d 6170 290d 0a20 2020 2020 2020  Bitmap)..       
-00055650: 2069 6478 3320 3d20 696c 2e41 6464 2869   idx3 = il.Add(i
-00055660: 6d61 6765 732e 5061 6765 4d65 7267 6543  mages.PageMergeC
-00055670: 6f6e 7461 6374 732e 4269 746d 6170 290d  ontacts.Bitmap).
-00055680: 0a20 2020 2020 2020 206e 6f74 6562 6f6f  .        noteboo
-00055690: 6b2e 4173 7369 676e 496d 6167 654c 6973  k.AssignImageLis
-000556a0: 7428 696c 290d 0a0d 0a20 2020 2020 2020  t(il)....       
-000556b0: 2073 656c 662e 6372 6561 7465 5f70 6167   self.create_pag
-000556c0: 655f 6d65 7267 655f 616c 6c28 6e6f 7465  e_merge_all(note
-000556d0: 626f 6f6b 290d 0a20 2020 2020 2020 2073  book)..        s
-000556e0: 656c 662e 6372 6561 7465 5f70 6167 655f  elf.create_page_
-000556f0: 6d65 7267 655f 6368 6174 7328 6e6f 7465  merge_chats(note
-00055700: 626f 6f6b 290d 0a20 2020 2020 2020 2073  book)..        s
-00055710: 656c 662e 6372 6561 7465 5f70 6167 655f  elf.create_page_
-00055720: 6d65 7267 655f 636f 6e74 6163 7473 286e  merge_contacts(n
-00055730: 6f74 6562 6f6f 6b29 0d0a 0d0a 2020 2020  otebook)....    
-00055740: 2020 2020 6e6f 7465 626f 6f6b 2e53 6574      notebook.Set
-00055750: 5061 6765 496d 6167 6528 302c 2069 6478  PageImage(0, idx
-00055760: 3129 0d0a 2020 2020 2020 2020 6e6f 7465  1)..        note
-00055770: 626f 6f6b 2e53 6574 5061 6765 496d 6167  book.SetPageImag
-00055780: 6528 312c 2069 6478 3229 0d0a 2020 2020  e(1, idx2)..    
-00055790: 2020 2020 6e6f 7465 626f 6f6b 2e53 6574      notebook.Set
-000557a0: 5061 6765 496d 6167 6528 322c 2069 6478  PageImage(2, idx
-000557b0: 3329 0d0a 0d0a 2020 2020 2020 2020 7365  3)....        se
-000557c0: 6c66 2e54 6f70 4c65 7665 6c50 6172 656e  lf.TopLevelParen
-000557d0: 742e 7061 6765 5f6d 6572 6765 5f6c 6174  t.page_merge_lat
-000557e0: 6573 7420 3d20 7365 6c66 0d0a 2020 2020  est = self..    
-000557f0: 2020 2020 7365 6c66 2e54 6f70 4c65 7665      self.TopLeve
-00055800: 6c50 6172 656e 742e 7275 6e5f 636f 6e73  lParent.run_cons
-00055810: 6f6c 6528 0d0a 2020 2020 2020 2020 2020  ole(..          
-00055820: 2020 2270 6167 6531 3220 3d20 7365 6c66    "page12 = self
-00055830: 2e70 6167 655f 6d65 7267 655f 6c61 7465  .page_merge_late
-00055840: 7374 2023 204d 6572 6765 7220 7461 6222  st # Merger tab"
-00055850: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00055860: 546f 704c 6576 656c 5061 7265 6e74 2e72  TopLevelParent.r
-00055870: 756e 5f63 6f6e 736f 6c65 280d 0a20 2020  un_console(..   
-00055880: 2020 2020 2020 2020 2022 6462 312c 2064           "db1, d
-00055890: 6232 203d 2070 6167 6531 322e 6462 312c  b2 = page12.db1,
-000558a0: 2070 6167 6531 322e 6462 3220 2320 4368   page12.db2 # Ch
-000558b0: 6f73 656e 2064 6174 6162 6173 6573 2229  osen databases")
-000558c0: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
-000558d0: 2e4c 6179 6f75 7428 290d 0a20 2020 2020  .Layout()..     
-000558e0: 2020 2073 656c 662e 6c6f 6164 5f64 6174     self.load_dat
-000558f0: 6128 290d 0a20 2020 2020 2020 2023 2048  a()..        # H
-00055900: 6163 6b20 746f 2067 6574 2073 6372 6f6c  ack to get scrol
-00055910: 6c65 6420 7061 6e65 6c73 206c 6179 206f  led panels lay o
-00055920: 7574 2070 726f 7065 726c 790d 0a20 2020  ut properly..   
-00055930: 2020 2020 206e 6f74 6562 6f6f 6b2e 5365       notebook.Se
-00055940: 7453 656c 6563 7469 6f6e 2831 290d 0a20  tSelection(1).. 
-00055950: 2020 2020 2020 2073 656c 662e 7061 6765         self.page
-00055960: 5f6d 6572 6765 5f63 6861 7473 2e4c 6179  _merge_chats.Lay
-00055970: 6f75 7428 290d 0a20 2020 2020 2020 206e  out()..        n
-00055980: 6f74 6562 6f6f 6b2e 5365 7453 656c 6563  otebook.SetSelec
-00055990: 7469 6f6e 2832 290d 0a20 2020 2020 2020  tion(2)..       
-000559a0: 2073 656c 662e 7061 6765 5f6d 6572 6765   self.page_merge
-000559b0: 5f63 6f6e 7461 6374 732e 4c61 796f 7574  _contacts.Layout
-000559c0: 2829 0d0a 2020 2020 2020 2020 6e6f 7465  ()..        note
-000559d0: 626f 6f6b 2e53 6574 5365 6c65 6374 696f  book.SetSelectio
-000559e0: 6e28 3029 0d0a 2020 2020 2020 2020 6275  n(0)..        bu
-000559f0: 7379 2e43 6c6f 7365 2829 0d0a 0d0a 0d0a  sy.Close()......
-00055a00: 2020 2020 6465 6620 6372 6561 7465 5f70      def create_p
-00055a10: 6167 655f 6d65 7267 655f 616c 6c28 7365  age_merge_all(se
-00055a20: 6c66 2c20 6e6f 7465 626f 6f6b 293a 0d0a  lf, notebook):..
-00055a30: 2020 2020 2020 2020 2222 2243 7265 6174          """Creat
-00055a40: 6573 2061 2070 6167 6520 666f 7220 6d65  es a page for me
-00055a50: 7267 696e 6720 616c 6c20 6368 6174 7320  rging all chats 
-00055a60: 6174 206f 6e63 652e 2222 220d 0a20 2020  at once."""..   
-00055a70: 2020 2020 2070 6167 6520 3d20 7365 6c66       page = self
-00055a80: 2e70 6167 655f 6d65 7267 655f 616c 6c20  .page_merge_all 
-00055a90: 3d20 7778 2e6c 6962 2e73 6372 6f6c 6c65  = wx.lib.scrolle
-00055aa0: 6470 616e 656c 2e53 6372 6f6c 6c65 6450  dpanel.ScrolledP
-00055ab0: 616e 656c 286e 6f74 6562 6f6f 6b29 0d0a  anel(notebook)..
-00055ac0: 2020 2020 2020 2020 7365 6c66 2e70 6167          self.pag
-00055ad0: 656f 7264 6572 5b70 6167 655d 203d 206c  eorder[page] = l
-00055ae0: 656e 2873 656c 662e 7061 6765 6f72 6465  en(self.pageorde
-00055af0: 7229 0d0a 2020 2020 2020 2020 6e6f 7465  r)..        note
-00055b00: 626f 6f6b 2e41 6464 5061 6765 2870 6167  book.AddPage(pag
-00055b10: 652c 2022 4d65 7267 6520 616c 6c22 290d  e, "Merge all").
-00055b20: 0a0d 0a20 2020 2020 2020 2070 616e 656c  ...        panel
-00055b30: 203d 2077 782e 5061 6e65 6c28 7061 6765   = wx.Panel(page
-00055b40: 2c20 7374 796c 653d 7778 2e42 4f52 4445  , style=wx.BORDE
-00055b50: 525f 5354 4154 4943 290d 0a20 2020 2020  R_STATIC)..     
-00055b60: 2020 206c 6162 656c 3120 3d20 7365 6c66     label1 = self
-00055b70: 2e6c 6162 656c 5f61 6c6c 3120 3d20 7778  .label_all1 = wx
-00055b80: 2e53 7461 7469 6354 6578 7428 7061 6e65  .StaticText(pane
-00055b90: 6c2c 2073 7479 6c65 3d77 782e 414c 4947  l, style=wx.ALIG
-00055ba0: 4e5f 5249 4748 542c 0d0a 2020 2020 2020  N_RIGHT,..      
-00055bb0: 2020 2020 2020 6c61 6265 6c3d 2225 735c        label="%s\
-00055bc0: 6e5c 6e41 6e61 6c79 7a69 6e67 2e2e 2573  n\nAnalyzing..%s
-00055bd0: 2220 2520 2873 656c 662e 6462 312c 2022  " % (self.db1, "
-00055be0: 5c6e 2220 2a20 3729 290d 0a20 2020 2020  \n" * 7))..     
-00055bf0: 2020 2062 6d70 5f61 7272 6f77 203d 2077     bmp_arrow = w
-00055c00: 782e 5374 6174 6963 4269 746d 6170 2870  x.StaticBitmap(p
-00055c10: 616e 656c 2c20 6269 746d 6170 3d69 6d61  anel, bitmap=ima
-00055c20: 6765 732e 4d65 7267 6554 6f52 6967 6874  ges.MergeToRight
-00055c30: 2e42 6974 6d61 7029 0d0a 2020 2020 2020  .Bitmap)..      
-00055c40: 2020 6c61 6265 6c32 203d 2073 656c 662e    label2 = self.
-00055c50: 6c61 6265 6c5f 616c 6c32 203d 2077 782e  label_all2 = wx.
-00055c60: 5374 6174 6963 5465 7874 2870 616e 656c  StaticText(panel
-00055c70: 2c0d 0a20 2020 2020 2020 2020 2020 206c  ,..            l
-00055c80: 6162 656c 3d22 2573 5c6e 5c6e 416e 616c  abel="%s\n\nAnal
-00055c90: 797a 696e 672e 2e25 7322 2025 2028 7365  yzing..%s" % (se
-00055ca0: 6c66 2e64 6232 2c20 225c 6e22 202a 2037  lf.db2, "\n" * 7
-00055cb0: 2929 0d0a 2020 2020 2020 2020 6275 7474  ))..        butt
-00055cc0: 6f6e 5f73 6361 6e20 3d20 7365 6c66 2e62  on_scan = self.b
-00055cd0: 7574 746f 6e5f 7363 616e 5f61 6c6c 203d  utton_scan_all =
-00055ce0: 2063 6f6e 7472 6f6c 732e 4e6f 7465 4275   controls.NoteBu
-00055cf0: 7474 6f6e 2870 616e 656c 2c0d 0a20 2020  tton(panel,..   
-00055d00: 2020 2020 2020 2020 206c 6162 656c 3d22           label="
-00055d10: 2653 6361 6e20 616e 6420 7265 706f 7274  &Scan and report
-00055d20: 222c 206e 6f74 653d 2253 6361 6e20 7468  ", note="Scan th
-00055d30: 726f 7567 6820 7468 6520 6c65 6674 2064  rough the left d
-00055d40: 6174 6162 6173 6520 220d 0a20 2020 2020  atabase "..     
-00055d50: 2020 2020 2020 2022 616e 6420 6669 6e64         "and find
-00055d60: 206d 6573 7361 6765 7320 6e6f 7420 7072   messages not pr
-00055d70: 6573 656e 7420 6f6e 2074 6865 2072 6967  esent on the rig
-00055d80: 6874 2e22 2c0d 0a20 2020 2020 2020 2020  ht.",..         
-00055d90: 2020 2062 6d70 3d69 6d61 6765 732e 4275     bmp=images.Bu
-00055da0: 7474 6f6e 5363 616e 4469 6666 2e42 6974  ttonScanDiff.Bit
-00055db0: 6d61 7029 0d0a 2020 2020 2020 2020 6275  map)..        bu
-00055dc0: 7474 6f6e 5f6d 6572 6765 203d 2073 656c  tton_merge = sel
-00055dd0: 662e 6275 7474 6f6e 5f6d 6572 6765 5f61  f.button_merge_a
-00055de0: 6c6c 203d 2063 6f6e 7472 6f6c 732e 4e6f  ll = controls.No
-00055df0: 7465 4275 7474 6f6e 2870 616e 656c 2c0d  teButton(panel,.
-00055e00: 0a20 2020 2020 2020 2020 2020 206c 6162  .            lab
-00055e10: 656c 3d22 264d 6572 6765 2074 6f20 7468  el="&Merge to th
-00055e20: 6520 7269 6768 7422 2c20 6e6f 7465 3d73  e right", note=s
-00055e30: 656c 662e 4d45 5247 455f 4255 5454 4f4e  elf.MERGE_BUTTON
-00055e40: 5f4e 4f54 452c 0d0a 2020 2020 2020 2020  _NOTE,..        
-00055e50: 2020 2020 626d 703d 696d 6167 6573 2e42      bmp=images.B
-00055e60: 7574 746f 6e4d 6572 6765 4c65 6674 4d75  uttonMergeLeftMu
-00055e70: 6c74 692e 4269 746d 6170 290d 0a20 2020  lti.Bitmap)..   
-00055e80: 2020 2020 2070 616e 656c 5f67 6175 6765       panel_gauge
-00055e90: 203d 2073 656c 662e 7061 6e65 6c5f 6761   = self.panel_ga
-00055ea0: 7567 6520 3d20 7778 2e50 616e 656c 2870  uge = wx.Panel(p
-00055eb0: 616e 656c 290d 0a20 2020 2020 2020 206c  anel)..        l
-00055ec0: 6162 656c 5f67 6175 6765 203d 2073 656c  abel_gauge = sel
-00055ed0: 662e 6c61 6265 6c5f 6761 7567 6520 3d20  f.label_gauge = 
-00055ee0: 7778 2e53 7461 7469 6354 6578 7428 7061  wx.StaticText(pa
-00055ef0: 6e65 6c5f 6761 7567 652c 206c 6162 656c  nel_gauge, label
-00055f00: 3d22 2229 0d0a 2020 2020 2020 2020 6761  ="")..        ga
-00055f10: 7567 6520 3d20 7365 6c66 2e67 6175 6765  uge = self.gauge
-00055f20: 5f70 726f 6772 6573 7320 3d20 7778 2e47  _progress = wx.G
-00055f30: 6175 6765 2870 616e 656c 5f67 6175 6765  auge(panel_gauge
-00055f40: 2c20 7369 7a65 3d28 3430 302c 2031 3529  , size=(400, 15)
-00055f50: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00055f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00055f70: 2020 2020 2020 2020 2073 7479 6c65 3d77           style=w
-00055f80: 782e 4741 5f48 4f52 495a 4f4e 5441 4c20  x.GA_HORIZONTAL 
-00055f90: 7c20 7778 2e50 445f 534d 4f4f 5448 290d  | wx.PD_SMOOTH).
-00055fa0: 0a20 2020 2020 2020 2068 746d 6c20 3d20  .        html = 
-00055fb0: 7365 6c66 2e68 746d 6c5f 7265 706f 7274  self.html_report
-00055fc0: 203d 205c 0d0a 2020 2020 2020 2020 2020   = \..          
-00055fd0: 2020 636f 6e74 726f 6c73 2e53 6372 6f6c    controls.Scrol
-00055fe0: 6c69 6e67 4874 6d6c 5769 6e64 6f77 2870  lingHtmlWindow(p
-00055ff0: 616e 656c 2c20 7374 796c 653d 7778 2e42  anel, style=wx.B
-00056000: 4f52 4445 525f 5355 4e4b 454e 290d 0a0d  ORDER_SUNKEN)...
-00056010: 0a20 2020 2020 2020 2066 6f72 2063 2069  .        for c i
-00056020: 6e20 5b70 616e 656c 2c20 6275 7474 6f6e  n [panel, button
-00056030: 5f73 6361 6e2c 2062 7574 746f 6e5f 6d65  _scan, button_me
-00056040: 7267 652c 2070 616e 656c 5f67 6175 6765  rge, panel_gauge
-00056050: 5d3a 0d0a 2020 2020 2020 2020 2020 2020  ]:..            
-00056060: 436f 6c6f 7572 4d61 6e61 6765 722e 4d61  ColourManager.Ma
-00056070: 6e61 6765 2863 2c20 2242 6163 6b67 726f  nage(c, "Backgro
-00056080: 756e 6443 6f6c 6f75 7222 2c20 2242 6743  undColour", "BgC
-00056090: 6f6c 6f75 7222 290d 0a20 2020 2020 2020  olour")..       
-000560a0: 2067 6175 6765 2e46 6f72 6567 726f 756e   gauge.Foregroun
-000560b0: 6443 6f6c 6f75 7220 3d20 636f 6e66 2e47  dColour = conf.G
-000560c0: 6175 6765 436f 6c6f 7572 0d0a 2020 2020  augeColour..    
-000560d0: 2020 2020 6275 7474 6f6e 5f73 6361 6e2e      button_scan.
-000560e0: 456e 6162 6c65 6420 3d20 6275 7474 6f6e  Enabled = button
-000560f0: 5f6d 6572 6765 2e45 6e61 626c 6564 203d  _merge.Enabled =
-00056100: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
-00056110: 6275 7474 6f6e 5f73 6361 6e2e 4d69 6e53  button_scan.MinS
-00056120: 697a 6520 3d20 6275 7474 6f6e 5f6d 6572  ize = button_mer
-00056130: 6765 2e4d 696e 5369 7a65 203d 2028 3430  ge.MinSize = (40
-00056140: 302c 202d 3129 0d0a 2020 2020 2020 2020  0, -1)..        
-00056150: 6874 6d6c 2e53 6574 466f 6e74 7328 6e6f  html.SetFonts(no
-00056160: 726d 616c 5f66 6163 653d 7365 6c66 2e46  rmal_face=self.F
-00056170: 6f6e 742e 4661 6365 4e61 6d65 2c0d 0a20  ont.FaceName,.. 
-00056180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056190: 2020 2020 2066 6978 6564 5f66 6163 653d       fixed_face=
-000561a0: 7365 6c66 2e46 6f6e 742e 4661 6365 4e61  self.Font.FaceNa
-000561b0: 6d65 2c20 7369 7a65 733d 5b38 5d20 2a20  me, sizes=[8] * 
-000561c0: 3729 0d0a 2020 2020 2020 2020 436f 6c6f  7)..        Colo
-000561d0: 7572 4d61 6e61 6765 722e 4d61 6e61 6765  urManager.Manage
-000561e0: 2868 746d 6c2c 2022 466f 7265 6772 6f75  (html, "Foregrou
-000561f0: 6e64 436f 6c6f 7572 222c 2022 4667 436f  ndColour", "FgCo
-00056200: 6c6f 7572 2229 0d0a 2020 2020 2020 2020  lour")..        
-00056210: 436f 6c6f 7572 4d61 6e61 6765 722e 4d61  ColourManager.Ma
-00056220: 6e61 6765 2868 746d 6c2c 2022 4261 636b  nage(html, "Back
-00056230: 6772 6f75 6e64 436f 6c6f 7572 222c 2022  groundColour", "
-00056240: 4d65 7267 6548 746d 6c42 6163 6b67 726f  MergeHtmlBackgro
-00056250: 756e 6443 6f6c 6f75 7222 290d 0a20 2020  undColour")..   
-00056260: 2020 2020 2068 746d 6c2e 4869 6465 2829       html.Hide()
-00056270: 0d0a 2020 2020 2020 2020 7061 6e65 6c5f  ..        panel_
-00056280: 6761 7567 652e 4869 6465 2829 0d0a 0d0a  gauge.Hide()....
-00056290: 2020 2020 2020 2020 7061 6765 2e53 697a          page.Siz
-000562a0: 6572 203d 2077 782e 426f 7853 697a 6572  er = wx.BoxSizer
-000562b0: 2877 782e 5645 5254 4943 414c 290d 0a20  (wx.VERTICAL).. 
-000562c0: 2020 2020 2020 2073 697a 6572 203d 2070         sizer = p
-000562d0: 616e 656c 2e53 697a 6572 203d 2077 782e  anel.Sizer = wx.
-000562e0: 426f 7853 697a 6572 2877 782e 5645 5254  BoxSizer(wx.VERT
-000562f0: 4943 414c 290d 0a20 2020 2020 2020 2073  ICAL)..        s
-00056300: 697a 6572 5f74 6f70 203d 2077 782e 4772  izer_top = wx.Gr
-00056310: 6964 4261 6753 697a 6572 2876 6761 703d  idBagSizer(vgap=
-00056320: 352c 2068 6761 703d 3330 290d 0a20 2020  5, hgap=30)..   
-00056330: 2020 2020 2070 616e 656c 5f67 6175 6765       panel_gauge
-00056340: 2e53 697a 6572 203d 2077 782e 426f 7853  .Sizer = wx.BoxS
-00056350: 697a 6572 2877 782e 5645 5254 4943 414c  izer(wx.VERTICAL
-00056360: 290d 0a0d 0a20 2020 2020 2020 2070 6167  )....        pag
-00056370: 652e 5369 7a65 722e 4164 6428 7061 6e65  e.Sizer.Add(pane
-00056380: 6c2c 2070 726f 706f 7274 696f 6e3d 312c  l, proportion=1,
-00056390: 2062 6f72 6465 723d 352c 2066 6c61 673d   border=5, flag=
-000563a0: 7778 2e47 524f 5720 7c20 7778 2e4c 4546  wx.GROW | wx.LEF
-000563b0: 5429 0d0a 2020 2020 2020 2020 7369 7a65  T)..        size
-000563c0: 725f 746f 702e 4164 6428 6c61 6265 6c31  r_top.Add(label1
-000563d0: 2c20 666c 6167 3d77 782e 414c 4947 4e5f  , flag=wx.ALIGN_
-000563e0: 5249 4748 542c 2070 6f73 3d28 302c 2030  RIGHT, pos=(0, 0
-000563f0: 2929 0d0a 2020 2020 2020 2020 7369 7a65  ))..        size
-00056400: 725f 746f 702e 4164 6428 626d 705f 6172  r_top.Add(bmp_ar
-00056410: 726f 772c 2066 6c61 673d 7778 2e41 4c49  row, flag=wx.ALI
-00056420: 474e 5f43 454e 5445 522c 2070 6f73 3d28  GN_CENTER, pos=(
-00056430: 302c 2031 2929 0d0a 2020 2020 2020 2020  0, 1))..        
-00056440: 7369 7a65 725f 746f 702e 4164 6428 6c61  sizer_top.Add(la
-00056450: 6265 6c32 2c20 706f 733d 2830 2c20 3229  bel2, pos=(0, 2)
-00056460: 290d 0a20 2020 2020 2020 2073 697a 6572  )..        sizer
-00056470: 5f74 6f70 2e41 6464 2862 7574 746f 6e5f  _top.Add(button_
-00056480: 7363 616e 2c20 626f 7264 6572 3d32 352c  scan, border=25,
-00056490: 2066 6c61 673d 7778 2e54 4f50 207c 2077   flag=wx.TOP | w
-000564a0: 782e 4752 4f57 2c20 706f 733d 2831 2c20  x.GROW, pos=(1, 
-000564b0: 3129 2c20 7370 616e 3d28 312c 2032 2929  1), span=(1, 2))
-000564c0: 0d0a 2020 2020 2020 2020 7369 7a65 725f  ..        sizer_
-000564d0: 746f 702e 4164 6428 6275 7474 6f6e 5f6d  top.Add(button_m
-000564e0: 6572 6765 2c20 666c 6167 3d77 782e 4752  erge, flag=wx.GR
-000564f0: 4f57 2c20 706f 733d 2832 2c20 3129 2c20  OW, pos=(2, 1), 
-00056500: 7370 616e 3d28 312c 2032 2929 0d0a 2020  span=(1, 2))..  
-00056510: 2020 2020 2020 7061 6e65 6c5f 6761 7567        panel_gaug
-00056520: 652e 5369 7a65 722e 4164 6428 6c61 6265  e.Sizer.Add(labe
-00056530: 6c5f 6761 7567 652c 2066 6c61 673d 7778  l_gauge, flag=wx
-00056540: 2e41 4c49 474e 5f43 454e 5445 5229 0d0a  .ALIGN_CENTER)..
-00056550: 2020 2020 2020 2020 7061 6e65 6c5f 6761          panel_ga
-00056560: 7567 652e 5369 7a65 722e 4164 6428 6761  uge.Sizer.Add(ga
-00056570: 7567 652c 2066 6c61 673d 7778 2e41 4c49  uge, flag=wx.ALI
-00056580: 474e 5f43 454e 5445 5229 0d0a 2020 2020  GN_CENTER)..    
-00056590: 2020 2020 7369 7a65 722e 4164 6428 7369      sizer.Add(si
-000565a0: 7a65 725f 746f 702c 2062 6f72 6465 723d  zer_top, border=
-000565b0: 3130 2c20 666c 6167 3d77 782e 414c 4c20  10, flag=wx.ALL 
-000565c0: 7c20 7778 2e41 4c49 474e 5f43 454e 5445  | wx.ALIGN_CENTE
-000565d0: 5229 0d0a 2020 2020 2020 2020 7369 7a65  R)..        size
-000565e0: 722e 4164 6428 7061 6e65 6c5f 6761 7567  r.Add(panel_gaug
-000565f0: 652c 2062 6f72 6465 723d 3130 2c20 666c  e, border=10, fl
-00056600: 6167 3d77 782e 414c 4c20 7c20 7778 2e47  ag=wx.ALL | wx.G
-00056610: 524f 5729 0d0a 2020 2020 2020 2020 7369  ROW)..        si
-00056620: 7a65 722e 4164 6428 6874 6d6c 2c20 7072  zer.Add(html, pr
-00056630: 6f70 6f72 7469 6f6e 3d31 2c20 626f 7264  oportion=1, bord
-00056640: 6572 3d33 302c 2066 6c61 673d 7778 2e4c  er=30, flag=wx.L
-00056650: 4546 5420 7c20 7778 2e52 4947 4854 207c  EFT | wx.RIGHT |
-00056660: 2077 782e 424f 5454 4f4d 207c 2077 782e   wx.BOTTOM | wx.
-00056670: 4752 4f57 290d 0a20 2020 2020 2020 2073  GROW)..        s
-00056680: 697a 6572 5f74 6f70 2e41 6464 4772 6f77  izer_top.AddGrow
-00056690: 6162 6c65 436f 6c28 3029 0d0a 2020 2020  ableCol(0)..    
-000566a0: 2020 2020 7369 7a65 725f 746f 702e 4164      sizer_top.Ad
-000566b0: 6447 726f 7761 626c 6543 6f6c 2832 290d  dGrowableCol(2).
-000566c0: 0a20 2020 2020 2020 2070 6167 652e 5365  .        page.Se
-000566d0: 7475 7053 6372 6f6c 6c69 6e67 2829 0d0a  tupScrolling()..
-000566e0: 0d0a 2020 2020 2020 2020 6275 7474 6f6e  ..        button
-000566f0: 5f73 6361 6e2e 4269 6e64 2877 782e 4556  _scan.Bind(wx.EV
-00056700: 545f 4255 5454 4f4e 2c20 7365 6c66 2e6f  T_BUTTON, self.o
-00056710: 6e5f 7363 616e 5f61 6c6c 290d 0a20 2020  n_scan_all)..   
-00056720: 2020 2020 2062 7574 746f 6e5f 6d65 7267       button_merg
-00056730: 652e 4269 6e64 2877 782e 4556 545f 4255  e.Bind(wx.EVT_BU
-00056740: 5454 4f4e 2c20 7365 6c66 2e6f 6e5f 6d65  TTON, self.on_me
-00056750: 7267 655f 616c 6c29 0d0a 2020 2020 2020  rge_all)..      
-00056760: 2020 6874 6d6c 2e42 696e 6428 7778 2e68    html.Bind(wx.h
-00056770: 746d 6c2e 4556 545f 4854 4d4c 5f4c 494e  tml.EVT_HTML_LIN
-00056780: 4b5f 434c 4943 4b45 442c 2073 656c 662e  K_CLICKED, self.
-00056790: 6f6e 5f63 6c69 636b 5f68 746d 6c64 6966  on_click_htmldif
-000567a0: 6629 0d0a 0d0a 0d0a 2020 2020 6465 6620  f)......    def 
-000567b0: 6372 6561 7465 5f70 6167 655f 6d65 7267  create_page_merg
-000567c0: 655f 6368 6174 7328 7365 6c66 2c20 6e6f  e_chats(self, no
-000567d0: 7465 626f 6f6b 293a 0d0a 2020 2020 2020  tebook):..      
-000567e0: 2020 2222 2243 7265 6174 6573 2061 2070    """Creates a p
-000567f0: 6167 6520 666f 7220 7365 6569 6e67 2061  age for seeing a
-00056800: 6e64 206d 6572 6769 6e67 2064 6966 6665  nd merging diffe
-00056810: 7269 6e67 2063 6861 7473 2e22 2222 0d0a  ring chats."""..
-00056820: 2020 2020 2020 2020 7061 6765 203d 2073          page = s
-00056830: 656c 662e 7061 6765 5f6d 6572 6765 5f63  elf.page_merge_c
-00056840: 6861 7473 203d 2077 782e 5061 6e65 6c28  hats = wx.Panel(
-00056850: 7061 7265 6e74 3d6e 6f74 6562 6f6f 6b29  parent=notebook)
-00056860: 0d0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
-00056870: 6167 656f 7264 6572 5b70 6167 655d 203d  ageorder[page] =
-00056880: 206c 656e 2873 656c 662e 7061 6765 6f72   len(self.pageor
-00056890: 6465 7229 0d0a 2020 2020 2020 2020 6e6f  der)..        no
-000568a0: 7465 626f 6f6b 2e41 6464 5061 6765 2870  tebook.AddPage(p
-000568b0: 6167 652c 2022 4368 6174 7322 290d 0a20  age, "Chats").. 
-000568c0: 2020 2020 2020 2073 697a 6572 203d 2070         sizer = p
-000568d0: 6167 652e 5369 7a65 7220 3d20 7778 2e42  age.Sizer = wx.B
-000568e0: 6f78 5369 7a65 7228 7778 2e56 4552 5449  oxSizer(wx.VERTI
-000568f0: 4341 4c29 0d0a 2020 2020 2020 2020 7370  CAL)..        sp
-00056900: 6c69 7474 6572 203d 2073 656c 662e 7370  litter = self.sp
-00056910: 6c69 7474 6572 5f6d 6572 6765 203d 2077  litter_merge = w
-00056920: 782e 5370 6c69 7474 6572 5769 6e64 6f77  x.SplitterWindow
-00056930: 280d 0a20 2020 2020 2020 2020 2020 2070  (..            p
-00056940: 6172 656e 743d 7061 6765 2c20 7374 796c  arent=page, styl
-00056950: 653d 7778 2e42 4f52 4445 525f 4e4f 4e45  e=wx.BORDER_NONE
-00056960: 0d0a 2020 2020 2020 2020 290d 0a20 2020  ..        )..   
-00056970: 2020 2020 2073 706c 6974 7465 722e 5365       splitter.Se
-00056980: 744d 696e 696d 756d 5061 6e65 5369 7a65  tMinimumPaneSize
-00056990: 2831 3030 290d 0a20 2020 2020 2020 2070  (100)..        p
-000569a0: 616e 656c 3120 3d20 7778 2e50 616e 656c  anel1 = wx.Panel
-000569b0: 2870 6172 656e 743d 7370 6c69 7474 6572  (parent=splitter
-000569c0: 290d 0a20 2020 2020 2020 2070 616e 656c  )..        panel
-000569d0: 3220 3d20 7778 2e50 616e 656c 2870 6172  2 = wx.Panel(par
-000569e0: 656e 743d 7370 6c69 7474 6572 290d 0a20  ent=splitter).. 
-000569f0: 2020 2020 2020 2073 697a 6572 3120 3d20         sizer1 = 
-00056a00: 7061 6e65 6c31 2e53 697a 6572 203d 2077  panel1.Sizer = w
-00056a10: 782e 426f 7853 697a 6572 2877 782e 5645  x.BoxSizer(wx.VE
-00056a20: 5254 4943 414c 290d 0a20 2020 2020 2020  RTICAL)..       
-00056a30: 2073 697a 6572 3220 3d20 7061 6e65 6c32   sizer2 = panel2
-00056a40: 2e53 697a 6572 203d 2077 782e 426f 7853  .Sizer = wx.BoxS
-00056a50: 697a 6572 2877 782e 5645 5254 4943 414c  izer(wx.VERTICAL
-00056a60: 290d 0a20 2020 2020 2020 2073 697a 6572  )..        sizer
-00056a70: 5f74 6f70 203d 2077 782e 426f 7853 697a  _top = wx.BoxSiz
-00056a80: 6572 2877 782e 484f 5249 5a4f 4e54 414c  er(wx.HORIZONTAL
-00056a90: 290d 0a0d 0a20 2020 2020 2020 2073 697a  )....        siz
-00056aa0: 6572 5f74 6f70 2e41 6464 2877 782e 5374  er_top.Add(wx.St
-00056ab0: 6174 6963 5465 7874 2870 6172 656e 743d  aticText(parent=
-00056ac0: 7061 6e65 6c31 2c20 6c61 6265 6c3d 2226  panel1, label="&
-00056ad0: 4368 6174 2063 6f6d 7061 7269 736f 6e3a  Chat comparison:
-00056ae0: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
-00056af0: 2020 2020 2020 2020 2020 6e61 6d65 3d22            name="
-00056b00: 6368 6174 735f 6c61 6265 6c22 292c 2066  chats_label"), f
-00056b10: 6c61 673d 7778 2e41 4c49 474e 5f43 454e  lag=wx.ALIGN_CEN
-00056b20: 5445 525f 5645 5254 4943 414c 290d 0a20  TER_VERTICAL).. 
-00056b30: 2020 2020 2020 2073 697a 6572 5f74 6f70         sizer_top
-00056b40: 2e41 6464 5374 7265 7463 6853 7061 6365  .AddStretchSpace
-00056b50: 7228 290d 0a20 2020 2020 2020 2065 6469  r()..        edi
-00056b60: 745f 6368 6174 6669 6c74 6572 203d 2073  t_chatfilter = s
-00056b70: 656c 662e 6564 6974 5f63 6861 7466 696c  elf.edit_chatfil
-00056b80: 7465 7220 3d20 636f 6e74 726f 6c73 2e48  ter = controls.H
-00056b90: 696e 7465 6454 6578 7443 7472 6c28 0d0a  intedTextCtrl(..
-00056ba0: 2020 2020 2020 2020 2020 2020 7061 6e65              pane
-00056bb0: 6c31 2c20 2246 696c 7465 7220 6368 6174  l1, "Filter chat
-00056bc0: 7322 2c20 7374 796c 653d 7778 2e54 455f  s", style=wx.TE_
-00056bd0: 5052 4f43 4553 535f 454e 5445 522c 2073  PROCESS_ENTER, s
-00056be0: 697a 653d 2837 352c 202d 3129 290d 0a20  ize=(75, -1)).. 
-00056bf0: 2020 2020 2020 2065 6469 745f 6368 6174         edit_chat
-00056c00: 6669 6c74 6572 2e53 6574 546f 6f6c 5469  filter.SetToolTi
-00056c10: 7028 2246 696c 7465 7220 6974 656d 7320  p("Filter items 
-00056c20: 696e 2063 6861 7420 6c69 7374 2229 0d0a  in chat list")..
-00056c30: 2020 2020 2020 2020 7365 6c66 2e42 696e          self.Bin
-00056c40: 6428 7778 2e45 5654 5f54 4558 545f 454e  d(wx.EVT_TEXT_EN
-00056c50: 5445 522c 2073 656c 662e 6f6e 5f63 6861  TER, self.on_cha
-00056c60: 6e67 655f 6368 6174 6669 6c74 6572 2c20  nge_chatfilter, 
-00056c70: 6564 6974 5f63 6861 7466 696c 7465 7229  edit_chatfilter)
-00056c80: 0d0a 2020 2020 2020 2020 7369 7a65 725f  ..        sizer_
-00056c90: 746f 702e 4164 6428 6564 6974 5f63 6861  top.Add(edit_cha
-00056ca0: 7466 696c 7465 722c 2066 6c61 673d 7778  tfilter, flag=wx
-00056cb0: 2e42 4f54 544f 4d20 7c20 7778 2e41 4c49  .BOTTOM | wx.ALI
-00056cc0: 474e 5f54 4f50 2c20 626f 7264 6572 3d35  GN_TOP, border=5
-00056cd0: 290d 0a20 2020 2020 2020 2073 697a 6572  )..        sizer
-00056ce0: 5f74 6f70 2e41 6464 5370 6163 6572 2832  _top.AddSpacer(2
-00056cf0: 3029 0d0a 2020 2020 2020 2020 7365 6c66  0)..        self
-00056d00: 2e62 7574 746f 6e5f 6d65 7267 655f 6368  .button_merge_ch
-00056d10: 6174 7320 3d20 7778 2e42 7574 746f 6e28  ats = wx.Button(
-00056d20: 7061 6e65 6c31 2c20 6c61 6265 6c3d 224d  panel1, label="M
-00056d30: 6572 6765 2026 7365 6c65 6374 6564 2229  erge &selected")
-00056d40: 0d0a 2020 2020 2020 2020 6368 6174 735f  ..        chats_
-00056d50: 746f 6f6c 7469 7020 3d20 224d 6572 6765  tooltip = "Merge
-00056d60: 2064 6966 6665 7265 6e63 6573 2069 6e20   differences in 
-00056d70: 7365 6c65 6374 6564 2063 6861 7473 2074  selected chats t
-00056d80: 6f20 7468 6520 7269 6768 7422 0d0a 2020  o the right"..  
-00056d90: 2020 2020 2020 7365 6c66 2e62 7574 746f        self.butto
-00056da0: 6e5f 6d65 7267 655f 6368 6174 732e 5365  n_merge_chats.Se
-00056db0: 7454 6f6f 6c54 6970 2863 6861 7473 5f74  tToolTip(chats_t
-00056dc0: 6f6f 6c74 6970 290d 0a20 2020 2020 2020  ooltip)..       
-00056dd0: 2073 656c 662e 6275 7474 6f6e 5f6d 6572   self.button_mer
-00056de0: 6765 5f63 6861 7473 2e45 6e61 626c 6564  ge_chats.Enabled
-00056df0: 203d 2046 616c 7365 0d0a 2020 2020 2020   = False..      
-00056e00: 2020 7369 7a65 725f 746f 702e 4164 6428    sizer_top.Add(
-00056e10: 7365 6c66 2e62 7574 746f 6e5f 6d65 7267  self.button_merg
-00056e20: 655f 6368 6174 732c 2066 6c61 673d 7778  e_chats, flag=wx
-00056e30: 2e41 4c49 474e 5f54 4f50 207c 2077 782e  .ALIGN_TOP | wx.
-00056e40: 424f 5454 4f4d 2c0d 0a20 2020 2020 2020  BOTTOM,..       
-00056e50: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-00056e60: 6f72 6465 723d 3529 0d0a 2020 2020 2020  order=5)..      
-00056e70: 2020 7365 6c66 2e42 696e 6428 7778 2e45    self.Bind(wx.E
-00056e80: 5654 5f42 5554 544f 4e2c 2073 656c 662e  VT_BUTTON, self.
-00056e90: 6f6e 5f6d 6572 6765 5f63 6861 7473 2c20  on_merge_chats, 
-00056ea0: 7365 6c66 2e62 7574 746f 6e5f 6d65 7267  self.button_merg
-00056eb0: 655f 6368 6174 7329 0d0a 2020 2020 2020  e_chats)..      
-00056ec0: 2020 7369 7a65 7231 2e41 6464 2873 697a    sizer1.Add(siz
-00056ed0: 6572 5f74 6f70 2c20 666c 6167 3d77 782e  er_top, flag=wx.
-00056ee0: 4752 4f57 290d 0a0d 0a20 2020 2020 2020  GROW)....       
-00056ef0: 206c 6973 745f 6368 6174 7320 3d20 7365   list_chats = se
-00056f00: 6c66 2e6c 6973 745f 6368 6174 7320 3d20  lf.list_chats = 
-00056f10: 636f 6e74 726f 6c73 2e53 6f72 7461 626c  controls.Sortabl
-00056f20: 654c 6973 7456 6965 7728 0d0a 2020 2020  eListView(..    
-00056f30: 2020 2020 2020 2020 7061 7265 6e74 3d70          parent=p
-00056f40: 616e 656c 312c 2073 7479 6c65 3d77 782e  anel1, style=wx.
-00056f50: 4c43 5f52 4550 4f52 542c 206e 616d 653d  LC_REPORT, name=
-00056f60: 2263 6861 7473 2229 0d0a 2020 2020 2020  "chats")..      
-00056f70: 2020 6c69 7374 5f63 6861 7473 2e53 6574    list_chats.Set
-00056f80: 436f 6c75 6d6e 7328 7365 6c66 2e63 6861  Columns(self.cha
-00056f90: 7473 5f6c 6973 745f 636f 6c75 6d6e 7329  ts_list_columns)
-00056fa0: 0d0a 2020 2020 2020 2020 6c69 7374 5f63  ..        list_c
-00056fb0: 6861 7473 2e53 6574 436f 6c75 6d6e 734d  hats.SetColumnsM
-00056fc0: 6178 5769 6474 6828 3330 3029 0d0a 2020  axWidth(300)..  
-00056fd0: 2020 2020 2020 6c69 7374 5f63 6861 7473        list_chats
-00056fe0: 2e53 6f72 744c 6973 7449 7465 6d73 2833  .SortListItems(3
-00056ff0: 2c20 3029 2023 2053 6f72 7420 6279 206c  , 0) # Sort by l
-00057000: 6173 7420 6d65 7373 6167 6520 696e 206c  ast message in l
-00057010: 6566 740d 0a20 2020 2020 2020 206c 6973  eft..        lis
-00057020: 745f 6368 6174 732e 456e 6162 6c65 6420  t_chats.Enabled 
-00057030: 3d20 4661 6c73 650d 0a20 2020 2020 2020  = False..       
-00057040: 2073 656c 662e 4269 6e64 2877 782e 4556   self.Bind(wx.EV
-00057050: 545f 4c49 5354 5f49 5445 4d5f 4143 5449  T_LIST_ITEM_ACTI
-00057060: 5641 5445 442c 2073 656c 662e 6f6e 5f63  VATED, self.on_c
-00057070: 6861 6e67 655f 6c69 7374 5f63 6861 7473  hange_list_chats
-00057080: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00057090: 2020 2020 206c 6973 745f 6368 6174 7329       list_chats)
-000570a0: 0d0a 2020 2020 2020 2020 7369 7a65 7231  ..        sizer1
-000570b0: 2e41 6464 286c 6973 745f 6368 6174 732c  .Add(list_chats,
-000570c0: 2070 726f 706f 7274 696f 6e3d 312c 2066   proportion=1, f
-000570d0: 6c61 673d 7778 2e47 524f 5729 0d0a 0d0a  lag=wx.GROW)....
-000570e0: 2020 2020 2020 2020 6c61 6265 6c5f 6368          label_ch
-000570f0: 6174 203d 2073 656c 662e 6c61 6265 6c5f  at = self.label_
-00057100: 6d65 7267 655f 6368 6174 203d 205c 0d0a  merge_chat = \..
-00057110: 2020 2020 2020 2020 2020 2020 7778 2e53              wx.S
-00057120: 7461 7469 6354 6578 7428 7061 7265 6e74  taticText(parent
-00057130: 3d70 616e 656c 322c 206c 6162 656c 3d22  =panel2, label="
-00057140: 2229 0d0a 2020 2020 2020 2020 7370 6c69  ")..        spli
-00057150: 7474 6572 5f64 6966 6620 3d20 7365 6c66  tter_diff = self
-00057160: 2e73 706c 6974 7465 725f 6469 6666 203d  .splitter_diff =
-00057170: 2077 782e 5370 6c69 7474 6572 5769 6e64   wx.SplitterWind
-00057180: 6f77 280d 0a20 2020 2020 2020 2020 2020  ow(..           
-00057190: 2070 6172 656e 743d 7061 6e65 6c32 2c20   parent=panel2, 
-000571a0: 7374 796c 653d 7778 2e42 4f52 4445 525f  style=wx.BORDER_
-000571b0: 4e4f 4e45 290d 0a20 2020 2020 2020 2073  NONE)..        s
-000571c0: 706c 6974 7465 725f 6469 6666 2e53 6574  plitter_diff.Set
-000571d0: 4d69 6e69 6d75 6d50 616e 6553 697a 6528  MinimumPaneSize(
-000571e0: 3335 3029 0d0a 2020 2020 2020 2020 7061  350)..        pa
-000571f0: 6e65 6c5f 7374 6331 203d 2073 656c 662e  nel_stc1 = self.
-00057200: 7061 6e65 6c5f 7374 6331 203d 2077 782e  panel_stc1 = wx.
-00057210: 5061 6e65 6c28 7061 7265 6e74 3d73 706c  Panel(parent=spl
-00057220: 6974 7465 725f 6469 6666 290d 0a20 2020  itter_diff)..   
-00057230: 2020 2020 2070 616e 656c 5f73 7463 3220       panel_stc2 
-00057240: 3d20 7365 6c66 2e70 616e 656c 5f73 7463  = self.panel_stc
-00057250: 3220 3d20 7778 2e6c 6962 2e73 6372 6f6c  2 = wx.lib.scrol
-00057260: 6c65 6470 616e 656c 2e53 6372 6f6c 6c65  ledpanel.Scrolle
-00057270: 6450 616e 656c 2873 706c 6974 7465 725f  dPanel(splitter_
-00057280: 6469 6666 290d 0a20 2020 2020 2020 2043  diff)..        C
-00057290: 6f6c 6f75 724d 616e 6167 6572 2e4d 616e  olourManager.Man
-000572a0: 6167 6528 7061 6e65 6c5f 7374 6332 2c20  age(panel_stc2, 
-000572b0: 2242 6163 6b67 726f 756e 6443 6f6c 6f75  "BackgroundColou
-000572c0: 7222 2c20 2242 6743 6f6c 6f75 7222 290d  r", "BgColour").
-000572d0: 0a20 2020 2020 2020 2073 697a 6572 5f73  .        sizer_s
-000572e0: 7463 3120 3d20 7061 6e65 6c5f 7374 6331  tc1 = panel_stc1
-000572f0: 2e53 697a 6572 203d 2077 782e 426f 7853  .Sizer = wx.BoxS
-00057300: 697a 6572 2877 782e 5645 5254 4943 414c  izer(wx.VERTICAL
-00057310: 290d 0a20 2020 2020 2020 2073 697a 6572  )..        sizer
-00057320: 5f73 7463 3220 3d20 7061 6e65 6c5f 7374  _stc2 = panel_st
-00057330: 6332 2e53 697a 6572 203d 2077 782e 426f  c2.Sizer = wx.Bo
-00057340: 7853 697a 6572 2877 782e 5645 5254 4943  xSizer(wx.VERTIC
-00057350: 414c 290d 0a0d 0a20 2020 2020 2020 2073  AL)....        s
-00057360: 7463 3120 3d20 7365 6c66 2e73 7463 5f64  tc1 = self.stc_d
-00057370: 6966 6631 203d 2043 6861 7443 6f6e 7465  iff1 = ChatConte
-00057380: 6e74 5354 4328 0d0a 2020 2020 2020 2020  ntSTC(..        
-00057390: 2020 2020 7061 7265 6e74 3d70 616e 656c      parent=panel
-000573a0: 5f73 7463 312c 2073 7479 6c65 3d77 782e  _stc1, style=wx.
-000573b0: 424f 5244 4552 5f53 5441 5449 4329 0d0a  BORDER_STATIC)..
-000573c0: 2020 2020 2020 2020 7374 6331 2e53 6574          stc1.Set
-000573d0: 4175 746f 5265 7472 6965 7665 2846 616c  AutoRetrieve(Fal
-000573e0: 7365 290d 0a20 2020 2020 2020 2073 7463  se)..        stc
-000573f0: 312e 5445 5854 5f4e 4f5f 4d45 5353 4147  1.TEXT_NO_MESSAG
-00057400: 4553 203d 2022 5c6e 4e6f 206e 6577 206d  ES = "\nNo new m
-00057410: 6573 7361 6765 7320 746f 2073 686f 772e  essages to show.
-00057420: 220d 0a0d 0a20 2020 2020 2020 2062 7574  "....        but
-00057430: 746f 6e5f 6d65 7267 6520 3d20 7365 6c66  ton_merge = self
-00057440: 2e62 7574 746f 6e5f 6d65 7267 655f 6368  .button_merge_ch
-00057450: 6174 203d 2063 6f6e 7472 6f6c 732e 4e6f  at = controls.No
-00057460: 7465 4275 7474 6f6e 280d 0a20 2020 2020  teButton(..     
-00057470: 2020 2020 2020 2070 616e 656c 5f73 7463         panel_stc
-00057480: 322c 206c 6162 656c 3d22 264d 6572 6765  2, label="&Merge
-00057490: 2074 6f20 7468 6520 7269 6768 7422 2c0d   to the right",.
-000574a0: 0a20 2020 2020 2020 2020 2020 206e 6f74  .            not
-000574b0: 653d 7365 6c66 2e4d 4552 4745 5f43 4841  e=self.MERGE_CHA
-000574c0: 545f 4255 5454 4f4e 5f4e 4f54 452c 2062  T_BUTTON_NOTE, b
-000574d0: 6d70 3d69 6d61 6765 732e 4275 7474 6f6e  mp=images.Button
-000574e0: 4d65 7267 654c 6566 742e 4269 746d 6170  MergeLeft.Bitmap
-000574f0: 290d 0a20 2020 2020 2020 2062 7574 746f  )..        butto
-00057500: 6e5f 6578 706f 7274 203d 2073 656c 662e  n_export = self.
-00057510: 6275 7474 6f6e 5f65 7870 6f72 745f 6368  button_export_ch
-00057520: 6174 203d 2063 6f6e 7472 6f6c 732e 4e6f  at = controls.No
-00057530: 7465 4275 7474 6f6e 280d 0a20 2020 2020  teButton(..     
-00057540: 2020 2020 2020 2070 616e 656c 5f73 7463         panel_stc
-00057550: 322c 206c 6162 656c 3d22 2645 7870 6f72  2, label="&Expor
-00057560: 7420 6d65 7373 6167 6573 222c 0d0a 2020  t messages",..  
-00057570: 2020 2020 2020 2020 2020 6e6f 7465 3d22            note="
-00057580: 4578 706f 7274 2064 6574 6563 7465 6420  Export detected 
-00057590: 6d65 7373 6167 6573 2061 7320 4854 4d4c  messages as HTML
-000575a0: 2c20 7465 7874 206f 7220 7370 7265 6164  , text or spread
-000575b0: 7368 6565 742e 222c 0d0a 2020 2020 2020  sheet.",..      
-000575c0: 2020 2020 2020 626d 703d 696d 6167 6573        bmp=images
-000575d0: 2e42 7574 746f 6e45 7870 6f72 742e 4269  .ButtonExport.Bi
-000575e0: 746d 6170 290d 0a20 2020 2020 2020 2062  tmap)..        b
-000575f0: 7574 746f 6e5f 6d65 7267 652e 4269 6e64  utton_merge.Bind
-00057600: 2877 782e 4556 545f 4255 5454 4f4e 2c20  (wx.EVT_BUTTON, 
-00057610: 7365 6c66 2e6f 6e5f 6d65 7267 655f 6368  self.on_merge_ch
-00057620: 6174 290d 0a20 2020 2020 2020 2062 7574  at)..        but
-00057630: 746f 6e5f 6578 706f 7274 2e42 696e 6428  ton_export.Bind(
-00057640: 7778 2e45 5654 5f42 5554 544f 4e2c 2073  wx.EVT_BUTTON, s
-00057650: 656c 662e 6f6e 5f65 7870 6f72 745f 6368  elf.on_export_ch
-00057660: 6174 290d 0a20 2020 2020 2020 2043 6f6c  at)..        Col
-00057670: 6f75 724d 616e 6167 6572 2e4d 616e 6167  ourManager.Manag
-00057680: 6528 6275 7474 6f6e 5f6d 6572 6765 2c20  e(button_merge, 
-00057690: 2022 4261 636b 6772 6f75 6e64 436f 6c6f   "BackgroundColo
-000576a0: 7572 222c 2022 4267 436f 6c6f 7572 2229  ur", "BgColour")
-000576b0: 0d0a 2020 2020 2020 2020 436f 6c6f 7572  ..        Colour
-000576c0: 4d61 6e61 6765 722e 4d61 6e61 6765 2862  Manager.Manage(b
-000576d0: 7574 746f 6e5f 6578 706f 7274 2c20 2242  utton_export, "B
-000576e0: 6163 6b67 726f 756e 6443 6f6c 6f75 7222  ackgroundColour"
-000576f0: 2c20 2242 6743 6f6c 6f75 7222 290d 0a20  , "BgColour").. 
-00057700: 2020 2020 2020 2062 7574 746f 6e5f 6d65         button_me
-00057710: 7267 652e 456e 6162 6c65 6420 3d20 6275  rge.Enabled = bu
-00057720: 7474 6f6e 5f65 7870 6f72 742e 456e 6162  tton_export.Enab
-00057730: 6c65 6420 3d20 4661 6c73 650d 0a0d 0a20  led = False.... 
-00057740: 2020 2020 2020 2073 697a 6572 5f73 7463         sizer_stc
-00057750: 312e 4164 6428 7374 6331 2c20 7072 6f70  1.Add(stc1, prop
-00057760: 6f72 7469 6f6e 3d31 2c20 666c 6167 3d77  ortion=1, flag=w
-00057770: 782e 4752 4f57 290d 0a20 2020 2020 2020  x.GROW)..       
-00057780: 2073 697a 6572 5f73 7463 322e 4164 6453   sizer_stc2.AddS
-00057790: 7472 6574 6368 5370 6163 6572 2829 0d0a  tretchSpacer()..
-000577a0: 2020 2020 2020 2020 7369 7a65 725f 7374          sizer_st
-000577b0: 6332 2e41 6464 2862 7574 746f 6e5f 6d65  c2.Add(button_me
-000577c0: 7267 652c 2062 6f72 6465 723d 352c 2020  rge, border=5,  
-000577d0: 666c 6167 3d77 782e 414c 4c20 7c20 7778  flag=wx.ALL | wx
-000577e0: 2e47 524f 5729 0d0a 2020 2020 2020 2020  .GROW)..        
-000577f0: 7369 7a65 725f 7374 6332 2e41 6464 2862  sizer_stc2.Add(b
-00057800: 7574 746f 6e5f 6578 706f 7274 2c20 626f  utton_export, bo
-00057810: 7264 6572 3d35 2c20 666c 6167 3d77 782e  rder=5, flag=wx.
-00057820: 414c 4c20 7c20 7778 2e47 524f 5729 0d0a  ALL | wx.GROW)..
-00057830: 2020 2020 2020 2020 7369 7a65 725f 7374          sizer_st
-00057840: 6332 2e41 6464 5374 7265 7463 6853 7061  c2.AddStretchSpa
-00057850: 6365 7228 290d 0a20 2020 2020 2020 2073  cer()..        s
-00057860: 697a 6572 322e 4164 6428 6c61 6265 6c5f  izer2.Add(label_
-00057870: 6368 6174 2c20 626f 7264 6572 3d35 2c20  chat, border=5, 
-00057880: 666c 6167 3d77 782e 414c 4c29 0d0a 2020  flag=wx.ALL)..  
-00057890: 2020 2020 2020 7369 7a65 7232 2e41 6464        sizer2.Add
-000578a0: 2873 706c 6974 7465 725f 6469 6666 2c20  (splitter_diff, 
-000578b0: 7072 6f70 6f72 7469 6f6e 3d31 2c20 666c  proportion=1, fl
-000578c0: 6167 3d77 782e 4752 4f57 290d 0a0d 0a20  ag=wx.GROW).... 
-000578d0: 2020 2020 2020 2073 697a 6572 2e41 6464         sizer.Add
-000578e0: 5370 6163 6572 2835 290d 0a20 2020 2020  Spacer(5)..     
-000578f0: 2020 2073 697a 6572 2e41 6464 2873 706c     sizer.Add(spl
-00057900: 6974 7465 722c 2062 6f72 6465 723d 352c  itter, border=5,
-00057910: 2070 726f 706f 7274 696f 6e3d 312c 2066   proportion=1, f
-00057920: 6c61 673d 7778 2e47 524f 5720 7c20 7778  lag=wx.GROW | wx
-00057930: 2e41 4c4c 290d 0a20 2020 2020 2020 2073  .ALL)..        s
-00057940: 706c 6974 7465 725f 6469 6666 2e53 6574  plitter_diff.Set
-00057950: 5361 7368 4772 6176 6974 7928 302e 3529  SashGravity(0.5)
-00057960: 0d0a 2020 2020 2020 2020 7370 6c69 7474  ..        splitt
-00057970: 6572 5f64 6966 662e 5370 6c69 7456 6572  er_diff.SplitVer
-00057980: 7469 6361 6c6c 7928 7061 6e65 6c5f 7374  tically(panel_st
-00057990: 6331 2c20 7061 6e65 6c5f 7374 6332 2c0d  c1, panel_stc2,.
-000579a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000579b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000579c0: 2020 2020 2020 2073 6173 6850 6f73 6974         sashPosit
-000579d0: 696f 6e3d 7365 6c66 2e53 697a 652e 7769  ion=self.Size.wi
-000579e0: 6474 6829 0d0a 2020 2020 2020 2020 7370  dth)..        sp
-000579f0: 6c69 7474 6572 2e53 706c 6974 486f 7269  litter.SplitHori
-00057a00: 7a6f 6e74 616c 6c79 2870 616e 656c 312c  zontally(panel1,
-00057a10: 2070 616e 656c 322c 0d0a 2020 2020 2020   panel2,..      
-00057a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00057a30: 2020 2020 2020 2020 2020 2020 2073 6173               sas
-00057a40: 6850 6f73 6974 696f 6e3d 7365 6c66 2e53  hPosition=self.S
-00057a50: 697a 652e 6865 6967 6874 202f 2f20 3329  ize.height // 3)
-00057a60: 0d0a 2020 2020 2020 2020 7061 6e65 6c5f  ..        panel_
-00057a70: 7374 6332 2e53 6574 7570 5363 726f 6c6c  stc2.SetupScroll
-00057a80: 696e 6728 7363 726f 6c6c 5f78 3d46 616c  ing(scroll_x=Fal
-00057a90: 7365 290d 0a0d 0a0d 0a20 2020 2064 6566  se)......    def
-00057aa0: 2063 7265 6174 655f 7061 6765 5f6d 6572   create_page_mer
-00057ab0: 6765 5f63 6f6e 7461 6374 7328 7365 6c66  ge_contacts(self
-00057ac0: 2c20 6e6f 7465 626f 6f6b 293a 0d0a 2020  , notebook):..  
-00057ad0: 2020 2020 2020 2222 2243 7265 6174 6573        """Creates
-00057ae0: 2061 2070 6167 6520 666f 7220 7365 6569   a page for seei
-00057af0: 6e67 2061 6e64 206d 6572 6769 6e67 2064  ng and merging d
-00057b00: 6966 6665 7269 6e67 2063 6f6e 7461 6374  iffering contact
-00057b10: 732e 2222 220d 0a20 2020 2020 2020 2070  s."""..        p
-00057b20: 6167 6520 3d20 7365 6c66 2e70 6167 655f  age = self.page_
-00057b30: 6d65 7267 655f 636f 6e74 6163 7473 203d  merge_contacts =
-00057b40: 2077 782e 5061 6e65 6c28 7061 7265 6e74   wx.Panel(parent
-00057b50: 3d6e 6f74 6562 6f6f 6b29 0d0a 2020 2020  =notebook)..    
-00057b60: 2020 2020 7365 6c66 2e70 6167 656f 7264      self.pageord
-00057b70: 6572 5b70 6167 655d 203d 206c 656e 2873  er[page] = len(s
-00057b80: 656c 662e 7061 6765 6f72 6465 7229 0d0a  elf.pageorder)..
-00057b90: 2020 2020 2020 2020 6e6f 7465 626f 6f6b          notebook
-00057ba0: 2e41 6464 5061 6765 2870 6167 652c 2022  .AddPage(page, "
-00057bb0: 436f 6e74 6163 7473 2229 0d0a 2020 2020  Contacts")..    
-00057bc0: 2020 2020 7369 7a65 7220 3d20 7061 6765      sizer = page
-00057bd0: 2e53 697a 6572 203d 2077 782e 426f 7853  .Sizer = wx.BoxS
-00057be0: 697a 6572 2877 782e 5645 5254 4943 414c  izer(wx.VERTICAL
-00057bf0: 290d 0a0d 0a20 2020 2020 2020 2073 706c  )....        spl
-00057c00: 6974 7465 7220 3d20 7365 6c66 2e73 706c  itter = self.spl
-00057c10: 6974 7465 725f 636f 6e74 6163 7473 203d  itter_contacts =
-00057c20: 2077 782e 5370 6c69 7474 6572 5769 6e64   wx.SplitterWind
-00057c30: 6f77 280d 0a20 2020 2020 2020 2020 2020  ow(..           
-00057c40: 2070 6172 656e 743d 7061 6765 2c20 7374   parent=page, st
-00057c50: 796c 653d 7778 2e42 4f52 4445 525f 4e4f  yle=wx.BORDER_NO
-00057c60: 4e45 0d0a 2020 2020 2020 2020 290d 0a20  NE..        ).. 
-00057c70: 2020 2020 2020 2073 706c 6974 7465 722e         splitter.
-00057c80: 5365 744d 696e 696d 756d 5061 6e65 5369  SetMinimumPaneSi
-00057c90: 7a65 2833 3530 290d 0a20 2020 2020 2020  ze(350)..       
-00057ca0: 2070 616e 656c 3120 3d20 7778 2e50 616e   panel1 = wx.Pan
-00057cb0: 656c 2870 6172 656e 743d 7370 6c69 7474  el(parent=splitt
-00057cc0: 6572 290d 0a20 2020 2020 2020 2070 616e  er)..        pan
-00057cd0: 656c 3220 3d20 7778 2e6c 6962 2e73 6372  el2 = wx.lib.scr
-00057ce0: 6f6c 6c65 6470 616e 656c 2e53 6372 6f6c  olledpanel.Scrol
-00057cf0: 6c65 6450 616e 656c 2873 706c 6974 7465  ledPanel(splitte
-00057d00: 7229 0d0a 2020 2020 2020 2020 436f 6c6f  r)..        Colo
-00057d10: 7572 4d61 6e61 6765 722e 4d61 6e61 6765  urManager.Manage
-00057d20: 2870 616e 656c 322c 2022 4261 636b 6772  (panel2, "Backgr
-00057d30: 6f75 6e64 436f 6c6f 7572 222c 2022 4267  oundColour", "Bg
-00057d40: 436f 6c6f 7572 2229 0d0a 2020 2020 2020  Colour")..      
-00057d50: 2020 7369 7a65 7231 203d 2070 616e 656c    sizer1 = panel
-00057d60: 312e 5369 7a65 7220 3d20 7778 2e42 6f78  1.Sizer = wx.Box
-00057d70: 5369 7a65 7228 7778 2e56 4552 5449 4341  Sizer(wx.VERTICA
-00057d80: 4c29 0d0a 2020 2020 2020 2020 7369 7a65  L)..        size
-00057d90: 7232 203d 2070 616e 656c 322e 5369 7a65  r2 = panel2.Size
-00057da0: 7220 3d20 7778 2e42 6f78 5369 7a65 7228  r = wx.BoxSizer(
-00057db0: 7778 2e56 4552 5449 4341 4c29 0d0a 0d0a  wx.VERTICAL)....
-00057dc0: 2020 2020 2020 2020 7369 7a65 725f 746f          sizer_to
-00057dd0: 7020 3d20 7778 2e42 6f78 5369 7a65 7228  p = wx.BoxSizer(
-00057de0: 7778 2e48 4f52 495a 4f4e 5441 4c29 0d0a  wx.HORIZONTAL)..
-00057df0: 2020 2020 2020 2020 6c62 6c20 3d20 7778          lbl = wx
-00057e00: 2e53 7461 7469 6354 6578 7428 7061 7265  .StaticText(pare
-00057e10: 6e74 3d70 616e 656c 312c 206c 6162 656c  nt=panel1, label
-00057e20: 3d22 4e65 7720 2663 6f6e 7461 6374 7320  ="New &contacts 
-00057e30: 6f6e 2074 6865 206c 6566 743a 222c 0d0a  on the left:",..
-00057e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00057e50: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
-00057e60: 3d22 636f 6e74 6163 745f 6c69 7374 5f6c  ="contact_list_l
-00057e70: 6162 656c 2229 0d0a 2020 2020 2020 2020  abel")..        
-00057e80: 7369 7a65 725f 746f 702e 4164 6428 6c62  sizer_top.Add(lb
-00057e90: 6c2c 2066 6c61 673d 7778 2e41 4c49 474e  l, flag=wx.ALIGN
-00057ea0: 5f43 454e 5445 525f 5645 5254 4943 414c  _CENTER_VERTICAL
-00057eb0: 290d 0a20 2020 2020 2020 2073 697a 6572  )..        sizer
-00057ec0: 5f74 6f70 2e41 6464 5374 7265 7463 6853  _top.AddStretchS
-00057ed0: 7061 6365 7228 290d 0a20 2020 2020 2020  pacer()..       
-00057ee0: 2065 6469 745f 636f 6e74 6163 7466 696c   edit_contactfil
-00057ef0: 7465 7220 3d20 7365 6c66 2e65 6469 745f  ter = self.edit_
-00057f00: 636f 6e74 6163 7466 696c 7465 7220 3d20  contactfilter = 
-00057f10: 636f 6e74 726f 6c73 2e48 696e 7465 6454  controls.HintedT
-00057f20: 6578 7443 7472 6c28 0d0a 2020 2020 2020  extCtrl(..      
-00057f30: 2020 2020 2020 7061 6e65 6c31 2c20 2246        panel1, "F
-00057f40: 696c 7465 7220 636f 6e74 6163 7473 222c  ilter contacts",
-00057f50: 2073 7479 6c65 3d77 782e 5445 5f50 524f   style=wx.TE_PRO
-00057f60: 4345 5353 5f45 4e54 4552 2c20 7369 7a65  CESS_ENTER, size
-00057f70: 3d28 3930 2c20 2d31 2929 0d0a 2020 2020  =(90, -1))..    
-00057f80: 2020 2020 6564 6974 5f63 6f6e 7461 6374      edit_contact
-00057f90: 6669 6c74 6572 2e53 6574 546f 6f6c 5469  filter.SetToolTi
-00057fa0: 7028 2246 696c 7465 7220 6974 656d 7320  p("Filter items 
-00057fb0: 696e 2063 6f6e 7461 6374 206c 6973 7473  in contact lists
-00057fc0: 2229 0d0a 2020 2020 2020 2020 7365 6c66  ")..        self
-00057fd0: 2e42 696e 6428 7778 2e45 5654 5f54 4558  .Bind(wx.EVT_TEX
-00057fe0: 545f 454e 5445 522c 2073 656c 662e 6f6e  T_ENTER, self.on
-00057ff0: 5f63 6861 6e67 655f 636f 6e74 6163 7466  _change_contactf
-00058000: 696c 7465 722c 0d0a 2020 2020 2020 2020  ilter,..        
-00058010: 2020 2020 2020 2020 2020 6564 6974 5f63            edit_c
-00058020: 6f6e 7461 6374 6669 6c74 6572 290d 0a20  ontactfilter).. 
-00058030: 2020 2020 2020 2073 697a 6572 5f74 6f70         sizer_top
-00058040: 2e41 6464 2865 6469 745f 636f 6e74 6163  .Add(edit_contac
-00058050: 7466 696c 7465 7229 0d0a 0d0a 2020 2020  tfilter)....    
-00058060: 2020 2020 6c69 7374 3120 3d20 7365 6c66      list1 = self
-00058070: 2e6c 6973 745f 636f 6e74 6163 7473 203d  .list_contacts =
-00058080: 2063 6f6e 7472 6f6c 732e 536f 7274 6162   controls.Sortab
-00058090: 6c65 4c69 7374 5669 6577 280d 0a20 2020  leListView(..   
-000580a0: 2020 2020 2020 2020 2070 6172 656e 743d           parent=
-000580b0: 7061 6e65 6c31 2c20 2073 7479 6c65 3d77  panel1,  style=w
-000580c0: 782e 4c43 5f52 4550 4f52 542c 206e 616d  x.LC_REPORT, nam
-000580d0: 653d 2263 6f6e 7461 6374 5f6c 6973 7422  e="contact_list"
-000580e0: 290d 0a20 2020 2020 2020 206c 6973 7431  )..        list1
-000580f0: 2e53 6574 436f 6c75 6d6e 7328 7365 6c66  .SetColumns(self
-00058100: 2e63 6f6e 7461 6374 735f 6c69 7374 5f63  .contacts_list_c
-00058110: 6f6c 756d 6e73 290d 0a20 2020 2020 2020  olumns)..       
-00058120: 206c 6973 7431 2e53 6574 436f 6c75 6d6e   list1.SetColumn
-00058130: 734d 6178 5769 6474 6828 3330 3029 0d0a  sMaxWidth(300)..
-00058140: 2020 2020 2020 2020 6c69 7374 312e 4269          list1.Bi
-00058150: 6e64 2877 782e 4556 545f 4c49 5354 5f49  nd(wx.EVT_LIST_I
-00058160: 5445 4d5f 5345 4c45 4354 4544 2c20 2020  TEM_SELECTED,   
-00058170: 7365 6c66 2e6f 6e5f 7365 6c65 6374 5f6c  self.on_select_l
-00058180: 6973 745f 636f 6e74 6163 7473 290d 0a20  ist_contacts).. 
-00058190: 2020 2020 2020 206c 6973 7431 2e42 696e         list1.Bin
-000581a0: 6428 7778 2e45 5654 5f4c 4953 545f 4954  d(wx.EVT_LIST_IT
-000581b0: 454d 5f44 4553 454c 4543 5445 442c 2073  EM_DESELECTED, s
-000581c0: 656c 662e 6f6e 5f73 656c 6563 745f 6c69  elf.on_select_li
-000581d0: 7374 5f63 6f6e 7461 6374 7329 0d0a 2020  st_contacts)..  
-000581e0: 2020 2020 2020 6c69 7374 312e 4269 6e64        list1.Bind
-000581f0: 2877 782e 4556 545f 4c49 5354 5f49 5445  (wx.EVT_LIST_ITE
-00058200: 4d5f 4143 5449 5641 5445 442c 2020 7365  M_ACTIVATED,  se
-00058210: 6c66 2e6f 6e5f 6d65 7267 655f 636f 6e74  lf.on_merge_cont
-00058220: 6163 7473 290d 0a0d 0a20 2020 2020 2020  acts)....       
-00058230: 2062 7574 746f 6e31 203d 2073 656c 662e   button1 = self.
-00058240: 6275 7474 6f6e 5f6d 6572 6765 5f63 6f6e  button_merge_con
-00058250: 7461 6374 7320 3d20 636f 6e74 726f 6c73  tacts = controls
-00058260: 2e4e 6f74 6542 7574 746f 6e28 0d0a 2020  .NoteButton(..  
-00058270: 2020 2020 2020 2020 2020 7061 6e65 6c32            panel2
-00058280: 2c20 6c61 6265 6c3d 2226 4d65 7267 6520  , label="&Merge 
-00058290: 7365 6c65 6374 6564 2074 6f20 7468 6520  selected to the 
-000582a0: 7269 6768 7422 2c0d 0a20 2020 2020 2020  right",..       
-000582b0: 2020 2020 206e 6f74 653d 2243 6f70 7920       note="Copy 
-000582c0: 7365 6c65 6374 6564 2063 6f6e 7461 6374  selected contact
-000582d0: 7320 746f 2074 6865 2064 6174 6162 6173  s to the databas
-000582e0: 6520 6f6e 2074 6865 2072 6967 6874 2e22  e on the right."
-000582f0: 2c0d 0a20 2020 2020 2020 2020 2020 2062  ,..            b
-00058300: 6d70 3d69 6d61 6765 732e 4275 7474 6f6e  mp=images.Button
-00058310: 4d65 7267 654c 6566 742e 4269 746d 6170  MergeLeft.Bitmap
-00058320: 290d 0a20 2020 2020 2020 2062 7574 746f  )..        butto
-00058330: 6e5f 616c 6c31 203d 2073 656c 662e 6275  n_all1 = self.bu
-00058340: 7474 6f6e 5f6d 6572 6765 5f61 6c6c 636f  tton_merge_allco
-00058350: 6e74 6163 7473 203d 2063 6f6e 7472 6f6c  ntacts = control
-00058360: 732e 4e6f 7465 4275 7474 6f6e 280d 0a20  s.NoteButton(.. 
-00058370: 2020 2020 2020 2020 2020 2070 616e 656c             panel
-00058380: 322c 206c 6162 656c 3d22 4d65 7267 6520  2, label="Merge 
-00058390: 2661 6c6c 2074 6f20 7468 6520 7269 6768  &all to the righ
-000583a0: 7422 2c0d 0a20 2020 2020 2020 2020 2020  t",..           
-000583b0: 206e 6f74 653d 2243 6f70 7920 616c 6c20   note="Copy all 
-000583c0: 636f 6e74 6163 7473 2074 6f20 7468 6520  contacts to the 
-000583d0: 6461 7461 6261 7365 206f 6e20 7468 6520  database on the 
-000583e0: 7269 6768 742e 222c 0d0a 2020 2020 2020  right.",..      
-000583f0: 2020 2020 2020 626d 703d 696d 6167 6573        bmp=images
-00058400: 2e42 7574 746f 6e4d 6572 6765 4c65 6674  .ButtonMergeLeft
-00058410: 4d75 6c74 692e 4269 746d 6170 290d 0a20  Multi.Bitmap).. 
-00058420: 2020 2020 2020 2043 6f6c 6f75 724d 616e         ColourMan
-00058430: 6167 6572 2e4d 616e 6167 6528 6275 7474  ager.Manage(butt
-00058440: 6f6e 312c 2020 2020 2022 4261 636b 6772  on1,     "Backgr
-00058450: 6f75 6e64 436f 6c6f 7572 222c 2022 4267  oundColour", "Bg
-00058460: 436f 6c6f 7572 2229 0d0a 2020 2020 2020  Colour")..      
-00058470: 2020 436f 6c6f 7572 4d61 6e61 6765 722e    ColourManager.
-00058480: 4d61 6e61 6765 2862 7574 746f 6e5f 616c  Manage(button_al
-00058490: 6c31 2c20 2242 6163 6b67 726f 756e 6443  l1, "BackgroundC
-000584a0: 6f6c 6f75 7222 2c20 2242 6743 6f6c 6f75  olour", "BgColou
-000584b0: 7222 290d 0a20 2020 2020 2020 2062 7574  r")..        but
-000584c0: 746f 6e31 2e42 696e 6428 7778 2e45 5654  ton1.Bind(wx.EVT
-000584d0: 5f42 5554 544f 4e2c 2073 656c 662e 6f6e  _BUTTON, self.on
-000584e0: 5f6d 6572 6765 5f63 6f6e 7461 6374 7329  _merge_contacts)
-000584f0: 0d0a 2020 2020 2020 2020 6275 7474 6f6e  ..        button
-00058500: 5f61 6c6c 312e 4269 6e64 2877 782e 4556  _all1.Bind(wx.EV
-00058510: 545f 4255 5454 4f4e 2c20 7365 6c66 2e6f  T_BUTTON, self.o
-00058520: 6e5f 6d65 7267 655f 636f 6e74 6163 7473  n_merge_contacts
-00058530: 290d 0a20 2020 2020 2020 2062 7574 746f  )..        butto
-00058540: 6e31 2e45 6e61 626c 6564 203d 2062 7574  n1.Enabled = but
-00058550: 746f 6e5f 616c 6c31 2e45 6e61 626c 6564  ton_all1.Enabled
-00058560: 203d 2046 616c 7365 0d0a 2020 2020 2020   = False..      
-00058570: 2020 7369 7a65 7231 2e41 6464 2873 697a    sizer1.Add(siz
-00058580: 6572 5f74 6f70 2c20 666c 6167 3d77 782e  er_top, flag=wx.
-00058590: 4752 4f57 207c 2077 782e 424f 5454 4f4d  GROW | wx.BOTTOM
-000585a0: 207c 2077 782e 5249 4748 542c 2062 6f72   | wx.RIGHT, bor
-000585b0: 6465 723d 3529 0d0a 2020 2020 2020 2020  der=5)..        
-000585c0: 7369 7a65 7231 2e41 6464 286c 6973 7431  sizer1.Add(list1
-000585d0: 2c20 7072 6f70 6f72 7469 6f6e 3d31 2c20  , proportion=1, 
-000585e0: 666c 6167 3d77 782e 4752 4f57 207c 2077  flag=wx.GROW | w
-000585f0: 782e 424f 5454 4f4d 207c 2077 782e 5249  x.BOTTOM | wx.RI
-00058600: 4748 542c 0d0a 2020 2020 2020 2020 2020  GHT,..          
-00058610: 2020 2020 2020 2020 2062 6f72 6465 723d           border=
-00058620: 3529 0d0a 2020 2020 2020 2020 7369 7a65  5)..        size
-00058630: 7232 2e41 6464 5374 7265 7463 6853 7061  r2.AddStretchSpa
-00058640: 6365 7228 290d 0a20 2020 2020 2020 2073  cer()..        s
-00058650: 697a 6572 322e 4164 6428 6275 7474 6f6e  izer2.Add(button
-00058660: 312c 2020 2020 2066 6c61 673d 7778 2e41  1,     flag=wx.A
-00058670: 4c4c 207c 2077 782e 4752 4f57 2c20 626f  LL | wx.GROW, bo
-00058680: 7264 6572 3d35 290d 0a20 2020 2020 2020  rder=5)..       
-00058690: 2073 697a 6572 322e 4164 6428 6275 7474   sizer2.Add(butt
-000586a0: 6f6e 5f61 6c6c 312c 2066 6c61 673d 7778  on_all1, flag=wx
-000586b0: 2e41 4c4c 207c 2077 782e 4752 4f57 2c20  .ALL | wx.GROW, 
-000586c0: 626f 7264 6572 3d35 290d 0a20 2020 2020  border=5)..     
-000586d0: 2020 2073 697a 6572 322e 4164 6453 7472     sizer2.AddStr
-000586e0: 6574 6368 5370 6163 6572 2829 0d0a 0d0a  etchSpacer()....
-000586f0: 2020 2020 2020 2020 7370 6c69 7474 6572          splitter
-00058700: 2e53 706c 6974 5665 7274 6963 616c 6c79  .SplitVertically
-00058710: 2870 616e 656c 312c 2070 616e 656c 322c  (panel1, panel2,
-00058720: 2073 6173 6850 6f73 6974 696f 6e3d 7365   sashPosition=se
-00058730: 6c66 2e53 697a 652e 7769 6474 6829 0d0a  lf.Size.width)..
-00058740: 0d0a 2020 2020 2020 2020 7369 7a65 722e  ..        sizer.
-00058750: 4164 6453 7061 6365 7228 3130 290d 0a20  AddSpacer(10).. 
-00058760: 2020 2020 2020 2073 697a 6572 2e41 6464         sizer.Add
-00058770: 2873 706c 6974 7465 722c 2070 726f 706f  (splitter, propo
-00058780: 7274 696f 6e3d 312c 2062 6f72 6465 723d  rtion=1, border=
-00058790: 352c 0d0a 2020 2020 2020 2020 2020 2020  5,..            
-000587a0: 2020 2020 2020 666c 6167 3d77 782e 4752        flag=wx.GR
-000587b0: 4f57 207c 2077 782e 4c45 4654 207c 2077  OW | wx.LEFT | w
-000587c0: 782e 5249 4748 5429 0d0a 2020 2020 2020  x.RIGHT)..      
-000587d0: 2020 7061 6e65 6c32 2e53 6574 7570 5363    panel2.SetupSc
-000587e0: 726f 6c6c 696e 6728 7363 726f 6c6c 5f78  rolling(scroll_x
-000587f0: 3d46 616c 7365 290d 0a0d 0a0d 0a20 2020  =False)......   
-00058800: 2064 6566 206f 6e5f 6578 706f 7274 5f63   def on_export_c
-00058810: 6861 7428 7365 6c66 2c20 6576 656e 7429  hat(self, event)
-00058820: 3a0d 0a20 2020 2020 2020 2022 2222 0d0a  :..        """..
-00058830: 2020 2020 2020 2020 4861 6e64 6c65 7220          Handler 
-00058840: 666f 7220 636c 6963 6b69 6e67 2074 6f20  for clicking to 
-00058850: 6578 706f 7274 2061 2063 6861 7420 6469  export a chat di
-00058860: 6666 2c20 6469 7370 6c61 7973 2061 2073  ff, displays a s
-00058870: 6176 6520 6669 6c65 2064 6961 6c6f 670d  ave file dialog.
-00058880: 0a20 2020 2020 2020 2061 6e64 2073 6176  .        and sav
-00058890: 6573 2074 6865 2063 7572 7265 6e74 206d  es the current m
-000588a0: 6573 7361 6765 7320 746f 2066 696c 652e  essages to file.
-000588b0: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
-000588c0: 2020 2020 2020 2066 6f72 6d61 7461 7267         formatarg
-000588d0: 7320 3d20 636f 6c6c 6563 7469 6f6e 732e  s = collections.
-000588e0: 6465 6661 756c 7464 6963 7428 7374 7229  defaultdict(str)
-000588f0: 3b20 666f 726d 6174 6172 6773 2e75 7064  ; formatargs.upd
-00058900: 6174 6528 7365 6c66 2e63 6861 7429 0d0a  ate(self.chat)..
-00058910: 2020 2020 2020 2020 6465 6661 756c 7420          default 
-00058920: 3d20 2244 6966 6620 6f66 2025 7322 2025  = "Diff of %s" %
-00058930: 2063 6f6e 662e 4578 706f 7274 4368 6174   conf.ExportChat
-00058940: 5465 6d70 6c61 7465 2025 2066 6f72 6d61  Template % forma
-00058950: 7461 7267 730d 0a20 2020 2020 2020 2064  targs..        d
-00058960: 6961 6c6f 6720 3d20 7778 2e46 696c 6544  ialog = wx.FileD
-00058970: 6961 6c6f 6728 7061 7265 6e74 3d73 656c  ialog(parent=sel
-00058980: 662c 206d 6573 7361 6765 3d22 5361 7665  f, message="Save
-00058990: 206e 6577 206d 6573 7361 6765 7322 2c0d   new messages",.
-000589a0: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
-000589b0: 6175 6c74 4669 6c65 3d75 7469 6c2e 7361  aultFile=util.sa
-000589c0: 6665 5f66 696c 656e 616d 6528 6465 6661  fe_filename(defa
-000589d0: 756c 7429 2c0d 0a20 2020 2020 2020 2020  ult),..         
-000589e0: 2020 2073 7479 6c65 3d77 782e 4644 5f4f     style=wx.FD_O
-000589f0: 5645 5257 5249 5445 5f50 524f 4d50 5420  VERWRITE_PROMPT 
-00058a00: 7c20 7778 2e46 445f 5341 5645 207c 2077  | wx.FD_SAVE | w
-00058a10: 782e 5245 5349 5a45 5f42 4f52 4445 520d  x.RESIZE_BORDER.
-00058a20: 0a20 2020 2020 2020 2029 0d0a 2020 2020  .        )..    
-00058a30: 2020 2020 6469 616c 6f67 2e57 696c 6463      dialog.Wildc
-00058a40: 6172 6420 3d20 6578 706f 7274 2e43 4841  ard = export.CHA
-00058a50: 545f 5749 4c44 4341 5244 0d0a 2020 2020  T_WILDCARD..    
-00058a60: 2020 2020 6469 616c 6f67 2e46 696c 7465      dialog.Filte
-00058a70: 7249 6e64 6578 203d 2065 7870 6f72 742e  rIndex = export.
-00058a80: 4348 4154 5f45 5854 532e 696e 6465 7828  CHAT_EXTS.index(
-00058a90: 2268 746d 6c22 290d 0a20 2020 2020 2020  "html")..       
-00058aa0: 2069 6620 7778 2e49 445f 4f4b 2021 3d20   if wx.ID_OK != 
-00058ab0: 6469 616c 6f67 2e53 686f 774d 6f64 616c  dialog.ShowModal
-00058ac0: 2829 3a20 7265 7475 726e 0d0a 0d0a 2020  (): return....  
-00058ad0: 2020 2020 2020 6669 6c65 7061 7468 203d        filepath =
-00058ae0: 2063 6f6e 7472 6f6c 732e 6765 745f 6469   controls.get_di
-00058af0: 616c 6f67 5f70 6174 6828 6469 616c 6f67  alog_path(dialog
-00058b00: 290d 0a20 2020 2020 2020 2066 6f72 6d61  )..        forma
-00058b10: 7420 3d20 6578 706f 7274 2e43 4841 545f  t = export.CHAT_
-00058b20: 4558 5453 5b64 6961 6c6f 672e 4669 6c74  EXTS[dialog.Filt
-00058b30: 6572 496e 6465 785d 0d0a 2020 2020 2020  erIndex]..      
-00058b40: 2020 6d65 6469 615f 666f 6c64 6572 203d    media_folder =
-00058b50: 2022 6874 6d6c 2220 3d3d 2066 6f72 6d61   "html" == forma
-00058b60: 7420 616e 6420 5c0d 0a20 2020 2020 2020  t and \..       
-00058b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00058b80: 6469 616c 6f67 2e46 696c 7465 7249 6e64  dialog.FilterInd
-00058b90: 6578 2021 3d20 6578 706f 7274 2e43 4841  ex != export.CHA
-00058ba0: 545f 4558 5453 2e69 6e64 6578 2822 6874  T_EXTS.index("ht
-00058bb0: 6d6c 2229 0d0a 2020 2020 2020 2020 6966  ml")..        if
-00058bc0: 206d 6564 6961 5f66 6f6c 6465 7220 616e   media_folder an
-00058bd0: 6420 6e6f 7420 6368 6563 6b5f 6d65 6469  d not check_medi
-00058be0: 615f 6578 706f 7274 5f6c 6f67 696e 2873  a_export_login(s
-00058bf0: 656c 662e 6462 293a 2072 6574 7572 6e0d  elf.db): return.
-00058c00: 0a0d 0a20 2020 2020 2020 2062 7573 7920  ...        busy 
-00058c10: 3d20 636f 6e74 726f 6c73 2e42 7573 7950  = controls.BusyP
-00058c20: 616e 656c 2873 656c 662c 2027 4578 706f  anel(self, 'Expo
-00058c30: 7274 696e 6720 2225 7322 2e27 2025 2073  rting "%s".' % s
-00058c40: 656c 662e 6368 6174 5b22 7469 746c 6522  elf.chat["title"
-00058c50: 5d29 0d0a 2020 2020 2020 2020 6775 6962  ])..        guib
-00058c60: 6173 652e 7374 6174 7573 2822 4578 706f  ase.status("Expo
-00058c70: 7274 696e 6720 746f 2025 732e 222c 2066  rting to %s.", f
-00058c80: 696c 6570 6174 682c 206c 6f67 3d54 7275  ilepath, log=Tru
-00058c90: 6529 0d0a 2020 2020 2020 2020 7472 793a  e)..        try:
-00058ca0: 0d0a 2020 2020 2020 2020 2020 2020 6d65  ..            me
-00058cb0: 7373 6167 6573 203d 2073 656c 662e 6462  ssages = self.db
-00058cc0: 312e 6d65 7373 6167 655f 6974 6572 6174  1.message_iterat
-00058cd0: 6f72 2873 656c 662e 6368 6174 5f64 6966  or(self.chat_dif
-00058ce0: 665b 226d 6573 7361 6765 7322 5d29 0d0a  f["messages"])..
-00058cf0: 2020 2020 2020 2020 2020 2020 6f70 7473              opts
-00058d00: 203d 2064 6963 7428 6d65 7373 6167 6573   = dict(messages
-00058d10: 3d6d 6573 7361 6765 732c 2070 726f 6772  =messages, progr
-00058d20: 6573 733d 6c61 6d62 6461 202a 6172 6773  ess=lambda *args
-00058d30: 3a20 7778 2e53 6166 6559 6965 6c64 2829  : wx.SafeYield()
-00058d40: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
-00058d50: 6620 6d65 6469 615f 666f 6c64 6572 3a20  f media_folder: 
-00058d60: 6f70 7473 5b22 6d65 6469 615f 666f 6c64  opts["media_fold
-00058d70: 6572 225d 203d 2054 7275 650d 0a20 2020  er"] = True..   
-00058d80: 2020 2020 2020 2020 2072 6573 756c 7420           result 
-00058d90: 3d20 6578 706f 7274 2e65 7870 6f72 745f  = export.export_
-00058da0: 6368 6174 7328 5b73 656c 662e 6368 6174  chats([self.chat
-00058db0: 5d2c 2066 696c 6570 6174 682c 2066 6f72  ], filepath, for
-00058dc0: 6d61 742c 2073 656c 662e 6462 312c 206f  mat, self.db1, o
-00058dd0: 7074 7329 0d0a 2020 2020 2020 2020 2020  pts)..          
-00058de0: 2020 6669 6c65 732c 2063 6f75 6e74 2c20    files, count, 
-00058df0: 6d65 7373 6167 655f 636f 756e 7420 3d20  message_count = 
-00058e00: 7265 7375 6c74 0d0a 2020 2020 2020 2020  result..        
-00058e10: 2020 2020 6775 6962 6173 652e 7374 6174      guibase.stat
-00058e20: 7573 2822 4578 706f 7274 6564 2025 7320  us("Exported %s 
-00058e30: 746f 2025 732e 222c 0d0a 2020 2020 2020  to %s.",..      
-00058e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00058e50: 2020 2020 2075 7469 6c2e 706c 7572 616c       util.plural
-00058e60: 2822 6d65 7373 6167 6522 2c20 6d65 7373  ("message", mess
-00058e70: 6167 655f 636f 756e 742c 2073 6570 3d22  age_count, sep="
-00058e80: 2c22 292c 0d0a 2020 2020 2020 2020 2020  ,"),..          
-00058e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00058ea0: 2066 696c 6570 6174 682c 206c 6f67 3d54   filepath, log=T
-00058eb0: 7275 6529 0d0a 2020 2020 2020 2020 2020  rue)..          
-00058ec0: 2020 6966 2063 6f6e 662e 4578 706f 7274    if conf.Export
-00058ed0: 4669 6c65 4175 746f 4f70 656e 3a20 7574  FileAutoOpen: ut
-00058ee0: 696c 2e73 7461 7274 5f66 696c 6528 6669  il.start_file(fi
-00058ef0: 6c65 7061 7468 290d 0a20 2020 2020 2020  lepath)..       
-00058f00: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
-00058f10: 6e3a 0d0a 2020 2020 2020 2020 2020 2020  n:..            
-00058f20: 6775 6962 6173 652e 7374 6174 7573 2822  guibase.status("
-00058f30: 4572 726f 7220 7361 7669 6e67 2025 732e  Error saving %s.
-00058f40: 222c 2066 696c 6570 6174 6829 0d0a 2020  ", filepath)..  
-00058f50: 2020 2020 2020 2020 2020 6c6f 6767 6572            logger
-00058f60: 2e65 7863 6570 7469 6f6e 2822 4572 726f  .exception("Erro
-00058f70: 7220 7361 7669 6e67 2025 732e 222c 2066  r saving %s.", f
-00058f80: 696c 6570 6174 6829 0d0a 2020 2020 2020  ilepath)..      
-00058f90: 2020 2020 2020 6572 726f 726d 7367 203d        errormsg =
-00058fa0: 2022 4572 726f 7220 7361 7669 6e67 2025   "Error saving %
-00058fb0: 733a 5c6e 5c6e 2573 2220 2520 5c0d 0a20  s:\n\n%s" % \.. 
-00058fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00058fd0: 2020 2020 2020 2866 696c 6570 6174 682c        (filepath,
-00058fe0: 2074 7261 6365 6261 636b 2e66 6f72 6d61   traceback.forma
-00058ff0: 745f 6578 6328 2929 0d0a 2020 2020 2020  t_exc())..      
-00059000: 2020 2020 2020 7778 2e4d 6573 7361 6765        wx.Message
-00059010: 426f 7828 6572 726f 726d 7367 2c20 636f  Box(errormsg, co
-00059020: 6e66 2e54 6974 6c65 2c20 7778 2e4f 4b20  nf.Title, wx.OK 
-00059030: 7c20 7778 2e49 434f 4e5f 5741 524e 494e  | wx.ICON_WARNIN
-00059040: 4729 0d0a 2020 2020 2020 2020 6669 6e61  G)..        fina
-00059050: 6c6c 793a 0d0a 2020 2020 2020 2020 2020  lly:..          
-00059060: 2020 6275 7379 2e43 6c6f 7365 2829 0d0a    busy.Close()..
-00059070: 0d0a 0d0a 2020 2020 6465 6620 6f6e 5f63  ....    def on_c
-00059080: 6c69 636b 5f68 746d 6c64 6966 6628 7365  lick_htmldiff(se
-00059090: 6c66 2c20 6576 656e 7429 3a0d 0a20 2020  lf, event):..   
-000590a0: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-000590b0: 2020 4861 6e64 6c65 7220 666f 7220 636c    Handler for cl
-000590c0: 6963 6b69 6e67 2061 2063 6861 7420 6c69  icking a chat li
-000590d0: 6e6b 2069 6e20 6469 6666 206f 7665 7276  nk in diff overv
-000590e0: 6965 772c 206f 7065 6e73 2074 6865 2063  iew, opens the c
-000590f0: 6861 740d 0a20 2020 2020 2020 2063 6f6d  hat..        com
-00059100: 7061 7269 736f 6e20 696e 2043 6861 7473  parison in Chats
-00059110: 2070 6167 652e 0d0a 2020 2020 2020 2020   page...        
-00059120: 2222 220d 0a20 2020 2020 2020 2068 7265  """..        hre
-00059130: 6620 3d20 6576 656e 742e 4765 744c 696e  f = event.GetLin
-00059140: 6b49 6e66 6f28 292e 4872 6566 0d0a 2020  kInfo().Href..  
-00059150: 2020 2020 2020 6368 6174 203d 204e 6f6e        chat = Non
-00059160: 650d 0a20 2020 2020 2020 2066 6f72 2063  e..        for c
-00059170: 2069 6e20 7365 6c66 2e63 6f6d 7061 7265   in self.compare
-00059180: 643a 0d0a 2020 2020 2020 2020 2020 2020  d:..            
-00059190: 6966 2063 5b22 6964 656e 7469 7479 225d  if c["identity"]
-000591a0: 203d 3d20 6872 6566 3a0d 0a20 2020 2020   == href:..     
-000591b0: 2020 2020 2020 2020 2020 2063 6861 7420             chat 
-000591c0: 3d20 630d 0a20 2020 2020 2020 2020 2020  = c..           
-000591d0: 2020 2020 2062 7265 616b 2023 2066 6f72       break # for
-000591e0: 2063 0d0a 2020 2020 2020 2020 6966 2063   c..        if c
-000591f0: 6861 7420 616e 6420 7365 6c66 2e70 6167  hat and self.pag
-00059200: 655f 6d65 7267 655f 6368 6174 732e 456e  e_merge_chats.En
-00059210: 6162 6c65 643a 0d0a 2020 2020 2020 2020  abled:..        
-00059220: 2020 2020 7365 6c66 2e6f 6e5f 6368 616e      self.on_chan
-00059230: 6765 5f6c 6973 745f 6368 6174 7328 6368  ge_list_chats(ch
-00059240: 6174 3d63 6861 7429 0d0a 2020 2020 2020  at=chat)..      
-00059250: 2020 2020 2020 7365 6c66 2e6e 6f74 6562        self.noteb
-00059260: 6f6f 6b2e 5365 7453 656c 6563 7469 6f6e  ook.SetSelection
-00059270: 2873 656c 662e 7061 6765 6f72 6465 725b  (self.pageorder[
-00059280: 7365 6c66 2e70 6167 655f 6d65 7267 655f  self.page_merge_
-00059290: 6368 6174 735d 290d 0a0d 0a0d 0a20 2020  chats])......   
-000592a0: 2064 6566 206f 6e5f 776f 726b 6572 5f6d   def on_worker_m
-000592b0: 6572 6765 5f72 6573 756c 7428 7365 6c66  erge_result(self
-000592c0: 2c20 6576 656e 7429 3a0d 0a20 2020 2020  , event):..     
-000592d0: 2020 2022 2222 4861 6e64 6c65 7220 666f     """Handler fo
-000592e0: 7220 776f 726b 6572 5f6d 6572 6765 2072  r worker_merge r
-000592f0: 6573 756c 7420 6361 6c6c 6261 636b 2c20  esult callback, 
-00059300: 7570 6461 7465 7320 5549 2061 6e64 2074  updates UI and t
-00059310: 6578 7473 2e22 2222 0d0a 2020 2020 2020  exts."""..      
-00059320: 2020 6966 206e 6f74 2073 656c 663a 2072    if not self: r
-00059330: 6574 7572 6e0d 0a20 2020 2020 2020 2069  eturn..        i
-00059340: 6620 6576 656e 742e 7265 7375 6c74 2e67  f event.result.g
-00059350: 6574 2822 7479 7065 2229 2069 6e20 5b22  et("type") in ["
-00059360: 6d65 7267 655f 6c65 6674 222c 2022 6469  merge_left", "di
-00059370: 6666 5f6d 6572 6765 5f6c 6566 7422 5d3a  ff_merge_left"]:
-00059380: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00059390: 6c66 2e6f 6e5f 6d65 7267 655f 616c 6c5f  lf.on_merge_all_
-000593a0: 7265 7375 6c74 2865 7665 6e74 290d 0a20  result(event).. 
-000593b0: 2020 2020 2020 2065 6c69 6620 2264 6966         elif "dif
-000593c0: 665f 6c65 6674 2220 3d3d 2065 7665 6e74  f_left" == event
-000593d0: 2e72 6573 756c 742e 6765 7428 2274 7970  .result.get("typ
-000593e0: 6522 293a 0d0a 2020 2020 2020 2020 2020  e"):..          
-000593f0: 2020 7365 6c66 2e6f 6e5f 7363 616e 5f61    self.on_scan_a
-00059400: 6c6c 5f72 6573 756c 7428 6576 656e 7429  ll_result(event)
-00059410: 0d0a 0d0a 0d0a 2020 2020 6465 6620 6f6e  ......    def on
-00059420: 5f77 6f72 6b65 725f 6d65 7267 655f 6361  _worker_merge_ca
-00059430: 6c6c 6261 636b 2873 656c 662c 2072 6573  llback(self, res
-00059440: 756c 7429 3a0d 0a20 2020 2020 2020 2022  ult):..        "
-00059450: 2222 4361 6c6c 6261 636b 2066 756e 6374  ""Callback funct
-00059460: 696f 6e20 666f 7220 4d65 7267 6554 6872  ion for MergeThr
-00059470: 6561 642c 2070 6f73 7473 2074 6865 2064  ead, posts the d
-00059480: 6174 6120 746f 2073 656c 662e 2222 220d  ata to self.""".
-00059490: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-000594a0: 3a20 7778 2e50 6f73 7445 7665 6e74 2873  : wx.PostEvent(s
-000594b0: 656c 662c 2057 6f72 6b65 7245 7665 6e74  elf, WorkerEvent
-000594c0: 2872 6573 756c 743d 7265 7375 6c74 2929  (result=result))
-000594d0: 0d0a 0d0a 0d0a 2020 2020 6465 6620 6f6e  ......    def on
-000594e0: 5f77 6f72 6b65 725f 696d 706f 7274 5f63  _worker_import_c
-000594f0: 616c 6c62 6163 6b28 7365 6c66 2c20 7265  allback(self, re
-00059500: 7375 6c74 293a 0d0a 2020 2020 2020 2020  sult):..        
-00059510: 2222 2243 616c 6c62 6163 6b20 6675 6e63  """Callback func
-00059520: 7469 6f6e 2066 6f72 2053 6b79 7065 4172  tion for SkypeAr
-00059530: 6368 6976 6554 6872 6561 642c 2075 7064  chiveThread, upd
-00059540: 6174 6573 2055 492e 2222 220d 0a20 2020  ates UI."""..   
-00059550: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
-00059560: 3a20 7265 7475 726e 0d0a 0d0a 2020 2020  : return....    
-00059570: 2020 2020 6465 6620 6166 7465 7228 7265      def after(re
-00059580: 7375 6c74 293a 0d0a 2020 2020 2020 2020  sult):..        
-00059590: 2020 2020 6966 206e 6f74 2073 656c 663a      if not self:
-000595a0: 2072 6574 7572 6e0d 0a0d 0a20 2020 2020   return....     
-000595b0: 2020 2020 2020 2069 6620 2263 6f75 6e74         if "count
-000595c0: 7322 2069 6e20 7265 7375 6c74 3a0d 0a0d  s" in result:...
-000595d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000595e0: 2074 203d 2022 2c20 222e 6a6f 696e 2875   t = ", ".join(u
-000595f0: 7469 6c2e 706c 7572 616c 2878 5b3a 2d31  til.plural(x[:-1
-00059600: 5d2c 2072 6573 756c 745b 2263 6f75 6e74  ], result["count
-00059610: 7322 5d5b 785d 2c20 7365 703d 222c 2229  s"][x], sep=",")
-00059620: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00059630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059640: 666f 7220 7820 696e 2073 6f72 7465 6428  for x in sorted(
-00059650: 7265 7375 6c74 5b22 636f 756e 7473 225d  result["counts"]
-00059660: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
-00059670: 2020 2020 7365 6c66 2e6c 6162 656c 5f67      self.label_g
-00059680: 6175 6765 2e4c 6162 656c 203d 2022 5061  auge.Label = "Pa
-00059690: 7273 6564 2025 732e 2220 2520 740d 0a20  rsed %s." % t.. 
-000596a0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000596b0: 656c 662e 7061 6e65 6c5f 6761 7567 652e  elf.panel_gauge.
-000596c0: 4c61 796f 7574 2829 0d0a 0d0a 2020 2020  Layout()....    
-000596d0: 2020 2020 2020 2020 656c 6966 2022 6572          elif "er
-000596e0: 726f 7222 2069 6e20 7265 7375 6c74 3a0d  ror" in result:.
-000596f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00059700: 2073 656c 662e 6874 6d6c 5f72 6570 6f72   self.html_repor
-00059710: 742e 4170 7065 6e64 546f 5061 6765 2822  t.AppendToPage("
-00059720: 3c62 7220 2f3e 3c62 7220 2f3e 203c 623e  <br /><br /> <b>
-00059730: 4572 726f 7220 7061 7273 696e 6720 536b  Error parsing Sk
-00059740: 7970 6520 6578 706f 7274 3a3c 2f62 3e26  ype export:</b>&
-00059750: 6e62 7370 3b26 6e62 7370 3b22 0d0a 2020  nbsp;&nbsp;"..  
-00059760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059780: 2020 2020 2020 2020 2020 2020 2b20 7265              + re
-00059790: 7375 6c74 5b22 6572 726f 725f 7368 6f72  sult["error_shor
-000597a0: 7422 5d2e 7265 706c 6163 6528 223c 222c  t"].replace("<",
-000597b0: 2022 266c 743b 2229 290d 0a20 2020 2020   "&lt;"))..     
-000597c0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000597d0: 6874 6d6c 5f72 6570 6f72 742e 5363 726f  html_report.Scro
-000597e0: 6c6c 2830 2c20 7365 6c66 2e68 746d 6c5f  ll(0, self.html_
-000597f0: 7265 706f 7274 2e47 6574 5363 726f 6c6c  report.GetScroll
-00059800: 5261 6e67 6528 7778 2e56 4552 5449 4341  Range(wx.VERTICA
-00059810: 4c29 290d 0a20 2020 2020 2020 2020 2020  L))..           
-00059820: 2020 2020 2073 656c 662e 6761 7567 655f       self.gauge_
-00059830: 7072 6f67 7265 7373 2e56 616c 7565 203d  progress.Value =
-00059840: 2030 0d0a 2020 2020 2020 2020 2020 2020   0..            
-00059850: 2020 2020 7365 6c66 2e70 616e 656c 5f67      self.panel_g
-00059860: 6175 6765 2e48 6964 6528 290d 0a20 2020  auge.Hide()..   
-00059870: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00059880: 662e 7061 6765 5f6d 6572 6765 5f61 6c6c  f.page_merge_all
-00059890: 2e4c 6179 6f75 7428 290d 0a20 2020 2020  .Layout()..     
-000598a0: 2020 2020 2020 2065 6c69 6620 2264 6f6e         elif "don
-000598b0: 6522 2069 6e20 7265 7375 6c74 3a0d 0a20  e" in result:.. 
-000598c0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000598d0: 7461 7473 203d 2073 656c 662e 6462 312e  tats = self.db1.
-000598e0: 6765 745f 6765 6e65 7261 6c5f 7374 6174  get_general_stat
-000598f0: 6973 7469 6373 2829 0d0a 2020 2020 2020  istics()..      
-00059900: 2020 2020 2020 2020 2020 7465 7874 203d            text =
-00059910: 2022 3c62 7220 2f3e 3c62 7220 2f3e 5061   "<br /><br />Pa
-00059920: 7273 6564 2025 732c 2025 7320 616e 6420  rsed %s, %s and 
-00059930: 2573 2e22 2025 2074 7570 6c65 280d 0a20  %s." % tuple(.. 
-00059940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059950: 2020 2075 7469 6c2e 706c 7572 616c 2878     util.plural(x
-00059960: 5b3a 2d31 5d2c 2073 7461 7473 5b78 5d2c  [:-1], stats[x],
-00059970: 2073 6570 3d22 2c22 2920 666f 7220 7820   sep=",") for x 
-00059980: 696e 2028 2263 6861 7473 222c 2022 636f  in ("chats", "co
-00059990: 6e74 6163 7473 222c 2022 6d65 7373 6167  ntacts", "messag
-000599a0: 6573 2229 0d0a 2020 2020 2020 2020 2020  es")..          
-000599b0: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
-000599c0: 2020 2020 2020 2020 2073 656c 662e 6874           self.ht
-000599d0: 6d6c 5f72 6570 6f72 742e 4170 7065 6e64  ml_report.Append
-000599e0: 546f 5061 6765 2874 6578 7429 0d0a 2020  ToPage(text)..  
-000599f0: 2020 2020 2020 2020 2020 2020 2020 7363                sc
-00059a00: 726f 6c6c 706f 7320 3d20 7365 6c66 2e68  rollpos = self.h
-00059a10: 746d 6c5f 7265 706f 7274 2e47 6574 5363  tml_report.GetSc
-00059a20: 726f 6c6c 5261 6e67 6528 7778 2e56 4552  rollRange(wx.VER
-00059a30: 5449 4341 4c29 0d0a 2020 2020 2020 2020  TICAL)..        
-00059a40: 2020 2020 2020 2020 7365 6c66 2e68 746d          self.htm
-00059a50: 6c5f 7265 706f 7274 2e53 6372 6f6c 6c28  l_report.Scroll(
-00059a60: 302c 2073 6372 6f6c 6c70 6f73 290d 0a20  0, scrollpos).. 
-00059a70: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00059a80: 656c 662e 6761 7567 655f 7072 6f67 7265  elf.gauge_progre
-00059a90: 7373 2e56 616c 7565 203d 2031 3030 0d0a  ss.Value = 100..
-00059aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059ab0: 7365 6c66 2e70 616e 656c 5f67 6175 6765  self.panel_gauge
-00059ac0: 2e48 6964 6528 290d 0a20 2020 2020 2020  .Hide()..       
-00059ad0: 2020 2020 2020 2020 2073 656c 662e 6c6f           self.lo
-00059ae0: 6164 5f64 6174 6128 290d 0a0d 0a20 2020  ad_data()....   
-00059af0: 2020 2020 2077 782e 4361 6c6c 4166 7465       wx.CallAfte
-00059b00: 7228 6166 7465 722c 2072 6573 756c 7429  r(after, result)
-00059b10: 0d0a 0d0a 0d0a 2020 2020 6465 6620 6f6e  ......    def on
-00059b20: 5f73 7761 7028 7365 6c66 2c20 6576 656e  _swap(self, even
-00059b30: 7429 3a0d 0a20 2020 2020 2020 2022 2222  t):..        """
-00059b40: 0d0a 2020 2020 2020 2020 4861 6e64 6c65  ..        Handle
-00059b50: 7220 666f 7220 636c 6963 6b69 6e67 2074  r for clicking t
-00059b60: 6f20 7377 6170 206c 6566 7420 616e 6420  o swap left and 
-00059b70: 7269 6768 7420 6461 7461 6261 7365 732c  right databases,
-00059b80: 2063 6861 6e67 6573 2064 6174 610d 0a20   changes data.. 
-00059b90: 2020 2020 2020 2073 7472 7563 7475 7265         structure
-00059ba0: 7320 616e 6420 5549 2063 6f6e 7465 6e74  s and UI content
-00059bb0: 2e0d 0a20 2020 2020 2020 2022 2222 0d0a  ...        """..
-00059bc0: 2020 2020 2020 2020 7365 6c66 2e64 6231          self.db1
-00059bd0: 2c20 7365 6c66 2e64 6232 203d 2073 656c  , self.db2 = sel
-00059be0: 662e 6462 322c 2073 656c 662e 6462 310d  f.db2, self.db1.
-00059bf0: 0a20 2020 2020 2020 206e 616d 6573 7061  .        namespa
-00059c00: 6365 203d 207b 2264 6231 223a 2073 656c  ce = {"db1": sel
-00059c10: 662e 6462 312c 2022 6462 3222 3a20 7365  f.db1, "db2": se
-00059c20: 6c66 2e64 6232 7d0d 0a20 2020 2020 2020  lf.db2}..       
-00059c30: 2074 656d 706c 6174 6520 3d20 7374 6570   template = step
-00059c40: 2e54 656d 706c 6174 6528 7465 6d70 6c61  .Template(templa
-00059c50: 7465 732e 4d45 5247 455f 4442 5f4c 494e  tes.MERGE_DB_LIN
-00059c60: 4b53 2c20 6573 6361 7065 3d54 7275 6529  KS, escape=True)
-00059c70: 0d0a 2020 2020 2020 2020 7365 6c66 2e68  ..        self.h
-00059c80: 746d 6c5f 6462 6c61 6265 6c2e 5365 7450  tml_dblabel.SetP
-00059c90: 6167 6528 7465 6d70 6c61 7465 2e65 7870  age(template.exp
-00059ca0: 616e 6428 6e61 6d65 7370 6163 6529 290d  and(namespace)).
-00059cb0: 0a20 2020 2020 2020 2073 656c 662e 6874  .        self.ht
-00059cc0: 6d6c 5f64 626c 6162 656c 2e42 6163 6b67  ml_dblabel.Backg
-00059cd0: 726f 756e 6443 6f6c 6f75 7220 3d20 7778  roundColour = wx
-00059ce0: 2e4e 756c 6c43 6f6c 6f75 720d 0a20 2020  .NullColour..   
-00059cf0: 2020 2020 2073 656c 662e 636f 6e31 6469       self.con1di
-00059d00: 6666 2c20 7365 6c66 2e63 6f6e 3264 6966  ff, self.con2dif
-00059d10: 6620 3d20 7365 6c66 2e63 6f6e 3264 6966  f = self.con2dif
-00059d20: 662c 2073 656c 662e 636f 6e31 6469 6666  f, self.con1diff
-00059d30: 0d0a 2020 2020 2020 2020 7365 6c66 2e63  ..        self.c
-00059d40: 6f6e 3164 6966 666c 6973 742c 2073 656c  on1difflist, sel
-00059d50: 662e 636f 6e32 6469 6666 6c69 7374 203d  f.con2difflist =
-00059d60: 205c 0d0a 2020 2020 2020 2020 2020 2020   \..            
-00059d70: 7365 6c66 2e63 6f6e 3264 6966 666c 6973  self.con2difflis
-00059d80: 742c 2073 656c 662e 636f 6e31 6469 6666  t, self.con1diff
-00059d90: 6c69 7374 0d0a 2020 2020 2020 2020 7365  list..        se
-00059da0: 6c66 2e63 6f6e 6772 6f75 7031 6469 6666  lf.congroup1diff
-00059db0: 2c20 7365 6c66 2e63 6f6e 6772 6f75 7032  , self.congroup2
-00059dc0: 6469 6666 203d 205c 0d0a 2020 2020 2020  diff = \..      
-00059dd0: 2020 2020 2020 7365 6c66 2e63 6f6e 6772        self.congr
-00059de0: 6f75 7031 6469 6666 2c20 7365 6c66 2e63  oup1diff, self.c
-00059df0: 6f6e 6772 6f75 7032 6469 6666 0d0a 2020  ongroup2diff..  
-00059e00: 2020 2020 2020 7365 6c66 2e63 6861 7473        self.chats
-00059e10: 312c 2073 656c 662e 6368 6174 7332 203d  1, self.chats2 =
-00059e20: 2073 656c 662e 6368 6174 7332 2c20 7365   self.chats2, se
-00059e30: 6c66 2e63 6861 7473 310d 0a20 2020 2020  lf.chats1..     
-00059e40: 2020 2073 656c 662e 6368 6174 735f 6469     self.chats_di
-00059e50: 6666 6461 7461 2e63 6c65 6172 2829 0d0a  ffdata.clear()..
-00059e60: 2020 2020 2020 2020 7365 6c66 2e63 6861          self.cha
-00059e70: 7473 5f6e 6f64 6966 662e 636c 6561 7228  ts_nodiff.clear(
-00059e80: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00059e90: 6368 6174 203d 204e 6f6e 650d 0a20 2020  chat = None..   
-00059ea0: 2020 2020 2073 656c 662e 6368 6174 5f64       self.chat_d
-00059eb0: 6966 6620 3d20 4e6f 6e65 0d0a 2020 2020  iff = None..    
-00059ec0: 2020 2020 7365 6c66 2e69 735f 7363 616e      self.is_scan
-00059ed0: 6e65 6420 3d20 4661 6c73 650d 0a0d 0a20  ned = False.... 
-00059ee0: 2020 2020 2020 2066 6f72 2061 2c20 6220         for a, b 
-00059ef0: 696e 205b 2873 656c 662e 6c61 6265 6c5f  in [(self.label_
-00059f00: 616c 6c31 2c20 7365 6c66 2e6c 6162 656c  all1, self.label
-00059f10: 5f61 6c6c 3229 5d3a 0d0a 2020 2020 2020  _all2)]:..      
-00059f20: 2020 2020 2020 612e 4c61 6265 6c2c 2062        a.Label, b
-00059f30: 2e4c 6162 656c 203d 2062 2e4c 6162 656c  .Label = b.Label
-00059f40: 2c20 612e 4c61 6265 6c0d 0a0d 0a20 2020  , a.Label....   
-00059f50: 2020 2020 2073 656c 662e 6c61 6265 6c5f       self.label_
-00059f60: 6d65 7267 655f 6368 6174 2e4c 6162 656c  merge_chat.Label
-00059f70: 203d 2022 220d 0a20 2020 2020 2020 2073   = ""..        s
-00059f80: 656c 662e 7374 635f 6469 6666 312e 436c  elf.stc_diff1.Cl
-00059f90: 6561 7241 6c6c 2829 0d0a 2020 2020 2020  earAll()..      
-00059fa0: 2020 7365 6c66 2e62 7574 746f 6e5f 6d65    self.button_me
-00059fb0: 7267 655f 6368 6174 2e45 6e61 626c 6564  rge_chat.Enabled
-00059fc0: 203d 2046 616c 7365 0d0a 2020 2020 2020   = False..      
-00059fd0: 2020 7365 6c66 2e62 7574 746f 6e5f 6578    self.button_ex
-00059fe0: 706f 7274 5f63 6861 742e 456e 6162 6c65  port_chat.Enable
-00059ff0: 6420 3d20 4661 6c73 650d 0a20 2020 2020  d = False..     
-0005a000: 2020 2073 656c 662e 6275 7474 6f6e 5f6d     self.button_m
-0005a010: 6572 6765 5f63 6861 742e 4e6f 7465 203d  erge_chat.Note =
-0005a020: 2073 656c 662e 4d45 5247 455f 4348 4154   self.MERGE_CHAT
-0005a030: 5f42 5554 544f 4e5f 4e4f 5445 0d0a 0d0a  _BUTTON_NOTE....
-0005a040: 2020 2020 2020 2020 2320 5377 6170 206c          # Swap l
-0005a050: 6566 7420 616e 6420 7269 6768 7420 696e  eft and right in
-0005a060: 2064 6174 6120 7374 7275 6374 7572 6573   data structures
-0005a070: 2e0d 0a20 2020 2020 2020 2066 6f72 206c  ...        for l
-0005a080: 7374 2069 6e20 5b73 656c 662e 636f 6d70  st in [self.comp
-0005a090: 6172 6564 2c20 7365 6c66 2e63 6f6e 3164  ared, self.con1d
-0005a0a0: 6966 662c 2073 656c 662e 636f 6e32 6469  iff, self.con2di
-0005a0b0: 6666 2c0d 0a20 2020 2020 2020 2020 2020  ff,..           
-0005a0c0: 2020 2020 2020 2020 2073 656c 662e 636f           self.co
-0005a0d0: 6e67 726f 7570 3164 6966 662c 2073 656c  ngroup1diff, sel
-0005a0e0: 662e 636f 6e67 726f 7570 3264 6966 665d  f.congroup2diff]
-0005a0f0: 3a0d 0a20 2020 2020 2020 2020 2020 2066  :..            f
-0005a100: 6f72 2069 7465 6d20 696e 206c 7374 206f  or item in lst o
-0005a110: 7220 5b5d 3a0d 0a20 2020 2020 2020 2020  r []:..         
-0005a120: 2020 2020 2020 2066 6f72 2074 2069 6e20         for t in 
-0005a130: 5b22 6322 2c20 226d 6573 7361 6765 7322  ["c", "messages"
-0005a140: 2c20 2267 225d 3a0d 0a20 2020 2020 2020  , "g"]:..       
-0005a150: 2020 2020 2020 2020 2020 2020 206b 6579               key
-0005a160: 312c 206b 6579 3220 3d20 2225 7331 2220  1, key2 = "%s1" 
-0005a170: 2520 742c 2022 2573 3222 2025 2074 0d0a  % t, "%s2" % t..
-0005a180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005a190: 2020 2020 6966 206b 6579 3120 696e 2069      if key1 in i
-0005a1a0: 7465 6d20 616e 6420 6b65 7932 2069 6e20  tem and key2 in 
-0005a1b0: 6974 656d 3a0d 0a20 2020 2020 2020 2020  item:..         
-0005a1c0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0005a1d0: 7465 6d5b 6b65 7931 5d2c 2069 7465 6d5b  tem[key1], item[
-0005a1e0: 6b65 7932 5d20 3d20 6974 656d 5b6b 6579  key2] = item[key
-0005a1f0: 325d 2c20 6974 656d 5b6b 6579 315d 0d0a  2], item[key1]..
-0005a200: 0d0a 2020 2020 2020 2020 2320 5265 706f  ..        # Repo
-0005a210: 7075 6c61 7465 2063 6861 7420 616e 6420  pulate chat and 
-0005a220: 636f 6e74 6163 7420 6c69 7374 730d 0a20  contact lists.. 
-0005a230: 2020 2020 2020 2073 656c 662e 6c69 7374         self.list
-0005a240: 5f63 6f6e 7461 6374 732e 506f 7075 6c61  _contacts.Popula
-0005a250: 7465 2873 656c 662e 636f 6e31 6469 6666  te(self.con1diff
-0005a260: 6c69 7374 206f 7220 5b5d 290d 0a20 2020  list or [])..   
-0005a270: 2020 2020 2073 656c 662e 6c69 7374 5f63       self.list_c
-0005a280: 6861 7473 2e50 6f70 756c 6174 6528 7365  hats.Populate(se
-0005a290: 6c66 2e63 6f6d 7061 7265 6420 6f72 205b  lf.compared or [
-0005a2a0: 5d29 0d0a 0d0a 2020 2020 2020 2020 2320  ])....        # 
-0005a2b0: 5570 6461 7465 2062 7574 746f 6e20 7374  Update button st
-0005a2c0: 6174 6573 0d0a 2020 2020 2020 2020 7365  ates..        se
-0005a2d0: 6c66 2e62 7574 746f 6e5f 7363 616e 5f61  lf.button_scan_a
-0005a2e0: 6c6c 2e45 6e61 626c 6564 203d 2073 656c  ll.Enabled = sel
-0005a2f0: 662e 6275 7474 6f6e 5f6d 6572 6765 5f61  f.button_merge_a
-0005a300: 6c6c 2e45 6e61 626c 6564 203d 2054 7275  ll.Enabled = Tru
-0005a310: 650d 0a20 2020 2020 2020 2073 656c 662e  e..        self.
-0005a320: 6275 7474 6f6e 5f6d 6572 6765 5f61 6c6c  button_merge_all
-0005a330: 2e4e 6f74 6520 3d20 7365 6c66 2e4d 4552  .Note = self.MER
-0005a340: 4745 5f42 5554 544f 4e5f 4e4f 5445 0d0a  GE_BUTTON_NOTE..
-0005a350: 2020 2020 2020 2020 7365 6c66 2e62 7574          self.but
-0005a360: 746f 6e5f 6d65 7267 655f 636f 6e74 6163  ton_merge_contac
-0005a370: 7473 2e45 6e61 626c 6564 203d 2046 616c  ts.Enabled = Fal
-0005a380: 7365 0d0a 2020 2020 2020 2020 7365 6c66  se..        self
-0005a390: 2e62 7574 746f 6e5f 6d65 7267 655f 616c  .button_merge_al
-0005a3a0: 6c63 6f6e 7461 6374 732e 456e 6162 6c65  lcontacts.Enable
-0005a3b0: 6420 3d20 7365 6c66 2e6c 6973 745f 636f  d = self.list_co
-0005a3c0: 6e74 6163 7473 2e49 7465 6d43 6f75 6e74  ntacts.ItemCount
-0005a3d0: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
-0005a3e0: 2e70 616e 656c 5f67 6175 6765 2e48 6964  .panel_gauge.Hid
-0005a3f0: 6528 290d 0a20 2020 2020 2020 2073 656c  e()..        sel
-0005a400: 662e 6874 6d6c 5f72 6570 6f72 742e 4869  f.html_report.Hi
-0005a410: 6465 2829 0d0a 0d0a 2020 2020 2020 2020  de()....        
-0005a420: 7365 6c66 2e52 6566 7265 7368 2829 0d0a  self.Refresh()..
-0005a430: 2020 2020 2020 2020 7365 6c66 2e70 6167          self.pag
-0005a440: 655f 6d65 7267 655f 616c 6c2e 4c61 796f  e_merge_all.Layo
-0005a450: 7574 2829 0d0a 2020 2020 2020 2020 7365  ut()..        se
-0005a460: 6c66 2e4c 6179 6f75 7428 290d 0a0d 0a0d  lf.Layout().....
-0005a470: 0a20 2020 2064 6566 206f 6e5f 6d65 7267  .    def on_merg
-0005a480: 655f 6368 6174 7328 7365 6c66 2c20 6576  e_chats(self, ev
-0005a490: 656e 7429 3a0d 0a20 2020 2020 2020 2022  ent):..        "
-0005a4a0: 2222 4861 6e64 6c65 7220 6f6e 2063 686f  ""Handler on cho
-0005a4b0: 6f73 696e 6720 746f 206d 6572 6765 2074  osing to merge t
-0005a4c0: 6865 2063 6861 7473 2073 656c 6563 7465  he chats selecte
-0005a4d0: 6420 696e 2063 6861 7420 6c69 7374 2e22  d in chat list."
-0005a4e0: 2222 0d0a 2020 2020 2020 2020 7365 6c65  ""..        sele
-0005a4f0: 6374 6564 2c20 7365 6c65 6374 6564 7320  cted, selecteds 
-0005a500: 3d20 7365 6c66 2e6c 6973 745f 6368 6174  = self.list_chat
-0005a510: 732e 4765 7446 6972 7374 5365 6c65 6374  s.GetFirstSelect
-0005a520: 6564 2829 2c20 5b5d 0d0a 2020 2020 2020  ed(), []..      
-0005a530: 2020 7768 696c 6520 7365 6c65 6374 6564    while selected
-0005a540: 203e 3d20 303a 0d0a 2020 2020 2020 2020   >= 0:..        
-0005a550: 2020 2020 7365 6c65 6374 6564 732e 6170      selecteds.ap
-0005a560: 7065 6e64 2873 656c 662e 6c69 7374 5f63  pend(self.list_c
-0005a570: 6861 7473 2e47 6574 4974 656d 4d61 7070  hats.GetItemMapp
-0005a580: 6564 4461 7461 2873 656c 6563 7465 6429  edData(selected)
-0005a590: 5b22 6331 225d 290d 0a20 2020 2020 2020  ["c1"])..       
-0005a5a0: 2020 2020 2073 656c 6563 7465 6420 3d20       selected = 
-0005a5b0: 7365 6c66 2e6c 6973 745f 6368 6174 732e  self.list_chats.
-0005a5c0: 4765 744e 6578 7453 656c 6563 7465 6428  GetNextSelected(
-0005a5d0: 7365 6c65 6374 6564 290d 0a20 2020 2020  selected)..     
-0005a5e0: 2020 2069 6620 7365 6c65 6374 6564 733a     if selecteds:
-0005a5f0: 0d0a 2020 2020 2020 2020 2020 2020 6163  ..            ac
-0005a600: 7469 6f6e 203d 2022 4d65 7267 6522 2069  tion = "Merge" i
-0005a610: 6620 7365 6c66 2e69 735f 7363 616e 6e65  f self.is_scanne
-0005a620: 6420 656c 7365 2022 5363 616e 2061 6e64  d else "Scan and
-0005a630: 206d 6572 6765 220d 0a20 2020 2020 2020   merge"..       
-0005a640: 2020 2020 2069 6e66 6f20 3d20 7574 696c       info = util
-0005a650: 2e70 6c75 7261 6c28 2273 656c 6563 7465  .plural("selecte
-0005a660: 6420 6368 6174 222c 2073 656c 6563 7465  d chat", selecte
-0005a670: 6473 2c20 7365 703d 222c 2229 0d0a 2020  ds, sep=",")..  
-0005a680: 2020 2020 2020 2020 2020 6d65 7373 6167            messag
-0005a690: 6520 3d20 2822 2573 2064 6966 6665 7265  e = ("%s differe
-0005a6a0: 6e63 6573 2069 6e20 2573 5c6e 5c6e 6672  nces in %s\n\nfr
-0005a6b0: 6f6d 2025 735c 6e5c 6e69 6e74 6f20 2573  om %s\n\ninto %s
-0005a6c0: 3f22 2025 0d0a 2020 2020 2020 2020 2020  ?" %..          
-0005a6d0: 2020 2020 2020 2020 2020 2020 2028 6163               (ac
-0005a6e0: 7469 6f6e 2c20 696e 666f 2c20 7365 6c66  tion, info, self
-0005a6f0: 2e64 6231 2c20 7365 6c66 2e64 6232 2929  .db1, self.db2))
-0005a700: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-0005a710: 2077 782e 4f4b 203d 3d20 7778 2e4d 6573   wx.OK == wx.Mes
-0005a720: 7361 6765 426f 7828 6d65 7373 6167 652c  sageBox(message,
-0005a730: 2063 6f6e 662e 5469 746c 652c 0d0a 2020   conf.Title,..  
-0005a740: 2020 2020 2020 2020 2020 7778 2e49 434f            wx.ICO
-0005a750: 4e5f 494e 464f 524d 4154 494f 4e20 7c20  N_INFORMATION | 
-0005a760: 7778 2e43 414e 4345 4c29 3a0d 0a20 2020  wx.CANCEL):..   
-0005a770: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0005a780: 662e 6275 7474 6f6e 5f73 7761 702e 456e  f.button_swap.En
-0005a790: 6162 6c65 6420 3d20 4661 6c73 650d 0a20  abled = False.. 
-0005a7a0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0005a7b0: 656c 662e 6275 7474 6f6e 5f6d 6572 6765  elf.button_merge
-0005a7c0: 5f63 6861 7473 2e45 6e61 626c 6564 203d  _chats.Enabled =
-0005a7d0: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
-0005a7e0: 2020 2020 2020 2020 7365 6c66 2e62 7574          self.but
-0005a7f0: 746f 6e5f 7363 616e 5f61 6c6c 2e45 6e61  ton_scan_all.Ena
-0005a800: 626c 6564 203d 2046 616c 7365 0d0a 2020  bled = False..  
-0005a810: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0005a820: 6c66 2e62 7574 746f 6e5f 6d65 7267 655f  lf.button_merge_
-0005a830: 616c 6c2e 456e 6162 6c65 6420 3d20 4661  all.Enabled = Fa
-0005a840: 6c73 650d 0a20 2020 2020 2020 2020 2020  lse..           
-0005a850: 2020 2020 2073 656c 662e 7061 6765 5f6d       self.page_m
-0005a860: 6572 6765 5f63 6861 7473 2e45 6e61 626c  erge_chats.Enabl
-0005a870: 6564 203d 2046 616c 7365 0d0a 2020 2020  ed = False..    
-0005a880: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0005a890: 2e70 6167 655f 6d65 7267 655f 636f 6e74  .page_merge_cont
-0005a8a0: 6163 7473 2e45 6e61 626c 6564 203d 2046  acts.Enabled = F
-0005a8b0: 616c 7365 0d0a 2020 2020 2020 2020 2020  alse..          
-0005a8c0: 2020 2020 2020 7365 6c66 2e75 7064 6174        self.updat
-0005a8d0: 655f 6761 7567 6528 7365 6c66 2e67 6175  e_gauge(self.gau
-0005a8e0: 6765 5f70 726f 6772 6573 732c 2030 2c0d  ge_progress, 0,.
-0005a8f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0005a900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005a910: 2020 2022 2573 2030 2525 2063 6f6d 706c     "%s 0%% compl
-0005a920: 6574 652e 2220 2520 6163 7469 6f6e 290d  ete." % action).
-0005a930: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0005a940: 2069 6620 6e6f 7420 7365 6c66 2e68 746d   if not self.htm
-0005a950: 6c5f 7265 706f 7274 2e53 686f 776e 3a0d  l_report.Shown:.
-0005a960: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0005a970: 2020 2020 2073 656c 662e 6874 6d6c 5f72       self.html_r
-0005a980: 6570 6f72 742e 5368 6f77 2829 0d0a 2020  eport.Show()..  
-0005a990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005a9a0: 2020 7365 6c66 2e68 746d 6c5f 7265 706f    self.html_repo
-0005a9b0: 7274 2e43 6f6e 7461 696e 696e 6753 697a  rt.ContainingSiz
-0005a9c0: 6572 2e4c 6179 6f75 7428 290d 0a20 2020  er.Layout()..   
-0005a9d0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0005a9e0: 662e 6874 6d6c 5f72 6570 6f72 742e 5365  f.html_report.Se
-0005a9f0: 7450 6167 6528 223c 626f 6479 2062 6763  tPage("<body bgc
-0005aa00: 6f6c 6f72 3d27 2573 273e 3c66 6f6e 7420  olor='%s'><font 
-0005aa10: 636f 6c6f 723d 2725 7327 3e3c 623e 2573  color='%s'><b>%s
-0005aa20: 2070 726f 6772 6573 733a 220d 0a20 2020   progress:"..   
-0005aa30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005aa40: 2022 3c2f 623e 3c62 7220 2f3e 2220 2520   "</b><br />" % 
-0005aa50: 2863 6f6e 662e 4d65 7267 6548 746d 6c42  (conf.MergeHtmlB
-0005aa60: 6163 6b67 726f 756e 6443 6f6c 6f75 722c  ackgroundColour,
-0005aa70: 2063 6f6e 662e 4667 436f 6c6f 7572 2c20   conf.FgColour, 
-0005aa80: 6163 7469 6f6e 2929 0d0a 2020 2020 2020  action))..      
-0005aa90: 2020 2020 2020 2020 2020 6462 312c 2064            db1, d
-0005aaa0: 6232 203d 2073 656c 662e 6462 312c 2073  b2 = self.db1, s
-0005aab0: 656c 662e 6462 320d 0a20 2020 2020 2020  elf.db2..       
-0005aac0: 2020 2020 2020 2020 2063 6861 7473 203d           chats =
-0005aad0: 206c 6973 7428 6669 6c74 6572 2862 6f6f   list(filter(boo
-0005aae0: 6c2c 2073 656c 6563 7465 6473 2929 0d0a  l, selecteds))..
+0004a8b0: 696d 6720 3d20 736b 7970 6564 6174 612e  img = skypedata.
+0004a8c0: 6765 745f 6176 6174 6172 2870 5b22 636f  get_avatar(p["co
+0004a8d0: 6e74 6163 7422 5d2c 2073 7a5f 6176 6174  ntact"], sz_avat
+0004a8e0: 6172 290d 0a20 2020 2020 2020 2020 2020  ar)..           
+0004a8f0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0004a900: 696d 673a 0d0a 2020 2020 2020 2020 2020  img:..          
+0004a910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004a920: 2020 705b 2263 6f6e 7461 6374 225d 5b22    p["contact"]["
+0004a930: 6176 6174 6172 5f62 6974 6d61 7022 5d20  avatar_bitmap"] 
+0004a940: 3d20 696d 672e 436f 6e76 6572 7454 6f42  = img.ConvertToB
+0004a950: 6974 6d61 7028 290d 0a20 2020 2020 2020  itmap()..       
+0004a960: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0004a970: 2261 7661 7461 725f 6269 746d 6170 2220  "avatar_bitmap" 
+0004a980: 696e 2070 5b22 636f 6e74 6163 7422 5d3a  in p["contact"]:
+0004a990: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0004a9a0: 2020 2020 2020 2020 2020 6220 3d20 696c            b = il
+0004a9b0: 2e41 6464 2870 5b22 636f 6e74 6163 7422  .Add(p["contact"
+0004a9c0: 5d5b 2261 7661 7461 725f 6269 746d 6170  ]["avatar_bitmap
+0004a9d0: 225d 290d 0a20 2020 2020 2020 2020 2020  "])..           
+0004a9e0: 2020 2020 2020 2020 2074 203d 2070 5b22           t = p["
+0004a9f0: 636f 6e74 6163 7422 5d5b 226e 616d 6522  contact"]["name"
+0004aa00: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
+0004aa10: 2020 2020 2020 2069 6620 705b 2269 6465         if p["ide
+0004aa20: 6e74 6974 7922 5d20 213d 2070 5b22 636f  ntity"] != p["co
+0004aa30: 6e74 6163 7422 5d5b 226e 616d 6522 5d3a  ntact"]["name"]:
+0004aa40: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0004aa50: 2020 2020 2020 2020 2020 7420 2b3d 2022            t += "
+0004aa60: 2028 2573 2922 2025 2070 5b22 6964 656e   (%s)" % p["iden
+0004aa70: 7469 7479 225d 0d0a 2020 2020 2020 2020  tity"]..        
+0004aa80: 2020 2020 2020 2020 2020 2020 7420 3d20              t = 
+0004aa90: 742e 7265 706c 6163 6528 225c 6e22 2c20  t.replace("\n", 
+0004aaa0: 2220 2229 0d0a 2020 2020 2020 2020 2020  " ")..          
+0004aab0: 2020 2020 2020 2020 2020 7472 793a 2070            try: p
+0004aac0: 6c69 7374 2e49 6e73 6572 7449 6d61 6765  list.InsertImage
+0004aad0: 5374 7269 6e67 4974 656d 2869 6e64 6578  StringItem(index
+0004aae0: 2c20 742c 2062 2c20 6974 5f6b 696e 643d  , t, b, it_kind=
+0004aaf0: 3129 0d0a 2020 2020 2020 2020 2020 2020  1)..            
+0004ab00: 2020 2020 2020 2020 6578 6365 7074 2045          except E
+0004ab10: 7863 6570 7469 6f6e 3a0d 0a20 2020 2020  xception:..     
+0004ab20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ab30: 2020 2074 203d 2072 652e 7375 6228 7222     t = re.sub(r"
+0004ab40: 5b5e 5c77 2025 735d 2220 2520 7265 2e65  [^\w %s]" % re.e
+0004ab50: 7363 6170 6528 7374 7269 6e67 2e70 756e  scape(string.pun
+0004ab60: 6374 7561 7469 6f6e 292c 0d0a 2020 2020  ctuation),..    
+0004ab70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ab80: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+0004ab90: 616d 6264 6120 6d3a 2022 2325 7322 2025  ambda m: "#%s" %
+0004aba0: 206f 7264 286d 2e67 726f 7570 2830 2929   ord(m.group(0))
+0004abb0: 2c20 742c 2072 652e 5529 0d0a 2020 2020  , t, re.U)..    
+0004abc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004abd0: 2020 2020 706c 6973 742e 496e 7365 7274      plist.Insert
+0004abe0: 496d 6167 6553 7472 696e 6749 7465 6d28  ImageStringItem(
+0004abf0: 696e 6465 782c 2074 2c20 622c 2069 745f  index, t, b, it_
+0004ac00: 6b69 6e64 3d31 290d 0a20 2020 2020 2020  kind=1)..       
+0004ac10: 2020 2020 2020 2020 2020 2020 2070 6c69               pli
+0004ac20: 7374 2e53 6574 4974 656d 5465 7874 436f  st.SetItemTextCo
+0004ac30: 6c6f 7572 2869 6e64 6578 2c20 2020 2020  lour(index,     
+0004ac40: 2020 706c 6973 742e 466f 7265 6772 6f75    plist.Foregrou
+0004ac50: 6e64 436f 6c6f 7572 290d 0a20 2020 2020  ndColour)..     
+0004ac60: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0004ac70: 6c69 7374 2e53 6574 4974 656d 4261 636b  list.SetItemBack
+0004ac80: 6772 6f75 6e64 436f 6c6f 7572 2869 6e64  groundColour(ind
+0004ac90: 6578 2c20 706c 6973 742e 4261 636b 6772  ex, plist.Backgr
+0004aca0: 6f75 6e64 436f 6c6f 7572 290d 0a20 2020  oundColour)..   
+0004acb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004acc0: 2063 203d 2070 6c69 7374 2e47 6574 4974   c = plist.GetIt
+0004acd0: 656d 2869 6e64 6578 290d 0a20 2020 2020  em(index)..     
+0004ace0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0004acf0: 2e43 6865 636b 2854 7275 6529 0d0a 2020  .Check(True)..  
+0004ad00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ad10: 2020 706c 6973 742e 5365 7449 7465 6d28    plist.SetItem(
+0004ad20: 6329 0d0a 2020 2020 2020 2020 2020 2020  c)..            
+0004ad30: 2020 2020 2020 2020 706c 6973 742e 5365          plist.Se
+0004ad40: 7449 7465 6d44 6174 6128 696e 6465 782c  tItemData(index,
+0004ad50: 2070 290d 0a20 2020 2020 2020 2020 2020   p)..           
+0004ad60: 2020 2020 2020 2020 2069 6e64 6578 202b           index +
+0004ad70: 3d20 310d 0a20 2020 2020 2020 2020 2020  = 1..           
+0004ad80: 2020 2020 2064 656c 206e 6f6c 6f67 2023       del nolog #
+0004ad90: 2052 6573 746f 7265 2064 6566 6175 6c74   Restore default
+0004ada0: 2077 7820 6d65 7373 6167 6520 6c6f 6767   wx message logg
+0004adb0: 6572 0d0a 2020 2020 2020 2020 2020 2020  er..            
+0004adc0: 2020 2020 706c 6973 742e 5365 7443 6f6c      plist.SetCol
+0004add0: 756d 6e57 6964 7468 2830 2c20 7778 2e4c  umnWidth(0, wx.L
+0004ade0: 4953 545f 4155 544f 5349 5a45 290d 0a20  IST_AUTOSIZE).. 
+0004adf0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0004ae00: 6368 6174 5f66 696c 7465 725b 2270 6172  chat_filter["par
+0004ae10: 7469 6369 7061 6e74 7322 5d20 3d20 5b0d  ticipants"] = [.
+0004ae20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004ae30: 2070 5b22 6964 656e 7469 7479 225d 2066   p["identity"] f
+0004ae40: 6f72 2070 2069 6e20 6368 6174 5b22 7061  or p in chat["pa
+0004ae50: 7274 6963 6970 616e 7473 225d 5d0d 0a0d  rticipants"]]...
+0004ae60: 0a20 2020 2020 2020 2069 6620 6365 6e74  .        if cent
+0004ae70: 6572 5f6d 6573 7361 6765 5f69 6420 616e  er_message_id an
+0004ae80: 6420 7365 6c66 2e63 6861 7420 3d3d 2063  d self.chat == c
+0004ae90: 6861 743a 0d0a 2020 2020 2020 2020 2020  hat:..          
+0004aea0: 2020 6966 206e 6f74 2073 656c 662e 7374    if not self.st
+0004aeb0: 635f 6869 7374 6f72 792e 4973 4d65 7373  c_history.IsMess
+0004aec0: 6167 6553 686f 776e 2863 656e 7465 725f  ageShown(center_
+0004aed0: 6d65 7373 6167 655f 6964 293a 0d0a 2020  message_id):..  
+0004aee0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+0004aef0: 7220 6920 696e 2072 616e 6765 2870 6c69  r i in range(pli
+0004af00: 7374 2e47 6574 4974 656d 436f 756e 7428  st.GetItemCount(
+0004af10: 2929 3a0d 0a20 2020 2020 2020 2020 2020  )):..           
+0004af20: 2020 2020 2020 2020 2063 203d 2070 6c69           c = pli
+0004af30: 7374 2e47 6574 4974 656d 2869 290d 0a20  st.GetItem(i).. 
+0004af40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004af50: 2020 2063 2e43 6865 636b 2854 7275 6529     c.Check(True)
+0004af60: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0004af70: 2020 2020 2020 706c 6973 742e 5365 7449        plist.SetI
+0004af80: 7465 6d28 6329 0d0a 2020 2020 2020 2020  tem(c)..        
+0004af90: 2020 2020 2020 2020 706c 6973 742e 5265          plist.Re
+0004afa0: 6672 6573 6828 290d 0a20 2020 2020 2020  fresh()..       
+0004afb0: 2020 2020 2020 2020 2073 656c 662e 7374           self.st
+0004afc0: 635f 6869 7374 6f72 792e 5365 7446 696c  c_history.SetFil
+0004afd0: 7465 7228 7365 6c66 2e63 6861 745f 6669  ter(self.chat_fi
+0004afe0: 6c74 6572 290d 0a20 2020 2020 2020 2020  lter)..         
+0004aff0: 2020 2020 2020 2073 656c 662e 7374 635f         self.stc_
+0004b000: 6869 7374 6f72 792e 5265 6672 6573 684d  history.RefreshM
+0004b010: 6573 7361 6765 7328 6365 6e74 6572 5f6d  essages(center_m
+0004b020: 6573 7361 6765 5f69 6429 0d0a 2020 2020  essage_id)..    
+0004b030: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+0004b040: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0004b050: 656c 662e 7374 635f 6869 7374 6f72 792e  elf.stc_history.
+0004b060: 466f 6375 734d 6573 7361 6765 2863 656e  FocusMessage(cen
+0004b070: 7465 725f 6d65 7373 6167 655f 6964 290d  ter_message_id).
+0004b080: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
+0004b090: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0004b0a0: 2e73 7463 5f68 6973 746f 7279 2e53 6574  .stc_history.Set
+0004b0b0: 4669 6c74 6572 2873 656c 662e 6368 6174  Filter(self.chat
+0004b0c0: 5f66 696c 7465 7229 0d0a 2020 2020 2020  _filter)..      
+0004b0d0: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
+0004b0e0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0004b0f0: 2e73 7463 5f68 6973 746f 7279 2e50 6f70  .stc_history.Pop
+0004b100: 756c 6174 6528 6368 6174 2c20 7365 6c66  ulate(chat, self
+0004b110: 2e64 622c 0d0a 2020 2020 2020 2020 2020  .db,..          
+0004b120: 2020 2020 2020 2020 2020 6365 6e74 6572            center
+0004b130: 5f6d 6573 7361 6765 5f69 643d 6365 6e74  _message_id=cent
+0004b140: 6572 5f6d 6573 7361 6765 5f69 6429 0d0a  er_message_id)..
+0004b150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b160: 6966 2063 656e 7465 725f 6d65 7373 6167  if center_messag
+0004b170: 655f 6964 205c 0d0a 2020 2020 2020 2020  e_id \..        
+0004b180: 2020 2020 2020 2020 616e 6420 6e6f 7420          and not 
+0004b190: 7365 6c66 2e73 7463 5f68 6973 746f 7279  self.stc_history
+0004b1a0: 2e49 734d 6573 7361 6765 5368 6f77 6e28  .IsMessageShown(
+0004b1b0: 6365 6e74 6572 5f6d 6573 7361 6765 5f69  center_message_i
+0004b1c0: 6429 3a0d 0a20 2020 2020 2020 2020 2020  d):..           
+0004b1d0: 2020 2020 2020 2020 2073 656c 662e 7374           self.st
+0004b1e0: 635f 6869 7374 6f72 792e 5365 7446 696c  c_history.SetFil
+0004b1f0: 7465 7228 7365 6c66 2e63 6861 745f 6669  ter(self.chat_fi
+0004b200: 6c74 6572 290d 0a20 2020 2020 2020 2020  lter)..         
+0004b210: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0004b220: 7374 635f 6869 7374 6f72 792e 5265 6672  stc_history.Refr
+0004b230: 6573 684d 6573 7361 6765 7328 6365 6e74  eshMessages(cent
+0004b240: 6572 5f6d 6573 7361 6765 5f69 6429 0d0a  er_message_id)..
+0004b250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b260: 2020 2020 7365 6c66 2e73 7463 5f68 6973      self.stc_his
+0004b270: 746f 7279 2e46 6f63 7573 4d65 7373 6167  tory.FocusMessag
+0004b280: 6528 6365 6e74 6572 5f6d 6573 7361 6765  e(center_message
+0004b290: 5f69 6429 0d0a 2020 2020 2020 2020 2020  _id)..          
+0004b2a0: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
+0004b2b0: 6f6e 2061 7320 653a 0d0a 2020 2020 2020  on as e:..      
+0004b2c0: 2020 2020 2020 2020 2020 6775 6962 6173            guibas
+0004b2d0: 652e 7374 6174 7573 2822 4572 726f 7220  e.status("Error 
+0004b2e0: 6c6f 6164 696e 6720 2573 3a20 2573 222c  loading %s: %s",
+0004b2f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0004b300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b310: 2063 6861 745b 2274 6974 6c65 5f6c 6f6e   chat["title_lon
+0004b320: 675f 6c63 225d 2c20 7574 696c 2e66 6f72  g_lc"], util.for
+0004b330: 6d61 745f 6578 6328 6529 290d 0a20 2020  mat_exc(e))..   
+0004b340: 2020 2020 2020 2020 2020 2020 206c 6f67               log
+0004b350: 6765 722e 6578 6365 7074 696f 6e28 2245  ger.exception("E
+0004b360: 7272 6f72 206c 6f61 6469 6e67 2025 732e  rror loading %s.
+0004b370: 222c 2063 6861 745b 2274 6974 6c65 5f6c  ", chat["title_l
+0004b380: 6f6e 675f 6c63 225d 290d 0a20 2020 2020  ong_lc"])..     
+0004b390: 2020 2020 2020 2020 2020 2065 7272 6f72             error
+0004b3a0: 6d73 6720 3d20 2245 7272 6f72 206c 6f61  msg = "Error loa
+0004b3b0: 6469 6e67 2025 733a 5c6e 5c6e 2573 2220  ding %s:\n\n%s" 
+0004b3c0: 2520 5c0d 0a20 2020 2020 2020 2020 2020  % \..           
+0004b3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b3e0: 2863 6861 745b 2274 6974 6c65 5f6c 6f6e  (chat["title_lon
+0004b3f0: 675f 6c63 225d 2c20 7472 6163 6562 6163  g_lc"], tracebac
+0004b400: 6b2e 666f 726d 6174 5f65 7863 2829 290d  k.format_exc()).
+0004b410: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004b420: 2077 782e 4d65 7373 6167 6542 6f78 2865   wx.MessageBox(e
+0004b430: 7272 6f72 6d73 672c 2063 6f6e 662e 5469  rrormsg, conf.Ti
+0004b440: 746c 652c 2077 782e 4f4b 207c 2077 782e  tle, wx.OK | wx.
+0004b450: 4943 4f4e 5f57 4152 4e49 4e47 290d 0a0d  ICON_WARNING)...
+0004b460: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+0004b470: 2e73 7463 5f68 6973 746f 7279 2e47 6574  .stc_history.Get
+0004b480: 4d65 7373 6167 6528 3029 3a0d 0a20 2020  Message(0):..   
+0004b490: 2020 2020 2020 2020 2076 616c 7565 7320           values 
+0004b4a0: 3d20 5b73 656c 662e 7374 635f 6869 7374  = [self.stc_hist
+0004b4b0: 6f72 792e 4765 744d 6573 7361 6765 2830  ory.GetMessage(0
+0004b4c0: 295b 2264 6174 6574 696d 6522 5d2c 0d0a  )["datetime"],..
+0004b4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b4e0: 2020 2020 2020 7365 6c66 2e73 7463 5f68        self.stc_h
+0004b4f0: 6973 746f 7279 2e47 6574 4d65 7373 6167  istory.GetMessag
+0004b500: 6528 2d31 295b 2264 6174 6574 696d 6522  e(-1)["datetime"
+0004b510: 5d5d 0d0a 2020 2020 2020 2020 2020 2020  ]]..            
+0004b520: 6461 7465 735f 7661 6c75 6573 203d 205b  dates_values = [
+0004b530: 692e 6461 7465 2829 2066 6f72 2069 2069  i.date() for i i
+0004b540: 6e20 7661 6c75 6573 5d0d 0a20 2020 2020  n values]..     
+0004b550: 2020 2020 2020 2069 6620 6e6f 7420 616e         if not an
+0004b560: 7928 6669 6c74 6572 2862 6f6f 6c2c 2064  y(filter(bool, d
+0004b570: 6174 6573 5f72 616e 6765 2929 3a0d 0a20  ates_range)):.. 
+0004b580: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0004b590: 7473 203d 2022 6669 7273 745f 6d65 7373  ts = "first_mess
+0004b5a0: 6167 655f 6461 7465 7469 6d65 222c 2022  age_datetime", "
+0004b5b0: 6c61 7374 5f6d 6573 7361 6765 5f64 6174  last_message_dat
+0004b5c0: 6574 696d 6522 0d0a 2020 2020 2020 2020  etime"..        
+0004b5d0: 2020 2020 2020 2020 6461 7465 735f 7261          dates_ra
+0004b5e0: 6e67 6520 3d20 5b63 6861 745b 6e5d 2e64  nge = [chat[n].d
+0004b5f0: 6174 6528 2920 6966 2063 6861 745b 6e5d  ate() if chat[n]
+0004b600: 2065 6c73 6520 4e6f 6e65 2066 6f72 206e   else None for n
+0004b610: 2069 6e20 6474 735d 0d0a 2020 2020 2020   in dts]..      
+0004b620: 2020 2020 2020 6966 206e 6f74 2061 6e79        if not any
+0004b630: 2866 696c 7465 7228 626f 6f6c 2c20 6461  (filter(bool, da
+0004b640: 7465 735f 7261 6e67 6529 293a 0d0a 2020  tes_range)):..  
+0004b650: 2020 2020 2020 2020 2020 2020 2020 6461                da
+0004b660: 7465 735f 7261 6e67 6520 3d20 6461 7465  tes_range = date
+0004b670: 735f 7661 6c75 6573 0d0a 2020 2020 2020  s_values..      
+0004b680: 2020 2020 2020 7365 6c66 2e63 6861 745f        self.chat_
+0004b690: 6669 6c74 6572 5b22 6461 7465 7261 6e67  filter["daterang
+0004b6a0: 6522 5d20 3d20 6461 7465 735f 7261 6e67  e"] = dates_rang
+0004b6b0: 650d 0a20 2020 2020 2020 2020 2020 2069  e..            i
+0004b6c0: 6620 6368 6174 2021 3d20 7365 6c66 2e63  f chat != self.c
+0004b6d0: 6861 7420 6f72 206e 6f74 2061 6c6c 2873  hat or not all(s
+0004b6e0: 656c 662e 6368 6174 5f66 696c 7465 725b  elf.chat_filter[
+0004b6f0: 2273 7461 7274 6461 7465 7261 6e67 6522  "startdaterange"
+0004b700: 5d29 3a0d 0a20 2020 2020 2020 2020 2020  ]):..           
+0004b710: 2020 2020 2073 656c 662e 6368 6174 5f66       self.chat_f
+0004b720: 696c 7465 725b 2273 7461 7274 6461 7465  ilter["startdate
+0004b730: 7261 6e67 6522 5d20 3d20 6461 7465 735f  range"] = dates_
+0004b740: 7661 6c75 6573 0d0a 2020 2020 2020 2020  values..        
+0004b750: 7365 6c66 2e72 616e 6765 5f64 6174 652e  self.range_date.
+0004b760: 5365 7452 616e 6765 282a 6461 7465 735f  SetRange(*dates_
+0004b770: 7261 6e67 6529 0d0a 2020 2020 2020 2020  range)..        
+0004b780: 7365 6c66 2e65 6469 745f 6669 6c74 6572  self.edit_filter
+0004b790: 6461 7465 312e 5261 6e67 6520 3d20 7365  date1.Range = se
+0004b7a0: 6c66 2e65 6469 745f 6669 6c74 6572 6461  lf.edit_filterda
+0004b7b0: 7465 322e 5261 6e67 6520 3d20 6461 7465  te2.Range = date
+0004b7c0: 735f 7261 6e67 650d 0a20 2020 2020 2020  s_range..       
+0004b7d0: 2073 656c 662e 7261 6e67 655f 6461 7465   self.range_date
+0004b7e0: 2e53 6574 5661 6c75 6573 282a 6461 7465  .SetValues(*date
+0004b7f0: 735f 7661 6c75 6573 290d 0a20 2020 2020  s_values)..     
+0004b800: 2020 2068 6173 5f6d 6573 7361 6765 7320     has_messages 
+0004b810: 3d20 626f 6f6c 2873 656c 662e 7374 635f  = bool(self.stc_
+0004b820: 6869 7374 6f72 792e 4765 744d 6573 7361  history.GetMessa
+0004b830: 6765 2830 2929 0d0a 2020 2020 2020 2020  ge(0))..        
+0004b840: 7365 6c66 2e74 625f 6368 6174 2e45 6e61  self.tb_chat.Ena
+0004b850: 626c 6554 6f6f 6c28 7778 2e49 445f 4d4f  bleTool(wx.ID_MO
+0004b860: 5245 2c20 6861 735f 6d65 7373 6167 6573  RE, has_messages
+0004b870: 290d 0a20 2020 2020 2020 2069 6620 6e6f  )..        if no
+0004b880: 7420 7365 6c66 2e63 6861 743a 0d0a 2020  t self.chat:..  
+0004b890: 2020 2020 2020 2020 2020 2320 5665 7279            # Very
+0004b8a0: 2066 6972 7374 206c 6f61 642c 2074 6f67   first load, tog
+0004b8b0: 676c 6520 6669 6c74 6572 2074 6f6f 6c20  gle filter tool 
+0004b8c0: 6275 7474 6f6e 206f 6e0d 0a20 2020 2020  button on..     
+0004b8d0: 2020 2020 2020 2073 656c 662e 7462 5f63         self.tb_c
+0004b8e0: 6861 742e 546f 6767 6c65 546f 6f6c 2877  hat.ToggleTool(w
+0004b8f0: 782e 4944 5f4d 4f52 452c 2073 656c 662e  x.ID_MORE, self.
+0004b900: 7370 6c69 7474 6572 5f73 7463 2e49 7353  splitter_stc.IsS
+0004b910: 706c 6974 2829 290d 0a20 2020 2020 2020  plit())..       
+0004b920: 2069 6620 7365 6c66 2e63 6861 7420 213d   if self.chat !=
+0004b930: 2063 6861 743a 0d0a 2020 2020 2020 2020   chat:..        
+0004b940: 2020 2020 7365 6c66 2e63 6861 7420 3d20      self.chat = 
+0004b950: 6368 6174 0d0a 2020 2020 2020 2020 6966  chat..        if
+0004b960: 2062 7573 793a 0d0a 2020 2020 2020 2020   busy:..        
+0004b970: 2020 2020 6275 7379 2e43 6c6f 7365 2829      busy.Close()
+0004b980: 0d0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
+0004b990: 616e 656c 5f63 6861 7473 322e 456e 6162  anel_chats2.Enab
+0004b9a0: 6c65 6420 3d20 5472 7565 0d0a 2020 2020  led = True..    
+0004b9b0: 2020 2020 7365 6c66 2e6c 6973 745f 7469      self.list_ti
+0004b9c0: 6d65 6c69 6e65 2e50 6f70 756c 6174 6528  meline.Populate(
+0004b9d0: 2a73 656c 662e 7374 635f 6869 7374 6f72  *self.stc_histor
+0004b9e0: 792e 4765 7454 696d 656c 696e 6544 6174  y.GetTimelineDat
+0004b9f0: 6128 2929 0d0a 2020 2020 2020 2020 7365  a())..        se
+0004ba00: 6c66 2e70 6f70 756c 6174 655f 6368 6174  lf.populate_chat
+0004ba10: 5f73 7461 7469 7374 6963 7328 290d 0a20  _statistics().. 
+0004ba20: 2020 2020 2020 2069 6620 7365 6c66 2e68         if self.h
+0004ba30: 746d 6c5f 7374 6174 732e 5368 6f77 6e3a  tml_stats.Shown:
+0004ba40: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+0004ba50: 6c66 2e73 686f 775f 7374 6174 7328 5472  lf.show_stats(Tr
+0004ba60: 7565 2920 2320 546f 2072 6573 746f 7265  ue) # To restore
+0004ba70: 2073 6372 6f6c 6c20 706f 7369 7469 6f6e   scroll position
+0004ba80: 0d0a 0d0a 0d0a 2020 2020 6465 6620 6c6f  ......    def lo
+0004ba90: 6164 5f63 6f6e 7461 6374 2873 656c 662c  ad_contact(self,
+0004baa0: 2063 6f6e 7461 6374 293a 0d0a 2020 2020   contact):..    
+0004bab0: 2020 2020 2222 224c 6f61 6473 2063 6f6e      """Loads con
+0004bac0: 7461 6374 2069 6e66 6f72 6d61 7469 6f6e  tact information
+0004bad0: 3a20 6176 6174 6172 2c20 7072 6f66 696c  : avatar, profil
+0004bae0: 652c 2061 6e64 2063 6861 7473 2064 6174  e, and chats dat
+0004baf0: 612e 2222 220d 0a20 2020 2020 2020 2062  a."""..        b
+0004bb00: 7573 792c 2063 6c69 7374 203d 204e 6f6e  usy, clist = Non
+0004bb10: 652c 2073 656c 662e 6c69 7374 5f63 6f6e  e, self.list_con
+0004bb20: 7461 6374 730d 0a20 2020 2020 2020 2069  tacts..        i
+0004bb30: 6620 6e6f 7420 636f 6e74 6163 743a 0d0a  f not contact:..
+0004bb40: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0004bb50: 2e6c 6162 656c 5f63 6f6e 7461 6374 2e4c  .label_contact.L
+0004bb60: 6162 656c 203d 2022 2643 6f6e 7461 6374  abel = "&Contact
+0004bb70: 3a22 0d0a 2020 2020 2020 2020 2020 2020  :"..            
+0004bb80: 7365 6c66 2e68 746d 6c5f 636f 6e74 6163  self.html_contac
+0004bb90: 742e 5365 7450 6167 6528 2222 290d 0a20  t.SetPage("").. 
+0004bba0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0004bbb0: 6874 6d6c 5f63 6f6e 7461 6374 2e42 6163  html_contact.Bac
+0004bbc0: 6b67 726f 756e 6443 6f6c 6f75 7220 3d20  kgroundColour = 
+0004bbd0: 436f 6c6f 7572 4d61 6e61 6765 722e 4765  ColourManager.Ge
+0004bbe0: 7443 6f6c 6f75 7228 7778 2e53 5953 5f43  tColour(wx.SYS_C
+0004bbf0: 4f4c 4f55 525f 5749 4e44 4f57 290d 0a20  OLOUR_WINDOW).. 
+0004bc00: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0004bc10: 6874 6d6c 5f63 6f6e 7461 6374 2e50 6172  html_contact.Par
+0004bc20: 656e 742e 4469 7361 626c 6528 290d 0a20  ent.Disable().. 
+0004bc30: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
+0004bc40: 2069 6e20 7261 6e67 6528 636c 6973 742e   in range(clist.
+0004bc50: 4974 656d 436f 756e 7429 2069 6620 7365  ItemCount) if se
+0004bc60: 6c66 2e63 6f6e 7461 6374 2065 6c73 6520  lf.contact else 
+0004bc70: 2829 3a0d 0a20 2020 2020 2020 2020 2020  ():..           
+0004bc80: 2020 2020 2069 6620 636c 6973 742e 4765       if clist.Ge
+0004bc90: 7449 7465 6d4d 6170 7065 6444 6174 6128  tItemMappedData(
+0004bca0: 6929 203d 3d20 7365 6c66 2e63 6f6e 7461  i) == self.conta
+0004bcb0: 6374 3a0d 0a20 2020 2020 2020 2020 2020  ct:..           
+0004bcc0: 2020 2020 2020 2020 2063 6c69 7374 2e53           clist.S
+0004bcd0: 6574 4974 656d 466f 6e74 2869 2c20 636c  etItemFont(i, cl
+0004bce0: 6973 742e 466f 6e74 290d 0a20 2020 2020  ist.Font)..     
+0004bcf0: 2020 2020 2020 2073 656c 662e 636f 6e74         self.cont
+0004bd00: 6163 7420 3d20 4e6f 6e65 0d0a 2020 2020  act = None..    
+0004bd10: 2020 2020 2020 2020 7265 7475 726e 0d0a          return..
+0004bd20: 0d0a 2020 2020 2020 2020 2320 5570 6461  ..        # Upda
+0004bd30: 7465 2063 6f6e 7461 6374 206c 6973 7420  te contact list 
+0004bd40: 636f 6c6f 7572 7320 616e 6420 7363 726f  colours and scro
+0004bd50: 6c6c 2074 6f20 7468 6520 6f70 656e 6564  ll to the opened
+0004bd60: 2063 6f6e 7461 6374 0d0a 2020 2020 2020   contact..      
+0004bd70: 2020 6361 7465 676f 7279 203d 2022 6461    category = "da
+0004bd80: 7461 6261 7365 2061 6363 6f75 6e74 2220  tabase account" 
+0004bd90: 6966 2063 6f6e 7461 6374 5b22 6964 656e  if contact["iden
+0004bda0: 7469 7479 225d 203d 3d20 7365 6c66 2e64  tity"] == self.d
+0004bdb0: 622e 6964 2065 6c73 6520 2263 6f6e 7461  b.id else "conta
+0004bdc0: 6374 220d 0a20 2020 2020 2020 2069 6620  ct"..        if 
+0004bdd0: 636f 6e74 6163 7420 213d 2073 656c 662e  contact != self.
+0004bde0: 636f 6e74 6163 743a 0d0a 2020 2020 2020  contact:..      
+0004bdf0: 2020 2020 2020 6c6f 6767 6572 2e69 6e66        logger.inf
+0004be00: 6f28 224f 7065 6e69 6e67 2025 7320 2573  o("Opening %s %s
+0004be10: 2e22 2c20 6361 7465 676f 7279 2c20 636f  .", category, co
+0004be20: 6e74 6163 745b 226e 616d 6522 5d29 0d0a  ntact["name"])..
+0004be30: 2020 2020 2020 2020 636c 6973 742e 4672          clist.Fr
+0004be40: 6565 7a65 2829 0d0a 2020 2020 2020 2020  eeze()..        
+0004be50: 7363 726f 6c6c 706f 7320 3d20 636c 6973  scrollpos = clis
+0004be60: 742e 4765 7453 6372 6f6c 6c50 6f73 2877  t.GetScrollPos(w
+0004be70: 782e 5645 5254 4943 414c 290d 0a20 2020  x.VERTICAL)..   
+0004be80: 2020 2020 2069 6e64 6578 5f73 656c 6563       index_selec
+0004be90: 7465 6420 3d20 2d31 0d0a 2020 2020 2020  ted = -1..      
+0004bea0: 2020 666f 7220 6920 696e 2072 616e 6765    for i in range
+0004beb0: 2863 6c69 7374 2e49 7465 6d43 6f75 6e74  (clist.ItemCount
+0004bec0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+0004bed0: 6d79 6964 203d 2063 6c69 7374 2e47 6574  myid = clist.Get
+0004bee0: 4974 656d 4d61 7070 6564 4461 7461 2869  ItemMappedData(i
+0004bef0: 295b 2269 6422 5d0d 0a20 2020 2020 2020  )["id"]..       
+0004bf00: 2020 2020 2069 6620 6d79 6964 203d 3d20       if myid == 
+0004bf10: 636f 6e74 6163 745b 2269 6422 5d3a 0d0a  contact["id"]:..
+0004bf20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004bf30: 696e 6465 785f 7365 6c65 6374 6564 203d  index_selected =
+0004bf40: 2069 0d0a 2020 2020 2020 2020 2020 2020   i..            
+0004bf50: 2020 2020 6620 3d20 636c 6973 742e 466f      f = clist.Fo
+0004bf60: 6e74 3b20 662e 5365 7457 6569 6768 7428  nt; f.SetWeight(
+0004bf70: 7778 2e46 4f4e 5457 4549 4748 545f 424f  wx.FONTWEIGHT_BO
+0004bf80: 4c44 290d 0a20 2020 2020 2020 2020 2020  LD)..           
+0004bf90: 2020 2020 2063 6c69 7374 2e53 6574 4974       clist.SetIt
+0004bfa0: 656d 466f 6e74 2869 2c20 6629 0d0a 2020  emFont(i, f)..  
+0004bfb0: 2020 2020 2020 2020 2020 656c 6966 2073            elif s
+0004bfc0: 656c 662e 636f 6e74 6163 7420 616e 6420  elf.contact and 
+0004bfd0: 6d79 6964 203d 3d20 7365 6c66 2e63 6f6e  myid == self.con
+0004bfe0: 7461 6374 5b22 6964 225d 3a0d 0a20 2020  tact["id"]:..   
+0004bff0: 2020 2020 2020 2020 2020 2020 2063 6c69               cli
+0004c000: 7374 2e53 6574 4974 656d 466f 6e74 2869  st.SetItemFont(i
+0004c010: 2c20 636c 6973 742e 466f 6e74 290d 0a20  , clist.Font).. 
+0004c020: 2020 2020 2020 2069 6620 696e 6465 785f         if index_
+0004c030: 7365 6c65 6374 6564 203e 3d20 303a 0d0a  selected >= 0:..
+0004c040: 2020 2020 2020 2020 2020 2020 6465 6c74              delt
+0004c050: 6120 3d20 696e 6465 785f 7365 6c65 6374  a = index_select
+0004c060: 6564 202d 2073 6372 6f6c 6c70 6f73 0d0a  ed - scrollpos..
+0004c070: 2020 2020 2020 2020 2020 2020 6966 2064              if d
+0004c080: 656c 7461 203c 2030 206f 7220 6162 7328  elta < 0 or abs(
+0004c090: 6465 6c74 6129 203e 3d20 636c 6973 742e  delta) >= clist.
+0004c0a0: 436f 756e 7450 6572 5061 6765 3a0d 0a20  CountPerPage:.. 
+0004c0b0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+0004c0c0: 7564 6765 203d 202d 636c 6973 742e 436f  udge = -clist.Co
+0004c0d0: 756e 7450 6572 5061 6765 202f 2f20 320d  untPerPage // 2.
+0004c0e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004c0f0: 2063 6c69 7374 2e53 6372 6f6c 6c4c 696e   clist.ScrollLin
+0004c100: 6573 2864 656c 7461 202b 206e 7564 6765  es(delta + nudge
+0004c110: 290d 0a20 2020 2020 2020 2063 6c69 7374  )..        clist
+0004c120: 2e54 6861 7728 290d 0a20 2020 2020 2020  .Thaw()..       
+0004c130: 2077 782e 5969 656c 6449 664e 6565 6465   wx.YieldIfNeede
+0004c140: 6428 2920 2320 416c 6c6f 7720 6469 7370  d() # Allow disp
+0004c150: 6c61 7920 746f 2072 6566 7265 7368 0d0a  lay to refresh..
+0004c160: 2020 2020 2020 2020 7072 6566 6978 203d          prefix =
+0004c170: 2022 4461 7461 6261 7365 2061 2663 636f   "Database a&cco
+0004c180: 756e 7422 2069 6620 636f 6e74 6163 745b  unt" if contact[
+0004c190: 2269 6465 6e74 6974 7922 5d20 3d3d 2073  "identity"] == s
+0004c1a0: 656c 662e 6462 2e69 6420 656c 7365 2022  elf.db.id else "
+0004c1b0: 2643 6f6e 7461 6374 220d 0a20 2020 2020  &Contact"..     
+0004c1c0: 2020 2073 656c 662e 6275 7474 6f6e 5f65     self.button_e
+0004c1d0: 7870 6f72 745f 636f 6e74 6163 745f 6368  xport_contact_ch
+0004c1e0: 6174 732e 4c61 6265 6c20 3d20 2226 4578  ats.Label = "&Ex
+0004c1f0: 706f 7274 2025 7320 6368 6174 7322 2025  port %s chats" %
+0004c200: 2063 6174 6567 6f72 792e 7370 6c69 7428   category.split(
+0004c210: 295b 2d31 5d0d 0a20 2020 2020 2020 2073  )[-1]..        s
+0004c220: 656c 662e 6275 7474 6f6e 5f65 7870 6f72  elf.button_expor
+0004c230: 745f 636f 6e74 6163 745f 6368 6174 732e  t_contact_chats.
+0004c240: 456e 6162 6c65 6420 3d20 626f 6f6c 2863  Enabled = bool(c
+0004c250: 6f6e 7461 6374 2e67 6574 2822 636f 6e76  ontact.get("conv
+0004c260: 6572 7361 7469 6f6e 7322 2c20 5b5d 2929  ersations", []))
+0004c270: 0d0a 2020 2020 2020 2020 7365 6c66 2e6c  ..        self.l
+0004c280: 6162 656c 5f63 6f6e 7461 6374 2e4c 6162  abel_contact.Lab
+0004c290: 656c 203d 2070 7265 6669 7820 2b20 2220  el = prefix + " 
+0004c2a0: 2528 6e61 6d65 2973 2028 2528 6964 656e  %(name)s (%(iden
+0004c2b0: 7469 7479 2973 293a 2220 2520 636f 6e74  tity)s):" % cont
+0004c2c0: 6163 740d 0a20 2020 2020 2020 2073 656c  act..        sel
+0004c2d0: 662e 6c61 6265 6c5f 636f 6e74 6163 742e  f.label_contact.
+0004c2e0: 5061 7265 6e74 2e4c 6179 6f75 7428 290d  Parent.Layout().
+0004c2f0: 0a0d 0a20 2020 2020 2020 2074 6974 6c65  ...        title
+0004c300: 6d61 7020 3d20 7b78 5b22 6964 225d 3a20  map = {x["id"]: 
+0004c310: 785b 2274 6974 6c65 5f6c 6f6e 6722 5d20  x["title_long"] 
+0004c320: 666f 7220 7820 696e 2073 656c 662e 6368  for x in self.ch
+0004c330: 6174 737d 0d0a 2020 2020 2020 2020 666f  ats}..        fo
+0004c340: 7220 6461 7461 2069 6e20 636f 6e74 6163  r data in contac
+0004c350: 742e 6765 7428 2263 6f6e 7665 7273 6174  t.get("conversat
+0004c360: 696f 6e73 222c 205b 5d29 3a0d 0a20 2020  ions", []):..   
+0004c370: 2020 2020 2020 2020 2064 6174 615b 2274           data["t
+0004c380: 6974 6c65 5f6c 6f6e 6722 5d20 3d20 7469  itle_long"] = ti
+0004c390: 746c 656d 6170 5b64 6174 615b 2269 6422  tlemap[data["id"
+0004c3a0: 5d5d 0d0a 2020 2020 2020 2020 4d49 4e53  ]]..        MINS
+0004c3b0: 203d 207b 226d 6573 7361 6765 5f63 6f75   = {"message_cou
+0004c3c0: 6e74 223a 202d 7379 732e 6d61 7873 697a  nt": -sys.maxsiz
+0004c3d0: 652c 2022 7261 7469 6f22 3a20 2d73 7973  e, "ratio": -sys
+0004c3e0: 2e6d 6178 7369 7a65 2c0d 0a20 2020 2020  .maxsize,..     
+0004c3f0: 2020 2020 2020 2020 2020 2022 6669 7273             "firs
+0004c400: 745f 6d65 7373 6167 655f 6461 7465 7469  t_message_dateti
+0004c410: 6d65 223a 2064 6174 6574 696d 652e 6461  me": datetime.da
+0004c420: 7465 7469 6d65 2e6d 696e 2c0d 0a20 2020  tetime.min,..   
+0004c430: 2020 2020 2020 2020 2020 2020 2022 6c61               "la
+0004c440: 7374 5f6d 6573 7361 6765 5f64 6174 6574  st_message_datet
+0004c450: 696d 6522 3a20 6461 7465 7469 6d65 2e64  ime": datetime.d
+0004c460: 6174 6574 696d 652e 6d69 6e7d 0d0a 2020  atetime.min}..  
+0004c470: 2020 2020 2020 736f 7274 6b65 7920 3d20        sortkey = 
+0004c480: 6c61 6d62 6461 2078 3a20 7574 696c 2e63  lambda x: util.c
+0004c490: 6f61 6c65 7363 6528 785b 7365 6c66 2e63  oalesce(x[self.c
+0004c4a0: 6f6e 7461 6374 5f73 6f72 745f 6669 656c  ontact_sort_fiel
+0004c4b0: 645d 2c20 4d49 4e53 2e67 6574 2873 656c  d], MINS.get(sel
+0004c4c0: 662e 636f 6e74 6163 745f 736f 7274 5f66  f.contact_sort_f
+0004c4d0: 6965 6c64 2c20 2222 2929 0d0a 2020 2020  ield, ""))..    
+0004c4e0: 2020 2020 636f 6e74 6163 742e 6765 7428      contact.get(
+0004c4f0: 2263 6f6e 7665 7273 6174 696f 6e73 222c  "conversations",
+0004c500: 205b 5d29 2e73 6f72 7428 6b65 793d 736f   []).sort(key=so
+0004c510: 7274 6b65 792c 2072 6576 6572 7365 3d54  rtkey, reverse=T
+0004c520: 7275 6529 0d0a 0d0a 2020 2020 2020 2020  rue)....        
+0004c530: 6176 6174 6172 5f70 6174 682c 2061 7661  avatar_path, ava
+0004c540: 7461 725f 7369 7a65 2c20 6176 6174 6172  tar_size, avatar
+0004c550: 5f72 6177 203d 204e 6f6e 652c 204e 6f6e  _raw = None, Non
+0004c560: 652c 2073 6b79 7065 6461 7461 2e67 6574  e, skypedata.get
+0004c570: 5f61 7661 7461 725f 7261 7728 636f 6e74  _avatar_raw(cont
+0004c580: 6163 7429 0d0a 2020 2020 2020 2020 6966  act)..        if
+0004c590: 2073 6b79 7065 6461 7461 2e67 6574 5f61   skypedata.get_a
+0004c5a0: 7661 7461 725f 6461 7461 2863 6f6e 7461  vatar_data(conta
+0004c5b0: 6374 293a 0d0a 2020 2020 2020 2020 2020  ct):..          
+0004c5c0: 2020 696d 676b 6579 203d 2028 2261 7661    imgkey = ("ava
+0004c5d0: 7461 7222 2c20 636f 6e74 6163 745b 2269  tar", contact["i
+0004c5e0: 6422 5d29 0d0a 2020 2020 2020 2020 2020  d"])..          
+0004c5f0: 2020 696d 6720 3d20 7365 6c66 2e69 6d61    img = self.ima
+0004c600: 6765 6361 6368 652e 6765 7428 696d 676b  gecache.get(imgk
+0004c610: 6579 2920 6f72 2073 6b79 7065 6461 7461  ey) or skypedata
+0004c620: 2e67 6574 5f61 7661 7461 7228 636f 6e74  .get_avatar(cont
+0004c630: 6163 7429 0d0a 2020 2020 2020 2020 2020  act)..          
+0004c640: 2020 6578 7420 3d20 6e65 7874 2828 6b20    ext = next((k 
+0004c650: 666f 7220 6b2c 2076 2069 6e20 6578 706f  for k, v in expo
+0004c660: 7274 2e49 4d41 4745 5f46 4f52 4d41 5453  rt.IMAGE_FORMATS
+0004c670: 2e69 7465 6d73 2829 2069 6620 696d 6720  .items() if img 
+0004c680: 616e 6420 7620 3d3d 2069 6d67 2e54 7970  and v == img.Typ
+0004c690: 6529 2c20 226a 7067 2229 0d0a 2020 2020  e), "jpg")..    
+0004c6a0: 2020 2020 2020 2020 7661 6c73 203d 2028          vals = (
+0004c6b0: 636f 6e74 6163 745b 2269 6465 6e74 6974  contact["identit
+0004c6c0: 7922 5d2c 2073 656c 662e 6462 2e66 696c  y"], self.db.fil
+0004c6d0: 656e 616d 652e 656e 636f 6465 2822 7574  ename.encode("ut
+0004c6e0: 662d 3822 292c 2065 7874 290d 0a20 2020  f-8"), ext)..   
+0004c6f0: 2020 2020 2020 2020 2066 6e20 3d20 2225           fn = "%
+0004c700: 735f 2573 5f66 756c 6c73 697a 652e 2573  s_%s_fullsize.%s
+0004c710: 2220 2520 7475 706c 6528 6d61 7028 7572  " % tuple(map(ur
+0004c720: 6c6c 6962 2e70 6172 7365 2e71 756f 7465  llib.parse.quote
+0004c730: 2c20 7661 6c73 2929 0d0a 2020 2020 2020  , vals))..      
+0004c740: 2020 2020 2020 6966 2069 6d67 2061 6e64        if img and
+0004c750: 2066 6e20 6e6f 7420 696e 2073 656c 662e   fn not in self.
+0004c760: 6d65 6d6f 7279 6673 5b22 6669 6c65 7322  memoryfs["files"
+0004c770: 5d3a 0d0a 2020 2020 2020 2020 2020 2020  ]:..            
+0004c780: 2020 2020 7365 6c66 2e6d 656d 6f72 7966      self.memoryf
+0004c790: 735b 2268 616e 646c 6572 225d 2e41 6464  s["handler"].Add
+0004c7a0: 4669 6c65 2866 6e2c 2069 6d67 2c20 696d  File(fn, img, im
+0004c7b0: 672e 5479 7065 290d 0a20 2020 2020 2020  g.Type)..       
+0004c7c0: 2020 2020 2020 2020 2073 656c 662e 6d65           self.me
+0004c7d0: 6d6f 7279 6673 5b22 6669 6c65 7322 5d5b  moryfs["files"][
+0004c7e0: 666e 5d20 3d20 310d 0a20 2020 2020 2020  fn] = 1..       
+0004c7f0: 2020 2020 2069 6620 666e 2069 6e20 7365       if fn in se
+0004c800: 6c66 2e6d 656d 6f72 7966 735b 2266 696c  lf.memoryfs["fil
+0004c810: 6573 225d 3a0d 0a20 2020 2020 2020 2020  es"]:..         
+0004c820: 2020 2020 2020 2061 7661 7461 725f 7061         avatar_pa
+0004c830: 7468 203d 2066 6e0d 0a20 2020 2020 2020  th = fn..       
+0004c840: 2020 2020 2069 6620 696d 673a 0d0a 2020       if img:..  
+0004c850: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0004c860: 6c66 2e69 6d61 6765 6361 6368 655b 696d  lf.imagecache[im
+0004c870: 676b 6579 5d20 3d20 696d 670d 0a20 2020  gkey] = img..   
+0004c880: 2020 2020 2020 2020 2020 2020 2061 7661               ava
+0004c890: 7461 725f 7369 7a65 203d 2074 7570 6c65  tar_size = tuple
+0004c8a0: 2869 6d67 2e47 6574 5369 7a65 2829 290d  (img.GetSize()).
+0004c8b0: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
+0004c8c0: 6175 6c74 6176 6174 6172 203d 2022 6176  aultavatar = "av
+0004c8d0: 6174 6172 5f5f 6465 6661 756c 745f 5f6c  atar__default__l
+0004c8e0: 6172 6765 2e70 6e67 220d 0a20 2020 2020  arge.png"..     
+0004c8f0: 2020 2020 2020 2069 6620 6465 6661 756c         if defaul
+0004c900: 7461 7661 7461 7220 6e6f 7420 696e 2073  tavatar not in s
+0004c910: 656c 662e 6d65 6d6f 7279 6673 5b22 6669  elf.memoryfs["fi
+0004c920: 6c65 7322 5d3a 0d0a 2020 2020 2020 2020  les"]:..        
+0004c930: 2020 2020 2020 2020 696d 6720 3d20 696d          img = im
+0004c940: 6167 6573 2e41 7661 7461 7244 6566 6175  ages.AvatarDefau
+0004c950: 6c74 4c61 7267 652e 496d 6167 650d 0a20  ltLarge.Image.. 
+0004c960: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0004c970: 656c 662e 6d65 6d6f 7279 6673 5b22 6861  elf.memoryfs["ha
+0004c980: 6e64 6c65 7222 5d2e 4164 6446 696c 6528  ndler"].AddFile(
+0004c990: 6465 6661 756c 7461 7661 7461 722c 2069  defaultavatar, i
+0004c9a0: 6d67 2c20 7778 2e42 4954 4d41 505f 5459  mg, wx.BITMAP_TY
+0004c9b0: 5045 5f50 4e47 290d 0a20 2020 2020 2020  PE_PNG)..       
+0004c9c0: 2020 2020 2020 2020 2073 656c 662e 6d65           self.me
+0004c9d0: 6d6f 7279 6673 5b22 6669 6c65 7322 5d5b  moryfs["files"][
+0004c9e0: 6465 6661 756c 7461 7661 7461 725d 203d  defaultavatar] =
+0004c9f0: 2031 0d0a 0d0a 2020 2020 2020 2020 6461   1....        da
+0004ca00: 7461 203d 207b 2263 6f6e 7461 6374 223a  ta = {"contact":
+0004ca10: 2063 6f6e 7461 6374 2c20 2261 7661 7461   contact, "avata
+0004ca20: 7222 3a20 6176 6174 6172 5f70 6174 682c  r": avatar_path,
+0004ca30: 2022 6176 6174 6172 5f73 697a 6522 3a20   "avatar_size": 
+0004ca40: 6176 6174 6172 5f73 697a 652c 0d0a 2020  avatar_size,..  
+0004ca50: 2020 2020 2020 2020 2020 2020 2020 2264                "d
+0004ca60: 6222 3a20 7365 6c66 2e64 622c 2022 736f  b": self.db, "so
+0004ca70: 7274 5f62 7922 3a20 7365 6c66 2e63 6f6e  rt_by": self.con
+0004ca80: 7461 6374 5f73 6f72 745f 6669 656c 647d  tact_sort_field}
+0004ca90: 0d0a 2020 2020 2020 2020 6874 6d6c 203d  ..        html =
+0004caa0: 2073 7465 702e 5465 6d70 6c61 7465 2874   step.Template(t
+0004cab0: 656d 706c 6174 6573 2e43 4f4e 5441 4354  emplates.CONTACT
+0004cac0: 5f48 544d 4c2c 2065 7363 6170 653d 5472  _HTML, escape=Tr
+0004cad0: 7565 292e 6578 7061 6e64 2864 6174 6129  ue).expand(data)
+0004cae0: 0d0a 2020 2020 2020 2020 7363 726f 6c6c  ..        scroll
+0004caf0: 706f 7320 3d20 5b73 656c 662e 6874 6d6c  pos = [self.html
+0004cb00: 5f63 6f6e 7461 6374 2e47 6574 5363 726f  _contact.GetScro
+0004cb10: 6c6c 506f 7328 7829 2066 6f72 2078 2069  llPos(x) for x i
+0004cb20: 6e20 2877 782e 484f 5249 5a4f 4e54 414c  n (wx.HORIZONTAL
+0004cb30: 2c20 7778 2e56 4552 5449 4341 4c29 5d0d  , wx.VERTICAL)].
+0004cb40: 0a20 2020 2020 2020 2073 656c 662e 6874  .        self.ht
+0004cb50: 6d6c 5f63 6f6e 7461 6374 2e53 6574 5061  ml_contact.SetPa
+0004cb60: 6765 2868 746d 6c29 0d0a 2020 2020 2020  ge(html)..      
+0004cb70: 2020 7365 6c66 2e68 746d 6c5f 636f 6e74    self.html_cont
+0004cb80: 6163 742e 5363 726f 6c6c 282a 7363 726f  act.Scroll(*scro
+0004cb90: 6c6c 706f 7329 0d0a 2020 2020 2020 2020  llpos)..        
+0004cba0: 7365 6c66 2e68 746d 6c5f 636f 6e74 6163  self.html_contac
+0004cbb0: 742e 4261 636b 6772 6f75 6e64 436f 6c6f  t.BackgroundColo
+0004cbc0: 7572 203d 2043 6f6c 6f75 724d 616e 6167  ur = ColourManag
+0004cbd0: 6572 2e47 6574 436f 6c6f 7572 2877 782e  er.GetColour(wx.
+0004cbe0: 5359 535f 434f 4c4f 5552 5f57 494e 444f  SYS_COLOUR_WINDO
+0004cbf0: 5729 0d0a 2020 2020 2020 2020 7365 6c66  W)..        self
+0004cc00: 2e68 746d 6c5f 636f 6e74 6163 742e 5061  .html_contact.Pa
+0004cc10: 7265 6e74 2e45 6e61 626c 6528 290d 0a20  rent.Enable().. 
+0004cc20: 2020 2020 2020 2073 656c 662e 6874 6d6c         self.html
+0004cc30: 5f63 6f6e 7461 6374 2e50 6172 656e 742e  _contact.Parent.
+0004cc40: 4c61 796f 7574 2829 0d0a 2020 2020 2020  Layout()..      
+0004cc50: 2020 7365 6c66 2e63 6f6e 7461 6374 203d    self.contact =
+0004cc60: 2063 6f6e 7461 6374 0d0a 2020 2020 2020   contact..      
+0004cc70: 2020 6966 2062 7573 793a 0d0a 2020 2020    if busy:..    
+0004cc80: 2020 2020 2020 2020 6275 7379 2e43 6c6f          busy.Clo
+0004cc90: 7365 2829 0d0a 0d0a 0d0a 2020 2020 6465  se()......    de
+0004cca0: 6620 706f 7075 6c61 7465 5f63 6861 745f  f populate_chat_
+0004ccb0: 7374 6174 6973 7469 6373 2873 656c 6629  statistics(self)
+0004ccc0: 3a0d 0a20 2020 2020 2020 2022 2222 506f  :..        """Po
+0004ccd0: 7075 6c61 7465 7320 6874 6d6c 5f73 7461  pulates html_sta
+0004cce0: 7473 2077 6974 6820 6368 6174 2073 7461  ts with chat sta
+0004ccf0: 7469 7374 6963 7320 616e 6420 776f 7264  tistics and word
+0004cd00: 2063 6c6f 7564 2e22 2222 0d0a 2020 2020   cloud."""..    
+0004cd10: 2020 2020 7374 6174 732c 2068 746d 6c20      stats, html 
+0004cd20: 3d20 7365 6c66 2e73 7463 5f68 6973 746f  = self.stc_histo
+0004cd30: 7279 2e47 6574 5374 6174 6973 7469 6373  ry.GetStatistics
+0004cd40: 4461 7461 2829 2c20 2222 0d0a 2020 2020  Data(), ""..    
+0004cd50: 2020 2020 6966 2073 7461 7473 3a0d 0a20      if stats:.. 
+0004cd60: 2020 2020 2020 2020 2020 2064 6174 6120             data 
+0004cd70: 3d20 7b22 6462 223a 2073 656c 662e 6462  = {"db": self.db
+0004cd80: 2c20 2270 6172 7469 6369 7061 6e74 7322  , "participants"
+0004cd90: 3a20 5b5d 2c0d 0a20 2020 2020 2020 2020  : [],..         
+0004cda0: 2020 2020 2020 2020 2020 2022 6368 6174             "chat
+0004cdb0: 223a 2073 656c 662e 6368 6174 2c20 2273  ": self.chat, "s
+0004cdc0: 6f72 745f 6279 223a 2073 656c 662e 7374  ort_by": self.st
+0004cdd0: 6174 735f 736f 7274 5f66 6965 6c64 2c0d  ats_sort_field,.
+0004cde0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004cdf0: 2020 2020 2022 6368 6174 5f69 6d61 6765       "chat_image
+0004ce00: 223a 204e 6f6e 652c 2022 6368 6174 5f69  ": None, "chat_i
+0004ce10: 6d61 6765 5f73 697a 6522 3a20 4e6f 6e65  mage_size": None
+0004ce20: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0004ce30: 2020 2020 2020 2022 7374 6174 7322 3a20         "stats": 
+0004ce40: 7374 6174 732c 2022 696d 6167 6573 223a  stats, "images":
+0004ce50: 207b 7d2c 2022 6175 7468 6f72 696d 6167   {}, "authorimag
+0004ce60: 6573 223a 207b 7d2c 0d0a 2020 2020 2020  es": {},..      
+0004ce70: 2020 2020 2020 2020 2020 2020 2020 2269                "i
+0004ce80: 6d61 6765 6d61 7073 223a 207b 7d2c 2022  magemaps": {}, "
+0004ce90: 6175 7468 6f72 696d 6167 656d 6170 7322  authorimagemaps"
+0004cea0: 3a20 7b7d 2c0d 0a20 2020 2020 2020 2020  : {},..         
+0004ceb0: 2020 2020 2020 2020 2020 2022 6578 7061             "expa
+0004cec0: 6e64 223a 2073 656c 662e 7374 6174 735f  nd": self.stats_
+0004ced0: 6578 7061 6e64 7d0d 0a20 2020 2020 2020  expand}..       
+0004cee0: 2020 2020 2023 2046 696c 6c20 6176 6174       # Fill avat
+0004cef0: 6172 2069 6d61 6765 730d 0a20 2020 2020  ar images..     
+0004cf00: 2020 2020 2020 2066 732c 2064 6566 6175         fs, defau
+0004cf10: 6c74 6176 6174 6172 203d 2073 656c 662e  ltavatar = self.
+0004cf20: 6d65 6d6f 7279 6673 2c20 2261 7661 7461  memoryfs, "avata
+0004cf30: 725f 5f64 6566 6175 6c74 2e70 6e67 220d  r__default.png".
+0004cf40: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0004cf50: 6465 6661 756c 7461 7661 7461 7220 6e6f  defaultavatar no
+0004cf60: 7420 696e 2066 735b 2266 696c 6573 225d  t in fs["files"]
+0004cf70: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0004cf80: 2020 2069 6d67 203d 2069 6d61 6765 732e     img = images.
+0004cf90: 4176 6174 6172 4465 6661 756c 742e 496d  AvatarDefault.Im
+0004cfa0: 6167 650d 0a20 2020 2020 2020 2020 2020  age..           
+0004cfb0: 2020 2020 2066 735b 2268 616e 646c 6572       fs["handler
+0004cfc0: 225d 2e41 6464 4669 6c65 2864 6566 6175  "].AddFile(defau
+0004cfd0: 6c74 6176 6174 6172 2c20 696d 672c 2077  ltavatar, img, w
+0004cfe0: 782e 4249 544d 4150 5f54 5950 455f 504e  x.BITMAP_TYPE_PN
+0004cff0: 4729 0d0a 2020 2020 2020 2020 2020 2020  G)..            
+0004d000: 2020 2020 6673 5b22 6669 6c65 7322 5d5b      fs["files"][
+0004d010: 6465 6661 756c 7461 7661 7461 725d 203d  defaultavatar] =
+0004d020: 2031 0d0a 2020 2020 2020 2020 2020 2020   1..            
+0004d030: 636f 6e74 6163 7473 203d 2064 6963 7428  contacts = dict(
+0004d040: 2863 5b22 736b 7970 656e 616d 6522 5d2c  (c["skypename"],
+0004d050: 2063 2920 666f 7220 6320 696e 2073 656c   c) for c in sel
+0004d060: 662e 6462 2e67 6574 5f63 6f6e 7461 6374  f.db.get_contact
+0004d070: 7328 2929 0d0a 2020 2020 2020 2020 2020  s())..          
+0004d080: 2020 7061 7274 6963 7320 3d20 6469 6374    partics = dict
+0004d090: 2828 705b 2269 6465 6e74 6974 7922 5d2c  ((p["identity"],
+0004d0a0: 2070 2920 666f 7220 7020 696e 2073 656c   p) for p in sel
+0004d0b0: 662e 6368 6174 5b22 7061 7274 6963 6970  f.chat["particip
+0004d0c0: 616e 7473 225d 290d 0a20 2020 2020 2020  ants"])..       
+0004d0d0: 2020 2020 2023 2054 6865 7265 2063 616e       # There can
+0004d0e0: 2062 6520 6175 7468 6f72 7320 6e6f 7420   be authors not 
+0004d0f0: 616d 6f6e 6720 7061 7274 6963 6970 616e  among participan
+0004d100: 7473 2c20 616e 6420 7669 6365 2076 6572  ts, and vice ver
+0004d110: 7361 0d0a 2020 2020 2020 2020 2020 2020  sa..            
+0004d120: 666f 7220 6175 7468 6f72 2069 6e20 7374  for author in st
+0004d130: 6174 735b 2261 7574 686f 7273 225d 2e75  ats["authors"].u
+0004d140: 6e69 6f6e 2870 6172 7469 6373 293a 0d0a  nion(partics):..
+0004d150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d160: 636f 6e74 6163 7420 3d20 7061 7274 6963  contact = partic
+0004d170: 732e 6765 7428 6175 7468 6f72 2c20 7b7d  s.get(author, {}
+0004d180: 292e 6765 7428 2263 6f6e 7461 6374 2229  ).get("contact")
+0004d190: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0004d1a0: 2020 636f 6e74 6163 7420 3d20 636f 6e74    contact = cont
+0004d1b0: 6163 7420 6f72 2063 6f6e 7461 6374 732e  act or contacts.
+0004d1c0: 6765 7428 6175 7468 6f72 2c20 7b7d 290d  get(author, {}).
+0004d1d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004d1e0: 2063 6f6e 7461 6374 203d 2063 6f6e 7461   contact = conta
+0004d1f0: 6374 206f 7220 7b22 6964 656e 7469 7479  ct or {"identity
+0004d200: 223a 2061 7574 686f 722c 2022 6e61 6d65  ": author, "name
+0004d210: 223a 2061 7574 686f 727d 0d0a 2020 2020  ": author}..    
+0004d220: 2020 2020 2020 2020 2020 2020 6966 2022              if "
+0004d230: 6176 6174 6172 5f62 6974 6d61 7022 2069  avatar_bitmap" i
+0004d240: 6e20 636f 6e74 6163 743a 0d0a 2020 2020  n contact:..    
+0004d250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d260: 7661 6c73 203d 2028 6175 7468 6f72 2c20  vals = (author, 
+0004d270: 7365 6c66 2e64 622e 6669 6c65 6e61 6d65  self.db.filename
+0004d280: 2e65 6e63 6f64 6528 2275 7466 2d38 2229  .encode("utf-8")
+0004d290: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0004d2a0: 2020 2020 2020 2066 6e20 3d20 2225 735f         fn = "%s_
+0004d2b0: 2573 2e62 6d70 2220 2520 7475 706c 6528  %s.bmp" % tuple(
+0004d2c0: 6d61 7028 7572 6c6c 6962 2e70 6172 7365  map(urllib.parse
+0004d2d0: 2e71 756f 7465 2c20 7661 6c73 2929 0d0a  .quote, vals))..
+0004d2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d2f0: 2020 2020 6966 2066 6e20 6e6f 7420 696e      if fn not in
+0004d300: 2066 735b 2266 696c 6573 225d 3a0d 0a20   fs["files"]:.. 
+0004d310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d320: 2020 2020 2020 2062 6d70 203d 2063 6f6e         bmp = con
+0004d330: 7461 6374 5b22 6176 6174 6172 5f62 6974  tact["avatar_bit
+0004d340: 6d61 7022 5d0d 0a20 2020 2020 2020 2020  map"]..         
+0004d350: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0004d360: 735b 2268 616e 646c 6572 225d 2e41 6464  s["handler"].Add
+0004d370: 4669 6c65 2866 6e2c 2062 6d70 2c20 7778  File(fn, bmp, wx
+0004d380: 2e42 4954 4d41 505f 5459 5045 5f42 4d50  .BITMAP_TYPE_BMP
+0004d390: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0004d3a0: 2020 2020 2020 2020 2020 2066 735b 2266             fs["f
+0004d3b0: 696c 6573 225d 5b66 6e5d 203d 2031 0d0a  iles"][fn] = 1..
+0004d3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d3d0: 2020 2020 6461 7461 5b22 6175 7468 6f72      data["author
+0004d3e0: 696d 6167 6573 225d 5b61 7574 686f 725d  images"][author]
+0004d3f0: 203d 207b 2261 7661 7461 7222 3a20 666e   = {"avatar": fn
+0004d400: 7d0d 0a20 2020 2020 2020 2020 2020 2020  }..             
+0004d410: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+0004d420: 2020 2020 2020 2020 2020 2020 2020 6461                da
+0004d430: 7461 5b22 6175 7468 6f72 696d 6167 6573  ta["authorimages
+0004d440: 225d 5b61 7574 686f 725d 203d 207b 2261  "][author] = {"a
+0004d450: 7661 7461 7222 3a20 6465 6661 756c 7461  vatar": defaulta
+0004d460: 7661 7461 727d 0d0a 2020 2020 2020 2020  vatar}..        
+0004d470: 2020 2020 2020 2020 6461 7461 5b22 7061          data["pa
+0004d480: 7274 6963 6970 616e 7473 225d 2e61 7070  rticipants"].app
+0004d490: 656e 6428 636f 6e74 6163 7429 0d0a 0d0a  end(contact)....
+0004d4a0: 2020 2020 2020 2020 2020 2020 2320 4669              # Fi
+0004d4b0: 6c6c 2063 6861 7420 746f 7461 6c20 6869  ll chat total hi
+0004d4c0: 7374 6f67 7261 6d20 706c 6f74 2069 6d61  stogram plot ima
+0004d4d0: 6765 730d 0a20 2020 2020 2020 2020 2020  ges..           
+0004d4e0: 2050 4c4f 5443 4f4e 4620 3d20 7b22 6461   PLOTCONF = {"da
+0004d4f0: 7973 223a 2028 636f 6e66 2e50 6c6f 7444  ys": (conf.PlotD
+0004d500: 6179 7355 6e69 7453 697a 652c 2063 6f6e  aysUnitSize, con
+0004d510: 662e 506c 6f74 4461 7973 436f 6c6f 7572  f.PlotDaysColour
+0004d520: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0004d530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d540: 2020 2020 6d61 7828 7374 6174 735b 2274      max(stats["t
+0004d550: 6f74 616c 6869 7374 225d 5b22 6461 7973  otalhist"]["days
+0004d560: 225d 2e76 616c 7565 7328 2929 292c 0d0a  "].values())),..
+0004d570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d580: 2020 2020 2020 2020 2268 6f75 7273 223a          "hours":
+0004d590: 2028 636f 6e66 2e50 6c6f 7448 6f75 7273   (conf.PlotHours
+0004d5a0: 556e 6974 5369 7a65 2c20 636f 6e66 2e50  UnitSize, conf.P
+0004d5b0: 6c6f 7448 6f75 7273 436f 6c6f 7572 2c0d  lotHoursColour,.
+0004d5c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004d5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d5e0: 2020 206d 6178 2873 7461 7473 5b22 746f     max(stats["to
+0004d5f0: 7461 6c68 6973 7422 5d5b 2268 6f75 7273  talhist"]["hours
+0004d600: 225d 2e76 616c 7565 7328 2929 292c 0d0a  "].values())),..
+0004d610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d620: 2020 2020 2020 207d 2069 6620 7374 6174         } if stat
+0004d630: 735b 2268 6973 7473 225d 2065 6c73 6520  s["hists"] else 
+0004d640: 7b7d 0d0a 2020 2020 2020 2020 2020 2020  {}..            
+0004d650: 666f 7220 6869 7374 7479 7065 2c20 6869  for histtype, hi
+0004d660: 7374 6461 7461 2069 6e20 7374 6174 735b  stdata in stats[
+0004d670: 2274 6f74 616c 6869 7374 225d 2e69 7465  "totalhist"].ite
+0004d680: 6d73 2829 3a0d 0a20 2020 2020 2020 2020  ms():..         
+0004d690: 2020 2020 2020 2069 6620 6869 7374 7479         if histty
+0004d6a0: 7065 206e 6f74 2069 6e20 2822 686f 7572  pe not in ("hour
+0004d6b0: 7322 2c20 2264 6179 7322 293a 2063 6f6e  s", "days"): con
+0004d6c0: 7469 6e75 6520 2320 666f 7220 6869 7374  tinue # for hist
+0004d6d0: 7479 7065 2e2e 0d0a 2020 2020 2020 2020  type....        
+0004d6e0: 2020 2020 2020 2020 7661 6c73 203d 2028          vals = (
+0004d6f0: 7365 6c66 2e63 6861 745b 2269 6465 6e74  self.chat["ident
+0004d700: 6974 7922 5d2c 2068 6973 7474 7970 652c  ity"], histtype,
+0004d710: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0004d720: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
+0004d730: 622e 6669 6c65 6e61 6d65 2e65 6e63 6f64  b.filename.encod
+0004d740: 6528 2275 7466 2d38 2229 290d 0a20 2020  e("utf-8"))..   
+0004d750: 2020 2020 2020 2020 2020 2020 2066 6e20               fn 
+0004d760: 3d20 2225 735f 2573 5f25 732e 706e 6722  = "%s_%s_%s.png"
+0004d770: 2025 2074 7570 6c65 286d 6170 2875 726c   % tuple(map(url
+0004d780: 6c69 622e 7061 7273 652e 7175 6f74 652c  lib.parse.quote,
+0004d790: 2076 616c 7329 290d 0a20 2020 2020 2020   vals))..       
+0004d7a0: 2020 2020 2020 2020 2069 6620 666e 2069           if fn i
+0004d7b0: 6e20 6673 5b22 6669 6c65 7322 5d3a 0d0a  n fs["files"]:..
+0004d7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d7d0: 2020 2020 6673 5b22 6861 6e64 6c65 7222      fs["handler"
+0004d7e0: 5d2e 5265 6d6f 7665 4669 6c65 2866 6e29  ].RemoveFile(fn)
+0004d7f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0004d800: 2020 6261 7264 6174 6120 3d20 736f 7274    bardata = sort
+0004d810: 6564 2868 6973 7464 6174 612e 6974 656d  ed(histdata.item
+0004d820: 7328 2929 0d0a 2020 2020 2020 2020 2020  s())..          
+0004d830: 2020 2020 2020 696d 672c 2072 6563 7473        img, rects
+0004d840: 203d 2063 6f6e 7472 6f6c 732e 4275 696c   = controls.Buil
+0004d850: 6448 6973 746f 6772 616d 2862 6172 6461  dHistogram(barda
+0004d860: 7461 2c20 2a50 4c4f 5443 4f4e 465b 6869  ta, *PLOTCONF[hi
+0004d870: 7374 7479 7065 5d29 0d0a 2020 2020 2020  sttype])..      
+0004d880: 2020 2020 2020 2020 2020 6673 5b22 6861            fs["ha
+0004d890: 6e64 6c65 7222 5d2e 4164 6446 696c 6528  ndler"].AddFile(
+0004d8a0: 666e 2c20 696d 672c 2077 782e 4249 544d  fn, img, wx.BITM
+0004d8b0: 4150 5f54 5950 455f 504e 4729 0d0a 2020  AP_TYPE_PNG)..  
+0004d8c0: 2020 2020 2020 2020 2020 2020 2020 6673                fs
+0004d8d0: 5b22 6669 6c65 7322 5d5b 666e 5d20 3d20  ["files"][fn] = 
+0004d8e0: 310d 0a20 2020 2020 2020 2020 2020 2020  1..             
+0004d8f0: 2020 2064 6174 615b 2269 6d61 6765 7322     data["images"
+0004d900: 5d5b 6869 7374 7479 7065 5d20 3d20 666e  ][histtype] = fn
+0004d910: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0004d920: 2020 6172 6561 732c 206d 7367 7320 3d20    areas, msgs = 
+0004d930: 5b5d 2c20 7374 6174 735b 2274 6f74 616c  [], stats["total
+0004d940: 6869 7374 225d 5b22 2573 2d66 6972 7374  hist"]["%s-first
+0004d950: 7322 2025 2068 6973 7474 7970 655d 0d0a  s" % histtype]..
+0004d960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d970: 666f 7220 692c 2028 696e 7465 7276 616c  for i, (interval
+0004d980: 2c20 7661 6c29 2069 6e20 656e 756d 6572  , val) in enumer
+0004d990: 6174 6528 6261 7264 6174 6129 3a0d 0a20  ate(bardata):.. 
+0004d9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d9b0: 2020 2069 6620 696e 7465 7276 616c 2069     if interval i
+0004d9c0: 6e20 6d73 6773 3a0d 0a20 2020 2020 2020  n msgs:..       
+0004d9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004d9e0: 2061 7265 6173 2e61 7070 656e 6428 2872   areas.append((r
+0004d9f0: 6563 7473 5b69 5d2c 2022 6d65 7373 6167  ects[i], "messag
+0004da00: 653a 2573 2220 2520 6d73 6773 5b69 6e74  e:%s" % msgs[int
+0004da10: 6572 7661 6c5d 2929 0d0a 2020 2020 2020  erval]))..      
+0004da20: 2020 2020 2020 2020 2020 6461 7461 5b22            data["
+0004da30: 696d 6167 656d 6170 7322 5d5b 6869 7374  imagemaps"][hist
+0004da40: 7479 7065 5d20 3d20 6172 6561 730d 0a20  type] = areas.. 
+0004da50: 2020 2020 2020 2020 2020 2023 2046 696c             # Fil
+0004da60: 6c20 6175 7468 6f72 2068 6973 746f 6772  l author histogr
+0004da70: 616d 2070 6c6f 7420 696d 6167 6573 0d0a  am plot images..
+0004da80: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0004da90: 6175 7468 6f72 2c20 6869 7374 7320 696e  author, hists in
+0004daa0: 2073 7461 7473 5b22 6869 7374 7322 5d2e   stats["hists"].
+0004dab0: 6974 656d 7328 293a 0d0a 2020 2020 2020  items():..      
+0004dac0: 2020 2020 2020 2020 2020 666f 7220 6869            for hi
+0004dad0: 7374 7479 7065 2c20 6869 7374 6461 7461  sttype, histdata
+0004dae0: 2069 6e20 6869 7374 732e 6974 656d 7328   in hists.items(
+0004daf0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+0004db00: 2020 2020 2020 2020 6966 2068 6973 7474          if histt
+0004db10: 7970 6520 6e6f 7420 696e 2028 2268 6f75  ype not in ("hou
+0004db20: 7273 222c 2022 6461 7973 2229 3a20 636f  rs", "days"): co
+0004db30: 6e74 696e 7565 2023 2066 6f72 2068 6973  ntinue # for his
+0004db40: 7474 7970 652e 2e0d 0a20 2020 2020 2020  ttype....       
+0004db50: 2020 2020 2020 2020 2020 2020 2076 616c               val
+0004db60: 7320 3d20 2861 7574 686f 722c 2068 6973  s = (author, his
+0004db70: 7474 7970 652c 2073 656c 662e 6368 6174  ttype, self.chat
+0004db80: 5b22 6964 656e 7469 7479 225d 2c0d 0a20  ["identity"],.. 
+0004db90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004dba0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0004dbb0: 6462 2e66 696c 656e 616d 652e 656e 636f  db.filename.enco
+0004dbc0: 6465 2822 7574 662d 3822 2929 0d0a 2020  de("utf-8"))..  
+0004dbd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004dbe0: 2020 666e 203d 2022 2573 5f25 735f 2573    fn = "%s_%s_%s
+0004dbf0: 5f25 732e 706e 6722 2025 2074 7570 6c65  _%s.png" % tuple
+0004dc00: 286d 6170 2875 726c 6c69 622e 7061 7273  (map(urllib.pars
+0004dc10: 652e 7175 6f74 652c 2076 616c 7329 290d  e.quote, vals)).
+0004dc20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004dc30: 2020 2020 2069 6620 666e 2069 6e20 6673       if fn in fs
+0004dc40: 5b22 6669 6c65 7322 5d3a 0d0a 2020 2020  ["files"]:..    
+0004dc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004dc60: 2020 2020 6673 5b22 6861 6e64 6c65 7222      fs["handler"
+0004dc70: 5d2e 5265 6d6f 7665 4669 6c65 2866 6e29  ].RemoveFile(fn)
+0004dc80: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0004dc90: 2020 2020 2020 6261 7264 6174 6120 3d20        bardata = 
+0004dca0: 736f 7274 6564 2868 6973 7464 6174 612e  sorted(histdata.
+0004dcb0: 6974 656d 7328 2929 0d0a 2020 2020 2020  items())..      
+0004dcc0: 2020 2020 2020 2020 2020 2020 2020 696d                im
+0004dcd0: 672c 2072 6563 7473 203d 2063 6f6e 7472  g, rects = contr
+0004dce0: 6f6c 732e 4275 696c 6448 6973 746f 6772  ols.BuildHistogr
+0004dcf0: 616d 2862 6172 6461 7461 2c20 2a50 4c4f  am(bardata, *PLO
+0004dd00: 5443 4f4e 465b 6869 7374 7479 7065 5d29  TCONF[histtype])
+0004dd10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0004dd20: 2020 2020 2020 6673 5b22 6861 6e64 6c65        fs["handle
+0004dd30: 7222 5d2e 4164 6446 696c 6528 666e 2c20  r"].AddFile(fn, 
+0004dd40: 696d 672c 2077 782e 4249 544d 4150 5f54  img, wx.BITMAP_T
+0004dd50: 5950 455f 504e 4729 0d0a 2020 2020 2020  YPE_PNG)..      
+0004dd60: 2020 2020 2020 2020 2020 2020 2020 6673                fs
+0004dd70: 5b22 6669 6c65 7322 5d5b 666e 5d20 3d20  ["files"][fn] = 
+0004dd80: 310d 0a20 2020 2020 2020 2020 2020 2020  1..             
+0004dd90: 2020 2020 2020 2064 6174 615b 2261 7574         data["aut
+0004dda0: 686f 7269 6d61 6765 7322 5d5b 6175 7468  horimages"][auth
+0004ddb0: 6f72 5d5b 6869 7374 7479 7065 5d20 3d20  or][histtype] = 
+0004ddc0: 666e 0d0a 2020 2020 2020 2020 2020 2020  fn..            
+0004ddd0: 2020 2020 2020 2020 6172 6561 732c 206d          areas, m
+0004dde0: 7367 7320 3d20 5b5d 2c20 6869 7374 735b  sgs = [], hists[
+0004ddf0: 2225 732d 6669 7273 7473 2220 2520 6869  "%s-firsts" % hi
+0004de00: 7374 7479 7065 5d0d 0a20 2020 2020 2020  sttype]..       
+0004de10: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0004de20: 2069 2c20 2869 6e74 6572 7661 6c2c 2076   i, (interval, v
+0004de30: 616c 2920 696e 2065 6e75 6d65 7261 7465  al) in enumerate
+0004de40: 2862 6172 6461 7461 293a 0d0a 2020 2020  (bardata):..    
+0004de50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004de60: 2020 2020 6966 2069 6e74 6572 7661 6c20      if interval 
+0004de70: 696e 206d 7367 733a 0d0a 2020 2020 2020  in msgs:..      
+0004de80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004de90: 2020 2020 2020 6172 6561 732e 6170 7065        areas.appe
+0004dea0: 6e64 2828 7265 6374 735b 695d 2c20 226d  nd((rects[i], "m
+0004deb0: 6573 7361 6765 3a25 7322 2025 206d 7367  essage:%s" % msg
+0004dec0: 735b 696e 7465 7276 616c 5d29 290d 0a20  s[interval])).. 
+0004ded0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004dee0: 2020 2069 6620 6175 7468 6f72 206e 6f74     if author not
+0004def0: 2069 6e20 6461 7461 5b22 6175 7468 6f72   in data["author
+0004df00: 696d 6167 656d 6170 7322 5d3a 0d0a 2020  imagemaps"]:..  
+0004df10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004df20: 2020 2020 2020 6461 7461 5b22 6175 7468        data["auth
+0004df30: 6f72 696d 6167 656d 6170 7322 5d5b 6175  orimagemaps"][au
+0004df40: 7468 6f72 5d20 3d20 7b7d 0d0a 2020 2020  thor] = {}..    
+0004df50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004df60: 6461 7461 5b22 6175 7468 6f72 696d 6167  data["authorimag
+0004df70: 656d 6170 7322 5d5b 6175 7468 6f72 5d5b  emaps"][author][
+0004df80: 6869 7374 7479 7065 5d20 3d20 6172 6561  histtype] = area
+0004df90: 730d 0a20 2020 2020 2020 2020 2020 2023  s..            #
+0004dfa0: 2046 696c 6c20 656d 6f74 6963 6f6e 2069   Fill emoticon i
+0004dfb0: 6d61 6765 730d 0a20 2020 2020 2020 2020  mages..         
+0004dfc0: 2020 2066 6e20 3d20 2265 6d6f 7469 636f     fn = "emotico
+0004dfd0: 6e5f 7472 616e 7370 6172 656e 742e 6769  n_transparent.gi
+0004dfe0: 6622 0d0a 2020 2020 2020 2020 2020 2020  f"..            
+0004dff0: 6966 2066 6e20 6e6f 7420 696e 2066 735b  if fn not in fs[
+0004e000: 2266 696c 6573 225d 3a0d 0a20 2020 2020  "files"]:..     
+0004e010: 2020 2020 2020 2020 2020 2069 6d67 203d             img =
+0004e020: 2069 6d61 6765 732e 5472 616e 7370 6172   images.Transpar
+0004e030: 656e 7450 6978 656c 2e49 6d61 6765 0d0a  entPixel.Image..
+0004e040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e050: 6673 5b22 6861 6e64 6c65 7222 5d2e 4164  fs["handler"].Ad
+0004e060: 6446 696c 6528 666e 2c20 696d 672c 2077  dFile(fn, img, w
+0004e070: 782e 4249 544d 4150 5f54 5950 455f 4749  x.BITMAP_TYPE_GI
+0004e080: 4629 0d0a 2020 2020 2020 2020 2020 2020  F)..            
+0004e090: 2020 2020 6673 5b22 6669 6c65 7322 5d5b      fs["files"][
+0004e0a0: 666e 5d20 3d20 310d 0a20 2020 2020 2020  fn] = 1..       
+0004e0b0: 2020 2020 2066 6f72 2065 6d6f 7469 636f       for emotico
+0004e0c0: 6e20 696e 2073 7461 7473 5b22 656d 6f74  n in stats["emot
+0004e0d0: 6963 6f6e 7322 5d3a 0d0a 2020 2020 2020  icons"]:..      
+0004e0e0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+0004e0f0: 2068 6173 6174 7472 2865 6d6f 7469 636f   hasattr(emotico
+0004e100: 6e73 2c20 656d 6f74 6963 6f6e 293a 2063  ns, emoticon): c
+0004e110: 6f6e 7469 6e75 6520 2320 666f 7220 656d  ontinue # for em
+0004e120: 6f74 6963 6f6e 0d0a 2020 2020 2020 2020  oticon..        
+0004e130: 2020 2020 2020 2020 696d 6720 3d20 6765          img = ge
+0004e140: 7461 7474 7228 656d 6f74 6963 6f6e 732c  tattr(emoticons,
+0004e150: 2065 6d6f 7469 636f 6e29 0d0a 2020 2020   emoticon)..    
+0004e160: 2020 2020 2020 2020 2020 2020 666e 203d              fn =
+0004e170: 2022 656d 6f74 6963 6f6e 5f25 732e 6769   "emoticon_%s.gi
+0004e180: 6622 2025 2065 6d6f 7469 636f 6e0d 0a20  f" % emoticon.. 
+0004e190: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0004e1a0: 6620 696d 6720 616e 6420 666e 206e 6f74  f img and fn not
+0004e1b0: 2069 6e20 6673 5b22 6669 6c65 7322 5d3a   in fs["files"]:
+0004e1c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0004e1d0: 2020 2020 2020 6673 5b22 6861 6e64 6c65        fs["handle
+0004e1e0: 7222 5d2e 4164 6446 696c 6528 666e 2c20  r"].AddFile(fn, 
+0004e1f0: 696d 672e 496d 6167 652c 2077 782e 4249  img.Image, wx.BI
+0004e200: 544d 4150 5f54 5950 455f 4749 4629 0d0a  TMAP_TYPE_GIF)..
+0004e210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e220: 2020 2020 6673 5b22 6669 6c65 7322 5d5b      fs["files"][
+0004e230: 666e 5d20 3d20 310d 0a20 2020 2020 2020  fn] = 1..       
+0004e240: 2020 2020 2023 2046 696c 6c20 6368 6174       # Fill chat
+0004e250: 2069 6d61 6765 0d0a 2020 2020 2020 2020   image..        
+0004e260: 2020 2020 7069 6320 3d20 7365 6c66 2e63      pic = self.c
+0004e270: 6861 745b 226d 6574 615f 7069 6374 7572  hat["meta_pictur
+0004e280: 6522 5d20 6f72 2073 656c 662e 6368 6174  e"] or self.chat
+0004e290: 2e67 6574 2822 5f5f 6c69 6e6b 222c 207b  .get("__link", {
+0004e2a0: 7d29 2e67 6574 2822 6d65 7461 5f70 6963  }).get("meta_pic
+0004e2b0: 7475 7265 2229 0d0a 2020 2020 2020 2020  ture")..        
+0004e2c0: 2020 2020 696d 672c 2069 6d67 6b65 7920      img, imgkey 
+0004e2d0: 3d20 7365 6c66 2e69 6d61 6765 6361 6368  = self.imagecach
+0004e2e0: 652e 6765 7428 2822 6368 6174 222c 2073  e.get(("chat", s
+0004e2f0: 656c 662e 6368 6174 5b22 6964 225d 2929  elf.chat["id"]))
+0004e300: 2c20 2822 6368 6174 222c 2073 656c 662e  , ("chat", self.
+0004e310: 6368 6174 5b22 6964 225d 290d 0a20 2020  chat["id"])..   
+0004e320: 2020 2020 2020 2020 2074 7279 3a0d 0a20           try:.. 
+0004e330: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0004e340: 6177 203d 2073 6b79 7065 6461 7461 2e66  aw = skypedata.f
+0004e350: 6978 5f69 6d61 6765 5f72 6177 2870 6963  ix_image_raw(pic
+0004e360: 2920 6966 2070 6963 2061 6e64 206e 6f74  ) if pic and not
+0004e370: 2069 6d67 2065 6c73 6520 4e6f 6e65 0d0a   img else None..
+0004e380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e390: 696d 6720 3d20 696d 6720 6f72 2028 7778  img = img or (wx
+0004e3a0: 2e49 6d61 6765 2869 6f2e 4279 7465 7349  .Image(io.BytesI
+0004e3b0: 4f28 7261 772e 656e 636f 6465 2822 6c61  O(raw.encode("la
+0004e3c0: 7469 6e31 2229 2929 2069 6620 7261 7720  tin1"))) if raw 
+0004e3d0: 656c 7365 204e 6f6e 6529 0d0a 2020 2020  else None)..    
+0004e3e0: 2020 2020 2020 2020 6578 6365 7074 2045          except E
+0004e3f0: 7863 6570 7469 6f6e 3a0d 0a20 2020 2020  xception:..     
+0004e400: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
+0004e410: 722e 6578 6365 7074 696f 6e28 2245 7272  r.exception("Err
+0004e420: 6f72 206c 6f61 6469 6e67 2069 6d61 6765  or loading image
+0004e430: 2066 6f72 2025 732e 222c 2073 656c 662e   for %s.", self.
+0004e440: 6368 6174 5b22 7469 746c 655f 6c6f 6e67  chat["title_long
+0004e450: 5f6c 6322 5d29 0d0a 2020 2020 2020 2020  _lc"])..        
+0004e460: 2020 2020 6966 2069 6d67 3a0d 0a20 2020      if img:..   
+0004e470: 2020 2020 2020 2020 2020 2020 2076 616c               val
+0004e480: 7320 3d20 2873 7472 2873 656c 662e 6368  s = (str(self.ch
+0004e490: 6174 5b22 6964 225d 292e 656e 636f 6465  at["id"]).encode
+0004e4a0: 2822 7574 662d 3822 292c 2073 656c 662e  ("utf-8"), self.
+0004e4b0: 6462 2e66 696c 656e 616d 652e 656e 636f  db.filename.enco
+0004e4c0: 6465 2822 7574 662d 3822 2929 0d0a 2020  de("utf-8"))..  
+0004e4d0: 2020 2020 2020 2020 2020 2020 2020 666e                fn
+0004e4e0: 203d 2022 2573 5f25 732e 626d 7022 2025   = "%s_%s.bmp" %
+0004e4f0: 2074 7570 6c65 286d 6170 2875 726c 6c69   tuple(map(urlli
+0004e500: 622e 7061 7273 652e 7175 6f74 652c 2076  b.parse.quote, v
+0004e510: 616c 7329 290d 0a20 2020 2020 2020 2020  als))..         
+0004e520: 2020 2020 2020 2069 6620 666e 206e 6f74         if fn not
+0004e530: 2069 6e20 6673 5b22 6669 6c65 7322 5d3a   in fs["files"]:
+0004e540: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0004e550: 2020 2020 2020 6673 5b22 6861 6e64 6c65        fs["handle
+0004e560: 7222 5d2e 4164 6446 696c 6528 666e 2c20  r"].AddFile(fn, 
+0004e570: 696d 672e 436f 7079 2829 2c20 7778 2e42  img.Copy(), wx.B
+0004e580: 4954 4d41 505f 5459 5045 5f42 4d50 290d  ITMAP_TYPE_BMP).
+0004e590: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004e5a0: 2020 2020 2066 735b 2266 696c 6573 225d       fs["files"]
+0004e5b0: 5b66 6e5d 203d 2031 0d0a 2020 2020 2020  [fn] = 1..      
+0004e5c0: 2020 2020 2020 2020 2020 6461 7461 5b22            data["
+0004e5d0: 6368 6174 5f69 6d61 6765 225d 2c20 6461  chat_image"], da
+0004e5e0: 7461 5b22 6368 6174 5f69 6d61 6765 5f73  ta["chat_image_s
+0004e5f0: 697a 6522 5d20 3d20 666e 2c20 7475 706c  ize"] = fn, tupl
+0004e600: 6528 696d 672e 4765 7453 697a 6528 2929  e(img.GetSize())
+0004e610: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0004e620: 2020 7365 6c66 2e69 6d61 6765 6361 6368    self.imagecach
+0004e630: 655b 696d 676b 6579 5d20 3d20 696d 670d  e[imgkey] = img.
+0004e640: 0a0d 0a20 2020 2020 2020 2020 2020 2068  ...            h
+0004e650: 746d 6c20 3d20 7374 6570 2e54 656d 706c  tml = step.Templ
+0004e660: 6174 6528 7465 6d70 6c61 7465 732e 5354  ate(templates.ST
+0004e670: 4154 535f 4854 4d4c 2c20 6573 6361 7065  ATS_HTML, escape
+0004e680: 3d54 7275 6529 2e65 7870 616e 6428 6461  =True).expand(da
+0004e690: 7461 290d 0a0d 0a20 2020 2020 2020 2070  ta)....        p
+0004e6a0: 7265 7669 6f75 735f 616e 6368 6f72 203d  revious_anchor =
+0004e6b0: 2073 656c 662e 6874 6d6c 5f73 7461 7473   self.html_stats
+0004e6c0: 2e4f 7065 6e65 6441 6e63 686f 720d 0a20  .OpenedAnchor.. 
+0004e6d0: 2020 2020 2020 2070 7265 7669 6f75 735f         previous_
+0004e6e0: 7363 726f 6c6c 706f 7320 3d20 6765 7461  scrollpos = geta
+0004e6f0: 7474 7228 7365 6c66 2e68 746d 6c5f 7374  ttr(self.html_st
+0004e700: 6174 732c 2022 5f6c 6173 745f 7363 726f  ats, "_last_scro
+0004e710: 6c6c 5f70 6f73 222c 204e 6f6e 6529 0d0a  ll_pos", None)..
+0004e720: 2020 2020 2020 2020 7365 6c66 2e68 746d          self.htm
+0004e730: 6c5f 7374 6174 732e 4672 6565 7a65 2829  l_stats.Freeze()
+0004e740: 0d0a 2020 2020 2020 2020 7365 6c66 2e68  ..        self.h
+0004e750: 746d 6c5f 7374 6174 732e 5365 7450 6167  tml_stats.SetPag
+0004e760: 6528 6874 6d6c 290d 0a20 2020 2020 2020  e(html)..       
+0004e770: 2073 656c 662e 6874 6d6c 5f73 7461 7473   self.html_stats
+0004e780: 2e42 6163 6b67 726f 756e 6443 6f6c 6f75  .BackgroundColou
+0004e790: 7220 3d20 436f 6c6f 7572 4d61 6e61 6765  r = ColourManage
+0004e7a0: 722e 4765 7443 6f6c 6f75 7228 7778 2e53  r.GetColour(wx.S
+0004e7b0: 5953 5f43 4f4c 4f55 525f 5749 4e44 4f57  YS_COLOUR_WINDOW
+0004e7c0: 290d 0a20 2020 2020 2020 2069 6620 7072  )..        if pr
+0004e7d0: 6576 696f 7573 5f73 6372 6f6c 6c70 6f73  evious_scrollpos
+0004e7e0: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+0004e7f0: 656c 662e 6874 6d6c 5f73 7461 7473 2e53  elf.html_stats.S
+0004e800: 6372 6f6c 6c28 2a70 7265 7669 6f75 735f  croll(*previous_
+0004e810: 7363 726f 6c6c 706f 7329 0d0a 2020 2020  scrollpos)..    
+0004e820: 2020 2020 656c 6966 2070 7265 7669 6f75      elif previou
+0004e830: 735f 616e 6368 6f72 3a0d 0a20 2020 2020  s_anchor:..     
+0004e840: 2020 2020 2020 2073 656c 662e 6874 6d6c         self.html
+0004e850: 5f73 7461 7473 2e53 6372 6f6c 6c54 6f41  _stats.ScrollToA
+0004e860: 6e63 686f 7228 7072 6576 696f 7573 5f61  nchor(previous_a
+0004e870: 6e63 686f 7229 0d0a 2020 2020 2020 2020  nchor)..        
+0004e880: 7365 6c66 2e68 746d 6c5f 7374 6174 732e  self.html_stats.
+0004e890: 5468 6177 2829 0d0a 0d0a 0d0a 2020 2020  Thaw()......    
+0004e8a0: 6465 6620 636c 6f73 655f 6368 6174 2873  def close_chat(s
+0004e8b0: 656c 6629 3a0d 0a20 2020 2020 2020 2022  elf):..        "
+0004e8c0: 2222 436c 6f73 6573 2074 6865 2063 7572  ""Closes the cur
+0004e8d0: 7265 6e74 6c79 206f 7065 6e20 6368 6174  rently open chat
+0004e8e0: 2069 6e20 4368 6174 436f 6e74 656e 7453   in ChatContentS
+0004e8f0: 5443 2e22 2222 0d0a 2020 2020 2020 2020  TC."""..        
+0004e900: 6966 206e 6f74 2073 656c 662e 6368 6174  if not self.chat
+0004e910: 3a20 7265 7475 726e 0d0a 0d0a 2020 2020  : return....    
+0004e920: 2020 2020 6368 6174 2c20 7365 6c66 2e63      chat, self.c
+0004e930: 6861 7420 3d20 7365 6c66 2e63 6861 742c  hat = self.chat,
+0004e940: 204e 6f6e 650d 0a20 2020 2020 2020 2073   None..        s
+0004e950: 656c 662e 6368 6174 5f66 696c 7465 7220  elf.chat_filter 
+0004e960: 3d20 7b22 6461 7465 7261 6e67 6522 3a20  = {"daterange": 
+0004e970: 4e6f 6e65 2c20 2273 7461 7274 6461 7465  None, "startdate
+0004e980: 7261 6e67 6522 3a20 4e6f 6e65 2c0d 0a20  range": None,.. 
+0004e990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e9a0: 2020 2020 2020 2020 2020 2022 7465 7874             "text
+0004e9b0: 223a 2022 222c 2022 7061 7274 6963 6970  ": "", "particip
+0004e9c0: 616e 7473 223a 204e 6f6e 657d 0d0a 2020  ants": None}..  
+0004e9d0: 2020 2020 2020 2320 5570 6461 7465 2063        # Update c
+0004e9e0: 6861 7420 6c69 7374 2063 6f6c 6f75 7273  hat list colours
+0004e9f0: 0d0a 2020 2020 2020 2020 666f 7220 6920  ..        for i 
+0004ea00: 696e 2072 616e 6765 2873 656c 662e 6c69  in range(self.li
+0004ea10: 7374 5f63 6861 7473 2e49 7465 6d43 6f75  st_chats.ItemCou
+0004ea20: 6e74 293a 0d0a 2020 2020 2020 2020 2020  nt):..          
+0004ea30: 2020 6966 2073 656c 662e 6c69 7374 5f63    if self.list_c
+0004ea40: 6861 7473 2e47 6574 4974 656d 4d61 7070  hats.GetItemMapp
+0004ea50: 6564 4461 7461 2869 2920 3d3d 2063 6861  edData(i) == cha
+0004ea60: 743a 0d0a 2020 2020 2020 2020 2020 2020  t:..            
+0004ea70: 2020 2020 7365 6c66 2e6c 6973 745f 6368      self.list_ch
+0004ea80: 6174 732e 5365 7449 7465 6d46 6f6e 7428  ats.SetItemFont(
+0004ea90: 692c 2073 656c 662e 6c69 7374 5f63 6861  i, self.list_cha
+0004eaa0: 7473 2e46 6f6e 7429 0d0a 0d0a 2020 2020  ts.Font)....    
+0004eab0: 2020 2020 2320 436c 6561 7220 6669 6c74      # Clear filt
+0004eac0: 6572 2063 6f6e 7472 6f6c 730d 0a20 2020  er controls..   
+0004ead0: 2020 2020 2073 656c 662e 6c61 6265 6c5f       self.label_
+0004eae0: 6368 6174 2e4c 6162 656c 203d 2022 220d  chat.Label = "".
+0004eaf0: 0a20 2020 2020 2020 2073 656c 662e 6564  .        self.ed
+0004eb00: 6974 5f66 696c 7465 7274 6578 742e 5661  it_filtertext.Va
+0004eb10: 6c75 6520 3d20 2222 0d0a 2020 2020 2020  lue = ""..      
+0004eb20: 2020 7365 6c66 2e65 6469 745f 6669 6c74    self.edit_filt
+0004eb30: 6572 6461 7465 312e 5661 6c75 6520 3d20  erdate1.Value = 
+0004eb40: 7365 6c66 2e65 6469 745f 6669 6c74 6572  self.edit_filter
+0004eb50: 6461 7465 322e 5661 6c75 6520 3d20 4e6f  date2.Value = No
+0004eb60: 6e65 0d0a 2020 2020 2020 2020 7365 6c66  ne..        self
+0004eb70: 2e72 616e 6765 5f64 6174 652e 5365 7452  .range_date.SetR
+0004eb80: 616e 6765 284e 6f6e 652c 204e 6f6e 6529  ange(None, None)
+0004eb90: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
+0004eba0: 7463 5f68 6973 746f 7279 2e50 6f70 756c  tc_history.Popul
+0004ebb0: 6174 6528 4e6f 6e65 2c20 7365 6c66 2e64  ate(None, self.d
+0004ebc0: 6229 0d0a 2020 2020 2020 2020 7365 6c66  b)..        self
+0004ebd0: 2e73 7463 5f68 6973 746f 7279 2e53 6574  .stc_history.Set
+0004ebe0: 4669 6c74 6572 2873 656c 662e 6368 6174  Filter(self.chat
+0004ebf0: 5f66 696c 7465 7229 0d0a 2020 2020 2020  _filter)..      
+0004ec00: 2020 7365 6c66 2e73 7463 5f68 6973 746f    self.stc_histo
+0004ec10: 7279 2e43 6c65 6172 416c 6c28 290d 0a20  ry.ClearAll().. 
+0004ec20: 2020 2020 2020 2073 656c 662e 6c69 7374         self.list
+0004ec30: 5f70 6172 7469 6369 7061 6e74 732e 436c  _participants.Cl
+0004ec40: 6561 7241 6c6c 2829 0d0a 2020 2020 2020  earAll()..      
+0004ec50: 2020 7365 6c66 2e74 625f 6368 6174 2e54    self.tb_chat.T
+0004ec60: 6f67 676c 6554 6f6f 6c28 7778 2e49 445f  oggleTool(wx.ID_
+0004ec70: 4d4f 5245 2c20 4661 6c73 6529 0d0a 0d0a  MORE, False)....
+0004ec80: 2020 2020 2020 2020 2320 436c 6561 7220          # Clear 
+0004ec90: 616e 6420 6869 6465 2074 696d 656c 696e  and hide timelin
+0004eca0: 650d 0a20 2020 2020 2020 2069 6620 7365  e..        if se
+0004ecb0: 6c66 2e6c 6973 745f 7469 6d65 6c69 6e65  lf.list_timeline
+0004ecc0: 2e53 686f 776e 3a0d 0a20 2020 2020 2020  .Shown:..       
+0004ecd0: 2020 2020 2073 656c 662e 6c69 7374 5f74       self.list_t
+0004ece0: 696d 656c 696e 652e 4869 6465 2829 0d0a  imeline.Hide()..
+0004ecf0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0004ed00: 2e6c 6973 745f 7469 6d65 6c69 6e65 2e43  .list_timeline.C
+0004ed10: 6f6e 7461 696e 696e 6753 697a 6572 2e4c  ontainingSizer.L
+0004ed20: 6179 6f75 7428 290d 0a20 2020 2020 2020  ayout()..       
+0004ed30: 2020 2020 2073 656c 662e 7462 5f63 6861       self.tb_cha
+0004ed40: 742e 546f 6767 6c65 546f 6f6c 2877 782e  t.ToggleTool(wx.
+0004ed50: 4944 5f4a 554d 505f 544f 2c20 4661 6c73  ID_JUMP_TO, Fals
+0004ed60: 6529 0d0a 2020 2020 2020 2020 7365 6c66  e)..        self
+0004ed70: 2e6c 6973 745f 7469 6d65 6c69 6e65 2e50  .list_timeline.P
+0004ed80: 6f70 756c 6174 6528 5b5d 2c20 4e6f 6e65  opulate([], None
+0004ed90: 290d 0a0d 0a20 2020 2020 2020 2023 2043  )....        # C
+0004eda0: 6c65 6172 2061 6e64 2068 6964 6520 7374  lear and hide st
+0004edb0: 6174 6973 7469 6373 0d0a 2020 2020 2020  atistics..      
+0004edc0: 2020 7365 6c66 2e68 746d 6c5f 7374 6174    self.html_stat
+0004edd0: 732e 5365 7450 6167 6528 2222 290d 0a20  s.SetPage("").. 
+0004ede0: 2020 2020 2020 2069 6620 7365 6c66 2e68         if self.h
+0004edf0: 746d 6c5f 7374 6174 732e 5368 6f77 6e3a  tml_stats.Shown:
+0004ee00: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+0004ee10: 6c66 2e68 746d 6c5f 7374 6174 732e 4869  lf.html_stats.Hi
+0004ee20: 6465 2829 0d0a 2020 2020 2020 2020 2020  de()..          
+0004ee30: 2020 7365 6c66 2e73 7463 5f68 6973 746f    self.stc_histo
+0004ee40: 7279 2e53 686f 7728 290d 0a20 2020 2020  ry.Show()..     
+0004ee50: 2020 2020 2020 2073 656c 662e 6874 6d6c         self.html
+0004ee60: 5f73 7461 7473 2e43 6f6e 7461 696e 696e  _stats.Containin
+0004ee70: 6753 697a 6572 2e4c 6179 6f75 7428 290d  gSizer.Layout().
+0004ee80: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0004ee90: 662e 7374 635f 6869 7374 6f72 792e 436f  f.stc_history.Co
+0004eea0: 6e74 6169 6e69 6e67 5369 7a65 722e 4c61  ntainingSizer.La
+0004eeb0: 796f 7574 2829 0d0a 2020 2020 2020 2020  yout()..        
+0004eec0: 2020 2020 7365 6c66 2e74 625f 6368 6174      self.tb_chat
+0004eed0: 2e54 6f67 676c 6554 6f6f 6c28 7778 2e49  .ToggleTool(wx.I
+0004eee0: 445f 5052 4f50 4552 5449 4553 2c20 4661  D_PROPERTIES, Fa
+0004eef0: 6c73 6529 0d0a 0d0a 2020 2020 2020 2020  lse)....        
+0004ef00: 7365 6c66 2e70 616e 656c 5f63 6861 7473  self.panel_chats
+0004ef10: 322e 456e 6162 6c65 6420 3d20 4661 6c73  2.Enabled = Fals
+0004ef20: 650d 0a0d 0a0d 0a20 2020 2064 6566 2064  e......    def d
+0004ef30: 656c 6574 655f 6368 6174 7328 7365 6c66  elete_chats(self
+0004ef40: 2c20 6368 6174 7329 3a0d 0a20 2020 2020  , chats):..     
+0004ef50: 2020 2022 2222 4173 6b73 2066 6f72 2063     """Asks for c
+0004ef60: 6f6e 6669 726d 6174 696f 6e20 616e 6420  onfirmation and 
+0004ef70: 6465 6c65 7465 7320 7370 6563 6966 6965  deletes specifie
+0004ef80: 6420 6368 6174 7320 6672 6f6d 2064 6174  d chats from dat
+0004ef90: 6162 6173 652e 2222 220d 0a20 2020 2020  abase."""..     
+0004efa0: 2020 2069 6620 6e6f 7420 6368 6174 733a     if not chats:
+0004efb0: 2072 6574 7572 6e0d 0a20 2020 2020 2020   return..       
+0004efc0: 206f 6e67 6f69 6e67 7320 3d20 6c69 7374   ongoings = list
+0004efd0: 2866 696c 7465 7228 626f 6f6c 2c20 5b73  (filter(bool, [s
+0004efe0: 656c 662e 776f 726b 6572 5f6c 6976 652e  elf.worker_live.
+0004eff0: 6973 5f77 6f72 6b69 6e67 2829 2061 6e64  is_working() and
+0004f000: 2022 6c69 7665 2073 796e 6322 2c0d 0a20   "live sync",.. 
+0004f010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f030: 2020 2020 7365 6c66 2e77 6f72 6b65 7273      self.workers
+0004f040: 5f73 6561 7263 6820 616e 6420 2273 6561  _search and "sea
+0004f050: 7263 6822 5d29 290d 0a20 2020 2020 2020  rch"]))..       
+0004f060: 2069 6620 6f6e 676f 696e 6773 3a20 7265   if ongoings: re
+0004f070: 7475 726e 2077 782e 4d65 7373 6167 6542  turn wx.MessageB
+0004f080: 6f78 2822 2573 2069 7320 6375 7272 656e  ox("%s is curren
+0004f090: 746c 7920 6f6e 676f 696e 672c 2063 616e  tly ongoing, can
+0004f0a0: 6e6f 7420 6465 6c65 7465 2e22 2025 0d0a  not delete." %..
+0004f0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f0d0: 2020 2020 2020 2020 2020 2220 616e 6420            " and 
+0004f0e0: 222e 6a6f 696e 286f 6e67 6f69 6e67 7329  ".join(ongoings)
+0004f0f0: 2e63 6170 6974 616c 697a 6528 292c 0d0a  .capitalize(),..
+0004f100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f120: 2020 2020 2020 2020 2020 636f 6e66 2e54            conf.T
+0004f130: 6974 6c65 2c20 7778 2e49 434f 4e5f 494e  itle, wx.ICON_IN
+0004f140: 464f 524d 4154 494f 4e20 7c20 7778 2e4f  FORMATION | wx.O
+0004f150: 4b29 0d0a 0d0a 2020 2020 2020 2020 6d73  K)....        ms
+0004f160: 6720 3d20 2241 7265 2079 6f75 2073 7572  g = "Are you sur
+0004f170: 6520 796f 7520 7761 6e74 2074 6f20 6465  e you want to de
+0004f180: 6c65 7465 2025 7320 2573 3f5c 6e5c 6e20  lete %s %s?\n\n 
+0004f190: 2025 7322 2025 2028 0d0a 2020 2020 2020   %s" % (..      
+0004f1a0: 2020 2020 2020 2020 2274 6865 7365 2220          "these" 
+0004f1b0: 6966 206c 656e 2863 6861 7473 2920 3e20  if len(chats) > 
+0004f1c0: 3120 656c 7365 2022 7468 6973 222c 0d0a  1 else "this",..
+0004f1d0: 2020 2020 2020 2020 2020 2020 2020 7574                ut
+0004f1e0: 696c 2e70 6c75 7261 6c28 2263 6861 7422  il.plural("chat"
+0004f1f0: 2c20 6368 6174 732c 2073 696e 676c 653d  , chats, single=
+0004f200: 2222 292c 0d0a 2020 2020 2020 2020 2020  ""),..          
+0004f210: 2020 2020 7574 696c 2e65 6c6c 6970 7369      util.ellipsi
+0004f220: 7a65 2822 5c6e 2020 222e 6a6f 696e 2863  ze("\n  ".join(c
+0004f230: 5b22 7469 746c 655f 6c6f 6e67 225d 2066  ["title_long"] f
+0004f240: 6f72 2063 2069 6e20 6368 6174 7329 2c20  or c in chats), 
+0004f250: 3530 3029 290d 0a20 2020 2020 2020 2069  500))..        i
+0004f260: 6620 7778 2e4f 4b20 213d 2077 782e 4d65  f wx.OK != wx.Me
+0004f270: 7373 6167 6542 6f78 286d 7367 2c20 636f  ssageBox(msg, co
+0004f280: 6e66 2e54 6974 6c65 2c20 7778 2e49 434f  nf.Title, wx.ICO
+0004f290: 4e5f 494e 464f 524d 4154 494f 4e20 7c20  N_INFORMATION | 
+0004f2a0: 7778 2e4f 4b20 7c20 7778 2e43 414e 4345  wx.OK | wx.CANCE
+0004f2b0: 4c29 3a20 7265 7475 726e 0d0a 0d0a 2020  L): return....  
+0004f2c0: 2020 2020 2020 6966 2077 782e 4f4b 2021        if wx.OK !
+0004f2d0: 3d20 7778 2e4d 6573 7361 6765 426f 7828  = wx.MessageBox(
+0004f2e0: 0d0a 2020 2020 2020 2020 2020 2020 2241  ..            "A
+0004f2f0: 7265 2079 6f75 2072 6561 6c6c 7920 7375  re you really su
+0004f300: 7265 2079 6f75 2077 616e 7420 746f 2064  re you want to d
+0004f310: 656c 6574 6520 2573 2025 7320 220d 0a20  elete %s %s ".. 
+0004f320: 2020 2020 2020 2020 2020 2022 616e 6420             "and 
+0004f330: 616c 6c20 7468 6569 7220 7265 6c61 7465  all their relate
+0004f340: 6420 6461 7461 2066 726f 6d20 7468 6520  d data from the 
+0004f350: 6461 7461 6261 7365 3f5c 6e5c 6e22 0d0a  database?\n\n"..
+0004f360: 2020 2020 2020 2020 2020 2020 2254 6869              "Thi
+0004f370: 7320 6163 7469 6f6e 2069 7320 6e6f 7420  s action is not 
+0004f380: 756e 646f 6162 6c65 2e22 2025 2028 0d0a  undoable." % (..
+0004f390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f3a0: 2274 6869 7322 2069 6620 6c65 6e28 6368  "this" if len(ch
+0004f3b0: 6174 7329 203d 3d20 3120 656c 7365 2022  ats) == 1 else "
+0004f3c0: 7468 6573 6522 2c0d 0a20 2020 2020 2020  these",..       
+0004f3d0: 2020 2020 2020 2020 2075 7469 6c2e 706c           util.pl
+0004f3e0: 7572 616c 2822 6368 6174 222c 2063 6861  ural("chat", cha
+0004f3f0: 7473 2c20 6e75 6d62 6572 733d 4661 6c73  ts, numbers=Fals
+0004f400: 6529 2c0d 0a20 2020 2020 2020 2020 2020  e),..           
+0004f410: 2029 2c20 636f 6e66 2e54 6974 6c65 2c20   ), conf.Title, 
+0004f420: 7778 2e49 434f 4e5f 5741 524e 494e 4720  wx.ICON_WARNING 
+0004f430: 7c20 7778 2e4f 4b20 7c20 7778 2e43 414e  | wx.OK | wx.CAN
+0004f440: 4345 4c0d 0a20 2020 2020 2020 2029 3a20  CEL..        ): 
+0004f450: 7265 7475 726e 0d0a 0d0a 2020 2020 2020  return....      
+0004f460: 2020 636d 6170 203d 207b 705b 2263 6f6e    cmap = {p["con
+0004f470: 7461 6374 225d 5b22 6964 656e 7469 7479  tact"]["identity
+0004f480: 225d 3a20 705b 2263 6f6e 7461 6374 225d  "]: p["contact"]
+0004f490: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0004f4a0: 2020 666f 7220 6320 696e 2063 6861 7473    for c in chats
+0004f4b0: 2066 6f72 2070 2069 6e20 635b 2270 6172   for p in c["par
+0004f4c0: 7469 6369 7061 6e74 7322 5d0d 0a20 2020  ticipants"]..   
+0004f4d0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0004f4e0: 705b 2269 6465 6e74 6974 7922 5d20 213d  p["identity"] !=
+0004f4f0: 2073 656c 662e 6462 2e69 6420 616e 6420   self.db.id and 
+0004f500: 705b 2263 6f6e 7461 6374 225d 2e67 6574  p["contact"].get
+0004f510: 2822 6964 2229 7d0d 0a20 2020 2020 2020  ("id")}..       
+0004f520: 2063 6f6e 7461 6374 7320 3d20 736f 7274   contacts = sort
+0004f530: 6564 2863 6d61 702e 7661 6c75 6573 2829  ed(cmap.values()
+0004f540: 2c20 6b65 793d 6c61 6d62 6461 2078 3a20  , key=lambda x: 
+0004f550: 785b 226e 616d 6522 5d2e 6c6f 7765 7228  x["name"].lower(
+0004f560: 2929 0d0a 0d0a 2020 2020 2020 2020 6368  ))....        ch
+0004f570: 6174 6964 7320 3d20 5b63 5b22 6964 225d  atids = [c["id"]
+0004f580: 2066 6f72 2063 2069 6e20 6368 6174 735d   for c in chats]
+0004f590: 0d0a 2020 2020 2020 2020 6f74 6865 7263  ..        otherc
+0004f5a0: 6861 7473 203d 205b 6320 666f 7220 6320  hats = [c for c 
+0004f5b0: 696e 2073 656c 662e 6462 2e67 6574 5f63  in self.db.get_c
+0004f5c0: 6f6e 7665 7273 6174 696f 6e73 2829 2069  onversations() i
+0004f5d0: 6620 635b 2269 6422 5d20 6e6f 7420 696e  f c["id"] not in
+0004f5e0: 2063 6861 7469 6473 5d0d 0a20 2020 2020   chatids]..     
+0004f5f0: 2020 2070 7572 6761 626c 6573 203d 205b     purgables = [
+0004f600: 7820 666f 7220 7820 696e 2063 6f6e 7461  x for x in conta
+0004f610: 6374 7320 6966 206e 6f74 2061 6e79 280d  cts if not any(.
+0004f620: 0a20 2020 2020 2020 2020 2020 2061 6e79  .            any
+0004f630: 2870 5b22 636f 6e74 6163 7422 5d5b 2269  (p["contact"]["i
+0004f640: 6465 6e74 6974 7922 5d20 3d3d 2078 5b22  dentity"] == x["
+0004f650: 6964 656e 7469 7479 225d 2066 6f72 2070  identity"] for p
+0004f660: 2069 6e20 635b 2270 6172 7469 6369 7061   in c["participa
+0004f670: 6e74 7322 5d29 0d0a 2020 2020 2020 2020  nts"])..        
+0004f680: 2020 2020 666f 7220 6320 696e 206f 7468      for c in oth
+0004f690: 6572 6368 6174 730d 0a20 2020 2020 2020  erchats..       
+0004f6a0: 2029 5d0d 0a0d 0a20 2020 2020 2020 2069   )]....        i
+0004f6b0: 6620 7075 7267 6162 6c65 733a 0d0a 2020  f purgables:..  
+0004f6c0: 2020 2020 2020 2020 2020 6d73 6720 3d20            msg = 
+0004f6d0: 2225 7320 7769 6c6c 2068 6176 6520 6e6f  "%s will have no
+0004f6e0: 206d 6f72 6520 6d65 7373 6167 6573 2069   more messages i
+0004f6f0: 6e20 7468 6520 6461 7461 6261 7365 2022  n the database "
+0004f700: 205c 0d0a 2020 2020 2020 2020 2020 2020   \..            
+0004f710: 2020 2020 2020 2261 6674 6572 2064 656c        "after del
+0004f720: 6574 696e 6720 2573 2025 732e 2044 656c  eting %s %s. Del
+0004f730: 6574 6520 2573 2025 7320 616c 736f 3f5c  ete %s %s also?\
+0004f740: 6e5c 6e20 2025 7322 2025 2028 0d0a 2020  n\n  %s" % (..  
+0004f750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f760: 7574 696c 2e70 6c75 7261 6c28 2263 6f6e  util.plural("con
+0004f770: 7461 6374 222c 2070 7572 6761 626c 6573  tact", purgables
+0004f780: 2c20 7369 6e67 6c65 3d22 5468 6973 2229  , single="This")
+0004f790: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0004f7a0: 2020 2020 2022 7468 6573 6522 2069 6620       "these" if 
+0004f7b0: 6c65 6e28 6368 6174 7329 203e 2031 2065  len(chats) > 1 e
+0004f7c0: 6c73 6520 2274 6869 7322 2c0d 0a20 2020  lse "this",..   
+0004f7d0: 2020 2020 2020 2020 2020 2020 2020 2075                 u
+0004f7e0: 7469 6c2e 706c 7572 616c 2822 6368 6174  til.plural("chat
+0004f7f0: 222c 2063 6861 7473 2c20 7369 6e67 6c65  ", chats, single
+0004f800: 3d22 2229 2c0d 0a20 2020 2020 2020 2020  =""),..         
+0004f810: 2020 2020 2020 2020 2022 7468 6573 6522           "these"
+0004f820: 2069 6620 6c65 6e28 7075 7267 6162 6c65   if len(purgable
+0004f830: 7329 203e 2031 2065 6c73 6520 2274 6865  s) > 1 else "the
+0004f840: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
+0004f850: 2020 2020 2020 7574 696c 2e70 6c75 7261        util.plura
+0004f860: 6c28 2263 6f6e 7461 6374 222c 2070 7572  l("contact", pur
+0004f870: 6761 626c 6573 2c20 7369 6e67 6c65 3d22  gables, single="
+0004f880: 2229 2c0d 0a20 2020 2020 2020 2020 2020  "),..           
+0004f890: 2020 2020 2020 2022 5c6e 2020 222e 6a6f         "\n  ".jo
+0004f8a0: 696e 2878 5b22 6964 656e 7469 7479 225d  in(x["identity"]
+0004f8b0: 2069 6620 785b 2269 6465 6e74 6974 7922   if x["identity"
+0004f8c0: 5d20 3d3d 2078 5b22 6e61 6d65 225d 0d0a  ] == x["name"]..
+0004f8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f8e0: 2020 2020 2020 2020 2020 2020 2020 656c                el
+0004f8f0: 7365 2022 2573 2028 2573 2922 2025 2028  se "%s (%s)" % (
+0004f900: 785b 226e 616d 6522 5d2c 2078 5b22 6964  x["name"], x["id
+0004f910: 656e 7469 7479 225d 290d 0a20 2020 2020  entity"])..     
+0004f920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f930: 2020 2020 2020 2020 2066 6f72 2078 2069           for x i
+0004f940: 6e20 7075 7267 6162 6c65 7329 290d 0a20  n purgables)).. 
+0004f950: 2020 2020 2020 2020 2020 2072 6573 7020             resp 
+0004f960: 3d20 7778 2e4d 6573 7361 6765 426f 7828  = wx.MessageBox(
+0004f970: 6d73 672c 2063 6f6e 662e 5469 746c 652c  msg, conf.Title,
+0004f980: 2077 782e 4943 4f4e 5f49 4e46 4f52 4d41   wx.ICON_INFORMA
+0004f990: 5449 4f4e 207c 2077 782e 5945 5320 7c20  TION | wx.YES | 
+0004f9a0: 7778 2e4e 4f20 7c20 7778 2e43 414e 4345  wx.NO | wx.CANCE
+0004f9b0: 4c29 0d0a 2020 2020 2020 2020 2020 2020  L)..            
+0004f9c0: 6966 2077 782e 4341 4e43 454c 203d 3d20  if wx.CANCEL == 
+0004f9d0: 7265 7370 3a20 7265 7475 726e 0d0a 2020  resp: return..  
+0004f9e0: 2020 2020 2020 2020 2020 656c 6966 2020            elif  
+0004f9f0: 2077 782e 4e4f 203d 3d20 7265 7370 3a20   wx.NO == resp: 
+0004fa00: 6465 6c20 7075 7267 6162 6c65 735b 3a5d  del purgables[:]
+0004fa10: 0d0a 0d0a 2020 2020 2020 2020 5441 424c  ....        TABL
+0004fa20: 4553 203d 205b 2243 616c 6c73 222c 2022  ES = ["Calls", "
+0004fa30: 4368 6174 7322 2c20 2243 6f6e 7665 7273  Chats", "Convers
+0004fa40: 6174 696f 6e73 222c 2022 4d65 6469 6144  ations", "MediaD
+0004fa50: 6f63 756d 656e 7473 222c 2022 4d65 7373  ocuments", "Mess
+0004fa60: 6167 6573 222c 0d0a 2020 2020 2020 2020  ages",..        
+0004fa70: 2020 2020 2020 2020 2020 2250 6172 7469            "Parti
+0004fa80: 6369 7061 6e74 7322 2c20 2254 7261 6e73  cipants", "Trans
+0004fa90: 6665 7273 222c 2022 5669 6465 6f73 222c  fers", "Videos",
+0004faa0: 2022 566f 6963 656d 6169 6c73 225d 0d0a   "Voicemails"]..
+0004fab0: 2020 2020 2020 2020 6966 2070 7572 6761          if purga
+0004fac0: 626c 6573 3a20 5441 424c 4553 2e65 7874  bles: TABLES.ext
+0004fad0: 656e 6428 5b22 436f 6e74 6163 7473 222c  end(["Contacts",
+0004fae0: 2022 436f 6e74 6163 7447 726f 7570 7322   "ContactGroups"
+0004faf0: 5d29 0d0a 2020 2020 2020 2020 6f70 656e  ])..        open
+0004fb00: 6564 732c 2063 6861 6e67 6564 7320 3d20  eds, changeds = 
+0004fb10: 5b5d 2c20 5b5d 0d0a 2020 2020 2020 2020  [], []..        
+0004fb20: 666f 7220 7420 696e 2054 4142 4c45 533a  for t in TABLES:
+0004fb30: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+0004fb40: 2074 2e6c 6f77 6572 2829 2069 6e20 7365   t.lower() in se
+0004fb50: 6c66 2e64 625f 6772 6964 733a 0d0a 2020  lf.db_grids:..  
+0004fb60: 2020 2020 2020 2020 2020 2020 2020 6f70                op
+0004fb70: 656e 6564 732e 6170 7065 6e64 2874 290d  eneds.append(t).
+0004fb80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004fb90: 2069 6620 7365 6c66 2e64 625f 6772 6964   if self.db_grid
+0004fba0: 735b 742e 6c6f 7765 7228 295d 2e49 7343  s[t.lower()].IsC
+0004fbb0: 6861 6e67 6564 2829 3a20 6368 616e 6765  hanged(): change
+0004fbc0: 6473 2e61 7070 656e 6428 7429 0d0a 0d0a  ds.append(t)....
+0004fbd0: 2020 2020 2020 2020 6966 2063 6861 6e67          if chang
+0004fbe0: 6564 7320 616e 6420 7778 2e4f 4b20 213d  eds and wx.OK !=
+0004fbf0: 2077 782e 4d65 7373 6167 6542 6f78 2822   wx.MessageBox("
+0004fc00: 5468 6572 6520 6172 6520 756e 7361 7665  There are unsave
+0004fc10: 6420 6368 616e 6765 7320 220d 0a20 2020  d changes "..   
+0004fc20: 2020 2020 2020 2020 2022 696e 206f 7065           "in ope
+0004fc30: 6e20 6461 7461 2067 7269 6473 2066 6f72  n data grids for
+0004fc40: 2074 6865 2066 6f6c 6c6f 7769 6e67 2074   the following t
+0004fc50: 6162 6c65 733a 5c6e 2020 2573 5c6e 5c6e  ables:\n  %s\n\n
+0004fc60: 220d 0a20 2020 2020 2020 2020 2020 2022  "..            "
+0004fc70: 4469 7363 6172 6420 6368 616e 6765 7320  Discard changes 
+0004fc80: 616e 6420 636f 6e74 696e 7565 3f22 2025  and continue?" %
+0004fc90: 2022 5c6e 2020 222e 6a6f 696e 2863 6861   "\n  ".join(cha
+0004fca0: 6e67 6564 7329 2c0d 0a20 2020 2020 2020  ngeds),..       
+0004fcb0: 2020 2020 2063 6f6e 662e 5469 746c 652c       conf.Title,
+0004fcc0: 2077 782e 4943 4f4e 5f57 4152 4e49 4e47   wx.ICON_WARNING
+0004fcd0: 207c 2077 782e 4f4b 207c 2077 782e 4341   | wx.OK | wx.CA
+0004fce0: 4e43 454c 293a 2072 6574 7572 6e0d 0a0d  NCEL): return...
+0004fcf0: 0a20 2020 2020 2020 2023 2043 6c6f 7365  .        # Close
+0004fd00: 2071 7565 7279 2063 7572 736f 7273 2c20   query cursors, 
+0004fd10: 6469 7363 6172 6420 7461 626c 6520 6772  discard table gr
+0004fd20: 6964 7320 6375 7272 656e 746c 7920 6e6f  ids currently no
+0004fd30: 7420 7669 7369 626c 650d 0a20 2020 2020  t visible..     
+0004fd40: 2020 2069 6620 7365 6c66 2e67 7269 645f     if self.grid_
+0004fd50: 7371 6c2e 5461 626c 653a 2073 656c 662e  sql.Table: self.
+0004fd60: 6772 6964 5f73 716c 2e54 6162 6c65 2e43  grid_sql.Table.C
+0004fd70: 6c6f 7365 2829 0d0a 2020 2020 2020 2020  lose()..        
+0004fd80: 6966 2073 656c 662e 6772 6964 5f74 6162  if self.grid_tab
+0004fd90: 6c65 2e54 6162 6c65 2061 6e64 2073 656c  le.Table and sel
+0004fda0: 662e 6772 6964 5f74 6162 6c65 2e54 6162  f.grid_table.Tab
+0004fdb0: 6c65 2e49 7343 6861 6e67 6564 2829 3a0d  le.IsChanged():.
+0004fdc0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0004fdd0: 662e 6772 6964 5f74 6162 6c65 2e54 6162  f.grid_table.Tab
+0004fde0: 6c65 2e55 6e64 6f43 6861 6e67 6573 2829  le.UndoChanges()
+0004fdf0: 0d0a 2020 2020 2020 2020 666f 7220 7420  ..        for t 
+0004fe00: 696e 206f 7065 6e65 6473 3a0d 0a20 2020  in openeds:..   
+0004fe10: 2020 2020 2020 2020 2067 7269 6420 3d20           grid = 
+0004fe20: 7365 6c66 2e64 625f 6772 6964 735b 742e  self.db_grids[t.
+0004fe30: 6c6f 7765 7228 295d 0d0a 2020 2020 2020  lower()]..      
+0004fe40: 2020 2020 2020 6772 6964 2e43 6c6f 7365        grid.Close
+0004fe50: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+0004fe60: 6966 2067 7269 6420 6973 206e 6f74 2073  if grid is not s
+0004fe70: 656c 662e 6772 6964 5f74 6162 6c65 2e54  elf.grid_table.T
+0004fe80: 6162 6c65 3a20 7365 6c66 2e64 625f 6772  able: self.db_gr
+0004fe90: 6964 732e 706f 7028 742e 6c6f 7765 7228  ids.pop(t.lower(
+0004fea0: 2929 0d0a 2020 2020 2020 2020 7365 6c66  ))..        self
+0004feb0: 2e75 7064 6174 655f 7461 6268 6561 6465  .update_tabheade
+0004fec0: 7228 290d 0a0d 0a20 2020 2020 2020 2062  r()....        b
+0004fed0: 7573 7920 3d20 636f 6e74 726f 6c73 2e42  usy = controls.B
+0004fee0: 7573 7950 616e 656c 2873 656c 662c 2022  usyPanel(self, "
+0004fef0: 4465 6c65 7469 6e67 2e2e 2229 0d0a 2020  Deleting..")..  
+0004ff00: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
+0004ff10: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0004ff20: 6368 6174 2069 6e20 6368 6174 733a 2073  chat in chats: s
+0004ff30: 656c 662e 636c 6f73 655f 6368 6174 2829  elf.close_chat()
+0004ff40: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+0004ff50: 7265 7375 6c74 203d 2073 656c 662e 6462  result = self.db
+0004ff60: 2e64 656c 6574 655f 6461 7461 2863 6861  .delete_data(cha
+0004ff70: 7473 2c20 7075 7267 6162 6c65 7329 0d0a  ts, purgables)..
+0004ff80: 2020 2020 2020 2020 2020 2020 6275 7379              busy
+0004ff90: 2e43 6c6f 7365 2829 0d0a 2020 2020 2020  .Close()..      
+0004ffa0: 2020 2020 2020 6275 7379 203d 2063 6f6e        busy = con
+0004ffb0: 7472 6f6c 732e 4275 7379 5061 6e65 6c28  trols.BusyPanel(
+0004ffc0: 7365 6c66 2c20 2252 6566 7265 7368 696e  self, "Refreshin
+0004ffd0: 672e 2e22 290d 0a0d 0a20 2020 2020 2020  g..")....       
+0004ffe0: 2020 2020 2069 6478 7320 3d20 5b69 2066       idxs = [i f
+0004fff0: 6f72 2069 2069 6e20 7261 6e67 6528 7365  or i in range(se
+00050000: 6c66 2e6c 6973 745f 6368 6174 732e 4765  lf.list_chats.Ge
+00050010: 7449 7465 6d43 6f75 6e74 2829 290d 0a20  tItemCount()).. 
+00050020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050030: 2020 2069 6620 7365 6c66 2e6c 6973 745f     if self.list_
+00050040: 6368 6174 732e 4765 7449 7465 6d4d 6170  chats.GetItemMap
+00050050: 7065 6444 6174 6128 6929 2069 6e20 6368  pedData(i) in ch
+00050060: 6174 735d 0d0a 2020 2020 2020 2020 2020  ats]..          
+00050070: 2020 666f 7220 6964 7820 696e 2069 6478    for idx in idx
+00050080: 735b 3a3a 2d31 5d3a 2073 656c 662e 6c69  s[::-1]: self.li
+00050090: 7374 5f63 6861 7473 2e44 656c 6574 6549  st_chats.DeleteI
+000500a0: 7465 6d28 6964 7829 0d0a 2020 2020 2020  tem(idx)..      
+000500b0: 2020 2020 2020 7365 6c66 2e63 6861 7473        self.chats
+000500c0: 203d 205b 6320 666f 7220 6320 696e 2073   = [c for c in s
+000500d0: 656c 662e 6368 6174 7320 6966 2063 206e  elf.chats if c n
+000500e0: 6f74 2069 6e20 6368 6174 735d 0d0a 0d0a  ot in chats]....
+000500f0: 2020 2020 2020 2020 2020 2020 6964 7873              idxs
+00050100: 203d 205b 6920 666f 7220 6920 696e 2072   = [i for i in r
+00050110: 616e 6765 2873 656c 662e 6c69 7374 5f63  ange(self.list_c
+00050120: 6f6e 7461 6374 732e 4765 7449 7465 6d43  ontacts.GetItemC
+00050130: 6f75 6e74 2829 290d 0a20 2020 2020 2020  ount())..       
+00050140: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00050150: 7365 6c66 2e6c 6973 745f 636f 6e74 6163  self.list_contac
+00050160: 7473 2e47 6574 4974 656d 4d61 7070 6564  ts.GetItemMapped
+00050170: 4461 7461 2869 2920 696e 2070 7572 6761  Data(i) in purga
+00050180: 626c 6573 5d0d 0a20 2020 2020 2020 2020  bles]..         
+00050190: 2020 2066 6f72 2069 6478 2069 6e20 6964     for idx in id
+000501a0: 7873 5b3a 3a2d 315d 3a20 7365 6c66 2e6c  xs[::-1]: self.l
+000501b0: 6973 745f 636f 6e74 6163 7473 2e44 656c  ist_contacts.Del
+000501c0: 6574 6549 7465 6d28 6964 7829 0d0a 2020  eteItem(idx)..  
+000501d0: 2020 2020 2020 2020 2020 7365 6c66 2e63            self.c
+000501e0: 6f6e 7461 6374 7320 3d20 5b63 2066 6f72  ontacts = [c for
+000501f0: 2063 2069 6e20 7365 6c66 2e63 6f6e 7461   c in self.conta
+00050200: 6374 7320 6966 2063 206e 6f74 2069 6e20  cts if c not in 
+00050210: 7075 7267 6162 6c65 735d 0d0a 0d0a 2020  purgables]....  
+00050220: 2020 2020 2020 2020 2020 636f 6e74 6163            contac
+00050230: 7473 5f61 6666 6563 7465 6420 3d20 5b63  ts_affected = [c
+00050240: 2066 6f72 2063 2069 6e20 7365 6c66 2e63   for c in self.c
+00050250: 6f6e 7461 6374 7320 6966 2061 6e79 280d  ontacts if any(.
+00050260: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00050270: 2078 5b22 6964 225d 2069 6e20 5b79 5b22   x["id"] in [y["
+00050280: 6964 225d 2066 6f72 2079 2069 6e20 6368  id"] for y in ch
+00050290: 6174 735d 2066 6f72 2078 2069 6e20 632e  ats] for x in c.
+000502a0: 6765 7428 2263 6f6e 7665 7273 6174 696f  get("conversatio
+000502b0: 6e73 2229 206f 7220 5b5d 0d0a 2020 2020  ns") or []..    
+000502c0: 2020 2020 2020 2020 295d 0d0a 2020 2020          )]..    
+000502d0: 2020 2020 2020 2020 7365 6c66 2e64 622e          self.db.
+000502e0: 6765 745f 636f 6e74 6163 7473 5f73 7461  get_contacts_sta
+000502f0: 7473 285b 7365 6c66 2e64 622e 6163 636f  ts([self.db.acco
+00050300: 756e 745d 202b 2063 6f6e 7461 6374 735f  unt] + contacts_
+00050310: 6166 6665 6374 6564 2c20 7365 6c66 2e63  affected, self.c
+00050320: 6861 7473 290d 0a20 2020 2020 2020 2020  hats)..         
+00050330: 2020 2073 656c 662e 6c69 7374 5f63 6f6e     self.list_con
+00050340: 7461 6374 732e 5265 6672 6573 6852 6f77  tacts.RefreshRow
+00050350: 7328 290d 0a20 2020 2020 2020 2020 2020  s()..           
+00050360: 2073 656c 662e 6c6f 6164 5f63 6f6e 7461   self.load_conta
+00050370: 6374 284e 6f6e 6520 6966 2073 656c 662e  ct(None if self.
+00050380: 636f 6e74 6163 7420 696e 2070 7572 6761  contact in purga
+00050390: 626c 6573 2065 6c73 6520 7365 6c66 2e63  bles else self.c
+000503a0: 6f6e 7461 6374 290d 0a0d 0a20 2020 2020  ontact)....     
+000503b0: 2020 2020 2020 206c 626c 203d 2022 4126         lbl = "A&
+000503c0: 6c6c 2063 6861 7420 656e 7472 6965 7320  ll chat entries 
+000503d0: 696e 2064 6174 6162 6173 6520 2825 7329  in database (%s)
+000503e0: 3a22 2025 2073 656c 662e 6c69 7374 5f63  :" % self.list_c
+000503f0: 6861 7473 2e49 7465 6d43 6f75 6e74 0d0a  hats.ItemCount..
+00050400: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00050410: 2e6c 6162 656c 5f6c 6973 745f 6368 6174  .label_list_chat
+00050420: 732e 4c61 6265 6c20 3d20 6c62 6c0d 0a20  s.Label = lbl.. 
+00050430: 2020 2020 2020 2020 2020 206c 626c 203d             lbl =
+00050440: 2022 4126 6c6c 2070 726f 6669 6c65 7320   "A&ll profiles 
+00050450: 696e 2064 6174 6162 6173 6520 2825 7329  in database (%s)
+00050460: 3a22 2025 2073 656c 662e 6c69 7374 5f63  :" % self.list_c
+00050470: 6f6e 7461 6374 732e 4974 656d 436f 756e  ontacts.ItemCoun
+00050480: 740d 0a20 2020 2020 2020 2020 2020 2073  t..            s
+00050490: 656c 662e 6c61 6265 6c5f 6c69 7374 5f63  elf.label_list_c
+000504a0: 6f6e 7461 6374 732e 4c61 6265 6c20 3d20  ontacts.Label = 
+000504b0: 6c62 6c0d 0a0d 0a20 2020 2020 2020 2020  lbl....         
+000504c0: 2020 2073 656c 662e 6f6e 5f72 6566 7265     self.on_refre
+000504d0: 7368 5f74 6162 6c65 7328 290d 0a20 2020  sh_tables()..   
+000504e0: 2020 2020 2020 2020 2077 782e 4361 6c6c           wx.Call
+000504f0: 4166 7465 7228 7365 6c66 2e75 7064 6174  After(self.updat
+00050500: 655f 696e 666f 5f70 6167 6529 0d0a 2020  e_info_page)..  
+00050510: 2020 2020 2020 2020 2020 7778 2e43 616c            wx.Cal
+00050520: 6c41 6674 6572 2873 656c 662e 546f 704c  lAfter(self.TopL
+00050530: 6576 656c 5061 7265 6e74 2e75 7064 6174  evelParent.updat
+00050540: 655f 6461 7461 6261 7365 5f64 6574 6169  e_database_detai
+00050550: 6c29 0d0a 2020 2020 2020 2020 2020 2020  l)..            
+00050560: 6275 7379 2e43 6c6f 7365 2829 0d0a 0d0a  busy.Close()....
+00050570: 2020 2020 2020 2020 2020 2020 4d41 494e              MAIN
+00050580: 5320 3d20 5b22 436f 6e76 6572 7361 7469  S = ["Conversati
+00050590: 6f6e 7322 2c20 224d 6573 7361 6765 7322  ons", "Messages"
+000505a0: 2c20 2243 6f6e 7461 6374 7322 5d0d 0a20  , "Contacts"].. 
+000505b0: 2020 2020 2020 2020 2020 2069 6e66 6f74             infot
+000505c0: 6578 7420 3d20 2220 616e 6420 222e 6a6f  ext = " and ".jo
+000505d0: 696e 2875 7469 6c2e 706c 7572 616c 2874  in(util.plural(t
+000505e0: 2e6c 6f77 6572 2829 5b3a 2d31 5d2c 2072  .lower()[:-1], r
+000505f0: 6573 756c 745b 745d 290d 0a20 2020 2020  esult[t])..     
+00050600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050610: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00050620: 6f72 2074 2069 6e20 4d41 494e 5320 6966  or t in MAINS if
+00050630: 2072 6573 756c 742e 6765 7428 7429 290d   result.get(t)).
+00050640: 0a20 2020 2020 2020 2020 2020 206f 7468  .            oth
+00050650: 6572 636f 756e 7420 3d20 7375 6d28 7265  ercount = sum(re
+00050660: 7375 6c74 5b74 5d20 666f 7220 7420 696e  sult[t] for t in
+00050670: 2072 6573 756c 7420 6966 2074 206e 6f74   result if t not
+00050680: 2069 6e20 4d41 494e 5329 0d0a 2020 2020   in MAINS)..    
+00050690: 2020 2020 2020 2020 6966 206f 7468 6572          if other
+000506a0: 636f 756e 743a 0d0a 2020 2020 2020 2020  count:..        
+000506b0: 2020 2020 2020 2020 696e 666f 7465 7874          infotext
+000506c0: 202b 3d20 2220 2861 6e64 2025 7329 2220   += " (and %s)" 
+000506d0: 2520 7574 696c 2e70 6c75 7261 6c28 2272  % util.plural("r
+000506e0: 656c 6174 6564 2072 6f77 222c 206f 7468  elated row", oth
+000506f0: 6572 636f 756e 7429 0d0a 2020 2020 2020  ercount)..      
+00050700: 2020 2020 2020 6775 6962 6173 652e 7374        guibase.st
+00050710: 6174 7573 2822 4465 6c65 7465 6420 2573  atus("Deleted %s
+00050720: 2066 726f 6d20 2573 2e22 2c20 696e 666f   from %s.", info
+00050730: 7465 7874 2c20 7365 6c66 2e64 622c 206c  text, self.db, l
+00050740: 6f67 3d54 7275 6529 0d0a 2020 2020 2020  og=True)..      
+00050750: 2020 2020 2020 7778 2e4d 6573 7361 6765        wx.Message
+00050760: 426f 7828 2244 656c 6574 6564 2025 732e  Box("Deleted %s.
+00050770: 2220 2520 696e 666f 7465 7874 2c20 636f  " % infotext, co
+00050780: 6e66 2e54 6974 6c65 2c20 7778 2e49 434f  nf.Title, wx.ICO
+00050790: 4e5f 494e 464f 524d 4154 494f 4e29 0d0a  N_INFORMATION)..
+000507a0: 2020 2020 2020 2020 6669 6e61 6c6c 793a          finally:
+000507b0: 2062 7573 792e 436c 6f73 6528 290d 0a0d   busy.Close()...
+000507c0: 0a0d 0a20 2020 2064 6566 206f 6e5f 6465  ...    def on_de
+000507d0: 6c65 7465 5f63 6f6e 7461 6374 7328 7365  lete_contacts(se
+000507e0: 6c66 2c20 6576 656e 743d 4e6f 6e65 2c20  lf, event=None, 
+000507f0: 636f 6e74 6163 7473 3d28 2929 3a0d 0a20  contacts=()):.. 
+00050800: 2020 2020 2020 2022 2222 4861 6e64 6c65         """Handle
+00050810: 7220 666f 7220 6465 6c65 7469 6e67 2063  r for deleting c
+00050820: 6f6e 7461 6374 732c 2061 736b 7320 666f  ontacts, asks fo
+00050830: 7220 636f 6e66 6972 6d61 7469 6f6e 2e22  r confirmation."
+00050840: 2222 0d0a 2020 2020 2020 2020 636f 6e74  ""..        cont
+00050850: 6163 7473 203d 2073 6f72 7465 6428 2863  acts = sorted((c
+00050860: 2066 6f72 2063 2069 6e20 636f 6e74 6163   for c in contac
+00050870: 7473 2069 6620 635b 2269 6465 6e74 6974  ts if c["identit
+00050880: 7922 5d20 213d 2073 656c 662e 6462 2e69  y"] != self.db.i
+00050890: 6429 2c0d 0a20 2020 2020 2020 2020 2020  d),..           
+000508a0: 2020 2020 2020 2020 2020 2020 2020 206b                 k
+000508b0: 6579 3d6c 616d 6264 6120 633a 2063 5b22  ey=lambda c: c["
+000508c0: 6e61 6d65 225d 2e6c 6f77 6572 2829 290d  name"].lower()).
+000508d0: 0a20 2020 2020 2020 2069 6620 7778 2e4f  .        if wx.O
+000508e0: 4b20 213d 2077 782e 4d65 7373 6167 6542  K != wx.MessageB
+000508f0: 6f78 280d 0a20 2020 2020 2020 2020 2020  ox(..           
+00050900: 2022 4172 6520 796f 7520 7375 7265 2079   "Are you sure y
+00050910: 6f75 2077 616e 7420 746f 2064 656c 6574  ou want to delet
+00050920: 6520 2573 2066 726f 6d20 7468 6520 6461  e %s from the da
+00050930: 7461 6261 7365 3f5c 6e5c 6e22 0d0a 2020  tabase?\n\n"..  
+00050940: 2020 2020 2020 2020 2020 2225 735c 6e5c            "%s\n\
+00050950: 6e22 0d0a 2020 2020 2020 2020 2020 2020  n"..            
+00050960: 2254 6869 7320 7769 6c6c 2064 656c 6574  "This will delet
+00050970: 6520 7468 6569 7220 313a 3120 2573 2c20  e their 1:1 %s, 
+00050980: 616c 6c20 7468 6569 7220 6f74 6865 7220  all their other 
+00050990: 6d65 7373 6167 6573 2c20 220d 0a20 2020  messages, "..   
+000509a0: 2020 2020 2020 2020 2022 616e 6420 616e           "and an
+000509b0: 7920 6f74 6865 7220 7265 6c61 7465 6420  y other related 
+000509c0: 6461 7461 2e22 2025 2028 0d0a 2020 2020  data." % (..    
+000509d0: 2020 2020 2020 2020 2020 2020 7574 696c              util
+000509e0: 2e70 6c75 7261 6c28 2263 6f6e 7461 6374  .plural("contact
+000509f0: 222c 2063 6f6e 7461 6374 732c 2073 696e  ", contacts, sin
+00050a00: 676c 653d 2274 6869 7322 292c 0d0a 2020  gle="this"),..  
+00050a10: 2020 2020 2020 2020 2020 2020 2020 7574                ut
+00050a20: 696c 2e65 6c6c 6970 7369 7a65 2822 5c6e  il.ellipsize("\n
+00050a30: 222e 6a6f 696e 2822 2573 2028 2573 2922  ".join("%s (%s)"
+00050a40: 2025 2028 635b 226e 616d 6522 5d2c 2063   % (c["name"], c
+00050a50: 5b22 6964 656e 7469 7479 225d 2920 666f  ["identity"]) fo
+00050a60: 7220 6320 696e 2063 6f6e 7461 6374 7329  r c in contacts)
+00050a70: 2c20 3530 3029 2c0d 0a20 2020 2020 2020  , 500),..       
+00050a80: 2020 2020 2020 2020 2075 7469 6c2e 706c           util.pl
+00050a90: 7572 616c 2822 6368 6174 222c 2063 6f6e  ural("chat", con
+00050aa0: 7461 6374 732c 206e 756d 6265 7273 3d46  tacts, numbers=F
+00050ab0: 616c 7365 292c 0d0a 2020 2020 2020 2020  alse),..        
+00050ac0: 2020 2020 292c 2063 6f6e 662e 5469 746c      ), conf.Titl
+00050ad0: 652c 2077 782e 4943 4f4e 5f49 4e46 4f52  e, wx.ICON_INFOR
+00050ae0: 4d41 5449 4f4e 207c 2077 782e 4f4b 207c  MATION | wx.OK |
+00050af0: 2077 782e 4341 4e43 454c 0d0a 2020 2020   wx.CANCEL..    
+00050b00: 2020 2020 293a 2072 6574 7572 6e0d 0a0d      ): return...
+00050b10: 0a20 2020 2020 2020 2069 6620 7778 2e4f  .        if wx.O
+00050b20: 4b20 213d 2077 782e 4d65 7373 6167 6542  K != wx.MessageB
+00050b30: 6f78 280d 0a20 2020 2020 2020 2020 2020  ox(..           
+00050b40: 2022 4172 6520 796f 7520 7265 616c 6c79   "Are you really
+00050b50: 2073 7572 6520 796f 7520 7761 6e74 2074   sure you want t
+00050b60: 6f20 6465 6c65 7465 2025 7320 2573 2022  o delete %s %s "
+00050b70: 0d0a 2020 2020 2020 2020 2020 2020 2261  ..            "a
+00050b80: 6e64 2061 6c6c 2072 656c 6174 6564 2064  nd all related d
+00050b90: 6174 6120 6672 6f6d 2074 6865 2064 6174  ata from the dat
+00050ba0: 6162 6173 653f 5c6e 5c6e 220d 0a20 2020  abase?\n\n"..   
+00050bb0: 2020 2020 2020 2020 2022 5468 6973 2061           "This a
+00050bc0: 6374 696f 6e20 6973 206e 6f74 2075 6e64  ction is not und
+00050bd0: 6f61 626c 652e 2220 2520 280d 0a20 2020  oable." % (..   
+00050be0: 2020 2020 2020 2020 2020 2020 2022 7468               "th
+00050bf0: 6973 2220 6966 206c 656e 2863 6f6e 7461  is" if len(conta
+00050c00: 6374 7329 203d 3d20 3120 656c 7365 2022  cts) == 1 else "
+00050c10: 7468 6573 6522 2c0d 0a20 2020 2020 2020  these",..       
+00050c20: 2020 2020 2020 2020 2075 7469 6c2e 706c           util.pl
+00050c30: 7572 616c 2822 636f 6e74 6163 7422 2c20  ural("contact", 
+00050c40: 636f 6e74 6163 7473 2c20 6e75 6d62 6572  contacts, number
+00050c50: 733d 4661 6c73 6529 2c0d 0a20 2020 2020  s=False),..     
+00050c60: 2020 2020 2020 2029 2c20 636f 6e66 2e54         ), conf.T
+00050c70: 6974 6c65 2c20 7778 2e49 434f 4e5f 5741  itle, wx.ICON_WA
+00050c80: 524e 494e 4720 7c20 7778 2e4f 4b20 7c20  RNING | wx.OK | 
+00050c90: 7778 2e43 414e 4345 4c0d 0a20 2020 2020  wx.CANCEL..     
+00050ca0: 2020 2029 3a20 7265 7475 726e 0d0a 0d0a     ): return....
+00050cb0: 2020 2020 2020 2020 5441 424c 4553 203d          TABLES =
+00050cc0: 205b 2241 6c65 7274 7322 2c20 2243 616c   ["Alerts", "Cal
+00050cd0: 6c4d 656d 6265 7273 222c 2022 4361 6c6c  lMembers", "Call
+00050ce0: 7322 2c20 2243 6861 744d 656d 6265 7273  s", "ChatMembers
+00050cf0: 222c 2022 4368 6174 7322 2c20 2243 6f6e  ", "Chats", "Con
+00050d00: 7461 6374 7322 2c0d 0a20 2020 2020 2020  tacts",..       
+00050d10: 2020 2020 2020 2020 2020 2022 436f 6e74             "Cont
+00050d20: 6163 7447 726f 7570 7322 2c20 2243 6f6e  actGroups", "Con
+00050d30: 7665 7273 6174 696f 6e73 222c 2022 4d65  versations", "Me
+00050d40: 6469 6144 6f63 756d 656e 7473 222c 2022  diaDocuments", "
+00050d50: 4d65 7373 6167 6541 6e6e 6f74 6174 696f  MessageAnnotatio
+00050d60: 6e73 222c 0d0a 2020 2020 2020 2020 2020  ns",..          
+00050d70: 2020 2020 2020 2020 224d 6573 7361 6765          "Message
+00050d80: 7322 2c20 2250 6172 7469 6369 7061 6e74  s", "Participant
+00050d90: 7322 2c20 2254 7261 6e73 6665 7273 222c  s", "Transfers",
+00050da0: 2022 5669 6465 6f4d 6573 7361 6765 7322   "VideoMessages"
+00050db0: 2c20 2256 6964 656f 7322 2c0d 0a20 2020  , "Videos",..   
+00050dc0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00050dd0: 566f 6963 656d 6169 6c73 225d 0d0a 2020  Voicemails"]..  
+00050de0: 2020 2020 2020 6f70 656e 6564 732c 2063        openeds, c
+00050df0: 6861 6e67 6564 7320 3d20 5b5d 2c20 5b5d  hangeds = [], []
+00050e00: 0d0a 2020 2020 2020 2020 666f 7220 7420  ..        for t 
+00050e10: 696e 2054 4142 4c45 533a 0d0a 2020 2020  in TABLES:..    
+00050e20: 2020 2020 2020 2020 6966 2074 2e6c 6f77          if t.low
+00050e30: 6572 2829 2069 6e20 7365 6c66 2e64 625f  er() in self.db_
+00050e40: 6772 6964 733a 0d0a 2020 2020 2020 2020  grids:..        
+00050e50: 2020 2020 2020 2020 6f70 656e 6564 732e          openeds.
+00050e60: 6170 7065 6e64 2874 290d 0a20 2020 2020  append(t)..     
+00050e70: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+00050e80: 6c66 2e64 625f 6772 6964 735b 742e 6c6f  lf.db_grids[t.lo
+00050e90: 7765 7228 295d 2e49 7343 6861 6e67 6564  wer()].IsChanged
+00050ea0: 2829 3a20 6368 616e 6765 6473 2e61 7070  (): changeds.app
+00050eb0: 656e 6428 7429 0d0a 0d0a 2020 2020 2020  end(t)....      
+00050ec0: 2020 6966 2063 6861 6e67 6564 7320 616e    if changeds an
+00050ed0: 6420 7778 2e4f 4b20 213d 2077 782e 4d65  d wx.OK != wx.Me
+00050ee0: 7373 6167 6542 6f78 2822 5468 6572 6520  ssageBox("There 
+00050ef0: 6172 6520 756e 7361 7665 6420 6368 616e  are unsaved chan
+00050f00: 6765 7320 220d 0a20 2020 2020 2020 2020  ges "..         
+00050f10: 2020 2022 696e 206f 7065 6e20 6461 7461     "in open data
+00050f20: 2067 7269 6473 2066 6f72 2074 6865 2066   grids for the f
+00050f30: 6f6c 6c6f 7769 6e67 2074 6162 6c65 733a  ollowing tables:
+00050f40: 5c6e 2020 2573 5c6e 5c6e 220d 0a20 2020  \n  %s\n\n"..   
+00050f50: 2020 2020 2020 2020 2022 4469 7363 6172           "Discar
+00050f60: 6420 6368 616e 6765 7320 616e 6420 636f  d changes and co
+00050f70: 6e74 696e 7565 3f22 2025 2022 5c6e 2020  ntinue?" % "\n  
+00050f80: 222e 6a6f 696e 2863 6861 6e67 6564 7329  ".join(changeds)
+00050f90: 2c0d 0a20 2020 2020 2020 2020 2020 2063  ,..            c
+00050fa0: 6f6e 662e 5469 746c 652c 2077 782e 4943  onf.Title, wx.IC
+00050fb0: 4f4e 5f57 4152 4e49 4e47 207c 2077 782e  ON_WARNING | wx.
+00050fc0: 4f4b 207c 2077 782e 4341 4e43 454c 293a  OK | wx.CANCEL):
+00050fd0: 2072 6574 7572 6e0d 0a0d 0a20 2020 2020   return....     
+00050fe0: 2020 2023 2043 6c6f 7365 2071 7565 7279     # Close query
+00050ff0: 2063 7572 736f 7273 2c20 6469 7363 6172   cursors, discar
+00051000: 6420 7461 626c 6520 6772 6964 7320 6375  d table grids cu
+00051010: 7272 656e 746c 7920 6e6f 7420 7669 7369  rrently not visi
+00051020: 626c 650d 0a20 2020 2020 2020 2069 6620  ble..        if 
+00051030: 7365 6c66 2e67 7269 645f 7371 6c2e 5461  self.grid_sql.Ta
+00051040: 626c 653a 2073 656c 662e 6772 6964 5f73  ble: self.grid_s
+00051050: 716c 2e54 6162 6c65 2e43 6c6f 7365 2829  ql.Table.Close()
+00051060: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
+00051070: 662e 6772 6964 5f74 6162 6c65 2e54 6162  f.grid_table.Tab
+00051080: 6c65 2061 6e64 2073 656c 662e 6772 6964  le and self.grid
+00051090: 5f74 6162 6c65 2e54 6162 6c65 2e49 7343  _table.Table.IsC
+000510a0: 6861 6e67 6564 2829 3a0d 0a20 2020 2020  hanged():..     
+000510b0: 2020 2020 2020 2073 656c 662e 6772 6964         self.grid
+000510c0: 5f74 6162 6c65 2e54 6162 6c65 2e55 6e64  _table.Table.Und
+000510d0: 6f43 6861 6e67 6573 2829 0d0a 2020 2020  oChanges()..    
+000510e0: 2020 2020 666f 7220 7420 696e 206f 7065      for t in ope
+000510f0: 6e65 6473 3a0d 0a20 2020 2020 2020 2020  neds:..         
+00051100: 2020 2067 7269 6420 3d20 7365 6c66 2e64     grid = self.d
+00051110: 625f 6772 6964 735b 742e 6c6f 7765 7228  b_grids[t.lower(
+00051120: 295d 0d0a 2020 2020 2020 2020 2020 2020  )]..            
+00051130: 6772 6964 2e43 6c6f 7365 2829 0d0a 2020  grid.Close()..  
+00051140: 2020 2020 2020 2020 2020 6966 2067 7269            if gri
+00051150: 6420 6973 206e 6f74 2073 656c 662e 6772  d is not self.gr
+00051160: 6964 5f74 6162 6c65 2e54 6162 6c65 3a20  id_table.Table: 
+00051170: 7365 6c66 2e64 625f 6772 6964 732e 706f  self.db_grids.po
+00051180: 7028 742e 6c6f 7765 7228 2929 0d0a 2020  p(t.lower())..  
+00051190: 2020 2020 2020 7365 6c66 2e75 7064 6174        self.updat
+000511a0: 655f 7461 6268 6561 6465 7228 290d 0a0d  e_tabheader()...
+000511b0: 0a20 2020 2020 2020 2063 6861 746d 6170  .        chatmap
+000511c0: 203d 207b 785b 2269 6422 5d3a 2078 2066   = {x["id"]: x f
+000511d0: 6f72 2078 2069 6e20 7365 6c66 2e63 6861  or x in self.cha
+000511e0: 7473 7d0d 0a20 2020 2020 2020 2063 6861  ts}..        cha
+000511f0: 7473 203d 207b 785b 2269 6422 5d3a 2063  ts = {x["id"]: c
+00051200: 6861 746d 6170 5b78 5b22 6964 225d 5d20  hatmap[x["id"]] 
+00051210: 666f 7220 6320 696e 2063 6f6e 7461 6374  for c in contact
+00051220: 730d 0a20 2020 2020 2020 2020 2020 2020  s..             
+00051230: 2020 2020 666f 7220 7820 696e 2063 2e67      for x in c.g
+00051240: 6574 2822 636f 6e76 6572 7361 7469 6f6e  et("conversation
+00051250: 7322 2920 6f72 205b 5d20 6966 2078 5b22  s") or [] if x["
+00051260: 6964 225d 2069 6e20 6368 6174 6d61 707d  id"] in chatmap}
+00051270: 0d0a 2020 2020 2020 2020 6d75 6c74 6963  ..        multic
+00051280: 6861 7473 2020 3d20 5b78 2066 6f72 2078  hats  = [x for x
+00051290: 2069 6e20 6368 6174 732e 7661 6c75 6573   in chats.values
+000512a0: 2829 2069 6620 736b 7970 6564 6174 612e  () if skypedata.
+000512b0: 4348 4154 535f 5459 5045 5f53 494e 474c  CHATS_TYPE_SINGL
+000512c0: 4520 213d 2078 5b22 7479 7065 225d 5d0d  E != x["type"]].
+000512d0: 0a20 2020 2020 2020 2073 696e 676c 6563  .        singlec
+000512e0: 6861 7473 203d 205b 7820 666f 7220 7820  hats = [x for x 
+000512f0: 696e 2063 6861 7473 2e76 616c 7565 7328  in chats.values(
+00051300: 2920 6966 2073 6b79 7065 6461 7461 2e43  ) if skypedata.C
+00051310: 4841 5453 5f54 5950 455f 5349 4e47 4c45  HATS_TYPE_SINGLE
+00051320: 203d 3d20 785b 2274 7970 6522 5d5d 0d0a   == x["type"]]..
+00051330: 2020 2020 2020 2020 6c6f 6767 6572 2e69          logger.i
+00051340: 6e66 6f28 2243 433a 2025 7322 2c20 5b28  nfo("CC: %s", [(
+00051350: 785b 2269 6422 5d2c 2078 5b22 7469 746c  x["id"], x["titl
+00051360: 6522 5d29 2066 6f72 2078 2069 6e20 6368  e"]) for x in ch
+00051370: 6174 732e 7661 6c75 6573 2829 5d29 0d0a  ats.values()])..
+00051380: 0d0a 2020 2020 2020 2020 6275 7379 203d  ..        busy =
+00051390: 2063 6f6e 7472 6f6c 732e 4275 7379 5061   controls.BusyPa
+000513a0: 6e65 6c28 7365 6c66 2c20 2244 656c 6574  nel(self, "Delet
+000513b0: 696e 672e 2e22 290d 0a20 2020 2020 2020  ing..")..       
+000513c0: 2074 7279 3a0d 0a20 2020 2020 2020 2020   try:..         
+000513d0: 2020 2069 6620 7365 6c66 2e63 6861 7420     if self.chat 
+000513e0: 616e 6420 7365 6c66 2e63 6861 745b 2269  and self.chat["i
+000513f0: 6422 5d20 696e 2063 6861 7473 3a0d 0a20  d"] in chats:.. 
+00051400: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00051410: 656c 662e 636c 6f73 655f 6368 6174 2829  elf.close_chat()
+00051420: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+00051430: 7265 7375 6c74 203d 2073 656c 662e 6462  result = self.db
+00051440: 2e64 656c 6574 655f 6461 7461 2873 696e  .delete_data(sin
+00051450: 676c 6563 6861 7473 2c20 636f 6e74 6163  glechats, contac
+00051460: 7473 290d 0a20 2020 2020 2020 2020 2020  ts)..           
+00051470: 2062 7573 792e 436c 6f73 6528 290d 0a20   busy.Close().. 
+00051480: 2020 2020 2020 2020 2020 2062 7573 7920             busy 
+00051490: 3d20 636f 6e74 726f 6c73 2e42 7573 7950  = controls.BusyP
+000514a0: 616e 656c 2873 656c 662c 2022 5265 6672  anel(self, "Refr
+000514b0: 6573 6869 6e67 2e2e 2229 0d0a 0d0a 2020  eshing..")....  
+000514c0: 2020 2020 2020 2020 2020 6964 7873 203d            idxs =
+000514d0: 205b 6920 666f 7220 6920 696e 2072 616e   [i for i in ran
+000514e0: 6765 2873 656c 662e 6c69 7374 5f63 6861  ge(self.list_cha
+000514f0: 7473 2e47 6574 4974 656d 436f 756e 7428  ts.GetItemCount(
+00051500: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
+00051510: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00051520: 6c69 7374 5f63 6861 7473 2e47 6574 4974  list_chats.GetIt
+00051530: 656d 4d61 7070 6564 4461 7461 2869 2920  emMappedData(i) 
+00051540: 696e 2073 696e 676c 6563 6861 7473 5d0d  in singlechats].
+00051550: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+00051560: 2069 6478 2069 6e20 6964 7873 5b3a 3a2d   idx in idxs[::-
+00051570: 315d 3a20 7365 6c66 2e6c 6973 745f 6368  1]: self.list_ch
+00051580: 6174 732e 4465 6c65 7465 4974 656d 2869  ats.DeleteItem(i
+00051590: 6478 290d 0a20 2020 2020 2020 2020 2020  dx)..           
+000515a0: 2073 656c 662e 6368 6174 7320 3d20 5b63   self.chats = [c
+000515b0: 2066 6f72 2063 2069 6e20 7365 6c66 2e63   for c in self.c
+000515c0: 6861 7473 2069 6620 6320 6e6f 7420 696e  hats if c not in
+000515d0: 2073 696e 676c 6563 6861 7473 5d0d 0a0d   singlechats]...
+000515e0: 0a20 2020 2020 2020 2020 2020 2069 6478  .            idx
+000515f0: 7320 3d20 5b69 2066 6f72 2069 2069 6e20  s = [i for i in 
+00051600: 7261 6e67 6528 7365 6c66 2e6c 6973 745f  range(self.list_
+00051610: 636f 6e74 6163 7473 2e47 6574 4974 656d  contacts.GetItem
+00051620: 436f 756e 7428 2929 0d0a 2020 2020 2020  Count())..      
+00051630: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00051640: 2073 656c 662e 6c69 7374 5f63 6f6e 7461   self.list_conta
+00051650: 6374 732e 4765 7449 7465 6d4d 6170 7065  cts.GetItemMappe
+00051660: 6444 6174 6128 6929 2069 6e20 636f 6e74  dData(i) in cont
+00051670: 6163 7473 5d0d 0a20 2020 2020 2020 2020  acts]..         
+00051680: 2020 2066 6f72 2069 6478 2069 6e20 6964     for idx in id
+00051690: 7873 5b3a 3a2d 315d 3a20 7365 6c66 2e6c  xs[::-1]: self.l
+000516a0: 6973 745f 636f 6e74 6163 7473 2e44 656c  ist_contacts.Del
+000516b0: 6574 6549 7465 6d28 6964 7829 0d0a 2020  eteItem(idx)..  
+000516c0: 2020 2020 2020 2020 2020 7365 6c66 2e63            self.c
+000516d0: 6f6e 7461 6374 7320 3d20 5b63 2066 6f72  ontacts = [c for
+000516e0: 2063 2069 6e20 7365 6c66 2e63 6f6e 7461   c in self.conta
+000516f0: 6374 7320 6966 2063 206e 6f74 2069 6e20  cts if c not in 
+00051700: 636f 6e74 6163 7473 5d0d 0a0d 0a20 2020  contacts]....   
+00051710: 2020 2020 2020 2020 2069 6620 6d75 6c74           if mult
+00051720: 6963 6861 7473 3a0d 0a20 2020 2020 2020  ichats:..       
+00051730: 2020 2020 2020 2020 2069 6465 6e74 6974           identit
+00051740: 6965 7320 3d20 5b78 5b22 6964 656e 7469  ies = [x["identi
+00051750: 7479 225d 2066 6f72 2078 2069 6e20 636f  ty"] for x in co
+00051760: 6e74 6163 7473 5d0d 0a20 2020 2020 2020  ntacts]..       
+00051770: 2020 2020 2020 2020 2066 6f72 2063 6861           for cha
+00051780: 7420 696e 206d 756c 7469 6368 6174 733a  t in multichats:
+00051790: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000517a0: 2020 2020 2020 6368 6174 5b22 7061 7274        chat["part
+000517b0: 6963 6970 616e 7473 225d 203d 205b 7820  icipants"] = [x 
+000517c0: 666f 7220 7820 696e 2063 6861 745b 2270  for x in chat["p
+000517d0: 6172 7469 6369 7061 6e74 7322 5d0d 0a20  articipants"].. 
+000517e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000517f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051800: 2020 2020 2020 2020 2020 2069 6620 785b             if x[
+00051810: 2269 6465 6e74 6974 7922 5d20 6e6f 7420  "identity"] not 
+00051820: 696e 2069 6465 6e74 6974 6965 735d 0d0a  in identities]..
+00051830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051840: 2020 2020 7065 6f70 6c65 203d 2073 6f72      people = sor
+00051850: 7465 6428 5b70 5b22 6964 656e 7469 7479  ted([p["identity
+00051860: 225d 2066 6f72 2070 2069 6e20 6368 6174  "] for p in chat
+00051870: 5b22 7061 7274 6963 6970 616e 7473 225d  ["participants"]
+00051880: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
+00051890: 2020 2020 2020 2020 6368 6174 5b22 7065          chat["pe
+000518a0: 6f70 6c65 225d 203d 2022 2573 2028 2573  ople"] = "%s (%s
+000518b0: 2922 2025 2028 6c65 6e28 7065 6f70 6c65  )" % (len(people
+000518c0: 292c 2022 2c20 222e 6a6f 696e 2870 656f  ), ", ".join(peo
+000518d0: 706c 6529 290d 0a20 2020 2020 2020 2020  ple))..         
+000518e0: 2020 2020 2020 2073 656c 662e 6462 2e67         self.db.g
+000518f0: 6574 5f63 6f6e 7665 7273 6174 696f 6e73  et_conversations
+00051900: 5f73 7461 7473 286d 756c 7469 6368 6174  _stats(multichat
+00051910: 7329 0d0a 2020 2020 2020 2020 2020 2020  s)..            
+00051920: 2020 2020 7365 6c66 2e6c 6973 745f 6368      self.list_ch
+00051930: 6174 732e 5265 6672 6573 6852 6f77 7328  ats.RefreshRows(
+00051940: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
+00051950: 2063 6f6e 7461 6374 735f 6166 6665 6374   contacts_affect
+00051960: 6564 203d 205b 6320 666f 7220 6320 696e  ed = [c for c in
+00051970: 205b 7365 6c66 2e64 622e 6163 636f 756e   [self.db.accoun
+00051980: 745d 202b 2073 656c 662e 636f 6e74 6163  t] + self.contac
+00051990: 7473 2069 6620 616e 7928 0d0a 2020 2020  ts if any(..    
+000519a0: 2020 2020 2020 2020 2020 2020 785b 2269              x["i
+000519b0: 6422 5d20 696e 205b 795b 2269 6422 5d20  d"] in [y["id"] 
+000519c0: 666f 7220 7920 696e 206d 756c 7469 6368  for y in multich
+000519d0: 6174 735d 2066 6f72 2078 2069 6e20 632e  ats] for x in c.
+000519e0: 6765 7428 2263 6f6e 7665 7273 6174 696f  get("conversatio
+000519f0: 6e73 2229 206f 7220 5b5d 0d0a 2020 2020  ns") or []..    
+00051a00: 2020 2020 2020 2020 295d 0d0a 2020 2020          )]..    
+00051a10: 2020 2020 2020 2020 7365 6c66 2e64 622e          self.db.
+00051a20: 6765 745f 636f 6e74 6163 7473 5f73 7461  get_contacts_sta
+00051a30: 7473 2863 6f6e 7461 6374 735f 6166 6665  ts(contacts_affe
+00051a40: 6374 6564 2c20 7365 6c66 2e63 6861 7473  cted, self.chats
+00051a50: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
+00051a60: 656c 662e 6c69 7374 5f63 6f6e 7461 6374  elf.list_contact
+00051a70: 732e 5265 6672 6573 6852 6f77 7328 290d  s.RefreshRows().
+00051a80: 0a0d 0a20 2020 2020 2020 2020 2020 206c  ...            l
+00051a90: 626c 203d 2022 4126 6c6c 2063 6861 7420  bl = "A&ll chat 
+00051aa0: 656e 7472 6965 7320 696e 2064 6174 6162  entries in datab
+00051ab0: 6173 6520 2825 7329 3a22 2025 2073 656c  ase (%s):" % sel
+00051ac0: 662e 6c69 7374 5f63 6861 7473 2e49 7465  f.list_chats.Ite
+00051ad0: 6d43 6f75 6e74 0d0a 2020 2020 2020 2020  mCount..        
+00051ae0: 2020 2020 7365 6c66 2e6c 6162 656c 5f6c      self.label_l
+00051af0: 6973 745f 6368 6174 732e 4c61 6265 6c20  ist_chats.Label 
+00051b00: 3d20 6c62 6c0d 0a20 2020 2020 2020 2020  = lbl..         
+00051b10: 2020 206c 626c 203d 2022 4126 6c6c 2070     lbl = "A&ll p
+00051b20: 726f 6669 6c65 7320 696e 2064 6174 6162  rofiles in datab
+00051b30: 6173 6520 2825 7329 3a22 2025 2073 656c  ase (%s):" % sel
+00051b40: 662e 6c69 7374 5f63 6f6e 7461 6374 732e  f.list_contacts.
+00051b50: 4974 656d 436f 756e 740d 0a20 2020 2020  ItemCount..     
+00051b60: 2020 2020 2020 2073 656c 662e 6c61 6265         self.labe
+00051b70: 6c5f 6c69 7374 5f63 6f6e 7461 6374 732e  l_list_contacts.
+00051b80: 4c61 6265 6c20 3d20 6c62 6c0d 0a0d 0a20  Label = lbl.... 
+00051b90: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00051ba0: 6c6f 6164 5f63 6f6e 7461 6374 284e 6f6e  load_contact(Non
+00051bb0: 6520 6966 2073 656c 662e 636f 6e74 6163  e if self.contac
+00051bc0: 7420 696e 2063 6f6e 7461 6374 7320 656c  t in contacts el
+00051bd0: 7365 2073 656c 662e 636f 6e74 6163 7429  se self.contact)
+00051be0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00051bf0: 6c66 2e6f 6e5f 7265 6672 6573 685f 7461  lf.on_refresh_ta
+00051c00: 626c 6573 2829 0d0a 2020 2020 2020 2020  bles()..        
+00051c10: 2020 2020 7778 2e43 616c 6c41 6674 6572      wx.CallAfter
+00051c20: 2873 656c 662e 7570 6461 7465 5f69 6e66  (self.update_inf
+00051c30: 6f5f 7061 6765 290d 0a20 2020 2020 2020  o_page)..       
+00051c40: 2020 2020 2077 782e 4361 6c6c 4166 7465       wx.CallAfte
+00051c50: 7228 7365 6c66 2e54 6f70 4c65 7665 6c50  r(self.TopLevelP
+00051c60: 6172 656e 742e 7570 6461 7465 5f64 6174  arent.update_dat
+00051c70: 6162 6173 655f 6465 7461 696c 290d 0a20  abase_detail).. 
+00051c80: 2020 2020 2020 2020 2020 2062 7573 792e             busy.
+00051c90: 436c 6f73 6528 290d 0a0d 0a20 2020 2020  Close()....     
+00051ca0: 2020 2020 2020 204d 4149 4e53 203d 205b         MAINS = [
+00051cb0: 2243 6f6e 7461 6374 7322 2c20 2243 6f6e  "Contacts", "Con
+00051cc0: 7665 7273 6174 696f 6e73 222c 2022 4d65  versations", "Me
+00051cd0: 7373 6167 6573 225d 0d0a 2020 2020 2020  ssages"]..      
+00051ce0: 2020 2020 2020 696e 666f 7465 7874 203d        infotext =
+00051cf0: 2022 2061 6e64 2022 2e6a 6f69 6e28 7574   " and ".join(ut
+00051d00: 696c 2e70 6c75 7261 6c28 742e 6c6f 7765  il.plural(t.lowe
+00051d10: 7228 295b 3a2d 315d 2c20 7265 7375 6c74  r()[:-1], result
+00051d20: 5b74 5d29 0d0a 2020 2020 2020 2020 2020  [t])..          
+00051d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051d40: 2020 2020 2020 2020 2020 666f 7220 7420            for t 
+00051d50: 696e 204d 4149 4e53 2069 6620 7265 7375  in MAINS if resu
+00051d60: 6c74 2e67 6574 2874 2929 0d0a 2020 2020  lt.get(t))..    
+00051d70: 2020 2020 2020 2020 6f74 6865 7263 6f75          othercou
+00051d80: 6e74 203d 2073 756d 2872 6573 756c 745b  nt = sum(result[
+00051d90: 745d 2066 6f72 2074 2069 6e20 7265 7375  t] for t in resu
+00051da0: 6c74 2069 6620 7420 6e6f 7420 696e 204d  lt if t not in M
+00051db0: 4149 4e53 290d 0a20 2020 2020 2020 2020  AINS)..         
+00051dc0: 2020 2069 6620 6f74 6865 7263 6f75 6e74     if othercount
+00051dd0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00051de0: 2020 2069 6e66 6f74 6578 7420 2b3d 2022     infotext += "
+00051df0: 2028 616e 6420 2573 2922 2025 2075 7469   (and %s)" % uti
+00051e00: 6c2e 706c 7572 616c 2822 7265 6c61 7465  l.plural("relate
+00051e10: 6420 726f 7722 2c20 6f74 6865 7263 6f75  d row", othercou
+00051e20: 6e74 290d 0a20 2020 2020 2020 2020 2020  nt)..           
+00051e30: 2067 7569 6261 7365 2e73 7461 7475 7328   guibase.status(
+00051e40: 2244 656c 6574 6564 2025 7320 6672 6f6d  "Deleted %s from
+00051e50: 2025 732e 222c 2069 6e66 6f74 6578 742c   %s.", infotext,
+00051e60: 2073 656c 662e 6462 2c20 6c6f 673d 5472   self.db, log=Tr
+00051e70: 7565 290d 0a20 2020 2020 2020 2020 2020  ue)..           
+00051e80: 2077 782e 4d65 7373 6167 6542 6f78 2822   wx.MessageBox("
+00051e90: 4465 6c65 7465 6420 2573 2e22 2025 2069  Deleted %s." % i
+00051ea0: 6e66 6f74 6578 742c 2063 6f6e 662e 5469  nfotext, conf.Ti
+00051eb0: 746c 652c 2077 782e 4943 4f4e 5f49 4e46  tle, wx.ICON_INF
+00051ec0: 4f52 4d41 5449 4f4e 290d 0a20 2020 2020  ORMATION)..     
+00051ed0: 2020 2066 696e 616c 6c79 3a20 6275 7379     finally: busy
+00051ee0: 2e43 6c6f 7365 2829 0d0a 0d0a 0d0a 2020  .Close()......  
+00051ef0: 2020 6465 6620 6f6e 5f73 6f72 745f 6772    def on_sort_gr
+00051f00: 6964 5f63 6f6c 756d 6e28 7365 6c66 2c20  id_column(self, 
+00051f10: 6576 656e 7429 3a0d 0a20 2020 2020 2020  event):..       
+00051f20: 2022 2222 0d0a 2020 2020 2020 2020 4861   """..        Ha
+00051f30: 6e64 6c65 7220 666f 7220 636c 6963 6b69  ndler for clicki
+00051f40: 6e67 2061 2074 6162 6c65 2067 7269 6420  ng a table grid 
+00051f50: 636f 6c75 6d6e 2c20 736f 7274 7320 7461  column, sorts ta
+00051f60: 626c 6520 6279 2074 6865 2063 6f6c 756d  ble by the colum
+00051f70: 6e2e 0d0a 2020 2020 2020 2020 2222 220d  n...        """.
+00051f80: 0a20 2020 2020 2020 2067 7269 6420 3d20  .        grid = 
+00051f90: 6576 656e 742e 4765 7445 7665 6e74 4f62  event.GetEventOb
+00051fa0: 6a65 6374 2829 0d0a 2020 2020 2020 2020  ject()..        
+00051fb0: 6966 2067 7269 642e 5461 626c 6520 616e  if grid.Table an
+00051fc0: 6420 6973 696e 7374 616e 6365 2867 7269  d isinstance(gri
+00051fd0: 642e 5461 626c 652c 2053 716c 6974 6547  d.Table, SqliteG
+00051fe0: 7269 6442 6173 6529 3a0d 0a20 2020 2020  ridBase):..     
+00051ff0: 2020 2020 2020 2072 6f77 2c20 636f 6c20         row, col 
+00052000: 3d20 6576 656e 742e 4765 7452 6f77 2829  = event.GetRow()
+00052010: 2c20 6576 656e 742e 4765 7443 6f6c 2829  , event.GetCol()
+00052020: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00052030: 5265 6d65 6d62 6572 2073 6372 6f6c 6c20  Remember scroll 
+00052040: 706f 7369 7469 6f6e 732c 2061 7320 6772  positions, as gr
+00052050: 6964 2075 7064 6174 6520 6c6f 7365 7320  id update loses 
+00052060: 7468 656d 0d0a 2020 2020 2020 2020 2020  them..          
+00052070: 2020 7363 726f 6c6c 5f68 6f72 203d 2067    scroll_hor = g
+00052080: 7269 642e 4765 7453 6372 6f6c 6c50 6f73  rid.GetScrollPos
+00052090: 2877 782e 484f 5249 5a4f 4e54 414c 290d  (wx.HORIZONTAL).
+000520a0: 0a20 2020 2020 2020 2020 2020 2073 6372  .            scr
+000520b0: 6f6c 6c5f 7665 7220 3d20 6772 6964 2e47  oll_ver = grid.G
+000520c0: 6574 5363 726f 6c6c 506f 7328 7778 2e56  etScrollPos(wx.V
+000520d0: 4552 5449 4341 4c29 0d0a 2020 2020 2020  ERTICAL)..      
+000520e0: 2020 2020 2020 6966 2072 6f77 203c 2030        if row < 0
+000520f0: 3a20 2320 4f6e 6c79 2072 6561 6374 2074  : # Only react t
+00052100: 6f20 636c 6963 6b73 2069 6e20 7468 6520  o clicks in the 
+00052110: 6865 6164 6572 0d0a 2020 2020 2020 2020  header..        
+00052120: 2020 2020 2020 2020 6772 6964 2e54 6162          grid.Tab
+00052130: 6c65 2e53 6f72 7443 6f6c 756d 6e28 636f  le.SortColumn(co
+00052140: 6c29 0d0a 2020 2020 2020 2020 2020 2020  l)..            
+00052150: 6772 6964 2e43 6f6e 7461 696e 696e 6753  grid.ContainingS
+00052160: 697a 6572 2e4c 6179 6f75 7428 2920 2320  izer.Layout() # 
+00052170: 5265 6163 7420 746f 2067 7269 6420 7369  React to grid si
+00052180: 7a65 2063 6861 6e67 650d 0a20 2020 2020  ze change..     
+00052190: 2020 2020 2020 2067 7269 642e 5363 726f         grid.Scro
+000521a0: 6c6c 2873 6372 6f6c 6c5f 686f 722c 2073  ll(scroll_hor, s
+000521b0: 6372 6f6c 6c5f 7665 7229 0d0a 0d0a 0d0a  croll_ver)......
+000521c0: 2020 2020 6465 6620 6f6e 5f66 696c 7465      def on_filte
+000521d0: 725f 6772 6964 5f63 6f6c 756d 6e28 7365  r_grid_column(se
+000521e0: 6c66 2c20 6576 656e 7429 3a0d 0a20 2020  lf, event):..   
+000521f0: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
+00052200: 2020 4861 6e64 6c65 7220 666f 7220 7269    Handler for ri
+00052210: 6768 742d 636c 6963 6b69 6e67 2061 2074  ght-clicking a t
+00052220: 6162 6c65 2067 7269 6420 636f 6c75 6d6e  able grid column
+00052230: 2c20 6c65 7473 2074 6865 2075 7365 720d  , lets the user.
+00052240: 0a20 2020 2020 2020 2063 6861 6e67 6520  .        change 
+00052250: 7468 6520 636f 6c75 6d6e 2066 696c 7465  the column filte
+00052260: 722e 0d0a 2020 2020 2020 2020 2222 220d  r...        """.
+00052270: 0a20 2020 2020 2020 2067 7269 6420 3d20  .        grid = 
+00052280: 6576 656e 742e 4765 7445 7665 6e74 4f62  event.GetEventOb
+00052290: 6a65 6374 2829 0d0a 2020 2020 2020 2020  ject()..        
+000522a0: 6966 2067 7269 642e 5461 626c 6520 616e  if grid.Table an
+000522b0: 6420 6973 696e 7374 616e 6365 2867 7269  d isinstance(gri
+000522c0: 642e 5461 626c 652c 2053 716c 6974 6547  d.Table, SqliteG
+000522d0: 7269 6442 6173 6529 3a0d 0a20 2020 2020  ridBase):..     
+000522e0: 2020 2020 2020 2072 6f77 2c20 636f 6c20         row, col 
+000522f0: 3d20 6576 656e 742e 4765 7452 6f77 2829  = event.GetRow()
+00052300: 2c20 6576 656e 742e 4765 7443 6f6c 2829  , event.GetCol()
+00052310: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00052320: 5265 6d65 6d62 6572 2073 6372 6f6c 6c20  Remember scroll 
+00052330: 706f 7369 7469 6f6e 732c 2061 7320 6772  positions, as gr
+00052340: 6964 2075 7064 6174 6520 6c6f 7365 7320  id update loses 
+00052350: 7468 656d 0d0a 2020 2020 2020 2020 2020  them..          
+00052360: 2020 6966 2072 6f77 203c 2030 3a20 2320    if row < 0: # 
+00052370: 4f6e 6c79 2072 6561 6374 2074 6f20 636c  Only react to cl
+00052380: 6963 6b73 2069 6e20 7468 6520 6865 6164  icks in the head
+00052390: 6572 0d0a 2020 2020 2020 2020 2020 2020  er..            
+000523a0: 2020 2020 6772 6964 5f64 6174 6120 3d20      grid_data = 
+000523b0: 6772 6964 2e54 6162 6c65 0d0a 2020 2020  grid.Table..    
+000523c0: 2020 2020 2020 2020 2020 2020 6375 7272              curr
+000523d0: 656e 745f 6669 6c74 6572 203d 2075 7469  ent_filter = uti
+000523e0: 6c2e 746f 5f75 6e69 636f 6465 2867 7269  l.to_unicode(gri
+000523f0: 645f 6461 7461 2e66 696c 7465 7273 5b63  d_data.filters[c
+00052400: 6f6c 5d29 205c 0d0a 2020 2020 2020 2020  ol]) \..        
+00052410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052420: 2020 2020 2020 2020 2069 6620 636f 6c20           if col 
+00052430: 696e 2067 7269 645f 6461 7461 2e66 696c  in grid_data.fil
+00052440: 7465 7273 2065 6c73 6520 2222 0d0a 2020  ters else ""..  
+00052450: 2020 2020 2020 2020 2020 2020 2020 6469                di
+00052460: 616c 6f67 203d 2077 782e 5465 7874 456e  alog = wx.TextEn
+00052470: 7472 7944 6961 6c6f 6728 7365 6c66 2c0d  tryDialog(self,.
+00052480: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00052490: 2020 2020 2022 4669 6c74 6572 2063 6f6c       "Filter col
+000524a0: 756d 6e20 5c22 2573 5c22 2062 793a 2220  umn \"%s\" by:" 
+000524b0: 2520 6772 6964 5f64 6174 612e 636f 6c75  % grid_data.colu
+000524c0: 6d6e 735b 636f 6c5d 5b22 6e61 6d65 225d  mns[col]["name"]
+000524d0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+000524e0: 2020 2020 2020 2022 4669 6c74 6572 222c         "Filter",
+000524f0: 2076 616c 7565 3d63 7572 7265 6e74 5f66   value=current_f
+00052500: 696c 7465 722c 0d0a 2020 2020 2020 2020  ilter,..        
+00052510: 2020 2020 2020 2020 2020 2020 7374 796c              styl
+00052520: 653d 7778 2e4f 4b20 7c20 7778 2e43 414e  e=wx.OK | wx.CAN
+00052530: 4345 4c29 0d0a 2020 2020 2020 2020 2020  CEL)..          
+00052540: 2020 2020 2020 6966 2077 782e 4944 5f4f        if wx.ID_O
+00052550: 4b20 3d3d 2064 6961 6c6f 672e 5368 6f77  K == dialog.Show
+00052560: 4d6f 6461 6c28 293a 0d0a 2020 2020 2020  Modal():..      
+00052570: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+00052580: 775f 6669 6c74 6572 203d 2064 6961 6c6f  w_filter = dialo
+00052590: 672e 4765 7456 616c 7565 2829 0d0a 2020  g.GetValue()..  
+000525a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000525b0: 2020 6966 206c 656e 286e 6577 5f66 696c    if len(new_fil
+000525c0: 7465 7229 3a0d 0a20 2020 2020 2020 2020  ter):..         
+000525d0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+000525e0: 7573 7920 3d20 636f 6e74 726f 6c73 2e42  usy = controls.B
+000525f0: 7573 7950 616e 656c 2873 656c 662e 7061  usyPanel(self.pa
+00052600: 6765 5f74 6162 6c65 732c 0d0a 2020 2020  ge_tables,..    
+00052610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052620: 2020 2020 2020 2020 2246 696c 7465 7269          "Filteri
+00052630: 6e67 2063 6f6c 756d 6e20 5c22 2573 5c22  ng column \"%s\"
+00052640: 2062 7920 5c22 2573 5c22 2e22 2025 0d0a   by \"%s\"." %..
+00052650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052660: 2020 2020 2020 2020 2020 2020 2867 7269              (gri
+00052670: 645f 6461 7461 2e63 6f6c 756d 6e73 5b63  d_data.columns[c
+00052680: 6f6c 5d5b 226e 616d 6522 5d2c 206e 6577  ol]["name"], new
+00052690: 5f66 696c 7465 7229 290d 0a20 2020 2020  _filter))..     
+000526a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000526b0: 2020 2067 7269 645f 6461 7461 2e41 6464     grid_data.Add
+000526c0: 4669 6c74 6572 2863 6f6c 2c20 6e65 775f  Filter(col, new_
+000526d0: 6669 6c74 6572 290d 0a20 2020 2020 2020  filter)..       
+000526e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000526f0: 2062 7573 792e 436c 6f73 6528 290d 0a20   busy.Close().. 
+00052700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052710: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+00052720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052730: 2020 6772 6964 5f64 6174 612e 5265 6d6f    grid_data.Remo
+00052740: 7665 4669 6c74 6572 2863 6f6c 290d 0a20  veFilter(col).. 
+00052750: 2020 2020 2020 2020 2020 2067 7269 642e             grid.
+00052760: 436f 6e74 6169 6e69 6e67 5369 7a65 722e  ContainingSizer.
+00052770: 4c61 796f 7574 2829 2023 2052 6561 6374  Layout() # React
+00052780: 2074 6f20 6772 6964 2073 697a 6520 6368   to grid size ch
+00052790: 616e 6765 0d0a 0d0a 0d0a 2020 2020 6465  ange......    de
+000527a0: 6620 6c6f 6164 5f64 6174 6128 7365 6c66  f load_data(self
+000527b0: 293a 0d0a 2020 2020 2020 2020 2222 224c  ):..        """L
+000527c0: 6f61 6473 2064 6174 6120 6672 6f6d 206f  oads data from o
+000527d0: 7572 2053 6b79 7065 4461 7461 6261 7365  ur SkypeDatabase
+000527e0: 2e22 2222 0d0a 2020 2020 2020 2020 7365  ."""..        se
+000527f0: 6c66 2e6c 6162 656c 5f74 6974 6c65 2e4c  lf.label_title.L
+00052800: 6162 656c 203d 2022 4461 7461 6261 7365  abel = "Database
+00052810: 205c 2225 735c 223a 2220 2520 7365 6c66   \"%s\":" % self
+00052820: 2e64 620d 0a0d 0a20 2020 2020 2020 2074  .db....        t
+00052830: 7279 3a0d 0a20 2020 2020 2020 2020 2020  ry:..           
+00052840: 2023 2052 6573 746f 7265 206c 6173 7420   # Restore last 
+00052850: 7365 6172 6368 2074 6578 742c 2069 6620  search text, if 
+00052860: 616e 790d 0a20 2020 2020 2020 2020 2020  any..           
+00052870: 2069 6620 636f 6e66 2e53 6561 7263 6848   if conf.SearchH
+00052880: 6973 746f 7279 2061 6e64 2063 6f6e 662e  istory and conf.
+00052890: 5365 6172 6368 4869 7374 6f72 795b 2d31  SearchHistory[-1
+000528a0: 5d20 213d 2022 223a 0d0a 2020 2020 2020  ] != "":..      
+000528b0: 2020 2020 2020 2020 2020 7365 6c66 2e65            self.e
+000528c0: 6469 745f 7365 6172 6368 616c 6c2e 5661  dit_searchall.Va
+000528d0: 6c75 6520 3d20 636f 6e66 2e53 6561 7263  lue = conf.Searc
+000528e0: 6848 6973 746f 7279 5b2d 315d 0d0a 2020  hHistory[-1]..  
+000528f0: 2020 2020 2020 2020 2020 6966 2063 6f6e            if con
+00052900: 662e 5365 6172 6368 4869 7374 6f72 7920  f.SearchHistory 
+00052910: 616e 6420 636f 6e66 2e53 6561 7263 6848  and conf.SearchH
+00052920: 6973 746f 7279 5b2d 315d 203d 3d20 2222  istory[-1] == ""
+00052930: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00052940: 2020 2023 2043 6c65 6172 2074 6865 2065     # Clear the e
+00052950: 6d70 7479 2073 6561 7263 6820 666c 6167  mpty search flag
+00052960: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00052970: 2020 636f 6e66 2e53 6561 7263 6848 6973    conf.SearchHis
+00052980: 746f 7279 203d 2063 6f6e 662e 5365 6172  tory = conf.Sear
+00052990: 6368 4869 7374 6f72 795b 3a2d 315d 0d0a  chHistory[:-1]..
+000529a0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000529b0: 2e65 6469 745f 7365 6172 6368 616c 6c2e  .edit_searchall.
+000529c0: 5365 7443 686f 6963 6573 2863 6f6e 662e  SetChoices(conf.
+000529d0: 5365 6172 6368 4869 7374 6f72 7929 0d0a  SearchHistory)..
+000529e0: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+000529f0: 5265 7374 6f72 6520 6c61 7374 2063 6163  Restore last cac
+00052a00: 6865 6420 7365 6172 6368 2072 6573 756c  hed search resul
+00052a10: 7473 2070 6167 650d 0a20 2020 2020 2020  ts page..       
+00052a20: 2020 2020 206c 6173 745f 7365 6172 6368       last_search
+00052a30: 203d 2063 6f6e 662e 4c61 7374 5365 6172   = conf.LastSear
+00052a40: 6368 5265 7375 6c74 732e 6765 7428 7365  chResults.get(se
+00052a50: 6c66 2e64 622e 6669 6c65 6e61 6d65 290d  lf.db.filename).
+00052a60: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00052a70: 6c61 7374 5f73 6561 7263 683a 0d0a 2020  last_search:..  
+00052a80: 2020 2020 2020 2020 2020 2020 2020 7469                ti
+00052a90: 746c 6520 3d20 6c61 7374 5f73 6561 7263  tle = last_searc
+00052aa0: 682e 6765 7428 2274 6974 6c65 222c 2022  h.get("title", "
+00052ab0: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
+00052ac0: 2020 2020 6874 6d6c 203d 206c 6173 745f      html = last_
+00052ad0: 7365 6172 6368 2e67 6574 2822 636f 6e74  search.get("cont
+00052ae0: 656e 7422 2c20 2222 290d 0a20 2020 2020  ent", "")..     
+00052af0: 2020 2020 2020 2020 2020 2069 6e66 6f20             info 
+00052b00: 3d20 6c61 7374 5f73 6561 7263 682e 6765  = last_search.ge
+00052b10: 7428 2269 6e66 6f22 290d 0a20 2020 2020  t("info")..     
+00052b20: 2020 2020 2020 2020 2020 2074 6162 6964             tabid
+00052b30: 203d 2073 656c 662e 636f 756e 7465 7228   = self.counter(
+00052b40: 2920 6966 2030 2021 3d20 6c61 7374 5f73  ) if 0 != last_s
+00052b50: 6561 7263 682e 6765 7428 2269 6422 2920  earch.get("id") 
+00052b60: 656c 7365 2030 0d0a 2020 2020 2020 2020  else 0..        
+00052b70: 2020 2020 2020 2020 7365 6c66 2e68 746d          self.htm
+00052b80: 6c5f 7365 6172 6368 616c 6c2e 496e 7365  l_searchall.Inse
+00052b90: 7274 5461 6228 302c 2074 6974 6c65 2c20  rtTab(0, title, 
+00052ba0: 7461 6269 642c 2068 746d 6c2c 2069 6e66  tabid, html, inf
+00052bb0: 6f29 0d0a 0d0a 2020 2020 2020 2020 2020  o)....          
+00052bc0: 2020 2320 4869 6465 2072 656e 616d 652d    # Hide rename-
+00052bd0: 6275 7474 6f6e 2069 6620 6769 7665 6e5f  button if given_
+00052be0: 6469 7370 6c61 796e 616d 6520 6e6f 7420  displayname not 
+00052bf0: 6176 6169 6c61 626c 650d 0a20 2020 2020  available..     
+00052c00: 2020 2020 2020 2063 6861 745f 636f 6c73         chat_cols
+00052c10: 203d 2073 656c 662e 6462 2e67 6574 5f74   = self.db.get_t
+00052c20: 6162 6c65 5f63 6f6c 756d 6e73 2822 636f  able_columns("co
+00052c30: 6e76 6572 7361 7469 6f6e 7322 290d 0a20  nversations").. 
+00052c40: 2020 2020 2020 2020 2020 2063 6f6e 7461             conta
+00052c50: 6374 5f63 6f6c 7320 3d20 7365 6c66 2e64  ct_cols = self.d
+00052c60: 622e 6765 745f 7461 626c 655f 636f 6c75  b.get_table_colu
+00052c70: 6d6e 7328 2263 6f6e 7461 6374 7322 290d  mns("contacts").
+00052c80: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00052c90: 206e 6f74 2061 6e79 2878 5b22 6e61 6d65   not any(x["name
+00052ca0: 225d 203d 3d20 2267 6976 656e 5f64 6973  "] == "given_dis
+00052cb0: 706c 6179 6e61 6d65 2220 666f 7220 7820  playname" for x 
+00052cc0: 696e 2063 6861 745f 636f 6c73 2920 5c0d  in chat_cols) \.
+00052cd0: 0a20 2020 2020 2020 2020 2020 2061 6e64  .            and
+00052ce0: 206e 6f74 2061 6e79 2878 5b22 6e61 6d65   not any(x["name
+00052cf0: 225d 203d 3d20 2267 6976 656e 5f64 6973  "] == "given_dis
+00052d00: 706c 6179 6e61 6d65 2220 666f 7220 7820  playname" for x 
+00052d10: 696e 2063 6f6e 7461 6374 5f63 6f6c 7329  in contact_cols)
+00052d20: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00052d30: 2020 2073 656c 662e 6275 7474 6f6e 5f72     self.button_r
+00052d40: 656e 616d 652e 4469 7361 626c 6528 292c  ename.Disable(),
+00052d50: 2073 656c 662e 6275 7474 6f6e 5f72 656e   self.button_ren
+00052d60: 616d 652e 4869 6465 2829 0d0a 0d0a 2020  ame.Hide()....  
+00052d70: 2020 2020 2020 2020 2020 2320 506f 7075            # Popu
+00052d80: 6c61 7465 2074 6865 2063 6861 7473 206c  late the chats l
+00052d90: 6973 740d 0a20 2020 2020 2020 2020 2020  ist..           
+00052da0: 2073 656c 662e 6368 6174 7320 3d20 7365   self.chats = se
+00052db0: 6c66 2e64 622e 6765 745f 636f 6e76 6572  lf.db.get_conver
+00052dc0: 7361 7469 6f6e 7328 290d 0a20 2020 2020  sations()..     
+00052dd0: 2020 2020 2020 2073 656c 662e 6c69 7374         self.list
+00052de0: 5f63 6861 7473 2e50 6f70 756c 6174 6528  _chats.Populate(
+00052df0: 7365 6c66 2e63 6861 7473 290d 0a20 2020  self.chats)..   
+00052e00: 2020 2020 2020 2020 206c 626c 203d 2022           lbl = "
+00052e10: 4126 6c6c 2063 6861 7420 656e 7472 6965  A&ll chat entrie
+00052e20: 7320 696e 2064 6174 6162 6173 6520 2825  s in database (%
+00052e30: 7329 3a22 2025 2073 656c 662e 6c69 7374  s):" % self.list
+00052e40: 5f63 6861 7473 2e49 7465 6d43 6f75 6e74  _chats.ItemCount
+00052e50: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00052e60: 6c66 2e6c 6162 656c 5f6c 6973 745f 6368  lf.label_list_ch
+00052e70: 6174 732e 4c61 6265 6c20 3d20 6c62 6c0d  ats.Label = lbl.
+00052e80: 0a0d 0a20 2020 2020 2020 2020 2020 2023  ...            #
+00052e90: 2050 6f70 756c 6174 6520 7468 6520 636f   Populate the co
+00052ea0: 6e74 6163 7473 206c 6973 740d 0a20 2020  ntacts list..   
+00052eb0: 2020 2020 2020 2020 2073 656c 662e 636f           self.co
+00052ec0: 6e74 6163 7473 203d 2073 656c 662e 6462  ntacts = self.db
+00052ed0: 2e67 6574 5f63 6f6e 7461 6374 7328 290d  .get_contacts().
+00052ee0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00052ef0: 662e 6c69 7374 5f63 6f6e 7461 6374 732e  f.list_contacts.
+00052f00: 506f 7075 6c61 7465 285b 7365 6c66 2e64  Populate([self.d
+00052f10: 622e 6163 636f 756e 745d 202b 2073 656c  b.account] + sel
+00052f20: 662e 636f 6e74 6163 7473 290d 0a20 2020  f.contacts)..   
+00052f30: 2020 2020 2020 2020 2073 656c 662e 6c69           self.li
+00052f40: 7374 5f63 6f6e 7461 6374 732e 5365 7443  st_contacts.SetC
+00052f50: 6f6c 756d 6e57 6964 7468 2830 2c20 3135  olumnWidth(0, 15
+00052f60: 3029 0d0a 2020 2020 2020 2020 2020 2020  0)..            
+00052f70: 7365 6c66 2e6c 6973 745f 636f 6e74 6163  self.list_contac
+00052f80: 7473 2e53 6574 436f 6c75 6d6e 5769 6474  ts.SetColumnWidt
+00052f90: 6828 312c 2032 3530 290d 0a20 2020 2020  h(1, 250)..     
+00052fa0: 2020 2020 2020 206c 626c 203d 2022 4126         lbl = "A&
+00052fb0: 6c6c 2070 726f 6669 6c65 7320 696e 2064  ll profiles in d
+00052fc0: 6174 6162 6173 6520 2825 7329 3a22 2025  atabase (%s):" %
+00052fd0: 2073 656c 662e 6c69 7374 5f63 6f6e 7461   self.list_conta
+00052fe0: 6374 732e 4974 656d 436f 756e 740d 0a20  cts.ItemCount.. 
+00052ff0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00053000: 6c61 6265 6c5f 6c69 7374 5f63 6f6e 7461  label_list_conta
+00053010: 6374 732e 4c61 6265 6c20 3d20 6c62 6c0d  cts.Label = lbl.
+00053020: 0a0d 0a20 2020 2020 2020 2020 2020 2077  ...            w
+00053030: 782e 4361 6c6c 4c61 7465 7228 3130 302c  x.CallLater(100,
+00053040: 2073 656c 662e 6c6f 6164 5f6c 6174 6572   self.load_later
+00053050: 5f64 6174 6129 0d0a 2020 2020 2020 2020  _data)..        
+00053060: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
+00053070: 3a0d 0a20 2020 2020 2020 2020 2020 2077  :..            w
+00053080: 782e 4361 6c6c 4166 7465 7228 7365 6c66  x.CallAfter(self
+00053090: 2e75 7064 6174 655f 7461 6268 6561 6465  .update_tabheade
+000530a0: 7229 0d0a 2020 2020 2020 2020 2020 2020  r)..            
+000530b0: 6775 6962 6173 652e 7374 6174 7573 2822  guibase.status("
+000530c0: 436f 756c 6420 6e6f 7420 6c6f 6164 2063  Could not load c
+000530d0: 6861 7420 6c69 7374 2066 726f 6d20 2573  hat list from %s
+000530e0: 2e22 2c20 7365 6c66 2e64 6229 0d0a 2020  .", self.db)..  
+000530f0: 2020 2020 2020 2020 2020 6c6f 6767 6572            logger
+00053100: 2e65 7863 6570 7469 6f6e 2822 436f 756c  .exception("Coul
+00053110: 6420 6e6f 7420 6c6f 6164 2063 6861 7420  d not load chat 
+00053120: 6c69 7374 2066 726f 6d20 2573 2e22 2c20  list from %s.", 
+00053130: 7365 6c66 2e64 6229 0d0a 2020 2020 2020  self.db)..      
+00053140: 2020 7778 2e43 616c 6c4c 6174 6572 2835    wx.CallLater(5
+00053150: 3030 2c20 7365 6c66 2e75 7064 6174 655f  00, self.update_
+00053160: 696e 666f 5f70 6167 652c 2046 616c 7365  info_page, False
+00053170: 290d 0a20 2020 2020 2020 2077 782e 4361  )..        wx.Ca
+00053180: 6c6c 4c61 7465 7228 3230 302c 2073 656c  llLater(200, sel
+00053190: 662e 6c6f 6164 5f74 6162 6c65 735f 6461  f.load_tables_da
+000531a0: 7461 290d 0a20 2020 2020 2020 2073 656c  ta)..        sel
+000531b0: 662e 7570 6461 7465 5f6c 6976 6569 6e66  f.update_liveinf
+000531c0: 6f28 290d 0a20 2020 2020 2020 2069 6620  o()..        if 
+000531d0: 636f 6e66 2e4c 6f67 696e 2e67 6574 2873  conf.Login.get(s
+000531e0: 656c 662e 6462 2e66 696c 656e 616d 652c  elf.db.filename,
+000531f0: 207b 7d29 2e67 6574 2822 6175 746f 2229   {}).get("auto")
+00053200: 3a0d 0a20 2020 2020 2020 2020 2020 2077  :..            w
+00053210: 782e 4361 6c6c 4c61 7465 7228 3130 3030  x.CallLater(1000
+00053220: 2c20 7365 6c66 2e6f 6e5f 6c69 7665 5f6c  , self.on_live_l
+00053230: 6f67 696e 2c20 7379 6e63 3d63 6f6e 662e  ogin, sync=conf.
+00053240: 4c6f 6769 6e5b 7365 6c66 2e64 622e 6669  Login[self.db.fi
+00053250: 6c65 6e61 6d65 5d2e 6765 7428 2273 796e  lename].get("syn
+00053260: 6322 2929 0d0a 0d0a 0d0a 2020 2020 6465  c"))......    de
+00053270: 6620 6c6f 6164 5f6c 6174 6572 5f64 6174  f load_later_dat
+00053280: 6128 7365 6c66 293a 0d0a 2020 2020 2020  a(self):..      
+00053290: 2020 2222 220d 0a20 2020 2020 2020 204c    """..        L
+000532a0: 6f61 6473 206c 6174 6572 2064 6174 6120  oads later data 
+000532b0: 6672 6f6d 2074 6865 2064 6174 6162 6173  from the databas
+000532c0: 652c 206c 696b 6520 7461 626c 6520 6d65  e, like table me
+000532d0: 7461 696e 666f 726d 6174 696f 6e20 616e  tainformation an
+000532e0: 640d 0a20 2020 2020 2020 2073 7461 7469  d..        stati
+000532f0: 7374 6963 7320 666f 7220 616c 6c20 6368  stics for all ch
+00053300: 6174 732c 2075 7365 6420 6173 2061 2062  ats, used as a b
+00053310: 6163 6b67 726f 756e 6420 6361 6c6c 6261  ackground callba
+00053320: 636b 2074 6f20 7370 6565 640d 0a20 2020  ck to speed..   
+00053330: 2020 2020 2075 7020 7061 6765 206f 7065       up page ope
+00053340: 6e69 6e67 2e0d 0a20 2020 2020 2020 2022  ning...        "
+00053350: 2222 0d0a 2020 2020 2020 2020 6966 206e  ""..        if n
+00053360: 6f74 2073 656c 663a 2072 6574 7572 6e0d  ot self: return.
+00053370: 0a0d 0a20 2020 2020 2020 2074 7279 3a0d  ...        try:.
+00053380: 0a20 2020 2020 2020 2020 2020 2023 204c  .            # L
+00053390: 6f61 6420 6368 6174 2073 7461 7469 7374  oad chat statist
+000533a0: 6963 7320 616e 6420 7570 6461 7465 2074  ics and update t
+000533b0: 6865 2063 6861 7420 6c69 7374 0d0a 2020  he chat list..  
+000533c0: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
+000533d0: 622e 6765 745f 636f 6e76 6572 7361 7469  b.get_conversati
+000533e0: 6f6e 735f 7374 6174 7328 7365 6c66 2e63  ons_stats(self.c
+000533f0: 6861 7473 290d 0a20 2020 2020 2020 2020  hats)..         
+00053400: 2020 2069 6620 7365 6c66 2e63 6861 743a     if self.chat:
+00053410: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00053420: 2020 2320 4966 2074 6865 2075 7365 7220    # If the user 
+00053430: 616c 7265 6164 7920 6f70 656e 6564 2061  already opened a
+00053440: 2063 6861 7420 7768 696c 6520 6c61 7465   chat while late
+00053450: 7220 6461 7461 0d0a 2020 2020 2020 2020  r data..        
+00053460: 2020 2020 2020 2020 2320 7761 7320 6c6f          # was lo
+00053470: 6164 696e 672c 2075 7064 6174 6520 7468  ading, update th
+00053480: 6520 6461 7465 2072 616e 6765 2063 6f6e  e date range con
+00053490: 7472 6f6c 2076 616c 7565 732e 0d0a 2020  trol values...  
+000534a0: 2020 2020 2020 2020 2020 2020 2020 6461                da
+000534b0: 7465 5f72 616e 6765 203d 205b 7365 6c66  te_range = [self
+000534c0: 2e63 6861 745b 2266 6972 7374 5f6d 6573  .chat["first_mes
+000534d0: 7361 6765 5f64 6174 6574 696d 6522 5d2e  sage_datetime"].
+000534e0: 6461 7465 2829 0d0a 2020 2020 2020 2020  date()..        
+000534f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053500: 2020 2020 2020 6966 2073 656c 662e 6368        if self.ch
+00053510: 6174 5b22 6669 7273 745f 6d65 7373 6167  at["first_messag
+00053520: 655f 6461 7465 7469 6d65 225d 2065 6c73  e_datetime"] els
+00053530: 6520 4e6f 6e65 2c0d 0a20 2020 2020 2020  e None,..       
+00053540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053550: 2020 2020 2020 2073 656c 662e 6368 6174         self.chat
+00053560: 5b22 6c61 7374 5f6d 6573 7361 6765 5f64  ["last_message_d
+00053570: 6174 6574 696d 6522 5d2e 6461 7465 2829  atetime"].date()
+00053580: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00053590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000535a0: 6966 2073 656c 662e 6368 6174 5b22 6c61  if self.chat["la
+000535b0: 7374 5f6d 6573 7361 6765 5f64 6174 6574  st_message_datet
+000535c0: 696d 6522 5d20 656c 7365 204e 6f6e 6520  ime"] else None 
+000535d0: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
+000535e0: 2020 2073 656c 662e 7261 6e67 655f 6461     self.range_da
+000535f0: 7465 2e53 6574 5261 6e67 6528 2a64 6174  te.SetRange(*dat
+00053600: 655f 7261 6e67 6529 0d0a 2020 2020 2020  e_range)..      
+00053610: 2020 2020 2020 2020 2020 7365 6c66 2e65            self.e
+00053620: 6469 745f 6669 6c74 6572 6461 7465 312e  dit_filterdate1.
+00053630: 5261 6e67 6520 3d20 6461 7465 5f72 616e  Range = date_ran
+00053640: 6765 0d0a 2020 2020 2020 2020 2020 2020  ge..            
+00053650: 2020 2020 7365 6c66 2e65 6469 745f 6669      self.edit_fi
+00053660: 6c74 6572 6461 7465 322e 5261 6e67 6520  lterdate2.Range 
+00053670: 3d20 6461 7465 5f72 616e 6765 0d0a 2020  = date_range..  
+00053680: 2020 2020 2020 2020 2020 2320 4c6f 6164            # Load
+00053690: 2063 6f6e 7461 6374 2073 7461 7469 7374   contact statist
+000536a0: 6963 7320 616e 6420 7570 6461 7465 2074  ics and update t
+000536b0: 6865 2063 6f6e 7461 6374 206c 6973 740d  he contact list.
+000536c0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+000536d0: 662e 6462 2e67 6574 5f63 6f6e 7461 6374  f.db.get_contact
+000536e0: 735f 7374 6174 7328 5b73 656c 662e 6462  s_stats([self.db
+000536f0: 2e61 6363 6f75 6e74 5d20 2b20 7365 6c66  .account] + self
+00053700: 2e63 6f6e 7461 6374 732c 2073 656c 662e  .contacts, self.
+00053710: 6368 6174 7329 0d0a 2020 2020 2020 2020  chats)..        
+00053720: 2020 2020 6966 2073 656c 662e 636f 6e74      if self.cont
+00053730: 6163 743a 0d0a 2020 2020 2020 2020 2020  act:..          
+00053740: 2020 2020 2020 2320 4966 2074 6865 2075        # If the u
+00053750: 7365 7220 616c 7265 6164 7920 6f70 656e  ser already open
+00053760: 6564 2061 2063 6f6e 7461 6374 2077 6869  ed a contact whi
+00053770: 6c65 206c 6174 6572 2064 6174 610d 0a20  le later data.. 
+00053780: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00053790: 2077 6173 206c 6f61 6469 6e67 2c20 7570   was loading, up
+000537a0: 6461 7465 2074 6865 2070 6167 650d 0a20  date the page.. 
+000537b0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+000537c0: 6f6e 7461 6374 203d 206e 6578 7428 2878  ontact = next((x
+000537d0: 2066 6f72 2078 2069 6e20 5b73 656c 662e   for x in [self.
+000537e0: 6462 2e61 6363 6f75 6e74 5d20 2b20 7365  db.account] + se
+000537f0: 6c66 2e63 6f6e 7461 6374 730d 0a20 2020  lf.contacts..   
+00053800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053810: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00053820: 785b 2269 6465 6e74 6974 7922 5d20 3d3d  x["identity"] ==
+00053830: 2073 656c 662e 636f 6e74 6163 745b 2269   self.contact["i
+00053840: 6465 6e74 6974 7922 5d29 2c20 4e6f 6e65  dentity"]), None
+00053850: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00053860: 2020 2069 6620 636f 6e74 6163 743a 2073     if contact: s
+00053870: 656c 662e 6c6f 6164 5f63 6f6e 7461 6374  elf.load_contact
+00053880: 2863 6f6e 7461 6374 290d 0a20 2020 2020  (contact)..     
+00053890: 2020 2020 2020 2067 7569 6261 7365 2e73         guibase.s
+000538a0: 7461 7475 7328 224f 7065 6e65 6420 536b  tatus("Opened Sk
+000538b0: 7970 6520 6461 7461 6261 7365 2025 732e  ype database %s.
+000538c0: 222c 2073 656c 662e 6462 290d 0a20 2020  ", self.db)..   
+000538d0: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
+000538e0: 7074 696f 6e20 6173 2065 3a0d 0a20 2020  ption as e:..   
+000538f0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+00053900: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00053910: 2020 2067 7569 6261 7365 2e73 7461 7475     guibase.statu
+00053920: 7328 2245 7272 6f72 206c 6f61 6469 6e67  s("Error loading
+00053930: 2061 6464 6974 696f 6e61 6c20 6461 7461   additional data
+00053940: 2066 726f 6d20 2573 3a20 2573 222c 0d0a   from %s: %s",..
+00053950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053960: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00053970: 656c 662e 6462 2c20 7574 696c 2e66 6f72  elf.db, util.for
+00053980: 6d61 745f 6578 6328 6529 290d 0a20 2020  mat_exc(e))..   
+00053990: 2020 2020 2020 2020 2020 2020 206c 6f67               log
+000539a0: 6765 722e 6578 6365 7074 696f 6e28 2245  ger.exception("E
+000539b0: 7272 6f72 206c 6f61 6469 6e67 2061 6464  rror loading add
+000539c0: 6974 696f 6e61 6c20 6461 7461 2066 726f  itional data fro
+000539d0: 6d20 2573 2e22 2c20 7365 6c66 2e64 6229  m %s.", self.db)
+000539e0: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
+000539f0: 663a 0d0a 2020 2020 2020 2020 2020 2020  f:..            
+00053a00: 2320 5265 6672 6573 6820 6c69 7374 2066  # Refresh list f
+00053a10: 726f 6d20 6c6f 6164 6564 2064 6174 612c  rom loaded data,
+00053a20: 2073 6f72 7420 6279 206c 6173 7420 6d65   sort by last me
+00053a30: 7373 6167 6520 6461 7465 7469 6d65 0d0a  ssage datetime..
+00053a40: 2020 2020 2020 2020 2020 2020 736f 7274              sort
+00053a50: 6675 6e63 203d 206c 616d 6264 6120 6c3a  func = lambda l:
+00053a60: 206c 2061 6e64 2028 6c2e 5265 7365 7443   l and (l.ResetC
+00053a70: 6f6c 756d 6e57 6964 7468 7328 292c 0d0a  olumnWidths(),..
+00053a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053aa0: 2020 2020 2020 2020 6c2e 536f 7274 4c69          l.SortLi
+00053ab0: 7374 4974 656d 7328 342c 2030 292c 0d0a  stItems(4, 0),..
+00053ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053ae0: 2020 2020 2020 2020 286c 2e53 6574 436f          (l.SetCo
+00053af0: 6c75 6d6e 5769 6474 6828 302c 2031 3530  lumnWidth(0, 150
+00053b00: 292c 206c 2e53 6574 436f 6c75 6d6e 5769  ), l.SetColumnWi
+00053b10: 6474 6828 312c 2032 3530 2929 0d0a 2020  dth(1, 250))..  
+00053b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053b40: 2020 2020 2020 2069 6620 6c20 6973 2073         if l is s
+00053b50: 656c 662e 6c69 7374 5f63 6f6e 7461 6374  elf.list_contact
+00053b60: 7320 656c 7365 204e 6f6e 6529 0d0a 2020  s else None)..  
+00053b70: 2020 2020 2020 2020 2020 7778 2e43 616c            wx.Cal
+00053b80: 6c4c 6174 6572 2831 2c20 736f 7274 6675  lLater(1, sortfu
+00053b90: 6e63 2c20 7365 6c66 2e6c 6973 745f 6368  nc, self.list_ch
+00053ba0: 6174 7329 0d0a 2020 2020 2020 2020 2020  ats)..          
+00053bb0: 2020 7778 2e43 616c 6c4c 6174 6572 2831    wx.CallLater(1
+00053bc0: 2c20 736f 7274 6675 6e63 2c20 7365 6c66  , sortfunc, self
+00053bd0: 2e6c 6973 745f 636f 6e74 6163 7473 290d  .list_contacts).
+00053be0: 0a20 2020 2020 2020 2020 2020 2077 782e  .            wx.
+00053bf0: 4361 6c6c 4166 7465 7228 7365 6c66 2e75  CallAfter(self.u
+00053c00: 7064 6174 655f 7461 6268 6561 6465 7229  pdate_tabheader)
+00053c10: 0d0a 0d0a 0d0a 2020 2020 6465 6620 6c6f  ......    def lo
+00053c20: 6164 5f74 6162 6c65 735f 6461 7461 2873  ad_tables_data(s
+00053c30: 656c 662c 2072 656c 6f61 643d 4661 6c73  elf, reload=Fals
+00053c40: 6529 3a0d 0a20 2020 2020 2020 2022 2222  e):..        """
+00053c50: 0d0a 2020 2020 2020 2020 4c6f 6164 7320  ..        Loads 
+00053c60: 7461 626c 6520 6461 7461 2069 6e74 6f20  table data into 
+00053c70: 7461 626c 6520 7472 6565 2061 6e64 2053  table tree and S
+00053c80: 514c 2065 6469 746f 722c 0d0a 2020 2020  QL editor,..    
+00053c90: 2020 2020 7265 6c6f 6164 696e 6720 7363      reloading sc
+00053ca0: 6865 6d61 2061 6e64 2072 6f77 2063 6f75  hema and row cou
+00053cb0: 6e74 7320 6966 2073 7065 6369 6669 6564  nts if specified
+00053cc0: 2e0d 0a20 2020 2020 2020 2022 2222 0d0a  ...        """..
+00053cd0: 2020 2020 2020 2020 7472 793a 0d0a 2020          try:..  
+00053ce0: 2020 2020 2020 2020 2020 7461 626c 6573            tables
+00053cf0: 203d 2073 656c 662e 6462 2e67 6574 5f74   = self.db.get_t
+00053d00: 6162 6c65 7328 7265 6672 6573 683d 7265  ables(refresh=re
+00053d10: 6c6f 6164 290d 0a20 2020 2020 2020 2020  load)..         
+00053d20: 2020 2023 2046 696c 6c20 7461 626c 6520     # Fill table 
+00053d30: 7472 6565 2077 6974 6820 696e 666f 726d  tree with inform
+00053d40: 6174 696f 6e20 6f6e 2072 6f77 2063 6f75  ation on row cou
+00053d50: 6e74 7320 616e 6420 636f 6c75 6d6e 730d  nts and columns.
+00053d60: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00053d70: 662e 7472 6565 5f74 6162 6c65 732e 4465  f.tree_tables.De
+00053d80: 6c65 7465 416c 6c49 7465 6d73 2829 0d0a  leteAllItems()..
+00053d90: 2020 2020 2020 2020 2020 2020 726f 6f74              root
+00053da0: 203d 2073 656c 662e 7472 6565 5f74 6162   = self.tree_tab
+00053db0: 6c65 732e 4164 6452 6f6f 7428 2253 514c  les.AddRoot("SQL
+00053dc0: 4954 4522 290d 0a20 2020 2020 2020 2020  ITE")..         
+00053dd0: 2020 2063 6869 6c64 203d 204e 6f6e 650d     child = None.
+00053de0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+00053df0: 2074 6162 6c65 2069 6e20 7461 626c 6573   table in tables
+00053e00: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00053e10: 2020 2063 6869 6c64 203d 2073 656c 662e     child = self.
+00053e20: 7472 6565 5f74 6162 6c65 732e 4170 7065  tree_tables.Appe
+00053e30: 6e64 4974 656d 2872 6f6f 742c 2074 6162  ndItem(root, tab
+00053e40: 6c65 5b22 6e61 6d65 225d 290d 0a20 2020  le["name"])..   
+00053e50: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00053e60: 662e 7472 6565 5f74 6162 6c65 732e 5365  f.tree_tables.Se
+00053e70: 7449 7465 6d54 6578 7428 6368 696c 642c  tItemText(child,
+00053e80: 2022 2564 2072 6f77 2573 2220 2520 280d   "%d row%s" % (.
+00053e90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00053ea0: 2020 2020 2074 6162 6c65 5b22 726f 7773       table["rows
+00053eb0: 225d 2c20 2273 2220 6966 2074 6162 6c65  "], "s" if table
+00053ec0: 5b22 726f 7773 225d 2021 3d20 3120 656c  ["rows"] != 1 el
+00053ed0: 7365 2022 2022 0d0a 2020 2020 2020 2020  se " "..        
+00053ee0: 2020 2020 2020 2020 292c 2031 290d 0a20          ), 1).. 
+00053ef0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00053f00: 656c 662e 7472 6565 5f74 6162 6c65 732e  elf.tree_tables.
+00053f10: 5365 7449 7465 6d50 7944 6174 6128 6368  SetItemPyData(ch
+00053f20: 696c 642c 2074 6162 6c65 5b22 6e61 6d65  ild, table["name
+00053f30: 225d 290d 0a20 2020 2020 2020 2020 2020  "])..           
+00053f40: 2020 2020 2073 656c 662e 7472 6565 5f74       self.tree_t
+00053f50: 6162 6c65 732e 5365 7449 7465 6d54 6578  ables.SetItemTex
+00053f60: 7443 6f6c 6f75 7228 6368 696c 642c 2073  tColour(child, s
+00053f70: 656c 662e 7472 6565 5f74 6162 6c65 732e  elf.tree_tables.
+00053f80: 466f 7265 6772 6f75 6e64 436f 6c6f 7572  ForegroundColour
+00053f90: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
+00053fa0: 2020 2020 2066 6f72 2063 6f6c 2069 6e20       for col in 
+00053fb0: 7365 6c66 2e64 622e 6765 745f 7461 626c  self.db.get_tabl
+00053fc0: 655f 636f 6c75 6d6e 7328 7461 626c 655b  e_columns(table[
+00053fd0: 226e 616d 6522 5d29 3a0d 0a20 2020 2020  "name"]):..     
+00053fe0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00053ff0: 7562 6368 696c 6420 3d20 7365 6c66 2e74  ubchild = self.t
+00054000: 7265 655f 7461 626c 6573 2e41 7070 656e  ree_tables.Appen
+00054010: 6449 7465 6d28 6368 696c 642c 2063 6f6c  dItem(child, col
+00054020: 5b22 6e61 6d65 225d 290d 0a20 2020 2020  ["name"])..     
+00054030: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00054040: 656c 662e 7472 6565 5f74 6162 6c65 732e  elf.tree_tables.
+00054050: 5365 7449 7465 6d54 6578 7428 7375 6263  SetItemText(subc
+00054060: 6869 6c64 2c20 636f 6c5b 2274 7970 6522  hild, col["type"
+00054070: 5d2c 2031 290d 0a20 2020 2020 2020 2020  ], 1)..         
+00054080: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00054090: 7472 6565 5f74 6162 6c65 732e 5365 7449  tree_tables.SetI
+000540a0: 7465 6d54 6578 7443 6f6c 6f75 7228 7375  temTextColour(su
+000540b0: 6263 6869 6c64 2c20 7365 6c66 2e74 7265  bchild, self.tre
+000540c0: 655f 7461 626c 6573 2e46 6f72 6567 726f  e_tables.Foregro
+000540d0: 756e 6443 6f6c 6f75 7229 0d0a 2020 2020  undColour)..    
+000540e0: 2020 2020 2020 2020 7365 6c66 2e74 7265          self.tre
+000540f0: 655f 7461 626c 6573 2e45 7870 616e 6428  e_tables.Expand(
+00054100: 726f 6f74 290d 0a20 2020 2020 2020 2020  root)..         
+00054110: 2020 2069 6620 6368 696c 643a 0d0a 2020     if child:..  
+00054120: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00054130: 4e75 6467 6520 636f 6c75 6d6e 7320 746f  Nudge columns to
+00054140: 2066 6974 2061 6e64 2066 696c 6c20 7468   fit and fill th
+00054150: 6520 6865 6164 6572 2065 7861 6374 6c79  e header exactly
+00054160: 2e0d 0a20 2020 2020 2020 2020 2020 2020  ...             
+00054170: 2020 2073 656c 662e 7472 6565 5f74 6162     self.tree_tab
+00054180: 6c65 732e 4578 7061 6e64 2863 6869 6c64  les.Expand(child
+00054190: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+000541a0: 2020 2073 656c 662e 7472 6565 5f74 6162     self.tree_tab
+000541b0: 6c65 732e 5365 7443 6f6c 756d 6e57 6964  les.SetColumnWid
+000541c0: 7468 2830 2c20 2d31 290d 0a20 2020 2020  th(0, -1)..     
+000541d0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000541e0: 7472 6565 5f74 6162 6c65 732e 5365 7443  tree_tables.SetC
+000541f0: 6f6c 756d 6e57 6964 7468 2831 2c20 6d69  olumnWidth(1, mi
+00054200: 6e28 3730 2c0d 0a20 2020 2020 2020 2020  n(70,..         
+00054210: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00054220: 7472 6565 5f74 6162 6c65 732e 5369 7a65  tree_tables.Size
+00054230: 2e77 6964 7468 202d 0d0a 2020 2020 2020  .width -..      
+00054240: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00054250: 6c66 2e74 7265 655f 7461 626c 6573 2e47  lf.tree_tables.G
+00054260: 6574 436f 6c75 6d6e 5769 6474 6828 3029  etColumnWidth(0)
+00054270: 202d 2035 2929 0d0a 2020 2020 2020 2020   - 5))..        
+00054280: 2020 2020 2020 2020 7365 6c66 2e74 7265          self.tre
+00054290: 655f 7461 626c 6573 2e43 6f6c 6c61 7073  e_tables.Collaps
+000542a0: 6528 6368 696c 6429 0d0a 0d0a 2020 2020  e(child)....    
+000542b0: 2020 2020 2020 2020 2320 4164 6420 7461          # Add ta
+000542c0: 626c 6520 616e 6420 636f 6c75 6d6e 206e  ble and column n
+000542d0: 616d 6573 2074 6f20 5351 4c20 6564 6974  ames to SQL edit
+000542e0: 6f72 2061 7574 6f63 6f6d 706c 6574 650d  or autocomplete.
+000542f0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+00054300: 2074 2069 6e20 7461 626c 6573 3a0d 0a20   t in tables:.. 
+00054310: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00054320: 6f6c 6461 7461 203d 2073 656c 662e 6462  oldata = self.db
+00054330: 2e67 6574 5f74 6162 6c65 5f63 6f6c 756d  .get_table_colum
+00054340: 6e73 2874 5b22 6e61 6d65 225d 290d 0a20  ns(t["name"]).. 
+00054350: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00054360: 6965 6c64 7320 3d20 5b63 5b22 6e61 6d65  ields = [c["name
+00054370: 225d 2066 6f72 2063 2069 6e20 636f 6c64  "] for c in cold
+00054380: 6174 615d 0d0a 2020 2020 2020 2020 2020  ata]..          
+00054390: 2020 2020 2020 7365 6c66 2e73 7463 5f73        self.stc_s
+000543a0: 716c 2e41 7574 6f43 6f6d 7041 6464 5375  ql.AutoCompAddSu
+000543b0: 6257 6f72 6473 2874 5b22 6e61 6d65 225d  bWords(t["name"]
+000543c0: 2c20 6669 656c 6473 290d 0a20 2020 2020  , fields)..     
+000543d0: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
+000543e0: 696f 6e3a 0d0a 2020 2020 2020 2020 2020  ion:..          
+000543f0: 2020 6966 2073 656c 663a 0d0a 2020 2020    if self:..    
+00054400: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
+00054410: 6572 2e65 7863 6570 7469 6f6e 2822 4572  er.exception("Er
+00054420: 726f 7220 6c6f 6164 696e 6720 7461 626c  ror loading tabl
+00054430: 6520 6461 7461 2066 726f 6d20 2573 2e22  e data from %s."
+00054440: 2c20 7365 6c66 2e64 6229 0d0a 0d0a 0d0a  , self.db)......
+00054450: 2020 2020 6465 6620 7570 6461 7465 5f74      def update_t
+00054460: 6162 6865 6164 6572 2873 656c 6629 3a0d  abheader(self):.
+00054470: 0a20 2020 2020 2020 2022 2222 5570 6461  .        """Upda
+00054480: 7465 7320 7061 6765 2074 6162 2068 6561  tes page tab hea
+00054490: 6465 7220 7769 7468 206f 7074 696f 6e20  der with option 
+000544a0: 746f 2063 6c6f 7365 2070 6167 652e 2222  to close page.""
+000544b0: 220d 0a20 2020 2020 2020 2069 6620 7365  "..        if se
+000544c0: 6c66 3a0d 0a20 2020 2020 2020 2020 2020  lf:..           
+000544d0: 2073 656c 662e 7265 6164 795f 746f 5f63   self.ready_to_c
+000544e0: 6c6f 7365 203d 2054 7275 650d 0a20 2020  lose = True..   
+000544f0: 2020 2020 2069 6620 7365 6c66 3a0d 0a20       if self:.. 
+00054500: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00054510: 546f 704c 6576 656c 5061 7265 6e74 2e75  TopLevelParent.u
+00054520: 7064 6174 655f 6e6f 7465 626f 6f6b 5f68  pdate_notebook_h
+00054530: 6561 6465 7228 290d 0a0d 0a0d 0a0d 0a63  eader()........c
+00054540: 6c61 7373 204d 6572 6765 7250 6167 6528  lass MergerPage(
+00054550: 7778 2e50 616e 656c 293a 0d0a 2020 2020  wx.Panel):..    
+00054560: 2222 220d 0a20 2020 2041 2077 782e 4e6f  """..    A wx.No
+00054570: 7465 626f 6f6b 2070 6167 6520 666f 7220  tebook page for 
+00054580: 636f 6d70 6172 696e 6720 7477 6f20 536b  comparing two Sk
+00054590: 7970 6520 6461 7461 6261 7365 732c 2068  ype databases, h
+000545a0: 6173 2069 7473 206f 776e 204e 6f74 6562  as its own Noteb
+000545b0: 6f6f 6b0d 0a20 2020 2077 6974 6820 6f6e  ook..    with on
+000545c0: 6520 7061 6765 2066 6f72 2064 6966 6669  e page for diffi
+000545d0: 6e67 2f6d 6572 6769 6e67 2063 6861 7473  ng/merging chats
+000545e0: 2c20 616e 6420 616e 6f74 6865 7220 666f  , and another fo
+000545f0: 7220 636f 6e74 6163 7473 2e0d 0a20 2020  r contacts...   
+00054600: 2022 2222 0d0a 0d0a 2020 2020 2222 224e   """....    """N
+00054610: 6f74 6573 2066 6f72 206d 6572 6765 2062  otes for merge b
+00054620: 7574 746f 6e73 2077 6865 7265 206e 6f74  uttons where not
+00054630: 6520 6368 616e 6765 7320 7769 7468 2064  e changes with d
+00054640: 6174 612e 2222 220d 0a20 2020 204d 4552  ata."""..    MER
+00054650: 4745 5f42 5554 544f 4e5f 4e4f 5445 203d  GE_BUTTON_NOTE =
+00054660: 2028 2253 6361 6e20 7468 726f 7567 6820   ("Scan through 
+00054670: 7468 6520 6c65 6674 2064 6174 6162 6173  the left databas
+00054680: 652c 2066 696e 6420 6d65 7373 6167 6573  e, find messages
+00054690: 206e 6f74 2022 0d0a 2020 2020 2020 2020   not "..        
+000546a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000546b0: 2022 7072 6573 656e 7420 6f6e 2074 6865   "present on the
+000546c0: 2072 6967 6874 2c20 616e 6420 636f 7079   right, and copy
+000546d0: 2074 6865 6d20 746f 2074 6865 2064 6174   them to the dat
+000546e0: 6162 6173 6520 220d 0a20 2020 2020 2020  abase "..       
+000546f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00054700: 2020 226f 6e20 7468 6520 7269 6768 742e    "on the right.
+00054710: 2229 0d0a 2020 2020 4d45 5247 455f 4348  ")..    MERGE_CH
+00054720: 4154 5f42 5554 544f 4e5f 4e4f 5445 203d  AT_BUTTON_NOTE =
+00054730: 2022 436f 7079 206e 6577 206d 6573 7361   "Copy new messa
+00054740: 6765 7320 746f 2074 6865 2064 6174 6162  ges to the datab
+00054750: 6173 6520 6f6e 2074 6865 2072 6967 6874  ase on the right
+00054760: 2e22 0d0a 0d0a 2020 2020 6465 6620 5f5f  ."....    def __
+00054770: 696e 6974 5f5f 2873 656c 662c 2070 6172  init__(self, par
+00054780: 656e 745f 6e6f 7465 626f 6f6b 2c20 6462  ent_notebook, db
+00054790: 312c 2064 6232 2c20 7469 746c 6529 3a0d  1, db2, title):.
+000547a0: 0a20 2020 2020 2020 2077 782e 5061 6e65  .        wx.Pane
+000547b0: 6c2e 5f5f 696e 6974 5f5f 2873 656c 662c  l.__init__(self,
+000547c0: 2070 6172 656e 743d 7061 7265 6e74 5f6e   parent=parent_n
+000547d0: 6f74 6562 6f6f 6b29 0d0a 2020 2020 2020  otebook)..      
+000547e0: 2020 7365 6c66 2e70 6167 656f 7264 6572    self.pageorder
+000547f0: 203d 207b 7d20 2320 7b70 6167 653a 206e   = {} # {page: n
+00054800: 6f74 6562 6f6f 6b20 696e 6465 782c 207d  otebook index, }
+00054810: 0d0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
+00054820: 6172 656e 745f 6e6f 7465 626f 6f6b 203d  arent_notebook =
+00054830: 2070 6172 656e 745f 6e6f 7465 626f 6f6b   parent_notebook
+00054840: 0d0a 2020 2020 2020 2020 7365 6c66 2e72  ..        self.r
+00054850: 6561 6479 5f74 6f5f 636c 6f73 6520 3d20  eady_to_close = 
+00054860: 4661 6c73 650d 0a20 2020 2020 2020 2073  False..        s
+00054870: 656c 662e 6973 5f6d 6572 6769 6e67 203d  elf.is_merging =
+00054880: 2046 616c 7365 2023 2057 6865 7468 6572   False # Whether
+00054890: 206d 6572 6769 6e67 2069 7320 6375 7272   merging is curr
+000548a0: 656e 746c 7920 756e 6465 7277 6179 0d0a  ently underway..
+000548b0: 2020 2020 2020 2020 7365 6c66 2e69 735f          self.is_
+000548c0: 7363 616e 6e69 6e67 203d 2046 616c 7365  scanning = False
+000548d0: 2023 2057 6865 7468 6572 2073 6361 6e6e   # Whether scann
+000548e0: 696e 6720 6973 2063 7572 7265 6e74 6c79  ing is currently
+000548f0: 2075 6e64 6572 7761 790d 0a20 2020 2020   underway..     
+00054900: 2020 2073 656c 662e 6973 5f73 6361 6e6e     self.is_scann
+00054910: 6564 203d 2046 616c 7365 2023 2057 6865  ed = False # Whe
+00054920: 7468 6572 2067 6c6f 6261 6c20 7363 616e  ther global scan
+00054930: 2068 6173 2062 6565 6e20 7275 6e0d 0a20   has been run.. 
+00054940: 2020 2020 2020 2073 656c 662e 6462 3120         self.db1 
+00054950: 3d20 6462 310d 0a20 2020 2020 2020 2073  = db1..        s
+00054960: 656c 662e 6462 3220 3d20 6462 320d 0a20  elf.db2 = db2.. 
+00054970: 2020 2020 2020 2067 7569 6261 7365 2e73         guibase.s
+00054980: 7461 7475 7328 224f 7065 6e69 6e67 2025  tatus("Opening %
+00054990: 7320 616e 6420 2573 2e22 2c20 7365 6c66  s and %s.", self
+000549a0: 2e64 6231 2c20 7365 6c66 2e64 6232 290d  .db1, self.db2).
+000549b0: 0a20 2020 2020 2020 2073 656c 662e 6462  .        self.db
+000549c0: 312e 7265 6769 7374 6572 5f63 6f6e 7375  1.register_consu
+000549d0: 6d65 7228 7365 6c66 292c 2073 656c 662e  mer(self), self.
+000549e0: 6462 322e 7265 6769 7374 6572 5f63 6f6e  db2.register_con
+000549f0: 7375 6d65 7228 7365 6c66 290d 0a20 2020  sumer(self)..   
+00054a00: 2020 2020 2073 656c 662e 7469 746c 6520       self.title 
+00054a10: 3d20 7469 746c 650d 0a20 2020 2020 2020  = title..       
+00054a20: 2070 6172 656e 745f 6e6f 7465 626f 6f6b   parent_notebook
+00054a30: 2e49 6e73 6572 7450 6167 6528 312c 2073  .InsertPage(1, s
+00054a40: 656c 662c 2074 6974 6c65 290d 0a20 2020  elf, title)..   
+00054a50: 2020 2020 2043 6f6c 6f75 724d 616e 6167       ColourManag
+00054a60: 6572 2e4d 616e 6167 6528 7365 6c66 2c20  er.Manage(self, 
+00054a70: 2242 6163 6b67 726f 756e 6443 6f6c 6f75  "BackgroundColou
+00054a80: 7222 2c20 7778 2e53 5953 5f43 4f4c 4f55  r", wx.SYS_COLOU
+00054a90: 525f 4254 4e46 4143 4529 0d0a 2020 2020  R_BTNFACE)..    
+00054aa0: 2020 2020 6275 7379 203d 2063 6f6e 7472      busy = contr
+00054ab0: 6f6c 732e 4275 7379 5061 6e65 6c28 0d0a  ols.BusyPanel(..
+00054ac0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00054ad0: 2c20 2243 6f6d 7061 7269 6e67 205c 2225  , "Comparing \"%
+00054ae0: 735c 225c 6e20 616e 6420 5c22 2573 5c22  s\"\n and \"%s\"
+00054af0: 2e22 2025 2028 6462 312c 2064 6232 2929  ." % (db1, db2))
+00054b00: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
+00054b10: 2e63 6861 7473 3120 3d20 4e6f 6e65 2020  .chats1 = None  
+00054b20: 2020 2020 2020 2320 5b63 6861 7473 2069        # [chats i
+00054b30: 6e20 6c65 6674 2064 6174 6162 6173 655d  n left database]
+00054b40: 0d0a 2020 2020 2020 2020 7365 6c66 2e63  ..        self.c
+00054b50: 6861 7473 3220 3d20 4e6f 6e65 2020 2020  hats2 = None    
+00054b60: 2020 2020 2320 5b63 6861 7473 2069 6e20      # [chats in 
+00054b70: 7269 6768 7420 6461 7461 6261 7365 5d0d  right database].
+00054b80: 0a20 2020 2020 2020 2073 656c 662e 6368  .        self.ch
+00054b90: 6174 203d 204e 6f6e 6520 2020 2020 2020  at = None       
+00054ba0: 2020 2023 2043 6861 7420 6f70 656e 6564     # Chat opened
+00054bb0: 206f 6e20 6368 6174 7320 7061 6765 0d0a   on chats page..
+00054bc0: 2020 2020 2020 2020 7365 6c66 2e63 6861          self.cha
+00054bd0: 745f 6469 6666 203d 204e 6f6e 6520 2020  t_diff = None   
+00054be0: 2020 2320 4f70 656e 2064 6966 6620 7b22    # Open diff {"
+00054bf0: 6d65 7373 6167 6573 223a 205b 5d2c 2022  messages": [], "
+00054c00: 7061 7274 6963 6970 616e 7473 223a 205b  participants": [
+00054c10: 5d7d 0d0a 2020 2020 2020 2020 7365 6c66  ]}..        self
+00054c20: 2e63 6f6d 7061 7265 6420 3d20 4e6f 6e65  .compared = None
+00054c30: 2020 2020 2020 2320 4368 6174 206c 6973        # Chat lis
+00054c40: 742c 206c 6566 742d 7269 6768 7420 6461  t, left-right da
+00054c50: 7461 2069 6e20 6b65 7973 2022 6331 2220  ta in keys "c1" 
+00054c60: 2620 2263 3222 0d0a 2020 2020 2020 2020  & "c2"..        
+00054c70: 7365 6c66 2e63 6f6e 3164 6966 666c 6973  self.con1difflis
+00054c80: 7420 3d20 4e6f 6e65 2020 2320 436f 6e74  t = None  # Cont
+00054c90: 6163 7420 616e 6420 636f 6e74 6163 7420  act and contact 
+00054ca0: 6772 6f75 7020 6469 6666 6572 656e 6365  group difference
+00054cb0: 730d 0a20 2020 2020 2020 2073 656c 662e  s..        self.
+00054cc0: 636f 6e32 6469 6666 6c69 7374 203d 204e  con2difflist = N
+00054cd0: 6f6e 6520 2023 2043 6f6e 7461 6374 2061  one  # Contact a
+00054ce0: 6e64 2063 6f6e 7461 6374 2067 726f 7570  nd contact group
+00054cf0: 2064 6966 6665 7265 6e63 6573 0d0a 2020   differences..  
+00054d00: 2020 2020 2020 7365 6c66 2e63 6f6e 3164        self.con1d
+00054d10: 6966 6620 3d20 4e6f 6e65 2020 2020 2020  iff = None      
+00054d20: 2320 436f 6e74 6163 7420 6469 6666 6572  # Contact differ
+00054d30: 656e 6365 7320 666f 7220 6c65 6674 0d0a  ences for left..
+00054d40: 2020 2020 2020 2020 7365 6c66 2e63 6f6e          self.con
+00054d50: 3264 6966 6620 3d20 4e6f 6e65 2020 2020  2diff = None    
+00054d60: 2020 2320 436f 6e74 6163 7420 6469 6666    # Contact diff
+00054d70: 6572 656e 6365 7320 666f 7220 7269 6768  erences for righ
+00054d80: 740d 0a20 2020 2020 2020 2073 656c 662e  t..        self.
+00054d90: 636f 6e67 726f 7570 3164 6966 6620 3d20  congroup1diff = 
+00054da0: 4e6f 6e65 2023 2043 6f6e 7461 6374 2067  None # Contact g
+00054db0: 726f 7570 2064 6966 6665 7265 6e63 6573  roup differences
+00054dc0: 2066 6f72 206c 6566 740d 0a20 2020 2020   for left..     
+00054dd0: 2020 2073 656c 662e 636f 6e67 726f 7570     self.congroup
+00054de0: 3264 6966 6620 3d20 4e6f 6e65 2023 2043  2diff = None # C
+00054df0: 6f6e 7461 6374 2067 726f 7570 2064 6966  ontact group dif
+00054e00: 6665 7265 6e63 6573 2066 6f72 2072 6967  ferences for rig
+00054e10: 6874 0d0a 2020 2020 2020 2020 7365 6c66  ht..        self
+00054e20: 2e63 6861 7473 5f6e 6f64 6966 6620 3d20  .chats_nodiff = 
+00054e30: 7b7d 2020 2020 2320 7b69 6465 6e74 6974  {}    # {identit
+00054e40: 7920 6f66 2075 6e63 6861 6e67 6564 2063  y of unchanged c
+00054e50: 6861 743a 207b 6368 6174 7d2c 207d 0d0a  hat: {chat}, }..
+00054e60: 2020 2020 2020 2020 2320 7b69 6465 6e74          # {ident
+00054e70: 6974 7920 6f66 2063 6861 6e67 6564 2063  ity of changed c
+00054e80: 6861 743a 207b 2263 6861 7422 3a20 7b7d  hat: {"chat": {}
+00054e90: 2c20 2264 6966 6622 3a20 5b6d 6573 7361  , "diff": [messa
+00054ea0: 6765 2049 442c 205d 7d2c 207d 0d0a 2020  ge ID, ]}, }..  
+00054eb0: 2020 2020 2020 7365 6c66 2e63 6861 7473        self.chats
+00054ec0: 5f64 6966 6664 6174 6120 3d20 7b7d 0d0a  _diffdata = {}..
+00054ed0: 0d0a 2020 2020 2020 2020 7365 6c66 2e63  ..        self.c
+00054ee0: 6f6e 7461 6374 735f 6c69 7374 5f63 6f6c  ontacts_list_col
+00054ef0: 756d 6e73 203d 205b 0d0a 2020 2020 2020  umns = [..      
+00054f00: 2020 2020 2020 2822 6964 656e 7469 7479        ("identity
+00054f10: 222c 2022 4163 636f 756e 7422 292c 2028  ", "Account"), (
+00054f20: 226e 616d 6522 2c20 224e 616d 6522 292c  "name", "Name"),
+00054f30: 0d0a 2020 2020 2020 2020 2020 2020 2822  ..            ("
+00054f40: 7068 6f6e 655f 6d6f 6269 6c65 5f6e 6f72  phone_mobile_nor
+00054f50: 6d61 6c69 7a65 6422 2c20 224d 6f62 696c  malized", "Mobil
+00054f60: 6520 7068 6f6e 6522 292c 0d0a 2020 2020  e phone"),..    
+00054f70: 2020 2020 2020 2020 2822 636f 756e 7472          ("countr
+00054f80: 7922 2c20 2243 6f75 6e74 7279 2229 2c20  y", "Country"), 
+00054f90: 2822 6369 7479 222c 2022 4369 7479 2229  ("city", "City")
+00054fa0: 2c20 2822 6162 6f75 7422 2c20 2241 626f  , ("about", "Abo
+00054fb0: 7574 2229 2c0d 0a20 2020 2020 2020 2020  ut"),..         
+00054fc0: 2020 2028 225f 5f74 7970 6522 2c20 2254     ("__type", "T
+00054fd0: 7970 6522 292c 205d 0d0a 2020 2020 2020  ype"), ]..      
+00054fe0: 2020 7365 6c66 2e63 6861 7473 5f6c 6973    self.chats_lis
+00054ff0: 745f 636f 6c75 6d6e 7320 3d20 5b0d 0a20  t_columns = [.. 
+00055000: 2020 2020 2020 2020 2020 2028 2274 6974             ("tit
+00055010: 6c65 222c 2022 4368 6174 2229 2c20 2822  le", "Chat"), ("
+00055020: 6d65 7373 6167 6573 3122 2c20 224d 6573  messages1", "Mes
+00055030: 7361 6765 7320 696e 206c 6566 7422 292c  sages in left"),
+00055040: 0d0a 2020 2020 2020 2020 2020 2020 2822  ..            ("
+00055050: 6d65 7373 6167 6573 3222 2c20 224d 6573  messages2", "Mes
+00055060: 7361 6765 7320 696e 2072 6967 6874 2229  sages in right")
+00055070: 2c0d 0a20 2020 2020 2020 2020 2020 2028  ,..            (
+00055080: 226c 6173 745f 6d65 7373 6167 655f 6461  "last_message_da
+00055090: 7465 7469 6d65 3122 2c20 224c 6173 7420  tetime1", "Last 
+000550a0: 6d65 7373 6167 6520 696e 206c 6566 7422  message in left"
+000550b0: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
+000550c0: 2822 6c61 7374 5f6d 6573 7361 6765 5f64  ("last_message_d
+000550d0: 6174 6574 696d 6532 222c 2022 4c61 7374  atetime2", "Last
+000550e0: 206d 6573 7361 6765 2069 6e20 7269 6768   message in righ
+000550f0: 7422 292c 0d0a 2020 2020 2020 2020 2020  t"),..          
+00055100: 2020 2822 7479 7065 5f6e 616d 6522 2c20    ("type_name", 
+00055110: 2254 7970 6522 292c 2028 2270 656f 706c  "Type"), ("peopl
+00055120: 6522 2c20 2250 656f 706c 6522 292c 205d  e", "People"), ]
+00055130: 0d0a 2020 2020 2020 2020 7365 6c66 2e42  ..        self.B
+00055140: 696e 6428 4556 545f 574f 524b 4552 2c20  ind(EVT_WORKER, 
+00055150: 7365 6c66 2e6f 6e5f 776f 726b 6572 5f6d  self.on_worker_m
+00055160: 6572 6765 5f72 6573 756c 7429 0d0a 2020  erge_result)..  
+00055170: 2020 2020 2020 7365 6c66 2e77 6f72 6b65        self.worke
+00055180: 725f 6d65 7267 6520 3d20 776f 726b 6572  r_merge = worker
+00055190: 732e 4d65 7267 6554 6872 6561 6428 7365  s.MergeThread(se
+000551a0: 6c66 2e6f 6e5f 776f 726b 6572 5f6d 6572  lf.on_worker_mer
+000551b0: 6765 5f63 616c 6c62 6163 6b29 0d0a 2020  ge_callback)..  
+000551c0: 2020 2020 2020 7365 6c66 2e77 6f72 6b65        self.worke
+000551d0: 725f 696d 706f 7274 203d 2077 6f72 6b65  r_import = worke
+000551e0: 7273 2e53 6b79 7065 4172 6368 6976 6554  rs.SkypeArchiveT
+000551f0: 6872 6561 6428 7365 6c66 2e6f 6e5f 776f  hread(self.on_wo
+00055200: 726b 6572 5f69 6d70 6f72 745f 6361 6c6c  rker_import_call
+00055210: 6261 636b 290d 0a0d 0a20 2020 2020 2020  back)....       
+00055220: 2073 697a 6572 203d 2073 656c 662e 5369   sizer = self.Si
+00055230: 7a65 7220 3d20 7778 2e42 6f78 5369 7a65  zer = wx.BoxSize
+00055240: 7228 7778 2e56 4552 5449 4341 4c29 0d0a  r(wx.VERTICAL)..
+00055250: 0d0a 2020 2020 2020 2020 7369 7a65 725f  ..        sizer_
+00055260: 6865 6164 6572 203d 2077 782e 426f 7853  header = wx.BoxS
+00055270: 697a 6572 2877 782e 484f 5249 5a4f 4e54  izer(wx.HORIZONT
+00055280: 414c 290d 0a20 2020 2020 2020 206c 6162  AL)..        lab
+00055290: 656c 203d 2073 656c 662e 6874 6d6c 5f64  el = self.html_d
+000552a0: 626c 6162 656c 203d 2077 782e 6874 6d6c  blabel = wx.html
+000552b0: 2e48 746d 6c57 696e 646f 7728 7061 7265  .HtmlWindow(pare
+000552c0: 6e74 3d73 656c 662c 0d0a 2020 2020 2020  nt=self,..      
+000552d0: 2020 2020 2020 7369 7a65 3d28 2d31 2c20        size=(-1, 
+000552e0: 3336 292c 2073 7479 6c65 3d77 782e 6874  36), style=wx.ht
+000552f0: 6d6c 2e48 575f 5343 524f 4c4c 4241 525f  ml.HW_SCROLLBAR_
+00055300: 4e45 5645 5229 0d0a 2020 2020 2020 2020  NEVER)..        
+00055310: 6c61 6265 6c2e 5365 7446 6f6e 7473 286e  label.SetFonts(n
+00055320: 6f72 6d61 6c5f 6661 6365 3d73 656c 662e  ormal_face=self.
+00055330: 466f 6e74 2e46 6163 654e 616d 652c 0d0a  Font.FaceName,..
+00055340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00055350: 2020 2020 2020 2066 6978 6564 5f66 6163         fixed_fac
+00055360: 653d 7365 6c66 2e46 6f6e 742e 4661 6365  e=self.Font.Face
+00055370: 4e61 6d65 2c20 7369 7a65 733d 5b38 5d20  Name, sizes=[8] 
+00055380: 2a20 3729 0d0a 2020 2020 2020 2020 7365  * 7)..        se
+00055390: 6c66 2e42 696e 6428 7778 2e68 746d 6c2e  lf.Bind(wx.html.
+000553a0: 4556 545f 4854 4d4c 5f4c 494e 4b5f 434c  EVT_HTML_LINK_CL
+000553b0: 4943 4b45 442c 2073 656c 662e 6f6e 5f6c  ICKED, self.on_l
+000553c0: 696e 6b5f 6462 2c20 6c61 6265 6c29 0d0a  ink_db, label)..
+000553d0: 2020 2020 2020 2020 6275 7474 6f6e 5f73          button_s
+000553e0: 7761 7020 3d20 7365 6c66 2e62 7574 746f  wap = self.butto
+000553f0: 6e5f 7377 6170 203d 205c 0d0a 2020 2020  n_swap = \..    
+00055400: 2020 2020 2020 2020 7778 2e42 7574 746f          wx.Butto
+00055410: 6e28 7061 7265 6e74 3d73 656c 662c 206c  n(parent=self, l
+00055420: 6162 656c 3d22 5326 7761 7020 6c65 6674  abel="S&wap left
+00055430: 2d72 6967 6874 2229 0d0a 2020 2020 2020  -right")..      
+00055440: 2020 6275 7474 6f6e 5f73 7761 702e 456e    button_swap.En
+00055450: 6162 6c65 6420 3d20 4661 6c73 650d 0a20  abled = False.. 
+00055460: 2020 2020 2020 2062 7574 746f 6e5f 7377         button_sw
+00055470: 6170 2e53 6574 546f 6f6c 5469 7028 2253  ap.SetToolTip("S
+00055480: 7761 7073 206c 6566 7420 616e 6420 7269  waps left and ri
+00055490: 6768 7420 6461 7461 6261 7365 2c20 220d  ght database, ".
+000554a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000554b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000554c0: 2263 6861 6e67 696e 6720 6d65 7267 6520  "changing merge 
+000554d0: 6469 7265 6374 696f 6e2e 2229 0d0a 2020  direction.")..  
+000554e0: 2020 2020 2020 7365 6c66 2e42 696e 6428        self.Bind(
+000554f0: 7778 2e45 5654 5f42 5554 544f 4e2c 2073  wx.EVT_BUTTON, s
+00055500: 656c 662e 6f6e 5f73 7761 702c 2062 7574  elf.on_swap, but
+00055510: 746f 6e5f 7377 6170 290d 0a20 2020 2020  ton_swap)..     
+00055520: 2020 2073 697a 6572 5f68 6561 6465 722e     sizer_header.
+00055530: 4164 6428 6c61 6265 6c2c 2062 6f72 6465  Add(label, borde
+00055540: 723d 352c 2070 726f 706f 7274 696f 6e3d  r=5, proportion=
+00055550: 312c 0d0a 2020 2020 2020 2020 2020 2020  1,..            
+00055560: 2020 2020 2020 2020 2020 2020 2066 6c61               fla
+00055570: 673d 7778 2e47 524f 5720 7c20 7778 2e54  g=wx.GROW | wx.T
+00055580: 4f50 207c 2077 782e 424f 5454 4f4d 290d  OP | wx.BOTTOM).
+00055590: 0a20 2020 2020 2020 2073 697a 6572 5f68  .        sizer_h
+000555a0: 6561 6465 722e 4164 6428 6275 7474 6f6e  eader.Add(button
+000555b0: 5f73 7761 702c 2062 6f72 6465 723d 352c  _swap, border=5,
+000555c0: 2066 6c61 673d 7778 2e4c 4546 5420 7c20   flag=wx.LEFT | 
+000555d0: 7778 2e52 4947 4854 207c 0d0a 2020 2020  wx.RIGHT |..    
+000555e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000555f0: 2020 2020 2077 782e 414c 4947 4e5f 4345       wx.ALIGN_CE
+00055600: 4e54 4552 5f56 4552 5449 4341 4c29 0d0a  NTER_VERTICAL)..
+00055610: 2020 2020 2020 2020 7369 7a65 722e 4164          sizer.Ad
+00055620: 6428 7369 7a65 725f 6865 6164 6572 2c20  d(sizer_header, 
+00055630: 666c 6167 3d77 782e 4752 4f57 290d 0a20  flag=wx.GROW).. 
+00055640: 2020 2020 2020 2073 697a 6572 2e4c 6179         sizer.Lay
+00055650: 6f75 7428 2920 2320 546f 2061 766f 6964  out() # To avoid
+00055660: 2068 6561 6465 7220 6d6f 7669 6e67 2061   header moving a
+00055670: 726f 756e 6420 6475 7269 6e67 2070 6167  round during pag
+00055680: 6520 6372 6561 7469 6f6e 0d0a 0d0a 2020  e creation....  
+00055690: 2020 2020 2020 6e6f 7465 626f 6f6b 203d        notebook =
+000556a0: 2073 656c 662e 6e6f 7465 626f 6f6b 203d   self.notebook =
+000556b0: 2077 782e 6c69 622e 6167 772e 6c61 6265   wx.lib.agw.labe
+000556c0: 6c62 6f6f 6b2e 466c 6174 496d 6167 6542  lbook.FlatImageB
+000556d0: 6f6f 6b28 0d0a 2020 2020 2020 2020 2020  ook(..          
+000556e0: 2020 7061 7265 6e74 3d73 656c 662c 2061    parent=self, a
+000556f0: 6777 5374 796c 653d 7778 2e6c 6962 2e61  gwStyle=wx.lib.a
+00055700: 6777 2e66 6d72 6573 6f75 7263 6573 2e49  gw.fmresources.I
+00055710: 4e42 5f4c 4546 542c 2073 7479 6c65 3d77  NB_LEFT, style=w
+00055720: 782e 424f 5244 4552 5f53 5441 5449 4329  x.BORDER_STATIC)
+00055730: 0d0a 2020 2020 2020 2020 7369 7a65 722e  ..        sizer.
+00055740: 4164 6428 6e6f 7465 626f 6f6b 2c20 7072  Add(notebook, pr
+00055750: 6f70 6f72 7469 6f6e 3d31 302c 2062 6f72  oportion=10, bor
+00055760: 6465 723d 352c 0d0a 2020 2020 2020 2020  der=5,..        
+00055770: 2020 2020 2020 2020 2020 666c 6167 3d77            flag=w
+00055780: 782e 4752 4f57 207c 2077 782e 4c45 4654  x.GROW | wx.LEFT
+00055790: 207c 2077 782e 5249 4748 5420 7c20 7778   | wx.RIGHT | wx
+000557a0: 2e42 4f54 544f 4d29 0d0a 0d0a 2020 2020  .BOTTOM)....    
+000557b0: 2020 2020 696c 203d 2077 782e 496d 6167      il = wx.Imag
+000557c0: 654c 6973 7428 3332 2c20 3332 290d 0a20  eList(32, 32).. 
+000557d0: 2020 2020 2020 2069 6478 3120 3d20 696c         idx1 = il
+000557e0: 2e41 6464 2869 6d61 6765 732e 5061 6765  .Add(images.Page
+000557f0: 4d65 7267 6541 6c6c 2e42 6974 6d61 7029  MergeAll.Bitmap)
+00055800: 0d0a 2020 2020 2020 2020 6964 7832 203d  ..        idx2 =
+00055810: 2069 6c2e 4164 6428 696d 6167 6573 2e50   il.Add(images.P
+00055820: 6167 654d 6572 6765 4368 6174 732e 4269  ageMergeChats.Bi
+00055830: 746d 6170 290d 0a20 2020 2020 2020 2069  tmap)..        i
+00055840: 6478 3320 3d20 696c 2e41 6464 2869 6d61  dx3 = il.Add(ima
+00055850: 6765 732e 5061 6765 4d65 7267 6543 6f6e  ges.PageMergeCon
+00055860: 7461 6374 732e 4269 746d 6170 290d 0a20  tacts.Bitmap).. 
+00055870: 2020 2020 2020 206e 6f74 6562 6f6f 6b2e         notebook.
+00055880: 4173 7369 676e 496d 6167 654c 6973 7428  AssignImageList(
+00055890: 696c 290d 0a0d 0a20 2020 2020 2020 2073  il)....        s
+000558a0: 656c 662e 6372 6561 7465 5f70 6167 655f  elf.create_page_
+000558b0: 6d65 7267 655f 616c 6c28 6e6f 7465 626f  merge_all(notebo
+000558c0: 6f6b 290d 0a20 2020 2020 2020 2073 656c  ok)..        sel
+000558d0: 662e 6372 6561 7465 5f70 6167 655f 6d65  f.create_page_me
+000558e0: 7267 655f 6368 6174 7328 6e6f 7465 626f  rge_chats(notebo
+000558f0: 6f6b 290d 0a20 2020 2020 2020 2073 656c  ok)..        sel
+00055900: 662e 6372 6561 7465 5f70 6167 655f 6d65  f.create_page_me
+00055910: 7267 655f 636f 6e74 6163 7473 286e 6f74  rge_contacts(not
+00055920: 6562 6f6f 6b29 0d0a 0d0a 2020 2020 2020  ebook)....      
+00055930: 2020 6e6f 7465 626f 6f6b 2e53 6574 5061    notebook.SetPa
+00055940: 6765 496d 6167 6528 302c 2069 6478 3129  geImage(0, idx1)
+00055950: 0d0a 2020 2020 2020 2020 6e6f 7465 626f  ..        notebo
+00055960: 6f6b 2e53 6574 5061 6765 496d 6167 6528  ok.SetPageImage(
+00055970: 312c 2069 6478 3229 0d0a 2020 2020 2020  1, idx2)..      
+00055980: 2020 6e6f 7465 626f 6f6b 2e53 6574 5061    notebook.SetPa
+00055990: 6765 496d 6167 6528 322c 2069 6478 3329  geImage(2, idx3)
+000559a0: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
+000559b0: 2e54 6f70 4c65 7665 6c50 6172 656e 742e  .TopLevelParent.
+000559c0: 7061 6765 5f6d 6572 6765 5f6c 6174 6573  page_merge_lates
+000559d0: 7420 3d20 7365 6c66 0d0a 2020 2020 2020  t = self..      
+000559e0: 2020 7365 6c66 2e54 6f70 4c65 7665 6c50    self.TopLevelP
+000559f0: 6172 656e 742e 7275 6e5f 636f 6e73 6f6c  arent.run_consol
+00055a00: 6528 0d0a 2020 2020 2020 2020 2020 2020  e(..            
+00055a10: 2270 6167 6531 3220 3d20 7365 6c66 2e70  "page12 = self.p
+00055a20: 6167 655f 6d65 7267 655f 6c61 7465 7374  age_merge_latest
+00055a30: 2023 204d 6572 6765 7220 7461 6222 290d   # Merger tab").
+00055a40: 0a20 2020 2020 2020 2073 656c 662e 546f  .        self.To
+00055a50: 704c 6576 656c 5061 7265 6e74 2e72 756e  pLevelParent.run
+00055a60: 5f63 6f6e 736f 6c65 280d 0a20 2020 2020  _console(..     
+00055a70: 2020 2020 2020 2022 6462 312c 2064 6232         "db1, db2
+00055a80: 203d 2070 6167 6531 322e 6462 312c 2070   = page12.db1, p
+00055a90: 6167 6531 322e 6462 3220 2320 4368 6f73  age12.db2 # Chos
+00055aa0: 656e 2064 6174 6162 6173 6573 2229 0d0a  en databases")..
+00055ab0: 0d0a 2020 2020 2020 2020 7365 6c66 2e4c  ..        self.L
+00055ac0: 6179 6f75 7428 290d 0a20 2020 2020 2020  ayout()..       
+00055ad0: 2073 656c 662e 6c6f 6164 5f64 6174 6128   self.load_data(
+00055ae0: 290d 0a20 2020 2020 2020 2023 2048 6163  )..        # Hac
+00055af0: 6b20 746f 2067 6574 2073 6372 6f6c 6c65  k to get scrolle
+00055b00: 6420 7061 6e65 6c73 206c 6179 206f 7574  d panels lay out
+00055b10: 2070 726f 7065 726c 790d 0a20 2020 2020   properly..     
+00055b20: 2020 206e 6f74 6562 6f6f 6b2e 5365 7453     notebook.SetS
+00055b30: 656c 6563 7469 6f6e 2831 290d 0a20 2020  election(1)..   
+00055b40: 2020 2020 2073 656c 662e 7061 6765 5f6d       self.page_m
+00055b50: 6572 6765 5f63 6861 7473 2e4c 6179 6f75  erge_chats.Layou
+00055b60: 7428 290d 0a20 2020 2020 2020 206e 6f74  t()..        not
+00055b70: 6562 6f6f 6b2e 5365 7453 656c 6563 7469  ebook.SetSelecti
+00055b80: 6f6e 2832 290d 0a20 2020 2020 2020 2073  on(2)..        s
+00055b90: 656c 662e 7061 6765 5f6d 6572 6765 5f63  elf.page_merge_c
+00055ba0: 6f6e 7461 6374 732e 4c61 796f 7574 2829  ontacts.Layout()
+00055bb0: 0d0a 2020 2020 2020 2020 6e6f 7465 626f  ..        notebo
+00055bc0: 6f6b 2e53 6574 5365 6c65 6374 696f 6e28  ok.SetSelection(
+00055bd0: 3029 0d0a 2020 2020 2020 2020 6275 7379  0)..        busy
+00055be0: 2e43 6c6f 7365 2829 0d0a 0d0a 0d0a 2020  .Close()......  
+00055bf0: 2020 6465 6620 6372 6561 7465 5f70 6167    def create_pag
+00055c00: 655f 6d65 7267 655f 616c 6c28 7365 6c66  e_merge_all(self
+00055c10: 2c20 6e6f 7465 626f 6f6b 293a 0d0a 2020  , notebook):..  
+00055c20: 2020 2020 2020 2222 2243 7265 6174 6573        """Creates
+00055c30: 2061 2070 6167 6520 666f 7220 6d65 7267   a page for merg
+00055c40: 696e 6720 616c 6c20 6368 6174 7320 6174  ing all chats at
+00055c50: 206f 6e63 652e 2222 220d 0a20 2020 2020   once."""..     
+00055c60: 2020 2070 6167 6520 3d20 7365 6c66 2e70     page = self.p
+00055c70: 6167 655f 6d65 7267 655f 616c 6c20 3d20  age_merge_all = 
+00055c80: 7778 2e6c 6962 2e73 6372 6f6c 6c65 6470  wx.lib.scrolledp
+00055c90: 616e 656c 2e53 6372 6f6c 6c65 6450 616e  anel.ScrolledPan
+00055ca0: 656c 286e 6f74 6562 6f6f 6b29 0d0a 2020  el(notebook)..  
+00055cb0: 2020 2020 2020 7365 6c66 2e70 6167 656f        self.pageo
+00055cc0: 7264 6572 5b70 6167 655d 203d 206c 656e  rder[page] = len
+00055cd0: 2873 656c 662e 7061 6765 6f72 6465 7229  (self.pageorder)
+00055ce0: 0d0a 2020 2020 2020 2020 6e6f 7465 626f  ..        notebo
+00055cf0: 6f6b 2e41 6464 5061 6765 2870 6167 652c  ok.AddPage(page,
+00055d00: 2022 4d65 7267 6520 616c 6c22 290d 0a0d   "Merge all")...
+00055d10: 0a20 2020 2020 2020 2070 616e 656c 203d  .        panel =
+00055d20: 2077 782e 5061 6e65 6c28 7061 6765 2c20   wx.Panel(page, 
+00055d30: 7374 796c 653d 7778 2e42 4f52 4445 525f  style=wx.BORDER_
+00055d40: 5354 4154 4943 290d 0a20 2020 2020 2020  STATIC)..       
+00055d50: 206c 6162 656c 3120 3d20 7365 6c66 2e6c   label1 = self.l
+00055d60: 6162 656c 5f61 6c6c 3120 3d20 7778 2e53  abel_all1 = wx.S
+00055d70: 7461 7469 6354 6578 7428 7061 6e65 6c2c  taticText(panel,
+00055d80: 2073 7479 6c65 3d77 782e 414c 4947 4e5f   style=wx.ALIGN_
+00055d90: 5249 4748 542c 0d0a 2020 2020 2020 2020  RIGHT,..        
+00055da0: 2020 2020 6c61 6265 6c3d 2225 735c 6e5c      label="%s\n\
+00055db0: 6e41 6e61 6c79 7a69 6e67 2e2e 2573 2220  nAnalyzing..%s" 
+00055dc0: 2520 2873 656c 662e 6462 312c 2022 5c6e  % (self.db1, "\n
+00055dd0: 2220 2a20 3729 290d 0a20 2020 2020 2020  " * 7))..       
+00055de0: 2062 6d70 5f61 7272 6f77 203d 2077 782e   bmp_arrow = wx.
+00055df0: 5374 6174 6963 4269 746d 6170 2870 616e  StaticBitmap(pan
+00055e00: 656c 2c20 6269 746d 6170 3d69 6d61 6765  el, bitmap=image
+00055e10: 732e 4d65 7267 6554 6f52 6967 6874 2e42  s.MergeToRight.B
+00055e20: 6974 6d61 7029 0d0a 2020 2020 2020 2020  itmap)..        
+00055e30: 6c61 6265 6c32 203d 2073 656c 662e 6c61  label2 = self.la
+00055e40: 6265 6c5f 616c 6c32 203d 2077 782e 5374  bel_all2 = wx.St
+00055e50: 6174 6963 5465 7874 2870 616e 656c 2c0d  aticText(panel,.
+00055e60: 0a20 2020 2020 2020 2020 2020 206c 6162  .            lab
+00055e70: 656c 3d22 2573 5c6e 5c6e 416e 616c 797a  el="%s\n\nAnalyz
+00055e80: 696e 672e 2e25 7322 2025 2028 7365 6c66  ing..%s" % (self
+00055e90: 2e64 6232 2c20 225c 6e22 202a 2037 2929  .db2, "\n" * 7))
+00055ea0: 0d0a 2020 2020 2020 2020 6275 7474 6f6e  ..        button
+00055eb0: 5f73 6361 6e20 3d20 7365 6c66 2e62 7574  _scan = self.but
+00055ec0: 746f 6e5f 7363 616e 5f61 6c6c 203d 2063  ton_scan_all = c
+00055ed0: 6f6e 7472 6f6c 732e 4e6f 7465 4275 7474  ontrols.NoteButt
+00055ee0: 6f6e 2870 616e 656c 2c0d 0a20 2020 2020  on(panel,..     
+00055ef0: 2020 2020 2020 206c 6162 656c 3d22 2653         label="&S
+00055f00: 6361 6e20 616e 6420 7265 706f 7274 222c  can and report",
+00055f10: 206e 6f74 653d 2253 6361 6e20 7468 726f   note="Scan thro
+00055f20: 7567 6820 7468 6520 6c65 6674 2064 6174  ugh the left dat
+00055f30: 6162 6173 6520 220d 0a20 2020 2020 2020  abase "..       
+00055f40: 2020 2020 2022 616e 6420 6669 6e64 206d       "and find m
+00055f50: 6573 7361 6765 7320 6e6f 7420 7072 6573  essages not pres
+00055f60: 656e 7420 6f6e 2074 6865 2072 6967 6874  ent on the right
+00055f70: 2e22 2c0d 0a20 2020 2020 2020 2020 2020  .",..           
+00055f80: 2062 6d70 3d69 6d61 6765 732e 4275 7474   bmp=images.Butt
+00055f90: 6f6e 5363 616e 4469 6666 2e42 6974 6d61  onScanDiff.Bitma
+00055fa0: 7029 0d0a 2020 2020 2020 2020 6275 7474  p)..        butt
+00055fb0: 6f6e 5f6d 6572 6765 203d 2073 656c 662e  on_merge = self.
+00055fc0: 6275 7474 6f6e 5f6d 6572 6765 5f61 6c6c  button_merge_all
+00055fd0: 203d 2063 6f6e 7472 6f6c 732e 4e6f 7465   = controls.Note
+00055fe0: 4275 7474 6f6e 2870 616e 656c 2c0d 0a20  Button(panel,.. 
+00055ff0: 2020 2020 2020 2020 2020 206c 6162 656c             label
+00056000: 3d22 264d 6572 6765 2074 6f20 7468 6520  ="&Merge to the 
+00056010: 7269 6768 7422 2c20 6e6f 7465 3d73 656c  right", note=sel
+00056020: 662e 4d45 5247 455f 4255 5454 4f4e 5f4e  f.MERGE_BUTTON_N
+00056030: 4f54 452c 0d0a 2020 2020 2020 2020 2020  OTE,..          
+00056040: 2020 626d 703d 696d 6167 6573 2e42 7574    bmp=images.But
+00056050: 746f 6e4d 6572 6765 4c65 6674 4d75 6c74  tonMergeLeftMult
+00056060: 692e 4269 746d 6170 290d 0a20 2020 2020  i.Bitmap)..     
+00056070: 2020 2070 616e 656c 5f67 6175 6765 203d     panel_gauge =
+00056080: 2073 656c 662e 7061 6e65 6c5f 6761 7567   self.panel_gaug
+00056090: 6520 3d20 7778 2e50 616e 656c 2870 616e  e = wx.Panel(pan
+000560a0: 656c 290d 0a20 2020 2020 2020 206c 6162  el)..        lab
+000560b0: 656c 5f67 6175 6765 203d 2073 656c 662e  el_gauge = self.
+000560c0: 6c61 6265 6c5f 6761 7567 6520 3d20 7778  label_gauge = wx
+000560d0: 2e53 7461 7469 6354 6578 7428 7061 6e65  .StaticText(pane
+000560e0: 6c5f 6761 7567 652c 206c 6162 656c 3d22  l_gauge, label="
+000560f0: 2229 0d0a 2020 2020 2020 2020 6761 7567  ")..        gaug
+00056100: 6520 3d20 7365 6c66 2e67 6175 6765 5f70  e = self.gauge_p
+00056110: 726f 6772 6573 7320 3d20 7778 2e47 6175  rogress = wx.Gau
+00056120: 6765 2870 616e 656c 5f67 6175 6765 2c20  ge(panel_gauge, 
+00056130: 7369 7a65 3d28 3430 302c 2031 3529 2c0d  size=(400, 15),.
+00056140: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00056150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00056160: 2020 2020 2020 2073 7479 6c65 3d77 782e         style=wx.
+00056170: 4741 5f48 4f52 495a 4f4e 5441 4c20 7c20  GA_HORIZONTAL | 
+00056180: 7778 2e50 445f 534d 4f4f 5448 290d 0a20  wx.PD_SMOOTH).. 
+00056190: 2020 2020 2020 2068 746d 6c20 3d20 7365         html = se
+000561a0: 6c66 2e68 746d 6c5f 7265 706f 7274 203d  lf.html_report =
+000561b0: 205c 0d0a 2020 2020 2020 2020 2020 2020   \..            
+000561c0: 636f 6e74 726f 6c73 2e53 6372 6f6c 6c69  controls.Scrolli
+000561d0: 6e67 4874 6d6c 5769 6e64 6f77 2870 616e  ngHtmlWindow(pan
+000561e0: 656c 2c20 7374 796c 653d 7778 2e42 4f52  el, style=wx.BOR
+000561f0: 4445 525f 5355 4e4b 454e 290d 0a0d 0a20  DER_SUNKEN).... 
+00056200: 2020 2020 2020 2066 6f72 2063 2069 6e20         for c in 
+00056210: 5b70 616e 656c 2c20 6275 7474 6f6e 5f73  [panel, button_s
+00056220: 6361 6e2c 2062 7574 746f 6e5f 6d65 7267  can, button_merg
+00056230: 652c 2070 616e 656c 5f67 6175 6765 5d3a  e, panel_gauge]:
+00056240: 0d0a 2020 2020 2020 2020 2020 2020 436f  ..            Co
+00056250: 6c6f 7572 4d61 6e61 6765 722e 4d61 6e61  lourManager.Mana
+00056260: 6765 2863 2c20 2242 6163 6b67 726f 756e  ge(c, "Backgroun
+00056270: 6443 6f6c 6f75 7222 2c20 2242 6743 6f6c  dColour", "BgCol
+00056280: 6f75 7222 290d 0a20 2020 2020 2020 2067  our")..        g
+00056290: 6175 6765 2e46 6f72 6567 726f 756e 6443  auge.ForegroundC
+000562a0: 6f6c 6f75 7220 3d20 636f 6e66 2e47 6175  olour = conf.Gau
+000562b0: 6765 436f 6c6f 7572 0d0a 2020 2020 2020  geColour..      
+000562c0: 2020 6275 7474 6f6e 5f73 6361 6e2e 456e    button_scan.En
+000562d0: 6162 6c65 6420 3d20 6275 7474 6f6e 5f6d  abled = button_m
+000562e0: 6572 6765 2e45 6e61 626c 6564 203d 2046  erge.Enabled = F
+000562f0: 616c 7365 0d0a 2020 2020 2020 2020 6275  alse..        bu
+00056300: 7474 6f6e 5f73 6361 6e2e 4d69 6e53 697a  tton_scan.MinSiz
+00056310: 6520 3d20 6275 7474 6f6e 5f6d 6572 6765  e = button_merge
+00056320: 2e4d 696e 5369 7a65 203d 2028 3430 302c  .MinSize = (400,
+00056330: 202d 3129 0d0a 2020 2020 2020 2020 6874   -1)..        ht
+00056340: 6d6c 2e53 6574 466f 6e74 7328 6e6f 726d  ml.SetFonts(norm
+00056350: 616c 5f66 6163 653d 7365 6c66 2e46 6f6e  al_face=self.Fon
+00056360: 742e 4661 6365 4e61 6d65 2c0d 0a20 2020  t.FaceName,..   
+00056370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00056380: 2020 2066 6978 6564 5f66 6163 653d 7365     fixed_face=se
+00056390: 6c66 2e46 6f6e 742e 4661 6365 4e61 6d65  lf.Font.FaceName
+000563a0: 2c20 7369 7a65 733d 5b38 5d20 2a20 3729  , sizes=[8] * 7)
+000563b0: 0d0a 2020 2020 2020 2020 436f 6c6f 7572  ..        Colour
+000563c0: 4d61 6e61 6765 722e 4d61 6e61 6765 2868  Manager.Manage(h
+000563d0: 746d 6c2c 2022 466f 7265 6772 6f75 6e64  tml, "Foreground
+000563e0: 436f 6c6f 7572 222c 2022 4667 436f 6c6f  Colour", "FgColo
+000563f0: 7572 2229 0d0a 2020 2020 2020 2020 436f  ur")..        Co
+00056400: 6c6f 7572 4d61 6e61 6765 722e 4d61 6e61  lourManager.Mana
+00056410: 6765 2868 746d 6c2c 2022 4261 636b 6772  ge(html, "Backgr
+00056420: 6f75 6e64 436f 6c6f 7572 222c 2022 4d65  oundColour", "Me
+00056430: 7267 6548 746d 6c42 6163 6b67 726f 756e  rgeHtmlBackgroun
+00056440: 6443 6f6c 6f75 7222 290d 0a20 2020 2020  dColour")..     
+00056450: 2020 2068 746d 6c2e 4869 6465 2829 0d0a     html.Hide()..
+00056460: 2020 2020 2020 2020 7061 6e65 6c5f 6761          panel_ga
+00056470: 7567 652e 4869 6465 2829 0d0a 0d0a 2020  uge.Hide()....  
+00056480: 2020 2020 2020 7061 6765 2e53 697a 6572        page.Sizer
+00056490: 203d 2077 782e 426f 7853 697a 6572 2877   = wx.BoxSizer(w
+000564a0: 782e 5645 5254 4943 414c 290d 0a20 2020  x.VERTICAL)..   
+000564b0: 2020 2020 2073 697a 6572 203d 2070 616e       sizer = pan
+000564c0: 656c 2e53 697a 6572 203d 2077 782e 426f  el.Sizer = wx.Bo
+000564d0: 7853 697a 6572 2877 782e 5645 5254 4943  xSizer(wx.VERTIC
+000564e0: 414c 290d 0a20 2020 2020 2020 2073 697a  AL)..        siz
+000564f0: 6572 5f74 6f70 203d 2077 782e 4772 6964  er_top = wx.Grid
+00056500: 4261 6753 697a 6572 2876 6761 703d 352c  BagSizer(vgap=5,
+00056510: 2068 6761 703d 3330 290d 0a20 2020 2020   hgap=30)..     
+00056520: 2020 2070 616e 656c 5f67 6175 6765 2e53     panel_gauge.S
+00056530: 697a 6572 203d 2077 782e 426f 7853 697a  izer = wx.BoxSiz
+00056540: 6572 2877 782e 5645 5254 4943 414c 290d  er(wx.VERTICAL).
+00056550: 0a0d 0a20 2020 2020 2020 2070 6167 652e  ...        page.
+00056560: 5369 7a65 722e 4164 6428 7061 6e65 6c2c  Sizer.Add(panel,
+00056570: 2070 726f 706f 7274 696f 6e3d 312c 2062   proportion=1, b
+00056580: 6f72 6465 723d 352c 2066 6c61 673d 7778  order=5, flag=wx
+00056590: 2e47 524f 5720 7c20 7778 2e4c 4546 5429  .GROW | wx.LEFT)
+000565a0: 0d0a 2020 2020 2020 2020 7369 7a65 725f  ..        sizer_
+000565b0: 746f 702e 4164 6428 6c61 6265 6c31 2c20  top.Add(label1, 
+000565c0: 666c 6167 3d77 782e 414c 4947 4e5f 5249  flag=wx.ALIGN_RI
+000565d0: 4748 542c 2070 6f73 3d28 302c 2030 2929  GHT, pos=(0, 0))
+000565e0: 0d0a 2020 2020 2020 2020 7369 7a65 725f  ..        sizer_
+000565f0: 746f 702e 4164 6428 626d 705f 6172 726f  top.Add(bmp_arro
+00056600: 772c 2066 6c61 673d 7778 2e41 4c49 474e  w, flag=wx.ALIGN
+00056610: 5f43 454e 5445 522c 2070 6f73 3d28 302c  _CENTER, pos=(0,
+00056620: 2031 2929 0d0a 2020 2020 2020 2020 7369   1))..        si
+00056630: 7a65 725f 746f 702e 4164 6428 6c61 6265  zer_top.Add(labe
+00056640: 6c32 2c20 706f 733d 2830 2c20 3229 290d  l2, pos=(0, 2)).
+00056650: 0a20 2020 2020 2020 2073 697a 6572 5f74  .        sizer_t
+00056660: 6f70 2e41 6464 2862 7574 746f 6e5f 7363  op.Add(button_sc
+00056670: 616e 2c20 626f 7264 6572 3d32 352c 2066  an, border=25, f
+00056680: 6c61 673d 7778 2e54 4f50 207c 2077 782e  lag=wx.TOP | wx.
+00056690: 4752 4f57 2c20 706f 733d 2831 2c20 3129  GROW, pos=(1, 1)
+000566a0: 2c20 7370 616e 3d28 312c 2032 2929 0d0a  , span=(1, 2))..
+000566b0: 2020 2020 2020 2020 7369 7a65 725f 746f          sizer_to
+000566c0: 702e 4164 6428 6275 7474 6f6e 5f6d 6572  p.Add(button_mer
+000566d0: 6765 2c20 666c 6167 3d77 782e 4752 4f57  ge, flag=wx.GROW
+000566e0: 2c20 706f 733d 2832 2c20 3129 2c20 7370  , pos=(2, 1), sp
+000566f0: 616e 3d28 312c 2032 2929 0d0a 2020 2020  an=(1, 2))..    
+00056700: 2020 2020 7061 6e65 6c5f 6761 7567 652e      panel_gauge.
+00056710: 5369 7a65 722e 4164 6428 6c61 6265 6c5f  Sizer.Add(label_
+00056720: 6761 7567 652c 2066 6c61 673d 7778 2e41  gauge, flag=wx.A
+00056730: 4c49 474e 5f43 454e 5445 5229 0d0a 2020  LIGN_CENTER)..  
+00056740: 2020 2020 2020 7061 6e65 6c5f 6761 7567        panel_gaug
+00056750: 652e 5369 7a65 722e 4164 6428 6761 7567  e.Sizer.Add(gaug
+00056760: 652c 2066 6c61 673d 7778 2e41 4c49 474e  e, flag=wx.ALIGN
+00056770: 5f43 454e 5445 5229 0d0a 2020 2020 2020  _CENTER)..      
+00056780: 2020 7369 7a65 722e 4164 6428 7369 7a65    sizer.Add(size
+00056790: 725f 746f 702c 2062 6f72 6465 723d 3130  r_top, border=10
+000567a0: 2c20 666c 6167 3d77 782e 414c 4c20 7c20  , flag=wx.ALL | 
+000567b0: 7778 2e41 4c49 474e 5f43 454e 5445 5229  wx.ALIGN_CENTER)
+000567c0: 0d0a 2020 2020 2020 2020 7369 7a65 722e  ..        sizer.
+000567d0: 4164 6428 7061 6e65 6c5f 6761 7567 652c  Add(panel_gauge,
+000567e0: 2062 6f72 6465 723d 3130 2c20 666c 6167   border=10, flag
+000567f0: 3d77 782e 414c 4c20 7c20 7778 2e47 524f  =wx.ALL | wx.GRO
+00056800: 5729 0d0a 2020 2020 2020 2020 7369 7a65  W)..        size
+00056810: 722e 4164 6428 6874 6d6c 2c20 7072 6f70  r.Add(html, prop
+00056820: 6f72 7469 6f6e 3d31 2c20 626f 7264 6572  ortion=1, border
+00056830: 3d33 302c 2066 6c61 673d 7778 2e4c 4546  =30, flag=wx.LEF
+00056840: 5420 7c20 7778 2e52 4947 4854 207c 2077  T | wx.RIGHT | w
+00056850: 782e 424f 5454 4f4d 207c 2077 782e 4752  x.BOTTOM | wx.GR
+00056860: 4f57 290d 0a20 2020 2020 2020 2073 697a  OW)..        siz
+00056870: 6572 5f74 6f70 2e41 6464 4772 6f77 6162  er_top.AddGrowab
+00056880: 6c65 436f 6c28 3029 0d0a 2020 2020 2020  leCol(0)..      
+00056890: 2020 7369 7a65 725f 746f 702e 4164 6447    sizer_top.AddG
+000568a0: 726f 7761 626c 6543 6f6c 2832 290d 0a20  rowableCol(2).. 
+000568b0: 2020 2020 2020 2070 6167 652e 5365 7475         page.Setu
+000568c0: 7053 6372 6f6c 6c69 6e67 2829 0d0a 0d0a  pScrolling()....
+000568d0: 2020 2020 2020 2020 6275 7474 6f6e 5f73          button_s
+000568e0: 6361 6e2e 4269 6e64 2877 782e 4556 545f  can.Bind(wx.EVT_
+000568f0: 4255 5454 4f4e 2c20 7365 6c66 2e6f 6e5f  BUTTON, self.on_
+00056900: 7363 616e 5f61 6c6c 290d 0a20 2020 2020  scan_all)..     
+00056910: 2020 2062 7574 746f 6e5f 6d65 7267 652e     button_merge.
+00056920: 4269 6e64 2877 782e 4556 545f 4255 5454  Bind(wx.EVT_BUTT
+00056930: 4f4e 2c20 7365 6c66 2e6f 6e5f 6d65 7267  ON, self.on_merg
+00056940: 655f 616c 6c29 0d0a 2020 2020 2020 2020  e_all)..        
+00056950: 6874 6d6c 2e42 696e 6428 7778 2e68 746d  html.Bind(wx.htm
+00056960: 6c2e 4556 545f 4854 4d4c 5f4c 494e 4b5f  l.EVT_HTML_LINK_
+00056970: 434c 4943 4b45 442c 2073 656c 662e 6f6e  CLICKED, self.on
+00056980: 5f63 6c69 636b 5f68 746d 6c64 6966 6629  _click_htmldiff)
+00056990: 0d0a 0d0a 0d0a 2020 2020 6465 6620 6372  ......    def cr
+000569a0: 6561 7465 5f70 6167 655f 6d65 7267 655f  eate_page_merge_
+000569b0: 6368 6174 7328 7365 6c66 2c20 6e6f 7465  chats(self, note
+000569c0: 626f 6f6b 293a 0d0a 2020 2020 2020 2020  book):..        
+000569d0: 2222 2243 7265 6174 6573 2061 2070 6167  """Creates a pag
+000569e0: 6520 666f 7220 7365 6569 6e67 2061 6e64  e for seeing and
+000569f0: 206d 6572 6769 6e67 2064 6966 6665 7269   merging differi
+00056a00: 6e67 2063 6861 7473 2e22 2222 0d0a 2020  ng chats."""..  
+00056a10: 2020 2020 2020 7061 6765 203d 2073 656c        page = sel
+00056a20: 662e 7061 6765 5f6d 6572 6765 5f63 6861  f.page_merge_cha
+00056a30: 7473 203d 2077 782e 5061 6e65 6c28 7061  ts = wx.Panel(pa
+00056a40: 7265 6e74 3d6e 6f74 6562 6f6f 6b29 0d0a  rent=notebook)..
+00056a50: 2020 2020 2020 2020 7365 6c66 2e70 6167          self.pag
+00056a60: 656f 7264 6572 5b70 6167 655d 203d 206c  eorder[page] = l
+00056a70: 656e 2873 656c 662e 7061 6765 6f72 6465  en(self.pageorde
+00056a80: 7229 0d0a 2020 2020 2020 2020 6e6f 7465  r)..        note
+00056a90: 626f 6f6b 2e41 6464 5061 6765 2870 6167  book.AddPage(pag
+00056aa0: 652c 2022 4368 6174 7322 290d 0a20 2020  e, "Chats")..   
+00056ab0: 2020 2020 2073 697a 6572 203d 2070 6167       sizer = pag
+00056ac0: 652e 5369 7a65 7220 3d20 7778 2e42 6f78  e.Sizer = wx.Box
+00056ad0: 5369 7a65 7228 7778 2e56 4552 5449 4341  Sizer(wx.VERTICA
+00056ae0: 4c29 0d0a 2020 2020 2020 2020 7370 6c69  L)..        spli
+00056af0: 7474 6572 203d 2073 656c 662e 7370 6c69  tter = self.spli
+00056b00: 7474 6572 5f6d 6572 6765 203d 2077 782e  tter_merge = wx.
+00056b10: 5370 6c69 7474 6572 5769 6e64 6f77 280d  SplitterWindow(.
+00056b20: 0a20 2020 2020 2020 2020 2020 2070 6172  .            par
+00056b30: 656e 743d 7061 6765 2c20 7374 796c 653d  ent=page, style=
+00056b40: 7778 2e42 4f52 4445 525f 4e4f 4e45 0d0a  wx.BORDER_NONE..
+00056b50: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
+00056b60: 2020 2073 706c 6974 7465 722e 5365 744d     splitter.SetM
+00056b70: 696e 696d 756d 5061 6e65 5369 7a65 2831  inimumPaneSize(1
+00056b80: 3030 290d 0a20 2020 2020 2020 2070 616e  00)..        pan
+00056b90: 656c 3120 3d20 7778 2e50 616e 656c 2870  el1 = wx.Panel(p
+00056ba0: 6172 656e 743d 7370 6c69 7474 6572 290d  arent=splitter).
+00056bb0: 0a20 2020 2020 2020 2070 616e 656c 3220  .        panel2 
+00056bc0: 3d20 7778 2e50 616e 656c 2870 6172 656e  = wx.Panel(paren
+00056bd0: 743d 7370 6c69 7474 6572 290d 0a20 2020  t=splitter)..   
+00056be0: 2020 2020 2073 697a 6572 3120 3d20 7061       sizer1 = pa
+00056bf0: 6e65 6c31 2e53 697a 6572 203d 2077 782e  nel1.Sizer = wx.
+00056c00: 426f 7853 697a 6572 2877 782e 5645 5254  BoxSizer(wx.VERT
+00056c10: 4943 414c 290d 0a20 2020 2020 2020 2073  ICAL)..        s
+00056c20: 697a 6572 3220 3d20 7061 6e65 6c32 2e53  izer2 = panel2.S
+00056c30: 697a 6572 203d 2077 782e 426f 7853 697a  izer = wx.BoxSiz
+00056c40: 6572 2877 782e 5645 5254 4943 414c 290d  er(wx.VERTICAL).
+00056c50: 0a20 2020 2020 2020 2073 697a 6572 5f74  .        sizer_t
+00056c60: 6f70 203d 2077 782e 426f 7853 697a 6572  op = wx.BoxSizer
+00056c70: 2877 782e 484f 5249 5a4f 4e54 414c 290d  (wx.HORIZONTAL).
+00056c80: 0a0d 0a20 2020 2020 2020 2073 697a 6572  ...        sizer
+00056c90: 5f74 6f70 2e41 6464 2877 782e 5374 6174  _top.Add(wx.Stat
+00056ca0: 6963 5465 7874 2870 6172 656e 743d 7061  icText(parent=pa
+00056cb0: 6e65 6c31 2c20 6c61 6265 6c3d 2226 4368  nel1, label="&Ch
+00056cc0: 6174 2063 6f6d 7061 7269 736f 6e3a 222c  at comparison:",
+00056cd0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00056ce0: 2020 2020 2020 2020 6e61 6d65 3d22 6368          name="ch
+00056cf0: 6174 735f 6c61 6265 6c22 292c 2066 6c61  ats_label"), fla
+00056d00: 673d 7778 2e41 4c49 474e 5f43 454e 5445  g=wx.ALIGN_CENTE
+00056d10: 525f 5645 5254 4943 414c 290d 0a20 2020  R_VERTICAL)..   
+00056d20: 2020 2020 2073 697a 6572 5f74 6f70 2e41       sizer_top.A
+00056d30: 6464 5374 7265 7463 6853 7061 6365 7228  ddStretchSpacer(
+00056d40: 290d 0a20 2020 2020 2020 2065 6469 745f  )..        edit_
+00056d50: 6368 6174 6669 6c74 6572 203d 2073 656c  chatfilter = sel
+00056d60: 662e 6564 6974 5f63 6861 7466 696c 7465  f.edit_chatfilte
+00056d70: 7220 3d20 636f 6e74 726f 6c73 2e48 696e  r = controls.Hin
+00056d80: 7465 6454 6578 7443 7472 6c28 0d0a 2020  tedTextCtrl(..  
+00056d90: 2020 2020 2020 2020 2020 7061 6e65 6c31            panel1
+00056da0: 2c20 2246 696c 7465 7220 6368 6174 7322  , "Filter chats"
+00056db0: 2c20 7374 796c 653d 7778 2e54 455f 5052  , style=wx.TE_PR
+00056dc0: 4f43 4553 535f 454e 5445 522c 2073 697a  OCESS_ENTER, siz
+00056dd0: 653d 2837 352c 202d 3129 290d 0a20 2020  e=(75, -1))..   
+00056de0: 2020 2020 2065 6469 745f 6368 6174 6669       edit_chatfi
+00056df0: 6c74 6572 2e53 6574 546f 6f6c 5469 7028  lter.SetToolTip(
+00056e00: 2246 696c 7465 7220 6974 656d 7320 696e  "Filter items in
+00056e10: 2063 6861 7420 6c69 7374 2229 0d0a 2020   chat list")..  
+00056e20: 2020 2020 2020 7365 6c66 2e42 696e 6428        self.Bind(
+00056e30: 7778 2e45 5654 5f54 4558 545f 454e 5445  wx.EVT_TEXT_ENTE
+00056e40: 522c 2073 656c 662e 6f6e 5f63 6861 6e67  R, self.on_chang
+00056e50: 655f 6368 6174 6669 6c74 6572 2c20 6564  e_chatfilter, ed
+00056e60: 6974 5f63 6861 7466 696c 7465 7229 0d0a  it_chatfilter)..
+00056e70: 2020 2020 2020 2020 7369 7a65 725f 746f          sizer_to
+00056e80: 702e 4164 6428 6564 6974 5f63 6861 7466  p.Add(edit_chatf
+00056e90: 696c 7465 722c 2066 6c61 673d 7778 2e42  ilter, flag=wx.B
+00056ea0: 4f54 544f 4d20 7c20 7778 2e41 4c49 474e  OTTOM | wx.ALIGN
+00056eb0: 5f54 4f50 2c20 626f 7264 6572 3d35 290d  _TOP, border=5).
+00056ec0: 0a20 2020 2020 2020 2073 697a 6572 5f74  .        sizer_t
+00056ed0: 6f70 2e41 6464 5370 6163 6572 2832 3029  op.AddSpacer(20)
+00056ee0: 0d0a 2020 2020 2020 2020 7365 6c66 2e62  ..        self.b
+00056ef0: 7574 746f 6e5f 6d65 7267 655f 6368 6174  utton_merge_chat
+00056f00: 7320 3d20 7778 2e42 7574 746f 6e28 7061  s = wx.Button(pa
+00056f10: 6e65 6c31 2c20 6c61 6265 6c3d 224d 6572  nel1, label="Mer
+00056f20: 6765 2026 7365 6c65 6374 6564 2229 0d0a  ge &selected")..
+00056f30: 2020 2020 2020 2020 6368 6174 735f 746f          chats_to
+00056f40: 6f6c 7469 7020 3d20 224d 6572 6765 2064  oltip = "Merge d
+00056f50: 6966 6665 7265 6e63 6573 2069 6e20 7365  ifferences in se
+00056f60: 6c65 6374 6564 2063 6861 7473 2074 6f20  lected chats to 
+00056f70: 7468 6520 7269 6768 7422 0d0a 2020 2020  the right"..    
+00056f80: 2020 2020 7365 6c66 2e62 7574 746f 6e5f      self.button_
+00056f90: 6d65 7267 655f 6368 6174 732e 5365 7454  merge_chats.SetT
+00056fa0: 6f6f 6c54 6970 2863 6861 7473 5f74 6f6f  oolTip(chats_too
+00056fb0: 6c74 6970 290d 0a20 2020 2020 2020 2073  ltip)..        s
+00056fc0: 656c 662e 6275 7474 6f6e 5f6d 6572 6765  elf.button_merge
+00056fd0: 5f63 6861 7473 2e45 6e61 626c 6564 203d  _chats.Enabled =
+00056fe0: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
+00056ff0: 7369 7a65 725f 746f 702e 4164 6428 7365  sizer_top.Add(se
+00057000: 6c66 2e62 7574 746f 6e5f 6d65 7267 655f  lf.button_merge_
+00057010: 6368 6174 732c 2066 6c61 673d 7778 2e41  chats, flag=wx.A
+00057020: 4c49 474e 5f54 4f50 207c 2077 782e 424f  LIGN_TOP | wx.BO
+00057030: 5454 4f4d 2c0d 0a20 2020 2020 2020 2020  TTOM,..         
+00057040: 2020 2020 2020 2020 2020 2020 2062 6f72               bor
+00057050: 6465 723d 3529 0d0a 2020 2020 2020 2020  der=5)..        
+00057060: 7365 6c66 2e42 696e 6428 7778 2e45 5654  self.Bind(wx.EVT
+00057070: 5f42 5554 544f 4e2c 2073 656c 662e 6f6e  _BUTTON, self.on
+00057080: 5f6d 6572 6765 5f63 6861 7473 2c20 7365  _merge_chats, se
+00057090: 6c66 2e62 7574 746f 6e5f 6d65 7267 655f  lf.button_merge_
+000570a0: 6368 6174 7329 0d0a 2020 2020 2020 2020  chats)..        
+000570b0: 7369 7a65 7231 2e41 6464 2873 697a 6572  sizer1.Add(sizer
+000570c0: 5f74 6f70 2c20 666c 6167 3d77 782e 4752  _top, flag=wx.GR
+000570d0: 4f57 290d 0a0d 0a20 2020 2020 2020 206c  OW)....        l
+000570e0: 6973 745f 6368 6174 7320 3d20 7365 6c66  ist_chats = self
+000570f0: 2e6c 6973 745f 6368 6174 7320 3d20 636f  .list_chats = co
+00057100: 6e74 726f 6c73 2e53 6f72 7461 626c 654c  ntrols.SortableL
+00057110: 6973 7456 6965 7728 0d0a 2020 2020 2020  istView(..      
+00057120: 2020 2020 2020 7061 7265 6e74 3d70 616e        parent=pan
+00057130: 656c 312c 2073 7479 6c65 3d77 782e 4c43  el1, style=wx.LC
+00057140: 5f52 4550 4f52 542c 206e 616d 653d 2263  _REPORT, name="c
+00057150: 6861 7473 2229 0d0a 2020 2020 2020 2020  hats")..        
+00057160: 6c69 7374 5f63 6861 7473 2e53 6574 436f  list_chats.SetCo
+00057170: 6c75 6d6e 7328 7365 6c66 2e63 6861 7473  lumns(self.chats
+00057180: 5f6c 6973 745f 636f 6c75 6d6e 7329 0d0a  _list_columns)..
+00057190: 2020 2020 2020 2020 6c69 7374 5f63 6861          list_cha
+000571a0: 7473 2e53 6574 436f 6c75 6d6e 734d 6178  ts.SetColumnsMax
+000571b0: 5769 6474 6828 3330 3029 0d0a 2020 2020  Width(300)..    
+000571c0: 2020 2020 6c69 7374 5f63 6861 7473 2e53      list_chats.S
+000571d0: 6f72 744c 6973 7449 7465 6d73 2833 2c20  ortListItems(3, 
+000571e0: 3029 2023 2053 6f72 7420 6279 206c 6173  0) # Sort by las
+000571f0: 7420 6d65 7373 6167 6520 696e 206c 6566  t message in lef
+00057200: 740d 0a20 2020 2020 2020 206c 6973 745f  t..        list_
+00057210: 6368 6174 732e 456e 6162 6c65 6420 3d20  chats.Enabled = 
+00057220: 4661 6c73 650d 0a20 2020 2020 2020 2073  False..        s
+00057230: 656c 662e 4269 6e64 2877 782e 4556 545f  elf.Bind(wx.EVT_
+00057240: 4c49 5354 5f49 5445 4d5f 4143 5449 5641  LIST_ITEM_ACTIVA
+00057250: 5445 442c 2073 656c 662e 6f6e 5f63 6861  TED, self.on_cha
+00057260: 6e67 655f 6c69 7374 5f63 6861 7473 2c0d  nge_list_chats,.
+00057270: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00057280: 2020 206c 6973 745f 6368 6174 7329 0d0a     list_chats)..
+00057290: 2020 2020 2020 2020 7369 7a65 7231 2e41          sizer1.A
+000572a0: 6464 286c 6973 745f 6368 6174 732c 2070  dd(list_chats, p
+000572b0: 726f 706f 7274 696f 6e3d 312c 2066 6c61  roportion=1, fla
+000572c0: 673d 7778 2e47 524f 5729 0d0a 0d0a 2020  g=wx.GROW)....  
+000572d0: 2020 2020 2020 6c61 6265 6c5f 6368 6174        label_chat
+000572e0: 203d 2073 656c 662e 6c61 6265 6c5f 6d65   = self.label_me
+000572f0: 7267 655f 6368 6174 203d 205c 0d0a 2020  rge_chat = \..  
+00057300: 2020 2020 2020 2020 2020 7778 2e53 7461            wx.Sta
+00057310: 7469 6354 6578 7428 7061 7265 6e74 3d70  ticText(parent=p
+00057320: 616e 656c 322c 206c 6162 656c 3d22 2229  anel2, label="")
+00057330: 0d0a 2020 2020 2020 2020 7370 6c69 7474  ..        splitt
+00057340: 6572 5f64 6966 6620 3d20 7365 6c66 2e73  er_diff = self.s
+00057350: 706c 6974 7465 725f 6469 6666 203d 2077  plitter_diff = w
+00057360: 782e 5370 6c69 7474 6572 5769 6e64 6f77  x.SplitterWindow
+00057370: 280d 0a20 2020 2020 2020 2020 2020 2070  (..            p
+00057380: 6172 656e 743d 7061 6e65 6c32 2c20 7374  arent=panel2, st
+00057390: 796c 653d 7778 2e42 4f52 4445 525f 4e4f  yle=wx.BORDER_NO
+000573a0: 4e45 290d 0a20 2020 2020 2020 2073 706c  NE)..        spl
+000573b0: 6974 7465 725f 6469 6666 2e53 6574 4d69  itter_diff.SetMi
+000573c0: 6e69 6d75 6d50 616e 6553 697a 6528 3335  nimumPaneSize(35
+000573d0: 3029 0d0a 2020 2020 2020 2020 7061 6e65  0)..        pane
+000573e0: 6c5f 7374 6331 203d 2073 656c 662e 7061  l_stc1 = self.pa
+000573f0: 6e65 6c5f 7374 6331 203d 2077 782e 5061  nel_stc1 = wx.Pa
+00057400: 6e65 6c28 7061 7265 6e74 3d73 706c 6974  nel(parent=split
+00057410: 7465 725f 6469 6666 290d 0a20 2020 2020  ter_diff)..     
+00057420: 2020 2070 616e 656c 5f73 7463 3220 3d20     panel_stc2 = 
+00057430: 7365 6c66 2e70 616e 656c 5f73 7463 3220  self.panel_stc2 
+00057440: 3d20 7778 2e6c 6962 2e73 6372 6f6c 6c65  = wx.lib.scrolle
+00057450: 6470 616e 656c 2e53 6372 6f6c 6c65 6450  dpanel.ScrolledP
+00057460: 616e 656c 2873 706c 6974 7465 725f 6469  anel(splitter_di
+00057470: 6666 290d 0a20 2020 2020 2020 2043 6f6c  ff)..        Col
+00057480: 6f75 724d 616e 6167 6572 2e4d 616e 6167  ourManager.Manag
+00057490: 6528 7061 6e65 6c5f 7374 6332 2c20 2242  e(panel_stc2, "B
+000574a0: 6163 6b67 726f 756e 6443 6f6c 6f75 7222  ackgroundColour"
+000574b0: 2c20 2242 6743 6f6c 6f75 7222 290d 0a20  , "BgColour").. 
+000574c0: 2020 2020 2020 2073 697a 6572 5f73 7463         sizer_stc
+000574d0: 3120 3d20 7061 6e65 6c5f 7374 6331 2e53  1 = panel_stc1.S
+000574e0: 697a 6572 203d 2077 782e 426f 7853 697a  izer = wx.BoxSiz
+000574f0: 6572 2877 782e 5645 5254 4943 414c 290d  er(wx.VERTICAL).
+00057500: 0a20 2020 2020 2020 2073 697a 6572 5f73  .        sizer_s
+00057510: 7463 3220 3d20 7061 6e65 6c5f 7374 6332  tc2 = panel_stc2
+00057520: 2e53 697a 6572 203d 2077 782e 426f 7853  .Sizer = wx.BoxS
+00057530: 697a 6572 2877 782e 5645 5254 4943 414c  izer(wx.VERTICAL
+00057540: 290d 0a0d 0a20 2020 2020 2020 2073 7463  )....        stc
+00057550: 3120 3d20 7365 6c66 2e73 7463 5f64 6966  1 = self.stc_dif
+00057560: 6631 203d 2043 6861 7443 6f6e 7465 6e74  f1 = ChatContent
+00057570: 5354 4328 0d0a 2020 2020 2020 2020 2020  STC(..          
+00057580: 2020 7061 7265 6e74 3d70 616e 656c 5f73    parent=panel_s
+00057590: 7463 312c 2073 7479 6c65 3d77 782e 424f  tc1, style=wx.BO
+000575a0: 5244 4552 5f53 5441 5449 4329 0d0a 2020  RDER_STATIC)..  
+000575b0: 2020 2020 2020 7374 6331 2e53 6574 4175        stc1.SetAu
+000575c0: 746f 5265 7472 6965 7665 2846 616c 7365  toRetrieve(False
+000575d0: 290d 0a20 2020 2020 2020 2073 7463 312e  )..        stc1.
+000575e0: 5445 5854 5f4e 4f5f 4d45 5353 4147 4553  TEXT_NO_MESSAGES
+000575f0: 203d 2022 5c6e 4e6f 206e 6577 206d 6573   = "\nNo new mes
+00057600: 7361 6765 7320 746f 2073 686f 772e 220d  sages to show.".
+00057610: 0a0d 0a20 2020 2020 2020 2062 7574 746f  ...        butto
+00057620: 6e5f 6d65 7267 6520 3d20 7365 6c66 2e62  n_merge = self.b
+00057630: 7574 746f 6e5f 6d65 7267 655f 6368 6174  utton_merge_chat
+00057640: 203d 2063 6f6e 7472 6f6c 732e 4e6f 7465   = controls.Note
+00057650: 4275 7474 6f6e 280d 0a20 2020 2020 2020  Button(..       
+00057660: 2020 2020 2070 616e 656c 5f73 7463 322c       panel_stc2,
+00057670: 206c 6162 656c 3d22 264d 6572 6765 2074   label="&Merge t
+00057680: 6f20 7468 6520 7269 6768 7422 2c0d 0a20  o the right",.. 
+00057690: 2020 2020 2020 2020 2020 206e 6f74 653d             note=
+000576a0: 7365 6c66 2e4d 4552 4745 5f43 4841 545f  self.MERGE_CHAT_
+000576b0: 4255 5454 4f4e 5f4e 4f54 452c 2062 6d70  BUTTON_NOTE, bmp
+000576c0: 3d69 6d61 6765 732e 4275 7474 6f6e 4d65  =images.ButtonMe
+000576d0: 7267 654c 6566 742e 4269 746d 6170 290d  rgeLeft.Bitmap).
+000576e0: 0a20 2020 2020 2020 2062 7574 746f 6e5f  .        button_
+000576f0: 6578 706f 7274 203d 2073 656c 662e 6275  export = self.bu
+00057700: 7474 6f6e 5f65 7870 6f72 745f 6368 6174  tton_export_chat
+00057710: 203d 2063 6f6e 7472 6f6c 732e 4e6f 7465   = controls.Note
+00057720: 4275 7474 6f6e 280d 0a20 2020 2020 2020  Button(..       
+00057730: 2020 2020 2070 616e 656c 5f73 7463 322c       panel_stc2,
+00057740: 206c 6162 656c 3d22 2645 7870 6f72 7420   label="&Export 
+00057750: 6d65 7373 6167 6573 222c 0d0a 2020 2020  messages",..    
+00057760: 2020 2020 2020 2020 6e6f 7465 3d22 4578          note="Ex
+00057770: 706f 7274 2064 6574 6563 7465 6420 6d65  port detected me
+00057780: 7373 6167 6573 2061 7320 4854 4d4c 2c20  ssages as HTML, 
+00057790: 7465 7874 206f 7220 7370 7265 6164 7368  text or spreadsh
+000577a0: 6565 742e 222c 0d0a 2020 2020 2020 2020  eet.",..        
+000577b0: 2020 2020 626d 703d 696d 6167 6573 2e42      bmp=images.B
+000577c0: 7574 746f 6e45 7870 6f72 742e 4269 746d  uttonExport.Bitm
+000577d0: 6170 290d 0a20 2020 2020 2020 2062 7574  ap)..        but
+000577e0: 746f 6e5f 6d65 7267 652e 4269 6e64 2877  ton_merge.Bind(w
+000577f0: 782e 4556 545f 4255 5454 4f4e 2c20 7365  x.EVT_BUTTON, se
+00057800: 6c66 2e6f 6e5f 6d65 7267 655f 6368 6174  lf.on_merge_chat
+00057810: 290d 0a20 2020 2020 2020 2062 7574 746f  )..        butto
+00057820: 6e5f 6578 706f 7274 2e42 696e 6428 7778  n_export.Bind(wx
+00057830: 2e45 5654 5f42 5554 544f 4e2c 2073 656c  .EVT_BUTTON, sel
+00057840: 662e 6f6e 5f65 7870 6f72 745f 6368 6174  f.on_export_chat
+00057850: 290d 0a20 2020 2020 2020 2043 6f6c 6f75  )..        Colou
+00057860: 724d 616e 6167 6572 2e4d 616e 6167 6528  rManager.Manage(
+00057870: 6275 7474 6f6e 5f6d 6572 6765 2c20 2022  button_merge,  "
+00057880: 4261 636b 6772 6f75 6e64 436f 6c6f 7572  BackgroundColour
+00057890: 222c 2022 4267 436f 6c6f 7572 2229 0d0a  ", "BgColour")..
+000578a0: 2020 2020 2020 2020 436f 6c6f 7572 4d61          ColourMa
+000578b0: 6e61 6765 722e 4d61 6e61 6765 2862 7574  nager.Manage(but
+000578c0: 746f 6e5f 6578 706f 7274 2c20 2242 6163  ton_export, "Bac
+000578d0: 6b67 726f 756e 6443 6f6c 6f75 7222 2c20  kgroundColour", 
+000578e0: 2242 6743 6f6c 6f75 7222 290d 0a20 2020  "BgColour")..   
+000578f0: 2020 2020 2062 7574 746f 6e5f 6d65 7267       button_merg
+00057900: 652e 456e 6162 6c65 6420 3d20 6275 7474  e.Enabled = butt
+00057910: 6f6e 5f65 7870 6f72 742e 456e 6162 6c65  on_export.Enable
+00057920: 6420 3d20 4661 6c73 650d 0a0d 0a20 2020  d = False....   
+00057930: 2020 2020 2073 697a 6572 5f73 7463 312e       sizer_stc1.
+00057940: 4164 6428 7374 6331 2c20 7072 6f70 6f72  Add(stc1, propor
+00057950: 7469 6f6e 3d31 2c20 666c 6167 3d77 782e  tion=1, flag=wx.
+00057960: 4752 4f57 290d 0a20 2020 2020 2020 2073  GROW)..        s
+00057970: 697a 6572 5f73 7463 322e 4164 6453 7472  izer_stc2.AddStr
+00057980: 6574 6368 5370 6163 6572 2829 0d0a 2020  etchSpacer()..  
+00057990: 2020 2020 2020 7369 7a65 725f 7374 6332        sizer_stc2
+000579a0: 2e41 6464 2862 7574 746f 6e5f 6d65 7267  .Add(button_merg
+000579b0: 652c 2062 6f72 6465 723d 352c 2020 666c  e, border=5,  fl
+000579c0: 6167 3d77 782e 414c 4c20 7c20 7778 2e47  ag=wx.ALL | wx.G
+000579d0: 524f 5729 0d0a 2020 2020 2020 2020 7369  ROW)..        si
+000579e0: 7a65 725f 7374 6332 2e41 6464 2862 7574  zer_stc2.Add(but
+000579f0: 746f 6e5f 6578 706f 7274 2c20 626f 7264  ton_export, bord
+00057a00: 6572 3d35 2c20 666c 6167 3d77 782e 414c  er=5, flag=wx.AL
+00057a10: 4c20 7c20 7778 2e47 524f 5729 0d0a 2020  L | wx.GROW)..  
+00057a20: 2020 2020 2020 7369 7a65 725f 7374 6332        sizer_stc2
+00057a30: 2e41 6464 5374 7265 7463 6853 7061 6365  .AddStretchSpace
+00057a40: 7228 290d 0a20 2020 2020 2020 2073 697a  r()..        siz
+00057a50: 6572 322e 4164 6428 6c61 6265 6c5f 6368  er2.Add(label_ch
+00057a60: 6174 2c20 626f 7264 6572 3d35 2c20 666c  at, border=5, fl
+00057a70: 6167 3d77 782e 414c 4c29 0d0a 2020 2020  ag=wx.ALL)..    
+00057a80: 2020 2020 7369 7a65 7232 2e41 6464 2873      sizer2.Add(s
+00057a90: 706c 6974 7465 725f 6469 6666 2c20 7072  plitter_diff, pr
+00057aa0: 6f70 6f72 7469 6f6e 3d31 2c20 666c 6167  oportion=1, flag
+00057ab0: 3d77 782e 4752 4f57 290d 0a0d 0a20 2020  =wx.GROW)....   
+00057ac0: 2020 2020 2073 697a 6572 2e41 6464 5370       sizer.AddSp
+00057ad0: 6163 6572 2835 290d 0a20 2020 2020 2020  acer(5)..       
+00057ae0: 2073 697a 6572 2e41 6464 2873 706c 6974   sizer.Add(split
+00057af0: 7465 722c 2062 6f72 6465 723d 352c 2070  ter, border=5, p
+00057b00: 726f 706f 7274 696f 6e3d 312c 2066 6c61  roportion=1, fla
+00057b10: 673d 7778 2e47 524f 5720 7c20 7778 2e41  g=wx.GROW | wx.A
+00057b20: 4c4c 290d 0a20 2020 2020 2020 2073 706c  LL)..        spl
+00057b30: 6974 7465 725f 6469 6666 2e53 6574 5361  itter_diff.SetSa
+00057b40: 7368 4772 6176 6974 7928 302e 3529 0d0a  shGravity(0.5)..
+00057b50: 2020 2020 2020 2020 7370 6c69 7474 6572          splitter
+00057b60: 5f64 6966 662e 5370 6c69 7456 6572 7469  _diff.SplitVerti
+00057b70: 6361 6c6c 7928 7061 6e65 6c5f 7374 6331  cally(panel_stc1
+00057b80: 2c20 7061 6e65 6c5f 7374 6332 2c0d 0a20  , panel_stc2,.. 
+00057b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00057ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00057bb0: 2020 2020 2073 6173 6850 6f73 6974 696f       sashPositio
+00057bc0: 6e3d 7365 6c66 2e53 697a 652e 7769 6474  n=self.Size.widt
+00057bd0: 6829 0d0a 2020 2020 2020 2020 7370 6c69  h)..        spli
+00057be0: 7474 6572 2e53 706c 6974 486f 7269 7a6f  tter.SplitHorizo
+00057bf0: 6e74 616c 6c79 2870 616e 656c 312c 2070  ntally(panel1, p
+00057c00: 616e 656c 322c 0d0a 2020 2020 2020 2020  anel2,..        
+00057c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00057c20: 2020 2020 2020 2020 2020 2073 6173 6850             sashP
+00057c30: 6f73 6974 696f 6e3d 7365 6c66 2e53 697a  osition=self.Siz
+00057c40: 652e 6865 6967 6874 202f 2f20 3329 0d0a  e.height // 3)..
+00057c50: 2020 2020 2020 2020 7061 6e65 6c5f 7374          panel_st
+00057c60: 6332 2e53 6574 7570 5363 726f 6c6c 696e  c2.SetupScrollin
+00057c70: 6728 7363 726f 6c6c 5f78 3d46 616c 7365  g(scroll_x=False
+00057c80: 290d 0a0d 0a0d 0a20 2020 2064 6566 2063  )......    def c
+00057c90: 7265 6174 655f 7061 6765 5f6d 6572 6765  reate_page_merge
+00057ca0: 5f63 6f6e 7461 6374 7328 7365 6c66 2c20  _contacts(self, 
+00057cb0: 6e6f 7465 626f 6f6b 293a 0d0a 2020 2020  notebook):..    
+00057cc0: 2020 2020 2222 2243 7265 6174 6573 2061      """Creates a
+00057cd0: 2070 6167 6520 666f 7220 7365 6569 6e67   page for seeing
+00057ce0: 2061 6e64 206d 6572 6769 6e67 2064 6966   and merging dif
+00057cf0: 6665 7269 6e67 2063 6f6e 7461 6374 732e  fering contacts.
+00057d00: 2222 220d 0a20 2020 2020 2020 2070 6167  """..        pag
+00057d10: 6520 3d20 7365 6c66 2e70 6167 655f 6d65  e = self.page_me
+00057d20: 7267 655f 636f 6e74 6163 7473 203d 2077  rge_contacts = w
+00057d30: 782e 5061 6e65 6c28 7061 7265 6e74 3d6e  x.Panel(parent=n
+00057d40: 6f74 6562 6f6f 6b29 0d0a 2020 2020 2020  otebook)..      
+00057d50: 2020 7365 6c66 2e70 6167 656f 7264 6572    self.pageorder
+00057d60: 5b70 6167 655d 203d 206c 656e 2873 656c  [page] = len(sel
+00057d70: 662e 7061 6765 6f72 6465 7229 0d0a 2020  f.pageorder)..  
+00057d80: 2020 2020 2020 6e6f 7465 626f 6f6b 2e41        notebook.A
+00057d90: 6464 5061 6765 2870 6167 652c 2022 436f  ddPage(page, "Co
+00057da0: 6e74 6163 7473 2229 0d0a 2020 2020 2020  ntacts")..      
+00057db0: 2020 7369 7a65 7220 3d20 7061 6765 2e53    sizer = page.S
+00057dc0: 697a 6572 203d 2077 782e 426f 7853 697a  izer = wx.BoxSiz
+00057dd0: 6572 2877 782e 5645 5254 4943 414c 290d  er(wx.VERTICAL).
+00057de0: 0a0d 0a20 2020 2020 2020 2073 706c 6974  ...        split
+00057df0: 7465 7220 3d20 7365 6c66 2e73 706c 6974  ter = self.split
+00057e00: 7465 725f 636f 6e74 6163 7473 203d 2077  ter_contacts = w
+00057e10: 782e 5370 6c69 7474 6572 5769 6e64 6f77  x.SplitterWindow
+00057e20: 280d 0a20 2020 2020 2020 2020 2020 2070  (..            p
+00057e30: 6172 656e 743d 7061 6765 2c20 7374 796c  arent=page, styl
+00057e40: 653d 7778 2e42 4f52 4445 525f 4e4f 4e45  e=wx.BORDER_NONE
+00057e50: 0d0a 2020 2020 2020 2020 290d 0a20 2020  ..        )..   
+00057e60: 2020 2020 2073 706c 6974 7465 722e 5365       splitter.Se
+00057e70: 744d 696e 696d 756d 5061 6e65 5369 7a65  tMinimumPaneSize
+00057e80: 2833 3530 290d 0a20 2020 2020 2020 2070  (350)..        p
+00057e90: 616e 656c 3120 3d20 7778 2e50 616e 656c  anel1 = wx.Panel
+00057ea0: 2870 6172 656e 743d 7370 6c69 7474 6572  (parent=splitter
+00057eb0: 290d 0a20 2020 2020 2020 2070 616e 656c  )..        panel
+00057ec0: 3220 3d20 7778 2e6c 6962 2e73 6372 6f6c  2 = wx.lib.scrol
+00057ed0: 6c65 6470 616e 656c 2e53 6372 6f6c 6c65  ledpanel.Scrolle
+00057ee0: 6450 616e 656c 2873 706c 6974 7465 7229  dPanel(splitter)
+00057ef0: 0d0a 2020 2020 2020 2020 436f 6c6f 7572  ..        Colour
+00057f00: 4d61 6e61 6765 722e 4d61 6e61 6765 2870  Manager.Manage(p
+00057f10: 616e 656c 322c 2022 4261 636b 6772 6f75  anel2, "Backgrou
+00057f20: 6e64 436f 6c6f 7572 222c 2022 4267 436f  ndColour", "BgCo
+00057f30: 6c6f 7572 2229 0d0a 2020 2020 2020 2020  lour")..        
+00057f40: 7369 7a65 7231 203d 2070 616e 656c 312e  sizer1 = panel1.
+00057f50: 5369 7a65 7220 3d20 7778 2e42 6f78 5369  Sizer = wx.BoxSi
+00057f60: 7a65 7228 7778 2e56 4552 5449 4341 4c29  zer(wx.VERTICAL)
+00057f70: 0d0a 2020 2020 2020 2020 7369 7a65 7232  ..        sizer2
+00057f80: 203d 2070 616e 656c 322e 5369 7a65 7220   = panel2.Sizer 
+00057f90: 3d20 7778 2e42 6f78 5369 7a65 7228 7778  = wx.BoxSizer(wx
+00057fa0: 2e56 4552 5449 4341 4c29 0d0a 0d0a 2020  .VERTICAL)....  
+00057fb0: 2020 2020 2020 7369 7a65 725f 746f 7020        sizer_top 
+00057fc0: 3d20 7778 2e42 6f78 5369 7a65 7228 7778  = wx.BoxSizer(wx
+00057fd0: 2e48 4f52 495a 4f4e 5441 4c29 0d0a 2020  .HORIZONTAL)..  
+00057fe0: 2020 2020 2020 6c62 6c20 3d20 7778 2e53        lbl = wx.S
+00057ff0: 7461 7469 6354 6578 7428 7061 7265 6e74  taticText(parent
+00058000: 3d70 616e 656c 312c 206c 6162 656c 3d22  =panel1, label="
+00058010: 4e65 7720 2663 6f6e 7461 6374 7320 6f6e  New &contacts on
+00058020: 2074 6865 206c 6566 743a 222c 0d0a 2020   the left:",..  
+00058030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00058040: 2020 2020 2020 2020 2020 6e61 6d65 3d22            name="
+00058050: 636f 6e74 6163 745f 6c69 7374 5f6c 6162  contact_list_lab
+00058060: 656c 2229 0d0a 2020 2020 2020 2020 7369  el")..        si
+00058070: 7a65 725f 746f 702e 4164 6428 6c62 6c2c  zer_top.Add(lbl,
+00058080: 2066 6c61 673d 7778 2e41 4c49 474e 5f43   flag=wx.ALIGN_C
+00058090: 454e 5445 525f 5645 5254 4943 414c 290d  ENTER_VERTICAL).
+000580a0: 0a20 2020 2020 2020 2073 697a 6572 5f74  .        sizer_t
+000580b0: 6f70 2e41 6464 5374 7265 7463 6853 7061  op.AddStretchSpa
+000580c0: 6365 7228 290d 0a20 2020 2020 2020 2065  cer()..        e
+000580d0: 6469 745f 636f 6e74 6163 7466 696c 7465  dit_contactfilte
+000580e0: 7220 3d20 7365 6c66 2e65 6469 745f 636f  r = self.edit_co
+000580f0: 6e74 6163 7466 696c 7465 7220 3d20 636f  ntactfilter = co
+00058100: 6e74 726f 6c73 2e48 696e 7465 6454 6578  ntrols.HintedTex
+00058110: 7443 7472 6c28 0d0a 2020 2020 2020 2020  tCtrl(..        
+00058120: 2020 2020 7061 6e65 6c31 2c20 2246 696c      panel1, "Fil
+00058130: 7465 7220 636f 6e74 6163 7473 222c 2073  ter contacts", s
+00058140: 7479 6c65 3d77 782e 5445 5f50 524f 4345  tyle=wx.TE_PROCE
+00058150: 5353 5f45 4e54 4552 2c20 7369 7a65 3d28  SS_ENTER, size=(
+00058160: 3930 2c20 2d31 2929 0d0a 2020 2020 2020  90, -1))..      
+00058170: 2020 6564 6974 5f63 6f6e 7461 6374 6669    edit_contactfi
+00058180: 6c74 6572 2e53 6574 546f 6f6c 5469 7028  lter.SetToolTip(
+00058190: 2246 696c 7465 7220 6974 656d 7320 696e  "Filter items in
+000581a0: 2063 6f6e 7461 6374 206c 6973 7473 2229   contact lists")
+000581b0: 0d0a 2020 2020 2020 2020 7365 6c66 2e42  ..        self.B
+000581c0: 696e 6428 7778 2e45 5654 5f54 4558 545f  ind(wx.EVT_TEXT_
+000581d0: 454e 5445 522c 2073 656c 662e 6f6e 5f63  ENTER, self.on_c
+000581e0: 6861 6e67 655f 636f 6e74 6163 7466 696c  hange_contactfil
+000581f0: 7465 722c 0d0a 2020 2020 2020 2020 2020  ter,..          
+00058200: 2020 2020 2020 2020 6564 6974 5f63 6f6e          edit_con
+00058210: 7461 6374 6669 6c74 6572 290d 0a20 2020  tactfilter)..   
+00058220: 2020 2020 2073 697a 6572 5f74 6f70 2e41       sizer_top.A
+00058230: 6464 2865 6469 745f 636f 6e74 6163 7466  dd(edit_contactf
+00058240: 696c 7465 7229 0d0a 0d0a 2020 2020 2020  ilter)....      
+00058250: 2020 6c69 7374 3120 3d20 7365 6c66 2e6c    list1 = self.l
+00058260: 6973 745f 636f 6e74 6163 7473 203d 2063  ist_contacts = c
+00058270: 6f6e 7472 6f6c 732e 536f 7274 6162 6c65  ontrols.Sortable
+00058280: 4c69 7374 5669 6577 280d 0a20 2020 2020  ListView(..     
+00058290: 2020 2020 2020 2070 6172 656e 743d 7061         parent=pa
+000582a0: 6e65 6c31 2c20 2073 7479 6c65 3d77 782e  nel1,  style=wx.
+000582b0: 4c43 5f52 4550 4f52 542c 206e 616d 653d  LC_REPORT, name=
+000582c0: 2263 6f6e 7461 6374 5f6c 6973 7422 290d  "contact_list").
+000582d0: 0a20 2020 2020 2020 206c 6973 7431 2e53  .        list1.S
+000582e0: 6574 436f 6c75 6d6e 7328 7365 6c66 2e63  etColumns(self.c
+000582f0: 6f6e 7461 6374 735f 6c69 7374 5f63 6f6c  ontacts_list_col
+00058300: 756d 6e73 290d 0a20 2020 2020 2020 206c  umns)..        l
+00058310: 6973 7431 2e53 6574 436f 6c75 6d6e 734d  ist1.SetColumnsM
+00058320: 6178 5769 6474 6828 3330 3029 0d0a 2020  axWidth(300)..  
+00058330: 2020 2020 2020 6c69 7374 312e 4269 6e64        list1.Bind
+00058340: 2877 782e 4556 545f 4c49 5354 5f49 5445  (wx.EVT_LIST_ITE
+00058350: 4d5f 5345 4c45 4354 4544 2c20 2020 7365  M_SELECTED,   se
+00058360: 6c66 2e6f 6e5f 7365 6c65 6374 5f6c 6973  lf.on_select_lis
+00058370: 745f 636f 6e74 6163 7473 290d 0a20 2020  t_contacts)..   
+00058380: 2020 2020 206c 6973 7431 2e42 696e 6428       list1.Bind(
+00058390: 7778 2e45 5654 5f4c 4953 545f 4954 454d  wx.EVT_LIST_ITEM
+000583a0: 5f44 4553 454c 4543 5445 442c 2073 656c  _DESELECTED, sel
+000583b0: 662e 6f6e 5f73 656c 6563 745f 6c69 7374  f.on_select_list
+000583c0: 5f63 6f6e 7461 6374 7329 0d0a 2020 2020  _contacts)..    
+000583d0: 2020 2020 6c69 7374 312e 4269 6e64 2877      list1.Bind(w
+000583e0: 782e 4556 545f 4c49 5354 5f49 5445 4d5f  x.EVT_LIST_ITEM_
+000583f0: 4143 5449 5641 5445 442c 2020 7365 6c66  ACTIVATED,  self
+00058400: 2e6f 6e5f 6d65 7267 655f 636f 6e74 6163  .on_merge_contac
+00058410: 7473 290d 0a0d 0a20 2020 2020 2020 2062  ts)....        b
+00058420: 7574 746f 6e31 203d 2073 656c 662e 6275  utton1 = self.bu
+00058430: 7474 6f6e 5f6d 6572 6765 5f63 6f6e 7461  tton_merge_conta
+00058440: 6374 7320 3d20 636f 6e74 726f 6c73 2e4e  cts = controls.N
+00058450: 6f74 6542 7574 746f 6e28 0d0a 2020 2020  oteButton(..    
+00058460: 2020 2020 2020 2020 7061 6e65 6c32 2c20          panel2, 
+00058470: 6c61 6265 6c3d 2226 4d65 7267 6520 7365  label="&Merge se
+00058480: 6c65 6374 6564 2074 6f20 7468 6520 7269  lected to the ri
+00058490: 6768 7422 2c0d 0a20 2020 2020 2020 2020  ght",..         
+000584a0: 2020 206e 6f74 653d 2243 6f70 7920 7365     note="Copy se
+000584b0: 6c65 6374 6564 2063 6f6e 7461 6374 7320  lected contacts 
+000584c0: 746f 2074 6865 2064 6174 6162 6173 6520  to the database 
+000584d0: 6f6e 2074 6865 2072 6967 6874 2e22 2c0d  on the right.",.
+000584e0: 0a20 2020 2020 2020 2020 2020 2062 6d70  .            bmp
+000584f0: 3d69 6d61 6765 732e 4275 7474 6f6e 4d65  =images.ButtonMe
+00058500: 7267 654c 6566 742e 4269 746d 6170 290d  rgeLeft.Bitmap).
+00058510: 0a20 2020 2020 2020 2062 7574 746f 6e5f  .        button_
+00058520: 616c 6c31 203d 2073 656c 662e 6275 7474  all1 = self.butt
+00058530: 6f6e 5f6d 6572 6765 5f61 6c6c 636f 6e74  on_merge_allcont
+00058540: 6163 7473 203d 2063 6f6e 7472 6f6c 732e  acts = controls.
+00058550: 4e6f 7465 4275 7474 6f6e 280d 0a20 2020  NoteButton(..   
+00058560: 2020 2020 2020 2020 2070 616e 656c 322c           panel2,
+00058570: 206c 6162 656c 3d22 4d65 7267 6520 2661   label="Merge &a
+00058580: 6c6c 2074 6f20 7468 6520 7269 6768 7422  ll to the right"
+00058590: 2c0d 0a20 2020 2020 2020 2020 2020 206e  ,..            n
+000585a0: 6f74 653d 2243 6f70 7920 616c 6c20 636f  ote="Copy all co
+000585b0: 6e74 6163 7473 2074 6f20 7468 6520 6461  ntacts to the da
+000585c0: 7461 6261 7365 206f 6e20 7468 6520 7269  tabase on the ri
+000585d0: 6768 742e 222c 0d0a 2020 2020 2020 2020  ght.",..        
+000585e0: 2020 2020 626d 703d 696d 6167 6573 2e42      bmp=images.B
+000585f0: 7574 746f 6e4d 6572 6765 4c65 6674 4d75  uttonMergeLeftMu
+00058600: 6c74 692e 4269 746d 6170 290d 0a20 2020  lti.Bitmap)..   
+00058610: 2020 2020 2043 6f6c 6f75 724d 616e 6167       ColourManag
+00058620: 6572 2e4d 616e 6167 6528 6275 7474 6f6e  er.Manage(button
+00058630: 312c 2020 2020 2022 4261 636b 6772 6f75  1,     "Backgrou
+00058640: 6e64 436f 6c6f 7572 222c 2022 4267 436f  ndColour", "BgCo
+00058650: 6c6f 7572 2229 0d0a 2020 2020 2020 2020  lour")..        
+00058660: 436f 6c6f 7572 4d61 6e61 6765 722e 4d61  ColourManager.Ma
+00058670: 6e61 6765 2862 7574 746f 6e5f 616c 6c31  nage(button_all1
+00058680: 2c20 2242 6163 6b67 726f 756e 6443 6f6c  , "BackgroundCol
+00058690: 6f75 7222 2c20 2242 6743 6f6c 6f75 7222  our", "BgColour"
+000586a0: 290d 0a20 2020 2020 2020 2062 7574 746f  )..        butto
+000586b0: 6e31 2e42 696e 6428 7778 2e45 5654 5f42  n1.Bind(wx.EVT_B
+000586c0: 5554 544f 4e2c 2073 656c 662e 6f6e 5f6d  UTTON, self.on_m
+000586d0: 6572 6765 5f63 6f6e 7461 6374 7329 0d0a  erge_contacts)..
+000586e0: 2020 2020 2020 2020 6275 7474 6f6e 5f61          button_a
+000586f0: 6c6c 312e 4269 6e64 2877 782e 4556 545f  ll1.Bind(wx.EVT_
+00058700: 4255 5454 4f4e 2c20 7365 6c66 2e6f 6e5f  BUTTON, self.on_
+00058710: 6d65 7267 655f 636f 6e74 6163 7473 290d  merge_contacts).
+00058720: 0a20 2020 2020 2020 2062 7574 746f 6e31  .        button1
+00058730: 2e45 6e61 626c 6564 203d 2062 7574 746f  .Enabled = butto
+00058740: 6e5f 616c 6c31 2e45 6e61 626c 6564 203d  n_all1.Enabled =
+00058750: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
+00058760: 7369 7a65 7231 2e41 6464 2873 697a 6572  sizer1.Add(sizer
+00058770: 5f74 6f70 2c20 666c 6167 3d77 782e 4752  _top, flag=wx.GR
+00058780: 4f57 207c 2077 782e 424f 5454 4f4d 207c  OW | wx.BOTTOM |
+00058790: 2077 782e 5249 4748 542c 2062 6f72 6465   wx.RIGHT, borde
+000587a0: 723d 3529 0d0a 2020 2020 2020 2020 7369  r=5)..        si
+000587b0: 7a65 7231 2e41 6464 286c 6973 7431 2c20  zer1.Add(list1, 
+000587c0: 7072 6f70 6f72 7469 6f6e 3d31 2c20 666c  proportion=1, fl
+000587d0: 6167 3d77 782e 4752 4f57 207c 2077 782e  ag=wx.GROW | wx.
+000587e0: 424f 5454 4f4d 207c 2077 782e 5249 4748  BOTTOM | wx.RIGH
+000587f0: 542c 0d0a 2020 2020 2020 2020 2020 2020  T,..            
+00058800: 2020 2020 2020 2062 6f72 6465 723d 3529         border=5)
+00058810: 0d0a 2020 2020 2020 2020 7369 7a65 7232  ..        sizer2
+00058820: 2e41 6464 5374 7265 7463 6853 7061 6365  .AddStretchSpace
+00058830: 7228 290d 0a20 2020 2020 2020 2073 697a  r()..        siz
+00058840: 6572 322e 4164 6428 6275 7474 6f6e 312c  er2.Add(button1,
+00058850: 2020 2020 2066 6c61 673d 7778 2e41 4c4c       flag=wx.ALL
+00058860: 207c 2077 782e 4752 4f57 2c20 626f 7264   | wx.GROW, bord
+00058870: 6572 3d35 290d 0a20 2020 2020 2020 2073  er=5)..        s
+00058880: 697a 6572 322e 4164 6428 6275 7474 6f6e  izer2.Add(button
+00058890: 5f61 6c6c 312c 2066 6c61 673d 7778 2e41  _all1, flag=wx.A
+000588a0: 4c4c 207c 2077 782e 4752 4f57 2c20 626f  LL | wx.GROW, bo
+000588b0: 7264 6572 3d35 290d 0a20 2020 2020 2020  rder=5)..       
+000588c0: 2073 697a 6572 322e 4164 6453 7472 6574   sizer2.AddStret
+000588d0: 6368 5370 6163 6572 2829 0d0a 0d0a 2020  chSpacer()....  
+000588e0: 2020 2020 2020 7370 6c69 7474 6572 2e53        splitter.S
+000588f0: 706c 6974 5665 7274 6963 616c 6c79 2870  plitVertically(p
+00058900: 616e 656c 312c 2070 616e 656c 322c 2073  anel1, panel2, s
+00058910: 6173 6850 6f73 6974 696f 6e3d 7365 6c66  ashPosition=self
+00058920: 2e53 697a 652e 7769 6474 6829 0d0a 0d0a  .Size.width)....
+00058930: 2020 2020 2020 2020 7369 7a65 722e 4164          sizer.Ad
+00058940: 6453 7061 6365 7228 3130 290d 0a20 2020  dSpacer(10)..   
+00058950: 2020 2020 2073 697a 6572 2e41 6464 2873       sizer.Add(s
+00058960: 706c 6974 7465 722c 2070 726f 706f 7274  plitter, proport
+00058970: 696f 6e3d 312c 2062 6f72 6465 723d 352c  ion=1, border=5,
+00058980: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00058990: 2020 2020 666c 6167 3d77 782e 4752 4f57      flag=wx.GROW
+000589a0: 207c 2077 782e 4c45 4654 207c 2077 782e   | wx.LEFT | wx.
+000589b0: 5249 4748 5429 0d0a 2020 2020 2020 2020  RIGHT)..        
+000589c0: 7061 6e65 6c32 2e53 6574 7570 5363 726f  panel2.SetupScro
+000589d0: 6c6c 696e 6728 7363 726f 6c6c 5f78 3d46  lling(scroll_x=F
+000589e0: 616c 7365 290d 0a0d 0a0d 0a20 2020 2064  alse)......    d
+000589f0: 6566 206f 6e5f 6578 706f 7274 5f63 6861  ef on_export_cha
+00058a00: 7428 7365 6c66 2c20 6576 656e 7429 3a0d  t(self, event):.
+00058a10: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
+00058a20: 2020 2020 2020 4861 6e64 6c65 7220 666f        Handler fo
+00058a30: 7220 636c 6963 6b69 6e67 2074 6f20 6578  r clicking to ex
+00058a40: 706f 7274 2061 2063 6861 7420 6469 6666  port a chat diff
+00058a50: 2c20 6469 7370 6c61 7973 2061 2073 6176  , displays a sav
+00058a60: 6520 6669 6c65 2064 6961 6c6f 670d 0a20  e file dialog.. 
+00058a70: 2020 2020 2020 2061 6e64 2073 6176 6573         and saves
+00058a80: 2074 6865 2063 7572 7265 6e74 206d 6573   the current mes
+00058a90: 7361 6765 7320 746f 2066 696c 652e 0d0a  sages to file...
+00058aa0: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
+00058ab0: 2020 2020 2066 6f72 6d61 7461 7267 7320       formatargs 
+00058ac0: 3d20 636f 6c6c 6563 7469 6f6e 732e 6465  = collections.de
+00058ad0: 6661 756c 7464 6963 7428 7374 7229 3b20  faultdict(str); 
+00058ae0: 666f 726d 6174 6172 6773 2e75 7064 6174  formatargs.updat
+00058af0: 6528 7365 6c66 2e63 6861 7429 0d0a 2020  e(self.chat)..  
+00058b00: 2020 2020 2020 6465 6661 756c 7420 3d20        default = 
+00058b10: 2244 6966 6620 6f66 2025 7322 2025 2063  "Diff of %s" % c
+00058b20: 6f6e 662e 4578 706f 7274 4368 6174 5465  onf.ExportChatTe
+00058b30: 6d70 6c61 7465 2025 2066 6f72 6d61 7461  mplate % formata
+00058b40: 7267 730d 0a20 2020 2020 2020 2064 6961  rgs..        dia
+00058b50: 6c6f 6720 3d20 7778 2e46 696c 6544 6961  log = wx.FileDia
+00058b60: 6c6f 6728 7061 7265 6e74 3d73 656c 662c  log(parent=self,
+00058b70: 206d 6573 7361 6765 3d22 5361 7665 206e   message="Save n
+00058b80: 6577 206d 6573 7361 6765 7322 2c0d 0a20  ew messages",.. 
+00058b90: 2020 2020 2020 2020 2020 2064 6566 6175             defau
+00058ba0: 6c74 4669 6c65 3d75 7469 6c2e 7361 6665  ltFile=util.safe
+00058bb0: 5f66 696c 656e 616d 6528 6465 6661 756c  _filename(defaul
+00058bc0: 7429 2c0d 0a20 2020 2020 2020 2020 2020  t),..           
+00058bd0: 2073 7479 6c65 3d77 782e 4644 5f4f 5645   style=wx.FD_OVE
+00058be0: 5257 5249 5445 5f50 524f 4d50 5420 7c20  RWRITE_PROMPT | 
+00058bf0: 7778 2e46 445f 5341 5645 207c 2077 782e  wx.FD_SAVE | wx.
+00058c00: 5245 5349 5a45 5f42 4f52 4445 520d 0a20  RESIZE_BORDER.. 
+00058c10: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
+00058c20: 2020 6469 616c 6f67 2e57 696c 6463 6172    dialog.Wildcar
+00058c30: 6420 3d20 6578 706f 7274 2e43 4841 545f  d = export.CHAT_
+00058c40: 5749 4c44 4341 5244 0d0a 2020 2020 2020  WILDCARD..      
+00058c50: 2020 6469 616c 6f67 2e46 696c 7465 7249    dialog.FilterI
+00058c60: 6e64 6578 203d 2065 7870 6f72 742e 4348  ndex = export.CH
+00058c70: 4154 5f45 5854 532e 696e 6465 7828 2268  AT_EXTS.index("h
+00058c80: 746d 6c22 290d 0a20 2020 2020 2020 2069  tml")..        i
+00058c90: 6620 7778 2e49 445f 4f4b 2021 3d20 6469  f wx.ID_OK != di
+00058ca0: 616c 6f67 2e53 686f 774d 6f64 616c 2829  alog.ShowModal()
+00058cb0: 3a20 7265 7475 726e 0d0a 0d0a 2020 2020  : return....    
+00058cc0: 2020 2020 6669 6c65 7061 7468 203d 2063      filepath = c
+00058cd0: 6f6e 7472 6f6c 732e 6765 745f 6469 616c  ontrols.get_dial
+00058ce0: 6f67 5f70 6174 6828 6469 616c 6f67 290d  og_path(dialog).
+00058cf0: 0a20 2020 2020 2020 2066 6f72 6d61 7420  .        format 
+00058d00: 3d20 6578 706f 7274 2e43 4841 545f 4558  = export.CHAT_EX
+00058d10: 5453 5b64 6961 6c6f 672e 4669 6c74 6572  TS[dialog.Filter
+00058d20: 496e 6465 785d 0d0a 2020 2020 2020 2020  Index]..        
+00058d30: 6d65 6469 615f 666f 6c64 6572 203d 2022  media_folder = "
+00058d40: 6874 6d6c 2220 3d3d 2066 6f72 6d61 7420  html" == format 
+00058d50: 616e 6420 5c0d 0a20 2020 2020 2020 2020  and \..         
+00058d60: 2020 2020 2020 2020 2020 2020 2020 6469                di
+00058d70: 616c 6f67 2e46 696c 7465 7249 6e64 6578  alog.FilterIndex
+00058d80: 2021 3d20 6578 706f 7274 2e43 4841 545f   != export.CHAT_
+00058d90: 4558 5453 2e69 6e64 6578 2822 6874 6d6c  EXTS.index("html
+00058da0: 2229 0d0a 2020 2020 2020 2020 6966 206d  ")..        if m
+00058db0: 6564 6961 5f66 6f6c 6465 7220 616e 6420  edia_folder and 
+00058dc0: 6e6f 7420 6368 6563 6b5f 6d65 6469 615f  not check_media_
+00058dd0: 6578 706f 7274 5f6c 6f67 696e 2873 656c  export_login(sel
+00058de0: 662e 6462 293a 2072 6574 7572 6e0d 0a0d  f.db): return...
+00058df0: 0a20 2020 2020 2020 2062 7573 7920 3d20  .        busy = 
+00058e00: 636f 6e74 726f 6c73 2e42 7573 7950 616e  controls.BusyPan
+00058e10: 656c 2873 656c 662c 2027 4578 706f 7274  el(self, 'Export
+00058e20: 696e 6720 2225 7322 2e27 2025 2073 656c  ing "%s".' % sel
+00058e30: 662e 6368 6174 5b22 7469 746c 6522 5d29  f.chat["title"])
+00058e40: 0d0a 2020 2020 2020 2020 6775 6962 6173  ..        guibas
+00058e50: 652e 7374 6174 7573 2822 4578 706f 7274  e.status("Export
+00058e60: 696e 6720 746f 2025 732e 222c 2066 696c  ing to %s.", fil
+00058e70: 6570 6174 682c 206c 6f67 3d54 7275 6529  epath, log=True)
+00058e80: 0d0a 2020 2020 2020 2020 7472 793a 0d0a  ..        try:..
+00058e90: 2020 2020 2020 2020 2020 2020 6d65 7373              mess
+00058ea0: 6167 6573 203d 2073 656c 662e 6462 312e  ages = self.db1.
+00058eb0: 6d65 7373 6167 655f 6974 6572 6174 6f72  message_iterator
+00058ec0: 2873 656c 662e 6368 6174 5f64 6966 665b  (self.chat_diff[
+00058ed0: 226d 6573 7361 6765 7322 5d29 0d0a 2020  "messages"])..  
+00058ee0: 2020 2020 2020 2020 2020 6f70 7473 203d            opts =
+00058ef0: 2064 6963 7428 6d65 7373 6167 6573 3d6d   dict(messages=m
+00058f00: 6573 7361 6765 732c 2070 726f 6772 6573  essages, progres
+00058f10: 733d 6c61 6d62 6461 202a 6172 6773 3a20  s=lambda *args: 
+00058f20: 7778 2e53 6166 6559 6965 6c64 2829 290d  wx.SafeYield()).
+00058f30: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00058f40: 6d65 6469 615f 666f 6c64 6572 3a20 6f70  media_folder: op
+00058f50: 7473 5b22 6d65 6469 615f 666f 6c64 6572  ts["media_folder
+00058f60: 225d 203d 2054 7275 650d 0a20 2020 2020  "] = True..     
+00058f70: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
+00058f80: 6578 706f 7274 2e65 7870 6f72 745f 6368  export.export_ch
+00058f90: 6174 7328 5b73 656c 662e 6368 6174 5d2c  ats([self.chat],
+00058fa0: 2066 696c 6570 6174 682c 2066 6f72 6d61   filepath, forma
+00058fb0: 742c 2073 656c 662e 6462 312c 206f 7074  t, self.db1, opt
+00058fc0: 7329 0d0a 2020 2020 2020 2020 2020 2020  s)..            
+00058fd0: 6669 6c65 732c 2063 6f75 6e74 2c20 6d65  files, count, me
+00058fe0: 7373 6167 655f 636f 756e 7420 3d20 7265  ssage_count = re
+00058ff0: 7375 6c74 0d0a 2020 2020 2020 2020 2020  sult..          
+00059000: 2020 6775 6962 6173 652e 7374 6174 7573    guibase.status
+00059010: 2822 4578 706f 7274 6564 2025 7320 746f  ("Exported %s to
+00059020: 2025 732e 222c 0d0a 2020 2020 2020 2020   %s.",..        
+00059030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059040: 2020 2075 7469 6c2e 706c 7572 616c 2822     util.plural("
+00059050: 6d65 7373 6167 6522 2c20 6d65 7373 6167  message", messag
+00059060: 655f 636f 756e 742c 2073 6570 3d22 2c22  e_count, sep=","
+00059070: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
+00059080: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00059090: 696c 6570 6174 682c 206c 6f67 3d54 7275  ilepath, log=Tru
+000590a0: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+000590b0: 6966 2063 6f6e 662e 4578 706f 7274 4669  if conf.ExportFi
+000590c0: 6c65 4175 746f 4f70 656e 3a20 7574 696c  leAutoOpen: util
+000590d0: 2e73 7461 7274 5f66 696c 6528 6669 6c65  .start_file(file
+000590e0: 7061 7468 290d 0a20 2020 2020 2020 2065  path)..        e
+000590f0: 7863 6570 7420 4578 6365 7074 696f 6e3a  xcept Exception:
+00059100: 0d0a 2020 2020 2020 2020 2020 2020 6775  ..            gu
+00059110: 6962 6173 652e 7374 6174 7573 2822 4572  ibase.status("Er
+00059120: 726f 7220 7361 7669 6e67 2025 732e 222c  ror saving %s.",
+00059130: 2066 696c 6570 6174 6829 0d0a 2020 2020   filepath)..    
+00059140: 2020 2020 2020 2020 6c6f 6767 6572 2e65          logger.e
+00059150: 7863 6570 7469 6f6e 2822 4572 726f 7220  xception("Error 
+00059160: 7361 7669 6e67 2025 732e 222c 2066 696c  saving %s.", fil
+00059170: 6570 6174 6829 0d0a 2020 2020 2020 2020  epath)..        
+00059180: 2020 2020 6572 726f 726d 7367 203d 2022      errormsg = "
+00059190: 4572 726f 7220 7361 7669 6e67 2025 733a  Error saving %s:
+000591a0: 5c6e 5c6e 2573 2220 2520 5c0d 0a20 2020  \n\n%s" % \..   
+000591b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000591c0: 2020 2020 2866 696c 6570 6174 682c 2074      (filepath, t
+000591d0: 7261 6365 6261 636b 2e66 6f72 6d61 745f  raceback.format_
+000591e0: 6578 6328 2929 0d0a 2020 2020 2020 2020  exc())..        
+000591f0: 2020 2020 7778 2e4d 6573 7361 6765 426f      wx.MessageBo
+00059200: 7828 6572 726f 726d 7367 2c20 636f 6e66  x(errormsg, conf
+00059210: 2e54 6974 6c65 2c20 7778 2e4f 4b20 7c20  .Title, wx.OK | 
+00059220: 7778 2e49 434f 4e5f 5741 524e 494e 4729  wx.ICON_WARNING)
+00059230: 0d0a 2020 2020 2020 2020 6669 6e61 6c6c  ..        finall
+00059240: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
+00059250: 6275 7379 2e43 6c6f 7365 2829 0d0a 0d0a  busy.Close()....
+00059260: 0d0a 2020 2020 6465 6620 6f6e 5f63 6c69  ..    def on_cli
+00059270: 636b 5f68 746d 6c64 6966 6628 7365 6c66  ck_htmldiff(self
+00059280: 2c20 6576 656e 7429 3a0d 0a20 2020 2020  , event):..     
+00059290: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
+000592a0: 4861 6e64 6c65 7220 666f 7220 636c 6963  Handler for clic
+000592b0: 6b69 6e67 2061 2063 6861 7420 6c69 6e6b  king a chat link
+000592c0: 2069 6e20 6469 6666 206f 7665 7276 6965   in diff overvie
+000592d0: 772c 206f 7065 6e73 2074 6865 2063 6861  w, opens the cha
+000592e0: 740d 0a20 2020 2020 2020 2063 6f6d 7061  t..        compa
+000592f0: 7269 736f 6e20 696e 2043 6861 7473 2070  rison in Chats p
+00059300: 6167 652e 0d0a 2020 2020 2020 2020 2222  age...        ""
+00059310: 220d 0a20 2020 2020 2020 2068 7265 6620  "..        href 
+00059320: 3d20 6576 656e 742e 4765 744c 696e 6b49  = event.GetLinkI
+00059330: 6e66 6f28 292e 4872 6566 0d0a 2020 2020  nfo().Href..    
+00059340: 2020 2020 6368 6174 203d 204e 6f6e 650d      chat = None.
+00059350: 0a20 2020 2020 2020 2066 6f72 2063 2069  .        for c i
+00059360: 6e20 7365 6c66 2e63 6f6d 7061 7265 643a  n self.compared:
+00059370: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00059380: 2063 5b22 6964 656e 7469 7479 225d 203d   c["identity"] =
+00059390: 3d20 6872 6566 3a0d 0a20 2020 2020 2020  = href:..       
+000593a0: 2020 2020 2020 2020 2063 6861 7420 3d20           chat = 
+000593b0: 630d 0a20 2020 2020 2020 2020 2020 2020  c..             
+000593c0: 2020 2062 7265 616b 2023 2066 6f72 2063     break # for c
+000593d0: 0d0a 2020 2020 2020 2020 6966 2063 6861  ..        if cha
+000593e0: 7420 616e 6420 7365 6c66 2e70 6167 655f  t and self.page_
+000593f0: 6d65 7267 655f 6368 6174 732e 456e 6162  merge_chats.Enab
+00059400: 6c65 643a 0d0a 2020 2020 2020 2020 2020  led:..          
+00059410: 2020 7365 6c66 2e6f 6e5f 6368 616e 6765    self.on_change
+00059420: 5f6c 6973 745f 6368 6174 7328 6368 6174  _list_chats(chat
+00059430: 3d63 6861 7429 0d0a 2020 2020 2020 2020  =chat)..        
+00059440: 2020 2020 7365 6c66 2e6e 6f74 6562 6f6f      self.noteboo
+00059450: 6b2e 5365 7453 656c 6563 7469 6f6e 2873  k.SetSelection(s
+00059460: 656c 662e 7061 6765 6f72 6465 725b 7365  elf.pageorder[se
+00059470: 6c66 2e70 6167 655f 6d65 7267 655f 6368  lf.page_merge_ch
+00059480: 6174 735d 290d 0a0d 0a0d 0a20 2020 2064  ats])......    d
+00059490: 6566 206f 6e5f 776f 726b 6572 5f6d 6572  ef on_worker_mer
+000594a0: 6765 5f72 6573 756c 7428 7365 6c66 2c20  ge_result(self, 
+000594b0: 6576 656e 7429 3a0d 0a20 2020 2020 2020  event):..       
+000594c0: 2022 2222 4861 6e64 6c65 7220 666f 7220   """Handler for 
+000594d0: 776f 726b 6572 5f6d 6572 6765 2072 6573  worker_merge res
+000594e0: 756c 7420 6361 6c6c 6261 636b 2c20 7570  ult callback, up
+000594f0: 6461 7465 7320 5549 2061 6e64 2074 6578  dates UI and tex
+00059500: 7473 2e22 2222 0d0a 2020 2020 2020 2020  ts."""..        
+00059510: 6966 206e 6f74 2073 656c 663a 2072 6574  if not self: ret
+00059520: 7572 6e0d 0a20 2020 2020 2020 2069 6620  urn..        if 
+00059530: 6576 656e 742e 7265 7375 6c74 2e67 6574  event.result.get
+00059540: 2822 7479 7065 2229 2069 6e20 5b22 6d65  ("type") in ["me
+00059550: 7267 655f 6c65 6674 222c 2022 6469 6666  rge_left", "diff
+00059560: 5f6d 6572 6765 5f6c 6566 7422 5d3a 0d0a  _merge_left"]:..
+00059570: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00059580: 2e6f 6e5f 6d65 7267 655f 616c 6c5f 7265  .on_merge_all_re
+00059590: 7375 6c74 2865 7665 6e74 290d 0a20 2020  sult(event)..   
+000595a0: 2020 2020 2065 6c69 6620 2264 6966 665f       elif "diff_
+000595b0: 6c65 6674 2220 3d3d 2065 7665 6e74 2e72  left" == event.r
+000595c0: 6573 756c 742e 6765 7428 2274 7970 6522  esult.get("type"
+000595d0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+000595e0: 7365 6c66 2e6f 6e5f 7363 616e 5f61 6c6c  self.on_scan_all
+000595f0: 5f72 6573 756c 7428 6576 656e 7429 0d0a  _result(event)..
+00059600: 0d0a 0d0a 2020 2020 6465 6620 6f6e 5f77  ....    def on_w
+00059610: 6f72 6b65 725f 6d65 7267 655f 6361 6c6c  orker_merge_call
+00059620: 6261 636b 2873 656c 662c 2072 6573 756c  back(self, resul
+00059630: 7429 3a0d 0a20 2020 2020 2020 2022 2222  t):..        """
+00059640: 4361 6c6c 6261 636b 2066 756e 6374 696f  Callback functio
+00059650: 6e20 666f 7220 4d65 7267 6554 6872 6561  n for MergeThrea
+00059660: 642c 2070 6f73 7473 2074 6865 2064 6174  d, posts the dat
+00059670: 6120 746f 2073 656c 662e 2222 220d 0a20  a to self.""".. 
+00059680: 2020 2020 2020 2069 6620 7365 6c66 3a20         if self: 
+00059690: 7778 2e50 6f73 7445 7665 6e74 2873 656c  wx.PostEvent(sel
+000596a0: 662c 2057 6f72 6b65 7245 7665 6e74 2872  f, WorkerEvent(r
+000596b0: 6573 756c 743d 7265 7375 6c74 2929 0d0a  esult=result))..
+000596c0: 0d0a 0d0a 2020 2020 6465 6620 6f6e 5f77  ....    def on_w
+000596d0: 6f72 6b65 725f 696d 706f 7274 5f63 616c  orker_import_cal
+000596e0: 6c62 6163 6b28 7365 6c66 2c20 7265 7375  lback(self, resu
+000596f0: 6c74 293a 0d0a 2020 2020 2020 2020 2222  lt):..        ""
+00059700: 2243 616c 6c62 6163 6b20 6675 6e63 7469  "Callback functi
+00059710: 6f6e 2066 6f72 2053 6b79 7065 4172 6368  on for SkypeArch
+00059720: 6976 6554 6872 6561 642c 2075 7064 6174  iveThread, updat
+00059730: 6573 2055 492e 2222 220d 0a20 2020 2020  es UI."""..     
+00059740: 2020 2069 6620 6e6f 7420 7365 6c66 3a20     if not self: 
+00059750: 7265 7475 726e 0d0a 0d0a 2020 2020 2020  return....      
+00059760: 2020 6465 6620 6166 7465 7228 7265 7375    def after(resu
+00059770: 6c74 293a 0d0a 2020 2020 2020 2020 2020  lt):..          
+00059780: 2020 6966 206e 6f74 2073 656c 663a 2072    if not self: r
+00059790: 6574 7572 6e0d 0a0d 0a20 2020 2020 2020  eturn....       
+000597a0: 2020 2020 2069 6620 2263 6f75 6e74 7322       if "counts"
+000597b0: 2069 6e20 7265 7375 6c74 3a0d 0a0d 0a20   in result:.... 
+000597c0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+000597d0: 203d 2022 2c20 222e 6a6f 696e 2875 7469   = ", ".join(uti
+000597e0: 6c2e 706c 7572 616c 2878 5b3a 2d31 5d2c  l.plural(x[:-1],
+000597f0: 2072 6573 756c 745b 2263 6f75 6e74 7322   result["counts"
+00059800: 5d5b 785d 2c20 7365 703d 222c 2229 0d0a  ][x], sep=",")..
+00059810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059820: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+00059830: 7220 7820 696e 2073 6f72 7465 6428 7265  r x in sorted(re
+00059840: 7375 6c74 5b22 636f 756e 7473 225d 2929  sult["counts"]))
+00059850: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00059860: 2020 7365 6c66 2e6c 6162 656c 5f67 6175    self.label_gau
+00059870: 6765 2e4c 6162 656c 203d 2022 5061 7273  ge.Label = "Pars
+00059880: 6564 2025 732e 2220 2520 740d 0a20 2020  ed %s." % t..   
+00059890: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+000598a0: 662e 7061 6e65 6c5f 6761 7567 652e 4c61  f.panel_gauge.La
+000598b0: 796f 7574 2829 0d0a 0d0a 2020 2020 2020  yout()....      
+000598c0: 2020 2020 2020 656c 6966 2022 6572 726f        elif "erro
+000598d0: 7222 2069 6e20 7265 7375 6c74 3a0d 0a20  r" in result:.. 
+000598e0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000598f0: 656c 662e 6874 6d6c 5f72 6570 6f72 742e  elf.html_report.
+00059900: 4170 7065 6e64 546f 5061 6765 2822 3c62  AppendToPage("<b
+00059910: 7220 2f3e 3c62 7220 2f3e 203c 623e 4572  r /><br /> <b>Er
+00059920: 726f 7220 7061 7273 696e 6720 536b 7970  ror parsing Skyp
+00059930: 6520 6578 706f 7274 3a3c 2f62 3e26 6e62  e export:</b>&nb
+00059940: 7370 3b26 6e62 7370 3b22 0d0a 2020 2020  sp;&nbsp;"..    
+00059950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059970: 2020 2020 2020 2020 2020 2b20 7265 7375            + resu
+00059980: 6c74 5b22 6572 726f 725f 7368 6f72 7422  lt["error_short"
+00059990: 5d2e 7265 706c 6163 6528 223c 222c 2022  ].replace("<", "
+000599a0: 266c 743b 2229 290d 0a20 2020 2020 2020  &lt;"))..       
+000599b0: 2020 2020 2020 2020 2073 656c 662e 6874           self.ht
+000599c0: 6d6c 5f72 6570 6f72 742e 5363 726f 6c6c  ml_report.Scroll
+000599d0: 2830 2c20 7365 6c66 2e68 746d 6c5f 7265  (0, self.html_re
+000599e0: 706f 7274 2e47 6574 5363 726f 6c6c 5261  port.GetScrollRa
+000599f0: 6e67 6528 7778 2e56 4552 5449 4341 4c29  nge(wx.VERTICAL)
+00059a00: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00059a10: 2020 2073 656c 662e 6761 7567 655f 7072     self.gauge_pr
+00059a20: 6f67 7265 7373 2e56 616c 7565 203d 2030  ogress.Value = 0
+00059a30: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00059a40: 2020 7365 6c66 2e70 616e 656c 5f67 6175    self.panel_gau
+00059a50: 6765 2e48 6964 6528 290d 0a20 2020 2020  ge.Hide()..     
+00059a60: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00059a70: 7061 6765 5f6d 6572 6765 5f61 6c6c 2e4c  page_merge_all.L
+00059a80: 6179 6f75 7428 290d 0a20 2020 2020 2020  ayout()..       
+00059a90: 2020 2020 2065 6c69 6620 2264 6f6e 6522       elif "done"
+00059aa0: 2069 6e20 7265 7375 6c74 3a0d 0a20 2020   in result:..   
+00059ab0: 2020 2020 2020 2020 2020 2020 2073 7461               sta
+00059ac0: 7473 203d 2073 656c 662e 6462 312e 6765  ts = self.db1.ge
+00059ad0: 745f 6765 6e65 7261 6c5f 7374 6174 6973  t_general_statis
+00059ae0: 7469 6373 2829 0d0a 2020 2020 2020 2020  tics()..        
+00059af0: 2020 2020 2020 2020 7465 7874 203d 2022          text = "
+00059b00: 3c62 7220 2f3e 3c62 7220 2f3e 5061 7273  <br /><br />Pars
+00059b10: 6564 2025 732c 2025 7320 616e 6420 2573  ed %s, %s and %s
+00059b20: 2e22 2025 2074 7570 6c65 280d 0a20 2020  ." % tuple(..   
+00059b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059b40: 2075 7469 6c2e 706c 7572 616c 2878 5b3a   util.plural(x[:
+00059b50: 2d31 5d2c 2073 7461 7473 5b78 5d2c 2073  -1], stats[x], s
+00059b60: 6570 3d22 2c22 2920 666f 7220 7820 696e  ep=",") for x in
+00059b70: 2028 2263 6861 7473 222c 2022 636f 6e74   ("chats", "cont
+00059b80: 6163 7473 222c 2022 6d65 7373 6167 6573  acts", "messages
+00059b90: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
+00059ba0: 2020 2020 290d 0a20 2020 2020 2020 2020      )..         
+00059bb0: 2020 2020 2020 2073 656c 662e 6874 6d6c         self.html
+00059bc0: 5f72 6570 6f72 742e 4170 7065 6e64 546f  _report.AppendTo
+00059bd0: 5061 6765 2874 6578 7429 0d0a 2020 2020  Page(text)..    
+00059be0: 2020 2020 2020 2020 2020 2020 7363 726f              scro
+00059bf0: 6c6c 706f 7320 3d20 7365 6c66 2e68 746d  llpos = self.htm
+00059c00: 6c5f 7265 706f 7274 2e47 6574 5363 726f  l_report.GetScro
+00059c10: 6c6c 5261 6e67 6528 7778 2e56 4552 5449  llRange(wx.VERTI
+00059c20: 4341 4c29 0d0a 2020 2020 2020 2020 2020  CAL)..          
+00059c30: 2020 2020 2020 7365 6c66 2e68 746d 6c5f        self.html_
+00059c40: 7265 706f 7274 2e53 6372 6f6c 6c28 302c  report.Scroll(0,
+00059c50: 2073 6372 6f6c 6c70 6f73 290d 0a20 2020   scrollpos)..   
+00059c60: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00059c70: 662e 6761 7567 655f 7072 6f67 7265 7373  f.gauge_progress
+00059c80: 2e56 616c 7565 203d 2031 3030 0d0a 2020  .Value = 100..  
+00059c90: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00059ca0: 6c66 2e70 616e 656c 5f67 6175 6765 2e48  lf.panel_gauge.H
+00059cb0: 6964 6528 290d 0a20 2020 2020 2020 2020  ide()..         
+00059cc0: 2020 2020 2020 2073 656c 662e 6c6f 6164         self.load
+00059cd0: 5f64 6174 6128 290d 0a0d 0a20 2020 2020  _data()....     
+00059ce0: 2020 2077 782e 4361 6c6c 4166 7465 7228     wx.CallAfter(
+00059cf0: 6166 7465 722c 2072 6573 756c 7429 0d0a  after, result)..
+00059d00: 0d0a 0d0a 2020 2020 6465 6620 6f6e 5f73  ....    def on_s
+00059d10: 7761 7028 7365 6c66 2c20 6576 656e 7429  wap(self, event)
+00059d20: 3a0d 0a20 2020 2020 2020 2022 2222 0d0a  :..        """..
+00059d30: 2020 2020 2020 2020 4861 6e64 6c65 7220          Handler 
+00059d40: 666f 7220 636c 6963 6b69 6e67 2074 6f20  for clicking to 
+00059d50: 7377 6170 206c 6566 7420 616e 6420 7269  swap left and ri
+00059d60: 6768 7420 6461 7461 6261 7365 732c 2063  ght databases, c
+00059d70: 6861 6e67 6573 2064 6174 610d 0a20 2020  hanges data..   
+00059d80: 2020 2020 2073 7472 7563 7475 7265 7320       structures 
+00059d90: 616e 6420 5549 2063 6f6e 7465 6e74 2e0d  and UI content..
+00059da0: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
+00059db0: 2020 2020 2020 7365 6c66 2e64 6231 2c20        self.db1, 
+00059dc0: 7365 6c66 2e64 6232 203d 2073 656c 662e  self.db2 = self.
+00059dd0: 6462 322c 2073 656c 662e 6462 310d 0a20  db2, self.db1.. 
+00059de0: 2020 2020 2020 206e 616d 6573 7061 6365         namespace
+00059df0: 203d 207b 2264 6231 223a 2073 656c 662e   = {"db1": self.
+00059e00: 6462 312c 2022 6462 3222 3a20 7365 6c66  db1, "db2": self
+00059e10: 2e64 6232 7d0d 0a20 2020 2020 2020 2074  .db2}..        t
+00059e20: 656d 706c 6174 6520 3d20 7374 6570 2e54  emplate = step.T
+00059e30: 656d 706c 6174 6528 7465 6d70 6c61 7465  emplate(template
+00059e40: 732e 4d45 5247 455f 4442 5f4c 494e 4b53  s.MERGE_DB_LINKS
+00059e50: 2c20 6573 6361 7065 3d54 7275 6529 0d0a  , escape=True)..
+00059e60: 2020 2020 2020 2020 7365 6c66 2e68 746d          self.htm
+00059e70: 6c5f 6462 6c61 6265 6c2e 5365 7450 6167  l_dblabel.SetPag
+00059e80: 6528 7465 6d70 6c61 7465 2e65 7870 616e  e(template.expan
+00059e90: 6428 6e61 6d65 7370 6163 6529 290d 0a20  d(namespace)).. 
+00059ea0: 2020 2020 2020 2073 656c 662e 6874 6d6c         self.html
+00059eb0: 5f64 626c 6162 656c 2e42 6163 6b67 726f  _dblabel.Backgro
+00059ec0: 756e 6443 6f6c 6f75 7220 3d20 7778 2e4e  undColour = wx.N
+00059ed0: 756c 6c43 6f6c 6f75 720d 0a20 2020 2020  ullColour..     
+00059ee0: 2020 2073 656c 662e 636f 6e31 6469 6666     self.con1diff
+00059ef0: 2c20 7365 6c66 2e63 6f6e 3264 6966 6620  , self.con2diff 
+00059f00: 3d20 7365 6c66 2e63 6f6e 3264 6966 662c  = self.con2diff,
+00059f10: 2073 656c 662e 636f 6e31 6469 6666 0d0a   self.con1diff..
+00059f20: 2020 2020 2020 2020 7365 6c66 2e63 6f6e          self.con
+00059f30: 3164 6966 666c 6973 742c 2073 656c 662e  1difflist, self.
+00059f40: 636f 6e32 6469 6666 6c69 7374 203d 205c  con2difflist = \
+00059f50: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00059f60: 6c66 2e63 6f6e 3264 6966 666c 6973 742c  lf.con2difflist,
+00059f70: 2073 656c 662e 636f 6e31 6469 6666 6c69   self.con1diffli
+00059f80: 7374 0d0a 2020 2020 2020 2020 7365 6c66  st..        self
+00059f90: 2e63 6f6e 6772 6f75 7031 6469 6666 2c20  .congroup1diff, 
+00059fa0: 7365 6c66 2e63 6f6e 6772 6f75 7032 6469  self.congroup2di
+00059fb0: 6666 203d 205c 0d0a 2020 2020 2020 2020  ff = \..        
+00059fc0: 2020 2020 7365 6c66 2e63 6f6e 6772 6f75      self.congrou
+00059fd0: 7031 6469 6666 2c20 7365 6c66 2e63 6f6e  p1diff, self.con
+00059fe0: 6772 6f75 7032 6469 6666 0d0a 2020 2020  group2diff..    
+00059ff0: 2020 2020 7365 6c66 2e63 6861 7473 312c      self.chats1,
+0005a000: 2073 656c 662e 6368 6174 7332 203d 2073   self.chats2 = s
+0005a010: 656c 662e 6368 6174 7332 2c20 7365 6c66  elf.chats2, self
+0005a020: 2e63 6861 7473 310d 0a20 2020 2020 2020  .chats1..       
+0005a030: 2073 656c 662e 6368 6174 735f 6469 6666   self.chats_diff
+0005a040: 6461 7461 2e63 6c65 6172 2829 0d0a 2020  data.clear()..  
+0005a050: 2020 2020 2020 7365 6c66 2e63 6861 7473        self.chats
+0005a060: 5f6e 6f64 6966 662e 636c 6561 7228 290d  _nodiff.clear().
+0005a070: 0a20 2020 2020 2020 2073 656c 662e 6368  .        self.ch
+0005a080: 6174 203d 204e 6f6e 650d 0a20 2020 2020  at = None..     
+0005a090: 2020 2073 656c 662e 6368 6174 5f64 6966     self.chat_dif
+0005a0a0: 6620 3d20 4e6f 6e65 0d0a 2020 2020 2020  f = None..      
+0005a0b0: 2020 7365 6c66 2e69 735f 7363 616e 6e65    self.is_scanne
+0005a0c0: 6420 3d20 4661 6c73 650d 0a0d 0a20 2020  d = False....   
+0005a0d0: 2020 2020 2066 6f72 2061 2c20 6220 696e       for a, b in
+0005a0e0: 205b 2873 656c 662e 6c61 6265 6c5f 616c   [(self.label_al
+0005a0f0: 6c31 2c20 7365 6c66 2e6c 6162 656c 5f61  l1, self.label_a
+0005a100: 6c6c 3229 5d3a 0d0a 2020 2020 2020 2020  ll2)]:..        
+0005a110: 2020 2020 612e 4c61 6265 6c2c 2062 2e4c      a.Label, b.L
+0005a120: 6162 656c 203d 2062 2e4c 6162 656c 2c20  abel = b.Label, 
+0005a130: 612e 4c61 6265 6c0d 0a0d 0a20 2020 2020  a.Label....     
+0005a140: 2020 2073 656c 662e 6c61 6265 6c5f 6d65     self.label_me
+0005a150: 7267 655f 6368 6174 2e4c 6162 656c 203d  rge_chat.Label =
+0005a160: 2022 220d 0a20 2020 2020 2020 2073 656c   ""..        sel
+0005a170: 662e 7374 635f 6469 6666 312e 436c 6561  f.stc_diff1.Clea
+0005a180: 7241 6c6c 2829 0d0a 2020 2020 2020 2020  rAll()..        
+0005a190: 7365 6c66 2e62 7574 746f 6e5f 6d65 7267  self.button_merg
+0005a1a0: 655f 6368 6174 2e45 6e61 626c 6564 203d  e_chat.Enabled =
+0005a1b0: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
+0005a1c0: 7365 6c66 2e62 7574 746f 6e5f 6578 706f  self.button_expo
+0005a1d0: 7274 5f63 6861 742e 456e 6162 6c65 6420  rt_chat.Enabled 
+0005a1e0: 3d20 4661 6c73 650d 0a20 2020 2020 2020  = False..       
+0005a1f0: 2073 656c 662e 6275 7474 6f6e 5f6d 6572   self.button_mer
+0005a200: 6765 5f63 6861 742e 4e6f 7465 203d 2073  ge_chat.Note = s
+0005a210: 656c 662e 4d45 5247 455f 4348 4154 5f42  elf.MERGE_CHAT_B
+0005a220: 5554 544f 4e5f 4e4f 5445 0d0a 0d0a 2020  UTTON_NOTE....  
+0005a230: 2020 2020 2020 2320 5377 6170 206c 6566        # Swap lef
+0005a240: 7420 616e 6420 7269 6768 7420 696e 2064  t and right in d
+0005a250: 6174 6120 7374 7275 6374 7572 6573 2e0d  ata structures..
+0005a260: 0a20 2020 2020 2020 2066 6f72 206c 7374  .        for lst
+0005a270: 2069 6e20 5b73 656c 662e 636f 6d70 6172   in [self.compar
+0005a280: 6564 2c20 7365 6c66 2e63 6f6e 3164 6966  ed, self.con1dif
+0005a290: 662c 2073 656c 662e 636f 6e32 6469 6666  f, self.con2diff
+0005a2a0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0005a2b0: 2020 2020 2020 2073 656c 662e 636f 6e67         self.cong
+0005a2c0: 726f 7570 3164 6966 662c 2073 656c 662e  roup1diff, self.
+0005a2d0: 636f 6e67 726f 7570 3264 6966 665d 3a0d  congroup2diff]:.
+0005a2e0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+0005a2f0: 2069 7465 6d20 696e 206c 7374 206f 7220   item in lst or 
+0005a300: 5b5d 3a0d 0a20 2020 2020 2020 2020 2020  []:..           
+0005a310: 2020 2020 2066 6f72 2074 2069 6e20 5b22       for t in ["
+0005a320: 6322 2c20 226d 6573 7361 6765 7322 2c20  c", "messages", 
+0005a330: 2267 225d 3a0d 0a20 2020 2020 2020 2020  "g"]:..         
+0005a340: 2020 2020 2020 2020 2020 206b 6579 312c             key1,
+0005a350: 206b 6579 3220 3d20 2225 7331 2220 2520   key2 = "%s1" % 
+0005a360: 742c 2022 2573 3222 2025 2074 0d0a 2020  t, "%s2" % t..  
+0005a370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005a380: 2020 6966 206b 6579 3120 696e 2069 7465    if key1 in ite
+0005a390: 6d20 616e 6420 6b65 7932 2069 6e20 6974  m and key2 in it
+0005a3a0: 656d 3a0d 0a20 2020 2020 2020 2020 2020  em:..           
+0005a3b0: 2020 2020 2020 2020 2020 2020 2069 7465               ite
+0005a3c0: 6d5b 6b65 7931 5d2c 2069 7465 6d5b 6b65  m[key1], item[ke
+0005a3d0: 7932 5d20 3d20 6974 656d 5b6b 6579 325d  y2] = item[key2]
+0005a3e0: 2c20 6974 656d 5b6b 6579 315d 0d0a 0d0a  , item[key1]....
+0005a3f0: 2020 2020 2020 2020 2320 5265 706f 7075          # Repopu
+0005a400: 6c61 7465 2063 6861 7420 616e 6420 636f  late chat and co
+0005a410: 6e74 6163 7420 6c69 7374 730d 0a20 2020  ntact lists..   
+0005a420: 2020 2020 2073 656c 662e 6c69 7374 5f63       self.list_c
+0005a430: 6f6e 7461 6374 732e 506f 7075 6c61 7465  ontacts.Populate
+0005a440: 2873 656c 662e 636f 6e31 6469 6666 6c69  (self.con1diffli
+0005a450: 7374 206f 7220 5b5d 290d 0a20 2020 2020  st or [])..     
+0005a460: 2020 2073 656c 662e 6c69 7374 5f63 6861     self.list_cha
+0005a470: 7473 2e50 6f70 756c 6174 6528 7365 6c66  ts.Populate(self
+0005a480: 2e63 6f6d 7061 7265 6420 6f72 205b 5d29  .compared or [])
+0005a490: 0d0a 0d0a 2020 2020 2020 2020 2320 5570  ....        # Up
+0005a4a0: 6461 7465 2062 7574 746f 6e20 7374 6174  date button stat
+0005a4b0: 6573 0d0a 2020 2020 2020 2020 7365 6c66  es..        self
+0005a4c0: 2e62 7574 746f 6e5f 7363 616e 5f61 6c6c  .button_scan_all
+0005a4d0: 2e45 6e61 626c 6564 203d 2073 656c 662e  .Enabled = self.
+0005a4e0: 6275 7474 6f6e 5f6d 6572 6765 5f61 6c6c  button_merge_all
+0005a4f0: 2e45 6e61 626c 6564 203d 2054 7275 650d  .Enabled = True.
+0005a500: 0a20 2020 2020 2020 2073 656c 662e 6275  .        self.bu
+0005a510: 7474 6f6e 5f6d 6572 6765 5f61 6c6c 2e4e  tton_merge_all.N
+0005a520: 6f74 6520 3d20 7365 6c66 2e4d 4552 4745  ote = self.MERGE
+0005a530: 5f42 5554 544f 4e5f 4e4f 5445 0d0a 2020  _BUTTON_NOTE..  
+0005a540: 2020 2020 2020 7365 6c66 2e62 7574 746f        self.butto
+0005a550: 6e5f 6d65 7267 655f 636f 6e74 6163 7473  n_merge_contacts
+0005a560: 2e45 6e61 626c 6564 203d 2046 616c 7365  .Enabled = False
+0005a570: 0d0a 2020 2020 2020 2020 7365 6c66 2e62  ..        self.b
+0005a580: 7574 746f 6e5f 6d65 7267 655f 616c 6c63  utton_merge_allc
+0005a590: 6f6e 7461 6374 732e 456e 6162 6c65 6420  ontacts.Enabled 
+0005a5a0: 3d20 7365 6c66 2e6c 6973 745f 636f 6e74  = self.list_cont
+0005a5b0: 6163 7473 2e49 7465 6d43 6f75 6e74 0d0a  acts.ItemCount..
+0005a5c0: 0d0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
+0005a5d0: 616e 656c 5f67 6175 6765 2e48 6964 6528  anel_gauge.Hide(
+0005a5e0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+0005a5f0: 6874 6d6c 5f72 6570 6f72 742e 4869 6465  html_report.Hide
+0005a600: 2829 0d0a 0d0a 2020 2020 2020 2020 7365  ()....        se
+0005a610: 6c66 2e52 6566 7265 7368 2829 0d0a 2020  lf.Refresh()..  
+0005a620: 2020 2020 2020 7365 6c66 2e70 6167 655f        self.page_
+0005a630: 6d65 7267 655f 616c 6c2e 4c61 796f 7574  merge_all.Layout
+0005a640: 2829 0d0a 2020 2020 2020 2020 7365 6c66  ()..        self
+0005a650: 2e4c 6179 6f75 7428 290d 0a0d 0a0d 0a20  .Layout()...... 
+0005a660: 2020 2064 6566 206f 6e5f 6d65 7267 655f     def on_merge_
+0005a670: 6368 6174 7328 7365 6c66 2c20 6576 656e  chats(self, even
+0005a680: 7429 3a0d 0a20 2020 2020 2020 2022 2222  t):..        """
+0005a690: 4861 6e64 6c65 7220 6f6e 2063 686f 6f73  Handler on choos
+0005a6a0: 696e 6720 746f 206d 6572 6765 2074 6865  ing to merge the
+0005a6b0: 2063 6861 7473 2073 656c 6563 7465 6420   chats selected 
+0005a6c0: 696e 2063 6861 7420 6c69 7374 2e22 2222  in chat list."""
+0005a6d0: 0d0a 2020 2020 2020 2020 7365 6c65 6374  ..        select
+0005a6e0: 6564 2c20 7365 6c65 6374 6564 7320 3d20  ed, selecteds = 
+0005a6f0: 7365 6c66 2e6c 6973 745f 6368 6174 732e  self.list_chats.
+0005a700: 4765 7446 6972 7374 5365 6c65 6374 6564  GetFirstSelected
+0005a710: 2829 2c20 5b5d 0d0a 2020 2020 2020 2020  (), []..        
+0005a720: 7768 696c 6520 7365 6c65 6374 6564 203e  while selected >
+0005a730: 3d20 303a 0d0a 2020 2020 2020 2020 2020  = 0:..          
+0005a740: 2020 7365 6c65 6374 6564 732e 6170 7065    selecteds.appe
+0005a750: 6e64 2873 656c 662e 6c69 7374 5f63 6861  nd(self.list_cha
+0005a760: 7473 2e47 6574 4974 656d 4d61 7070 6564  ts.GetItemMapped
+0005a770: 4461 7461 2873 656c 6563 7465 6429 5b22  Data(selected)["
+0005a780: 6331 225d 290d 0a20 2020 2020 2020 2020  c1"])..         
+0005a790: 2020 2073 656c 6563 7465 6420 3d20 7365     selected = se
+0005a7a0: 6c66 2e6c 6973 745f 6368 6174 732e 4765  lf.list_chats.Ge
+0005a7b0: 744e 6578 7453 656c 6563 7465 6428 7365  tNextSelected(se
+0005a7c0: 6c65 6374 6564 290d 0a20 2020 2020 2020  lected)..       
+0005a7d0: 2069 6620 7365 6c65 6374 6564 733a 0d0a   if selecteds:..
+0005a7e0: 2020 2020 2020 2020 2020 2020 6163 7469              acti
+0005a7f0: 6f6e 203d 2022 4d65 7267 6522 2069 6620  on = "Merge" if 
+0005a800: 7365 6c66 2e69 735f 7363 616e 6e65 6420  self.is_scanned 
+0005a810: 656c 7365 2022 5363 616e 2061 6e64 206d  else "Scan and m
+0005a820: 6572 6765 220d 0a20 2020 2020 2020 2020  erge"..         
+0005a830: 2020 2069 6e66 6f20 3d20 7574 696c 2e70     info = util.p
+0005a840: 6c75 7261 6c28 2273 656c 6563 7465 6420  lural("selected 
+0005a850: 6368 6174 222c 2073 656c 6563 7465 6473  chat", selecteds
+0005a860: 2c20 7365 703d 222c 2229 0d0a 2020 2020  , sep=",")..    
+0005a870: 2020 2020 2020 2020 6d65 7373 6167 6520          message 
+0005a880: 3d20 2822 2573 2064 6966 6665 7265 6e63  = ("%s differenc
+0005a890: 6573 2069 6e20 2573 5c6e 5c6e 6672 6f6d  es in %s\n\nfrom
+0005a8a0: 2025 735c 6e5c 6e69 6e74 6f20 2573 3f22   %s\n\ninto %s?"
+0005a8b0: 2025 0d0a 2020 2020 2020 2020 2020 2020   %..            
+0005a8c0: 2020 2020 2020 2020 2020 2028 6163 7469             (acti
+0005a8d0: 6f6e 2c20 696e 666f 2c20 7365 6c66 2e64  on, info, self.d
+0005a8e0: 6231 2c20 7365 6c66 2e64 6232 2929 0d0a  b1, self.db2))..
+0005a8f0: 2020 2020 2020 2020 2020 2020 6966 2077              if w
+0005a900: 782e 4f4b 203d 3d20 7778 2e4d 6573 7361  x.OK == wx.Messa
+0005a910: 6765 426f 7828 6d65 7373 6167 652c 2063  geBox(message, c
+0005a920: 6f6e 662e 5469 746c 652c 0d0a 2020 2020  onf.Title,..    
+0005a930: 2020 2020 2020 2020 7778 2e49 434f 4e5f          wx.ICON_
+0005a940: 494e 464f 524d 4154 494f 4e20 7c20 7778  INFORMATION | wx
+0005a950: 2e43 414e 4345 4c29 3a0d 0a20 2020 2020  .CANCEL):..     
+0005a960: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0005a970: 6275 7474 6f6e 5f73 7761 702e 456e 6162  button_swap.Enab
+0005a980: 6c65 6420 3d20 4661 6c73 650d 0a20 2020  led = False..   
+0005a990: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0005a9a0: 662e 6275 7474 6f6e 5f6d 6572 6765 5f63  f.button_merge_c
+0005a9b0: 6861 7473 2e45 6e61 626c 6564 203d 2046  hats.Enabled = F
+0005a9c0: 616c 7365 0d0a 2020 2020 2020 2020 2020  alse..          
+0005a9d0: 2020 2020 2020 7365 6c66 2e62 7574 746f        self.butto
+0005a9e0: 6e5f 7363 616e 5f61 6c6c 2e45 6e61 626c  n_scan_all.Enabl
+0005a9f0: 6564 203d 2046 616c 7365 0d0a 2020 2020  ed = False..    
+0005aa00: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0005aa10: 2e62 7574 746f 6e5f 6d65 7267 655f 616c  .button_merge_al
+0005aa20: 6c2e 456e 6162 6c65 6420 3d20 4661 6c73  l.Enabled = Fals
+0005aa30: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
+0005aa40: 2020 2073 656c 662e 7061 6765 5f6d 6572     self.page_mer
+0005aa50: 6765 5f63 6861 7473 2e45 6e61 626c 6564  ge_chats.Enabled
+0005aa60: 203d 2046 616c 7365 0d0a 2020 2020 2020   = False..      
+0005aa70: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+0005aa80: 6167 655f 6d65 7267 655f 636f 6e74 6163  age_merge_contac
+0005aa90: 7473 2e45 6e61 626c 6564 203d 2046 616c  ts.Enabled = Fal
+0005aaa0: 7365 0d0a 2020 2020 2020 2020 2020 2020  se..            
+0005aab0: 2020 2020 7365 6c66 2e75 7064 6174 655f      self.update_
+0005aac0: 6761 7567 6528 7365 6c66 2e67 6175 6765  gauge(self.gauge
+0005aad0: 5f70 726f 6772 6573 732c 2030 2c0d 0a20  _progress, 0,.. 
+0005aae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0005aaf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005ab00: 6966 2073 656c 662e 6973 5f73 6361 6e6e  if self.is_scann
-0005ab10: 6564 3a0d 0a20 2020 2020 2020 2020 2020  ed:..           
-0005ab20: 2020 2020 2020 2020 2074 7970 6520 3d20           type = 
-0005ab30: 226d 6572 6765 5f6c 6566 7422 0d0a 2020  "merge_left"..  
-0005ab40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005ab50: 2020 6363 203d 205b 7365 6c66 2e63 6861    cc = [self.cha
-0005ab60: 7473 5f64 6966 6664 6174 612e 6765 7428  ts_diffdata.get(
-0005ab70: 635b 2269 6465 6e74 6974 7922 5d29 2066  c["identity"]) f
-0005ab80: 6f72 2063 2069 6e20 6368 6174 735d 0d0a  or c in chats]..
-0005ab90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005aba0: 2020 2020 6368 6174 7320 3d20 6c69 7374      chats = list
-0005abb0: 2866 696c 7465 7228 626f 6f6c 2c20 6363  (filter(bool, cc
-0005abc0: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
-0005abd0: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-0005abe0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0005abf0: 7970 6520 3d20 2264 6966 665f 6d65 7267  ype = "diff_merg
-0005ac00: 655f 6c65 6674 220d 0a20 2020 2020 2020  e_left"..       
-0005ac10: 2020 2020 2020 2020 2070 6172 616d 7320           params 
-0005ac20: 3d20 6c6f 6361 6c73 2829 0d0a 2020 2020  = locals()..    
-0005ac30: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0005ac40: 2e77 6f72 6b65 725f 6d65 7267 652e 776f  .worker_merge.wo
-0005ac50: 726b 2870 6172 616d 7329 0d0a 2020 2020  rk(params)..    
-0005ac60: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0005ac70: 2e69 735f 6d65 7267 696e 6720 3d20 5472  .is_merging = Tr
-0005ac80: 7565 0d0a 2020 2020 2020 2020 2020 2020  ue..            
-0005ac90: 2020 2020 6775 6962 6173 652e 7374 6174      guibase.stat
-0005aca0: 7573 2822 4d65 7267 696e 6720 2573 2066  us("Merging %s f
-0005acb0: 726f 6d20 2573 2074 6f20 2573 2e22 2c20  rom %s to %s.", 
-0005acc0: 696e 666f 2c20 6462 312c 2064 6232 2c20  info, db1, db2, 
-0005acd0: 6c6f 673d 5472 7565 290d 0a20 2020 2020  log=True)..     
-0005ace0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0005acf0: 6e6f 7465 626f 6f6b 2e53 6574 5365 6c65  notebook.SetSele
-0005ad00: 6374 696f 6e28 3029 0d0a 0d0a 0d0a 2020  ction(0)......  
-0005ad10: 2020 6465 6620 6f6e 5f6c 696e 6b5f 6462    def on_link_db
-0005ad20: 2873 656c 662c 2065 7665 6e74 293a 0d0a  (self, event):..
-0005ad30: 2020 2020 2020 2020 2222 2248 616e 646c          """Handl
-0005ad40: 6572 206f 6e20 636c 6963 6b69 6e67 2061  er on clicking a
-0005ad50: 2064 6174 6162 6173 6520 6c69 6e6b 2c20   database link, 
-0005ad60: 6f70 656e 7320 7468 6520 6461 7461 6261  opens the databa
-0005ad70: 7365 2074 6162 2e22 2222 0d0a 2020 2020  se tab."""..    
-0005ad80: 2020 2020 7365 6c66 2e54 6f70 4c65 7665      self.TopLeve
-0005ad90: 6c50 6172 656e 742e 6c6f 6164 5f64 6174  lParent.load_dat
-0005ada0: 6162 6173 655f 7061 6765 2865 7665 6e74  abase_page(event
-0005adb0: 2e47 6574 4c69 6e6b 496e 666f 2829 2e48  .GetLinkInfo().H
-0005adc0: 7265 6629 0d0a 0d0a 0d0a 2020 2020 6465  ref)......    de
-0005add0: 6620 6f6e 5f73 656c 6563 745f 6c69 7374  f on_select_list
-0005ade0: 5f63 6f6e 7461 6374 7328 7365 6c66 2c20  _contacts(self, 
-0005adf0: 6576 656e 7429 3a0d 0a20 2020 2020 2020  event):..       
-0005ae00: 2022 2222 0d0a 2020 2020 2020 2020 4861   """..        Ha
-0005ae10: 6e64 6c65 7220 666f 7220 6368 616e 6769  ndler for changi
-0005ae20: 6e67 2073 656c 6563 7469 6f6e 2069 6e20  ng selection in 
-0005ae30: 636f 6e74 6163 7473 206c 6973 742c 2075  contacts list, u
-0005ae40: 7064 6174 6573 2062 7574 746f 6e20 7374  pdates button st
-0005ae50: 6174 6573 2e0d 0a20 2020 2020 2020 2022  ates...        "
-0005ae60: 2222 0d0a 2020 2020 2020 2020 7365 6c66  ""..        self
-0005ae70: 2e62 7574 746f 6e5f 6d65 7267 655f 636f  .button_merge_co
-0005ae80: 6e74 6163 7473 2e45 6e61 626c 6564 203d  ntacts.Enabled =
-0005ae90: 2062 6f6f 6c28 7365 6c66 2e6c 6973 745f   bool(self.list_
-0005aea0: 636f 6e74 6163 7473 2e53 656c 6563 7465  contacts.Selecte
-0005aeb0: 6449 7465 6d43 6f75 6e74 290d 0a20 2020  dItemCount)..   
-0005aec0: 2020 2020 2073 656c 662e 6275 7474 6f6e       self.button
-0005aed0: 5f6d 6572 6765 5f63 6f6e 7461 6374 732e  _merge_contacts.
-0005aee0: 5265 6672 6573 6828 290d 0a0d 0a0d 0a20  Refresh()...... 
-0005aef0: 2020 2064 6566 206f 6e5f 636c 6963 6b5f     def on_click_
-0005af00: 6c69 6e6b 2873 656c 662c 2065 7665 6e74  link(self, event
-0005af10: 293a 0d0a 2020 2020 2020 2020 2222 220d  ):..        """.
-0005af20: 0a20 2020 2020 2020 2048 616e 646c 6572  .        Handler
-0005af30: 2066 6f72 2063 6c69 636b 696e 6720 6120   for clicking a 
-0005af40: 6c69 6e6b 2069 6e20 6368 6174 2068 6973  link in chat his
-0005af50: 746f 7279 2c20 6f70 656e 7320 7468 6520  tory, opens the 
-0005af60: 6c69 6e6b 2069 6e20 7379 7374 656d 0d0a  link in system..
-0005af70: 2020 2020 2020 2020 6272 6f77 7365 722e          browser.
-0005af80: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
-0005af90: 2020 2020 2020 2073 7463 203d 2065 7665         stc = eve
-0005afa0: 6e74 2e45 7665 6e74 4f62 6a65 6374 0d0a  nt.EventObject..
-0005afb0: 2020 2020 2020 2020 6966 2073 7463 2e47          if stc.G
-0005afc0: 6574 5374 796c 6541 7428 6576 656e 742e  etStyleAt(event.
-0005afd0: 506f 7369 7469 6f6e 2920 3d3d 2073 656c  Position) == sel
-0005afe0: 662e 7374 635f 7374 796c 6573 5b22 6c69  f.stc_styles["li
-0005aff0: 6e6b 225d 3a0d 0a20 2020 2020 2020 2020  nk"]:..         
-0005b000: 2020 2023 2047 6f20 6261 636b 2061 6e64     # Go back and
-0005b010: 2066 6f72 7468 2066 726f 6d20 706f 7369   forth from posi
-0005b020: 7469 6f6e 2061 6e64 2067 6574 2055 524c  tion and get URL
-0005b030: 2072 616e 6765 2e0d 0a20 2020 2020 2020   range...       
-0005b040: 2020 2020 2075 726c 5f72 616e 6765 203d       url_range =
-0005b050: 207b 2d31 3a20 2d31 2c20 313a 202d 317d   {-1: -1, 1: -1}
-0005b060: 2023 207b 2073 7461 7274 2061 6e64 2065   # { start and e
-0005b070: 6e64 2070 6f73 6974 696f 6e73 207d 0d0a  nd positions }..
-0005b080: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0005b090: 7374 6570 2069 6e20 7572 6c5f 7261 6e67  step in url_rang
-0005b0a0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-0005b0b0: 2020 2020 706f 7320 3d20 6576 656e 742e      pos = event.
-0005b0c0: 506f 7369 7469 6f6e 0d0a 2020 2020 2020  Position..      
-0005b0d0: 2020 2020 2020 2020 2020 7768 696c 6520            while 
-0005b0e0: 7374 632e 4765 7453 7479 6c65 4174 2870  stc.GetStyleAt(p
-0005b0f0: 6f73 202b 2073 7465 7029 203d 3d20 7365  os + step) == se
-0005b100: 6c66 2e73 7463 5f73 7479 6c65 735b 226c  lf.stc_styles["l
-0005b110: 696e 6b22 5d3a 0d0a 2020 2020 2020 2020  ink"]:..        
-0005b120: 2020 2020 2020 2020 2020 2020 706f 7320              pos 
-0005b130: 2b3d 2073 7465 700d 0a20 2020 2020 2020  += step..       
-0005b140: 2020 2020 2020 2020 2075 726c 5f72 616e           url_ran
-0005b150: 6765 5b73 7465 705d 203d 2070 6f73 0d0a  ge[step] = pos..
-0005b160: 2020 2020 2020 2020 2020 2020 7572 6c20              url 
-0005b170: 3d20 7374 632e 4765 7454 6578 7452 616e  = stc.GetTextRan
-0005b180: 6765 2875 726c 5f72 616e 6765 5b2d 315d  ge(url_range[-1]
-0005b190: 2c20 7572 6c5f 7261 6e67 655b 315d 202b  , url_range[1] +
-0005b1a0: 2031 290d 0a20 2020 2020 2020 2020 2020   1)..           
-0005b1b0: 2077 6562 6272 6f77 7365 722e 6f70 656e   webbrowser.open
-0005b1c0: 2875 726c 290d 0a0d 0a0d 0a20 2020 2064  (url)......    d
-0005b1d0: 6566 206f 6e5f 6368 616e 6765 5f63 6861  ef on_change_cha
-0005b1e0: 7466 696c 7465 7228 7365 6c66 2c20 6576  tfilter(self, ev
-0005b1f0: 656e 7429 3a0d 0a20 2020 2020 2020 2022  ent):..        "
-0005b200: 2222 4861 6e64 6c65 7220 666f 7220 6368  ""Handler for ch
-0005b210: 616e 6769 6e67 2074 6578 7420 696e 2063  anging text in c
-0005b220: 6861 7420 6669 6c74 6572 2062 6f78 2c20  hat filter box, 
-0005b230: 6669 6c74 6572 7320 6368 6174 206c 6973  filters chat lis
-0005b240: 742e 2222 220d 0a20 2020 2020 2020 2073  t."""..        s
-0005b250: 656c 662e 6c69 7374 5f63 6861 7473 2e53  elf.list_chats.S
-0005b260: 6574 4669 6c74 6572 2865 7665 6e74 2e53  etFilter(event.S
-0005b270: 7472 696e 672e 7374 7269 7028 2929 0d0a  tring.strip())..
-0005b280: 0d0a 0d0a 2020 2020 6465 6620 6f6e 5f63  ....    def on_c
-0005b290: 6861 6e67 655f 636f 6e74 6163 7466 696c  hange_contactfil
-0005b2a0: 7465 7228 7365 6c66 2c20 6576 656e 7429  ter(self, event)
-0005b2b0: 3a0d 0a20 2020 2020 2020 2022 2222 0d0a  :..        """..
-0005b2c0: 2020 2020 2020 2020 4861 6e64 6c65 7220          Handler 
-0005b2d0: 666f 7220 6368 616e 6769 6e67 2074 6578  for changing tex
-0005b2e0: 7420 696e 2063 6861 7420 6669 6c74 6572  t in chat filter
-0005b2f0: 2062 6f78 2c20 6669 6c74 6572 7320 636f   box, filters co
-0005b300: 6e74 6163 7420 6c69 7374 732e 0d0a 2020  ntact lists...  
-0005b310: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
-0005b320: 2020 2073 656c 662e 6c69 7374 5f63 6f6e     self.list_con
-0005b330: 7461 6374 732e 5365 7446 696c 7465 7228  tacts.SetFilter(
-0005b340: 6576 656e 742e 5374 7269 6e67 2e73 7472  event.String.str
-0005b350: 6970 2829 290d 0a20 2020 2020 2020 2073  ip())..        s
-0005b360: 656c 662e 6275 7474 6f6e 5f6d 6572 6765  elf.button_merge
-0005b370: 5f63 6f6e 7461 6374 732e 456e 6162 6c65  _contacts.Enable
-0005b380: 6420 3d20 7365 6c66 2e6c 6973 745f 636f  d = self.list_co
-0005b390: 6e74 6163 7473 2e53 656c 6563 7465 6449  ntacts.SelectedI
-0005b3a0: 7465 6d43 6f75 6e74 0d0a 2020 2020 2020  temCount..      
-0005b3b0: 2020 7365 6c66 2e62 7574 746f 6e5f 6d65    self.button_me
-0005b3c0: 7267 655f 616c 6c63 6f6e 7461 6374 732e  rge_allcontacts.
-0005b3d0: 456e 6162 6c65 6420 3d20 7365 6c66 2e6c  Enabled = self.l
-0005b3e0: 6973 745f 636f 6e74 6163 7473 2e49 7465  ist_contacts.Ite
-0005b3f0: 6d43 6f75 6e74 0d0a 0d0a 0d0a 2020 2020  mCount......    
-0005b400: 6465 6620 6f6e 5f63 6861 6e67 655f 6c69  def on_change_li
-0005b410: 7374 5f63 6861 7473 2873 656c 662c 2065  st_chats(self, e
-0005b420: 7665 6e74 3d4e 6f6e 652c 2063 6861 743d  vent=None, chat=
-0005b430: 4e6f 6e65 293a 0d0a 2020 2020 2020 2020  None):..        
-0005b440: 2222 220d 0a20 2020 2020 2020 2048 616e  """..        Han
-0005b450: 646c 6572 2066 6f72 2061 6374 6976 6174  dler for activat
-0005b460: 696e 6720 616e 2069 7465 6d20 696e 2074  ing an item in t
-0005b470: 6865 2064 6966 6665 7269 6e67 2063 6861  he differing cha
-0005b480: 7473 206c 6973 742c 0d0a 2020 2020 2020  ts list,..      
-0005b490: 2020 676f 6573 2074 6872 6f75 6768 2061    goes through a
-0005b4a0: 6c6c 206d 6573 7361 6765 7320 6f66 2074  ll messages of t
-0005b4b0: 6865 2063 6861 7420 696e 2062 6f74 6820  he chat in both 
-0005b4c0: 6461 7461 6261 7365 7320 616e 6420 7368  databases and sh
-0005b4d0: 6f77 730d 0a20 2020 2020 2020 2074 686f  ows..        tho
-0005b4e0: 7365 206d 6573 7361 6765 7320 7468 6174  se messages that
-0005b4f0: 2061 7265 206d 6973 7369 6e67 206f 7220   are missing or 
-0005b500: 6469 6666 6572 656e 742c 2066 6f72 2062  different, for b
-0005b510: 6f74 6820 6c65 6674 2061 6e64 0d0a 2020  oth left and..  
-0005b520: 2020 2020 2020 7269 6768 742e 0d0a 2020        right...  
-0005b530: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
-0005b540: 2020 2063 203d 2063 6861 7420 6f72 2073     c = chat or s
-0005b550: 656c 662e 6c69 7374 5f63 6861 7473 2e47  elf.list_chats.G
-0005b560: 6574 4974 656d 4d61 7070 6564 4461 7461  etItemMappedData
-0005b570: 2865 7665 6e74 2e49 6e64 6578 290d 0a20  (event.Index).. 
-0005b580: 2020 2020 2020 2069 6620 6e6f 7420 7365         if not se
-0005b590: 6c66 2e63 6861 7420 6f72 2063 5b22 6964  lf.chat or c["id
-0005b5a0: 656e 7469 7479 225d 2021 3d20 7365 6c66  entity"] != self
-0005b5b0: 2e63 6861 745b 2269 6465 6e74 6974 7922  .chat["identity"
-0005b5c0: 5d3a 0d0a 2020 2020 2020 2020 2020 2020  ]:..            
-0005b5d0: 7365 6c66 2e6c 6162 656c 5f6d 6572 6765  self.label_merge
-0005b5e0: 5f63 6861 742e 4c61 6265 6c20 3d20 224e  _chat.Label = "N
-0005b5f0: 6577 2069 6e20 2573 3a22 205c 0d0a 2020  ew in %s:" \..  
-0005b600: 2020 2020 2020 2020 2020 2020 2020 2520                % 
-0005b610: 635b 2274 6974 6c65 5f6c 6f6e 675f 6c63  c["title_long_lc
-0005b620: 225d 0d0a 2020 2020 2020 2020 2020 2020  "]..            
-0005b630: 6c6f 6767 6572 2e69 6e66 6f28 2243 6f6d  logger.info("Com
-0005b640: 7061 7269 6e67 2025 7320 2825 7320 7673  paring %s (%s vs
-0005b650: 2025 7329 2e22 2c20 635b 2274 6974 6c65   %s).", c["title
-0005b660: 5f6c 6f6e 675f 6c63 225d 2c0d 0a20 2020  _long_lc"],..   
-0005b670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005b680: 2020 2020 2073 656c 662e 6462 312c 2073       self.db1, s
-0005b690: 656c 662e 6462 3229 0d0a 2020 2020 2020  elf.db2)..      
-0005b6a0: 2020 2020 2020 7363 726f 6c6c 706f 7320        scrollpos 
-0005b6b0: 3d20 7365 6c66 2e6c 6973 745f 6368 6174  = self.list_chat
-0005b6c0: 732e 4765 7453 6372 6f6c 6c50 6f73 2877  s.GetScrollPos(w
-0005b6d0: 782e 5645 5254 4943 414c 290d 0a20 2020  x.VERTICAL)..   
-0005b6e0: 2020 2020 2020 2020 2069 6e64 6578 5f73           index_s
-0005b6f0: 656c 6563 7465 6420 3d20 2d31 0d0a 2020  elected = -1..  
-0005b700: 2020 2020 2020 2020 2020 2320 5570 6461            # Upda
-0005b710: 7465 2069 7465 6d20 6261 636b 6772 6f75  te item backgrou
-0005b720: 6e64 2069 6e20 6368 6174 7320 6c69 7374  nd in chats list
-0005b730: 0d0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
-0005b740: 7220 6920 696e 2072 616e 6765 2873 656c  r i in range(sel
-0005b750: 662e 6c69 7374 5f63 6861 7473 2e49 7465  f.list_chats.Ite
-0005b760: 6d43 6f75 6e74 293a 0d0a 2020 2020 2020  mCount):..      
-0005b770: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-0005b780: 662e 6c69 7374 5f63 6861 7473 2e47 6574  f.list_chats.Get
-0005b790: 4974 656d 4d61 7070 6564 4461 7461 2869  ItemMappedData(i
-0005b7a0: 2920 3d3d 2073 656c 662e 6368 6174 3a0d  ) == self.chat:.
-0005b7b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0005b7c0: 2020 2020 2073 656c 662e 6c69 7374 5f63       self.list_c
-0005b7d0: 6861 7473 2e53 6574 4974 656d 466f 6e74  hats.SetItemFont
-0005b7e0: 2869 2c20 7365 6c66 2e6c 6973 745f 6368  (i, self.list_ch
-0005b7f0: 6174 732e 466f 6e74 290d 0a20 2020 2020  ats.Font)..     
-0005b800: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-0005b810: 7365 6c66 2e6c 6973 745f 6368 6174 732e  self.list_chats.
-0005b820: 4765 7449 7465 6d4d 6170 7065 6444 6174  GetItemMappedDat
-0005b830: 6128 6929 203d 3d20 633a 0d0a 2020 2020  a(i) == c:..    
-0005b840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005b850: 696e 6465 785f 7365 6c65 6374 6564 203d  index_selected =
-0005b860: 2069 0d0a 2020 2020 2020 2020 2020 2020   i..            
-0005b870: 2020 2020 2020 2020 6620 3d20 7365 6c66          f = self
-0005b880: 2e6c 6973 745f 6368 6174 732e 466f 6e74  .list_chats.Font
-0005b890: 3b20 662e 5365 7457 6569 6768 7428 7778  ; f.SetWeight(wx
-0005b8a0: 2e46 4f4e 5457 4549 4748 545f 424f 4c44  .FONTWEIGHT_BOLD
-0005b8b0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0005b8c0: 2020 2020 2020 2073 656c 662e 6c69 7374         self.list
-0005b8d0: 5f63 6861 7473 2e53 6574 4974 656d 466f  _chats.SetItemFo
-0005b8e0: 6e74 2869 2c20 6629 0d0a 2020 2020 2020  nt(i, f)..      
-0005b8f0: 2020 2020 2020 6966 2069 6e64 6578 5f73        if index_s
-0005b900: 656c 6563 7465 6420 3e3d 2030 3a0d 0a20  elected >= 0:.. 
-0005b910: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0005b920: 656c 7461 203d 2069 6e64 6578 5f73 656c  elta = index_sel
-0005b930: 6563 7465 6420 2d20 7363 726f 6c6c 706f  ected - scrollpo
-0005b940: 730d 0a20 2020 2020 2020 2020 2020 2020  s..             
-0005b950: 2020 2069 6620 6465 6c74 6120 3c20 3020     if delta < 0 
-0005b960: 6f72 2061 6273 2864 656c 7461 2920 3e3d  or abs(delta) >=
-0005b970: 2073 656c 662e 6c69 7374 5f63 6861 7473   self.list_chats
-0005b980: 2e43 6f75 6e74 5065 7250 6167 653a 0d0a  .CountPerPage:..
-0005b990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005b9a0: 2020 2020 6e75 6467 6520 3d20 2d73 656c      nudge = -sel
-0005b9b0: 662e 6c69 7374 5f63 6861 7473 2e43 6f75  f.list_chats.Cou
-0005b9c0: 6e74 5065 7250 6167 6520 2f2f 2032 0d0a  ntPerPage // 2..
-0005b9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005b9e0: 2020 2020 7365 6c66 2e6c 6973 745f 6368      self.list_ch
-0005b9f0: 6174 732e 5363 726f 6c6c 4c69 6e65 7328  ats.ScrollLines(
-0005ba00: 6465 6c74 6120 2b20 6e75 6467 6529 0d0a  delta + nudge)..
-0005ba10: 2020 2020 2020 2020 2020 2020 6275 7379              busy
-0005ba20: 203d 2063 6f6e 7472 6f6c 732e 4275 7379   = controls.Busy
-0005ba30: 5061 6e65 6c28 0d0a 2020 2020 2020 2020  Panel(..        
-0005ba40: 2020 2020 2020 2020 7365 6c66 2c20 2244          self, "D
-0005ba50: 6966 6669 6e67 206d 6573 7361 6765 7320  iffing messages 
-0005ba60: 666f 7220 2573 2e22 2025 2063 5b22 7469  for %s." % c["ti
-0005ba70: 746c 655f 6c6f 6e67 5f6c 6322 5d29 0d0a  tle_long_lc"])..
-0005ba80: 0d0a 2020 2020 2020 2020 2020 2020 7472  ..            tr
-0005ba90: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
-0005baa0: 2020 2020 6469 6666 203d 207b 226d 6573      diff = {"mes
-0005bab0: 7361 6765 7322 3a20 5b5d 2c20 2270 6172  sages": [], "par
-0005bac0: 7469 6369 7061 6e74 7322 3a20 5b5d 7d0d  ticipants": []}.
-0005bad0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0005bae0: 2064 6174 6120 3d20 7365 6c66 2e63 6861   data = self.cha
-0005baf0: 7473 5f64 6966 6664 6174 612e 6765 7428  ts_diffdata.get(
-0005bb00: 635b 2269 6465 6e74 6974 7922 5d29 0d0a  c["identity"])..
-0005bb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005bb20: 6966 2064 6174 613a 0d0a 2020 2020 2020  if data:..      
-0005bb30: 2020 2020 2020 2020 2020 2020 2020 6469                di
-0005bb40: 6666 203d 2064 6174 615b 2264 6966 6622  ff = data["diff"
-0005bb50: 5d20 2320 5573 6520 6361 6368 6564 2064  ] # Use cached d
-0005bb60: 6966 6620 6966 2061 7661 696c 6162 6c65  iff if available
-0005bb70: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0005bb80: 2020 656c 6966 206e 6f74 2073 656c 662e    elif not self.
-0005bb90: 6973 5f73 6361 6e6e 6564 205c 0d0a 2020  is_scanned \..  
-0005bba0: 2020 2020 2020 2020 2020 2020 2020 616e                an
-0005bbb0: 6420 635b 2269 6465 6e74 6974 7922 5d20  d c["identity"] 
-0005bbc0: 6e6f 7420 696e 2073 656c 662e 6368 6174  not in self.chat
-0005bbd0: 735f 6e6f 6469 6666 3a0d 0a20 2020 2020  s_nodiff:..     
-0005bbe0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0005bbf0: 6966 6620 3d20 7365 6c66 2e77 6f72 6b65  iff = self.worke
-0005bc00: 725f 6d65 7267 652e 6765 745f 6368 6174  r_merge.get_chat
-0005bc10: 5f64 6966 665f 6c65 6674 2863 2c20 7365  _diff_left(c, se
-0005bc20: 6c66 2e64 6231 2c0d 0a20 2020 2020 2020  lf.db1,..       
-0005bc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005bc40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005bc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005bc60: 2020 2020 2020 2020 2073 656c 662e 6462           self.db
-0005bc70: 3229 0d0a 2020 2020 2020 2020 2020 2020  2)..            
-0005bc80: 2020 2020 2020 2020 6461 7461 203d 207b          data = {
-0005bc90: 2263 6861 7422 3a20 632c 2022 6469 6666  "chat": c, "diff
-0005bca0: 223a 2064 6966 667d 0d0a 2020 2020 2020  ": diff}..      
-0005bcb0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0005bcc0: 2061 6e79 2864 6966 662e 7661 6c75 6573   any(diff.values
-0005bcd0: 2829 293a 2023 2043 6163 6865 206e 6577  ()): # Cache new
-0005bce0: 2064 6966 660d 0a20 2020 2020 2020 2020   diff..         
-0005bcf0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0005bd00: 656c 662e 6368 6174 735f 6469 6666 6461  elf.chats_diffda
-0005bd10: 7461 5b63 5b22 6964 656e 7469 7479 225d  ta[c["identity"]
-0005bd20: 5d20 3d20 6461 7461 0d0a 2020 2020 2020  ] = data..      
-0005bd30: 2020 2020 2020 2020 2020 2020 2020 656c                el
-0005bd40: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-0005bd50: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0005bd60: 662e 6368 6174 735f 6e6f 6469 6666 5b63  f.chats_nodiff[c
-0005bd70: 5b22 6964 656e 7469 7479 225d 5d20 3d20  ["identity"]] = 
-0005bd80: 630d 0a20 2020 2020 2020 2020 2020 2020  c..             
-0005bd90: 2020 2065 6c69 6620 635b 2269 6465 6e74     elif c["ident
-0005bda0: 6974 7922 5d20 6e6f 7420 696e 2073 656c  ity"] not in sel
-0005bdb0: 662e 6368 6174 735f 6e6f 6469 6666 3a0d  f.chats_nodiff:.
-0005bdc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0005bdd0: 2020 2020 2064 6174 6120 3d20 7b22 6368       data = {"ch
-0005bde0: 6174 223a 2063 2c20 2264 6966 6622 3a20  at": c, "diff": 
-0005bdf0: 6469 6666 7d0d 0a20 2020 2020 2020 2020  diff}..         
-0005be00: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0005be10: 6368 6174 735f 6e6f 6469 6666 5b63 5b22  chats_nodiff[c["
-0005be20: 6964 656e 7469 7479 225d 5d20 3d20 6461  identity"]] = da
-0005be30: 7461 0d0a 2020 2020 2020 2020 2020 2020  ta..            
-0005be40: 2020 2020 6d65 7373 6167 6573 203d 206c      messages = l
-0005be50: 6973 7428 7365 6c66 2e64 6231 2e6d 6573  ist(self.db1.mes
-0005be60: 7361 6765 5f69 7465 7261 746f 7228 6469  sage_iterator(di
-0005be70: 6666 5b22 6d65 7373 6167 6573 225d 2929  ff["messages"]))
-0005be80: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0005be90: 2020 7365 6c66 2e63 6861 7420 3d20 630d    self.chat = c.
-0005bea0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0005beb0: 2073 656c 662e 6368 6174 5f64 6966 6620   self.chat_diff 
-0005bec0: 3d20 6469 6666 0d0a 2020 2020 2020 2020  = diff..        
-0005bed0: 2020 2020 2020 2020 7365 6c66 2e62 7574          self.but
-0005bee0: 746f 6e5f 6d65 7267 655f 6368 6174 2e45  ton_merge_chat.E
-0005bef0: 6e61 626c 6564 203d 206c 656e 286d 6573  nabled = len(mes
-0005bf00: 7361 6765 7329 0d0a 2020 2020 2020 2020  sages)..        
-0005bf10: 2020 2020 2020 2020 7365 6c66 2e62 7574          self.but
-0005bf20: 746f 6e5f 6d65 7267 655f 6368 6174 2e4e  ton_merge_chat.N
-0005bf30: 6f74 6520 3d20 7365 6c66 2e4d 4552 4745  ote = self.MERGE
-0005bf40: 5f43 4841 545f 4255 5454 4f4e 5f4e 4f54  _CHAT_BUTTON_NOT
-0005bf50: 450d 0a20 2020 2020 2020 2020 2020 2020  E..             
-0005bf60: 2020 2073 656c 662e 6275 7474 6f6e 5f65     self.button_e
-0005bf70: 7870 6f72 745f 6368 6174 2e45 6e61 626c  xport_chat.Enabl
-0005bf80: 6564 203d 206c 656e 286d 6573 7361 6765  ed = len(message
-0005bf90: 7329 0d0a 2020 2020 2020 2020 2020 2020  s)..            
-0005bfa0: 2020 2020 6966 206d 6573 7361 6765 733a      if messages:
-0005bfb0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0005bfc0: 2020 2020 2020 7365 6c66 2e62 7574 746f        self.butto
-0005bfd0: 6e5f 6d65 7267 655f 6368 6174 2e4e 6f74  n_merge_chat.Not
-0005bfe0: 6520 3d20 280d 0a20 2020 2020 2020 2020  e = (..         
-0005bff0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0005c000: 436f 7079 2025 7320 746f 2074 6865 2064  Copy %s to the d
-0005c010: 6174 6162 6173 6520 6f6e 2074 6865 2072  atabase on the r
-0005c020: 6967 6874 2e22 2025 0d0a 2020 2020 2020  ight." %..      
-0005c030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005c040: 2020 7574 696c 2e70 6c75 7261 6c28 2263    util.plural("c
-0005c050: 6861 7420 6d65 7373 6167 6522 2c20 6d65  hat message", me
-0005c060: 7373 6167 6573 2c20 7365 703d 222c 2229  ssages, sep=",")
-0005c070: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0005c080: 2020 2020 2020 2073 656c 662e 6275 7474         self.butt
-0005c090: 6f6e 5f6d 6572 6765 5f63 6861 742e 436f  on_merge_chat.Co
-0005c0a0: 6e74 6169 6e69 6e67 5369 7a65 722e 4c61  ntainingSizer.La
-0005c0b0: 796f 7574 2829 0d0a 2020 2020 2020 2020  yout()..        
-0005c0c0: 2020 2020 2020 2020 6964 7820 3d20 2d63          idx = -c
-0005c0d0: 6f6e 662e 4d61 7848 6973 746f 7279 496e  onf.MaxHistoryIn
-0005c0e0: 6974 6961 6c4d 6573 7361 6765 730d 0a20  itialMessages.. 
-0005c0f0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0005c100: 656c 662e 7374 635f 6469 6666 312e 506f  elf.stc_diff1.Po
-0005c110: 7075 6c61 7465 2863 2c20 7365 6c66 2e64  pulate(c, self.d
-0005c120: 6231 2c20 6d65 7373 6167 6573 2c20 6672  b1, messages, fr
-0005c130: 6f6d 5f69 6e64 6578 3d69 6478 290d 0a20  om_index=idx).. 
-0005c140: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0005c150: 6578 746c 656e 6774 6820 3d20 7365 6c66  extlength = self
-0005c160: 2e73 7463 5f64 6966 6631 2e54 6578 744c  .stc_diff1.TextL
-0005c170: 656e 6774 680d 0a20 2020 2020 2020 2020  ength..         
-0005c180: 2020 2020 2020 2073 656c 662e 7374 635f         self.stc_
-0005c190: 6469 6666 312e 5365 7453 656c 6563 7469  diff1.SetSelecti
-0005c1a0: 6f6e 2874 6578 746c 656e 6774 682c 2074  on(textlength, t
-0005c1b0: 6578 746c 656e 6774 6829 0d0a 2020 2020  extlength)..    
-0005c1c0: 2020 2020 2020 2020 6669 6e61 6c6c 793a          finally:
-0005c1d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0005c1e0: 2020 6275 7379 2e43 6c6f 7365 2829 0d0a    busy.Close()..
-0005c1f0: 0d0a 0d0a 2020 2020 6465 6620 6f6e 5f6d  ....    def on_m
-0005c200: 6572 6765 5f63 6f6e 7461 6374 7328 7365  erge_contacts(se
-0005c210: 6c66 2c20 6576 656e 7429 3a0d 0a20 2020  lf, event):..   
-0005c220: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-0005c230: 2020 4861 6e64 6c65 7220 666f 7220 636c    Handler for cl
-0005c240: 6963 6b69 6e67 2074 6f20 6d65 7267 6520  icking to merge 
-0005c250: 636f 6e74 6163 7473 2066 726f 6d20 6f6e  contacts from on
-0005c260: 6520 6461 7461 6261 7365 2074 6f20 7468  e database to th
-0005c270: 6520 6f74 6865 722c 0d0a 2020 2020 2020  e other,..      
-0005c280: 2020 6569 7468 6572 2073 656c 6563 7465    either selecte
-0005c290: 6420 6f72 2061 6c6c 2063 6f6e 7461 6374  d or all contact
-0005c2a0: 732c 2064 6570 656e 6469 6e67 206f 6e20  s, depending on 
-0005c2b0: 6275 7474 6f6e 2063 6c69 636b 6564 2e0d  button clicked..
-0005c2c0: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
-0005c2d0: 2020 2020 2020 6462 5f74 6172 6765 742c        db_target,
-0005c2e0: 2064 625f 736f 7572 6365 203d 2073 656c   db_source = sel
-0005c2f0: 662e 6462 322c 2073 656c 662e 6462 310d  f.db2, self.db1.
-0005c300: 0a20 2020 2020 2020 206c 6973 745f 736f  .        list_so
-0005c310: 7572 6365 203d 2073 656c 662e 6c69 7374  urce = self.list
-0005c320: 5f63 6f6e 7461 6374 730d 0a20 2020 2020  _contacts..     
-0005c330: 2020 2073 6f75 7263 6520 3d20 300d 0a20     source = 0.. 
-0005c340: 2020 2020 2020 2063 6f6e 7461 6374 732c         contacts,
-0005c350: 2063 6f6e 7461 6374 6772 6f75 7073 2c20   contactgroups, 
-0005c360: 696e 6469 6365 7320 3d20 5b5d 2c20 5b5d  indices = [], []
-0005c370: 2c20 5b5d 0d0a 2020 2020 2020 2020 6966  , []..        if
-0005c380: 2065 7665 6e74 2e49 6420 3d3d 2073 656c   event.Id == sel
-0005c390: 662e 6275 7474 6f6e 5f6d 6572 6765 5f61  f.button_merge_a
-0005c3a0: 6c6c 636f 6e74 6163 7473 2e49 643a 0d0a  llcontacts.Id:..
-0005c3b0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0005c3c0: 6920 696e 2072 616e 6765 286c 6973 745f  i in range(list_
-0005c3d0: 736f 7572 6365 2e49 7465 6d43 6f75 6e74  source.ItemCount
-0005c3e0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-0005c3f0: 2020 2020 6461 7461 203d 206c 6973 745f      data = list_
-0005c400: 736f 7572 6365 2e47 6574 4974 656d 4d61  source.GetItemMa
-0005c410: 7070 6564 4461 7461 2869 290d 0a20 2020  ppedData(i)..   
-0005c420: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0005c430: 2243 6f6e 7461 6374 2220 3d3d 2064 6174  "Contact" == dat
-0005c440: 615b 225f 5f74 7970 6522 5d3a 0d0a 2020  a["__type"]:..  
-0005c450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005c460: 2020 636f 6e74 6163 7473 2e61 7070 656e    contacts.appen
-0005c470: 6428 6461 7461 5b22 5f5f 6461 7461 225d  d(data["__data"]
-0005c480: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0005c490: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-0005c4a0: 2020 2020 2020 2020 2020 2020 2020 636f                co
-0005c4b0: 6e74 6163 7467 726f 7570 732e 6170 7065  ntactgroups.appe
-0005c4c0: 6e64 2864 6174 615b 225f 5f64 6174 6122  nd(data["__data"
-0005c4d0: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
-0005c4e0: 2020 2020 696e 6469 6365 732e 6170 7065      indices.appe
-0005c4f0: 6e64 2869 290d 0a20 2020 2020 2020 2065  nd(i)..        e
-0005c500: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-0005c510: 2020 7365 6c65 6374 6564 203d 206c 6973    selected = lis
-0005c520: 745f 736f 7572 6365 2e47 6574 4669 7273  t_source.GetFirs
-0005c530: 7453 656c 6563 7465 6428 290d 0a20 2020  tSelected()..   
-0005c540: 2020 2020 2020 2020 2077 6869 6c65 2073           while s
-0005c550: 656c 6563 7465 6420 3e3d 2030 3a0d 0a20  elected >= 0:.. 
-0005c560: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0005c570: 6174 6120 3d20 6c69 7374 5f73 6f75 7263  ata = list_sourc
-0005c580: 652e 4765 7449 7465 6d4d 6170 7065 6444  e.GetItemMappedD
-0005c590: 6174 6128 7365 6c65 6374 6564 290d 0a20  ata(selected).. 
-0005c5a0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0005c5b0: 6620 2243 6f6e 7461 6374 2220 3d3d 2064  f "Contact" == d
-0005c5c0: 6174 615b 225f 5f74 7970 6522 5d3a 0d0a  ata["__type"]:..
-0005c5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005c5e0: 2020 2020 636f 6e74 6163 7473 2e61 7070      contacts.app
-0005c5f0: 656e 6428 6461 7461 5b22 5f5f 6461 7461  end(data["__data
-0005c600: 225d 290d 0a20 2020 2020 2020 2020 2020  "])..           
-0005c610: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-0005c620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005c630: 636f 6e74 6163 7467 726f 7570 732e 6170  contactgroups.ap
-0005c640: 7065 6e64 2864 6174 615b 225f 5f64 6174  pend(data["__dat
-0005c650: 6122 5d29 0d0a 2020 2020 2020 2020 2020  a"])..          
-0005c660: 2020 2020 2020 696e 6469 6365 732e 6170        indices.ap
-0005c670: 7065 6e64 2873 656c 6563 7465 6429 0d0a  pend(selected)..
-0005c680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005c690: 7365 6c65 6374 6564 203d 206c 6973 745f  selected = list_
-0005c6a0: 736f 7572 6365 2e47 6574 4e65 7874 5365  source.GetNextSe
-0005c6b0: 6c65 6374 6564 2873 656c 6563 7465 6429  lected(selected)
-0005c6c0: 0d0a 2020 2020 2020 2020 2320 436f 6e74  ..        # Cont
-0005c6d0: 6163 7473 2061 6e64 2063 6f6e 7461 6374  acts and contact
-0005c6e0: 2067 726f 7570 7320 6172 6520 7368 6f77   groups are show
-0005c6f0: 6e20 696e 2074 6865 2073 616d 6520 6c69  n in the same li
-0005c700: 7374 2e20 4966 2061 2063 6f6e 7461 6374  st. If a contact
-0005c710: 0d0a 2020 2020 2020 2020 2320 6772 6f75  ..        # grou
-0005c720: 7020 6973 2063 686f 7365 6e2c 2069 7420  p is chosen, it 
-0005c730: 6361 6e20 696e 636c 7564 6520 636f 6e74  can include cont
-0005c740: 6163 7473 206e 6f74 2079 6574 2069 6e20  acts not yet in 
-0005c750: 7461 7267 6574 2064 6174 6162 6173 652e  target database.
-0005c760: 0d0a 2020 2020 2020 2020 636f 6e74 6163  ..        contac
-0005c770: 7473 5f74 6172 6765 745f 6669 6e61 6c20  ts_target_final 
-0005c780: 3d20 6469 6374 285b 2863 5b22 6964 656e  = dict([(c["iden
-0005c790: 7469 7479 225d 2c20 6329 2066 6f72 2063  tity"], c) for c
-0005c7a0: 2069 6e20 636f 6e74 6163 7473 5d29 0d0a   in contacts])..
-0005c7b0: 2020 2020 2020 2020 636f 6e74 6163 7473          contacts
-0005c7c0: 5f74 6172 6765 745f 6669 6e61 6c2e 7570  _target_final.up
-0005c7d0: 6461 7465 2864 6963 7428 2863 5b22 6964  date(dict((c["id
-0005c7e0: 656e 7469 7479 225d 2c20 6329 0d0a 2020  entity"], c)..  
-0005c7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005c800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005c810: 2020 2020 2020 2020 666f 7220 6320 696e          for c in
-0005c820: 2064 625f 7461 7267 6574 2e67 6574 5f63   db_target.get_c
-0005c830: 6f6e 7461 6374 7328 2929 290d 0a20 2020  ontacts()))..   
-0005c840: 2020 2020 2063 6f6e 7461 6374 735f 736f       contacts_so
-0005c850: 7572 6365 203d 2064 6963 7428 2863 5b27  urce = dict((c['
-0005c860: 6964 656e 7469 7479 275d 2c20 6329 0d0a  identity'], c)..
-0005c870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005c880: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0005c890: 6f72 2063 2069 6e20 6462 5f73 6f75 7263  or c in db_sourc
-0005c8a0: 652e 6765 745f 636f 6e74 6163 7473 2829  e.get_contacts()
-0005c8b0: 290d 0a20 2020 2020 2020 2066 6f72 2067  )..        for g
-0005c8c0: 726f 7570 2069 6e20 636f 6e74 6163 7467  roup in contactg
-0005c8d0: 726f 7570 733a 0d0a 2020 2020 2020 2020  roups:..        
-0005c8e0: 2020 2020 6d65 6d62 6572 7320 3d20 7365      members = se
-0005c8f0: 7428 6772 6f75 705b 226d 656d 6265 7273  t(group["members
-0005c900: 225d 2e73 706c 6974 2822 2022 2929 0d0a  "].split(" "))..
-0005c910: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0005c920: 6e65 7720 696e 206d 656d 6265 7273 2e64  new in members.d
-0005c930: 6966 6665 7265 6e63 6528 636f 6e74 6163  ifference(contac
-0005c940: 7473 5f74 6172 6765 745f 6669 6e61 6c29  ts_target_final)
-0005c950: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0005c960: 2020 2063 6f6e 7461 6374 732e 6170 7065     contacts.appe
-0005c970: 6e64 2863 6f6e 7461 6374 735f 736f 7572  nd(contacts_sour
-0005c980: 6365 5b6e 6577 5d29 0d0a 2020 2020 2020  ce[new])..      
-0005c990: 2020 7465 7874 5f61 6464 203d 2022 220d    text_add = "".
-0005c9a0: 0a20 2020 2020 2020 2069 6620 636f 6e74  .        if cont
-0005c9b0: 6163 7473 3a0d 0a20 2020 2020 2020 2020  acts:..         
-0005c9c0: 2020 2074 6578 745f 6164 6420 2b3d 2075     text_add += u
-0005c9d0: 7469 6c2e 706c 7572 616c 2822 636f 6e74  til.plural("cont
-0005c9e0: 6163 7422 2c20 636f 6e74 6163 7473 2c20  act", contacts, 
-0005c9f0: 7365 703d 222c 2229 0d0a 2020 2020 2020  sep=",")..      
-0005ca00: 2020 6966 2063 6f6e 7461 6374 6772 6f75    if contactgrou
-0005ca10: 7073 3a0d 0a20 2020 2020 2020 2020 2020  ps:..           
-0005ca20: 2074 6578 745f 6164 6420 2b3d 2028 2220   text_add += (" 
-0005ca30: 616e 6420 2220 6966 2063 6f6e 7461 6374  and " if contact
-0005ca40: 7320 656c 7365 2022 2229 205c 0d0a 2020  s else "") \..  
-0005ca50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005ca60: 2020 2020 202b 2075 7469 6c2e 706c 7572       + util.plur
-0005ca70: 616c 2822 636f 6e74 6163 7420 6772 6f75  al("contact grou
-0005ca80: 7022 2c20 636f 6e74 6163 7467 726f 7570  p", contactgroup
-0005ca90: 732c 2073 6570 3d22 2c22 290d 0a20 2020  s, sep=",")..   
-0005caa0: 2020 2020 2069 6620 2863 6f6e 7461 6374       if (contact
-0005cab0: 7320 6f72 2063 6f6e 7461 6374 6772 6f75  s or contactgrou
-0005cac0: 7073 2920 616e 6420 7778 2e4f 4b20 3d3d  ps) and wx.OK ==
-0005cad0: 2077 782e 4d65 7373 6167 6542 6f78 280d   wx.MessageBox(.
-0005cae0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0005caf0: 2022 436f 7079 2025 735c 6e5c 6e66 726f   "Copy %s\n\nfro
-0005cb00: 6d20 2573 5c6e 5c6e 696e 746f 2025 733f  m %s\n\ninto %s?
-0005cb10: 2220 250d 0a20 2020 2020 2020 2020 2020  " %..           
-0005cb20: 2020 2020 2028 7465 7874 5f61 6464 2c20       (text_add, 
-0005cb30: 7365 6c66 2e64 6231 2c20 7365 6c66 2e64  self.db1, self.d
-0005cb40: 6232 292c 0d0a 2020 2020 2020 2020 2020  b2),..          
-0005cb50: 2020 2020 2020 636f 6e66 2e54 6974 6c65        conf.Title
-0005cb60: 2c20 7778 2e4f 4b20 7c20 7778 2e43 414e  , wx.OK | wx.CAN
-0005cb70: 4345 4c20 7c20 7778 2e49 434f 4e5f 494e  CEL | wx.ICON_IN
-0005cb80: 464f 524d 4154 494f 4e29 3a0d 0a20 2020  FORMATION):..   
-0005cb90: 2020 2020 2020 2020 2073 656c 662e 6973           self.is
-0005cba0: 5f6d 6572 6769 6e67 203d 2054 7275 650d  _merging = True.
-0005cbb0: 0a20 2020 2020 2020 2020 2020 2074 7279  .            try
-0005cbc0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0005cbd0: 2020 2069 6620 636f 6e74 6163 7473 3a0d     if contacts:.
-0005cbe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0005cbf0: 2020 2020 2064 625f 7461 7267 6574 2e69       db_target.i
-0005cc00: 6e73 6572 745f 636f 6e74 6163 7473 2863  nsert_contacts(c
-0005cc10: 6f6e 7461 6374 732c 2064 625f 736f 7572  ontacts, db_sour
-0005cc20: 6365 290d 0a20 2020 2020 2020 2020 2020  ce)..           
-0005cc30: 2020 2020 2069 6620 636f 6e74 6163 7467       if contactg
-0005cc40: 726f 7570 733a 0d0a 2020 2020 2020 2020  roups:..        
-0005cc50: 2020 2020 2020 2020 2020 2020 6462 5f74              db_t
-0005cc60: 6172 6765 742e 7265 706c 6163 655f 636f  arget.replace_co
-0005cc70: 6e74 6163 7467 726f 7570 7328 636f 6e74  ntactgroups(cont
-0005cc80: 6163 7467 726f 7570 732c 2064 625f 736f  actgroups, db_so
-0005cc90: 7572 6365 290d 0a20 2020 2020 2020 2020  urce)..         
-0005cca0: 2020 2066 696e 616c 6c79 3a0d 0a20 2020     finally:..   
-0005ccb0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0005ccc0: 662e 6973 5f6d 6572 6769 6e67 203d 2046  f.is_merging = F
-0005ccd0: 616c 7365 0d0a 2020 2020 2020 2020 2020  alse..          
-0005cce0: 2020 666f 7220 6920 696e 2073 6f72 7465    for i in sorte
-0005ccf0: 6428 696e 6469 6365 7329 5b3a 3a2d 315d  d(indices)[::-1]
-0005cd00: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0005cd10: 2020 206c 6973 745f 736f 7572 6365 2e44     list_source.D
-0005cd20: 656c 6574 6549 7465 6d28 6929 0d0a 2020  eleteItem(i)..  
-0005cd30: 2020 2020 2020 2020 2020 636f 6e64 6966            condif
-0005cd40: 6620 3d20 5b73 656c 662e 636f 6e31 6469  f = [self.con1di
-0005cd50: 6666 2c20 7365 6c66 2e63 6f6e 3264 6966  ff, self.con2dif
-0005cd60: 665d 5b73 6f75 7263 655d 0d0a 2020 2020  f][source]..    
-0005cd70: 2020 2020 2020 2020 6367 6469 6666 203d          cgdiff =
-0005cd80: 205b 7365 6c66 2e63 6f6e 6772 6f75 7031   [self.congroup1
-0005cd90: 6469 6666 2c20 7365 6c66 2e63 6f6e 6772  diff, self.congr
-0005cda0: 6f75 7031 6469 6666 5d5b 736f 7572 6365  oup1diff][source
-0005cdb0: 5d0d 0a20 2020 2020 2020 2020 2020 2064  ]..            d
-0005cdc0: 6966 666c 6973 7420 3d20 5b73 656c 662e  ifflist = [self.
-0005cdd0: 636f 6e31 6469 6666 6c69 7374 2c20 7365  con1difflist, se
-0005cde0: 6c66 2e63 6f6e 3164 6966 666c 6973 745d  lf.con1difflist]
-0005cdf0: 5b73 6f75 7263 655d 0d0a 2020 2020 2020  [source]..      
-0005ce00: 2020 2020 2020 666f 7220 6320 696e 205b        for c in [
-0005ce10: 636f 6e74 6163 7473 2c20 636f 6e74 6163  contacts, contac
-0005ce20: 7467 726f 7570 735d 3a0d 0a20 2020 2020  tgroups]:..     
-0005ce30: 2020 2020 2020 2020 2020 205b 6c2e 7265             [l.re
-0005ce40: 6d6f 7665 2863 2920 666f 7220 6c20 696e  move(c) for l in
-0005ce50: 205b 636f 6e64 6966 662c 2063 6764 6966   [condiff, cgdif
-0005ce60: 662c 2064 6966 666c 6973 745d 2069 6620  f, difflist] if 
-0005ce70: 6320 696e 206c 5d0d 0a20 2020 2020 2020  c in l]..       
-0005ce80: 2020 2020 2064 625f 7461 7267 6574 2e63       db_target.c
-0005ce90: 6c65 6172 5f63 6163 6865 2829 0d0a 2020  lear_cache()..  
-0005cea0: 2020 2020 2020 2020 2020 7365 6c66 2e62            self.b
-0005ceb0: 7574 746f 6e5f 6d65 7267 655f 636f 6e74  utton_merge_cont
-0005cec0: 6163 7473 2e45 6e61 626c 6564 203d 2046  acts.Enabled = F
-0005ced0: 616c 7365 0d0a 2020 2020 2020 2020 2020  alse..          
-0005cee0: 2020 7365 6c66 2e62 7574 746f 6e5f 6d65    self.button_me
-0005cef0: 7267 655f 616c 6c63 6f6e 7461 6374 732e  rge_allcontacts.
-0005cf00: 456e 6162 6c65 6420 3d20 6c69 7374 5f73  Enabled = list_s
-0005cf10: 6f75 7263 652e 4974 656d 436f 756e 740d  ource.ItemCount.
-0005cf20: 0a20 2020 2020 2020 2020 2020 206c 6f67  .            log
-0005cf30: 6765 722e 696e 666f 2822 436f 7069 6564  ger.info("Copied
-0005cf40: 2025 7320 6672 6f6d 2025 7320 696e 746f   %s from %s into
-0005cf50: 2025 732e 222c 2074 6578 745f 6164 642c   %s.", text_add,
-0005cf60: 2073 656c 662e 6462 312c 2073 656c 662e   self.db1, self.
-0005cf70: 6462 3229 0d0a 2020 2020 2020 2020 2020  db2)..          
-0005cf80: 2020 7778 2e4d 6573 7361 6765 426f 7828    wx.MessageBox(
-0005cf90: 2243 6f70 6965 6420 2573 5c6e 5c6e 6672  "Copied %s\n\nfr
-0005cfa0: 6f6d 2025 735c 6e5c 6e69 6e74 6f20 2573  om %s\n\ninto %s
-0005cfb0: 2e22 2025 2028 7465 7874 5f61 6464 2c0d  ." % (text_add,.
-0005cfc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0005cfd0: 2073 656c 662e 6462 312c 2073 656c 662e   self.db1, self.
-0005cfe0: 6462 3229 2c20 636f 6e66 2e54 6974 6c65  db2), conf.Title
-0005cff0: 2c20 7778 2e4f 4b20 7c20 7778 2e49 434f  , wx.OK | wx.ICO
-0005d000: 4e5f 494e 464f 524d 4154 494f 4e29 0d0a  N_INFORMATION)..
-0005d010: 0d0a 0d0a 2020 2020 6465 6620 6f6e 5f73  ....    def on_s
-0005d020: 6361 6e5f 616c 6c28 7365 6c66 2c20 6576  can_all(self, ev
-0005d030: 656e 7429 3a0d 0a20 2020 2020 2020 2022  ent):..        "
-0005d040: 2222 0d0a 2020 2020 2020 2020 4861 6e64  ""..        Hand
-0005d050: 6c65 7220 666f 7220 636c 6963 6b69 6e67  ler for clicking
-0005d060: 2074 6f20 7363 616e 2066 6f72 2064 6966   to scan for dif
-0005d070: 6665 7265 6e63 6573 2077 6974 6820 7468  ferences with th
-0005d080: 6520 6c65 6674 2064 6174 6162 6173 652c  e left database,
-0005d090: 0d0a 2020 2020 2020 2020 7374 6172 7473  ..        starts
-0005d0a0: 2073 6361 6e6e 696e 6720 7072 6f63 6573   scanning proces
-0005d0b0: 732e 0d0a 2020 2020 2020 2020 2222 220d  s...        """.
-0005d0c0: 0a20 2020 2020 2020 2067 7569 6261 7365  .        guibase
-0005d0d0: 2e73 7461 7475 7328 2253 6361 6e6e 696e  .status("Scannin
-0005d0e0: 6720 6469 6666 6572 656e 6365 7320 6265  g differences be
-0005d0f0: 7477 6565 6e20 2573 2061 6e64 2025 732e  tween %s and %s.
-0005d100: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
-0005d110: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0005d120: 6462 312c 2073 656c 662e 6462 322c 206c  db1, self.db2, l
-0005d130: 6f67 3d54 7275 6529 0d0a 2020 2020 2020  og=True)..      
-0005d140: 2020 7365 6c66 2e63 6861 7473 5f64 6966    self.chats_dif
-0005d150: 6664 6174 612e 636c 6561 7228 290d 0a20  fdata.clear().. 
-0005d160: 2020 2020 2020 2073 656c 662e 6275 7474         self.butt
-0005d170: 6f6e 5f6d 6572 6765 5f61 6c6c 2e45 6e61  on_merge_all.Ena
-0005d180: 626c 6564 203d 2046 616c 7365 0d0a 2020  bled = False..  
-0005d190: 2020 2020 2020 7365 6c66 2e62 7574 746f        self.butto
-0005d1a0: 6e5f 7363 616e 5f61 6c6c 2e45 6e61 626c  n_scan_all.Enabl
-0005d1b0: 6564 203d 2046 616c 7365 0d0a 2020 2020  ed = False..    
-0005d1c0: 2020 2020 7365 6c66 2e62 7574 746f 6e5f      self.button_
-0005d1d0: 7377 6170 2e45 6e61 626c 6564 203d 2046  swap.Enabled = F
-0005d1e0: 616c 7365 0d0a 2020 2020 2020 2020 7365  alse..        se
-0005d1f0: 6c66 2e62 7574 746f 6e5f 6d65 7267 655f  lf.button_merge_
-0005d200: 6368 6174 732e 456e 6162 6c65 6420 3d20  chats.Enabled = 
-0005d210: 4661 6c73 650d 0a20 2020 2020 2020 2069  False..        i
-0005d220: 6620 6e6f 7420 7365 6c66 2e68 746d 6c5f  f not self.html_
-0005d230: 7265 706f 7274 2e53 686f 776e 3a0d 0a20  report.Shown:.. 
-0005d240: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0005d250: 6874 6d6c 5f72 6570 6f72 742e 5368 6f77  html_report.Show
-0005d260: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
-0005d270: 7365 6c66 2e68 746d 6c5f 7265 706f 7274  self.html_report
-0005d280: 2e43 6f6e 7461 696e 696e 6753 697a 6572  .ContainingSizer
-0005d290: 2e4c 6179 6f75 7428 290d 0a20 2020 2020  .Layout()..     
-0005d2a0: 2020 2068 746d 6c20 3d20 2822 3c62 6f64     html = ("<bod
-0005d2b0: 7920 6267 636f 6c6f 723d 2725 7327 3e3c  y bgcolor='%s'><
-0005d2c0: 666f 6e74 2063 6f6c 6f72 3d27 2573 273e  font color='%s'>
-0005d2d0: 3c62 3e53 6361 6e20 7265 7375 6c74 733a  <b>Scan results:
-0005d2e0: 3c2f 623e 220d 0a20 2020 2020 2020 2020  </b>"..         
-0005d2f0: 2020 2020 2020 2022 3c62 7220 2f3e 3c62         "<br /><b
-0005d300: 7220 2f3e 2220 250d 0a20 2020 2020 2020  r />" %..       
-0005d310: 2020 2020 2020 2020 2028 636f 6e66 2e4d           (conf.M
-0005d320: 6572 6765 4874 6d6c 4261 636b 6772 6f75  ergeHtmlBackgrou
-0005d330: 6e64 436f 6c6f 7572 2c20 636f 6e66 2e46  ndColour, conf.F
-0005d340: 6743 6f6c 6f75 7229 290d 0a20 2020 2020  gColour))..     
-0005d350: 2020 2073 656c 662e 6874 6d6c 5f72 6570     self.html_rep
-0005d360: 6f72 742e 5365 7450 6167 6528 6874 6d6c  ort.SetPage(html
-0005d370: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-0005d380: 7570 6461 7465 5f67 6175 6765 2873 656c  update_gauge(sel
-0005d390: 662e 6761 7567 655f 7072 6f67 7265 7373  f.gauge_progress
-0005d3a0: 2c20 302c 2022 5363 616e 6e69 6e67 206d  , 0, "Scanning m
-0005d3b0: 6573 7361 6765 732e 2229 0d0a 2020 2020  essages.")..    
-0005d3c0: 2020 2020 7061 7261 6d73 203d 207b 2264      params = {"d
-0005d3d0: 6231 223a 2073 656c 662e 6462 312c 2022  b1": self.db1, "
-0005d3e0: 6462 3222 3a20 7365 6c66 2e64 6232 2c20  db2": self.db2, 
-0005d3f0: 2274 7970 6522 3a20 2264 6966 665f 6c65  "type": "diff_le
-0005d400: 6674 227d 0d0a 2020 2020 2020 2020 7365  ft"}..        se
-0005d410: 6c66 2e77 6f72 6b65 725f 6d65 7267 652e  lf.worker_merge.
-0005d420: 776f 726b 2870 6172 616d 7329 0d0a 2020  work(params)..  
-0005d430: 2020 2020 2020 7365 6c66 2e69 735f 7363        self.is_sc
-0005d440: 616e 6e69 6e67 203d 2054 7275 650d 0a0d  anning = True...
-0005d450: 0a0d 0a20 2020 2064 6566 206f 6e5f 7363  ...    def on_sc
-0005d460: 616e 5f61 6c6c 5f72 6573 756c 7428 7365  an_all_result(se
-0005d470: 6c66 2c20 6576 656e 7429 3a0d 0a20 2020  lf, event):..   
-0005d480: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-0005d490: 2020 4861 6e64 6c65 7220 666f 7220 6765    Handler for ge
-0005d4a0: 7474 696e 6720 6469 6666 2072 6573 756c  tting diff resul
-0005d4b0: 7473 2066 726f 6d20 776f 726b 6572 2074  ts from worker t
-0005d4c0: 6872 6561 642c 2061 6464 7320 7468 6520  hread, adds the 
-0005d4d0: 7265 7375 6c74 730d 0a20 2020 2020 2020  results..       
-0005d4e0: 2074 6f20 7468 6520 6469 6666 2077 696e   to the diff win
-0005d4f0: 646f 7773 2e0d 0a20 2020 2020 2020 2022  dows...        "
-0005d500: 2222 0d0a 2020 2020 2020 2020 7265 7375  ""..        resu
-0005d510: 6c74 203d 2065 7665 6e74 2e72 6573 756c  lt = event.resul
-0005d520: 740d 0a20 2020 2020 2020 2066 6f72 2064  t..        for d
-0005d530: 2069 6e20 7265 7375 6c74 2e67 6574 2822   in result.get("
-0005d540: 6368 6174 7322 2c20 5b5d 293a 0d0a 2020  chats", []):..  
-0005d550: 2020 2020 2020 2020 2020 7365 6c66 2e63            self.c
-0005d560: 6861 7473 5f64 6966 6664 6174 615b 645b  hats_diffdata[d[
-0005d570: 2263 6861 7422 5d5b 2269 6465 6e74 6974  "chat"]["identit
-0005d580: 7922 5d5d 203d 2064 0d0a 2020 2020 2020  y"]] = d..      
-0005d590: 2020 6966 2072 6573 756c 742e 6765 7428    if result.get(
-0005d5a0: 226f 7574 7075 7422 2920 616e 6420 2264  "output") and "d
-0005d5b0: 6f6e 6522 206e 6f74 2069 6e20 7265 7375  one" not in resu
-0005d5c0: 6c74 3a0d 0a20 2020 2020 2020 2020 2020  lt:..           
-0005d5d0: 2073 656c 662e 6874 6d6c 5f72 6570 6f72   self.html_repor
-0005d5e0: 742e 4170 7065 6e64 546f 5061 6765 2872  t.AppendToPage(r
-0005d5f0: 6573 756c 745b 226f 7574 7075 7422 5d29  esult["output"])
-0005d600: 0d0a 2020 2020 2020 2020 6966 2022 7374  ..        if "st
-0005d610: 6174 7573 2220 696e 2072 6573 756c 743a  atus" in result:
-0005d620: 0d0a 2020 2020 2020 2020 2020 2020 6775  ..            gu
-0005d630: 6962 6173 652e 7374 6174 7573 2872 6573  ibase.status(res
-0005d640: 756c 745b 2273 7461 7475 7322 5d29 0d0a  ult["status"])..
-0005d650: 2020 2020 2020 2020 6966 2022 696e 6465          if "inde
-0005d660: 7822 2069 6e20 7265 7375 6c74 3a0d 0a20  x" in result:.. 
-0005d670: 2020 2020 2020 2020 2020 206d 696e 6465             minde
-0005d680: 782c 206d 636f 756e 7420 3d20 7265 7375  x, mcount = resu
-0005d690: 6c74 5b22 696e 6465 7822 5d2c 2072 6573  lt["index"], res
-0005d6a0: 756c 745b 2263 6f75 6e74 225d 0d0a 2020  ult["count"]..  
-0005d6b0: 2020 2020 2020 2020 2020 6369 6e64 6578            cindex
-0005d6c0: 2c20 6363 6f75 6e74 203d 2072 6573 756c  , ccount = resul
-0005d6d0: 745b 2263 6861 7469 6e64 6578 225d 2c20  t["chatindex"], 
-0005d6e0: 7265 7375 6c74 5b22 6368 6174 636f 756e  result["chatcoun
-0005d6f0: 7422 5d0d 0a20 2020 2020 2020 2020 2020  t"]..           
-0005d700: 2070 6572 6365 6e74 203d 206d 696e 2831   percent = min(1
-0005d710: 3030 2c20 6d61 7468 2e63 6569 6c28 3130  00, math.ceil(10
-0005d720: 3020 2a20 7574 696c 2e73 6166 6564 6976  0 * util.safediv
-0005d730: 6628 6d69 6e64 6578 2c20 6d63 6f75 6e74  f(mindex, mcount
-0005d740: 2929 290d 0a20 2020 2020 2020 2020 2020  )))..           
-0005d750: 2069 6620 7065 7263 656e 7420 3d3d 2031   if percent == 1
-0005d760: 3030 2061 6e64 206d 696e 6465 7820 3c20  00 and mindex < 
-0005d770: 6d63 6f75 6e74 3a20 7065 7263 656e 7420  mcount: percent 
-0005d780: 3d20 3939 0d0a 2020 2020 2020 2020 2020  = 99..          
-0005d790: 2020 6d73 6720 3d20 2253 6361 6e20 2564    msg = "Scan %d
-0005d7a0: 2525 2063 6f6d 706c 6574 6520 2825 7320  %% complete (%s 
-0005d7b0: 6f66 2025 7329 2e22 2025 205c 0d0a 2020  of %s)." % \..  
-0005d7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005d7d0: 2870 6572 6365 6e74 2c20 6369 6e64 6578  (percent, cindex
-0005d7e0: 202b 2031 2c20 7574 696c 2e70 6c75 7261   + 1, util.plura
-0005d7f0: 6c28 2263 6f6e 7665 7273 6174 696f 6e22  l("conversation"
-0005d800: 2c20 6363 6f75 6e74 2c20 7365 703d 222c  , ccount, sep=",
-0005d810: 2229 290d 0a20 2020 2020 2020 2020 2020  "))..           
-0005d820: 2073 656c 662e 7570 6461 7465 5f67 6175   self.update_gau
-0005d830: 6765 2873 656c 662e 6761 7567 655f 7072  ge(self.gauge_pr
-0005d840: 6f67 7265 7373 2c20 7065 7263 656e 742c  ogress, percent,
-0005d850: 206d 7367 290d 0a20 2020 2020 2020 2069   msg)..        i
-0005d860: 6620 2264 6f6e 6522 2069 6e20 7265 7375  f "done" in resu
-0005d870: 6c74 3a0d 0a20 2020 2020 2020 2020 2020  lt:..           
-0005d880: 2073 656c 662e 6973 5f73 6361 6e6e 696e   self.is_scannin
-0005d890: 6720 3d20 4661 6c73 650d 0a20 2020 2020  g = False..     
-0005d8a0: 2020 2020 2020 2073 656c 662e 6973 5f73         self.is_s
-0005d8b0: 6361 6e6e 6564 203d 2054 7275 650d 0a20  canned = True.. 
-0005d8c0: 2020 2020 2020 2020 2020 2073 3120 3d20             s1 = 
-0005d8d0: 7574 696c 2e70 6c75 7261 6c28 2264 6966  util.plural("dif
-0005d8e0: 6665 7269 6e67 2063 6861 7422 2c20 7365  fering chat", se
-0005d8f0: 6c66 2e63 6861 7473 5f64 6966 6664 6174  lf.chats_diffdat
-0005d900: 6129 0d0a 2020 2020 2020 2020 2020 2020  a)..            
-0005d910: 6775 6962 6173 652e 7374 6174 7573 2822  guibase.status("
-0005d920: 466f 756e 6420 2573 2069 6e20 2573 2e22  Found %s in %s."
-0005d930: 2c20 7331 2c20 7365 6c66 2e64 6231 2c20  , s1, self.db1, 
-0005d940: 6c6f 673d 5472 7565 290d 0a20 2020 2020  log=True)..     
-0005d950: 2020 2020 2020 2073 656c 662e 6275 7474         self.butt
-0005d960: 6f6e 5f73 7761 702e 456e 6162 6c65 6420  on_swap.Enabled 
-0005d970: 3d20 5472 7565 0d0a 2020 2020 2020 2020  = True..        
-0005d980: 2020 2020 7365 6c66 2e62 7574 746f 6e5f      self.button_
-0005d990: 6d65 7267 655f 6368 6174 732e 456e 6162  merge_chats.Enab
-0005d9a0: 6c65 6420 3d20 5472 7565 0d0a 2020 2020  led = True..    
-0005d9b0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-0005d9c0: 6368 6174 735f 6469 6666 6461 7461 3a0d  chats_diffdata:.
-0005d9d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0005d9e0: 2063 6f75 6e74 5f6d 7367 7320 3d20 7574   count_msgs = ut
-0005d9f0: 696c 2e70 6c75 7261 6c28 0d0a 2020 2020  il.plural(..    
-0005da00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005da10: 226d 6573 7361 6765 222c 2073 756d 286c  "message", sum(l
-0005da20: 656e 2864 5b22 6469 6666 225d 5b22 6d65  en(d["diff"]["me
-0005da30: 7373 6167 6573 225d 290d 0a20 2020 2020  ssages"])..     
-0005da40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005da50: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-0005da60: 7220 6420 696e 2073 656c 662e 6368 6174  r d in self.chat
-0005da70: 735f 6469 6666 6461 7461 2e76 616c 7565  s_diffdata.value
-0005da80: 7328 2929 2c20 7365 703d 222c 2229 0d0a  s()), sep=",")..
-0005da90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005daa0: 636f 756e 745f 6368 6174 7320 3d20 7574  count_chats = ut
-0005dab0: 696c 2e70 6c75 7261 6c28 2263 6861 7422  il.plural("chat"
-0005dac0: 2c20 7365 6c66 2e63 6861 7473 5f64 6966  , self.chats_dif
-0005dad0: 6664 6174 612c 2073 6570 3d22 2c22 290d  fdata, sep=",").
-0005dae0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0005daf0: 206e 6f74 6569 6e66 6f20 3d20 2225 7320   noteinfo = "%s 
-0005db00: 6672 6f6d 2025 7322 2025 2028 636f 756e  from %s" % (coun
-0005db10: 745f 6d73 6773 2c20 636f 756e 745f 6368  t_msgs, count_ch
-0005db20: 6174 7329 0d0a 2020 2020 2020 2020 2020  ats)..          
-0005db30: 2020 2020 2020 7365 6c66 2e62 7574 746f        self.butto
-0005db40: 6e5f 6d65 7267 655f 616c 6c2e 4e6f 7465  n_merge_all.Note
-0005db50: 203d 2028 0d0a 2020 2020 2020 2020 2020   = (..          
-0005db60: 2020 2020 2020 2020 2020 2243 6f70 7920            "Copy 
-0005db70: 2573 2074 6f20 7468 6520 6461 7461 6261  %s to the databa
-0005db80: 7365 206f 6e20 7468 6520 7269 6768 742e  se on the right.
-0005db90: 2220 2520 6e6f 7465 696e 666f 290d 0a20  " % noteinfo).. 
-0005dba0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0005dbb0: 656c 662e 6275 7474 6f6e 5f6d 6572 6765  elf.button_merge
-0005dbc0: 5f61 6c6c 2e45 6e61 626c 6564 203d 2054  _all.Enabled = T
-0005dbd0: 7275 650d 0a20 2020 2020 2020 2020 2020  rue..           
-0005dbe0: 2020 2020 2073 656c 662e 6874 6d6c 5f72       self.html_r
-0005dbf0: 6570 6f72 742e 4672 6565 7a65 2829 0d0a  eport.Freeze()..
-0005dc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005dc10: 7365 6c66 2e68 746d 6c5f 7265 706f 7274  self.html_report
-0005dc20: 2e41 7070 656e 6454 6f50 6167 6528 0d0a  .AppendToPage(..
+0005ab00: 2022 2573 2030 2525 2063 6f6d 706c 6574   "%s 0%% complet
+0005ab10: 652e 2220 2520 6163 7469 6f6e 290d 0a20  e." % action).. 
+0005ab20: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0005ab30: 6620 6e6f 7420 7365 6c66 2e68 746d 6c5f  f not self.html_
+0005ab40: 7265 706f 7274 2e53 686f 776e 3a0d 0a20  report.Shown:.. 
+0005ab50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005ab60: 2020 2073 656c 662e 6874 6d6c 5f72 6570     self.html_rep
+0005ab70: 6f72 742e 5368 6f77 2829 0d0a 2020 2020  ort.Show()..    
+0005ab80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005ab90: 7365 6c66 2e68 746d 6c5f 7265 706f 7274  self.html_report
+0005aba0: 2e43 6f6e 7461 696e 696e 6753 697a 6572  .ContainingSizer
+0005abb0: 2e4c 6179 6f75 7428 290d 0a20 2020 2020  .Layout()..     
+0005abc0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0005abd0: 6874 6d6c 5f72 6570 6f72 742e 5365 7450  html_report.SetP
+0005abe0: 6167 6528 223c 626f 6479 2062 6763 6f6c  age("<body bgcol
+0005abf0: 6f72 3d27 2573 273e 3c66 6f6e 7420 636f  or='%s'><font co
+0005ac00: 6c6f 723d 2725 7327 3e3c 623e 2573 2070  lor='%s'><b>%s p
+0005ac10: 726f 6772 6573 733a 220d 0a20 2020 2020  rogress:"..     
+0005ac20: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0005ac30: 3c2f 623e 3c62 7220 2f3e 2220 2520 2863  </b><br />" % (c
+0005ac40: 6f6e 662e 4d65 7267 6548 746d 6c42 6163  onf.MergeHtmlBac
+0005ac50: 6b67 726f 756e 6443 6f6c 6f75 722c 2063  kgroundColour, c
+0005ac60: 6f6e 662e 4667 436f 6c6f 7572 2c20 6163  onf.FgColour, ac
+0005ac70: 7469 6f6e 2929 0d0a 2020 2020 2020 2020  tion))..        
+0005ac80: 2020 2020 2020 2020 6462 312c 2064 6232          db1, db2
+0005ac90: 203d 2073 656c 662e 6462 312c 2073 656c   = self.db1, sel
+0005aca0: 662e 6462 320d 0a20 2020 2020 2020 2020  f.db2..         
+0005acb0: 2020 2020 2020 2063 6861 7473 203d 206c         chats = l
+0005acc0: 6973 7428 6669 6c74 6572 2862 6f6f 6c2c  ist(filter(bool,
+0005acd0: 2073 656c 6563 7465 6473 2929 0d0a 2020   selecteds))..  
+0005ace0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0005acf0: 2073 656c 662e 6973 5f73 6361 6e6e 6564   self.is_scanned
+0005ad00: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0005ad10: 2020 2020 2020 2074 7970 6520 3d20 226d         type = "m
+0005ad20: 6572 6765 5f6c 6566 7422 0d0a 2020 2020  erge_left"..    
+0005ad30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005ad40: 6363 203d 205b 7365 6c66 2e63 6861 7473  cc = [self.chats
+0005ad50: 5f64 6966 6664 6174 612e 6765 7428 635b  _diffdata.get(c[
+0005ad60: 2269 6465 6e74 6974 7922 5d29 2066 6f72  "identity"]) for
+0005ad70: 2063 2069 6e20 6368 6174 735d 0d0a 2020   c in chats]..  
+0005ad80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005ad90: 2020 6368 6174 7320 3d20 6c69 7374 2866    chats = list(f
+0005ada0: 696c 7465 7228 626f 6f6c 2c20 6363 2929  ilter(bool, cc))
+0005adb0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0005adc0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+0005add0: 2020 2020 2020 2020 2020 2020 2074 7970               typ
+0005ade0: 6520 3d20 2264 6966 665f 6d65 7267 655f  e = "diff_merge_
+0005adf0: 6c65 6674 220d 0a20 2020 2020 2020 2020  left"..         
+0005ae00: 2020 2020 2020 2070 6172 616d 7320 3d20         params = 
+0005ae10: 6c6f 6361 6c73 2829 0d0a 2020 2020 2020  locals()..      
+0005ae20: 2020 2020 2020 2020 2020 7365 6c66 2e77            self.w
+0005ae30: 6f72 6b65 725f 6d65 7267 652e 776f 726b  orker_merge.work
+0005ae40: 2870 6172 616d 7329 0d0a 2020 2020 2020  (params)..      
+0005ae50: 2020 2020 2020 2020 2020 7365 6c66 2e69            self.i
+0005ae60: 735f 6d65 7267 696e 6720 3d20 5472 7565  s_merging = True
+0005ae70: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0005ae80: 2020 6775 6962 6173 652e 7374 6174 7573    guibase.status
+0005ae90: 2822 4d65 7267 696e 6720 2573 2066 726f  ("Merging %s fro
+0005aea0: 6d20 2573 2074 6f20 2573 2e22 2c20 696e  m %s to %s.", in
+0005aeb0: 666f 2c20 6462 312c 2064 6232 2c20 6c6f  fo, db1, db2, lo
+0005aec0: 673d 5472 7565 290d 0a20 2020 2020 2020  g=True)..       
+0005aed0: 2020 2020 2020 2020 2073 656c 662e 6e6f           self.no
+0005aee0: 7465 626f 6f6b 2e53 6574 5365 6c65 6374  tebook.SetSelect
+0005aef0: 696f 6e28 3029 0d0a 0d0a 0d0a 2020 2020  ion(0)......    
+0005af00: 6465 6620 6f6e 5f6c 696e 6b5f 6462 2873  def on_link_db(s
+0005af10: 656c 662c 2065 7665 6e74 293a 0d0a 2020  elf, event):..  
+0005af20: 2020 2020 2020 2222 2248 616e 646c 6572        """Handler
+0005af30: 206f 6e20 636c 6963 6b69 6e67 2061 2064   on clicking a d
+0005af40: 6174 6162 6173 6520 6c69 6e6b 2c20 6f70  atabase link, op
+0005af50: 656e 7320 7468 6520 6461 7461 6261 7365  ens the database
+0005af60: 2074 6162 2e22 2222 0d0a 2020 2020 2020   tab."""..      
+0005af70: 2020 7365 6c66 2e54 6f70 4c65 7665 6c50    self.TopLevelP
+0005af80: 6172 656e 742e 6c6f 6164 5f64 6174 6162  arent.load_datab
+0005af90: 6173 655f 7061 6765 2865 7665 6e74 2e47  ase_page(event.G
+0005afa0: 6574 4c69 6e6b 496e 666f 2829 2e48 7265  etLinkInfo().Hre
+0005afb0: 6629 0d0a 0d0a 0d0a 2020 2020 6465 6620  f)......    def 
+0005afc0: 6f6e 5f73 656c 6563 745f 6c69 7374 5f63  on_select_list_c
+0005afd0: 6f6e 7461 6374 7328 7365 6c66 2c20 6576  ontacts(self, ev
+0005afe0: 656e 7429 3a0d 0a20 2020 2020 2020 2022  ent):..        "
+0005aff0: 2222 0d0a 2020 2020 2020 2020 4861 6e64  ""..        Hand
+0005b000: 6c65 7220 666f 7220 6368 616e 6769 6e67  ler for changing
+0005b010: 2073 656c 6563 7469 6f6e 2069 6e20 636f   selection in co
+0005b020: 6e74 6163 7473 206c 6973 742c 2075 7064  ntacts list, upd
+0005b030: 6174 6573 2062 7574 746f 6e20 7374 6174  ates button stat
+0005b040: 6573 2e0d 0a20 2020 2020 2020 2022 2222  es...        """
+0005b050: 0d0a 2020 2020 2020 2020 7365 6c66 2e62  ..        self.b
+0005b060: 7574 746f 6e5f 6d65 7267 655f 636f 6e74  utton_merge_cont
+0005b070: 6163 7473 2e45 6e61 626c 6564 203d 2062  acts.Enabled = b
+0005b080: 6f6f 6c28 7365 6c66 2e6c 6973 745f 636f  ool(self.list_co
+0005b090: 6e74 6163 7473 2e53 656c 6563 7465 6449  ntacts.SelectedI
+0005b0a0: 7465 6d43 6f75 6e74 290d 0a20 2020 2020  temCount)..     
+0005b0b0: 2020 2073 656c 662e 6275 7474 6f6e 5f6d     self.button_m
+0005b0c0: 6572 6765 5f63 6f6e 7461 6374 732e 5265  erge_contacts.Re
+0005b0d0: 6672 6573 6828 290d 0a0d 0a0d 0a20 2020  fresh()......   
+0005b0e0: 2064 6566 206f 6e5f 636c 6963 6b5f 6c69   def on_click_li
+0005b0f0: 6e6b 2873 656c 662c 2065 7665 6e74 293a  nk(self, event):
+0005b100: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
+0005b110: 2020 2020 2020 2048 616e 646c 6572 2066         Handler f
+0005b120: 6f72 2063 6c69 636b 696e 6720 6120 6c69  or clicking a li
+0005b130: 6e6b 2069 6e20 6368 6174 2068 6973 746f  nk in chat histo
+0005b140: 7279 2c20 6f70 656e 7320 7468 6520 6c69  ry, opens the li
+0005b150: 6e6b 2069 6e20 7379 7374 656d 0d0a 2020  nk in system..  
+0005b160: 2020 2020 2020 6272 6f77 7365 722e 0d0a        browser...
+0005b170: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
+0005b180: 2020 2020 2073 7463 203d 2065 7665 6e74       stc = event
+0005b190: 2e45 7665 6e74 4f62 6a65 6374 0d0a 2020  .EventObject..  
+0005b1a0: 2020 2020 2020 6966 2073 7463 2e47 6574        if stc.Get
+0005b1b0: 5374 796c 6541 7428 6576 656e 742e 506f  StyleAt(event.Po
+0005b1c0: 7369 7469 6f6e 2920 3d3d 2073 656c 662e  sition) == self.
+0005b1d0: 7374 635f 7374 796c 6573 5b22 6c69 6e6b  stc_styles["link
+0005b1e0: 225d 3a0d 0a20 2020 2020 2020 2020 2020  "]:..           
+0005b1f0: 2023 2047 6f20 6261 636b 2061 6e64 2066   # Go back and f
+0005b200: 6f72 7468 2066 726f 6d20 706f 7369 7469  orth from positi
+0005b210: 6f6e 2061 6e64 2067 6574 2055 524c 2072  on and get URL r
+0005b220: 616e 6765 2e0d 0a20 2020 2020 2020 2020  ange...         
+0005b230: 2020 2075 726c 5f72 616e 6765 203d 207b     url_range = {
+0005b240: 2d31 3a20 2d31 2c20 313a 202d 317d 2023  -1: -1, 1: -1} #
+0005b250: 207b 2073 7461 7274 2061 6e64 2065 6e64   { start and end
+0005b260: 2070 6f73 6974 696f 6e73 207d 0d0a 2020   positions }..  
+0005b270: 2020 2020 2020 2020 2020 666f 7220 7374            for st
+0005b280: 6570 2069 6e20 7572 6c5f 7261 6e67 653a  ep in url_range:
+0005b290: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0005b2a0: 2020 706f 7320 3d20 6576 656e 742e 506f    pos = event.Po
+0005b2b0: 7369 7469 6f6e 0d0a 2020 2020 2020 2020  sition..        
+0005b2c0: 2020 2020 2020 2020 7768 696c 6520 7374          while st
+0005b2d0: 632e 4765 7453 7479 6c65 4174 2870 6f73  c.GetStyleAt(pos
+0005b2e0: 202b 2073 7465 7029 203d 3d20 7365 6c66   + step) == self
+0005b2f0: 2e73 7463 5f73 7479 6c65 735b 226c 696e  .stc_styles["lin
+0005b300: 6b22 5d3a 0d0a 2020 2020 2020 2020 2020  k"]:..          
+0005b310: 2020 2020 2020 2020 2020 706f 7320 2b3d            pos +=
+0005b320: 2073 7465 700d 0a20 2020 2020 2020 2020   step..         
+0005b330: 2020 2020 2020 2075 726c 5f72 616e 6765         url_range
+0005b340: 5b73 7465 705d 203d 2070 6f73 0d0a 2020  [step] = pos..  
+0005b350: 2020 2020 2020 2020 2020 7572 6c20 3d20            url = 
+0005b360: 7374 632e 4765 7454 6578 7452 616e 6765  stc.GetTextRange
+0005b370: 2875 726c 5f72 616e 6765 5b2d 315d 2c20  (url_range[-1], 
+0005b380: 7572 6c5f 7261 6e67 655b 315d 202b 2031  url_range[1] + 1
+0005b390: 290d 0a20 2020 2020 2020 2020 2020 2077  )..            w
+0005b3a0: 6562 6272 6f77 7365 722e 6f70 656e 2875  ebbrowser.open(u
+0005b3b0: 726c 290d 0a0d 0a0d 0a20 2020 2064 6566  rl)......    def
+0005b3c0: 206f 6e5f 6368 616e 6765 5f63 6861 7466   on_change_chatf
+0005b3d0: 696c 7465 7228 7365 6c66 2c20 6576 656e  ilter(self, even
+0005b3e0: 7429 3a0d 0a20 2020 2020 2020 2022 2222  t):..        """
+0005b3f0: 4861 6e64 6c65 7220 666f 7220 6368 616e  Handler for chan
+0005b400: 6769 6e67 2074 6578 7420 696e 2063 6861  ging text in cha
+0005b410: 7420 6669 6c74 6572 2062 6f78 2c20 6669  t filter box, fi
+0005b420: 6c74 6572 7320 6368 6174 206c 6973 742e  lters chat list.
+0005b430: 2222 220d 0a20 2020 2020 2020 2073 656c  """..        sel
+0005b440: 662e 6c69 7374 5f63 6861 7473 2e53 6574  f.list_chats.Set
+0005b450: 4669 6c74 6572 2865 7665 6e74 2e53 7472  Filter(event.Str
+0005b460: 696e 672e 7374 7269 7028 2929 0d0a 0d0a  ing.strip())....
+0005b470: 0d0a 2020 2020 6465 6620 6f6e 5f63 6861  ..    def on_cha
+0005b480: 6e67 655f 636f 6e74 6163 7466 696c 7465  nge_contactfilte
+0005b490: 7228 7365 6c66 2c20 6576 656e 7429 3a0d  r(self, event):.
+0005b4a0: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
+0005b4b0: 2020 2020 2020 4861 6e64 6c65 7220 666f        Handler fo
+0005b4c0: 7220 6368 616e 6769 6e67 2074 6578 7420  r changing text 
+0005b4d0: 696e 2063 6861 7420 6669 6c74 6572 2062  in chat filter b
+0005b4e0: 6f78 2c20 6669 6c74 6572 7320 636f 6e74  ox, filters cont
+0005b4f0: 6163 7420 6c69 7374 732e 0d0a 2020 2020  act lists...    
+0005b500: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
+0005b510: 2073 656c 662e 6c69 7374 5f63 6f6e 7461   self.list_conta
+0005b520: 6374 732e 5365 7446 696c 7465 7228 6576  cts.SetFilter(ev
+0005b530: 656e 742e 5374 7269 6e67 2e73 7472 6970  ent.String.strip
+0005b540: 2829 290d 0a20 2020 2020 2020 2073 656c  ())..        sel
+0005b550: 662e 6275 7474 6f6e 5f6d 6572 6765 5f63  f.button_merge_c
+0005b560: 6f6e 7461 6374 732e 456e 6162 6c65 6420  ontacts.Enabled 
+0005b570: 3d20 7365 6c66 2e6c 6973 745f 636f 6e74  = self.list_cont
+0005b580: 6163 7473 2e53 656c 6563 7465 6449 7465  acts.SelectedIte
+0005b590: 6d43 6f75 6e74 0d0a 2020 2020 2020 2020  mCount..        
+0005b5a0: 7365 6c66 2e62 7574 746f 6e5f 6d65 7267  self.button_merg
+0005b5b0: 655f 616c 6c63 6f6e 7461 6374 732e 456e  e_allcontacts.En
+0005b5c0: 6162 6c65 6420 3d20 7365 6c66 2e6c 6973  abled = self.lis
+0005b5d0: 745f 636f 6e74 6163 7473 2e49 7465 6d43  t_contacts.ItemC
+0005b5e0: 6f75 6e74 0d0a 0d0a 0d0a 2020 2020 6465  ount......    de
+0005b5f0: 6620 6f6e 5f63 6861 6e67 655f 6c69 7374  f on_change_list
+0005b600: 5f63 6861 7473 2873 656c 662c 2065 7665  _chats(self, eve
+0005b610: 6e74 3d4e 6f6e 652c 2063 6861 743d 4e6f  nt=None, chat=No
+0005b620: 6e65 293a 0d0a 2020 2020 2020 2020 2222  ne):..        ""
+0005b630: 220d 0a20 2020 2020 2020 2048 616e 646c  "..        Handl
+0005b640: 6572 2066 6f72 2061 6374 6976 6174 696e  er for activatin
+0005b650: 6720 616e 2069 7465 6d20 696e 2074 6865  g an item in the
+0005b660: 2064 6966 6665 7269 6e67 2063 6861 7473   differing chats
+0005b670: 206c 6973 742c 0d0a 2020 2020 2020 2020   list,..        
+0005b680: 676f 6573 2074 6872 6f75 6768 2061 6c6c  goes through all
+0005b690: 206d 6573 7361 6765 7320 6f66 2074 6865   messages of the
+0005b6a0: 2063 6861 7420 696e 2062 6f74 6820 6461   chat in both da
+0005b6b0: 7461 6261 7365 7320 616e 6420 7368 6f77  tabases and show
+0005b6c0: 730d 0a20 2020 2020 2020 2074 686f 7365  s..        those
+0005b6d0: 206d 6573 7361 6765 7320 7468 6174 2061   messages that a
+0005b6e0: 7265 206d 6973 7369 6e67 206f 7220 6469  re missing or di
+0005b6f0: 6666 6572 656e 742c 2066 6f72 2062 6f74  fferent, for bot
+0005b700: 6820 6c65 6674 2061 6e64 0d0a 2020 2020  h left and..    
+0005b710: 2020 2020 7269 6768 742e 0d0a 2020 2020      right...    
+0005b720: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
+0005b730: 2063 203d 2063 6861 7420 6f72 2073 656c   c = chat or sel
+0005b740: 662e 6c69 7374 5f63 6861 7473 2e47 6574  f.list_chats.Get
+0005b750: 4974 656d 4d61 7070 6564 4461 7461 2865  ItemMappedData(e
+0005b760: 7665 6e74 2e49 6e64 6578 290d 0a20 2020  vent.Index)..   
+0005b770: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
+0005b780: 2e63 6861 7420 6f72 2063 5b22 6964 656e  .chat or c["iden
+0005b790: 7469 7479 225d 2021 3d20 7365 6c66 2e63  tity"] != self.c
+0005b7a0: 6861 745b 2269 6465 6e74 6974 7922 5d3a  hat["identity"]:
+0005b7b0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+0005b7c0: 6c66 2e6c 6162 656c 5f6d 6572 6765 5f63  lf.label_merge_c
+0005b7d0: 6861 742e 4c61 6265 6c20 3d20 224e 6577  hat.Label = "New
+0005b7e0: 2069 6e20 2573 3a22 205c 0d0a 2020 2020   in %s:" \..    
+0005b7f0: 2020 2020 2020 2020 2020 2020 2520 635b              % c[
+0005b800: 2274 6974 6c65 5f6c 6f6e 675f 6c63 225d  "title_long_lc"]
+0005b810: 0d0a 2020 2020 2020 2020 2020 2020 6c6f  ..            lo
+0005b820: 6767 6572 2e69 6e66 6f28 2243 6f6d 7061  gger.info("Compa
+0005b830: 7269 6e67 2025 7320 2825 7320 7673 2025  ring %s (%s vs %
+0005b840: 7329 2e22 2c20 635b 2274 6974 6c65 5f6c  s).", c["title_l
+0005b850: 6f6e 675f 6c63 225d 2c0d 0a20 2020 2020  ong_lc"],..     
+0005b860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005b870: 2020 2073 656c 662e 6462 312c 2073 656c     self.db1, sel
+0005b880: 662e 6462 3229 0d0a 2020 2020 2020 2020  f.db2)..        
+0005b890: 2020 2020 7363 726f 6c6c 706f 7320 3d20      scrollpos = 
+0005b8a0: 7365 6c66 2e6c 6973 745f 6368 6174 732e  self.list_chats.
+0005b8b0: 4765 7453 6372 6f6c 6c50 6f73 2877 782e  GetScrollPos(wx.
+0005b8c0: 5645 5254 4943 414c 290d 0a20 2020 2020  VERTICAL)..     
+0005b8d0: 2020 2020 2020 2069 6e64 6578 5f73 656c         index_sel
+0005b8e0: 6563 7465 6420 3d20 2d31 0d0a 2020 2020  ected = -1..    
+0005b8f0: 2020 2020 2020 2020 2320 5570 6461 7465          # Update
+0005b900: 2069 7465 6d20 6261 636b 6772 6f75 6e64   item background
+0005b910: 2069 6e20 6368 6174 7320 6c69 7374 0d0a   in chats list..
+0005b920: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0005b930: 6920 696e 2072 616e 6765 2873 656c 662e  i in range(self.
+0005b940: 6c69 7374 5f63 6861 7473 2e49 7465 6d43  list_chats.ItemC
+0005b950: 6f75 6e74 293a 0d0a 2020 2020 2020 2020  ount):..        
+0005b960: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0005b970: 6c69 7374 5f63 6861 7473 2e47 6574 4974  list_chats.GetIt
+0005b980: 656d 4d61 7070 6564 4461 7461 2869 2920  emMappedData(i) 
+0005b990: 3d3d 2073 656c 662e 6368 6174 3a0d 0a20  == self.chat:.. 
+0005b9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005b9b0: 2020 2073 656c 662e 6c69 7374 5f63 6861     self.list_cha
+0005b9c0: 7473 2e53 6574 4974 656d 466f 6e74 2869  ts.SetItemFont(i
+0005b9d0: 2c20 7365 6c66 2e6c 6973 745f 6368 6174  , self.list_chat
+0005b9e0: 732e 466f 6e74 290d 0a20 2020 2020 2020  s.Font)..       
+0005b9f0: 2020 2020 2020 2020 2065 6c69 6620 7365           elif se
+0005ba00: 6c66 2e6c 6973 745f 6368 6174 732e 4765  lf.list_chats.Ge
+0005ba10: 7449 7465 6d4d 6170 7065 6444 6174 6128  tItemMappedData(
+0005ba20: 6929 203d 3d20 633a 0d0a 2020 2020 2020  i) == c:..      
+0005ba30: 2020 2020 2020 2020 2020 2020 2020 696e                in
+0005ba40: 6465 785f 7365 6c65 6374 6564 203d 2069  dex_selected = i
+0005ba50: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0005ba60: 2020 2020 2020 6620 3d20 7365 6c66 2e6c        f = self.l
+0005ba70: 6973 745f 6368 6174 732e 466f 6e74 3b20  ist_chats.Font; 
+0005ba80: 662e 5365 7457 6569 6768 7428 7778 2e46  f.SetWeight(wx.F
+0005ba90: 4f4e 5457 4549 4748 545f 424f 4c44 290d  ONTWEIGHT_BOLD).
+0005baa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0005bab0: 2020 2020 2073 656c 662e 6c69 7374 5f63       self.list_c
+0005bac0: 6861 7473 2e53 6574 4974 656d 466f 6e74  hats.SetItemFont
+0005bad0: 2869 2c20 6629 0d0a 2020 2020 2020 2020  (i, f)..        
+0005bae0: 2020 2020 6966 2069 6e64 6578 5f73 656c      if index_sel
+0005baf0: 6563 7465 6420 3e3d 2030 3a0d 0a20 2020  ected >= 0:..   
+0005bb00: 2020 2020 2020 2020 2020 2020 2064 656c               del
+0005bb10: 7461 203d 2069 6e64 6578 5f73 656c 6563  ta = index_selec
+0005bb20: 7465 6420 2d20 7363 726f 6c6c 706f 730d  ted - scrollpos.
+0005bb30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0005bb40: 2069 6620 6465 6c74 6120 3c20 3020 6f72   if delta < 0 or
+0005bb50: 2061 6273 2864 656c 7461 2920 3e3d 2073   abs(delta) >= s
+0005bb60: 656c 662e 6c69 7374 5f63 6861 7473 2e43  elf.list_chats.C
+0005bb70: 6f75 6e74 5065 7250 6167 653a 0d0a 2020  ountPerPage:..  
+0005bb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005bb90: 2020 6e75 6467 6520 3d20 2d73 656c 662e    nudge = -self.
+0005bba0: 6c69 7374 5f63 6861 7473 2e43 6f75 6e74  list_chats.Count
+0005bbb0: 5065 7250 6167 6520 2f2f 2032 0d0a 2020  PerPage // 2..  
+0005bbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005bbd0: 2020 7365 6c66 2e6c 6973 745f 6368 6174    self.list_chat
+0005bbe0: 732e 5363 726f 6c6c 4c69 6e65 7328 6465  s.ScrollLines(de
+0005bbf0: 6c74 6120 2b20 6e75 6467 6529 0d0a 2020  lta + nudge)..  
+0005bc00: 2020 2020 2020 2020 2020 6275 7379 203d            busy =
+0005bc10: 2063 6f6e 7472 6f6c 732e 4275 7379 5061   controls.BusyPa
+0005bc20: 6e65 6c28 0d0a 2020 2020 2020 2020 2020  nel(..          
+0005bc30: 2020 2020 2020 7365 6c66 2c20 2244 6966        self, "Dif
+0005bc40: 6669 6e67 206d 6573 7361 6765 7320 666f  fing messages fo
+0005bc50: 7220 2573 2e22 2025 2063 5b22 7469 746c  r %s." % c["titl
+0005bc60: 655f 6c6f 6e67 5f6c 6322 5d29 0d0a 0d0a  e_long_lc"])....
+0005bc70: 2020 2020 2020 2020 2020 2020 7472 793a              try:
+0005bc80: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0005bc90: 2020 6469 6666 203d 207b 226d 6573 7361    diff = {"messa
+0005bca0: 6765 7322 3a20 5b5d 2c20 2270 6172 7469  ges": [], "parti
+0005bcb0: 6369 7061 6e74 7322 3a20 5b5d 7d0d 0a20  cipants": []}.. 
+0005bcc0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0005bcd0: 6174 6120 3d20 7365 6c66 2e63 6861 7473  ata = self.chats
+0005bce0: 5f64 6966 6664 6174 612e 6765 7428 635b  _diffdata.get(c[
+0005bcf0: 2269 6465 6e74 6974 7922 5d29 0d0a 2020  "identity"])..  
+0005bd00: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0005bd10: 2064 6174 613a 0d0a 2020 2020 2020 2020   data:..        
+0005bd20: 2020 2020 2020 2020 2020 2020 6469 6666              diff
+0005bd30: 203d 2064 6174 615b 2264 6966 6622 5d20   = data["diff"] 
+0005bd40: 2320 5573 6520 6361 6368 6564 2064 6966  # Use cached dif
+0005bd50: 6620 6966 2061 7661 696c 6162 6c65 0d0a  f if available..
+0005bd60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005bd70: 656c 6966 206e 6f74 2073 656c 662e 6973  elif not self.is
+0005bd80: 5f73 6361 6e6e 6564 205c 0d0a 2020 2020  _scanned \..    
+0005bd90: 2020 2020 2020 2020 2020 2020 616e 6420              and 
+0005bda0: 635b 2269 6465 6e74 6974 7922 5d20 6e6f  c["identity"] no
+0005bdb0: 7420 696e 2073 656c 662e 6368 6174 735f  t in self.chats_
+0005bdc0: 6e6f 6469 6666 3a0d 0a20 2020 2020 2020  nodiff:..       
+0005bdd0: 2020 2020 2020 2020 2020 2020 2064 6966               dif
+0005bde0: 6620 3d20 7365 6c66 2e77 6f72 6b65 725f  f = self.worker_
+0005bdf0: 6d65 7267 652e 6765 745f 6368 6174 5f64  merge.get_chat_d
+0005be00: 6966 665f 6c65 6674 2863 2c20 7365 6c66  iff_left(c, self
+0005be10: 2e64 6231 2c0d 0a20 2020 2020 2020 2020  .db1,..         
+0005be20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005be30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005be40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005be50: 2020 2020 2020 2073 656c 662e 6462 3229         self.db2)
+0005be60: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0005be70: 2020 2020 2020 6461 7461 203d 207b 2263        data = {"c
+0005be80: 6861 7422 3a20 632c 2022 6469 6666 223a  hat": c, "diff":
+0005be90: 2064 6966 667d 0d0a 2020 2020 2020 2020   diff}..        
+0005bea0: 2020 2020 2020 2020 2020 2020 6966 2061              if a
+0005beb0: 6e79 2864 6966 662e 7661 6c75 6573 2829  ny(diff.values()
+0005bec0: 293a 2023 2043 6163 6865 206e 6577 2064  ): # Cache new d
+0005bed0: 6966 660d 0a20 2020 2020 2020 2020 2020  iff..           
+0005bee0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0005bef0: 662e 6368 6174 735f 6469 6666 6461 7461  f.chats_diffdata
+0005bf00: 5b63 5b22 6964 656e 7469 7479 225d 5d20  [c["identity"]] 
+0005bf10: 3d20 6461 7461 0d0a 2020 2020 2020 2020  = data..        
+0005bf20: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0005bf30: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0005bf40: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0005bf50: 6368 6174 735f 6e6f 6469 6666 5b63 5b22  chats_nodiff[c["
+0005bf60: 6964 656e 7469 7479 225d 5d20 3d20 630d  identity"]] = c.
+0005bf70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0005bf80: 2065 6c69 6620 635b 2269 6465 6e74 6974   elif c["identit
+0005bf90: 7922 5d20 6e6f 7420 696e 2073 656c 662e  y"] not in self.
+0005bfa0: 6368 6174 735f 6e6f 6469 6666 3a0d 0a20  chats_nodiff:.. 
+0005bfb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005bfc0: 2020 2064 6174 6120 3d20 7b22 6368 6174     data = {"chat
+0005bfd0: 223a 2063 2c20 2264 6966 6622 3a20 6469  ": c, "diff": di
+0005bfe0: 6666 7d0d 0a20 2020 2020 2020 2020 2020  ff}..           
+0005bff0: 2020 2020 2020 2020 2073 656c 662e 6368           self.ch
+0005c000: 6174 735f 6e6f 6469 6666 5b63 5b22 6964  ats_nodiff[c["id
+0005c010: 656e 7469 7479 225d 5d20 3d20 6461 7461  entity"]] = data
+0005c020: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0005c030: 2020 6d65 7373 6167 6573 203d 206c 6973    messages = lis
+0005c040: 7428 7365 6c66 2e64 6231 2e6d 6573 7361  t(self.db1.messa
+0005c050: 6765 5f69 7465 7261 746f 7228 6469 6666  ge_iterator(diff
+0005c060: 5b22 6d65 7373 6167 6573 225d 2929 0d0a  ["messages"]))..
+0005c070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005c080: 7365 6c66 2e63 6861 7420 3d20 630d 0a20  self.chat = c.. 
+0005c090: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0005c0a0: 656c 662e 6368 6174 5f64 6966 6620 3d20  elf.chat_diff = 
+0005c0b0: 6469 6666 0d0a 2020 2020 2020 2020 2020  diff..          
+0005c0c0: 2020 2020 2020 7365 6c66 2e62 7574 746f        self.butto
+0005c0d0: 6e5f 6d65 7267 655f 6368 6174 2e45 6e61  n_merge_chat.Ena
+0005c0e0: 626c 6564 203d 206c 656e 286d 6573 7361  bled = len(messa
+0005c0f0: 6765 7329 0d0a 2020 2020 2020 2020 2020  ges)..          
+0005c100: 2020 2020 2020 7365 6c66 2e62 7574 746f        self.butto
+0005c110: 6e5f 6d65 7267 655f 6368 6174 2e4e 6f74  n_merge_chat.Not
+0005c120: 6520 3d20 7365 6c66 2e4d 4552 4745 5f43  e = self.MERGE_C
+0005c130: 4841 545f 4255 5454 4f4e 5f4e 4f54 450d  HAT_BUTTON_NOTE.
+0005c140: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0005c150: 2073 656c 662e 6275 7474 6f6e 5f65 7870   self.button_exp
+0005c160: 6f72 745f 6368 6174 2e45 6e61 626c 6564  ort_chat.Enabled
+0005c170: 203d 206c 656e 286d 6573 7361 6765 7329   = len(messages)
+0005c180: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0005c190: 2020 6966 206d 6573 7361 6765 733a 0d0a    if messages:..
+0005c1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005c1b0: 2020 2020 7365 6c66 2e62 7574 746f 6e5f      self.button_
+0005c1c0: 6d65 7267 655f 6368 6174 2e4e 6f74 6520  merge_chat.Note 
+0005c1d0: 3d20 280d 0a20 2020 2020 2020 2020 2020  = (..           
+0005c1e0: 2020 2020 2020 2020 2020 2020 2022 436f               "Co
+0005c1f0: 7079 2025 7320 746f 2074 6865 2064 6174  py %s to the dat
+0005c200: 6162 6173 6520 6f6e 2074 6865 2072 6967  abase on the rig
+0005c210: 6874 2e22 2025 0d0a 2020 2020 2020 2020  ht." %..        
+0005c220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005c230: 7574 696c 2e70 6c75 7261 6c28 2263 6861  util.plural("cha
+0005c240: 7420 6d65 7373 6167 6522 2c20 6d65 7373  t message", mess
+0005c250: 6167 6573 2c20 7365 703d 222c 2229 290d  ages, sep=",")).
+0005c260: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0005c270: 2020 2020 2073 656c 662e 6275 7474 6f6e       self.button
+0005c280: 5f6d 6572 6765 5f63 6861 742e 436f 6e74  _merge_chat.Cont
+0005c290: 6169 6e69 6e67 5369 7a65 722e 4c61 796f  ainingSizer.Layo
+0005c2a0: 7574 2829 0d0a 2020 2020 2020 2020 2020  ut()..          
+0005c2b0: 2020 2020 2020 6964 7820 3d20 2d63 6f6e        idx = -con
+0005c2c0: 662e 4d61 7848 6973 746f 7279 496e 6974  f.MaxHistoryInit
+0005c2d0: 6961 6c4d 6573 7361 6765 730d 0a20 2020  ialMessages..   
+0005c2e0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0005c2f0: 662e 7374 635f 6469 6666 312e 506f 7075  f.stc_diff1.Popu
+0005c300: 6c61 7465 2863 2c20 7365 6c66 2e64 6231  late(c, self.db1
+0005c310: 2c20 6d65 7373 6167 6573 2c20 6672 6f6d  , messages, from
+0005c320: 5f69 6e64 6578 3d69 6478 290d 0a20 2020  _index=idx)..   
+0005c330: 2020 2020 2020 2020 2020 2020 2074 6578               tex
+0005c340: 746c 656e 6774 6820 3d20 7365 6c66 2e73  tlength = self.s
+0005c350: 7463 5f64 6966 6631 2e54 6578 744c 656e  tc_diff1.TextLen
+0005c360: 6774 680d 0a20 2020 2020 2020 2020 2020  gth..           
+0005c370: 2020 2020 2073 656c 662e 7374 635f 6469       self.stc_di
+0005c380: 6666 312e 5365 7453 656c 6563 7469 6f6e  ff1.SetSelection
+0005c390: 2874 6578 746c 656e 6774 682c 2074 6578  (textlength, tex
+0005c3a0: 746c 656e 6774 6829 0d0a 2020 2020 2020  tlength)..      
+0005c3b0: 2020 2020 2020 6669 6e61 6c6c 793a 0d0a        finally:..
+0005c3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005c3d0: 6275 7379 2e43 6c6f 7365 2829 0d0a 0d0a  busy.Close()....
+0005c3e0: 0d0a 2020 2020 6465 6620 6f6e 5f6d 6572  ..    def on_mer
+0005c3f0: 6765 5f63 6f6e 7461 6374 7328 7365 6c66  ge_contacts(self
+0005c400: 2c20 6576 656e 7429 3a0d 0a20 2020 2020  , event):..     
+0005c410: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
+0005c420: 4861 6e64 6c65 7220 666f 7220 636c 6963  Handler for clic
+0005c430: 6b69 6e67 2074 6f20 6d65 7267 6520 636f  king to merge co
+0005c440: 6e74 6163 7473 2066 726f 6d20 6f6e 6520  ntacts from one 
+0005c450: 6461 7461 6261 7365 2074 6f20 7468 6520  database to the 
+0005c460: 6f74 6865 722c 0d0a 2020 2020 2020 2020  other,..        
+0005c470: 6569 7468 6572 2073 656c 6563 7465 6420  either selected 
+0005c480: 6f72 2061 6c6c 2063 6f6e 7461 6374 732c  or all contacts,
+0005c490: 2064 6570 656e 6469 6e67 206f 6e20 6275   depending on bu
+0005c4a0: 7474 6f6e 2063 6c69 636b 6564 2e0d 0a20  tton clicked... 
+0005c4b0: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
+0005c4c0: 2020 2020 6462 5f74 6172 6765 742c 2064      db_target, d
+0005c4d0: 625f 736f 7572 6365 203d 2073 656c 662e  b_source = self.
+0005c4e0: 6462 322c 2073 656c 662e 6462 310d 0a20  db2, self.db1.. 
+0005c4f0: 2020 2020 2020 206c 6973 745f 736f 7572         list_sour
+0005c500: 6365 203d 2073 656c 662e 6c69 7374 5f63  ce = self.list_c
+0005c510: 6f6e 7461 6374 730d 0a20 2020 2020 2020  ontacts..       
+0005c520: 2073 6f75 7263 6520 3d20 300d 0a20 2020   source = 0..   
+0005c530: 2020 2020 2063 6f6e 7461 6374 732c 2063       contacts, c
+0005c540: 6f6e 7461 6374 6772 6f75 7073 2c20 696e  ontactgroups, in
+0005c550: 6469 6365 7320 3d20 5b5d 2c20 5b5d 2c20  dices = [], [], 
+0005c560: 5b5d 0d0a 2020 2020 2020 2020 6966 2065  []..        if e
+0005c570: 7665 6e74 2e49 6420 3d3d 2073 656c 662e  vent.Id == self.
+0005c580: 6275 7474 6f6e 5f6d 6572 6765 5f61 6c6c  button_merge_all
+0005c590: 636f 6e74 6163 7473 2e49 643a 0d0a 2020  contacts.Id:..  
+0005c5a0: 2020 2020 2020 2020 2020 666f 7220 6920            for i 
+0005c5b0: 696e 2072 616e 6765 286c 6973 745f 736f  in range(list_so
+0005c5c0: 7572 6365 2e49 7465 6d43 6f75 6e74 293a  urce.ItemCount):
+0005c5d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0005c5e0: 2020 6461 7461 203d 206c 6973 745f 736f    data = list_so
+0005c5f0: 7572 6365 2e47 6574 4974 656d 4d61 7070  urce.GetItemMapp
+0005c600: 6564 4461 7461 2869 290d 0a20 2020 2020  edData(i)..     
+0005c610: 2020 2020 2020 2020 2020 2069 6620 2243             if "C
+0005c620: 6f6e 7461 6374 2220 3d3d 2064 6174 615b  ontact" == data[
+0005c630: 225f 5f74 7970 6522 5d3a 0d0a 2020 2020  "__type"]:..    
+0005c640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005c650: 636f 6e74 6163 7473 2e61 7070 656e 6428  contacts.append(
+0005c660: 6461 7461 5b22 5f5f 6461 7461 225d 290d  data["__data"]).
+0005c670: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0005c680: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+0005c690: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+0005c6a0: 6163 7467 726f 7570 732e 6170 7065 6e64  actgroups.append
+0005c6b0: 2864 6174 615b 225f 5f64 6174 6122 5d29  (data["__data"])
+0005c6c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0005c6d0: 2020 696e 6469 6365 732e 6170 7065 6e64    indices.append
+0005c6e0: 2869 290d 0a20 2020 2020 2020 2065 6c73  (i)..        els
+0005c6f0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+0005c700: 7365 6c65 6374 6564 203d 206c 6973 745f  selected = list_
+0005c710: 736f 7572 6365 2e47 6574 4669 7273 7453  source.GetFirstS
+0005c720: 656c 6563 7465 6428 290d 0a20 2020 2020  elected()..     
+0005c730: 2020 2020 2020 2077 6869 6c65 2073 656c         while sel
+0005c740: 6563 7465 6420 3e3d 2030 3a0d 0a20 2020  ected >= 0:..   
+0005c750: 2020 2020 2020 2020 2020 2020 2064 6174               dat
+0005c760: 6120 3d20 6c69 7374 5f73 6f75 7263 652e  a = list_source.
+0005c770: 4765 7449 7465 6d4d 6170 7065 6444 6174  GetItemMappedDat
+0005c780: 6128 7365 6c65 6374 6564 290d 0a20 2020  a(selected)..   
+0005c790: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0005c7a0: 2243 6f6e 7461 6374 2220 3d3d 2064 6174  "Contact" == dat
+0005c7b0: 615b 225f 5f74 7970 6522 5d3a 0d0a 2020  a["__type"]:..  
+0005c7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005c7d0: 2020 636f 6e74 6163 7473 2e61 7070 656e    contacts.appen
+0005c7e0: 6428 6461 7461 5b22 5f5f 6461 7461 225d  d(data["__data"]
+0005c7f0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0005c800: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+0005c810: 2020 2020 2020 2020 2020 2020 2020 636f                co
+0005c820: 6e74 6163 7467 726f 7570 732e 6170 7065  ntactgroups.appe
+0005c830: 6e64 2864 6174 615b 225f 5f64 6174 6122  nd(data["__data"
+0005c840: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
+0005c850: 2020 2020 696e 6469 6365 732e 6170 7065      indices.appe
+0005c860: 6e64 2873 656c 6563 7465 6429 0d0a 2020  nd(selected)..  
+0005c870: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0005c880: 6c65 6374 6564 203d 206c 6973 745f 736f  lected = list_so
+0005c890: 7572 6365 2e47 6574 4e65 7874 5365 6c65  urce.GetNextSele
+0005c8a0: 6374 6564 2873 656c 6563 7465 6429 0d0a  cted(selected)..
+0005c8b0: 2020 2020 2020 2020 2320 436f 6e74 6163          # Contac
+0005c8c0: 7473 2061 6e64 2063 6f6e 7461 6374 2067  ts and contact g
+0005c8d0: 726f 7570 7320 6172 6520 7368 6f77 6e20  roups are shown 
+0005c8e0: 696e 2074 6865 2073 616d 6520 6c69 7374  in the same list
+0005c8f0: 2e20 4966 2061 2063 6f6e 7461 6374 0d0a  . If a contact..
+0005c900: 2020 2020 2020 2020 2320 6772 6f75 7020          # group 
+0005c910: 6973 2063 686f 7365 6e2c 2069 7420 6361  is chosen, it ca
+0005c920: 6e20 696e 636c 7564 6520 636f 6e74 6163  n include contac
+0005c930: 7473 206e 6f74 2079 6574 2069 6e20 7461  ts not yet in ta
+0005c940: 7267 6574 2064 6174 6162 6173 652e 0d0a  rget database...
+0005c950: 2020 2020 2020 2020 636f 6e74 6163 7473          contacts
+0005c960: 5f74 6172 6765 745f 6669 6e61 6c20 3d20  _target_final = 
+0005c970: 6469 6374 285b 2863 5b22 6964 656e 7469  dict([(c["identi
+0005c980: 7479 225d 2c20 6329 2066 6f72 2063 2069  ty"], c) for c i
+0005c990: 6e20 636f 6e74 6163 7473 5d29 0d0a 2020  n contacts])..  
+0005c9a0: 2020 2020 2020 636f 6e74 6163 7473 5f74        contacts_t
+0005c9b0: 6172 6765 745f 6669 6e61 6c2e 7570 6461  arget_final.upda
+0005c9c0: 7465 2864 6963 7428 2863 5b22 6964 656e  te(dict((c["iden
+0005c9d0: 7469 7479 225d 2c20 6329 0d0a 2020 2020  tity"], c)..    
+0005c9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005c9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005ca00: 2020 2020 2020 666f 7220 6320 696e 2064        for c in d
+0005ca10: 625f 7461 7267 6574 2e67 6574 5f63 6f6e  b_target.get_con
+0005ca20: 7461 6374 7328 2929 290d 0a20 2020 2020  tacts()))..     
+0005ca30: 2020 2063 6f6e 7461 6374 735f 736f 7572     contacts_sour
+0005ca40: 6365 203d 2064 6963 7428 2863 5b27 6964  ce = dict((c['id
+0005ca50: 656e 7469 7479 275d 2c20 6329 0d0a 2020  entity'], c)..  
+0005ca60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005ca70: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0005ca80: 2063 2069 6e20 6462 5f73 6f75 7263 652e   c in db_source.
+0005ca90: 6765 745f 636f 6e74 6163 7473 2829 290d  get_contacts()).
+0005caa0: 0a20 2020 2020 2020 2066 6f72 2067 726f  .        for gro
+0005cab0: 7570 2069 6e20 636f 6e74 6163 7467 726f  up in contactgro
+0005cac0: 7570 733a 0d0a 2020 2020 2020 2020 2020  ups:..          
+0005cad0: 2020 6d65 6d62 6572 7320 3d20 7365 7428    members = set(
+0005cae0: 6772 6f75 705b 226d 656d 6265 7273 225d  group["members"]
+0005caf0: 2e73 706c 6974 2822 2022 2929 0d0a 2020  .split(" "))..  
+0005cb00: 2020 2020 2020 2020 2020 666f 7220 6e65            for ne
+0005cb10: 7720 696e 206d 656d 6265 7273 2e64 6966  w in members.dif
+0005cb20: 6665 7265 6e63 6528 636f 6e74 6163 7473  ference(contacts
+0005cb30: 5f74 6172 6765 745f 6669 6e61 6c29 3a0d  _target_final):.
+0005cb40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0005cb50: 2063 6f6e 7461 6374 732e 6170 7065 6e64   contacts.append
+0005cb60: 2863 6f6e 7461 6374 735f 736f 7572 6365  (contacts_source
+0005cb70: 5b6e 6577 5d29 0d0a 2020 2020 2020 2020  [new])..        
+0005cb80: 7465 7874 5f61 6464 203d 2022 220d 0a20  text_add = "".. 
+0005cb90: 2020 2020 2020 2069 6620 636f 6e74 6163         if contac
+0005cba0: 7473 3a0d 0a20 2020 2020 2020 2020 2020  ts:..           
+0005cbb0: 2074 6578 745f 6164 6420 2b3d 2075 7469   text_add += uti
+0005cbc0: 6c2e 706c 7572 616c 2822 636f 6e74 6163  l.plural("contac
+0005cbd0: 7422 2c20 636f 6e74 6163 7473 2c20 7365  t", contacts, se
+0005cbe0: 703d 222c 2229 0d0a 2020 2020 2020 2020  p=",")..        
+0005cbf0: 6966 2063 6f6e 7461 6374 6772 6f75 7073  if contactgroups
+0005cc00: 3a0d 0a20 2020 2020 2020 2020 2020 2074  :..            t
+0005cc10: 6578 745f 6164 6420 2b3d 2028 2220 616e  ext_add += (" an
+0005cc20: 6420 2220 6966 2063 6f6e 7461 6374 7320  d " if contacts 
+0005cc30: 656c 7365 2022 2229 205c 0d0a 2020 2020  else "") \..    
+0005cc40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005cc50: 2020 202b 2075 7469 6c2e 706c 7572 616c     + util.plural
+0005cc60: 2822 636f 6e74 6163 7420 6772 6f75 7022  ("contact group"
+0005cc70: 2c20 636f 6e74 6163 7467 726f 7570 732c  , contactgroups,
+0005cc80: 2073 6570 3d22 2c22 290d 0a20 2020 2020   sep=",")..     
+0005cc90: 2020 2069 6620 2863 6f6e 7461 6374 7320     if (contacts 
+0005cca0: 6f72 2063 6f6e 7461 6374 6772 6f75 7073  or contactgroups
+0005ccb0: 2920 616e 6420 7778 2e4f 4b20 3d3d 2077  ) and wx.OK == w
+0005ccc0: 782e 4d65 7373 6167 6542 6f78 280d 0a20  x.MessageBox(.. 
+0005ccd0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0005cce0: 436f 7079 2025 735c 6e5c 6e66 726f 6d20  Copy %s\n\nfrom 
+0005ccf0: 2573 5c6e 5c6e 696e 746f 2025 733f 2220  %s\n\ninto %s?" 
+0005cd00: 250d 0a20 2020 2020 2020 2020 2020 2020  %..             
+0005cd10: 2020 2028 7465 7874 5f61 6464 2c20 7365     (text_add, se
+0005cd20: 6c66 2e64 6231 2c20 7365 6c66 2e64 6232  lf.db1, self.db2
+0005cd30: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
+0005cd40: 2020 2020 636f 6e66 2e54 6974 6c65 2c20      conf.Title, 
+0005cd50: 7778 2e4f 4b20 7c20 7778 2e43 414e 4345  wx.OK | wx.CANCE
+0005cd60: 4c20 7c20 7778 2e49 434f 4e5f 494e 464f  L | wx.ICON_INFO
+0005cd70: 524d 4154 494f 4e29 3a0d 0a20 2020 2020  RMATION):..     
+0005cd80: 2020 2020 2020 2073 656c 662e 6973 5f6d         self.is_m
+0005cd90: 6572 6769 6e67 203d 2054 7275 650d 0a20  erging = True.. 
+0005cda0: 2020 2020 2020 2020 2020 2074 7279 3a0d             try:.
+0005cdb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0005cdc0: 2069 6620 636f 6e74 6163 7473 3a0d 0a20   if contacts:.. 
+0005cdd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005cde0: 2020 2064 625f 7461 7267 6574 2e69 6e73     db_target.ins
+0005cdf0: 6572 745f 636f 6e74 6163 7473 2863 6f6e  ert_contacts(con
+0005ce00: 7461 6374 732c 2064 625f 736f 7572 6365  tacts, db_source
+0005ce10: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0005ce20: 2020 2069 6620 636f 6e74 6163 7467 726f     if contactgro
+0005ce30: 7570 733a 0d0a 2020 2020 2020 2020 2020  ups:..          
+0005ce40: 2020 2020 2020 2020 2020 6462 5f74 6172            db_tar
+0005ce50: 6765 742e 7265 706c 6163 655f 636f 6e74  get.replace_cont
+0005ce60: 6163 7467 726f 7570 7328 636f 6e74 6163  actgroups(contac
+0005ce70: 7467 726f 7570 732c 2064 625f 736f 7572  tgroups, db_sour
+0005ce80: 6365 290d 0a20 2020 2020 2020 2020 2020  ce)..           
+0005ce90: 2066 696e 616c 6c79 3a0d 0a20 2020 2020   finally:..     
+0005cea0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0005ceb0: 6973 5f6d 6572 6769 6e67 203d 2046 616c  is_merging = Fal
+0005cec0: 7365 0d0a 2020 2020 2020 2020 2020 2020  se..            
+0005ced0: 666f 7220 6920 696e 2073 6f72 7465 6428  for i in sorted(
+0005cee0: 696e 6469 6365 7329 5b3a 3a2d 315d 3a0d  indices)[::-1]:.
+0005cef0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0005cf00: 206c 6973 745f 736f 7572 6365 2e44 656c   list_source.Del
+0005cf10: 6574 6549 7465 6d28 6929 0d0a 2020 2020  eteItem(i)..    
+0005cf20: 2020 2020 2020 2020 636f 6e64 6966 6620          condiff 
+0005cf30: 3d20 5b73 656c 662e 636f 6e31 6469 6666  = [self.con1diff
+0005cf40: 2c20 7365 6c66 2e63 6f6e 3264 6966 665d  , self.con2diff]
+0005cf50: 5b73 6f75 7263 655d 0d0a 2020 2020 2020  [source]..      
+0005cf60: 2020 2020 2020 6367 6469 6666 203d 205b        cgdiff = [
+0005cf70: 7365 6c66 2e63 6f6e 6772 6f75 7031 6469  self.congroup1di
+0005cf80: 6666 2c20 7365 6c66 2e63 6f6e 6772 6f75  ff, self.congrou
+0005cf90: 7031 6469 6666 5d5b 736f 7572 6365 5d0d  p1diff][source].
+0005cfa0: 0a20 2020 2020 2020 2020 2020 2064 6966  .            dif
+0005cfb0: 666c 6973 7420 3d20 5b73 656c 662e 636f  flist = [self.co
+0005cfc0: 6e31 6469 6666 6c69 7374 2c20 7365 6c66  n1difflist, self
+0005cfd0: 2e63 6f6e 3164 6966 666c 6973 745d 5b73  .con1difflist][s
+0005cfe0: 6f75 7263 655d 0d0a 2020 2020 2020 2020  ource]..        
+0005cff0: 2020 2020 666f 7220 6320 696e 205b 636f      for c in [co
+0005d000: 6e74 6163 7473 2c20 636f 6e74 6163 7467  ntacts, contactg
+0005d010: 726f 7570 735d 3a0d 0a20 2020 2020 2020  roups]:..       
+0005d020: 2020 2020 2020 2020 205b 6c2e 7265 6d6f           [l.remo
+0005d030: 7665 2863 2920 666f 7220 6c20 696e 205b  ve(c) for l in [
+0005d040: 636f 6e64 6966 662c 2063 6764 6966 662c  condiff, cgdiff,
+0005d050: 2064 6966 666c 6973 745d 2069 6620 6320   difflist] if c 
+0005d060: 696e 206c 5d0d 0a20 2020 2020 2020 2020  in l]..         
+0005d070: 2020 2064 625f 7461 7267 6574 2e63 6c65     db_target.cle
+0005d080: 6172 5f63 6163 6865 2829 0d0a 2020 2020  ar_cache()..    
+0005d090: 2020 2020 2020 2020 7365 6c66 2e62 7574          self.but
+0005d0a0: 746f 6e5f 6d65 7267 655f 636f 6e74 6163  ton_merge_contac
+0005d0b0: 7473 2e45 6e61 626c 6564 203d 2046 616c  ts.Enabled = Fal
+0005d0c0: 7365 0d0a 2020 2020 2020 2020 2020 2020  se..            
+0005d0d0: 7365 6c66 2e62 7574 746f 6e5f 6d65 7267  self.button_merg
+0005d0e0: 655f 616c 6c63 6f6e 7461 6374 732e 456e  e_allcontacts.En
+0005d0f0: 6162 6c65 6420 3d20 6c69 7374 5f73 6f75  abled = list_sou
+0005d100: 7263 652e 4974 656d 436f 756e 740d 0a20  rce.ItemCount.. 
+0005d110: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
+0005d120: 722e 696e 666f 2822 436f 7069 6564 2025  r.info("Copied %
+0005d130: 7320 6672 6f6d 2025 7320 696e 746f 2025  s from %s into %
+0005d140: 732e 222c 2074 6578 745f 6164 642c 2073  s.", text_add, s
+0005d150: 656c 662e 6462 312c 2073 656c 662e 6462  elf.db1, self.db
+0005d160: 3229 0d0a 2020 2020 2020 2020 2020 2020  2)..            
+0005d170: 7778 2e4d 6573 7361 6765 426f 7828 2243  wx.MessageBox("C
+0005d180: 6f70 6965 6420 2573 5c6e 5c6e 6672 6f6d  opied %s\n\nfrom
+0005d190: 2025 735c 6e5c 6e69 6e74 6f20 2573 2e22   %s\n\ninto %s."
+0005d1a0: 2025 2028 7465 7874 5f61 6464 2c0d 0a20   % (text_add,.. 
+0005d1b0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0005d1c0: 656c 662e 6462 312c 2073 656c 662e 6462  elf.db1, self.db
+0005d1d0: 3229 2c20 636f 6e66 2e54 6974 6c65 2c20  2), conf.Title, 
+0005d1e0: 7778 2e4f 4b20 7c20 7778 2e49 434f 4e5f  wx.OK | wx.ICON_
+0005d1f0: 494e 464f 524d 4154 494f 4e29 0d0a 0d0a  INFORMATION)....
+0005d200: 0d0a 2020 2020 6465 6620 6f6e 5f73 6361  ..    def on_sca
+0005d210: 6e5f 616c 6c28 7365 6c66 2c20 6576 656e  n_all(self, even
+0005d220: 7429 3a0d 0a20 2020 2020 2020 2022 2222  t):..        """
+0005d230: 0d0a 2020 2020 2020 2020 4861 6e64 6c65  ..        Handle
+0005d240: 7220 666f 7220 636c 6963 6b69 6e67 2074  r for clicking t
+0005d250: 6f20 7363 616e 2066 6f72 2064 6966 6665  o scan for diffe
+0005d260: 7265 6e63 6573 2077 6974 6820 7468 6520  rences with the 
+0005d270: 6c65 6674 2064 6174 6162 6173 652c 0d0a  left database,..
+0005d280: 2020 2020 2020 2020 7374 6172 7473 2073          starts s
+0005d290: 6361 6e6e 696e 6720 7072 6f63 6573 732e  canning process.
+0005d2a0: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
+0005d2b0: 2020 2020 2020 2067 7569 6261 7365 2e73         guibase.s
+0005d2c0: 7461 7475 7328 2253 6361 6e6e 696e 6720  tatus("Scanning 
+0005d2d0: 6469 6666 6572 656e 6365 7320 6265 7477  differences betw
+0005d2e0: 6565 6e20 2573 2061 6e64 2025 732e 222c  een %s and %s.",
+0005d2f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0005d300: 2020 2020 2020 2020 2073 656c 662e 6462           self.db
+0005d310: 312c 2073 656c 662e 6462 322c 206c 6f67  1, self.db2, log
+0005d320: 3d54 7275 6529 0d0a 2020 2020 2020 2020  =True)..        
+0005d330: 7365 6c66 2e63 6861 7473 5f64 6966 6664  self.chats_diffd
+0005d340: 6174 612e 636c 6561 7228 290d 0a20 2020  ata.clear()..   
+0005d350: 2020 2020 2073 656c 662e 6275 7474 6f6e       self.button
+0005d360: 5f6d 6572 6765 5f61 6c6c 2e45 6e61 626c  _merge_all.Enabl
+0005d370: 6564 203d 2046 616c 7365 0d0a 2020 2020  ed = False..    
+0005d380: 2020 2020 7365 6c66 2e62 7574 746f 6e5f      self.button_
+0005d390: 7363 616e 5f61 6c6c 2e45 6e61 626c 6564  scan_all.Enabled
+0005d3a0: 203d 2046 616c 7365 0d0a 2020 2020 2020   = False..      
+0005d3b0: 2020 7365 6c66 2e62 7574 746f 6e5f 7377    self.button_sw
+0005d3c0: 6170 2e45 6e61 626c 6564 203d 2046 616c  ap.Enabled = Fal
+0005d3d0: 7365 0d0a 2020 2020 2020 2020 7365 6c66  se..        self
+0005d3e0: 2e62 7574 746f 6e5f 6d65 7267 655f 6368  .button_merge_ch
+0005d3f0: 6174 732e 456e 6162 6c65 6420 3d20 4661  ats.Enabled = Fa
+0005d400: 6c73 650d 0a20 2020 2020 2020 2069 6620  lse..        if 
+0005d410: 6e6f 7420 7365 6c66 2e68 746d 6c5f 7265  not self.html_re
+0005d420: 706f 7274 2e53 686f 776e 3a0d 0a20 2020  port.Shown:..   
+0005d430: 2020 2020 2020 2020 2073 656c 662e 6874           self.ht
+0005d440: 6d6c 5f72 6570 6f72 742e 5368 6f77 2829  ml_report.Show()
+0005d450: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+0005d460: 6c66 2e68 746d 6c5f 7265 706f 7274 2e43  lf.html_report.C
+0005d470: 6f6e 7461 696e 696e 6753 697a 6572 2e4c  ontainingSizer.L
+0005d480: 6179 6f75 7428 290d 0a20 2020 2020 2020  ayout()..       
+0005d490: 2068 746d 6c20 3d20 2822 3c62 6f64 7920   html = ("<body 
+0005d4a0: 6267 636f 6c6f 723d 2725 7327 3e3c 666f  bgcolor='%s'><fo
+0005d4b0: 6e74 2063 6f6c 6f72 3d27 2573 273e 3c62  nt color='%s'><b
+0005d4c0: 3e53 6361 6e20 7265 7375 6c74 733a 3c2f  >Scan results:</
+0005d4d0: 623e 220d 0a20 2020 2020 2020 2020 2020  b>"..           
+0005d4e0: 2020 2020 2022 3c62 7220 2f3e 3c62 7220       "<br /><br 
+0005d4f0: 2f3e 2220 250d 0a20 2020 2020 2020 2020  />" %..         
+0005d500: 2020 2020 2020 2028 636f 6e66 2e4d 6572         (conf.Mer
+0005d510: 6765 4874 6d6c 4261 636b 6772 6f75 6e64  geHtmlBackground
+0005d520: 436f 6c6f 7572 2c20 636f 6e66 2e46 6743  Colour, conf.FgC
+0005d530: 6f6c 6f75 7229 290d 0a20 2020 2020 2020  olour))..       
+0005d540: 2073 656c 662e 6874 6d6c 5f72 6570 6f72   self.html_repor
+0005d550: 742e 5365 7450 6167 6528 6874 6d6c 290d  t.SetPage(html).
+0005d560: 0a20 2020 2020 2020 2073 656c 662e 7570  .        self.up
+0005d570: 6461 7465 5f67 6175 6765 2873 656c 662e  date_gauge(self.
+0005d580: 6761 7567 655f 7072 6f67 7265 7373 2c20  gauge_progress, 
+0005d590: 302c 2022 5363 616e 6e69 6e67 206d 6573  0, "Scanning mes
+0005d5a0: 7361 6765 732e 2229 0d0a 2020 2020 2020  sages.")..      
+0005d5b0: 2020 7061 7261 6d73 203d 207b 2264 6231    params = {"db1
+0005d5c0: 223a 2073 656c 662e 6462 312c 2022 6462  ": self.db1, "db
+0005d5d0: 3222 3a20 7365 6c66 2e64 6232 2c20 2274  2": self.db2, "t
+0005d5e0: 7970 6522 3a20 2264 6966 665f 6c65 6674  ype": "diff_left
+0005d5f0: 227d 0d0a 2020 2020 2020 2020 7365 6c66  "}..        self
+0005d600: 2e77 6f72 6b65 725f 6d65 7267 652e 776f  .worker_merge.wo
+0005d610: 726b 2870 6172 616d 7329 0d0a 2020 2020  rk(params)..    
+0005d620: 2020 2020 7365 6c66 2e69 735f 7363 616e      self.is_scan
+0005d630: 6e69 6e67 203d 2054 7275 650d 0a0d 0a0d  ning = True.....
+0005d640: 0a20 2020 2064 6566 206f 6e5f 7363 616e  .    def on_scan
+0005d650: 5f61 6c6c 5f72 6573 756c 7428 7365 6c66  _all_result(self
+0005d660: 2c20 6576 656e 7429 3a0d 0a20 2020 2020  , event):..     
+0005d670: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
+0005d680: 4861 6e64 6c65 7220 666f 7220 6765 7474  Handler for gett
+0005d690: 696e 6720 6469 6666 2072 6573 756c 7473  ing diff results
+0005d6a0: 2066 726f 6d20 776f 726b 6572 2074 6872   from worker thr
+0005d6b0: 6561 642c 2061 6464 7320 7468 6520 7265  ead, adds the re
+0005d6c0: 7375 6c74 730d 0a20 2020 2020 2020 2074  sults..        t
+0005d6d0: 6f20 7468 6520 6469 6666 2077 696e 646f  o the diff windo
+0005d6e0: 7773 2e0d 0a20 2020 2020 2020 2022 2222  ws...        """
+0005d6f0: 0d0a 2020 2020 2020 2020 7265 7375 6c74  ..        result
+0005d700: 203d 2065 7665 6e74 2e72 6573 756c 740d   = event.result.
+0005d710: 0a20 2020 2020 2020 2066 6f72 2064 2069  .        for d i
+0005d720: 6e20 7265 7375 6c74 2e67 6574 2822 6368  n result.get("ch
+0005d730: 6174 7322 2c20 5b5d 293a 0d0a 2020 2020  ats", []):..    
+0005d740: 2020 2020 2020 2020 7365 6c66 2e63 6861          self.cha
+0005d750: 7473 5f64 6966 6664 6174 615b 645b 2263  ts_diffdata[d["c
+0005d760: 6861 7422 5d5b 2269 6465 6e74 6974 7922  hat"]["identity"
+0005d770: 5d5d 203d 2064 0d0a 2020 2020 2020 2020  ]] = d..        
+0005d780: 6966 2072 6573 756c 742e 6765 7428 226f  if result.get("o
+0005d790: 7574 7075 7422 2920 616e 6420 2264 6f6e  utput") and "don
+0005d7a0: 6522 206e 6f74 2069 6e20 7265 7375 6c74  e" not in result
+0005d7b0: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+0005d7c0: 656c 662e 6874 6d6c 5f72 6570 6f72 742e  elf.html_report.
+0005d7d0: 4170 7065 6e64 546f 5061 6765 2872 6573  AppendToPage(res
+0005d7e0: 756c 745b 226f 7574 7075 7422 5d29 0d0a  ult["output"])..
+0005d7f0: 2020 2020 2020 2020 6966 2022 7374 6174          if "stat
+0005d800: 7573 2220 696e 2072 6573 756c 743a 0d0a  us" in result:..
+0005d810: 2020 2020 2020 2020 2020 2020 6775 6962              guib
+0005d820: 6173 652e 7374 6174 7573 2872 6573 756c  ase.status(resul
+0005d830: 745b 2273 7461 7475 7322 5d29 0d0a 2020  t["status"])..  
+0005d840: 2020 2020 2020 6966 2022 696e 6465 7822        if "index"
+0005d850: 2069 6e20 7265 7375 6c74 3a0d 0a20 2020   in result:..   
+0005d860: 2020 2020 2020 2020 206d 696e 6465 782c           mindex,
+0005d870: 206d 636f 756e 7420 3d20 7265 7375 6c74   mcount = result
+0005d880: 5b22 696e 6465 7822 5d2c 2072 6573 756c  ["index"], resul
+0005d890: 745b 2263 6f75 6e74 225d 0d0a 2020 2020  t["count"]..    
+0005d8a0: 2020 2020 2020 2020 6369 6e64 6578 2c20          cindex, 
+0005d8b0: 6363 6f75 6e74 203d 2072 6573 756c 745b  ccount = result[
+0005d8c0: 2263 6861 7469 6e64 6578 225d 2c20 7265  "chatindex"], re
+0005d8d0: 7375 6c74 5b22 6368 6174 636f 756e 7422  sult["chatcount"
+0005d8e0: 5d0d 0a20 2020 2020 2020 2020 2020 2070  ]..            p
+0005d8f0: 6572 6365 6e74 203d 206d 696e 2831 3030  ercent = min(100
+0005d900: 2c20 6d61 7468 2e63 6569 6c28 3130 3020  , math.ceil(100 
+0005d910: 2a20 7574 696c 2e73 6166 6564 6976 6628  * util.safedivf(
+0005d920: 6d69 6e64 6578 2c20 6d63 6f75 6e74 2929  mindex, mcount))
+0005d930: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
+0005d940: 6620 7065 7263 656e 7420 3d3d 2031 3030  f percent == 100
+0005d950: 2061 6e64 206d 696e 6465 7820 3c20 6d63   and mindex < mc
+0005d960: 6f75 6e74 3a20 7065 7263 656e 7420 3d20  ount: percent = 
+0005d970: 3939 0d0a 2020 2020 2020 2020 2020 2020  99..            
+0005d980: 6d73 6720 3d20 2253 6361 6e20 2564 2525  msg = "Scan %d%%
+0005d990: 2063 6f6d 706c 6574 6520 2825 7320 6f66   complete (%s of
+0005d9a0: 2025 7329 2e22 2025 205c 0d0a 2020 2020   %s)." % \..    
+0005d9b0: 2020 2020 2020 2020 2020 2020 2020 2870                (p
+0005d9c0: 6572 6365 6e74 2c20 6369 6e64 6578 202b  ercent, cindex +
+0005d9d0: 2031 2c20 7574 696c 2e70 6c75 7261 6c28   1, util.plural(
+0005d9e0: 2263 6f6e 7665 7273 6174 696f 6e22 2c20  "conversation", 
+0005d9f0: 6363 6f75 6e74 2c20 7365 703d 222c 2229  ccount, sep=",")
+0005da00: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
+0005da10: 656c 662e 7570 6461 7465 5f67 6175 6765  elf.update_gauge
+0005da20: 2873 656c 662e 6761 7567 655f 7072 6f67  (self.gauge_prog
+0005da30: 7265 7373 2c20 7065 7263 656e 742c 206d  ress, percent, m
+0005da40: 7367 290d 0a20 2020 2020 2020 2069 6620  sg)..        if 
+0005da50: 2264 6f6e 6522 2069 6e20 7265 7375 6c74  "done" in result
+0005da60: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+0005da70: 656c 662e 6973 5f73 6361 6e6e 696e 6720  elf.is_scanning 
+0005da80: 3d20 4661 6c73 650d 0a20 2020 2020 2020  = False..       
+0005da90: 2020 2020 2073 656c 662e 6973 5f73 6361       self.is_sca
+0005daa0: 6e6e 6564 203d 2054 7275 650d 0a20 2020  nned = True..   
+0005dab0: 2020 2020 2020 2020 2073 3120 3d20 7574           s1 = ut
+0005dac0: 696c 2e70 6c75 7261 6c28 2264 6966 6665  il.plural("diffe
+0005dad0: 7269 6e67 2063 6861 7422 2c20 7365 6c66  ring chat", self
+0005dae0: 2e63 6861 7473 5f64 6966 6664 6174 6129  .chats_diffdata)
+0005daf0: 0d0a 2020 2020 2020 2020 2020 2020 6775  ..            gu
+0005db00: 6962 6173 652e 7374 6174 7573 2822 466f  ibase.status("Fo
+0005db10: 756e 6420 2573 2069 6e20 2573 2e22 2c20  und %s in %s.", 
+0005db20: 7331 2c20 7365 6c66 2e64 6231 2c20 6c6f  s1, self.db1, lo
+0005db30: 673d 5472 7565 290d 0a20 2020 2020 2020  g=True)..       
+0005db40: 2020 2020 2073 656c 662e 6275 7474 6f6e       self.button
+0005db50: 5f73 7761 702e 456e 6162 6c65 6420 3d20  _swap.Enabled = 
+0005db60: 5472 7565 0d0a 2020 2020 2020 2020 2020  True..          
+0005db70: 2020 7365 6c66 2e62 7574 746f 6e5f 6d65    self.button_me
+0005db80: 7267 655f 6368 6174 732e 456e 6162 6c65  rge_chats.Enable
+0005db90: 6420 3d20 5472 7565 0d0a 2020 2020 2020  d = True..      
+0005dba0: 2020 2020 2020 6966 2073 656c 662e 6368        if self.ch
+0005dbb0: 6174 735f 6469 6666 6461 7461 3a0d 0a20  ats_diffdata:.. 
+0005dbc0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0005dbd0: 6f75 6e74 5f6d 7367 7320 3d20 7574 696c  ount_msgs = util
+0005dbe0: 2e70 6c75 7261 6c28 0d0a 2020 2020 2020  .plural(..      
+0005dbf0: 2020 2020 2020 2020 2020 2020 2020 226d                "m
+0005dc00: 6573 7361 6765 222c 2073 756d 286c 656e  essage", sum(len
+0005dc10: 2864 5b22 6469 6666 225d 5b22 6d65 7373  (d["diff"]["mess
+0005dc20: 6167 6573 225d 290d 0a20 2020 2020 2020  ages"])..       
 0005dc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005dc40: 2020 2020 223c 6272 202f 3e3c 6272 202f      "<br /><br /
-0005dc50: 3e4e 6577 2069 6e20 2573 3a20 2573 2069  >New in %s: %s i
-0005dc60: 6e20 2573 2e22 2025 0d0a 2020 2020 2020  n %s." %..      
-0005dc70: 2020 2020 2020 2020 2020 2020 2020 2873                (s
-0005dc80: 656c 662e 6462 312c 2063 6f75 6e74 5f6d  elf.db1, count_m
-0005dc90: 7367 732c 2063 6f75 6e74 5f63 6861 7473  sgs, count_chats
-0005dca0: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
-0005dcb0: 2020 2020 7363 726f 6c6c 706f 7320 3d20      scrollpos = 
-0005dcc0: 7365 6c66 2e68 746d 6c5f 7265 706f 7274  self.html_report
-0005dcd0: 2e47 6574 5363 726f 6c6c 5261 6e67 6528  .GetScrollRange(
-0005dce0: 7778 2e56 4552 5449 4341 4c29 0d0a 2020  wx.VERTICAL)..  
-0005dcf0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0005dd00: 6c66 2e68 746d 6c5f 7265 706f 7274 2e53  lf.html_report.S
-0005dd10: 6372 6f6c 6c28 302c 2073 6372 6f6c 6c70  croll(0, scrollp
-0005dd20: 6f73 290d 0a20 2020 2020 2020 2020 2020  os)..           
-0005dd30: 2020 2020 2073 656c 662e 6874 6d6c 5f72       self.html_r
-0005dd40: 6570 6f72 742e 5468 6177 2829 0d0a 2020  eport.Thaw()..  
-0005dd50: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
-0005dd60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0005dd70: 2073 656c 662e 6874 6d6c 5f72 6570 6f72   self.html_repor
-0005dd80: 742e 5365 7450 6167 6528 223c 626f 6479  t.SetPage("<body
-0005dd90: 2062 6763 6f6c 6f72 3d27 2573 273e 3c66   bgcolor='%s'><f
-0005dda0: 6f6e 7420 636f 6c6f 723d 2725 7327 3e22  ont color='%s'>"
-0005ddb0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0005ddc0: 2020 2020 2020 224e 6f20 6e65 7720 6d65        "No new me
-0005ddd0: 7373 6167 6573 2e3c 2f66 6f6e 743e 3c2f  ssages.</font></
-0005dde0: 626f 6479 3e22 2025 0d0a 2020 2020 2020  body>" %..      
-0005ddf0: 2020 2020 2020 2020 2020 2020 2020 2863                (c
-0005de00: 6f6e 662e 4d65 7267 6548 746d 6c42 6163  onf.MergeHtmlBac
-0005de10: 6b67 726f 756e 6443 6f6c 6f75 722c 2063  kgroundColour, c
-0005de20: 6f6e 662e 4667 436f 6c6f 7572 2929 0d0a  onf.FgColour))..
-0005de30: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0005de40: 2e75 7064 6174 655f 6761 7567 6528 7365  .update_gauge(se
-0005de50: 6c66 2e67 6175 6765 5f70 726f 6772 6573  lf.gauge_progres
-0005de60: 732c 2031 3030 2c20 2253 6361 6e20 636f  s, 100, "Scan co
-0005de70: 6d70 6c65 7465 2e22 290d 0a20 2020 2020  mplete.")..     
-0005de80: 2020 2020 2020 2077 782e 4265 6c6c 2829         wx.Bell()
-0005de90: 0d0a 0d0a 0d0a 2020 2020 6465 6620 6f6e  ......    def on
-0005dea0: 5f6d 6572 6765 5f61 6c6c 2873 656c 662c  _merge_all(self,
-0005deb0: 2065 7665 6e74 293a 0d0a 2020 2020 2020   event):..      
-0005dec0: 2020 2222 220d 0a20 2020 2020 2020 2048    """..        H
-0005ded0: 616e 646c 6572 2066 6f72 2063 6c69 636b  andler for click
-0005dee0: 696e 6720 746f 2063 6f70 7920 616c 6c20  ing to copy all 
-0005def0: 7468 6520 6469 6666 6572 656e 6365 7320  the differences 
-0005df00: 746f 2074 6865 206f 7468 6572 0d0a 2020  to the other..  
-0005df10: 2020 2020 2020 6461 7461 6261 7365 2c20        database, 
-0005df20: 6173 6b73 2066 6f72 2066 696e 616c 2063  asks for final c
-0005df30: 6f6e 6669 726d 6174 696f 6e20 616e 6420  onfirmation and 
-0005df40: 6578 6563 7574 6573 2e0d 0a20 2020 2020  executes...     
-0005df50: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
-0005df60: 6462 312c 2064 6232 203d 2073 656c 662e  db1, db2 = self.
-0005df70: 6462 312c 2073 656c 662e 6462 320d 0a20  db1, self.db2.. 
-0005df80: 2020 2020 2020 2069 6620 7365 6c66 2e69         if self.i
-0005df90: 735f 7363 616e 6e65 643a 0d0a 2020 2020  s_scanned:..    
-0005dfa0: 2020 2020 2020 2020 636f 756e 745f 6d73          count_ms
-0005dfb0: 6773 203d 2075 7469 6c2e 706c 7572 616c  gs = util.plural
-0005dfc0: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-0005dfd0: 2020 2022 6d65 7373 6167 6522 2c20 7375     "message", su
-0005dfe0: 6d28 6c65 6e28 645b 2264 6966 6622 5d5b  m(len(d["diff"][
-0005dff0: 226d 6573 7361 6765 7322 5d29 0d0a 2020  "messages"])..  
-0005e000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005e010: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-0005e020: 2064 2069 6e20 7365 6c66 2e63 6861 7473   d in self.chats
-0005e030: 5f64 6966 6664 6174 612e 7661 6c75 6573  _diffdata.values
-0005e040: 2829 292c 2073 6570 3d22 2c22 290d 0a20  ()), sep=",").. 
-0005e050: 2020 2020 2020 2020 2020 2063 6f75 6e74             count
-0005e060: 5f63 6861 7473 203d 2075 7469 6c2e 706c  _chats = util.pl
-0005e070: 7572 616c 2822 6368 6174 222c 2073 656c  ural("chat", sel
-0005e080: 662e 6368 6174 735f 6469 6666 6461 7461  f.chats_diffdata
-0005e090: 2c20 7365 703d 222c 2229 0d0a 2020 2020  , sep=",")..    
-0005e0a0: 2020 2020 2020 2020 696e 666f 203d 2022          info = "
-0005e0b0: 2573 2069 6e20 2573 2220 2520 2863 6f75  %s in %s" % (cou
-0005e0c0: 6e74 5f6d 7367 732c 2063 6f75 6e74 5f63  nt_msgs, count_c
-0005e0d0: 6861 7473 290d 0a20 2020 2020 2020 2020  hats)..         
-0005e0e0: 2020 206d 6573 7361 6765 203d 2022 436f     message = "Co
-0005e0f0: 7079 2025 735c 6e5c 6e66 726f 6d20 2573  py %s\n\nfrom %s
-0005e100: 5c6e 5c6e 696e 746f 2025 733f 2220 2520  \n\ninto %s?" % 
-0005e110: 2869 6e66 6f2c 2064 6231 2c20 6462 3229  (info, db1, db2)
-0005e120: 0d0a 2020 2020 2020 2020 2020 2020 7479  ..            ty
-0005e130: 7065 203d 2022 6d65 7267 655f 6c65 6674  pe = "merge_left
-0005e140: 220d 0a20 2020 2020 2020 2020 2020 2063  "..            c
-0005e150: 6861 7473 203d 206c 6973 7428 7365 6c66  hats = list(self
-0005e160: 2e63 6861 7473 5f64 6966 6664 6174 612e  .chats_diffdata.
-0005e170: 7661 6c75 6573 2829 290d 0a20 2020 2020  values())..     
-0005e180: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-0005e190: 2020 2020 2020 696e 666f 203d 2022 616e        info = "an
-0005e1a0: 7920 6469 6666 6572 656e 6365 7322 0d0a  y differences"..
-0005e1b0: 2020 2020 2020 2020 2020 2020 6d65 7373              mess
-0005e1c0: 6167 6520 3d20 2822 5363 616e 2061 6e64  age = ("Scan and
-0005e1d0: 206d 6572 6765 2063 6861 7420 6469 6666   merge chat diff
-0005e1e0: 6572 656e 6365 735c 6e5c 6e66 726f 6d20  erences\n\nfrom 
-0005e1f0: 2573 5c6e 5c6e 696e 746f 2025 733f 220d  %s\n\ninto %s?".
-0005e200: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0005e210: 2020 2020 2020 2020 2520 2864 6231 2c20          % (db1, 
-0005e220: 6462 3229 290d 0a20 2020 2020 2020 2020  db2))..         
-0005e230: 2020 2074 7970 6520 3d20 2264 6966 665f     type = "diff_
-0005e240: 6d65 7267 655f 6c65 6674 220d 0a20 2020  merge_left"..   
-0005e250: 2020 2020 2072 6573 706f 6e73 6520 3d20       response = 
-0005e260: 7778 2e4d 6573 7361 6765 426f 7828 6d65  wx.MessageBox(me
-0005e270: 7373 6167 652c 2063 6f6e 662e 5469 746c  ssage, conf.Titl
-0005e280: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
-0005e290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005e2a0: 2020 2020 2077 782e 4f4b 207c 2077 782e       wx.OK | wx.
-0005e2b0: 4341 4e43 454c 207c 2077 782e 4943 4f4e  CANCEL | wx.ICON
-0005e2c0: 5f49 4e46 4f52 4d41 5449 4f4e 290d 0a20  _INFORMATION).. 
-0005e2d0: 2020 2020 2020 2069 6620 7778 2e4f 4b20         if wx.OK 
-0005e2e0: 3d3d 2072 6573 706f 6e73 653a 0d0a 2020  == response:..  
-0005e2f0: 2020 2020 2020 2020 2020 7365 6c66 2e75            self.u
-0005e300: 7064 6174 655f 6761 7567 6528 7365 6c66  pdate_gauge(self
-0005e310: 2e67 6175 6765 5f70 726f 6772 6573 732c  .gauge_progress,
-0005e320: 2030 2c20 224d 6572 6765 2030 2520 636f   0, "Merge 0% co
-0005e330: 6d70 6c65 7465 2e22 290d 0a20 2020 2020  mplete.")..     
-0005e340: 2020 2020 2020 2073 656c 662e 6275 7474         self.butt
-0005e350: 6f6e 5f73 7761 702e 456e 6162 6c65 6420  on_swap.Enabled 
-0005e360: 3d20 4661 6c73 650d 0a20 2020 2020 2020  = False..       
-0005e370: 2020 2020 2073 656c 662e 6275 7474 6f6e       self.button
-0005e380: 5f6d 6572 6765 5f63 6861 7473 2e45 6e61  _merge_chats.Ena
-0005e390: 626c 6564 203d 2046 616c 7365 0d0a 2020  bled = False..  
-0005e3a0: 2020 2020 2020 2020 2020 7365 6c66 2e62            self.b
-0005e3b0: 7574 746f 6e5f 7363 616e 5f61 6c6c 2e45  utton_scan_all.E
-0005e3c0: 6e61 626c 6564 203d 2073 656c 662e 6275  nabled = self.bu
-0005e3d0: 7474 6f6e 5f6d 6572 6765 5f61 6c6c 2e45  tton_merge_all.E
-0005e3e0: 6e61 626c 6564 203d 2046 616c 7365 0d0a  nabled = False..
-0005e3f0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-0005e400: 6f74 2073 656c 662e 6874 6d6c 5f72 6570  ot self.html_rep
-0005e410: 6f72 742e 5368 6f77 6e3a 0d0a 2020 2020  ort.Shown:..    
-0005e420: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0005e430: 2e68 746d 6c5f 7265 706f 7274 2e53 686f  .html_report.Sho
-0005e440: 7728 290d 0a20 2020 2020 2020 2020 2020  w()..           
-0005e450: 2020 2020 2073 656c 662e 6874 6d6c 5f72       self.html_r
-0005e460: 6570 6f72 742e 436f 6e74 6169 6e69 6e67  eport.Containing
-0005e470: 5369 7a65 722e 4c61 796f 7574 2829 0d0a  Sizer.Layout()..
-0005e480: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0005e490: 2e68 746d 6c5f 7265 706f 7274 2e53 6574  .html_report.Set
-0005e4a0: 5061 6765 2822 3c62 6f64 7920 6267 636f  Page("<body bgco
-0005e4b0: 6c6f 723d 2725 7327 3e3c 666f 6e74 2063  lor='%s'><font c
-0005e4c0: 6f6c 6f72 3d27 2573 273e 3c62 3e4d 6572  olor='%s'><b>Mer
-0005e4d0: 6765 2070 726f 6772 6573 733a 220d 0a20  ge progress:".. 
-0005e4e0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0005e4f0: 3c2f 623e 3c62 7220 2f3e 2220 2520 2863  </b><br />" % (c
-0005e500: 6f6e 662e 4d65 7267 6548 746d 6c42 6163  onf.MergeHtmlBac
-0005e510: 6b67 726f 756e 6443 6f6c 6f75 722c 2063  kgroundColour, c
-0005e520: 6f6e 662e 4667 436f 6c6f 7572 2929 0d0a  onf.FgColour))..
-0005e530: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0005e540: 2e70 6167 655f 6d65 7267 655f 6368 6174  .page_merge_chat
-0005e550: 732e 456e 6162 6c65 6420 3d20 4661 6c73  s.Enabled = Fals
-0005e560: 650d 0a20 2020 2020 2020 2020 2020 2073  e..            s
-0005e570: 656c 662e 7061 6765 5f6d 6572 6765 5f63  elf.page_merge_c
-0005e580: 6f6e 7461 6374 732e 456e 6162 6c65 6420  ontacts.Enabled 
-0005e590: 3d20 4661 6c73 650d 0a20 2020 2020 2020  = False..       
-0005e5a0: 2020 2020 2067 7569 6261 7365 2e73 7461       guibase.sta
-0005e5b0: 7475 7328 224d 6572 6769 6e67 2025 7320  tus("Merging %s 
-0005e5c0: 6672 6f6d 2025 7320 746f 2025 732e 222c  from %s to %s.",
-0005e5d0: 2069 6e66 6f2c 2064 6231 2c20 6462 322c   info, db1, db2,
-0005e5e0: 206c 6f67 3d54 7275 6529 0d0a 2020 2020   log=True)..    
-0005e5f0: 2020 2020 2020 2020 7061 7261 6d73 203d          params =
-0005e600: 206c 6f63 616c 7328 290d 0a20 2020 2020   locals()..     
-0005e610: 2020 2020 2020 2073 656c 662e 776f 726b         self.work
-0005e620: 6572 5f6d 6572 6765 2e77 6f72 6b28 7061  er_merge.work(pa
-0005e630: 7261 6d73 290d 0a20 2020 2020 2020 2020  rams)..         
-0005e640: 2020 2073 656c 662e 6973 5f6d 6572 6769     self.is_mergi
-0005e650: 6e67 203d 2054 7275 650d 0a0d 0a0d 0a20  ng = True...... 
-0005e660: 2020 2064 6566 206f 6e5f 6d65 7267 655f     def on_merge_
-0005e670: 616c 6c5f 7265 7375 6c74 2873 656c 662c  all_result(self,
-0005e680: 2065 7665 6e74 293a 0d0a 2020 2020 2020   event):..      
-0005e690: 2020 2222 220d 0a20 2020 2020 2020 2048    """..        H
-0005e6a0: 616e 646c 6572 2066 6f72 2067 6574 7469  andler for getti
-0005e6b0: 6e67 206d 6572 6765 2072 6573 756c 7473  ng merge results
-0005e6c0: 2066 726f 6d20 776f 726b 6572 2074 6872   from worker thr
-0005e6d0: 6561 642c 2072 6566 7265 7368 6573 2074  ead, refreshes t
-0005e6e0: 6578 7473 0d0a 2020 2020 2020 2020 616e  exts..        an
-0005e6f0: 6420 5549 2063 6f6e 7472 6f6c 732e 0d0a  d UI controls...
-0005e700: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
-0005e710: 2020 2020 2072 6573 756c 7420 3d20 6576       result = ev
-0005e720: 656e 742e 7265 7375 6c74 0d0a 2020 2020  ent.result..    
-0005e730: 2020 2020 6163 7469 6f6e 203d 2028 224d      action = ("M
-0005e740: 6572 6765 2220 6966 2022 6d65 7267 655f  erge" if "merge_
-0005e750: 6c65 6674 2220 3d3d 2072 6573 756c 745b  left" == result[
-0005e760: 2274 7970 6522 5d0d 0a20 2020 2020 2020  "type"]..       
-0005e770: 2020 2020 2020 2020 2020 2065 6c73 6520             else 
-0005e780: 2253 6361 6e20 616e 6420 6d65 7267 6522  "Scan and merge"
-0005e790: 290d 0a20 2020 2020 2020 2069 6620 2269  )..        if "i
-0005e7a0: 6e64 6578 2220 696e 2072 6573 756c 743a  ndex" in result:
-0005e7b0: 0d0a 2020 2020 2020 2020 2020 2020 6d69  ..            mi
-0005e7c0: 6e64 6578 2c20 6d63 6f75 6e74 203d 2072  ndex, mcount = r
-0005e7d0: 6573 756c 745b 2269 6e64 6578 225d 2c20  esult["index"], 
-0005e7e0: 7265 7375 6c74 5b22 636f 756e 7422 5d0d  result["count"].
-0005e7f0: 0a20 2020 2020 2020 2020 2020 2063 696e  .            cin
-0005e800: 6465 782c 2063 636f 756e 7420 3d20 7265  dex, ccount = re
-0005e810: 7375 6c74 5b22 6368 6174 696e 6465 7822  sult["chatindex"
-0005e820: 5d2c 2072 6573 756c 745b 2263 6861 7463  ], result["chatc
-0005e830: 6f75 6e74 225d 0d0a 2020 2020 2020 2020  ount"]..        
-0005e840: 2020 2020 7065 7263 656e 7420 3d20 6d69      percent = mi
-0005e850: 6e28 3130 302c 206d 6174 682e 6365 696c  n(100, math.ceil
-0005e860: 2831 3030 202a 2075 7469 6c2e 7361 6665  (100 * util.safe
-0005e870: 6469 7666 286d 696e 6465 782c 206d 636f  divf(mindex, mco
-0005e880: 756e 7429 2929 0d0a 2020 2020 2020 2020  unt)))..        
-0005e890: 2020 2020 6966 2070 6572 6365 6e74 203d      if percent =
-0005e8a0: 3d20 3130 3020 616e 6420 6d69 6e64 6578  = 100 and mindex
-0005e8b0: 203c 206d 636f 756e 743a 2070 6572 6365   < mcount: perce
-0005e8c0: 6e74 203d 2039 390d 0a20 2020 2020 2020  nt = 99..       
-0005e8d0: 2020 2020 206d 7367 203d 2022 2573 2025       msg = "%s %
-0005e8e0: 6425 2520 636f 6d70 6c65 7465 2028 2573  d%% complete (%s
-0005e8f0: 206f 6620 2573 292e 2220 2520 2861 6374   of %s)." % (act
-0005e900: 696f 6e2c 2070 6572 6365 6e74 2c0d 0a20  ion, percent,.. 
-0005e910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005e920: 2063 696e 6465 782b 312c 2075 7469 6c2e   cindex+1, util.
-0005e930: 706c 7572 616c 2822 636f 6e76 6572 7361  plural("conversa
-0005e940: 7469 6f6e 222c 2063 636f 756e 742c 2073  tion", ccount, s
-0005e950: 6570 3d22 2c22 2929 0d0a 2020 2020 2020  ep=","))..      
-0005e960: 2020 2020 2020 7365 6c66 2e75 7064 6174        self.updat
-0005e970: 655f 6761 7567 6528 7365 6c66 2e67 6175  e_gauge(self.gau
-0005e980: 6765 5f70 726f 6772 6573 732c 2070 6572  ge_progress, per
-0005e990: 6365 6e74 2c20 6d73 6729 0d0a 2020 2020  cent, msg)..    
-0005e9a0: 2020 2020 2020 2020 666f 7220 6368 6174          for chat
-0005e9b0: 2069 6e20 7265 7375 6c74 2e67 6574 2822   in result.get("
-0005e9c0: 6368 6174 7322 2c20 5b5d 293a 0d0a 2020  chats", []):..  
-0005e9d0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0005e9e0: 2063 6861 745b 2269 6465 6e74 6974 7922   chat["identity"
-0005e9f0: 5d20 696e 2073 656c 662e 6368 6174 735f  ] in self.chats_
-0005ea00: 6469 6666 6461 7461 3a0d 0a20 2020 2020  diffdata:..     
-0005ea10: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0005ea20: 656c 2073 656c 662e 6368 6174 735f 6469  el self.chats_di
-0005ea30: 6666 6461 7461 5b63 6861 745b 2269 6465  ffdata[chat["ide
-0005ea40: 6e74 6974 7922 5d5d 0d0a 2020 2020 2020  ntity"]]..      
-0005ea50: 2020 6966 2022 6572 726f 7222 2069 6e20    if "error" in 
-0005ea60: 7265 7375 6c74 3a0d 0a20 2020 2020 2020  result:..       
-0005ea70: 2020 2020 2073 656c 662e 6973 5f6d 6572       self.is_mer
-0005ea80: 6769 6e67 203d 2046 616c 7365 0d0a 2020  ging = False..  
-0005ea90: 2020 2020 2020 2020 2020 7365 6c66 2e75            self.u
-0005eaa0: 7064 6174 655f 6761 7567 6528 7365 6c66  pdate_gauge(self
-0005eab0: 2e67 6175 6765 5f70 726f 6772 6573 732c  .gauge_progress,
-0005eac0: 2030 2c20 2225 7320 6572 726f 722e 2220   0, "%s error." 
-0005ead0: 2520 6163 7469 6f6e 290d 0a20 2020 2020  % action)..     
-0005eae0: 2020 2020 2020 206c 6f67 6765 722e 6572         logger.er
-0005eaf0: 726f 7228 2225 7320 6572 726f 722e 5c6e  ror("%s error.\n
-0005eb00: 5c6e 2573 222c 2061 6374 696f 6e2c 2072  \n%s", action, r
-0005eb10: 6573 756c 745b 2265 7272 6f72 225d 290d  esult["error"]).
-0005eb20: 0a20 2020 2020 2020 2020 2020 206d 7367  .            msg
-0005eb30: 203d 2022 2573 2065 7272 6f72 2e5c 6e5c   = "%s error.\n\
-0005eb40: 6e25 7322 2025 2028 6163 7469 6f6e 2c0d  n%s" % (action,.
-0005eb50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0005eb60: 2020 2072 6573 756c 742e 6765 7428 2265     result.get("e
-0005eb70: 7272 6f72 5f73 686f 7274 222c 2072 6573  rror_short", res
-0005eb80: 756c 745b 2265 7272 6f72 225d 2929 0d0a  ult["error"]))..
-0005eb90: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0005eba0: 2e68 746d 6c5f 7265 706f 7274 2e46 7265  .html_report.Fre
-0005ebb0: 657a 6528 290d 0a20 2020 2020 2020 2020  eze()..         
-0005ebc0: 2020 2073 656c 662e 6874 6d6c 5f72 6570     self.html_rep
-0005ebd0: 6f72 742e 4170 7065 6e64 546f 5061 6765  ort.AppendToPage
-0005ebe0: 2822 3c62 7220 2f3e 3c62 7220 2f3e 203c  ("<br /><br /> <
-0005ebf0: 623e 4572 726f 7220 6d65 7267 696e 6720  b>Error merging 
-0005ec00: 6368 6174 733a 3c2f 623e 266e 6273 703b  chats:</b>&nbsp;
-0005ec10: 266e 6273 703b 220d 0a20 2020 2020 2020  &nbsp;"..       
-0005ec20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005ec30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005ec40: 2020 202b 2072 6573 756c 745b 2265 7272     + result["err
-0005ec50: 6f72 225d 2e72 6570 6c61 6365 2822 3c22  or"].replace("<"
-0005ec60: 2c20 2226 6c74 3b22 290d 0a20 2020 2020  , "&lt;")..     
-0005ec70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005ec80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005ec90: 2020 2020 2020 202e 7265 706c 6163 6528         .replace(
-0005eca0: 2220 222c 2022 266e 6273 703b 2229 2e72  " ", "&nbsp;").r
-0005ecb0: 6570 6c61 6365 2822 5c6e 222c 2022 3c62  eplace("\n", "<b
-0005ecc0: 7220 2f3e 2229 290d 0a20 2020 2020 2020  r />"))..       
-0005ecd0: 2020 2020 2073 6372 6f6c 6c70 6f73 203d       scrollpos =
-0005ece0: 2073 656c 662e 6874 6d6c 5f72 6570 6f72   self.html_repor
-0005ecf0: 742e 4765 7453 6372 6f6c 6c52 616e 6765  t.GetScrollRange
-0005ed00: 2877 782e 5645 5254 4943 414c 290d 0a20  (wx.VERTICAL).. 
-0005ed10: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0005ed20: 6874 6d6c 5f72 6570 6f72 742e 5363 726f  html_report.Scro
-0005ed30: 6c6c 2830 2c20 7363 726f 6c6c 706f 7329  ll(0, scrollpos)
-0005ed40: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-0005ed50: 6c66 2e68 746d 6c5f 7265 706f 7274 2e54  lf.html_report.T
-0005ed60: 6861 7728 290d 0a20 2020 2020 2020 2020  haw()..         
-0005ed70: 2020 2077 782e 4d65 7373 6167 6542 6f78     wx.MessageBox
-0005ed80: 286d 7367 2c20 636f 6e66 2e54 6974 6c65  (msg, conf.Title
-0005ed90: 2c20 7778 2e4f 4b20 7c20 7778 2e49 434f  , wx.OK | wx.ICO
-0005eda0: 4e5f 5741 524e 494e 4729 0d0a 2020 2020  N_WARNING)..    
-0005edb0: 2020 2020 6966 2022 7374 6174 7573 2220      if "status" 
-0005edc0: 696e 2072 6573 756c 743a 0d0a 2020 2020  in result:..    
-0005edd0: 2020 2020 2020 2020 6775 6962 6173 652e          guibase.
-0005ede0: 7374 6174 7573 2872 6573 756c 745b 2273  status(result["s
-0005edf0: 7461 7475 7322 5d29 0d0a 2020 2020 2020  tatus"])..      
-0005ee00: 2020 6966 2022 646f 6e65 2220 696e 2072    if "done" in r
-0005ee10: 6573 756c 743a 0d0a 2020 2020 2020 2020  esult:..        
-0005ee20: 2020 2020 7365 6c66 2e69 735f 6d65 7267      self.is_merg
-0005ee30: 696e 6720 3d20 4661 6c73 650d 0a20 2020  ing = False..   
-0005ee40: 2020 2020 2020 2020 2073 656c 662e 7061           self.pa
-0005ee50: 6765 5f6d 6572 6765 5f63 6861 7473 2e45  ge_merge_chats.E
-0005ee60: 6e61 626c 6564 203d 2054 7275 650d 0a20  nabled = True.. 
-0005ee70: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0005ee80: 7061 6765 5f6d 6572 6765 5f63 6f6e 7461  page_merge_conta
-0005ee90: 6374 732e 456e 6162 6c65 6420 3d20 5472  cts.Enabled = Tr
-0005eea0: 7565 0d0a 2020 2020 2020 2020 2020 2020  ue..            
-0005eeb0: 7365 6c66 2e64 6232 2e63 6c65 6172 5f63  self.db2.clear_c
-0005eec0: 6163 6865 2829 0d0a 2020 2020 2020 2020  ache()..        
-0005eed0: 2020 2020 7365 6c66 2e73 7463 5f64 6966      self.stc_dif
-0005eee0: 6631 2e43 6c65 6172 416c 6c28 290d 0a20  f1.ClearAll().. 
-0005eef0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0005ef00: 6c69 7374 5f63 6861 7473 2e44 656c 6574  list_chats.Delet
-0005ef10: 6541 6c6c 4974 656d 7328 290d 0a20 2020  eAllItems()..   
-0005ef20: 2020 2020 2020 2020 2073 656c 662e 6c69           self.li
-0005ef30: 7374 5f63 6f6e 7461 6374 732e 4465 6c65  st_contacts.Dele
-0005ef40: 7465 416c 6c49 7465 6d73 2829 0d0a 2020  teAllItems()..  
-0005ef50: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
-0005ef60: 6162 656c 5f6d 6572 6765 5f63 6861 742e  abel_merge_chat.
-0005ef70: 4c61 6265 6c20 3d20 2222 0d0a 2020 2020  Label = ""..    
-0005ef80: 2020 2020 2020 2020 7365 6c66 2e63 6861          self.cha
-0005ef90: 7420 3d20 4e6f 6e65 0d0a 2020 2020 2020  t = None..      
-0005efa0: 2020 2020 2020 7365 6c66 2e63 6861 745f        self.chat_
-0005efb0: 6469 6666 203d 204e 6f6e 650d 0a20 2020  diff = None..   
-0005efc0: 2020 2020 2020 2020 2073 656c 662e 6368           self.ch
-0005efd0: 6174 7332 203d 2073 656c 662e 6462 322e  ats2 = self.db2.
-0005efe0: 6765 745f 636f 6e76 6572 7361 7469 6f6e  get_conversation
-0005eff0: 7328 290d 0a20 2020 2020 2020 2020 2020  s()..           
-0005f000: 2069 6e66 6f20 3d20 7265 7375 6c74 5b22   info = result["
-0005f010: 6f75 7470 7574 225d 0d0a 2020 2020 2020  output"]..      
-0005f020: 2020 2020 2020 6966 2022 6572 726f 7222        if "error"
-0005f030: 206e 6f74 2069 6e20 7265 7375 6c74 3a0d   not in result:.
-0005f040: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0005f050: 2067 7569 6261 7365 2e73 7461 7475 7328   guibase.status(
-0005f060: 696e 666f 2c20 6c6f 673d 5472 7565 290d  info, log=True).
-0005f070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0005f080: 2073 656c 662e 7570 6461 7465 5f67 6175   self.update_gau
-0005f090: 6765 2873 656c 662e 6761 7567 655f 7072  ge(self.gauge_pr
-0005f0a0: 6f67 7265 7373 2c20 3130 302c 2022 4d65  ogress, 100, "Me
-0005f0b0: 7267 6520 636f 6d70 6c65 7465 2e22 290d  rge complete.").
-0005f0c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0005f0d0: 2074 6578 7420 3d20 223c 6272 202f 3e3c   text = "<br /><
-0005f0e0: 6272 202f 3e20 2573 2220 2520 7265 7375  br /> %s" % resu
-0005f0f0: 6c74 5b22 6f75 7470 7574 225d 0d0a 2020  lt["output"]..  
-0005f100: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0005f110: 6c66 2e68 746d 6c5f 7265 706f 7274 2e46  lf.html_report.F
-0005f120: 7265 657a 6528 290d 0a20 2020 2020 2020  reeze()..       
-0005f130: 2020 2020 2020 2020 2073 656c 662e 6874           self.ht
-0005f140: 6d6c 5f72 6570 6f72 742e 4170 7065 6e64  ml_report.Append
-0005f150: 546f 5061 6765 2874 6578 7429 0d0a 2020  ToPage(text)..  
-0005f160: 2020 2020 2020 2020 2020 2020 2020 7363                sc
-0005f170: 726f 6c6c 706f 7320 3d20 7365 6c66 2e68  rollpos = self.h
-0005f180: 746d 6c5f 7265 706f 7274 2e47 6574 5363  tml_report.GetSc
-0005f190: 726f 6c6c 5261 6e67 6528 7778 2e56 4552  rollRange(wx.VER
-0005f1a0: 5449 4341 4c29 0d0a 2020 2020 2020 2020  TICAL)..        
-0005f1b0: 2020 2020 2020 2020 7365 6c66 2e68 746d          self.htm
-0005f1c0: 6c5f 7265 706f 7274 2e53 6372 6f6c 6c28  l_report.Scroll(
-0005f1d0: 302c 2073 6372 6f6c 6c70 6f73 290d 0a20  0, scrollpos).. 
-0005f1e0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0005f1f0: 656c 662e 6874 6d6c 5f72 6570 6f72 742e  elf.html_report.
-0005f200: 5468 6177 2829 0d0a 2020 2020 2020 2020  Thaw()..        
-0005f210: 2020 2020 2020 2020 7778 2e4d 6573 7361          wx.Messa
-0005f220: 6765 426f 7828 696e 666f 2c20 636f 6e66  geBox(info, conf
-0005f230: 2e54 6974 6c65 2c20 7778 2e4f 4b20 7c20  .Title, wx.OK | 
-0005f240: 7778 2e49 434f 4e5f 494e 464f 524d 4154  wx.ICON_INFORMAT
-0005f250: 494f 4e29 0d0a 2020 2020 2020 2020 2020  ION)..          
-0005f260: 2020 7365 6c66 2e62 7574 746f 6e5f 6d65    self.button_me
-0005f270: 7267 655f 616c 6c2e 4e6f 7465 203d 2073  rge_all.Note = s
-0005f280: 656c 662e 4d45 5247 455f 4255 5454 4f4e  elf.MERGE_BUTTON
-0005f290: 5f4e 4f54 450d 0a20 2020 2020 2020 2020  _NOTE..         
-0005f2a0: 2020 2073 656c 662e 6275 7474 6f6e 5f73     self.button_s
-0005f2b0: 7761 702e 456e 6162 6c65 6420 3d20 5472  wap.Enabled = Tr
-0005f2c0: 7565 0d0a 2020 2020 2020 2020 2020 2020  ue..            
-0005f2d0: 7365 6c66 2e62 7574 746f 6e5f 6d65 7267  self.button_merg
-0005f2e0: 655f 6368 6174 732e 456e 6162 6c65 6420  e_chats.Enabled 
-0005f2f0: 3d20 5472 7565 0d0a 2020 2020 2020 2020  = True..        
-0005f300: 2020 2020 7778 2e43 616c 6c4c 6174 6572      wx.CallLater
-0005f310: 2832 302c 2073 656c 662e 6c6f 6164 5f6c  (20, self.load_l
-0005f320: 6174 6572 5f64 6174 6129 0d0a 2020 2020  ater_data)..    
-0005f330: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-0005f340: 6973 5f73 6361 6e6e 6564 2061 6e64 2073  is_scanned and s
-0005f350: 656c 662e 6368 6174 735f 6469 6666 6461  elf.chats_diffda
-0005f360: 7461 3a0d 0a20 2020 2020 2020 2020 2020  ta:..           
-0005f370: 2020 2020 2063 6f75 6e74 5f6d 7367 7320       count_msgs 
-0005f380: 3d20 7574 696c 2e70 6c75 7261 6c28 0d0a  = util.plural(..
-0005f390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005f3a0: 2020 2020 226d 6573 7361 6765 222c 2073      "message", s
-0005f3b0: 756d 286c 656e 2864 5b22 6469 6666 225d  um(len(d["diff"]
-0005f3c0: 5b22 6d65 7373 6167 6573 225d 290d 0a20  ["messages"]).. 
-0005f3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005f3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005f3f0: 2020 666f 7220 6420 696e 2073 656c 662e    for d in self.
-0005f400: 6368 6174 735f 6469 6666 6461 7461 2e76  chats_diffdata.v
-0005f410: 616c 7565 7328 2929 2c20 7365 703d 222c  alues()), sep=",
-0005f420: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
-0005f430: 2020 2020 636f 756e 745f 6368 6174 7320      count_chats 
-0005f440: 3d20 7574 696c 2e70 6c75 7261 6c28 2263  = util.plural("c
-0005f450: 6861 7422 2c20 7365 6c66 2e63 6861 7473  hat", self.chats
-0005f460: 5f64 6966 6664 6174 612c 2073 6570 3d22  _diffdata, sep="
-0005f470: 2c22 290d 0a20 2020 2020 2020 2020 2020  ,")..           
-0005f480: 2020 2020 206e 6f74 6569 6e66 6f20 3d20       noteinfo = 
-0005f490: 2225 7320 6672 6f6d 2025 7322 2025 2028  "%s from %s" % (
-0005f4a0: 636f 756e 745f 6d73 6773 2c20 636f 756e  count_msgs, coun
-0005f4b0: 745f 6368 6174 7329 0d0a 2020 2020 2020  t_chats)..      
-0005f4c0: 2020 2020 2020 2020 2020 7365 6c66 2e62            self.b
-0005f4d0: 7574 746f 6e5f 6d65 7267 655f 616c 6c2e  utton_merge_all.
-0005f4e0: 4e6f 7465 203d 2028 0d0a 2020 2020 2020  Note = (..      
-0005f4f0: 2020 2020 2020 2020 2020 2020 2020 2243                "C
-0005f500: 6f70 7920 2573 2074 6f20 7468 6520 6461  opy %s to the da
-0005f510: 7461 6261 7365 206f 6e20 7468 6520 7269  tabase on the ri
-0005f520: 6768 742e 2220 2520 6e6f 7465 696e 666f  ght." % noteinfo
-0005f530: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0005f540: 2020 2073 656c 662e 6275 7474 6f6e 5f6d     self.button_m
-0005f550: 6572 6765 5f61 6c6c 2e45 6e61 626c 6564  erge_all.Enabled
-0005f560: 203d 2054 7275 650d 0a20 2020 2020 2020   = True..       
-0005f570: 2065 6c69 6620 226f 7574 7075 7422 2069   elif "output" i
-0005f580: 6e20 7265 7375 6c74 2061 6e64 2072 6573  n result and res
-0005f590: 756c 745b 226f 7574 7075 7422 5d3a 0d0a  ult["output"]:..
-0005f5a0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0005f5b0: 2e68 746d 6c5f 7265 706f 7274 2e41 7070  .html_report.App
-0005f5c0: 656e 6454 6f50 6167 6528 223c 6272 202f  endToPage("<br /
-0005f5d0: 3e20 2573 2220 2520 7265 7375 6c74 5b22  > %s" % result["
-0005f5e0: 6f75 7470 7574 225d 290d 0a0d 0a0d 0a20  output"])...... 
-0005f5f0: 2020 2064 6566 2075 7064 6174 655f 6761     def update_ga
-0005f600: 7567 6528 7365 6c66 2c20 6761 7567 652c  uge(self, gauge,
-0005f610: 2076 616c 7565 2c20 6d65 7373 6167 653d   value, message=
-0005f620: 2222 293a 0d0a 2020 2020 2020 2020 2222  ""):..        ""
-0005f630: 220d 0a20 2020 2020 2020 2055 7064 6174  "..        Updat
-0005f640: 6573 2074 6865 2067 6175 6765 2076 616c  es the gauge val
-0005f650: 7565 2061 6e64 206d 6573 7361 6765 206f  ue and message o
-0005f660: 6e20 7061 6765 5f6d 6572 6765 5f61 6c6c  n page_merge_all
-0005f670: 2e20 4966 2076 616c 7565 2069 730d 0a20  . If value is.. 
-0005f680: 2020 2020 2020 204e 6f6e 652c 2068 6964         None, hid
-0005f690: 6573 2067 6175 6765 2070 616e 656c 2e0d  es gauge panel..
-0005f6a0: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
-0005f6b0: 2020 2020 2020 6966 2076 616c 7565 2069        if value i
-0005f6c0: 7320 4e6f 6e65 3a0d 0a20 2020 2020 2020  s None:..       
-0005f6d0: 2020 2020 2067 6175 6765 2e48 6964 6528       gauge.Hide(
-0005f6e0: 290d 0a20 2020 2020 2020 2065 6c73 653a  )..        else:
-0005f6f0: 0d0a 2020 2020 2020 2020 2020 2020 6761  ..            ga
-0005f700: 7567 652e 5661 6c75 6520 3d20 7661 6c75  uge.Value = valu
-0005f710: 650d 0a20 2020 2020 2020 2020 2020 2066  e..            f
-0005f720: 6f72 2063 2069 6e20 6761 7567 652e 5061  or c in gauge.Pa
-0005f730: 7265 6e74 2e43 6869 6c64 7265 6e3a 0d0a  rent.Children:..
-0005f740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005f750: 6966 2069 7369 6e73 7461 6e63 6528 632c  if isinstance(c,
-0005f760: 2077 782e 5374 6174 6963 5465 7874 293a   wx.StaticText):
-0005f770: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0005f780: 2020 2020 2020 632e 4c61 6265 6c20 3d20        c.Label = 
-0005f790: 6d65 7373 6167 650d 0a20 2020 2020 2020  message..       
-0005f7a0: 2020 2020 2020 2020 2020 2020 2062 7265               bre
-0005f7b0: 616b 2023 2066 6f72 2063 0d0a 2020 2020  ak # for c..    
-0005f7c0: 2020 2020 2020 2020 6761 7567 652e 5061          gauge.Pa
-0005f7d0: 7265 6e74 2e53 697a 6572 2e4c 6179 6f75  rent.Sizer.Layou
-0005f7e0: 7428 290d 0a20 2020 2020 2020 2020 2020  t()..           
-0005f7f0: 2069 6620 6e6f 7420 6761 7567 652e 5061   if not gauge.Pa
-0005f800: 7265 6e74 2e53 686f 776e 3a0d 0a20 2020  rent.Shown:..   
-0005f810: 2020 2020 2020 2020 2020 2020 2067 6175               gau
-0005f820: 6765 2e50 6172 656e 742e 5368 6f77 2829  ge.Parent.Show()
-0005f830: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0005f840: 2020 6761 7567 652e 5061 7265 6e74 2e43    gauge.Parent.C
-0005f850: 6f6e 7461 696e 696e 6753 697a 6572 2e4c  ontainingSizer.L
-0005f860: 6179 6f75 7428 290d 0a0d 0a0d 0a20 2020  ayout()......   
-0005f870: 2064 6566 206f 6e5f 6d65 7267 655f 6368   def on_merge_ch
-0005f880: 6174 2873 656c 662c 2065 7665 6e74 293a  at(self, event):
-0005f890: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
-0005f8a0: 2020 2020 2020 2048 616e 646c 6572 2066         Handler f
-0005f8b0: 6f72 2063 6c69 636b 696e 6720 746f 206d  or clicking to m
-0005f8c0: 6572 6765 2061 2063 6861 7420 6672 6f6d  erge a chat from
-0005f8d0: 206c 6566 7420 7369 6465 2064 6220 746f   left side db to
-0005f8e0: 2074 6865 2072 6967 6874 0d0a 2020 2020   the right..    
-0005f8f0: 2020 2020 7369 6465 2064 622e 0d0a 2020      side db...  
-0005f900: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
-0005f910: 2020 2069 6620 7365 6c66 2e69 735f 7363     if self.is_sc
-0005f920: 616e 6e69 6e67 206f 7220 7365 6c66 2e69  anning or self.i
-0005f930: 735f 6d65 7267 696e 673a 0d0a 2020 2020  s_merging:..    
-0005f940: 2020 2020 2020 2020 7778 2e4d 6573 7361          wx.Messa
-0005f950: 6765 426f 7828 2247 6c6f 6261 6c20 2528  geBox("Global %(
-0005f960: 7429 7320 6973 2063 7572 7265 6e74 6c79  t)s is currently
-0005f970: 2075 6e64 6572 7761 793a 2073 696e 676c   underway: singl
-0005f980: 6520 6368 6174 2022 0d0a 2020 2020 2020  e chat "..      
-0005f990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005f9a0: 2020 2020 226d 6572 6765 2074 656d 706f      "merge tempo
-0005f9b0: 7261 7269 6c79 2064 6973 6162 6c65 6420  rarily disabled 
-0005f9c0: 666f 7220 6461 7461 2073 6166 6574 792e  for data safety.
-0005f9d0: 5c6e 5c6e 220d 0a20 2020 2020 2020 2020  \n\n"..         
-0005f9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005f9f0: 2022 506c 6561 7365 2077 6169 7420 756e   "Please wait un
-0005fa00: 7469 6c20 7468 6520 676c 6f62 616c 2025  til the global %
-0005fa10: 2874 2973 2069 7320 6669 6e69 7368 6564  (t)s is finished
-0005fa20: 2e22 0d0a 2020 2020 2020 2020 2020 2020  ."..            
-0005fa30: 2020 2020 2020 2020 2020 2020 2020 2520                % 
-0005fa40: 7b22 7422 3a20 226d 6572 6765 2220 6966  {"t": "merge" if
-0005fa50: 2073 656c 662e 6973 5f6d 6572 6769 6e67   self.is_merging
-0005fa60: 2065 6c73 6520 2273 6361 6e22 7d2c 0d0a   else "scan"},..
-0005fa70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005fa80: 2020 2020 2020 2020 2020 636f 6e66 2e54            conf.T
-0005fa90: 6974 6c65 2c20 7778 2e4f 4b20 7c20 7778  itle, wx.OK | wx
-0005faa0: 2e49 434f 4e5f 5741 524e 494e 4729 0d0a  .ICON_WARNING)..
-0005fab0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0005fac0: 726e 0d0a 2020 2020 2020 2020 6462 312c  rn..        db1,
-0005fad0: 2064 6232 203d 2073 656c 662e 6462 312c   db2 = self.db1,
-0005fae0: 2073 656c 662e 6462 320d 0a20 2020 2020   self.db2..     
-0005faf0: 2020 2063 6861 742c 2063 6861 7432 203d     chat, chat2 =
-0005fb00: 2073 656c 662e 6368 6174 5b22 6331 225d   self.chat["c1"]
-0005fb10: 2c20 7365 6c66 2e63 6861 745b 2263 3222  , self.chat["c2"
-0005fb20: 5d0d 0a20 2020 2020 2020 206d 6573 7361  ]..        messa
-0005fb30: 6765 7320 3d20 7365 6c66 2e63 6861 745f  ges = self.chat_
-0005fb40: 6469 6666 5b22 6d65 7373 6167 6573 225d  diff["messages"]
-0005fb50: 0d0a 2020 2020 2020 2020 7061 7274 6963  ..        partic
-0005fb60: 6970 616e 7473 203d 2073 656c 662e 6368  ipants = self.ch
-0005fb70: 6174 5f64 6966 665b 2270 6172 7469 6369  at_diff["partici
-0005fb80: 7061 6e74 7322 5d0d 0a20 2020 2020 2020  pants"]..       
-0005fb90: 2063 6f6e 6469 6666 203d 2073 656c 662e   condiff = self.
-0005fba0: 636f 6e31 6469 6666 0d0a 2020 2020 2020  con1diff..      
-0005fbb0: 2020 636f 6e74 6163 7473 3220 3d20 5b5d    contacts2 = []
-0005fbc0: 0d0a 0d0a 2020 2020 2020 2020 6966 206d  ....        if m
-0005fbd0: 6573 7361 6765 7320 6f72 2070 6172 7469  essages or parti
-0005fbe0: 6369 7061 6e74 733a 0d0a 2020 2020 2020  cipants:..      
-0005fbf0: 2020 2020 2020 696e 666f 203d 2022 220d        info = "".
-0005fc00: 0a20 2020 2020 2020 2020 2020 2070 6172  .            par
-0005fc10: 7473 203d 205b 5d0d 0a20 2020 2020 2020  ts = []..       
-0005fc20: 2020 2020 206e 6577 5f63 6861 7420 3d20       new_chat = 
-0005fc30: 6e6f 7420 6368 6174 320d 0a20 2020 2020  not chat2..     
-0005fc40: 2020 2020 2020 206e 6577 7374 7220 3d20         newstr = 
-0005fc50: 2222 2069 6620 6e65 775f 6368 6174 2065  "" if new_chat e
-0005fc60: 6c73 6520 226e 6577 2022 0d0a 2020 2020  lse "new "..    
-0005fc70: 2020 2020 2020 2020 6966 206e 6577 5f63          if new_c
-0005fc80: 6861 743a 0d0a 2020 2020 2020 2020 2020  hat:..          
-0005fc90: 2020 2020 2020 696e 666f 202b 3d20 226e        info += "n
-0005fca0: 6577 2063 6861 7420 7769 7468 2022 0d0a  ew chat with "..
-0005fcb0: 2020 2020 2020 2020 2020 2020 6966 206d              if m
-0005fcc0: 6573 7361 6765 733a 0d0a 2020 2020 2020  essages:..      
-0005fcd0: 2020 2020 2020 2020 2020 7061 7274 732e            parts.
-0005fce0: 6170 7065 6e64 2875 7469 6c2e 706c 7572  append(util.plur
-0005fcf0: 616c 2822 2573 6d65 7373 6167 6522 2025  al("%smessage" %
-0005fd00: 206e 6577 7374 722c 206d 6573 7361 6765   newstr, message
-0005fd10: 732c 2073 6570 3d22 2c22 2929 0d0a 2020  s, sep=","))..  
-0005fd20: 2020 2020 2020 2020 2020 6966 2070 6172            if par
-0005fd30: 7469 6369 7061 6e74 733a 0d0a 2020 2020  ticipants:..    
-0005fd40: 2020 2020 2020 2020 2020 2020 2320 4164              # Ad
-0005fd50: 6420 746f 2063 6f6e 7461 6374 7320 7468  d to contacts th
-0005fd60: 6f73 6520 7468 6174 2061 7265 206e 6577  ose that are new
-0005fd70: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0005fd80: 2020 6363 3220 3d20 5b64 6231 2e69 642c    cc2 = [db1.id,
-0005fd90: 2064 6232 2e69 645d 202b 205c 0d0a 2020   db2.id] + \..  
-0005fda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005fdb0: 2020 5b69 5b22 6964 656e 7469 7479 225d    [i["identity"]
-0005fdc0: 2066 6f72 2069 2069 6e20 6462 322e 6765   for i in db2.ge
-0005fdd0: 745f 636f 6e74 6163 7473 2829 5d0d 0a20  t_contacts()].. 
-0005fde0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0005fdf0: 6f6e 7461 6374 7332 203d 205b 695b 2263  ontacts2 = [i["c
-0005fe00: 6f6e 7461 6374 225d 2066 6f72 2069 2069  ontact"] for i i
-0005fe10: 6e20 7061 7274 6963 6970 616e 7473 0d0a  n participants..
-0005fe20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005fe30: 2020 2020 6966 2022 6964 2220 696e 2069      if "id" in i
-0005fe40: 5b22 636f 6e74 6163 7422 5d20 616e 6420  ["contact"] and 
-0005fe50: 695b 2269 6465 6e74 6974 7922 5d20 6e6f  i["identity"] no
-0005fe60: 7420 696e 2063 6332 5d0d 0a20 2020 2020  t in cc2]..     
-0005fe70: 2020 2020 2020 2020 2020 2069 6620 636f             if co
-0005fe80: 6e74 6163 7473 323a 0d0a 2020 2020 2020  ntacts2:..      
-0005fe90: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-0005fea0: 7274 732e 6170 7065 6e64 2875 7469 6c2e  rts.append(util.
-0005feb0: 706c 7572 616c 2822 6e65 7720 636f 6e74  plural("new cont
-0005fec0: 6163 7422 2c20 636f 6e74 6163 7473 322c  act", contacts2,
-0005fed0: 2073 6570 3d22 2c22 2929 0d0a 2020 2020   sep=","))..    
-0005fee0: 2020 2020 2020 2020 2020 2020 7061 7274              part
-0005fef0: 732e 6170 7065 6e64 2875 7469 6c2e 706c  s.append(util.pl
-0005ff00: 7572 616c 2822 2573 7061 7274 6963 6970  ural("%sparticip
-0005ff10: 616e 7422 2025 206e 6577 7374 722c 0d0a  ant" % newstr,..
-0005ff20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005ff30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005ff40: 2020 2020 2020 2020 2070 6172 7469 6369           partici
-0005ff50: 7061 6e74 732c 2073 6570 3d22 2c22 2929  pants, sep=","))
-0005ff60: 0d0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
-0005ff70: 7220 6920 696e 2070 6172 7473 3a0d 0a20  r i in parts:.. 
-0005ff80: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0005ff90: 6e66 6f20 2b3d 2028 2222 2069 6620 6920  nfo += ("" if i 
-0005ffa0: 3d3d 2070 6172 7473 5b30 5d20 656c 7365  == parts[0] else
-0005ffb0: 2028 0d0a 2020 2020 2020 2020 2020 2020   (..            
-0005ffc0: 2020 2020 2020 2020 2020 2020 2022 2061               " a
-0005ffd0: 6e64 2022 2069 6620 6920 3d3d 2070 6172  nd " if i == par
-0005ffe0: 7473 5b2d 315d 2065 6c73 6520 222c 2022  ts[-1] else ", "
-0005fff0: 2929 202b 2069 0d0a 0d0a 2020 2020 2020  )) + i....      
-00060000: 2020 2020 2020 7072 6f63 6565 6420 3d20        proceed = 
-00060010: 7778 2e4f 4b20 3d3d 2077 782e 4d65 7373  wx.OK == wx.Mess
-00060020: 6167 6542 6f78 280d 0a20 2020 2020 2020  ageBox(..       
-00060030: 2020 2020 2020 2020 2022 436f 7079 2025           "Copy %
-00060040: 735c 6e5c 6e66 726f 6d20 2573 5c6e 5c6e  s\n\nfrom %s\n\n
-00060050: 696e 746f 2025 733f 2220 2520 2869 6e66  into %s?" % (inf
-00060060: 6f2c 2064 6231 2c20 6462 3229 2c0d 0a20  o, db1, db2),.. 
-00060070: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00060080: 6f6e 662e 5469 746c 652c 2077 782e 4f4b  onf.Title, wx.OK
-00060090: 207c 2077 782e 4341 4e43 454c 207c 2077   | wx.CANCEL | w
-000600a0: 782e 4943 4f4e 5f49 4e46 4f52 4d41 5449  x.ICON_INFORMATI
-000600b0: 4f4e 290d 0a20 2020 2020 2020 2020 2020  ON)..           
-000600c0: 2069 6620 7072 6f63 6565 643a 0d0a 2020   if proceed:..  
-000600d0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-000600e0: 6c66 2e69 735f 6d65 7267 696e 6720 3d20  lf.is_merging = 
-000600f0: 5472 7565 0d0a 2020 2020 2020 2020 2020  True..          
-00060100: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
+0005dc40: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0005dc50: 6420 696e 2073 656c 662e 6368 6174 735f  d in self.chats_
+0005dc60: 6469 6666 6461 7461 2e76 616c 7565 7328  diffdata.values(
+0005dc70: 2929 2c20 7365 703d 222c 2229 0d0a 2020  )), sep=",")..  
+0005dc80: 2020 2020 2020 2020 2020 2020 2020 636f                co
+0005dc90: 756e 745f 6368 6174 7320 3d20 7574 696c  unt_chats = util
+0005dca0: 2e70 6c75 7261 6c28 2263 6861 7422 2c20  .plural("chat", 
+0005dcb0: 7365 6c66 2e63 6861 7473 5f64 6966 6664  self.chats_diffd
+0005dcc0: 6174 612c 2073 6570 3d22 2c22 290d 0a20  ata, sep=",").. 
+0005dcd0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+0005dce0: 6f74 6569 6e66 6f20 3d20 2225 7320 6672  oteinfo = "%s fr
+0005dcf0: 6f6d 2025 7322 2025 2028 636f 756e 745f  om %s" % (count_
+0005dd00: 6d73 6773 2c20 636f 756e 745f 6368 6174  msgs, count_chat
+0005dd10: 7329 0d0a 2020 2020 2020 2020 2020 2020  s)..            
+0005dd20: 2020 2020 7365 6c66 2e62 7574 746f 6e5f      self.button_
+0005dd30: 6d65 7267 655f 616c 6c2e 4e6f 7465 203d  merge_all.Note =
+0005dd40: 2028 0d0a 2020 2020 2020 2020 2020 2020   (..            
+0005dd50: 2020 2020 2020 2020 2243 6f70 7920 2573          "Copy %s
+0005dd60: 2074 6f20 7468 6520 6461 7461 6261 7365   to the database
+0005dd70: 206f 6e20 7468 6520 7269 6768 742e 2220   on the right." 
+0005dd80: 2520 6e6f 7465 696e 666f 290d 0a20 2020  % noteinfo)..   
+0005dd90: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0005dda0: 662e 6275 7474 6f6e 5f6d 6572 6765 5f61  f.button_merge_a
+0005ddb0: 6c6c 2e45 6e61 626c 6564 203d 2054 7275  ll.Enabled = Tru
+0005ddc0: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
+0005ddd0: 2020 2073 656c 662e 6874 6d6c 5f72 6570     self.html_rep
+0005dde0: 6f72 742e 4672 6565 7a65 2829 0d0a 2020  ort.Freeze()..  
+0005ddf0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0005de00: 6c66 2e68 746d 6c5f 7265 706f 7274 2e41  lf.html_report.A
+0005de10: 7070 656e 6454 6f50 6167 6528 0d0a 2020  ppendToPage(..  
+0005de20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005de30: 2020 223c 6272 202f 3e3c 6272 202f 3e4e    "<br /><br />N
+0005de40: 6577 2069 6e20 2573 3a20 2573 2069 6e20  ew in %s: %s in 
+0005de50: 2573 2e22 2025 0d0a 2020 2020 2020 2020  %s." %..        
+0005de60: 2020 2020 2020 2020 2020 2020 2873 656c              (sel
+0005de70: 662e 6462 312c 2063 6f75 6e74 5f6d 7367  f.db1, count_msg
+0005de80: 732c 2063 6f75 6e74 5f63 6861 7473 2929  s, count_chats))
+0005de90: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0005dea0: 2020 7363 726f 6c6c 706f 7320 3d20 7365    scrollpos = se
+0005deb0: 6c66 2e68 746d 6c5f 7265 706f 7274 2e47  lf.html_report.G
+0005dec0: 6574 5363 726f 6c6c 5261 6e67 6528 7778  etScrollRange(wx
+0005ded0: 2e56 4552 5449 4341 4c29 0d0a 2020 2020  .VERTICAL)..    
+0005dee0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0005def0: 2e68 746d 6c5f 7265 706f 7274 2e53 6372  .html_report.Scr
+0005df00: 6f6c 6c28 302c 2073 6372 6f6c 6c70 6f73  oll(0, scrollpos
+0005df10: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0005df20: 2020 2073 656c 662e 6874 6d6c 5f72 6570     self.html_rep
+0005df30: 6f72 742e 5468 6177 2829 0d0a 2020 2020  ort.Thaw()..    
+0005df40: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+0005df50: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0005df60: 656c 662e 6874 6d6c 5f72 6570 6f72 742e  elf.html_report.
+0005df70: 5365 7450 6167 6528 223c 626f 6479 2062  SetPage("<body b
+0005df80: 6763 6f6c 6f72 3d27 2573 273e 3c66 6f6e  gcolor='%s'><fon
+0005df90: 7420 636f 6c6f 723d 2725 7327 3e22 0d0a  t color='%s'>"..
+0005dfa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005dfb0: 2020 2020 224e 6f20 6e65 7720 6d65 7373      "No new mess
+0005dfc0: 6167 6573 2e3c 2f66 6f6e 743e 3c2f 626f  ages.</font></bo
+0005dfd0: 6479 3e22 2025 0d0a 2020 2020 2020 2020  dy>" %..        
+0005dfe0: 2020 2020 2020 2020 2020 2020 2863 6f6e              (con
+0005dff0: 662e 4d65 7267 6548 746d 6c42 6163 6b67  f.MergeHtmlBackg
+0005e000: 726f 756e 6443 6f6c 6f75 722c 2063 6f6e  roundColour, con
+0005e010: 662e 4667 436f 6c6f 7572 2929 0d0a 2020  f.FgColour))..  
+0005e020: 2020 2020 2020 2020 2020 7365 6c66 2e75            self.u
+0005e030: 7064 6174 655f 6761 7567 6528 7365 6c66  pdate_gauge(self
+0005e040: 2e67 6175 6765 5f70 726f 6772 6573 732c  .gauge_progress,
+0005e050: 2031 3030 2c20 2253 6361 6e20 636f 6d70   100, "Scan comp
+0005e060: 6c65 7465 2e22 290d 0a20 2020 2020 2020  lete.")..       
+0005e070: 2020 2020 2077 782e 4265 6c6c 2829 0d0a       wx.Bell()..
+0005e080: 0d0a 0d0a 2020 2020 6465 6620 6f6e 5f6d  ....    def on_m
+0005e090: 6572 6765 5f61 6c6c 2873 656c 662c 2065  erge_all(self, e
+0005e0a0: 7665 6e74 293a 0d0a 2020 2020 2020 2020  vent):..        
+0005e0b0: 2222 220d 0a20 2020 2020 2020 2048 616e  """..        Han
+0005e0c0: 646c 6572 2066 6f72 2063 6c69 636b 696e  dler for clickin
+0005e0d0: 6720 746f 2063 6f70 7920 616c 6c20 7468  g to copy all th
+0005e0e0: 6520 6469 6666 6572 656e 6365 7320 746f  e differences to
+0005e0f0: 2074 6865 206f 7468 6572 0d0a 2020 2020   the other..    
+0005e100: 2020 2020 6461 7461 6261 7365 2c20 6173      database, as
+0005e110: 6b73 2066 6f72 2066 696e 616c 2063 6f6e  ks for final con
+0005e120: 6669 726d 6174 696f 6e20 616e 6420 6578  firmation and ex
+0005e130: 6563 7574 6573 2e0d 0a20 2020 2020 2020  ecutes...       
+0005e140: 2022 2222 0d0a 2020 2020 2020 2020 6462   """..        db
+0005e150: 312c 2064 6232 203d 2073 656c 662e 6462  1, db2 = self.db
+0005e160: 312c 2073 656c 662e 6462 320d 0a20 2020  1, self.db2..   
+0005e170: 2020 2020 2069 6620 7365 6c66 2e69 735f       if self.is_
+0005e180: 7363 616e 6e65 643a 0d0a 2020 2020 2020  scanned:..      
+0005e190: 2020 2020 2020 636f 756e 745f 6d73 6773        count_msgs
+0005e1a0: 203d 2075 7469 6c2e 706c 7572 616c 280d   = util.plural(.
+0005e1b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0005e1c0: 2022 6d65 7373 6167 6522 2c20 7375 6d28   "message", sum(
+0005e1d0: 6c65 6e28 645b 2264 6966 6622 5d5b 226d  len(d["diff"]["m
+0005e1e0: 6573 7361 6765 7322 5d29 0d0a 2020 2020  essages"])..    
+0005e1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005e200: 2020 2020 2020 2020 2020 2066 6f72 2064             for d
+0005e210: 2069 6e20 7365 6c66 2e63 6861 7473 5f64   in self.chats_d
+0005e220: 6966 6664 6174 612e 7661 6c75 6573 2829  iffdata.values()
+0005e230: 292c 2073 6570 3d22 2c22 290d 0a20 2020  ), sep=",")..   
+0005e240: 2020 2020 2020 2020 2063 6f75 6e74 5f63           count_c
+0005e250: 6861 7473 203d 2075 7469 6c2e 706c 7572  hats = util.plur
+0005e260: 616c 2822 6368 6174 222c 2073 656c 662e  al("chat", self.
+0005e270: 6368 6174 735f 6469 6666 6461 7461 2c20  chats_diffdata, 
+0005e280: 7365 703d 222c 2229 0d0a 2020 2020 2020  sep=",")..      
+0005e290: 2020 2020 2020 696e 666f 203d 2022 2573        info = "%s
+0005e2a0: 2069 6e20 2573 2220 2520 2863 6f75 6e74   in %s" % (count
+0005e2b0: 5f6d 7367 732c 2063 6f75 6e74 5f63 6861  _msgs, count_cha
+0005e2c0: 7473 290d 0a20 2020 2020 2020 2020 2020  ts)..           
+0005e2d0: 206d 6573 7361 6765 203d 2022 436f 7079   message = "Copy
+0005e2e0: 2025 735c 6e5c 6e66 726f 6d20 2573 5c6e   %s\n\nfrom %s\n
+0005e2f0: 5c6e 696e 746f 2025 733f 2220 2520 2869  \ninto %s?" % (i
+0005e300: 6e66 6f2c 2064 6231 2c20 6462 3229 0d0a  nfo, db1, db2)..
+0005e310: 2020 2020 2020 2020 2020 2020 7479 7065              type
+0005e320: 203d 2022 6d65 7267 655f 6c65 6674 220d   = "merge_left".
+0005e330: 0a20 2020 2020 2020 2020 2020 2063 6861  .            cha
+0005e340: 7473 203d 206c 6973 7428 7365 6c66 2e63  ts = list(self.c
+0005e350: 6861 7473 5f64 6966 6664 6174 612e 7661  hats_diffdata.va
+0005e360: 6c75 6573 2829 290d 0a20 2020 2020 2020  lues())..       
+0005e370: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+0005e380: 2020 2020 696e 666f 203d 2022 616e 7920      info = "any 
+0005e390: 6469 6666 6572 656e 6365 7322 0d0a 2020  differences"..  
+0005e3a0: 2020 2020 2020 2020 2020 6d65 7373 6167            messag
+0005e3b0: 6520 3d20 2822 5363 616e 2061 6e64 206d  e = ("Scan and m
+0005e3c0: 6572 6765 2063 6861 7420 6469 6666 6572  erge chat differ
+0005e3d0: 656e 6365 735c 6e5c 6e66 726f 6d20 2573  ences\n\nfrom %s
+0005e3e0: 5c6e 5c6e 696e 746f 2025 733f 220d 0a20  \n\ninto %s?".. 
+0005e3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005e400: 2020 2020 2020 2520 2864 6231 2c20 6462        % (db1, db
+0005e410: 3229 290d 0a20 2020 2020 2020 2020 2020  2))..           
+0005e420: 2074 7970 6520 3d20 2264 6966 665f 6d65   type = "diff_me
+0005e430: 7267 655f 6c65 6674 220d 0a20 2020 2020  rge_left"..     
+0005e440: 2020 2072 6573 706f 6e73 6520 3d20 7778     response = wx
+0005e450: 2e4d 6573 7361 6765 426f 7828 6d65 7373  .MessageBox(mess
+0005e460: 6167 652c 2063 6f6e 662e 5469 746c 652c  age, conf.Title,
+0005e470: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0005e480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005e490: 2020 2077 782e 4f4b 207c 2077 782e 4341     wx.OK | wx.CA
+0005e4a0: 4e43 454c 207c 2077 782e 4943 4f4e 5f49  NCEL | wx.ICON_I
+0005e4b0: 4e46 4f52 4d41 5449 4f4e 290d 0a20 2020  NFORMATION)..   
+0005e4c0: 2020 2020 2069 6620 7778 2e4f 4b20 3d3d       if wx.OK ==
+0005e4d0: 2072 6573 706f 6e73 653a 0d0a 2020 2020   response:..    
+0005e4e0: 2020 2020 2020 2020 7365 6c66 2e75 7064          self.upd
+0005e4f0: 6174 655f 6761 7567 6528 7365 6c66 2e67  ate_gauge(self.g
+0005e500: 6175 6765 5f70 726f 6772 6573 732c 2030  auge_progress, 0
+0005e510: 2c20 224d 6572 6765 2030 2520 636f 6d70  , "Merge 0% comp
+0005e520: 6c65 7465 2e22 290d 0a20 2020 2020 2020  lete.")..       
+0005e530: 2020 2020 2073 656c 662e 6275 7474 6f6e       self.button
+0005e540: 5f73 7761 702e 456e 6162 6c65 6420 3d20  _swap.Enabled = 
+0005e550: 4661 6c73 650d 0a20 2020 2020 2020 2020  False..         
+0005e560: 2020 2073 656c 662e 6275 7474 6f6e 5f6d     self.button_m
+0005e570: 6572 6765 5f63 6861 7473 2e45 6e61 626c  erge_chats.Enabl
+0005e580: 6564 203d 2046 616c 7365 0d0a 2020 2020  ed = False..    
+0005e590: 2020 2020 2020 2020 7365 6c66 2e62 7574          self.but
+0005e5a0: 746f 6e5f 7363 616e 5f61 6c6c 2e45 6e61  ton_scan_all.Ena
+0005e5b0: 626c 6564 203d 2073 656c 662e 6275 7474  bled = self.butt
+0005e5c0: 6f6e 5f6d 6572 6765 5f61 6c6c 2e45 6e61  on_merge_all.Ena
+0005e5d0: 626c 6564 203d 2046 616c 7365 0d0a 2020  bled = False..  
+0005e5e0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+0005e5f0: 2073 656c 662e 6874 6d6c 5f72 6570 6f72   self.html_repor
+0005e600: 742e 5368 6f77 6e3a 0d0a 2020 2020 2020  t.Shown:..      
+0005e610: 2020 2020 2020 2020 2020 7365 6c66 2e68            self.h
+0005e620: 746d 6c5f 7265 706f 7274 2e53 686f 7728  tml_report.Show(
+0005e630: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0005e640: 2020 2073 656c 662e 6874 6d6c 5f72 6570     self.html_rep
+0005e650: 6f72 742e 436f 6e74 6169 6e69 6e67 5369  ort.ContainingSi
+0005e660: 7a65 722e 4c61 796f 7574 2829 0d0a 2020  zer.Layout()..  
+0005e670: 2020 2020 2020 2020 2020 7365 6c66 2e68            self.h
+0005e680: 746d 6c5f 7265 706f 7274 2e53 6574 5061  tml_report.SetPa
+0005e690: 6765 2822 3c62 6f64 7920 6267 636f 6c6f  ge("<body bgcolo
+0005e6a0: 723d 2725 7327 3e3c 666f 6e74 2063 6f6c  r='%s'><font col
+0005e6b0: 6f72 3d27 2573 273e 3c62 3e4d 6572 6765  or='%s'><b>Merge
+0005e6c0: 2070 726f 6772 6573 733a 220d 0a20 2020   progress:"..   
+0005e6d0: 2020 2020 2020 2020 2020 2020 2022 3c2f               "</
+0005e6e0: 623e 3c62 7220 2f3e 2220 2520 2863 6f6e  b><br />" % (con
+0005e6f0: 662e 4d65 7267 6548 746d 6c42 6163 6b67  f.MergeHtmlBackg
+0005e700: 726f 756e 6443 6f6c 6f75 722c 2063 6f6e  roundColour, con
+0005e710: 662e 4667 436f 6c6f 7572 2929 0d0a 2020  f.FgColour))..  
+0005e720: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+0005e730: 6167 655f 6d65 7267 655f 6368 6174 732e  age_merge_chats.
+0005e740: 456e 6162 6c65 6420 3d20 4661 6c73 650d  Enabled = False.
+0005e750: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0005e760: 662e 7061 6765 5f6d 6572 6765 5f63 6f6e  f.page_merge_con
+0005e770: 7461 6374 732e 456e 6162 6c65 6420 3d20  tacts.Enabled = 
+0005e780: 4661 6c73 650d 0a20 2020 2020 2020 2020  False..         
+0005e790: 2020 2067 7569 6261 7365 2e73 7461 7475     guibase.statu
+0005e7a0: 7328 224d 6572 6769 6e67 2025 7320 6672  s("Merging %s fr
+0005e7b0: 6f6d 2025 7320 746f 2025 732e 222c 2069  om %s to %s.", i
+0005e7c0: 6e66 6f2c 2064 6231 2c20 6462 322c 206c  nfo, db1, db2, l
+0005e7d0: 6f67 3d54 7275 6529 0d0a 2020 2020 2020  og=True)..      
+0005e7e0: 2020 2020 2020 7061 7261 6d73 203d 206c        params = l
+0005e7f0: 6f63 616c 7328 290d 0a20 2020 2020 2020  ocals()..       
+0005e800: 2020 2020 2073 656c 662e 776f 726b 6572       self.worker
+0005e810: 5f6d 6572 6765 2e77 6f72 6b28 7061 7261  _merge.work(para
+0005e820: 6d73 290d 0a20 2020 2020 2020 2020 2020  ms)..           
+0005e830: 2073 656c 662e 6973 5f6d 6572 6769 6e67   self.is_merging
+0005e840: 203d 2054 7275 650d 0a0d 0a0d 0a20 2020   = True......   
+0005e850: 2064 6566 206f 6e5f 6d65 7267 655f 616c   def on_merge_al
+0005e860: 6c5f 7265 7375 6c74 2873 656c 662c 2065  l_result(self, e
+0005e870: 7665 6e74 293a 0d0a 2020 2020 2020 2020  vent):..        
+0005e880: 2222 220d 0a20 2020 2020 2020 2048 616e  """..        Han
+0005e890: 646c 6572 2066 6f72 2067 6574 7469 6e67  dler for getting
+0005e8a0: 206d 6572 6765 2072 6573 756c 7473 2066   merge results f
+0005e8b0: 726f 6d20 776f 726b 6572 2074 6872 6561  rom worker threa
+0005e8c0: 642c 2072 6566 7265 7368 6573 2074 6578  d, refreshes tex
+0005e8d0: 7473 0d0a 2020 2020 2020 2020 616e 6420  ts..        and 
+0005e8e0: 5549 2063 6f6e 7472 6f6c 732e 0d0a 2020  UI controls...  
+0005e8f0: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
+0005e900: 2020 2072 6573 756c 7420 3d20 6576 656e     result = even
+0005e910: 742e 7265 7375 6c74 0d0a 2020 2020 2020  t.result..      
+0005e920: 2020 6163 7469 6f6e 203d 2028 224d 6572    action = ("Mer
+0005e930: 6765 2220 6966 2022 6d65 7267 655f 6c65  ge" if "merge_le
+0005e940: 6674 2220 3d3d 2072 6573 756c 745b 2274  ft" == result["t
+0005e950: 7970 6522 5d0d 0a20 2020 2020 2020 2020  ype"]..         
+0005e960: 2020 2020 2020 2020 2065 6c73 6520 2253           else "S
+0005e970: 6361 6e20 616e 6420 6d65 7267 6522 290d  can and merge").
+0005e980: 0a20 2020 2020 2020 2069 6620 2269 6e64  .        if "ind
+0005e990: 6578 2220 696e 2072 6573 756c 743a 0d0a  ex" in result:..
+0005e9a0: 2020 2020 2020 2020 2020 2020 6d69 6e64              mind
+0005e9b0: 6578 2c20 6d63 6f75 6e74 203d 2072 6573  ex, mcount = res
+0005e9c0: 756c 745b 2269 6e64 6578 225d 2c20 7265  ult["index"], re
+0005e9d0: 7375 6c74 5b22 636f 756e 7422 5d0d 0a20  sult["count"].. 
+0005e9e0: 2020 2020 2020 2020 2020 2063 696e 6465             cinde
+0005e9f0: 782c 2063 636f 756e 7420 3d20 7265 7375  x, ccount = resu
+0005ea00: 6c74 5b22 6368 6174 696e 6465 7822 5d2c  lt["chatindex"],
+0005ea10: 2072 6573 756c 745b 2263 6861 7463 6f75   result["chatcou
+0005ea20: 6e74 225d 0d0a 2020 2020 2020 2020 2020  nt"]..          
+0005ea30: 2020 7065 7263 656e 7420 3d20 6d69 6e28    percent = min(
+0005ea40: 3130 302c 206d 6174 682e 6365 696c 2831  100, math.ceil(1
+0005ea50: 3030 202a 2075 7469 6c2e 7361 6665 6469  00 * util.safedi
+0005ea60: 7666 286d 696e 6465 782c 206d 636f 756e  vf(mindex, mcoun
+0005ea70: 7429 2929 0d0a 2020 2020 2020 2020 2020  t)))..          
+0005ea80: 2020 6966 2070 6572 6365 6e74 203d 3d20    if percent == 
+0005ea90: 3130 3020 616e 6420 6d69 6e64 6578 203c  100 and mindex <
+0005eaa0: 206d 636f 756e 743a 2070 6572 6365 6e74   mcount: percent
+0005eab0: 203d 2039 390d 0a20 2020 2020 2020 2020   = 99..         
+0005eac0: 2020 206d 7367 203d 2022 2573 2025 6425     msg = "%s %d%
+0005ead0: 2520 636f 6d70 6c65 7465 2028 2573 206f  % complete (%s o
+0005eae0: 6620 2573 292e 2220 2520 2861 6374 696f  f %s)." % (actio
+0005eaf0: 6e2c 2070 6572 6365 6e74 2c0d 0a20 2020  n, percent,..   
+0005eb00: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0005eb10: 696e 6465 782b 312c 2075 7469 6c2e 706c  index+1, util.pl
+0005eb20: 7572 616c 2822 636f 6e76 6572 7361 7469  ural("conversati
+0005eb30: 6f6e 222c 2063 636f 756e 742c 2073 6570  on", ccount, sep
+0005eb40: 3d22 2c22 2929 0d0a 2020 2020 2020 2020  =","))..        
+0005eb50: 2020 2020 7365 6c66 2e75 7064 6174 655f      self.update_
+0005eb60: 6761 7567 6528 7365 6c66 2e67 6175 6765  gauge(self.gauge
+0005eb70: 5f70 726f 6772 6573 732c 2070 6572 6365  _progress, perce
+0005eb80: 6e74 2c20 6d73 6729 0d0a 2020 2020 2020  nt, msg)..      
+0005eb90: 2020 2020 2020 666f 7220 6368 6174 2069        for chat i
+0005eba0: 6e20 7265 7375 6c74 2e67 6574 2822 6368  n result.get("ch
+0005ebb0: 6174 7322 2c20 5b5d 293a 0d0a 2020 2020  ats", []):..    
+0005ebc0: 2020 2020 2020 2020 2020 2020 6966 2063              if c
+0005ebd0: 6861 745b 2269 6465 6e74 6974 7922 5d20  hat["identity"] 
+0005ebe0: 696e 2073 656c 662e 6368 6174 735f 6469  in self.chats_di
+0005ebf0: 6666 6461 7461 3a0d 0a20 2020 2020 2020  ffdata:..       
+0005ec00: 2020 2020 2020 2020 2020 2020 2064 656c               del
+0005ec10: 2073 656c 662e 6368 6174 735f 6469 6666   self.chats_diff
+0005ec20: 6461 7461 5b63 6861 745b 2269 6465 6e74  data[chat["ident
+0005ec30: 6974 7922 5d5d 0d0a 2020 2020 2020 2020  ity"]]..        
+0005ec40: 6966 2022 6572 726f 7222 2069 6e20 7265  if "error" in re
+0005ec50: 7375 6c74 3a0d 0a20 2020 2020 2020 2020  sult:..         
+0005ec60: 2020 2073 656c 662e 6973 5f6d 6572 6769     self.is_mergi
+0005ec70: 6e67 203d 2046 616c 7365 0d0a 2020 2020  ng = False..    
+0005ec80: 2020 2020 2020 2020 7365 6c66 2e75 7064          self.upd
+0005ec90: 6174 655f 6761 7567 6528 7365 6c66 2e67  ate_gauge(self.g
+0005eca0: 6175 6765 5f70 726f 6772 6573 732c 2030  auge_progress, 0
+0005ecb0: 2c20 2225 7320 6572 726f 722e 2220 2520  , "%s error." % 
+0005ecc0: 6163 7469 6f6e 290d 0a20 2020 2020 2020  action)..       
+0005ecd0: 2020 2020 206c 6f67 6765 722e 6572 726f       logger.erro
+0005ece0: 7228 2225 7320 6572 726f 722e 5c6e 5c6e  r("%s error.\n\n
+0005ecf0: 2573 222c 2061 6374 696f 6e2c 2072 6573  %s", action, res
+0005ed00: 756c 745b 2265 7272 6f72 225d 290d 0a20  ult["error"]).. 
+0005ed10: 2020 2020 2020 2020 2020 206d 7367 203d             msg =
+0005ed20: 2022 2573 2065 7272 6f72 2e5c 6e5c 6e25   "%s error.\n\n%
+0005ed30: 7322 2025 2028 6163 7469 6f6e 2c0d 0a20  s" % (action,.. 
+0005ed40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005ed50: 2072 6573 756c 742e 6765 7428 2265 7272   result.get("err
+0005ed60: 6f72 5f73 686f 7274 222c 2072 6573 756c  or_short", resul
+0005ed70: 745b 2265 7272 6f72 225d 2929 0d0a 2020  t["error"]))..  
+0005ed80: 2020 2020 2020 2020 2020 7365 6c66 2e68            self.h
+0005ed90: 746d 6c5f 7265 706f 7274 2e46 7265 657a  tml_report.Freez
+0005eda0: 6528 290d 0a20 2020 2020 2020 2020 2020  e()..           
+0005edb0: 2073 656c 662e 6874 6d6c 5f72 6570 6f72   self.html_repor
+0005edc0: 742e 4170 7065 6e64 546f 5061 6765 2822  t.AppendToPage("
+0005edd0: 3c62 7220 2f3e 3c62 7220 2f3e 203c 623e  <br /><br /> <b>
+0005ede0: 4572 726f 7220 6d65 7267 696e 6720 6368  Error merging ch
+0005edf0: 6174 733a 3c2f 623e 266e 6273 703b 266e  ats:</b>&nbsp;&n
+0005ee00: 6273 703b 220d 0a20 2020 2020 2020 2020  bsp;"..         
+0005ee10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005ee20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005ee30: 202b 2072 6573 756c 745b 2265 7272 6f72   + result["error
+0005ee40: 225d 2e72 6570 6c61 6365 2822 3c22 2c20  "].replace("<", 
+0005ee50: 2226 6c74 3b22 290d 0a20 2020 2020 2020  "&lt;")..       
+0005ee60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005ee70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005ee80: 2020 2020 202e 7265 706c 6163 6528 2220       .replace(" 
+0005ee90: 222c 2022 266e 6273 703b 2229 2e72 6570  ", "&nbsp;").rep
+0005eea0: 6c61 6365 2822 5c6e 222c 2022 3c62 7220  lace("\n", "<br 
+0005eeb0: 2f3e 2229 290d 0a20 2020 2020 2020 2020  />"))..         
+0005eec0: 2020 2073 6372 6f6c 6c70 6f73 203d 2073     scrollpos = s
+0005eed0: 656c 662e 6874 6d6c 5f72 6570 6f72 742e  elf.html_report.
+0005eee0: 4765 7453 6372 6f6c 6c52 616e 6765 2877  GetScrollRange(w
+0005eef0: 782e 5645 5254 4943 414c 290d 0a20 2020  x.VERTICAL)..   
+0005ef00: 2020 2020 2020 2020 2073 656c 662e 6874           self.ht
+0005ef10: 6d6c 5f72 6570 6f72 742e 5363 726f 6c6c  ml_report.Scroll
+0005ef20: 2830 2c20 7363 726f 6c6c 706f 7329 0d0a  (0, scrollpos)..
+0005ef30: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0005ef40: 2e68 746d 6c5f 7265 706f 7274 2e54 6861  .html_report.Tha
+0005ef50: 7728 290d 0a20 2020 2020 2020 2020 2020  w()..           
+0005ef60: 2077 782e 4d65 7373 6167 6542 6f78 286d   wx.MessageBox(m
+0005ef70: 7367 2c20 636f 6e66 2e54 6974 6c65 2c20  sg, conf.Title, 
+0005ef80: 7778 2e4f 4b20 7c20 7778 2e49 434f 4e5f  wx.OK | wx.ICON_
+0005ef90: 5741 524e 494e 4729 0d0a 2020 2020 2020  WARNING)..      
+0005efa0: 2020 6966 2022 7374 6174 7573 2220 696e    if "status" in
+0005efb0: 2072 6573 756c 743a 0d0a 2020 2020 2020   result:..      
+0005efc0: 2020 2020 2020 6775 6962 6173 652e 7374        guibase.st
+0005efd0: 6174 7573 2872 6573 756c 745b 2273 7461  atus(result["sta
+0005efe0: 7475 7322 5d29 0d0a 2020 2020 2020 2020  tus"])..        
+0005eff0: 6966 2022 646f 6e65 2220 696e 2072 6573  if "done" in res
+0005f000: 756c 743a 0d0a 2020 2020 2020 2020 2020  ult:..          
+0005f010: 2020 7365 6c66 2e69 735f 6d65 7267 696e    self.is_mergin
+0005f020: 6720 3d20 4661 6c73 650d 0a20 2020 2020  g = False..     
+0005f030: 2020 2020 2020 2073 656c 662e 7061 6765         self.page
+0005f040: 5f6d 6572 6765 5f63 6861 7473 2e45 6e61  _merge_chats.Ena
+0005f050: 626c 6564 203d 2054 7275 650d 0a20 2020  bled = True..   
+0005f060: 2020 2020 2020 2020 2073 656c 662e 7061           self.pa
+0005f070: 6765 5f6d 6572 6765 5f63 6f6e 7461 6374  ge_merge_contact
+0005f080: 732e 456e 6162 6c65 6420 3d20 5472 7565  s.Enabled = True
+0005f090: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+0005f0a0: 6c66 2e64 6232 2e63 6c65 6172 5f63 6163  lf.db2.clear_cac
+0005f0b0: 6865 2829 0d0a 2020 2020 2020 2020 2020  he()..          
+0005f0c0: 2020 7365 6c66 2e73 7463 5f64 6966 6631    self.stc_diff1
+0005f0d0: 2e43 6c65 6172 416c 6c28 290d 0a20 2020  .ClearAll()..   
+0005f0e0: 2020 2020 2020 2020 2073 656c 662e 6c69           self.li
+0005f0f0: 7374 5f63 6861 7473 2e44 656c 6574 6541  st_chats.DeleteA
+0005f100: 6c6c 4974 656d 7328 290d 0a20 2020 2020  llItems()..     
+0005f110: 2020 2020 2020 2073 656c 662e 6c69 7374         self.list
+0005f120: 5f63 6f6e 7461 6374 732e 4465 6c65 7465  _contacts.Delete
+0005f130: 416c 6c49 7465 6d73 2829 0d0a 2020 2020  AllItems()..    
+0005f140: 2020 2020 2020 2020 7365 6c66 2e6c 6162          self.lab
+0005f150: 656c 5f6d 6572 6765 5f63 6861 742e 4c61  el_merge_chat.La
+0005f160: 6265 6c20 3d20 2222 0d0a 2020 2020 2020  bel = ""..      
+0005f170: 2020 2020 2020 7365 6c66 2e63 6861 7420        self.chat 
+0005f180: 3d20 4e6f 6e65 0d0a 2020 2020 2020 2020  = None..        
+0005f190: 2020 2020 7365 6c66 2e63 6861 745f 6469      self.chat_di
+0005f1a0: 6666 203d 204e 6f6e 650d 0a20 2020 2020  ff = None..     
+0005f1b0: 2020 2020 2020 2073 656c 662e 6368 6174         self.chat
+0005f1c0: 7332 203d 2073 656c 662e 6462 322e 6765  s2 = self.db2.ge
+0005f1d0: 745f 636f 6e76 6572 7361 7469 6f6e 7328  t_conversations(
+0005f1e0: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
+0005f1f0: 6e66 6f20 3d20 7265 7375 6c74 5b22 6f75  nfo = result["ou
+0005f200: 7470 7574 225d 0d0a 2020 2020 2020 2020  tput"]..        
+0005f210: 2020 2020 6966 2022 6572 726f 7222 206e      if "error" n
+0005f220: 6f74 2069 6e20 7265 7375 6c74 3a0d 0a20  ot in result:.. 
+0005f230: 2020 2020 2020 2020 2020 2020 2020 2067                 g
+0005f240: 7569 6261 7365 2e73 7461 7475 7328 696e  uibase.status(in
+0005f250: 666f 2c20 6c6f 673d 5472 7565 290d 0a20  fo, log=True).. 
+0005f260: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0005f270: 656c 662e 7570 6461 7465 5f67 6175 6765  elf.update_gauge
+0005f280: 2873 656c 662e 6761 7567 655f 7072 6f67  (self.gauge_prog
+0005f290: 7265 7373 2c20 3130 302c 2022 4d65 7267  ress, 100, "Merg
+0005f2a0: 6520 636f 6d70 6c65 7465 2e22 290d 0a20  e complete.").. 
+0005f2b0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0005f2c0: 6578 7420 3d20 223c 6272 202f 3e3c 6272  ext = "<br /><br
+0005f2d0: 202f 3e20 2573 2220 2520 7265 7375 6c74   /> %s" % result
+0005f2e0: 5b22 6f75 7470 7574 225d 0d0a 2020 2020  ["output"]..    
+0005f2f0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0005f300: 2e68 746d 6c5f 7265 706f 7274 2e46 7265  .html_report.Fre
+0005f310: 657a 6528 290d 0a20 2020 2020 2020 2020  eze()..         
+0005f320: 2020 2020 2020 2073 656c 662e 6874 6d6c         self.html
+0005f330: 5f72 6570 6f72 742e 4170 7065 6e64 546f  _report.AppendTo
+0005f340: 5061 6765 2874 6578 7429 0d0a 2020 2020  Page(text)..    
+0005f350: 2020 2020 2020 2020 2020 2020 7363 726f              scro
+0005f360: 6c6c 706f 7320 3d20 7365 6c66 2e68 746d  llpos = self.htm
+0005f370: 6c5f 7265 706f 7274 2e47 6574 5363 726f  l_report.GetScro
+0005f380: 6c6c 5261 6e67 6528 7778 2e56 4552 5449  llRange(wx.VERTI
+0005f390: 4341 4c29 0d0a 2020 2020 2020 2020 2020  CAL)..          
+0005f3a0: 2020 2020 2020 7365 6c66 2e68 746d 6c5f        self.html_
+0005f3b0: 7265 706f 7274 2e53 6372 6f6c 6c28 302c  report.Scroll(0,
+0005f3c0: 2073 6372 6f6c 6c70 6f73 290d 0a20 2020   scrollpos)..   
+0005f3d0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0005f3e0: 662e 6874 6d6c 5f72 6570 6f72 742e 5468  f.html_report.Th
+0005f3f0: 6177 2829 0d0a 2020 2020 2020 2020 2020  aw()..          
+0005f400: 2020 2020 2020 7778 2e4d 6573 7361 6765        wx.Message
+0005f410: 426f 7828 696e 666f 2c20 636f 6e66 2e54  Box(info, conf.T
+0005f420: 6974 6c65 2c20 7778 2e4f 4b20 7c20 7778  itle, wx.OK | wx
+0005f430: 2e49 434f 4e5f 494e 464f 524d 4154 494f  .ICON_INFORMATIO
+0005f440: 4e29 0d0a 2020 2020 2020 2020 2020 2020  N)..            
+0005f450: 7365 6c66 2e62 7574 746f 6e5f 6d65 7267  self.button_merg
+0005f460: 655f 616c 6c2e 4e6f 7465 203d 2073 656c  e_all.Note = sel
+0005f470: 662e 4d45 5247 455f 4255 5454 4f4e 5f4e  f.MERGE_BUTTON_N
+0005f480: 4f54 450d 0a20 2020 2020 2020 2020 2020  OTE..           
+0005f490: 2073 656c 662e 6275 7474 6f6e 5f73 7761   self.button_swa
+0005f4a0: 702e 456e 6162 6c65 6420 3d20 5472 7565  p.Enabled = True
+0005f4b0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+0005f4c0: 6c66 2e62 7574 746f 6e5f 6d65 7267 655f  lf.button_merge_
+0005f4d0: 6368 6174 732e 456e 6162 6c65 6420 3d20  chats.Enabled = 
+0005f4e0: 5472 7565 0d0a 2020 2020 2020 2020 2020  True..          
+0005f4f0: 2020 7778 2e43 616c 6c4c 6174 6572 2832    wx.CallLater(2
+0005f500: 302c 2073 656c 662e 6c6f 6164 5f6c 6174  0, self.load_lat
+0005f510: 6572 5f64 6174 6129 0d0a 2020 2020 2020  er_data)..      
+0005f520: 2020 2020 2020 6966 2073 656c 662e 6973        if self.is
+0005f530: 5f73 6361 6e6e 6564 2061 6e64 2073 656c  _scanned and sel
+0005f540: 662e 6368 6174 735f 6469 6666 6461 7461  f.chats_diffdata
+0005f550: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0005f560: 2020 2063 6f75 6e74 5f6d 7367 7320 3d20     count_msgs = 
+0005f570: 7574 696c 2e70 6c75 7261 6c28 0d0a 2020  util.plural(..  
+0005f580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005f590: 2020 226d 6573 7361 6765 222c 2073 756d    "message", sum
+0005f5a0: 286c 656e 2864 5b22 6469 6666 225d 5b22  (len(d["diff"]["
+0005f5b0: 6d65 7373 6167 6573 225d 290d 0a20 2020  messages"])..   
+0005f5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005f5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005f5e0: 666f 7220 6420 696e 2073 656c 662e 6368  for d in self.ch
+0005f5f0: 6174 735f 6469 6666 6461 7461 2e76 616c  ats_diffdata.val
+0005f600: 7565 7328 2929 2c20 7365 703d 222c 2229  ues()), sep=",")
+0005f610: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0005f620: 2020 636f 756e 745f 6368 6174 7320 3d20    count_chats = 
+0005f630: 7574 696c 2e70 6c75 7261 6c28 2263 6861  util.plural("cha
+0005f640: 7422 2c20 7365 6c66 2e63 6861 7473 5f64  t", self.chats_d
+0005f650: 6966 6664 6174 612c 2073 6570 3d22 2c22  iffdata, sep=","
+0005f660: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0005f670: 2020 206e 6f74 6569 6e66 6f20 3d20 2225     noteinfo = "%
+0005f680: 7320 6672 6f6d 2025 7322 2025 2028 636f  s from %s" % (co
+0005f690: 756e 745f 6d73 6773 2c20 636f 756e 745f  unt_msgs, count_
+0005f6a0: 6368 6174 7329 0d0a 2020 2020 2020 2020  chats)..        
+0005f6b0: 2020 2020 2020 2020 7365 6c66 2e62 7574          self.but
+0005f6c0: 746f 6e5f 6d65 7267 655f 616c 6c2e 4e6f  ton_merge_all.No
+0005f6d0: 7465 203d 2028 0d0a 2020 2020 2020 2020  te = (..        
+0005f6e0: 2020 2020 2020 2020 2020 2020 2243 6f70              "Cop
+0005f6f0: 7920 2573 2074 6f20 7468 6520 6461 7461  y %s to the data
+0005f700: 6261 7365 206f 6e20 7468 6520 7269 6768  base on the righ
+0005f710: 742e 2220 2520 6e6f 7465 696e 666f 290d  t." % noteinfo).
+0005f720: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0005f730: 2073 656c 662e 6275 7474 6f6e 5f6d 6572   self.button_mer
+0005f740: 6765 5f61 6c6c 2e45 6e61 626c 6564 203d  ge_all.Enabled =
+0005f750: 2054 7275 650d 0a20 2020 2020 2020 2065   True..        e
+0005f760: 6c69 6620 226f 7574 7075 7422 2069 6e20  lif "output" in 
+0005f770: 7265 7375 6c74 2061 6e64 2072 6573 756c  result and resul
+0005f780: 745b 226f 7574 7075 7422 5d3a 0d0a 2020  t["output"]:..  
+0005f790: 2020 2020 2020 2020 2020 7365 6c66 2e68            self.h
+0005f7a0: 746d 6c5f 7265 706f 7274 2e41 7070 656e  tml_report.Appen
+0005f7b0: 6454 6f50 6167 6528 223c 6272 202f 3e20  dToPage("<br /> 
+0005f7c0: 2573 2220 2520 7265 7375 6c74 5b22 6f75  %s" % result["ou
+0005f7d0: 7470 7574 225d 290d 0a0d 0a0d 0a20 2020  tput"])......   
+0005f7e0: 2064 6566 2075 7064 6174 655f 6761 7567   def update_gaug
+0005f7f0: 6528 7365 6c66 2c20 6761 7567 652c 2076  e(self, gauge, v
+0005f800: 616c 7565 2c20 6d65 7373 6167 653d 2222  alue, message=""
+0005f810: 293a 0d0a 2020 2020 2020 2020 2222 220d  ):..        """.
+0005f820: 0a20 2020 2020 2020 2055 7064 6174 6573  .        Updates
+0005f830: 2074 6865 2067 6175 6765 2076 616c 7565   the gauge value
+0005f840: 2061 6e64 206d 6573 7361 6765 206f 6e20   and message on 
+0005f850: 7061 6765 5f6d 6572 6765 5f61 6c6c 2e20  page_merge_all. 
+0005f860: 4966 2076 616c 7565 2069 730d 0a20 2020  If value is..   
+0005f870: 2020 2020 204e 6f6e 652c 2068 6964 6573       None, hides
+0005f880: 2067 6175 6765 2070 616e 656c 2e0d 0a20   gauge panel... 
+0005f890: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
+0005f8a0: 2020 2020 6966 2076 616c 7565 2069 7320      if value is 
+0005f8b0: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+0005f8c0: 2020 2067 6175 6765 2e48 6964 6528 290d     gauge.Hide().
+0005f8d0: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
+0005f8e0: 2020 2020 2020 2020 2020 2020 6761 7567              gaug
+0005f8f0: 652e 5661 6c75 6520 3d20 7661 6c75 650d  e.Value = value.
+0005f900: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+0005f910: 2063 2069 6e20 6761 7567 652e 5061 7265   c in gauge.Pare
+0005f920: 6e74 2e43 6869 6c64 7265 6e3a 0d0a 2020  nt.Children:..  
+0005f930: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0005f940: 2069 7369 6e73 7461 6e63 6528 632c 2077   isinstance(c, w
+0005f950: 782e 5374 6174 6963 5465 7874 293a 0d0a  x.StaticText):..
+0005f960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005f970: 2020 2020 632e 4c61 6265 6c20 3d20 6d65      c.Label = me
+0005f980: 7373 6167 650d 0a20 2020 2020 2020 2020  ssage..         
+0005f990: 2020 2020 2020 2020 2020 2062 7265 616b             break
+0005f9a0: 2023 2066 6f72 2063 0d0a 2020 2020 2020   # for c..      
+0005f9b0: 2020 2020 2020 6761 7567 652e 5061 7265        gauge.Pare
+0005f9c0: 6e74 2e53 697a 6572 2e4c 6179 6f75 7428  nt.Sizer.Layout(
+0005f9d0: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
+0005f9e0: 6620 6e6f 7420 6761 7567 652e 5061 7265  f not gauge.Pare
+0005f9f0: 6e74 2e53 686f 776e 3a0d 0a20 2020 2020  nt.Shown:..     
+0005fa00: 2020 2020 2020 2020 2020 2067 6175 6765             gauge
+0005fa10: 2e50 6172 656e 742e 5368 6f77 2829 0d0a  .Parent.Show()..
+0005fa20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005fa30: 6761 7567 652e 5061 7265 6e74 2e43 6f6e  gauge.Parent.Con
+0005fa40: 7461 696e 696e 6753 697a 6572 2e4c 6179  tainingSizer.Lay
+0005fa50: 6f75 7428 290d 0a0d 0a0d 0a20 2020 2064  out()......    d
+0005fa60: 6566 206f 6e5f 6d65 7267 655f 6368 6174  ef on_merge_chat
+0005fa70: 2873 656c 662c 2065 7665 6e74 293a 0d0a  (self, event):..
+0005fa80: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
+0005fa90: 2020 2020 2048 616e 646c 6572 2066 6f72       Handler for
+0005faa0: 2063 6c69 636b 696e 6720 746f 206d 6572   clicking to mer
+0005fab0: 6765 2061 2063 6861 7420 6672 6f6d 206c  ge a chat from l
+0005fac0: 6566 7420 7369 6465 2064 6220 746f 2074  eft side db to t
+0005fad0: 6865 2072 6967 6874 0d0a 2020 2020 2020  he right..      
+0005fae0: 2020 7369 6465 2064 622e 0d0a 2020 2020    side db...    
+0005faf0: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
+0005fb00: 2069 6620 7365 6c66 2e69 735f 7363 616e   if self.is_scan
+0005fb10: 6e69 6e67 206f 7220 7365 6c66 2e69 735f  ning or self.is_
+0005fb20: 6d65 7267 696e 673a 0d0a 2020 2020 2020  merging:..      
+0005fb30: 2020 2020 2020 7778 2e4d 6573 7361 6765        wx.Message
+0005fb40: 426f 7828 2247 6c6f 6261 6c20 2528 7429  Box("Global %(t)
+0005fb50: 7320 6973 2063 7572 7265 6e74 6c79 2075  s is currently u
+0005fb60: 6e64 6572 7761 793a 2073 696e 676c 6520  nderway: single 
+0005fb70: 6368 6174 2022 0d0a 2020 2020 2020 2020  chat "..        
+0005fb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005fb90: 2020 226d 6572 6765 2074 656d 706f 7261    "merge tempora
+0005fba0: 7269 6c79 2064 6973 6162 6c65 6420 666f  rily disabled fo
+0005fbb0: 7220 6461 7461 2073 6166 6574 792e 5c6e  r data safety.\n
+0005fbc0: 5c6e 220d 0a20 2020 2020 2020 2020 2020  \n"..           
+0005fbd0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0005fbe0: 506c 6561 7365 2077 6169 7420 756e 7469  Please wait unti
+0005fbf0: 6c20 7468 6520 676c 6f62 616c 2025 2874  l the global %(t
+0005fc00: 2973 2069 7320 6669 6e69 7368 6564 2e22  )s is finished."
+0005fc10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0005fc20: 2020 2020 2020 2020 2020 2020 2520 7b22              % {"
+0005fc30: 7422 3a20 226d 6572 6765 2220 6966 2073  t": "merge" if s
+0005fc40: 656c 662e 6973 5f6d 6572 6769 6e67 2065  elf.is_merging e
+0005fc50: 6c73 6520 2273 6361 6e22 7d2c 0d0a 2020  lse "scan"},..  
+0005fc60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005fc70: 2020 2020 2020 2020 636f 6e66 2e54 6974          conf.Tit
+0005fc80: 6c65 2c20 7778 2e4f 4b20 7c20 7778 2e49  le, wx.OK | wx.I
+0005fc90: 434f 4e5f 5741 524e 494e 4729 0d0a 2020  CON_WARNING)..  
+0005fca0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0005fcb0: 0d0a 2020 2020 2020 2020 6462 312c 2064  ..        db1, d
+0005fcc0: 6232 203d 2073 656c 662e 6462 312c 2073  b2 = self.db1, s
+0005fcd0: 656c 662e 6462 320d 0a20 2020 2020 2020  elf.db2..       
+0005fce0: 2063 6861 742c 2063 6861 7432 203d 2073   chat, chat2 = s
+0005fcf0: 656c 662e 6368 6174 5b22 6331 225d 2c20  elf.chat["c1"], 
+0005fd00: 7365 6c66 2e63 6861 745b 2263 3222 5d0d  self.chat["c2"].
+0005fd10: 0a20 2020 2020 2020 206d 6573 7361 6765  .        message
+0005fd20: 7320 3d20 7365 6c66 2e63 6861 745f 6469  s = self.chat_di
+0005fd30: 6666 5b22 6d65 7373 6167 6573 225d 0d0a  ff["messages"]..
+0005fd40: 2020 2020 2020 2020 7061 7274 6963 6970          particip
+0005fd50: 616e 7473 203d 2073 656c 662e 6368 6174  ants = self.chat
+0005fd60: 5f64 6966 665b 2270 6172 7469 6369 7061  _diff["participa
+0005fd70: 6e74 7322 5d0d 0a20 2020 2020 2020 2063  nts"]..        c
+0005fd80: 6f6e 6469 6666 203d 2073 656c 662e 636f  ondiff = self.co
+0005fd90: 6e31 6469 6666 0d0a 2020 2020 2020 2020  n1diff..        
+0005fda0: 636f 6e74 6163 7473 3220 3d20 5b5d 0d0a  contacts2 = []..
+0005fdb0: 0d0a 2020 2020 2020 2020 6966 206d 6573  ..        if mes
+0005fdc0: 7361 6765 7320 6f72 2070 6172 7469 6369  sages or partici
+0005fdd0: 7061 6e74 733a 0d0a 2020 2020 2020 2020  pants:..        
+0005fde0: 2020 2020 696e 666f 203d 2022 220d 0a20      info = "".. 
+0005fdf0: 2020 2020 2020 2020 2020 2070 6172 7473             parts
+0005fe00: 203d 205b 5d0d 0a20 2020 2020 2020 2020   = []..         
+0005fe10: 2020 206e 6577 5f63 6861 7420 3d20 6e6f     new_chat = no
+0005fe20: 7420 6368 6174 320d 0a20 2020 2020 2020  t chat2..       
+0005fe30: 2020 2020 206e 6577 7374 7220 3d20 2222       newstr = ""
+0005fe40: 2069 6620 6e65 775f 6368 6174 2065 6c73   if new_chat els
+0005fe50: 6520 226e 6577 2022 0d0a 2020 2020 2020  e "new "..      
+0005fe60: 2020 2020 2020 6966 206e 6577 5f63 6861        if new_cha
+0005fe70: 743a 0d0a 2020 2020 2020 2020 2020 2020  t:..            
+0005fe80: 2020 2020 696e 666f 202b 3d20 226e 6577      info += "new
+0005fe90: 2063 6861 7420 7769 7468 2022 0d0a 2020   chat with "..  
+0005fea0: 2020 2020 2020 2020 2020 6966 206d 6573            if mes
+0005feb0: 7361 6765 733a 0d0a 2020 2020 2020 2020  sages:..        
+0005fec0: 2020 2020 2020 2020 7061 7274 732e 6170          parts.ap
+0005fed0: 7065 6e64 2875 7469 6c2e 706c 7572 616c  pend(util.plural
+0005fee0: 2822 2573 6d65 7373 6167 6522 2025 206e  ("%smessage" % n
+0005fef0: 6577 7374 722c 206d 6573 7361 6765 732c  ewstr, messages,
+0005ff00: 2073 6570 3d22 2c22 2929 0d0a 2020 2020   sep=","))..    
+0005ff10: 2020 2020 2020 2020 6966 2070 6172 7469          if parti
+0005ff20: 6369 7061 6e74 733a 0d0a 2020 2020 2020  cipants:..      
+0005ff30: 2020 2020 2020 2020 2020 2320 4164 6420            # Add 
+0005ff40: 746f 2063 6f6e 7461 6374 7320 7468 6f73  to contacts thos
+0005ff50: 6520 7468 6174 2061 7265 206e 6577 0d0a  e that are new..
+0005ff60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005ff70: 6363 3220 3d20 5b64 6231 2e69 642c 2064  cc2 = [db1.id, d
+0005ff80: 6232 2e69 645d 202b 205c 0d0a 2020 2020  b2.id] + \..    
+0005ff90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005ffa0: 5b69 5b22 6964 656e 7469 7479 225d 2066  [i["identity"] f
+0005ffb0: 6f72 2069 2069 6e20 6462 322e 6765 745f  or i in db2.get_
+0005ffc0: 636f 6e74 6163 7473 2829 5d0d 0a20 2020  contacts()]..   
+0005ffd0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+0005ffe0: 7461 6374 7332 203d 205b 695b 2263 6f6e  tacts2 = [i["con
+0005fff0: 7461 6374 225d 2066 6f72 2069 2069 6e20  tact"] for i in 
+00060000: 7061 7274 6963 6970 616e 7473 0d0a 2020  participants..  
+00060010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00060020: 2020 6966 2022 6964 2220 696e 2069 5b22    if "id" in i["
+00060030: 636f 6e74 6163 7422 5d20 616e 6420 695b  contact"] and i[
+00060040: 2269 6465 6e74 6974 7922 5d20 6e6f 7420  "identity"] not 
+00060050: 696e 2063 6332 5d0d 0a20 2020 2020 2020  in cc2]..       
+00060060: 2020 2020 2020 2020 2069 6620 636f 6e74           if cont
+00060070: 6163 7473 323a 0d0a 2020 2020 2020 2020  acts2:..        
+00060080: 2020 2020 2020 2020 2020 2020 7061 7274              part
+00060090: 732e 6170 7065 6e64 2875 7469 6c2e 706c  s.append(util.pl
+000600a0: 7572 616c 2822 6e65 7720 636f 6e74 6163  ural("new contac
+000600b0: 7422 2c20 636f 6e74 6163 7473 322c 2073  t", contacts2, s
+000600c0: 6570 3d22 2c22 2929 0d0a 2020 2020 2020  ep=","))..      
+000600d0: 2020 2020 2020 2020 2020 7061 7274 732e            parts.
+000600e0: 6170 7065 6e64 2875 7469 6c2e 706c 7572  append(util.plur
+000600f0: 616c 2822 2573 7061 7274 6963 6970 616e  al("%sparticipan
+00060100: 7422 2025 206e 6577 7374 722c 0d0a 2020  t" % newstr,..  
 00060110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060120: 6966 206e 6f74 2063 6861 7432 3a0d 0a20  if not chat2:.. 
-00060130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060140: 2020 2020 2020 2063 6861 7432 203d 2063         chat2 = c
-00060150: 6861 742e 636f 7079 2829 0d0a 2020 2020  hat.copy()..    
-00060160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060170: 2020 2020 7365 6c66 2e63 6861 745b 2263      self.chat["c
-00060180: 3222 5d20 3d20 6368 6174 320d 0a20 2020  2"] = chat2..   
-00060190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000601a0: 2020 2020 2063 6861 7432 5b22 6964 225d       chat2["id"]
-000601b0: 203d 2064 6232 2e69 6e73 6572 745f 636f   = db2.insert_co
-000601c0: 6e76 6572 7361 7469 6f6e 2863 6861 7432  nversation(chat2
-000601d0: 2c20 6462 3129 0d0a 2020 2020 2020 2020  , db1)..        
-000601e0: 2020 2020 2020 2020 2020 2020 6966 2070              if p
-000601f0: 6172 7469 6369 7061 6e74 733a 0d0a 2020  articipants:..  
-00060200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060210: 2020 2020 2020 6966 2063 6f6e 7461 6374        if contact
-00060220: 7332 3a0d 0a20 2020 2020 2020 2020 2020  s2:..           
-00060230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060240: 2064 6232 2e69 6e73 6572 745f 636f 6e74   db2.insert_cont
-00060250: 6163 7473 2863 6f6e 7461 6374 7332 2c20  acts(contacts2, 
-00060260: 6462 3129 0d0a 2020 2020 2020 2020 2020  db1)..          
-00060270: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00060280: 7220 7020 696e 2070 6172 7469 6369 7061  r p in participa
-00060290: 6e74 733a 0d0a 2020 2020 2020 2020 2020  nts:..          
-000602a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000602b0: 2020 6966 2070 2069 6e20 636f 6e64 6966    if p in condif
-000602c0: 663a 0d0a 2020 2020 2020 2020 2020 2020  f:..            
-000602d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000602e0: 2020 2020 636f 6e64 6966 662e 7265 6d6f      condiff.remo
-000602f0: 7665 2870 290d 0a20 2020 2020 2020 2020  ve(p)..         
-00060300: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00060310: 6232 2e69 6e73 6572 745f 7061 7274 6963  b2.insert_partic
-00060320: 6970 616e 7473 2863 6861 7432 2c20 7061  ipants(chat2, pa
-00060330: 7274 6963 6970 616e 7473 2c20 6462 3129  rticipants, db1)
-00060340: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00060350: 2020 2020 2020 2020 2020 6465 6c20 7061            del pa
-00060360: 7274 6963 6970 616e 7473 5b3a 5d0d 0a20  rticipants[:].. 
-00060370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060380: 2020 2069 6620 6d65 7373 6167 6573 3a0d     if messages:.
-00060390: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000603a0: 2020 2020 2020 2020 2064 6232 2e69 6e73           db2.ins
-000603b0: 6572 745f 6d65 7373 6167 6573 2863 6861  ert_messages(cha
-000603c0: 7432 2c20 6d65 7373 6167 6573 2c20 6462  t2, messages, db
-000603d0: 312c 2063 6861 7429 0d0a 2020 2020 2020  1, chat)..      
-000603e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000603f0: 2020 6465 6c20 6d65 7373 6167 6573 5b3a    del messages[:
-00060400: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
-00060410: 2020 2066 696e 616c 6c79 3a0d 0a20 2020     finally:..   
-00060420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060430: 2073 656c 662e 6973 5f6d 6572 6769 6e67   self.is_merging
-00060440: 203d 2046 616c 7365 0d0a 2020 2020 2020   = False..      
-00060450: 2020 2020 2020 2020 2020 6966 2063 6861            if cha
-00060460: 745b 2269 6465 6e74 6974 7922 5d20 696e  t["identity"] in
-00060470: 2073 656c 662e 6368 6174 735f 6469 6666   self.chats_diff
-00060480: 6461 7461 3a0d 0a20 2020 2020 2020 2020  data:..         
-00060490: 2020 2020 2020 2020 2020 2064 656c 2073             del s
-000604a0: 656c 662e 6368 6174 735f 6469 6666 6461  elf.chats_diffda
-000604b0: 7461 5b63 6861 745b 2269 6465 6e74 6974  ta[chat["identit
-000604c0: 7922 5d5d 0d0a 2020 2020 2020 2020 2020  y"]]..          
-000604d0: 2020 2020 2020 6462 322e 636c 6561 725f        db2.clear_
-000604e0: 6361 6368 6528 290d 0a20 2020 2020 2020  cache()..       
-000604f0: 2020 2020 2020 2020 2073 656c 662e 7374           self.st
-00060500: 635f 6469 6666 312e 436c 6561 7241 6c6c  c_diff1.ClearAll
-00060510: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
-00060520: 2020 2020 7365 6c66 2e62 7574 746f 6e5f      self.button_
-00060530: 6d65 7267 655f 6368 6174 2e45 6e61 626c  merge_chat.Enabl
-00060540: 6564 203d 2046 616c 7365 0d0a 2020 2020  ed = False..    
-00060550: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00060560: 2e62 7574 746f 6e5f 6578 706f 7274 5f63  .button_export_c
-00060570: 6861 742e 456e 6162 6c65 6420 3d20 4661  hat.Enabled = Fa
-00060580: 6c73 650d 0a20 2020 2020 2020 2020 2020  lse..           
-00060590: 2020 2020 2067 7569 6261 7365 2e73 7461       guibase.sta
-000605a0: 7475 7328 224d 6572 6765 6420 2573 206f  tus("Merged %s o
-000605b0: 6620 6368 6174 205c 2225 735c 2220 6672  f chat \"%s\" fr
-000605c0: 6f6d 2025 7320 746f 2025 732e 222c 0d0a  om %s to %s.",..
+00060120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00060130: 2020 2020 2020 2070 6172 7469 6369 7061         participa
+00060140: 6e74 732c 2073 6570 3d22 2c22 2929 0d0a  nts, sep=","))..
+00060150: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00060160: 6920 696e 2070 6172 7473 3a0d 0a20 2020  i in parts:..   
+00060170: 2020 2020 2020 2020 2020 2020 2069 6e66               inf
+00060180: 6f20 2b3d 2028 2222 2069 6620 6920 3d3d  o += ("" if i ==
+00060190: 2070 6172 7473 5b30 5d20 656c 7365 2028   parts[0] else (
+000601a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000601b0: 2020 2020 2020 2020 2020 2022 2061 6e64             " and
+000601c0: 2022 2069 6620 6920 3d3d 2070 6172 7473   " if i == parts
+000601d0: 5b2d 315d 2065 6c73 6520 222c 2022 2929  [-1] else ", "))
+000601e0: 202b 2069 0d0a 0d0a 2020 2020 2020 2020   + i....        
+000601f0: 2020 2020 7072 6f63 6565 6420 3d20 7778      proceed = wx
+00060200: 2e4f 4b20 3d3d 2077 782e 4d65 7373 6167  .OK == wx.Messag
+00060210: 6542 6f78 280d 0a20 2020 2020 2020 2020  eBox(..         
+00060220: 2020 2020 2020 2022 436f 7079 2025 735c         "Copy %s\
+00060230: 6e5c 6e66 726f 6d20 2573 5c6e 5c6e 696e  n\nfrom %s\n\nin
+00060240: 746f 2025 733f 2220 2520 2869 6e66 6f2c  to %s?" % (info,
+00060250: 2064 6231 2c20 6462 3229 2c0d 0a20 2020   db1, db2),..   
+00060260: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+00060270: 662e 5469 746c 652c 2077 782e 4f4b 207c  f.Title, wx.OK |
+00060280: 2077 782e 4341 4e43 454c 207c 2077 782e   wx.CANCEL | wx.
+00060290: 4943 4f4e 5f49 4e46 4f52 4d41 5449 4f4e  ICON_INFORMATION
+000602a0: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
+000602b0: 6620 7072 6f63 6565 643a 0d0a 2020 2020  f proceed:..    
+000602c0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000602d0: 2e69 735f 6d65 7267 696e 6720 3d20 5472  .is_merging = Tr
+000602e0: 7565 0d0a 2020 2020 2020 2020 2020 2020  ue..            
+000602f0: 2020 2020 7472 793a 0d0a 2020 2020 2020      try:..      
+00060300: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00060310: 206e 6f74 2063 6861 7432 3a0d 0a20 2020   not chat2:..   
+00060320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00060330: 2020 2020 2063 6861 7432 203d 2063 6861       chat2 = cha
+00060340: 742e 636f 7079 2829 0d0a 2020 2020 2020  t.copy()..      
+00060350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00060360: 2020 7365 6c66 2e63 6861 745b 2263 3222    self.chat["c2"
+00060370: 5d20 3d20 6368 6174 320d 0a20 2020 2020  ] = chat2..     
+00060380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00060390: 2020 2063 6861 7432 5b22 6964 225d 203d     chat2["id"] =
+000603a0: 2064 6232 2e69 6e73 6572 745f 636f 6e76   db2.insert_conv
+000603b0: 6572 7361 7469 6f6e 2863 6861 7432 2c20  ersation(chat2, 
+000603c0: 6462 3129 0d0a 2020 2020 2020 2020 2020  db1)..          
+000603d0: 2020 2020 2020 2020 2020 6966 2070 6172            if par
+000603e0: 7469 6369 7061 6e74 733a 0d0a 2020 2020  ticipants:..    
+000603f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00060400: 2020 2020 6966 2063 6f6e 7461 6374 7332      if contacts2
+00060410: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00060420: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00060430: 6232 2e69 6e73 6572 745f 636f 6e74 6163  b2.insert_contac
+00060440: 7473 2863 6f6e 7461 6374 7332 2c20 6462  ts(contacts2, db
+00060450: 3129 0d0a 2020 2020 2020 2020 2020 2020  1)..            
+00060460: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00060470: 7020 696e 2070 6172 7469 6369 7061 6e74  p in participant
+00060480: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
+00060490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000604a0: 6966 2070 2069 6e20 636f 6e64 6966 663a  if p in condiff:
+000604b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000604c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000604d0: 2020 636f 6e64 6966 662e 7265 6d6f 7665    condiff.remove
+000604e0: 2870 290d 0a20 2020 2020 2020 2020 2020  (p)..           
+000604f0: 2020 2020 2020 2020 2020 2020 2064 6232               db2
+00060500: 2e69 6e73 6572 745f 7061 7274 6963 6970  .insert_particip
+00060510: 616e 7473 2863 6861 7432 2c20 7061 7274  ants(chat2, part
+00060520: 6963 6970 616e 7473 2c20 6462 3129 0d0a  icipants, db1)..
+00060530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00060540: 2020 2020 2020 2020 6465 6c20 7061 7274          del part
+00060550: 6963 6970 616e 7473 5b3a 5d0d 0a20 2020  icipants[:]..   
+00060560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00060570: 2069 6620 6d65 7373 6167 6573 3a0d 0a20   if messages:.. 
+00060580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00060590: 2020 2020 2020 2064 6232 2e69 6e73 6572         db2.inser
+000605a0: 745f 6d65 7373 6167 6573 2863 6861 7432  t_messages(chat2
+000605b0: 2c20 6d65 7373 6167 6573 2c20 6462 312c  , messages, db1,
+000605c0: 2063 6861 7429 0d0a 2020 2020 2020 2020   chat)..        
 000605d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000605e0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000605f0: 6e66 6f2c 2063 6861 7432 5b22 7469 746c  nfo, chat2["titl
-00060600: 6522 5d2c 2064 6231 2c20 6462 322c 206c  e"], db1, db2, l
-00060610: 6f67 3d54 7275 6529 0d0a 2020 2020 2020  og=True)..      
-00060620: 2020 2020 2020 2020 2020 2320 5570 6461            # Upda
-00060630: 7465 2063 6861 7420 6c69 7374 0d0a 2020  te chat list..  
-00060640: 2020 2020 2020 2020 2020 2020 2020 6462                db
-00060650: 322e 6765 745f 636f 6e76 6572 7361 7469  2.get_conversati
-00060660: 6f6e 735f 7374 6174 7328 5b63 6861 7432  ons_stats([chat2
-00060670: 5d2c 206c 6f67 3d46 616c 7365 290d 0a20  ], log=False).. 
-00060680: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00060690: 656c 662e 6368 6174 5b22 6d65 7373 6167  elf.chat["messag
-000606a0: 6573 3222 5d20 3d20 6368 6174 325b 226d  es2"] = chat2["m
-000606b0: 6573 7361 6765 5f63 6f75 6e74 225d 0d0a  essage_count"]..
-000606c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000606d0: 7365 6c66 2e63 6861 745b 226c 6173 745f  self.chat["last_
-000606e0: 6d65 7373 6167 655f 6461 7465 7469 6d65  message_datetime
-000606f0: 3222 5d20 3d20 5c0d 0a20 2020 2020 2020  2"] = \..       
-00060700: 2020 2020 2020 2020 2020 2020 2063 6861               cha
-00060710: 7432 5b22 6c61 7374 5f6d 6573 7361 6765  t2["last_message
-00060720: 5f64 6174 6574 696d 6522 5d0d 0a20 2020  _datetime"]..   
-00060730: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-00060740: 2069 2069 6e20 7261 6e67 6528 7365 6c66   i in range(self
-00060750: 2e6c 6973 745f 6368 6174 732e 4974 656d  .list_chats.Item
-00060760: 436f 756e 7429 3a0d 0a20 2020 2020 2020  Count):..       
-00060770: 2020 2020 2020 2020 2020 2020 2063 6861               cha
-00060780: 745f 6920 3d20 7365 6c66 2e6c 6973 745f  t_i = self.list_
-00060790: 6368 6174 732e 4765 7449 7465 6d4d 6170  chats.GetItemMap
-000607a0: 7065 6444 6174 6128 6929 0d0a 2020 2020  pedData(i)..    
-000607b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000607c0: 6966 2063 6861 745f 6920 3d3d 2073 656c  if chat_i == sel
-000607d0: 662e 6368 6174 3a0d 0a20 2020 2020 2020  f.chat:..       
-000607e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000607f0: 2073 656c 662e 6c69 7374 5f63 6861 7473   self.list_chats
-00060800: 2e53 6574 4974 656d 4261 636b 6772 6f75  .SetItemBackgrou
-00060810: 6e64 436f 6c6f 7572 280d 0a20 2020 2020  ndColour(..     
-00060820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060830: 2020 2020 2020 2069 2c20 7365 6c66 2e6c         i, self.l
-00060840: 6973 745f 6368 6174 732e 4261 636b 6772  ist_chats.Backgr
-00060850: 6f75 6e64 436f 6c6f 7572 290d 0a20 2020  oundColour)..   
-00060860: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00060870: 662e 6c69 7374 5f63 6861 7473 2e52 6566  f.list_chats.Ref
-00060880: 7265 7368 526f 7773 2829 2023 2055 7064  reshRows() # Upd
-00060890: 6174 6520 6672 6f6d 206c 6f61 6465 6420  ate from loaded 
-000608a0: 6461 7461 0d0a 2020 2020 2020 2020 2020  data..          
-000608b0: 2020 2020 2020 696e 666f 6d73 6720 3d20        infomsg = 
-000608c0: 224d 6572 6765 6420 2573 206f 6620 6368  "Merged %s of ch
-000608d0: 6174 205c 2225 735c 225c 6e5c 6e66 726f  at \"%s\"\n\nfro
-000608e0: 6d20 2573 5c6e 5c6e 746f 2025 732e 2220  m %s\n\nto %s." 
-000608f0: 2520 5c0d 0a20 2020 2020 2020 2020 2020  % \..           
-00060900: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-00060910: 696e 666f 2c20 6368 6174 325b 2274 6974  info, chat2["tit
-00060920: 6c65 225d 2c20 6462 312c 2064 6232 290d  le"], db1, db2).
-00060930: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00060940: 2077 782e 4d65 7373 6167 6542 6f78 2869   wx.MessageBox(i
-00060950: 6e66 6f6d 7367 2c20 636f 6e66 2e54 6974  nfomsg, conf.Tit
-00060960: 6c65 2c20 7778 2e4f 4b20 7c20 7778 2e49  le, wx.OK | wx.I
-00060970: 434f 4e5f 494e 464f 524d 4154 494f 4e29  CON_INFORMATION)
-00060980: 0d0a 0d0a 0d0a 2020 2020 6465 6620 7570  ......    def up
-00060990: 6461 7465 5f74 6162 6865 6164 6572 2873  date_tabheader(s
-000609a0: 656c 6629 3a0d 0a20 2020 2020 2020 2022  elf):..        "
-000609b0: 2222 5570 6461 7465 7320 7061 6765 2074  ""Updates page t
-000609c0: 6162 2068 6561 6465 7220 7769 7468 206f  ab header with o
-000609d0: 7074 696f 6e20 746f 2063 6c6f 7365 2070  ption to close p
-000609e0: 6167 652e 2222 220d 0a20 2020 2020 2020  age."""..       
-000609f0: 2069 6620 7365 6c66 3a0d 0a20 2020 2020   if self:..     
-00060a00: 2020 2020 2020 2073 656c 662e 7265 6164         self.read
-00060a10: 795f 746f 5f63 6c6f 7365 203d 2054 7275  y_to_close = Tru
-00060a20: 650d 0a20 2020 2020 2020 2069 6620 7365  e..        if se
-00060a30: 6c66 3a0d 0a20 2020 2020 2020 2020 2020  lf:..           
-00060a40: 2073 656c 662e 546f 704c 6576 656c 5061   self.TopLevelPa
-00060a50: 7265 6e74 2e75 7064 6174 655f 6e6f 7465  rent.update_note
-00060a60: 626f 6f6b 5f68 6561 6465 7228 290d 0a0d  book_header()...
-00060a70: 0a0d 0a20 2020 2064 6566 206c 6f61 645f  ...    def load_
-00060a80: 6461 7461 2873 656c 6629 3a0d 0a20 2020  data(self):..   
-00060a90: 2020 2020 2022 2222 4c6f 6164 7320 6461       """Loads da
-00060aa0: 7461 2066 726f 6d20 6f75 7220 536b 7970  ta from our Skyp
-00060ab0: 6544 6174 6162 6173 6573 2e22 2222 0d0a  eDatabases."""..
-00060ac0: 2020 2020 2020 2020 6e61 6d65 7370 6163          namespac
-00060ad0: 6520 3d20 7b22 6462 3122 3a20 7365 6c66  e = {"db1": self
-00060ae0: 2e64 6231 2c20 2264 6232 223a 2073 656c  .db1, "db2": sel
-00060af0: 662e 6462 327d 0d0a 2020 2020 2020 2020  f.db2}..        
-00060b00: 7465 6d70 6c61 7465 203d 2073 7465 702e  template = step.
-00060b10: 5465 6d70 6c61 7465 2874 656d 706c 6174  Template(templat
-00060b20: 6573 2e4d 4552 4745 5f44 425f 4c49 4e4b  es.MERGE_DB_LINK
-00060b30: 532c 2065 7363 6170 653d 5472 7565 290d  S, escape=True).
-00060b40: 0a20 2020 2020 2020 2073 656c 662e 6874  .        self.ht
-00060b50: 6d6c 5f64 626c 6162 656c 2e53 6574 5061  ml_dblabel.SetPa
-00060b60: 6765 2874 656d 706c 6174 652e 6578 7061  ge(template.expa
-00060b70: 6e64 286e 616d 6573 7061 6365 2929 0d0a  nd(namespace))..
-00060b80: 2020 2020 2020 2020 7365 6c66 2e68 746d          self.htm
-00060b90: 6c5f 6462 6c61 6265 6c2e 4261 636b 6772  l_dblabel.Backgr
-00060ba0: 6f75 6e64 436f 6c6f 7572 203d 2077 782e  oundColour = wx.
-00060bb0: 4e75 6c6c 436f 6c6f 7572 0d0a 0d0a 2020  NullColour....  
-00060bc0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-00060bd0: 6e63 6528 7365 6c66 2e64 6231 2c20 6c69  nce(self.db1, li
-00060be0: 7665 2e53 6b79 7065 4578 706f 7274 2920  ve.SkypeExport) 
-00060bf0: 616e 6420 6e6f 7420 7365 6c66 2e64 6231  and not self.db1
-00060c00: 2e65 7870 6f72 745f 7061 7273 6564 3a0d  .export_parsed:.
-00060c10: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00060c20: 662e 6275 7474 6f6e 5f73 7761 702e 4869  f.button_swap.Hi
-00060c30: 6465 2829 0d0a 2020 2020 2020 2020 2020  de()..          
-00060c40: 2020 7365 6c66 2e77 6f72 6b65 725f 696d    self.worker_im
-00060c50: 706f 7274 2e77 6f72 6b28 7b22 6163 7469  port.work({"acti
-00060c60: 6f6e 223a 2022 7061 7273 6522 2c20 2264  on": "parse", "d
-00060c70: 6222 3a20 7365 6c66 2e64 6231 7d29 0d0a  b": self.db1})..
-00060c80: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00060c90: 2e68 746d 6c5f 7265 706f 7274 2e53 686f  .html_report.Sho
-00060ca0: 7728 290d 0a0d 0a20 2020 2020 2020 2020  w()....         
-00060cb0: 2020 2068 746d 6c20 3d20 2822 3c62 6f64     html = ("<bod
-00060cc0: 7920 6267 636f 6c6f 723d 2725 7327 3e3c  y bgcolor='%s'><
-00060cd0: 666f 6e74 2063 6f6c 6f72 3d27 2573 273e  font color='%s'>
-00060ce0: 5061 7273 696e 6720 536b 7970 6520 6368  Parsing Skype ch
-00060cf0: 6174 2068 6973 746f 7279 2065 7870 6f72  at history expor
-00060d00: 7420 2573 202e 2e22 2025 0d0a 2020 2020  t %s .." %..    
-00060d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060d20: 2863 6f6e 662e 4d65 7267 6548 746d 6c42  (conf.MergeHtmlB
-00060d30: 6163 6b67 726f 756e 6443 6f6c 6f75 722c  ackgroundColour,
-00060d40: 2063 6f6e 662e 4667 436f 6c6f 7572 2c20   conf.FgColour, 
-00060d50: 7365 6c66 2e64 6231 2929 0d0a 2020 2020  self.db1))..    
-00060d60: 2020 2020 2020 2020 7365 6c66 2e68 746d          self.htm
-00060d70: 6c5f 7265 706f 7274 2e53 6574 5061 6765  l_report.SetPage
-00060d80: 2868 746d 6c29 0d0a 2020 2020 2020 2020  (html)..        
-00060d90: 2020 2020 7365 6c66 2e75 7064 6174 655f      self.update_
-00060da0: 6761 7567 6528 7365 6c66 2e67 6175 6765  gauge(self.gauge
-00060db0: 5f70 726f 6772 6573 732c 2030 290d 0a20  _progress, 0).. 
-00060dc0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00060dd0: 6761 7567 655f 7072 6f67 7265 7373 2e50  gauge_progress.P
-00060de0: 756c 7365 2829 0d0a 2020 2020 2020 2020  ulse()..        
-00060df0: 2020 2020 7365 6c66 2e75 7064 6174 655f      self.update_
-00060e00: 7461 6268 6561 6465 7228 290d 0a0d 0a20  tabheader().... 
-00060e10: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
-00060e20: 2069 6e20 7261 6e67 6528 3229 3a0d 0a20   in range(2):.. 
-00060e30: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00060e40: 6220 3d20 7365 6c66 2e64 6232 2069 6620  b = self.db2 if 
-00060e50: 6920 656c 7365 2073 656c 662e 6462 310d  i else self.db1.
-00060e60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00060e70: 2064 622e 7570 6461 7465 5f66 696c 6569   db.update_filei
-00060e80: 6e66 6f28 290d 0a20 2020 2020 2020 2020  nfo()..         
-00060e90: 2020 2020 2020 206c 6162 656c 203d 2073         label = s
-00060ea0: 656c 662e 6c61 6265 6c5f 616c 6c32 2069  elf.label_all2 i
-00060eb0: 6620 6920 656c 7365 2073 656c 662e 6c61  f i else self.la
-00060ec0: 6265 6c5f 616c 6c31 0d0a 2020 2020 2020  bel_all1..      
-00060ed0: 2020 2020 2020 2020 2020 6c61 6265 6c2e            label.
-00060ee0: 4c61 6265 6c20 3d20 2225 732e 5c6e 5c6e  Label = "%s.\n\n
-00060ef0: 5369 7a65 2025 732e 5c6e 416e 616c 797a  Size %s.\nAnalyz
-00060f00: 696e 672e 2e22 2025 2028 0d0a 2020 2020  ing.." % (..    
-00060f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060f20: 2020 2020 2020 2020 2020 6462 2c20 7574            db, ut
-00060f30: 696c 2e66 6f72 6d61 745f 6279 7465 7328  il.format_bytes(
-00060f40: 6462 2e66 696c 6573 697a 6529 290d 0a20  db.filesize)).. 
-00060f50: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00060f60: 6e0d 0a0d 0a20 2020 2020 2020 2074 7279  n....        try
-00060f70: 3a0d 0a20 2020 2020 2020 2020 2020 2023  :..            #
-00060f80: 2050 6f70 756c 6174 6520 7468 6520 6368   Populate the ch
-00060f90: 6174 2063 6f6d 7061 7269 736f 6e20 6c69  at comparison li
-00060fa0: 7374 0d0a 2020 2020 2020 2020 2020 2020  st..            
-00060fb0: 6368 6174 7331 203d 2073 656c 662e 6462  chats1 = self.db
-00060fc0: 312e 6765 745f 636f 6e76 6572 7361 7469  1.get_conversati
-00060fd0: 6f6e 7328 290d 0a20 2020 2020 2020 2020  ons()..         
-00060fe0: 2020 2063 6861 7473 3220 3d20 7365 6c66     chats2 = self
-00060ff0: 2e64 6232 2e67 6574 5f63 6f6e 7665 7273  .db2.get_convers
-00061000: 6174 696f 6e73 2829 0d0a 2020 2020 2020  ations()..      
-00061010: 2020 2020 2020 6331 6d61 7020 3d20 6469        c1map = di
-00061020: 6374 2828 635b 2269 6465 6e74 6974 7922  ct((c["identity"
-00061030: 5d2c 2063 2920 666f 7220 6320 696e 2063  ], c) for c in c
-00061040: 6861 7473 3129 0d0a 2020 2020 2020 2020  hats1)..        
-00061050: 2020 2020 6332 6d61 7020 3d20 6469 6374      c2map = dict
-00061060: 2828 635b 2269 6465 6e74 6974 7922 5d2c  ((c["identity"],
-00061070: 2063 2920 666f 7220 6320 696e 2063 6861   c) for c in cha
-00061080: 7473 3229 0d0a 2020 2020 2020 2020 2020  ts2)..          
-00061090: 2020 666f 7220 6d6d 2c20 6363 2069 6e20    for mm, cc in 
-000610a0: 2863 316d 6170 2c20 6368 6174 7331 292c  (c1map, chats1),
-000610b0: 2028 6332 6d61 702c 2063 6861 7473 3229   (c2map, chats2)
-000610c0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-000610d0: 2020 2066 6f72 2063 2069 6e20 2863 2066     for c in (c f
-000610e0: 6f72 2063 2069 6e20 6363 2069 6620 632e  or c in cc if c.
-000610f0: 6765 7428 225f 5f6c 696e 6b22 2929 3a0d  get("__link")):.
-00061100: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00061110: 2020 2020 206d 6d5b 635b 225f 5f6c 696e       mm[c["__lin
-00061120: 6b22 5d5b 2269 6465 6e74 6974 7922 5d5d  k"]["identity"]]
-00061130: 203d 2063 0d0a 2020 2020 2020 2020 2020   = c..          
-00061140: 2020 6465 6620 6765 745f 6d61 7463 6865    def get_matche
-00061150: 6428 636d 6170 2c20 6329 3a0d 0a20 2020  d(cmap, c):..   
-00061160: 2020 2020 2020 2020 2020 2020 2078 203d               x =
-00061170: 2063 6d61 702e 6765 7428 635b 2269 6465   cmap.get(c["ide
-00061180: 6e74 6974 7922 5d29 0d0a 2020 2020 2020  ntity"])..      
-00061190: 2020 2020 2020 2020 2020 7820 3d20 7820            x = x 
-000611a0: 6f72 2063 2e67 6574 2822 5f5f 6c69 6e6b  or c.get("__link
-000611b0: 2229 2061 6e64 2063 6d61 702e 6765 7428  ") and cmap.get(
-000611c0: 635b 225f 5f6c 696e 6b22 5d5b 2269 6465  c["__link"]["ide
-000611d0: 6e74 6974 7922 5d29 0d0a 2020 2020 2020  ntity"])..      
-000611e0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000611f0: 2078 0d0a 0d0a 2020 2020 2020 2020 2020   x....          
-00061200: 2020 636f 6d70 6172 6564 203d 205b 5d0d    compared = [].
-00061210: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00061220: 2063 3120 696e 2063 6861 7473 313a 0d0a   c1 in chats1:..
-00061230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00061240: 6331 5b22 6331 225d 2c20 6331 5b22 6332  c1["c1"], c1["c2
-00061250: 225d 203d 2063 312e 636f 7079 2829 2c20  "] = c1.copy(), 
-00061260: 6765 745f 6d61 7463 6865 6428 6332 6d61  get_matched(c2ma
-00061270: 702c 2063 3129 0d0a 2020 2020 2020 2020  p, c1)..        
-00061280: 2020 2020 2020 2020 636f 6d70 6172 6564          compared
-00061290: 2e61 7070 656e 6428 6331 290d 0a20 2020  .append(c1)..   
-000612a0: 2020 2020 2020 2020 2066 6f72 2063 3220           for c2 
-000612b0: 696e 2063 6861 7473 323a 0d0a 2020 2020  in chats2:..    
-000612c0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-000612d0: 6f74 2067 6574 5f6d 6174 6368 6564 2863  ot get_matched(c
-000612e0: 316d 6170 2c20 6332 293a 0d0a 2020 2020  1map, c2):..    
+000605e0: 6465 6c20 6d65 7373 6167 6573 5b3a 5d0d  del messages[:].
+000605f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00060600: 2066 696e 616c 6c79 3a0d 0a20 2020 2020   finally:..     
+00060610: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00060620: 656c 662e 6973 5f6d 6572 6769 6e67 203d  elf.is_merging =
+00060630: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
+00060640: 2020 2020 2020 2020 6966 2063 6861 745b          if chat[
+00060650: 2269 6465 6e74 6974 7922 5d20 696e 2073  "identity"] in s
+00060660: 656c 662e 6368 6174 735f 6469 6666 6461  elf.chats_diffda
+00060670: 7461 3a0d 0a20 2020 2020 2020 2020 2020  ta:..           
+00060680: 2020 2020 2020 2020 2064 656c 2073 656c           del sel
+00060690: 662e 6368 6174 735f 6469 6666 6461 7461  f.chats_diffdata
+000606a0: 5b63 6861 745b 2269 6465 6e74 6974 7922  [chat["identity"
+000606b0: 5d5d 0d0a 2020 2020 2020 2020 2020 2020  ]]..            
+000606c0: 2020 2020 6462 322e 636c 6561 725f 6361      db2.clear_ca
+000606d0: 6368 6528 290d 0a20 2020 2020 2020 2020  che()..         
+000606e0: 2020 2020 2020 2073 656c 662e 7374 635f         self.stc_
+000606f0: 6469 6666 312e 436c 6561 7241 6c6c 2829  diff1.ClearAll()
+00060700: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00060710: 2020 7365 6c66 2e62 7574 746f 6e5f 6d65    self.button_me
+00060720: 7267 655f 6368 6174 2e45 6e61 626c 6564  rge_chat.Enabled
+00060730: 203d 2046 616c 7365 0d0a 2020 2020 2020   = False..      
+00060740: 2020 2020 2020 2020 2020 7365 6c66 2e62            self.b
+00060750: 7574 746f 6e5f 6578 706f 7274 5f63 6861  utton_export_cha
+00060760: 742e 456e 6162 6c65 6420 3d20 4661 6c73  t.Enabled = Fals
+00060770: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
+00060780: 2020 2067 7569 6261 7365 2e73 7461 7475     guibase.statu
+00060790: 7328 224d 6572 6765 6420 2573 206f 6620  s("Merged %s of 
+000607a0: 6368 6174 205c 2225 735c 2220 6672 6f6d  chat \"%s\" from
+000607b0: 2025 7320 746f 2025 732e 222c 0d0a 2020   %s to %s.",..  
+000607c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000607d0: 2020 2020 2020 2020 2020 2020 2069 6e66               inf
+000607e0: 6f2c 2063 6861 7432 5b22 7469 746c 6522  o, chat2["title"
+000607f0: 5d2c 2064 6231 2c20 6462 322c 206c 6f67  ], db1, db2, log
+00060800: 3d54 7275 6529 0d0a 2020 2020 2020 2020  =True)..        
+00060810: 2020 2020 2020 2020 2320 5570 6461 7465          # Update
+00060820: 2063 6861 7420 6c69 7374 0d0a 2020 2020   chat list..    
+00060830: 2020 2020 2020 2020 2020 2020 6462 322e              db2.
+00060840: 6765 745f 636f 6e76 6572 7361 7469 6f6e  get_conversation
+00060850: 735f 7374 6174 7328 5b63 6861 7432 5d2c  s_stats([chat2],
+00060860: 206c 6f67 3d46 616c 7365 290d 0a20 2020   log=False)..   
+00060870: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00060880: 662e 6368 6174 5b22 6d65 7373 6167 6573  f.chat["messages
+00060890: 3222 5d20 3d20 6368 6174 325b 226d 6573  2"] = chat2["mes
+000608a0: 7361 6765 5f63 6f75 6e74 225d 0d0a 2020  sage_count"]..  
+000608b0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+000608c0: 6c66 2e63 6861 745b 226c 6173 745f 6d65  lf.chat["last_me
+000608d0: 7373 6167 655f 6461 7465 7469 6d65 3222  ssage_datetime2"
+000608e0: 5d20 3d20 5c0d 0a20 2020 2020 2020 2020  ] = \..         
+000608f0: 2020 2020 2020 2020 2020 2063 6861 7432             chat2
+00060900: 5b22 6c61 7374 5f6d 6573 7361 6765 5f64  ["last_message_d
+00060910: 6174 6574 696d 6522 5d0d 0a20 2020 2020  atetime"]..     
+00060920: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
+00060930: 2069 6e20 7261 6e67 6528 7365 6c66 2e6c   in range(self.l
+00060940: 6973 745f 6368 6174 732e 4974 656d 436f  ist_chats.ItemCo
+00060950: 756e 7429 3a0d 0a20 2020 2020 2020 2020  unt):..         
+00060960: 2020 2020 2020 2020 2020 2063 6861 745f             chat_
+00060970: 6920 3d20 7365 6c66 2e6c 6973 745f 6368  i = self.list_ch
+00060980: 6174 732e 4765 7449 7465 6d4d 6170 7065  ats.GetItemMappe
+00060990: 6444 6174 6128 6929 0d0a 2020 2020 2020  dData(i)..      
+000609a0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000609b0: 2063 6861 745f 6920 3d3d 2073 656c 662e   chat_i == self.
+000609c0: 6368 6174 3a0d 0a20 2020 2020 2020 2020  chat:..         
+000609d0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000609e0: 656c 662e 6c69 7374 5f63 6861 7473 2e53  elf.list_chats.S
+000609f0: 6574 4974 656d 4261 636b 6772 6f75 6e64  etItemBackground
+00060a00: 436f 6c6f 7572 280d 0a20 2020 2020 2020  Colour(..       
+00060a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00060a20: 2020 2020 2069 2c20 7365 6c66 2e6c 6973       i, self.lis
+00060a30: 745f 6368 6174 732e 4261 636b 6772 6f75  t_chats.Backgrou
+00060a40: 6e64 436f 6c6f 7572 290d 0a20 2020 2020  ndColour)..     
+00060a50: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00060a60: 6c69 7374 5f63 6861 7473 2e52 6566 7265  list_chats.Refre
+00060a70: 7368 526f 7773 2829 2023 2055 7064 6174  shRows() # Updat
+00060a80: 6520 6672 6f6d 206c 6f61 6465 6420 6461  e from loaded da
+00060a90: 7461 0d0a 2020 2020 2020 2020 2020 2020  ta..            
+00060aa0: 2020 2020 696e 666f 6d73 6720 3d20 224d      infomsg = "M
+00060ab0: 6572 6765 6420 2573 206f 6620 6368 6174  erged %s of chat
+00060ac0: 205c 2225 735c 225c 6e5c 6e66 726f 6d20   \"%s\"\n\nfrom 
+00060ad0: 2573 5c6e 5c6e 746f 2025 732e 2220 2520  %s\n\nto %s." % 
+00060ae0: 5c0d 0a20 2020 2020 2020 2020 2020 2020  \..             
+00060af0: 2020 2020 2020 2020 2020 2020 2028 696e               (in
+00060b00: 666f 2c20 6368 6174 325b 2274 6974 6c65  fo, chat2["title
+00060b10: 225d 2c20 6462 312c 2064 6232 290d 0a20  "], db1, db2).. 
+00060b20: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+00060b30: 782e 4d65 7373 6167 6542 6f78 2869 6e66  x.MessageBox(inf
+00060b40: 6f6d 7367 2c20 636f 6e66 2e54 6974 6c65  omsg, conf.Title
+00060b50: 2c20 7778 2e4f 4b20 7c20 7778 2e49 434f  , wx.OK | wx.ICO
+00060b60: 4e5f 494e 464f 524d 4154 494f 4e29 0d0a  N_INFORMATION)..
+00060b70: 0d0a 0d0a 2020 2020 6465 6620 7570 6461  ....    def upda
+00060b80: 7465 5f74 6162 6865 6164 6572 2873 656c  te_tabheader(sel
+00060b90: 6629 3a0d 0a20 2020 2020 2020 2022 2222  f):..        """
+00060ba0: 5570 6461 7465 7320 7061 6765 2074 6162  Updates page tab
+00060bb0: 2068 6561 6465 7220 7769 7468 206f 7074   header with opt
+00060bc0: 696f 6e20 746f 2063 6c6f 7365 2070 6167  ion to close pag
+00060bd0: 652e 2222 220d 0a20 2020 2020 2020 2069  e."""..        i
+00060be0: 6620 7365 6c66 3a0d 0a20 2020 2020 2020  f self:..       
+00060bf0: 2020 2020 2073 656c 662e 7265 6164 795f       self.ready_
+00060c00: 746f 5f63 6c6f 7365 203d 2054 7275 650d  to_close = True.
+00060c10: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00060c20: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+00060c30: 656c 662e 546f 704c 6576 656c 5061 7265  elf.TopLevelPare
+00060c40: 6e74 2e75 7064 6174 655f 6e6f 7465 626f  nt.update_notebo
+00060c50: 6f6b 5f68 6561 6465 7228 290d 0a0d 0a0d  ok_header().....
+00060c60: 0a20 2020 2064 6566 206c 6f61 645f 6461  .    def load_da
+00060c70: 7461 2873 656c 6629 3a0d 0a20 2020 2020  ta(self):..     
+00060c80: 2020 2022 2222 4c6f 6164 7320 6461 7461     """Loads data
+00060c90: 2066 726f 6d20 6f75 7220 536b 7970 6544   from our SkypeD
+00060ca0: 6174 6162 6173 6573 2e22 2222 0d0a 2020  atabases."""..  
+00060cb0: 2020 2020 2020 6e61 6d65 7370 6163 6520        namespace 
+00060cc0: 3d20 7b22 6462 3122 3a20 7365 6c66 2e64  = {"db1": self.d
+00060cd0: 6231 2c20 2264 6232 223a 2073 656c 662e  b1, "db2": self.
+00060ce0: 6462 327d 0d0a 2020 2020 2020 2020 7465  db2}..        te
+00060cf0: 6d70 6c61 7465 203d 2073 7465 702e 5465  mplate = step.Te
+00060d00: 6d70 6c61 7465 2874 656d 706c 6174 6573  mplate(templates
+00060d10: 2e4d 4552 4745 5f44 425f 4c49 4e4b 532c  .MERGE_DB_LINKS,
+00060d20: 2065 7363 6170 653d 5472 7565 290d 0a20   escape=True).. 
+00060d30: 2020 2020 2020 2073 656c 662e 6874 6d6c         self.html
+00060d40: 5f64 626c 6162 656c 2e53 6574 5061 6765  _dblabel.SetPage
+00060d50: 2874 656d 706c 6174 652e 6578 7061 6e64  (template.expand
+00060d60: 286e 616d 6573 7061 6365 2929 0d0a 2020  (namespace))..  
+00060d70: 2020 2020 2020 7365 6c66 2e68 746d 6c5f        self.html_
+00060d80: 6462 6c61 6265 6c2e 4261 636b 6772 6f75  dblabel.Backgrou
+00060d90: 6e64 436f 6c6f 7572 203d 2077 782e 4e75  ndColour = wx.Nu
+00060da0: 6c6c 436f 6c6f 7572 0d0a 0d0a 2020 2020  llColour....    
+00060db0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+00060dc0: 6528 7365 6c66 2e64 6231 2c20 6c69 7665  e(self.db1, live
+00060dd0: 2e53 6b79 7065 4578 706f 7274 2920 616e  .SkypeExport) an
+00060de0: 6420 6e6f 7420 7365 6c66 2e64 6231 2e65  d not self.db1.e
+00060df0: 7870 6f72 745f 7061 7273 6564 3a0d 0a20  xport_parsed:.. 
+00060e00: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00060e10: 6275 7474 6f6e 5f73 7761 702e 4869 6465  button_swap.Hide
+00060e20: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+00060e30: 7365 6c66 2e77 6f72 6b65 725f 696d 706f  self.worker_impo
+00060e40: 7274 2e77 6f72 6b28 7b22 6163 7469 6f6e  rt.work({"action
+00060e50: 223a 2022 7061 7273 6522 2c20 2264 6222  ": "parse", "db"
+00060e60: 3a20 7365 6c66 2e64 6231 7d29 0d0a 2020  : self.db1})..  
+00060e70: 2020 2020 2020 2020 2020 7365 6c66 2e68            self.h
+00060e80: 746d 6c5f 7265 706f 7274 2e53 686f 7728  tml_report.Show(
+00060e90: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
+00060ea0: 2068 746d 6c20 3d20 2822 3c62 6f64 7920   html = ("<body 
+00060eb0: 6267 636f 6c6f 723d 2725 7327 3e3c 666f  bgcolor='%s'><fo
+00060ec0: 6e74 2063 6f6c 6f72 3d27 2573 273e 5061  nt color='%s'>Pa
+00060ed0: 7273 696e 6720 536b 7970 6520 6368 6174  rsing Skype chat
+00060ee0: 2068 6973 746f 7279 2065 7870 6f72 7420   history export 
+00060ef0: 2573 202e 2e22 2025 0d0a 2020 2020 2020  %s .." %..      
+00060f00: 2020 2020 2020 2020 2020 2020 2020 2863                (c
+00060f10: 6f6e 662e 4d65 7267 6548 746d 6c42 6163  onf.MergeHtmlBac
+00060f20: 6b67 726f 756e 6443 6f6c 6f75 722c 2063  kgroundColour, c
+00060f30: 6f6e 662e 4667 436f 6c6f 7572 2c20 7365  onf.FgColour, se
+00060f40: 6c66 2e64 6231 2929 0d0a 2020 2020 2020  lf.db1))..      
+00060f50: 2020 2020 2020 7365 6c66 2e68 746d 6c5f        self.html_
+00060f60: 7265 706f 7274 2e53 6574 5061 6765 2868  report.SetPage(h
+00060f70: 746d 6c29 0d0a 2020 2020 2020 2020 2020  tml)..          
+00060f80: 2020 7365 6c66 2e75 7064 6174 655f 6761    self.update_ga
+00060f90: 7567 6528 7365 6c66 2e67 6175 6765 5f70  uge(self.gauge_p
+00060fa0: 726f 6772 6573 732c 2030 290d 0a20 2020  rogress, 0)..   
+00060fb0: 2020 2020 2020 2020 2073 656c 662e 6761           self.ga
+00060fc0: 7567 655f 7072 6f67 7265 7373 2e50 756c  uge_progress.Pul
+00060fd0: 7365 2829 0d0a 2020 2020 2020 2020 2020  se()..          
+00060fe0: 2020 7365 6c66 2e75 7064 6174 655f 7461    self.update_ta
+00060ff0: 6268 6561 6465 7228 290d 0a0d 0a20 2020  bheader()....   
+00061000: 2020 2020 2020 2020 2066 6f72 2069 2069           for i i
+00061010: 6e20 7261 6e67 6528 3229 3a0d 0a20 2020  n range(2):..   
+00061020: 2020 2020 2020 2020 2020 2020 2064 6220               db 
+00061030: 3d20 7365 6c66 2e64 6232 2069 6620 6920  = self.db2 if i 
+00061040: 656c 7365 2073 656c 662e 6462 310d 0a20  else self.db1.. 
+00061050: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00061060: 622e 7570 6461 7465 5f66 696c 6569 6e66  b.update_fileinf
+00061070: 6f28 290d 0a20 2020 2020 2020 2020 2020  o()..           
+00061080: 2020 2020 206c 6162 656c 203d 2073 656c       label = sel
+00061090: 662e 6c61 6265 6c5f 616c 6c32 2069 6620  f.label_all2 if 
+000610a0: 6920 656c 7365 2073 656c 662e 6c61 6265  i else self.labe
+000610b0: 6c5f 616c 6c31 0d0a 2020 2020 2020 2020  l_all1..        
+000610c0: 2020 2020 2020 2020 6c61 6265 6c2e 4c61          label.La
+000610d0: 6265 6c20 3d20 2225 732e 5c6e 5c6e 5369  bel = "%s.\n\nSi
+000610e0: 7a65 2025 732e 5c6e 416e 616c 797a 696e  ze %s.\nAnalyzin
+000610f0: 672e 2e22 2025 2028 0d0a 2020 2020 2020  g.." % (..      
+00061100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00061110: 2020 2020 2020 2020 6462 2c20 7574 696c          db, util
+00061120: 2e66 6f72 6d61 745f 6279 7465 7328 6462  .format_bytes(db
+00061130: 2e66 696c 6573 697a 6529 290d 0a20 2020  .filesize))..   
+00061140: 2020 2020 2020 2020 2072 6574 7572 6e0d           return.
+00061150: 0a0d 0a20 2020 2020 2020 2074 7279 3a0d  ...        try:.
+00061160: 0a20 2020 2020 2020 2020 2020 2023 2050  .            # P
+00061170: 6f70 756c 6174 6520 7468 6520 6368 6174  opulate the chat
+00061180: 2063 6f6d 7061 7269 736f 6e20 6c69 7374   comparison list
+00061190: 0d0a 2020 2020 2020 2020 2020 2020 6368  ..            ch
+000611a0: 6174 7331 203d 2073 656c 662e 6462 312e  ats1 = self.db1.
+000611b0: 6765 745f 636f 6e76 6572 7361 7469 6f6e  get_conversation
+000611c0: 7328 290d 0a20 2020 2020 2020 2020 2020  s()..           
+000611d0: 2063 6861 7473 3220 3d20 7365 6c66 2e64   chats2 = self.d
+000611e0: 6232 2e67 6574 5f63 6f6e 7665 7273 6174  b2.get_conversat
+000611f0: 696f 6e73 2829 0d0a 2020 2020 2020 2020  ions()..        
+00061200: 2020 2020 6331 6d61 7020 3d20 6469 6374      c1map = dict
+00061210: 2828 635b 2269 6465 6e74 6974 7922 5d2c  ((c["identity"],
+00061220: 2063 2920 666f 7220 6320 696e 2063 6861   c) for c in cha
+00061230: 7473 3129 0d0a 2020 2020 2020 2020 2020  ts1)..          
+00061240: 2020 6332 6d61 7020 3d20 6469 6374 2828    c2map = dict((
+00061250: 635b 2269 6465 6e74 6974 7922 5d2c 2063  c["identity"], c
+00061260: 2920 666f 7220 6320 696e 2063 6861 7473  ) for c in chats
+00061270: 3229 0d0a 2020 2020 2020 2020 2020 2020  2)..            
+00061280: 666f 7220 6d6d 2c20 6363 2069 6e20 2863  for mm, cc in (c
+00061290: 316d 6170 2c20 6368 6174 7331 292c 2028  1map, chats1), (
+000612a0: 6332 6d61 702c 2063 6861 7473 3229 3a0d  c2map, chats2):.
+000612b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000612c0: 2066 6f72 2063 2069 6e20 2863 2066 6f72   for c in (c for
+000612d0: 2063 2069 6e20 6363 2069 6620 632e 6765   c in cc if c.ge
+000612e0: 7428 225f 5f6c 696e 6b22 2929 3a0d 0a20  t("__link")):.. 
 000612f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00061300: 6332 5b22 6331 225d 2c20 6332 5b22 6332  c2["c1"], c2["c2
-00061310: 225d 203d 204e 6f6e 652c 2063 322e 636f  "] = None, c2.co
-00061320: 7079 2829 0d0a 2020 2020 2020 2020 2020  py()..          
-00061330: 2020 2020 2020 2020 2020 636f 6d70 6172            compar
-00061340: 6564 2e61 7070 656e 6428 6332 290d 0a20  ed.append(c2).. 
-00061350: 2020 2020 2020 2020 2020 2066 6f72 2063             for c
-00061360: 2069 6e20 636f 6d70 6172 6564 3a0d 0a20   in compared:.. 
-00061370: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00061380: 5b22 6c61 7374 5f6d 6573 7361 6765 5f64  ["last_message_d
-00061390: 6174 6574 696d 6531 225d 203d 204e 6f6e  atetime1"] = Non
-000613a0: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
-000613b0: 2020 2063 5b22 6c61 7374 5f6d 6573 7361     c["last_messa
-000613c0: 6765 5f64 6174 6574 696d 6532 225d 203d  ge_datetime2"] =
-000613d0: 204e 6f6e 650d 0a20 2020 2020 2020 2020   None..         
-000613e0: 2020 2020 2020 2063 5b22 6d65 7373 6167         c["messag
-000613f0: 6573 3122 5d20 3d20 635b 226d 6573 7361  es1"] = c["messa
-00061400: 6765 7332 225d 203d 2063 5b22 7065 6f70  ges2"] = c["peop
-00061410: 6c65 225d 203d 204e 6f6e 650d 0a0d 0a20  le"] = None.... 
-00061420: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00061430: 6c69 7374 5f63 6861 7473 2e50 6f70 756c  list_chats.Popul
-00061440: 6174 6528 636f 6d70 6172 6564 290d 0a20  ate(compared).. 
-00061450: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00061460: 6c69 7374 5f63 6861 7473 2e53 6f72 744c  list_chats.SortL
-00061470: 6973 7449 7465 6d73 2833 2c20 3029 2023  istItems(3, 0) #
-00061480: 2053 6f72 7420 6279 206c 6173 7420 6d65   Sort by last me
-00061490: 7373 6167 6520 696e 206c 6566 740d 0a20  ssage in left.. 
-000614a0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000614b0: 636f 6d70 6172 6564 203d 2063 6f6d 7061  compared = compa
-000614c0: 7265 640d 0a20 2020 2020 2020 2020 2020  red..           
-000614d0: 2073 656c 662e 6368 6174 7331 203d 2063   self.chats1 = c
-000614e0: 6861 7473 310d 0a20 2020 2020 2020 2020  hats1..         
-000614f0: 2020 2073 656c 662e 6368 6174 7332 203d     self.chats2 =
-00061500: 2063 6861 7473 320d 0a20 2020 2020 2020   chats2..       
-00061510: 2020 2020 2077 782e 4361 6c6c 4c61 7465       wx.CallLate
-00061520: 7228 3230 302c 2073 656c 662e 6c6f 6164  r(200, self.load
-00061530: 5f6c 6174 6572 5f64 6174 6129 0d0a 2020  _later_data)..  
-00061540: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
-00061550: 6570 7469 6f6e 2061 7320 653a 0d0a 2020  eption as e:..  
-00061560: 2020 2020 2020 2020 2020 7778 2e43 616c            wx.Cal
-00061570: 6c41 6674 6572 2873 656c 662e 7570 6461  lAfter(self.upda
-00061580: 7465 5f74 6162 6865 6164 6572 290d 0a20  te_tabheader).. 
-00061590: 2020 2020 2020 2020 2020 2067 7569 6261             guiba
-000615a0: 7365 2e73 7461 7475 7328 2243 6f75 6c64  se.status("Could
-000615b0: 206e 6f74 206c 6f61 6420 6368 6174 206c   not load chat l
-000615c0: 6973 7473 2066 726f 6d20 2573 2061 6e64  ists from %s and
-000615d0: 2025 733a 2025 7322 2c0d 0a20 2020 2020   %s: %s",..     
-000615e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000615f0: 2020 2020 2020 7365 6c66 2e64 6231 2c20        self.db1, 
-00061600: 7365 6c66 2e64 6232 2c20 7574 696c 2e66  self.db2, util.f
-00061610: 6f72 6d61 745f 6578 6328 6529 290d 0a20  ormat_exc(e)).. 
-00061620: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
-00061630: 722e 6578 6365 7074 696f 6e28 2243 6f75  r.exception("Cou
-00061640: 6c64 206e 6f74 206c 6f61 6420 6368 6174  ld not load chat
-00061650: 206c 6973 7473 2066 726f 6d20 2573 2061   lists from %s a
-00061660: 6e64 2025 732e 222c 0d0a 2020 2020 2020  nd %s.",..      
-00061670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00061680: 2020 2020 2020 2073 656c 662e 6462 312c         self.db1,
-00061690: 2073 656c 662e 6462 3229 0d0a 2020 2020   self.db2)..    
-000616a0: 2020 2020 2020 2020 6572 726f 726d 7367          errormsg
-000616b0: 203d 2022 436f 756c 6420 6e6f 7420 6c6f   = "Could not lo
-000616c0: 6164 2063 6861 7420 6c69 7374 7320 6672  ad chat lists fr
-000616d0: 6f6d 2025 7320 616e 6420 2573 2e5c 6e5c  om %s and %s.\n\
-000616e0: 6e25 7322 2025 205c 0d0a 2020 2020 2020  n%s" % \..      
-000616f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00061700: 2028 7365 6c66 2e64 6231 2c20 7365 6c66   (self.db1, self
-00061710: 2e64 6232 2c20 7472 6163 6562 6163 6b2e  .db2, traceback.
-00061720: 666f 726d 6174 5f65 7863 2829 290d 0a20  format_exc()).. 
-00061730: 2020 2020 2020 2020 2020 2077 782e 4d65             wx.Me
-00061740: 7373 6167 6542 6f78 2865 7272 6f72 6d73  ssageBox(errorms
-00061750: 672c 2063 6f6e 662e 5469 746c 652c 2077  g, conf.Title, w
-00061760: 782e 4f4b 207c 2077 782e 4943 4f4e 5f57  x.OK | wx.ICON_W
-00061770: 4152 4e49 4e47 290d 0a0d 0a0d 0a20 2020  ARNING)......   
-00061780: 2064 6566 206c 6f61 645f 6c61 7465 725f   def load_later_
-00061790: 6461 7461 2873 656c 6629 3a0d 0a20 2020  data(self):..   
-000617a0: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-000617b0: 2020 4c6f 6164 7320 6c61 7465 7220 6461    Loads later da
-000617c0: 7461 2066 726f 6d20 7468 6520 6461 7461  ta from the data
-000617d0: 6261 7365 732c 206c 696b 6520 6d65 7373  bases, like mess
-000617e0: 6167 6520 636f 756e 7473 2061 6e64 2063  age counts and c
-000617f0: 6f6d 7061 7265 640d 0a20 2020 2020 2020  ompared..       
-00061800: 2063 6f6e 7461 6374 732c 2075 7365 6420   contacts, used 
-00061810: 6173 2061 2062 6163 6b67 726f 756e 6420  as a background 
-00061820: 6361 6c6c 6261 636b 2074 6f20 7370 6565  callback to spee
-00061830: 6420 7570 2070 6167 6520 6f70 656e 696e  d up page openin
-00061840: 672e 0d0a 2020 2020 2020 2020 2222 220d  g...        """.
-00061850: 0a0d 0a20 2020 2020 2020 2074 7279 3a0d  ...        try:.
-00061860: 0a20 2020 2020 2020 2020 2020 2063 6861  .            cha
-00061870: 7473 312c 2063 6861 7473 3220 3d20 7365  ts1, chats2 = se
-00061880: 6c66 2e63 6861 7473 312c 2073 656c 662e  lf.chats1, self.
-00061890: 6368 6174 7332 0d0a 2020 2020 2020 2020  chats2..        
-000618a0: 2020 2020 7365 6c66 2e64 6231 2e67 6574      self.db1.get
-000618b0: 5f63 6f6e 7665 7273 6174 696f 6e73 5f73  _conversations_s
-000618c0: 7461 7473 2863 6861 7473 3129 0d0a 2020  tats(chats1)..  
-000618d0: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
-000618e0: 6232 2e67 6574 5f63 6f6e 7665 7273 6174  b2.get_conversat
-000618f0: 696f 6e73 5f73 7461 7473 2863 6861 7473  ions_stats(chats
-00061900: 3229 0d0a 2020 2020 2020 2020 2020 2020  2)..            
-00061910: 6331 6d61 7020 3d20 6469 6374 2828 635b  c1map = dict((c[
-00061920: 2269 6465 6e74 6974 7922 5d2c 2063 2920  "identity"], c) 
-00061930: 666f 7220 6320 696e 2063 6861 7473 3129  for c in chats1)
-00061940: 0d0a 2020 2020 2020 2020 2020 2020 6332  ..            c2
-00061950: 6d61 7020 3d20 6469 6374 2828 635b 2269  map = dict((c["i
-00061960: 6465 6e74 6974 7922 5d2c 2063 2920 666f  dentity"], c) fo
-00061970: 7220 6320 696e 2063 6861 7473 3229 0d0a  r c in chats2)..
-00061980: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00061990: 2073 656c 662e 636f 6d70 6172 6564 2069   self.compared i
-000619a0: 7320 4e6f 6e65 3a0d 0a20 2020 2020 2020  s None:..       
-000619b0: 2020 2020 2020 2020 2063 6f6d 7061 7265           compare
-000619c0: 6420 3d20 5b5d 0d0a 2020 2020 2020 2020  d = []..        
-000619d0: 2020 2020 2020 2020 666f 7220 6331 2069          for c1 i
-000619e0: 6e20 6368 6174 7331 3a0d 0a20 2020 2020  n chats1:..     
-000619f0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00061a00: 315b 2263 3122 5d2c 2063 315b 2263 3222  1["c1"], c1["c2"
-00061a10: 5d20 3d20 6331 2e63 6f70 7928 292c 2063  ] = c1.copy(), c
-00061a20: 326d 6170 2e67 6574 2863 315b 2269 6465  2map.get(c1["ide
-00061a30: 6e74 6974 7922 5d29 0d0a 2020 2020 2020  ntity"])..      
-00061a40: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00061a50: 6d70 6172 6564 2e61 7070 656e 6428 6331  mpared.append(c1
-00061a60: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00061a70: 2020 2066 6f72 2063 3220 696e 2063 6861     for c2 in cha
-00061a80: 7473 323a 0d0a 2020 2020 2020 2020 2020  ts2:..          
-00061a90: 2020 2020 2020 2020 2020 6966 2063 325b            if c2[
-00061aa0: 2269 6465 6e74 6974 7922 5d20 6e6f 7420  "identity"] not 
-00061ab0: 696e 2063 316d 6170 3a0d 0a20 2020 2020  in c1map:..     
-00061ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00061ad0: 2020 2063 325b 2263 3122 5d2c 2063 325b     c2["c1"], c2[
-00061ae0: 2263 3222 5d20 3d20 4e6f 6e65 2c20 6332  "c2"] = None, c2
-00061af0: 2e63 6f70 7928 290d 0a20 2020 2020 2020  .copy()..       
-00061b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00061b10: 2063 6f6d 7061 7265 642e 6170 7065 6e64   compared.append
-00061b20: 2863 3229 0d0a 2020 2020 2020 2020 2020  (c2)..          
-00061b30: 2020 2020 2020 666f 7220 6320 696e 2063        for c in c
-00061b40: 6f6d 7061 7265 643a 0d0a 2020 2020 2020  ompared:..      
-00061b50: 2020 2020 2020 2020 2020 2020 2020 635b                c[
-00061b60: 226c 6173 745f 6d65 7373 6167 655f 6461  "last_message_da
-00061b70: 7465 7469 6d65 3122 5d20 3d20 4e6f 6e65  tetime1"] = None
-00061b80: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00061b90: 2020 2020 2020 635b 226c 6173 745f 6d65        c["last_me
-00061ba0: 7373 6167 655f 6461 7465 7469 6d65 3222  ssage_datetime2"
-00061bb0: 5d20 3d20 4e6f 6e65 0d0a 2020 2020 2020  ] = None..      
-00061bc0: 2020 2020 2020 2020 2020 2020 2020 635b                c[
-00061bd0: 226d 6573 7361 6765 7331 225d 203d 2063  "messages1"] = c
-00061be0: 5b22 6d65 7373 6167 6573 3222 5d20 3d20  ["messages2"] = 
-00061bf0: 635b 2270 656f 706c 6522 5d20 3d20 4e6f  c["people"] = No
-00061c00: 6e65 0d0a 2020 2020 2020 2020 2020 2020  ne..            
-00061c10: 2020 2020 7365 6c66 2e63 6f6d 7061 7265      self.compare
-00061c20: 6420 3d20 636f 6d70 6172 6564 0d0a 2020  d = compared..  
-00061c30: 2020 2020 2020 2020 2020 666f 7220 6320            for c 
-00061c40: 696e 2073 656c 662e 636f 6d70 6172 6564  in self.compared
-00061c50: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00061c60: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
-00061c70: 6528 3229 3a0d 0a20 2020 2020 2020 2020  e(2):..         
-00061c80: 2020 2020 2020 2020 2020 2063 6d61 7020             cmap 
-00061c90: 3d20 6332 6d61 7020 6966 2069 2065 6c73  = c2map if i els
-00061ca0: 6520 6331 6d61 700d 0a20 2020 2020 2020  e c1map..       
-00061cb0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00061cc0: 635b 2263 2573 2220 2520 2869 202b 2031  c["c%s" % (i + 1
-00061cd0: 295d 2061 6e64 2063 5b22 6964 656e 7469  )] and c["identi
-00061ce0: 7479 225d 2069 6e20 636d 6170 3a0d 0a20  ty"] in cmap:.. 
-00061cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00061d00: 2020 2020 2020 2063 5b22 6d65 7373 6167         c["messag
-00061d10: 6573 2573 2220 2520 2869 202b 2031 295d  es%s" % (i + 1)]
-00061d20: 203d 205c 0d0a 2020 2020 2020 2020 2020   = \..          
-00061d30: 2020 2020 2020 2020 2020 2020 2020 635b                c[
-00061d40: 2263 2573 2220 2520 2869 202b 2031 295d  "c%s" % (i + 1)]
-00061d50: 5b22 6d65 7373 6167 655f 636f 756e 7422  ["message_count"
-00061d60: 5d20 3d20 5c0d 0a20 2020 2020 2020 2020  ] = \..         
+00061300: 2020 206d 6d5b 635b 225f 5f6c 696e 6b22     mm[c["__link"
+00061310: 5d5b 2269 6465 6e74 6974 7922 5d5d 203d  ]["identity"]] =
+00061320: 2063 0d0a 2020 2020 2020 2020 2020 2020   c..            
+00061330: 6465 6620 6765 745f 6d61 7463 6865 6428  def get_matched(
+00061340: 636d 6170 2c20 6329 3a0d 0a20 2020 2020  cmap, c):..     
+00061350: 2020 2020 2020 2020 2020 2078 203d 2063             x = c
+00061360: 6d61 702e 6765 7428 635b 2269 6465 6e74  map.get(c["ident
+00061370: 6974 7922 5d29 0d0a 2020 2020 2020 2020  ity"])..        
+00061380: 2020 2020 2020 2020 7820 3d20 7820 6f72          x = x or
+00061390: 2063 2e67 6574 2822 5f5f 6c69 6e6b 2229   c.get("__link")
+000613a0: 2061 6e64 2063 6d61 702e 6765 7428 635b   and cmap.get(c[
+000613b0: 225f 5f6c 696e 6b22 5d5b 2269 6465 6e74  "__link"]["ident
+000613c0: 6974 7922 5d29 0d0a 2020 2020 2020 2020  ity"])..        
+000613d0: 2020 2020 2020 2020 7265 7475 726e 2078          return x
+000613e0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+000613f0: 636f 6d70 6172 6564 203d 205b 5d0d 0a20  compared = [].. 
+00061400: 2020 2020 2020 2020 2020 2066 6f72 2063             for c
+00061410: 3120 696e 2063 6861 7473 313a 0d0a 2020  1 in chats1:..  
+00061420: 2020 2020 2020 2020 2020 2020 2020 6331                c1
+00061430: 5b22 6331 225d 2c20 6331 5b22 6332 225d  ["c1"], c1["c2"]
+00061440: 203d 2063 312e 636f 7079 2829 2c20 6765   = c1.copy(), ge
+00061450: 745f 6d61 7463 6865 6428 6332 6d61 702c  t_matched(c2map,
+00061460: 2063 3129 0d0a 2020 2020 2020 2020 2020   c1)..          
+00061470: 2020 2020 2020 636f 6d70 6172 6564 2e61        compared.a
+00061480: 7070 656e 6428 6331 290d 0a20 2020 2020  ppend(c1)..     
+00061490: 2020 2020 2020 2066 6f72 2063 3220 696e         for c2 in
+000614a0: 2063 6861 7473 323a 0d0a 2020 2020 2020   chats2:..      
+000614b0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+000614c0: 2067 6574 5f6d 6174 6368 6564 2863 316d   get_matched(c1m
+000614d0: 6170 2c20 6332 293a 0d0a 2020 2020 2020  ap, c2):..      
+000614e0: 2020 2020 2020 2020 2020 2020 2020 6332                c2
+000614f0: 5b22 6331 225d 2c20 6332 5b22 6332 225d  ["c1"], c2["c2"]
+00061500: 203d 204e 6f6e 652c 2063 322e 636f 7079   = None, c2.copy
+00061510: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+00061520: 2020 2020 2020 2020 636f 6d70 6172 6564          compared
+00061530: 2e61 7070 656e 6428 6332 290d 0a20 2020  .append(c2)..   
+00061540: 2020 2020 2020 2020 2066 6f72 2063 2069           for c i
+00061550: 6e20 636f 6d70 6172 6564 3a0d 0a20 2020  n compared:..   
+00061560: 2020 2020 2020 2020 2020 2020 2063 5b22               c["
+00061570: 6c61 7374 5f6d 6573 7361 6765 5f64 6174  last_message_dat
+00061580: 6574 696d 6531 225d 203d 204e 6f6e 650d  etime1"] = None.
+00061590: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000615a0: 2063 5b22 6c61 7374 5f6d 6573 7361 6765   c["last_message
+000615b0: 5f64 6174 6574 696d 6532 225d 203d 204e  _datetime2"] = N
+000615c0: 6f6e 650d 0a20 2020 2020 2020 2020 2020  one..           
+000615d0: 2020 2020 2063 5b22 6d65 7373 6167 6573       c["messages
+000615e0: 3122 5d20 3d20 635b 226d 6573 7361 6765  1"] = c["message
+000615f0: 7332 225d 203d 2063 5b22 7065 6f70 6c65  s2"] = c["people
+00061600: 225d 203d 204e 6f6e 650d 0a0d 0a20 2020  "] = None....   
+00061610: 2020 2020 2020 2020 2073 656c 662e 6c69           self.li
+00061620: 7374 5f63 6861 7473 2e50 6f70 756c 6174  st_chats.Populat
+00061630: 6528 636f 6d70 6172 6564 290d 0a20 2020  e(compared)..   
+00061640: 2020 2020 2020 2020 2073 656c 662e 6c69           self.li
+00061650: 7374 5f63 6861 7473 2e53 6f72 744c 6973  st_chats.SortLis
+00061660: 7449 7465 6d73 2833 2c20 3029 2023 2053  tItems(3, 0) # S
+00061670: 6f72 7420 6279 206c 6173 7420 6d65 7373  ort by last mess
+00061680: 6167 6520 696e 206c 6566 740d 0a20 2020  age in left..   
+00061690: 2020 2020 2020 2020 2073 656c 662e 636f           self.co
+000616a0: 6d70 6172 6564 203d 2063 6f6d 7061 7265  mpared = compare
+000616b0: 640d 0a20 2020 2020 2020 2020 2020 2073  d..            s
+000616c0: 656c 662e 6368 6174 7331 203d 2063 6861  elf.chats1 = cha
+000616d0: 7473 310d 0a20 2020 2020 2020 2020 2020  ts1..           
+000616e0: 2073 656c 662e 6368 6174 7332 203d 2063   self.chats2 = c
+000616f0: 6861 7473 320d 0a20 2020 2020 2020 2020  hats2..         
+00061700: 2020 2077 782e 4361 6c6c 4c61 7465 7228     wx.CallLater(
+00061710: 3230 302c 2073 656c 662e 6c6f 6164 5f6c  200, self.load_l
+00061720: 6174 6572 5f64 6174 6129 0d0a 2020 2020  ater_data)..    
+00061730: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
+00061740: 7469 6f6e 2061 7320 653a 0d0a 2020 2020  tion as e:..    
+00061750: 2020 2020 2020 2020 7778 2e43 616c 6c41          wx.CallA
+00061760: 6674 6572 2873 656c 662e 7570 6461 7465  fter(self.update
+00061770: 5f74 6162 6865 6164 6572 290d 0a20 2020  _tabheader)..   
+00061780: 2020 2020 2020 2020 2067 7569 6261 7365           guibase
+00061790: 2e73 7461 7475 7328 2243 6f75 6c64 206e  .status("Could n
+000617a0: 6f74 206c 6f61 6420 6368 6174 206c 6973  ot load chat lis
+000617b0: 7473 2066 726f 6d20 2573 2061 6e64 2025  ts from %s and %
+000617c0: 733a 2025 7322 2c0d 0a20 2020 2020 2020  s: %s",..       
+000617d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000617e0: 2020 2020 7365 6c66 2e64 6231 2c20 7365      self.db1, se
+000617f0: 6c66 2e64 6232 2c20 7574 696c 2e66 6f72  lf.db2, util.for
+00061800: 6d61 745f 6578 6328 6529 290d 0a20 2020  mat_exc(e))..   
+00061810: 2020 2020 2020 2020 206c 6f67 6765 722e           logger.
+00061820: 6578 6365 7074 696f 6e28 2243 6f75 6c64  exception("Could
+00061830: 206e 6f74 206c 6f61 6420 6368 6174 206c   not load chat l
+00061840: 6973 7473 2066 726f 6d20 2573 2061 6e64  ists from %s and
+00061850: 2025 732e 222c 0d0a 2020 2020 2020 2020   %s.",..        
+00061860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00061870: 2020 2020 2073 656c 662e 6462 312c 2073       self.db1, s
+00061880: 656c 662e 6462 3229 0d0a 2020 2020 2020  elf.db2)..      
+00061890: 2020 2020 2020 6572 726f 726d 7367 203d        errormsg =
+000618a0: 2022 436f 756c 6420 6e6f 7420 6c6f 6164   "Could not load
+000618b0: 2063 6861 7420 6c69 7374 7320 6672 6f6d   chat lists from
+000618c0: 2025 7320 616e 6420 2573 2e5c 6e5c 6e25   %s and %s.\n\n%
+000618d0: 7322 2025 205c 0d0a 2020 2020 2020 2020  s" % \..        
+000618e0: 2020 2020 2020 2020 2020 2020 2020 2028                 (
+000618f0: 7365 6c66 2e64 6231 2c20 7365 6c66 2e64  self.db1, self.d
+00061900: 6232 2c20 7472 6163 6562 6163 6b2e 666f  b2, traceback.fo
+00061910: 726d 6174 5f65 7863 2829 290d 0a20 2020  rmat_exc())..   
+00061920: 2020 2020 2020 2020 2077 782e 4d65 7373           wx.Mess
+00061930: 6167 6542 6f78 2865 7272 6f72 6d73 672c  ageBox(errormsg,
+00061940: 2063 6f6e 662e 5469 746c 652c 2077 782e   conf.Title, wx.
+00061950: 4f4b 207c 2077 782e 4943 4f4e 5f57 4152  OK | wx.ICON_WAR
+00061960: 4e49 4e47 290d 0a0d 0a0d 0a20 2020 2064  NING)......    d
+00061970: 6566 206c 6f61 645f 6c61 7465 725f 6461  ef load_later_da
+00061980: 7461 2873 656c 6629 3a0d 0a20 2020 2020  ta(self):..     
+00061990: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
+000619a0: 4c6f 6164 7320 6c61 7465 7220 6461 7461  Loads later data
+000619b0: 2066 726f 6d20 7468 6520 6461 7461 6261   from the databa
+000619c0: 7365 732c 206c 696b 6520 6d65 7373 6167  ses, like messag
+000619d0: 6520 636f 756e 7473 2061 6e64 2063 6f6d  e counts and com
+000619e0: 7061 7265 640d 0a20 2020 2020 2020 2063  pared..        c
+000619f0: 6f6e 7461 6374 732c 2075 7365 6420 6173  ontacts, used as
+00061a00: 2061 2062 6163 6b67 726f 756e 6420 6361   a background ca
+00061a10: 6c6c 6261 636b 2074 6f20 7370 6565 6420  llback to speed 
+00061a20: 7570 2070 6167 6520 6f70 656e 696e 672e  up page opening.
+00061a30: 0d0a 2020 2020 2020 2020 2222 220d 0a0d  ..        """...
+00061a40: 0a20 2020 2020 2020 2074 7279 3a0d 0a20  .        try:.. 
+00061a50: 2020 2020 2020 2020 2020 2063 6861 7473             chats
+00061a60: 312c 2063 6861 7473 3220 3d20 7365 6c66  1, chats2 = self
+00061a70: 2e63 6861 7473 312c 2073 656c 662e 6368  .chats1, self.ch
+00061a80: 6174 7332 0d0a 2020 2020 2020 2020 2020  ats2..          
+00061a90: 2020 7365 6c66 2e64 6231 2e67 6574 5f63    self.db1.get_c
+00061aa0: 6f6e 7665 7273 6174 696f 6e73 5f73 7461  onversations_sta
+00061ab0: 7473 2863 6861 7473 3129 0d0a 2020 2020  ts(chats1)..    
+00061ac0: 2020 2020 2020 2020 7365 6c66 2e64 6232          self.db2
+00061ad0: 2e67 6574 5f63 6f6e 7665 7273 6174 696f  .get_conversatio
+00061ae0: 6e73 5f73 7461 7473 2863 6861 7473 3229  ns_stats(chats2)
+00061af0: 0d0a 2020 2020 2020 2020 2020 2020 6331  ..            c1
+00061b00: 6d61 7020 3d20 6469 6374 2828 635b 2269  map = dict((c["i
+00061b10: 6465 6e74 6974 7922 5d2c 2063 2920 666f  dentity"], c) fo
+00061b20: 7220 6320 696e 2063 6861 7473 3129 0d0a  r c in chats1)..
+00061b30: 2020 2020 2020 2020 2020 2020 6332 6d61              c2ma
+00061b40: 7020 3d20 6469 6374 2828 635b 2269 6465  p = dict((c["ide
+00061b50: 6e74 6974 7922 5d2c 2063 2920 666f 7220  ntity"], c) for 
+00061b60: 6320 696e 2063 6861 7473 3229 0d0a 0d0a  c in chats2)....
+00061b70: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+00061b80: 656c 662e 636f 6d70 6172 6564 2069 7320  elf.compared is 
+00061b90: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+00061ba0: 2020 2020 2020 2063 6f6d 7061 7265 6420         compared 
+00061bb0: 3d20 5b5d 0d0a 2020 2020 2020 2020 2020  = []..          
+00061bc0: 2020 2020 2020 666f 7220 6331 2069 6e20        for c1 in 
+00061bd0: 6368 6174 7331 3a0d 0a20 2020 2020 2020  chats1:..       
+00061be0: 2020 2020 2020 2020 2020 2020 2063 315b               c1[
+00061bf0: 2263 3122 5d2c 2063 315b 2263 3222 5d20  "c1"], c1["c2"] 
+00061c00: 3d20 6331 2e63 6f70 7928 292c 2063 326d  = c1.copy(), c2m
+00061c10: 6170 2e67 6574 2863 315b 2269 6465 6e74  ap.get(c1["ident
+00061c20: 6974 7922 5d29 0d0a 2020 2020 2020 2020  ity"])..        
+00061c30: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
+00061c40: 6172 6564 2e61 7070 656e 6428 6331 290d  ared.append(c1).
+00061c50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00061c60: 2066 6f72 2063 3220 696e 2063 6861 7473   for c2 in chats
+00061c70: 323a 0d0a 2020 2020 2020 2020 2020 2020  2:..            
+00061c80: 2020 2020 2020 2020 6966 2063 325b 2269          if c2["i
+00061c90: 6465 6e74 6974 7922 5d20 6e6f 7420 696e  dentity"] not in
+00061ca0: 2063 316d 6170 3a0d 0a20 2020 2020 2020   c1map:..       
+00061cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00061cc0: 2063 325b 2263 3122 5d2c 2063 325b 2263   c2["c1"], c2["c
+00061cd0: 3222 5d20 3d20 4e6f 6e65 2c20 6332 2e63  2"] = None, c2.c
+00061ce0: 6f70 7928 290d 0a20 2020 2020 2020 2020  opy()..         
+00061cf0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00061d00: 6f6d 7061 7265 642e 6170 7065 6e64 2863  ompared.append(c
+00061d10: 3229 0d0a 2020 2020 2020 2020 2020 2020  2)..            
+00061d20: 2020 2020 666f 7220 6320 696e 2063 6f6d      for c in com
+00061d30: 7061 7265 643a 0d0a 2020 2020 2020 2020  pared:..        
+00061d40: 2020 2020 2020 2020 2020 2020 635b 226c              c["l
+00061d50: 6173 745f 6d65 7373 6167 655f 6461 7465  ast_message_date
+00061d60: 7469 6d65 3122 5d20 3d20 4e6f 6e65 0d0a  time1"] = None..
 00061d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00061d80: 2020 2063 6d61 705b 635b 2269 6465 6e74     cmap[c["ident
-00061d90: 6974 7922 5d5d 5b22 6d65 7373 6167 655f  ity"]]["message_
-00061da0: 636f 756e 7422 5d0d 0a20 2020 2020 2020  count"]..       
-00061db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00061dc0: 2063 5b22 6c61 7374 5f6d 6573 7361 6765   c["last_message
-00061dd0: 5f64 6174 6574 696d 6525 7322 2025 2028  _datetime%s" % (
-00061de0: 6920 2b20 3129 5d20 3d20 5c0d 0a20 2020  i + 1)] = \..   
-00061df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00061e00: 2020 2020 2063 5b22 6325 7322 2025 2028       c["c%s" % (
-00061e10: 6920 2b20 3129 5d5b 226c 6173 745f 6d65  i + 1)]["last_me
-00061e20: 7373 6167 655f 6461 7465 7469 6d65 2573  ssage_datetime%s
-00061e30: 2220 2520 2869 202b 2031 295d 203d 205c  " % (i + 1)] = \
-00061e40: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00061e50: 2020 2020 2020 2020 2020 2020 2020 636d                cm
-00061e60: 6170 5b63 5b22 6964 656e 7469 7479 225d  ap[c["identity"]
-00061e70: 5d5b 226c 6173 745f 6d65 7373 6167 655f  ]["last_message_
-00061e80: 6461 7465 7469 6d65 225d 0d0a 2020 2020  datetime"]..    
-00061e90: 2020 2020 2020 2020 2020 2020 7065 6f70              peop
-00061ea0: 6c65 203d 2073 6f72 7465 6428 5b70 5b22  le = sorted([p["
-00061eb0: 6964 656e 7469 7479 225d 2066 6f72 2070  identity"] for p
-00061ec0: 2069 6e20 635b 2270 6172 7469 6369 7061   in c["participa
-00061ed0: 6e74 7322 5d5d 290d 0a20 2020 2020 2020  nts"]])..       
-00061ee0: 2020 2020 2020 2020 2069 6620 736b 7970           if skyp
-00061ef0: 6564 6174 612e 4348 4154 535f 5459 5045  edata.CHATS_TYPE
-00061f00: 5f53 494e 474c 4520 213d 2063 5b22 7479  _SINGLE != c["ty
-00061f10: 7065 225d 3a0d 0a20 2020 2020 2020 2020  pe"]:..         
-00061f20: 2020 2020 2020 2020 2020 2063 5b22 7065             c["pe
-00061f30: 6f70 6c65 225d 203d 2022 2573 2028 2573  ople"] = "%s (%s
-00061f40: 2922 2025 2028 6c65 6e28 7065 6f70 6c65  )" % (len(people
-00061f50: 292c 2022 2c20 222e 6a6f 696e 2870 656f  ), ", ".join(peo
-00061f60: 706c 6529 290d 0a20 2020 2020 2020 2020  ple))..         
-00061f70: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-00061f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00061f90: 2020 7065 6f70 6c65 203d 205b 7020 666f    people = [p fo
-00061fa0: 7220 7020 696e 2070 656f 706c 6520 6966  r p in people if
-00061fb0: 2070 2021 3d20 7365 6c66 2e64 6231 2e69   p != self.db1.i
-00061fc0: 645d 0d0a 2020 2020 2020 2020 2020 2020  d]..            
-00061fd0: 2020 2020 2020 2020 635b 2270 656f 706c          c["peopl
-00061fe0: 6522 5d20 3d20 222c 2022 2e6a 6f69 6e28  e"] = ", ".join(
-00061ff0: 7065 6f70 6c65 290d 0a0d 0a20 2020 2020  people)....     
-00062000: 2020 2020 2020 2073 656c 662e 6c69 7374         self.list
-00062010: 5f63 6861 7473 2e45 6e61 626c 6564 203d  _chats.Enabled =
-00062020: 2054 7275 650d 0a20 2020 2020 2020 2020   True..         
-00062030: 2020 2073 656c 662e 6c69 7374 5f63 6861     self.list_cha
-00062040: 7473 2e50 6f70 756c 6174 6528 7365 6c66  ts.Populate(self
-00062050: 2e63 6f6d 7061 7265 6429 0d0a 0d0a 2020  .compared)....  
-00062060: 2020 2020 2020 2020 2020 2320 506f 7075            # Popu
-00062070: 6c61 7465 2074 6865 2063 6f6e 7461 6374  late the contact
-00062080: 2063 6f6d 7061 7269 736f 6e20 6c69 7374   comparison list
-00062090: 0d0a 2020 2020 2020 2020 2020 2020 636f  ..            co
-000620a0: 6e74 6163 7473 3120 3d20 7365 6c66 2e64  ntacts1 = self.d
-000620b0: 6231 2e67 6574 5f63 6f6e 7461 6374 7328  b1.get_contacts(
-000620c0: 290d 0a20 2020 2020 2020 2020 2020 2063  )..            c
-000620d0: 6f6e 7461 6374 7332 203d 2073 656c 662e  ontacts2 = self.
-000620e0: 6462 322e 6765 745f 636f 6e74 6163 7473  db2.get_contacts
-000620f0: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
-00062100: 636f 6e74 6163 7467 726f 7570 7331 203d  contactgroups1 =
-00062110: 2073 656c 662e 6462 312e 6765 745f 636f   self.db1.get_co
-00062120: 6e74 6163 7467 726f 7570 7328 290d 0a20  ntactgroups().. 
-00062130: 2020 2020 2020 2020 2020 2063 6f6e 7461             conta
-00062140: 6374 6772 6f75 7073 3220 3d20 7365 6c66  ctgroups2 = self
-00062150: 2e64 6232 2e67 6574 5f63 6f6e 7461 6374  .db2.get_contact
-00062160: 6772 6f75 7073 2829 0d0a 2020 2020 2020  groups()..      
-00062170: 2020 2020 2020 636f 6e31 6d61 7020 3d20        con1map = 
-00062180: 6469 6374 2828 635b 2269 6465 6e74 6974  dict((c["identit
-00062190: 7922 5d2c 2063 2920 666f 7220 6320 696e  y"], c) for c in
-000621a0: 2063 6f6e 7461 6374 7331 290d 0a20 2020   contacts1)..   
-000621b0: 2020 2020 2020 2020 2063 6f6e 326d 6170           con2map
-000621c0: 203d 2064 6963 7428 2863 5b22 6964 656e   = dict((c["iden
-000621d0: 7469 7479 225d 2c20 6329 2066 6f72 2063  tity"], c) for c
-000621e0: 2069 6e20 636f 6e74 6163 7473 3229 0d0a   in contacts2)..
-000621f0: 2020 2020 2020 2020 2020 2020 636f 6e31              con1
-00062200: 6469 6666 2c20 636f 6e32 6469 6666 203d  diff, con2diff =
-00062210: 205b 5d2c 205b 5d0d 0a20 2020 2020 2020   [], []..       
-00062220: 2020 2020 2063 6f6e 316e 6577 2c20 636f       con1new, co
-00062230: 6e32 6e65 7720 3d20 7b7d 2c20 7b7d 2023  n2new = {}, {} #
-00062240: 204e 6577 2063 6f6e 7461 6374 7320 666f   New contacts fo
-00062250: 7220 6462 7320 7b73 6b79 7065 6e61 6d65  r dbs {skypename
-00062260: 3a72 6f77 2c20 7d0d 0a20 2020 2020 2020  :row, }..       
-00062270: 2020 2020 2063 6731 6469 6666 2c20 6367       cg1diff, cg
-00062280: 3264 6966 6620 3d20 5b5d 2c20 5b5d 0d0a  2diff = [], []..
-00062290: 2020 2020 2020 2020 2020 2020 6367 316d              cg1m
-000622a0: 6170 203d 2064 6963 7428 2867 5b22 6e61  ap = dict((g["na
-000622b0: 6d65 225d 2c20 6729 2066 6f72 2067 2069  me"], g) for g i
-000622c0: 6e20 636f 6e74 6163 7467 726f 7570 7331  n contactgroups1
-000622d0: 290d 0a20 2020 2020 2020 2020 2020 2063  )..            c
-000622e0: 6732 6d61 7020 3d20 6469 6374 2828 675b  g2map = dict((g[
-000622f0: 226e 616d 6522 5d2c 2067 2920 666f 7220  "name"], g) for 
-00062300: 6720 696e 2063 6f6e 7461 6374 6772 6f75  g in contactgrou
-00062310: 7073 3229 0d0a 2020 2020 2020 2020 2020  ps2)..          
-00062320: 2020 666f 7220 6331 2069 6e20 636f 6e74    for c1 in cont
-00062330: 6163 7473 313a 0d0a 2020 2020 2020 2020  acts1:..        
-00062340: 2020 2020 2020 2020 6332 203d 2063 6f6e          c2 = con
-00062350: 326d 6170 2e67 6574 2863 315b 2269 6465  2map.get(c1["ide
-00062360: 6e74 6974 7922 5d29 0d0a 2020 2020 2020  ntity"])..      
-00062370: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-00062380: 2063 3220 616e 6420 6331 5b22 6964 656e   c2 and c1["iden
-00062390: 7469 7479 225d 206e 6f74 2069 6e20 636f  tity"] not in co
-000623a0: 6e31 6e65 773a 0d0a 2020 2020 2020 2020  n1new:..        
-000623b0: 2020 2020 2020 2020 2020 2020 6320 3d20              c = 
-000623c0: 6331 2e63 6f70 7928 290d 0a20 2020 2020  c1.copy()..     
-000623d0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-000623e0: 5b22 6331 225d 2c20 635b 2263 3222 5d20  ["c1"], c["c2"] 
-000623f0: 3d20 6331 2c20 6332 0d0a 2020 2020 2020  = c1, c2..      
-00062400: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00062410: 6e31 6469 6666 2e61 7070 656e 6428 6329  n1diff.append(c)
-00062420: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00062430: 2020 2020 2020 636f 6e31 6e65 775b 6331        con1new[c1
-00062440: 5b22 6964 656e 7469 7479 225d 5d20 3d20  ["identity"]] = 
-00062450: 5472 7565 0d0a 2020 2020 2020 2020 2020  True..          
-00062460: 2020 666f 7220 6332 2069 6e20 636f 6e74    for c2 in cont
-00062470: 6163 7473 323a 0d0a 2020 2020 2020 2020  acts2:..        
-00062480: 2020 2020 2020 2020 6331 203d 2063 6f6e          c1 = con
-00062490: 316d 6170 2e67 6574 2863 325b 2269 6465  1map.get(c2["ide
-000624a0: 6e74 6974 7922 5d29 0d0a 2020 2020 2020  ntity"])..      
-000624b0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-000624c0: 2063 3120 616e 6420 6332 5b22 6964 656e   c1 and c2["iden
-000624d0: 7469 7479 225d 206e 6f74 2069 6e20 636f  tity"] not in co
-000624e0: 6e32 6e65 773a 0d0a 2020 2020 2020 2020  n2new:..        
-000624f0: 2020 2020 2020 2020 2020 2020 6320 3d20              c = 
-00062500: 6332 2e63 6f70 7928 290d 0a20 2020 2020  c2.copy()..     
-00062510: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00062520: 5b22 6331 225d 2c20 635b 2263 3222 5d20  ["c1"], c["c2"] 
-00062530: 3d20 6331 2c20 6332 0d0a 2020 2020 2020  = c1, c2..      
-00062540: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00062550: 6e32 6469 6666 2e61 7070 656e 6428 6329  n2diff.append(c)
-00062560: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00062570: 2020 2020 2020 636f 6e32 6e65 775b 6332        con2new[c2
-00062580: 5b22 6964 656e 7469 7479 225d 5d20 3d20  ["identity"]] = 
-00062590: 5472 7565 0d0a 2020 2020 2020 2020 2020  True..          
-000625a0: 2020 666f 7220 6731 2069 6e20 636f 6e74    for g1 in cont
-000625b0: 6163 7467 726f 7570 7331 3a0d 0a20 2020  actgroups1:..   
-000625c0: 2020 2020 2020 2020 2020 2020 2067 3220               g2 
-000625d0: 3d20 6367 326d 6170 2e67 6574 2867 315b  = cg2map.get(g1[
-000625e0: 226e 616d 6522 5d29 0d0a 2020 2020 2020  "name"])..      
-000625f0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-00062600: 2067 3220 6f72 2067 325b 226d 656d 6265   g2 or g2["membe
-00062610: 7273 225d 2021 3d20 6731 5b22 6d65 6d62  rs"] != g1["memb
-00062620: 6572 7322 5d3a 0d0a 2020 2020 2020 2020  ers"]:..        
-00062630: 2020 2020 2020 2020 2020 2020 6720 3d20              g = 
-00062640: 6731 2e63 6f70 7928 290d 0a20 2020 2020  g1.copy()..     
-00062650: 2020 2020 2020 2020 2020 2020 2020 2067                 g
-00062660: 5b22 6731 225d 203d 2067 310d 0a20 2020  ["g1"] = g1..   
-00062670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00062680: 2067 5b22 6732 225d 203d 2067 320d 0a20   g["g2"] = g2.. 
-00062690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000626a0: 2020 2063 6731 6469 6666 2e61 7070 656e     cg1diff.appen
-000626b0: 6428 6729 0d0a 2020 2020 2020 2020 2020  d(g)..          
-000626c0: 2020 666f 7220 6732 2069 6e20 636f 6e74    for g2 in cont
-000626d0: 6163 7467 726f 7570 7332 3a0d 0a20 2020  actgroups2:..   
-000626e0: 2020 2020 2020 2020 2020 2020 2067 3120               g1 
-000626f0: 3d20 6367 316d 6170 2e67 6574 2867 325b  = cg1map.get(g2[
-00062700: 226e 616d 6522 5d29 0d0a 2020 2020 2020  "name"])..      
-00062710: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-00062720: 2067 3120 6f72 2067 315b 226d 656d 6265   g1 or g1["membe
-00062730: 7273 225d 2021 3d20 6732 5b22 6d65 6d62  rs"] != g2["memb
-00062740: 6572 7322 5d3a 0d0a 2020 2020 2020 2020  ers"]:..        
-00062750: 2020 2020 2020 2020 2020 2020 6720 3d20              g = 
-00062760: 6732 2e63 6f70 7928 290d 0a20 2020 2020  g2.copy()..     
-00062770: 2020 2020 2020 2020 2020 2020 2020 2067                 g
-00062780: 5b22 6731 225d 203d 2067 310d 0a20 2020  ["g1"] = g1..   
-00062790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000627a0: 2067 5b22 6732 225d 203d 2067 320d 0a20   g["g2"] = g2.. 
-000627b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000627c0: 2020 2063 6732 6469 6666 2e61 7070 656e     cg2diff.appen
-000627d0: 6428 6729 0d0a 2020 2020 2020 2020 2020  d(g)..          
-000627e0: 2020 6475 6d6d 7920 3d20 7b22 5f5f 7479    dummy = {"__ty
-000627f0: 7065 223a 2022 4772 6f75 7022 2c20 2270  pe": "Group", "p
-00062800: 686f 6e65 5f6d 6f62 696c 655f 6e6f 726d  hone_mobile_norm
-00062810: 616c 697a 6564 223a 2022 222c 0d0a 2020  alized": "",..  
-00062820: 2020 2020 2020 2020 2020 2020 2020 2263                "c
-00062830: 6f75 6e74 7279 223a 2022 222c 2022 6369  ountry": "", "ci
-00062840: 7479 223a 2022 222c 2022 6162 6f75 7422  ty": "", "about"
-00062850: 3a20 2241 626f 7574 227d 0d0a 2020 2020  : "About"}..    
-00062860: 2020 2020 2020 2020 636f 6e31 6469 6666          con1diff
-00062870: 6c69 7374 203d 205b 632e 636f 7079 2829  list = [c.copy()
-00062880: 2066 6f72 2063 2069 6e20 636f 6e31 6469   for c in con1di
-00062890: 6666 5d0d 0a20 2020 2020 2020 2020 2020  ff]..           
-000628a0: 205b 632e 7570 6461 7465 287b 225f 5f74   [c.update({"__t
-000628b0: 7970 6522 3a20 2243 6f6e 7461 6374 222c  ype": "Contact",
-000628c0: 2022 5f5f 6461 7461 223a 2063 7d29 2066   "__data": c}) f
-000628d0: 6f72 2063 2069 6e20 636f 6e31 6469 6666  or c in con1diff
-000628e0: 6c69 7374 5d0d 0a20 2020 2020 2020 2020  list]..         
-000628f0: 2020 2066 6f72 2067 2069 6e20 6367 3164     for g in cg1d
-00062900: 6966 663a 0d0a 2020 2020 2020 2020 2020  iff:..          
-00062910: 2020 2020 2020 6320 3d20 672e 636f 7079        c = g.copy
-00062920: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
-00062930: 2020 2020 632e 7570 6461 7465 2864 756d      c.update(dum
-00062940: 6d79 290d 0a20 2020 2020 2020 2020 2020  my)..           
-00062950: 2020 2020 2063 5b22 6964 656e 7469 7479       c["identity
-00062960: 225d 2c20 635b 225f 5f64 6174 6122 5d20  "], c["__data"] 
-00062970: 3d20 635b 226d 656d 6265 7273 225d 2c20  = c["members"], 
-00062980: 670d 0a20 2020 2020 2020 2020 2020 2020  g..             
-00062990: 2020 2063 6f6e 3164 6966 666c 6973 742e     con1difflist.
-000629a0: 6170 7065 6e64 2863 290d 0a20 2020 2020  append(c)..     
-000629b0: 2020 2020 2020 2063 6f6e 3264 6966 666c         con2diffl
-000629c0: 6973 7420 3d20 5b63 2e63 6f70 7928 2920  ist = [c.copy() 
-000629d0: 666f 7220 6320 696e 2063 6f6e 3264 6966  for c in con2dif
-000629e0: 665d 0d0a 2020 2020 2020 2020 2020 2020  f]..            
-000629f0: 5b63 2e75 7064 6174 6528 7b22 5f5f 7479  [c.update({"__ty
-00062a00: 7065 223a 2243 6f6e 7461 6374 222c 2022  pe":"Contact", "
-00062a10: 5f5f 6461 7461 223a 2063 7d29 2066 6f72  __data": c}) for
-00062a20: 2063 2069 6e20 636f 6e32 6469 6666 6c69   c in con2diffli
-00062a30: 7374 5d0d 0a20 2020 2020 2020 2020 2020  st]..           
-00062a40: 2066 6f72 2067 2069 6e20 6367 3264 6966   for g in cg2dif
-00062a50: 663a 0d0a 2020 2020 2020 2020 2020 2020  f:..            
-00062a60: 2020 2020 6320 3d20 672e 636f 7079 2829      c = g.copy()
-00062a70: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00062a80: 2020 632e 7570 6461 7465 2864 756d 6d79    c.update(dummy
-00062a90: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00062aa0: 2020 2063 5b22 6964 656e 7469 7479 225d     c["identity"]
-00062ab0: 2c20 635b 225f 5f64 6174 6122 5d20 3d20  , c["__data"] = 
-00062ac0: 635b 226d 656d 6265 7273 225d 2c20 670d  c["members"], g.
-00062ad0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00062ae0: 2063 6f6e 3264 6966 666c 6973 742e 6170   con2difflist.ap
-00062af0: 7065 6e64 2863 290d 0a20 2020 2020 2020  pend(c)..       
-00062b00: 2020 2020 2073 656c 662e 6c69 7374 5f63       self.list_c
-00062b10: 6f6e 7461 6374 732e 506f 7075 6c61 7465  ontacts.Populate
-00062b20: 2863 6f6e 3164 6966 666c 6973 7429 0d0a  (con1difflist)..
-00062b30: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00062b40: 2e62 7574 746f 6e5f 6d65 7267 655f 616c  .button_merge_al
-00062b50: 6c63 6f6e 7461 6374 732e 456e 6162 6c65  lcontacts.Enable
-00062b60: 6420 3d20 7365 6c66 2e6c 6973 745f 636f  d = self.list_co
-00062b70: 6e74 6163 7473 2e49 7465 6d43 6f75 6e74  ntacts.ItemCount
-00062b80: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00062b90: 6c66 2e63 6f6e 3164 6966 6620 3d20 636f  lf.con1diff = co
-00062ba0: 6e31 6469 6666 0d0a 2020 2020 2020 2020  n1diff..        
-00062bb0: 2020 2020 7365 6c66 2e63 6f6e 3264 6966      self.con2dif
-00062bc0: 6620 3d20 636f 6e32 6469 6666 0d0a 2020  f = con2diff..  
-00062bd0: 2020 2020 2020 2020 2020 7365 6c66 2e63            self.c
-00062be0: 6f6e 3164 6966 666c 6973 7420 3d20 636f  on1difflist = co
-00062bf0: 6e31 6469 6666 6c69 7374 0d0a 2020 2020  n1difflist..    
-00062c00: 2020 2020 2020 2020 7365 6c66 2e63 6f6e          self.con
-00062c10: 3264 6966 666c 6973 7420 3d20 636f 6e32  2difflist = con2
-00062c20: 6469 6666 6c69 7374 0d0a 2020 2020 2020  difflist..      
-00062c30: 2020 2020 2020 7365 6c66 2e63 6f6e 6772        self.congr
-00062c40: 6f75 7031 6469 6666 203d 2063 6731 6469  oup1diff = cg1di
-00062c50: 6666 0d0a 2020 2020 2020 2020 2020 2020  ff..            
-00062c60: 7365 6c66 2e63 6f6e 6772 6f75 7032 6469  self.congroup2di
-00062c70: 6666 203d 2063 6732 6469 6666 0d0a 0d0a  ff = cg2diff....
-00062c80: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00062c90: 6920 696e 2072 616e 6765 2832 293a 0d0a  i in range(2):..
-00062ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00062cb0: 6462 203d 2073 656c 662e 6462 3220 6966  db = self.db2 if
-00062cc0: 2069 2065 6c73 6520 7365 6c66 2e64 6231   i else self.db1
-00062cd0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00062ce0: 2020 6462 2e75 7064 6174 655f 6669 6c65    db.update_file
-00062cf0: 696e 666f 2829 0d0a 2020 2020 2020 2020  info()..        
-00062d00: 2020 2020 2020 2020 6c61 6265 6c20 3d20          label = 
-00062d10: 7365 6c66 2e6c 6162 656c 5f61 6c6c 3220  self.label_all2 
-00062d20: 6966 2069 2065 6c73 6520 7365 6c66 2e6c  if i else self.l
-00062d30: 6162 656c 5f61 6c6c 310d 0a20 2020 2020  abel_all1..     
-00062d40: 2020 2020 2020 2020 2020 206c 6162 656c             label
-00062d50: 2e4c 6162 656c 203d 2022 2573 2e5c 6e5c  .Label = "%s.\n\
-00062d60: 6e53 697a 6520 2573 2e5c 6e4c 6173 7420  nSize %s.\nLast 
-00062d70: 6d6f 6469 6669 6564 2025 732e 5c6e 2220  modified %s.\n" 
-00062d80: 2520 280d 0a20 2020 2020 2020 2020 2020  % (..           
-00062d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00062da0: 2020 2064 622c 2075 7469 6c2e 666f 726d     db, util.form
-00062db0: 6174 5f62 7974 6573 2864 622e 6669 6c65  at_bytes(db.file
-00062dc0: 7369 7a65 292c 0d0a 2020 2020 2020 2020  size),..        
-00062dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00062de0: 2020 2020 2020 6462 2e6c 6173 745f 6d6f        db.last_mo
-00062df0: 6469 6669 6564 2e73 7472 6674 696d 6528  dified.strftime(
-00062e00: 2225 592d 256d 2d25 6420 2548 3a25 4d3a  "%Y-%m-%d %H:%M:
-00062e10: 2553 2229 290d 0a20 2020 2020 2020 2020  %S"))..         
-00062e20: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
-00062e30: 6528 3229 3a0d 0a20 2020 2020 2020 2020  e(2):..         
-00062e40: 2020 2020 2020 2064 6220 3d20 7365 6c66         db = self
-00062e50: 2e64 6232 2069 6620 6920 656c 7365 2073  .db2 if i else s
-00062e60: 656c 662e 6462 310d 0a20 2020 2020 2020  elf.db1..       
-00062e70: 2020 2020 2020 2020 2063 6f6e 6469 6666           condiff
-00062e80: 203d 2073 656c 662e 636f 6e32 6469 6666   = self.con2diff
-00062e90: 2069 6620 6920 656c 7365 2073 656c 662e   if i else self.
-00062ea0: 636f 6e31 6469 6666 0d0a 2020 2020 2020  con1diff..      
-00062eb0: 2020 2020 2020 2020 2020 636f 6e74 6163            contac
-00062ec0: 7473 203d 2063 6f6e 7461 6374 7332 2069  ts = contacts2 i
-00062ed0: 6620 6920 656c 7365 2063 6f6e 7461 6374  f i else contact
-00062ee0: 7331 0d0a 2020 2020 2020 2020 2020 2020  s1..            
-00062ef0: 2020 2020 6462 2e75 7064 6174 655f 6669      db.update_fi
-00062f00: 6c65 696e 666f 2829 0d0a 2020 2020 2020  leinfo()..      
-00062f10: 2020 2020 2020 2020 2020 6c61 6265 6c20            label 
-00062f20: 3d20 7365 6c66 2e6c 6162 656c 5f61 6c6c  = self.label_all
-00062f30: 3220 6966 2069 2065 6c73 6520 7365 6c66  2 if i else self
-00062f40: 2e6c 6162 656c 5f61 6c6c 310d 0a20 2020  .label_all1..   
-00062f50: 2020 2020 2020 2020 2020 2020 206c 6162               lab
-00062f60: 656c 2e4c 6162 656c 203d 2022 2573 2e5c  el.Label = "%s.\
-00062f70: 6e5c 6e53 697a 6520 2573 2e5c 6e4c 6173  n\nSize %s.\nLas
-00062f80: 7420 6d6f 6469 6669 6564 2025 732e 5c6e  t modified %s.\n
-00062f90: 2220 2520 280d 0a20 2020 2020 2020 2020  " % (..         
-00062fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00062fb0: 2020 2020 2064 622c 2075 7469 6c2e 666f       db, util.fo
-00062fc0: 726d 6174 5f62 7974 6573 2864 622e 6669  rmat_bytes(db.fi
-00062fd0: 6c65 7369 7a65 292c 0d0a 2020 2020 2020  lesize),..      
-00062fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00062ff0: 2020 2020 2020 2020 6462 2e6c 6173 745f          db.last_
-00063000: 6d6f 6469 6669 6564 2e73 7472 6674 696d  modified.strftim
-00063010: 6528 2225 592d 256d 2d25 6420 2548 3a25  e("%Y-%m-%d %H:%
-00063020: 4d3a 2553 2229 290d 0a20 2020 2020 2020  M:%S"))..       
-00063030: 2020 2020 2020 2020 2063 6861 7473 203d           chats =
-00063040: 2063 6861 7473 3220 6966 2069 2065 6c73   chats2 if i els
-00063050: 6520 6368 6174 7331 0d0a 2020 2020 2020  e chats1..      
-00063060: 2020 2020 2020 2020 2020 6966 2063 6861            if cha
-00063070: 7473 3a0d 0a20 2020 2020 2020 2020 2020  ts:..           
-00063080: 2020 2020 2020 2020 2074 3120 3d20 6c69           t1 = li
-00063090: 7374 2866 696c 7465 7228 626f 6f6c 2c20  st(filter(bool, 
-000630a0: 5b63 5b22 6d65 7373 6167 655f 636f 756e  [c["message_coun
-000630b0: 7422 5d20 666f 7220 6320 696e 2063 6861  t"] for c in cha
-000630c0: 7473 5d29 290d 0a20 2020 2020 2020 2020  ts]))..         
-000630d0: 2020 2020 2020 2020 2020 2063 6f75 6e74             count
-000630e0: 5f6d 6573 7361 6765 7320 3d20 7375 6d28  _messages = sum(
-000630f0: 7431 2920 6966 2074 3120 656c 7365 2030  t1) if t1 else 0
-00063100: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00063110: 2020 2020 2020 7432 203d 206c 6973 7428        t2 = list(
-00063120: 6669 6c74 6572 2862 6f6f 6c2c 205b 635b  filter(bool, [c[
-00063130: 2266 6972 7374 5f6d 6573 7361 6765 5f64  "first_message_d
-00063140: 6174 6574 696d 6522 5d20 666f 7220 6320  atetime"] for c 
-00063150: 696e 2063 6861 7473 5d29 290d 0a20 2020  in chats]))..   
-00063160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00063170: 2064 6174 6574 696d 655f 6669 7273 7420   datetime_first 
-00063180: 3d20 6d69 6e28 7432 2920 6966 2074 3220  = min(t2) if t2 
-00063190: 656c 7365 204e 6f6e 650d 0a20 2020 2020  else None..     
-000631a0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-000631b0: 3320 3d20 6c69 7374 2866 696c 7465 7228  3 = list(filter(
-000631c0: 626f 6f6c 2c20 5b63 5b22 6c61 7374 5f6d  bool, [c["last_m
-000631d0: 6573 7361 6765 5f64 6174 6574 696d 6522  essage_datetime"
-000631e0: 5d20 666f 7220 6320 696e 2063 6861 7473  ] for c in chats
-000631f0: 5d29 290d 0a20 2020 2020 2020 2020 2020  ]))..           
-00063200: 2020 2020 2020 2020 2064 6174 6574 696d           datetim
-00063210: 655f 6c61 7374 203d 206d 6178 2874 3329  e_last = max(t3)
-00063220: 2069 6620 7433 2065 6c73 6520 4e6f 6e65   if t3 else None
-00063230: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00063240: 2020 2020 2020 6461 7465 7465 7874 5f66        datetext_f
-00063250: 6972 7374 203d 2022 2220 6966 206e 6f74  irst = "" if not
-00063260: 2064 6174 6574 696d 655f 6669 7273 7420   datetime_first 
-00063270: 5c0d 0a20 2020 2020 2020 2020 2020 2020  \..             
-00063280: 2020 2020 2020 2020 2020 2065 6c73 6520             else 
-00063290: 6461 7465 7469 6d65 5f66 6972 7374 2e73  datetime_first.s
-000632a0: 7472 6674 696d 6528 2225 592d 256d 2d25  trftime("%Y-%m-%
-000632b0: 6420 2548 3a25 4d3a 2553 2229 0d0a 2020  d %H:%M:%S")..  
-000632c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000632d0: 2020 6461 7465 7465 7874 5f6c 6173 7420    datetext_last 
-000632e0: 3d20 2222 2069 6620 6e6f 7420 6461 7465  = "" if not date
-000632f0: 7469 6d65 5f6c 6173 7420 5c0d 0a20 2020  time_last \..   
-00063300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00063310: 2020 2020 2065 6c73 6520 6461 7465 7469       else dateti
-00063320: 6d65 5f6c 6173 742e 7374 7266 7469 6d65  me_last.strftime
-00063330: 2822 2559 2d25 6d2d 2564 2025 483a 254d  ("%Y-%m-%d %H:%M
-00063340: 3a25 5322 290d 0a20 2020 2020 2020 2020  :%S")..         
-00063350: 2020 2020 2020 2020 2020 2063 6f6e 7461             conta
-00063360: 6374 7465 7874 203d 2075 7469 6c2e 706c  cttext = util.pl
-00063370: 7572 616c 2822 636f 6e74 6163 7422 2c20  ural("contact", 
-00063380: 636f 6e74 6163 7473 2c20 7365 703d 222c  contacts, sep=",
-00063390: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
-000633a0: 2020 2020 2020 2020 6966 2063 6f6e 6469          if condi
-000633b0: 6666 3a0d 0a20 2020 2020 2020 2020 2020  ff:..           
-000633c0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-000633d0: 7461 6374 7465 7874 202b 3d20 2220 2825  tacttext += " (%
-000633e0: 6420 6e6f 7420 7072 6573 656e 7420 6f6e  d not present on
-000633f0: 2074 6865 2025 7329 2220 2520 280d 0a20   the %s)" % (.. 
-00063400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00063410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00063420: 2020 2020 2020 6c65 6e28 636f 6e64 6966        len(condif
-00063430: 6629 2c20 5b22 7269 6768 7422 2c20 226c  f), ["right", "l
-00063440: 6566 7422 5d5b 695d 290d 0a20 2020 2020  eft"][i])..     
-00063450: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-00063460: 6162 656c 2e4c 6162 656c 202b 3d20 2225  abel.Label += "%
-00063470: 732e 5c6e 2573 2e5c 6e25 732e 5c6e 4669  s.\n%s.\n%s.\nFi
-00063480: 7273 7420 6d65 7373 6167 6520 6174 2025  rst message at %
-00063490: 732e 5c6e 2220 5c0d 0a20 2020 2020 2020  s.\n" \..       
-000634a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000634b0: 2020 2020 2020 2020 2020 2020 224c 6173              "Las
-000634c0: 7420 6d65 7373 6167 6520 6174 2025 732e  t message at %s.
-000634d0: 2220 2520 280d 0a20 2020 2020 2020 2020  " % (..         
-000634e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000634f0: 2020 2020 2020 2020 2020 7574 696c 2e70            util.p
-00063500: 6c75 7261 6c28 2263 6f6e 7665 7273 6174  lural("conversat
-00063510: 696f 6e22 2c20 6368 6174 732c 2073 6570  ion", chats, sep
-00063520: 3d22 2c22 292c 0d0a 2020 2020 2020 2020  =","),..        
-00063530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00063540: 2020 2020 2020 2020 2020 2075 7469 6c2e             util.
-00063550: 706c 7572 616c 2822 6d65 7373 6167 6522  plural("message"
-00063560: 2c20 636f 756e 745f 6d65 7373 6167 6573  , count_messages
-00063570: 2c20 7365 703d 222c 2229 2c0d 0a20 2020  , sep=","),..   
-00063580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00063590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000635a0: 636f 6e74 6163 7474 6578 742c 2064 6174  contacttext, dat
-000635b0: 6574 6578 745f 6669 7273 742c 2064 6174  etext_first, dat
-000635c0: 6574 6578 745f 6c61 7374 290d 0a20 2020  etext_last)..   
-000635d0: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
-000635e0: 7074 696f 6e20 6173 2065 3a0d 0a20 2020  ption as e:..   
-000635f0: 2020 2020 2020 2020 2023 2044 6174 6162           # Datab
-00063600: 6173 6520 6163 6365 7373 2063 616e 2065  ase access can e
-00063610: 6173 696c 7920 6661 696c 2069 6620 7468  asily fail if th
-00063620: 6520 7573 6572 2063 6c6f 7365 7320 7468  e user closes th
-00063630: 6520 7461 6220 6265 666f 7265 0d0a 2020  e tab before..  
-00063640: 2020 2020 2020 2020 2020 2320 7468 6520            # the 
-00063650: 6c61 7465 7220 6461 7461 2068 6173 2062  later data has b
-00063660: 6565 6e20 6c6f 6164 6564 2e0d 0a20 2020  een loaded...   
-00063670: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-00063680: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00063690: 2020 206c 6f67 6765 722e 6578 6365 7074     logger.except
-000636a0: 696f 6e28 2245 7272 6f72 206c 6f61 6469  ion("Error loadi
-000636b0: 6e67 2061 6464 6974 696f 6e61 6c20 6461  ng additional da
-000636c0: 7461 2066 726f 6d20 2573 206f 7220 2573  ta from %s or %s
-000636d0: 2e22 2c0d 0a20 2020 2020 2020 2020 2020  .",..           
-000636e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000636f0: 2020 2020 2020 7365 6c66 2e64 6231 2c20        self.db1, 
-00063700: 7365 6c66 2e64 6232 290d 0a20 2020 2020  self.db2)..     
-00063710: 2020 2020 2020 2020 2020 2077 782e 4d65             wx.Me
-00063720: 7373 6167 6542 6f78 2822 4572 726f 7220  ssageBox("Error 
-00063730: 6c6f 6164 696e 6720 6164 6469 7469 6f6e  loading addition
-00063740: 616c 2064 6174 6120 6672 6f6d 2025 7320  al data from %s 
-00063750: 6f72 2025 732e 220d 0a20 2020 2020 2020  or %s."..       
-00063760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00063770: 2020 2020 2020 2022 5c6e 5c6e 4572 726f         "\n\nErro
-00063780: 723a 2025 732e 2220 2520 2873 656c 662e  r: %s." % (self.
-00063790: 6462 312c 2073 656c 662e 6462 322c 2075  db1, self.db2, u
-000637a0: 7469 6c2e 666f 726d 6174 5f65 7863 2865  til.format_exc(e
-000637b0: 2929 2c0d 0a20 2020 2020 2020 2020 2020  )),..           
-000637c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000637d0: 2020 2063 6f6e 662e 5469 746c 652c 2077     conf.Title, w
-000637e0: 782e 4f4b 207c 2077 782e 4943 4f4e 5f57  x.OK | wx.ICON_W
-000637f0: 4152 4e49 4e47 290d 0a0d 0a20 2020 2020  ARNING)....     
-00063800: 2020 2069 6620 7365 6c66 3a0d 0a20 2020     if self:..   
-00063810: 2020 2020 2020 2020 2073 656c 662e 6275           self.bu
-00063820: 7474 6f6e 5f73 7761 702e 456e 6162 6c65  tton_swap.Enable
-00063830: 6420 3d20 5472 7565 0d0a 2020 2020 2020  d = True..      
-00063840: 2020 2020 2020 7365 6c66 2e62 7574 746f        self.butto
-00063850: 6e5f 6d65 7267 655f 6368 6174 732e 456e  n_merge_chats.En
-00063860: 6162 6c65 6420 3d20 5472 7565 0d0a 2020  abled = True..  
-00063870: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-00063880: 2073 656c 662e 6973 5f73 6361 6e6e 6564   self.is_scanned
-00063890: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-000638a0: 2020 2073 656c 662e 6275 7474 6f6e 5f73     self.button_s
-000638b0: 6361 6e5f 616c 6c2e 456e 6162 6c65 6420  can_all.Enabled 
-000638c0: 3d20 5472 7565 0d0a 2020 2020 2020 2020  = True..        
-000638d0: 2020 2020 2020 2020 7365 6c66 2e62 7574          self.but
-000638e0: 746f 6e5f 6d65 7267 655f 616c 6c2e 456e  ton_merge_all.En
-000638f0: 6162 6c65 6420 3d20 5472 7565 0d0a 2020  abled = True..  
-00063900: 2020 2020 2020 2020 2020 6775 6962 6173            guibas
-00063910: 652e 7374 6174 7573 2822 4f70 656e 6564  e.status("Opened
-00063920: 2025 7320 616e 6420 2573 2e22 2c20 7365   %s and %s.", se
-00063930: 6c66 2e64 6231 2c20 7365 6c66 2e64 6232  lf.db1, self.db2
-00063940: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
-00063950: 656c 662e 7061 6765 5f6d 6572 6765 5f61  elf.page_merge_a
-00063960: 6c6c 2e4c 6179 6f75 7428 290d 0a20 2020  ll.Layout()..   
-00063970: 2020 2020 2020 2020 2073 656c 662e 5265           self.Re
-00063980: 6672 6573 6828 290d 0a20 2020 2020 2020  fresh()..       
-00063990: 2020 2020 2077 782e 4361 6c6c 4166 7465       wx.CallAfte
-000639a0: 7228 7365 6c66 2e75 7064 6174 655f 7461  r(self.update_ta
-000639b0: 6268 6561 6465 7229 0d0a 0d0a 0d0a 0d0a  bheader)........
-000639c0: 636c 6173 7320 4368 6174 436f 6e74 656e  class ChatConten
-000639d0: 7453 5443 2863 6f6e 7472 6f6c 732e 5365  tSTC(controls.Se
-000639e0: 6172 6368 6162 6c65 5374 796c 6564 5465  archableStyledTe
-000639f0: 7874 4374 726c 293a 0d0a 2020 2020 2222  xtCtrl):..    ""
-00063a00: 2241 2053 7479 6c65 6454 6578 7443 7472  "A StyledTextCtr
-00063a10: 6c20 666f 7220 7368 6f77 696e 6720 616e  l for showing an
-00063a20: 6420 6669 6c74 6572 696e 6720 6368 6174  d filtering chat
-00063a30: 206d 6573 7361 6765 732e 2222 220d 0a0d   messages."""...
-00063a40: 0a20 2020 2054 4558 545f 4e4f 5f4d 4553  .    TEXT_NO_MES
-00063a50: 5341 4745 5320 3d20 225c 6e4e 6f20 6d65  SAGES = "\nNo me
-00063a60: 7373 6167 6573 2074 6f20 7368 6f77 2e22  ssages to show."
-00063a70: 0d0a 0d0a 2020 2020 2222 2253 5443 207a  ....    """STC z
-00063a80: 6f6f 6d20 6c65 7665 6c73 2074 6f20 6566  oom levels to ef
-00063a90: 6665 6374 6976 6520 7465 7874 2073 697a  fective text siz
-00063aa0: 6520 6d75 6c74 6970 6c69 6572 732e 2222  e multipliers.""
-00063ab0: 220d 0a20 2020 205a 4f4f 4d5f 5045 5243  "..    ZOOM_PERC
-00063ac0: 454e 5453 203d 207b 0d0a 2020 2020 2020  ENTS = {..      
-00063ad0: 2020 202d 383a 2020 2e32 352c 2023 204c     -8:  .25, # L
-00063ae0: 6f77 6572 2076 616c 7565 7320 6469 7370  ower values disp
-00063af0: 6c61 7965 6420 7769 7468 2073 616d 6520  layed with same 
-00063b00: 7369 7a65 0d0a 2020 2020 2020 2020 202d  size..         -
-00063b10: 353a 2020 2e35 302c 0d0a 2020 2020 2020  5:  .50,..      
-00063b20: 2020 202d 333a 2020 2e38 302c 2023 2041     -3:  .80, # A
-00063b30: 7070 726f 7869 6d61 7465 0d0a 2020 2020  pproximate..    
-00063b40: 2020 2020 2020 303a 2031 2e30 302c 0d0a        0: 1.00,..
-00063b50: 2020 2020 2020 2020 2020 323a 2031 2e32            2: 1.2
-00063b60: 302c 2023 2041 7070 726f 7869 6d61 7465  0, # Approximate
-00063b70: 0d0a 2020 2020 2020 2020 2020 353a 2031  ..          5: 1
-00063b80: 2e35 302c 0d0a 2020 2020 2020 2020 2020  .50,..          
-00063b90: 373a 2031 2e37 352c 0d0a 2020 2020 2020  7: 1.75,..      
-00063ba0: 2020 2031 303a 2032 2e30 302c 2023 2041     10: 2.00, # A
-00063bb0: 7070 726f 7869 6d61 7465 0d0a 2020 2020  pproximate..    
-00063bc0: 2020 2020 2031 353a 2032 2e35 302c 0d0a       15: 2.50,..
-00063bd0: 2020 2020 2020 2020 2032 303a 2033 2e30           20: 3.0
-00063be0: 302c 0d0a 2020 2020 7d0d 0a20 2020 205a  0,..    }..    Z
-00063bf0: 4f4f 4d5f 5045 5243 454e 545f 4d41 5820  OOM_PERCENT_MAX 
-00063c00: 3d20 3130 2e30 0d0a 0d0a 0d0a 2020 2020  = 10.0......    
-00063c10: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
-00063c20: 662c 202a 6172 6773 2c20 2a2a 6b77 6172  f, *args, **kwar
-00063c30: 6773 293a 0d0a 2020 2020 2020 2020 636f  gs):..        co
-00063c40: 6e74 726f 6c73 2e53 6561 7263 6861 626c  ntrols.Searchabl
-00063c50: 6553 7479 6c65 6454 6578 7443 7472 6c2e  eStyledTextCtrl.
-00063c60: 5f5f 696e 6974 5f5f 2873 656c 662c 202a  __init__(self, *
-00063c70: 6172 6773 2c20 2a2a 6b77 6172 6773 290d  args, **kwargs).
-00063c80: 0a20 2020 2020 2020 2073 656c 662e 5365  .        self.Se
-00063c90: 7455 6e64 6f43 6f6c 6c65 6374 696f 6e28  tUndoCollection(
-00063ca0: 4661 6c73 6529 0d0a 0d0a 2020 2020 2020  False)....      
-00063cb0: 2020 7365 6c66 2e5f 7061 7273 6572 203d    self._parser =
-00063cc0: 204e 6f6e 6520 2020 2020 2320 4375 7272   None     # Curr
-00063cd0: 656e 7420 736b 7970 6564 6174 612e 4d65  ent skypedata.Me
-00063ce0: 7373 6167 6550 6172 7365 7220 696e 7374  ssageParser inst
-00063cf0: 616e 6365 0d0a 2020 2020 2020 2020 7365  ance..        se
-00063d00: 6c66 2e5f 6368 6174 203d 204e 6f6e 6520  lf._chat = None 
-00063d10: 2020 2020 2020 2320 4375 7272 656e 746c        # Currentl
-00063d20: 7920 7368 6f77 6e20 6368 6174 0d0a 2020  y shown chat..  
-00063d30: 2020 2020 2020 7365 6c66 2e5f 6462 203d        self._db =
-00063d40: 204e 6f6e 6520 2020 2020 2020 2020 2320   None         # 
-00063d50: 4461 7461 6261 7365 2066 6f72 2063 7572  Database for cur
-00063d60: 7265 6e74 6c79 2073 686f 776e 206d 6573  rently shown mes
-00063d70: 7361 6765 730d 0a20 2020 2020 2020 2073  sages..        s
-00063d80: 656c 662e 5f70 6167 6520 3d20 4e6f 6e65  elf._page = None
-00063d90: 2020 2020 2020 2023 2044 6174 6162 6173         # Databas
-00063da0: 6550 6167 652f 4d65 7267 6572 5061 6765  ePage/MergerPage
-00063db0: 2066 6f72 2061 6374 696f 6e20 6361 6c6c   for action call
-00063dc0: 6261 636b 730d 0a20 2020 2020 2020 2073  backs..        s
-00063dd0: 656c 662e 5f6d 6573 7361 6765 7320 3d20  elf._messages = 
-00063de0: 4e6f 6e65 2020 2023 204c 6973 7420 6f66  None   # List of
-00063df0: 2061 6c6c 2072 6574 7269 6576 6564 206d   all retrieved m
-00063e00: 6573 7361 6765 730d 0a20 2020 2020 2020  essages..       
-00063e10: 2073 656c 662e 5f6d 6573 7361 6765 735f   self._messages_
-00063e20: 6375 7272 656e 7420 3d20 4e6f 6e65 2020  current = None  
-00063e30: 2320 4c69 7374 206f 6620 6375 7272 656e  # List of curren
-00063e40: 746c 7920 7368 6f77 6e20 6d65 7373 6167  tly shown messag
-00063e50: 6573 0d0a 2020 2020 2020 2020 7365 6c66  es..        self
-00063e60: 2e5f 6d65 7373 6167 655f 706f 7369 7469  ._message_positi
-00063e70: 6f6e 7320 3d20 636f 6c6c 6563 7469 6f6e  ons = collection
-00063e80: 732e 4f72 6465 7265 6444 6963 7428 2920  s.OrderedDict() 
-00063e90: 2320 7b6d 7367 2069 643a 2028 7374 6172  # {msg id: (star
-00063ea0: 7420 696e 6465 782c 2065 6e64 2069 6e64  t index, end ind
-00063eb0: 6578 297d 0d0a 2020 2020 2020 2020 7365  ex)}..        se
-00063ec0: 6c66 2e5f 6d65 7373 6167 655f 6d61 7020  lf._message_map 
-00063ed0: 3d20 636f 6c6c 6563 7469 6f6e 732e 4f72  = collections.Or
-00063ee0: 6465 7265 6444 6963 7428 2920 2320 7b6d  deredDict() # {m
-00063ef0: 7367 2049 443a 207b 6d73 677d 7d0d 0a20  sg ID: {msg}}.. 
-00063f00: 2020 2020 2020 2023 2049 6620 7365 742c         # If set,
-00063f10: 2072 616e 6765 2069 7320 6365 6e74 6572   range is center
-00063f20: 6564 2061 726f 756e 6420 7468 6520 6d65  ed around the me
-00063f30: 7373 6167 6520 7769 7468 2074 6865 2073  ssage with the s
-00063f40: 7065 6369 6669 6564 2049 440d 0a20 2020  pecified ID..   
-00063f50: 2020 2020 2073 656c 662e 5f63 656e 7465       self._cente
-00063f60: 725f 6d65 7373 6167 655f 6964 203d 2020  r_message_id =  
-00063f70: 2020 4e6f 6e65 0d0a 2020 2020 2020 2020    None..        
-00063f80: 2320 496e 6465 7820 6f66 2074 6865 2063  # Index of the c
-00063f90: 656e 7465 7265 6420 6d65 7373 6167 6520  entered message 
-00063fa0: 696e 205f 6d65 7373 6167 6573 0d0a 2020  in _messages..  
-00063fb0: 2020 2020 2020 7365 6c66 2e5f 6365 6e74        self._cent
-00063fc0: 6572 5f6d 6573 7361 6765 5f69 6e64 6578  er_message_index
-00063fd0: 203d 204e 6f6e 650d 0a20 2020 2020 2020   = None..       
-00063fe0: 2073 656c 662e 5f75 726c 6c69 6e6b 7320   self._urllinks 
-00063ff0: 203d 207b 7d20 2320 7b6c 696e 6b20 7374   = {} # {link st
-00064000: 6172 7420 706f 7369 7469 6f6e 3a20 7572  art position: ur
-00064010: 6c7d 0d0a 2020 2020 2020 2020 7365 6c66  l}..        self
-00064020: 2e5f 6669 6c65 6c69 6e6b 7320 3d20 7b7d  ._filelinks = {}
-00064030: 2023 207b 6c69 6e6b 2073 7461 7274 2070   # {link start p
-00064040: 6f73 6974 696f 6e3a 2066 696c 6520 7061  osition: file pa
-00064050: 7468 7d0d 0a20 2020 2020 2020 2073 656c  th}..        sel
-00064060: 662e 5f64 6174 656c 696e 6b73 203d 207b  f._datelinks = {
-00064070: 7d20 2320 7b6c 696e 6b20 7374 6172 7420  } # {link start 
-00064080: 706f 7369 7469 6f6e 3a20 7477 6f20 6461  position: two da
-00064090: 7465 732c 207d 0d0a 2020 2020 2020 2020  tes, }..        
-000640a0: 7365 6c66 2e5f 6461 7465 6c69 6e6b 5f6c  self._datelink_l
-000640b0: 6173 7420 3d20 4e6f 6e65 2023 2054 6974  ast = None # Tit
-000640c0: 6c65 206f 6620 636c 6963 6b65 6420 6461  le of clicked da
-000640d0: 7465 206c 696e 6b2c 2069 6620 616e 790d  te link, if any.
-000640e0: 0a20 2020 2020 2020 2023 2043 7572 7265  .        # Curre
-000640f0: 6e74 6c79 2073 6574 206d 6573 7361 6765  ntly set message
-00064100: 2066 696c 7465 7220 7b22 6461 7465 7261   filter {"datera
-00064110: 6e67 6522 3a20 2864 6174 6574 696d 652c  nge": (datetime,
-00064120: 2064 6174 6574 696d 6529 2c0d 0a20 2020   datetime),..   
-00064130: 2020 2020 2023 2022 7465 7874 223a 2074       # "text": t
-00064140: 6578 7420 696e 206d 6573 7361 6765 2c20  ext in message, 
-00064150: 2270 6172 7469 6369 7061 6e74 7322 3a20  "participants": 
-00064160: 5b73 6b79 7065 6e61 6d65 312c 205d 2c0d  [skypename1, ],.
-00064170: 0a20 2020 2020 2020 2023 2022 6d65 7373  .        # "mess
-00064180: 6167 655f 6964 223a 206d 6573 7361 6765  age_id": message
-00064190: 2049 4420 746f 2073 686f 772c 2072 616e   ID to show, ran
-000641a0: 6765 2073 686f 776e 2077 696c 6c20 6265  ge shown will be
-000641b0: 2063 656e 7465 7265 640d 0a20 2020 2020   centered..     
-000641c0: 2020 2023 2061 726f 756e 6420 6974 7d0d     # around it}.
-000641d0: 0a20 2020 2020 2020 2073 656c 662e 5f66  .        self._f
-000641e0: 696c 7465 7220 3d20 7b7d 0d0a 2020 2020  ilter = {}..    
-000641f0: 2020 2020 7365 6c66 2e5f 6669 6c74 6572      self._filter
-00064200: 7465 7874 5f72 6778 203d 204e 6f6e 6520  text_rgx = None 
-00064210: 2320 4361 6368 6564 2072 6567 6578 2066  # Cached regex f
-00064220: 6f72 2066 696c 7465 725b 2274 6578 7422  or filter["text"
-00064230: 5d0d 0a20 2020 2020 2020 2073 656c 662e  ]..        self.
-00064240: 5f61 7574 6f5f 7265 7472 6965 7665 203d  _auto_retrieve =
-00064250: 2054 7275 6520 2320 5768 6574 6865 7220   True # Whether 
-00064260: 6e65 7720 6d65 7373 6167 6573 2072 6574  new messages ret
-00064270: 7269 6576 6564 206f 6e20 7265 6672 6573  rieved on refres
-00064280: 680d 0a0d 0a20 2020 2020 2020 2073 656c  h....        sel
-00064290: 662e 5f73 7479 6c65 7320 3d20 7b22 6465  f._styles = {"de
-000642a0: 6661 756c 7422 3a20 3130 2c20 2262 6f6c  fault": 10, "bol
-000642b0: 6422 3a20 3131 2c20 2274 696d 6573 7461  d": 11, "timesta
-000642c0: 6d70 223a 2031 322c 0d0a 2020 2020 2020  mp": 12,..      
-000642d0: 2020 2020 2020 2272 656d 6f74 6522 3a20        "remote": 
-000642e0: 3133 2c20 226c 6f63 616c 223a 2031 342c  13, "local": 14,
-000642f0: 2022 6c69 6e6b 223a 2031 352c 2022 7469   "link": 15, "ti
-00064300: 6e79 223a 2031 362c 0d0a 2020 2020 2020  ny": 16,..      
-00064310: 2020 2020 2020 2273 7065 6369 616c 223a        "special":
-00064320: 2031 372c 2022 626f 6c64 6465 6661 756c   17, "bolddefaul
-00064330: 7422 3a20 3138 2c20 2262 6f6c 646c 696e  t": 18, "boldlin
-00064340: 6b22 3a20 3139 2c0d 0a20 2020 2020 2020  k": 19,..       
-00064350: 2020 2020 2022 626f 6c64 7370 6563 6961       "boldspecia
-00064360: 6c22 3a20 3230 2c20 2272 656d 6f74 6577  l": 20, "remotew
-00064370: 6561 6b22 3a20 3231 2c20 226c 6f63 616c  eak": 21, "local
-00064380: 7765 616b 223a 2032 322c 0d0a 2020 2020  weak": 22,..    
-00064390: 2020 2020 2020 2020 2269 7461 6c69 6322          "italic"
-000643a0: 3a20 3233 2c20 2273 7472 696b 6522 3a20  : 23, "strike": 
-000643b0: 3234 0d0a 2020 2020 2020 2020 7d0d 0a20  24..        }.. 
-000643c0: 2020 2020 2020 2073 656c 662e 5365 7457         self.SetW
-000643d0: 7261 704d 6f64 6528 5472 7565 290d 0a20  rapMode(True).. 
-000643e0: 2020 2020 2020 2073 656c 662e 5365 744d         self.SetM
-000643f0: 6172 6769 6e4c 6566 7428 3130 290d 0a20  arginLeft(10).. 
-00064400: 2020 2020 2020 2073 656c 662e 5365 744d         self.SetM
-00064410: 6172 6769 6e57 6964 7468 2831 2c20 3029  arginWidth(1, 0)
-00064420: 2023 2048 6964 6520 6c65 6674 206d 6172   # Hide left mar
-00064430: 6769 6e0d 0a20 2020 2020 2020 2073 656c  gin..        sel
-00064440: 662e 5365 7452 6561 644f 6e6c 7928 5472  f.SetReadOnly(Tr
-00064450: 7565 290d 0a20 2020 2020 2020 2073 656c  ue)..        sel
-00064460: 662e 5365 7453 7479 6c65 5370 6563 7328  f.SetStyleSpecs(
-00064470: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00064480: 5f74 6578 7468 6569 6768 745f 7a6f 6f6d  _textheight_zoom
-00064490: 3020 3d20 7365 6c66 2e5f 7374 632e 5465  0 = self._stc.Te
-000644a0: 7874 4865 6967 6874 2830 290d 0a20 2020  xtHeight(0)..   
-000644b0: 2020 2020 2073 656c 662e 5365 745a 6f6f       self.SetZoo
-000644c0: 6d50 6572 6365 6e74 2863 6f6e 662e 4869  mPercent(conf.Hi
-000644d0: 7374 6f72 795a 6f6f 6d29 0d0a 0d0a 2020  storyZoom)....  
-000644e0: 2020 2020 2020 7365 6c66 2e5f 7374 632e        self._stc.
-000644f0: 4269 6e64 2877 782e 7374 632e 4556 545f  Bind(wx.stc.EVT_
-00064500: 5354 435f 484f 5453 504f 545f 434c 4943  STC_HOTSPOT_CLIC
-00064510: 4b2c 2073 656c 662e 4f6e 5572 6c29 0d0a  K, self.OnUrl)..
-00064520: 2020 2020 2020 2020 7365 6c66 2e5f 7374          self._st
-00064530: 632e 4269 6e64 2877 782e 4556 545f 5249  c.Bind(wx.EVT_RI
-00064540: 4748 545f 5550 2c20 7365 6c66 2e4f 6e4d  GHT_UP, self.OnM
-00064550: 656e 7529 0d0a 2020 2020 2020 2020 7365  enu)..        se
-00064560: 6c66 2e5f 7374 632e 4269 6e64 2877 782e  lf._stc.Bind(wx.
-00064570: 4556 545f 434f 4e54 4558 545f 4d45 4e55  EVT_CONTEXT_MENU
-00064580: 2c20 7365 6c66 2e4f 6e4d 656e 7529 0d0a  , self.OnMenu)..
-00064590: 2020 2020 2020 2020 7365 6c66 2e5f 7374          self._st
-000645a0: 632e 4269 6e64 2877 782e 4556 545f 5359  c.Bind(wx.EVT_SY
-000645b0: 535f 434f 4c4f 5552 5f43 4841 4e47 4544  S_COLOUR_CHANGED
-000645c0: 2c20 7365 6c66 2e4f 6e53 7973 436f 6c6f  , self.OnSysColo
-000645d0: 7572 4368 616e 6765 290d 0a20 2020 2020  urChange)..     
-000645e0: 2020 2073 656c 662e 5f73 7463 2e42 696e     self._stc.Bin
-000645f0: 6428 7778 2e73 7463 2e45 5654 5f53 5443  d(wx.stc.EVT_STC
-00064600: 5f5a 4f4f 4d2c 2073 656c 662e 4f6e 5a6f  _ZOOM, self.OnZo
-00064610: 6f6d 290d 0a20 2020 2020 2020 2023 2048  om)..        # H
-00064620: 6964 6520 6361 7265 740d 0a20 2020 2020  ide caret..     
-00064630: 2020 2073 656c 662e 5365 7443 6172 6574     self.SetCaret
-00064640: 466f 7265 6772 6f75 6e64 2863 6f6e 662e  Foreground(conf.
-00064650: 4267 436f 6c6f 7572 292c 2073 656c 662e  BgColour), self.
-00064660: 5365 7443 6172 6574 5769 6474 6828 3029  SetCaretWidth(0)
-00064670: 0d0a 0d0a 0d0a 2020 2020 6465 6620 5365  ......    def Se
-00064680: 7453 7479 6c65 5370 6563 7328 7365 6c66  tStyleSpecs(self
-00064690: 293a 0d0a 2020 2020 2020 2020 2222 2253  ):..        """S
-000646a0: 6574 7320 5354 4320 7374 796c 6520 636f  ets STC style co
-000646b0: 6c6f 7572 732e 2222 220d 0a20 2020 2020  lours."""..     
-000646c0: 2020 2073 7479 6c65 7370 6563 7320 3d20     stylespecs = 
-000646d0: 7b0d 0a20 2020 2020 2020 2020 2020 2022  {..            "
-000646e0: 6465 6661 756c 7422 3a20 2020 2020 2022  default":      "
-000646f0: 6661 6365 3a25 732c 7369 7a65 3a25 642c  face:%s,size:%d,
-00064700: 666f 7265 3a25 732c 6261 636b 3a25 7322  fore:%s,back:%s"
-00064710: 2025 0d0a 2020 2020 2020 2020 2020 2020   %..            
-00064720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00064730: 2863 6f6e 662e 4869 7374 6f72 7946 6f6e  (conf.HistoryFon
-00064740: 744e 616d 652c 2063 6f6e 662e 4869 7374  tName, conf.Hist
-00064750: 6f72 7946 6f6e 7453 697a 652c 0d0a 2020  oryFontSize,..  
-00064760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00064770: 2020 2020 2020 2020 2020 2063 6f6e 662e             conf.
-00064780: 4d65 7373 6167 6554 6578 7443 6f6c 6f75  MessageTextColou
-00064790: 722c 2063 6f6e 662e 4267 436f 6c6f 7572  r, conf.BgColour
-000647a0: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
-000647b0: 2262 6f6c 6464 6566 6175 6c74 223a 2022  "bolddefault": "
-000647c0: 626f 6c64 222c 0d0a 2020 2020 2020 2020  bold",..        
-000647d0: 2020 2020 2262 6f6c 6422 3a20 2020 2020      "bold":     
-000647e0: 2020 2022 626f 6c64 222c 0d0a 2020 2020     "bold",..    
-000647f0: 2020 2020 2020 2020 2274 696d 6573 7461          "timesta
-00064800: 6d70 223a 2020 2022 666f 7265 3a25 7322  mp":   "fore:%s"
-00064810: 2025 2063 6f6e 662e 4869 7374 6f72 7954   % conf.HistoryT
-00064820: 696d 6573 7461 6d70 436f 6c6f 7572 2c0d  imestampColour,.
-00064830: 0a20 2020 2020 2020 2020 2020 2022 7265  .            "re
-00064840: 6d6f 7465 223a 2020 2020 2020 2266 6f72  mote":      "for
-00064850: 653a 2573 2c62 6f6c 6422 2025 2063 6f6e  e:%s,bold" % con
-00064860: 662e 4869 7374 6f72 7952 656d 6f74 6541  f.HistoryRemoteA
-00064870: 7574 686f 7243 6f6c 6f75 722c 0d0a 2020  uthorColour,..  
-00064880: 2020 2020 2020 2020 2020 226c 6f63 616c            "local
-00064890: 223a 2020 2020 2020 2022 666f 7265 3a25  ":       "fore:%
-000648a0: 732c 626f 6c64 2220 2520 636f 6e66 2e48  s,bold" % conf.H
-000648b0: 6973 746f 7279 4c6f 6361 6c41 7574 686f  istoryLocalAutho
-000648c0: 7243 6f6c 6f75 722c 0d0a 2020 2020 2020  rColour,..      
-000648d0: 2020 2020 2020 2272 656d 6f74 6577 6561        "remotewea
-000648e0: 6b22 3a20 2022 666f 7265 3a25 7322 2025  k":  "fore:%s" %
-000648f0: 2063 6f6e 662e 4869 7374 6f72 7952 656d   conf.HistoryRem
-00064900: 6f74 6541 7574 686f 7243 6f6c 6f75 722c  oteAuthorColour,
-00064910: 0d0a 2020 2020 2020 2020 2020 2020 226c  ..            "l
-00064920: 6f63 616c 7765 616b 223a 2020 2022 666f  ocalweak":   "fo
-00064930: 7265 3a25 7322 2025 2063 6f6e 662e 4869  re:%s" % conf.Hi
-00064940: 7374 6f72 794c 6f63 616c 4175 7468 6f72  storyLocalAuthor
-00064950: 436f 6c6f 7572 2c0d 0a20 2020 2020 2020  Colour,..       
-00064960: 2020 2020 2022 6c69 6e6b 223a 2020 2020       "link":    
-00064970: 2020 2020 2266 6f72 653a 2573 2220 2520      "fore:%s" % 
-00064980: 636f 6e66 2e53 6b79 7065 4c69 6e6b 436f  conf.SkypeLinkCo
-00064990: 6c6f 7572 2c0d 0a20 2020 2020 2020 2020  lour,..         
-000649a0: 2020 2022 626f 6c64 6c69 6e6b 223a 2020     "boldlink":  
-000649b0: 2020 2266 6f72 653a 2573 2c62 6f6c 6422    "fore:%s,bold"
-000649c0: 2025 2063 6f6e 662e 536b 7970 654c 696e   % conf.SkypeLin
-000649d0: 6b43 6f6c 6f75 722c 0d0a 2020 2020 2020  kColour,..      
-000649e0: 2020 2020 2020 2274 696e 7922 3a20 2020        "tiny":   
-000649f0: 2020 2020 2022 7369 7a65 3a31 222c 0d0a       "size:1",..
-00064a00: 2020 2020 2020 2020 2020 2020 2273 7065              "spe
-00064a10: 6369 616c 223a 2020 2020 2022 666f 7265  cial":     "fore
-00064a20: 3a25 7322 2025 2063 6f6e 662e 4869 7374  :%s" % conf.Hist
-00064a30: 6f72 7947 7265 7943 6f6c 6f75 722c 0d0a  oryGreyColour,..
-00064a40: 2020 2020 2020 2020 2020 2020 2262 6f6c              "bol
-00064a50: 6473 7065 6369 616c 223a 2022 666f 7265  dspecial": "fore
-00064a60: 3a25 732c 626f 6c64 2220 2520 636f 6e66  :%s,bold" % conf
-00064a70: 2e48 6973 746f 7279 4772 6579 436f 6c6f  .HistoryGreyColo
-00064a80: 7572 2c0d 0a20 2020 2020 2020 2020 2020  ur,..           
-00064a90: 2022 6974 616c 6963 223a 2020 2020 2020   "italic":      
-00064aa0: 2269 7461 6c69 6322 2c0d 0a20 2020 2020  "italic",..     
-00064ab0: 2020 2020 2020 2022 7374 7269 6b65 223a         "strike":
-00064ac0: 2020 2020 2020 2275 6e64 6572 6c69 6e65        "underline
-00064ad0: 222c 0d0a 2020 2020 2020 2020 7d0d 0a20  ",..        }.. 
-00064ae0: 2020 2020 2020 2073 656c 662e 5374 796c         self.Styl
-00064af0: 6553 6574 5370 6563 2877 782e 7374 632e  eSetSpec(wx.stc.
-00064b00: 5354 435f 5354 594c 455f 4445 4641 554c  STC_STYLE_DEFAUL
-00064b10: 542c 2073 7479 6c65 7370 6563 735b 2264  T, stylespecs["d
-00064b20: 6566 6175 6c74 225d 290d 0a20 2020 2020  efault"])..     
-00064b30: 2020 2073 656c 662e 5374 796c 6543 6c65     self.StyleCle
-00064b40: 6172 416c 6c28 2920 2320 4170 706c 7920  arAll() # Apply 
-00064b50: 7468 6520 6e65 7720 6465 6661 756c 7420  the new default 
-00064b60: 7374 796c 6520 746f 2061 6c6c 2073 7479  style to all sty
-00064b70: 6c65 730d 0a20 2020 2020 2020 2066 6f72  les..        for
-00064b80: 2073 7479 6c65 2c20 7370 6563 2069 6e20   style, spec in 
-00064b90: 7374 796c 6573 7065 6373 2e69 7465 6d73  stylespecs.items
-00064ba0: 2829 3a0d 0a20 2020 2020 2020 2020 2020  ():..           
-00064bb0: 2073 656c 662e 5374 796c 6553 6574 5370   self.StyleSetSp
-00064bc0: 6563 2873 656c 662e 5f73 7479 6c65 735b  ec(self._styles[
-00064bd0: 7374 796c 655d 2c20 7370 6563 290d 0a20  style], spec).. 
-00064be0: 2020 2020 2020 2073 656c 662e 5374 796c         self.Styl
-00064bf0: 6553 6574 486f 7453 706f 7428 7365 6c66  eSetHotSpot(self
-00064c00: 2e5f 7374 796c 6573 5b22 6c69 6e6b 225d  ._styles["link"]
-00064c10: 2c20 5472 7565 290d 0a20 2020 2020 2020  , True)..       
-00064c20: 2073 656c 662e 5374 796c 6553 6574 486f   self.StyleSetHo
-00064c30: 7453 706f 7428 7365 6c66 2e5f 7374 796c  tSpot(self._styl
-00064c40: 6573 5b22 626f 6c64 6c69 6e6b 225d 2c20  es["boldlink"], 
-00064c50: 5472 7565 290d 0a0d 0a0d 0a20 2020 2064  True)......    d
-00064c60: 6566 2053 6574 4461 7461 6261 7365 5061  ef SetDatabasePa
-00064c70: 6765 2873 656c 662c 2070 6167 6529 3a0d  ge(self, page):.
-00064c80: 0a20 2020 2020 2020 2073 656c 662e 5f70  .        self._p
-00064c90: 6167 6520 3d20 7061 6765 0d0a 0d0a 0d0a  age = page......
-00064ca0: 2020 2020 6465 6620 4765 745a 6f6f 6d50      def GetZoomP
-00064cb0: 6572 6365 6e74 2873 656c 6629 3a0d 0a20  ercent(self):.. 
-00064cc0: 2020 2020 2020 2022 2222 5265 7475 726e         """Return
-00064cd0: 7320 6375 7272 656e 7420 7465 7874 207a  s current text z
-00064ce0: 6f6f 6d20 6c65 7665 6c2c 2061 7320 6672  oom level, as fr
-00064cf0: 6163 7469 6f6e 616c 2070 6572 6365 6e74  actional percent
-00064d00: 6167 652c 2065 2e67 2e20 312e 3020 6973  age, e.g. 1.0 is
-00064d10: 2064 6566 6175 6c74 2e22 2222 0d0a 2020   default."""..  
-00064d20: 2020 2020 2020 7065 7263 656e 7420 3d20        percent = 
-00064d30: 7365 6c66 2e5a 4f4f 4d5f 5045 5243 454e  self.ZOOM_PERCEN
-00064d40: 5453 2e67 6574 2873 656c 662e 5f73 7463  TS.get(self._stc
-00064d50: 2e5a 6f6f 6d29 0d0a 2020 2020 2020 2020  .Zoom)..        
-00064d60: 6966 2070 6572 6365 6e74 2069 7320 4e6f  if percent is No
-00064d70: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
-00064d80: 2070 6572 6365 6e74 203d 2066 6c6f 6174   percent = float
-00064d90: 2873 656c 662e 5f73 7463 2e54 6578 7448  (self._stc.TextH
-00064da0: 6569 6768 7428 3029 2920 2f20 7365 6c66  eight(0)) / self
-00064db0: 2e5f 7465 7874 6865 6967 6874 5f7a 6f6f  ._textheight_zoo
-00064dc0: 6d30 0d0a 2020 2020 2020 2020 7265 7475  m0..        retu
-00064dd0: 726e 2070 6572 6365 6e74 0d0a 2020 2020  rn percent..    
-00064de0: 6465 6620 5365 745a 6f6f 6d50 6572 6365  def SetZoomPerce
-00064df0: 6e74 2873 656c 662c 2076 616c 7565 293a  nt(self, value):
-00064e00: 0d0a 2020 2020 2020 2020 2222 2253 6574  ..        """Set
-00064e10: 7320 6375 7272 656e 7420 7465 7874 207a  s current text z
-00064e20: 6f6f 6d20 6c65 7665 6c2c 2061 7320 6672  oom level, as fr
-00064e30: 6163 7469 6f6e 616c 2070 6572 6365 6e74  actional percent
-00064e40: 6167 652c 2065 2e67 2e20 312e 3020 6973  age, e.g. 1.0 is
-00064e50: 2064 6566 6175 6c74 2e22 2222 0d0a 2020   default."""..  
-00064e60: 2020 2020 2020 7661 6c75 6520 3d20 666c        value = fl
-00064e70: 6f61 7428 6d61 7828 6d69 6e28 7365 6c66  oat(max(min(self
-00064e80: 2e5a 4f4f 4d5f 5045 5243 454e 5453 2e76  .ZOOM_PERCENTS.v
-00064e90: 616c 7565 7328 2929 2c20 6d69 6e28 7661  alues()), min(va
-00064ea0: 6c75 652c 2073 656c 662e 5a4f 4f4d 5f50  lue, self.ZOOM_P
-00064eb0: 4552 4345 4e54 5f4d 4158 2929 290d 0a20  ERCENT_MAX))).. 
-00064ec0: 2020 2020 2020 207a 6f6f 6d20 3d20 6e65         zoom = ne
-00064ed0: 7874 2828 6b20 666f 7220 6b2c 2076 2069  xt((k for k, v i
-00064ee0: 6e20 7365 6c66 2e5a 4f4f 4d5f 5045 5243  n self.ZOOM_PERC
-00064ef0: 454e 5453 2e69 7465 6d73 2829 2069 6620  ENTS.items() if 
-00064f00: 7620 3d3d 2076 616c 7565 292c 204e 6f6e  v == value), Non
-00064f10: 6529 0d0a 2020 2020 2020 2020 6966 207a  e)..        if z
-00064f20: 6f6f 6d20 6973 204e 6f6e 6520 616e 6420  oom is None and 
-00064f30: 7661 6c75 6520 3c20 313a 0d0a 2020 2020  value < 1:..    
-00064f40: 2020 2020 2020 2020 7a6f 6f6d 203d 2069          zoom = i
-00064f50: 6e74 2831 3020 2a20 7661 6c75 6529 202d  nt(10 * value) -
-00064f60: 2031 3020 2023 2030 2e36 3235 2074 6f20   10  # 0.625 to 
-00064f70: 2d34 0d0a 2020 2020 2020 2020 656c 6966  -4..        elif
-00064f80: 207a 6f6f 6d20 6973 204e 6f6e 653a 0d0a   zoom is None:..
-00064f90: 2020 2020 2020 2020 2020 2020 7a6f 6f6d              zoom
-00064fa0: 203d 2069 6e74 2831 3020 2a20 2876 616c   = int(10 * (val
-00064fb0: 7565 202d 2031 2929 2023 2032 2e31 3235  ue - 1)) # 2.125
-00064fc0: 2074 6f20 3131 0d0a 2020 2020 2020 2020   to 11..        
-00064fd0: 7365 6c66 2e5f 7374 632e 5a6f 6f6d 203d  self._stc.Zoom =
-00064fe0: 207a 6f6f 6d0d 0a20 2020 2020 2020 2063   zoom..        c
-00064ff0: 6f6e 662e 4869 7374 6f72 795a 6f6f 6d20  onf.HistoryZoom 
-00065000: 3d20 7661 6c75 650d 0a20 2020 205a 6f6f  = value..    Zoo
-00065010: 6d50 6572 6365 6e74 203d 2070 726f 7065  mPercent = prope
-00065020: 7274 7928 4765 745a 6f6f 6d50 6572 6365  rty(GetZoomPerce
-00065030: 6e74 2c20 5365 745a 6f6f 6d50 6572 6365  nt, SetZoomPerce
-00065040: 6e74 2c20 646f 633d 0d0a 2020 2020 2222  nt, doc=..    ""
-00065050: 2243 7572 7265 6e74 2074 6578 7420 7a6f  "Current text zo
-00065060: 6f6d 206c 6576 656c 2c20 6173 2066 7261  om level, as fra
-00065070: 6374 696f 6e61 6c20 7065 7263 656e 7461  ctional percenta
-00065080: 6765 2c20 6465 6661 756c 7473 2074 6f20  ge, defaults to 
-00065090: 312e 3020 2831 3030 2529 2e22 2222 290d  1.0 (100%).""").
-000650a0: 0a0d 0a0d 0a20 2020 2064 6566 2047 6574  .....    def Get
-000650b0: 5572 6c41 7450 6f73 6974 696f 6e28 7365  UrlAtPosition(se
-000650c0: 6c66 2c20 706f 7329 3a0d 0a20 2020 2020  lf, pos):..     
-000650d0: 2020 2022 2222 2247 6f20 6261 636b 2061     """"Go back a
-000650e0: 6e64 2066 6f72 7468 2066 726f 6d20 5354  nd forth from ST
-000650f0: 4320 706f 7369 7469 6f6e 2c20 7265 7475  C position, retu
-00065100: 726e 2055 524c 2061 6e64 2053 5443 2072  rn URL and STC r
-00065110: 616e 6765 2e22 2222 0d0a 2020 2020 2020  ange."""..      
-00065120: 2020 7572 6c5f 7261 6e67 6520 3d20 7b2d    url_range = {-
-00065130: 313a 202d 312c 2031 3a20 2d31 7d20 2320  1: -1, 1: -1} # 
-00065140: 7b20 7374 6172 7420 616e 6420 656e 6420  { start and end 
-00065150: 706f 7369 7469 6f6e 7320 7d0d 0a20 2020  positions }..   
-00065160: 2020 2020 2073 7479 6c65 735f 6c69 6e6b       styles_link
-00065170: 203d 205b 7365 6c66 2e5f 7374 796c 6573   = [self._styles
-00065180: 5b22 6c69 6e6b 225d 2c20 7365 6c66 2e5f  ["link"], self._
-00065190: 7374 796c 6573 5b22 626f 6c64 6c69 6e6b  styles["boldlink
-000651a0: 225d 5d0d 0a20 2020 2020 2020 2066 6f72  "]]..        for
-000651b0: 2073 7465 7020 696e 2075 726c 5f72 616e   step in url_ran
-000651c0: 6765 3a0d 0a20 2020 2020 2020 2020 2020  ge:..           
-000651d0: 2077 6869 6c65 2073 656c 662e 5f73 7463   while self._stc
-000651e0: 2e47 6574 5374 796c 6541 7428 706f 7320  .GetStyleAt(pos 
-000651f0: 2b20 7374 6570 2920 696e 2073 7479 6c65  + step) in style
-00065200: 735f 6c69 6e6b 3a0d 0a20 2020 2020 2020  s_link:..       
-00065210: 2020 2020 2020 2020 2070 6f73 202b 3d20           pos += 
-00065220: 7374 6570 0d0a 2020 2020 2020 2020 2020  step..          
-00065230: 2020 7572 6c5f 7261 6e67 655b 7374 6570    url_range[step
-00065240: 5d20 3d20 706f 730d 0a20 2020 2020 2020  ] = pos..       
-00065250: 2075 726c 5f72 616e 6765 5b31 5d20 2b3d   url_range[1] +=
-00065260: 2031 0d0a 2020 2020 2020 2020 7374 6172   1..        star
-00065270: 7473 746f 7020 3d20 7572 6c5f 7261 6e67  tstop = url_rang
-00065280: 655b 2d31 5d2c 2075 726c 5f72 616e 6765  e[-1], url_range
-00065290: 5b31 5d0d 0a20 2020 2020 2020 2072 6574  [1]..        ret
-000652a0: 7572 6e20 7365 6c66 2e5f 7374 632e 4765  urn self._stc.Ge
-000652b0: 7454 6578 7452 616e 6765 282a 7374 6172  tTextRange(*star
-000652c0: 7473 746f 7029 2c20 7374 6172 7473 746f  tstop), startsto
-000652d0: 700d 0a0d 0a0d 0a20 2020 2064 6566 204d  p......    def M
-000652e0: 616b 655a 6f6f 6d4d 656e 7528 7365 6c66  akeZoomMenu(self
-000652f0: 293a 0d0a 2020 2020 2020 2020 2222 2252  ):..        """R
-00065300: 6574 7572 6e73 2077 782e 4d65 6e75 2070  eturns wx.Menu p
-00065310: 6f70 756c 6174 6564 2077 6974 6820 7465  opulated with te
-00065320: 7874 207a 6f6f 6d20 6368 616e 6765 206f  xt zoom change o
-00065330: 7074 696f 6e73 2e22 2222 0d0a 2020 2020  ptions."""..    
-00065340: 2020 2020 6465 6620 6f6e 5f74 6578 7473      def on_texts
-00065350: 697a 6528 6469 7265 6374 696f 6e3d 4e6f  ize(direction=No
-00065360: 6e65 2c20 6c65 7665 6c3d 4e6f 6e65 293a  ne, level=None):
-00065370: 0d0a 2020 2020 2020 2020 2020 2020 6465  ..            de
-00065380: 6620 646f 5f74 6578 7473 697a 6528 6576  f do_textsize(ev
-00065390: 656e 7429 3a0d 0a20 2020 2020 2020 2020  ent):..         
-000653a0: 2020 2020 2020 2069 6620 6c65 7665 6c20         if level 
-000653b0: 6973 206e 6f74 204e 6f6e 653a 2073 656c  is not None: sel
-000653c0: 662e 5a6f 6f6d 5065 7263 656e 7420 3d20  f.ZoomPercent = 
-000653d0: 6c65 7665 6c0d 0a20 2020 2020 2020 2020  level..         
-000653e0: 2020 2020 2020 2065 6c73 653a 2073 656c         else: sel
-000653f0: 662e 5f73 7463 2e5a 6f6f 6d20 3d20 2873  f._stc.Zoom = (s
-00065400: 656c 662e 5f73 7463 2e5a 6f6f 6d20 2b20  elf._stc.Zoom + 
-00065410: 6469 7265 6374 696f 6e29 2069 6620 6469  direction) if di
-00065420: 7265 6374 696f 6e20 656c 7365 2030 0d0a  rection else 0..
-00065430: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00065440: 726e 2064 6f5f 7465 7874 7369 7a65 0d0a  rn do_textsize..
-00065450: 0d0a 2020 2020 2020 2020 6d65 6e75 203d  ..        menu =
-00065460: 2077 782e 4d65 6e75 2829 0d0a 2020 2020   wx.Menu()..    
-00065470: 2020 2020 6974 656d 5f6c 6172 6765 7220      item_larger 
-00065480: 203d 2077 782e 4d65 6e75 4974 656d 286d   = wx.MenuItem(m
-00065490: 656e 752c 202d 312c 2075 2226 4c61 7267  enu, -1, u"&Larg
-000654a0: 6572 5c74 5c75 4646 3042 2229 2020 2320  er\t\uFF0B")  # 
-000654b0: 4675 6c6c 2077 6964 7468 2070 6c75 730d  Full width plus.
-000654c0: 0a20 2020 2020 2020 2069 7465 6d5f 736d  .        item_sm
-000654d0: 616c 6c65 7220 3d20 7778 2e4d 656e 7549  aller = wx.MenuI
-000654e0: 7465 6d28 6d65 6e75 2c20 2d31 2c20 7522  tem(menu, -1, u"
-000654f0: 2653 6d61 6c6c 6572 5c74 5c75 4646 3044  &Smaller\t\uFF0D
-00065500: 2229 2023 2046 756c 6c20 7769 6474 6820  ") # Full width 
-00065510: 6d69 6e75 730d 0a20 2020 2020 2020 2069  minus..        i
-00065520: 7465 6d5f 7265 7365 7420 2020 3d20 7778  tem_reset   = wx
-00065530: 2e4d 656e 7549 7465 6d28 6d65 6e75 2c20  .MenuItem(menu, 
-00065540: 2d31 2c20 2226 5265 7365 7422 290d 0a20  -1, "&Reset").. 
-00065550: 2020 2020 2020 206d 656e 752e 4170 7065         menu.Appe
-00065560: 6e64 2869 7465 6d5f 6c61 7267 6572 290d  nd(item_larger).
-00065570: 0a20 2020 2020 2020 206d 656e 752e 4170  .        menu.Ap
-00065580: 7065 6e64 2869 7465 6d5f 736d 616c 6c65  pend(item_smalle
-00065590: 7229 0d0a 2020 2020 2020 2020 6d65 6e75  r)..        menu
-000655a0: 2e41 7070 656e 6428 6974 656d 5f72 6573  .Append(item_res
-000655b0: 6574 290d 0a20 2020 2020 2020 206d 656e  et)..        men
-000655c0: 752e 4170 7065 6e64 5365 7061 7261 746f  u.AppendSeparato
-000655d0: 7228 290d 0a20 2020 2020 2020 2063 7572  r()..        cur
-000655e0: 6c65 7665 6c20 3d20 7365 6c66 2e5a 6f6f  level = self.Zoo
-000655f0: 6d50 6572 6365 6e74 0d0a 2020 2020 2020  mPercent..      
-00065600: 2020 666f 7220 6c65 7665 6c20 696e 2073    for level in s
-00065610: 6f72 7465 6428 7365 7428 7365 6c66 2e5a  orted(set(self.Z
-00065620: 4f4f 4d5f 5045 5243 454e 5453 2e76 616c  OOM_PERCENTS.val
-00065630: 7565 7328 2929 207c 207b 6375 726c 6576  ues()) | {curlev
-00065640: 656c 7d29 3a0d 0a20 2020 2020 2020 2020  el}):..         
-00065650: 2020 2074 6578 7420 3d20 7574 696c 2e72     text = util.r
-00065660: 6f75 6e64 5f66 6c6f 6174 286c 6576 656c  ound_float(level
-00065670: 202a 2031 3030 2c20 3429 202b 2022 2522   * 100, 4) + "%"
-00065680: 0d0a 2020 2020 2020 2020 2020 2020 6974  ..            it
-00065690: 656d 203d 2077 782e 4d65 6e75 4974 656d  em = wx.MenuItem
-000656a0: 286d 656e 752c 202d 312c 2074 6578 742c  (menu, -1, text,
-000656b0: 206b 696e 643d 7778 2e49 5445 4d5f 4348   kind=wx.ITEM_CH
-000656c0: 4543 4b29 0d0a 2020 2020 2020 2020 2020  ECK)..          
-000656d0: 2020 6d65 6e75 2e41 7070 656e 6428 6974    menu.Append(it
-000656e0: 656d 290d 0a20 2020 2020 2020 2020 2020  em)..           
-000656f0: 2069 6620 6c65 7665 6c20 3d3d 2063 7572   if level == cur
-00065700: 6c65 7665 6c3a 2069 7465 6d2e 4368 6563  level: item.Chec
-00065710: 6b28 290d 0a20 2020 2020 2020 2020 2020  k()..           
-00065720: 206d 656e 752e 4269 6e64 2877 782e 4556   menu.Bind(wx.EV
-00065730: 545f 4d45 4e55 2c20 6f6e 5f74 6578 7473  T_MENU, on_texts
-00065740: 697a 6528 6c65 7665 6c3d 6c65 7665 6c29  ize(level=level)
-00065750: 2c20 6964 3d69 7465 6d2e 4765 7449 6428  , id=item.GetId(
-00065760: 2929 0d0a 2020 2020 2020 2020 6974 656d  ))..        item
-00065770: 5f73 6d61 6c6c 6572 2e45 6e61 626c 6564  _smaller.Enabled
-00065780: 203d 2028 6375 726c 6576 656c 203e 206d   = (curlevel > m
-00065790: 696e 2873 656c 662e 5a4f 4f4d 5f50 4552  in(self.ZOOM_PER
-000657a0: 4345 4e54 532e 7661 6c75 6573 2829 2929  CENTS.values()))
-000657b0: 0d0a 2020 2020 2020 2020 6974 656d 5f6c  ..        item_l
-000657c0: 6172 6765 7220 2e45 6e61 626c 6564 203d  arger .Enabled =
-000657d0: 2028 6375 726c 6576 656c 203c 2073 656c   (curlevel < sel
-000657e0: 662e 5a4f 4f4d 5f50 4552 4345 4e54 5f4d  f.ZOOM_PERCENT_M
-000657f0: 4158 290d 0a20 2020 2020 2020 206d 656e  AX)..        men
-00065800: 752e 4269 6e64 2877 782e 4556 545f 4d45  u.Bind(wx.EVT_ME
-00065810: 4e55 2c20 6f6e 5f74 6578 7473 697a 6528  NU, on_textsize(
-00065820: 2b31 292c 2020 2020 2020 2020 2020 6964  +1),          id
-00065830: 3d69 7465 6d5f 6c61 7267 6572 2e47 6574  =item_larger.Get
-00065840: 4964 2829 290d 0a20 2020 2020 2020 206d  Id())..        m
-00065850: 656e 752e 4269 6e64 2877 782e 4556 545f  enu.Bind(wx.EVT_
-00065860: 4d45 4e55 2c20 6f6e 5f74 6578 7473 697a  MENU, on_textsiz
-00065870: 6528 2d31 292c 2020 2020 2020 2020 2020  e(-1),          
-00065880: 6964 3d69 7465 6d5f 736d 616c 6c65 722e  id=item_smaller.
-00065890: 4765 7449 6428 2929 0d0a 2020 2020 2020  GetId())..      
-000658a0: 2020 6d65 6e75 2e42 696e 6428 7778 2e45    menu.Bind(wx.E
-000658b0: 5654 5f4d 454e 552c 206f 6e5f 7465 7874  VT_MENU, on_text
-000658c0: 7369 7a65 2829 2c20 2020 2020 2020 2020  size(),         
-000658d0: 2020 2069 643d 6974 656d 5f72 6573 6574     id=item_reset
-000658e0: 2e47 6574 4964 2829 290d 0a20 2020 2020  .GetId())..     
-000658f0: 2020 2072 6574 7572 6e20 6d65 6e75 0d0a     return menu..
-00065900: 0d0a 0d0a 2020 2020 6465 6620 4f6e 5a6f  ....    def OnZo
-00065910: 6f6d 2873 656c 662c 2065 7665 6e74 293a  om(self, event):
-00065920: 0d0a 2020 2020 2020 2020 2222 2248 616e  ..        """Han
-00065930: 646c 6572 2066 6f72 2063 6861 6e67 696e  dler for changin
-00065940: 6720 7a6f 6f6d 206c 6576 656c 2076 6961  g zoom level via
-00065950: 2063 7472 6c2b 7768 6565 6c2c 2073 6176   ctrl+wheel, sav
-00065960: 6573 2063 6f6e 6669 672e 2222 220d 0a20  es config.""".. 
-00065970: 2020 2020 2020 2063 6f6e 662e 4869 7374         conf.Hist
-00065980: 6f72 795a 6f6f 6d20 3d20 7365 6c66 2e5a  oryZoom = self.Z
-00065990: 6f6f 6d50 6572 6365 6e74 0d0a 0d0a 0d0a  oomPercent......
-000659a0: 2020 2020 6465 6620 4f6e 5379 7343 6f6c      def OnSysCol
-000659b0: 6f75 7243 6861 6e67 6528 7365 6c66 2c20  ourChange(self, 
-000659c0: 6576 656e 7429 3a0d 0a20 2020 2020 2020  event):..       
-000659d0: 2022 2222 4861 6e64 6c65 7220 666f 7220   """Handler for 
-000659e0: 7379 7374 656d 2063 6f6c 6f75 7220 6368  system colour ch
-000659f0: 616e 6765 2c20 7570 6461 7465 7320 5354  ange, updates ST
-00065a00: 4320 7374 796c 696e 672e 2222 220d 0a20  C styling.""".. 
-00065a10: 2020 2020 2020 2065 7665 6e74 2e53 6b69         event.Ski
-00065a20: 7028 290d 0a20 2020 2020 2020 2073 656c  p()..        sel
-00065a30: 662e 5365 7453 7479 6c65 5370 6563 7328  f.SetStyleSpecs(
-00065a40: 290d 0a0d 0a0d 0a20 2020 2064 6566 204f  )......    def O
-00065a50: 6e4d 656e 7528 7365 6c66 2c20 6576 656e  nMenu(self, even
-00065a60: 7429 3a0d 0a20 2020 2020 2020 2022 2222  t):..        """
-00065a70: 0d0a 2020 2020 2020 2020 4861 6e64 6c65  ..        Handle
-00065a80: 7220 666f 7220 7269 6768 742d 636c 6963  r for right-clic
-00065a90: 6b69 6e67 2028 6f72 2070 7265 7373 696e  king (or pressin
-00065aa0: 6720 6d65 6e75 206b 6579 292c 206f 7065  g menu key), ope
-00065ab0: 6e73 2061 2063 7573 746f 6d20 636f 6e74  ns a custom cont
-00065ac0: 6578 740d 0a20 2020 2020 2020 206d 656e  ext..        men
-00065ad0: 752e 0d0a 2020 2020 2020 2020 2222 220d  u...        """.
-00065ae0: 0a20 2020 2020 2020 2064 6566 2063 6c69  .        def cli
-00065af0: 7062 6f61 7264 697a 6528 7465 7874 293a  pboardize(text):
-00065b00: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00065b10: 2077 782e 5468 6543 6c69 7062 6f61 7264   wx.TheClipboard
-00065b20: 2e4f 7065 6e28 293a 0d0a 2020 2020 2020  .Open():..      
-00065b30: 2020 2020 2020 2020 2020 6420 3d20 7778            d = wx
-00065b40: 2e54 6578 7444 6174 614f 626a 6563 7428  .TextDataObject(
-00065b50: 7465 7874 290d 0a20 2020 2020 2020 2020  text)..         
-00065b60: 2020 2020 2020 2077 782e 5468 6543 6c69         wx.TheCli
-00065b70: 7062 6f61 7264 2e53 6574 4461 7461 2864  pboard.SetData(d
-00065b80: 292c 2077 782e 5468 6543 6c69 7062 6f61  ), wx.TheClipboa
-00065b90: 7264 2e43 6c6f 7365 2829 0d0a 0d0a 2020  rd.Close()....  
-00065ba0: 2020 2020 2020 6973 5f63 6c69 636b 203d        is_click =
-00065bb0: 2069 7369 6e73 7461 6e63 6528 6576 656e   isinstance(even
-00065bc0: 742c 2077 782e 4d6f 7573 6545 7665 6e74  t, wx.MouseEvent
-00065bd0: 290d 0a20 2020 2020 2020 2070 6f73 203d  )..        pos =
-00065be0: 2073 656c 662e 5f73 7463 2e50 6f73 6974   self._stc.Posit
-00065bf0: 696f 6e46 726f 6d50 6f69 6e74 2865 7665  ionFromPoint(eve
-00065c00: 6e74 2e50 6f73 6974 696f 6e29 2069 6620  nt.Position) if 
-00065c10: 6973 5f63 6c69 636b 2065 6c73 6520 2d31  is_click else -1
-00065c20: 0d0a 2020 2020 2020 2020 6d73 675f 6964  ..        msg_id
-00065c30: 203d 206d 7367 203d 206d 7367 5f69 6478   = msg = msg_idx
-00065c40: 203d 2070 7265 766d 7367 5f69 6420 3d20   = prevmsg_id = 
-00065c50: 4e6f 6e65 0d0a 2020 2020 2020 2020 666f  None..        fo
-00065c60: 7220 692c 206d 5f69 6420 696e 2065 6e75  r i, m_id in enu
-00065c70: 6d65 7261 7465 2873 656c 662e 5f6d 6573  merate(self._mes
-00065c80: 7361 6765 5f70 6f73 6974 696f 6e73 2920  sage_positions) 
-00065c90: 6966 2070 6f73 203e 3d20 3020 656c 7365  if pos >= 0 else
-00065ca0: 205b 5d3a 0d0a 2020 2020 2020 2020 2020   []:..          
-00065cb0: 2020 6d5f 706f 7320 3d20 7365 6c66 2e5f    m_pos = self._
-00065cc0: 6d65 7373 6167 655f 706f 7369 7469 6f6e  message_position
-00065cd0: 735b 6d5f 6964 5d0d 0a20 2020 2020 2020  s[m_id]..       
-00065ce0: 2020 2020 2069 6620 6d5f 706f 735b 305d       if m_pos[0]
-00065cf0: 203c 3d20 706f 7320 3c3d 206d 5f70 6f73   <= pos <= m_pos
-00065d00: 5b31 5d3a 0d0a 2020 2020 2020 2020 2020  [1]:..          
-00065d10: 2020 2020 2020 6d73 675f 6964 2c20 6d73        msg_id, ms
-00065d20: 675f 6964 7820 3d20 6d5f 6964 2c20 690d  g_idx = m_id, i.
-00065d30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00065d40: 2062 7265 616b 2023 2066 6f72 2069 2c20   break # for i, 
-00065d50: 6d5f 6964 0d0a 2020 2020 2020 2020 2020  m_id..          
-00065d60: 2020 656c 6966 2069 2061 6e64 2073 656c    elif i and sel
-00065d70: 662e 5f6d 6573 7361 6765 5f70 6f73 6974  f._message_posit
-00065d80: 696f 6e73 5b70 7265 766d 7367 5f69 645d  ions[prevmsg_id]
-00065d90: 5b31 5d20 3c20 706f 7320 5c0d 0a20 2020  [1] < pos \..   
-00065da0: 2020 2020 2020 2020 2061 6e64 206d 5f70           and m_p
-00065db0: 6f73 5b30 5d20 3e20 706f 733a 0d0a 2020  os[0] > pos:..  
-00065dc0: 2020 2020 2020 2020 2020 2020 2020 6d73                ms
-00065dd0: 675f 6964 2c20 6d73 675f 6964 7820 3d20  g_id, msg_idx = 
-00065de0: 7072 6576 6d73 675f 6964 2c20 6920 2d20  prevmsg_id, i - 
-00065df0: 310d 0a20 2020 2020 2020 2020 2020 2020  1..             
-00065e00: 2020 2062 7265 616b 2023 2066 6f72 2069     break # for i
-00065e10: 2c20 6d5f 6964 0d0a 2020 2020 2020 2020  , m_id..        
-00065e20: 2020 2020 656c 6966 206d 5f70 6f73 5b30      elif m_pos[0
-00065e30: 5d20 3e20 706f 733a 0d0a 2020 2020 2020  ] > pos:..      
-00065e40: 2020 2020 2020 2020 2020 6272 6561 6b20            break 
-00065e50: 2320 666f 7220 692c 206d 5f69 640d 0a20  # for i, m_id.. 
-00065e60: 2020 2020 2020 2020 2020 2070 7265 766d             prevm
-00065e70: 7367 5f69 6420 3d20 6d5f 6964 0d0a 2020  sg_id = m_id..  
-00065e80: 2020 2020 2020 6966 206d 7367 5f69 6420        if msg_id 
-00065e90: 6973 204e 6f6e 6520 616e 6420 6e6f 7420  is None and not 
-00065ea0: 6973 5f63 6c69 636b 3a0d 0a20 2020 2020  is_click:..     
-00065eb0: 2020 2020 2020 2023 2043 6f6e 7465 7874         # Context
-00065ec0: 206d 656e 7520 6576 656e 742c 2070 6963   menu event, pic
-00065ed0: 6b20 666f 6375 7365 6420 6f72 2066 6972  k focused or fir
-00065ee0: 7374 2076 6973 6962 6c65 206d 6573 7361  st visible messa
-00065ef0: 6765 0d0a 2020 2020 2020 2020 2020 2020  ge..            
-00065f00: 6d73 675f 6964 2c20 5f20 3d20 7365 6c66  msg_id, _ = self
-00065f10: 2e47 6574 466f 6375 7365 644d 6573 7361  .GetFocusedMessa
-00065f20: 6765 2829 0d0a 2020 2020 2020 2020 2020  ge()..          
-00065f30: 2020 6966 206d 7367 5f69 6420 6973 206e    if msg_id is n
-00065f40: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
-00065f50: 2020 2020 2020 2020 2020 6d73 675f 6964            msg_id
-00065f60: 7820 3d20 6c69 7374 2873 656c 662e 5f6d  x = list(self._m
-00065f70: 6573 7361 6765 5f6d 6170 292e 696e 6465  essage_map).inde
-00065f80: 7828 6d73 675f 6964 290d 0a20 2020 2020  x(msg_id)..     
-00065f90: 2020 2069 6620 6d73 675f 6964 2069 7320     if msg_id is 
-00065fa0: 4e6f 6e65 2061 6e64 2073 656c 662e 5f6d  None and self._m
-00065fb0: 6573 7361 6765 5f70 6f73 6974 696f 6e73  essage_positions
-00065fc0: 3a0d 0a20 2020 2020 2020 2020 2020 206d  :..            m
-00065fd0: 5f69 6420 3d20 7365 6c66 2e5f 6d65 7373  _id = self._mess
-00065fe0: 6167 6573 5f63 7572 7265 6e74 5b2d 315d  ages_current[-1]
-00065ff0: 5b22 6964 225d 0d0a 2020 2020 2020 2020  ["id"]..        
-00066000: 2020 2020 6966 2070 6f73 203e 3d20 3020      if pos >= 0 
-00066010: 616e 6420 7365 6c66 2e5f 6d65 7373 6167  and self._messag
-00066020: 655f 706f 7369 7469 6f6e 735b 6d5f 6964  e_positions[m_id
-00066030: 5d5b 315d 203c 2070 6f73 3a0d 0a20 2020  ][1] < pos:..   
-00066040: 2020 2020 2020 2020 2020 2020 206d 7367               msg
-00066050: 5f69 642c 206d 7367 5f69 6478 203d 206d  _id, msg_idx = m
-00066060: 5f69 642c 206c 656e 2873 656c 662e 5f6d  _id, len(self._m
-00066070: 6573 7361 6765 735f 6375 7272 656e 7429  essages_current)
-00066080: 202d 2031 0d0a 2020 2020 2020 2020 6d73   - 1..        ms
-00066090: 6720 3d20 7365 6c66 2e5f 6d65 7373 6167  g = self._messag
-000660a0: 655f 6d61 702e 6765 7428 6d73 675f 6964  e_map.get(msg_id
-000660b0: 290d 0a20 2020 2020 2020 206d 656e 7520  )..        menu 
-000660c0: 3d20 7778 2e4d 656e 7528 290d 0a20 2020  = wx.Menu()..   
-000660d0: 2020 2020 2069 7465 6d5f 7365 6c65 6374       item_select
-000660e0: 696f 6e20 3d20 7778 2e4d 656e 7549 7465  ion = wx.MenuIte
-000660f0: 6d28 6d65 6e75 2c20 2d31 2c20 2226 436f  m(menu, -1, "&Co
-00066100: 7079 2073 656c 6563 7469 6f6e 2229 0d0a  py selection")..
-00066110: 2020 2020 2020 2020 6d65 6e75 2e41 7070          menu.App
-00066120: 656e 6428 6974 656d 5f73 656c 6563 7469  end(item_selecti
-00066130: 6f6e 290d 0a20 2020 2020 2020 206d 656e  on)..        men
-00066140: 752e 4269 6e64 2877 782e 4556 545f 4d45  u.Bind(wx.EVT_ME
-00066150: 4e55 2c20 6c61 6d62 6461 2065 3a20 636c  NU, lambda e: cl
-00066160: 6970 626f 6172 6469 7a65 2873 656c 662e  ipboardize(self.
-00066170: 5f73 7463 2e53 656c 6563 7465 6454 6578  _stc.SelectedTex
-00066180: 7429 2c0d 0a20 2020 2020 2020 2020 2020  t),..           
-00066190: 2020 2020 2020 2069 643d 6974 656d 5f73         id=item_s
-000661a0: 656c 6563 7469 6f6e 2e47 6574 4964 2829  election.GetId()
-000661b0: 290d 0a20 2020 2020 2020 2069 7465 6d5f  )..        item_
-000661c0: 7365 6c65 6374 696f 6e2e 456e 6162 6c65  selection.Enable
-000661d0: 2862 6f6f 6c28 7365 6c66 2e5f 7374 632e  (bool(self._stc.
-000661e0: 5365 6c65 6374 6564 5465 7874 2929 0d0a  SelectedText))..
-000661f0: 0d0a 2020 2020 2020 2020 7374 796c 6573  ..        styles
-00066200: 5f6c 696e 6b20 3d20 5b73 656c 662e 5f73  _link = [self._s
-00066210: 7479 6c65 735b 226c 696e 6b22 5d2c 2073  tyles["link"], s
-00066220: 656c 662e 5f73 7479 6c65 735b 2262 6f6c  elf._styles["bol
-00066230: 646c 696e 6b22 5d5d 0d0a 2020 2020 2020  dlink"]]..      
-00066240: 2020 6966 206d 7367 2061 6e64 2073 656c    if msg and sel
-00066250: 662e 5f73 7463 2e47 6574 5374 796c 6541  f._stc.GetStyleA
-00066260: 7428 706f 7329 2069 6e20 7374 796c 6573  t(pos) in styles
-00066270: 5f6c 696e 6b3a 0d0a 2020 2020 2020 2020  _link:..        
-00066280: 2020 2020 2320 5269 6768 742d 636c 6963      # Right-clic
-00066290: 6b65 6420 6120 6c69 6e6b 2069 6e73 6964  ked a link insid
-000662a0: 6520 6120 6d65 7373 6167 650d 0a20 2020  e a message..   
-000662b0: 2020 2020 2020 2020 2064 6566 206f 6e5f           def on_
-000662c0: 636f 7079 7572 6c28 6576 656e 7429 3a20  copyurl(event): 
-000662d0: 636c 6970 626f 6172 6469 7a65 2875 726c  clipboardize(url
-000662e0: 290d 0a20 2020 2020 2020 2020 2020 2028  )..            (
-000662f0: 7572 6c2c 2075 726c 7261 6e67 6529 2c20  url, urlrange), 
-00066300: 7572 6c74 7970 6520 3d20 7365 6c66 2e47  urltype = self.G
-00066310: 6574 5572 6c41 7450 6f73 6974 696f 6e28  etUrlAtPosition(
-00066320: 706f 7329 2c20 226c 696e 6b22 0d0a 2020  pos), "link"..  
-00066330: 2020 2020 2020 2020 2020 6966 2075 726c            if url
-00066340: 7261 6e67 655b 305d 2069 6e20 7365 6c66  range[0] in self
-00066350: 2e5f 6669 6c65 6c69 6e6b 733a 0d0a 2020  ._filelinks:..  
-00066360: 2020 2020 2020 2020 2020 2020 2020 7572                ur
-00066370: 6c2c 2075 726c 7479 7065 203d 2073 656c  l, urltype = sel
-00066380: 662e 5f66 696c 656c 696e 6b73 5b75 726c  f._filelinks[url
-00066390: 7261 6e67 655b 305d 5d2c 2022 6669 6c65  range[0]], "file
-000663a0: 220d 0a20 2020 2020 2020 2020 2020 2020  "..             
-000663b0: 2020 2069 6620 616e 7928 7572 6c2e 7374     if any(url.st
-000663c0: 6172 7473 7769 7468 2878 2920 666f 7220  artswith(x) for 
-000663d0: 7820 696e 205b 225c 5c5c 5c5c 5c22 2c20  x in ["\\\\\\", 
-000663e0: 222f 2f2f 225d 293a 0d0a 2020 2020 2020  "///"]):..      
-000663f0: 2020 2020 2020 2020 2020 2020 2020 7572                ur
-00066400: 6c20 3d20 7572 6c5b 333a 5d20 2320 5374  l = url[3:] # St
-00066410: 7269 7020 7265 6475 6e64 616e 7420 6669  rip redundant fi
-00066420: 6c65 6c69 6e6b 2073 6c61 7368 6573 0d0a  lelink slashes..
-00066430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00066440: 6966 206e 6f74 2069 7369 6e73 7461 6e63  if not isinstanc
-00066450: 6528 7572 6c2c 2073 6978 2e74 6578 745f  e(url, six.text_
-00066460: 7479 7065 293a 0d0a 2020 2020 2020 2020  type):..        
-00066470: 2020 2020 2020 2020 2020 2020 7572 6c20              url 
-00066480: 3d20 7574 696c 2e74 6f5f 756e 6963 6f64  = util.to_unicod
-00066490: 6528 7572 6c2c 2022 7574 662d 3822 2c20  e(url, "utf-8", 
-000664a0: 6572 726f 7273 3d22 7265 706c 6163 6522  errors="replace"
-000664b0: 290d 0a20 2020 2020 2020 2020 2020 2065  )..            e
-000664c0: 6c69 6620 7572 6c72 616e 6765 5b30 5d20  lif urlrange[0] 
-000664d0: 696e 2073 656c 662e 5f75 726c 6c69 6e6b  in self._urllink
-000664e0: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
-000664f0: 2020 2020 7572 6c20 3d20 7365 6c66 2e5f      url = self._
-00066500: 7572 6c6c 696e 6b73 5b75 726c 7261 6e67  urllinks[urlrang
-00066510: 655b 305d 5d0d 0a20 2020 2020 2020 2020  e[0]]..         
-00066520: 2020 2069 7465 6d5f 6c69 6e6b 203d 2077     item_link = w
-00066530: 782e 4d65 6e75 4974 656d 286d 656e 752c  x.MenuItem(menu,
-00066540: 202d 312c 2022 4326 6f70 7920 2573 206c   -1, "C&opy %s l
-00066550: 6f63 6174 696f 6e22 2025 2075 726c 7479  ocation" % urlty
-00066560: 7065 290d 0a20 2020 2020 2020 2020 2020  pe)..           
-00066570: 206d 656e 752e 4170 7065 6e64 2869 7465   menu.Append(ite
-00066580: 6d5f 6c69 6e6b 290d 0a20 2020 2020 2020  m_link)..       
-00066590: 2020 2020 206d 656e 752e 4269 6e64 2877       menu.Bind(w
-000665a0: 782e 4556 545f 4d45 4e55 2c20 6f6e 5f63  x.EVT_MENU, on_c
-000665b0: 6f70 7975 726c 2c20 6964 3d69 7465 6d5f  opyurl, id=item_
-000665c0: 6c69 6e6b 2e47 6574 4964 2829 290d 0a20  link.GetId()).. 
-000665d0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-000665e0: 2020 2020 2020 2020 2020 6f70 7473 203d            opts =
-000665f0: 2064 6963 7428 6375 7272 656e 743d 6d73   dict(current=ms
-00066600: 675f 6964 782c 2061 7574 686f 723d 286d  g_idx, author=(m
-00066610: 7367 206f 7220 7b7d 292e 6765 7428 2261  sg or {}).get("a
-00066620: 7574 686f 7222 2929 0d0a 2020 2020 2020  uthor"))..      
-00066630: 2020 2020 2020 6465 6620 6f6e 5f63 6f70        def on_cop
-00066640: 796d 7367 2865 7665 6e74 293a 0d0a 2020  ymsg(event):..  
-00066650: 2020 2020 2020 2020 2020 2020 2020 7420                t 
-00066660: 3d20 7374 6570 2e54 656d 706c 6174 6528  = step.Template(
-00066670: 7465 6d70 6c61 7465 732e 4d45 5353 4147  templates.MESSAG
-00066680: 455f 434c 4950 424f 4152 4429 0d0a 2020  E_CLIPBOARD)..  
-00066690: 2020 2020 2020 2020 2020 2020 2020 636c                cl
-000666a0: 6970 626f 6172 6469 7a65 2874 2e65 7870  ipboardize(t.exp
-000666b0: 616e 6428 7b22 6d22 3a20 6d73 672c 2022  and({"m": msg, "
-000666c0: 7061 7273 6572 223a 2073 656c 662e 5f70  parser": self._p
-000666d0: 6172 7365 727d 2929 0d0a 2020 2020 2020  arser}))..      
-000666e0: 2020 2020 2020 2020 2020 6775 6962 6173            guibas
-000666f0: 652e 7374 6174 7573 2822 436f 7069 6564  e.status("Copied
-00066700: 206d 6573 7361 6765 2023 2573 2074 6f20   message #%s to 
-00066710: 636c 6970 626f 6172 642e 2220 2520 6d73  clipboard." % ms
-00066720: 675b 2269 6422 5d29 0d0a 2020 2020 2020  g["id"])..      
-00066730: 2020 2020 2020 6465 6620 6f6e 5f73 656c        def on_sel
-00066740: 6563 7461 6c6c 2865 7665 6e74 293a 2073  ectall(event): s
-00066750: 656c 662e 5f73 7463 2e53 656c 6563 7441  elf._stc.SelectA
-00066760: 6c6c 2829 0d0a 2020 2020 2020 2020 2020  ll()..          
-00066770: 2020 6465 6620 6f6e 5f73 6561 7263 6828    def on_search(
-00066780: 6576 656e 7429 3a0d 0a20 2020 2020 2020  event):..       
-00066790: 2020 2020 2020 2020 2073 656c 662e 5365           self.Se
-000667a0: 7453 6561 7263 6842 6172 5669 7369 626c  tSearchBarVisibl
-000667b0: 6528 290d 0a20 2020 2020 2020 2020 2020  e()..           
-000667c0: 2020 2020 2073 656c 662e 5f65 6469 742e       self._edit.
-000667d0: 5365 7446 6f63 7573 2829 0d0a 2020 2020  SetFocus()..    
-000667e0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000667f0: 2e5f 6564 6974 2e53 656c 6563 7441 6c6c  ._edit.SelectAll
-00066800: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
-00066810: 6465 6620 6f6e 5f66 696c 7465 725f 6461  def on_filter_da
-00066820: 7465 2870 6572 696f 6429 3a0d 0a20 2020  te(period):..   
-00066830: 2020 2020 2020 2020 2020 2020 2064 6566               def
-00066840: 2064 6f5f 6669 6c74 6572 2865 7665 6e74   do_filter(event
-00066850: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00066860: 2020 2020 2020 2020 6474 203d 206d 7367          dt = msg
-00066870: 5b22 6461 7465 7469 6d65 225d 2e64 6174  ["datetime"].dat
-00066880: 6528 290d 0a20 2020 2020 2020 2020 2020  e()..           
-00066890: 2020 2020 2020 2020 2069 6620 2020 2264           if   "d
-000668a0: 6179 2220 2020 3d3d 2070 6572 696f 643a  ay"   == period:
-000668b0: 2064 6174 6572 616e 6765 203d 205b 6474   daterange = [dt
-000668c0: 2c20 6474 5d0d 0a20 2020 2020 2020 2020  , dt]..         
-000668d0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-000668e0: 2277 6565 6b22 2020 3d3d 2070 6572 696f  "week"  == perio
-000668f0: 643a 0d0a 2020 2020 2020 2020 2020 2020  d:..            
-00066900: 2020 2020 2020 2020 2020 2020 6461 7465              date
-00066910: 7261 6e67 6520 3d20 5b64 7420 2d20 6461  range = [dt - da
-00066920: 7465 7469 6d65 2e74 696d 6564 656c 7461  tetime.timedelta
-00066930: 2864 6179 733d 6474 2e77 6565 6b64 6179  (days=dt.weekday
-00066940: 2829 292c 0d0a 2020 2020 2020 2020 2020  ()),..          
-00066950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00066960: 2020 2020 2020 2020 2020 2064 7420 2b20             dt + 
-00066970: 6461 7465 7469 6d65 2e74 696d 6564 656c  datetime.timedel
-00066980: 7461 2864 6179 733d 362d 6474 2e77 6565  ta(days=6-dt.wee
-00066990: 6b64 6179 2829 295d 0d0a 2020 2020 2020  kday())]..      
-000669a0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-000669b0: 6966 2022 6d6f 6e74 6822 203d 3d20 7065  if "month" == pe
-000669c0: 7269 6f64 3a0d 0a20 2020 2020 2020 2020  riod:..         
-000669d0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-000669e0: 6178 6420 3d20 6361 6c65 6e64 6172 2e6d  axd = calendar.m
-000669f0: 6f6e 7468 7261 6e67 6528 6474 2e79 6561  onthrange(dt.yea
-00066a00: 722c 2064 742e 6d6f 6e74 6829 5b31 5d0d  r, dt.month)[1].
-00066a10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00066a20: 2020 2020 2020 2020 2064 6174 6572 616e           dateran
-00066a30: 6765 203d 205b 6461 7465 7469 6d65 2e64  ge = [datetime.d
-00066a40: 6174 6528 6474 2e79 6561 722c 2064 742e  ate(dt.year, dt.
-00066a50: 6d6f 6e74 682c 2031 292c 0d0a 2020 2020  month, 1),..    
-00066a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00066a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00066a80: 2064 6174 6574 696d 652e 6461 7465 2864   datetime.date(d
-00066a90: 742e 7965 6172 2c20 6474 2e6d 6f6e 7468  t.year, dt.month
-00066aa0: 2c20 6d61 7864 295d 0d0a 2020 2020 2020  , maxd)]..      
-00066ab0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00066ac0: 6966 2022 7965 6172 2220 203d 3d20 7065  if "year"  == pe
-00066ad0: 7269 6f64 3a0d 0a20 2020 2020 2020 2020  riod:..         
-00066ae0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00066af0: 6174 6572 616e 6765 203d 205b 6461 7465  aterange = [date
-00066b00: 7469 6d65 2e64 6174 6528 6474 2e79 6561  time.date(dt.yea
-00066b10: 722c 2020 312c 2020 3129 2c0d 0a20 2020  r,  1,  1),..   
-00066b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00066b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00066b40: 2020 6461 7465 7469 6d65 2e64 6174 6528    datetime.date(
-00066b50: 6474 2e79 6561 722c 2031 322c 2033 3129  dt.year, 12, 31)
-00066b60: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
-00066b70: 2020 2020 2020 2073 656c 662e 4170 706c         self.Appl
-00066b80: 7946 696c 7465 7228 6461 7465 7261 6e67  yFilter(daterang
-00066b90: 653d 6461 7465 7261 6e67 652c 2074 6578  e=daterange, tex
-00066ba0: 743d 2222 290d 0a20 2020 2020 2020 2020  t="")..         
-00066bb0: 2020 2020 2020 2072 6574 7572 6e20 646f         return do
-00066bc0: 5f66 696c 7465 720d 0a20 2020 2020 2020  _filter..       
-00066bd0: 2020 2020 2064 6566 206f 6e5f 676f 746f       def on_goto
-00066be0: 6175 7468 6f72 2864 6972 6563 7469 6f6e  author(direction
-00066bf0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00066c00: 2020 2020 7265 7475 726e 206c 616d 6264      return lambd
-00066c10: 6120 653a 2073 656c 662e 4e65 7874 4672  a e: self.NextFr
-00066c20: 6f6d 4175 7468 6f72 2864 6972 6563 7469  omAuthor(directi
-00066c30: 6f6e 3d64 6972 6563 7469 6f6e 2c20 2a2a  on=direction, **
-00066c40: 6f70 7473 290d 0a20 2020 2020 2020 2020  opts)..         
-00066c50: 2020 2064 6566 206f 6e5f 676f 746f 7469     def on_gototi
-00066c60: 6d65 2875 6e69 742c 2064 6972 6563 7469  me(unit, directi
-00066c70: 6f6e 293a 0d0a 2020 2020 2020 2020 2020  on):..          
-00066c80: 2020 2020 2020 7265 7475 726e 206c 616d        return lam
-00066c90: 6264 6120 653a 2073 656c 662e 4e65 7874  bda e: self.Next
-00066ca0: 5469 6d65 2875 6e69 742c 206d 7367 5f69  Time(unit, msg_i
-00066cb0: 6478 2c20 6469 7265 6374 696f 6e29 0d0a  dx, direction)..
-00066cc0: 0d0a 2020 2020 2020 2020 2020 2020 6974  ..            it
-00066cd0: 656d 5f6d 7367 203d 2077 782e 4d65 6e75  em_msg = wx.Menu
-00066ce0: 4974 656d 286d 656e 752c 202d 312c 2022  Item(menu, -1, "
-00066cf0: 436f 7079 2026 6d65 7373 6167 6522 290d  Copy &message").
-00066d00: 0a20 2020 2020 2020 2020 2020 2069 7465  .            ite
-00066d10: 6d5f 7365 6c65 6374 203d 2077 782e 4d65  m_select = wx.Me
-00066d20: 6e75 4974 656d 286d 656e 752c 202d 312c  nuItem(menu, -1,
-00066d30: 2022 5365 6c65 6374 2026 616c 6c22 290d   "Select &all").
-00066d40: 0a20 2020 2020 2020 2020 2020 206d 656e  .            men
-00066d50: 752e 4170 7065 6e64 2869 7465 6d5f 6d73  u.Append(item_ms
-00066d60: 6729 0d0a 2020 2020 2020 2020 2020 2020  g)..            
-00066d70: 6d65 6e75 2e41 7070 656e 6428 6974 656d  menu.Append(item
-00066d80: 5f73 656c 6563 7429 0d0a 2020 2020 2020  _select)..      
-00066d90: 2020 2020 2020 6974 656d 5f73 697a 6520        item_size 
-00066da0: 3d20 6d65 6e75 2e41 7070 656e 6453 7562  = menu.AppendSub
-00066db0: 4d65 6e75 2873 656c 662e 4d61 6b65 5a6f  Menu(self.MakeZo
-00066dc0: 6f6d 4d65 6e75 2829 2c20 2226 5465 7874  omMenu(), "&Text
-00066dd0: 2073 697a 6522 290d 0a20 2020 2020 2020   size")..       
-00066de0: 2020 2020 206d 656e 752e 4170 7065 6e64       menu.Append
-00066df0: 5365 7061 7261 746f 7228 290d 0a0d 0a20  Separator().... 
-00066e00: 2020 2020 2020 2020 2020 2069 7465 6d5f             item_
-00066e10: 7365 6172 6368 203d 2077 782e 4d65 6e75  search = wx.Menu
-00066e20: 4974 656d 286d 656e 752c 202d 312c 2022  Item(menu, -1, "
-00066e30: 2653 6561 7263 682e 2e22 290d 0a20 2020  &Search..")..   
-00066e40: 2020 2020 2020 2020 206d 656e 752e 4170           menu.Ap
-00066e50: 7065 6e64 2869 7465 6d5f 7365 6172 6368  pend(item_search
-00066e60: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
-00066e70: 206d 656e 755f 6669 6c74 6572 203d 2077   menu_filter = w
-00066e80: 782e 4d65 6e75 2829 0d0a 2020 2020 2020  x.Menu()..      
-00066e90: 2020 2020 2020 6974 656d 5f64 6179 2020        item_day  
-00066ea0: 203d 2077 782e 4d65 6e75 4974 656d 286d   = wx.MenuItem(m
-00066eb0: 656e 755f 6669 6c74 6572 2c20 2d31 2c20  enu_filter, -1, 
-00066ec0: 2253 616d 6520 2664 6179 2229 0d0a 2020  "Same &day")..  
-00066ed0: 2020 2020 2020 2020 2020 6974 656d 5f77            item_w
-00066ee0: 6565 6b20 203d 2077 782e 4d65 6e75 4974  eek  = wx.MenuIt
-00066ef0: 656d 286d 656e 755f 6669 6c74 6572 2c20  em(menu_filter, 
-00066f00: 2d31 2c20 2253 616d 6520 2677 6565 6b22  -1, "Same &week"
-00066f10: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
-00066f20: 7465 6d5f 6d6f 6e74 6820 3d20 7778 2e4d  tem_month = wx.M
-00066f30: 656e 7549 7465 6d28 6d65 6e75 5f66 696c  enuItem(menu_fil
-00066f40: 7465 722c 202d 312c 2022 5361 6d65 2026  ter, -1, "Same &
-00066f50: 6d6f 6e74 6822 290d 0a20 2020 2020 2020  month")..       
-00066f60: 2020 2020 2069 7465 6d5f 7965 6172 2020       item_year  
-00066f70: 3d20 7778 2e4d 656e 7549 7465 6d28 6d65  = wx.MenuItem(me
-00066f80: 6e75 5f66 696c 7465 722c 202d 312c 2022  nu_filter, -1, "
-00066f90: 5361 6d65 2026 7965 6172 2229 0d0a 2020  Same &year")..  
-00066fa0: 2020 2020 2020 2020 2020 6974 656d 5f66            item_f
-00066fb0: 696c 7465 7220 3d20 6d65 6e75 2e41 7070  ilter = menu.App
-00066fc0: 656e 6453 7562 4d65 6e75 286d 656e 755f  endSubMenu(menu_
-00066fd0: 6669 6c74 6572 2c20 2226 4669 6c74 6572  filter, "&Filter
-00066fe0: 2062 7920 6461 7465 2e2e 2229 0d0a 2020   by date..")..  
-00066ff0: 2020 2020 2020 2020 2020 6d65 6e75 5f66            menu_f
-00067000: 696c 7465 722e 4170 7065 6e64 2869 7465  ilter.Append(ite
-00067010: 6d5f 6461 7929 0d0a 2020 2020 2020 2020  m_day)..        
-00067020: 2020 2020 6d65 6e75 5f66 696c 7465 722e      menu_filter.
-00067030: 4170 7065 6e64 2869 7465 6d5f 7765 656b  Append(item_week
-00067040: 290d 0a20 2020 2020 2020 2020 2020 206d  )..            m
-00067050: 656e 755f 6669 6c74 6572 2e41 7070 656e  enu_filter.Appen
-00067060: 6428 6974 656d 5f6d 6f6e 7468 290d 0a20  d(item_month).. 
-00067070: 2020 2020 2020 2020 2020 206d 656e 755f             menu_
-00067080: 6669 6c74 6572 2e41 7070 656e 6428 6974  filter.Append(it
-00067090: 656d 5f79 6561 7229 0d0a 0d0a 2020 2020  em_year)....    
-000670a0: 2020 2020 2020 2020 6d65 6e75 5f67 6f74          menu_got
-000670b0: 6f20 3d20 7778 2e4d 656e 7528 290d 0a0d  o = wx.Menu()...
-000670c0: 0a20 2020 2020 2020 2020 2020 2069 7465  .            ite
-000670d0: 6d5f 7072 6576 203d 2077 782e 4d65 6e75  m_prev = wx.Menu
-000670e0: 4974 656d 286d 656e 755f 676f 746f 2c20  Item(menu_goto, 
-000670f0: 2d31 2c20 2226 5072 6576 696f 7573 2066  -1, "&Previous f
-00067100: 726f 6d20 7361 6d65 2061 7574 686f 7222  rom same author"
-00067110: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
-00067120: 7465 6d5f 6e65 7874 203d 2077 782e 4d65  tem_next = wx.Me
-00067130: 6e75 4974 656d 286d 656e 755f 676f 746f  nuItem(menu_goto
-00067140: 2c20 2d31 2c20 2226 4e65 7874 2066 726f  , -1, "&Next fro
-00067150: 6d20 7361 6d65 2061 7574 686f 7222 290d  m same author").
-00067160: 0a20 2020 2020 2020 2020 2020 2069 7465  .            ite
-00067170: 6d5f 7072 6576 5f64 6179 2020 203d 2077  m_prev_day   = w
-00067180: 782e 4d65 6e75 4974 656d 286d 656e 755f  x.MenuItem(menu_
-00067190: 676f 746f 2c20 2d31 2c20 2250 7265 7669  goto, -1, "Previ
-000671a0: 6f75 7320 2664 6179 2229 0d0a 2020 2020  ous &day")..    
-000671b0: 2020 2020 2020 2020 6974 656d 5f6e 6578          item_nex
-000671c0: 745f 6461 7920 2020 3d20 7778 2e4d 656e  t_day   = wx.Men
-000671d0: 7549 7465 6d28 6d65 6e75 5f67 6f74 6f2c  uItem(menu_goto,
-000671e0: 202d 312c 2022 4e65 7874 2064 2661 7922   -1, "Next d&ay"
-000671f0: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
-00067200: 7465 6d5f 7072 6576 5f77 6565 6b20 203d  tem_prev_week  =
-00067210: 2077 782e 4d65 6e75 4974 656d 286d 656e   wx.MenuItem(men
-00067220: 755f 676f 746f 2c20 2d31 2c20 2250 7265  u_goto, -1, "Pre
-00067230: 7669 6f75 7320 2677 6565 6b22 290d 0a20  vious &week").. 
-00067240: 2020 2020 2020 2020 2020 2069 7465 6d5f             item_
-00067250: 6e65 7874 5f77 6565 6b20 203d 2077 782e  next_week  = wx.
-00067260: 4d65 6e75 4974 656d 286d 656e 755f 676f  MenuItem(menu_go
-00067270: 746f 2c20 2d31 2c20 224e 6578 7420 7726  to, -1, "Next w&
-00067280: 6565 6b22 290d 0a20 2020 2020 2020 2020  eek")..         
-00067290: 2020 2069 7465 6d5f 7072 6576 5f6d 6f6e     item_prev_mon
-000672a0: 7468 203d 2077 782e 4d65 6e75 4974 656d  th = wx.MenuItem
-000672b0: 286d 656e 755f 676f 746f 2c20 2d31 2c20  (menu_goto, -1, 
-000672c0: 2250 7265 7669 6f75 7320 266d 6f6e 7468  "Previous &month
-000672d0: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
-000672e0: 6974 656d 5f6e 6578 745f 6d6f 6e74 6820  item_next_month 
-000672f0: 3d20 7778 2e4d 656e 7549 7465 6d28 6d65  = wx.MenuItem(me
-00067300: 6e75 5f67 6f74 6f2c 202d 312c 2022 4e65  nu_goto, -1, "Ne
-00067310: 7874 206d 266f 6e74 6822 290d 0a0d 0a20  xt m&onth").... 
-00067320: 2020 2020 2020 2020 2020 2069 7465 6d5f             item_
-00067330: 676f 746f 203d 206d 656e 752e 4170 7065  goto = menu.Appe
-00067340: 6e64 5375 624d 656e 7528 6d65 6e75 5f67  ndSubMenu(menu_g
-00067350: 6f74 6f2c 2022 2647 6f20 746f 2e2e 2229  oto, "&Go to..")
-00067360: 0d0a 2020 2020 2020 2020 2020 2020 6d65  ..            me
-00067370: 6e75 5f67 6f74 6f2e 4170 7065 6e64 2869  nu_goto.Append(i
-00067380: 7465 6d5f 7072 6576 292c 206d 656e 755f  tem_prev), menu_
-00067390: 676f 746f 2e41 7070 656e 6428 6974 656d  goto.Append(item
-000673a0: 5f6e 6578 7429 0d0a 2020 2020 2020 2020  _next)..        
-000673b0: 2020 2020 6d65 6e75 5f67 6f74 6f2e 4170      menu_goto.Ap
-000673c0: 7065 6e64 5365 7061 7261 746f 7228 290d  pendSeparator().
-000673d0: 0a20 2020 2020 2020 2020 2020 206d 656e  .            men
-000673e0: 755f 676f 746f 2e41 7070 656e 6428 6974  u_goto.Append(it
-000673f0: 656d 5f70 7265 765f 6461 7929 2c20 6d65  em_prev_day), me
-00067400: 6e75 5f67 6f74 6f2e 4170 7065 6e64 2869  nu_goto.Append(i
-00067410: 7465 6d5f 6e65 7874 5f64 6179 290d 0a20  tem_next_day).. 
-00067420: 2020 2020 2020 2020 2020 206d 656e 755f             menu_
-00067430: 676f 746f 2e41 7070 656e 6453 6570 6172  goto.AppendSepar
-00067440: 6174 6f72 2829 0d0a 2020 2020 2020 2020  ator()..        
-00067450: 2020 2020 6d65 6e75 5f67 6f74 6f2e 4170      menu_goto.Ap
-00067460: 7065 6e64 2869 7465 6d5f 7072 6576 5f77  pend(item_prev_w
-00067470: 6565 6b29 2c20 6d65 6e75 5f67 6f74 6f2e  eek), menu_goto.
-00067480: 4170 7065 6e64 2869 7465 6d5f 6e65 7874  Append(item_next
-00067490: 5f77 6565 6b29 0d0a 2020 2020 2020 2020  _week)..        
-000674a0: 2020 2020 6d65 6e75 5f67 6f74 6f2e 4170      menu_goto.Ap
-000674b0: 7065 6e64 5365 7061 7261 746f 7228 290d  pendSeparator().
-000674c0: 0a20 2020 2020 2020 2020 2020 206d 656e  .            men
-000674d0: 755f 676f 746f 2e41 7070 656e 6428 6974  u_goto.Append(it
-000674e0: 656d 5f70 7265 765f 6d6f 6e74 6829 2c20  em_prev_month), 
-000674f0: 6d65 6e75 5f67 6f74 6f2e 4170 7065 6e64  menu_goto.Append
-00067500: 2869 7465 6d5f 6e65 7874 5f6d 6f6e 7468  (item_next_month
-00067510: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
-00067520: 2069 7465 6d5f 6d73 672e 456e 6162 6c65   item_msg.Enable
-00067530: 6420 3d20 6974 656d 5f66 696c 7465 722e  d = item_filter.
-00067540: 456e 6162 6c65 6420 3d20 6974 656d 5f67  Enabled = item_g
-00067550: 6f74 6f2e 456e 6162 6c65 6420 3d20 626f  oto.Enabled = bo
-00067560: 6f6c 286d 7367 290d 0a20 2020 2020 2020  ol(msg)..       
-00067570: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
-00067580: 2e5f 6175 746f 5f72 6574 7269 6576 653a  ._auto_retrieve:
-00067590: 2069 7465 6d5f 6669 6c74 6572 2e45 6e61   item_filter.Ena
-000675a0: 626c 6564 203d 2046 616c 7365 0d0a 2020  bled = False..  
-000675b0: 2020 2020 2020 2020 2020 6d65 6e75 2e42            menu.B
-000675c0: 696e 6428 7778 2e45 5654 5f4d 454e 552c  ind(wx.EVT_MENU,
-000675d0: 206f 6e5f 7365 6c65 6374 616c 6c2c 2020   on_selectall,  
-000675e0: 2020 2020 2020 2020 2020 2069 643d 6974             id=it
-000675f0: 656d 5f73 656c 6563 742e 4765 7449 6428  em_select.GetId(
-00067600: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
-00067610: 6d65 6e75 2e42 696e 6428 7778 2e45 5654  menu.Bind(wx.EVT
-00067620: 5f4d 454e 552c 206f 6e5f 636f 7079 6d73  _MENU, on_copyms
-00067630: 672c 2020 2020 2020 2020 2020 2020 2020  g,              
-00067640: 2069 643d 6974 656d 5f6d 7367 2e47 6574   id=item_msg.Get
-00067650: 4964 2829 290d 0a20 2020 2020 2020 2020  Id())..         
-00067660: 2020 206d 656e 752e 4269 6e64 2877 782e     menu.Bind(wx.
-00067670: 4556 545f 4d45 4e55 2c20 6f6e 5f73 6561  EVT_MENU, on_sea
-00067680: 7263 682c 2020 2020 2020 2020 2020 2020  rch,            
-00067690: 2020 2020 6964 3d69 7465 6d5f 7365 6172      id=item_sear
-000676a0: 6368 2e47 6574 4964 2829 290d 0a20 2020  ch.GetId())..   
-000676b0: 2020 2020 2020 2020 206d 656e 752e 4269           menu.Bi
-000676c0: 6e64 2877 782e 4556 545f 4d45 4e55 2c20  nd(wx.EVT_MENU, 
-000676d0: 6f6e 5f66 696c 7465 725f 6461 7465 2822  on_filter_date("
-000676e0: 6461 7922 292c 2020 2020 6964 3d69 7465  day"),    id=ite
-000676f0: 6d5f 6461 792e 4765 7449 6428 2929 0d0a  m_day.GetId())..
-00067700: 2020 2020 2020 2020 2020 2020 6d65 6e75              menu
-00067710: 2e42 696e 6428 7778 2e45 5654 5f4d 454e  .Bind(wx.EVT_MEN
-00067720: 552c 206f 6e5f 6669 6c74 6572 5f64 6174  U, on_filter_dat
-00067730: 6528 2277 6565 6b22 292c 2020 2069 643d  e("week"),   id=
-00067740: 6974 656d 5f77 6565 6b2e 4765 7449 6428  item_week.GetId(
-00067750: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
-00067760: 6d65 6e75 2e42 696e 6428 7778 2e45 5654  menu.Bind(wx.EVT
-00067770: 5f4d 454e 552c 206f 6e5f 6669 6c74 6572  _MENU, on_filter
-00067780: 5f64 6174 6528 226d 6f6e 7468 2229 2c20  _date("month"), 
-00067790: 2069 643d 6974 656d 5f6d 6f6e 7468 2e47   id=item_month.G
-000677a0: 6574 4964 2829 290d 0a20 2020 2020 2020  etId())..       
-000677b0: 2020 2020 206d 656e 752e 4269 6e64 2877       menu.Bind(w
-000677c0: 782e 4556 545f 4d45 4e55 2c20 6f6e 5f66  x.EVT_MENU, on_f
-000677d0: 696c 7465 725f 6461 7465 2822 7965 6172  ilter_date("year
-000677e0: 2229 2c20 2020 6964 3d69 7465 6d5f 7965  "),   id=item_ye
-000677f0: 6172 2e47 6574 4964 2829 290d 0a20 2020  ar.GetId())..   
-00067800: 2020 2020 2020 2020 206d 656e 752e 4269           menu.Bi
-00067810: 6e64 2877 782e 4556 545f 4d45 4e55 2c20  nd(wx.EVT_MENU, 
-00067820: 6f6e 5f67 6f74 6f61 7574 686f 7228 2d31  on_gotoauthor(-1
-00067830: 292c 2020 2020 2020 2020 6964 3d69 7465  ),        id=ite
-00067840: 6d5f 7072 6576 2e47 6574 4964 2829 290d  m_prev.GetId()).
-00067850: 0a20 2020 2020 2020 2020 2020 206d 656e  .            men
-00067860: 752e 4269 6e64 2877 782e 4556 545f 4d45  u.Bind(wx.EVT_ME
-00067870: 4e55 2c20 6f6e 5f67 6f74 6f61 7574 686f  NU, on_gotoautho
-00067880: 7228 2b31 292c 2020 2020 2020 2020 6964  r(+1),        id
-00067890: 3d69 7465 6d5f 6e65 7874 2e47 6574 4964  =item_next.GetId
-000678a0: 2829 290d 0a20 2020 2020 2020 2020 2020  ())..           
-000678b0: 206d 656e 752e 4269 6e64 2877 782e 4556   menu.Bind(wx.EV
-000678c0: 545f 4d45 4e55 2c20 6f6e 5f67 6f74 6f74  T_MENU, on_gotot
-000678d0: 696d 6528 2264 6179 222c 202d 3129 2c20  ime("day", -1), 
-000678e0: 2020 6964 3d69 7465 6d5f 7072 6576 5f64    id=item_prev_d
-000678f0: 6179 2e47 6574 4964 2829 290d 0a20 2020  ay.GetId())..   
-00067900: 2020 2020 2020 2020 206d 656e 752e 4269           menu.Bi
-00067910: 6e64 2877 782e 4556 545f 4d45 4e55 2c20  nd(wx.EVT_MENU, 
-00067920: 6f6e 5f67 6f74 6f74 696d 6528 2264 6179  on_gototime("day
-00067930: 222c 202b 3129 2c20 2020 6964 3d69 7465  ", +1),   id=ite
-00067940: 6d5f 6e65 7874 5f64 6179 2e47 6574 4964  m_next_day.GetId
-00067950: 2829 290d 0a20 2020 2020 2020 2020 2020  ())..           
-00067960: 206d 656e 752e 4269 6e64 2877 782e 4556   menu.Bind(wx.EV
-00067970: 545f 4d45 4e55 2c20 6f6e 5f67 6f74 6f74  T_MENU, on_gotot
-00067980: 696d 6528 2277 6565 6b22 2c20 2d31 292c  ime("week", -1),
-00067990: 2020 6964 3d69 7465 6d5f 7072 6576 5f77    id=item_prev_w
-000679a0: 6565 6b2e 4765 7449 6428 2929 0d0a 2020  eek.GetId())..  
-000679b0: 2020 2020 2020 2020 2020 6d65 6e75 2e42            menu.B
-000679c0: 696e 6428 7778 2e45 5654 5f4d 454e 552c  ind(wx.EVT_MENU,
-000679d0: 206f 6e5f 676f 746f 7469 6d65 2822 7765   on_gototime("we
-000679e0: 656b 222c 202b 3129 2c20 2069 643d 6974  ek", +1),  id=it
-000679f0: 656d 5f6e 6578 745f 7765 656b 2e47 6574  em_next_week.Get
-00067a00: 4964 2829 290d 0a20 2020 2020 2020 2020  Id())..         
-00067a10: 2020 206d 656e 752e 4269 6e64 2877 782e     menu.Bind(wx.
-00067a20: 4556 545f 4d45 4e55 2c20 6f6e 5f67 6f74  EVT_MENU, on_got
-00067a30: 6f74 696d 6528 226d 6f6e 7468 222c 202d  otime("month", -
-00067a40: 3129 2c20 6964 3d69 7465 6d5f 7072 6576  1), id=item_prev
-00067a50: 5f6d 6f6e 7468 2e47 6574 4964 2829 290d  _month.GetId()).
-00067a60: 0a20 2020 2020 2020 2020 2020 206d 656e  .            men
-00067a70: 752e 4269 6e64 2877 782e 4556 545f 4d45  u.Bind(wx.EVT_ME
-00067a80: 4e55 2c20 6f6e 5f67 6f74 6f74 696d 6528  NU, on_gototime(
-00067a90: 226d 6f6e 7468 222c 202b 3129 2c20 6964  "month", +1), id
-00067aa0: 3d69 7465 6d5f 6e65 7874 5f6d 6f6e 7468  =item_next_month
-00067ab0: 2e47 6574 4964 2829 290d 0a20 2020 2020  .GetId())..     
-00067ac0: 2020 2073 656c 662e 506f 7075 704d 656e     self.PopupMen
-00067ad0: 7528 6d65 6e75 290d 0a0d 0a0d 0a20 2020  u(menu)......   
-00067ae0: 2064 6566 204f 6e55 726c 2873 656c 662c   def OnUrl(self,
-00067af0: 2065 7665 6e74 293a 0d0a 2020 2020 2020   event):..      
-00067b00: 2020 2222 220d 0a20 2020 2020 2020 2048    """..        H
-00067b10: 616e 646c 6572 2066 6f72 2063 6c69 636b  andler for click
-00067b20: 696e 6720 6120 6c69 6e6b 2069 6e20 6368  ing a link in ch
-00067b30: 6174 2068 6973 746f 7279 2c20 6f70 656e  at history, open
-00067b40: 7320 5552 4c73 2069 6e20 7379 7374 656d  s URLs in system
-00067b50: 0d0a 2020 2020 2020 2020 6272 6f77 7365  ..        browse
-00067b60: 722c 2073 7461 7274 7320 6669 6c65 206c  r, starts file l
-00067b70: 696e 6b73 2c20 616e 6420 6861 6e64 6c65  inks, and handle
-00067b80: 7320 696e 7465 726e 616c 206c 696e 6b73  s internal links
-00067b90: 2e0d 0a20 2020 2020 2020 2022 2222 0d0a  ...        """..
-00067ba0: 2020 2020 2020 2020 7374 6320 3d20 6576          stc = ev
-00067bb0: 656e 742e 4576 656e 744f 626a 6563 740d  ent.EventObject.
-00067bc0: 0a20 2020 2020 2020 2073 7479 6c65 735f  .        styles_
-00067bd0: 6c69 6e6b 203d 205b 7365 6c66 2e5f 7374  link = [self._st
-00067be0: 796c 6573 5b22 6c69 6e6b 225d 2c20 7365  yles["link"], se
-00067bf0: 6c66 2e5f 7374 796c 6573 5b22 626f 6c64  lf._styles["bold
-00067c00: 6c69 6e6b 225d 5d0d 0a20 2020 2020 2020  link"]]..       
-00067c10: 2069 6620 7374 632e 4765 7453 7479 6c65   if stc.GetStyle
-00067c20: 4174 2865 7665 6e74 2e50 6f73 6974 696f  At(event.Positio
-00067c30: 6e29 2069 6e20 7374 796c 6573 5f6c 696e  n) in styles_lin
-00067c40: 6b3a 0d0a 2020 2020 2020 2020 2020 2020  k:..            
-00067c50: 2320 476f 2062 6163 6b20 616e 6420 666f  # Go back and fo
-00067c60: 7274 6820 6672 6f6d 2070 6f73 6974 696f  rth from positio
-00067c70: 6e20 616e 6420 6765 7420 5552 4c20 7261  n and get URL ra
-00067c80: 6e67 652e 0d0a 2020 2020 2020 2020 2020  nge...          
-00067c90: 2020 7572 6c2c 2075 726c 5f72 616e 6765    url, url_range
-00067ca0: 203d 2073 656c 662e 4765 7455 726c 4174   = self.GetUrlAt
-00067cb0: 506f 7369 7469 6f6e 2865 7665 6e74 2e50  Position(event.P
-00067cc0: 6f73 6974 696f 6e29 0d0a 2020 2020 2020  osition)..      
-00067cd0: 2020 2020 2020 6675 6e63 7469 6f6e 2c20        function, 
-00067ce0: 6172 6773 2c20 6b77 6172 6773 203d 204e  args, kwargs = N
-00067cf0: 6f6e 652c 205b 5d2c 207b 7d0d 0a20 2020  one, [], {}..   
-00067d00: 2020 2020 2020 2020 2069 6620 7572 6c5f           if url_
-00067d10: 7261 6e67 655b 305d 2069 6e20 7365 6c66  range[0] in self
-00067d20: 2e5f 6669 6c65 6c69 6e6b 733a 0d0a 2020  ._filelinks:..  
-00067d30: 2020 2020 2020 2020 2020 2020 2020 6465                de
-00067d40: 6620 7374 6172 745f 6669 6c65 2875 726c  f start_file(url
-00067d50: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00067d60: 2020 2020 2020 2020 6966 206f 732e 7061          if os.pa
-00067d70: 7468 2e65 7869 7374 7328 7572 6c29 3a0d  th.exists(url):.
-00067d80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00067d90: 2020 2020 2020 2020 2075 7469 6c2e 7374           util.st
-00067da0: 6172 745f 6669 6c65 2875 726c 290d 0a20  art_file(url).. 
-00067db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00067dc0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-00067dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00067de0: 2020 6d65 7373 6167 6542 6f78 2822 5468    messageBox("Th
-00067df0: 6520 6669 6c65 205c 2225 735c 2220 6361  e file \"%s\" ca
-00067e00: 6e6e 6f74 2062 6520 666f 756e 6420 220d  nnot be found ".
-00067e10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00067e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00067e30: 2020 2020 226f 6e20 7468 6973 2063 6f6d      "on this com
-00067e40: 7075 7465 722e 2220 2520 7572 6c2c 0d0a  puter." % url,..
-00067e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00067e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00067e70: 2020 2063 6f6e 662e 5469 746c 652c 2077     conf.Title, w
-00067e80: 782e 4f4b 207c 2077 782e 4943 4f4e 5f49  x.OK | wx.ICON_I
-00067e90: 4e46 4f52 4d41 5449 4f4e 290d 0a20 2020  NFORMATION)..   
-00067ea0: 2020 2020 2020 2020 2020 2020 2066 756e               fun
-00067eb0: 6374 696f 6e2c 2061 7267 7320 3d20 7374  ction, args = st
-00067ec0: 6172 745f 6669 6c65 2c20 5b73 656c 662e  art_file, [self.
-00067ed0: 5f66 696c 656c 696e 6b73 5b75 726c 5f72  _filelinks[url_r
-00067ee0: 616e 6765 5b30 5d5d 5d0d 0a20 2020 2020  ange[0]]]..     
-00067ef0: 2020 2020 2020 2065 6c69 6620 7572 6c5f         elif url_
-00067f00: 7261 6e67 655b 305d 2069 6e20 7365 6c66  range[0] in self
-00067f10: 2e5f 6461 7465 6c69 6e6b 733a 0d0a 2020  ._datelinks:..  
-00067f20: 2020 2020 2020 2020 2020 2020 2020 6675                fu
-00067f30: 6e63 7469 6f6e 203d 2073 656c 662e 4170  nction = self.Ap
-00067f40: 706c 7946 696c 7465 720d 0a20 2020 2020  plyFilter..     
-00067f50: 2020 2020 2020 2020 2020 206b 7761 7267             kwarg
-00067f60: 7320 3d20 6469 6374 2864 6174 6572 616e  s = dict(dateran
-00067f70: 6765 3d73 656c 662e 5f64 6174 656c 696e  ge=self._datelin
-00067f80: 6b73 5b75 726c 5f72 616e 6765 5b30 5d5d  ks[url_range[0]]
-00067f90: 2c20 6461 7465 6c61 6265 6c3d 7572 6c29  , datelabel=url)
-00067fa0: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
-00067fb0: 6966 2075 726c 5f72 616e 6765 5b30 5d20  if url_range[0] 
-00067fc0: 696e 2073 656c 662e 5f75 726c 6c69 6e6b  in self._urllink
-00067fd0: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
-00067fe0: 2020 2020 7572 6c20 3d20 7365 6c66 2e5f      url = self._
-00067ff0: 7572 6c6c 696e 6b73 5b75 726c 5f72 616e  urllinks[url_ran
-00068000: 6765 5b30 5d5d 0d0a 2020 2020 2020 2020  ge[0]]..        
-00068010: 2020 2020 2020 2020 6675 6e63 7469 6f6e          function
-00068020: 2c20 6172 6773 203d 2077 6562 6272 6f77  , args = webbrow
-00068030: 7365 722e 6f70 656e 2c20 5b75 726c 5d0d  ser.open, [url].
-00068040: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-00068050: 6620 2253 6372 6f6c 6c20 6261 636b 206d  f "Scroll back m
-00068060: 6f72 652e 2220 3d3d 2075 726c 3a0d 0a20  ore." == url:.. 
-00068070: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00068080: 756e 6374 696f 6e20 3d20 7365 6c66 2e52  unction = self.R
-00068090: 6574 7269 6576 654d 6f72 654d 6573 7361  etrieveMoreMessa
-000680a0: 6765 730d 0a20 2020 2020 2020 2020 2020  ges..           
-000680b0: 2065 6c69 6620 7572 6c3a 0d0a 2020 2020   elif url:..    
-000680c0: 2020 2020 2020 2020 2020 2020 6675 6e63              func
-000680d0: 7469 6f6e 2c20 6172 6773 203d 2077 6562  tion, args = web
-000680e0: 6272 6f77 7365 722e 6f70 656e 2c20 5b75  browser.open, [u
-000680f0: 726c 5d0d 0a20 2020 2020 2020 2020 2020  rl]..           
-00068100: 2069 6620 6675 6e63 7469 6f6e 3a0d 0a20   if function:.. 
-00068110: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00068120: 2043 616c 6c69 6e67 2066 756e 6374 696f   Calling functio
-00068130: 6e20 6865 7265 2069 6d6d 6564 6961 7465  n here immediate
-00068140: 6c79 2077 696c 6c20 6361 7573 6520 5354  ly will cause ST
-00068150: 4320 746f 206c 6f73 650d 0a20 2020 2020  C to lose..     
-00068160: 2020 2020 2020 2020 2020 2023 204d 6f75             # Mou
-00068170: 7365 5570 2c20 7265 7375 6c74 696e 6720  seUp, resulting 
-00068180: 696e 2061 7574 6f73 656c 6563 7420 6d6f  in autoselect mo
-00068190: 6465 2066 726f 6d20 636c 6963 6b20 706f  de from click po
-000681a0: 7369 7469 6f6e 2e0d 0a20 2020 2020 2020  sition...       
-000681b0: 2020 2020 2020 2020 2077 782e 4361 6c6c           wx.Call
-000681c0: 4c61 7465 7228 3130 302c 2066 756e 6374  Later(100, funct
-000681d0: 696f 6e2c 202a 6172 6773 2c20 2a2a 6b77  ion, *args, **kw
-000681e0: 6172 6773 290d 0a20 2020 2020 2020 2065  args)..        e
-000681f0: 7665 6e74 2e53 746f 7050 726f 7061 6761  vent.StopPropaga
-00068200: 7469 6f6e 2829 0d0a 0d0a 0d0a 2020 2020  tion()......    
-00068210: 6465 6620 5365 7441 7574 6f52 6574 7269  def SetAutoRetri
-00068220: 6576 6528 7365 6c66 2c20 7265 7472 6965  eve(self, retrie
-00068230: 7665 293a 0d0a 2020 2020 2020 2020 2222  ve):..        ""
-00068240: 220d 0a20 2020 2020 2020 2053 6574 7320  "..        Sets 
-00068250: 7768 6574 6865 7220 746f 2061 7574 6f2d  whether to auto-
-00068260: 7265 7472 6965 7665 206d 6f72 6520 6d65  retrieve more me
-00068270: 7373 6167 6573 2c0d 0a20 2020 2020 2020  ssages,..       
-00068280: 2061 6e64 2061 6c6c 6f77 2064 6174 6520   and allow date 
-00068290: 7065 7269 6f64 7320 6e61 7669 6761 7469  periods navigati
-000682a0: 6f6e 2061 6e64 2066 696c 7465 7269 6e67  on and filtering
-000682b0: 2e0d 0a20 2020 2020 2020 2022 2222 0d0a  ...        """..
-000682c0: 2020 2020 2020 2020 7365 6c66 2e5f 6175          self._au
-000682d0: 746f 5f72 6574 7269 6576 6520 3d20 7265  to_retrieve = re
-000682e0: 7472 6965 7665 0d0a 0d0a 0d0a 2020 2020  trieve......    
-000682f0: 6465 6620 5265 7472 6965 7665 4d65 7373  def RetrieveMess
-00068300: 6167 6573 4966 4e65 6564 6564 2873 656c  agesIfNeeded(sel
-00068310: 6629 3a0d 0a20 2020 2020 2020 2022 2222  f):..        """
-00068320: 0d0a 2020 2020 2020 2020 5265 7472 6965  ..        Retrie
-00068330: 7665 7320 6d6f 7265 206d 6573 7361 6765  ves more message
-00068340: 7320 6966 206e 6565 6465 642c 2066 6f72  s if needed, for
-00068350: 2065 7861 6d70 6c65 2069 6620 6375 7272   example if curr
-00068360: 656e 7420 6669 6c74 6572 0d0a 2020 2020  ent filter..    
-00068370: 2020 2020 7370 6563 6966 6965 7320 6120      specifies a 
-00068380: 6c61 7267 6572 2064 6174 6520 7261 6e67  larger date rang
-00068390: 6520 7468 616e 2063 7572 7265 6e74 6c79  e than currently
-000683a0: 2061 7661 696c 6162 6c65 2e0d 0a20 2020   available...   
-000683b0: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-000683c0: 2020 6966 206e 6f74 2073 656c 662e 5f6d    if not self._m
-000683d0: 6573 7361 6765 735f 6375 7272 656e 7420  essages_current 
-000683e0: 616e 6420 2264 6174 6572 616e 6765 2220  and "daterange" 
-000683f0: 696e 2073 656c 662e 5f66 696c 7465 7220  in self._filter 
-00068400: 5c0d 0a20 2020 2020 2020 2061 6e64 2073  \..        and s
-00068410: 656c 662e 5f66 696c 7465 725b 2264 6174  elf._filter["dat
-00068420: 6572 616e 6765 225d 5b30 5d3a 0d0a 2020  erange"][0]:..  
-00068430: 2020 2020 2020 2020 2020 2320 4966 2064            # If d
-00068440: 6174 6520 6669 6c74 6572 696e 6720 7761  ate filtering wa
-00068450: 7320 6a75 7374 2061 7070 6c69 6564 2c20  s just applied, 
-00068460: 6368 6563 6b20 6966 2077 6520 6e65 6564  check if we need
-00068470: 2074 6f0d 0a20 2020 2020 2020 2020 2020   to..           
-00068480: 2023 2072 6574 7269 6576 6520 6d6f 7265   # retrieve more
-00068490: 206d 6573 7361 6765 7320 6672 6f6d 2065   messages from e
-000684a0: 6172 6c69 6572 2028 6d65 7373 6167 6573  arlier (messages
-000684b0: 2061 7265 2072 6574 7269 6576 6564 0d0a   are retrieved..
-000684c0: 2020 2020 2020 2020 2020 2020 2320 7374              # st
-000684d0: 6172 7469 6e67 2066 726f 6d20 6c61 7465  arting from late
-000684e0: 7374 292e 0d0a 2020 2020 2020 2020 2020  st)...          
-000684f0: 2020 6966 206e 6f74 2073 656c 662e 5f6d    if not self._m
-00068500: 6573 7361 6765 735b 305d 5b22 6461 7465  essages[0]["date
-00068510: 7469 6d65 225d 205c 0d0a 2020 2020 2020  time"] \..      
-00068520: 2020 2020 2020 6f72 2073 656c 662e 5f6d        or self._m
-00068530: 6573 7361 6765 735b 305d 5b22 6461 7465  essages[0]["date
-00068540: 7469 6d65 225d 2e64 6174 6528 2920 3e3d  time"].date() >=
-00068550: 2073 656c 662e 5f66 696c 7465 725b 2264   self._filter["d
-00068560: 6174 6572 616e 6765 225d 5b30 5d3a 0d0a  aterange"][0]:..
-00068570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00068580: 6d6d 2c20 6b77 7320 3d20 5b5d 2c20 6469  mm, kws = [], di
-00068590: 6374 2874 696d 6573 7461 6d70 5f66 726f  ct(timestamp_fro
-000685a0: 6d3d 7365 6c66 2e5f 6d65 7373 6167 6573  m=self._messages
-000685b0: 5b30 5d5b 2274 696d 6573 7461 6d70 225d  [0]["timestamp"]
-000685c0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-000685d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000685e0: 2020 2020 2020 6173 6365 6e64 696e 673d        ascending=
-000685f0: 4661 6c73 652c 2075 7365 5f63 6163 6865  False, use_cache
-00068600: 3d46 616c 7365 290d 0a20 2020 2020 2020  =False)..       
-00068610: 2020 2020 2020 2020 2066 6f72 206d 2069           for m i
-00068620: 6e20 7365 6c66 2e5f 6462 2e67 6574 5f6d  n self._db.get_m
-00068630: 6573 7361 6765 7328 7365 6c66 2e5f 6368  essages(self._ch
-00068640: 6174 2c20 2a2a 6b77 7329 3a0d 0a20 2020  at, **kws):..   
-00068650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00068660: 206d 6d2e 6170 7065 6e64 286d 290d 0a20   mm.append(m).. 
-00068670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00068680: 2020 2069 6620 6d5b 2264 6174 6574 696d     if m["datetim
-00068690: 6522 5d2e 6461 7465 2829 203c 2073 656c  e"].date() < sel
-000686a0: 662e 5f66 696c 7465 725b 2264 6174 6572  f._filter["dater
-000686b0: 616e 6765 225d 5b30 5d3a 0d0a 2020 2020  ange"][0]:..    
-000686c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000686d0: 2020 2020 6272 6561 6b20 2320 666f 7220      break # for 
-000686e0: 6d0d 0a20 2020 2020 2020 2020 2020 2020  m..             
-000686f0: 2020 2073 656c 662e 5f6d 6573 7361 6765     self._message
-00068700: 735b 3a30 5d20 3d20 6d6d 5b3a 3a2d 315d  s[:0] = mm[::-1]
-00068710: 2023 2049 6e73 6572 7420 6173 6365 6e64   # Insert ascend
-00068720: 696e 6720 6174 2066 726f 6e74 0d0a 2020  ing at front..  
-00068730: 2020 2020 2020 6c61 7374 5f64 7420 3d20        last_dt = 
-00068740: 7365 6c66 2e5f 6368 6174 2e67 6574 2822  self._chat.get("
-00068750: 6c61 7374 5f6d 6573 7361 6765 5f64 6174  last_message_dat
-00068760: 6574 696d 6522 290d 0a20 2020 2020 2020  etime")..       
-00068770: 2069 6620 7365 6c66 2e5f 6d65 7373 6167   if self._messag
-00068780: 6573 2061 6e64 206c 6173 745f 6474 2061  es and last_dt a
-00068790: 6e64 2073 656c 662e 5f6d 6573 7361 6765  nd self._message
-000687a0: 735b 2d31 5d5b 2264 6174 6574 696d 6522  s[-1]["datetime"
-000687b0: 5d20 3c20 6c61 7374 5f64 743a 0d0a 2020  ] < last_dt:..  
-000687c0: 2020 2020 2020 2020 2020 2320 4c61 7374            # Last
-000687d0: 206d 6573 7361 6765 2074 696d 6573 7461   message timesta
-000687e0: 6d70 2069 7320 6561 726c 6965 7220 7468  mp is earlier th
-000687f0: 616e 2063 6861 7427 7320 6c61 7374 206d  an chat's last m
-00068800: 6573 7361 6765 0d0a 2020 2020 2020 2020  essage..        
-00068810: 2020 2020 2320 7469 6d65 7374 616d 703a      # timestamp:
-00068820: 206e 6577 206d 6573 7361 6765 7320 6861   new messages ha
-00068830: 7665 2061 7272 6976 6564 0d0a 2020 2020  ve arrived..    
-00068840: 2020 2020 2020 2020 7365 6c66 2e5f 6d65          self._me
-00068850: 7373 6167 6573 2e65 7874 656e 6428 7365  ssages.extend(se
-00068860: 6c66 2e5f 6462 2e67 6574 5f6d 6573 7361  lf._db.get_messa
-00068870: 6765 7328 7365 6c66 2e5f 6368 6174 2c0d  ges(self._chat,.
-00068880: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00068890: 2061 7363 656e 6469 6e67 3d54 7275 652c   ascending=True,
-000688a0: 2075 7365 5f63 6163 6865 3d46 616c 7365   use_cache=False
-000688b0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-000688c0: 2020 2074 696d 6573 7461 6d70 5f66 726f     timestamp_fro
-000688d0: 6d3d 7365 6c66 2e5f 6d65 7373 6167 6573  m=self._messages
-000688e0: 5b2d 315d 5b22 7469 6d65 7374 616d 7022  [-1]["timestamp"
-000688f0: 5d0d 0a20 2020 2020 2020 2020 2020 2029  ]..            )
-00068900: 290d 0a0d 0a0d 0a20 2020 2064 6566 2052  )......    def R
-00068910: 6574 7269 6576 654d 6f72 654d 6573 7361  etrieveMoreMessa
-00068920: 6765 7328 7365 6c66 2c20 636f 756e 743d  ges(self, count=
-00068930: 4e6f 6e65 293a 0d0a 2020 2020 2020 2020  None):..        
-00068940: 2222 220d 0a20 2020 2020 2020 2052 6574  """..        Ret
-00068950: 7269 6576 6573 2061 6e6f 7468 6572 204e  rieves another N
-00068960: 206d 6573 7361 6765 7320 7374 6172 7469   messages starti
-00068970: 6e67 2066 726f 6d20 6375 7272 656e 7420  ng from current 
-00068980: 6669 7273 742e 0d0a 0d0a 2020 2020 2020  first.....      
-00068990: 2020 4070 6172 616d 2020 2063 6f75 6e74    @param   count
-000689a0: 2020 6d61 7869 6d75 6d20 6e75 6d62 6572    maximum number
-000689b0: 206f 6620 6d6f 7265 206d 6573 7361 6765   of more message
-000689c0: 7320 746f 2072 6574 7269 6576 652c 0d0a  s to retrieve,..
-000689d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000689e0: 2020 2020 2020 2020 6465 6661 756c 7473          defaults
-000689f0: 2074 6f20 636f 6e66 2e4d 6178 4869 7374   to conf.MaxHist
-00068a00: 6f72 7949 6e69 7469 616c 4d65 7373 6167  oryInitialMessag
-00068a10: 6573 202f 2032 0d0a 2020 2020 2020 2020  es / 2..        
-00068a20: 2222 220d 0a20 2020 2020 2020 2069 6620  """..        if 
-00068a30: 636f 756e 7420 6973 204e 6f6e 653a 2063  count is None: c
-00068a40: 6f75 6e74 203d 206d 6178 2831 2c20 636f  ount = max(1, co
-00068a50: 6e66 2e4d 6178 4869 7374 6f72 7949 6e69  nf.MaxHistoryIni
-00068a60: 7469 616c 4d65 7373 6167 6573 202f 2f20  tialMessages // 
-00068a70: 3229 0d0a 2020 2020 2020 2020 6966 206e  2)..        if n
-00068a80: 6f74 2063 6f75 6e74 3a20 7265 7475 726e  ot count: return
-00068a90: 0d0a 0d0a 2020 2020 2020 2020 6365 6e74  ....        cent
-00068aa0: 6572 5f69 642c 2073 7461 6d70 5f66 726f  er_id, stamp_fro
-00068ab0: 6d20 3d20 4e6f 6e65 2c20 4e6f 6e65 0d0a  m = None, None..
-00068ac0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00068ad0: 5f6d 6573 7361 6765 733a 0d0a 2020 2020  _messages:..    
-00068ae0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00068af0: 5f6d 6573 7361 6765 735f 6375 7272 656e  _messages_curren
-00068b00: 743a 2063 656e 7465 725f 6964 203d 2073  t: center_id = s
-00068b10: 656c 662e 5f6d 6573 7361 6765 735f 6375  elf._messages_cu
-00068b20: 7272 656e 745b 305d 5b22 6964 225d 0d0a  rrent[0]["id"]..
-00068b30: 2020 2020 2020 2020 2020 2020 7374 616d              stam
-00068b40: 705f 6672 6f6d 203d 2073 656c 662e 5f6d  p_from = self._m
-00068b50: 6573 7361 6765 735b 305d 5b22 7469 6d65  essages[0]["time
-00068b60: 7374 616d 7022 5d0d 0a20 2020 2020 2020  stamp"]..       
-00068b70: 2065 6c69 6620 616e 7928 7365 6c66 2e5f   elif any(self._
-00068b80: 6669 6c74 6572 2e67 6574 2822 6461 7465  filter.get("date
-00068b90: 7261 6e67 6522 2920 6f72 205b 5d29 3a0d  range") or []):.
-00068ba0: 0a20 2020 2020 2020 2020 2020 2073 7461  .            sta
-00068bb0: 6d70 5f66 726f 6d20 3d20 7574 696c 2e64  mp_from = util.d
-00068bc0: 6174 6574 696d 655f 746f 5f65 706f 6368  atetime_to_epoch
-00068bd0: 2873 656c 662e 5f66 696c 7465 725b 2264  (self._filter["d
-00068be0: 6174 6572 616e 6765 225d 5b30 5d29 0d0a  aterange"][0])..
-00068bf0: 2020 2020 2020 2020 6966 2073 7461 6d70          if stamp
-00068c00: 5f66 726f 6d20 6973 204e 6f6e 653a 2072  _from is None: r
-00068c10: 6574 7572 6e0d 0a0d 0a20 2020 2020 2020  eturn....       
-00068c20: 206d 6d2c 206b 7773 203d 205b 5d2c 2064   mm, kws = [], d
-00068c30: 6963 7428 7469 6d65 7374 616d 705f 6672  ict(timestamp_fr
-00068c40: 6f6d 3d73 7461 6d70 5f66 726f 6d2c 0d0a  om=stamp_from,..
-00068c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00068c60: 2020 2020 2020 2020 2020 2061 7363 656e             ascen
-00068c70: 6469 6e67 3d46 616c 7365 2c20 7573 655f  ding=False, use_
-00068c80: 6361 6368 653d 4661 6c73 6529 0d0a 2020  cache=False)..  
-00068c90: 2020 2020 2020 6275 7379 203d 2063 6f6e        busy = con
-00068ca0: 7472 6f6c 732e 4275 7379 5061 6e65 6c28  trols.BusyPanel(
-00068cb0: 7365 6c66 2e5f 7061 6765 206f 7220 7365  self._page or se
-00068cc0: 6c66 2e50 6172 656e 742c 0d0a 2020 2020  lf.Parent,..    
-00068cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00068ce0: 2020 2020 2020 2020 2020 2020 2020 2252                "R
-00068cf0: 6574 7269 6576 696e 6720 6d6f 7265 206d  etrieving more m
-00068d00: 6573 7361 6765 732e 2229 0d0a 2020 2020  essages.")..    
-00068d10: 2020 2020 7472 793a 0d0a 2020 2020 2020      try:..      
-00068d20: 2020 2020 2020 666f 7220 692c 206d 2069        for i, m i
-00068d30: 6e20 656e 756d 6572 6174 6528 7365 6c66  n enumerate(self
-00068d40: 2e5f 6462 2e67 6574 5f6d 6573 7361 6765  ._db.get_message
-00068d50: 7328 7365 6c66 2e5f 6368 6174 2c20 2a2a  s(self._chat, **
-00068d60: 6b77 7329 293a 0d0a 2020 2020 2020 2020  kws)):..        
-00068d70: 2020 2020 2020 2020 6d6d 2e61 7070 656e          mm.appen
-00068d80: 6428 6d29 0d0a 2020 2020 2020 2020 2020  d(m)..          
-00068d90: 2020 2020 2020 6966 2069 202b 2031 203e        if i + 1 >
-00068da0: 3d20 636f 756e 743a 2062 7265 616b 2023  = count: break #
-00068db0: 2066 6f72 2069 2c20 6d0d 0a20 2020 2020   for i, m..     
-00068dc0: 2020 2020 2020 2073 656c 662e 5f6d 6573         self._mes
-00068dd0: 7361 6765 735b 3a30 5d20 3d20 6d6d 5b3a  sages[:0] = mm[:
-00068de0: 3a2d 315d 2023 2049 6e73 6572 7420 6173  :-1] # Insert as
-00068df0: 6365 6e64 696e 6720 6174 2066 726f 6e74  cending at front
-00068e00: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00068e10: 6c66 2e5f 6365 6e74 6572 5f6d 6573 7361  lf._center_messa
-00068e20: 6765 5f69 6420 3d20 7365 6c66 2e5f 6365  ge_id = self._ce
-00068e30: 6e74 6572 5f6d 6573 7361 6765 5f69 6e64  nter_message_ind
-00068e40: 6578 203d 204e 6f6e 650d 0a20 2020 2020  ex = None..     
-00068e50: 2020 2020 2020 2069 6620 7365 6c66 2e5f         if self._
-00068e60: 6d65 7373 6167 6573 3a0d 0a20 2020 2020  messages:..     
-00068e70: 2020 2020 2020 2020 2020 2072 6e67 203d             rng =
-00068e80: 205b 7365 6c66 2e5f 6d65 7373 6167 6573   [self._messages
-00068e90: 5b78 5d5b 2264 6174 6574 696d 6522 5d2e  [x]["datetime"].
-00068ea0: 6461 7465 2829 2066 6f72 2078 2069 6e20  date() for x in 
-00068eb0: 2830 2c20 2d31 295d 0d0a 2020 2020 2020  (0, -1)]..      
-00068ec0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-00068ed0: 6669 6c74 6572 5b22 6461 7465 7261 6e67  filter["daterang
-00068ee0: 6522 5d20 3d20 726e 670d 0a20 2020 2020  e"] = rng..     
-00068ef0: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-00068f00: 6c66 2e5f 7061 6765 3a0d 0a20 2020 2020  lf._page:..     
-00068f10: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00068f20: 656c 662e 5f70 6167 652e 7261 6e67 655f  elf._page.range_
-00068f30: 6461 7465 2e53 6574 5661 6c75 6573 282a  date.SetValues(*
-00068f40: 726e 6729 0d0a 2020 2020 2020 2020 2020  rng)..          
-00068f50: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-00068f60: 7061 6765 2e63 6861 745f 6669 6c74 6572  page.chat_filter
-00068f70: 5b22 6461 7465 7261 6e67 6522 5d20 3d20  ["daterange"] = 
-00068f80: 726e 670d 0a20 2020 2020 2020 2020 2020  rng..           
-00068f90: 2073 656c 662e 5265 6672 6573 684d 6573   self.RefreshMes
-00068fa0: 7361 6765 7328 290d 0a20 2020 2020 2020  sages()..       
-00068fb0: 2020 2020 2069 6620 7365 6c66 2e5f 7061       if self._pa
-00068fc0: 6765 3a0d 0a20 2020 2020 2020 2020 2020  ge:..           
-00068fd0: 2020 2020 2073 656c 662e 5f70 6167 652e       self._page.
-00068fe0: 706f 7075 6c61 7465 5f63 6861 745f 7374  populate_chat_st
-00068ff0: 6174 6973 7469 6373 2829 0d0a 2020 2020  atistics()..    
-00069000: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00069010: 2e5f 7061 6765 2e6c 6973 745f 7469 6d65  ._page.list_time
-00069020: 6c69 6e65 2e50 6f70 756c 6174 6528 2a73  line.Populate(*s
-00069030: 656c 662e 4765 7454 696d 656c 696e 6544  elf.GetTimelineD
-00069040: 6174 6128 2929 0d0a 2020 2020 2020 2020  ata())..        
-00069050: 6669 6e61 6c6c 793a 2062 7573 792e 436c  finally: busy.Cl
-00069060: 6f73 6528 290d 0a20 2020 2020 2020 2069  ose()..        i
-00069070: 6620 6365 6e74 6572 5f69 6420 6973 206e  f center_id is n
-00069080: 6f74 204e 6f6e 653a 2073 656c 662e 466f  ot None: self.Fo
-00069090: 6375 734d 6573 7361 6765 2863 656e 7465  cusMessage(cente
-000690a0: 725f 6964 2c20 7365 6c65 6374 3d46 616c  r_id, select=Fal
-000690b0: 7365 290d 0a0d 0a0d 0a20 2020 2064 6566  se)......    def
-000690c0: 2052 6566 7265 7368 4d65 7373 6167 6573   RefreshMessages
-000690d0: 2873 656c 662c 2063 656e 7465 725f 6d65  (self, center_me
-000690e0: 7373 6167 655f 6964 3d4e 6f6e 6529 3a0d  ssage_id=None):.
-000690f0: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
-00069100: 2020 2020 2020 436c 6561 7273 2063 6f6e        Clears con
-00069110: 7465 6e74 2061 6e64 2072 6564 6973 706c  tent and redispl
-00069120: 6179 7320 6d65 7373 6167 6573 206f 6620  ays messages of 
-00069130: 6375 7272 656e 7420 6368 6174 2e0d 0a0d  current chat....
-00069140: 0a20 2020 2020 2020 2040 7061 7261 6d20  .        @param 
-00069150: 2020 6365 6e74 6572 5f6d 6573 7361 6765    center_message
-00069160: 5f69 6420 2069 6620 7370 6563 6966 6965  _id  if specifie
-00069170: 642c 206d 6573 7361 6765 2077 6974 6820  d, message with 
-00069180: 7468 6520 4944 2069 730d 0a20 2020 2020  the ID is..     
-00069190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000691a0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-000691b0: 6f63 7573 6564 2061 6e64 206d 6573 7361  ocused and messa
-000691c0: 6765 2072 616e 6765 2077 696c 6c20 6365  ge range will ce
-000691d0: 6e74 6572 0d0a 2020 2020 2020 2020 2020  nter..          
-000691e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000691f0: 2020 2020 2020 2020 2020 6172 6f75 6e64            around
-00069200: 2069 742c 2073 7461 7969 6e67 2077 6974   it, staying wit
-00069210: 6869 6e20 6d61 7820 6e75 6d62 6572 0d0a  hin max number..
-00069220: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
-00069230: 2020 2020 2073 656c 662e 5365 7452 6561       self.SetRea
-00069240: 644f 6e6c 7928 4661 6c73 6529 2023 2043  dOnly(False) # C
-00069250: 616e 2774 206d 6f64 6966 7920 7768 696c  an't modify whil
-00069260: 6520 7265 6164 2d6f 6e6c 790d 0a20 2020  e read-only..   
-00069270: 2020 2020 2073 656c 662e 436c 6561 7241       self.ClearA
-00069280: 6c6c 2829 0d0a 2020 2020 2020 2020 7365  ll()..        se
-00069290: 6c66 2e5f 7061 7273 6572 203d 2073 6b79  lf._parser = sky
-000692a0: 7065 6461 7461 2e4d 6573 7361 6765 5061  pedata.MessagePa
-000692b0: 7273 6572 2873 656c 662e 5f64 622c 2073  rser(self._db, s
-000692c0: 656c 662e 5f63 6861 742c 2073 7461 7473  elf._chat, stats
-000692d0: 3d54 7275 6529 0d0a 2020 2020 2020 2020  =True)..        
-000692e0: 6966 2073 656c 662e 5f6d 6573 7361 6765  if self._message
-000692f0: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
-00069300: 6966 2073 656c 662e 5f61 7574 6f5f 7265  if self._auto_re
-00069310: 7472 6965 7665 3a0d 0a20 2020 2020 2020  trieve:..       
-00069320: 2020 2020 2020 2020 2073 656c 662e 5265           self.Re
-00069330: 7472 6965 7665 4d65 7373 6167 6573 4966  trieveMessagesIf
-00069340: 4e65 6564 6564 2829 0d0a 2020 2020 2020  Needed()..      
-00069350: 2020 2020 2020 7365 6c66 2e41 7070 656e        self.Appen
-00069360: 6454 6578 7428 2246 6f72 6d61 7474 696e  dText("Formattin
-00069370: 6720 6d65 7373 6167 6573 2e2e 5c6e 2229  g messages..\n")
-00069380: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00069390: 6c66 2e52 6566 7265 7368 2829 0d0a 2020  lf.Refresh()..  
-000693a0: 2020 2020 2020 2020 2020 7365 6c66 2e46            self.F
-000693b0: 7265 657a 6528 290d 0a20 2020 2020 2020  reeze()..       
-000693c0: 2020 2020 2073 656c 662e 436c 6561 7241       self.ClearA
-000693d0: 6c6c 2829 0d0a 0d0a 2020 2020 2020 2020  ll()....        
-000693e0: 2020 2020 6966 2063 656e 7465 725f 6d65      if center_me
-000693f0: 7373 6167 655f 6964 3a0d 0a20 2020 2020  ssage_id:..     
-00069400: 2020 2020 2020 2020 2020 2069 6e64 6578             index
-00069410: 203d 2030 0d0a 2020 2020 2020 2020 2020   = 0..          
-00069420: 2020 2020 2020 666f 7220 6d20 696e 2073        for m in s
-00069430: 656c 662e 5f6d 6573 7361 6765 733a 0d0a  elf._messages:..
-00069440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00069450: 2020 2020 6966 206d 5b22 6964 225d 203d      if m["id"] =
-00069460: 3d20 6365 6e74 6572 5f6d 6573 7361 6765  = center_message
-00069470: 5f69 643a 0d0a 2020 2020 2020 2020 2020  _id:..          
-00069480: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00069490: 6c66 2e5f 6365 6e74 6572 5f6d 6573 7361  lf._center_messa
-000694a0: 6765 5f69 6420 3d20 6365 6e74 6572 5f6d  ge_id = center_m
-000694b0: 6573 7361 6765 5f69 640d 0a20 2020 2020  essage_id..     
-000694c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000694d0: 2020 2073 656c 662e 5f63 656e 7465 725f     self._center_
-000694e0: 6d65 7373 6167 655f 696e 6465 7820 3d20  message_index = 
-000694f0: 696e 6465 780d 0a20 2020 2020 2020 2020  index..         
-00069500: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-00069510: 7265 616b 0d0a 2020 2020 2020 2020 2020  reak..          
-00069520: 2020 2020 2020 2020 2020 696e 6465 7820            index 
-00069530: 2b3d 2031 0d0a 0d0a 2020 2020 2020 2020  += 1....        
-00069540: 2020 2020 636f 6c6f 7572 6d61 7020 3d20      colourmap = 
-00069550: 636f 6c6c 6563 7469 6f6e 732e 6465 6661  collections.defa
-00069560: 756c 7464 6963 7428 6c61 6d62 6461 3a20  ultdict(lambda: 
-00069570: 2272 656d 6f74 6522 290d 0a20 2020 2020  "remote")..     
-00069580: 2020 2020 2020 2063 6f6c 6f75 726d 6170         colourmap
-00069590: 5b73 656c 662e 5f64 622e 6964 5d20 3d20  [self._db.id] = 
-000695a0: 226c 6f63 616c 220d 0a20 2020 2020 2020  "local"..       
-000695b0: 2020 2020 2073 656c 662e 5f6d 6573 7361       self._messa
-000695c0: 6765 5f70 6f73 6974 696f 6e73 2e63 6c65  ge_positions.cle
-000695d0: 6172 2829 0d0a 2020 2020 2020 2020 2020  ar()..          
-000695e0: 2020 7365 6c66 2e5f 6d65 7373 6167 655f    self._message_
-000695f0: 6d61 702e 636c 6561 7228 290d 0a20 2020  map.clear()..   
-00069600: 2020 2020 2020 2020 2070 7265 7669 6f75           previou
-00069610: 735f 6461 7920 3d20 4e6f 6e65 0d0a 2020  s_day = None..  
-00069620: 2020 2020 2020 2020 2020 636f 756e 7420            count 
-00069630: 3d20 300d 0a20 2020 2020 2020 2020 2020  = 0..           
-00069640: 2066 6f63 7573 5f6d 6573 7361 6765 5f69   focus_message_i
-00069650: 6420 3d20 4e6f 6e65 0d0a 2020 2020 2020  d = None..      
-00069660: 2020 2020 2020 7365 6c66 2e5f 7572 6c6c        self._urll
-00069670: 696e 6b73 2e63 6c65 6172 2829 0d0a 2020  inks.clear()..  
-00069680: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-00069690: 6669 6c65 6c69 6e6b 732e 636c 6561 7228  filelinks.clear(
-000696a0: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
-000696b0: 656c 662e 5f64 6174 656c 696e 6b73 2e63  elf._datelinks.c
-000696c0: 6c65 6172 2829 0d0a 2020 2020 2020 2020  lear()..        
-000696d0: 2020 2020 2320 466f 7220 6163 6375 6d75      # For accumu
-000696e0: 6c61 7469 6e67 2076 6172 696f 7573 2073  lating various s
-000696f0: 7461 7469 7374 6963 730d 0a20 2020 2020  tatistics..     
-00069700: 2020 2020 2020 2072 6778 5f68 6967 686c         rgx_highl
-00069710: 6967 6874 203d 2072 652e 636f 6d70 696c  ight = re.compil
-00069720: 6528 0d0a 2020 2020 2020 2020 2020 2020  e(..            
-00069730: 2020 2020 2228 2573 2922 2025 2072 652e      "(%s)" % re.
-00069740: 6573 6361 7065 2873 656c 662e 5f66 696c  escape(self._fil
-00069750: 7465 725b 2274 6578 7422 5d29 2c20 7265  ter["text"]), re
-00069760: 2e49 0d0a 2020 2020 2020 2020 2020 2020  .I..            
-00069770: 2920 6966 2028 2274 6578 7422 2069 6e20  ) if ("text" in 
-00069780: 7365 6c66 2e5f 6669 6c74 6572 2061 6e64  self._filter and
-00069790: 2073 656c 662e 5f66 696c 7465 725b 2274   self._filter["t
-000697a0: 6578 7422 5d29 2065 6c73 6520 4e6f 6e65  ext"]) else None
-000697b0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-000697c0: 6c66 2e5f 6d65 7373 6167 6573 5f63 7572  lf._messages_cur
-000697d0: 7265 6e74 203d 205b 5d0d 0a0d 0a20 2020  rent = []....   
-000697e0: 2020 2020 2020 2020 2023 2041 7373 656d           # Assem
-000697f0: 626c 6520 6d65 7373 6167 6573 2074 6f20  ble messages to 
-00069800: 7368 6f77 0d0a 2020 2020 2020 2020 2020  show..          
-00069810: 2020 666f 7220 6d20 696e 2073 656c 662e    for m in self.
-00069820: 5f6d 6573 7361 6765 733a 0d0a 2020 2020  _messages:..    
-00069830: 2020 2020 2020 2020 2020 2020 636f 756e              coun
-00069840: 7420 2b3d 2031 0d0a 2020 2020 2020 2020  t += 1..        
-00069850: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00069860: 4973 4d65 7373 6167 6546 696c 7465 7265  IsMessageFiltere
-00069870: 644f 7574 286d 293a 0d0a 2020 2020 2020  dOut(m):..      
-00069880: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00069890: 6e74 696e 7565 2023 2066 6f72 206d 0d0a  ntinue # for m..
-000698a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000698b0: 6966 2073 656c 662e 5f63 656e 7465 725f  if self._center_
-000698c0: 6d65 7373 6167 655f 696e 6465 7820 6973  message_index is
-000698d0: 206e 6f74 204e 6f6e 6520 5c0d 0a20 2020   not None \..   
-000698e0: 2020 2020 2020 2020 2020 2020 2061 6e64               and
-000698f0: 2063 6f75 6e74 203c 2073 656c 662e 5f63   count < self._c
-00069900: 656e 7465 725f 6d65 7373 6167 655f 696e  enter_message_in
-00069910: 6465 7820 5c0d 0a20 2020 2020 2020 2020  dex \..         
-00069920: 2020 2020 2020 202d 2063 6f6e 662e 4d61         - conf.Ma
-00069930: 7848 6973 746f 7279 496e 6974 6961 6c4d  xHistoryInitialM
-00069940: 6573 7361 6765 7320 2f2f 2032 3a0d 0a20  essages // 2:.. 
-00069950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00069960: 2020 2023 2053 6b69 7020 6d65 7373 6167     # Skip messag
-00069970: 6573 2062 6566 6f72 6520 7468 6520 7261  es before the ra
-00069980: 6e67 6520 6365 6e74 6572 6564 2061 726f  nge centered aro
-00069990: 756e 6420 6120 6d65 7373 6167 650d 0a20  und a message.. 
-000699a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000699b0: 2020 2063 6f6e 7469 6e75 6520 2320 666f     continue # fo
-000699c0: 7220 6d0d 0a20 2020 2020 2020 2020 2020  r m..           
-000699d0: 2020 2020 2069 6620 7365 6c66 2e5f 6365       if self._ce
-000699e0: 6e74 6572 5f6d 6573 7361 6765 5f69 6e64  nter_message_ind
-000699f0: 6578 2069 7320 6e6f 7420 4e6f 6e65 205c  ex is not None \
-00069a00: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00069a10: 2020 616e 6420 636f 756e 7420 3e20 7365    and count > se
-00069a20: 6c66 2e5f 6365 6e74 6572 5f6d 6573 7361  lf._center_messa
-00069a30: 6765 5f69 6e64 6578 205c 0d0a 2020 2020  ge_index \..    
-00069a40: 2020 2020 2020 2020 2020 2020 2b20 636f              + co
-00069a50: 6e66 2e4d 6178 4869 7374 6f72 7949 6e69  nf.MaxHistoryIni
-00069a60: 7469 616c 4d65 7373 6167 6573 202f 2f20  tialMessages // 
-00069a70: 323a 0d0a 2020 2020 2020 2020 2020 2020  2:..            
-00069a80: 2020 2020 2020 2020 2320 536b 6970 206d          # Skip m
-00069a90: 6573 7361 6765 7320 6166 7465 7220 7468  essages after th
-00069aa0: 6520 7261 6e67 6520 6365 6e74 6572 6564  e range centered
-00069ab0: 2061 726f 756e 6420 6120 6d65 7373 6167   around a messag
-00069ac0: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
-00069ad0: 2020 2020 2020 2062 7265 616b 2023 2066         break # f
-00069ae0: 6f72 206d 0d0a 0d0a 2020 2020 2020 2020  or m....        
-00069af0: 2020 2020 2020 2020 7365 6c66 2e5f 6d65          self._me
-00069b00: 7373 6167 6573 5f63 7572 7265 6e74 2e61  ssages_current.a
-00069b10: 7070 656e 6428 6d29 0d0a 0d0a 2020 2020  ppend(m)....    
-00069b20: 2020 2020 2020 2020 2320 4164 6420 6461          # Add da
-00069b30: 7465 2061 6e64 2063 6f75 6e74 2069 6e66  te and count inf
-00069b40: 6f72 6d61 7469 6f6e 2c20 2253 6372 6f6c  ormation, "Scrol
-00069b50: 6c20 6261 636b 206d 6f72 6522 2c20 616e  l back more", an
-00069b60: 6420 6c69 6e6b 7320 6c69 6b65 2022 3620  d links like "6 
-00069b70: 6d6f 6e74 6873 220d 0a20 2020 2020 2020  months"..       
-00069b80: 2020 2020 2073 656c 662e 5f61 7070 656e       self._appen
-00069b90: 645f 7465 7874 2822 5c6e 2229 0d0a 2020  d_text("\n")..  
-00069ba0: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-00069bb0: 662e 5f6d 6573 7361 6765 735f 6375 7272  f._messages_curr
-00069bc0: 656e 743a 0d0a 2020 2020 2020 2020 2020  ent:..          
-00069bd0: 2020 2020 2020 6d31 2c20 6d32 203d 2073        m1, m2 = s
-00069be0: 656c 662e 5f6d 6573 7361 6765 735f 6375  elf._messages_cu
-00069bf0: 7272 656e 745b 305d 2c20 7365 6c66 2e5f  rrent[0], self._
-00069c00: 6d65 7373 6167 6573 5f63 7572 7265 6e74  messages_current
-00069c10: 5b2d 315d 0d0a 2020 2020 2020 2020 2020  [-1]..          
-00069c20: 2020 2020 2020 7365 6c66 2e5f 6170 7065        self._appe
-00069c30: 6e64 5f74 6578 7428 2248 6973 746f 7279  nd_text("History
-00069c40: 206f 6620 2022 290d 0a20 2020 2020 2020   of  ")..       
-00069c50: 2020 2020 2020 2020 2073 656c 662e 5f61           self._a
-00069c60: 7070 656e 645f 7465 7874 286d 315b 2264  ppend_text(m1["d
-00069c70: 6174 6574 696d 6522 5d2e 7374 7266 7469  atetime"].strfti
-00069c80: 6d65 2822 2564 2e25 6d2e 2559 2229 2c20  me("%d.%m.%Y"), 
-00069c90: 2262 6f6c 6422 290d 0a20 2020 2020 2020  "bold")..       
-00069ca0: 2020 2020 2020 2020 2069 6620 6d31 5b22           if m1["
-00069cb0: 6461 7465 7469 6d65 225d 2e64 6174 6528  datetime"].date(
-00069cc0: 2920 213d 206d 325b 2264 6174 6574 696d  ) != m2["datetim
-00069cd0: 6522 5d2e 6461 7465 2829 3a0d 0a20 2020  e"].date():..   
-00069ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00069cf0: 2073 656c 662e 5f61 7070 656e 645f 7465   self._append_te
-00069d00: 7874 2822 2074 6f20 2229 0d0a 2020 2020  xt(" to ")..    
-00069d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00069d20: 7365 6c66 2e5f 6170 7065 6e64 5f74 6578  self._append_tex
-00069d30: 7428 0d0a 2020 2020 2020 2020 2020 2020  t(..            
-00069d40: 2020 2020 2020 2020 2020 2020 6d32 5b22              m2["
-00069d50: 6461 7465 7469 6d65 225d 2e73 7472 6674  datetime"].strft
-00069d60: 696d 6528 2225 642e 256d 2e25 5922 292c  ime("%d.%m.%Y"),
-00069d70: 2022 626f 6c64 2229 0d0a 2020 2020 2020   "bold")..      
-00069d80: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-00069d90: 6170 7065 6e64 5f74 6578 7428 2220 2028  append_text("  (
-00069da0: 2573 292e 2022 2025 2075 7469 6c2e 706c  %s). " % util.pl
-00069db0: 7572 616c 280d 0a20 2020 2020 2020 2020  ural(..         
-00069dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00069dd0: 2020 2020 2020 2020 2022 6d65 7373 6167           "messag
-00069de0: 6522 2c20 7365 6c66 2e5f 6d65 7373 6167  e", self._messag
-00069df0: 6573 5f63 7572 7265 6e74 2c20 7365 703d  es_current, sep=
-00069e00: 222c 2229 290d 0a0d 0a20 2020 2020 2020  ","))....       
-00069e10: 2020 2020 2069 6620 7365 6c66 2e5f 6368       if self._ch
-00069e20: 6174 5b22 6d65 7373 6167 655f 636f 756e  at["message_coun
-00069e30: 7422 5d20 616e 6420 7365 6c66 2e5f 6175  t"] and self._au
-00069e40: 746f 5f72 6574 7269 6576 6520 616e 6420  to_retrieve and 
-00069e50: 286e 6f74 2073 656c 662e 5f6d 6573 7361  (not self._messa
-00069e60: 6765 730d 0a20 2020 2020 2020 2020 2020  ges..           
-00069e70: 206f 7220 7365 6c66 2e5f 6d65 7373 6167   or self._messag
-00069e80: 6573 5b30 5d5b 2264 6174 6574 696d 6522  es[0]["datetime"
-00069e90: 5d20 3e20 7365 6c66 2e5f 6368 6174 5b22  ] > self._chat["
-00069ea0: 6669 7273 745f 6d65 7373 6167 655f 6461  first_message_da
-00069eb0: 7465 7469 6d65 225d 293a 0d0a 2020 2020  tetime"]):..    
-00069ec0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00069ed0: 2e5f 6170 7065 6e64 5f74 6578 7428 2253  ._append_text("S
-00069ee0: 6372 6f6c 6c20 6261 636b 206d 6f72 652e  croll back more.
-00069ef0: 222c 2022 6c69 6e6b 2229 0d0a 0d0a 2020  ", "link")....  
-00069f00: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-00069f10: 662e 5f63 6861 745b 226d 6573 7361 6765  f._chat["message
-00069f20: 5f63 6f75 6e74 225d 2061 6e64 2073 656c  _count"] and sel
-00069f30: 662e 5f61 7574 6f5f 7265 7472 6965 7665  f._auto_retrieve
-00069f40: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00069f50: 2020 2073 656c 662e 5f61 7070 656e 645f     self._append_
-00069f60: 7465 7874 2822 5c6e 5368 6f77 2066 726f  text("\nShow fro
-00069f70: 6d3a 2020 2229 0d0a 2020 2020 2020 2020  m:  ")..        
-00069f80: 2020 2020 2020 2020 6461 7465 5f66 6972          date_fir
-00069f90: 7374 203d 2073 656c 662e 5f63 6861 745b  st = self._chat[
-00069fa0: 2266 6972 7374 5f6d 6573 7361 6765 5f64  "first_message_d
-00069fb0: 6174 6574 696d 6522 5d2e 6461 7465 2829  atetime"].date()
-00069fc0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00069fd0: 2020 6461 7465 5f6c 6173 7420 3d20 7365    date_last = se
-00069fe0: 6c66 2e5f 6368 6174 5b22 6c61 7374 5f6d  lf._chat["last_m
-00069ff0: 6573 7361 6765 5f64 6174 6574 696d 6522  essage_datetime"
-0006a000: 5d2e 6461 7465 2829 0d0a 2020 2020 2020  ].date()..      
-0006a010: 2020 2020 2020 2020 2020 6461 7465 5f75            date_u
-0006a020: 6e74 696c 203d 2064 6174 6574 696d 652e  ntil = datetime.
-0006a030: 6461 7465 2e74 6f64 6179 2829 0d0a 2020  date.today()..  
-0006a040: 2020 2020 2020 2020 2020 2020 2020 6461                da
-0006a050: 7465 735f 6669 6c74 6572 203d 2073 656c  tes_filter = sel
-0006a060: 662e 5f66 696c 7465 722e 6765 7428 2264  f._filter.get("d
-0006a070: 6174 6572 616e 6765 2229 0d0a 2020 2020  aterange")..    
-0006a080: 2020 2020 2020 2020 2020 2020 6672 6f6d              from
-0006a090: 5f69 7465 6d73 203d 205b 5d20 2320 5b28  _items = [] # [(
-0006a0a0: 7469 746c 652c 205b 6461 7465 5f66 6972  title, [date_fir
-0006a0b0: 7374 2c20 6461 7465 5f6c 6173 745d 295d  st, date_last])]
-0006a0c0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-0006a0d0: 2020 2020 666f 7220 756e 6974 2c20 636f      for unit, co
-0006a0e0: 756e 7420 696e 205b 2822 6461 7922 2c20  unt in [("day", 
-0006a0f0: 3729 2c20 2822 7765 656b 222c 2032 292c  7), ("week", 2),
-0006a100: 2028 2264 6179 222c 2033 3029 2c0d 0a20   ("day", 30),.. 
-0006a110: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-0006a120: 226d 6f6e 7468 222c 2033 292c 2028 226d  "month", 3), ("m
-0006a130: 6f6e 7468 222c 2036 292c 2028 2279 6561  onth", 6), ("yea
-0006a140: 7222 2c20 3129 2c20 2822 7965 6172 222c  r", 1), ("year",
-0006a150: 2032 295d 3a0d 0a20 2020 2020 2020 2020   2)]:..         
-0006a160: 2020 2020 2020 2020 2020 2064 6174 655f             date_
-0006a170: 6672 6f6d 203d 2075 7469 6c2e 6461 7465  from = util.date
-0006a180: 5f73 6869 6674 2864 6174 655f 756e 7469  _shift(date_unti
-0006a190: 6c2c 2075 6e69 742c 202d 636f 756e 7429  l, unit, -count)
-0006a1a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0006a1b0: 2020 2020 2020 6966 2064 6174 655f 6672        if date_fr
-0006a1c0: 6f6d 203e 3d20 6461 7465 5f66 6972 7374  om >= date_first
-0006a1d0: 2061 6e64 2064 6174 655f 6672 6f6d 203c   and date_from <
-0006a1e0: 3d20 6461 7465 5f6c 6173 743a 0d0a 2020  = date_last:..  
-0006a1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006a200: 2020 2020 2020 7469 746c 6520 3d20 7574        title = ut
-0006a210: 696c 2e70 6c75 7261 6c28 756e 6974 2c20  il.plural(unit, 
-0006a220: 636f 756e 742c 2073 6570 3d22 2c22 290d  count, sep=",").
-0006a230: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0006a240: 2020 2020 2020 2020 2066 726f 6d5f 6974           from_it
-0006a250: 656d 732e 6170 7065 6e64 2828 7469 746c  ems.append((titl
-0006a260: 652c 205b 6461 7465 5f66 726f 6d2c 2064  e, [date_from, d
-0006a270: 6174 655f 6c61 7374 5d29 290d 0a20 2020  ate_last]))..   
-0006a280: 2020 2020 2020 2020 2020 2020 2064 6174               dat
-0006a290: 655f 3279 203d 2075 7469 6c2e 6461 7465  e_2y = util.date
-0006a2a0: 5f73 6869 6674 2864 6174 655f 756e 7469  _shift(date_unti
-0006a2b0: 6c2c 2022 7965 6172 222c 202d 3229 0d0a  l, "year", -2)..
-0006a2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006a2d0: 6461 7465 5f34 7920 3d20 7574 696c 2e64  date_4y = util.d
-0006a2e0: 6174 655f 7368 6966 7428 6461 7465 5f75  ate_shift(date_u
-0006a2f0: 6e74 696c 2c20 2279 6561 7222 2c20 2d34  ntil, "year", -4
-0006a300: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0006a310: 2020 2069 6620 2064 6174 655f 3279 203e     if  date_2y >
-0006a320: 2064 6174 655f 6669 7273 7420 616e 6420   date_first and 
-0006a330: 6461 7465 5f34 7920 3e20 6461 7465 5f66  date_4y > date_f
-0006a340: 6972 7374 3a0d 0a20 2020 2020 2020 2020  irst:..         
-0006a350: 2020 2020 2020 2020 2020 2066 726f 6d5f             from_
-0006a360: 6974 656d 732e 6170 7065 6e64 2828 2232  items.append(("2
-0006a370: 2074 6f20 3420 7965 6172 7322 2c20 5b64   to 4 years", [d
-0006a380: 6174 655f 3479 2c20 6461 7465 5f32 795d  ate_4y, date_2y]
-0006a390: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
-0006a3a0: 2020 2020 6966 2064 6174 655f 3479 203e      if date_4y >
-0006a3b0: 2064 6174 655f 6669 7273 743a 0d0a 2020   date_first:..  
-0006a3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006a3d0: 2020 6672 6f6d 5f69 7465 6d73 2e61 7070    from_items.app
-0006a3e0: 656e 6428 2822 3420 7965 6172 7320 616e  end(("4 years an
-0006a3f0: 6420 6f6c 6465 7222 2c20 5b64 6174 655f  d older", [date_
-0006a400: 6669 7273 742c 2064 6174 655f 3479 5d29  first, date_4y])
-0006a410: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
-0006a420: 2020 2020 2064 6174 6572 616e 6765 203d       daterange =
-0006a430: 205b 6461 7465 5f66 6972 7374 2c20 6461   [date_first, da
-0006a440: 7465 5f6c 6173 745d 0d0a 2020 2020 2020  te_last]..      
-0006a450: 2020 2020 2020 2020 2020 6672 6f6d 5f69            from_i
-0006a460: 7465 6d73 2e61 7070 656e 6428 2822 4672  tems.append(("Fr
-0006a470: 6f6d 2074 6865 2062 6567 696e 6e69 6e67  om the beginning
-0006a480: 222c 2064 6174 6572 616e 6765 2929 0d0a  ", daterange))..
-0006a490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006a4a0: 666f 7220 692c 2028 7469 746c 652c 2064  for i, (title, d
-0006a4b0: 6174 6572 616e 6765 2920 696e 2065 6e75  aterange) in enu
-0006a4c0: 6d65 7261 7465 2866 726f 6d5f 6974 656d  merate(from_item
-0006a4d0: 7329 3a0d 0a20 2020 2020 2020 2020 2020  s):..           
-0006a4e0: 2020 2020 2020 2020 2069 735f 6163 7469           is_acti
-0006a4f0: 7665 203d 2063 656e 7465 725f 6d65 7373  ve = center_mess
-0006a500: 6167 655f 6964 2069 7320 4e6f 6e65 205c  age_id is None \
-0006a510: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0006a520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006a530: 2020 616e 6420 2828 7469 746c 6520 3d3d    and ((title ==
-0006a540: 2073 656c 662e 5f64 6174 656c 696e 6b5f   self._datelink_
-0006a550: 6c61 7374 290d 0a20 2020 2020 2020 2020  last)..         
-0006a560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006a570: 2020 2020 2020 2020 2020 2020 6f72 2028              or (
-0006a580: 6461 7465 7261 6e67 6520 3d3d 2064 6174  daterange == dat
-0006a590: 6573 5f66 696c 7465 7229 290d 0a20 2020  es_filter))..   
-0006a5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006a5b0: 2069 6620 693a 0d0a 2020 2020 2020 2020   if i:..        
-0006a5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006a5d0: 7365 6c66 2e5f 6170 7065 6e64 5f74 6578  self._append_tex
-0006a5e0: 7428 7522 2020 5c75 3230 3232 2020 222c  t(u"  \u2022  ",
-0006a5f0: 2022 7370 6563 6961 6c22 2920 2320 6275   "special") # bu
-0006a600: 6c6c 6574 0d0a 2020 2020 2020 2020 2020  llet..          
-0006a610: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-0006a620: 2069 735f 6163 7469 7665 3a0d 0a20 2020   is_active:..   
-0006a630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006a640: 2020 2020 2073 656c 662e 5f64 6174 656c       self._datel
-0006a650: 696e 6b73 5b73 656c 662e 5354 432e 4c65  inks[self.STC.Le
-0006a660: 6e67 7468 5d20 3d20 6461 7465 7261 6e67  ngth] = daterang
-0006a670: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
-0006a680: 2020 2020 2020 2073 656c 662e 5f61 7070         self._app
-0006a690: 656e 645f 7465 7874 2874 6974 6c65 2c20  end_text(title, 
-0006a6a0: 2262 6f6c 6422 2069 6620 6973 5f61 6374  "bold" if is_act
-0006a6b0: 6976 6520 656c 7365 2022 6c69 6e6b 2229  ive else "link")
-0006a6c0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-0006a6d0: 6c66 2e5f 6461 7465 6c69 6e6b 5f6c 6173  lf._datelink_las
-0006a6e0: 7420 3d20 4e6f 6e65 0d0a 2020 2020 2020  t = None..      
-0006a6f0: 2020 2020 2020 7365 6c66 2e5f 6170 7065        self._appe
-0006a700: 6e64 5f74 6578 7428 225c 6e5c 6e22 290d  nd_text("\n\n").
-0006a710: 0a0d 0a20 2020 2020 2020 2020 2020 2066  ...            f
-0006a720: 6f72 2069 2c20 6d20 696e 2065 6e75 6d65  or i, m in enume
-0006a730: 7261 7465 2873 656c 662e 5f6d 6573 7361  rate(self._messa
-0006a740: 6765 735f 6375 7272 656e 7429 3a0d 0a20  ges_current):.. 
-0006a750: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0006a760: 6620 6d5b 2264 6174 6574 696d 6522 5d2e  f m["datetime"].
-0006a770: 6461 7465 2829 2021 3d20 7072 6576 696f  date() != previo
-0006a780: 7573 5f64 6179 3a0d 0a20 2020 2020 2020  us_day:..       
-0006a790: 2020 2020 2020 2020 2020 2020 2023 2044               # D
-0006a7a0: 6179 2068 6173 2063 6861 6e67 6564 3a20  ay has changed: 
-0006a7b0: 696e 7365 7274 2061 2064 6174 6520 6865  insert a date he
-0006a7c0: 6164 6572 0d0a 2020 2020 2020 2020 2020  ader..          
-0006a7d0: 2020 2020 2020 2020 2020 7072 6576 696f            previo
-0006a7e0: 7573 5f64 6179 203d 206d 5b22 6461 7465  us_day = m["date
-0006a7f0: 7469 6d65 225d 2e64 6174 6528 290d 0a20  time"].date().. 
-0006a800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006a810: 2020 2077 6565 6b64 6179 2c20 7765 656b     weekday, week
-0006a820: 6461 7465 203d 2075 7469 6c2e 6765 745f  date = util.get_
-0006a830: 6c6f 6361 6c65 5f64 6179 5f64 6174 6528  locale_day_date(
-0006a840: 7072 6576 696f 7573 5f64 6179 290d 0a20  previous_day).. 
-0006a850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006a860: 2020 2073 656c 662e 5f61 7070 656e 645f     self._append_
-0006a870: 7465 7874 2822 5c6e 2573 2220 2520 7765  text("\n%s" % we
-0006a880: 656b 6461 792c 2022 626f 6c64 2229 0d0a  ekday, "bold")..
-0006a890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006a8a0: 2020 2020 7365 6c66 2e5f 6170 7065 6e64      self._append
-0006a8b0: 5f74 6578 7428 222c 2025 735c 6e5c 6e22  _text(", %s\n\n"
-0006a8c0: 2025 2077 6565 6b64 6174 6529 0d0a 0d0a   % weekdate)....
-0006a8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006a8e0: 646f 6d20 3d20 7365 6c66 2e5f 7061 7273  dom = self._pars
-0006a8f0: 6572 2e70 6172 7365 286d 290d 0a20 2020  er.parse(m)..   
-0006a900: 2020 2020 2020 2020 2020 2020 206c 656e               len
-0006a910: 6774 685f 6265 666f 7265 203d 2073 656c  gth_before = sel
-0006a920: 662e 5354 432e 4c65 6e67 7468 0d0a 2020  f.STC.Length..  
-0006a930: 2020 2020 2020 2020 2020 2020 2020 7469                ti
-0006a940: 6d65 5f76 616c 7565 203d 206d 5b22 6461  me_value = m["da
-0006a950: 7465 7469 6d65 225d 2e73 7472 6674 696d  tetime"].strftim
-0006a960: 6528 2225 483a 254d 2229 0d0a 2020 2020  e("%H:%M")..    
-0006a970: 2020 2020 2020 2020 2020 2020 6469 7370              disp
-0006a980: 6c61 796e 616d 6520 3d20 7365 6c66 2e5f  layname = self._
-0006a990: 6462 2e67 6574 5f61 7574 686f 725f 6e61  db.get_author_na
-0006a9a0: 6d65 286d 290d 0a20 2020 2020 2020 2020  me(m)..         
-0006a9b0: 2020 2020 2020 2073 7065 6369 616c 5f74         special_t
-0006a9c0: 6167 203d 2064 6f6d 2e66 696e 6428 226d  ag = dom.find("m
-0006a9d0: 7367 7374 6174 7573 2229 0d0a 2020 2020  sgstatus")..    
-0006a9e0: 2020 2020 2020 2020 2020 2020 2320 496e              # In
-0006a9f0: 666f 206d 6573 7361 6765 7320 6c69 6b65  fo messages like
-0006aa00: 2022 2f6d 6520 6973 2074 6869 7273 7479   "/me is thirsty
-0006aa10: 2220 2d3e 2061 7574 686f 7220 6f6e 2073  " -> author on s
-0006aa20: 616d 6520 6c69 6e65 2e0d 0a20 2020 2020  ame line...     
-0006aa30: 2020 2020 2020 2020 2020 2069 735f 696e             is_in
-0006aa40: 666f 203d 2028 736b 7970 6564 6174 612e  fo = (skypedata.
-0006aa50: 4d45 5353 4147 455f 5459 5045 5f49 4e46  MESSAGE_TYPE_INF
-0006aa60: 4f20 3d3d 206d 5b22 7479 7065 225d 290d  O == m["type"]).
-0006aa70: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
-0006aa80: 2020 2069 6620 6973 5f69 6e66 6f3a 0d0a     if is_info:..
-0006aa90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006aaa0: 2020 2020 7374 796c 6562 6173 6520 3d20      stylebase = 
-0006aab0: 636f 6c6f 7572 6d61 705b 6d5b 2261 7574  colourmap[m["aut
-0006aac0: 686f 7222 5d5d 0d0a 2020 2020 2020 2020  hor"]]..        
-0006aad0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0006aae0: 2e5f 6170 7065 6e64 5f74 6578 7428 7469  ._append_text(ti
-0006aaf0: 6d65 5f76 616c 7565 2c20 7374 796c 6562  me_value, styleb
-0006ab00: 6173 6529 0d0a 2020 2020 2020 2020 2020  ase)..          
-0006ab10: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-0006ab20: 6170 7065 6e64 5f74 6578 7428 225c 6e25  append_text("\n%
-0006ab30: 7320 2220 2520 6469 7370 6c61 796e 616d  s " % displaynam
-0006ab40: 652c 2073 7479 6c65 6261 7365 202b 2022  e, stylebase + "
-0006ab50: 7765 616b 2229 0d0a 2020 2020 2020 2020  weak")..        
-0006ab60: 2020 2020 2020 2020 656c 6966 2073 7065          elif spe
-0006ab70: 6369 616c 5f74 6167 2069 7320 4e6f 6e65  cial_tag is None
-0006ab80: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0006ab90: 2020 2020 2020 2073 656c 662e 5f61 7070         self._app
-0006aba0: 656e 645f 7465 7874 2822 2573 2025 735c  end_text("%s %s\
-0006abb0: 6e22 2025 2028 7469 6d65 5f76 616c 7565  n" % (time_value
-0006abc0: 2c20 6469 7370 6c61 796e 616d 6529 2c0d  , displayname),.
-0006abd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0006abe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006abf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006ac00: 2020 2020 636f 6c6f 7572 6d61 705b 6d5b      colourmap[m[
-0006ac10: 2261 7574 686f 7222 5d5d 290d 0a20 2020  "author"]])..   
-0006ac20: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-0006ac30: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-0006ac40: 2020 2020 2020 2020 7365 6c66 2e5f 6170          self._ap
-0006ac50: 7065 6e64 5f74 6578 7428 2225 7320 2573  pend_text("%s %s
-0006ac60: 2220 2520 2874 696d 655f 7661 6c75 652c  " % (time_value,
-0006ac70: 2064 6973 706c 6179 6e61 6d65 292c 0d0a   displayname),..
+00061d80: 2020 2020 635b 226c 6173 745f 6d65 7373      c["last_mess
+00061d90: 6167 655f 6461 7465 7469 6d65 3222 5d20  age_datetime2"] 
+00061da0: 3d20 4e6f 6e65 0d0a 2020 2020 2020 2020  = None..        
+00061db0: 2020 2020 2020 2020 2020 2020 635b 226d              c["m
+00061dc0: 6573 7361 6765 7331 225d 203d 2063 5b22  essages1"] = c["
+00061dd0: 6d65 7373 6167 6573 3222 5d20 3d20 635b  messages2"] = c[
+00061de0: 2270 656f 706c 6522 5d20 3d20 4e6f 6e65  "people"] = None
+00061df0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00061e00: 2020 7365 6c66 2e63 6f6d 7061 7265 6420    self.compared 
+00061e10: 3d20 636f 6d70 6172 6564 0d0a 2020 2020  = compared..    
+00061e20: 2020 2020 2020 2020 666f 7220 6320 696e          for c in
+00061e30: 2073 656c 662e 636f 6d70 6172 6564 3a0d   self.compared:.
+00061e40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00061e50: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
+00061e60: 3229 3a0d 0a20 2020 2020 2020 2020 2020  2):..           
+00061e70: 2020 2020 2020 2020 2063 6d61 7020 3d20           cmap = 
+00061e80: 6332 6d61 7020 6966 2069 2065 6c73 6520  c2map if i else 
+00061e90: 6331 6d61 700d 0a20 2020 2020 2020 2020  c1map..         
+00061ea0: 2020 2020 2020 2020 2020 2069 6620 635b             if c[
+00061eb0: 2263 2573 2220 2520 2869 202b 2031 295d  "c%s" % (i + 1)]
+00061ec0: 2061 6e64 2063 5b22 6964 656e 7469 7479   and c["identity
+00061ed0: 225d 2069 6e20 636d 6170 3a0d 0a20 2020  "] in cmap:..   
+00061ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00061ef0: 2020 2020 2063 5b22 6d65 7373 6167 6573       c["messages
+00061f00: 2573 2220 2520 2869 202b 2031 295d 203d  %s" % (i + 1)] =
+00061f10: 205c 0d0a 2020 2020 2020 2020 2020 2020   \..            
+00061f20: 2020 2020 2020 2020 2020 2020 635b 2263              c["c
+00061f30: 2573 2220 2520 2869 202b 2031 295d 5b22  %s" % (i + 1)]["
+00061f40: 6d65 7373 6167 655f 636f 756e 7422 5d20  message_count"] 
+00061f50: 3d20 5c0d 0a20 2020 2020 2020 2020 2020  = \..           
+00061f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00061f70: 2063 6d61 705b 635b 2269 6465 6e74 6974   cmap[c["identit
+00061f80: 7922 5d5d 5b22 6d65 7373 6167 655f 636f  y"]]["message_co
+00061f90: 756e 7422 5d0d 0a20 2020 2020 2020 2020  unt"]..         
+00061fa0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00061fb0: 5b22 6c61 7374 5f6d 6573 7361 6765 5f64  ["last_message_d
+00061fc0: 6174 6574 696d 6525 7322 2025 2028 6920  atetime%s" % (i 
+00061fd0: 2b20 3129 5d20 3d20 5c0d 0a20 2020 2020  + 1)] = \..     
+00061fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00061ff0: 2020 2063 5b22 6325 7322 2025 2028 6920     c["c%s" % (i 
+00062000: 2b20 3129 5d5b 226c 6173 745f 6d65 7373  + 1)]["last_mess
+00062010: 6167 655f 6461 7465 7469 6d65 2573 2220  age_datetime%s" 
+00062020: 2520 2869 202b 2031 295d 203d 205c 0d0a  % (i + 1)] = \..
+00062030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00062040: 2020 2020 2020 2020 2020 2020 636d 6170              cmap
+00062050: 5b63 5b22 6964 656e 7469 7479 225d 5d5b  [c["identity"]][
+00062060: 226c 6173 745f 6d65 7373 6167 655f 6461  "last_message_da
+00062070: 7465 7469 6d65 225d 0d0a 2020 2020 2020  tetime"]..      
+00062080: 2020 2020 2020 2020 2020 7065 6f70 6c65            people
+00062090: 203d 2073 6f72 7465 6428 5b70 5b22 6964   = sorted([p["id
+000620a0: 656e 7469 7479 225d 2066 6f72 2070 2069  entity"] for p i
+000620b0: 6e20 635b 2270 6172 7469 6369 7061 6e74  n c["participant
+000620c0: 7322 5d5d 290d 0a20 2020 2020 2020 2020  s"]])..         
+000620d0: 2020 2020 2020 2069 6620 736b 7970 6564         if skyped
+000620e0: 6174 612e 4348 4154 535f 5459 5045 5f53  ata.CHATS_TYPE_S
+000620f0: 494e 474c 4520 213d 2063 5b22 7479 7065  INGLE != c["type
+00062100: 225d 3a0d 0a20 2020 2020 2020 2020 2020  "]:..           
+00062110: 2020 2020 2020 2020 2063 5b22 7065 6f70           c["peop
+00062120: 6c65 225d 203d 2022 2573 2028 2573 2922  le"] = "%s (%s)"
+00062130: 2025 2028 6c65 6e28 7065 6f70 6c65 292c   % (len(people),
+00062140: 2022 2c20 222e 6a6f 696e 2870 656f 706c   ", ".join(peopl
+00062150: 6529 290d 0a20 2020 2020 2020 2020 2020  e))..           
+00062160: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+00062170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00062180: 7065 6f70 6c65 203d 205b 7020 666f 7220  people = [p for 
+00062190: 7020 696e 2070 656f 706c 6520 6966 2070  p in people if p
+000621a0: 2021 3d20 7365 6c66 2e64 6231 2e69 645d   != self.db1.id]
+000621b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000621c0: 2020 2020 2020 635b 2270 656f 706c 6522        c["people"
+000621d0: 5d20 3d20 222c 2022 2e6a 6f69 6e28 7065  ] = ", ".join(pe
+000621e0: 6f70 6c65 290d 0a0d 0a20 2020 2020 2020  ople)....       
+000621f0: 2020 2020 2073 656c 662e 6c69 7374 5f63       self.list_c
+00062200: 6861 7473 2e45 6e61 626c 6564 203d 2054  hats.Enabled = T
+00062210: 7275 650d 0a20 2020 2020 2020 2020 2020  rue..           
+00062220: 2073 656c 662e 6c69 7374 5f63 6861 7473   self.list_chats
+00062230: 2e50 6f70 756c 6174 6528 7365 6c66 2e63  .Populate(self.c
+00062240: 6f6d 7061 7265 6429 0d0a 0d0a 2020 2020  ompared)....    
+00062250: 2020 2020 2020 2020 2320 506f 7075 6c61          # Popula
+00062260: 7465 2074 6865 2063 6f6e 7461 6374 2063  te the contact c
+00062270: 6f6d 7061 7269 736f 6e20 6c69 7374 0d0a  omparison list..
+00062280: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+00062290: 6163 7473 3120 3d20 7365 6c66 2e64 6231  acts1 = self.db1
+000622a0: 2e67 6574 5f63 6f6e 7461 6374 7328 290d  .get_contacts().
+000622b0: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
+000622c0: 7461 6374 7332 203d 2073 656c 662e 6462  tacts2 = self.db
+000622d0: 322e 6765 745f 636f 6e74 6163 7473 2829  2.get_contacts()
+000622e0: 0d0a 2020 2020 2020 2020 2020 2020 636f  ..            co
+000622f0: 6e74 6163 7467 726f 7570 7331 203d 2073  ntactgroups1 = s
+00062300: 656c 662e 6462 312e 6765 745f 636f 6e74  elf.db1.get_cont
+00062310: 6163 7467 726f 7570 7328 290d 0a20 2020  actgroups()..   
+00062320: 2020 2020 2020 2020 2063 6f6e 7461 6374           contact
+00062330: 6772 6f75 7073 3220 3d20 7365 6c66 2e64  groups2 = self.d
+00062340: 6232 2e67 6574 5f63 6f6e 7461 6374 6772  b2.get_contactgr
+00062350: 6f75 7073 2829 0d0a 2020 2020 2020 2020  oups()..        
+00062360: 2020 2020 636f 6e31 6d61 7020 3d20 6469      con1map = di
+00062370: 6374 2828 635b 2269 6465 6e74 6974 7922  ct((c["identity"
+00062380: 5d2c 2063 2920 666f 7220 6320 696e 2063  ], c) for c in c
+00062390: 6f6e 7461 6374 7331 290d 0a20 2020 2020  ontacts1)..     
+000623a0: 2020 2020 2020 2063 6f6e 326d 6170 203d         con2map =
+000623b0: 2064 6963 7428 2863 5b22 6964 656e 7469   dict((c["identi
+000623c0: 7479 225d 2c20 6329 2066 6f72 2063 2069  ty"], c) for c i
+000623d0: 6e20 636f 6e74 6163 7473 3229 0d0a 2020  n contacts2)..  
+000623e0: 2020 2020 2020 2020 2020 636f 6e31 6469            con1di
+000623f0: 6666 2c20 636f 6e32 6469 6666 203d 205b  ff, con2diff = [
+00062400: 5d2c 205b 5d0d 0a20 2020 2020 2020 2020  ], []..         
+00062410: 2020 2063 6f6e 316e 6577 2c20 636f 6e32     con1new, con2
+00062420: 6e65 7720 3d20 7b7d 2c20 7b7d 2023 204e  new = {}, {} # N
+00062430: 6577 2063 6f6e 7461 6374 7320 666f 7220  ew contacts for 
+00062440: 6462 7320 7b73 6b79 7065 6e61 6d65 3a72  dbs {skypename:r
+00062450: 6f77 2c20 7d0d 0a20 2020 2020 2020 2020  ow, }..         
+00062460: 2020 2063 6731 6469 6666 2c20 6367 3264     cg1diff, cg2d
+00062470: 6966 6620 3d20 5b5d 2c20 5b5d 0d0a 2020  iff = [], []..  
+00062480: 2020 2020 2020 2020 2020 6367 316d 6170            cg1map
+00062490: 203d 2064 6963 7428 2867 5b22 6e61 6d65   = dict((g["name
+000624a0: 225d 2c20 6729 2066 6f72 2067 2069 6e20  "], g) for g in 
+000624b0: 636f 6e74 6163 7467 726f 7570 7331 290d  contactgroups1).
+000624c0: 0a20 2020 2020 2020 2020 2020 2063 6732  .            cg2
+000624d0: 6d61 7020 3d20 6469 6374 2828 675b 226e  map = dict((g["n
+000624e0: 616d 6522 5d2c 2067 2920 666f 7220 6720  ame"], g) for g 
+000624f0: 696e 2063 6f6e 7461 6374 6772 6f75 7073  in contactgroups
+00062500: 3229 0d0a 2020 2020 2020 2020 2020 2020  2)..            
+00062510: 666f 7220 6331 2069 6e20 636f 6e74 6163  for c1 in contac
+00062520: 7473 313a 0d0a 2020 2020 2020 2020 2020  ts1:..          
+00062530: 2020 2020 2020 6332 203d 2063 6f6e 326d        c2 = con2m
+00062540: 6170 2e67 6574 2863 315b 2269 6465 6e74  ap.get(c1["ident
+00062550: 6974 7922 5d29 0d0a 2020 2020 2020 2020  ity"])..        
+00062560: 2020 2020 2020 2020 6966 206e 6f74 2063          if not c
+00062570: 3220 616e 6420 6331 5b22 6964 656e 7469  2 and c1["identi
+00062580: 7479 225d 206e 6f74 2069 6e20 636f 6e31  ty"] not in con1
+00062590: 6e65 773a 0d0a 2020 2020 2020 2020 2020  new:..          
+000625a0: 2020 2020 2020 2020 2020 6320 3d20 6331            c = c1
+000625b0: 2e63 6f70 7928 290d 0a20 2020 2020 2020  .copy()..       
+000625c0: 2020 2020 2020 2020 2020 2020 2063 5b22               c["
+000625d0: 6331 225d 2c20 635b 2263 3222 5d20 3d20  c1"], c["c2"] = 
+000625e0: 6331 2c20 6332 0d0a 2020 2020 2020 2020  c1, c2..        
+000625f0: 2020 2020 2020 2020 2020 2020 636f 6e31              con1
+00062600: 6469 6666 2e61 7070 656e 6428 6329 0d0a  diff.append(c)..
+00062610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00062620: 2020 2020 636f 6e31 6e65 775b 6331 5b22      con1new[c1["
+00062630: 6964 656e 7469 7479 225d 5d20 3d20 5472  identity"]] = Tr
+00062640: 7565 0d0a 2020 2020 2020 2020 2020 2020  ue..            
+00062650: 666f 7220 6332 2069 6e20 636f 6e74 6163  for c2 in contac
+00062660: 7473 323a 0d0a 2020 2020 2020 2020 2020  ts2:..          
+00062670: 2020 2020 2020 6331 203d 2063 6f6e 316d        c1 = con1m
+00062680: 6170 2e67 6574 2863 325b 2269 6465 6e74  ap.get(c2["ident
+00062690: 6974 7922 5d29 0d0a 2020 2020 2020 2020  ity"])..        
+000626a0: 2020 2020 2020 2020 6966 206e 6f74 2063          if not c
+000626b0: 3120 616e 6420 6332 5b22 6964 656e 7469  1 and c2["identi
+000626c0: 7479 225d 206e 6f74 2069 6e20 636f 6e32  ty"] not in con2
+000626d0: 6e65 773a 0d0a 2020 2020 2020 2020 2020  new:..          
+000626e0: 2020 2020 2020 2020 2020 6320 3d20 6332            c = c2
+000626f0: 2e63 6f70 7928 290d 0a20 2020 2020 2020  .copy()..       
+00062700: 2020 2020 2020 2020 2020 2020 2063 5b22               c["
+00062710: 6331 225d 2c20 635b 2263 3222 5d20 3d20  c1"], c["c2"] = 
+00062720: 6331 2c20 6332 0d0a 2020 2020 2020 2020  c1, c2..        
+00062730: 2020 2020 2020 2020 2020 2020 636f 6e32              con2
+00062740: 6469 6666 2e61 7070 656e 6428 6329 0d0a  diff.append(c)..
+00062750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00062760: 2020 2020 636f 6e32 6e65 775b 6332 5b22      con2new[c2["
+00062770: 6964 656e 7469 7479 225d 5d20 3d20 5472  identity"]] = Tr
+00062780: 7565 0d0a 2020 2020 2020 2020 2020 2020  ue..            
+00062790: 666f 7220 6731 2069 6e20 636f 6e74 6163  for g1 in contac
+000627a0: 7467 726f 7570 7331 3a0d 0a20 2020 2020  tgroups1:..     
+000627b0: 2020 2020 2020 2020 2020 2067 3220 3d20             g2 = 
+000627c0: 6367 326d 6170 2e67 6574 2867 315b 226e  cg2map.get(g1["n
+000627d0: 616d 6522 5d29 0d0a 2020 2020 2020 2020  ame"])..        
+000627e0: 2020 2020 2020 2020 6966 206e 6f74 2067          if not g
+000627f0: 3220 6f72 2067 325b 226d 656d 6265 7273  2 or g2["members
+00062800: 225d 2021 3d20 6731 5b22 6d65 6d62 6572  "] != g1["member
+00062810: 7322 5d3a 0d0a 2020 2020 2020 2020 2020  s"]:..          
+00062820: 2020 2020 2020 2020 2020 6720 3d20 6731            g = g1
+00062830: 2e63 6f70 7928 290d 0a20 2020 2020 2020  .copy()..       
+00062840: 2020 2020 2020 2020 2020 2020 2067 5b22               g["
+00062850: 6731 225d 203d 2067 310d 0a20 2020 2020  g1"] = g1..     
+00062860: 2020 2020 2020 2020 2020 2020 2020 2067                 g
+00062870: 5b22 6732 225d 203d 2067 320d 0a20 2020  ["g2"] = g2..   
+00062880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00062890: 2063 6731 6469 6666 2e61 7070 656e 6428   cg1diff.append(
+000628a0: 6729 0d0a 2020 2020 2020 2020 2020 2020  g)..            
+000628b0: 666f 7220 6732 2069 6e20 636f 6e74 6163  for g2 in contac
+000628c0: 7467 726f 7570 7332 3a0d 0a20 2020 2020  tgroups2:..     
+000628d0: 2020 2020 2020 2020 2020 2067 3120 3d20             g1 = 
+000628e0: 6367 316d 6170 2e67 6574 2867 325b 226e  cg1map.get(g2["n
+000628f0: 616d 6522 5d29 0d0a 2020 2020 2020 2020  ame"])..        
+00062900: 2020 2020 2020 2020 6966 206e 6f74 2067          if not g
+00062910: 3120 6f72 2067 315b 226d 656d 6265 7273  1 or g1["members
+00062920: 225d 2021 3d20 6732 5b22 6d65 6d62 6572  "] != g2["member
+00062930: 7322 5d3a 0d0a 2020 2020 2020 2020 2020  s"]:..          
+00062940: 2020 2020 2020 2020 2020 6720 3d20 6732            g = g2
+00062950: 2e63 6f70 7928 290d 0a20 2020 2020 2020  .copy()..       
+00062960: 2020 2020 2020 2020 2020 2020 2067 5b22               g["
+00062970: 6731 225d 203d 2067 310d 0a20 2020 2020  g1"] = g1..     
+00062980: 2020 2020 2020 2020 2020 2020 2020 2067                 g
+00062990: 5b22 6732 225d 203d 2067 320d 0a20 2020  ["g2"] = g2..   
+000629a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000629b0: 2063 6732 6469 6666 2e61 7070 656e 6428   cg2diff.append(
+000629c0: 6729 0d0a 2020 2020 2020 2020 2020 2020  g)..            
+000629d0: 6475 6d6d 7920 3d20 7b22 5f5f 7479 7065  dummy = {"__type
+000629e0: 223a 2022 4772 6f75 7022 2c20 2270 686f  ": "Group", "pho
+000629f0: 6e65 5f6d 6f62 696c 655f 6e6f 726d 616c  ne_mobile_normal
+00062a00: 697a 6564 223a 2022 222c 0d0a 2020 2020  ized": "",..    
+00062a10: 2020 2020 2020 2020 2020 2020 2263 6f75              "cou
+00062a20: 6e74 7279 223a 2022 222c 2022 6369 7479  ntry": "", "city
+00062a30: 223a 2022 222c 2022 6162 6f75 7422 3a20  ": "", "about": 
+00062a40: 2241 626f 7574 227d 0d0a 2020 2020 2020  "About"}..      
+00062a50: 2020 2020 2020 636f 6e31 6469 6666 6c69        con1diffli
+00062a60: 7374 203d 205b 632e 636f 7079 2829 2066  st = [c.copy() f
+00062a70: 6f72 2063 2069 6e20 636f 6e31 6469 6666  or c in con1diff
+00062a80: 5d0d 0a20 2020 2020 2020 2020 2020 205b  ]..            [
+00062a90: 632e 7570 6461 7465 287b 225f 5f74 7970  c.update({"__typ
+00062aa0: 6522 3a20 2243 6f6e 7461 6374 222c 2022  e": "Contact", "
+00062ab0: 5f5f 6461 7461 223a 2063 7d29 2066 6f72  __data": c}) for
+00062ac0: 2063 2069 6e20 636f 6e31 6469 6666 6c69   c in con1diffli
+00062ad0: 7374 5d0d 0a20 2020 2020 2020 2020 2020  st]..           
+00062ae0: 2066 6f72 2067 2069 6e20 6367 3164 6966   for g in cg1dif
+00062af0: 663a 0d0a 2020 2020 2020 2020 2020 2020  f:..            
+00062b00: 2020 2020 6320 3d20 672e 636f 7079 2829      c = g.copy()
+00062b10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00062b20: 2020 632e 7570 6461 7465 2864 756d 6d79    c.update(dummy
+00062b30: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00062b40: 2020 2063 5b22 6964 656e 7469 7479 225d     c["identity"]
+00062b50: 2c20 635b 225f 5f64 6174 6122 5d20 3d20  , c["__data"] = 
+00062b60: 635b 226d 656d 6265 7273 225d 2c20 670d  c["members"], g.
+00062b70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00062b80: 2063 6f6e 3164 6966 666c 6973 742e 6170   con1difflist.ap
+00062b90: 7065 6e64 2863 290d 0a20 2020 2020 2020  pend(c)..       
+00062ba0: 2020 2020 2063 6f6e 3264 6966 666c 6973       con2difflis
+00062bb0: 7420 3d20 5b63 2e63 6f70 7928 2920 666f  t = [c.copy() fo
+00062bc0: 7220 6320 696e 2063 6f6e 3264 6966 665d  r c in con2diff]
+00062bd0: 0d0a 2020 2020 2020 2020 2020 2020 5b63  ..            [c
+00062be0: 2e75 7064 6174 6528 7b22 5f5f 7479 7065  .update({"__type
+00062bf0: 223a 2243 6f6e 7461 6374 222c 2022 5f5f  ":"Contact", "__
+00062c00: 6461 7461 223a 2063 7d29 2066 6f72 2063  data": c}) for c
+00062c10: 2069 6e20 636f 6e32 6469 6666 6c69 7374   in con2difflist
+00062c20: 5d0d 0a20 2020 2020 2020 2020 2020 2066  ]..            f
+00062c30: 6f72 2067 2069 6e20 6367 3264 6966 663a  or g in cg2diff:
+00062c40: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00062c50: 2020 6320 3d20 672e 636f 7079 2829 0d0a    c = g.copy()..
+00062c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00062c70: 632e 7570 6461 7465 2864 756d 6d79 290d  c.update(dummy).
+00062c80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00062c90: 2063 5b22 6964 656e 7469 7479 225d 2c20   c["identity"], 
+00062ca0: 635b 225f 5f64 6174 6122 5d20 3d20 635b  c["__data"] = c[
+00062cb0: 226d 656d 6265 7273 225d 2c20 670d 0a20  "members"], g.. 
+00062cc0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00062cd0: 6f6e 3264 6966 666c 6973 742e 6170 7065  on2difflist.appe
+00062ce0: 6e64 2863 290d 0a20 2020 2020 2020 2020  nd(c)..         
+00062cf0: 2020 2073 656c 662e 6c69 7374 5f63 6f6e     self.list_con
+00062d00: 7461 6374 732e 506f 7075 6c61 7465 2863  tacts.Populate(c
+00062d10: 6f6e 3164 6966 666c 6973 7429 0d0a 2020  on1difflist)..  
+00062d20: 2020 2020 2020 2020 2020 7365 6c66 2e62            self.b
+00062d30: 7574 746f 6e5f 6d65 7267 655f 616c 6c63  utton_merge_allc
+00062d40: 6f6e 7461 6374 732e 456e 6162 6c65 6420  ontacts.Enabled 
+00062d50: 3d20 7365 6c66 2e6c 6973 745f 636f 6e74  = self.list_cont
+00062d60: 6163 7473 2e49 7465 6d43 6f75 6e74 0d0a  acts.ItemCount..
+00062d70: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00062d80: 2e63 6f6e 3164 6966 6620 3d20 636f 6e31  .con1diff = con1
+00062d90: 6469 6666 0d0a 2020 2020 2020 2020 2020  diff..          
+00062da0: 2020 7365 6c66 2e63 6f6e 3264 6966 6620    self.con2diff 
+00062db0: 3d20 636f 6e32 6469 6666 0d0a 2020 2020  = con2diff..    
+00062dc0: 2020 2020 2020 2020 7365 6c66 2e63 6f6e          self.con
+00062dd0: 3164 6966 666c 6973 7420 3d20 636f 6e31  1difflist = con1
+00062de0: 6469 6666 6c69 7374 0d0a 2020 2020 2020  difflist..      
+00062df0: 2020 2020 2020 7365 6c66 2e63 6f6e 3264        self.con2d
+00062e00: 6966 666c 6973 7420 3d20 636f 6e32 6469  ifflist = con2di
+00062e10: 6666 6c69 7374 0d0a 2020 2020 2020 2020  fflist..        
+00062e20: 2020 2020 7365 6c66 2e63 6f6e 6772 6f75      self.congrou
+00062e30: 7031 6469 6666 203d 2063 6731 6469 6666  p1diff = cg1diff
+00062e40: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00062e50: 6c66 2e63 6f6e 6772 6f75 7032 6469 6666  lf.congroup2diff
+00062e60: 203d 2063 6732 6469 6666 0d0a 0d0a 2020   = cg2diff....  
+00062e70: 2020 2020 2020 2020 2020 666f 7220 6920            for i 
+00062e80: 696e 2072 616e 6765 2832 293a 0d0a 2020  in range(2):..  
+00062e90: 2020 2020 2020 2020 2020 2020 2020 6462                db
+00062ea0: 203d 2073 656c 662e 6462 3220 6966 2069   = self.db2 if i
+00062eb0: 2065 6c73 6520 7365 6c66 2e64 6231 0d0a   else self.db1..
+00062ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00062ed0: 6462 2e75 7064 6174 655f 6669 6c65 696e  db.update_filein
+00062ee0: 666f 2829 0d0a 2020 2020 2020 2020 2020  fo()..          
+00062ef0: 2020 2020 2020 6c61 6265 6c20 3d20 7365        label = se
+00062f00: 6c66 2e6c 6162 656c 5f61 6c6c 3220 6966  lf.label_all2 if
+00062f10: 2069 2065 6c73 6520 7365 6c66 2e6c 6162   i else self.lab
+00062f20: 656c 5f61 6c6c 310d 0a20 2020 2020 2020  el_all1..       
+00062f30: 2020 2020 2020 2020 206c 6162 656c 2e4c           label.L
+00062f40: 6162 656c 203d 2022 2573 2e5c 6e5c 6e53  abel = "%s.\n\nS
+00062f50: 697a 6520 2573 2e5c 6e4c 6173 7420 6d6f  ize %s.\nLast mo
+00062f60: 6469 6669 6564 2025 732e 5c6e 2220 2520  dified %s.\n" % 
+00062f70: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+00062f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00062f90: 2064 622c 2075 7469 6c2e 666f 726d 6174   db, util.format
+00062fa0: 5f62 7974 6573 2864 622e 6669 6c65 7369  _bytes(db.filesi
+00062fb0: 7a65 292c 0d0a 2020 2020 2020 2020 2020  ze),..          
+00062fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00062fd0: 2020 2020 6462 2e6c 6173 745f 6d6f 6469      db.last_modi
+00062fe0: 6669 6564 2e73 7472 6674 696d 6528 2225  fied.strftime("%
+00062ff0: 592d 256d 2d25 6420 2548 3a25 4d3a 2553  Y-%m-%d %H:%M:%S
+00063000: 2229 290d 0a20 2020 2020 2020 2020 2020  "))..           
+00063010: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
+00063020: 3229 3a0d 0a20 2020 2020 2020 2020 2020  2):..           
+00063030: 2020 2020 2064 6220 3d20 7365 6c66 2e64       db = self.d
+00063040: 6232 2069 6620 6920 656c 7365 2073 656c  b2 if i else sel
+00063050: 662e 6462 310d 0a20 2020 2020 2020 2020  f.db1..         
+00063060: 2020 2020 2020 2063 6f6e 6469 6666 203d         condiff =
+00063070: 2073 656c 662e 636f 6e32 6469 6666 2069   self.con2diff i
+00063080: 6620 6920 656c 7365 2073 656c 662e 636f  f i else self.co
+00063090: 6e31 6469 6666 0d0a 2020 2020 2020 2020  n1diff..        
+000630a0: 2020 2020 2020 2020 636f 6e74 6163 7473          contacts
+000630b0: 203d 2063 6f6e 7461 6374 7332 2069 6620   = contacts2 if 
+000630c0: 6920 656c 7365 2063 6f6e 7461 6374 7331  i else contacts1
+000630d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000630e0: 2020 6462 2e75 7064 6174 655f 6669 6c65    db.update_file
+000630f0: 696e 666f 2829 0d0a 2020 2020 2020 2020  info()..        
+00063100: 2020 2020 2020 2020 6c61 6265 6c20 3d20          label = 
+00063110: 7365 6c66 2e6c 6162 656c 5f61 6c6c 3220  self.label_all2 
+00063120: 6966 2069 2065 6c73 6520 7365 6c66 2e6c  if i else self.l
+00063130: 6162 656c 5f61 6c6c 310d 0a20 2020 2020  abel_all1..     
+00063140: 2020 2020 2020 2020 2020 206c 6162 656c             label
+00063150: 2e4c 6162 656c 203d 2022 2573 2e5c 6e5c  .Label = "%s.\n\
+00063160: 6e53 697a 6520 2573 2e5c 6e4c 6173 7420  nSize %s.\nLast 
+00063170: 6d6f 6469 6669 6564 2025 732e 5c6e 2220  modified %s.\n" 
+00063180: 2520 280d 0a20 2020 2020 2020 2020 2020  % (..           
+00063190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000631a0: 2020 2064 622c 2075 7469 6c2e 666f 726d     db, util.form
+000631b0: 6174 5f62 7974 6573 2864 622e 6669 6c65  at_bytes(db.file
+000631c0: 7369 7a65 292c 0d0a 2020 2020 2020 2020  size),..        
+000631d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000631e0: 2020 2020 2020 6462 2e6c 6173 745f 6d6f        db.last_mo
+000631f0: 6469 6669 6564 2e73 7472 6674 696d 6528  dified.strftime(
+00063200: 2225 592d 256d 2d25 6420 2548 3a25 4d3a  "%Y-%m-%d %H:%M:
+00063210: 2553 2229 290d 0a20 2020 2020 2020 2020  %S"))..         
+00063220: 2020 2020 2020 2063 6861 7473 203d 2063         chats = c
+00063230: 6861 7473 3220 6966 2069 2065 6c73 6520  hats2 if i else 
+00063240: 6368 6174 7331 0d0a 2020 2020 2020 2020  chats1..        
+00063250: 2020 2020 2020 2020 6966 2063 6861 7473          if chats
+00063260: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00063270: 2020 2020 2020 2074 3120 3d20 6c69 7374         t1 = list
+00063280: 2866 696c 7465 7228 626f 6f6c 2c20 5b63  (filter(bool, [c
+00063290: 5b22 6d65 7373 6167 655f 636f 756e 7422  ["message_count"
+000632a0: 5d20 666f 7220 6320 696e 2063 6861 7473  ] for c in chats
+000632b0: 5d29 290d 0a20 2020 2020 2020 2020 2020  ]))..           
+000632c0: 2020 2020 2020 2020 2063 6f75 6e74 5f6d           count_m
+000632d0: 6573 7361 6765 7320 3d20 7375 6d28 7431  essages = sum(t1
+000632e0: 2920 6966 2074 3120 656c 7365 2030 0d0a  ) if t1 else 0..
+000632f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00063300: 2020 2020 7432 203d 206c 6973 7428 6669      t2 = list(fi
+00063310: 6c74 6572 2862 6f6f 6c2c 205b 635b 2266  lter(bool, [c["f
+00063320: 6972 7374 5f6d 6573 7361 6765 5f64 6174  irst_message_dat
+00063330: 6574 696d 6522 5d20 666f 7220 6320 696e  etime"] for c in
+00063340: 2063 6861 7473 5d29 290d 0a20 2020 2020   chats]))..     
+00063350: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00063360: 6174 6574 696d 655f 6669 7273 7420 3d20  atetime_first = 
+00063370: 6d69 6e28 7432 2920 6966 2074 3220 656c  min(t2) if t2 el
+00063380: 7365 204e 6f6e 650d 0a20 2020 2020 2020  se None..       
+00063390: 2020 2020 2020 2020 2020 2020 2074 3320               t3 
+000633a0: 3d20 6c69 7374 2866 696c 7465 7228 626f  = list(filter(bo
+000633b0: 6f6c 2c20 5b63 5b22 6c61 7374 5f6d 6573  ol, [c["last_mes
+000633c0: 7361 6765 5f64 6174 6574 696d 6522 5d20  sage_datetime"] 
+000633d0: 666f 7220 6320 696e 2063 6861 7473 5d29  for c in chats])
+000633e0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+000633f0: 2020 2020 2020 2064 6174 6574 696d 655f         datetime_
+00063400: 6c61 7374 203d 206d 6178 2874 3329 2069  last = max(t3) i
+00063410: 6620 7433 2065 6c73 6520 4e6f 6e65 0d0a  f t3 else None..
+00063420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00063430: 2020 2020 6461 7465 7465 7874 5f66 6972      datetext_fir
+00063440: 7374 203d 2022 2220 6966 206e 6f74 2064  st = "" if not d
+00063450: 6174 6574 696d 655f 6669 7273 7420 5c0d  atetime_first \.
+00063460: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00063470: 2020 2020 2020 2020 2065 6c73 6520 6461           else da
+00063480: 7465 7469 6d65 5f66 6972 7374 2e73 7472  tetime_first.str
+00063490: 6674 696d 6528 2225 592d 256d 2d25 6420  ftime("%Y-%m-%d 
+000634a0: 2548 3a25 4d3a 2553 2229 0d0a 2020 2020  %H:%M:%S")..    
+000634b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000634c0: 6461 7465 7465 7874 5f6c 6173 7420 3d20  datetext_last = 
+000634d0: 2222 2069 6620 6e6f 7420 6461 7465 7469  "" if not dateti
+000634e0: 6d65 5f6c 6173 7420 5c0d 0a20 2020 2020  me_last \..     
+000634f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00063500: 2020 2065 6c73 6520 6461 7465 7469 6d65     else datetime
+00063510: 5f6c 6173 742e 7374 7266 7469 6d65 2822  _last.strftime("
+00063520: 2559 2d25 6d2d 2564 2025 483a 254d 3a25  %Y-%m-%d %H:%M:%
+00063530: 5322 290d 0a20 2020 2020 2020 2020 2020  S")..           
+00063540: 2020 2020 2020 2020 2063 6f6e 7461 6374           contact
+00063550: 7465 7874 203d 2075 7469 6c2e 706c 7572  text = util.plur
+00063560: 616c 2822 636f 6e74 6163 7422 2c20 636f  al("contact", co
+00063570: 6e74 6163 7473 2c20 7365 703d 222c 2229  ntacts, sep=",")
+00063580: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00063590: 2020 2020 2020 6966 2063 6f6e 6469 6666        if condiff
+000635a0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+000635b0: 2020 2020 2020 2020 2020 2063 6f6e 7461             conta
+000635c0: 6374 7465 7874 202b 3d20 2220 2825 6420  cttext += " (%d 
+000635d0: 6e6f 7420 7072 6573 656e 7420 6f6e 2074  not present on t
+000635e0: 6865 2025 7329 2220 2520 280d 0a20 2020  he %s)" % (..   
+000635f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00063600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00063610: 2020 2020 6c65 6e28 636f 6e64 6966 6629      len(condiff)
+00063620: 2c20 5b22 7269 6768 7422 2c20 226c 6566  , ["right", "lef
+00063630: 7422 5d5b 695d 290d 0a20 2020 2020 2020  t"][i])..       
+00063640: 2020 2020 2020 2020 2020 2020 206c 6162               lab
+00063650: 656c 2e4c 6162 656c 202b 3d20 2225 732e  el.Label += "%s.
+00063660: 5c6e 2573 2e5c 6e25 732e 5c6e 4669 7273  \n%s.\n%s.\nFirs
+00063670: 7420 6d65 7373 6167 6520 6174 2025 732e  t message at %s.
+00063680: 5c6e 2220 5c0d 0a20 2020 2020 2020 2020  \n" \..         
+00063690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000636a0: 2020 2020 2020 2020 2020 224c 6173 7420            "Last 
+000636b0: 6d65 7373 6167 6520 6174 2025 732e 2220  message at %s." 
+000636c0: 2520 280d 0a20 2020 2020 2020 2020 2020  % (..           
+000636d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000636e0: 2020 2020 2020 2020 7574 696c 2e70 6c75          util.plu
+000636f0: 7261 6c28 2263 6f6e 7665 7273 6174 696f  ral("conversatio
+00063700: 6e22 2c20 6368 6174 732c 2073 6570 3d22  n", chats, sep="
+00063710: 2c22 292c 0d0a 2020 2020 2020 2020 2020  ,"),..          
+00063720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00063730: 2020 2020 2020 2020 2075 7469 6c2e 706c           util.pl
+00063740: 7572 616c 2822 6d65 7373 6167 6522 2c20  ural("message", 
+00063750: 636f 756e 745f 6d65 7373 6167 6573 2c20  count_messages, 
+00063760: 7365 703d 222c 2229 2c0d 0a20 2020 2020  sep=","),..     
+00063770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00063780: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00063790: 6e74 6163 7474 6578 742c 2064 6174 6574  ntacttext, datet
+000637a0: 6578 745f 6669 7273 742c 2064 6174 6574  ext_first, datet
+000637b0: 6578 745f 6c61 7374 290d 0a20 2020 2020  ext_last)..     
+000637c0: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
+000637d0: 696f 6e20 6173 2065 3a0d 0a20 2020 2020  ion as e:..     
+000637e0: 2020 2020 2020 2023 2044 6174 6162 6173         # Databas
+000637f0: 6520 6163 6365 7373 2063 616e 2065 6173  e access can eas
+00063800: 696c 7920 6661 696c 2069 6620 7468 6520  ily fail if the 
+00063810: 7573 6572 2063 6c6f 7365 7320 7468 6520  user closes the 
+00063820: 7461 6220 6265 666f 7265 0d0a 2020 2020  tab before..    
+00063830: 2020 2020 2020 2020 2320 7468 6520 6c61          # the la
+00063840: 7465 7220 6461 7461 2068 6173 2062 6565  ter data has bee
+00063850: 6e20 6c6f 6164 6564 2e0d 0a20 2020 2020  n loaded...     
+00063860: 2020 2020 2020 2069 6620 7365 6c66 3a0d         if self:.
+00063870: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00063880: 206c 6f67 6765 722e 6578 6365 7074 696f   logger.exceptio
+00063890: 6e28 2245 7272 6f72 206c 6f61 6469 6e67  n("Error loading
+000638a0: 2061 6464 6974 696f 6e61 6c20 6461 7461   additional data
+000638b0: 2066 726f 6d20 2573 206f 7220 2573 2e22   from %s or %s."
+000638c0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+000638d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000638e0: 2020 2020 7365 6c66 2e64 6231 2c20 7365      self.db1, se
+000638f0: 6c66 2e64 6232 290d 0a20 2020 2020 2020  lf.db2)..       
+00063900: 2020 2020 2020 2020 2077 782e 4d65 7373           wx.Mess
+00063910: 6167 6542 6f78 2822 4572 726f 7220 6c6f  ageBox("Error lo
+00063920: 6164 696e 6720 6164 6469 7469 6f6e 616c  ading additional
+00063930: 2064 6174 6120 6672 6f6d 2025 7320 6f72   data from %s or
+00063940: 2025 732e 220d 0a20 2020 2020 2020 2020   %s."..         
+00063950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00063960: 2020 2020 2022 5c6e 5c6e 4572 726f 723a       "\n\nError:
+00063970: 2025 732e 2220 2520 2873 656c 662e 6462   %s." % (self.db
+00063980: 312c 2073 656c 662e 6462 322c 2075 7469  1, self.db2, uti
+00063990: 6c2e 666f 726d 6174 5f65 7863 2865 2929  l.format_exc(e))
+000639a0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+000639b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000639c0: 2063 6f6e 662e 5469 746c 652c 2077 782e   conf.Title, wx.
+000639d0: 4f4b 207c 2077 782e 4943 4f4e 5f57 4152  OK | wx.ICON_WAR
+000639e0: 4e49 4e47 290d 0a0d 0a20 2020 2020 2020  NING)....       
+000639f0: 2069 6620 7365 6c66 3a0d 0a20 2020 2020   if self:..     
+00063a00: 2020 2020 2020 2073 656c 662e 6275 7474         self.butt
+00063a10: 6f6e 5f73 7761 702e 456e 6162 6c65 6420  on_swap.Enabled 
+00063a20: 3d20 5472 7565 0d0a 2020 2020 2020 2020  = True..        
+00063a30: 2020 2020 7365 6c66 2e62 7574 746f 6e5f      self.button_
+00063a40: 6d65 7267 655f 6368 6174 732e 456e 6162  merge_chats.Enab
+00063a50: 6c65 6420 3d20 5472 7565 0d0a 2020 2020  led = True..    
+00063a60: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
+00063a70: 656c 662e 6973 5f73 6361 6e6e 6564 3a0d  elf.is_scanned:.
+00063a80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00063a90: 2073 656c 662e 6275 7474 6f6e 5f73 6361   self.button_sca
+00063aa0: 6e5f 616c 6c2e 456e 6162 6c65 6420 3d20  n_all.Enabled = 
+00063ab0: 5472 7565 0d0a 2020 2020 2020 2020 2020  True..          
+00063ac0: 2020 2020 2020 7365 6c66 2e62 7574 746f        self.butto
+00063ad0: 6e5f 6d65 7267 655f 616c 6c2e 456e 6162  n_merge_all.Enab
+00063ae0: 6c65 6420 3d20 5472 7565 0d0a 2020 2020  led = True..    
+00063af0: 2020 2020 2020 2020 6775 6962 6173 652e          guibase.
+00063b00: 7374 6174 7573 2822 4f70 656e 6564 2025  status("Opened %
+00063b10: 7320 616e 6420 2573 2e22 2c20 7365 6c66  s and %s.", self
+00063b20: 2e64 6231 2c20 7365 6c66 2e64 6232 290d  .db1, self.db2).
+00063b30: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00063b40: 662e 7061 6765 5f6d 6572 6765 5f61 6c6c  f.page_merge_all
+00063b50: 2e4c 6179 6f75 7428 290d 0a20 2020 2020  .Layout()..     
+00063b60: 2020 2020 2020 2073 656c 662e 5265 6672         self.Refr
+00063b70: 6573 6828 290d 0a20 2020 2020 2020 2020  esh()..         
+00063b80: 2020 2077 782e 4361 6c6c 4166 7465 7228     wx.CallAfter(
+00063b90: 7365 6c66 2e75 7064 6174 655f 7461 6268  self.update_tabh
+00063ba0: 6561 6465 7229 0d0a 0d0a 0d0a 0d0a 636c  eader)........cl
+00063bb0: 6173 7320 4368 6174 436f 6e74 656e 7453  ass ChatContentS
+00063bc0: 5443 2863 6f6e 7472 6f6c 732e 5365 6172  TC(controls.Sear
+00063bd0: 6368 6162 6c65 5374 796c 6564 5465 7874  chableStyledText
+00063be0: 4374 726c 293a 0d0a 2020 2020 2222 2241  Ctrl):..    """A
+00063bf0: 2053 7479 6c65 6454 6578 7443 7472 6c20   StyledTextCtrl 
+00063c00: 666f 7220 7368 6f77 696e 6720 616e 6420  for showing and 
+00063c10: 6669 6c74 6572 696e 6720 6368 6174 206d  filtering chat m
+00063c20: 6573 7361 6765 732e 2222 220d 0a0d 0a20  essages.""".... 
+00063c30: 2020 2054 4558 545f 4e4f 5f4d 4553 5341     TEXT_NO_MESSA
+00063c40: 4745 5320 3d20 225c 6e4e 6f20 6d65 7373  GES = "\nNo mess
+00063c50: 6167 6573 2074 6f20 7368 6f77 2e22 0d0a  ages to show."..
+00063c60: 0d0a 2020 2020 2222 2253 5443 207a 6f6f  ..    """STC zoo
+00063c70: 6d20 6c65 7665 6c73 2074 6f20 6566 6665  m levels to effe
+00063c80: 6374 6976 6520 7465 7874 2073 697a 6520  ctive text size 
+00063c90: 6d75 6c74 6970 6c69 6572 732e 2222 220d  multipliers.""".
+00063ca0: 0a20 2020 205a 4f4f 4d5f 5045 5243 454e  .    ZOOM_PERCEN
+00063cb0: 5453 203d 207b 0d0a 2020 2020 2020 2020  TS = {..        
+00063cc0: 202d 383a 2020 2e32 352c 2023 204c 6f77   -8:  .25, # Low
+00063cd0: 6572 2076 616c 7565 7320 6469 7370 6c61  er values displa
+00063ce0: 7965 6420 7769 7468 2073 616d 6520 7369  yed with same si
+00063cf0: 7a65 0d0a 2020 2020 2020 2020 202d 353a  ze..         -5:
+00063d00: 2020 2e35 302c 0d0a 2020 2020 2020 2020    .50,..        
+00063d10: 202d 333a 2020 2e38 302c 2023 2041 7070   -3:  .80, # App
+00063d20: 726f 7869 6d61 7465 0d0a 2020 2020 2020  roximate..      
+00063d30: 2020 2020 303a 2031 2e30 302c 0d0a 2020      0: 1.00,..  
+00063d40: 2020 2020 2020 2020 323a 2031 2e32 302c          2: 1.20,
+00063d50: 2023 2041 7070 726f 7869 6d61 7465 0d0a   # Approximate..
+00063d60: 2020 2020 2020 2020 2020 353a 2031 2e35            5: 1.5
+00063d70: 302c 0d0a 2020 2020 2020 2020 2020 373a  0,..          7:
+00063d80: 2031 2e37 352c 0d0a 2020 2020 2020 2020   1.75,..        
+00063d90: 2031 303a 2032 2e30 302c 2023 2041 7070   10: 2.00, # App
+00063da0: 726f 7869 6d61 7465 0d0a 2020 2020 2020  roximate..      
+00063db0: 2020 2031 353a 2032 2e35 302c 0d0a 2020     15: 2.50,..  
+00063dc0: 2020 2020 2020 2032 303a 2033 2e30 302c         20: 3.00,
+00063dd0: 0d0a 2020 2020 7d0d 0a20 2020 205a 4f4f  ..    }..    ZOO
+00063de0: 4d5f 5045 5243 454e 545f 4d41 5820 3d20  M_PERCENT_MAX = 
+00063df0: 3130 2e30 0d0a 0d0a 0d0a 2020 2020 6465  10.0......    de
+00063e00: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
+00063e10: 202a 6172 6773 2c20 2a2a 6b77 6172 6773   *args, **kwargs
+00063e20: 293a 0d0a 2020 2020 2020 2020 636f 6e74  ):..        cont
+00063e30: 726f 6c73 2e53 6561 7263 6861 626c 6553  rols.SearchableS
+00063e40: 7479 6c65 6454 6578 7443 7472 6c2e 5f5f  tyledTextCtrl.__
+00063e50: 696e 6974 5f5f 2873 656c 662c 202a 6172  init__(self, *ar
+00063e60: 6773 2c20 2a2a 6b77 6172 6773 290d 0a20  gs, **kwargs).. 
+00063e70: 2020 2020 2020 2073 656c 662e 5365 7455         self.SetU
+00063e80: 6e64 6f43 6f6c 6c65 6374 696f 6e28 4661  ndoCollection(Fa
+00063e90: 6c73 6529 0d0a 0d0a 2020 2020 2020 2020  lse)....        
+00063ea0: 7365 6c66 2e5f 7061 7273 6572 203d 204e  self._parser = N
+00063eb0: 6f6e 6520 2020 2020 2320 4375 7272 656e  one     # Curren
+00063ec0: 7420 736b 7970 6564 6174 612e 4d65 7373  t skypedata.Mess
+00063ed0: 6167 6550 6172 7365 7220 696e 7374 616e  ageParser instan
+00063ee0: 6365 0d0a 2020 2020 2020 2020 7365 6c66  ce..        self
+00063ef0: 2e5f 6368 6174 203d 204e 6f6e 6520 2020  ._chat = None   
+00063f00: 2020 2020 2320 4375 7272 656e 746c 7920      # Currently 
+00063f10: 7368 6f77 6e20 6368 6174 0d0a 2020 2020  shown chat..    
+00063f20: 2020 2020 7365 6c66 2e5f 6462 203d 204e      self._db = N
+00063f30: 6f6e 6520 2020 2020 2020 2020 2320 4461  one         # Da
+00063f40: 7461 6261 7365 2066 6f72 2063 7572 7265  tabase for curre
+00063f50: 6e74 6c79 2073 686f 776e 206d 6573 7361  ntly shown messa
+00063f60: 6765 730d 0a20 2020 2020 2020 2073 656c  ges..        sel
+00063f70: 662e 5f70 6167 6520 3d20 4e6f 6e65 2020  f._page = None  
+00063f80: 2020 2020 2023 2044 6174 6162 6173 6550       # DatabaseP
+00063f90: 6167 652f 4d65 7267 6572 5061 6765 2066  age/MergerPage f
+00063fa0: 6f72 2061 6374 696f 6e20 6361 6c6c 6261  or action callba
+00063fb0: 636b 730d 0a20 2020 2020 2020 2073 656c  cks..        sel
+00063fc0: 662e 5f6d 6573 7361 6765 7320 3d20 4e6f  f._messages = No
+00063fd0: 6e65 2020 2023 204c 6973 7420 6f66 2061  ne   # List of a
+00063fe0: 6c6c 2072 6574 7269 6576 6564 206d 6573  ll retrieved mes
+00063ff0: 7361 6765 730d 0a20 2020 2020 2020 2073  sages..        s
+00064000: 656c 662e 5f6d 6573 7361 6765 735f 6375  elf._messages_cu
+00064010: 7272 656e 7420 3d20 4e6f 6e65 2020 2320  rrent = None  # 
+00064020: 4c69 7374 206f 6620 6375 7272 656e 746c  List of currentl
+00064030: 7920 7368 6f77 6e20 6d65 7373 6167 6573  y shown messages
+00064040: 0d0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
+00064050: 6d65 7373 6167 655f 706f 7369 7469 6f6e  message_position
+00064060: 7320 3d20 636f 6c6c 6563 7469 6f6e 732e  s = collections.
+00064070: 4f72 6465 7265 6444 6963 7428 2920 2320  OrderedDict() # 
+00064080: 7b6d 7367 2069 643a 2028 7374 6172 7420  {msg id: (start 
+00064090: 696e 6465 782c 2065 6e64 2069 6e64 6578  index, end index
+000640a0: 297d 0d0a 2020 2020 2020 2020 7365 6c66  )}..        self
+000640b0: 2e5f 6d65 7373 6167 655f 6d61 7020 3d20  ._message_map = 
+000640c0: 636f 6c6c 6563 7469 6f6e 732e 4f72 6465  collections.Orde
+000640d0: 7265 6444 6963 7428 2920 2320 7b6d 7367  redDict() # {msg
+000640e0: 2049 443a 207b 6d73 677d 7d0d 0a20 2020   ID: {msg}}..   
+000640f0: 2020 2020 2023 2049 6620 7365 742c 2072       # If set, r
+00064100: 616e 6765 2069 7320 6365 6e74 6572 6564  ange is centered
+00064110: 2061 726f 756e 6420 7468 6520 6d65 7373   around the mess
+00064120: 6167 6520 7769 7468 2074 6865 2073 7065  age with the spe
+00064130: 6369 6669 6564 2049 440d 0a20 2020 2020  cified ID..     
+00064140: 2020 2073 656c 662e 5f63 656e 7465 725f     self._center_
+00064150: 6d65 7373 6167 655f 6964 203d 2020 2020  message_id =    
+00064160: 4e6f 6e65 0d0a 2020 2020 2020 2020 2320  None..        # 
+00064170: 496e 6465 7820 6f66 2074 6865 2063 656e  Index of the cen
+00064180: 7465 7265 6420 6d65 7373 6167 6520 696e  tered message in
+00064190: 205f 6d65 7373 6167 6573 0d0a 2020 2020   _messages..    
+000641a0: 2020 2020 7365 6c66 2e5f 6365 6e74 6572      self._center
+000641b0: 5f6d 6573 7361 6765 5f69 6e64 6578 203d  _message_index =
+000641c0: 204e 6f6e 650d 0a20 2020 2020 2020 2073   None..        s
+000641d0: 656c 662e 5f75 726c 6c69 6e6b 7320 203d  elf._urllinks  =
+000641e0: 207b 7d20 2320 7b6c 696e 6b20 7374 6172   {} # {link star
+000641f0: 7420 706f 7369 7469 6f6e 3a20 7572 6c7d  t position: url}
+00064200: 0d0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
+00064210: 6669 6c65 6c69 6e6b 7320 3d20 7b7d 2023  filelinks = {} #
+00064220: 207b 6c69 6e6b 2073 7461 7274 2070 6f73   {link start pos
+00064230: 6974 696f 6e3a 2066 696c 6520 7061 7468  ition: file path
+00064240: 7d0d 0a20 2020 2020 2020 2073 656c 662e  }..        self.
+00064250: 5f64 6174 656c 696e 6b73 203d 207b 7d20  _datelinks = {} 
+00064260: 2320 7b6c 696e 6b20 7374 6172 7420 706f  # {link start po
+00064270: 7369 7469 6f6e 3a20 7477 6f20 6461 7465  sition: two date
+00064280: 732c 207d 0d0a 2020 2020 2020 2020 7365  s, }..        se
+00064290: 6c66 2e5f 6461 7465 6c69 6e6b 5f6c 6173  lf._datelink_las
+000642a0: 7420 3d20 4e6f 6e65 2023 2054 6974 6c65  t = None # Title
+000642b0: 206f 6620 636c 6963 6b65 6420 6461 7465   of clicked date
+000642c0: 206c 696e 6b2c 2069 6620 616e 790d 0a20   link, if any.. 
+000642d0: 2020 2020 2020 2023 2043 7572 7265 6e74         # Current
+000642e0: 6c79 2073 6574 206d 6573 7361 6765 2066  ly set message f
+000642f0: 696c 7465 7220 7b22 6461 7465 7261 6e67  ilter {"daterang
+00064300: 6522 3a20 2864 6174 6574 696d 652c 2064  e": (datetime, d
+00064310: 6174 6574 696d 6529 2c0d 0a20 2020 2020  atetime),..     
+00064320: 2020 2023 2022 7465 7874 223a 2074 6578     # "text": tex
+00064330: 7420 696e 206d 6573 7361 6765 2c20 2270  t in message, "p
+00064340: 6172 7469 6369 7061 6e74 7322 3a20 5b73  articipants": [s
+00064350: 6b79 7065 6e61 6d65 312c 205d 2c0d 0a20  kypename1, ],.. 
+00064360: 2020 2020 2020 2023 2022 6d65 7373 6167         # "messag
+00064370: 655f 6964 223a 206d 6573 7361 6765 2049  e_id": message I
+00064380: 4420 746f 2073 686f 772c 2072 616e 6765  D to show, range
+00064390: 2073 686f 776e 2077 696c 6c20 6265 2063   shown will be c
+000643a0: 656e 7465 7265 640d 0a20 2020 2020 2020  entered..       
+000643b0: 2023 2061 726f 756e 6420 6974 7d0d 0a20   # around it}.. 
+000643c0: 2020 2020 2020 2073 656c 662e 5f66 696c         self._fil
+000643d0: 7465 7220 3d20 7b7d 0d0a 2020 2020 2020  ter = {}..      
+000643e0: 2020 7365 6c66 2e5f 6669 6c74 6572 7465    self._filterte
+000643f0: 7874 5f72 6778 203d 204e 6f6e 6520 2320  xt_rgx = None # 
+00064400: 4361 6368 6564 2072 6567 6578 2066 6f72  Cached regex for
+00064410: 2066 696c 7465 725b 2274 6578 7422 5d0d   filter["text"].
+00064420: 0a20 2020 2020 2020 2073 656c 662e 5f61  .        self._a
+00064430: 7574 6f5f 7265 7472 6965 7665 203d 2054  uto_retrieve = T
+00064440: 7275 6520 2320 5768 6574 6865 7220 6e65  rue # Whether ne
+00064450: 7720 6d65 7373 6167 6573 2072 6574 7269  w messages retri
+00064460: 6576 6564 206f 6e20 7265 6672 6573 680d  eved on refresh.
+00064470: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
+00064480: 5f73 7479 6c65 7320 3d20 7b22 6465 6661  _styles = {"defa
+00064490: 756c 7422 3a20 3130 2c20 2262 6f6c 6422  ult": 10, "bold"
+000644a0: 3a20 3131 2c20 2274 696d 6573 7461 6d70  : 11, "timestamp
+000644b0: 223a 2031 322c 0d0a 2020 2020 2020 2020  ": 12,..        
+000644c0: 2020 2020 2272 656d 6f74 6522 3a20 3133      "remote": 13
+000644d0: 2c20 226c 6f63 616c 223a 2031 342c 2022  , "local": 14, "
+000644e0: 6c69 6e6b 223a 2031 352c 2022 7469 6e79  link": 15, "tiny
+000644f0: 223a 2031 362c 0d0a 2020 2020 2020 2020  ": 16,..        
+00064500: 2020 2020 2273 7065 6369 616c 223a 2031      "special": 1
+00064510: 372c 2022 626f 6c64 6465 6661 756c 7422  7, "bolddefault"
+00064520: 3a20 3138 2c20 2262 6f6c 646c 696e 6b22  : 18, "boldlink"
+00064530: 3a20 3139 2c0d 0a20 2020 2020 2020 2020  : 19,..         
+00064540: 2020 2022 626f 6c64 7370 6563 6961 6c22     "boldspecial"
+00064550: 3a20 3230 2c20 2272 656d 6f74 6577 6561  : 20, "remotewea
+00064560: 6b22 3a20 3231 2c20 226c 6f63 616c 7765  k": 21, "localwe
+00064570: 616b 223a 2032 322c 0d0a 2020 2020 2020  ak": 22,..      
+00064580: 2020 2020 2020 2269 7461 6c69 6322 3a20        "italic": 
+00064590: 3233 2c20 2273 7472 696b 6522 3a20 3234  23, "strike": 24
+000645a0: 0d0a 2020 2020 2020 2020 7d0d 0a20 2020  ..        }..   
+000645b0: 2020 2020 2073 656c 662e 5365 7457 7261       self.SetWra
+000645c0: 704d 6f64 6528 5472 7565 290d 0a20 2020  pMode(True)..   
+000645d0: 2020 2020 2073 656c 662e 5365 744d 6172       self.SetMar
+000645e0: 6769 6e4c 6566 7428 3130 290d 0a20 2020  ginLeft(10)..   
+000645f0: 2020 2020 2073 656c 662e 5365 744d 6172       self.SetMar
+00064600: 6769 6e57 6964 7468 2831 2c20 3029 2023  ginWidth(1, 0) #
+00064610: 2048 6964 6520 6c65 6674 206d 6172 6769   Hide left margi
+00064620: 6e0d 0a20 2020 2020 2020 2073 656c 662e  n..        self.
+00064630: 5365 7452 6561 644f 6e6c 7928 5472 7565  SetReadOnly(True
+00064640: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00064650: 5365 7453 7479 6c65 5370 6563 7328 290d  SetStyleSpecs().
+00064660: 0a20 2020 2020 2020 2073 656c 662e 5f74  .        self._t
+00064670: 6578 7468 6569 6768 745f 7a6f 6f6d 3020  extheight_zoom0 
+00064680: 3d20 7365 6c66 2e5f 7374 632e 5465 7874  = self._stc.Text
+00064690: 4865 6967 6874 2830 290d 0a20 2020 2020  Height(0)..     
+000646a0: 2020 2073 656c 662e 5365 745a 6f6f 6d50     self.SetZoomP
+000646b0: 6572 6365 6e74 2863 6f6e 662e 4869 7374  ercent(conf.Hist
+000646c0: 6f72 795a 6f6f 6d29 0d0a 0d0a 2020 2020  oryZoom)....    
+000646d0: 2020 2020 7365 6c66 2e5f 7374 632e 4269      self._stc.Bi
+000646e0: 6e64 2877 782e 7374 632e 4556 545f 5354  nd(wx.stc.EVT_ST
+000646f0: 435f 484f 5453 504f 545f 434c 4943 4b2c  C_HOTSPOT_CLICK,
+00064700: 2073 656c 662e 4f6e 5572 6c29 0d0a 2020   self.OnUrl)..  
+00064710: 2020 2020 2020 7365 6c66 2e5f 7374 632e        self._stc.
+00064720: 4269 6e64 2877 782e 4556 545f 5249 4748  Bind(wx.EVT_RIGH
+00064730: 545f 5550 2c20 7365 6c66 2e4f 6e4d 656e  T_UP, self.OnMen
+00064740: 7529 0d0a 2020 2020 2020 2020 7365 6c66  u)..        self
+00064750: 2e5f 7374 632e 4269 6e64 2877 782e 4556  ._stc.Bind(wx.EV
+00064760: 545f 434f 4e54 4558 545f 4d45 4e55 2c20  T_CONTEXT_MENU, 
+00064770: 7365 6c66 2e4f 6e4d 656e 7529 0d0a 2020  self.OnMenu)..  
+00064780: 2020 2020 2020 7365 6c66 2e5f 7374 632e        self._stc.
+00064790: 4269 6e64 2877 782e 4556 545f 5359 535f  Bind(wx.EVT_SYS_
+000647a0: 434f 4c4f 5552 5f43 4841 4e47 4544 2c20  COLOUR_CHANGED, 
+000647b0: 7365 6c66 2e4f 6e53 7973 436f 6c6f 7572  self.OnSysColour
+000647c0: 4368 616e 6765 290d 0a20 2020 2020 2020  Change)..       
+000647d0: 2073 656c 662e 5f73 7463 2e42 696e 6428   self._stc.Bind(
+000647e0: 7778 2e73 7463 2e45 5654 5f53 5443 5f5a  wx.stc.EVT_STC_Z
+000647f0: 4f4f 4d2c 2073 656c 662e 4f6e 5a6f 6f6d  OOM, self.OnZoom
+00064800: 290d 0a20 2020 2020 2020 2023 2048 6964  )..        # Hid
+00064810: 6520 6361 7265 740d 0a20 2020 2020 2020  e caret..       
+00064820: 2073 656c 662e 5365 7443 6172 6574 466f   self.SetCaretFo
+00064830: 7265 6772 6f75 6e64 2863 6f6e 662e 4267  reground(conf.Bg
+00064840: 436f 6c6f 7572 292c 2073 656c 662e 5365  Colour), self.Se
+00064850: 7443 6172 6574 5769 6474 6828 3029 0d0a  tCaretWidth(0)..
+00064860: 0d0a 0d0a 2020 2020 6465 6620 5365 7453  ....    def SetS
+00064870: 7479 6c65 5370 6563 7328 7365 6c66 293a  tyleSpecs(self):
+00064880: 0d0a 2020 2020 2020 2020 2222 2253 6574  ..        """Set
+00064890: 7320 5354 4320 7374 796c 6520 636f 6c6f  s STC style colo
+000648a0: 7572 732e 2222 220d 0a20 2020 2020 2020  urs."""..       
+000648b0: 2073 7479 6c65 7370 6563 7320 3d20 7b0d   stylespecs = {.
+000648c0: 0a20 2020 2020 2020 2020 2020 2022 6465  .            "de
+000648d0: 6661 756c 7422 3a20 2020 2020 2022 6661  fault":      "fa
+000648e0: 6365 3a25 732c 7369 7a65 3a25 642c 666f  ce:%s,size:%d,fo
+000648f0: 7265 3a25 732c 6261 636b 3a25 7322 2025  re:%s,back:%s" %
+00064900: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00064910: 2020 2020 2020 2020 2020 2020 2020 2863                (c
+00064920: 6f6e 662e 4869 7374 6f72 7946 6f6e 744e  onf.HistoryFontN
+00064930: 616d 652c 2063 6f6e 662e 4869 7374 6f72  ame, conf.Histor
+00064940: 7946 6f6e 7453 697a 652c 0d0a 2020 2020  yFontSize,..    
+00064950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00064960: 2020 2020 2020 2020 2063 6f6e 662e 4d65           conf.Me
+00064970: 7373 6167 6554 6578 7443 6f6c 6f75 722c  ssageTextColour,
+00064980: 2063 6f6e 662e 4267 436f 6c6f 7572 292c   conf.BgColour),
+00064990: 0d0a 2020 2020 2020 2020 2020 2020 2262  ..            "b
+000649a0: 6f6c 6464 6566 6175 6c74 223a 2022 626f  olddefault": "bo
+000649b0: 6c64 222c 0d0a 2020 2020 2020 2020 2020  ld",..          
+000649c0: 2020 2262 6f6c 6422 3a20 2020 2020 2020    "bold":       
+000649d0: 2022 626f 6c64 222c 0d0a 2020 2020 2020   "bold",..      
+000649e0: 2020 2020 2020 2274 696d 6573 7461 6d70        "timestamp
+000649f0: 223a 2020 2022 666f 7265 3a25 7322 2025  ":   "fore:%s" %
+00064a00: 2063 6f6e 662e 4869 7374 6f72 7954 696d   conf.HistoryTim
+00064a10: 6573 7461 6d70 436f 6c6f 7572 2c0d 0a20  estampColour,.. 
+00064a20: 2020 2020 2020 2020 2020 2022 7265 6d6f             "remo
+00064a30: 7465 223a 2020 2020 2020 2266 6f72 653a  te":      "fore:
+00064a40: 2573 2c62 6f6c 6422 2025 2063 6f6e 662e  %s,bold" % conf.
+00064a50: 4869 7374 6f72 7952 656d 6f74 6541 7574  HistoryRemoteAut
+00064a60: 686f 7243 6f6c 6f75 722c 0d0a 2020 2020  horColour,..    
+00064a70: 2020 2020 2020 2020 226c 6f63 616c 223a          "local":
+00064a80: 2020 2020 2020 2022 666f 7265 3a25 732c         "fore:%s,
+00064a90: 626f 6c64 2220 2520 636f 6e66 2e48 6973  bold" % conf.His
+00064aa0: 746f 7279 4c6f 6361 6c41 7574 686f 7243  toryLocalAuthorC
+00064ab0: 6f6c 6f75 722c 0d0a 2020 2020 2020 2020  olour,..        
+00064ac0: 2020 2020 2272 656d 6f74 6577 6561 6b22      "remoteweak"
+00064ad0: 3a20 2022 666f 7265 3a25 7322 2025 2063  :  "fore:%s" % c
+00064ae0: 6f6e 662e 4869 7374 6f72 7952 656d 6f74  onf.HistoryRemot
+00064af0: 6541 7574 686f 7243 6f6c 6f75 722c 0d0a  eAuthorColour,..
+00064b00: 2020 2020 2020 2020 2020 2020 226c 6f63              "loc
+00064b10: 616c 7765 616b 223a 2020 2022 666f 7265  alweak":   "fore
+00064b20: 3a25 7322 2025 2063 6f6e 662e 4869 7374  :%s" % conf.Hist
+00064b30: 6f72 794c 6f63 616c 4175 7468 6f72 436f  oryLocalAuthorCo
+00064b40: 6c6f 7572 2c0d 0a20 2020 2020 2020 2020  lour,..         
+00064b50: 2020 2022 6c69 6e6b 223a 2020 2020 2020     "link":      
+00064b60: 2020 2266 6f72 653a 2573 2220 2520 636f    "fore:%s" % co
+00064b70: 6e66 2e53 6b79 7065 4c69 6e6b 436f 6c6f  nf.SkypeLinkColo
+00064b80: 7572 2c0d 0a20 2020 2020 2020 2020 2020  ur,..           
+00064b90: 2022 626f 6c64 6c69 6e6b 223a 2020 2020   "boldlink":    
+00064ba0: 2266 6f72 653a 2573 2c62 6f6c 6422 2025  "fore:%s,bold" %
+00064bb0: 2063 6f6e 662e 536b 7970 654c 696e 6b43   conf.SkypeLinkC
+00064bc0: 6f6c 6f75 722c 0d0a 2020 2020 2020 2020  olour,..        
+00064bd0: 2020 2020 2274 696e 7922 3a20 2020 2020      "tiny":     
+00064be0: 2020 2022 7369 7a65 3a31 222c 0d0a 2020     "size:1",..  
+00064bf0: 2020 2020 2020 2020 2020 2273 7065 6369            "speci
+00064c00: 616c 223a 2020 2020 2022 666f 7265 3a25  al":     "fore:%
+00064c10: 7322 2025 2063 6f6e 662e 4869 7374 6f72  s" % conf.Histor
+00064c20: 7947 7265 7943 6f6c 6f75 722c 0d0a 2020  yGreyColour,..  
+00064c30: 2020 2020 2020 2020 2020 2262 6f6c 6473            "bolds
+00064c40: 7065 6369 616c 223a 2022 666f 7265 3a25  pecial": "fore:%
+00064c50: 732c 626f 6c64 2220 2520 636f 6e66 2e48  s,bold" % conf.H
+00064c60: 6973 746f 7279 4772 6579 436f 6c6f 7572  istoryGreyColour
+00064c70: 2c0d 0a20 2020 2020 2020 2020 2020 2022  ,..            "
+00064c80: 6974 616c 6963 223a 2020 2020 2020 2269  italic":      "i
+00064c90: 7461 6c69 6322 2c0d 0a20 2020 2020 2020  talic",..       
+00064ca0: 2020 2020 2022 7374 7269 6b65 223a 2020       "strike":  
+00064cb0: 2020 2020 2275 6e64 6572 6c69 6e65 222c      "underline",
+00064cc0: 0d0a 2020 2020 2020 2020 7d0d 0a20 2020  ..        }..   
+00064cd0: 2020 2020 2073 656c 662e 5374 796c 6553       self.StyleS
+00064ce0: 6574 5370 6563 2877 782e 7374 632e 5354  etSpec(wx.stc.ST
+00064cf0: 435f 5354 594c 455f 4445 4641 554c 542c  C_STYLE_DEFAULT,
+00064d00: 2073 7479 6c65 7370 6563 735b 2264 6566   stylespecs["def
+00064d10: 6175 6c74 225d 290d 0a20 2020 2020 2020  ault"])..       
+00064d20: 2073 656c 662e 5374 796c 6543 6c65 6172   self.StyleClear
+00064d30: 416c 6c28 2920 2320 4170 706c 7920 7468  All() # Apply th
+00064d40: 6520 6e65 7720 6465 6661 756c 7420 7374  e new default st
+00064d50: 796c 6520 746f 2061 6c6c 2073 7479 6c65  yle to all style
+00064d60: 730d 0a20 2020 2020 2020 2066 6f72 2073  s..        for s
+00064d70: 7479 6c65 2c20 7370 6563 2069 6e20 7374  tyle, spec in st
+00064d80: 796c 6573 7065 6373 2e69 7465 6d73 2829  ylespecs.items()
+00064d90: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+00064da0: 656c 662e 5374 796c 6553 6574 5370 6563  elf.StyleSetSpec
+00064db0: 2873 656c 662e 5f73 7479 6c65 735b 7374  (self._styles[st
+00064dc0: 796c 655d 2c20 7370 6563 290d 0a20 2020  yle], spec)..   
+00064dd0: 2020 2020 2073 656c 662e 5374 796c 6553       self.StyleS
+00064de0: 6574 486f 7453 706f 7428 7365 6c66 2e5f  etHotSpot(self._
+00064df0: 7374 796c 6573 5b22 6c69 6e6b 225d 2c20  styles["link"], 
+00064e00: 5472 7565 290d 0a20 2020 2020 2020 2073  True)..        s
+00064e10: 656c 662e 5374 796c 6553 6574 486f 7453  elf.StyleSetHotS
+00064e20: 706f 7428 7365 6c66 2e5f 7374 796c 6573  pot(self._styles
+00064e30: 5b22 626f 6c64 6c69 6e6b 225d 2c20 5472  ["boldlink"], Tr
+00064e40: 7565 290d 0a0d 0a0d 0a20 2020 2064 6566  ue)......    def
+00064e50: 2053 6574 4461 7461 6261 7365 5061 6765   SetDatabasePage
+00064e60: 2873 656c 662c 2070 6167 6529 3a0d 0a20  (self, page):.. 
+00064e70: 2020 2020 2020 2073 656c 662e 5f70 6167         self._pag
+00064e80: 6520 3d20 7061 6765 0d0a 0d0a 0d0a 2020  e = page......  
+00064e90: 2020 6465 6620 4765 745a 6f6f 6d50 6572    def GetZoomPer
+00064ea0: 6365 6e74 2873 656c 6629 3a0d 0a20 2020  cent(self):..   
+00064eb0: 2020 2020 2022 2222 5265 7475 726e 7320       """Returns 
+00064ec0: 6375 7272 656e 7420 7465 7874 207a 6f6f  current text zoo
+00064ed0: 6d20 6c65 7665 6c2c 2061 7320 6672 6163  m level, as frac
+00064ee0: 7469 6f6e 616c 2070 6572 6365 6e74 6167  tional percentag
+00064ef0: 652c 2065 2e67 2e20 312e 3020 6973 2064  e, e.g. 1.0 is d
+00064f00: 6566 6175 6c74 2e22 2222 0d0a 2020 2020  efault."""..    
+00064f10: 2020 2020 7065 7263 656e 7420 3d20 7365      percent = se
+00064f20: 6c66 2e5a 4f4f 4d5f 5045 5243 454e 5453  lf.ZOOM_PERCENTS
+00064f30: 2e67 6574 2873 656c 662e 5f73 7463 2e5a  .get(self._stc.Z
+00064f40: 6f6f 6d29 0d0a 2020 2020 2020 2020 6966  oom)..        if
+00064f50: 2070 6572 6365 6e74 2069 7320 4e6f 6e65   percent is None
+00064f60: 3a0d 0a20 2020 2020 2020 2020 2020 2070  :..            p
+00064f70: 6572 6365 6e74 203d 2066 6c6f 6174 2873  ercent = float(s
+00064f80: 656c 662e 5f73 7463 2e54 6578 7448 6569  elf._stc.TextHei
+00064f90: 6768 7428 3029 2920 2f20 7365 6c66 2e5f  ght(0)) / self._
+00064fa0: 7465 7874 6865 6967 6874 5f7a 6f6f 6d30  textheight_zoom0
+00064fb0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00064fc0: 2070 6572 6365 6e74 0d0a 2020 2020 6465   percent..    de
+00064fd0: 6620 5365 745a 6f6f 6d50 6572 6365 6e74  f SetZoomPercent
+00064fe0: 2873 656c 662c 2076 616c 7565 293a 0d0a  (self, value):..
+00064ff0: 2020 2020 2020 2020 2222 2253 6574 7320          """Sets 
+00065000: 6375 7272 656e 7420 7465 7874 207a 6f6f  current text zoo
+00065010: 6d20 6c65 7665 6c2c 2061 7320 6672 6163  m level, as frac
+00065020: 7469 6f6e 616c 2070 6572 6365 6e74 6167  tional percentag
+00065030: 652c 2065 2e67 2e20 312e 3020 6973 2064  e, e.g. 1.0 is d
+00065040: 6566 6175 6c74 2e22 2222 0d0a 2020 2020  efault."""..    
+00065050: 2020 2020 7661 6c75 6520 3d20 666c 6f61      value = floa
+00065060: 7428 6d61 7828 6d69 6e28 7365 6c66 2e5a  t(max(min(self.Z
+00065070: 4f4f 4d5f 5045 5243 454e 5453 2e76 616c  OOM_PERCENTS.val
+00065080: 7565 7328 2929 2c20 6d69 6e28 7661 6c75  ues()), min(valu
+00065090: 652c 2073 656c 662e 5a4f 4f4d 5f50 4552  e, self.ZOOM_PER
+000650a0: 4345 4e54 5f4d 4158 2929 290d 0a20 2020  CENT_MAX)))..   
+000650b0: 2020 2020 207a 6f6f 6d20 3d20 6e65 7874       zoom = next
+000650c0: 2828 6b20 666f 7220 6b2c 2076 2069 6e20  ((k for k, v in 
+000650d0: 7365 6c66 2e5a 4f4f 4d5f 5045 5243 454e  self.ZOOM_PERCEN
+000650e0: 5453 2e69 7465 6d73 2829 2069 6620 7620  TS.items() if v 
+000650f0: 3d3d 2076 616c 7565 292c 204e 6f6e 6529  == value), None)
+00065100: 0d0a 2020 2020 2020 2020 6966 207a 6f6f  ..        if zoo
+00065110: 6d20 6973 204e 6f6e 6520 616e 6420 7661  m is None and va
+00065120: 6c75 6520 3c20 313a 0d0a 2020 2020 2020  lue < 1:..      
+00065130: 2020 2020 2020 7a6f 6f6d 203d 2069 6e74        zoom = int
+00065140: 2831 3020 2a20 7661 6c75 6529 202d 2031  (10 * value) - 1
+00065150: 3020 2023 2030 2e36 3235 2074 6f20 2d34  0  # 0.625 to -4
+00065160: 0d0a 2020 2020 2020 2020 656c 6966 207a  ..        elif z
+00065170: 6f6f 6d20 6973 204e 6f6e 653a 0d0a 2020  oom is None:..  
+00065180: 2020 2020 2020 2020 2020 7a6f 6f6d 203d            zoom =
+00065190: 2069 6e74 2831 3020 2a20 2876 616c 7565   int(10 * (value
+000651a0: 202d 2031 2929 2023 2032 2e31 3235 2074   - 1)) # 2.125 t
+000651b0: 6f20 3131 0d0a 2020 2020 2020 2020 7365  o 11..        se
+000651c0: 6c66 2e5f 7374 632e 5a6f 6f6d 203d 207a  lf._stc.Zoom = z
+000651d0: 6f6f 6d0d 0a20 2020 2020 2020 2063 6f6e  oom..        con
+000651e0: 662e 4869 7374 6f72 795a 6f6f 6d20 3d20  f.HistoryZoom = 
+000651f0: 7661 6c75 650d 0a20 2020 205a 6f6f 6d50  value..    ZoomP
+00065200: 6572 6365 6e74 203d 2070 726f 7065 7274  ercent = propert
+00065210: 7928 4765 745a 6f6f 6d50 6572 6365 6e74  y(GetZoomPercent
+00065220: 2c20 5365 745a 6f6f 6d50 6572 6365 6e74  , SetZoomPercent
+00065230: 2c20 646f 633d 0d0a 2020 2020 2222 2243  , doc=..    """C
+00065240: 7572 7265 6e74 2074 6578 7420 7a6f 6f6d  urrent text zoom
+00065250: 206c 6576 656c 2c20 6173 2066 7261 6374   level, as fract
+00065260: 696f 6e61 6c20 7065 7263 656e 7461 6765  ional percentage
+00065270: 2c20 6465 6661 756c 7473 2074 6f20 312e  , defaults to 1.
+00065280: 3020 2831 3030 2529 2e22 2222 290d 0a0d  0 (100%).""")...
+00065290: 0a0d 0a20 2020 2064 6566 2047 6574 5572  ...    def GetUr
+000652a0: 6c41 7450 6f73 6974 696f 6e28 7365 6c66  lAtPosition(self
+000652b0: 2c20 706f 7329 3a0d 0a20 2020 2020 2020  , pos):..       
+000652c0: 2022 2222 2247 6f20 6261 636b 2061 6e64   """"Go back and
+000652d0: 2066 6f72 7468 2066 726f 6d20 5354 4320   forth from STC 
+000652e0: 706f 7369 7469 6f6e 2c20 7265 7475 726e  position, return
+000652f0: 2055 524c 2061 6e64 2053 5443 2072 616e   URL and STC ran
+00065300: 6765 2e22 2222 0d0a 2020 2020 2020 2020  ge."""..        
+00065310: 7572 6c5f 7261 6e67 6520 3d20 7b2d 313a  url_range = {-1:
+00065320: 202d 312c 2031 3a20 2d31 7d20 2320 7b20   -1, 1: -1} # { 
+00065330: 7374 6172 7420 616e 6420 656e 6420 706f  start and end po
+00065340: 7369 7469 6f6e 7320 7d0d 0a20 2020 2020  sitions }..     
+00065350: 2020 2073 7479 6c65 735f 6c69 6e6b 203d     styles_link =
+00065360: 205b 7365 6c66 2e5f 7374 796c 6573 5b22   [self._styles["
+00065370: 6c69 6e6b 225d 2c20 7365 6c66 2e5f 7374  link"], self._st
+00065380: 796c 6573 5b22 626f 6c64 6c69 6e6b 225d  yles["boldlink"]
+00065390: 5d0d 0a20 2020 2020 2020 2066 6f72 2073  ]..        for s
+000653a0: 7465 7020 696e 2075 726c 5f72 616e 6765  tep in url_range
+000653b0: 3a0d 0a20 2020 2020 2020 2020 2020 2077  :..            w
+000653c0: 6869 6c65 2073 656c 662e 5f73 7463 2e47  hile self._stc.G
+000653d0: 6574 5374 796c 6541 7428 706f 7320 2b20  etStyleAt(pos + 
+000653e0: 7374 6570 2920 696e 2073 7479 6c65 735f  step) in styles_
+000653f0: 6c69 6e6b 3a0d 0a20 2020 2020 2020 2020  link:..         
+00065400: 2020 2020 2020 2070 6f73 202b 3d20 7374         pos += st
+00065410: 6570 0d0a 2020 2020 2020 2020 2020 2020  ep..            
+00065420: 7572 6c5f 7261 6e67 655b 7374 6570 5d20  url_range[step] 
+00065430: 3d20 706f 730d 0a20 2020 2020 2020 2075  = pos..        u
+00065440: 726c 5f72 616e 6765 5b31 5d20 2b3d 2031  rl_range[1] += 1
+00065450: 0d0a 2020 2020 2020 2020 7374 6172 7473  ..        starts
+00065460: 746f 7020 3d20 7572 6c5f 7261 6e67 655b  top = url_range[
+00065470: 2d31 5d2c 2075 726c 5f72 616e 6765 5b31  -1], url_range[1
+00065480: 5d0d 0a20 2020 2020 2020 2072 6574 7572  ]..        retur
+00065490: 6e20 7365 6c66 2e5f 7374 632e 4765 7454  n self._stc.GetT
+000654a0: 6578 7452 616e 6765 282a 7374 6172 7473  extRange(*starts
+000654b0: 746f 7029 2c20 7374 6172 7473 746f 700d  top), startstop.
+000654c0: 0a0d 0a0d 0a20 2020 2064 6566 204d 616b  .....    def Mak
+000654d0: 655a 6f6f 6d4d 656e 7528 7365 6c66 293a  eZoomMenu(self):
+000654e0: 0d0a 2020 2020 2020 2020 2222 2252 6574  ..        """Ret
+000654f0: 7572 6e73 2077 782e 4d65 6e75 2070 6f70  urns wx.Menu pop
+00065500: 756c 6174 6564 2077 6974 6820 7465 7874  ulated with text
+00065510: 207a 6f6f 6d20 6368 616e 6765 206f 7074   zoom change opt
+00065520: 696f 6e73 2e22 2222 0d0a 2020 2020 2020  ions."""..      
+00065530: 2020 6465 6620 6f6e 5f74 6578 7473 697a    def on_textsiz
+00065540: 6528 6469 7265 6374 696f 6e3d 4e6f 6e65  e(direction=None
+00065550: 2c20 6c65 7665 6c3d 4e6f 6e65 293a 0d0a  , level=None):..
+00065560: 2020 2020 2020 2020 2020 2020 6465 6620              def 
+00065570: 646f 5f74 6578 7473 697a 6528 6576 656e  do_textsize(even
+00065580: 7429 3a0d 0a20 2020 2020 2020 2020 2020  t):..           
+00065590: 2020 2020 2069 6620 6c65 7665 6c20 6973       if level is
+000655a0: 206e 6f74 204e 6f6e 653a 2073 656c 662e   not None: self.
+000655b0: 5a6f 6f6d 5065 7263 656e 7420 3d20 6c65  ZoomPercent = le
+000655c0: 7665 6c0d 0a20 2020 2020 2020 2020 2020  vel..           
+000655d0: 2020 2020 2065 6c73 653a 2073 656c 662e       else: self.
+000655e0: 5f73 7463 2e5a 6f6f 6d20 3d20 2873 656c  _stc.Zoom = (sel
+000655f0: 662e 5f73 7463 2e5a 6f6f 6d20 2b20 6469  f._stc.Zoom + di
+00065600: 7265 6374 696f 6e29 2069 6620 6469 7265  rection) if dire
+00065610: 6374 696f 6e20 656c 7365 2030 0d0a 2020  ction else 0..  
+00065620: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00065630: 2064 6f5f 7465 7874 7369 7a65 0d0a 0d0a   do_textsize....
+00065640: 2020 2020 2020 2020 6d65 6e75 203d 2077          menu = w
+00065650: 782e 4d65 6e75 2829 0d0a 2020 2020 2020  x.Menu()..      
+00065660: 2020 6974 656d 5f6c 6172 6765 7220 203d    item_larger  =
+00065670: 2077 782e 4d65 6e75 4974 656d 286d 656e   wx.MenuItem(men
+00065680: 752c 202d 312c 2075 2226 4c61 7267 6572  u, -1, u"&Larger
+00065690: 5c74 5c75 4646 3042 2229 2020 2320 4675  \t\uFF0B")  # Fu
+000656a0: 6c6c 2077 6964 7468 2070 6c75 730d 0a20  ll width plus.. 
+000656b0: 2020 2020 2020 2069 7465 6d5f 736d 616c         item_smal
+000656c0: 6c65 7220 3d20 7778 2e4d 656e 7549 7465  ler = wx.MenuIte
+000656d0: 6d28 6d65 6e75 2c20 2d31 2c20 7522 2653  m(menu, -1, u"&S
+000656e0: 6d61 6c6c 6572 5c74 5c75 4646 3044 2229  maller\t\uFF0D")
+000656f0: 2023 2046 756c 6c20 7769 6474 6820 6d69   # Full width mi
+00065700: 6e75 730d 0a20 2020 2020 2020 2069 7465  nus..        ite
+00065710: 6d5f 7265 7365 7420 2020 3d20 7778 2e4d  m_reset   = wx.M
+00065720: 656e 7549 7465 6d28 6d65 6e75 2c20 2d31  enuItem(menu, -1
+00065730: 2c20 2226 5265 7365 7422 290d 0a20 2020  , "&Reset")..   
+00065740: 2020 2020 206d 656e 752e 4170 7065 6e64       menu.Append
+00065750: 2869 7465 6d5f 6c61 7267 6572 290d 0a20  (item_larger).. 
+00065760: 2020 2020 2020 206d 656e 752e 4170 7065         menu.Appe
+00065770: 6e64 2869 7465 6d5f 736d 616c 6c65 7229  nd(item_smaller)
+00065780: 0d0a 2020 2020 2020 2020 6d65 6e75 2e41  ..        menu.A
+00065790: 7070 656e 6428 6974 656d 5f72 6573 6574  ppend(item_reset
+000657a0: 290d 0a20 2020 2020 2020 206d 656e 752e  )..        menu.
+000657b0: 4170 7065 6e64 5365 7061 7261 746f 7228  AppendSeparator(
+000657c0: 290d 0a20 2020 2020 2020 2063 7572 6c65  )..        curle
+000657d0: 7665 6c20 3d20 7365 6c66 2e5a 6f6f 6d50  vel = self.ZoomP
+000657e0: 6572 6365 6e74 0d0a 2020 2020 2020 2020  ercent..        
+000657f0: 666f 7220 6c65 7665 6c20 696e 2073 6f72  for level in sor
+00065800: 7465 6428 7365 7428 7365 6c66 2e5a 4f4f  ted(set(self.ZOO
+00065810: 4d5f 5045 5243 454e 5453 2e76 616c 7565  M_PERCENTS.value
+00065820: 7328 2929 207c 207b 6375 726c 6576 656c  s()) | {curlevel
+00065830: 7d29 3a0d 0a20 2020 2020 2020 2020 2020  }):..           
+00065840: 2074 6578 7420 3d20 7574 696c 2e72 6f75   text = util.rou
+00065850: 6e64 5f66 6c6f 6174 286c 6576 656c 202a  nd_float(level *
+00065860: 2031 3030 2c20 3429 202b 2022 2522 0d0a   100, 4) + "%"..
+00065870: 2020 2020 2020 2020 2020 2020 6974 656d              item
+00065880: 203d 2077 782e 4d65 6e75 4974 656d 286d   = wx.MenuItem(m
+00065890: 656e 752c 202d 312c 2074 6578 742c 206b  enu, -1, text, k
+000658a0: 696e 643d 7778 2e49 5445 4d5f 4348 4543  ind=wx.ITEM_CHEC
+000658b0: 4b29 0d0a 2020 2020 2020 2020 2020 2020  K)..            
+000658c0: 6d65 6e75 2e41 7070 656e 6428 6974 656d  menu.Append(item
+000658d0: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
+000658e0: 6620 6c65 7665 6c20 3d3d 2063 7572 6c65  f level == curle
+000658f0: 7665 6c3a 2069 7465 6d2e 4368 6563 6b28  vel: item.Check(
+00065900: 290d 0a20 2020 2020 2020 2020 2020 206d  )..            m
+00065910: 656e 752e 4269 6e64 2877 782e 4556 545f  enu.Bind(wx.EVT_
+00065920: 4d45 4e55 2c20 6f6e 5f74 6578 7473 697a  MENU, on_textsiz
+00065930: 6528 6c65 7665 6c3d 6c65 7665 6c29 2c20  e(level=level), 
+00065940: 6964 3d69 7465 6d2e 4765 7449 6428 2929  id=item.GetId())
+00065950: 0d0a 2020 2020 2020 2020 6974 656d 5f73  ..        item_s
+00065960: 6d61 6c6c 6572 2e45 6e61 626c 6564 203d  maller.Enabled =
+00065970: 2028 6375 726c 6576 656c 203e 206d 696e   (curlevel > min
+00065980: 2873 656c 662e 5a4f 4f4d 5f50 4552 4345  (self.ZOOM_PERCE
+00065990: 4e54 532e 7661 6c75 6573 2829 2929 0d0a  NTS.values()))..
+000659a0: 2020 2020 2020 2020 6974 656d 5f6c 6172          item_lar
+000659b0: 6765 7220 2e45 6e61 626c 6564 203d 2028  ger .Enabled = (
+000659c0: 6375 726c 6576 656c 203c 2073 656c 662e  curlevel < self.
+000659d0: 5a4f 4f4d 5f50 4552 4345 4e54 5f4d 4158  ZOOM_PERCENT_MAX
+000659e0: 290d 0a20 2020 2020 2020 206d 656e 752e  )..        menu.
+000659f0: 4269 6e64 2877 782e 4556 545f 4d45 4e55  Bind(wx.EVT_MENU
+00065a00: 2c20 6f6e 5f74 6578 7473 697a 6528 2b31  , on_textsize(+1
+00065a10: 292c 2020 2020 2020 2020 2020 6964 3d69  ),          id=i
+00065a20: 7465 6d5f 6c61 7267 6572 2e47 6574 4964  tem_larger.GetId
+00065a30: 2829 290d 0a20 2020 2020 2020 206d 656e  ())..        men
+00065a40: 752e 4269 6e64 2877 782e 4556 545f 4d45  u.Bind(wx.EVT_ME
+00065a50: 4e55 2c20 6f6e 5f74 6578 7473 697a 6528  NU, on_textsize(
+00065a60: 2d31 292c 2020 2020 2020 2020 2020 6964  -1),          id
+00065a70: 3d69 7465 6d5f 736d 616c 6c65 722e 4765  =item_smaller.Ge
+00065a80: 7449 6428 2929 0d0a 2020 2020 2020 2020  tId())..        
+00065a90: 6d65 6e75 2e42 696e 6428 7778 2e45 5654  menu.Bind(wx.EVT
+00065aa0: 5f4d 454e 552c 206f 6e5f 7465 7874 7369  _MENU, on_textsi
+00065ab0: 7a65 2829 2c20 2020 2020 2020 2020 2020  ze(),           
+00065ac0: 2069 643d 6974 656d 5f72 6573 6574 2e47   id=item_reset.G
+00065ad0: 6574 4964 2829 290d 0a20 2020 2020 2020  etId())..       
+00065ae0: 2072 6574 7572 6e20 6d65 6e75 0d0a 0d0a   return menu....
+00065af0: 0d0a 2020 2020 6465 6620 4f6e 5a6f 6f6d  ..    def OnZoom
+00065b00: 2873 656c 662c 2065 7665 6e74 293a 0d0a  (self, event):..
+00065b10: 2020 2020 2020 2020 2222 2248 616e 646c          """Handl
+00065b20: 6572 2066 6f72 2063 6861 6e67 696e 6720  er for changing 
+00065b30: 7a6f 6f6d 206c 6576 656c 2076 6961 2063  zoom level via c
+00065b40: 7472 6c2b 7768 6565 6c2c 2073 6176 6573  trl+wheel, saves
+00065b50: 2063 6f6e 6669 672e 2222 220d 0a20 2020   config."""..   
+00065b60: 2020 2020 2063 6f6e 662e 4869 7374 6f72       conf.Histor
+00065b70: 795a 6f6f 6d20 3d20 7365 6c66 2e5a 6f6f  yZoom = self.Zoo
+00065b80: 6d50 6572 6365 6e74 0d0a 0d0a 0d0a 2020  mPercent......  
+00065b90: 2020 6465 6620 4f6e 5379 7343 6f6c 6f75    def OnSysColou
+00065ba0: 7243 6861 6e67 6528 7365 6c66 2c20 6576  rChange(self, ev
+00065bb0: 656e 7429 3a0d 0a20 2020 2020 2020 2022  ent):..        "
+00065bc0: 2222 4861 6e64 6c65 7220 666f 7220 7379  ""Handler for sy
+00065bd0: 7374 656d 2063 6f6c 6f75 7220 6368 616e  stem colour chan
+00065be0: 6765 2c20 7570 6461 7465 7320 5354 4320  ge, updates STC 
+00065bf0: 7374 796c 696e 672e 2222 220d 0a20 2020  styling."""..   
+00065c00: 2020 2020 2065 7665 6e74 2e53 6b69 7028       event.Skip(
+00065c10: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00065c20: 5365 7453 7479 6c65 5370 6563 7328 290d  SetStyleSpecs().
+00065c30: 0a0d 0a0d 0a20 2020 2064 6566 204f 6e4d  .....    def OnM
+00065c40: 656e 7528 7365 6c66 2c20 6576 656e 7429  enu(self, event)
+00065c50: 3a0d 0a20 2020 2020 2020 2022 2222 0d0a  :..        """..
+00065c60: 2020 2020 2020 2020 4861 6e64 6c65 7220          Handler 
+00065c70: 666f 7220 7269 6768 742d 636c 6963 6b69  for right-clicki
+00065c80: 6e67 2028 6f72 2070 7265 7373 696e 6720  ng (or pressing 
+00065c90: 6d65 6e75 206b 6579 292c 206f 7065 6e73  menu key), opens
+00065ca0: 2061 2063 7573 746f 6d20 636f 6e74 6578   a custom contex
+00065cb0: 740d 0a20 2020 2020 2020 206d 656e 752e  t..        menu.
+00065cc0: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
+00065cd0: 2020 2020 2020 2064 6566 2063 6c69 7062         def clipb
+00065ce0: 6f61 7264 697a 6528 7465 7874 293a 0d0a  oardize(text):..
+00065cf0: 2020 2020 2020 2020 2020 2020 6966 2077              if w
+00065d00: 782e 5468 6543 6c69 7062 6f61 7264 2e4f  x.TheClipboard.O
+00065d10: 7065 6e28 293a 0d0a 2020 2020 2020 2020  pen():..        
+00065d20: 2020 2020 2020 2020 6420 3d20 7778 2e54          d = wx.T
+00065d30: 6578 7444 6174 614f 626a 6563 7428 7465  extDataObject(te
+00065d40: 7874 290d 0a20 2020 2020 2020 2020 2020  xt)..           
+00065d50: 2020 2020 2077 782e 5468 6543 6c69 7062       wx.TheClipb
+00065d60: 6f61 7264 2e53 6574 4461 7461 2864 292c  oard.SetData(d),
+00065d70: 2077 782e 5468 6543 6c69 7062 6f61 7264   wx.TheClipboard
+00065d80: 2e43 6c6f 7365 2829 0d0a 0d0a 2020 2020  .Close()....    
+00065d90: 2020 2020 6973 5f63 6c69 636b 203d 2069      is_click = i
+00065da0: 7369 6e73 7461 6e63 6528 6576 656e 742c  sinstance(event,
+00065db0: 2077 782e 4d6f 7573 6545 7665 6e74 290d   wx.MouseEvent).
+00065dc0: 0a20 2020 2020 2020 2070 6f73 203d 2073  .        pos = s
+00065dd0: 656c 662e 5f73 7463 2e50 6f73 6974 696f  elf._stc.Positio
+00065de0: 6e46 726f 6d50 6f69 6e74 2865 7665 6e74  nFromPoint(event
+00065df0: 2e50 6f73 6974 696f 6e29 2069 6620 6973  .Position) if is
+00065e00: 5f63 6c69 636b 2065 6c73 6520 2d31 0d0a  _click else -1..
+00065e10: 2020 2020 2020 2020 6d73 675f 6964 203d          msg_id =
+00065e20: 206d 7367 203d 206d 7367 5f69 6478 203d   msg = msg_idx =
+00065e30: 2070 7265 766d 7367 5f69 6420 3d20 4e6f   prevmsg_id = No
+00065e40: 6e65 0d0a 2020 2020 2020 2020 666f 7220  ne..        for 
+00065e50: 692c 206d 5f69 6420 696e 2065 6e75 6d65  i, m_id in enume
+00065e60: 7261 7465 2873 656c 662e 5f6d 6573 7361  rate(self._messa
+00065e70: 6765 5f70 6f73 6974 696f 6e73 2920 6966  ge_positions) if
+00065e80: 2070 6f73 203e 3d20 3020 656c 7365 205b   pos >= 0 else [
+00065e90: 5d3a 0d0a 2020 2020 2020 2020 2020 2020  ]:..            
+00065ea0: 6d5f 706f 7320 3d20 7365 6c66 2e5f 6d65  m_pos = self._me
+00065eb0: 7373 6167 655f 706f 7369 7469 6f6e 735b  ssage_positions[
+00065ec0: 6d5f 6964 5d0d 0a20 2020 2020 2020 2020  m_id]..         
+00065ed0: 2020 2069 6620 6d5f 706f 735b 305d 203c     if m_pos[0] <
+00065ee0: 3d20 706f 7320 3c3d 206d 5f70 6f73 5b31  = pos <= m_pos[1
+00065ef0: 5d3a 0d0a 2020 2020 2020 2020 2020 2020  ]:..            
+00065f00: 2020 2020 6d73 675f 6964 2c20 6d73 675f      msg_id, msg_
+00065f10: 6964 7820 3d20 6d5f 6964 2c20 690d 0a20  idx = m_id, i.. 
+00065f20: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+00065f30: 7265 616b 2023 2066 6f72 2069 2c20 6d5f  reak # for i, m_
+00065f40: 6964 0d0a 2020 2020 2020 2020 2020 2020  id..            
+00065f50: 656c 6966 2069 2061 6e64 2073 656c 662e  elif i and self.
+00065f60: 5f6d 6573 7361 6765 5f70 6f73 6974 696f  _message_positio
+00065f70: 6e73 5b70 7265 766d 7367 5f69 645d 5b31  ns[prevmsg_id][1
+00065f80: 5d20 3c20 706f 7320 5c0d 0a20 2020 2020  ] < pos \..     
+00065f90: 2020 2020 2020 2061 6e64 206d 5f70 6f73         and m_pos
+00065fa0: 5b30 5d20 3e20 706f 733a 0d0a 2020 2020  [0] > pos:..    
+00065fb0: 2020 2020 2020 2020 2020 2020 6d73 675f              msg_
+00065fc0: 6964 2c20 6d73 675f 6964 7820 3d20 7072  id, msg_idx = pr
+00065fd0: 6576 6d73 675f 6964 2c20 6920 2d20 310d  evmsg_id, i - 1.
+00065fe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00065ff0: 2062 7265 616b 2023 2066 6f72 2069 2c20   break # for i, 
+00066000: 6d5f 6964 0d0a 2020 2020 2020 2020 2020  m_id..          
+00066010: 2020 656c 6966 206d 5f70 6f73 5b30 5d20    elif m_pos[0] 
+00066020: 3e20 706f 733a 0d0a 2020 2020 2020 2020  > pos:..        
+00066030: 2020 2020 2020 2020 6272 6561 6b20 2320          break # 
+00066040: 666f 7220 692c 206d 5f69 640d 0a20 2020  for i, m_id..   
+00066050: 2020 2020 2020 2020 2070 7265 766d 7367           prevmsg
+00066060: 5f69 6420 3d20 6d5f 6964 0d0a 2020 2020  _id = m_id..    
+00066070: 2020 2020 6966 206d 7367 5f69 6420 6973      if msg_id is
+00066080: 204e 6f6e 6520 616e 6420 6e6f 7420 6973   None and not is
+00066090: 5f63 6c69 636b 3a0d 0a20 2020 2020 2020  _click:..       
+000660a0: 2020 2020 2023 2043 6f6e 7465 7874 206d       # Context m
+000660b0: 656e 7520 6576 656e 742c 2070 6963 6b20  enu event, pick 
+000660c0: 666f 6375 7365 6420 6f72 2066 6972 7374  focused or first
+000660d0: 2076 6973 6962 6c65 206d 6573 7361 6765   visible message
+000660e0: 0d0a 2020 2020 2020 2020 2020 2020 6d73  ..            ms
+000660f0: 675f 6964 2c20 5f20 3d20 7365 6c66 2e47  g_id, _ = self.G
+00066100: 6574 466f 6375 7365 644d 6573 7361 6765  etFocusedMessage
+00066110: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+00066120: 6966 206d 7367 5f69 6420 6973 206e 6f74  if msg_id is not
+00066130: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+00066140: 2020 2020 2020 2020 6d73 675f 6964 7820          msg_idx 
+00066150: 3d20 6c69 7374 2873 656c 662e 5f6d 6573  = list(self._mes
+00066160: 7361 6765 5f6d 6170 292e 696e 6465 7828  sage_map).index(
+00066170: 6d73 675f 6964 290d 0a20 2020 2020 2020  msg_id)..       
+00066180: 2069 6620 6d73 675f 6964 2069 7320 4e6f   if msg_id is No
+00066190: 6e65 2061 6e64 2073 656c 662e 5f6d 6573  ne and self._mes
+000661a0: 7361 6765 5f70 6f73 6974 696f 6e73 3a0d  sage_positions:.
+000661b0: 0a20 2020 2020 2020 2020 2020 206d 5f69  .            m_i
+000661c0: 6420 3d20 7365 6c66 2e5f 6d65 7373 6167  d = self._messag
+000661d0: 6573 5f63 7572 7265 6e74 5b2d 315d 5b22  es_current[-1]["
+000661e0: 6964 225d 0d0a 2020 2020 2020 2020 2020  id"]..          
+000661f0: 2020 6966 2070 6f73 203e 3d20 3020 616e    if pos >= 0 an
+00066200: 6420 7365 6c66 2e5f 6d65 7373 6167 655f  d self._message_
+00066210: 706f 7369 7469 6f6e 735b 6d5f 6964 5d5b  positions[m_id][
+00066220: 315d 203c 2070 6f73 3a0d 0a20 2020 2020  1] < pos:..     
+00066230: 2020 2020 2020 2020 2020 206d 7367 5f69             msg_i
+00066240: 642c 206d 7367 5f69 6478 203d 206d 5f69  d, msg_idx = m_i
+00066250: 642c 206c 656e 2873 656c 662e 5f6d 6573  d, len(self._mes
+00066260: 7361 6765 735f 6375 7272 656e 7429 202d  sages_current) -
+00066270: 2031 0d0a 2020 2020 2020 2020 6d73 6720   1..        msg 
+00066280: 3d20 7365 6c66 2e5f 6d65 7373 6167 655f  = self._message_
+00066290: 6d61 702e 6765 7428 6d73 675f 6964 290d  map.get(msg_id).
+000662a0: 0a20 2020 2020 2020 206d 656e 7520 3d20  .        menu = 
+000662b0: 7778 2e4d 656e 7528 290d 0a20 2020 2020  wx.Menu()..     
+000662c0: 2020 2069 7465 6d5f 7365 6c65 6374 696f     item_selectio
+000662d0: 6e20 3d20 7778 2e4d 656e 7549 7465 6d28  n = wx.MenuItem(
+000662e0: 6d65 6e75 2c20 2d31 2c20 2226 436f 7079  menu, -1, "&Copy
+000662f0: 2073 656c 6563 7469 6f6e 2229 0d0a 2020   selection")..  
+00066300: 2020 2020 2020 6d65 6e75 2e41 7070 656e        menu.Appen
+00066310: 6428 6974 656d 5f73 656c 6563 7469 6f6e  d(item_selection
+00066320: 290d 0a20 2020 2020 2020 206d 656e 752e  )..        menu.
+00066330: 4269 6e64 2877 782e 4556 545f 4d45 4e55  Bind(wx.EVT_MENU
+00066340: 2c20 6c61 6d62 6461 2065 3a20 636c 6970  , lambda e: clip
+00066350: 626f 6172 6469 7a65 2873 656c 662e 5f73  boardize(self._s
+00066360: 7463 2e53 656c 6563 7465 6454 6578 7429  tc.SelectedText)
+00066370: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00066380: 2020 2020 2069 643d 6974 656d 5f73 656c       id=item_sel
+00066390: 6563 7469 6f6e 2e47 6574 4964 2829 290d  ection.GetId()).
+000663a0: 0a20 2020 2020 2020 2069 7465 6d5f 7365  .        item_se
+000663b0: 6c65 6374 696f 6e2e 456e 6162 6c65 2862  lection.Enable(b
+000663c0: 6f6f 6c28 7365 6c66 2e5f 7374 632e 5365  ool(self._stc.Se
+000663d0: 6c65 6374 6564 5465 7874 2929 0d0a 0d0a  lectedText))....
+000663e0: 2020 2020 2020 2020 7374 796c 6573 5f6c          styles_l
+000663f0: 696e 6b20 3d20 5b73 656c 662e 5f73 7479  ink = [self._sty
+00066400: 6c65 735b 226c 696e 6b22 5d2c 2073 656c  les["link"], sel
+00066410: 662e 5f73 7479 6c65 735b 2262 6f6c 646c  f._styles["boldl
+00066420: 696e 6b22 5d5d 0d0a 2020 2020 2020 2020  ink"]]..        
+00066430: 6966 206d 7367 2061 6e64 2073 656c 662e  if msg and self.
+00066440: 5f73 7463 2e47 6574 5374 796c 6541 7428  _stc.GetStyleAt(
+00066450: 706f 7329 2069 6e20 7374 796c 6573 5f6c  pos) in styles_l
+00066460: 696e 6b3a 0d0a 2020 2020 2020 2020 2020  ink:..          
+00066470: 2020 2320 5269 6768 742d 636c 6963 6b65    # Right-clicke
+00066480: 6420 6120 6c69 6e6b 2069 6e73 6964 6520  d a link inside 
+00066490: 6120 6d65 7373 6167 650d 0a20 2020 2020  a message..     
+000664a0: 2020 2020 2020 2064 6566 206f 6e5f 636f         def on_co
+000664b0: 7079 7572 6c28 6576 656e 7429 3a20 636c  pyurl(event): cl
+000664c0: 6970 626f 6172 6469 7a65 2875 726c 290d  ipboardize(url).
+000664d0: 0a20 2020 2020 2020 2020 2020 2028 7572  .            (ur
+000664e0: 6c2c 2075 726c 7261 6e67 6529 2c20 7572  l, urlrange), ur
+000664f0: 6c74 7970 6520 3d20 7365 6c66 2e47 6574  ltype = self.Get
+00066500: 5572 6c41 7450 6f73 6974 696f 6e28 706f  UrlAtPosition(po
+00066510: 7329 2c20 226c 696e 6b22 0d0a 2020 2020  s), "link"..    
+00066520: 2020 2020 2020 2020 6966 2075 726c 7261          if urlra
+00066530: 6e67 655b 305d 2069 6e20 7365 6c66 2e5f  nge[0] in self._
+00066540: 6669 6c65 6c69 6e6b 733a 0d0a 2020 2020  filelinks:..    
+00066550: 2020 2020 2020 2020 2020 2020 7572 6c2c              url,
+00066560: 2075 726c 7479 7065 203d 2073 656c 662e   urltype = self.
+00066570: 5f66 696c 656c 696e 6b73 5b75 726c 7261  _filelinks[urlra
+00066580: 6e67 655b 305d 5d2c 2022 6669 6c65 220d  nge[0]], "file".
+00066590: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000665a0: 2069 6620 616e 7928 7572 6c2e 7374 6172   if any(url.star
+000665b0: 7473 7769 7468 2878 2920 666f 7220 7820  tswith(x) for x 
+000665c0: 696e 205b 225c 5c5c 5c5c 5c22 2c20 222f  in ["\\\\\\", "/
+000665d0: 2f2f 225d 293a 0d0a 2020 2020 2020 2020  //"]):..        
+000665e0: 2020 2020 2020 2020 2020 2020 7572 6c20              url 
+000665f0: 3d20 7572 6c5b 333a 5d20 2320 5374 7269  = url[3:] # Stri
+00066600: 7020 7265 6475 6e64 616e 7420 6669 6c65  p redundant file
+00066610: 6c69 6e6b 2073 6c61 7368 6573 0d0a 2020  link slashes..  
+00066620: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00066630: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
+00066640: 7572 6c2c 2073 6978 2e74 6578 745f 7479  url, six.text_ty
+00066650: 7065 293a 0d0a 2020 2020 2020 2020 2020  pe):..          
+00066660: 2020 2020 2020 2020 2020 7572 6c20 3d20            url = 
+00066670: 7574 696c 2e74 6f5f 756e 6963 6f64 6528  util.to_unicode(
+00066680: 7572 6c2c 2022 7574 662d 3822 2c20 6572  url, "utf-8", er
+00066690: 726f 7273 3d22 7265 706c 6163 6522 290d  rors="replace").
+000666a0: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
+000666b0: 6620 7572 6c72 616e 6765 5b30 5d20 696e  f urlrange[0] in
+000666c0: 2073 656c 662e 5f75 726c 6c69 6e6b 733a   self._urllinks:
+000666d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000666e0: 2020 7572 6c20 3d20 7365 6c66 2e5f 7572    url = self._ur
+000666f0: 6c6c 696e 6b73 5b75 726c 7261 6e67 655b  llinks[urlrange[
+00066700: 305d 5d0d 0a20 2020 2020 2020 2020 2020  0]]..           
+00066710: 2069 7465 6d5f 6c69 6e6b 203d 2077 782e   item_link = wx.
+00066720: 4d65 6e75 4974 656d 286d 656e 752c 202d  MenuItem(menu, -
+00066730: 312c 2022 4326 6f70 7920 2573 206c 6f63  1, "C&opy %s loc
+00066740: 6174 696f 6e22 2025 2075 726c 7479 7065  ation" % urltype
+00066750: 290d 0a20 2020 2020 2020 2020 2020 206d  )..            m
+00066760: 656e 752e 4170 7065 6e64 2869 7465 6d5f  enu.Append(item_
+00066770: 6c69 6e6b 290d 0a20 2020 2020 2020 2020  link)..         
+00066780: 2020 206d 656e 752e 4269 6e64 2877 782e     menu.Bind(wx.
+00066790: 4556 545f 4d45 4e55 2c20 6f6e 5f63 6f70  EVT_MENU, on_cop
+000667a0: 7975 726c 2c20 6964 3d69 7465 6d5f 6c69  yurl, id=item_li
+000667b0: 6e6b 2e47 6574 4964 2829 290d 0a20 2020  nk.GetId())..   
+000667c0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+000667d0: 2020 2020 2020 2020 6f70 7473 203d 2064          opts = d
+000667e0: 6963 7428 6375 7272 656e 743d 6d73 675f  ict(current=msg_
+000667f0: 6964 782c 2061 7574 686f 723d 286d 7367  idx, author=(msg
+00066800: 206f 7220 7b7d 292e 6765 7428 2261 7574   or {}).get("aut
+00066810: 686f 7222 2929 0d0a 2020 2020 2020 2020  hor"))..        
+00066820: 2020 2020 6465 6620 6f6e 5f63 6f70 796d      def on_copym
+00066830: 7367 2865 7665 6e74 293a 0d0a 2020 2020  sg(event):..    
+00066840: 2020 2020 2020 2020 2020 2020 7420 3d20              t = 
+00066850: 7374 6570 2e54 656d 706c 6174 6528 7465  step.Template(te
+00066860: 6d70 6c61 7465 732e 4d45 5353 4147 455f  mplates.MESSAGE_
+00066870: 434c 4950 424f 4152 4429 0d0a 2020 2020  CLIPBOARD)..    
+00066880: 2020 2020 2020 2020 2020 2020 636c 6970              clip
+00066890: 626f 6172 6469 7a65 2874 2e65 7870 616e  boardize(t.expan
+000668a0: 6428 7b22 6d22 3a20 6d73 672c 2022 7061  d({"m": msg, "pa
+000668b0: 7273 6572 223a 2073 656c 662e 5f70 6172  rser": self._par
+000668c0: 7365 727d 2929 0d0a 2020 2020 2020 2020  ser}))..        
+000668d0: 2020 2020 2020 2020 6775 6962 6173 652e          guibase.
+000668e0: 7374 6174 7573 2822 436f 7069 6564 206d  status("Copied m
+000668f0: 6573 7361 6765 2023 2573 2074 6f20 636c  essage #%s to cl
+00066900: 6970 626f 6172 642e 2220 2520 6d73 675b  ipboard." % msg[
+00066910: 2269 6422 5d29 0d0a 2020 2020 2020 2020  "id"])..        
+00066920: 2020 2020 6465 6620 6f6e 5f73 656c 6563      def on_selec
+00066930: 7461 6c6c 2865 7665 6e74 293a 2073 656c  tall(event): sel
+00066940: 662e 5f73 7463 2e53 656c 6563 7441 6c6c  f._stc.SelectAll
+00066950: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+00066960: 6465 6620 6f6e 5f73 6561 7263 6828 6576  def on_search(ev
+00066970: 656e 7429 3a0d 0a20 2020 2020 2020 2020  ent):..         
+00066980: 2020 2020 2020 2073 656c 662e 5365 7453         self.SetS
+00066990: 6561 7263 6842 6172 5669 7369 626c 6528  earchBarVisible(
+000669a0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+000669b0: 2020 2073 656c 662e 5f65 6469 742e 5365     self._edit.Se
+000669c0: 7446 6f63 7573 2829 0d0a 2020 2020 2020  tFocus()..      
+000669d0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+000669e0: 6564 6974 2e53 656c 6563 7441 6c6c 2829  edit.SelectAll()
+000669f0: 0d0a 2020 2020 2020 2020 2020 2020 6465  ..            de
+00066a00: 6620 6f6e 5f66 696c 7465 725f 6461 7465  f on_filter_date
+00066a10: 2870 6572 696f 6429 3a0d 0a20 2020 2020  (period):..     
+00066a20: 2020 2020 2020 2020 2020 2064 6566 2064             def d
+00066a30: 6f5f 6669 6c74 6572 2865 7665 6e74 293a  o_filter(event):
+00066a40: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00066a50: 2020 2020 2020 6474 203d 206d 7367 5b22        dt = msg["
+00066a60: 6461 7465 7469 6d65 225d 2e64 6174 6528  datetime"].date(
+00066a70: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00066a80: 2020 2020 2020 2069 6620 2020 2264 6179         if   "day
+00066a90: 2220 2020 3d3d 2070 6572 696f 643a 2064  "   == period: d
+00066aa0: 6174 6572 616e 6765 203d 205b 6474 2c20  aterange = [dt, 
+00066ab0: 6474 5d0d 0a20 2020 2020 2020 2020 2020  dt]..           
+00066ac0: 2020 2020 2020 2020 2065 6c69 6620 2277           elif "w
+00066ad0: 6565 6b22 2020 3d3d 2070 6572 696f 643a  eek"  == period:
+00066ae0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00066af0: 2020 2020 2020 2020 2020 6461 7465 7261            datera
+00066b00: 6e67 6520 3d20 5b64 7420 2d20 6461 7465  nge = [dt - date
+00066b10: 7469 6d65 2e74 696d 6564 656c 7461 2864  time.timedelta(d
+00066b20: 6179 733d 6474 2e77 6565 6b64 6179 2829  ays=dt.weekday()
+00066b30: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
+00066b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00066b50: 2020 2020 2020 2020 2064 7420 2b20 6461           dt + da
+00066b60: 7465 7469 6d65 2e74 696d 6564 656c 7461  tetime.timedelta
+00066b70: 2864 6179 733d 362d 6474 2e77 6565 6b64  (days=6-dt.weekd
+00066b80: 6179 2829 295d 0d0a 2020 2020 2020 2020  ay())]..        
+00066b90: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+00066ba0: 2022 6d6f 6e74 6822 203d 3d20 7065 7269   "month" == peri
+00066bb0: 6f64 3a0d 0a20 2020 2020 2020 2020 2020  od:..           
+00066bc0: 2020 2020 2020 2020 2020 2020 206d 6178               max
+00066bd0: 6420 3d20 6361 6c65 6e64 6172 2e6d 6f6e  d = calendar.mon
+00066be0: 7468 7261 6e67 6528 6474 2e79 6561 722c  thrange(dt.year,
+00066bf0: 2064 742e 6d6f 6e74 6829 5b31 5d0d 0a20   dt.month)[1].. 
+00066c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00066c10: 2020 2020 2020 2064 6174 6572 616e 6765         daterange
+00066c20: 203d 205b 6461 7465 7469 6d65 2e64 6174   = [datetime.dat
+00066c30: 6528 6474 2e79 6561 722c 2064 742e 6d6f  e(dt.year, dt.mo
+00066c40: 6e74 682c 2031 292c 0d0a 2020 2020 2020  nth, 1),..      
+00066c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00066c60: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00066c70: 6174 6574 696d 652e 6461 7465 2864 742e  atetime.date(dt.
+00066c80: 7965 6172 2c20 6474 2e6d 6f6e 7468 2c20  year, dt.month, 
+00066c90: 6d61 7864 295d 0d0a 2020 2020 2020 2020  maxd)]..        
+00066ca0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+00066cb0: 2022 7965 6172 2220 203d 3d20 7065 7269   "year"  == peri
+00066cc0: 6f64 3a0d 0a20 2020 2020 2020 2020 2020  od:..           
+00066cd0: 2020 2020 2020 2020 2020 2020 2064 6174               dat
+00066ce0: 6572 616e 6765 203d 205b 6461 7465 7469  erange = [dateti
+00066cf0: 6d65 2e64 6174 6528 6474 2e79 6561 722c  me.date(dt.year,
+00066d00: 2020 312c 2020 3129 2c0d 0a20 2020 2020    1,  1),..     
+00066d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00066d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00066d30: 6461 7465 7469 6d65 2e64 6174 6528 6474  datetime.date(dt
+00066d40: 2e79 6561 722c 2031 322c 2033 3129 5d0d  .year, 12, 31)].
+00066d50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00066d60: 2020 2020 2073 656c 662e 4170 706c 7946       self.ApplyF
+00066d70: 696c 7465 7228 6461 7465 7261 6e67 653d  ilter(daterange=
+00066d80: 6461 7465 7261 6e67 652c 2074 6578 743d  daterange, text=
+00066d90: 2222 290d 0a20 2020 2020 2020 2020 2020  "")..           
+00066da0: 2020 2020 2072 6574 7572 6e20 646f 5f66       return do_f
+00066db0: 696c 7465 720d 0a20 2020 2020 2020 2020  ilter..         
+00066dc0: 2020 2064 6566 206f 6e5f 676f 746f 6175     def on_gotoau
+00066dd0: 7468 6f72 2864 6972 6563 7469 6f6e 293a  thor(direction):
+00066de0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00066df0: 2020 7265 7475 726e 206c 616d 6264 6120    return lambda 
+00066e00: 653a 2073 656c 662e 4e65 7874 4672 6f6d  e: self.NextFrom
+00066e10: 4175 7468 6f72 2864 6972 6563 7469 6f6e  Author(direction
+00066e20: 3d64 6972 6563 7469 6f6e 2c20 2a2a 6f70  =direction, **op
+00066e30: 7473 290d 0a20 2020 2020 2020 2020 2020  ts)..           
+00066e40: 2064 6566 206f 6e5f 676f 746f 7469 6d65   def on_gototime
+00066e50: 2875 6e69 742c 2064 6972 6563 7469 6f6e  (unit, direction
+00066e60: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00066e70: 2020 2020 7265 7475 726e 206c 616d 6264      return lambd
+00066e80: 6120 653a 2073 656c 662e 4e65 7874 5469  a e: self.NextTi
+00066e90: 6d65 2875 6e69 742c 206d 7367 5f69 6478  me(unit, msg_idx
+00066ea0: 2c20 6469 7265 6374 696f 6e29 0d0a 0d0a  , direction)....
+00066eb0: 2020 2020 2020 2020 2020 2020 6974 656d              item
+00066ec0: 5f6d 7367 203d 2077 782e 4d65 6e75 4974  _msg = wx.MenuIt
+00066ed0: 656d 286d 656e 752c 202d 312c 2022 436f  em(menu, -1, "Co
+00066ee0: 7079 2026 6d65 7373 6167 6522 290d 0a20  py &message").. 
+00066ef0: 2020 2020 2020 2020 2020 2069 7465 6d5f             item_
+00066f00: 7365 6c65 6374 203d 2077 782e 4d65 6e75  select = wx.Menu
+00066f10: 4974 656d 286d 656e 752c 202d 312c 2022  Item(menu, -1, "
+00066f20: 5365 6c65 6374 2026 616c 6c22 290d 0a20  Select &all").. 
+00066f30: 2020 2020 2020 2020 2020 206d 656e 752e             menu.
+00066f40: 4170 7065 6e64 2869 7465 6d5f 6d73 6729  Append(item_msg)
+00066f50: 0d0a 2020 2020 2020 2020 2020 2020 6d65  ..            me
+00066f60: 6e75 2e41 7070 656e 6428 6974 656d 5f73  nu.Append(item_s
+00066f70: 656c 6563 7429 0d0a 2020 2020 2020 2020  elect)..        
+00066f80: 2020 2020 6974 656d 5f73 697a 6520 3d20      item_size = 
+00066f90: 6d65 6e75 2e41 7070 656e 6453 7562 4d65  menu.AppendSubMe
+00066fa0: 6e75 2873 656c 662e 4d61 6b65 5a6f 6f6d  nu(self.MakeZoom
+00066fb0: 4d65 6e75 2829 2c20 2226 5465 7874 2073  Menu(), "&Text s
+00066fc0: 697a 6522 290d 0a20 2020 2020 2020 2020  ize")..         
+00066fd0: 2020 206d 656e 752e 4170 7065 6e64 5365     menu.AppendSe
+00066fe0: 7061 7261 746f 7228 290d 0a0d 0a20 2020  parator()....   
+00066ff0: 2020 2020 2020 2020 2069 7465 6d5f 7365           item_se
+00067000: 6172 6368 203d 2077 782e 4d65 6e75 4974  arch = wx.MenuIt
+00067010: 656d 286d 656e 752c 202d 312c 2022 2653  em(menu, -1, "&S
+00067020: 6561 7263 682e 2e22 290d 0a20 2020 2020  earch..")..     
+00067030: 2020 2020 2020 206d 656e 752e 4170 7065         menu.Appe
+00067040: 6e64 2869 7465 6d5f 7365 6172 6368 290d  nd(item_search).
+00067050: 0a0d 0a20 2020 2020 2020 2020 2020 206d  ...            m
+00067060: 656e 755f 6669 6c74 6572 203d 2077 782e  enu_filter = wx.
+00067070: 4d65 6e75 2829 0d0a 2020 2020 2020 2020  Menu()..        
+00067080: 2020 2020 6974 656d 5f64 6179 2020 203d      item_day   =
+00067090: 2077 782e 4d65 6e75 4974 656d 286d 656e   wx.MenuItem(men
+000670a0: 755f 6669 6c74 6572 2c20 2d31 2c20 2253  u_filter, -1, "S
+000670b0: 616d 6520 2664 6179 2229 0d0a 2020 2020  ame &day")..    
+000670c0: 2020 2020 2020 2020 6974 656d 5f77 6565          item_wee
+000670d0: 6b20 203d 2077 782e 4d65 6e75 4974 656d  k  = wx.MenuItem
+000670e0: 286d 656e 755f 6669 6c74 6572 2c20 2d31  (menu_filter, -1
+000670f0: 2c20 2253 616d 6520 2677 6565 6b22 290d  , "Same &week").
+00067100: 0a20 2020 2020 2020 2020 2020 2069 7465  .            ite
+00067110: 6d5f 6d6f 6e74 6820 3d20 7778 2e4d 656e  m_month = wx.Men
+00067120: 7549 7465 6d28 6d65 6e75 5f66 696c 7465  uItem(menu_filte
+00067130: 722c 202d 312c 2022 5361 6d65 2026 6d6f  r, -1, "Same &mo
+00067140: 6e74 6822 290d 0a20 2020 2020 2020 2020  nth")..         
+00067150: 2020 2069 7465 6d5f 7965 6172 2020 3d20     item_year  = 
+00067160: 7778 2e4d 656e 7549 7465 6d28 6d65 6e75  wx.MenuItem(menu
+00067170: 5f66 696c 7465 722c 202d 312c 2022 5361  _filter, -1, "Sa
+00067180: 6d65 2026 7965 6172 2229 0d0a 2020 2020  me &year")..    
+00067190: 2020 2020 2020 2020 6974 656d 5f66 696c          item_fil
+000671a0: 7465 7220 3d20 6d65 6e75 2e41 7070 656e  ter = menu.Appen
+000671b0: 6453 7562 4d65 6e75 286d 656e 755f 6669  dSubMenu(menu_fi
+000671c0: 6c74 6572 2c20 2226 4669 6c74 6572 2062  lter, "&Filter b
+000671d0: 7920 6461 7465 2e2e 2229 0d0a 2020 2020  y date..")..    
+000671e0: 2020 2020 2020 2020 6d65 6e75 5f66 696c          menu_fil
+000671f0: 7465 722e 4170 7065 6e64 2869 7465 6d5f  ter.Append(item_
+00067200: 6461 7929 0d0a 2020 2020 2020 2020 2020  day)..          
+00067210: 2020 6d65 6e75 5f66 696c 7465 722e 4170    menu_filter.Ap
+00067220: 7065 6e64 2869 7465 6d5f 7765 656b 290d  pend(item_week).
+00067230: 0a20 2020 2020 2020 2020 2020 206d 656e  .            men
+00067240: 755f 6669 6c74 6572 2e41 7070 656e 6428  u_filter.Append(
+00067250: 6974 656d 5f6d 6f6e 7468 290d 0a20 2020  item_month)..   
+00067260: 2020 2020 2020 2020 206d 656e 755f 6669           menu_fi
+00067270: 6c74 6572 2e41 7070 656e 6428 6974 656d  lter.Append(item
+00067280: 5f79 6561 7229 0d0a 0d0a 2020 2020 2020  _year)....      
+00067290: 2020 2020 2020 6d65 6e75 5f67 6f74 6f20        menu_goto 
+000672a0: 3d20 7778 2e4d 656e 7528 290d 0a0d 0a20  = wx.Menu().... 
+000672b0: 2020 2020 2020 2020 2020 2069 7465 6d5f             item_
+000672c0: 7072 6576 203d 2077 782e 4d65 6e75 4974  prev = wx.MenuIt
+000672d0: 656d 286d 656e 755f 676f 746f 2c20 2d31  em(menu_goto, -1
+000672e0: 2c20 2226 5072 6576 696f 7573 2066 726f  , "&Previous fro
+000672f0: 6d20 7361 6d65 2061 7574 686f 7222 290d  m same author").
+00067300: 0a20 2020 2020 2020 2020 2020 2069 7465  .            ite
+00067310: 6d5f 6e65 7874 203d 2077 782e 4d65 6e75  m_next = wx.Menu
+00067320: 4974 656d 286d 656e 755f 676f 746f 2c20  Item(menu_goto, 
+00067330: 2d31 2c20 2226 4e65 7874 2066 726f 6d20  -1, "&Next from 
+00067340: 7361 6d65 2061 7574 686f 7222 290d 0a20  same author").. 
+00067350: 2020 2020 2020 2020 2020 2069 7465 6d5f             item_
+00067360: 7072 6576 5f64 6179 2020 203d 2077 782e  prev_day   = wx.
+00067370: 4d65 6e75 4974 656d 286d 656e 755f 676f  MenuItem(menu_go
+00067380: 746f 2c20 2d31 2c20 2250 7265 7669 6f75  to, -1, "Previou
+00067390: 7320 2664 6179 2229 0d0a 2020 2020 2020  s &day")..      
+000673a0: 2020 2020 2020 6974 656d 5f6e 6578 745f        item_next_
+000673b0: 6461 7920 2020 3d20 7778 2e4d 656e 7549  day   = wx.MenuI
+000673c0: 7465 6d28 6d65 6e75 5f67 6f74 6f2c 202d  tem(menu_goto, -
+000673d0: 312c 2022 4e65 7874 2064 2661 7922 290d  1, "Next d&ay").
+000673e0: 0a20 2020 2020 2020 2020 2020 2069 7465  .            ite
+000673f0: 6d5f 7072 6576 5f77 6565 6b20 203d 2077  m_prev_week  = w
+00067400: 782e 4d65 6e75 4974 656d 286d 656e 755f  x.MenuItem(menu_
+00067410: 676f 746f 2c20 2d31 2c20 2250 7265 7669  goto, -1, "Previ
+00067420: 6f75 7320 2677 6565 6b22 290d 0a20 2020  ous &week")..   
+00067430: 2020 2020 2020 2020 2069 7465 6d5f 6e65           item_ne
+00067440: 7874 5f77 6565 6b20 203d 2077 782e 4d65  xt_week  = wx.Me
+00067450: 6e75 4974 656d 286d 656e 755f 676f 746f  nuItem(menu_goto
+00067460: 2c20 2d31 2c20 224e 6578 7420 7726 6565  , -1, "Next w&ee
+00067470: 6b22 290d 0a20 2020 2020 2020 2020 2020  k")..           
+00067480: 2069 7465 6d5f 7072 6576 5f6d 6f6e 7468   item_prev_month
+00067490: 203d 2077 782e 4d65 6e75 4974 656d 286d   = wx.MenuItem(m
+000674a0: 656e 755f 676f 746f 2c20 2d31 2c20 2250  enu_goto, -1, "P
+000674b0: 7265 7669 6f75 7320 266d 6f6e 7468 2229  revious &month")
+000674c0: 0d0a 2020 2020 2020 2020 2020 2020 6974  ..            it
+000674d0: 656d 5f6e 6578 745f 6d6f 6e74 6820 3d20  em_next_month = 
+000674e0: 7778 2e4d 656e 7549 7465 6d28 6d65 6e75  wx.MenuItem(menu
+000674f0: 5f67 6f74 6f2c 202d 312c 2022 4e65 7874  _goto, -1, "Next
+00067500: 206d 266f 6e74 6822 290d 0a0d 0a20 2020   m&onth")....   
+00067510: 2020 2020 2020 2020 2069 7465 6d5f 676f           item_go
+00067520: 746f 203d 206d 656e 752e 4170 7065 6e64  to = menu.Append
+00067530: 5375 624d 656e 7528 6d65 6e75 5f67 6f74  SubMenu(menu_got
+00067540: 6f2c 2022 2647 6f20 746f 2e2e 2229 0d0a  o, "&Go to..")..
+00067550: 2020 2020 2020 2020 2020 2020 6d65 6e75              menu
+00067560: 5f67 6f74 6f2e 4170 7065 6e64 2869 7465  _goto.Append(ite
+00067570: 6d5f 7072 6576 292c 206d 656e 755f 676f  m_prev), menu_go
+00067580: 746f 2e41 7070 656e 6428 6974 656d 5f6e  to.Append(item_n
+00067590: 6578 7429 0d0a 2020 2020 2020 2020 2020  ext)..          
+000675a0: 2020 6d65 6e75 5f67 6f74 6f2e 4170 7065    menu_goto.Appe
+000675b0: 6e64 5365 7061 7261 746f 7228 290d 0a20  ndSeparator().. 
+000675c0: 2020 2020 2020 2020 2020 206d 656e 755f             menu_
+000675d0: 676f 746f 2e41 7070 656e 6428 6974 656d  goto.Append(item
+000675e0: 5f70 7265 765f 6461 7929 2c20 6d65 6e75  _prev_day), menu
+000675f0: 5f67 6f74 6f2e 4170 7065 6e64 2869 7465  _goto.Append(ite
+00067600: 6d5f 6e65 7874 5f64 6179 290d 0a20 2020  m_next_day)..   
+00067610: 2020 2020 2020 2020 206d 656e 755f 676f           menu_go
+00067620: 746f 2e41 7070 656e 6453 6570 6172 6174  to.AppendSeparat
+00067630: 6f72 2829 0d0a 2020 2020 2020 2020 2020  or()..          
+00067640: 2020 6d65 6e75 5f67 6f74 6f2e 4170 7065    menu_goto.Appe
+00067650: 6e64 2869 7465 6d5f 7072 6576 5f77 6565  nd(item_prev_wee
+00067660: 6b29 2c20 6d65 6e75 5f67 6f74 6f2e 4170  k), menu_goto.Ap
+00067670: 7065 6e64 2869 7465 6d5f 6e65 7874 5f77  pend(item_next_w
+00067680: 6565 6b29 0d0a 2020 2020 2020 2020 2020  eek)..          
+00067690: 2020 6d65 6e75 5f67 6f74 6f2e 4170 7065    menu_goto.Appe
+000676a0: 6e64 5365 7061 7261 746f 7228 290d 0a20  ndSeparator().. 
+000676b0: 2020 2020 2020 2020 2020 206d 656e 755f             menu_
+000676c0: 676f 746f 2e41 7070 656e 6428 6974 656d  goto.Append(item
+000676d0: 5f70 7265 765f 6d6f 6e74 6829 2c20 6d65  _prev_month), me
+000676e0: 6e75 5f67 6f74 6f2e 4170 7065 6e64 2869  nu_goto.Append(i
+000676f0: 7465 6d5f 6e65 7874 5f6d 6f6e 7468 290d  tem_next_month).
+00067700: 0a0d 0a20 2020 2020 2020 2020 2020 2069  ...            i
+00067710: 7465 6d5f 6d73 672e 456e 6162 6c65 6420  tem_msg.Enabled 
+00067720: 3d20 6974 656d 5f66 696c 7465 722e 456e  = item_filter.En
+00067730: 6162 6c65 6420 3d20 6974 656d 5f67 6f74  abled = item_got
+00067740: 6f2e 456e 6162 6c65 6420 3d20 626f 6f6c  o.Enabled = bool
+00067750: 286d 7367 290d 0a20 2020 2020 2020 2020  (msg)..         
+00067760: 2020 2069 6620 6e6f 7420 7365 6c66 2e5f     if not self._
+00067770: 6175 746f 5f72 6574 7269 6576 653a 2069  auto_retrieve: i
+00067780: 7465 6d5f 6669 6c74 6572 2e45 6e61 626c  tem_filter.Enabl
+00067790: 6564 203d 2046 616c 7365 0d0a 2020 2020  ed = False..    
+000677a0: 2020 2020 2020 2020 6d65 6e75 2e42 696e          menu.Bin
+000677b0: 6428 7778 2e45 5654 5f4d 454e 552c 206f  d(wx.EVT_MENU, o
+000677c0: 6e5f 7365 6c65 6374 616c 6c2c 2020 2020  n_selectall,    
+000677d0: 2020 2020 2020 2020 2069 643d 6974 656d           id=item
+000677e0: 5f73 656c 6563 742e 4765 7449 6428 2929  _select.GetId())
+000677f0: 0d0a 2020 2020 2020 2020 2020 2020 6d65  ..            me
+00067800: 6e75 2e42 696e 6428 7778 2e45 5654 5f4d  nu.Bind(wx.EVT_M
+00067810: 454e 552c 206f 6e5f 636f 7079 6d73 672c  ENU, on_copymsg,
+00067820: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00067830: 643d 6974 656d 5f6d 7367 2e47 6574 4964  d=item_msg.GetId
+00067840: 2829 290d 0a20 2020 2020 2020 2020 2020  ())..           
+00067850: 206d 656e 752e 4269 6e64 2877 782e 4556   menu.Bind(wx.EV
+00067860: 545f 4d45 4e55 2c20 6f6e 5f73 6561 7263  T_MENU, on_searc
+00067870: 682c 2020 2020 2020 2020 2020 2020 2020  h,              
+00067880: 2020 6964 3d69 7465 6d5f 7365 6172 6368    id=item_search
+00067890: 2e47 6574 4964 2829 290d 0a20 2020 2020  .GetId())..     
+000678a0: 2020 2020 2020 206d 656e 752e 4269 6e64         menu.Bind
+000678b0: 2877 782e 4556 545f 4d45 4e55 2c20 6f6e  (wx.EVT_MENU, on
+000678c0: 5f66 696c 7465 725f 6461 7465 2822 6461  _filter_date("da
+000678d0: 7922 292c 2020 2020 6964 3d69 7465 6d5f  y"),    id=item_
+000678e0: 6461 792e 4765 7449 6428 2929 0d0a 2020  day.GetId())..  
+000678f0: 2020 2020 2020 2020 2020 6d65 6e75 2e42            menu.B
+00067900: 696e 6428 7778 2e45 5654 5f4d 454e 552c  ind(wx.EVT_MENU,
+00067910: 206f 6e5f 6669 6c74 6572 5f64 6174 6528   on_filter_date(
+00067920: 2277 6565 6b22 292c 2020 2069 643d 6974  "week"),   id=it
+00067930: 656d 5f77 6565 6b2e 4765 7449 6428 2929  em_week.GetId())
+00067940: 0d0a 2020 2020 2020 2020 2020 2020 6d65  ..            me
+00067950: 6e75 2e42 696e 6428 7778 2e45 5654 5f4d  nu.Bind(wx.EVT_M
+00067960: 454e 552c 206f 6e5f 6669 6c74 6572 5f64  ENU, on_filter_d
+00067970: 6174 6528 226d 6f6e 7468 2229 2c20 2069  ate("month"),  i
+00067980: 643d 6974 656d 5f6d 6f6e 7468 2e47 6574  d=item_month.Get
+00067990: 4964 2829 290d 0a20 2020 2020 2020 2020  Id())..         
+000679a0: 2020 206d 656e 752e 4269 6e64 2877 782e     menu.Bind(wx.
+000679b0: 4556 545f 4d45 4e55 2c20 6f6e 5f66 696c  EVT_MENU, on_fil
+000679c0: 7465 725f 6461 7465 2822 7965 6172 2229  ter_date("year")
+000679d0: 2c20 2020 6964 3d69 7465 6d5f 7965 6172  ,   id=item_year
+000679e0: 2e47 6574 4964 2829 290d 0a20 2020 2020  .GetId())..     
+000679f0: 2020 2020 2020 206d 656e 752e 4269 6e64         menu.Bind
+00067a00: 2877 782e 4556 545f 4d45 4e55 2c20 6f6e  (wx.EVT_MENU, on
+00067a10: 5f67 6f74 6f61 7574 686f 7228 2d31 292c  _gotoauthor(-1),
+00067a20: 2020 2020 2020 2020 6964 3d69 7465 6d5f          id=item_
+00067a30: 7072 6576 2e47 6574 4964 2829 290d 0a20  prev.GetId()).. 
+00067a40: 2020 2020 2020 2020 2020 206d 656e 752e             menu.
+00067a50: 4269 6e64 2877 782e 4556 545f 4d45 4e55  Bind(wx.EVT_MENU
+00067a60: 2c20 6f6e 5f67 6f74 6f61 7574 686f 7228  , on_gotoauthor(
+00067a70: 2b31 292c 2020 2020 2020 2020 6964 3d69  +1),        id=i
+00067a80: 7465 6d5f 6e65 7874 2e47 6574 4964 2829  tem_next.GetId()
+00067a90: 290d 0a20 2020 2020 2020 2020 2020 206d  )..            m
+00067aa0: 656e 752e 4269 6e64 2877 782e 4556 545f  enu.Bind(wx.EVT_
+00067ab0: 4d45 4e55 2c20 6f6e 5f67 6f74 6f74 696d  MENU, on_gototim
+00067ac0: 6528 2264 6179 222c 202d 3129 2c20 2020  e("day", -1),   
+00067ad0: 6964 3d69 7465 6d5f 7072 6576 5f64 6179  id=item_prev_day
+00067ae0: 2e47 6574 4964 2829 290d 0a20 2020 2020  .GetId())..     
+00067af0: 2020 2020 2020 206d 656e 752e 4269 6e64         menu.Bind
+00067b00: 2877 782e 4556 545f 4d45 4e55 2c20 6f6e  (wx.EVT_MENU, on
+00067b10: 5f67 6f74 6f74 696d 6528 2264 6179 222c  _gototime("day",
+00067b20: 202b 3129 2c20 2020 6964 3d69 7465 6d5f   +1),   id=item_
+00067b30: 6e65 7874 5f64 6179 2e47 6574 4964 2829  next_day.GetId()
+00067b40: 290d 0a20 2020 2020 2020 2020 2020 206d  )..            m
+00067b50: 656e 752e 4269 6e64 2877 782e 4556 545f  enu.Bind(wx.EVT_
+00067b60: 4d45 4e55 2c20 6f6e 5f67 6f74 6f74 696d  MENU, on_gototim
+00067b70: 6528 2277 6565 6b22 2c20 2d31 292c 2020  e("week", -1),  
+00067b80: 6964 3d69 7465 6d5f 7072 6576 5f77 6565  id=item_prev_wee
+00067b90: 6b2e 4765 7449 6428 2929 0d0a 2020 2020  k.GetId())..    
+00067ba0: 2020 2020 2020 2020 6d65 6e75 2e42 696e          menu.Bin
+00067bb0: 6428 7778 2e45 5654 5f4d 454e 552c 206f  d(wx.EVT_MENU, o
+00067bc0: 6e5f 676f 746f 7469 6d65 2822 7765 656b  n_gototime("week
+00067bd0: 222c 202b 3129 2c20 2069 643d 6974 656d  ", +1),  id=item
+00067be0: 5f6e 6578 745f 7765 656b 2e47 6574 4964  _next_week.GetId
+00067bf0: 2829 290d 0a20 2020 2020 2020 2020 2020  ())..           
+00067c00: 206d 656e 752e 4269 6e64 2877 782e 4556   menu.Bind(wx.EV
+00067c10: 545f 4d45 4e55 2c20 6f6e 5f67 6f74 6f74  T_MENU, on_gotot
+00067c20: 696d 6528 226d 6f6e 7468 222c 202d 3129  ime("month", -1)
+00067c30: 2c20 6964 3d69 7465 6d5f 7072 6576 5f6d  , id=item_prev_m
+00067c40: 6f6e 7468 2e47 6574 4964 2829 290d 0a20  onth.GetId()).. 
+00067c50: 2020 2020 2020 2020 2020 206d 656e 752e             menu.
+00067c60: 4269 6e64 2877 782e 4556 545f 4d45 4e55  Bind(wx.EVT_MENU
+00067c70: 2c20 6f6e 5f67 6f74 6f74 696d 6528 226d  , on_gototime("m
+00067c80: 6f6e 7468 222c 202b 3129 2c20 6964 3d69  onth", +1), id=i
+00067c90: 7465 6d5f 6e65 7874 5f6d 6f6e 7468 2e47  tem_next_month.G
+00067ca0: 6574 4964 2829 290d 0a20 2020 2020 2020  etId())..       
+00067cb0: 2073 656c 662e 506f 7075 704d 656e 7528   self.PopupMenu(
+00067cc0: 6d65 6e75 290d 0a0d 0a0d 0a20 2020 2064  menu)......    d
+00067cd0: 6566 204f 6e55 726c 2873 656c 662c 2065  ef OnUrl(self, e
+00067ce0: 7665 6e74 293a 0d0a 2020 2020 2020 2020  vent):..        
+00067cf0: 2222 220d 0a20 2020 2020 2020 2048 616e  """..        Han
+00067d00: 646c 6572 2066 6f72 2063 6c69 636b 696e  dler for clickin
+00067d10: 6720 6120 6c69 6e6b 2069 6e20 6368 6174  g a link in chat
+00067d20: 2068 6973 746f 7279 2c20 6f70 656e 7320   history, opens 
+00067d30: 5552 4c73 2069 6e20 7379 7374 656d 0d0a  URLs in system..
+00067d40: 2020 2020 2020 2020 6272 6f77 7365 722c          browser,
+00067d50: 2073 7461 7274 7320 6669 6c65 206c 696e   starts file lin
+00067d60: 6b73 2c20 616e 6420 6861 6e64 6c65 7320  ks, and handles 
+00067d70: 696e 7465 726e 616c 206c 696e 6b73 2e0d  internal links..
+00067d80: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
+00067d90: 2020 2020 2020 7374 6320 3d20 6576 656e        stc = even
+00067da0: 742e 4576 656e 744f 626a 6563 740d 0a20  t.EventObject.. 
+00067db0: 2020 2020 2020 2073 7479 6c65 735f 6c69         styles_li
+00067dc0: 6e6b 203d 205b 7365 6c66 2e5f 7374 796c  nk = [self._styl
+00067dd0: 6573 5b22 6c69 6e6b 225d 2c20 7365 6c66  es["link"], self
+00067de0: 2e5f 7374 796c 6573 5b22 626f 6c64 6c69  ._styles["boldli
+00067df0: 6e6b 225d 5d0d 0a20 2020 2020 2020 2069  nk"]]..        i
+00067e00: 6620 7374 632e 4765 7453 7479 6c65 4174  f stc.GetStyleAt
+00067e10: 2865 7665 6e74 2e50 6f73 6974 696f 6e29  (event.Position)
+00067e20: 2069 6e20 7374 796c 6573 5f6c 696e 6b3a   in styles_link:
+00067e30: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00067e40: 476f 2062 6163 6b20 616e 6420 666f 7274  Go back and fort
+00067e50: 6820 6672 6f6d 2070 6f73 6974 696f 6e20  h from position 
+00067e60: 616e 6420 6765 7420 5552 4c20 7261 6e67  and get URL rang
+00067e70: 652e 0d0a 2020 2020 2020 2020 2020 2020  e...            
+00067e80: 7572 6c2c 2075 726c 5f72 616e 6765 203d  url, url_range =
+00067e90: 2073 656c 662e 4765 7455 726c 4174 506f   self.GetUrlAtPo
+00067ea0: 7369 7469 6f6e 2865 7665 6e74 2e50 6f73  sition(event.Pos
+00067eb0: 6974 696f 6e29 0d0a 2020 2020 2020 2020  ition)..        
+00067ec0: 2020 2020 6675 6e63 7469 6f6e 2c20 6172      function, ar
+00067ed0: 6773 2c20 6b77 6172 6773 203d 204e 6f6e  gs, kwargs = Non
+00067ee0: 652c 205b 5d2c 207b 7d0d 0a20 2020 2020  e, [], {}..     
+00067ef0: 2020 2020 2020 2069 6620 7572 6c5f 7261         if url_ra
+00067f00: 6e67 655b 305d 2069 6e20 7365 6c66 2e5f  nge[0] in self._
+00067f10: 6669 6c65 6c69 6e6b 733a 0d0a 2020 2020  filelinks:..    
+00067f20: 2020 2020 2020 2020 2020 2020 6465 6620              def 
+00067f30: 7374 6172 745f 6669 6c65 2875 726c 293a  start_file(url):
+00067f40: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00067f50: 2020 2020 2020 6966 206f 732e 7061 7468        if os.path
+00067f60: 2e65 7869 7374 7328 7572 6c29 3a0d 0a20  .exists(url):.. 
+00067f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00067f80: 2020 2020 2020 2075 7469 6c2e 7374 6172         util.star
+00067f90: 745f 6669 6c65 2875 726c 290d 0a20 2020  t_file(url)..   
+00067fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00067fb0: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+00067fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00067fd0: 6d65 7373 6167 6542 6f78 2822 5468 6520  messageBox("The 
+00067fe0: 6669 6c65 205c 2225 735c 2220 6361 6e6e  file \"%s\" cann
+00067ff0: 6f74 2062 6520 666f 756e 6420 220d 0a20  ot be found ".. 
+00068000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00068010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00068020: 2020 226f 6e20 7468 6973 2063 6f6d 7075    "on this compu
+00068030: 7465 722e 2220 2520 7572 6c2c 0d0a 2020  ter." % url,..  
+00068040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00068050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00068060: 2063 6f6e 662e 5469 746c 652c 2077 782e   conf.Title, wx.
+00068070: 4f4b 207c 2077 782e 4943 4f4e 5f49 4e46  OK | wx.ICON_INF
+00068080: 4f52 4d41 5449 4f4e 290d 0a20 2020 2020  ORMATION)..     
+00068090: 2020 2020 2020 2020 2020 2066 756e 6374             funct
+000680a0: 696f 6e2c 2061 7267 7320 3d20 7374 6172  ion, args = star
+000680b0: 745f 6669 6c65 2c20 5b73 656c 662e 5f66  t_file, [self._f
+000680c0: 696c 656c 696e 6b73 5b75 726c 5f72 616e  ilelinks[url_ran
+000680d0: 6765 5b30 5d5d 5d0d 0a20 2020 2020 2020  ge[0]]]..       
+000680e0: 2020 2020 2065 6c69 6620 7572 6c5f 7261       elif url_ra
+000680f0: 6e67 655b 305d 2069 6e20 7365 6c66 2e5f  nge[0] in self._
+00068100: 6461 7465 6c69 6e6b 733a 0d0a 2020 2020  datelinks:..    
+00068110: 2020 2020 2020 2020 2020 2020 6675 6e63              func
+00068120: 7469 6f6e 203d 2073 656c 662e 4170 706c  tion = self.Appl
+00068130: 7946 696c 7465 720d 0a20 2020 2020 2020  yFilter..       
+00068140: 2020 2020 2020 2020 206b 7761 7267 7320           kwargs 
+00068150: 3d20 6469 6374 2864 6174 6572 616e 6765  = dict(daterange
+00068160: 3d73 656c 662e 5f64 6174 656c 696e 6b73  =self._datelinks
+00068170: 5b75 726c 5f72 616e 6765 5b30 5d5d 2c20  [url_range[0]], 
+00068180: 6461 7465 6c61 6265 6c3d 7572 6c29 0d0a  datelabel=url)..
+00068190: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+000681a0: 2075 726c 5f72 616e 6765 5b30 5d20 696e   url_range[0] in
+000681b0: 2073 656c 662e 5f75 726c 6c69 6e6b 733a   self._urllinks:
+000681c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000681d0: 2020 7572 6c20 3d20 7365 6c66 2e5f 7572    url = self._ur
+000681e0: 6c6c 696e 6b73 5b75 726c 5f72 616e 6765  llinks[url_range
+000681f0: 5b30 5d5d 0d0a 2020 2020 2020 2020 2020  [0]]..          
+00068200: 2020 2020 2020 6675 6e63 7469 6f6e 2c20        function, 
+00068210: 6172 6773 203d 2077 6562 6272 6f77 7365  args = webbrowse
+00068220: 722e 6f70 656e 2c20 5b75 726c 5d0d 0a20  r.open, [url].. 
+00068230: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+00068240: 2253 6372 6f6c 6c20 6261 636b 206d 6f72  "Scroll back mor
+00068250: 652e 2220 3d3d 2075 726c 3a0d 0a20 2020  e." == url:..   
+00068260: 2020 2020 2020 2020 2020 2020 2066 756e               fun
+00068270: 6374 696f 6e20 3d20 7365 6c66 2e52 6574  ction = self.Ret
+00068280: 7269 6576 654d 6f72 654d 6573 7361 6765  rieveMoreMessage
+00068290: 730d 0a20 2020 2020 2020 2020 2020 2065  s..            e
+000682a0: 6c69 6620 7572 6c3a 0d0a 2020 2020 2020  lif url:..      
+000682b0: 2020 2020 2020 2020 2020 6675 6e63 7469            functi
+000682c0: 6f6e 2c20 6172 6773 203d 2077 6562 6272  on, args = webbr
+000682d0: 6f77 7365 722e 6f70 656e 2c20 5b75 726c  owser.open, [url
+000682e0: 5d0d 0a20 2020 2020 2020 2020 2020 2069  ]..            i
+000682f0: 6620 6675 6e63 7469 6f6e 3a0d 0a20 2020  f function:..   
+00068300: 2020 2020 2020 2020 2020 2020 2023 2043               # C
+00068310: 616c 6c69 6e67 2066 756e 6374 696f 6e20  alling function 
+00068320: 6865 7265 2069 6d6d 6564 6961 7465 6c79  here immediately
+00068330: 2077 696c 6c20 6361 7573 6520 5354 4320   will cause STC 
+00068340: 746f 206c 6f73 650d 0a20 2020 2020 2020  to lose..       
+00068350: 2020 2020 2020 2020 2023 204d 6f75 7365           # Mouse
+00068360: 5570 2c20 7265 7375 6c74 696e 6720 696e  Up, resulting in
+00068370: 2061 7574 6f73 656c 6563 7420 6d6f 6465   autoselect mode
+00068380: 2066 726f 6d20 636c 6963 6b20 706f 7369   from click posi
+00068390: 7469 6f6e 2e0d 0a20 2020 2020 2020 2020  tion...         
+000683a0: 2020 2020 2020 2077 782e 4361 6c6c 4c61         wx.CallLa
+000683b0: 7465 7228 3130 302c 2066 756e 6374 696f  ter(100, functio
+000683c0: 6e2c 202a 6172 6773 2c20 2a2a 6b77 6172  n, *args, **kwar
+000683d0: 6773 290d 0a20 2020 2020 2020 2065 7665  gs)..        eve
+000683e0: 6e74 2e53 746f 7050 726f 7061 6761 7469  nt.StopPropagati
+000683f0: 6f6e 2829 0d0a 0d0a 0d0a 2020 2020 6465  on()......    de
+00068400: 6620 5365 7441 7574 6f52 6574 7269 6576  f SetAutoRetriev
+00068410: 6528 7365 6c66 2c20 7265 7472 6965 7665  e(self, retrieve
+00068420: 293a 0d0a 2020 2020 2020 2020 2222 220d  ):..        """.
+00068430: 0a20 2020 2020 2020 2053 6574 7320 7768  .        Sets wh
+00068440: 6574 6865 7220 746f 2061 7574 6f2d 7265  ether to auto-re
+00068450: 7472 6965 7665 206d 6f72 6520 6d65 7373  trieve more mess
+00068460: 6167 6573 2c0d 0a20 2020 2020 2020 2061  ages,..        a
+00068470: 6e64 2061 6c6c 6f77 2064 6174 6520 7065  nd allow date pe
+00068480: 7269 6f64 7320 6e61 7669 6761 7469 6f6e  riods navigation
+00068490: 2061 6e64 2066 696c 7465 7269 6e67 2e0d   and filtering..
+000684a0: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
+000684b0: 2020 2020 2020 7365 6c66 2e5f 6175 746f        self._auto
+000684c0: 5f72 6574 7269 6576 6520 3d20 7265 7472  _retrieve = retr
+000684d0: 6965 7665 0d0a 0d0a 0d0a 2020 2020 6465  ieve......    de
+000684e0: 6620 5265 7472 6965 7665 4d65 7373 6167  f RetrieveMessag
+000684f0: 6573 4966 4e65 6564 6564 2873 656c 6629  esIfNeeded(self)
+00068500: 3a0d 0a20 2020 2020 2020 2022 2222 0d0a  :..        """..
+00068510: 2020 2020 2020 2020 5265 7472 6965 7665          Retrieve
+00068520: 7320 6d6f 7265 206d 6573 7361 6765 7320  s more messages 
+00068530: 6966 206e 6565 6465 642c 2066 6f72 2065  if needed, for e
+00068540: 7861 6d70 6c65 2069 6620 6375 7272 656e  xample if curren
+00068550: 7420 6669 6c74 6572 0d0a 2020 2020 2020  t filter..      
+00068560: 2020 7370 6563 6966 6965 7320 6120 6c61    specifies a la
+00068570: 7267 6572 2064 6174 6520 7261 6e67 6520  rger date range 
+00068580: 7468 616e 2063 7572 7265 6e74 6c79 2061  than currently a
+00068590: 7661 696c 6162 6c65 2e0d 0a20 2020 2020  vailable...     
+000685a0: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
+000685b0: 6966 206e 6f74 2073 656c 662e 5f6d 6573  if not self._mes
+000685c0: 7361 6765 735f 6375 7272 656e 7420 616e  sages_current an
+000685d0: 6420 2264 6174 6572 616e 6765 2220 696e  d "daterange" in
+000685e0: 2073 656c 662e 5f66 696c 7465 7220 5c0d   self._filter \.
+000685f0: 0a20 2020 2020 2020 2061 6e64 2073 656c  .        and sel
+00068600: 662e 5f66 696c 7465 725b 2264 6174 6572  f._filter["dater
+00068610: 616e 6765 225d 5b30 5d3a 0d0a 2020 2020  ange"][0]:..    
+00068620: 2020 2020 2020 2020 2320 4966 2064 6174          # If dat
+00068630: 6520 6669 6c74 6572 696e 6720 7761 7320  e filtering was 
+00068640: 6a75 7374 2061 7070 6c69 6564 2c20 6368  just applied, ch
+00068650: 6563 6b20 6966 2077 6520 6e65 6564 2074  eck if we need t
+00068660: 6f0d 0a20 2020 2020 2020 2020 2020 2023  o..            #
+00068670: 2072 6574 7269 6576 6520 6d6f 7265 206d   retrieve more m
+00068680: 6573 7361 6765 7320 6672 6f6d 2065 6172  essages from ear
+00068690: 6c69 6572 2028 6d65 7373 6167 6573 2061  lier (messages a
+000686a0: 7265 2072 6574 7269 6576 6564 0d0a 2020  re retrieved..  
+000686b0: 2020 2020 2020 2020 2020 2320 7374 6172            # star
+000686c0: 7469 6e67 2066 726f 6d20 6c61 7465 7374  ting from latest
+000686d0: 292e 0d0a 2020 2020 2020 2020 2020 2020  )...            
+000686e0: 6966 206e 6f74 2073 656c 662e 5f6d 6573  if not self._mes
+000686f0: 7361 6765 735b 305d 5b22 6461 7465 7469  sages[0]["dateti
+00068700: 6d65 225d 205c 0d0a 2020 2020 2020 2020  me"] \..        
+00068710: 2020 2020 6f72 2073 656c 662e 5f6d 6573      or self._mes
+00068720: 7361 6765 735b 305d 5b22 6461 7465 7469  sages[0]["dateti
+00068730: 6d65 225d 2e64 6174 6528 2920 3e3d 2073  me"].date() >= s
+00068740: 656c 662e 5f66 696c 7465 725b 2264 6174  elf._filter["dat
+00068750: 6572 616e 6765 225d 5b30 5d3a 0d0a 2020  erange"][0]:..  
+00068760: 2020 2020 2020 2020 2020 2020 2020 6d6d                mm
+00068770: 2c20 6b77 7320 3d20 5b5d 2c20 6469 6374  , kws = [], dict
+00068780: 2874 696d 6573 7461 6d70 5f66 726f 6d3d  (timestamp_from=
+00068790: 7365 6c66 2e5f 6d65 7373 6167 6573 5b30  self._messages[0
+000687a0: 5d5b 2274 696d 6573 7461 6d70 225d 2c0d  ]["timestamp"],.
+000687b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000687c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000687d0: 2020 2020 6173 6365 6e64 696e 673d 4661      ascending=Fa
+000687e0: 6c73 652c 2075 7365 5f63 6163 6865 3d46  lse, use_cache=F
+000687f0: 616c 7365 290d 0a20 2020 2020 2020 2020  alse)..         
+00068800: 2020 2020 2020 2066 6f72 206d 2069 6e20         for m in 
+00068810: 7365 6c66 2e5f 6462 2e67 6574 5f6d 6573  self._db.get_mes
+00068820: 7361 6765 7328 7365 6c66 2e5f 6368 6174  sages(self._chat
+00068830: 2c20 2a2a 6b77 7329 3a0d 0a20 2020 2020  , **kws):..     
+00068840: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00068850: 6d2e 6170 7065 6e64 286d 290d 0a20 2020  m.append(m)..   
+00068860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00068870: 2069 6620 6d5b 2264 6174 6574 696d 6522   if m["datetime"
+00068880: 5d2e 6461 7465 2829 203c 2073 656c 662e  ].date() < self.
+00068890: 5f66 696c 7465 725b 2264 6174 6572 616e  _filter["dateran
+000688a0: 6765 225d 5b30 5d3a 0d0a 2020 2020 2020  ge"][0]:..      
+000688b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000688c0: 2020 6272 6561 6b20 2320 666f 7220 6d0d    break # for m.
+000688d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000688e0: 2073 656c 662e 5f6d 6573 7361 6765 735b   self._messages[
+000688f0: 3a30 5d20 3d20 6d6d 5b3a 3a2d 315d 2023  :0] = mm[::-1] #
+00068900: 2049 6e73 6572 7420 6173 6365 6e64 696e   Insert ascendin
+00068910: 6720 6174 2066 726f 6e74 0d0a 2020 2020  g at front..    
+00068920: 2020 2020 6c61 7374 5f64 7420 3d20 7365      last_dt = se
+00068930: 6c66 2e5f 6368 6174 2e67 6574 2822 6c61  lf._chat.get("la
+00068940: 7374 5f6d 6573 7361 6765 5f64 6174 6574  st_message_datet
+00068950: 696d 6522 290d 0a20 2020 2020 2020 2069  ime")..        i
+00068960: 6620 7365 6c66 2e5f 6d65 7373 6167 6573  f self._messages
+00068970: 2061 6e64 206c 6173 745f 6474 2061 6e64   and last_dt and
+00068980: 2073 656c 662e 5f6d 6573 7361 6765 735b   self._messages[
+00068990: 2d31 5d5b 2264 6174 6574 696d 6522 5d20  -1]["datetime"] 
+000689a0: 3c20 6c61 7374 5f64 743a 0d0a 2020 2020  < last_dt:..    
+000689b0: 2020 2020 2020 2020 2320 4c61 7374 206d          # Last m
+000689c0: 6573 7361 6765 2074 696d 6573 7461 6d70  essage timestamp
+000689d0: 2069 7320 6561 726c 6965 7220 7468 616e   is earlier than
+000689e0: 2063 6861 7427 7320 6c61 7374 206d 6573   chat's last mes
+000689f0: 7361 6765 0d0a 2020 2020 2020 2020 2020  sage..          
+00068a00: 2020 2320 7469 6d65 7374 616d 703a 206e    # timestamp: n
+00068a10: 6577 206d 6573 7361 6765 7320 6861 7665  ew messages have
+00068a20: 2061 7272 6976 6564 0d0a 2020 2020 2020   arrived..      
+00068a30: 2020 2020 2020 7365 6c66 2e5f 6d65 7373        self._mess
+00068a40: 6167 6573 2e65 7874 656e 6428 7365 6c66  ages.extend(self
+00068a50: 2e5f 6462 2e67 6574 5f6d 6573 7361 6765  ._db.get_message
+00068a60: 7328 7365 6c66 2e5f 6368 6174 2c0d 0a20  s(self._chat,.. 
+00068a70: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00068a80: 7363 656e 6469 6e67 3d54 7275 652c 2075  scending=True, u
+00068a90: 7365 5f63 6163 6865 3d46 616c 7365 2c0d  se_cache=False,.
+00068aa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00068ab0: 2074 696d 6573 7461 6d70 5f66 726f 6d3d   timestamp_from=
+00068ac0: 7365 6c66 2e5f 6d65 7373 6167 6573 5b2d  self._messages[-
+00068ad0: 315d 5b22 7469 6d65 7374 616d 7022 5d0d  1]["timestamp"].
+00068ae0: 0a20 2020 2020 2020 2020 2020 2029 290d  .            )).
+00068af0: 0a0d 0a0d 0a20 2020 2064 6566 2052 6574  .....    def Ret
+00068b00: 7269 6576 654d 6f72 654d 6573 7361 6765  rieveMoreMessage
+00068b10: 7328 7365 6c66 2c20 636f 756e 743d 4e6f  s(self, count=No
+00068b20: 6e65 293a 0d0a 2020 2020 2020 2020 2222  ne):..        ""
+00068b30: 220d 0a20 2020 2020 2020 2052 6574 7269  "..        Retri
+00068b40: 6576 6573 2061 6e6f 7468 6572 204e 206d  eves another N m
+00068b50: 6573 7361 6765 7320 7374 6172 7469 6e67  essages starting
+00068b60: 2066 726f 6d20 6375 7272 656e 7420 6669   from current fi
+00068b70: 7273 742e 0d0a 0d0a 2020 2020 2020 2020  rst.....        
+00068b80: 4070 6172 616d 2020 2063 6f75 6e74 2020  @param   count  
+00068b90: 6d61 7869 6d75 6d20 6e75 6d62 6572 206f  maximum number o
+00068ba0: 6620 6d6f 7265 206d 6573 7361 6765 7320  f more messages 
+00068bb0: 746f 2072 6574 7269 6576 652c 0d0a 2020  to retrieve,..  
+00068bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00068bd0: 2020 2020 2020 6465 6661 756c 7473 2074        defaults t
+00068be0: 6f20 636f 6e66 2e4d 6178 4869 7374 6f72  o conf.MaxHistor
+00068bf0: 7949 6e69 7469 616c 4d65 7373 6167 6573  yInitialMessages
+00068c00: 202f 2032 0d0a 2020 2020 2020 2020 2222   / 2..        ""
+00068c10: 220d 0a20 2020 2020 2020 2069 6620 636f  "..        if co
+00068c20: 756e 7420 6973 204e 6f6e 653a 2063 6f75  unt is None: cou
+00068c30: 6e74 203d 206d 6178 2831 2c20 636f 6e66  nt = max(1, conf
+00068c40: 2e4d 6178 4869 7374 6f72 7949 6e69 7469  .MaxHistoryIniti
+00068c50: 616c 4d65 7373 6167 6573 202f 2f20 3229  alMessages // 2)
+00068c60: 0d0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
+00068c70: 2063 6f75 6e74 3a20 7265 7475 726e 0d0a   count: return..
+00068c80: 0d0a 2020 2020 2020 2020 6365 6e74 6572  ..        center
+00068c90: 5f69 642c 2073 7461 6d70 5f66 726f 6d20  _id, stamp_from 
+00068ca0: 3d20 4e6f 6e65 2c20 4e6f 6e65 0d0a 2020  = None, None..  
+00068cb0: 2020 2020 2020 6966 2073 656c 662e 5f6d        if self._m
+00068cc0: 6573 7361 6765 733a 0d0a 2020 2020 2020  essages:..      
+00068cd0: 2020 2020 2020 6966 2073 656c 662e 5f6d        if self._m
+00068ce0: 6573 7361 6765 735f 6375 7272 656e 743a  essages_current:
+00068cf0: 2063 656e 7465 725f 6964 203d 2073 656c   center_id = sel
+00068d00: 662e 5f6d 6573 7361 6765 735f 6375 7272  f._messages_curr
+00068d10: 656e 745b 305d 5b22 6964 225d 0d0a 2020  ent[0]["id"]..  
+00068d20: 2020 2020 2020 2020 2020 7374 616d 705f            stamp_
+00068d30: 6672 6f6d 203d 2073 656c 662e 5f6d 6573  from = self._mes
+00068d40: 7361 6765 735b 305d 5b22 7469 6d65 7374  sages[0]["timest
+00068d50: 616d 7022 5d0d 0a20 2020 2020 2020 2065  amp"]..        e
+00068d60: 6c69 6620 616e 7928 7365 6c66 2e5f 6669  lif any(self._fi
+00068d70: 6c74 6572 2e67 6574 2822 6461 7465 7261  lter.get("datera
+00068d80: 6e67 6522 2920 6f72 205b 5d29 3a0d 0a20  nge") or []):.. 
+00068d90: 2020 2020 2020 2020 2020 2073 7461 6d70             stamp
+00068da0: 5f66 726f 6d20 3d20 7574 696c 2e64 6174  _from = util.dat
+00068db0: 6574 696d 655f 746f 5f65 706f 6368 2873  etime_to_epoch(s
+00068dc0: 656c 662e 5f66 696c 7465 725b 2264 6174  elf._filter["dat
+00068dd0: 6572 616e 6765 225d 5b30 5d29 0d0a 2020  erange"][0])..  
+00068de0: 2020 2020 2020 6966 2073 7461 6d70 5f66        if stamp_f
+00068df0: 726f 6d20 6973 204e 6f6e 653a 2072 6574  rom is None: ret
+00068e00: 7572 6e0d 0a0d 0a20 2020 2020 2020 206d  urn....        m
+00068e10: 6d2c 206b 7773 203d 205b 5d2c 2064 6963  m, kws = [], dic
+00068e20: 7428 7469 6d65 7374 616d 705f 6672 6f6d  t(timestamp_from
+00068e30: 3d73 7461 6d70 5f66 726f 6d2c 0d0a 2020  =stamp_from,..  
+00068e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00068e50: 2020 2020 2020 2020 2061 7363 656e 6469           ascendi
+00068e60: 6e67 3d46 616c 7365 2c20 7573 655f 6361  ng=False, use_ca
+00068e70: 6368 653d 4661 6c73 6529 0d0a 2020 2020  che=False)..    
+00068e80: 2020 2020 6275 7379 203d 2063 6f6e 7472      busy = contr
+00068e90: 6f6c 732e 4275 7379 5061 6e65 6c28 7365  ols.BusyPanel(se
+00068ea0: 6c66 2e5f 7061 6765 206f 7220 7365 6c66  lf._page or self
+00068eb0: 2e50 6172 656e 742c 0d0a 2020 2020 2020  .Parent,..      
+00068ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00068ed0: 2020 2020 2020 2020 2020 2020 2252 6574              "Ret
+00068ee0: 7269 6576 696e 6720 6d6f 7265 206d 6573  rieving more mes
+00068ef0: 7361 6765 732e 2229 0d0a 2020 2020 2020  sages.")..      
+00068f00: 2020 7472 793a 0d0a 2020 2020 2020 2020    try:..        
+00068f10: 2020 2020 666f 7220 692c 206d 2069 6e20      for i, m in 
+00068f20: 656e 756d 6572 6174 6528 7365 6c66 2e5f  enumerate(self._
+00068f30: 6462 2e67 6574 5f6d 6573 7361 6765 7328  db.get_messages(
+00068f40: 7365 6c66 2e5f 6368 6174 2c20 2a2a 6b77  self._chat, **kw
+00068f50: 7329 293a 0d0a 2020 2020 2020 2020 2020  s)):..          
+00068f60: 2020 2020 2020 6d6d 2e61 7070 656e 6428        mm.append(
+00068f70: 6d29 0d0a 2020 2020 2020 2020 2020 2020  m)..            
+00068f80: 2020 2020 6966 2069 202b 2031 203e 3d20      if i + 1 >= 
+00068f90: 636f 756e 743a 2062 7265 616b 2023 2066  count: break # f
+00068fa0: 6f72 2069 2c20 6d0d 0a20 2020 2020 2020  or i, m..       
+00068fb0: 2020 2020 2073 656c 662e 5f6d 6573 7361       self._messa
+00068fc0: 6765 735b 3a30 5d20 3d20 6d6d 5b3a 3a2d  ges[:0] = mm[::-
+00068fd0: 315d 2023 2049 6e73 6572 7420 6173 6365  1] # Insert asce
+00068fe0: 6e64 696e 6720 6174 2066 726f 6e74 0d0a  nding at front..
+00068ff0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00069000: 2e5f 6365 6e74 6572 5f6d 6573 7361 6765  ._center_message
+00069010: 5f69 6420 3d20 7365 6c66 2e5f 6365 6e74  _id = self._cent
+00069020: 6572 5f6d 6573 7361 6765 5f69 6e64 6578  er_message_index
+00069030: 203d 204e 6f6e 650d 0a20 2020 2020 2020   = None..       
+00069040: 2020 2020 2069 6620 7365 6c66 2e5f 6d65       if self._me
+00069050: 7373 6167 6573 3a0d 0a20 2020 2020 2020  ssages:..       
+00069060: 2020 2020 2020 2020 2072 6e67 203d 205b           rng = [
+00069070: 7365 6c66 2e5f 6d65 7373 6167 6573 5b78  self._messages[x
+00069080: 5d5b 2264 6174 6574 696d 6522 5d2e 6461  ]["datetime"].da
+00069090: 7465 2829 2066 6f72 2078 2069 6e20 2830  te() for x in (0
+000690a0: 2c20 2d31 295d 0d0a 2020 2020 2020 2020  , -1)]..        
+000690b0: 2020 2020 2020 2020 7365 6c66 2e5f 6669          self._fi
+000690c0: 6c74 6572 5b22 6461 7465 7261 6e67 6522  lter["daterange"
+000690d0: 5d20 3d20 726e 670d 0a20 2020 2020 2020  ] = rng..       
+000690e0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+000690f0: 2e5f 7061 6765 3a0d 0a20 2020 2020 2020  ._page:..       
+00069100: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00069110: 662e 5f70 6167 652e 7261 6e67 655f 6461  f._page.range_da
+00069120: 7465 2e53 6574 5661 6c75 6573 282a 726e  te.SetValues(*rn
+00069130: 6729 0d0a 2020 2020 2020 2020 2020 2020  g)..            
+00069140: 2020 2020 2020 2020 7365 6c66 2e5f 7061          self._pa
+00069150: 6765 2e63 6861 745f 6669 6c74 6572 5b22  ge.chat_filter["
+00069160: 6461 7465 7261 6e67 6522 5d20 3d20 726e  daterange"] = rn
+00069170: 670d 0a20 2020 2020 2020 2020 2020 2073  g..            s
+00069180: 656c 662e 5265 6672 6573 684d 6573 7361  elf.RefreshMessa
+00069190: 6765 7328 290d 0a20 2020 2020 2020 2020  ges()..         
+000691a0: 2020 2069 6620 7365 6c66 2e5f 7061 6765     if self._page
+000691b0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+000691c0: 2020 2073 656c 662e 5f70 6167 652e 706f     self._page.po
+000691d0: 7075 6c61 7465 5f63 6861 745f 7374 6174  pulate_chat_stat
+000691e0: 6973 7469 6373 2829 0d0a 2020 2020 2020  istics()..      
+000691f0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+00069200: 7061 6765 2e6c 6973 745f 7469 6d65 6c69  page.list_timeli
+00069210: 6e65 2e50 6f70 756c 6174 6528 2a73 656c  ne.Populate(*sel
+00069220: 662e 4765 7454 696d 656c 696e 6544 6174  f.GetTimelineDat
+00069230: 6128 2929 0d0a 2020 2020 2020 2020 6669  a())..        fi
+00069240: 6e61 6c6c 793a 2062 7573 792e 436c 6f73  nally: busy.Clos
+00069250: 6528 290d 0a20 2020 2020 2020 2069 6620  e()..        if 
+00069260: 6365 6e74 6572 5f69 6420 6973 206e 6f74  center_id is not
+00069270: 204e 6f6e 653a 2073 656c 662e 466f 6375   None: self.Focu
+00069280: 734d 6573 7361 6765 2863 656e 7465 725f  sMessage(center_
+00069290: 6964 2c20 7365 6c65 6374 3d46 616c 7365  id, select=False
+000692a0: 290d 0a0d 0a0d 0a20 2020 2064 6566 2052  )......    def R
+000692b0: 6566 7265 7368 4d65 7373 6167 6573 2873  efreshMessages(s
+000692c0: 656c 662c 2063 656e 7465 725f 6d65 7373  elf, center_mess
+000692d0: 6167 655f 6964 3d4e 6f6e 6529 3a0d 0a20  age_id=None):.. 
+000692e0: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
+000692f0: 2020 2020 436c 6561 7273 2063 6f6e 7465      Clears conte
+00069300: 6e74 2061 6e64 2072 6564 6973 706c 6179  nt and redisplay
+00069310: 7320 6d65 7373 6167 6573 206f 6620 6375  s messages of cu
+00069320: 7272 656e 7420 6368 6174 2e0d 0a0d 0a20  rrent chat..... 
+00069330: 2020 2020 2020 2040 7061 7261 6d20 2020         @param   
+00069340: 6365 6e74 6572 5f6d 6573 7361 6765 5f69  center_message_i
+00069350: 6420 2069 6620 7370 6563 6966 6965 642c  d  if specified,
+00069360: 206d 6573 7361 6765 2077 6974 6820 7468   message with th
+00069370: 6520 4944 2069 730d 0a20 2020 2020 2020  e ID is..       
+00069380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00069390: 2020 2020 2020 2020 2020 2020 2066 6f63               foc
+000693a0: 7573 6564 2061 6e64 206d 6573 7361 6765  used and message
+000693b0: 2072 616e 6765 2077 696c 6c20 6365 6e74   range will cent
+000693c0: 6572 0d0a 2020 2020 2020 2020 2020 2020  er..            
+000693d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000693e0: 2020 2020 2020 2020 6172 6f75 6e64 2069          around i
+000693f0: 742c 2073 7461 7969 6e67 2077 6974 6869  t, staying withi
+00069400: 6e20 6d61 7820 6e75 6d62 6572 0d0a 2020  n max number..  
+00069410: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
+00069420: 2020 2073 656c 662e 5365 7452 6561 644f     self.SetReadO
+00069430: 6e6c 7928 4661 6c73 6529 2023 2043 616e  nly(False) # Can
+00069440: 2774 206d 6f64 6966 7920 7768 696c 6520  't modify while 
+00069450: 7265 6164 2d6f 6e6c 790d 0a20 2020 2020  read-only..     
+00069460: 2020 2073 656c 662e 436c 6561 7241 6c6c     self.ClearAll
+00069470: 2829 0d0a 2020 2020 2020 2020 7365 6c66  ()..        self
+00069480: 2e5f 7061 7273 6572 203d 2073 6b79 7065  ._parser = skype
+00069490: 6461 7461 2e4d 6573 7361 6765 5061 7273  data.MessagePars
+000694a0: 6572 2873 656c 662e 5f64 622c 2073 656c  er(self._db, sel
+000694b0: 662e 5f63 6861 742c 2073 7461 7473 3d54  f._chat, stats=T
+000694c0: 7275 6529 0d0a 2020 2020 2020 2020 6966  rue)..        if
+000694d0: 2073 656c 662e 5f6d 6573 7361 6765 733a   self._messages:
+000694e0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+000694f0: 2073 656c 662e 5f61 7574 6f5f 7265 7472   self._auto_retr
+00069500: 6965 7665 3a0d 0a20 2020 2020 2020 2020  ieve:..         
+00069510: 2020 2020 2020 2073 656c 662e 5265 7472         self.Retr
+00069520: 6965 7665 4d65 7373 6167 6573 4966 4e65  ieveMessagesIfNe
+00069530: 6564 6564 2829 0d0a 2020 2020 2020 2020  eded()..        
+00069540: 2020 2020 7365 6c66 2e41 7070 656e 6454      self.AppendT
+00069550: 6578 7428 2246 6f72 6d61 7474 696e 6720  ext("Formatting 
+00069560: 6d65 7373 6167 6573 2e2e 5c6e 2229 0d0a  messages..\n")..
+00069570: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00069580: 2e52 6566 7265 7368 2829 0d0a 2020 2020  .Refresh()..    
+00069590: 2020 2020 2020 2020 7365 6c66 2e46 7265          self.Fre
+000695a0: 657a 6528 290d 0a20 2020 2020 2020 2020  eze()..         
+000695b0: 2020 2073 656c 662e 436c 6561 7241 6c6c     self.ClearAll
+000695c0: 2829 0d0a 0d0a 2020 2020 2020 2020 2020  ()....          
+000695d0: 2020 6966 2063 656e 7465 725f 6d65 7373    if center_mess
+000695e0: 6167 655f 6964 3a0d 0a20 2020 2020 2020  age_id:..       
+000695f0: 2020 2020 2020 2020 2069 6e64 6578 203d           index =
+00069600: 2030 0d0a 2020 2020 2020 2020 2020 2020   0..            
+00069610: 2020 2020 666f 7220 6d20 696e 2073 656c      for m in sel
+00069620: 662e 5f6d 6573 7361 6765 733a 0d0a 2020  f._messages:..  
+00069630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00069640: 2020 6966 206d 5b22 6964 225d 203d 3d20    if m["id"] == 
+00069650: 6365 6e74 6572 5f6d 6573 7361 6765 5f69  center_message_i
+00069660: 643a 0d0a 2020 2020 2020 2020 2020 2020  d:..            
+00069670: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00069680: 2e5f 6365 6e74 6572 5f6d 6573 7361 6765  ._center_message
+00069690: 5f69 6420 3d20 6365 6e74 6572 5f6d 6573  _id = center_mes
+000696a0: 7361 6765 5f69 640d 0a20 2020 2020 2020  sage_id..       
+000696b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000696c0: 2073 656c 662e 5f63 656e 7465 725f 6d65   self._center_me
+000696d0: 7373 6167 655f 696e 6465 7820 3d20 696e  ssage_index = in
+000696e0: 6465 780d 0a20 2020 2020 2020 2020 2020  dex..           
+000696f0: 2020 2020 2020 2020 2020 2020 2062 7265               bre
+00069700: 616b 0d0a 2020 2020 2020 2020 2020 2020  ak..            
+00069710: 2020 2020 2020 2020 696e 6465 7820 2b3d          index +=
+00069720: 2031 0d0a 0d0a 2020 2020 2020 2020 2020   1....          
+00069730: 2020 636f 6c6f 7572 6d61 7020 3d20 636f    colourmap = co
+00069740: 6c6c 6563 7469 6f6e 732e 6465 6661 756c  llections.defaul
+00069750: 7464 6963 7428 6c61 6d62 6461 3a20 2272  tdict(lambda: "r
+00069760: 656d 6f74 6522 290d 0a20 2020 2020 2020  emote")..       
+00069770: 2020 2020 2063 6f6c 6f75 726d 6170 5b73       colourmap[s
+00069780: 656c 662e 5f64 622e 6964 5d20 3d20 226c  elf._db.id] = "l
+00069790: 6f63 616c 220d 0a20 2020 2020 2020 2020  ocal"..         
+000697a0: 2020 2073 656c 662e 5f6d 6573 7361 6765     self._message
+000697b0: 5f70 6f73 6974 696f 6e73 2e63 6c65 6172  _positions.clear
+000697c0: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+000697d0: 7365 6c66 2e5f 6d65 7373 6167 655f 6d61  self._message_ma
+000697e0: 702e 636c 6561 7228 290d 0a20 2020 2020  p.clear()..     
+000697f0: 2020 2020 2020 2070 7265 7669 6f75 735f         previous_
+00069800: 6461 7920 3d20 4e6f 6e65 0d0a 2020 2020  day = None..    
+00069810: 2020 2020 2020 2020 636f 756e 7420 3d20          count = 
+00069820: 300d 0a20 2020 2020 2020 2020 2020 2066  0..            f
+00069830: 6f63 7573 5f6d 6573 7361 6765 5f69 6420  ocus_message_id 
+00069840: 3d20 4e6f 6e65 0d0a 2020 2020 2020 2020  = None..        
+00069850: 2020 2020 7365 6c66 2e5f 7572 6c6c 696e      self._urllin
+00069860: 6b73 2e63 6c65 6172 2829 0d0a 2020 2020  ks.clear()..    
+00069870: 2020 2020 2020 2020 7365 6c66 2e5f 6669          self._fi
+00069880: 6c65 6c69 6e6b 732e 636c 6561 7228 290d  lelinks.clear().
+00069890: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+000698a0: 662e 5f64 6174 656c 696e 6b73 2e63 6c65  f._datelinks.cle
+000698b0: 6172 2829 0d0a 2020 2020 2020 2020 2020  ar()..          
+000698c0: 2020 2320 466f 7220 6163 6375 6d75 6c61    # For accumula
+000698d0: 7469 6e67 2076 6172 696f 7573 2073 7461  ting various sta
+000698e0: 7469 7374 6963 730d 0a20 2020 2020 2020  tistics..       
+000698f0: 2020 2020 2072 6778 5f68 6967 686c 6967       rgx_highlig
+00069900: 6874 203d 2072 652e 636f 6d70 696c 6528  ht = re.compile(
+00069910: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00069920: 2020 2228 2573 2922 2025 2072 652e 6573    "(%s)" % re.es
+00069930: 6361 7065 2873 656c 662e 5f66 696c 7465  cape(self._filte
+00069940: 725b 2274 6578 7422 5d29 2c20 7265 2e49  r["text"]), re.I
+00069950: 0d0a 2020 2020 2020 2020 2020 2020 2920  ..            ) 
+00069960: 6966 2028 2274 6578 7422 2069 6e20 7365  if ("text" in se
+00069970: 6c66 2e5f 6669 6c74 6572 2061 6e64 2073  lf._filter and s
+00069980: 656c 662e 5f66 696c 7465 725b 2274 6578  elf._filter["tex
+00069990: 7422 5d29 2065 6c73 6520 4e6f 6e65 0d0a  t"]) else None..
+000699a0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000699b0: 2e5f 6d65 7373 6167 6573 5f63 7572 7265  ._messages_curre
+000699c0: 6e74 203d 205b 5d0d 0a0d 0a20 2020 2020  nt = []....     
+000699d0: 2020 2020 2020 2023 2041 7373 656d 626c         # Assembl
+000699e0: 6520 6d65 7373 6167 6573 2074 6f20 7368  e messages to sh
+000699f0: 6f77 0d0a 2020 2020 2020 2020 2020 2020  ow..            
+00069a00: 666f 7220 6d20 696e 2073 656c 662e 5f6d  for m in self._m
+00069a10: 6573 7361 6765 733a 0d0a 2020 2020 2020  essages:..      
+00069a20: 2020 2020 2020 2020 2020 636f 756e 7420            count 
+00069a30: 2b3d 2031 0d0a 2020 2020 2020 2020 2020  += 1..          
+00069a40: 2020 2020 2020 6966 2073 656c 662e 4973        if self.Is
+00069a50: 4d65 7373 6167 6546 696c 7465 7265 644f  MessageFilteredO
+00069a60: 7574 286d 293a 0d0a 2020 2020 2020 2020  ut(m):..        
+00069a70: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+00069a80: 696e 7565 2023 2066 6f72 206d 0d0a 2020  inue # for m..  
+00069a90: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00069aa0: 2073 656c 662e 5f63 656e 7465 725f 6d65   self._center_me
+00069ab0: 7373 6167 655f 696e 6465 7820 6973 206e  ssage_index is n
+00069ac0: 6f74 204e 6f6e 6520 5c0d 0a20 2020 2020  ot None \..     
+00069ad0: 2020 2020 2020 2020 2020 2061 6e64 2063             and c
+00069ae0: 6f75 6e74 203c 2073 656c 662e 5f63 656e  ount < self._cen
+00069af0: 7465 725f 6d65 7373 6167 655f 696e 6465  ter_message_inde
+00069b00: 7820 5c0d 0a20 2020 2020 2020 2020 2020  x \..           
+00069b10: 2020 2020 202d 2063 6f6e 662e 4d61 7848       - conf.MaxH
+00069b20: 6973 746f 7279 496e 6974 6961 6c4d 6573  istoryInitialMes
+00069b30: 7361 6765 7320 2f2f 2032 3a0d 0a20 2020  sages // 2:..   
+00069b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00069b50: 2023 2053 6b69 7020 6d65 7373 6167 6573   # Skip messages
+00069b60: 2062 6566 6f72 6520 7468 6520 7261 6e67   before the rang
+00069b70: 6520 6365 6e74 6572 6564 2061 726f 756e  e centered aroun
+00069b80: 6420 6120 6d65 7373 6167 650d 0a20 2020  d a message..   
+00069b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00069ba0: 2063 6f6e 7469 6e75 6520 2320 666f 7220   continue # for 
+00069bb0: 6d0d 0a20 2020 2020 2020 2020 2020 2020  m..             
+00069bc0: 2020 2069 6620 7365 6c66 2e5f 6365 6e74     if self._cent
+00069bd0: 6572 5f6d 6573 7361 6765 5f69 6e64 6578  er_message_index
+00069be0: 2069 7320 6e6f 7420 4e6f 6e65 205c 0d0a   is not None \..
+00069bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00069c00: 616e 6420 636f 756e 7420 3e20 7365 6c66  and count > self
+00069c10: 2e5f 6365 6e74 6572 5f6d 6573 7361 6765  ._center_message
+00069c20: 5f69 6e64 6578 205c 0d0a 2020 2020 2020  _index \..      
+00069c30: 2020 2020 2020 2020 2020 2b20 636f 6e66            + conf
+00069c40: 2e4d 6178 4869 7374 6f72 7949 6e69 7469  .MaxHistoryIniti
+00069c50: 616c 4d65 7373 6167 6573 202f 2f20 323a  alMessages // 2:
+00069c60: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00069c70: 2020 2020 2020 2320 536b 6970 206d 6573        # Skip mes
+00069c80: 7361 6765 7320 6166 7465 7220 7468 6520  sages after the 
+00069c90: 7261 6e67 6520 6365 6e74 6572 6564 2061  range centered a
+00069ca0: 726f 756e 6420 6120 6d65 7373 6167 650d  round a message.
+00069cb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00069cc0: 2020 2020 2062 7265 616b 2023 2066 6f72       break # for
+00069cd0: 206d 0d0a 0d0a 2020 2020 2020 2020 2020   m....          
+00069ce0: 2020 2020 2020 7365 6c66 2e5f 6d65 7373        self._mess
+00069cf0: 6167 6573 5f63 7572 7265 6e74 2e61 7070  ages_current.app
+00069d00: 656e 6428 6d29 0d0a 0d0a 2020 2020 2020  end(m)....      
+00069d10: 2020 2020 2020 2320 4164 6420 6461 7465        # Add date
+00069d20: 2061 6e64 2063 6f75 6e74 2069 6e66 6f72   and count infor
+00069d30: 6d61 7469 6f6e 2c20 2253 6372 6f6c 6c20  mation, "Scroll 
+00069d40: 6261 636b 206d 6f72 6522 2c20 616e 6420  back more", and 
+00069d50: 6c69 6e6b 7320 6c69 6b65 2022 3620 6d6f  links like "6 mo
+00069d60: 6e74 6873 220d 0a20 2020 2020 2020 2020  nths"..         
+00069d70: 2020 2073 656c 662e 5f61 7070 656e 645f     self._append_
+00069d80: 7465 7874 2822 5c6e 2229 0d0a 2020 2020  text("\n")..    
+00069d90: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00069da0: 5f6d 6573 7361 6765 735f 6375 7272 656e  _messages_curren
+00069db0: 743a 0d0a 2020 2020 2020 2020 2020 2020  t:..            
+00069dc0: 2020 2020 6d31 2c20 6d32 203d 2073 656c      m1, m2 = sel
+00069dd0: 662e 5f6d 6573 7361 6765 735f 6375 7272  f._messages_curr
+00069de0: 656e 745b 305d 2c20 7365 6c66 2e5f 6d65  ent[0], self._me
+00069df0: 7373 6167 6573 5f63 7572 7265 6e74 5b2d  ssages_current[-
+00069e00: 315d 0d0a 2020 2020 2020 2020 2020 2020  1]..            
+00069e10: 2020 2020 7365 6c66 2e5f 6170 7065 6e64      self._append
+00069e20: 5f74 6578 7428 2248 6973 746f 7279 206f  _text("History o
+00069e30: 6620 2022 290d 0a20 2020 2020 2020 2020  f  ")..         
+00069e40: 2020 2020 2020 2073 656c 662e 5f61 7070         self._app
+00069e50: 656e 645f 7465 7874 286d 315b 2264 6174  end_text(m1["dat
+00069e60: 6574 696d 6522 5d2e 7374 7266 7469 6d65  etime"].strftime
+00069e70: 2822 2564 2e25 6d2e 2559 2229 2c20 2262  ("%d.%m.%Y"), "b
+00069e80: 6f6c 6422 290d 0a20 2020 2020 2020 2020  old")..         
+00069e90: 2020 2020 2020 2069 6620 6d31 5b22 6461         if m1["da
+00069ea0: 7465 7469 6d65 225d 2e64 6174 6528 2920  tetime"].date() 
+00069eb0: 213d 206d 325b 2264 6174 6574 696d 6522  != m2["datetime"
+00069ec0: 5d2e 6461 7465 2829 3a0d 0a20 2020 2020  ].date():..     
+00069ed0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00069ee0: 656c 662e 5f61 7070 656e 645f 7465 7874  elf._append_text
+00069ef0: 2822 2074 6f20 2229 0d0a 2020 2020 2020  (" to ")..      
+00069f00: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00069f10: 6c66 2e5f 6170 7065 6e64 5f74 6578 7428  lf._append_text(
+00069f20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00069f30: 2020 2020 2020 2020 2020 6d32 5b22 6461            m2["da
+00069f40: 7465 7469 6d65 225d 2e73 7472 6674 696d  tetime"].strftim
+00069f50: 6528 2225 642e 256d 2e25 5922 292c 2022  e("%d.%m.%Y"), "
+00069f60: 626f 6c64 2229 0d0a 2020 2020 2020 2020  bold")..        
+00069f70: 2020 2020 2020 2020 7365 6c66 2e5f 6170          self._ap
+00069f80: 7065 6e64 5f74 6578 7428 2220 2028 2573  pend_text("  (%s
+00069f90: 292e 2022 2025 2075 7469 6c2e 706c 7572  ). " % util.plur
+00069fa0: 616c 280d 0a20 2020 2020 2020 2020 2020  al(..           
+00069fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00069fc0: 2020 2020 2020 2022 6d65 7373 6167 6522         "message"
+00069fd0: 2c20 7365 6c66 2e5f 6d65 7373 6167 6573  , self._messages
+00069fe0: 5f63 7572 7265 6e74 2c20 7365 703d 222c  _current, sep=",
+00069ff0: 2229 290d 0a0d 0a20 2020 2020 2020 2020  "))....         
+0006a000: 2020 2069 6620 7365 6c66 2e5f 6368 6174     if self._chat
+0006a010: 5b22 6d65 7373 6167 655f 636f 756e 7422  ["message_count"
+0006a020: 5d20 616e 6420 7365 6c66 2e5f 6175 746f  ] and self._auto
+0006a030: 5f72 6574 7269 6576 6520 616e 6420 286e  _retrieve and (n
+0006a040: 6f74 2073 656c 662e 5f6d 6573 7361 6765  ot self._message
+0006a050: 730d 0a20 2020 2020 2020 2020 2020 206f  s..            o
+0006a060: 7220 7365 6c66 2e5f 6d65 7373 6167 6573  r self._messages
+0006a070: 5b30 5d5b 2264 6174 6574 696d 6522 5d20  [0]["datetime"] 
+0006a080: 3e20 7365 6c66 2e5f 6368 6174 5b22 6669  > self._chat["fi
+0006a090: 7273 745f 6d65 7373 6167 655f 6461 7465  rst_message_date
+0006a0a0: 7469 6d65 225d 293a 0d0a 2020 2020 2020  time"]):..      
+0006a0b0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+0006a0c0: 6170 7065 6e64 5f74 6578 7428 2253 6372  append_text("Scr
+0006a0d0: 6f6c 6c20 6261 636b 206d 6f72 652e 222c  oll back more.",
+0006a0e0: 2022 6c69 6e6b 2229 0d0a 0d0a 2020 2020   "link")....    
+0006a0f0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0006a100: 5f63 6861 745b 226d 6573 7361 6765 5f63  _chat["message_c
+0006a110: 6f75 6e74 225d 2061 6e64 2073 656c 662e  ount"] and self.
+0006a120: 5f61 7574 6f5f 7265 7472 6965 7665 3a0d  _auto_retrieve:.
+0006a130: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0006a140: 2073 656c 662e 5f61 7070 656e 645f 7465   self._append_te
+0006a150: 7874 2822 5c6e 5368 6f77 2066 726f 6d3a  xt("\nShow from:
+0006a160: 2020 2229 0d0a 2020 2020 2020 2020 2020    ")..          
+0006a170: 2020 2020 2020 6461 7465 5f66 6972 7374        date_first
+0006a180: 203d 2073 656c 662e 5f63 6861 745b 2266   = self._chat["f
+0006a190: 6972 7374 5f6d 6573 7361 6765 5f64 6174  irst_message_dat
+0006a1a0: 6574 696d 6522 5d2e 6461 7465 2829 0d0a  etime"].date()..
+0006a1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006a1c0: 6461 7465 5f6c 6173 7420 3d20 7365 6c66  date_last = self
+0006a1d0: 2e5f 6368 6174 5b22 6c61 7374 5f6d 6573  ._chat["last_mes
+0006a1e0: 7361 6765 5f64 6174 6574 696d 6522 5d2e  sage_datetime"].
+0006a1f0: 6461 7465 2829 0d0a 2020 2020 2020 2020  date()..        
+0006a200: 2020 2020 2020 2020 6461 7465 5f75 6e74          date_unt
+0006a210: 696c 203d 2064 6174 6574 696d 652e 6461  il = datetime.da
+0006a220: 7465 2e74 6f64 6179 2829 0d0a 2020 2020  te.today()..    
+0006a230: 2020 2020 2020 2020 2020 2020 6461 7465              date
+0006a240: 735f 6669 6c74 6572 203d 2073 656c 662e  s_filter = self.
+0006a250: 5f66 696c 7465 722e 6765 7428 2264 6174  _filter.get("dat
+0006a260: 6572 616e 6765 2229 0d0a 2020 2020 2020  erange")..      
+0006a270: 2020 2020 2020 2020 2020 6672 6f6d 5f69            from_i
+0006a280: 7465 6d73 203d 205b 5d20 2320 5b28 7469  tems = [] # [(ti
+0006a290: 746c 652c 205b 6461 7465 5f66 6972 7374  tle, [date_first
+0006a2a0: 2c20 6461 7465 5f6c 6173 745d 295d 0d0a  , date_last])]..
+0006a2b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0006a2c0: 2020 666f 7220 756e 6974 2c20 636f 756e    for unit, coun
+0006a2d0: 7420 696e 205b 2822 6461 7922 2c20 3729  t in [("day", 7)
+0006a2e0: 2c20 2822 7765 656b 222c 2032 292c 2028  , ("week", 2), (
+0006a2f0: 2264 6179 222c 2033 3029 2c0d 0a20 2020  "day", 30),..   
+0006a300: 2020 2020 2020 2020 2020 2020 2028 226d               ("m
+0006a310: 6f6e 7468 222c 2033 292c 2028 226d 6f6e  onth", 3), ("mon
+0006a320: 7468 222c 2036 292c 2028 2279 6561 7222  th", 6), ("year"
+0006a330: 2c20 3129 2c20 2822 7965 6172 222c 2032  , 1), ("year", 2
+0006a340: 295d 3a0d 0a20 2020 2020 2020 2020 2020  )]:..           
+0006a350: 2020 2020 2020 2020 2064 6174 655f 6672           date_fr
+0006a360: 6f6d 203d 2075 7469 6c2e 6461 7465 5f73  om = util.date_s
+0006a370: 6869 6674 2864 6174 655f 756e 7469 6c2c  hift(date_until,
+0006a380: 2075 6e69 742c 202d 636f 756e 7429 0d0a   unit, -count)..
+0006a390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006a3a0: 2020 2020 6966 2064 6174 655f 6672 6f6d      if date_from
+0006a3b0: 203e 3d20 6461 7465 5f66 6972 7374 2061   >= date_first a
+0006a3c0: 6e64 2064 6174 655f 6672 6f6d 203c 3d20  nd date_from <= 
+0006a3d0: 6461 7465 5f6c 6173 743a 0d0a 2020 2020  date_last:..    
+0006a3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006a3f0: 2020 2020 7469 746c 6520 3d20 7574 696c      title = util
+0006a400: 2e70 6c75 7261 6c28 756e 6974 2c20 636f  .plural(unit, co
+0006a410: 756e 742c 2073 6570 3d22 2c22 290d 0a20  unt, sep=",").. 
+0006a420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006a430: 2020 2020 2020 2066 726f 6d5f 6974 656d         from_item
+0006a440: 732e 6170 7065 6e64 2828 7469 746c 652c  s.append((title,
+0006a450: 205b 6461 7465 5f66 726f 6d2c 2064 6174   [date_from, dat
+0006a460: 655f 6c61 7374 5d29 290d 0a20 2020 2020  e_last]))..     
+0006a470: 2020 2020 2020 2020 2020 2064 6174 655f             date_
+0006a480: 3279 203d 2075 7469 6c2e 6461 7465 5f73  2y = util.date_s
+0006a490: 6869 6674 2864 6174 655f 756e 7469 6c2c  hift(date_until,
+0006a4a0: 2022 7965 6172 222c 202d 3229 0d0a 2020   "year", -2)..  
+0006a4b0: 2020 2020 2020 2020 2020 2020 2020 6461                da
+0006a4c0: 7465 5f34 7920 3d20 7574 696c 2e64 6174  te_4y = util.dat
+0006a4d0: 655f 7368 6966 7428 6461 7465 5f75 6e74  e_shift(date_unt
+0006a4e0: 696c 2c20 2279 6561 7222 2c20 2d34 290d  il, "year", -4).
+0006a4f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0006a500: 2069 6620 2064 6174 655f 3279 203e 2064   if  date_2y > d
+0006a510: 6174 655f 6669 7273 7420 616e 6420 6461  ate_first and da
+0006a520: 7465 5f34 7920 3e20 6461 7465 5f66 6972  te_4y > date_fir
+0006a530: 7374 3a0d 0a20 2020 2020 2020 2020 2020  st:..           
+0006a540: 2020 2020 2020 2020 2066 726f 6d5f 6974           from_it
+0006a550: 656d 732e 6170 7065 6e64 2828 2232 2074  ems.append(("2 t
+0006a560: 6f20 3420 7965 6172 7322 2c20 5b64 6174  o 4 years", [dat
+0006a570: 655f 3479 2c20 6461 7465 5f32 795d 2929  e_4y, date_2y]))
+0006a580: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0006a590: 2020 6966 2064 6174 655f 3479 203e 2064    if date_4y > d
+0006a5a0: 6174 655f 6669 7273 743a 0d0a 2020 2020  ate_first:..    
+0006a5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006a5c0: 6672 6f6d 5f69 7465 6d73 2e61 7070 656e  from_items.appen
+0006a5d0: 6428 2822 3420 7965 6172 7320 616e 6420  d(("4 years and 
+0006a5e0: 6f6c 6465 7222 2c20 5b64 6174 655f 6669  older", [date_fi
+0006a5f0: 7273 742c 2064 6174 655f 3479 5d29 290d  rst, date_4y])).
+0006a600: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
+0006a610: 2020 2064 6174 6572 616e 6765 203d 205b     daterange = [
+0006a620: 6461 7465 5f66 6972 7374 2c20 6461 7465  date_first, date
+0006a630: 5f6c 6173 745d 0d0a 2020 2020 2020 2020  _last]..        
+0006a640: 2020 2020 2020 2020 6672 6f6d 5f69 7465          from_ite
+0006a650: 6d73 2e61 7070 656e 6428 2822 4672 6f6d  ms.append(("From
+0006a660: 2074 6865 2062 6567 696e 6e69 6e67 222c   the beginning",
+0006a670: 2064 6174 6572 616e 6765 2929 0d0a 2020   daterange))..  
+0006a680: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+0006a690: 7220 692c 2028 7469 746c 652c 2064 6174  r i, (title, dat
+0006a6a0: 6572 616e 6765 2920 696e 2065 6e75 6d65  erange) in enume
+0006a6b0: 7261 7465 2866 726f 6d5f 6974 656d 7329  rate(from_items)
+0006a6c0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0006a6d0: 2020 2020 2020 2069 735f 6163 7469 7665         is_active
+0006a6e0: 203d 2063 656e 7465 725f 6d65 7373 6167   = center_messag
+0006a6f0: 655f 6964 2069 7320 4e6f 6e65 205c 0d0a  e_id is None \..
+0006a700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006a710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006a720: 616e 6420 2828 7469 746c 6520 3d3d 2073  and ((title == s
+0006a730: 656c 662e 5f64 6174 656c 696e 6b5f 6c61  elf._datelink_la
+0006a740: 7374 290d 0a20 2020 2020 2020 2020 2020  st)..           
+0006a750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006a760: 2020 2020 2020 2020 2020 6f72 2028 6461            or (da
+0006a770: 7465 7261 6e67 6520 3d3d 2064 6174 6573  terange == dates
+0006a780: 5f66 696c 7465 7229 290d 0a20 2020 2020  _filter))..     
+0006a790: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0006a7a0: 6620 693a 0d0a 2020 2020 2020 2020 2020  f i:..          
+0006a7b0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0006a7c0: 6c66 2e5f 6170 7065 6e64 5f74 6578 7428  lf._append_text(
+0006a7d0: 7522 2020 5c75 3230 3232 2020 222c 2022  u"  \u2022  ", "
+0006a7e0: 7370 6563 6961 6c22 2920 2320 6275 6c6c  special") # bull
+0006a7f0: 6574 0d0a 2020 2020 2020 2020 2020 2020  et..            
+0006a800: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
+0006a810: 735f 6163 7469 7665 3a0d 0a20 2020 2020  s_active:..     
+0006a820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006a830: 2020 2073 656c 662e 5f64 6174 656c 696e     self._datelin
+0006a840: 6b73 5b73 656c 662e 5354 432e 4c65 6e67  ks[self.STC.Leng
+0006a850: 7468 5d20 3d20 6461 7465 7261 6e67 650d  th] = daterange.
+0006a860: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0006a870: 2020 2020 2073 656c 662e 5f61 7070 656e       self._appen
+0006a880: 645f 7465 7874 2874 6974 6c65 2c20 2262  d_text(title, "b
+0006a890: 6f6c 6422 2069 6620 6973 5f61 6374 6976  old" if is_activ
+0006a8a0: 6520 656c 7365 2022 6c69 6e6b 2229 0d0a  e else "link")..
+0006a8b0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0006a8c0: 2e5f 6461 7465 6c69 6e6b 5f6c 6173 7420  ._datelink_last 
+0006a8d0: 3d20 4e6f 6e65 0d0a 2020 2020 2020 2020  = None..        
+0006a8e0: 2020 2020 7365 6c66 2e5f 6170 7065 6e64      self._append
+0006a8f0: 5f74 6578 7428 225c 6e5c 6e22 290d 0a0d  _text("\n\n")...
+0006a900: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+0006a910: 2069 2c20 6d20 696e 2065 6e75 6d65 7261   i, m in enumera
+0006a920: 7465 2873 656c 662e 5f6d 6573 7361 6765  te(self._message
+0006a930: 735f 6375 7272 656e 7429 3a0d 0a20 2020  s_current):..   
+0006a940: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0006a950: 6d5b 2264 6174 6574 696d 6522 5d2e 6461  m["datetime"].da
+0006a960: 7465 2829 2021 3d20 7072 6576 696f 7573  te() != previous
+0006a970: 5f64 6179 3a0d 0a20 2020 2020 2020 2020  _day:..         
+0006a980: 2020 2020 2020 2020 2020 2023 2044 6179             # Day
+0006a990: 2068 6173 2063 6861 6e67 6564 3a20 696e   has changed: in
+0006a9a0: 7365 7274 2061 2064 6174 6520 6865 6164  sert a date head
+0006a9b0: 6572 0d0a 2020 2020 2020 2020 2020 2020  er..            
+0006a9c0: 2020 2020 2020 2020 7072 6576 696f 7573          previous
+0006a9d0: 5f64 6179 203d 206d 5b22 6461 7465 7469  _day = m["dateti
+0006a9e0: 6d65 225d 2e64 6174 6528 290d 0a20 2020  me"].date()..   
+0006a9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006aa00: 2077 6565 6b64 6179 2c20 7765 656b 6461   weekday, weekda
+0006aa10: 7465 203d 2075 7469 6c2e 6765 745f 6c6f  te = util.get_lo
+0006aa20: 6361 6c65 5f64 6179 5f64 6174 6528 7072  cale_day_date(pr
+0006aa30: 6576 696f 7573 5f64 6179 290d 0a20 2020  evious_day)..   
+0006aa40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006aa50: 2073 656c 662e 5f61 7070 656e 645f 7465   self._append_te
+0006aa60: 7874 2822 5c6e 2573 2220 2520 7765 656b  xt("\n%s" % week
+0006aa70: 6461 792c 2022 626f 6c64 2229 0d0a 2020  day, "bold")..  
+0006aa80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006aa90: 2020 7365 6c66 2e5f 6170 7065 6e64 5f74    self._append_t
+0006aaa0: 6578 7428 222c 2025 735c 6e5c 6e22 2025  ext(", %s\n\n" %
+0006aab0: 2077 6565 6b64 6174 6529 0d0a 0d0a 2020   weekdate)....  
+0006aac0: 2020 2020 2020 2020 2020 2020 2020 646f                do
+0006aad0: 6d20 3d20 7365 6c66 2e5f 7061 7273 6572  m = self._parser
+0006aae0: 2e70 6172 7365 286d 290d 0a20 2020 2020  .parse(m)..     
+0006aaf0: 2020 2020 2020 2020 2020 206c 656e 6774             lengt
+0006ab00: 685f 6265 666f 7265 203d 2073 656c 662e  h_before = self.
+0006ab10: 5354 432e 4c65 6e67 7468 0d0a 2020 2020  STC.Length..    
+0006ab20: 2020 2020 2020 2020 2020 2020 7469 6d65              time
+0006ab30: 5f76 616c 7565 203d 206d 5b22 6461 7465  _value = m["date
+0006ab40: 7469 6d65 225d 2e73 7472 6674 696d 6528  time"].strftime(
+0006ab50: 2225 483a 254d 2229 0d0a 2020 2020 2020  "%H:%M")..      
+0006ab60: 2020 2020 2020 2020 2020 6469 7370 6c61            displa
+0006ab70: 796e 616d 6520 3d20 7365 6c66 2e5f 6462  yname = self._db
+0006ab80: 2e67 6574 5f61 7574 686f 725f 6e61 6d65  .get_author_name
+0006ab90: 286d 290d 0a20 2020 2020 2020 2020 2020  (m)..           
+0006aba0: 2020 2020 2073 7065 6369 616c 5f74 6167       special_tag
+0006abb0: 203d 2064 6f6d 2e66 696e 6428 226d 7367   = dom.find("msg
+0006abc0: 7374 6174 7573 2229 0d0a 2020 2020 2020  status")..      
+0006abd0: 2020 2020 2020 2020 2020 2320 496e 666f            # Info
+0006abe0: 206d 6573 7361 6765 7320 6c69 6b65 2022   messages like "
+0006abf0: 2f6d 6520 6973 2074 6869 7273 7479 2220  /me is thirsty" 
+0006ac00: 2d3e 2061 7574 686f 7220 6f6e 2073 616d  -> author on sam
+0006ac10: 6520 6c69 6e65 2e0d 0a20 2020 2020 2020  e line...       
+0006ac20: 2020 2020 2020 2020 2069 735f 696e 666f           is_info
+0006ac30: 203d 2028 736b 7970 6564 6174 612e 4d45   = (skypedata.ME
+0006ac40: 5353 4147 455f 5459 5045 5f49 4e46 4f20  SSAGE_TYPE_INFO 
+0006ac50: 3d3d 206d 5b22 7479 7065 225d 290d 0a0d  == m["type"])...
+0006ac60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0006ac70: 2069 6620 6973 5f69 6e66 6f3a 0d0a 2020   if is_info:..  
 0006ac80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006ac90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006aca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006acb0: 2063 6f6c 6f75 726d 6170 5b6d 5b22 6175   colourmap[m["au
-0006acc0: 7468 6f72 225d 5d29 0d0a 2020 2020 2020  thor"]])..      
-0006acd0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0006ace0: 6c66 2e5f 6170 7065 6e64 5f74 6578 7428  lf._append_text(
-0006acf0: 2225 735c 6e22 2025 2073 7065 6369 616c  "%s\n" % special
-0006ad00: 5f74 6167 2e74 6578 742c 2022 7370 6563  _tag.text, "spec
-0006ad10: 6961 6c22 290d 0a0d 0a20 2020 2020 2020  ial")....       
-0006ad20: 2020 2020 2020 2020 2073 656c 662e 5f77           self._w
-0006ad30: 7269 7465 5f65 6c65 6d65 6e74 2864 6f6d  rite_element(dom
-0006ad40: 2c20 7267 785f 6869 6768 6c69 6768 7429  , rgx_highlight)
-0006ad50: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-0006ad60: 2020 2020 6d65 7373 6167 6570 6f73 203d      messagepos =
-0006ad70: 2028 6c65 6e67 7468 5f62 6566 6f72 652c   (length_before,
-0006ad80: 2073 656c 662e 5354 432e 4c65 6e67 7468   self.STC.Length
-0006ad90: 202d 2032 290d 0a20 2020 2020 2020 2020   - 2)..         
-0006ada0: 2020 2020 2020 2073 656c 662e 5f6d 6573         self._mes
-0006adb0: 7361 6765 5f70 6f73 6974 696f 6e73 5b6d  sage_positions[m
-0006adc0: 5b22 6964 225d 5d20 3d20 6d65 7373 6167  ["id"]] = messag
-0006add0: 6570 6f73 0d0a 2020 2020 2020 2020 2020  epos..          
-0006ade0: 2020 2020 2020 7365 6c66 2e5f 6d65 7373        self._mess
-0006adf0: 6167 655f 6d61 705b 6d5b 2269 6422 5d5d  age_map[m["id"]]
-0006ae00: 203d 206d 0d0a 2020 2020 2020 2020 2020   = m..          
-0006ae10: 2020 2020 2020 6966 2073 656c 662e 5f63        if self._c
-0006ae20: 656e 7465 725f 6d65 7373 6167 655f 6964  enter_message_id
-0006ae30: 203d 3d20 6d5b 2269 6422 5d3a 0d0a 2020   == m["id"]:..  
-0006ae40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006ae50: 2020 666f 6375 735f 6d65 7373 6167 655f    focus_message_
-0006ae60: 6964 203d 206d 5b22 6964 225d 0d0a 2020  id = m["id"]..  
-0006ae70: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0006ae80: 2069 2061 6e64 206e 6f74 2069 2025 2063   i and not i % c
-0006ae90: 6f6e 662e 4d61 7848 6973 746f 7279 496e  onf.MaxHistoryIn
-0006aea0: 6974 6961 6c4d 6573 7361 6765 733a 0d0a  itialMessages:..
-0006aeb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006aec0: 2020 2020 7778 2e59 6965 6c64 4966 4e65      wx.YieldIfNe
-0006aed0: 6564 6564 2829 2023 2054 6f20 6861 7665  eded() # To have
-0006aee0: 2072 6573 706f 6e73 6976 6520 4755 490d   responsive GUI.
-0006aef0: 0a0d 0a20 2020 2020 2020 2020 2020 2023  ...            #
-0006af00: 2052 6573 6574 2074 6865 2063 656e 7465   Reset the cente
-0006af10: 7265 6420 6d65 7373 6167 6520 6461 7461  red message data
-0006af20: 2c20 6173 2066 696c 7465 7269 6e67 2073  , as filtering s
-0006af30: 686f 756c 6420 6f76 6572 7269 6465 2069  hould override i
-0006af40: 740d 0a20 2020 2020 2020 2020 2020 2073  t..            s
-0006af50: 656c 662e 5f63 656e 7465 725f 6d65 7373  elf._center_mess
-0006af60: 6167 655f 696e 6465 7820 3d20 4e6f 6e65  age_index = None
-0006af70: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-0006af80: 6c66 2e5f 6365 6e74 6572 5f6d 6573 7361  lf._center_messa
-0006af90: 6765 5f69 6420 3d20 4e6f 6e65 0d0a 2020  ge_id = None..  
-0006afa0: 2020 2020 2020 2020 2020 6966 2066 6f63            if foc
-0006afb0: 7573 5f6d 6573 7361 6765 5f69 643a 0d0a  us_message_id:..
-0006afc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006afd0: 7365 6c66 2e46 6f63 7573 4d65 7373 6167  self.FocusMessag
-0006afe0: 6528 666f 6375 735f 6d65 7373 6167 655f  e(focus_message_
-0006aff0: 6964 290d 0a20 2020 2020 2020 2020 2020  id)..           
-0006b000: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-0006b010: 2020 2020 2020 2020 7365 6c66 2e53 6372          self.Scr
-0006b020: 6f6c 6c54 6f4c 696e 6528 7365 6c66 2e4c  ollToLine(self.L
-0006b030: 696e 6543 6f75 6e74 290d 0a20 2020 2020  ineCount)..     
-0006b040: 2020 2020 2020 2073 656c 662e 5468 6177         self.Thaw
-0006b050: 2829 0d0a 2020 2020 2020 2020 656c 7365  ()..        else
-0006b060: 3a0d 0a20 2020 2020 2020 2020 2020 2023  :..            #
-0006b070: 204e 6f20 6d65 7373 6167 6573 2074 6f20   No messages to 
-0006b080: 7368 6f77 0d0a 2020 2020 2020 2020 2020  show..          
-0006b090: 2020 7365 6c66 2e43 6c65 6172 416c 6c28    self.ClearAll(
-0006b0a0: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
-0006b0b0: 656c 662e 5f61 7070 656e 645f 7465 7874  elf._append_text
-0006b0c0: 2873 656c 662e 5445 5854 5f4e 4f5f 4d45  (self.TEXT_NO_ME
-0006b0d0: 5353 4147 4553 2c20 2273 7065 6369 616c  SSAGES, "special
-0006b0e0: 2229 0d0a 2020 2020 2020 2020 7365 6c66  ")..        self
-0006b0f0: 2e53 6574 5265 6164 4f6e 6c79 2854 7275  .SetReadOnly(Tru
-0006b100: 6529 0d0a 0d0a 0d0a 0d0a 2020 2020 6465  e)........    de
-0006b110: 6620 5f77 7269 7465 5f65 6c65 6d65 6e74  f _write_element
-0006b120: 2873 656c 662c 2064 6f6d 2c20 7267 785f  (self, dom, rgx_
-0006b130: 6869 6768 6c69 6768 743d 4e6f 6e65 2c20  highlight=None, 
-0006b140: 7461 696c 735f 6e65 773d 4e6f 6e65 293a  tails_new=None):
-0006b150: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
-0006b160: 2020 2020 2020 2041 7070 656e 6473 2074         Appends t
-0006b170: 6865 206d 6573 7361 6765 2062 6f64 7920  he message body 
-0006b180: 746f 2074 6865 2053 7479 6c65 6454 6578  to the StyledTex
-0006b190: 7443 7472 6c2e 0d0a 0d0a 2020 2020 2020  tCtrl.....      
-0006b1a0: 2020 4070 6172 616d 2020 2064 6f6d 2020    @param   dom  
-0006b1b0: 2020 2020 2020 2020 2020 786d 6c2e 6574            xml.et
-0006b1c0: 7265 652e 6345 6c65 6d65 6e74 5472 6565  ree.cElementTree
-0006b1d0: 2e45 6c65 6d65 6e74 2069 6e73 7461 6e63  .Element instanc
-0006b1e0: 650d 0a20 2020 2020 2020 2040 7061 7261  e..        @para
-0006b1f0: 6d20 2020 7267 785f 6869 6768 6c69 6768  m   rgx_highligh
-0006b200: 7420 2069 6620 7365 742c 2073 7562 7374  t  if set, subst
-0006b210: 7269 6e67 7320 6d61 7463 6869 6e67 2074  rings matching t
-0006b220: 6865 2072 6567 6578 2061 7265 2061 6464  he regex are add
-0006b230: 6564 0d0a 2020 2020 2020 2020 2020 2020  ed..            
-0006b240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006b250: 2020 2020 696e 2068 6967 686c 6967 6874      in highlight
-0006b260: 6564 2073 7479 6c65 0d0a 2020 2020 2020  ed style..      
-0006b270: 2020 4070 6172 616d 2020 2074 6169 6c73    @param   tails
-0006b280: 5f6e 6577 2020 2020 2020 696e 7465 726e  _new      intern
-0006b290: 616c 2075 7365 2c20 7b65 6c65 6d65 6e74  al use, {element
-0006b2a0: 3a20 6d6f 6469 6669 6564 2074 6169 6c20  : modified tail 
-0006b2b0: 7374 727d 0d0a 2020 2020 2020 2020 2222  str}..        ""
-0006b2c0: 220d 0a20 2020 2020 2020 2074 6167 7374  "..        tagst
-0006b2d0: 796c 655f 6d61 7020 3d20 7b22 6222 3a20  yle_map = {"b": 
-0006b2e0: 2262 6f6c 6422 2c20 2269 223a 2022 6974  "bold", "i": "it
-0006b2f0: 616c 6963 222c 2022 7322 3a20 2273 7472  alic", "s": "str
-0006b300: 696b 6522 2c0d 0a20 2020 2020 2020 2020  ike",..         
-0006b310: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0006b320: 626f 6479 7374 6174 7573 223a 2022 7370  bodystatus": "sp
-0006b330: 6563 6961 6c22 2c20 2022 7175 6f74 6566  ecial",  "quotef
-0006b340: 726f 6d22 3a20 2273 7065 6369 616c 222c  rom": "special",
-0006b350: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0006b360: 2020 2020 2020 2020 2020 2261 223a 2022            "a": "
-0006b370: 6c69 6e6b 222c 2022 7373 223a 2022 6465  link", "ss": "de
-0006b380: 6661 756c 7422 2c20 2261 7422 3a20 2262  fault", "at": "b
-0006b390: 6f6c 6422 7d0d 0a20 2020 2020 2020 206f  old"}..        o
-0006b3a0: 7468 6572 5f74 6167 7320 3d20 5b22 626c  ther_tags = ["bl
-0006b3b0: 696e 6b22 2c20 2266 6f6e 7422 2c20 2262  ink", "font", "b
-0006b3c0: 6f64 7973 7461 7475 7322 2c20 2269 222c  odystatus", "i",
-0006b3d0: 2022 7370 616e 222c 2022 666c 6167 222c   "span", "flag",
-0006b3e0: 2022 7072 6522 5d0d 0a20 2020 2020 2020   "pre"]..       
-0006b3f0: 2074 6f5f 736b 6970 203d 207b 7d20 2320   to_skip = {} # 
-0006b400: 7b65 6c65 6d65 6e74 2074 6f20 736b 6970  {element to skip
-0006b410: 3a20 5472 7565 2c20 7d0d 0a20 2020 2020  : True, }..     
-0006b420: 2020 2074 6169 6c73 5f6e 6577 203d 207b     tails_new = {
-0006b430: 7d20 6966 2074 6169 6c73 5f6e 6577 2069  } if tails_new i
-0006b440: 7320 4e6f 6e65 2065 6c73 6520 7461 696c  s None else tail
-0006b450: 735f 6e65 770d 0a20 2020 2020 2020 206c  s_new..        l
-0006b460: 696e 6566 6565 645f 6669 6e61 6c20 3d20  inefeed_final = 
-0006b470: 225c 6e5c 6e22 2023 2044 6563 7265 6173  "\n\n" # Decreas
-0006b480: 6564 2069 6620 7175 6f74 6566 726f 6d20  ed if quotefrom 
-0006b490: 6973 206c 6173 740d 0a0d 0a20 2020 2020  is last....     
-0006b4a0: 2020 2066 6f72 2065 2069 6e20 646f 6d2e     for e in dom.
-0006b4b0: 6974 6572 2829 3a0d 0a20 2020 2020 2020  iter():..       
-0006b4c0: 2020 2020 2023 2050 6f73 7369 626c 6520       # Possible 
-0006b4d0: 7461 6773 3a20 617c 627c 7c69 7c73 7c62  tags: a|b||i|s|b
-0006b4e0: 6f64 7973 7461 7475 737c 7175 6f74 657c  odystatus|quote|
-0006b4f0: 7175 6f74 6566 726f 6d7c 6d73 6773 7461  quotefrom|msgsta
-0006b500: 7475 737c 0d0a 2020 2020 2020 2020 2020  tus|..          
-0006b510: 2020 2320 2020 2020 2020 2020 2020 2020    #             
-0006b520: 2020 2073 7061 6e7c 7370 6563 6961 6c7c     span|special|
-0006b530: 786d 6c7c 666f 6e74 7c62 6c69 6e6b 0d0a  xml|font|blink..
-0006b540: 2020 2020 2020 2020 2020 2020 6966 2065              if e
-0006b550: 2069 6e20 746f 5f73 6b69 703a 0d0a 2020   in to_skip:..  
-0006b560: 2020 2020 2020 2020 2020 2020 2020 636f                co
-0006b570: 6e74 696e 7565 0d0a 2020 2020 2020 2020  ntinue..        
-0006b580: 2020 2020 7374 796c 6520 3d20 7461 6773      style = tags
-0006b590: 7479 6c65 5f6d 6170 2e67 6574 2865 2e74  tyle_map.get(e.t
-0006b5a0: 6167 2c20 2264 6566 6175 6c74 2229 0d0a  ag, "default")..
-0006b5b0: 2020 2020 2020 2020 2020 2020 7465 7874              text
-0006b5c0: 203d 2065 2e74 6578 7420 6f72 2022 220d   = e.text or "".
-0006b5d0: 0a20 2020 2020 2020 2020 2020 2074 6169  .            tai
-0006b5e0: 6c20 3d20 7461 696c 735f 6e65 775b 655d  l = tails_new[e]
-0006b5f0: 2069 6620 6520 696e 2074 6169 6c73 5f6e   if e in tails_n
-0006b600: 6577 2065 6c73 6520 2865 2e74 6169 6c20  ew else (e.tail 
-0006b610: 6f72 2022 2229 0d0a 2020 2020 2020 2020  or "")..        
-0006b620: 2020 2020 6368 696c 6472 656e 203d 205b      children = [
-0006b630: 5d0d 0a20 2020 2020 2020 2020 2020 2069  ]..            i
-0006b640: 6620 6973 696e 7374 616e 6365 2874 6578  f isinstance(tex
-0006b650: 742c 2073 6978 2e62 696e 6172 795f 7479  t, six.binary_ty
-0006b660: 7065 293a 0d0a 2020 2020 2020 2020 2020  pe):..          
-0006b670: 2020 2020 2020 7465 7874 203d 2074 6578        text = tex
-0006b680: 742e 6465 636f 6465 2822 7574 662d 3822  t.decode("utf-8"
-0006b690: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
-0006b6a0: 6620 6973 696e 7374 616e 6365 2874 6169  f isinstance(tai
-0006b6b0: 6c2c 2073 6978 2e62 696e 6172 795f 7479  l, six.binary_ty
-0006b6c0: 7065 293a 0d0a 2020 2020 2020 2020 2020  pe):..          
-0006b6d0: 2020 2020 2020 7461 696c 203d 2074 6169        tail = tai
-0006b6e0: 6c2e 6465 636f 6465 2822 7574 662d 3822  l.decode("utf-8"
-0006b6f0: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
-0006b700: 6620 2261 2220 3d3d 2065 2e74 6167 3a0d  f "a" == e.tag:.
-0006b710: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0006b720: 2068 7265 6620 3d20 652e 6765 7428 2268   href = e.get("h
-0006b730: 7265 6622 290d 0a20 2020 2020 2020 2020  ref")..         
-0006b740: 2020 2020 2020 2069 6620 6872 6566 2e73         if href.s
-0006b750: 7461 7274 7377 6974 6828 2266 696c 653a  tartswith("file:
-0006b760: 2229 3a0d 0a20 2020 2020 2020 2020 2020  "):..           
-0006b770: 2020 2020 2020 2020 2070 6174 686e 616d           pathnam
-0006b780: 6520 3d20 7572 6c6c 6962 2e72 6571 7565  e = urllib.reque
-0006b790: 7374 2e75 726c 3270 6174 686e 616d 6528  st.url2pathname(
-0006b7a0: 652e 6765 7428 2268 7265 6622 295b 353a  e.get("href")[5:
-0006b7b0: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
-0006b7c0: 2020 2020 2020 2020 7365 6c66 2e5f 6669          self._fi
-0006b7d0: 6c65 6c69 6e6b 735b 7365 6c66 2e53 5443  lelinks[self.STC
-0006b7e0: 2e4c 656e 6774 685d 203d 2070 6174 686e  .Length] = pathn
-0006b7f0: 616d 650d 0a20 2020 2020 2020 2020 2020  ame..           
-0006b800: 2020 2020 2065 6c69 6620 7265 2e6d 6174       elif re.mat
-0006b810: 6368 2822 5e5b 612d 7a5d 2b25 7322 2025  ch("^[a-z]+%s" %
-0006b820: 2072 652e 6573 6361 7065 2822 3a2f 2f22   re.escape("://"
-0006b830: 292c 2068 7265 6629 3a0d 0a20 2020 2020  ), href):..     
-0006b840: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0006b850: 656c 662e 5f75 726c 6c69 6e6b 735b 7365  elf._urllinks[se
-0006b860: 6c66 2e53 5443 2e4c 656e 6774 685d 203d  lf.STC.Length] =
-0006b870: 2068 7265 660d 0a20 2020 2020 2020 2020   href..         
-0006b880: 2020 2020 2020 206c 696e 6566 6565 645f         linefeed_
-0006b890: 6669 6e61 6c20 3d20 225c 6e5c 6e22 0d0a  final = "\n\n"..
-0006b8a0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-0006b8b0: 2022 7373 2220 3d3d 2065 2e74 6167 3a0d   "ss" == e.tag:.
-0006b8c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0006b8d0: 2074 6578 7420 3d20 652e 7465 7874 0d0a   text = e.text..
-0006b8e0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-0006b8f0: 2022 7175 6f74 6522 203d 3d20 652e 7461   "quote" == e.ta
-0006b900: 673a 0d0a 2020 2020 2020 2020 2020 2020  g:..            
-0006b910: 2020 2020 7465 7874 203d 2022 5c22 2220      text = "\"" 
-0006b920: 2b20 7465 7874 0d0a 2020 2020 2020 2020  + text..        
-0006b930: 2020 2020 2020 2020 6368 696c 6472 656e          children
-0006b940: 203d 206c 6973 7428 6529 0d0a 2020 2020   = list(e)..    
-0006b950: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-0006b960: 656e 2863 6869 6c64 7265 6e29 203e 2031  en(children) > 1
-0006b970: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0006b980: 2020 2020 2020 2023 204c 6173 7420 656c         # Last el
-0006b990: 656d 656e 7420 6973 2061 6c77 6179 7320  ement is always 
-0006b9a0: 7175 6f74 6566 726f 6d0d 0a20 2020 2020  quotefrom..     
-0006b9b0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0006b9c0: 6869 6c64 7461 696c 203d 2063 6869 6c64  hildtail = child
-0006b9d0: 7265 6e5b 2d32 5d2e 7461 696c 2069 6620  ren[-2].tail if 
-0006b9e0: 6368 696c 6472 656e 5b2d 325d 2e74 6169  children[-2].tai
-0006b9f0: 6c20 656c 7365 2022 220d 0a20 2020 2020  l else ""..     
-0006ba00: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0006ba10: 6169 6c73 5f6e 6577 5b63 6869 6c64 7265  ails_new[childre
-0006ba20: 6e5b 2d32 5d5d 203d 2063 6869 6c64 7461  n[-2]] = childta
-0006ba30: 696c 202b 2022 5c22 220d 0a20 2020 2020  il + "\""..     
-0006ba40: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0006ba50: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0006ba60: 2020 2020 2020 7465 7874 202b 3d20 225c        text += "\
-0006ba70: 2222 0d0a 2020 2020 2020 2020 2020 2020  ""..            
-0006ba80: 2020 2020 6c69 6e65 6665 6564 5f66 696e      linefeed_fin
-0006ba90: 616c 203d 2022 5c6e 220d 0a20 2020 2020  al = "\n"..     
-0006baa0: 2020 2020 2020 2065 6c69 6620 2271 756f         elif "quo
-0006bab0: 7465 6672 6f6d 2220 3d3d 2065 2e74 6167  tefrom" == e.tag
-0006bac0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0006bad0: 2020 2074 6578 7420 3d20 225c 6e25 735c     text = "\n%s\
-0006bae0: 6e22 2025 2074 6578 740d 0a20 2020 2020  n" % text..     
-0006baf0: 2020 2020 2020 2065 6c69 6620 652e 7461         elif e.ta
-0006bb00: 6720 696e 205b 2278 6d6c 222c 2022 6222  g in ["xml", "b"
-0006bb10: 5d3a 0d0a 2020 2020 2020 2020 2020 2020  ]:..            
-0006bb20: 2020 2020 6c69 6e65 6665 6564 5f66 696e      linefeed_fin
-0006bb30: 616c 203d 2022 5c6e 5c6e 220d 0a20 2020  al = "\n\n"..   
-0006bb40: 2020 2020 2020 2020 2065 6c69 6620 2261           elif "a
-0006bb50: 7422 203d 3d20 652e 7461 673a 0d0a 2020  t" == e.tag:..  
-0006bb60: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0006bb70: 2074 6578 7420 616e 6420 6e6f 7420 7465   text and not te
-0006bb80: 7874 2e73 7461 7274 7377 6974 6828 2240  xt.startswith("@
-0006bb90: 2229 3a20 7465 7874 203d 2022 4022 202b  "): text = "@" +
-0006bba0: 2074 6578 740d 0a20 2020 2020 2020 2020   text..         
-0006bbb0: 2020 2065 6c69 6620 2273 2220 3d3d 2065     elif "s" == e
-0006bbc0: 2e74 6167 3a0d 0a20 2020 2020 2020 2020  .tag:..         
-0006bbd0: 2020 2020 2020 2074 6578 7420 3d20 227e         text = "~
-0006bbe0: 2573 7e22 2025 2074 6578 7420 2320 5354  %s~" % text # ST
-0006bbf0: 4320 646f 6573 206e 6f74 2073 7570 706f  C does not suppo
-0006bc00: 7274 2073 7472 696b 6574 6872 6f75 6768  rt strikethrough
-0006bc10: 2073 7479 6c65 0d0a 2020 2020 2020 2020   style..        
-0006bc20: 2020 2020 656c 6966 2065 2e74 6167 206e      elif e.tag n
-0006bc30: 6f74 2069 6e20 6f74 6865 725f 7461 6773  ot in other_tags
-0006bc40: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0006bc50: 2020 2074 6578 7420 3d20 2222 0d0a 2020     text = ""..  
-0006bc60: 2020 2020 2020 2020 2020 6966 2074 6578            if tex
-0006bc70: 743a 0d0a 2020 2020 2020 2020 2020 2020  t:..            
-0006bc80: 2020 2020 7365 6c66 2e5f 6170 7065 6e64      self._append
-0006bc90: 5f74 6578 7428 7465 7874 2c20 7374 796c  _text(text, styl
-0006bca0: 652c 2072 6778 5f68 6967 686c 6967 6874  e, rgx_highlight
-0006bcb0: 290d 0a20 2020 2020 2020 2020 2020 2066  )..            f
-0006bcc0: 6f72 2069 2069 6e20 6368 696c 6472 656e  or i in children
-0006bcd0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0006bce0: 2020 2073 656c 662e 5f77 7269 7465 5f65     self._write_e
-0006bcf0: 6c65 6d65 6e74 2869 2c20 7267 785f 6869  lement(i, rgx_hi
-0006bd00: 6768 6c69 6768 742c 2074 6169 6c73 5f6e  ghlight, tails_n
-0006bd10: 6577 290d 0a20 2020 2020 2020 2020 2020  ew)..           
-0006bd20: 2020 2020 2074 6f5f 736b 6970 5b69 5d20       to_skip[i] 
-0006bd30: 3d20 5472 7565 0d0a 2020 2020 2020 2020  = True..        
-0006bd40: 2020 2020 6966 2074 6169 6c3a 0d0a 2020      if tail:..  
-0006bd50: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0006bd60: 6c66 2e5f 6170 7065 6e64 5f74 6578 7428  lf._append_text(
-0006bd70: 7461 696c 2c20 2264 6566 6175 6c74 222c  tail, "default",
-0006bd80: 2072 6778 5f68 6967 686c 6967 6874 290d   rgx_highlight).
-0006bd90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0006bda0: 206c 696e 6566 6565 645f 6669 6e61 6c20   linefeed_final 
-0006bdb0: 3d20 225c 6e5c 6e22 0d0a 2020 2020 2020  = "\n\n"..      
-0006bdc0: 2020 6966 2022 786d 6c22 203d 3d20 646f    if "xml" == do
-0006bdd0: 6d2e 7461 673a 0d0a 2020 2020 2020 2020  m.tag:..        
-0006bde0: 2020 2020 7365 6c66 2e5f 6170 7065 6e64      self._append
-0006bdf0: 5f74 6578 7428 6c69 6e65 6665 6564 5f66  _text(linefeed_f
-0006be00: 696e 616c 290d 0a0d 0a0d 0a20 2020 2064  inal)......    d
-0006be10: 6566 205f 6170 7065 6e64 5f74 6578 7428  ef _append_text(
-0006be20: 7365 6c66 2c20 7465 7874 2c20 7374 796c  self, text, styl
-0006be30: 653d 2264 6566 6175 6c74 222c 2072 6778  e="default", rgx
-0006be40: 5f68 6967 686c 6967 6874 3d4e 6f6e 6529  _highlight=None)
-0006be50: 3a0d 0a20 2020 2020 2020 2022 2222 0d0a  :..        """..
-0006be60: 2020 2020 2020 2020 4170 7065 6e64 7320          Appends 
-0006be70: 7465 7874 2074 6f20 7468 6520 5374 796c  text to the Styl
-0006be80: 6564 5465 7874 4374 726c 2069 6e20 7468  edTextCtrl in th
-0006be90: 6520 7370 6563 6966 6965 6420 7374 796c  e specified styl
-0006bea0: 652e 0d0a 0d0a 2020 2020 2020 2020 4070  e.....        @p
-0006beb0: 6172 616d 2020 2072 6778 5f68 6967 686c  aram   rgx_highl
-0006bec0: 6967 6874 2020 6966 2073 6574 2c20 7375  ight  if set, su
-0006bed0: 6273 7472 696e 6773 206d 6174 6368 696e  bstrings matchin
-0006bee0: 6720 7468 6520 7265 6765 7820 6172 6520  g the regex are 
-0006bef0: 6164 6465 640d 0a20 2020 2020 2020 2020  added..         
-0006bf00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006bf10: 2020 2020 2020 2069 6e20 6869 6768 6c69         in highli
-0006bf20: 6768 7465 6420 7374 796c 650d 0a20 2020  ghted style..   
-0006bf30: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-0006bf40: 2020 7465 7874 203d 2074 6578 7420 6f72    text = text or
-0006bf50: 2022 220d 0a20 2020 2020 2020 2074 6578   ""..        tex
-0006bf60: 745f 7061 7274 7320 3d20 7267 785f 6869  t_parts = rgx_hi
-0006bf70: 6768 6c69 6768 742e 7370 6c69 7428 7465  ghlight.split(te
-0006bf80: 7874 2920 6966 2072 6778 5f68 6967 686c  xt) if rgx_highl
-0006bf90: 6967 6874 2065 6c73 6520 5b74 6578 745d  ight else [text]
-0006bfa0: 0d0a 2020 2020 2020 2020 6966 2069 7369  ..        if isi
-0006bfb0: 6e73 7461 6e63 6528 7465 7874 2c20 7369  nstance(text, si
-0006bfc0: 782e 7465 7874 5f74 7970 6529 3a0d 0a20  x.text_type):.. 
-0006bfd0: 2020 2020 2020 2020 2020 2074 6578 745f             text_
-0006bfe0: 7061 7274 7320 3d20 5b78 2e65 6e63 6f64  parts = [x.encod
-0006bff0: 6528 2275 7466 2d38 2229 2066 6f72 2078  e("utf-8") for x
-0006c000: 2069 6e20 7465 7874 5f70 6172 7473 5d0d   in text_parts].
-0006c010: 0a20 2020 2020 2020 2062 6f6c 6420 3d20  .        bold = 
-0006c020: 2262 6f6c 6425 7322 2025 2073 7479 6c65  "bold%s" % style
-0006c030: 2069 6620 2262 6f6c 6425 7322 2025 2073   if "bold%s" % s
-0006c040: 7479 6c65 2069 6e20 7365 6c66 2e5f 7374  tyle in self._st
-0006c050: 796c 6573 2065 6c73 6520 7374 796c 650d  yles else style.
-0006c060: 0a20 2020 2020 2020 206c 656e 5f73 656c  .        len_sel
-0006c070: 6620 3d20 7365 6c66 2e47 6574 5465 7874  f = self.GetText
-0006c080: 4c65 6e67 7468 2829 0d0a 2020 2020 2020  Length()..      
-0006c090: 2020 7365 6c66 2e53 5443 2e41 7070 656e    self.STC.Appen
-0006c0a0: 6454 6578 7428 7465 7874 290d 0a20 2020  dText(text)..   
-0006c0b0: 2020 2020 2073 656c 662e 5354 432e 5374       self.STC.St
-0006c0c0: 6172 7453 7479 6c69 6e67 286c 656e 5f73  artStyling(len_s
-0006c0d0: 656c 6629 0d0a 2020 2020 2020 2020 7365  elf)..        se
-0006c0e0: 6c66 2e53 5443 2e53 6574 5374 796c 696e  lf.STC.SetStylin
-0006c0f0: 6728 6c65 6e28 7465 7874 292c 2073 656c  g(len(text), sel
-0006c100: 662e 5f73 7479 6c65 735b 7374 796c 655d  f._styles[style]
-0006c110: 290d 0a20 2020 2020 2020 2066 6f72 2069  )..        for i
-0006c120: 2c20 7420 696e 2065 6e75 6d65 7261 7465  , t in enumerate
-0006c130: 2874 6578 745f 7061 7274 7329 3a0d 0a20  (text_parts):.. 
-0006c140: 2020 2020 2020 2020 2020 2069 6620 6920             if i 
-0006c150: 2520 323a 0d0a 2020 2020 2020 2020 2020  % 2:..          
-0006c160: 2020 2020 2020 7365 6c66 2e53 5443 2e53        self.STC.S
-0006c170: 7461 7274 5374 796c 696e 6728 6c65 6e5f  tartStyling(len_
-0006c180: 7365 6c66 290d 0a20 2020 2020 2020 2020  self)..         
-0006c190: 2020 2020 2020 2073 656c 662e 5354 432e         self.STC.
-0006c1a0: 5365 7453 7479 6c69 6e67 286c 656e 2874  SetStyling(len(t
-0006c1b0: 292c 2073 656c 662e 5f73 7479 6c65 735b  ), self._styles[
-0006c1c0: 626f 6c64 5d29 0d0a 2020 2020 2020 2020  bold])..        
-0006c1d0: 2020 2020 6c65 6e5f 7365 6c66 202b 3d20      len_self += 
-0006c1e0: 6c65 6e28 7429 0d0a 0d0a 0d0a 2020 2020  len(t)......    
-0006c1f0: 6465 6620 5f61 7070 656e 645f 6d75 6c74  def _append_mult
-0006c200: 696c 696e 6528 7365 6c66 2c20 7465 7874  iline(self, text
-0006c210: 2c20 696e 6465 6e74 293a 0d0a 2020 2020  , indent):..    
-0006c220: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
-0006c230: 2041 7070 656e 6473 2074 6578 7420 7769   Appends text wi
-0006c240: 7468 206e 6577 206c 696e 6573 2069 6e64  th new lines ind
-0006c250: 656e 7465 6420 6174 2074 6865 2073 7065  ented at the spe
-0006c260: 6369 6669 6564 206c 6576 656c 2e0d 0a20  cified level... 
-0006c270: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
-0006c280: 2020 2020 6966 2022 5c6e 2220 696e 2074      if "\n" in t
-0006c290: 6578 743a 0d0a 2020 2020 2020 2020 2020  ext:..          
-0006c2a0: 2020 666f 7220 6c69 6e65 2069 6e20 7465    for line in te
-0006c2b0: 7874 2e73 706c 6974 6c69 6e65 7328 293a  xt.splitlines():
-0006c2c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0006c2d0: 2020 7365 6c66 2e5f 6170 7065 6e64 5f74    self._append_t
-0006c2e0: 6578 7428 2225 735c 6e22 2025 206c 696e  ext("%s\n" % lin
-0006c2f0: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
-0006c300: 2020 2020 6966 2073 656c 662e 5553 455f      if self.USE_
-0006c310: 434f 4c55 4d4e 533a 0d0a 2020 2020 2020  COLUMNS:..      
-0006c320: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0006c330: 6c66 2e53 6574 4c69 6e65 496e 6465 6e74  lf.SetLineIndent
-0006c340: 6174 696f 6e28 7365 6c66 2e4c 696e 6543  ation(self.LineC
-0006c350: 6f75 6e74 202d 2031 2c20 696e 6465 6e74  ount - 1, indent
-0006c360: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
-0006c370: 6620 7365 6c66 2e55 5345 5f43 4f4c 554d  f self.USE_COLUM
-0006c380: 4e53 3a0d 0a20 2020 2020 2020 2020 2020  NS:..           
-0006c390: 2020 2020 2073 656c 662e 5365 744c 696e       self.SetLin
-0006c3a0: 6549 6e64 656e 7461 7469 6f6e 2873 656c  eIndentation(sel
-0006c3b0: 662e 4c69 6e65 436f 756e 7420 2d20 312c  f.LineCount - 1,
-0006c3c0: 2030 290d 0a20 2020 2020 2020 2065 6c73   0)..        els
-0006c3d0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-0006c3e0: 7365 6c66 2e5f 6170 7065 6e64 5f74 6578  self._append_tex
-0006c3f0: 7428 7465 7874 290d 0a0d 0a0d 0a20 2020  t(text)......   
-0006c400: 2064 6566 2050 6f70 756c 6174 6528 7365   def Populate(se
-0006c410: 6c66 2c20 6368 6174 2c20 6462 2c20 6d65  lf, chat, db, me
-0006c420: 7373 6167 6573 3d4e 6f6e 652c 2063 656e  ssages=None, cen
-0006c430: 7465 725f 6d65 7373 6167 655f 6964 3d4e  ter_message_id=N
-0006c440: 6f6e 652c 0d0a 2020 2020 2020 2020 2020  one,..          
-0006c450: 2020 2020 2020 2066 726f 6d5f 696e 6465         from_inde
-0006c460: 783d 4e6f 6e65 293a 0d0a 2020 2020 2020  x=None):..      
-0006c470: 2020 2222 220d 0a20 2020 2020 2020 2050    """..        P
-0006c480: 6f70 756c 6174 6573 2074 6865 2063 6861  opulates the cha
-0006c490: 7420 6869 7374 6f72 7920 7769 7468 206d  t history with m
-0006c4a0: 6573 7361 6765 7320 6672 6f6d 2074 6865  essages from the
-0006c4b0: 2073 7065 6369 6669 6564 2063 6861 742e   specified chat.
-0006c4c0: 0d0a 0d0a 2020 2020 2020 2020 4070 6172  ....        @par
-0006c4d0: 616d 2020 2063 6861 7420 2020 2020 2020  am   chat       
-0006c4e0: 2020 2020 2020 2020 6368 6174 2064 6174          chat dat
-0006c4f0: 612c 2061 7320 7265 7475 726e 6564 2066  a, as returned f
-0006c500: 726f 6d20 536b 7970 6544 6174 6162 6173  rom SkypeDatabas
-0006c510: 650d 0a20 2020 2020 2020 2040 7061 7261  e..        @para
-0006c520: 6d20 2020 6462 2020 2020 2020 2020 2020  m   db          
-0006c530: 2020 2020 2020 2053 6b79 7065 4461 7461         SkypeData
-0006c540: 6261 7365 2074 6f20 7573 650d 0a20 2020  base to use..   
-0006c550: 2020 2020 2040 7061 7261 6d20 2020 6d65       @param   me
-0006c560: 7373 6167 6573 2020 2020 2020 2020 2020  ssages          
-0006c570: 206d 6573 7361 6765 7320 746f 2073 686f   messages to sho
-0006c580: 7720 2869 6620 7365 742c 206d 6573 7361  w (if set, messa
-0006c590: 6765 7320 6172 6520 6e6f 740d 0a20 2020  ges are not..   
-0006c5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006c5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006c5c0: 2072 6574 7269 6576 6564 2066 726f 6d20   retrieved from 
-0006c5d0: 6461 7461 6261 7365 290d 0a20 2020 2020  database)..     
-0006c5e0: 2020 2040 7061 7261 6d20 2020 6365 6e74     @param   cent
-0006c5f0: 6572 5f6d 6573 7361 6765 5f69 6420 2069  er_message_id  i
-0006c600: 6620 7365 742c 2073 7065 6369 6669 6573  f set, specifies
-0006c610: 2074 6865 206d 6573 7361 6765 2061 726f   the message aro
-0006c620: 756e 6420 7768 6963 680d 0a20 2020 2020  und which..     
-0006c630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006c640: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0006c650: 6f20 6365 6e74 6572 206f 7468 6572 206d  o center other m
-0006c660: 6573 7361 6765 7320 696e 2074 6865 2073  essages in the s
-0006c670: 686f 776e 2072 616e 6765 0d0a 2020 2020  hown range..    
-0006c680: 2020 2020 4070 6172 616d 2020 2066 726f      @param   fro
-0006c690: 6d5f 696e 6465 7820 2020 2020 2020 2020  m_index         
-0006c6a0: 696e 6465 7820 6f66 206d 6573 7361 6765  index of message
-0006c6b0: 2074 6f20 7368 6f77 2066 726f 6d2c 2069   to show from, i
-0006c6c0: 6620 6d65 7373 6167 6573 2067 6976 656e  f messages given
-0006c6d0: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
-0006c6e0: 2020 2020 2020 2073 656c 662e 436c 6561         self.Clea
-0006c6f0: 7241 6c6c 2829 0d0a 2020 2020 2020 2020  rAll()..        
-0006c700: 7365 6c66 2e52 6566 7265 7368 2829 0d0a  self.Refresh()..
-0006c710: 2020 2020 2020 2020 7365 6c66 2e5f 6365          self._ce
-0006c720: 6e74 6572 5f6d 6573 7361 6765 5f69 6e64  nter_message_ind
-0006c730: 6578 203d 204e 6f6e 650d 0a20 2020 2020  ex = None..     
-0006c740: 2020 2073 656c 662e 5f63 656e 7465 725f     self._center_
-0006c750: 6d65 7373 6167 655f 6964 203d 204e 6f6e  message_id = Non
-0006c760: 650d 0a0d 0a20 2020 2020 2020 2069 6620  e....        if 
-0006c770: 6368 6174 2069 7320 4e6f 6e65 3a0d 0a20  chat is None:.. 
-0006c780: 2020 2020 2020 2020 2020 206d 6573 7361             messa
-0006c790: 6765 735f 6375 7272 656e 742c 206d 6573  ges_current, mes
-0006c7a0: 7361 6765 5f72 616e 6765 203d 205b 5d2c  sage_range = [],
-0006c7b0: 205b 5d0d 0a20 2020 2020 2020 2065 6c69   []..        eli
-0006c7c0: 6620 6d65 7373 6167 6573 2069 7320 4e6f  f messages is No
-0006c7d0: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
-0006c7e0: 206d 6d2c 2063 656e 7465 725f 6d65 7373   mm, center_mess
-0006c7f0: 6167 655f 6920 3d20 5b5d 2c20 4e6f 6e65  age_i = [], None
-0006c800: 0d0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
-0006c810: 7220 692c 206d 2069 6e20 656e 756d 6572  r i, m in enumer
-0006c820: 6174 6528 6462 2e67 6574 5f6d 6573 7361  ate(db.get_messa
-0006c830: 6765 7328 6368 6174 2c20 6173 6365 6e64  ges(chat, ascend
-0006c840: 696e 673d 4661 6c73 6529 293a 0d0a 2020  ing=False)):..  
-0006c850: 2020 2020 2020 2020 2020 2020 2020 6d6d                mm
-0006c860: 2e61 7070 656e 6428 6d29 0d0a 2020 2020  .append(m)..    
-0006c870: 2020 2020 2020 2020 2020 2020 6966 206d              if m
-0006c880: 5b22 6964 225d 203d 3d20 6365 6e74 6572  ["id"] == center
-0006c890: 5f6d 6573 7361 6765 5f69 643a 0d0a 2020  _message_id:..  
-0006c8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006c8b0: 2020 7365 6c66 2e5f 6365 6e74 6572 5f6d    self._center_m
-0006c8c0: 6573 7361 6765 5f69 6420 3d20 6365 6e74  essage_id = cent
-0006c8d0: 6572 5f6d 6573 7361 6765 5f69 640d 0a20  er_message_id.. 
-0006c8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006c8f0: 2020 2063 656e 7465 725f 6d65 7373 6167     center_messag
-0006c900: 655f 6920 3d20 690d 0a0d 0a20 2020 2020  e_i = i....     
-0006c910: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-0006c920: 6c66 2e5f 6365 6e74 6572 5f6d 6573 7361  lf._center_messa
-0006c930: 6765 5f69 6420 6973 206e 6f74 204e 6f6e  ge_id is not Non
-0006c940: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-0006c950: 2020 2020 2020 2020 6966 2069 202b 2031          if i + 1
-0006c960: 202d 2063 656e 7465 725f 6d65 7373 6167   - center_messag
-0006c970: 655f 6920 3e3d 2063 6f6e 662e 4d61 7848  e_i >= conf.MaxH
-0006c980: 6973 746f 7279 496e 6974 6961 6c4d 6573  istoryInitialMes
-0006c990: 7361 6765 7320 2f2f 2032 3a0d 0a20 2020  sages // 2:..   
-0006c9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006c9b0: 2020 2020 2062 7265 616b 2023 2066 6f72       break # for
-0006c9c0: 2069 2c20 6d0d 0a20 2020 2020 2020 2020   i, m..         
-0006c9d0: 2020 2020 2020 2065 6c69 6620 6920 2b20         elif i + 
-0006c9e0: 3120 3e3d 2063 6f6e 662e 4d61 7848 6973  1 >= conf.MaxHis
-0006c9f0: 746f 7279 496e 6974 6961 6c4d 6573 7361  toryInitialMessa
-0006ca00: 6765 733a 2062 7265 616b 2023 2066 6f72  ges: break # for
-0006ca10: 2069 2c20 6d0d 0a0d 0a20 2020 2020 2020   i, m....       
-0006ca20: 2020 2020 206d 6573 7361 6765 735f 6375       messages_cu
-0006ca30: 7272 656e 742c 206d 6573 7361 6765 5f72  rrent, message_r
-0006ca40: 616e 6765 203d 206d 6d5b 3a3a 2d31 5d2c  ange = mm[::-1],
-0006ca50: 206d 6d5b 3a3a 2d31 5d20 2320 5365 7420   mm[::-1] # Set 
-0006ca60: 6173 6365 6e64 696e 670d 0a20 2020 2020  ascending..     
-0006ca70: 2020 2020 2020 2069 6620 6365 6e74 6572         if center
-0006ca80: 5f6d 6573 7361 6765 5f69 2069 7320 6e6f  _message_i is no
-0006ca90: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
-0006caa0: 2020 2020 2020 2020 2073 656c 662e 5f63           self._c
-0006cab0: 656e 7465 725f 6d65 7373 6167 655f 696e  enter_message_in
-0006cac0: 6465 7820 3d20 6c65 6e28 6d6d 2920 2d20  dex = len(mm) - 
-0006cad0: 6365 6e74 6572 5f6d 6573 7361 6765 5f69  center_message_i
-0006cae0: 2d31 0d0a 2020 2020 2020 2020 656c 7365  -1..        else
-0006caf0: 3a0d 0a20 2020 2020 2020 2020 2020 206d  :..            m
-0006cb00: 6573 7361 6765 735f 6375 7272 656e 742c  essages_current,
-0006cb10: 206d 6573 7361 6765 5f72 616e 6765 203d   message_range =
-0006cb20: 206d 6573 7361 6765 735b 6672 6f6d 5f69   messages[from_i
-0006cb30: 6e64 6578 206f 7220 303a 5d2c 206d 6573  ndex or 0:], mes
-0006cb40: 7361 6765 735b 3a5d 0d0a 0d0a 2020 2020  sages[:]....    
-0006cb50: 2020 2020 7365 6c66 2e5f 6368 6174 203d      self._chat =
-0006cb60: 2063 6861 740d 0a20 2020 2020 2020 2073   chat..        s
-0006cb70: 656c 662e 5f64 6220 3d20 6462 0d0a 2020  elf._db = db..  
-0006cb80: 2020 2020 2020 7365 6c66 2e5f 6d65 7373        self._mess
-0006cb90: 6167 6573 5f63 7572 7265 6e74 203d 206d  ages_current = m
-0006cba0: 6573 7361 6765 735f 6375 7272 656e 740d  essages_current.
-0006cbb0: 0a20 2020 2020 2020 2073 656c 662e 5f6d  .        self._m
-0006cbc0: 6573 7361 6765 7320 3d20 6d65 7373 6167  essages = messag
-0006cbd0: 655f 7261 6e67 650d 0a20 2020 2020 2020  e_range..       
-0006cbe0: 2073 656c 662e 5f66 696c 7465 725b 2264   self._filter["d
-0006cbf0: 6174 6572 616e 6765 225d 203d 205b 0d0a  aterange"] = [..
-0006cc00: 2020 2020 2020 2020 2020 2020 6d65 7373              mess
-0006cc10: 6167 6573 5f63 7572 7265 6e74 5b20 305d  ages_current[ 0]
-0006cc20: 5b22 6461 7465 7469 6d65 225d 2e64 6174  ["datetime"].dat
-0006cc30: 6528 2920 6966 206d 6573 7361 6765 735f  e() if messages_
-0006cc40: 6375 7272 656e 7420 656c 7365 204e 6f6e  current else Non
-0006cc50: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
-0006cc60: 6d65 7373 6167 6573 5f63 7572 7265 6e74  messages_current
-0006cc70: 5b2d 315d 5b22 6461 7465 7469 6d65 225d  [-1]["datetime"]
-0006cc80: 2e64 6174 6528 2920 6966 206d 6573 7361  .date() if messa
-0006cc90: 6765 735f 6375 7272 656e 7420 656c 7365  ges_current else
-0006cca0: 204e 6f6e 650d 0a20 2020 2020 2020 205d   None..        ]
-0006ccb0: 0d0a 2020 2020 2020 2020 7365 6c66 2e52  ..        self.R
-0006ccc0: 6566 7265 7368 4d65 7373 6167 6573 2863  efreshMessages(c
-0006ccd0: 656e 7465 725f 6d65 7373 6167 655f 6964  enter_message_id
-0006cce0: 290d 0a0d 0a0d 0a20 2020 2064 6566 204e  )......    def N
-0006ccf0: 6578 7446 726f 6d41 7574 686f 7228 7365  extFromAuthor(se
-0006cd00: 6c66 2c20 6175 7468 6f72 2c20 6375 7272  lf, author, curr
-0006cd10: 656e 742c 2064 6972 6563 7469 6f6e 3d2b  ent, direction=+
-0006cd20: 3129 3a0d 0a20 2020 2020 2020 2022 2222  1):..        """
-0006cd30: 0d0a 2020 2020 2020 2020 5363 726f 6c6c  ..        Scroll
-0006cd40: 7320 746f 2061 6e6f 7468 6572 206d 6573  s to another mes
-0006cd50: 7361 6765 2066 726f 6d20 7361 6d65 2061  sage from same a
-0006cd60: 7574 686f 722e 0d0a 0d0a 2020 2020 2020  uthor.....      
-0006cd70: 2020 4070 6172 616d 2020 2061 7574 686f    @param   autho
-0006cd80: 7220 2020 2020 736b 7970 656e 616d 6520  r     skypename 
-0006cd90: 6f66 2061 7574 686f 7220 746f 2066 696e  of author to fin
-0006cda0: 640d 0a20 2020 2020 2020 2040 7061 7261  d..        @para
-0006cdb0: 6d20 2020 6375 7272 656e 7420 2020 206d  m   current    m
-0006cdc0: 6573 7361 6765 2069 6e64 6578 2069 6e20  essage index in 
-0006cdd0: 6375 7272 656e 7420 636f 6e74 656e 7420  current content 
-0006cde0: 746f 2073 7461 7274 2066 726f 6d0d 0a20  to start from.. 
-0006cdf0: 2020 2020 2020 2040 7061 7261 6d20 2020         @param   
-0006ce00: 6469 7265 6374 696f 6e20 2070 6f73 6974  direction  posit
-0006ce10: 6976 6520 666f 7220 666f 7277 6172 6473  ive for forwards
-0006ce20: 2c20 6e65 6761 7469 7665 2066 6f72 2062  , negative for b
-0006ce30: 6163 6b77 6172 6473 0d0a 2020 2020 2020  ackwards..      
-0006ce40: 2020 2222 220d 0a20 2020 2020 2020 2073    """..        s
-0006ce50: 7465 7020 3d20 2d31 2069 6620 6469 7265  tep = -1 if dire
-0006ce60: 6374 696f 6e20 3c20 3020 656c 7365 202b  ction < 0 else +
-0006ce70: 310d 0a20 2020 2020 2020 2069 6478 2c20  1..        idx, 
-0006ce80: 6d6d 203d 2063 7572 7265 6e74 202b 2073  mm = current + s
-0006ce90: 7465 702c 2073 656c 662e 5f6d 6573 7361  tep, self._messa
-0006cea0: 6765 735f 6375 7272 656e 7420 6f72 205b  ges_current or [
-0006ceb0: 5d0d 0a20 2020 2020 2020 206d 7367 203d  ]..        msg =
-0006cec0: 206d 6d5b 6964 785d 2069 6620 3020 3c3d   mm[idx] if 0 <=
-0006ced0: 2069 6478 203c 206c 656e 286d 6d29 2065   idx < len(mm) e
-0006cee0: 6c73 6520 4e6f 6e65 0d0a 2020 2020 2020  lse None..      
-0006cef0: 2020 7768 696c 6520 6d73 673a 0d0a 2020    while msg:..  
-0006cf00: 2020 2020 2020 2020 2020 6966 206d 7367            if msg
-0006cf10: 5b22 6175 7468 6f72 225d 203d 3d20 6175  ["author"] == au
-0006cf20: 7468 6f72 3a0d 0a20 2020 2020 2020 2020  thor:..         
-0006cf30: 2020 2020 2020 2067 7569 6261 7365 2e73         guibase.s
-0006cf40: 7461 7475 7328 290d 0a20 2020 2020 2020  tatus()..       
-0006cf50: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0006cf60: 7365 6c66 2e46 6f63 7573 4d65 7373 6167  self.FocusMessag
-0006cf70: 6528 6d73 675b 2269 6422 5d29 0d0a 2020  e(msg["id"])..  
-0006cf80: 2020 2020 2020 2020 2020 6964 7820 2b3d            idx +=
-0006cf90: 2073 7465 700d 0a20 2020 2020 2020 2020   step..         
-0006cfa0: 2020 206d 7367 203d 206d 6d5b 6964 785d     msg = mm[idx]
-0006cfb0: 2069 6620 3020 3c3d 2069 6478 203c 206c   if 0 <= idx < l
-0006cfc0: 656e 286d 6d29 2065 6c73 6520 4e6f 6e65  en(mm) else None
-0006cfd0: 0d0a 2020 2020 2020 2020 6c61 6265 6c20  ..        label 
-0006cfe0: 3d20 2270 7265 7669 6f75 7322 2069 6620  = "previous" if 
-0006cff0: 6469 7265 6374 696f 6e20 3c20 3020 656c  direction < 0 el
-0006d000: 7365 2022 6e65 7874 220d 0a20 2020 2020  se "next"..     
-0006d010: 2020 206e 616d 6520 3d20 7365 6c66 2e5f     name = self._
-0006d020: 6462 2e67 6574 5f61 7574 686f 725f 6e61  db.get_author_na
-0006d030: 6d65 287b 2261 7574 686f 7222 3a20 6175  me({"author": au
-0006d040: 7468 6f72 7d29 0d0a 2020 2020 2020 2020  thor})..        
-0006d050: 6775 6962 6173 652e 7374 6174 7573 2822  guibase.status("
-0006d060: 4e6f 2025 7320 6d65 7373 6167 6520 6672  No %s message fr
-0006d070: 6f6d 2025 7320 666f 756e 6420 696e 2063  om %s found in c
-0006d080: 7572 7265 6e74 2076 6965 772e 222c 206c  urrent view.", l
-0006d090: 6162 656c 2c20 6e61 6d65 290d 0a0d 0a0d  abel, name).....
-0006d0a0: 0a20 2020 2064 6566 204e 6578 7454 696d  .    def NextTim
-0006d0b0: 6528 7365 6c66 2c20 756e 6974 2c20 6375  e(self, unit, cu
-0006d0c0: 7272 656e 742c 2064 6972 6563 7469 6f6e  rrent, direction
-0006d0d0: 3d2b 3129 3a0d 0a20 2020 2020 2020 2022  =+1):..        "
-0006d0e0: 2222 0d0a 2020 2020 2020 2020 5363 726f  ""..        Scro
-0006d0f0: 6c6c 7320 746f 206d 6573 7361 6765 2066  lls to message f
-0006d100: 726f 6d20 6e65 7874 2074 696d 6520 756e  rom next time un
-0006d110: 6974 2e0d 0a0d 0a20 2020 2020 2020 2040  it.....        @
-0006d120: 7061 7261 6d20 2020 756e 6974 2020 2020  param   unit    
-0006d130: 2020 2022 6461 7922 206f 7220 2277 6565     "day" or "wee
-0006d140: 6b22 206f 7220 226d 6f6e 7468 220d 0a20  k" or "month".. 
-0006d150: 2020 2020 2020 2040 7061 7261 6d20 2020         @param   
-0006d160: 6375 7272 656e 7420 2020 206d 6573 7361  current    messa
-0006d170: 6765 2069 6e64 6578 2069 6e20 6375 7272  ge index in curr
-0006d180: 656e 7420 636f 6e74 656e 7420 746f 2073  ent content to s
-0006d190: 7461 7274 2066 726f 6d0d 0a20 2020 2020  tart from..     
-0006d1a0: 2020 2040 7061 7261 6d20 2020 6469 7265     @param   dire
-0006d1b0: 6374 696f 6e20 2070 6f73 6974 6976 6520  ction  positive 
-0006d1c0: 666f 7220 666f 7277 6172 6473 2c20 6e65  for forwards, ne
-0006d1d0: 6761 7469 7665 2066 6f72 2062 6163 6b77  gative for backw
-0006d1e0: 6172 6473 0d0a 2020 2020 2020 2020 2222  ards..        ""
-0006d1f0: 220d 0a20 2020 2020 2020 2069 6620 756e  "..        if un
-0006d200: 6974 206e 6f74 2069 6e20 2822 6461 7922  it not in ("day"
-0006d210: 2c20 2277 6565 6b22 2c20 226d 6f6e 7468  , "week", "month
-0006d220: 2229 3a20 7265 7475 726e 0d0a 2020 2020  "): return..    
-0006d230: 2020 2020 6775 6962 6173 652e 7374 6174      guibase.stat
-0006d240: 7573 2829 0d0a 2020 2020 2020 2020 7374  us()..        st
-0006d250: 6570 203d 202d 3120 6966 2064 6972 6563  ep = -1 if direc
-0006d260: 7469 6f6e 203c 2030 2065 6c73 6520 2b31  tion < 0 else +1
-0006d270: 0d0a 2020 2020 2020 2020 6964 782c 206d  ..        idx, m
-0006d280: 6d20 3d20 6375 7272 656e 7420 2b20 7374  m = current + st
-0006d290: 6570 2c20 7365 6c66 2e5f 6d65 7373 6167  ep, self._messag
-0006d2a0: 6573 5f63 7572 7265 6e74 206f 7220 5b5d  es_current or []
-0006d2b0: 0d0a 2020 2020 2020 2020 6d73 6730 203d  ..        msg0 =
-0006d2c0: 206d 6d5b 6375 7272 656e 745d 2069 6620   mm[current] if 
-0006d2d0: 3020 3c3d 2063 7572 7265 6e74 203c 206c  0 <= current < l
-0006d2e0: 656e 286d 6d29 2065 6c73 6520 4e6f 6e65  en(mm) else None
-0006d2f0: 0d0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
-0006d300: 206d 7367 303a 2072 6574 7572 6e0d 0a0d   msg0: return...
-0006d310: 0a20 2020 2020 2020 2064 6566 206d 616b  .        def mak
-0006d320: 655f 7468 7265 7368 6f6c 6428 6474 2c20  e_threshold(dt, 
-0006d330: 7374 6570 293a 0d0a 2020 2020 2020 2020  step):..        
-0006d340: 2020 2020 6474 203d 2064 742e 7265 706c      dt = dt.repl
-0006d350: 6163 6528 686f 7572 3d30 2c20 6d69 6e75  ace(hour=0, minu
-0006d360: 7465 3d30 2c20 7365 636f 6e64 3d30 2c20  te=0, second=0, 
-0006d370: 6d69 6372 6f73 6563 6f6e 643d 3029 0d0a  microsecond=0)..
-0006d380: 2020 2020 2020 2020 2020 2020 6966 2020              if  
-0006d390: 2022 6461 7922 2020 203d 3d20 756e 6974   "day"   == unit
-0006d3a0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0006d3b0: 2020 2072 6573 756c 7420 3d20 6474 202b     result = dt +
-0006d3c0: 2073 7465 7020 2a20 6461 7465 7469 6d65   step * datetime
-0006d3d0: 2e74 696d 6564 656c 7461 2864 6179 733d  .timedelta(days=
-0006d3e0: 3129 0d0a 2020 2020 2020 2020 2020 2020  1)..            
-0006d3f0: 656c 6966 2022 7765 656b 2220 203d 3d20  elif "week"  == 
-0006d400: 756e 6974 3a0d 0a20 2020 2020 2020 2020  unit:..         
-0006d410: 2020 2020 2020 2064 746d 6f6e 203d 2064         dtmon = d
-0006d420: 7420 2d20 6461 7465 7469 6d65 2e74 696d  t - datetime.tim
-0006d430: 6564 656c 7461 2864 6179 733d 6474 2e77  edelta(days=dt.w
-0006d440: 6565 6b64 6179 2829 290d 0a20 2020 2020  eekday())..     
-0006d450: 2020 2020 2020 2020 2020 2072 6573 756c             resul
-0006d460: 7420 3d20 6474 6d6f 6e20 2b20 7374 6570  t = dtmon + step
-0006d470: 202a 2064 6174 6574 696d 652e 7469 6d65   * datetime.time
-0006d480: 6465 6c74 6128 6461 7973 3d37 290d 0a20  delta(days=7).. 
-0006d490: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-0006d4a0: 226d 6f6e 7468 2220 3d3d 2075 6e69 743a  "month" == unit:
-0006d4b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0006d4c0: 2020 6465 6c74 6120 3d20 6461 7465 7469    delta = dateti
-0006d4d0: 6d65 2e74 696d 6564 656c 7461 2864 6179  me.timedelta(day
-0006d4e0: 733d 3332 2069 6620 7374 6570 203e 2030  s=32 if step > 0
-0006d4f0: 2065 6c73 6520 3129 0d0a 2020 2020 2020   else 1)..      
-0006d500: 2020 2020 2020 2020 2020 7265 7375 6c74            result
-0006d510: 203d 2028 6474 2e72 6570 6c61 6365 2864   = (dt.replace(d
-0006d520: 6179 3d31 2920 2b20 7374 6570 202a 2064  ay=1) + step * d
-0006d530: 656c 7461 292e 7265 706c 6163 6528 6461  elta).replace(da
-0006d540: 793d 3129 0d0a 2020 2020 2020 2020 2020  y=1)..          
-0006d550: 2020 7265 7475 726e 2072 6573 756c 740d    return result.
-0006d560: 0a0d 0a20 2020 2020 2020 2074 6872 6573  ...        thres
-0006d570: 686f 6c64 2c20 7368 6966 7465 6420 3d20  hold, shifted = 
-0006d580: 6d61 6b65 5f74 6872 6573 686f 6c64 286d  make_threshold(m
-0006d590: 7367 305b 2264 6174 6574 696d 6522 5d2c  sg0["datetime"],
-0006d5a0: 2073 7465 7029 2c20 4661 6c73 650d 0a20   step), False.. 
-0006d5b0: 2020 2020 2020 206d 7367 2c20 7072 6576         msg, prev
-0006d5c0: 6d73 6720 3d20 286d 6d5b 6964 785d 2069  msg = (mm[idx] i
-0006d5d0: 6620 3020 3c3d 2069 6478 203c 206c 656e  f 0 <= idx < len
-0006d5e0: 286d 6d29 2065 6c73 6520 4e6f 6e65 292c  (mm) else None),
-0006d5f0: 204e 6f6e 650d 0a20 2020 2020 2020 2077   None..        w
-0006d600: 6869 6c65 2073 7465 7020 3e20 3020 616e  hile step > 0 an
-0006d610: 6420 6d73 673a 0d0a 2020 2020 2020 2020  d msg:..        
-0006d620: 2020 2020 6966 206d 7367 5b22 6461 7465      if msg["date
-0006d630: 7469 6d65 225d 203e 3d20 7468 7265 7368  time"] >= thresh
-0006d640: 6f6c 643a 2072 6574 7572 6e20 7365 6c66  old: return self
-0006d650: 2e46 6f63 7573 4d65 7373 6167 6528 6d73  .FocusMessage(ms
-0006d660: 675b 2269 6422 5d29 0d0a 2020 2020 2020  g["id"])..      
-0006d670: 2020 2020 2020 6964 7820 2b3d 2073 7465        idx += ste
-0006d680: 700d 0a20 2020 2020 2020 2020 2020 206d  p..            m
-0006d690: 7367 203d 206d 6d5b 6964 785d 2069 6620  sg = mm[idx] if 
-0006d6a0: 3020 3c3d 2069 6478 203c 206c 656e 286d  0 <= idx < len(m
-0006d6b0: 6d29 2065 6c73 6520 4e6f 6e65 0d0a 2020  m) else None..  
-0006d6c0: 2020 2020 2020 7768 696c 6520 7374 6570        while step
-0006d6d0: 203c 2030 2061 6e64 206d 7367 3a0d 0a20   < 0 and msg:.. 
-0006d6e0: 2020 2020 2020 2020 2020 2069 6620 6d73             if ms
-0006d6f0: 675b 2264 6174 6574 696d 6522 5d20 3c20  g["datetime"] < 
-0006d700: 7468 7265 7368 6f6c 6420 616e 6420 7072  threshold and pr
-0006d710: 6576 6d73 673a 0d0a 2020 2020 2020 2020  evmsg:..        
-0006d720: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0006d730: 656c 662e 466f 6375 734d 6573 7361 6765  elf.FocusMessage
-0006d740: 2870 7265 766d 7367 5b22 6964 225d 290d  (prevmsg["id"]).
-0006d750: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0006d760: 6d73 675b 2264 6174 6574 696d 6522 5d20  msg["datetime"] 
-0006d770: 3c20 7468 7265 7368 6f6c 6420 616e 6420  < threshold and 
-0006d780: 6e6f 7420 7368 6966 7465 643a 0d0a 2020  not shifted:..  
-0006d790: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0006d7a0: 4c61 636b 7320 696d 6d65 6469 6174 6520  Lacks immediate 
-0006d7b0: 7072 6576 696f 7573 2075 6e69 742c 2072  previous unit, r
-0006d7c0: 656f 7269 656e 7420 7468 7265 7368 6f6c  eorient threshol
-0006d7d0: 640d 0a20 2020 2020 2020 2020 2020 2020  d..             
-0006d7e0: 2020 2074 6872 6573 686f 6c64 2c20 7368     threshold, sh
-0006d7f0: 6966 7465 6420 3d20 6d61 6b65 5f74 6872  ifted = make_thr
-0006d800: 6573 686f 6c64 286d 7367 5b22 6461 7465  eshold(msg["date
-0006d810: 7469 6d65 225d 2c20 7374 6570 3d30 292c  time"], step=0),
-0006d820: 2054 7275 650d 0a20 2020 2020 2020 2020   True..         
-0006d830: 2020 2069 6478 202b 3d20 7374 6570 0d0a     idx += step..
-0006d840: 2020 2020 2020 2020 2020 2020 6d73 672c              msg,
-0006d850: 2070 7265 766d 7367 203d 2028 6d6d 5b69   prevmsg = (mm[i
-0006d860: 6478 5d20 6966 2030 203c 3d20 6964 7820  dx] if 0 <= idx 
-0006d870: 3c20 6c65 6e28 6d6d 2920 656c 7365 204e  < len(mm) else N
-0006d880: 6f6e 6529 2c20 6d73 670d 0a20 2020 2020  one), msg..     
-0006d890: 2020 2069 6620 7374 6570 203c 2030 2061     if step < 0 a
-0006d8a0: 6e64 2070 7265 766d 7367 2061 6e64 2070  nd prevmsg and p
-0006d8b0: 7265 766d 7367 5b22 6461 7465 7469 6d65  revmsg["datetime
-0006d8c0: 225d 203e 3d20 7468 7265 7368 6f6c 643a  "] >= threshold:
-0006d8d0: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-0006d8e0: 436f 726e 6572 2063 6173 653a 2063 6f6e  Corner case: con
-0006d8f0: 7465 6e74 2073 7461 7274 7320 7769 7468  tent starts with
-0006d900: 2074 6872 6573 686f 6c64 0d0a 2020 2020   threshold..    
-0006d910: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0006d920: 656c 662e 466f 6375 734d 6573 7361 6765  elf.FocusMessage
-0006d930: 2870 7265 766d 7367 5b22 6964 225d 290d  (prevmsg["id"]).
-0006d940: 0a20 2020 2020 2020 206c 6162 656c 203d  .        label =
-0006d950: 2022 7072 6576 696f 7573 2220 6966 2064   "previous" if d
-0006d960: 6972 6563 7469 6f6e 203c 2030 2065 6c73  irection < 0 els
-0006d970: 6520 226e 6578 7422 0d0a 2020 2020 2020  e "next"..      
-0006d980: 2020 6775 6962 6173 652e 7374 6174 7573    guibase.status
-0006d990: 2822 4e6f 2025 7320 2573 2066 6f75 6e64  ("No %s %s found
-0006d9a0: 2069 6e20 6375 7272 656e 7420 7669 6577   in current view
-0006d9b0: 2e22 2c20 6c61 6265 6c2c 2075 6e69 7429  .", label, unit)
-0006d9c0: 0d0a 0d0a 0d0a 2020 2020 6465 6620 466f  ......    def Fo
-0006d9d0: 6375 734d 6573 7361 6765 2873 656c 662c  cusMessage(self,
-0006d9e0: 206d 6573 7361 6765 5f69 642c 2073 656c   message_id, sel
-0006d9f0: 6563 743d 5472 7565 293a 0d0a 2020 2020  ect=True):..    
-0006da00: 2020 2020 2222 2253 656c 6563 7473 2061      """Selects a
-0006da10: 6e64 2073 6372 6f6c 6c73 2074 6865 2073  nd scrolls the s
-0006da20: 7065 6369 6669 6564 206d 6573 7361 6765  pecified message
-0006da30: 2069 6e74 6f20 7669 6577 2e22 2222 0d0a   into view."""..
-0006da40: 2020 2020 2020 2020 6966 206d 6573 7361          if messa
-0006da50: 6765 5f69 6420 6e6f 7420 696e 2073 656c  ge_id not in sel
-0006da60: 662e 5f6d 6573 7361 6765 5f70 6f73 6974  f._message_posit
-0006da70: 696f 6e73 3a20 7265 7475 726e 0d0a 2020  ions: return..  
-0006da80: 2020 2020 2020 6c69 6e65 746f 706f 732c        linetopos,
-0006da90: 206c 696e 656e 756d 6265 7220 3d20 7365   linenumber = se
-0006daa0: 6c66 2e50 6f73 6974 696f 6e46 726f 6d4c  lf.PositionFromL
-0006dab0: 696e 652c 2073 656c 662e 446f 634c 696e  ine, self.DocLin
-0006dac0: 6546 726f 6d56 6973 6962 6c65 0d0a 2020  eFromVisible..  
-0006dad0: 2020 2020 2020 7669 6577 706f 7274 203d        viewport =
-0006dae0: 205b 6c69 6e65 746f 706f 7328 6c69 6e65   [linetopos(line
-0006daf0: 6e75 6d62 6572 2873 656c 662e 4669 7273  number(self.Firs
-0006db00: 7456 6973 6962 6c65 4c69 6e65 202b 2078  tVisibleLine + x
-0006db10: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
-0006db20: 2020 2020 2020 2020 666f 7220 7820 696e          for x in
-0006db30: 205b 302c 2073 656c 662e 4c69 6e65 734f   [0, self.LinesO
-0006db40: 6e53 6372 6565 6e28 295d 5d0d 0a20 2020  nScreen()]]..   
-0006db50: 2020 2020 2069 6620 7669 6577 706f 7274       if viewport
-0006db60: 5b31 5d20 3c20 303a 2076 6965 7770 6f72  [1] < 0: viewpor
-0006db70: 745b 315d 203d 2073 656c 662e 4c61 7374  t[1] = self.Last
-0006db80: 506f 7369 7469 6f6e 0d0a 2020 2020 2020  Position..      
-0006db90: 2020 706f 732c 2070 6164 6469 6e67 203d    pos, padding =
-0006dba0: 2073 656c 662e 5f6d 6573 7361 6765 5f70   self._message_p
-0006dbb0: 6f73 6974 696f 6e73 5b6d 6573 7361 6765  ositions[message
-0006dbc0: 5f69 645d 2c20 3530 0d0a 2020 2020 2020  _id], 50..      
-0006dbd0: 2020 6966 206e 6f74 2076 6965 7770 6f72    if not viewpor
-0006dbe0: 745b 305d 203c 3d20 706f 735b 305d 203c  t[0] <= pos[0] <
-0006dbf0: 3d20 7669 6577 706f 7274 5b31 5d3a 0d0a  = viewport[1]:..
-0006dc00: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0006dc10: 7020 696e 2070 6f73 5b3a 3a2d 315d 3a0d  p in pos[::-1]:.
-0006dc20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0006dc30: 2023 2045 6e73 7572 6520 7468 6174 2062   # Ensure that b
-0006dc40: 6f74 6820 656e 6473 206f 6620 7468 6520  oth ends of the 
-0006dc50: 7365 6c65 6374 696f 6e20 6172 6520 7669  selection are vi
-0006dc60: 7369 626c 650d 0a20 2020 2020 2020 2020  sible..         
-0006dc70: 2020 2020 2020 2073 656c 662e 5354 432e         self.STC.
-0006dc80: 4375 7272 656e 7450 6f73 203d 2070 202b  CurrentPos = p +
-0006dc90: 2070 6164 6469 6e67 0d0a 2020 2020 2020   padding..      
-0006dca0: 2020 2020 2020 2020 2020 7365 6c66 2e45            self.E
-0006dcb0: 6e73 7572 6543 6172 6574 5669 7369 626c  nsureCaretVisibl
-0006dcc0: 6528 290d 0a20 2020 2020 2020 2020 2020  e()..           
-0006dcd0: 2020 2020 2070 6164 6469 6e67 203d 202d       padding = -
-0006dce0: 7061 6464 696e 670d 0a20 2020 2020 2020  padding..       
-0006dcf0: 2020 2020 2073 656c 662e 5354 432e 5365       self.STC.Se
-0006dd00: 7453 656c 6563 7469 6f6e 2870 2c20 7029  tSelection(p, p)
-0006dd10: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
-0006dd20: 6563 743a 2073 656c 662e 5354 432e 5365  ect: self.STC.Se
-0006dd30: 7453 656c 6563 7469 6f6e 282a 706f 7329  tSelection(*pos)
-0006dd40: 0d0a 0d0a 0d0a 2020 2020 6465 6620 4765  ......    def Ge
-0006dd50: 7446 6f63 7573 6564 4d65 7373 6167 6528  tFocusedMessage(
-0006dd60: 7365 6c66 2c20 7365 6c65 6374 6564 6f6e  self, selectedon
-0006dd70: 6c79 3d46 616c 7365 293a 0d0a 2020 2020  ly=False):..    
-0006dd80: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
-0006dd90: 2052 6574 7572 6e73 2074 6865 2049 4420   Returns the ID 
-0006dda0: 6f66 2074 6865 2063 7572 7265 6e74 6c79  of the currently
-0006ddb0: 2073 656c 6563 7465 6420 6f72 2074 6865   selected or the
-0006ddc0: 2066 6972 7374 2076 6973 6962 6c65 206d   first visible m
-0006ddd0: 6573 7361 6765 2c0d 0a20 2020 2020 2020  essage,..       
-0006dde0: 2061 6e64 2077 6865 7468 6572 2074 6865   and whether the
-0006ddf0: 206d 6573 7361 6765 2074 6578 7420 7761   message text wa
-0006de00: 7320 7365 6c65 6374 6564 2e0d 0a0d 0a20  s selected..... 
-0006de10: 2020 2020 2020 2040 7061 7261 6d20 2020         @param   
-0006de20: 7365 6c65 6374 6564 6f6e 6c79 2020 7768  selectedonly  wh
-0006de30: 6574 6865 7220 746f 206c 6f6f 6b20 6174  ether to look at
-0006de40: 2073 656c 6563 7465 6420 6d65 7373 6167   selected messag
-0006de50: 6520 6f6e 6c79 0d0a 2020 2020 2020 2020  e only..        
-0006de60: 4072 6574 7572 6e20 2028 6d65 7373 6167  @return  (messag
-0006de70: 6520 4944 2c20 6973 5f73 656c 6563 7465  e ID, is_selecte
-0006de80: 6429 0d0a 2020 2020 2020 2020 2222 220d  d)..        """.
-0006de90: 0a20 2020 2020 2020 206c 696e 6574 6f70  .        linetop
-0006dea0: 6f73 2c20 6c69 6e65 6e75 6d62 6572 203d  os, linenumber =
-0006deb0: 2073 656c 662e 506f 7369 7469 6f6e 4672   self.PositionFr
-0006dec0: 6f6d 4c69 6e65 2c20 7365 6c66 2e44 6f63  omLine, self.Doc
-0006ded0: 4c69 6e65 4672 6f6d 5669 7369 626c 650d  LineFromVisible.
-0006dee0: 0a20 2020 2020 2020 2076 6965 7770 6f72  .        viewpor
-0006def0: 7420 3d20 5b6c 696e 6574 6f70 6f73 286c  t = [linetopos(l
-0006df00: 696e 656e 756d 6265 7228 7365 6c66 2e46  inenumber(self.F
-0006df10: 6972 7374 5669 7369 626c 654c 696e 6520  irstVisibleLine 
-0006df20: 2b20 7829 290d 0a20 2020 2020 2020 2020  + x))..         
-0006df30: 2020 2020 2020 2020 2020 2066 6f72 2078             for x
-0006df40: 2069 6e20 5b30 2c20 7365 6c66 2e4c 696e   in [0, self.Lin
-0006df50: 6573 4f6e 5363 7265 656e 2829 5d5d 0d0a  esOnScreen()]]..
-0006df60: 2020 2020 2020 2020 6966 2076 6965 7770          if viewp
-0006df70: 6f72 745b 315d 203c 2030 3a20 7669 6577  ort[1] < 0: view
-0006df80: 706f 7274 5b31 5d20 3d20 7365 6c66 2e4c  port[1] = self.L
-0006df90: 6173 7450 6f73 6974 696f 6e0d 0a20 2020  astPosition..   
-0006dfa0: 2020 2020 2073 656c 6563 7469 6f6e 2c20       selection, 
-0006dfb0: 6375 7270 6f73 2c20 7365 6c65 6374 6564  curpos, selected
-0006dfc0: 203d 2073 656c 662e 4765 7453 656c 6563   = self.GetSelec
-0006dfd0: 7469 6f6e 2829 2c20 4e6f 6e65 2c20 4661  tion(), None, Fa
-0006dfe0: 6c73 650d 0a20 2020 2020 2020 2069 6620  lse..        if 
-0006dff0: 7365 6c65 6374 696f 6e5b 305d 2021 3d20  selection[0] != 
-0006e000: 7365 6c65 6374 696f 6e5b 315d 205c 0d0a  selection[1] \..
-0006e010: 2020 2020 2020 2020 616e 6420 616e 7928          and any(
-0006e020: 7669 6577 706f 7274 5b30 5d20 3c3d 2078  viewport[0] <= x
-0006e030: 203c 3d20 7669 6577 706f 7274 5b31 5d20   <= viewport[1] 
-0006e040: 666f 7220 7820 696e 2073 656c 6563 7469  for x in selecti
-0006e050: 6f6e 293a 0d0a 2020 2020 2020 2020 2020  on):..          
-0006e060: 2020 6375 7270 6f73 2c20 7365 6c65 6374    curpos, select
-0006e070: 6564 203d 2073 656c 6563 7469 6f6e 5b30  ed = selection[0
-0006e080: 5d2c 2054 7275 650d 0a20 2020 2020 2020  ], True..       
-0006e090: 2065 6c69 6620 6e6f 7420 7365 6c65 6374   elif not select
-0006e0a0: 6564 6f6e 6c79 3a0d 0a20 2020 2020 2020  edonly:..       
-0006e0b0: 2020 2020 2063 7572 706f 7320 3d20 7669       curpos = vi
-0006e0c0: 6577 706f 7274 5b30 5d0d 0a20 2020 2020  ewport[0]..     
-0006e0d0: 2020 2069 6620 6375 7270 6f73 2069 7320     if curpos is 
-0006e0e0: 4e6f 6e65 3a20 7265 7475 726e 204e 6f6e  None: return Non
-0006e0f0: 652c 2046 616c 7365 2023 204e 6f20 706f  e, False # No po
-0006e100: 7369 7469 6f6e 2074 6f20 6368 6563 6b0d  sition to check.
-0006e110: 0a0d 0a20 2020 2020 2020 2066 6f72 206d  ...        for m
-0006e120: 5f69 6420 696e 2073 656c 662e 5f6d 6573  _id in self._mes
-0006e130: 7361 6765 5f70 6f73 6974 696f 6e73 3a0d  sage_positions:.
-0006e140: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0006e150: 6375 7270 6f73 203c 2073 656c 662e 5f6d  curpos < self._m
-0006e160: 6573 7361 6765 5f70 6f73 6974 696f 6e73  essage_positions
-0006e170: 5b6d 5f69 645d 5b31 5d3a 2072 6574 7572  [m_id][1]: retur
-0006e180: 6e20 6d5f 6964 2c20 7365 6c65 6374 6564  n m_id, selected
-0006e190: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-0006e1a0: 204e 6f6e 652c 2046 616c 7365 0d0a 0d0a   None, False....
-0006e1b0: 0d0a 2020 2020 6465 6620 4973 4d65 7373  ..    def IsMess
-0006e1c0: 6167 6546 696c 7465 7265 644f 7574 2873  ageFilteredOut(s
-0006e1d0: 656c 662c 206d 6573 7361 6765 293a 0d0a  elf, message):..
-0006e1e0: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
-0006e1f0: 2020 2020 2052 6574 7572 6e73 2077 6865       Returns whe
-0006e200: 7468 6572 2074 6865 2073 7065 6369 6669  ther the specifi
-0006e210: 6564 206d 6573 7361 6765 2064 6f65 7320  ed message does 
-0006e220: 6e6f 7420 7061 7373 2074 6865 2063 7572  not pass the cur
-0006e230: 7265 6e74 2066 696c 7465 722e 0d0a 2020  rent filter...  
-0006e240: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
-0006e250: 2020 2072 6573 756c 7420 3d20 4661 6c73     result = Fals
-0006e260: 650d 0a20 2020 2020 2020 2069 6620 2873  e..        if (s
-0006e270: 656c 662e 5f66 696c 7465 722e 6765 7428  elf._filter.get(
-0006e280: 2270 6172 7469 6369 7061 6e74 7322 290d  "participants").
-0006e290: 0a20 2020 2020 2020 2061 6e64 206d 6573  .        and mes
-0006e2a0: 7361 6765 5b22 6175 7468 6f72 225d 206e  sage["author"] n
-0006e2b0: 6f74 2069 6e20 7365 6c66 2e5f 6669 6c74  ot in self._filt
-0006e2c0: 6572 5b22 7061 7274 6963 6970 616e 7473  er["participants
-0006e2d0: 225d 0d0a 2020 2020 2020 2020 616e 6420  "]..        and 
-0006e2e0: 7365 7428 7365 6c66 2e5f 6669 6c74 6572  set(self._filter
-0006e2f0: 5b22 7061 7274 6963 6970 616e 7473 225d  ["participants"]
-0006e300: 2920 213d 0d0a 2020 2020 2020 2020 7365  ) !=..        se
-0006e310: 7428 5b70 5b22 6964 656e 7469 7479 225d  t([p["identity"]
-0006e320: 2066 6f72 2070 2069 6e20 7365 6c66 2e5f   for p in self._
-0006e330: 6368 6174 5b22 7061 7274 6963 6970 616e  chat["participan
-0006e340: 7473 225d 5d29 293a 0d0a 2020 2020 2020  ts"]])):..      
-0006e350: 2020 2020 2020 2320 4c61 7374 2063 6f6e        # Last con
-0006e360: 6469 7469 6f6e 2069 7320 746f 2063 6865  dition is to che
-0006e370: 636b 2069 6620 7061 7274 6963 6970 616e  ck if participan
-0006e380: 7473 2066 696c 7465 7220 6973 2061 7070  ts filter is app
-0006e390: 6c69 6564 2e0d 0a20 2020 2020 2020 2020  lied...         
-0006e3a0: 2020 2072 6573 756c 7420 3d20 5472 7565     result = True
-0006e3b0: 0d0a 2020 2020 2020 2020 656c 6966 2028  ..        elif (
-0006e3c0: 616c 6c28 7365 6c66 2e5f 6669 6c74 6572  all(self._filter
-0006e3d0: 2e67 6574 2822 6461 7465 7261 6e67 6522  .get("daterange"
-0006e3e0: 2920 6f72 205b 305d 290d 0a20 2020 2020  ) or [0])..     
-0006e3f0: 2020 2061 6e64 206e 6f74 2028 7365 6c66     and not (self
-0006e400: 2e5f 6669 6c74 6572 5b22 6461 7465 7261  ._filter["datera
-0006e410: 6e67 6522 5d5b 305d 203c 3d20 6d65 7373  nge"][0] <= mess
-0006e420: 6167 655b 2264 6174 6574 696d 6522 5d2e  age["datetime"].
-0006e430: 6461 7465 2829 0d0a 2020 2020 2020 2020  date()..        
-0006e440: 3c3d 2073 656c 662e 5f66 696c 7465 725b  <= self._filter[
-0006e450: 2264 6174 6572 616e 6765 225d 5b31 5d29  "daterange"][1])
-0006e460: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-0006e470: 7265 7375 6c74 203d 2054 7275 650d 0a20  result = True.. 
-0006e480: 2020 2020 2020 2065 6c69 6620 2274 6578         elif "tex
-0006e490: 7422 2069 6e20 7365 6c66 2e5f 6669 6c74  t" in self._filt
-0006e4a0: 6572 2061 6e64 2073 656c 662e 5f66 696c  er and self._fil
-0006e4b0: 7465 725b 2274 6578 7422 5d3a 0d0a 2020  ter["text"]:..  
-0006e4c0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-0006e4d0: 2073 656c 662e 5f66 696c 7465 7274 6578   self._filtertex
-0006e4e0: 745f 7267 783a 0d0a 2020 2020 2020 2020  t_rgx:..        
-0006e4f0: 2020 2020 2020 2020 6573 6361 7065 6420          escaped 
-0006e500: 3d20 7265 2e65 7363 6170 6528 7365 6c66  = re.escape(self
-0006e510: 2e5f 6669 6c74 6572 5b22 7465 7874 225d  ._filter["text"]
-0006e520: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0006e530: 2020 2073 656c 662e 5f66 696c 7465 7274     self._filtert
-0006e540: 6578 745f 7267 7820 3d20 7265 2e63 6f6d  ext_rgx = re.com
-0006e550: 7069 6c65 2865 7363 6170 6564 2c20 7265  pile(escaped, re
-0006e560: 2e49 474e 4f52 4543 4153 4529 0d0a 2020  .IGNORECASE)..  
-0006e570: 2020 2020 2020 2020 2020 6966 2028 6e6f            if (no
-0006e580: 7420 6d65 7373 6167 655b 2262 6f64 795f  t message["body_
-0006e590: 786d 6c22 5d0d 0a20 2020 2020 2020 2020  xml"]..         
-0006e5a0: 2020 206f 7220 6e6f 7420 7365 6c66 2e5f     or not self._
-0006e5b0: 6669 6c74 6572 7465 7874 5f72 6778 2e73  filtertext_rgx.s
-0006e5c0: 6561 7263 6828 6d65 7373 6167 655b 2262  earch(message["b
-0006e5d0: 6f64 795f 786d 6c22 5d29 293a 0d0a 2020  ody_xml"])):..  
-0006e5e0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0006e5f0: 7375 6c74 203d 2054 7275 650d 0a20 2020  sult = True..   
-0006e600: 2020 2020 2072 6574 7572 6e20 7265 7375       return resu
-0006e610: 6c74 0d0a 0d0a 0d0a 2020 2020 6465 6620  lt......    def 
-0006e620: 4973 4d65 7373 6167 6553 686f 776e 2873  IsMessageShown(s
-0006e630: 656c 662c 206d 6573 7361 6765 5f69 6429  elf, message_id)
-0006e640: 3a0d 0a20 2020 2020 2020 2022 2222 5265  :..        """Re
-0006e650: 7475 726e 7320 7768 6574 6865 7220 7468  turns whether th
-0006e660: 6520 7370 6563 6966 6965 6420 6d65 7373  e specified mess
-0006e670: 6167 6520 6973 2063 7572 7265 6e74 6c79  age is currently
-0006e680: 2073 686f 776e 2e22 2222 0d0a 2020 2020   shown."""..    
-0006e690: 2020 2020 7265 7475 726e 2028 6d65 7373      return (mess
-0006e6a0: 6167 655f 6964 2069 6e20 7365 6c66 2e5f  age_id in self._
-0006e6b0: 6d65 7373 6167 655f 706f 7369 7469 6f6e  message_position
-0006e6c0: 7329 0d0a 0d0a 0d0a 2020 2020 6465 6620  s)......    def 
-0006e6d0: 4765 744d 6573 7361 6765 2873 656c 662c  GetMessage(self,
-0006e6e0: 2069 6e64 6578 293a 0d0a 2020 2020 2020   index):..      
-0006e6f0: 2020 2222 220d 0a20 2020 2020 2020 2052    """..        R
-0006e700: 6574 7572 6e73 2074 6865 206d 6573 7361  eturns the messa
-0006e710: 6765 2061 7420 7468 6520 7370 6563 6966  ge at the specif
-0006e720: 6965 6420 696e 6465 7820 696e 2074 6865  ied index in the
-0006e730: 2063 7572 7265 6e74 6c79 2073 686f 776e   currently shown
-0006e740: 0d0a 2020 2020 2020 2020 6d65 7373 6167  ..        messag
-0006e750: 6573 2e0d 0a0d 0a20 2020 2020 2020 2040  es.....        @
-0006e760: 7061 7261 6d20 2020 696e 6465 7820 206c  param   index  l
-0006e770: 6973 7420 696e 6465 7820 286e 6567 6174  ist index (negat
-0006e780: 6976 6520 7374 6172 7473 2066 726f 6d20  ive starts from 
-0006e790: 656e 6429 0d0a 2020 2020 2020 2020 2222  end)..        ""
-0006e7a0: 220d 0a20 2020 2020 2020 2069 6620 696e  "..        if in
-0006e7b0: 6465 7820 3c20 303a 2069 6e64 6578 2025  dex < 0: index %
-0006e7c0: 3d20 6c65 6e28 7365 6c66 2e5f 6d65 7373  = len(self._mess
-0006e7d0: 6167 6573 5f63 7572 7265 6e74 206f 7220  ages_current or 
-0006e7e0: 5b5d 290d 0a20 2020 2020 2020 2069 6620  [])..        if 
-0006e7f0: 696e 6465 7820 3e3d 206c 656e 2873 656c  index >= len(sel
-0006e800: 662e 5f6d 6573 7361 6765 735f 6375 7272  f._messages_curr
-0006e810: 656e 7420 6f72 205b 5d29 3a20 7265 7475  ent or []): retu
-0006e820: 726e 204e 6f6e 650d 0a20 2020 2020 2020  rn None..       
-0006e830: 2072 6574 7572 6e20 7365 6c66 2e5f 6d65   return self._me
-0006e840: 7373 6167 6573 5f63 7572 7265 6e74 5b69  ssages_current[i
-0006e850: 6e64 6578 5d0d 0a0d 0a0d 0a20 2020 2064  ndex]......    d
-0006e860: 6566 2047 6574 4d65 7373 6167 6573 2873  ef GetMessages(s
-0006e870: 656c 6629 3a0d 0a20 2020 2020 2020 2022  elf):..        "
-0006e880: 2222 5265 7475 726e 7320 6120 6c69 7374  ""Returns a list
-0006e890: 206f 6620 616c 6c20 7468 6520 6375 7272   of all the curr
-0006e8a0: 656e 746c 7920 7368 6f77 6e20 6d65 7373  ently shown mess
-0006e8b0: 6167 6573 2e22 2222 0d0a 2020 2020 2020  ages."""..      
-0006e8c0: 2020 7265 7475 726e 206c 6973 7428 7365    return list(se
-0006e8d0: 6c66 2e5f 6d65 7373 6167 6573 5f63 7572  lf._messages_cur
-0006e8e0: 7265 6e74 206f 7220 5b5d 290d 0a0d 0a0d  rent or []).....
-0006e8f0: 0a20 2020 2064 6566 2047 6574 5265 7472  .    def GetRetr
-0006e900: 6965 7665 644d 6573 7361 6765 7328 7365  ievedMessages(se
-0006e910: 6c66 293a 0d0a 2020 2020 2020 2020 2222  lf):..        ""
-0006e920: 2252 6574 7572 6e73 2061 206c 6973 7420  "Returns a list 
-0006e930: 6f66 2061 6c6c 2072 6574 7269 6576 6564  of all retrieved
-0006e940: 206d 6573 7361 6765 732e 2222 220d 0a20   messages.""".. 
-0006e950: 2020 2020 2020 2072 6574 7572 6e20 6c69         return li
-0006e960: 7374 2873 656c 662e 5f6d 6573 7361 6765  st(self._message
-0006e970: 7320 6f72 205b 5d29 0d0a 0d0a 0d0a 2020  s or [])......  
-0006e980: 2020 6465 6620 4765 7456 6973 6962 6c65    def GetVisible
-0006e990: 4d65 7373 6167 6573 2873 656c 6629 3a0d  Messages(self):.
-0006e9a0: 0a20 2020 2020 2020 2022 2222 5265 7475  .        """Retu
-0006e9b0: 726e 7320 6120 6c69 7374 206f 6620 6d65  rns a list of me
-0006e9c0: 7373 6167 6573 2063 7572 7265 6e74 6c79  ssages currently
-0006e9d0: 2076 6973 6962 6c65 2069 6e20 7669 6577   visible in view
-0006e9e0: 706f 7274 2e22 2222 0d0a 2020 2020 2020  port."""..      
-0006e9f0: 2020 6964 7320 3d20 5b5d 0d0a 2020 2020    ids = []..    
-0006ea00: 2020 2020 6c69 6e65 746f 706f 732c 206c      linetopos, l
-0006ea10: 696e 656e 756d 6265 7220 3d20 7365 6c66  inenumber = self
-0006ea20: 2e50 6f73 6974 696f 6e46 726f 6d4c 696e  .PositionFromLin
-0006ea30: 652c 2073 656c 662e 446f 634c 696e 6546  e, self.DocLineF
-0006ea40: 726f 6d56 6973 6962 6c65 0d0a 2020 2020  romVisible..    
-0006ea50: 2020 2020 7669 6577 706f 7274 203d 205b      viewport = [
-0006ea60: 6c69 6e65 746f 706f 7328 6c69 6e65 6e75  linetopos(linenu
-0006ea70: 6d62 6572 2873 656c 662e 4669 7273 7456  mber(self.FirstV
-0006ea80: 6973 6962 6c65 4c69 6e65 202b 2078 2929  isibleLine + x))
-0006ea90: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0006eaa0: 2020 2020 2020 666f 7220 7820 696e 205b        for x in [
-0006eab0: 302c 2073 656c 662e 4c69 6e65 734f 6e53  0, self.LinesOnS
-0006eac0: 6372 6565 6e28 295d 5d0d 0a20 2020 2020  creen()]]..     
-0006ead0: 2020 2069 6620 7669 6577 706f 7274 5b31     if viewport[1
-0006eae0: 5d20 3c20 303a 2076 6965 7770 6f72 745b  ] < 0: viewport[
-0006eaf0: 315d 203d 2073 656c 662e 4c61 7374 506f  1] = self.LastPo
-0006eb00: 7369 7469 6f6e 0d0a 2020 2020 2020 2020  sition..        
-0006eb10: 666f 7220 6d5f 6964 2069 6e20 7365 6c66  for m_id in self
-0006eb20: 2e5f 6d65 7373 6167 655f 706f 7369 7469  ._message_positi
-0006eb30: 6f6e 733a 0d0a 2020 2020 2020 2020 2020  ons:..          
-0006eb40: 2020 6d5f 706f 7320 3d20 7365 6c66 2e5f    m_pos = self._
-0006eb50: 6d65 7373 6167 655f 706f 7369 7469 6f6e  message_position
-0006eb60: 735b 6d5f 6964 5d0d 0a20 2020 2020 2020  s[m_id]..       
-0006eb70: 2020 2020 2069 6620 616e 7928 7669 6577       if any(view
-0006eb80: 706f 7274 5b30 5d20 3c3d 2078 203c 3d20  port[0] <= x <= 
-0006eb90: 7669 6577 706f 7274 5b31 5d20 666f 7220  viewport[1] for 
-0006eba0: 7820 696e 206d 5f70 6f73 2920 5c0d 0a20  x in m_pos) \.. 
-0006ebb0: 2020 2020 2020 2020 2020 206f 7220 6d5f             or m_
-0006ebc0: 706f 735b 305d 203c 2076 6965 7770 6f72  pos[0] < viewpor
-0006ebd0: 745b 305d 2061 6e64 206d 5f70 6f73 5b31  t[0] and m_pos[1
-0006ebe0: 5d20 3e20 7669 6577 706f 7274 5b31 5d3a  ] > viewport[1]:
-0006ebf0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0006ec00: 2020 6964 732e 6170 7065 6e64 286d 5f69    ids.append(m_i
-0006ec10: 6429 0d0a 2020 2020 2020 2020 2020 2020  d)..            
-0006ec20: 6966 206d 5f70 6f73 5b30 5d20 3e20 7669  if m_pos[0] > vi
-0006ec30: 6577 706f 7274 5b31 5d3a 2062 7265 616b  ewport[1]: break
-0006ec40: 2023 2066 6f72 206d 5f69 640d 0a20 2020   # for m_id..   
-0006ec50: 2020 2020 2072 6574 7572 6e20 6d61 7028       return map(
-0006ec60: 7365 6c66 2e5f 6d65 7373 6167 655f 6d61  self._message_ma
-0006ec70: 702e 6765 742c 2069 6473 290d 0a0d 0a0d  p.get, ids).....
-0006ec80: 0a20 2020 2064 6566 2053 6574 4669 6c74  .    def SetFilt
-0006ec90: 6572 2873 656c 662c 2066 696c 7465 725f  er(self, filter_
-0006eca0: 6461 7461 293a 0d0a 2020 2020 2020 2020  data):..        
-0006ecb0: 2222 220d 0a20 2020 2020 2020 2053 6574  """..        Set
-0006ecc0: 7320 7468 6520 6669 6c74 6572 2074 6f20  s the filter to 
-0006ecd0: 7573 6520 666f 7220 7468 6520 6375 7272  use for the curr
-0006ece0: 656e 7420 6368 6174 2e20 446f 6573 206e  ent chat. Does n
-0006ecf0: 6f74 2072 6566 7265 7368 206d 6573 7361  ot refresh messa
-0006ed00: 6765 732e 0d0a 0d0a 2020 2020 2020 2020  ges.....        
-0006ed10: 4070 6172 616d 2020 2066 696c 7465 725f  @param   filter_
-0006ed20: 6461 7461 2020 4e6f 6e65 206f 7220 7b22  data  None or {"
-0006ed30: 6461 7465 7261 6e67 6522 3a0d 0a20 2020  daterange":..   
-0006ed40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006ed50: 2020 2020 2020 2020 2020 2028 6461 7465             (date
-0006ed60: 7469 6d65 2c20 6461 7465 7469 6d65 292c  time, datetime),
-0006ed70: 2022 7465 7874 223a 2074 6578 7420 696e   "text": text in
-0006ed80: 206d 6573 7361 6765 2c0d 0a20 2020 2020   message,..     
-0006ed90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006eda0: 2020 2020 2020 2020 2022 7061 7274 6963           "partic
-0006edb0: 6970 616e 7473 223a 205b 736b 7970 656e  ipants": [skypen
-0006edc0: 616d 6531 2c20 5d7d 0d0a 2020 2020 2020  ame1, ]}..      
-0006edd0: 2020 2222 220d 0a20 2020 2020 2020 2066    """..        f
-0006ede0: 696c 7465 725f 6461 7461 203d 2066 696c  ilter_data = fil
-0006edf0: 7465 725f 6461 7461 206f 7220 7b7d 0d0a  ter_data or {}..
-0006ee00: 2020 2020 2020 2020 6966 206e 6f74 2075          if not u
-0006ee10: 7469 6c2e 636d 705f 6469 6374 7328 6669  til.cmp_dicts(fi
-0006ee20: 6c74 6572 5f64 6174 612c 2073 656c 662e  lter_data, self.
-0006ee30: 5f66 696c 7465 7229 3a0d 0a20 2020 2020  _filter):..     
-0006ee40: 2020 2020 2020 2073 656c 662e 5f66 696c         self._fil
-0006ee50: 7465 7220 3d20 636f 7079 2e64 6565 7063  ter = copy.deepc
-0006ee60: 6f70 7928 6669 6c74 6572 5f64 6174 6129  opy(filter_data)
-0006ee70: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-0006ee80: 6c66 2e5f 6669 6c74 6572 7465 7874 5f72  lf._filtertext_r
-0006ee90: 6778 203d 204e 6f6e 650d 0a20 2020 2020  gx = None..     
-0006eea0: 2020 2020 2020 2073 656c 662e 5f6d 6573         self._mes
-0006eeb0: 7361 6765 735f 6375 7272 656e 7420 3d20  sages_current = 
-0006eec0: 4e6f 6e65 0d0a 2020 2020 6465 6620 4765  None..    def Ge
-0006eed0: 7446 696c 7465 7228 7365 6c66 293a 0d0a  tFilter(self):..
-0006eee0: 2020 2020 2020 2020 7265 7475 726e 2063          return c
-0006eef0: 6f70 792e 6465 6570 636f 7079 2873 656c  opy.deepcopy(sel
-0006ef00: 662e 5f66 696c 7465 7229 0d0a 2020 2020  f._filter)..    
-0006ef10: 4669 6c74 6572 203d 2070 726f 7065 7274  Filter = propert
-0006ef20: 7928 4765 7446 696c 7465 722c 2053 6574  y(GetFilter, Set
-0006ef30: 4669 6c74 6572 2c20 646f 633d 5c0d 0a20  Filter, doc=\.. 
-0006ef40: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
-0006ef50: 2020 2020 5468 6520 6669 6c74 6572 2074      The filter t
-0006ef60: 6f20 7573 6520 666f 7220 7468 6520 6375  o use for the cu
-0006ef70: 7272 656e 7420 6368 6174 2e20 7b22 6461  rrent chat. {"da
-0006ef80: 7465 7261 6e67 6522 3a0d 0a20 2020 2020  terange":..     
-0006ef90: 2020 2028 6461 7465 7469 6d65 2c20 6461     (datetime, da
-0006efa0: 7465 7469 6d65 292c 2022 7465 7874 223a  tetime), "text":
-0006efb0: 2074 6578 7420 696e 206d 6573 7361 6765   text in message
-0006efc0: 2c0d 0a20 2020 2020 2020 2022 7061 7274  ,..        "part
-0006efd0: 6963 6970 616e 7473 223a 205b 736b 7970  icipants": [skyp
-0006efe0: 656e 616d 6531 2c20 5d7d 0d0a 2020 2020  ename1, ]}..    
-0006eff0: 2020 2020 2222 220d 0a20 2020 2029 0d0a      """..    )..
-0006f000: 0d0a 0d0a 2020 2020 6465 6620 4170 706c  ....    def Appl
-0006f010: 7946 696c 7465 7228 7365 6c66 2c20 6461  yFilter(self, da
-0006f020: 7465 7261 6e67 653d 4e6f 6e65 2c20 7465  terange=None, te
-0006f030: 7874 3d4e 6f6e 652c 2070 6172 7469 6369  xt=None, partici
-0006f040: 7061 6e74 733d 4e6f 6e65 2c0d 0a20 2020  pants=None,..   
-0006f050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006f060: 2064 6174 656c 6162 656c 3d4e 6f6e 6529   datelabel=None)
-0006f070: 3a0d 0a20 2020 2020 2020 2022 2222 0d0a  :..        """..
-0006f080: 2020 2020 2020 2020 5365 7473 2061 6e64          Sets and
-0006f090: 2061 7070 6c69 6573 2066 696c 7465 7220   applies filter 
-0006f0a0: 666f 7220 7468 6520 6375 7272 656e 7420  for the current 
-0006f0b0: 6368 6174 2e0d 0a0d 0a20 2020 2020 2020  chat.....       
-0006f0c0: 2040 7061 7261 6d20 2020 6461 7465 7261   @param   datera
-0006f0d0: 6e67 6520 2020 2020 5b64 6174 6531 2c20  nge     [date1, 
-0006f0e0: 6461 7465 325d 206f 7220 4e6f 6e65 2074  date2] or None t
-0006f0f0: 6f20 736b 6970 0d0a 2020 2020 2020 2020  o skip..        
-0006f100: 4070 6172 616d 2020 2074 6578 7420 2020  @param   text   
-0006f110: 2020 2020 2020 2073 6561 7263 6820 7374         search st
-0006f120: 7269 6e67 206f 7220 4e6f 6e65 2074 6f20  ring or None to 
-0006f130: 736b 6970 0d0a 2020 2020 2020 2020 4070  skip..        @p
-0006f140: 6172 616d 2020 2070 6172 7469 6369 7061  aram   participa
-0006f150: 6e74 7320 205b 6964 656e 7469 7479 2c20  nts  [identity, 
-0006f160: 5d20 6f72 204e 6f6e 6520 746f 2073 6b69  ] or None to ski
-0006f170: 700d 0a20 2020 2020 2020 2040 7061 7261  p..        @para
-0006f180: 6d20 2020 6461 7465 6c61 6265 6c20 2020  m   datelabel   
-0006f190: 2020 6461 7465 6c69 6e6b 7320 6c61 6265    datelinks labe
-0006f1a0: 6c20 6c69 6b65 2022 3120 7965 6172 222c  l like "1 year",
-0006f1b0: 2069 6620 616e 790d 0a20 2020 2020 2020   if any..       
-0006f1c0: 2022 2222 0d0a 2020 2020 2020 2020 6d79   """..        my
-0006f1d0: 6669 6c74 6572 203d 2064 6963 7428 6461  filter = dict(da
-0006f1e0: 7465 7261 6e67 653d 6461 7465 7261 6e67  terange=daterang
-0006f1f0: 652c 2074 6578 743d 7465 7874 2c20 7061  e, text=text, pa
-0006f200: 7274 6963 6970 616e 7473 3d70 6172 7469  rticipants=parti
-0006f210: 6369 7061 6e74 7329 0d0a 2020 2020 2020  cipants)..      
-0006f220: 2020 6d79 6669 6c74 6572 203d 207b 6b3a    myfilter = {k:
-0006f230: 2076 2066 6f72 206b 2c20 7620 696e 206d   v for k, v in m
-0006f240: 7966 696c 7465 722e 6974 656d 7328 2920  yfilter.items() 
-0006f250: 6966 2076 2069 7320 6e6f 7420 4e6f 6e65  if v is not None
-0006f260: 7d0d 0a20 2020 2020 2020 2069 6620 6e6f  }..        if no
-0006f270: 7420 6d79 6669 6c74 6572 206f 7220 7574  t myfilter or ut
-0006f280: 696c 2e63 6d70 5f64 6963 7473 286d 7966  il.cmp_dicts(myf
-0006f290: 696c 7465 722c 2073 656c 662e 5f66 696c  ilter, self._fil
-0006f2a0: 7465 7229 3a20 7265 7475 726e 0d0a 0d0a  ter): return....
-0006f2b0: 2020 2020 2020 2020 6275 7379 203d 2063          busy = c
-0006f2c0: 6f6e 7472 6f6c 732e 4275 7379 5061 6e65  ontrols.BusyPane
-0006f2d0: 6c28 7365 6c66 2e5f 7061 6765 206f 7220  l(self._page or 
-0006f2e0: 7365 6c66 2e50 6172 656e 742c 0d0a 2020  self.Parent,..  
-0006f2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006f300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006f310: 2246 696c 7465 7269 6e67 206d 6573 7361  "Filtering messa
-0006f320: 6765 732e 2229 0d0a 2020 2020 2020 2020  ges.")..        
-0006f330: 7472 793a 0d0a 2020 2020 2020 2020 2020  try:..          
-0006f340: 2020 7365 6c66 2e5f 6461 7465 6c69 6e6b    self._datelink
-0006f350: 5f6c 6173 7420 3d20 6461 7465 6c61 6265  _last = datelabe
-0006f360: 6c0d 0a20 2020 2020 2020 2020 2020 2069  l..            i
-0006f370: 6620 7365 6c66 2e5f 7061 6765 3a0d 0a20  f self._page:.. 
-0006f380: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0006f390: 6620 6461 7465 7261 6e67 653a 0d0a 2020  f daterange:..  
-0006f3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006f3b0: 2020 7365 6c66 2e5f 7061 6765 2e72 616e    self._page.ran
-0006f3c0: 6765 5f64 6174 652e 5365 7456 616c 7565  ge_date.SetValue
-0006f3d0: 7328 2a64 6174 6572 616e 6765 290d 0a20  s(*daterange).. 
-0006f3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006f3f0: 2020 2073 656c 662e 5f70 6167 652e 6368     self._page.ch
-0006f400: 6174 5f66 696c 7465 725b 2264 6174 6572  at_filter["dater
-0006f410: 616e 6765 225d 203d 2064 6174 6572 616e  ange"] = dateran
-0006f420: 6765 0d0a 2020 2020 2020 2020 2020 2020  ge..            
-0006f430: 2020 2020 6966 2074 6578 7420 6973 206e      if text is n
-0006f440: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
-0006f450: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0006f460: 6c66 2e5f 7061 6765 2e65 6469 745f 6669  lf._page.edit_fi
-0006f470: 6c74 6572 7465 7874 2e56 616c 7565 203d  ltertext.Value =
-0006f480: 2074 6578 740d 0a20 2020 2020 2020 2020   text..         
-0006f490: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0006f4a0: 5f70 6167 652e 6368 6174 5f66 696c 7465  _page.chat_filte
-0006f4b0: 725b 2274 6578 7422 5d20 2020 3d20 7465  r["text"]   = te
-0006f4c0: 7874 0d0a 2020 2020 2020 2020 2020 2020  xt..            
-0006f4d0: 2020 2020 6966 2070 6172 7469 6369 7061      if participa
-0006f4e0: 6e74 733a 0d0a 2020 2020 2020 2020 2020  nts:..          
-0006f4f0: 2020 2020 2020 2020 2020 706c 6973 7420            plist 
-0006f500: 3d20 7365 6c66 2e5f 7061 6765 2e6c 6973  = self._page.lis
-0006f510: 745f 7061 7274 6963 6970 616e 7473 0d0a  t_participants..
-0006f520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006f530: 2020 2020 666f 7220 6920 696e 2072 616e      for i in ran
-0006f540: 6765 2870 6c69 7374 2e47 6574 4974 656d  ge(plist.GetItem
-0006f550: 436f 756e 7428 2929 3a0d 0a20 2020 2020  Count()):..     
-0006f560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006f570: 2020 2069 6465 6e74 6974 7920 3d20 706c     identity = pl
-0006f580: 6973 742e 4765 7449 7465 6d44 6174 6128  ist.GetItemData(
-0006f590: 6929 5b22 6964 656e 7469 7479 225d 0d0a  i)["identity"]..
-0006f5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006f5b0: 2020 2020 2020 2020 6320 3d20 706c 6973          c = plis
-0006f5c0: 742e 4765 7449 7465 6d28 6929 0d0a 2020  t.GetItem(i)..  
+0006ac90: 2020 7374 796c 6562 6173 6520 3d20 636f    stylebase = co
+0006aca0: 6c6f 7572 6d61 705b 6d5b 2261 7574 686f  lourmap[m["autho
+0006acb0: 7222 5d5d 0d0a 2020 2020 2020 2020 2020  r"]]..          
+0006acc0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+0006acd0: 6170 7065 6e64 5f74 6578 7428 7469 6d65  append_text(time
+0006ace0: 5f76 616c 7565 2c20 7374 796c 6562 6173  _value, stylebas
+0006acf0: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+0006ad00: 2020 2020 2020 2020 7365 6c66 2e5f 6170          self._ap
+0006ad10: 7065 6e64 5f74 6578 7428 225c 6e25 7320  pend_text("\n%s 
+0006ad20: 2220 2520 6469 7370 6c61 796e 616d 652c  " % displayname,
+0006ad30: 2073 7479 6c65 6261 7365 202b 2022 7765   stylebase + "we
+0006ad40: 616b 2229 0d0a 2020 2020 2020 2020 2020  ak")..          
+0006ad50: 2020 2020 2020 656c 6966 2073 7065 6369        elif speci
+0006ad60: 616c 5f74 6167 2069 7320 4e6f 6e65 3a0d  al_tag is None:.
+0006ad70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0006ad80: 2020 2020 2073 656c 662e 5f61 7070 656e       self._appen
+0006ad90: 645f 7465 7874 2822 2573 2025 735c 6e22  d_text("%s %s\n"
+0006ada0: 2025 2028 7469 6d65 5f76 616c 7565 2c20   % (time_value, 
+0006adb0: 6469 7370 6c61 796e 616d 6529 2c0d 0a20  displayname),.. 
+0006adc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006add0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006ade0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006adf0: 2020 636f 6c6f 7572 6d61 705b 6d5b 2261    colourmap[m["a
+0006ae00: 7574 686f 7222 5d5d 290d 0a20 2020 2020  uthor"]])..     
+0006ae10: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0006ae20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0006ae30: 2020 2020 2020 7365 6c66 2e5f 6170 7065        self._appe
+0006ae40: 6e64 5f74 6578 7428 2225 7320 2573 2220  nd_text("%s %s" 
+0006ae50: 2520 2874 696d 655f 7661 6c75 652c 2064  % (time_value, d
+0006ae60: 6973 706c 6179 6e61 6d65 292c 0d0a 2020  isplayname),..  
+0006ae70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006ae80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006ae90: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0006aea0: 6f6c 6f75 726d 6170 5b6d 5b22 6175 7468  olourmap[m["auth
+0006aeb0: 6f72 225d 5d29 0d0a 2020 2020 2020 2020  or"]])..        
+0006aec0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0006aed0: 2e5f 6170 7065 6e64 5f74 6578 7428 2225  ._append_text("%
+0006aee0: 735c 6e22 2025 2073 7065 6369 616c 5f74  s\n" % special_t
+0006aef0: 6167 2e74 6578 742c 2022 7370 6563 6961  ag.text, "specia
+0006af00: 6c22 290d 0a0d 0a20 2020 2020 2020 2020  l")....         
+0006af10: 2020 2020 2020 2073 656c 662e 5f77 7269         self._wri
+0006af20: 7465 5f65 6c65 6d65 6e74 2864 6f6d 2c20  te_element(dom, 
+0006af30: 7267 785f 6869 6768 6c69 6768 7429 0d0a  rgx_highlight)..
+0006af40: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0006af50: 2020 6d65 7373 6167 6570 6f73 203d 2028    messagepos = (
+0006af60: 6c65 6e67 7468 5f62 6566 6f72 652c 2073  length_before, s
+0006af70: 656c 662e 5354 432e 4c65 6e67 7468 202d  elf.STC.Length -
+0006af80: 2032 290d 0a20 2020 2020 2020 2020 2020   2)..           
+0006af90: 2020 2020 2073 656c 662e 5f6d 6573 7361       self._messa
+0006afa0: 6765 5f70 6f73 6974 696f 6e73 5b6d 5b22  ge_positions[m["
+0006afb0: 6964 225d 5d20 3d20 6d65 7373 6167 6570  id"]] = messagep
+0006afc0: 6f73 0d0a 2020 2020 2020 2020 2020 2020  os..            
+0006afd0: 2020 2020 7365 6c66 2e5f 6d65 7373 6167      self._messag
+0006afe0: 655f 6d61 705b 6d5b 2269 6422 5d5d 203d  e_map[m["id"]] =
+0006aff0: 206d 0d0a 2020 2020 2020 2020 2020 2020   m..            
+0006b000: 2020 2020 6966 2073 656c 662e 5f63 656e      if self._cen
+0006b010: 7465 725f 6d65 7373 6167 655f 6964 203d  ter_message_id =
+0006b020: 3d20 6d5b 2269 6422 5d3a 0d0a 2020 2020  = m["id"]:..    
+0006b030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006b040: 666f 6375 735f 6d65 7373 6167 655f 6964  focus_message_id
+0006b050: 203d 206d 5b22 6964 225d 0d0a 2020 2020   = m["id"]..    
+0006b060: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+0006b070: 2061 6e64 206e 6f74 2069 2025 2063 6f6e   and not i % con
+0006b080: 662e 4d61 7848 6973 746f 7279 496e 6974  f.MaxHistoryInit
+0006b090: 6961 6c4d 6573 7361 6765 733a 0d0a 2020  ialMessages:..  
+0006b0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006b0b0: 2020 7778 2e59 6965 6c64 4966 4e65 6564    wx.YieldIfNeed
+0006b0c0: 6564 2829 2023 2054 6f20 6861 7665 2072  ed() # To have r
+0006b0d0: 6573 706f 6e73 6976 6520 4755 490d 0a0d  esponsive GUI...
+0006b0e0: 0a20 2020 2020 2020 2020 2020 2023 2052  .            # R
+0006b0f0: 6573 6574 2074 6865 2063 656e 7465 7265  eset the centere
+0006b100: 6420 6d65 7373 6167 6520 6461 7461 2c20  d message data, 
+0006b110: 6173 2066 696c 7465 7269 6e67 2073 686f  as filtering sho
+0006b120: 756c 6420 6f76 6572 7269 6465 2069 740d  uld override it.
+0006b130: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0006b140: 662e 5f63 656e 7465 725f 6d65 7373 6167  f._center_messag
+0006b150: 655f 696e 6465 7820 3d20 4e6f 6e65 0d0a  e_index = None..
+0006b160: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0006b170: 2e5f 6365 6e74 6572 5f6d 6573 7361 6765  ._center_message
+0006b180: 5f69 6420 3d20 4e6f 6e65 0d0a 2020 2020  _id = None..    
+0006b190: 2020 2020 2020 2020 6966 2066 6f63 7573          if focus
+0006b1a0: 5f6d 6573 7361 6765 5f69 643a 0d0a 2020  _message_id:..  
+0006b1b0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0006b1c0: 6c66 2e46 6f63 7573 4d65 7373 6167 6528  lf.FocusMessage(
+0006b1d0: 666f 6375 735f 6d65 7373 6167 655f 6964  focus_message_id
+0006b1e0: 290d 0a20 2020 2020 2020 2020 2020 2065  )..            e
+0006b1f0: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+0006b200: 2020 2020 2020 7365 6c66 2e53 6372 6f6c        self.Scrol
+0006b210: 6c54 6f4c 696e 6528 7365 6c66 2e4c 696e  lToLine(self.Lin
+0006b220: 6543 6f75 6e74 290d 0a20 2020 2020 2020  eCount)..       
+0006b230: 2020 2020 2073 656c 662e 5468 6177 2829       self.Thaw()
+0006b240: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
+0006b250: 0a20 2020 2020 2020 2020 2020 2023 204e  .            # N
+0006b260: 6f20 6d65 7373 6167 6573 2074 6f20 7368  o messages to sh
+0006b270: 6f77 0d0a 2020 2020 2020 2020 2020 2020  ow..            
+0006b280: 7365 6c66 2e43 6c65 6172 416c 6c28 290d  self.ClearAll().
+0006b290: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0006b2a0: 662e 5f61 7070 656e 645f 7465 7874 2873  f._append_text(s
+0006b2b0: 656c 662e 5445 5854 5f4e 4f5f 4d45 5353  elf.TEXT_NO_MESS
+0006b2c0: 4147 4553 2c20 2273 7065 6369 616c 2229  AGES, "special")
+0006b2d0: 0d0a 2020 2020 2020 2020 7365 6c66 2e53  ..        self.S
+0006b2e0: 6574 5265 6164 4f6e 6c79 2854 7275 6529  etReadOnly(True)
+0006b2f0: 0d0a 0d0a 0d0a 0d0a 2020 2020 6465 6620  ........    def 
+0006b300: 5f77 7269 7465 5f65 6c65 6d65 6e74 2873  _write_element(s
+0006b310: 656c 662c 2064 6f6d 2c20 7267 785f 6869  elf, dom, rgx_hi
+0006b320: 6768 6c69 6768 743d 4e6f 6e65 2c20 7461  ghlight=None, ta
+0006b330: 696c 735f 6e65 773d 4e6f 6e65 293a 0d0a  ils_new=None):..
+0006b340: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
+0006b350: 2020 2020 2041 7070 656e 6473 2074 6865       Appends the
+0006b360: 206d 6573 7361 6765 2062 6f64 7920 746f   message body to
+0006b370: 2074 6865 2053 7479 6c65 6454 6578 7443   the StyledTextC
+0006b380: 7472 6c2e 0d0a 0d0a 2020 2020 2020 2020  trl.....        
+0006b390: 4070 6172 616d 2020 2064 6f6d 2020 2020  @param   dom    
+0006b3a0: 2020 2020 2020 2020 786d 6c2e 6574 7265          xml.etre
+0006b3b0: 652e 6345 6c65 6d65 6e74 5472 6565 2e45  e.cElementTree.E
+0006b3c0: 6c65 6d65 6e74 2069 6e73 7461 6e63 650d  lement instance.
+0006b3d0: 0a20 2020 2020 2020 2040 7061 7261 6d20  .        @param 
+0006b3e0: 2020 7267 785f 6869 6768 6c69 6768 7420    rgx_highlight 
+0006b3f0: 2069 6620 7365 742c 2073 7562 7374 7269   if set, substri
+0006b400: 6e67 7320 6d61 7463 6869 6e67 2074 6865  ngs matching the
+0006b410: 2072 6567 6578 2061 7265 2061 6464 6564   regex are added
+0006b420: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0006b430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006b440: 2020 696e 2068 6967 686c 6967 6874 6564    in highlighted
+0006b450: 2073 7479 6c65 0d0a 2020 2020 2020 2020   style..        
+0006b460: 4070 6172 616d 2020 2074 6169 6c73 5f6e  @param   tails_n
+0006b470: 6577 2020 2020 2020 696e 7465 726e 616c  ew      internal
+0006b480: 2075 7365 2c20 7b65 6c65 6d65 6e74 3a20   use, {element: 
+0006b490: 6d6f 6469 6669 6564 2074 6169 6c20 7374  modified tail st
+0006b4a0: 727d 0d0a 2020 2020 2020 2020 2222 220d  r}..        """.
+0006b4b0: 0a20 2020 2020 2020 2074 6167 7374 796c  .        tagstyl
+0006b4c0: 655f 6d61 7020 3d20 7b22 6222 3a20 2262  e_map = {"b": "b
+0006b4d0: 6f6c 6422 2c20 2269 223a 2022 6974 616c  old", "i": "ital
+0006b4e0: 6963 222c 2022 7322 3a20 2273 7472 696b  ic", "s": "strik
+0006b4f0: 6522 2c0d 0a20 2020 2020 2020 2020 2020  e",..           
+0006b500: 2020 2020 2020 2020 2020 2020 2022 626f               "bo
+0006b510: 6479 7374 6174 7573 223a 2022 7370 6563  dystatus": "spec
+0006b520: 6961 6c22 2c20 2022 7175 6f74 6566 726f  ial",  "quotefro
+0006b530: 6d22 3a20 2273 7065 6369 616c 222c 0d0a  m": "special",..
+0006b540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006b550: 2020 2020 2020 2020 2261 223a 2022 6c69          "a": "li
+0006b560: 6e6b 222c 2022 7373 223a 2022 6465 6661  nk", "ss": "defa
+0006b570: 756c 7422 2c20 2261 7422 3a20 2262 6f6c  ult", "at": "bol
+0006b580: 6422 7d0d 0a20 2020 2020 2020 206f 7468  d"}..        oth
+0006b590: 6572 5f74 6167 7320 3d20 5b22 626c 696e  er_tags = ["blin
+0006b5a0: 6b22 2c20 2266 6f6e 7422 2c20 2262 6f64  k", "font", "bod
+0006b5b0: 7973 7461 7475 7322 2c20 2269 222c 2022  ystatus", "i", "
+0006b5c0: 7370 616e 222c 2022 666c 6167 222c 2022  span", "flag", "
+0006b5d0: 7072 6522 5d0d 0a20 2020 2020 2020 2074  pre"]..        t
+0006b5e0: 6f5f 736b 6970 203d 207b 7d20 2320 7b65  o_skip = {} # {e
+0006b5f0: 6c65 6d65 6e74 2074 6f20 736b 6970 3a20  lement to skip: 
+0006b600: 5472 7565 2c20 7d0d 0a20 2020 2020 2020  True, }..       
+0006b610: 2074 6169 6c73 5f6e 6577 203d 207b 7d20   tails_new = {} 
+0006b620: 6966 2074 6169 6c73 5f6e 6577 2069 7320  if tails_new is 
+0006b630: 4e6f 6e65 2065 6c73 6520 7461 696c 735f  None else tails_
+0006b640: 6e65 770d 0a20 2020 2020 2020 206c 696e  new..        lin
+0006b650: 6566 6565 645f 6669 6e61 6c20 3d20 225c  efeed_final = "\
+0006b660: 6e5c 6e22 2023 2044 6563 7265 6173 6564  n\n" # Decreased
+0006b670: 2069 6620 7175 6f74 6566 726f 6d20 6973   if quotefrom is
+0006b680: 206c 6173 740d 0a0d 0a20 2020 2020 2020   last....       
+0006b690: 2066 6f72 2065 2069 6e20 646f 6d2e 6974   for e in dom.it
+0006b6a0: 6572 2829 3a0d 0a20 2020 2020 2020 2020  er():..         
+0006b6b0: 2020 2023 2050 6f73 7369 626c 6520 7461     # Possible ta
+0006b6c0: 6773 3a20 617c 627c 7c69 7c73 7c62 6f64  gs: a|b||i|s|bod
+0006b6d0: 7973 7461 7475 737c 7175 6f74 657c 7175  ystatus|quote|qu
+0006b6e0: 6f74 6566 726f 6d7c 6d73 6773 7461 7475  otefrom|msgstatu
+0006b6f0: 737c 0d0a 2020 2020 2020 2020 2020 2020  s|..            
+0006b700: 2320 2020 2020 2020 2020 2020 2020 2020  #               
+0006b710: 2073 7061 6e7c 7370 6563 6961 6c7c 786d   span|special|xm
+0006b720: 6c7c 666f 6e74 7c62 6c69 6e6b 0d0a 2020  l|font|blink..  
+0006b730: 2020 2020 2020 2020 2020 6966 2065 2069            if e i
+0006b740: 6e20 746f 5f73 6b69 703a 0d0a 2020 2020  n to_skip:..    
+0006b750: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+0006b760: 696e 7565 0d0a 2020 2020 2020 2020 2020  inue..          
+0006b770: 2020 7374 796c 6520 3d20 7461 6773 7479    style = tagsty
+0006b780: 6c65 5f6d 6170 2e67 6574 2865 2e74 6167  le_map.get(e.tag
+0006b790: 2c20 2264 6566 6175 6c74 2229 0d0a 2020  , "default")..  
+0006b7a0: 2020 2020 2020 2020 2020 7465 7874 203d            text =
+0006b7b0: 2065 2e74 6578 7420 6f72 2022 220d 0a20   e.text or "".. 
+0006b7c0: 2020 2020 2020 2020 2020 2074 6169 6c20             tail 
+0006b7d0: 3d20 7461 696c 735f 6e65 775b 655d 2069  = tails_new[e] i
+0006b7e0: 6620 6520 696e 2074 6169 6c73 5f6e 6577  f e in tails_new
+0006b7f0: 2065 6c73 6520 2865 2e74 6169 6c20 6f72   else (e.tail or
+0006b800: 2022 2229 0d0a 2020 2020 2020 2020 2020   "")..          
+0006b810: 2020 6368 696c 6472 656e 203d 205b 5d0d    children = [].
+0006b820: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0006b830: 6973 696e 7374 616e 6365 2874 6578 742c  isinstance(text,
+0006b840: 2073 6978 2e62 696e 6172 795f 7479 7065   six.binary_type
+0006b850: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+0006b860: 2020 2020 7465 7874 203d 2074 6578 742e      text = text.
+0006b870: 6465 636f 6465 2822 7574 662d 3822 290d  decode("utf-8").
+0006b880: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0006b890: 6973 696e 7374 616e 6365 2874 6169 6c2c  isinstance(tail,
+0006b8a0: 2073 6978 2e62 696e 6172 795f 7479 7065   six.binary_type
+0006b8b0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+0006b8c0: 2020 2020 7461 696c 203d 2074 6169 6c2e      tail = tail.
+0006b8d0: 6465 636f 6465 2822 7574 662d 3822 290d  decode("utf-8").
+0006b8e0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0006b8f0: 2261 2220 3d3d 2065 2e74 6167 3a0d 0a20  "a" == e.tag:.. 
+0006b900: 2020 2020 2020 2020 2020 2020 2020 2068                 h
+0006b910: 7265 6620 3d20 652e 6765 7428 2268 7265  ref = e.get("hre
+0006b920: 6622 290d 0a20 2020 2020 2020 2020 2020  f")..           
+0006b930: 2020 2020 2069 6620 6872 6566 2e73 7461       if href.sta
+0006b940: 7274 7377 6974 6828 2266 696c 653a 2229  rtswith("file:")
+0006b950: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0006b960: 2020 2020 2020 2070 6174 686e 616d 6520         pathname 
+0006b970: 3d20 7572 6c6c 6962 2e72 6571 7565 7374  = urllib.request
+0006b980: 2e75 726c 3270 6174 686e 616d 6528 652e  .url2pathname(e.
+0006b990: 6765 7428 2268 7265 6622 295b 353a 5d29  get("href")[5:])
+0006b9a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0006b9b0: 2020 2020 2020 7365 6c66 2e5f 6669 6c65        self._file
+0006b9c0: 6c69 6e6b 735b 7365 6c66 2e53 5443 2e4c  links[self.STC.L
+0006b9d0: 656e 6774 685d 203d 2070 6174 686e 616d  ength] = pathnam
+0006b9e0: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
+0006b9f0: 2020 2065 6c69 6620 7265 2e6d 6174 6368     elif re.match
+0006ba00: 2822 5e5b 612d 7a5d 2b25 7322 2025 2072  ("^[a-z]+%s" % r
+0006ba10: 652e 6573 6361 7065 2822 3a2f 2f22 292c  e.escape("://"),
+0006ba20: 2068 7265 6629 3a0d 0a20 2020 2020 2020   href):..       
+0006ba30: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0006ba40: 662e 5f75 726c 6c69 6e6b 735b 7365 6c66  f._urllinks[self
+0006ba50: 2e53 5443 2e4c 656e 6774 685d 203d 2068  .STC.Length] = h
+0006ba60: 7265 660d 0a20 2020 2020 2020 2020 2020  ref..           
+0006ba70: 2020 2020 206c 696e 6566 6565 645f 6669       linefeed_fi
+0006ba80: 6e61 6c20 3d20 225c 6e5c 6e22 0d0a 2020  nal = "\n\n"..  
+0006ba90: 2020 2020 2020 2020 2020 656c 6966 2022            elif "
+0006baa0: 7373 2220 3d3d 2065 2e74 6167 3a0d 0a20  ss" == e.tag:.. 
+0006bab0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0006bac0: 6578 7420 3d20 652e 7465 7874 0d0a 2020  ext = e.text..  
+0006bad0: 2020 2020 2020 2020 2020 656c 6966 2022            elif "
+0006bae0: 7175 6f74 6522 203d 3d20 652e 7461 673a  quote" == e.tag:
+0006baf0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0006bb00: 2020 7465 7874 203d 2022 5c22 2220 2b20    text = "\"" + 
+0006bb10: 7465 7874 0d0a 2020 2020 2020 2020 2020  text..          
+0006bb20: 2020 2020 2020 6368 696c 6472 656e 203d        children =
+0006bb30: 206c 6973 7428 6529 0d0a 2020 2020 2020   list(e)..      
+0006bb40: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+0006bb50: 2863 6869 6c64 7265 6e29 203e 2031 3a0d  (children) > 1:.
+0006bb60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0006bb70: 2020 2020 2023 204c 6173 7420 656c 656d       # Last elem
+0006bb80: 656e 7420 6973 2061 6c77 6179 7320 7175  ent is always qu
+0006bb90: 6f74 6566 726f 6d0d 0a20 2020 2020 2020  otefrom..       
+0006bba0: 2020 2020 2020 2020 2020 2020 2063 6869               chi
+0006bbb0: 6c64 7461 696c 203d 2063 6869 6c64 7265  ldtail = childre
+0006bbc0: 6e5b 2d32 5d2e 7461 696c 2069 6620 6368  n[-2].tail if ch
+0006bbd0: 696c 6472 656e 5b2d 325d 2e74 6169 6c20  ildren[-2].tail 
+0006bbe0: 656c 7365 2022 220d 0a20 2020 2020 2020  else ""..       
+0006bbf0: 2020 2020 2020 2020 2020 2020 2074 6169               tai
+0006bc00: 6c73 5f6e 6577 5b63 6869 6c64 7265 6e5b  ls_new[children[
+0006bc10: 2d32 5d5d 203d 2063 6869 6c64 7461 696c  -2]] = childtail
+0006bc20: 202b 2022 5c22 220d 0a20 2020 2020 2020   + "\""..       
+0006bc30: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
+0006bc40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006bc50: 2020 2020 7465 7874 202b 3d20 225c 2222      text += "\""
+0006bc60: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0006bc70: 2020 6c69 6e65 6665 6564 5f66 696e 616c    linefeed_final
+0006bc80: 203d 2022 5c6e 220d 0a20 2020 2020 2020   = "\n"..       
+0006bc90: 2020 2020 2065 6c69 6620 2271 756f 7465       elif "quote
+0006bca0: 6672 6f6d 2220 3d3d 2065 2e74 6167 3a0d  from" == e.tag:.
+0006bcb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0006bcc0: 2074 6578 7420 3d20 225c 6e25 735c 6e22   text = "\n%s\n"
+0006bcd0: 2025 2074 6578 740d 0a20 2020 2020 2020   % text..       
+0006bce0: 2020 2020 2065 6c69 6620 652e 7461 6720       elif e.tag 
+0006bcf0: 696e 205b 2278 6d6c 222c 2022 6222 5d3a  in ["xml", "b"]:
+0006bd00: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0006bd10: 2020 6c69 6e65 6665 6564 5f66 696e 616c    linefeed_final
+0006bd20: 203d 2022 5c6e 5c6e 220d 0a20 2020 2020   = "\n\n"..     
+0006bd30: 2020 2020 2020 2065 6c69 6620 2261 7422         elif "at"
+0006bd40: 203d 3d20 652e 7461 673a 0d0a 2020 2020   == e.tag:..    
+0006bd50: 2020 2020 2020 2020 2020 2020 6966 2074              if t
+0006bd60: 6578 7420 616e 6420 6e6f 7420 7465 7874  ext and not text
+0006bd70: 2e73 7461 7274 7377 6974 6828 2240 2229  .startswith("@")
+0006bd80: 3a20 7465 7874 203d 2022 4022 202b 2074  : text = "@" + t
+0006bd90: 6578 740d 0a20 2020 2020 2020 2020 2020  ext..           
+0006bda0: 2065 6c69 6620 2273 2220 3d3d 2065 2e74   elif "s" == e.t
+0006bdb0: 6167 3a0d 0a20 2020 2020 2020 2020 2020  ag:..           
+0006bdc0: 2020 2020 2074 6578 7420 3d20 227e 2573       text = "~%s
+0006bdd0: 7e22 2025 2074 6578 7420 2320 5354 4320  ~" % text # STC 
+0006bde0: 646f 6573 206e 6f74 2073 7570 706f 7274  does not support
+0006bdf0: 2073 7472 696b 6574 6872 6f75 6768 2073   strikethrough s
+0006be00: 7479 6c65 0d0a 2020 2020 2020 2020 2020  tyle..          
+0006be10: 2020 656c 6966 2065 2e74 6167 206e 6f74    elif e.tag not
+0006be20: 2069 6e20 6f74 6865 725f 7461 6773 3a0d   in other_tags:.
+0006be30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0006be40: 2074 6578 7420 3d20 2222 0d0a 2020 2020   text = ""..    
+0006be50: 2020 2020 2020 2020 6966 2074 6578 743a          if text:
+0006be60: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0006be70: 2020 7365 6c66 2e5f 6170 7065 6e64 5f74    self._append_t
+0006be80: 6578 7428 7465 7874 2c20 7374 796c 652c  ext(text, style,
+0006be90: 2072 6778 5f68 6967 686c 6967 6874 290d   rgx_highlight).
+0006bea0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+0006beb0: 2069 2069 6e20 6368 696c 6472 656e 3a0d   i in children:.
+0006bec0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0006bed0: 2073 656c 662e 5f77 7269 7465 5f65 6c65   self._write_ele
+0006bee0: 6d65 6e74 2869 2c20 7267 785f 6869 6768  ment(i, rgx_high
+0006bef0: 6c69 6768 742c 2074 6169 6c73 5f6e 6577  light, tails_new
+0006bf00: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0006bf10: 2020 2074 6f5f 736b 6970 5b69 5d20 3d20     to_skip[i] = 
+0006bf20: 5472 7565 0d0a 2020 2020 2020 2020 2020  True..          
+0006bf30: 2020 6966 2074 6169 6c3a 0d0a 2020 2020    if tail:..    
+0006bf40: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0006bf50: 2e5f 6170 7065 6e64 5f74 6578 7428 7461  ._append_text(ta
+0006bf60: 696c 2c20 2264 6566 6175 6c74 222c 2072  il, "default", r
+0006bf70: 6778 5f68 6967 686c 6967 6874 290d 0a20  gx_highlight).. 
+0006bf80: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+0006bf90: 696e 6566 6565 645f 6669 6e61 6c20 3d20  inefeed_final = 
+0006bfa0: 225c 6e5c 6e22 0d0a 2020 2020 2020 2020  "\n\n"..        
+0006bfb0: 6966 2022 786d 6c22 203d 3d20 646f 6d2e  if "xml" == dom.
+0006bfc0: 7461 673a 0d0a 2020 2020 2020 2020 2020  tag:..          
+0006bfd0: 2020 7365 6c66 2e5f 6170 7065 6e64 5f74    self._append_t
+0006bfe0: 6578 7428 6c69 6e65 6665 6564 5f66 696e  ext(linefeed_fin
+0006bff0: 616c 290d 0a0d 0a0d 0a20 2020 2064 6566  al)......    def
+0006c000: 205f 6170 7065 6e64 5f74 6578 7428 7365   _append_text(se
+0006c010: 6c66 2c20 7465 7874 2c20 7374 796c 653d  lf, text, style=
+0006c020: 2264 6566 6175 6c74 222c 2072 6778 5f68  "default", rgx_h
+0006c030: 6967 686c 6967 6874 3d4e 6f6e 6529 3a0d  ighlight=None):.
+0006c040: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
+0006c050: 2020 2020 2020 4170 7065 6e64 7320 7465        Appends te
+0006c060: 7874 2074 6f20 7468 6520 5374 796c 6564  xt to the Styled
+0006c070: 5465 7874 4374 726c 2069 6e20 7468 6520  TextCtrl in the 
+0006c080: 7370 6563 6966 6965 6420 7374 796c 652e  specified style.
+0006c090: 0d0a 0d0a 2020 2020 2020 2020 4070 6172  ....        @par
+0006c0a0: 616d 2020 2072 6778 5f68 6967 686c 6967  am   rgx_highlig
+0006c0b0: 6874 2020 6966 2073 6574 2c20 7375 6273  ht  if set, subs
+0006c0c0: 7472 696e 6773 206d 6174 6368 696e 6720  trings matching 
+0006c0d0: 7468 6520 7265 6765 7820 6172 6520 6164  the regex are ad
+0006c0e0: 6465 640d 0a20 2020 2020 2020 2020 2020  ded..           
+0006c0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006c100: 2020 2020 2069 6e20 6869 6768 6c69 6768       in highligh
+0006c110: 7465 6420 7374 796c 650d 0a20 2020 2020  ted style..     
+0006c120: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
+0006c130: 7465 7874 203d 2074 6578 7420 6f72 2022  text = text or "
+0006c140: 220d 0a20 2020 2020 2020 2074 6578 745f  "..        text_
+0006c150: 7061 7274 7320 3d20 7267 785f 6869 6768  parts = rgx_high
+0006c160: 6c69 6768 742e 7370 6c69 7428 7465 7874  light.split(text
+0006c170: 2920 6966 2072 6778 5f68 6967 686c 6967  ) if rgx_highlig
+0006c180: 6874 2065 6c73 6520 5b74 6578 745d 0d0a  ht else [text]..
+0006c190: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+0006c1a0: 7461 6e63 6528 7465 7874 2c20 7369 782e  tance(text, six.
+0006c1b0: 7465 7874 5f74 7970 6529 3a0d 0a20 2020  text_type):..   
+0006c1c0: 2020 2020 2020 2020 2074 6578 745f 7061           text_pa
+0006c1d0: 7274 7320 3d20 5b78 2e65 6e63 6f64 6528  rts = [x.encode(
+0006c1e0: 2275 7466 2d38 2229 2066 6f72 2078 2069  "utf-8") for x i
+0006c1f0: 6e20 7465 7874 5f70 6172 7473 5d0d 0a20  n text_parts].. 
+0006c200: 2020 2020 2020 2062 6f6c 6420 3d20 2262         bold = "b
+0006c210: 6f6c 6425 7322 2025 2073 7479 6c65 2069  old%s" % style i
+0006c220: 6620 2262 6f6c 6425 7322 2025 2073 7479  f "bold%s" % sty
+0006c230: 6c65 2069 6e20 7365 6c66 2e5f 7374 796c  le in self._styl
+0006c240: 6573 2065 6c73 6520 7374 796c 650d 0a20  es else style.. 
+0006c250: 2020 2020 2020 206c 656e 5f73 656c 6620         len_self 
+0006c260: 3d20 7365 6c66 2e47 6574 5465 7874 4c65  = self.GetTextLe
+0006c270: 6e67 7468 2829 0d0a 2020 2020 2020 2020  ngth()..        
+0006c280: 7365 6c66 2e53 5443 2e41 7070 656e 6454  self.STC.AppendT
+0006c290: 6578 7428 7465 7874 290d 0a20 2020 2020  ext(text)..     
+0006c2a0: 2020 2073 656c 662e 5354 432e 5374 6172     self.STC.Star
+0006c2b0: 7453 7479 6c69 6e67 286c 656e 5f73 656c  tStyling(len_sel
+0006c2c0: 6629 0d0a 2020 2020 2020 2020 7365 6c66  f)..        self
+0006c2d0: 2e53 5443 2e53 6574 5374 796c 696e 6728  .STC.SetStyling(
+0006c2e0: 6c65 6e28 7465 7874 292c 2073 656c 662e  len(text), self.
+0006c2f0: 5f73 7479 6c65 735b 7374 796c 655d 290d  _styles[style]).
+0006c300: 0a20 2020 2020 2020 2066 6f72 2069 2c20  .        for i, 
+0006c310: 7420 696e 2065 6e75 6d65 7261 7465 2874  t in enumerate(t
+0006c320: 6578 745f 7061 7274 7329 3a0d 0a20 2020  ext_parts):..   
+0006c330: 2020 2020 2020 2020 2069 6620 6920 2520           if i % 
+0006c340: 323a 0d0a 2020 2020 2020 2020 2020 2020  2:..            
+0006c350: 2020 2020 7365 6c66 2e53 5443 2e53 7461      self.STC.Sta
+0006c360: 7274 5374 796c 696e 6728 6c65 6e5f 7365  rtStyling(len_se
+0006c370: 6c66 290d 0a20 2020 2020 2020 2020 2020  lf)..           
+0006c380: 2020 2020 2073 656c 662e 5354 432e 5365       self.STC.Se
+0006c390: 7453 7479 6c69 6e67 286c 656e 2874 292c  tStyling(len(t),
+0006c3a0: 2073 656c 662e 5f73 7479 6c65 735b 626f   self._styles[bo
+0006c3b0: 6c64 5d29 0d0a 2020 2020 2020 2020 2020  ld])..          
+0006c3c0: 2020 6c65 6e5f 7365 6c66 202b 3d20 6c65    len_self += le
+0006c3d0: 6e28 7429 0d0a 0d0a 0d0a 2020 2020 6465  n(t)......    de
+0006c3e0: 6620 5f61 7070 656e 645f 6d75 6c74 696c  f _append_multil
+0006c3f0: 696e 6528 7365 6c66 2c20 7465 7874 2c20  ine(self, text, 
+0006c400: 696e 6465 6e74 293a 0d0a 2020 2020 2020  indent):..      
+0006c410: 2020 2222 220d 0a20 2020 2020 2020 2041    """..        A
+0006c420: 7070 656e 6473 2074 6578 7420 7769 7468  ppends text with
+0006c430: 206e 6577 206c 696e 6573 2069 6e64 656e   new lines inden
+0006c440: 7465 6420 6174 2074 6865 2073 7065 6369  ted at the speci
+0006c450: 6669 6564 206c 6576 656c 2e0d 0a20 2020  fied level...   
+0006c460: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
+0006c470: 2020 6966 2022 5c6e 2220 696e 2074 6578    if "\n" in tex
+0006c480: 743a 0d0a 2020 2020 2020 2020 2020 2020  t:..            
+0006c490: 666f 7220 6c69 6e65 2069 6e20 7465 7874  for line in text
+0006c4a0: 2e73 706c 6974 6c69 6e65 7328 293a 0d0a  .splitlines():..
+0006c4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006c4c0: 7365 6c66 2e5f 6170 7065 6e64 5f74 6578  self._append_tex
+0006c4d0: 7428 2225 735c 6e22 2025 206c 696e 6529  t("%s\n" % line)
+0006c4e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0006c4f0: 2020 6966 2073 656c 662e 5553 455f 434f    if self.USE_CO
+0006c500: 4c55 4d4e 533a 0d0a 2020 2020 2020 2020  LUMNS:..        
+0006c510: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0006c520: 2e53 6574 4c69 6e65 496e 6465 6e74 6174  .SetLineIndentat
+0006c530: 696f 6e28 7365 6c66 2e4c 696e 6543 6f75  ion(self.LineCou
+0006c540: 6e74 202d 2031 2c20 696e 6465 6e74 290d  nt - 1, indent).
+0006c550: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0006c560: 7365 6c66 2e55 5345 5f43 4f4c 554d 4e53  self.USE_COLUMNS
+0006c570: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0006c580: 2020 2073 656c 662e 5365 744c 696e 6549     self.SetLineI
+0006c590: 6e64 656e 7461 7469 6f6e 2873 656c 662e  ndentation(self.
+0006c5a0: 4c69 6e65 436f 756e 7420 2d20 312c 2030  LineCount - 1, 0
+0006c5b0: 290d 0a20 2020 2020 2020 2065 6c73 653a  )..        else:
+0006c5c0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+0006c5d0: 6c66 2e5f 6170 7065 6e64 5f74 6578 7428  lf._append_text(
+0006c5e0: 7465 7874 290d 0a0d 0a0d 0a20 2020 2064  text)......    d
+0006c5f0: 6566 2050 6f70 756c 6174 6528 7365 6c66  ef Populate(self
+0006c600: 2c20 6368 6174 2c20 6462 2c20 6d65 7373  , chat, db, mess
+0006c610: 6167 6573 3d4e 6f6e 652c 2063 656e 7465  ages=None, cente
+0006c620: 725f 6d65 7373 6167 655f 6964 3d4e 6f6e  r_message_id=Non
+0006c630: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
+0006c640: 2020 2020 2066 726f 6d5f 696e 6465 783d       from_index=
+0006c650: 4e6f 6e65 293a 0d0a 2020 2020 2020 2020  None):..        
+0006c660: 2222 220d 0a20 2020 2020 2020 2050 6f70  """..        Pop
+0006c670: 756c 6174 6573 2074 6865 2063 6861 7420  ulates the chat 
+0006c680: 6869 7374 6f72 7920 7769 7468 206d 6573  history with mes
+0006c690: 7361 6765 7320 6672 6f6d 2074 6865 2073  sages from the s
+0006c6a0: 7065 6369 6669 6564 2063 6861 742e 0d0a  pecified chat...
+0006c6b0: 0d0a 2020 2020 2020 2020 4070 6172 616d  ..        @param
+0006c6c0: 2020 2063 6861 7420 2020 2020 2020 2020     chat         
+0006c6d0: 2020 2020 2020 6368 6174 2064 6174 612c        chat data,
+0006c6e0: 2061 7320 7265 7475 726e 6564 2066 726f   as returned fro
+0006c6f0: 6d20 536b 7970 6544 6174 6162 6173 650d  m SkypeDatabase.
+0006c700: 0a20 2020 2020 2020 2040 7061 7261 6d20  .        @param 
+0006c710: 2020 6462 2020 2020 2020 2020 2020 2020    db            
+0006c720: 2020 2020 2053 6b79 7065 4461 7461 6261       SkypeDataba
+0006c730: 7365 2074 6f20 7573 650d 0a20 2020 2020  se to use..     
+0006c740: 2020 2040 7061 7261 6d20 2020 6d65 7373     @param   mess
+0006c750: 6167 6573 2020 2020 2020 2020 2020 206d  ages           m
+0006c760: 6573 7361 6765 7320 746f 2073 686f 7720  essages to show 
+0006c770: 2869 6620 7365 742c 206d 6573 7361 6765  (if set, message
+0006c780: 7320 6172 6520 6e6f 740d 0a20 2020 2020  s are not..     
+0006c790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006c7a0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0006c7b0: 6574 7269 6576 6564 2066 726f 6d20 6461  etrieved from da
+0006c7c0: 7461 6261 7365 290d 0a20 2020 2020 2020  tabase)..       
+0006c7d0: 2040 7061 7261 6d20 2020 6365 6e74 6572   @param   center
+0006c7e0: 5f6d 6573 7361 6765 5f69 6420 2069 6620  _message_id  if 
+0006c7f0: 7365 742c 2073 7065 6369 6669 6573 2074  set, specifies t
+0006c800: 6865 206d 6573 7361 6765 2061 726f 756e  he message aroun
+0006c810: 6420 7768 6963 680d 0a20 2020 2020 2020  d which..       
+0006c820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006c830: 2020 2020 2020 2020 2020 2020 2074 6f20               to 
+0006c840: 6365 6e74 6572 206f 7468 6572 206d 6573  center other mes
+0006c850: 7361 6765 7320 696e 2074 6865 2073 686f  sages in the sho
+0006c860: 776e 2072 616e 6765 0d0a 2020 2020 2020  wn range..      
+0006c870: 2020 4070 6172 616d 2020 2066 726f 6d5f    @param   from_
+0006c880: 696e 6465 7820 2020 2020 2020 2020 696e  index         in
+0006c890: 6465 7820 6f66 206d 6573 7361 6765 2074  dex of message t
+0006c8a0: 6f20 7368 6f77 2066 726f 6d2c 2069 6620  o show from, if 
+0006c8b0: 6d65 7373 6167 6573 2067 6976 656e 0d0a  messages given..
+0006c8c0: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
+0006c8d0: 2020 2020 2073 656c 662e 436c 6561 7241       self.ClearA
+0006c8e0: 6c6c 2829 0d0a 2020 2020 2020 2020 7365  ll()..        se
+0006c8f0: 6c66 2e52 6566 7265 7368 2829 0d0a 2020  lf.Refresh()..  
+0006c900: 2020 2020 2020 7365 6c66 2e5f 6365 6e74        self._cent
+0006c910: 6572 5f6d 6573 7361 6765 5f69 6e64 6578  er_message_index
+0006c920: 203d 204e 6f6e 650d 0a20 2020 2020 2020   = None..       
+0006c930: 2073 656c 662e 5f63 656e 7465 725f 6d65   self._center_me
+0006c940: 7373 6167 655f 6964 203d 204e 6f6e 650d  ssage_id = None.
+0006c950: 0a0d 0a20 2020 2020 2020 2069 6620 6368  ...        if ch
+0006c960: 6174 2069 7320 4e6f 6e65 3a0d 0a20 2020  at is None:..   
+0006c970: 2020 2020 2020 2020 206d 6573 7361 6765           message
+0006c980: 735f 6375 7272 656e 742c 206d 6573 7361  s_current, messa
+0006c990: 6765 5f72 616e 6765 203d 205b 5d2c 205b  ge_range = [], [
+0006c9a0: 5d0d 0a20 2020 2020 2020 2065 6c69 6620  ]..        elif 
+0006c9b0: 6d65 7373 6167 6573 2069 7320 4e6f 6e65  messages is None
+0006c9c0: 3a0d 0a20 2020 2020 2020 2020 2020 206d  :..            m
+0006c9d0: 6d2c 2063 656e 7465 725f 6d65 7373 6167  m, center_messag
+0006c9e0: 655f 6920 3d20 5b5d 2c20 4e6f 6e65 0d0a  e_i = [], None..
+0006c9f0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0006ca00: 692c 206d 2069 6e20 656e 756d 6572 6174  i, m in enumerat
+0006ca10: 6528 6462 2e67 6574 5f6d 6573 7361 6765  e(db.get_message
+0006ca20: 7328 6368 6174 2c20 6173 6365 6e64 696e  s(chat, ascendin
+0006ca30: 673d 4661 6c73 6529 293a 0d0a 2020 2020  g=False)):..    
+0006ca40: 2020 2020 2020 2020 2020 2020 6d6d 2e61              mm.a
+0006ca50: 7070 656e 6428 6d29 0d0a 2020 2020 2020  ppend(m)..      
+0006ca60: 2020 2020 2020 2020 2020 6966 206d 5b22            if m["
+0006ca70: 6964 225d 203d 3d20 6365 6e74 6572 5f6d  id"] == center_m
+0006ca80: 6573 7361 6765 5f69 643a 0d0a 2020 2020  essage_id:..    
+0006ca90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006caa0: 7365 6c66 2e5f 6365 6e74 6572 5f6d 6573  self._center_mes
+0006cab0: 7361 6765 5f69 6420 3d20 6365 6e74 6572  sage_id = center
+0006cac0: 5f6d 6573 7361 6765 5f69 640d 0a20 2020  _message_id..   
+0006cad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006cae0: 2063 656e 7465 725f 6d65 7373 6167 655f   center_message_
+0006caf0: 6920 3d20 690d 0a0d 0a20 2020 2020 2020  i = i....       
+0006cb00: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+0006cb10: 2e5f 6365 6e74 6572 5f6d 6573 7361 6765  ._center_message
+0006cb20: 5f69 6420 6973 206e 6f74 204e 6f6e 653a  _id is not None:
+0006cb30: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0006cb40: 2020 2020 2020 6966 2069 202b 2031 202d        if i + 1 -
+0006cb50: 2063 656e 7465 725f 6d65 7373 6167 655f   center_message_
+0006cb60: 6920 3e3d 2063 6f6e 662e 4d61 7848 6973  i >= conf.MaxHis
+0006cb70: 746f 7279 496e 6974 6961 6c4d 6573 7361  toryInitialMessa
+0006cb80: 6765 7320 2f2f 2032 3a0d 0a20 2020 2020  ges // 2:..     
+0006cb90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006cba0: 2020 2062 7265 616b 2023 2066 6f72 2069     break # for i
+0006cbb0: 2c20 6d0d 0a20 2020 2020 2020 2020 2020  , m..           
+0006cbc0: 2020 2020 2065 6c69 6620 6920 2b20 3120       elif i + 1 
+0006cbd0: 3e3d 2063 6f6e 662e 4d61 7848 6973 746f  >= conf.MaxHisto
+0006cbe0: 7279 496e 6974 6961 6c4d 6573 7361 6765  ryInitialMessage
+0006cbf0: 733a 2062 7265 616b 2023 2066 6f72 2069  s: break # for i
+0006cc00: 2c20 6d0d 0a0d 0a20 2020 2020 2020 2020  , m....         
+0006cc10: 2020 206d 6573 7361 6765 735f 6375 7272     messages_curr
+0006cc20: 656e 742c 206d 6573 7361 6765 5f72 616e  ent, message_ran
+0006cc30: 6765 203d 206d 6d5b 3a3a 2d31 5d2c 206d  ge = mm[::-1], m
+0006cc40: 6d5b 3a3a 2d31 5d20 2320 5365 7420 6173  m[::-1] # Set as
+0006cc50: 6365 6e64 696e 670d 0a20 2020 2020 2020  cending..       
+0006cc60: 2020 2020 2069 6620 6365 6e74 6572 5f6d       if center_m
+0006cc70: 6573 7361 6765 5f69 2069 7320 6e6f 7420  essage_i is not 
+0006cc80: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+0006cc90: 2020 2020 2020 2073 656c 662e 5f63 656e         self._cen
+0006cca0: 7465 725f 6d65 7373 6167 655f 696e 6465  ter_message_inde
+0006ccb0: 7820 3d20 6c65 6e28 6d6d 2920 2d20 6365  x = len(mm) - ce
+0006ccc0: 6e74 6572 5f6d 6573 7361 6765 5f69 2d31  nter_message_i-1
+0006ccd0: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
+0006cce0: 0a20 2020 2020 2020 2020 2020 206d 6573  .            mes
+0006ccf0: 7361 6765 735f 6375 7272 656e 742c 206d  sages_current, m
+0006cd00: 6573 7361 6765 5f72 616e 6765 203d 206d  essage_range = m
+0006cd10: 6573 7361 6765 735b 6672 6f6d 5f69 6e64  essages[from_ind
+0006cd20: 6578 206f 7220 303a 5d2c 206d 6573 7361  ex or 0:], messa
+0006cd30: 6765 735b 3a5d 0d0a 0d0a 2020 2020 2020  ges[:]....      
+0006cd40: 2020 7365 6c66 2e5f 6368 6174 203d 2063    self._chat = c
+0006cd50: 6861 740d 0a20 2020 2020 2020 2073 656c  hat..        sel
+0006cd60: 662e 5f64 6220 3d20 6462 0d0a 2020 2020  f._db = db..    
+0006cd70: 2020 2020 7365 6c66 2e5f 6d65 7373 6167      self._messag
+0006cd80: 6573 5f63 7572 7265 6e74 203d 206d 6573  es_current = mes
+0006cd90: 7361 6765 735f 6375 7272 656e 740d 0a20  sages_current.. 
+0006cda0: 2020 2020 2020 2073 656c 662e 5f6d 6573         self._mes
+0006cdb0: 7361 6765 7320 3d20 6d65 7373 6167 655f  sages = message_
+0006cdc0: 7261 6e67 650d 0a20 2020 2020 2020 2073  range..        s
+0006cdd0: 656c 662e 5f66 696c 7465 725b 2264 6174  elf._filter["dat
+0006cde0: 6572 616e 6765 225d 203d 205b 0d0a 2020  erange"] = [..  
+0006cdf0: 2020 2020 2020 2020 2020 6d65 7373 6167            messag
+0006ce00: 6573 5f63 7572 7265 6e74 5b20 305d 5b22  es_current[ 0]["
+0006ce10: 6461 7465 7469 6d65 225d 2e64 6174 6528  datetime"].date(
+0006ce20: 2920 6966 206d 6573 7361 6765 735f 6375  ) if messages_cu
+0006ce30: 7272 656e 7420 656c 7365 204e 6f6e 652c  rrent else None,
+0006ce40: 0d0a 2020 2020 2020 2020 2020 2020 6d65  ..            me
+0006ce50: 7373 6167 6573 5f63 7572 7265 6e74 5b2d  ssages_current[-
+0006ce60: 315d 5b22 6461 7465 7469 6d65 225d 2e64  1]["datetime"].d
+0006ce70: 6174 6528 2920 6966 206d 6573 7361 6765  ate() if message
+0006ce80: 735f 6375 7272 656e 7420 656c 7365 204e  s_current else N
+0006ce90: 6f6e 650d 0a20 2020 2020 2020 205d 0d0a  one..        ]..
+0006cea0: 2020 2020 2020 2020 7365 6c66 2e52 6566          self.Ref
+0006ceb0: 7265 7368 4d65 7373 6167 6573 2863 656e  reshMessages(cen
+0006cec0: 7465 725f 6d65 7373 6167 655f 6964 290d  ter_message_id).
+0006ced0: 0a0d 0a0d 0a20 2020 2064 6566 204e 6578  .....    def Nex
+0006cee0: 7446 726f 6d41 7574 686f 7228 7365 6c66  tFromAuthor(self
+0006cef0: 2c20 6175 7468 6f72 2c20 6375 7272 656e  , author, curren
+0006cf00: 742c 2064 6972 6563 7469 6f6e 3d2b 3129  t, direction=+1)
+0006cf10: 3a0d 0a20 2020 2020 2020 2022 2222 0d0a  :..        """..
+0006cf20: 2020 2020 2020 2020 5363 726f 6c6c 7320          Scrolls 
+0006cf30: 746f 2061 6e6f 7468 6572 206d 6573 7361  to another messa
+0006cf40: 6765 2066 726f 6d20 7361 6d65 2061 7574  ge from same aut
+0006cf50: 686f 722e 0d0a 0d0a 2020 2020 2020 2020  hor.....        
+0006cf60: 4070 6172 616d 2020 2061 7574 686f 7220  @param   author 
+0006cf70: 2020 2020 736b 7970 656e 616d 6520 6f66      skypename of
+0006cf80: 2061 7574 686f 7220 746f 2066 696e 640d   author to find.
+0006cf90: 0a20 2020 2020 2020 2040 7061 7261 6d20  .        @param 
+0006cfa0: 2020 6375 7272 656e 7420 2020 206d 6573    current    mes
+0006cfb0: 7361 6765 2069 6e64 6578 2069 6e20 6375  sage index in cu
+0006cfc0: 7272 656e 7420 636f 6e74 656e 7420 746f  rrent content to
+0006cfd0: 2073 7461 7274 2066 726f 6d0d 0a20 2020   start from..   
+0006cfe0: 2020 2020 2040 7061 7261 6d20 2020 6469       @param   di
+0006cff0: 7265 6374 696f 6e20 2070 6f73 6974 6976  rection  positiv
+0006d000: 6520 666f 7220 666f 7277 6172 6473 2c20  e for forwards, 
+0006d010: 6e65 6761 7469 7665 2066 6f72 2062 6163  negative for bac
+0006d020: 6b77 6172 6473 0d0a 2020 2020 2020 2020  kwards..        
+0006d030: 2222 220d 0a20 2020 2020 2020 2073 7465  """..        ste
+0006d040: 7020 3d20 2d31 2069 6620 6469 7265 6374  p = -1 if direct
+0006d050: 696f 6e20 3c20 3020 656c 7365 202b 310d  ion < 0 else +1.
+0006d060: 0a20 2020 2020 2020 2069 6478 2c20 6d6d  .        idx, mm
+0006d070: 203d 2063 7572 7265 6e74 202b 2073 7465   = current + ste
+0006d080: 702c 2073 656c 662e 5f6d 6573 7361 6765  p, self._message
+0006d090: 735f 6375 7272 656e 7420 6f72 205b 5d0d  s_current or [].
+0006d0a0: 0a20 2020 2020 2020 206d 7367 203d 206d  .        msg = m
+0006d0b0: 6d5b 6964 785d 2069 6620 3020 3c3d 2069  m[idx] if 0 <= i
+0006d0c0: 6478 203c 206c 656e 286d 6d29 2065 6c73  dx < len(mm) els
+0006d0d0: 6520 4e6f 6e65 0d0a 2020 2020 2020 2020  e None..        
+0006d0e0: 7768 696c 6520 6d73 673a 0d0a 2020 2020  while msg:..    
+0006d0f0: 2020 2020 2020 2020 6966 206d 7367 5b22          if msg["
+0006d100: 6175 7468 6f72 225d 203d 3d20 6175 7468  author"] == auth
+0006d110: 6f72 3a0d 0a20 2020 2020 2020 2020 2020  or:..           
+0006d120: 2020 2020 2067 7569 6261 7365 2e73 7461       guibase.sta
+0006d130: 7475 7328 290d 0a20 2020 2020 2020 2020  tus()..         
+0006d140: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0006d150: 6c66 2e46 6f63 7573 4d65 7373 6167 6528  lf.FocusMessage(
+0006d160: 6d73 675b 2269 6422 5d29 0d0a 2020 2020  msg["id"])..    
+0006d170: 2020 2020 2020 2020 6964 7820 2b3d 2073          idx += s
+0006d180: 7465 700d 0a20 2020 2020 2020 2020 2020  tep..           
+0006d190: 206d 7367 203d 206d 6d5b 6964 785d 2069   msg = mm[idx] i
+0006d1a0: 6620 3020 3c3d 2069 6478 203c 206c 656e  f 0 <= idx < len
+0006d1b0: 286d 6d29 2065 6c73 6520 4e6f 6e65 0d0a  (mm) else None..
+0006d1c0: 2020 2020 2020 2020 6c61 6265 6c20 3d20          label = 
+0006d1d0: 2270 7265 7669 6f75 7322 2069 6620 6469  "previous" if di
+0006d1e0: 7265 6374 696f 6e20 3c20 3020 656c 7365  rection < 0 else
+0006d1f0: 2022 6e65 7874 220d 0a20 2020 2020 2020   "next"..       
+0006d200: 206e 616d 6520 3d20 7365 6c66 2e5f 6462   name = self._db
+0006d210: 2e67 6574 5f61 7574 686f 725f 6e61 6d65  .get_author_name
+0006d220: 287b 2261 7574 686f 7222 3a20 6175 7468  ({"author": auth
+0006d230: 6f72 7d29 0d0a 2020 2020 2020 2020 6775  or})..        gu
+0006d240: 6962 6173 652e 7374 6174 7573 2822 4e6f  ibase.status("No
+0006d250: 2025 7320 6d65 7373 6167 6520 6672 6f6d   %s message from
+0006d260: 2025 7320 666f 756e 6420 696e 2063 7572   %s found in cur
+0006d270: 7265 6e74 2076 6965 772e 222c 206c 6162  rent view.", lab
+0006d280: 656c 2c20 6e61 6d65 290d 0a0d 0a0d 0a20  el, name)...... 
+0006d290: 2020 2064 6566 204e 6578 7454 696d 6528     def NextTime(
+0006d2a0: 7365 6c66 2c20 756e 6974 2c20 6375 7272  self, unit, curr
+0006d2b0: 656e 742c 2064 6972 6563 7469 6f6e 3d2b  ent, direction=+
+0006d2c0: 3129 3a0d 0a20 2020 2020 2020 2022 2222  1):..        """
+0006d2d0: 0d0a 2020 2020 2020 2020 5363 726f 6c6c  ..        Scroll
+0006d2e0: 7320 746f 206d 6573 7361 6765 2066 726f  s to message fro
+0006d2f0: 6d20 6e65 7874 2074 696d 6520 756e 6974  m next time unit
+0006d300: 2e0d 0a0d 0a20 2020 2020 2020 2040 7061  .....        @pa
+0006d310: 7261 6d20 2020 756e 6974 2020 2020 2020  ram   unit      
+0006d320: 2022 6461 7922 206f 7220 2277 6565 6b22   "day" or "week"
+0006d330: 206f 7220 226d 6f6e 7468 220d 0a20 2020   or "month"..   
+0006d340: 2020 2020 2040 7061 7261 6d20 2020 6375       @param   cu
+0006d350: 7272 656e 7420 2020 206d 6573 7361 6765  rrent    message
+0006d360: 2069 6e64 6578 2069 6e20 6375 7272 656e   index in curren
+0006d370: 7420 636f 6e74 656e 7420 746f 2073 7461  t content to sta
+0006d380: 7274 2066 726f 6d0d 0a20 2020 2020 2020  rt from..       
+0006d390: 2040 7061 7261 6d20 2020 6469 7265 6374   @param   direct
+0006d3a0: 696f 6e20 2070 6f73 6974 6976 6520 666f  ion  positive fo
+0006d3b0: 7220 666f 7277 6172 6473 2c20 6e65 6761  r forwards, nega
+0006d3c0: 7469 7665 2066 6f72 2062 6163 6b77 6172  tive for backwar
+0006d3d0: 6473 0d0a 2020 2020 2020 2020 2222 220d  ds..        """.
+0006d3e0: 0a20 2020 2020 2020 2069 6620 756e 6974  .        if unit
+0006d3f0: 206e 6f74 2069 6e20 2822 6461 7922 2c20   not in ("day", 
+0006d400: 2277 6565 6b22 2c20 226d 6f6e 7468 2229  "week", "month")
+0006d410: 3a20 7265 7475 726e 0d0a 2020 2020 2020  : return..      
+0006d420: 2020 6775 6962 6173 652e 7374 6174 7573    guibase.status
+0006d430: 2829 0d0a 2020 2020 2020 2020 7374 6570  ()..        step
+0006d440: 203d 202d 3120 6966 2064 6972 6563 7469   = -1 if directi
+0006d450: 6f6e 203c 2030 2065 6c73 6520 2b31 0d0a  on < 0 else +1..
+0006d460: 2020 2020 2020 2020 6964 782c 206d 6d20          idx, mm 
+0006d470: 3d20 6375 7272 656e 7420 2b20 7374 6570  = current + step
+0006d480: 2c20 7365 6c66 2e5f 6d65 7373 6167 6573  , self._messages
+0006d490: 5f63 7572 7265 6e74 206f 7220 5b5d 0d0a  _current or []..
+0006d4a0: 2020 2020 2020 2020 6d73 6730 203d 206d          msg0 = m
+0006d4b0: 6d5b 6375 7272 656e 745d 2069 6620 3020  m[current] if 0 
+0006d4c0: 3c3d 2063 7572 7265 6e74 203c 206c 656e  <= current < len
+0006d4d0: 286d 6d29 2065 6c73 6520 4e6f 6e65 0d0a  (mm) else None..
+0006d4e0: 2020 2020 2020 2020 6966 206e 6f74 206d          if not m
+0006d4f0: 7367 303a 2072 6574 7572 6e0d 0a0d 0a20  sg0: return.... 
+0006d500: 2020 2020 2020 2064 6566 206d 616b 655f         def make_
+0006d510: 7468 7265 7368 6f6c 6428 6474 2c20 7374  threshold(dt, st
+0006d520: 6570 293a 0d0a 2020 2020 2020 2020 2020  ep):..          
+0006d530: 2020 6474 203d 2064 742e 7265 706c 6163    dt = dt.replac
+0006d540: 6528 686f 7572 3d30 2c20 6d69 6e75 7465  e(hour=0, minute
+0006d550: 3d30 2c20 7365 636f 6e64 3d30 2c20 6d69  =0, second=0, mi
+0006d560: 6372 6f73 6563 6f6e 643d 3029 0d0a 2020  crosecond=0)..  
+0006d570: 2020 2020 2020 2020 2020 6966 2020 2022            if   "
+0006d580: 6461 7922 2020 203d 3d20 756e 6974 3a0d  day"   == unit:.
+0006d590: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0006d5a0: 2072 6573 756c 7420 3d20 6474 202b 2073   result = dt + s
+0006d5b0: 7465 7020 2a20 6461 7465 7469 6d65 2e74  tep * datetime.t
+0006d5c0: 696d 6564 656c 7461 2864 6179 733d 3129  imedelta(days=1)
+0006d5d0: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
+0006d5e0: 6966 2022 7765 656b 2220 203d 3d20 756e  if "week"  == un
+0006d5f0: 6974 3a0d 0a20 2020 2020 2020 2020 2020  it:..           
+0006d600: 2020 2020 2064 746d 6f6e 203d 2064 7420       dtmon = dt 
+0006d610: 2d20 6461 7465 7469 6d65 2e74 696d 6564  - datetime.timed
+0006d620: 656c 7461 2864 6179 733d 6474 2e77 6565  elta(days=dt.wee
+0006d630: 6b64 6179 2829 290d 0a20 2020 2020 2020  kday())..       
+0006d640: 2020 2020 2020 2020 2072 6573 756c 7420           result 
+0006d650: 3d20 6474 6d6f 6e20 2b20 7374 6570 202a  = dtmon + step *
+0006d660: 2064 6174 6574 696d 652e 7469 6d65 6465   datetime.timede
+0006d670: 6c74 6128 6461 7973 3d37 290d 0a20 2020  lta(days=7)..   
+0006d680: 2020 2020 2020 2020 2065 6c69 6620 226d           elif "m
+0006d690: 6f6e 7468 2220 3d3d 2075 6e69 743a 0d0a  onth" == unit:..
+0006d6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006d6b0: 6465 6c74 6120 3d20 6461 7465 7469 6d65  delta = datetime
+0006d6c0: 2e74 696d 6564 656c 7461 2864 6179 733d  .timedelta(days=
+0006d6d0: 3332 2069 6620 7374 6570 203e 2030 2065  32 if step > 0 e
+0006d6e0: 6c73 6520 3129 0d0a 2020 2020 2020 2020  lse 1)..        
+0006d6f0: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
+0006d700: 2028 6474 2e72 6570 6c61 6365 2864 6179   (dt.replace(day
+0006d710: 3d31 2920 2b20 7374 6570 202a 2064 656c  =1) + step * del
+0006d720: 7461 292e 7265 706c 6163 6528 6461 793d  ta).replace(day=
+0006d730: 3129 0d0a 2020 2020 2020 2020 2020 2020  1)..            
+0006d740: 7265 7475 726e 2072 6573 756c 740d 0a0d  return result...
+0006d750: 0a20 2020 2020 2020 2074 6872 6573 686f  .        thresho
+0006d760: 6c64 2c20 7368 6966 7465 6420 3d20 6d61  ld, shifted = ma
+0006d770: 6b65 5f74 6872 6573 686f 6c64 286d 7367  ke_threshold(msg
+0006d780: 305b 2264 6174 6574 696d 6522 5d2c 2073  0["datetime"], s
+0006d790: 7465 7029 2c20 4661 6c73 650d 0a20 2020  tep), False..   
+0006d7a0: 2020 2020 206d 7367 2c20 7072 6576 6d73       msg, prevms
+0006d7b0: 6720 3d20 286d 6d5b 6964 785d 2069 6620  g = (mm[idx] if 
+0006d7c0: 3020 3c3d 2069 6478 203c 206c 656e 286d  0 <= idx < len(m
+0006d7d0: 6d29 2065 6c73 6520 4e6f 6e65 292c 204e  m) else None), N
+0006d7e0: 6f6e 650d 0a20 2020 2020 2020 2077 6869  one..        whi
+0006d7f0: 6c65 2073 7465 7020 3e20 3020 616e 6420  le step > 0 and 
+0006d800: 6d73 673a 0d0a 2020 2020 2020 2020 2020  msg:..          
+0006d810: 2020 6966 206d 7367 5b22 6461 7465 7469    if msg["dateti
+0006d820: 6d65 225d 203e 3d20 7468 7265 7368 6f6c  me"] >= threshol
+0006d830: 643a 2072 6574 7572 6e20 7365 6c66 2e46  d: return self.F
+0006d840: 6f63 7573 4d65 7373 6167 6528 6d73 675b  ocusMessage(msg[
+0006d850: 2269 6422 5d29 0d0a 2020 2020 2020 2020  "id"])..        
+0006d860: 2020 2020 6964 7820 2b3d 2073 7465 700d      idx += step.
+0006d870: 0a20 2020 2020 2020 2020 2020 206d 7367  .            msg
+0006d880: 203d 206d 6d5b 6964 785d 2069 6620 3020   = mm[idx] if 0 
+0006d890: 3c3d 2069 6478 203c 206c 656e 286d 6d29  <= idx < len(mm)
+0006d8a0: 2065 6c73 6520 4e6f 6e65 0d0a 2020 2020   else None..    
+0006d8b0: 2020 2020 7768 696c 6520 7374 6570 203c      while step <
+0006d8c0: 2030 2061 6e64 206d 7367 3a0d 0a20 2020   0 and msg:..   
+0006d8d0: 2020 2020 2020 2020 2069 6620 6d73 675b           if msg[
+0006d8e0: 2264 6174 6574 696d 6522 5d20 3c20 7468  "datetime"] < th
+0006d8f0: 7265 7368 6f6c 6420 616e 6420 7072 6576  reshold and prev
+0006d900: 6d73 673a 0d0a 2020 2020 2020 2020 2020  msg:..          
+0006d910: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+0006d920: 662e 466f 6375 734d 6573 7361 6765 2870  f.FocusMessage(p
+0006d930: 7265 766d 7367 5b22 6964 225d 290d 0a20  revmsg["id"]).. 
+0006d940: 2020 2020 2020 2020 2020 2069 6620 6d73             if ms
+0006d950: 675b 2264 6174 6574 696d 6522 5d20 3c20  g["datetime"] < 
+0006d960: 7468 7265 7368 6f6c 6420 616e 6420 6e6f  threshold and no
+0006d970: 7420 7368 6966 7465 643a 0d0a 2020 2020  t shifted:..    
+0006d980: 2020 2020 2020 2020 2020 2020 2320 4c61              # La
+0006d990: 636b 7320 696d 6d65 6469 6174 6520 7072  cks immediate pr
+0006d9a0: 6576 696f 7573 2075 6e69 742c 2072 656f  evious unit, reo
+0006d9b0: 7269 656e 7420 7468 7265 7368 6f6c 640d  rient threshold.
+0006d9c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0006d9d0: 2074 6872 6573 686f 6c64 2c20 7368 6966   threshold, shif
+0006d9e0: 7465 6420 3d20 6d61 6b65 5f74 6872 6573  ted = make_thres
+0006d9f0: 686f 6c64 286d 7367 5b22 6461 7465 7469  hold(msg["dateti
+0006da00: 6d65 225d 2c20 7374 6570 3d30 292c 2054  me"], step=0), T
+0006da10: 7275 650d 0a20 2020 2020 2020 2020 2020  rue..           
+0006da20: 2069 6478 202b 3d20 7374 6570 0d0a 2020   idx += step..  
+0006da30: 2020 2020 2020 2020 2020 6d73 672c 2070            msg, p
+0006da40: 7265 766d 7367 203d 2028 6d6d 5b69 6478  revmsg = (mm[idx
+0006da50: 5d20 6966 2030 203c 3d20 6964 7820 3c20  ] if 0 <= idx < 
+0006da60: 6c65 6e28 6d6d 2920 656c 7365 204e 6f6e  len(mm) else Non
+0006da70: 6529 2c20 6d73 670d 0a20 2020 2020 2020  e), msg..       
+0006da80: 2069 6620 7374 6570 203c 2030 2061 6e64   if step < 0 and
+0006da90: 2070 7265 766d 7367 2061 6e64 2070 7265   prevmsg and pre
+0006daa0: 766d 7367 5b22 6461 7465 7469 6d65 225d  vmsg["datetime"]
+0006dab0: 203e 3d20 7468 7265 7368 6f6c 643a 0d0a   >= threshold:..
+0006dac0: 2020 2020 2020 2020 2020 2020 2320 436f              # Co
+0006dad0: 726e 6572 2063 6173 653a 2063 6f6e 7465  rner case: conte
+0006dae0: 6e74 2073 7461 7274 7320 7769 7468 2074  nt starts with t
+0006daf0: 6872 6573 686f 6c64 0d0a 2020 2020 2020  hreshold..      
+0006db00: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+0006db10: 662e 466f 6375 734d 6573 7361 6765 2870  f.FocusMessage(p
+0006db20: 7265 766d 7367 5b22 6964 225d 290d 0a20  revmsg["id"]).. 
+0006db30: 2020 2020 2020 206c 6162 656c 203d 2022         label = "
+0006db40: 7072 6576 696f 7573 2220 6966 2064 6972  previous" if dir
+0006db50: 6563 7469 6f6e 203c 2030 2065 6c73 6520  ection < 0 else 
+0006db60: 226e 6578 7422 0d0a 2020 2020 2020 2020  "next"..        
+0006db70: 6775 6962 6173 652e 7374 6174 7573 2822  guibase.status("
+0006db80: 4e6f 2025 7320 2573 2066 6f75 6e64 2069  No %s %s found i
+0006db90: 6e20 6375 7272 656e 7420 7669 6577 2e22  n current view."
+0006dba0: 2c20 6c61 6265 6c2c 2075 6e69 7429 0d0a  , label, unit)..
+0006dbb0: 0d0a 0d0a 2020 2020 6465 6620 466f 6375  ....    def Focu
+0006dbc0: 734d 6573 7361 6765 2873 656c 662c 206d  sMessage(self, m
+0006dbd0: 6573 7361 6765 5f69 642c 2073 656c 6563  essage_id, selec
+0006dbe0: 743d 5472 7565 293a 0d0a 2020 2020 2020  t=True):..      
+0006dbf0: 2020 2222 2253 656c 6563 7473 2061 6e64    """Selects and
+0006dc00: 2073 6372 6f6c 6c73 2074 6865 2073 7065   scrolls the spe
+0006dc10: 6369 6669 6564 206d 6573 7361 6765 2069  cified message i
+0006dc20: 6e74 6f20 7669 6577 2e22 2222 0d0a 2020  nto view."""..  
+0006dc30: 2020 2020 2020 6966 206d 6573 7361 6765        if message
+0006dc40: 5f69 6420 6e6f 7420 696e 2073 656c 662e  _id not in self.
+0006dc50: 5f6d 6573 7361 6765 5f70 6f73 6974 696f  _message_positio
+0006dc60: 6e73 3a20 7265 7475 726e 0d0a 2020 2020  ns: return..    
+0006dc70: 2020 2020 6c69 6e65 746f 706f 732c 206c      linetopos, l
+0006dc80: 696e 656e 756d 6265 7220 3d20 7365 6c66  inenumber = self
+0006dc90: 2e50 6f73 6974 696f 6e46 726f 6d4c 696e  .PositionFromLin
+0006dca0: 652c 2073 656c 662e 446f 634c 696e 6546  e, self.DocLineF
+0006dcb0: 726f 6d56 6973 6962 6c65 0d0a 2020 2020  romVisible..    
+0006dcc0: 2020 2020 7669 6577 706f 7274 203d 205b      viewport = [
+0006dcd0: 6c69 6e65 746f 706f 7328 6c69 6e65 6e75  linetopos(linenu
+0006dce0: 6d62 6572 2873 656c 662e 4669 7273 7456  mber(self.FirstV
+0006dcf0: 6973 6962 6c65 4c69 6e65 202b 2078 2929  isibleLine + x))
+0006dd00: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0006dd10: 2020 2020 2020 666f 7220 7820 696e 205b        for x in [
+0006dd20: 302c 2073 656c 662e 4c69 6e65 734f 6e53  0, self.LinesOnS
+0006dd30: 6372 6565 6e28 295d 5d0d 0a20 2020 2020  creen()]]..     
+0006dd40: 2020 2069 6620 7669 6577 706f 7274 5b31     if viewport[1
+0006dd50: 5d20 3c20 303a 2076 6965 7770 6f72 745b  ] < 0: viewport[
+0006dd60: 315d 203d 2073 656c 662e 4c61 7374 506f  1] = self.LastPo
+0006dd70: 7369 7469 6f6e 0d0a 2020 2020 2020 2020  sition..        
+0006dd80: 706f 732c 2070 6164 6469 6e67 203d 2073  pos, padding = s
+0006dd90: 656c 662e 5f6d 6573 7361 6765 5f70 6f73  elf._message_pos
+0006dda0: 6974 696f 6e73 5b6d 6573 7361 6765 5f69  itions[message_i
+0006ddb0: 645d 2c20 3530 0d0a 2020 2020 2020 2020  d], 50..        
+0006ddc0: 6966 206e 6f74 2076 6965 7770 6f72 745b  if not viewport[
+0006ddd0: 305d 203c 3d20 706f 735b 305d 203c 3d20  0] <= pos[0] <= 
+0006dde0: 7669 6577 706f 7274 5b31 5d3a 0d0a 2020  viewport[1]:..  
+0006ddf0: 2020 2020 2020 2020 2020 666f 7220 7020            for p 
+0006de00: 696e 2070 6f73 5b3a 3a2d 315d 3a0d 0a20  in pos[::-1]:.. 
+0006de10: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0006de20: 2045 6e73 7572 6520 7468 6174 2062 6f74   Ensure that bot
+0006de30: 6820 656e 6473 206f 6620 7468 6520 7365  h ends of the se
+0006de40: 6c65 6374 696f 6e20 6172 6520 7669 7369  lection are visi
+0006de50: 626c 650d 0a20 2020 2020 2020 2020 2020  ble..           
+0006de60: 2020 2020 2073 656c 662e 5354 432e 4375       self.STC.Cu
+0006de70: 7272 656e 7450 6f73 203d 2070 202b 2070  rrentPos = p + p
+0006de80: 6164 6469 6e67 0d0a 2020 2020 2020 2020  adding..        
+0006de90: 2020 2020 2020 2020 7365 6c66 2e45 6e73          self.Ens
+0006dea0: 7572 6543 6172 6574 5669 7369 626c 6528  ureCaretVisible(
+0006deb0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0006dec0: 2020 2070 6164 6469 6e67 203d 202d 7061     padding = -pa
+0006ded0: 6464 696e 670d 0a20 2020 2020 2020 2020  dding..         
+0006dee0: 2020 2073 656c 662e 5354 432e 5365 7453     self.STC.SetS
+0006def0: 656c 6563 7469 6f6e 2870 2c20 7029 0d0a  election(p, p)..
+0006df00: 2020 2020 2020 2020 6966 2073 656c 6563          if selec
+0006df10: 743a 2073 656c 662e 5354 432e 5365 7453  t: self.STC.SetS
+0006df20: 656c 6563 7469 6f6e 282a 706f 7329 0d0a  election(*pos)..
+0006df30: 0d0a 0d0a 2020 2020 6465 6620 4765 7446  ....    def GetF
+0006df40: 6f63 7573 6564 4d65 7373 6167 6528 7365  ocusedMessage(se
+0006df50: 6c66 2c20 7365 6c65 6374 6564 6f6e 6c79  lf, selectedonly
+0006df60: 3d46 616c 7365 293a 0d0a 2020 2020 2020  =False):..      
+0006df70: 2020 2222 220d 0a20 2020 2020 2020 2052    """..        R
+0006df80: 6574 7572 6e73 2074 6865 2049 4420 6f66  eturns the ID of
+0006df90: 2074 6865 2063 7572 7265 6e74 6c79 2073   the currently s
+0006dfa0: 656c 6563 7465 6420 6f72 2074 6865 2066  elected or the f
+0006dfb0: 6972 7374 2076 6973 6962 6c65 206d 6573  irst visible mes
+0006dfc0: 7361 6765 2c0d 0a20 2020 2020 2020 2061  sage,..        a
+0006dfd0: 6e64 2077 6865 7468 6572 2074 6865 206d  nd whether the m
+0006dfe0: 6573 7361 6765 2074 6578 7420 7761 7320  essage text was 
+0006dff0: 7365 6c65 6374 6564 2e0d 0a0d 0a20 2020  selected.....   
+0006e000: 2020 2020 2040 7061 7261 6d20 2020 7365       @param   se
+0006e010: 6c65 6374 6564 6f6e 6c79 2020 7768 6574  lectedonly  whet
+0006e020: 6865 7220 746f 206c 6f6f 6b20 6174 2073  her to look at s
+0006e030: 656c 6563 7465 6420 6d65 7373 6167 6520  elected message 
+0006e040: 6f6e 6c79 0d0a 2020 2020 2020 2020 4072  only..        @r
+0006e050: 6574 7572 6e20 2028 6d65 7373 6167 6520  eturn  (message 
+0006e060: 4944 2c20 6973 5f73 656c 6563 7465 6429  ID, is_selected)
+0006e070: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
+0006e080: 2020 2020 2020 206c 696e 6574 6f70 6f73         linetopos
+0006e090: 2c20 6c69 6e65 6e75 6d62 6572 203d 2073  , linenumber = s
+0006e0a0: 656c 662e 506f 7369 7469 6f6e 4672 6f6d  elf.PositionFrom
+0006e0b0: 4c69 6e65 2c20 7365 6c66 2e44 6f63 4c69  Line, self.DocLi
+0006e0c0: 6e65 4672 6f6d 5669 7369 626c 650d 0a20  neFromVisible.. 
+0006e0d0: 2020 2020 2020 2076 6965 7770 6f72 7420         viewport 
+0006e0e0: 3d20 5b6c 696e 6574 6f70 6f73 286c 696e  = [linetopos(lin
+0006e0f0: 656e 756d 6265 7228 7365 6c66 2e46 6972  enumber(self.Fir
+0006e100: 7374 5669 7369 626c 654c 696e 6520 2b20  stVisibleLine + 
+0006e110: 7829 290d 0a20 2020 2020 2020 2020 2020  x))..           
+0006e120: 2020 2020 2020 2020 2066 6f72 2078 2069           for x i
+0006e130: 6e20 5b30 2c20 7365 6c66 2e4c 696e 6573  n [0, self.Lines
+0006e140: 4f6e 5363 7265 656e 2829 5d5d 0d0a 2020  OnScreen()]]..  
+0006e150: 2020 2020 2020 6966 2076 6965 7770 6f72        if viewpor
+0006e160: 745b 315d 203c 2030 3a20 7669 6577 706f  t[1] < 0: viewpo
+0006e170: 7274 5b31 5d20 3d20 7365 6c66 2e4c 6173  rt[1] = self.Las
+0006e180: 7450 6f73 6974 696f 6e0d 0a20 2020 2020  tPosition..     
+0006e190: 2020 2073 656c 6563 7469 6f6e 2c20 6375     selection, cu
+0006e1a0: 7270 6f73 2c20 7365 6c65 6374 6564 203d  rpos, selected =
+0006e1b0: 2073 656c 662e 4765 7453 656c 6563 7469   self.GetSelecti
+0006e1c0: 6f6e 2829 2c20 4e6f 6e65 2c20 4661 6c73  on(), None, Fals
+0006e1d0: 650d 0a20 2020 2020 2020 2069 6620 7365  e..        if se
+0006e1e0: 6c65 6374 696f 6e5b 305d 2021 3d20 7365  lection[0] != se
+0006e1f0: 6c65 6374 696f 6e5b 315d 205c 0d0a 2020  lection[1] \..  
+0006e200: 2020 2020 2020 616e 6420 616e 7928 7669        and any(vi
+0006e210: 6577 706f 7274 5b30 5d20 3c3d 2078 203c  ewport[0] <= x <
+0006e220: 3d20 7669 6577 706f 7274 5b31 5d20 666f  = viewport[1] fo
+0006e230: 7220 7820 696e 2073 656c 6563 7469 6f6e  r x in selection
+0006e240: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+0006e250: 6375 7270 6f73 2c20 7365 6c65 6374 6564  curpos, selected
+0006e260: 203d 2073 656c 6563 7469 6f6e 5b30 5d2c   = selection[0],
+0006e270: 2054 7275 650d 0a20 2020 2020 2020 2065   True..        e
+0006e280: 6c69 6620 6e6f 7420 7365 6c65 6374 6564  lif not selected
+0006e290: 6f6e 6c79 3a0d 0a20 2020 2020 2020 2020  only:..         
+0006e2a0: 2020 2063 7572 706f 7320 3d20 7669 6577     curpos = view
+0006e2b0: 706f 7274 5b30 5d0d 0a20 2020 2020 2020  port[0]..       
+0006e2c0: 2069 6620 6375 7270 6f73 2069 7320 4e6f   if curpos is No
+0006e2d0: 6e65 3a20 7265 7475 726e 204e 6f6e 652c  ne: return None,
+0006e2e0: 2046 616c 7365 2023 204e 6f20 706f 7369   False # No posi
+0006e2f0: 7469 6f6e 2074 6f20 6368 6563 6b0d 0a0d  tion to check...
+0006e300: 0a20 2020 2020 2020 2066 6f72 206d 5f69  .        for m_i
+0006e310: 6420 696e 2073 656c 662e 5f6d 6573 7361  d in self._messa
+0006e320: 6765 5f70 6f73 6974 696f 6e73 3a0d 0a20  ge_positions:.. 
+0006e330: 2020 2020 2020 2020 2020 2069 6620 6375             if cu
+0006e340: 7270 6f73 203c 2073 656c 662e 5f6d 6573  rpos < self._mes
+0006e350: 7361 6765 5f70 6f73 6974 696f 6e73 5b6d  sage_positions[m
+0006e360: 5f69 645d 5b31 5d3a 2072 6574 7572 6e20  _id][1]: return 
+0006e370: 6d5f 6964 2c20 7365 6c65 6374 6564 0d0a  m_id, selected..
+0006e380: 2020 2020 2020 2020 7265 7475 726e 204e          return N
+0006e390: 6f6e 652c 2046 616c 7365 0d0a 0d0a 0d0a  one, False......
+0006e3a0: 2020 2020 6465 6620 4973 4d65 7373 6167      def IsMessag
+0006e3b0: 6546 696c 7465 7265 644f 7574 2873 656c  eFilteredOut(sel
+0006e3c0: 662c 206d 6573 7361 6765 293a 0d0a 2020  f, message):..  
+0006e3d0: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
+0006e3e0: 2020 2052 6574 7572 6e73 2077 6865 7468     Returns wheth
+0006e3f0: 6572 2074 6865 2073 7065 6369 6669 6564  er the specified
+0006e400: 206d 6573 7361 6765 2064 6f65 7320 6e6f   message does no
+0006e410: 7420 7061 7373 2074 6865 2063 7572 7265  t pass the curre
+0006e420: 6e74 2066 696c 7465 722e 0d0a 2020 2020  nt filter...    
+0006e430: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
+0006e440: 2072 6573 756c 7420 3d20 4661 6c73 650d   result = False.
+0006e450: 0a20 2020 2020 2020 2069 6620 2873 656c  .        if (sel
+0006e460: 662e 5f66 696c 7465 722e 6765 7428 2270  f._filter.get("p
+0006e470: 6172 7469 6369 7061 6e74 7322 290d 0a20  articipants").. 
+0006e480: 2020 2020 2020 2061 6e64 206d 6573 7361         and messa
+0006e490: 6765 5b22 6175 7468 6f72 225d 206e 6f74  ge["author"] not
+0006e4a0: 2069 6e20 7365 6c66 2e5f 6669 6c74 6572   in self._filter
+0006e4b0: 5b22 7061 7274 6963 6970 616e 7473 225d  ["participants"]
+0006e4c0: 0d0a 2020 2020 2020 2020 616e 6420 7365  ..        and se
+0006e4d0: 7428 7365 6c66 2e5f 6669 6c74 6572 5b22  t(self._filter["
+0006e4e0: 7061 7274 6963 6970 616e 7473 225d 2920  participants"]) 
+0006e4f0: 213d 0d0a 2020 2020 2020 2020 7365 7428  !=..        set(
+0006e500: 5b70 5b22 6964 656e 7469 7479 225d 2066  [p["identity"] f
+0006e510: 6f72 2070 2069 6e20 7365 6c66 2e5f 6368  or p in self._ch
+0006e520: 6174 5b22 7061 7274 6963 6970 616e 7473  at["participants
+0006e530: 225d 5d29 293a 0d0a 2020 2020 2020 2020  "]])):..        
+0006e540: 2020 2020 2320 4c61 7374 2063 6f6e 6469      # Last condi
+0006e550: 7469 6f6e 2069 7320 746f 2063 6865 636b  tion is to check
+0006e560: 2069 6620 7061 7274 6963 6970 616e 7473   if participants
+0006e570: 2066 696c 7465 7220 6973 2061 7070 6c69   filter is appli
+0006e580: 6564 2e0d 0a20 2020 2020 2020 2020 2020  ed...           
+0006e590: 2072 6573 756c 7420 3d20 5472 7565 0d0a   result = True..
+0006e5a0: 2020 2020 2020 2020 656c 6966 2028 616c          elif (al
+0006e5b0: 6c28 7365 6c66 2e5f 6669 6c74 6572 2e67  l(self._filter.g
+0006e5c0: 6574 2822 6461 7465 7261 6e67 6522 2920  et("daterange") 
+0006e5d0: 6f72 205b 305d 290d 0a20 2020 2020 2020  or [0])..       
+0006e5e0: 2061 6e64 206e 6f74 2028 7365 6c66 2e5f   and not (self._
+0006e5f0: 6669 6c74 6572 5b22 6461 7465 7261 6e67  filter["daterang
+0006e600: 6522 5d5b 305d 203c 3d20 6d65 7373 6167  e"][0] <= messag
+0006e610: 655b 2264 6174 6574 696d 6522 5d2e 6461  e["datetime"].da
+0006e620: 7465 2829 0d0a 2020 2020 2020 2020 3c3d  te()..        <=
+0006e630: 2073 656c 662e 5f66 696c 7465 725b 2264   self._filter["d
+0006e640: 6174 6572 616e 6765 225d 5b31 5d29 293a  aterange"][1])):
+0006e650: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+0006e660: 7375 6c74 203d 2054 7275 650d 0a20 2020  sult = True..   
+0006e670: 2020 2020 2065 6c69 6620 2274 6578 7422       elif "text"
+0006e680: 2069 6e20 7365 6c66 2e5f 6669 6c74 6572   in self._filter
+0006e690: 2061 6e64 2073 656c 662e 5f66 696c 7465   and self._filte
+0006e6a0: 725b 2274 6578 7422 5d3a 0d0a 2020 2020  r["text"]:..    
+0006e6b0: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
+0006e6c0: 656c 662e 5f66 696c 7465 7274 6578 745f  elf._filtertext_
+0006e6d0: 7267 783a 0d0a 2020 2020 2020 2020 2020  rgx:..          
+0006e6e0: 2020 2020 2020 6573 6361 7065 6420 3d20        escaped = 
+0006e6f0: 7265 2e65 7363 6170 6528 7365 6c66 2e5f  re.escape(self._
+0006e700: 6669 6c74 6572 5b22 7465 7874 225d 290d  filter["text"]).
+0006e710: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0006e720: 2073 656c 662e 5f66 696c 7465 7274 6578   self._filtertex
+0006e730: 745f 7267 7820 3d20 7265 2e63 6f6d 7069  t_rgx = re.compi
+0006e740: 6c65 2865 7363 6170 6564 2c20 7265 2e49  le(escaped, re.I
+0006e750: 474e 4f52 4543 4153 4529 0d0a 2020 2020  GNORECASE)..    
+0006e760: 2020 2020 2020 2020 6966 2028 6e6f 7420          if (not 
+0006e770: 6d65 7373 6167 655b 2262 6f64 795f 786d  message["body_xm
+0006e780: 6c22 5d0d 0a20 2020 2020 2020 2020 2020  l"]..           
+0006e790: 206f 7220 6e6f 7420 7365 6c66 2e5f 6669   or not self._fi
+0006e7a0: 6c74 6572 7465 7874 5f72 6778 2e73 6561  ltertext_rgx.sea
+0006e7b0: 7263 6828 6d65 7373 6167 655b 2262 6f64  rch(message["bod
+0006e7c0: 795f 786d 6c22 5d29 293a 0d0a 2020 2020  y_xml"])):..    
+0006e7d0: 2020 2020 2020 2020 2020 2020 7265 7375              resu
+0006e7e0: 6c74 203d 2054 7275 650d 0a20 2020 2020  lt = True..     
+0006e7f0: 2020 2072 6574 7572 6e20 7265 7375 6c74     return result
+0006e800: 0d0a 0d0a 0d0a 2020 2020 6465 6620 4973  ......    def Is
+0006e810: 4d65 7373 6167 6553 686f 776e 2873 656c  MessageShown(sel
+0006e820: 662c 206d 6573 7361 6765 5f69 6429 3a0d  f, message_id):.
+0006e830: 0a20 2020 2020 2020 2022 2222 5265 7475  .        """Retu
+0006e840: 726e 7320 7768 6574 6865 7220 7468 6520  rns whether the 
+0006e850: 7370 6563 6966 6965 6420 6d65 7373 6167  specified messag
+0006e860: 6520 6973 2063 7572 7265 6e74 6c79 2073  e is currently s
+0006e870: 686f 776e 2e22 2222 0d0a 2020 2020 2020  hown."""..      
+0006e880: 2020 7265 7475 726e 2028 6d65 7373 6167    return (messag
+0006e890: 655f 6964 2069 6e20 7365 6c66 2e5f 6d65  e_id in self._me
+0006e8a0: 7373 6167 655f 706f 7369 7469 6f6e 7329  ssage_positions)
+0006e8b0: 0d0a 0d0a 0d0a 2020 2020 6465 6620 4765  ......    def Ge
+0006e8c0: 744d 6573 7361 6765 2873 656c 662c 2069  tMessage(self, i
+0006e8d0: 6e64 6578 293a 0d0a 2020 2020 2020 2020  ndex):..        
+0006e8e0: 2222 220d 0a20 2020 2020 2020 2052 6574  """..        Ret
+0006e8f0: 7572 6e73 2074 6865 206d 6573 7361 6765  urns the message
+0006e900: 2061 7420 7468 6520 7370 6563 6966 6965   at the specifie
+0006e910: 6420 696e 6465 7820 696e 2074 6865 2063  d index in the c
+0006e920: 7572 7265 6e74 6c79 2073 686f 776e 0d0a  urrently shown..
+0006e930: 2020 2020 2020 2020 6d65 7373 6167 6573          messages
+0006e940: 2e0d 0a0d 0a20 2020 2020 2020 2040 7061  .....        @pa
+0006e950: 7261 6d20 2020 696e 6465 7820 206c 6973  ram   index  lis
+0006e960: 7420 696e 6465 7820 286e 6567 6174 6976  t index (negativ
+0006e970: 6520 7374 6172 7473 2066 726f 6d20 656e  e starts from en
+0006e980: 6429 0d0a 2020 2020 2020 2020 2222 220d  d)..        """.
+0006e990: 0a20 2020 2020 2020 2069 6620 696e 6465  .        if inde
+0006e9a0: 7820 3c20 303a 2069 6e64 6578 2025 3d20  x < 0: index %= 
+0006e9b0: 6c65 6e28 7365 6c66 2e5f 6d65 7373 6167  len(self._messag
+0006e9c0: 6573 5f63 7572 7265 6e74 206f 7220 5b5d  es_current or []
+0006e9d0: 290d 0a20 2020 2020 2020 2069 6620 696e  )..        if in
+0006e9e0: 6465 7820 3e3d 206c 656e 2873 656c 662e  dex >= len(self.
+0006e9f0: 5f6d 6573 7361 6765 735f 6375 7272 656e  _messages_curren
+0006ea00: 7420 6f72 205b 5d29 3a20 7265 7475 726e  t or []): return
+0006ea10: 204e 6f6e 650d 0a20 2020 2020 2020 2072   None..        r
+0006ea20: 6574 7572 6e20 7365 6c66 2e5f 6d65 7373  eturn self._mess
+0006ea30: 6167 6573 5f63 7572 7265 6e74 5b69 6e64  ages_current[ind
+0006ea40: 6578 5d0d 0a0d 0a0d 0a20 2020 2064 6566  ex]......    def
+0006ea50: 2047 6574 4d65 7373 6167 6573 2873 656c   GetMessages(sel
+0006ea60: 6629 3a0d 0a20 2020 2020 2020 2022 2222  f):..        """
+0006ea70: 5265 7475 726e 7320 6120 6c69 7374 206f  Returns a list o
+0006ea80: 6620 616c 6c20 7468 6520 6375 7272 656e  f all the curren
+0006ea90: 746c 7920 7368 6f77 6e20 6d65 7373 6167  tly shown messag
+0006eaa0: 6573 2e22 2222 0d0a 2020 2020 2020 2020  es."""..        
+0006eab0: 7265 7475 726e 206c 6973 7428 7365 6c66  return list(self
+0006eac0: 2e5f 6d65 7373 6167 6573 5f63 7572 7265  ._messages_curre
+0006ead0: 6e74 206f 7220 5b5d 290d 0a0d 0a0d 0a20  nt or [])...... 
+0006eae0: 2020 2064 6566 2047 6574 5265 7472 6965     def GetRetrie
+0006eaf0: 7665 644d 6573 7361 6765 7328 7365 6c66  vedMessages(self
+0006eb00: 293a 0d0a 2020 2020 2020 2020 2222 2252  ):..        """R
+0006eb10: 6574 7572 6e73 2061 206c 6973 7420 6f66  eturns a list of
+0006eb20: 2061 6c6c 2072 6574 7269 6576 6564 206d   all retrieved m
+0006eb30: 6573 7361 6765 732e 2222 220d 0a20 2020  essages."""..   
+0006eb40: 2020 2020 2072 6574 7572 6e20 6c69 7374       return list
+0006eb50: 2873 656c 662e 5f6d 6573 7361 6765 7320  (self._messages 
+0006eb60: 6f72 205b 5d29 0d0a 0d0a 0d0a 2020 2020  or [])......    
+0006eb70: 6465 6620 4765 7456 6973 6962 6c65 4d65  def GetVisibleMe
+0006eb80: 7373 6167 6573 2873 656c 6629 3a0d 0a20  ssages(self):.. 
+0006eb90: 2020 2020 2020 2022 2222 5265 7475 726e         """Return
+0006eba0: 7320 6120 6c69 7374 206f 6620 6d65 7373  s a list of mess
+0006ebb0: 6167 6573 2063 7572 7265 6e74 6c79 2076  ages currently v
+0006ebc0: 6973 6962 6c65 2069 6e20 7669 6577 706f  isible in viewpo
+0006ebd0: 7274 2e22 2222 0d0a 2020 2020 2020 2020  rt."""..        
+0006ebe0: 6964 7320 3d20 5b5d 0d0a 2020 2020 2020  ids = []..      
+0006ebf0: 2020 6c69 6e65 746f 706f 732c 206c 696e    linetopos, lin
+0006ec00: 656e 756d 6265 7220 3d20 7365 6c66 2e50  enumber = self.P
+0006ec10: 6f73 6974 696f 6e46 726f 6d4c 696e 652c  ositionFromLine,
+0006ec20: 2073 656c 662e 446f 634c 696e 6546 726f   self.DocLineFro
+0006ec30: 6d56 6973 6962 6c65 0d0a 2020 2020 2020  mVisible..      
+0006ec40: 2020 7669 6577 706f 7274 203d 205b 6c69    viewport = [li
+0006ec50: 6e65 746f 706f 7328 6c69 6e65 6e75 6d62  netopos(linenumb
+0006ec60: 6572 2873 656c 662e 4669 7273 7456 6973  er(self.FirstVis
+0006ec70: 6962 6c65 4c69 6e65 202b 2078 2929 0d0a  ibleLine + x))..
+0006ec80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006ec90: 2020 2020 666f 7220 7820 696e 205b 302c      for x in [0,
+0006eca0: 2073 656c 662e 4c69 6e65 734f 6e53 6372   self.LinesOnScr
+0006ecb0: 6565 6e28 295d 5d0d 0a20 2020 2020 2020  een()]]..       
+0006ecc0: 2069 6620 7669 6577 706f 7274 5b31 5d20   if viewport[1] 
+0006ecd0: 3c20 303a 2076 6965 7770 6f72 745b 315d  < 0: viewport[1]
+0006ece0: 203d 2073 656c 662e 4c61 7374 506f 7369   = self.LastPosi
+0006ecf0: 7469 6f6e 0d0a 2020 2020 2020 2020 666f  tion..        fo
+0006ed00: 7220 6d5f 6964 2069 6e20 7365 6c66 2e5f  r m_id in self._
+0006ed10: 6d65 7373 6167 655f 706f 7369 7469 6f6e  message_position
+0006ed20: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
+0006ed30: 6d5f 706f 7320 3d20 7365 6c66 2e5f 6d65  m_pos = self._me
+0006ed40: 7373 6167 655f 706f 7369 7469 6f6e 735b  ssage_positions[
+0006ed50: 6d5f 6964 5d0d 0a20 2020 2020 2020 2020  m_id]..         
+0006ed60: 2020 2069 6620 616e 7928 7669 6577 706f     if any(viewpo
+0006ed70: 7274 5b30 5d20 3c3d 2078 203c 3d20 7669  rt[0] <= x <= vi
+0006ed80: 6577 706f 7274 5b31 5d20 666f 7220 7820  ewport[1] for x 
+0006ed90: 696e 206d 5f70 6f73 2920 5c0d 0a20 2020  in m_pos) \..   
+0006eda0: 2020 2020 2020 2020 206f 7220 6d5f 706f           or m_po
+0006edb0: 735b 305d 203c 2076 6965 7770 6f72 745b  s[0] < viewport[
+0006edc0: 305d 2061 6e64 206d 5f70 6f73 5b31 5d20  0] and m_pos[1] 
+0006edd0: 3e20 7669 6577 706f 7274 5b31 5d3a 0d0a  > viewport[1]:..
+0006ede0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006edf0: 6964 732e 6170 7065 6e64 286d 5f69 6429  ids.append(m_id)
+0006ee00: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+0006ee10: 206d 5f70 6f73 5b30 5d20 3e20 7669 6577   m_pos[0] > view
+0006ee20: 706f 7274 5b31 5d3a 2062 7265 616b 2023  port[1]: break #
+0006ee30: 2066 6f72 206d 5f69 640d 0a20 2020 2020   for m_id..     
+0006ee40: 2020 2072 6574 7572 6e20 6d61 7028 7365     return map(se
+0006ee50: 6c66 2e5f 6d65 7373 6167 655f 6d61 702e  lf._message_map.
+0006ee60: 6765 742c 2069 6473 290d 0a0d 0a0d 0a20  get, ids)...... 
+0006ee70: 2020 2064 6566 2053 6574 4669 6c74 6572     def SetFilter
+0006ee80: 2873 656c 662c 2066 696c 7465 725f 6461  (self, filter_da
+0006ee90: 7461 293a 0d0a 2020 2020 2020 2020 2222  ta):..        ""
+0006eea0: 220d 0a20 2020 2020 2020 2053 6574 7320  "..        Sets 
+0006eeb0: 7468 6520 6669 6c74 6572 2074 6f20 7573  the filter to us
+0006eec0: 6520 666f 7220 7468 6520 6375 7272 656e  e for the curren
+0006eed0: 7420 6368 6174 2e20 446f 6573 206e 6f74  t chat. Does not
+0006eee0: 2072 6566 7265 7368 206d 6573 7361 6765   refresh message
+0006eef0: 732e 0d0a 0d0a 2020 2020 2020 2020 4070  s.....        @p
+0006ef00: 6172 616d 2020 2066 696c 7465 725f 6461  aram   filter_da
+0006ef10: 7461 2020 4e6f 6e65 206f 7220 7b22 6461  ta  None or {"da
+0006ef20: 7465 7261 6e67 6522 3a0d 0a20 2020 2020  terange":..     
+0006ef30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006ef40: 2020 2020 2020 2020 2028 6461 7465 7469           (dateti
+0006ef50: 6d65 2c20 6461 7465 7469 6d65 292c 2022  me, datetime), "
+0006ef60: 7465 7874 223a 2074 6578 7420 696e 206d  text": text in m
+0006ef70: 6573 7361 6765 2c0d 0a20 2020 2020 2020  essage,..       
+0006ef80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006ef90: 2020 2020 2020 2022 7061 7274 6963 6970         "particip
+0006efa0: 616e 7473 223a 205b 736b 7970 656e 616d  ants": [skypenam
+0006efb0: 6531 2c20 5d7d 0d0a 2020 2020 2020 2020  e1, ]}..        
+0006efc0: 2222 220d 0a20 2020 2020 2020 2066 696c  """..        fil
+0006efd0: 7465 725f 6461 7461 203d 2066 696c 7465  ter_data = filte
+0006efe0: 725f 6461 7461 206f 7220 7b7d 0d0a 2020  r_data or {}..  
+0006eff0: 2020 2020 2020 6966 206e 6f74 2075 7469        if not uti
+0006f000: 6c2e 636d 705f 6469 6374 7328 6669 6c74  l.cmp_dicts(filt
+0006f010: 6572 5f64 6174 612c 2073 656c 662e 5f66  er_data, self._f
+0006f020: 696c 7465 7229 3a0d 0a20 2020 2020 2020  ilter):..       
+0006f030: 2020 2020 2073 656c 662e 5f66 696c 7465       self._filte
+0006f040: 7220 3d20 636f 7079 2e64 6565 7063 6f70  r = copy.deepcop
+0006f050: 7928 6669 6c74 6572 5f64 6174 6129 0d0a  y(filter_data)..
+0006f060: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0006f070: 2e5f 6669 6c74 6572 7465 7874 5f72 6778  ._filtertext_rgx
+0006f080: 203d 204e 6f6e 650d 0a20 2020 2020 2020   = None..       
+0006f090: 2020 2020 2073 656c 662e 5f6d 6573 7361       self._messa
+0006f0a0: 6765 735f 6375 7272 656e 7420 3d20 4e6f  ges_current = No
+0006f0b0: 6e65 0d0a 2020 2020 6465 6620 4765 7446  ne..    def GetF
+0006f0c0: 696c 7465 7228 7365 6c66 293a 0d0a 2020  ilter(self):..  
+0006f0d0: 2020 2020 2020 7265 7475 726e 2063 6f70        return cop
+0006f0e0: 792e 6465 6570 636f 7079 2873 656c 662e  y.deepcopy(self.
+0006f0f0: 5f66 696c 7465 7229 0d0a 2020 2020 4669  _filter)..    Fi
+0006f100: 6c74 6572 203d 2070 726f 7065 7274 7928  lter = property(
+0006f110: 4765 7446 696c 7465 722c 2053 6574 4669  GetFilter, SetFi
+0006f120: 6c74 6572 2c20 646f 633d 5c0d 0a20 2020  lter, doc=\..   
+0006f130: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
+0006f140: 2020 5468 6520 6669 6c74 6572 2074 6f20    The filter to 
+0006f150: 7573 6520 666f 7220 7468 6520 6375 7272  use for the curr
+0006f160: 656e 7420 6368 6174 2e20 7b22 6461 7465  ent chat. {"date
+0006f170: 7261 6e67 6522 3a0d 0a20 2020 2020 2020  range":..       
+0006f180: 2028 6461 7465 7469 6d65 2c20 6461 7465   (datetime, date
+0006f190: 7469 6d65 292c 2022 7465 7874 223a 2074  time), "text": t
+0006f1a0: 6578 7420 696e 206d 6573 7361 6765 2c0d  ext in message,.
+0006f1b0: 0a20 2020 2020 2020 2022 7061 7274 6963  .        "partic
+0006f1c0: 6970 616e 7473 223a 205b 736b 7970 656e  ipants": [skypen
+0006f1d0: 616d 6531 2c20 5d7d 0d0a 2020 2020 2020  ame1, ]}..      
+0006f1e0: 2020 2222 220d 0a20 2020 2029 0d0a 0d0a    """..    )....
+0006f1f0: 0d0a 2020 2020 6465 6620 4170 706c 7946  ..    def ApplyF
+0006f200: 696c 7465 7228 7365 6c66 2c20 6461 7465  ilter(self, date
+0006f210: 7261 6e67 653d 4e6f 6e65 2c20 7465 7874  range=None, text
+0006f220: 3d4e 6f6e 652c 2070 6172 7469 6369 7061  =None, participa
+0006f230: 6e74 733d 4e6f 6e65 2c0d 0a20 2020 2020  nts=None,..     
+0006f240: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0006f250: 6174 656c 6162 656c 3d4e 6f6e 6529 3a0d  atelabel=None):.
+0006f260: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
+0006f270: 2020 2020 2020 5365 7473 2061 6e64 2061        Sets and a
+0006f280: 7070 6c69 6573 2066 696c 7465 7220 666f  pplies filter fo
+0006f290: 7220 7468 6520 6375 7272 656e 7420 6368  r the current ch
+0006f2a0: 6174 2e0d 0a0d 0a20 2020 2020 2020 2040  at.....        @
+0006f2b0: 7061 7261 6d20 2020 6461 7465 7261 6e67  param   daterang
+0006f2c0: 6520 2020 2020 5b64 6174 6531 2c20 6461  e     [date1, da
+0006f2d0: 7465 325d 206f 7220 4e6f 6e65 2074 6f20  te2] or None to 
+0006f2e0: 736b 6970 0d0a 2020 2020 2020 2020 4070  skip..        @p
+0006f2f0: 6172 616d 2020 2074 6578 7420 2020 2020  aram   text     
+0006f300: 2020 2020 2073 6561 7263 6820 7374 7269       search stri
+0006f310: 6e67 206f 7220 4e6f 6e65 2074 6f20 736b  ng or None to sk
+0006f320: 6970 0d0a 2020 2020 2020 2020 4070 6172  ip..        @par
+0006f330: 616d 2020 2070 6172 7469 6369 7061 6e74  am   participant
+0006f340: 7320 205b 6964 656e 7469 7479 2c20 5d20  s  [identity, ] 
+0006f350: 6f72 204e 6f6e 6520 746f 2073 6b69 700d  or None to skip.
+0006f360: 0a20 2020 2020 2020 2040 7061 7261 6d20  .        @param 
+0006f370: 2020 6461 7465 6c61 6265 6c20 2020 2020    datelabel     
+0006f380: 6461 7465 6c69 6e6b 7320 6c61 6265 6c20  datelinks label 
+0006f390: 6c69 6b65 2022 3120 7965 6172 222c 2069  like "1 year", i
+0006f3a0: 6620 616e 790d 0a20 2020 2020 2020 2022  f any..        "
+0006f3b0: 2222 0d0a 2020 2020 2020 2020 6d79 6669  ""..        myfi
+0006f3c0: 6c74 6572 203d 2064 6963 7428 6461 7465  lter = dict(date
+0006f3d0: 7261 6e67 653d 6461 7465 7261 6e67 652c  range=daterange,
+0006f3e0: 2074 6578 743d 7465 7874 2c20 7061 7274   text=text, part
+0006f3f0: 6963 6970 616e 7473 3d70 6172 7469 6369  icipants=partici
+0006f400: 7061 6e74 7329 0d0a 2020 2020 2020 2020  pants)..        
+0006f410: 6d79 6669 6c74 6572 203d 207b 6b3a 2076  myfilter = {k: v
+0006f420: 2066 6f72 206b 2c20 7620 696e 206d 7966   for k, v in myf
+0006f430: 696c 7465 722e 6974 656d 7328 2920 6966  ilter.items() if
+0006f440: 2076 2069 7320 6e6f 7420 4e6f 6e65 7d0d   v is not None}.
+0006f450: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+0006f460: 6d79 6669 6c74 6572 206f 7220 7574 696c  myfilter or util
+0006f470: 2e63 6d70 5f64 6963 7473 286d 7966 696c  .cmp_dicts(myfil
+0006f480: 7465 722c 2073 656c 662e 5f66 696c 7465  ter, self._filte
+0006f490: 7229 3a20 7265 7475 726e 0d0a 0d0a 2020  r): return....  
+0006f4a0: 2020 2020 2020 6275 7379 203d 2063 6f6e        busy = con
+0006f4b0: 7472 6f6c 732e 4275 7379 5061 6e65 6c28  trols.BusyPanel(
+0006f4c0: 7365 6c66 2e5f 7061 6765 206f 7220 7365  self._page or se
+0006f4d0: 6c66 2e50 6172 656e 742c 0d0a 2020 2020  lf.Parent,..    
+0006f4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006f4f0: 2020 2020 2020 2020 2020 2020 2020 2246                "F
+0006f500: 696c 7465 7269 6e67 206d 6573 7361 6765  iltering message
+0006f510: 732e 2229 0d0a 2020 2020 2020 2020 7472  s.")..        tr
+0006f520: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
+0006f530: 7365 6c66 2e5f 6461 7465 6c69 6e6b 5f6c  self._datelink_l
+0006f540: 6173 7420 3d20 6461 7465 6c61 6265 6c0d  ast = datelabel.
+0006f550: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0006f560: 7365 6c66 2e5f 7061 6765 3a0d 0a20 2020  self._page:..   
+0006f570: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0006f580: 6461 7465 7261 6e67 653a 0d0a 2020 2020  daterange:..    
+0006f590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006f5a0: 7365 6c66 2e5f 7061 6765 2e72 616e 6765  self._page.range
+0006f5b0: 5f64 6174 652e 5365 7456 616c 7565 7328  _date.SetValues(
+0006f5c0: 2a64 6174 6572 616e 6765 290d 0a20 2020  *daterange)..   
 0006f5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006f5e0: 2020 2020 2020 632e 4368 6563 6b28 6964        c.Check(id
-0006f5f0: 656e 7469 7479 2069 6e20 7061 7274 6963  entity in partic
-0006f600: 6970 616e 7473 290d 0a20 2020 2020 2020  ipants)..       
-0006f610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006f620: 2070 6c69 7374 2e53 6574 4974 656d 2863   plist.SetItem(c
-0006f630: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0006f640: 2020 2020 2020 2070 6c69 7374 2e52 6566         plist.Ref
-0006f650: 7265 7368 2829 0d0a 2020 2020 2020 2020  resh()..        
-0006f660: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0006f670: 2e5f 7061 6765 2e63 6861 745f 6669 6c74  ._page.chat_filt
-0006f680: 6572 5b22 7061 7274 6963 6970 616e 7473  er["participants
-0006f690: 225d 203d 2070 6172 7469 6369 7061 6e74  "] = participant
-0006f6a0: 730d 0a20 2020 2020 2020 2020 2020 2073  s..            s
-0006f6b0: 656c 662e 4669 6c74 6572 203d 2064 6963  elf.Filter = dic
-0006f6c0: 7428 7365 6c66 2e46 696c 7465 722c 202a  t(self.Filter, *
-0006f6d0: 2a6d 7966 696c 7465 7229 0d0a 2020 2020  *myfilter)..    
-0006f6e0: 2020 2020 2020 2020 7365 6c66 2e52 6566          self.Ref
-0006f6f0: 7265 7368 4d65 7373 6167 6573 2829 2c20  reshMessages(), 
-0006f700: 7365 6c66 2e53 6372 6f6c 6c54 6f4c 696e  self.ScrollToLin
-0006f710: 6528 3029 0d0a 2020 2020 2020 2020 2020  e(0)..          
-0006f720: 2020 6966 2073 656c 662e 5f70 6167 653a    if self._page:
-0006f730: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0006f740: 2020 7365 6c66 2e5f 7061 6765 2e70 6f70    self._page.pop
-0006f750: 756c 6174 655f 6368 6174 5f73 7461 7469  ulate_chat_stati
-0006f760: 7374 6963 7328 290d 0a20 2020 2020 2020  stics()..       
-0006f770: 2020 2020 2020 2020 2073 656c 662e 5f70           self._p
-0006f780: 6167 652e 6c69 7374 5f74 696d 656c 696e  age.list_timelin
-0006f790: 652e 506f 7075 6c61 7465 282a 7365 6c66  e.Populate(*self
-0006f7a0: 2e47 6574 5469 6d65 6c69 6e65 4461 7461  .GetTimelineData
-0006f7b0: 2829 290d 0a20 2020 2020 2020 2066 696e  ())..        fin
-0006f7c0: 616c 6c79 3a0d 0a20 2020 2020 2020 2020  ally:..         
-0006f7d0: 2020 2062 7573 792e 436c 6f73 6528 290d     busy.Close().
-0006f7e0: 0a0d 0a0d 0a20 2020 2064 6566 2047 6574  .....    def Get
-0006f7f0: 5374 6174 6973 7469 6373 4461 7461 2873  StatisticsData(s
-0006f800: 656c 6629 3a0d 0a20 2020 2020 2020 2022  elf):..        "
-0006f810: 2222 0d0a 2020 2020 2020 2020 5265 7475  ""..        Retu
-0006f820: 726e 7320 7468 6520 7374 6174 6973 7469  rns the statisti
-0006f830: 6373 2063 6f6c 6c65 6374 6564 2064 7572  cs collected dur
-0006f840: 696e 6720 6c61 7374 2050 6f70 756c 6174  ing last Populat
-0006f850: 6528 292c 206f 7220 7b7d 2e0d 0a20 2020  e(), or {}...   
-0006f860: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-0006f870: 2020 7265 7475 726e 2073 656c 662e 5f70    return self._p
-0006f880: 6172 7365 722e 6765 745f 636f 6c6c 6563  arser.get_collec
-0006f890: 7465 645f 7374 6174 7328 2920 6966 2073  ted_stats() if s
-0006f8a0: 656c 662e 5f70 6172 7365 7220 656c 7365  elf._parser else
-0006f8b0: 207b 7d0d 0a0d 0a0d 0a20 2020 2064 6566   {}......    def
-0006f8c0: 2047 6574 5469 6d65 6c69 6e65 4461 7461   GetTimelineData
-0006f8d0: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
-0006f8e0: 2022 2222 0d0a 2020 2020 2020 2020 5265   """..        Re
-0006f8f0: 7475 726e 7320 7468 6520 7469 6d65 6c69  turns the timeli
-0006f900: 6e65 2063 6f6c 6c65 6374 6564 2064 7572  ne collected dur
-0006f910: 696e 6720 6c61 7374 2050 6f70 756c 6174  ing last Populat
-0006f920: 6528 292c 206f 7220 7b7d 2e0d 0a20 2020  e(), or {}...   
-0006f930: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-0006f940: 2020 7265 7475 726e 2073 656c 662e 5f70    return self._p
-0006f950: 6172 7365 722e 6765 745f 7469 6d65 6c69  arser.get_timeli
-0006f960: 6e65 5f73 7461 7473 2829 2069 6620 7365  ne_stats() if se
-0006f970: 6c66 2e5f 7061 7273 6572 2065 6c73 6520  lf._parser else 
-0006f980: 7b7d 0d0a 0d0a 0d0a 2020 2020 6465 6620  {}......    def 
-0006f990: 436c 6561 7241 6c6c 2873 656c 6629 3a0d  ClearAll(self):.
-0006f9a0: 0a20 2020 2020 2020 2022 2222 4465 6c65  .        """Dele
-0006f9b0: 7465 2061 6c6c 2074 6578 7420 696e 2074  te all text in t
-0006f9c0: 6865 2064 6f63 756d 656e 742e 2222 220d  he document.""".
-0006f9d0: 0a20 2020 2020 2020 2072 6561 646f 6e6c  .        readonl
-0006f9e0: 795f 7374 6174 6520 3d20 7365 6c66 2e47  y_state = self.G
-0006f9f0: 6574 5265 6164 4f6e 6c79 2829 0d0a 2020  etReadOnly()..  
-0006fa00: 2020 2020 2020 7365 6c66 2e53 6574 5265        self.SetRe
-0006fa10: 6164 4f6e 6c79 2846 616c 7365 290d 0a20  adOnly(False).. 
-0006fa20: 2020 2020 2020 2077 782e 7374 632e 5374         wx.stc.St
-0006fa30: 796c 6564 5465 7874 4374 726c 2e43 6c65  yledTextCtrl.Cle
-0006fa40: 6172 416c 6c28 7365 6c66 2e53 5443 290d  arAll(self.STC).
-0006fa50: 0a20 2020 2020 2020 2073 656c 662e 5365  .        self.Se
-0006fa60: 7452 6561 644f 6e6c 7928 7265 6164 6f6e  tReadOnly(readon
-0006fa70: 6c79 5f73 7461 7465 290d 0a0d 0a0d 0a0d  ly_state).......
-0006fa80: 0a63 6c61 7373 2053 716c 6974 6547 7269  .class SqliteGri
-0006fa90: 6442 6173 6528 7778 2e67 7269 642e 4772  dBase(wx.grid.Gr
-0006faa0: 6964 5461 626c 6542 6173 6529 3a0d 0a20  idTableBase):.. 
-0006fab0: 2020 2022 2222 0d0a 2020 2020 5461 626c     """..    Tabl
-0006fac0: 6520 6261 7365 2066 6f72 2077 782e 6772  e base for wx.gr
-0006fad0: 6964 2e47 7269 642c 2063 616e 2074 616b  id.Grid, can tak
-0006fae0: 6520 6974 7320 6461 7461 2066 726f 6d20  e its data from 
-0006faf0: 6120 7369 6e67 6c65 2074 6162 6c65 2c20  a single table, 
-0006fb00: 6f72 2066 726f 6d0d 0a20 2020 2074 6865  or from..    the
-0006fb10: 2072 6573 756c 7473 206f 6620 616e 7920   results of any 
-0006fb20: 5345 4c45 4354 2071 7565 7279 2e0d 0a20  SELECT query... 
-0006fb30: 2020 2022 2222 0d0a 0d0a 2020 2020 2222     """....    ""
-0006fb40: 2248 6f77 206d 616e 7920 726f 7773 2074  "How many rows t
-0006fb50: 6f20 7365 656b 2061 6865 6164 2066 6f72  o seek ahead for
-0006fb60: 2071 7565 7279 2067 7269 6473 2e22 2222   query grids."""
-0006fb70: 0d0a 2020 2020 5345 454b 5f43 4855 4e4b  ..    SEEK_CHUNK
-0006fb80: 5f4c 454e 4754 4820 3d20 3130 300d 0a0d  _LENGTH = 100...
-0006fb90: 0a0d 0a20 2020 2064 6566 205f 5f69 6e69  ...    def __ini
-0006fba0: 745f 5f28 7365 6c66 2c20 6462 2c20 7461  t__(self, db, ta
-0006fbb0: 626c 653d 2222 2c20 7371 6c3d 2222 293a  ble="", sql=""):
-0006fbc0: 0d0a 2020 2020 2020 2020 7375 7065 7228  ..        super(
-0006fbd0: 5371 6c69 7465 4772 6964 4261 7365 2c20  SqliteGridBase, 
-0006fbe0: 7365 6c66 292e 5f5f 696e 6974 5f5f 2829  self).__init__()
-0006fbf0: 0d0a 2020 2020 2020 2020 7365 6c66 2e69  ..        self.i
-0006fc00: 735f 7175 6572 7920 3d20 626f 6f6c 2873  s_query = bool(s
-0006fc10: 716c 290d 0a20 2020 2020 2020 2073 656c  ql)..        sel
-0006fc20: 662e 6462 203d 2064 620d 0a20 2020 2020  f.db = db..     
-0006fc30: 2020 2073 656c 662e 7371 6c20 3d20 7371     self.sql = sq
-0006fc40: 6c0d 0a20 2020 2020 2020 2073 656c 662e  l..        self.
-0006fc50: 7461 626c 6520 3d20 7461 626c 650d 0a20  table = table.. 
-0006fc60: 2020 2020 2020 2023 2049 4420 6865 7265         # ID here
-0006fc70: 2069 7320 6120 756e 6971 7565 2076 616c   is a unique val
-0006fc80: 7565 2069 6465 6e74 6966 7969 6e67 2072  ue identifying r
-0006fc90: 6f77 7320 696e 2074 6869 7320 6f62 6a65  ows in this obje
-0006fca0: 6374 2c0d 0a20 2020 2020 2020 2023 206e  ct,..        # n
-0006fcb0: 6f20 7265 6c61 7469 6f6e 2074 6f20 7461  o relation to ta
-0006fcc0: 626c 6520 6461 7461 0d0a 2020 2020 2020  ble data..      
-0006fcd0: 2020 7365 6c66 2e69 6478 5f61 6c6c 203d    self.idx_all =
-0006fce0: 205b 5d20 2320 416e 206f 7264 6572 6564   [] # An ordered
-0006fcf0: 206c 6973 7420 6f66 2072 6f77 2069 6465   list of row ide
-0006fd00: 6e74 6966 6965 7273 2069 6e20 726f 7773  ntifiers in rows
-0006fd10: 5f61 6c6c 0d0a 2020 2020 2020 2020 7365  _all..        se
-0006fd20: 6c66 2e72 6f77 735f 616c 6c20 3d20 7b7d  lf.rows_all = {}
-0006fd30: 2023 2055 6e66 696c 7465 7265 642c 2075   # Unfiltered, u
-0006fd40: 6e73 6f72 7465 6420 726f 7773 207b 6964  nsorted rows {id
-0006fd50: 3a20 726f 772c 207d 0d0a 2020 2020 2020  : row, }..      
-0006fd60: 2020 7365 6c66 2e72 6f77 735f 6375 7272    self.rows_curr
-0006fd70: 656e 7420 3d20 5b5d 2023 2043 7572 7265  ent = [] # Curre
-0006fd80: 6e74 6c79 2073 686f 776e 2028 6669 6c74  ntly shown (filt
-0006fd90: 6572 6564 2f73 6f72 7465 6429 2072 6f77  ered/sorted) row
-0006fda0: 730d 0a20 2020 2020 2020 2073 656c 662e  s..        self.
-0006fdb0: 726f 7769 6473 203d 207b 7d20 2320 5351  rowids = {} # SQ
-0006fdc0: 4c69 7465 2074 6162 6c65 2072 6f77 6964  Lite table rowid
-0006fdd0: 732c 2075 7365 6420 666f 7220 5550 4441  s, used for UPDA
-0006fde0: 5445 2061 6e64 2044 454c 4554 450d 0a20  TE and DELETE.. 
-0006fdf0: 2020 2020 2020 2073 656c 662e 6964 785f         self.idx_
-0006fe00: 6368 616e 6765 6420 3d20 7365 7428 2920  changed = set() 
-0006fe10: 2320 7365 7420 6f66 2069 6e64 6963 6573  # set of indices
-0006fe20: 2066 6f72 2063 6861 6e67 6564 2072 6f77   for changed row
-0006fe30: 7320 696e 2072 6f77 735f 616c 6c0d 0a20  s in rows_all.. 
-0006fe40: 2020 2020 2020 2073 656c 662e 726f 7773         self.rows
-0006fe50: 5f62 6163 6b75 7020 3d20 7b7d 2023 2046  _backup = {} # F
-0006fe60: 6f72 2063 6861 6e67 6564 2072 6f77 7320  or changed rows 
-0006fe70: 7b69 643a 206f 7269 6769 6e61 6c5f 726f  {id: original_ro
-0006fe80: 772c 207d 0d0a 2020 2020 2020 2020 7365  w, }..        se
-0006fe90: 6c66 2e69 6478 5f6e 6577 203d 205b 5d20  lf.idx_new = [] 
-0006fea0: 2320 556e 7361 7665 6420 6164 6465 6420  # Unsaved added 
-0006feb0: 726f 7720 696e 6469 6365 730d 0a20 2020  row indices..   
-0006fec0: 2020 2020 2073 656c 662e 726f 7773 5f64       self.rows_d
-0006fed0: 656c 6574 6564 203d 207b 7d20 2320 556e  eleted = {} # Un
-0006fee0: 636f 6d6d 6974 7465 6420 6465 6c65 7465  committed delete
-0006fef0: 6420 726f 7773 207b 6964 3a20 6465 6c65  d rows {id: dele
-0006ff00: 7465 645f 726f 772c 207d 0d0a 2020 2020  ted_row, }..    
-0006ff10: 2020 2020 7365 6c66 2e72 6f77 6964 5f6e      self.rowid_n
-0006ff20: 616d 6520 3d20 2252 4f57 4944 2573 2220  ame = "ROWID%s" 
-0006ff30: 2520 696e 7428 7469 6d65 2e74 696d 6528  % int(time.time(
-0006ff40: 2929 2023 2041 766f 6964 2063 6f6c 6c69  )) # Avoid colli
-0006ff50: 7369 6f6e 730d 0a20 2020 2020 2020 2073  sions..        s
-0006ff60: 656c 662e 6974 6572 6174 6f72 5f69 6e64  elf.iterator_ind
-0006ff70: 6578 203d 202d 310d 0a20 2020 2020 2020  ex = -1..       
-0006ff80: 2073 656c 662e 736f 7274 5f61 7363 656e   self.sort_ascen
-0006ff90: 6469 6e67 203d 2046 616c 7365 0d0a 2020  ding = False..  
-0006ffa0: 2020 2020 2020 7365 6c66 2e73 6f72 745f        self.sort_
-0006ffb0: 636f 6c75 6d6e 203d 204e 6f6e 6520 2320  column = None # 
-0006ffc0: 496e 6465 7820 6f66 2063 6f6c 756d 6e20  Index of column 
-0006ffd0: 6375 7272 656e 746c 7920 736f 7274 6564  currently sorted
-0006ffe0: 2062 790d 0a20 2020 2020 2020 2073 656c   by..        sel
-0006fff0: 662e 6669 6c74 6572 7320 3d20 7b7d 2023  f.filters = {} #
-00070000: 207b 636f 6c3a 2076 616c 7565 2c20 7d0d   {col: value, }.
-00070010: 0a20 2020 2020 2020 2073 656c 662e 6174  .        self.at
-00070020: 7472 7320 3d20 7b7d 2023 207b 226e 6577  trs = {} # {"new
-00070030: 223a 2077 782e 6772 6964 2e47 7269 6443  ": wx.grid.GridC
-00070040: 656c 6c41 7474 722c 207d 0d0a 0d0a 2020  ellAttr, }....  
-00070050: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
-00070060: 662e 6973 5f71 7565 7279 3a0d 0a20 2020  f.is_query:..   
-00070070: 2020 2020 2020 2020 2073 656c 662e 7371           self.sq
-00070080: 6c20 3d20 2253 454c 4543 5420 726f 7769  l = "SELECT rowi
-00070090: 6420 4153 2025 732c 202a 2046 524f 4d20  d AS %s, * FROM 
-000700a0: 2573 2220 2520 2873 656c 662e 726f 7769  %s" % (self.rowi
-000700b0: 645f 6e61 6d65 2c20 7461 626c 6529 0d0a  d_name, table)..
-000700c0: 2020 2020 2020 2020 7365 6c66 2e72 6f77          self.row
-000700d0: 5f69 7465 7261 746f 7220 3d20 6462 2e65  _iterator = db.e
-000700e0: 7865 6375 7465 2873 656c 662e 7371 6c29  xecute(self.sql)
-000700f0: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
-00070100: 662e 6973 5f71 7565 7279 3a0d 0a20 2020  f.is_query:..   
-00070110: 2020 2020 2020 2020 2073 656c 662e 636f           self.co
-00070120: 6c75 6d6e 7320 3d20 5b7b 226e 616d 6522  lumns = [{"name"
-00070130: 3a20 635b 305d 2c20 2274 7970 6522 3a20  : c[0], "type": 
-00070140: 2254 4558 5422 7d0d 0a20 2020 2020 2020  "TEXT"}..       
-00070150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00070160: 2020 2020 2066 6f72 2063 2069 6e20 7365       for c in se
-00070170: 6c66 2e72 6f77 5f69 7465 7261 746f 722e  lf.row_iterator.
-00070180: 6465 7363 7269 7074 696f 6e20 6f72 2028  description or (
-00070190: 295d 0d0a 2020 2020 2020 2020 2020 2020  )]..            
-000701a0: 2320 446f 696e 6720 736f 6d65 2074 7269  # Doing some tri
-000701b0: 636b 6572 7920 6865 7265 3a20 7765 2063  ckery here: we c
-000701c0: 616e 206f 6e6c 7920 6b6e 6f77 2074 6865  an only know the
-000701d0: 2072 6f77 2063 6f75 6e74 2077 6865 6e20   row count when 
-000701e0: 7765 2068 6176 650d 0a20 2020 2020 2020  we have..       
-000701f0: 2020 2020 2023 2072 6574 7269 6576 6564       # retrieved
-00070200: 2061 6c6c 2074 6865 2072 6f77 732c 2077   all the rows, w
-00070210: 6869 6368 2069 7320 7072 6566 6572 7261  hich is preferra
-00070220: 626c 6520 6e6f 7420 746f 2064 6f20 6174  ble not to do at
-00070230: 2066 6972 7374 2c0d 0a20 2020 2020 2020   first,..       
-00070240: 2020 2020 2023 2073 696e 6365 2074 6865       # since the
-00070250: 7265 2069 7320 6e6f 2074 656c 6c69 6e67  re is no telling
-00070260: 2068 6f77 206d 7563 6820 7469 6d65 2069   how much time i
-00070270: 7420 6361 6e20 7461 6b65 2e20 496e 7374  t can take. Inst
-00070280: 6561 642c 2077 650d 0a20 2020 2020 2020  ead, we..       
-00070290: 2020 2020 2023 2075 7064 6174 6520 7468       # update th
-000702a0: 6520 726f 7720 636f 756e 7420 6368 756e  e row count chun
-000702b0: 6b20 6279 2063 6875 6e6b 2e0d 0a20 2020  k by chunk...   
-000702c0: 2020 2020 2020 2020 2073 656c 662e 726f           self.ro
-000702d0: 775f 636f 756e 7420 3d20 7365 6c66 2e53  w_count = self.S
-000702e0: 4545 4b5f 4348 554e 4b5f 4c45 4e47 5448  EEK_CHUNK_LENGTH
-000702f0: 0d0a 2020 2020 2020 2020 2020 2020 5459  ..            TY
-00070300: 5045 5320 3d20 6469 6374 2828 762c 206b  PES = dict((v, k
-00070310: 2920 666f 7220 6b2c 2076 7620 696e 207b  ) for k, vv in {
-00070320: 2249 4e54 4547 4552 223a 2073 6978 2e69  "INTEGER": six.i
-00070330: 6e74 6567 6572 5f74 7970 6573 202b 2028  nteger_types + (
-00070340: 626f 6f6c 2c20 292c 0d0a 2020 2020 2020  bool, ),..      
-00070350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00070360: 2020 2022 5245 414c 223a 2028 666c 6f61     "REAL": (floa
-00070370: 742c 2029 7d2e 6974 656d 7328 2920 666f  t, )}.items() fo
-00070380: 7220 7620 696e 2076 7629 0d0a 2020 2020  r v in vv)..    
-00070390: 2020 2020 2020 2020 2320 5365 656b 2061          # Seek a
-000703a0: 6865 6164 206f 6e20 726f 7773 2061 6e64  head on rows and
-000703b0: 2067 6574 2063 6f6c 756d 6e20 696e 666f   get column info
-000703c0: 726d 6174 696f 6e20 6672 6f6d 2066 6972  rmation from fir
-000703d0: 7374 2076 616c 7565 730d 0a20 2020 2020  st values..     
-000703e0: 2020 2020 2020 2074 7279 3a20 7365 6c66         try: self
-000703f0: 2e53 6565 6b54 6f52 6f77 2873 656c 662e  .SeekToRow(self.
-00070400: 5345 454b 5f43 4855 4e4b 5f4c 454e 4754  SEEK_CHUNK_LENGT
-00070410: 4820 2d20 3129 0d0a 2020 2020 2020 2020  H - 1)..        
-00070420: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
-00070430: 7469 6f6e 3a20 7061 7373 0d0a 2020 2020  tion: pass..    
-00070440: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00070450: 726f 7773 5f63 7572 7265 6e74 3a0d 0a20  rows_current:.. 
-00070460: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00070470: 6f72 2063 6f6c 2069 6e20 7365 6c66 2e63  or col in self.c
-00070480: 6f6c 756d 6e73 3a0d 0a20 2020 2020 2020  olumns:..       
-00070490: 2020 2020 2020 2020 2020 2020 2076 616c               val
-000704a0: 7565 203d 2073 656c 662e 726f 7773 5f63  ue = self.rows_c
-000704b0: 7572 7265 6e74 5b30 5d5b 636f 6c5b 226e  urrent[0][col["n
-000704c0: 616d 6522 5d5d 0d0a 2020 2020 2020 2020  ame"]]..        
-000704d0: 2020 2020 2020 2020 2020 2020 636f 6c5b              col[
-000704e0: 2274 7970 6522 5d20 3d20 5459 5045 532e  "type"] = TYPES.
-000704f0: 6765 7428 7479 7065 2876 616c 7565 292c  get(type(value),
-00070500: 2063 6f6c 5b22 7479 7065 225d 290d 0a20   col["type"]).. 
-00070510: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-00070520: 2020 2020 2020 2020 2020 7365 6c66 2e63            self.c
-00070530: 6f6c 756d 6e73 203d 2064 622e 6765 745f  olumns = db.get_
-00070540: 7461 626c 655f 636f 6c75 6d6e 7328 7461  table_columns(ta
-00070550: 626c 6529 0d0a 2020 2020 2020 2020 2020  ble)..          
-00070560: 2020 7365 6c66 2e72 6f77 5f63 6f75 6e74    self.row_count
-00070570: 203d 206e 6578 7428 6462 2e65 7865 6375   = next(db.execu
-00070580: 7465 2822 5345 4c45 4354 2043 4f55 4e54  te("SELECT COUNT
-00070590: 282a 2920 4153 2072 6f77 7320 4652 4f4d  (*) AS rows FROM
-000705a0: 2025 7322 0d0a 2020 2020 2020 2020 2020   %s"..          
-000705b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000705c0: 2020 2020 2020 2020 2520 7461 626c 6529          % table)
-000705d0: 295b 2272 6f77 7322 5d0d 0a0d 0a0d 0a20  )["rows"]...... 
-000705e0: 2020 2064 6566 2047 6574 436f 6c4c 6162     def GetColLab
-000705f0: 656c 5661 6c75 6528 7365 6c66 2c20 636f  elValue(self, co
-00070600: 6c29 3a0d 0a20 2020 2020 2020 206c 6162  l):..        lab
-00070610: 656c 203d 2073 656c 662e 636f 6c75 6d6e  el = self.column
-00070620: 735b 636f 6c5d 5b22 6e61 6d65 225d 0d0a  s[col]["name"]..
-00070630: 2020 2020 2020 2020 6966 2063 6f6c 203d          if col =
-00070640: 3d20 7365 6c66 2e73 6f72 745f 636f 6c75  = self.sort_colu
-00070650: 6d6e 3a0d 0a20 2020 2020 2020 2020 2020  mn:..           
-00070660: 206c 6162 656c 202b 3d20 7522 20e2 8691   label += u" ...
-00070670: 2220 6966 2073 656c 662e 736f 7274 5f61  " if self.sort_a
-00070680: 7363 656e 6469 6e67 2065 6c73 6520 7522  scending else u"
-00070690: 20e2 8693 220d 0a20 2020 2020 2020 2069   ..."..        i
-000706a0: 6620 636f 6c20 696e 2073 656c 662e 6669  f col in self.fi
-000706b0: 6c74 6572 733a 0d0a 2020 2020 2020 2020  lters:..        
-000706c0: 2020 2020 6966 2022 5445 5854 2220 3d3d      if "TEXT" ==
-000706d0: 2073 656c 662e 636f 6c75 6d6e 735b 636f   self.columns[co
-000706e0: 6c5d 5b22 7479 7065 225d 3a0d 0a20 2020  l]["type"]:..   
-000706f0: 2020 2020 2020 2020 2020 2020 206c 6162               lab
-00070700: 656c 202b 3d20 225c 6e6c 696b 6520 5c22  el += "\nlike \"
-00070710: 2573 5c22 2220 2520 7365 6c66 2e66 696c  %s\"" % self.fil
-00070720: 7465 7273 5b63 6f6c 5d0d 0a20 2020 2020  ters[col]..     
-00070730: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-00070740: 2020 2020 2020 2020 2020 2020 2020 6c61                la
-00070750: 6265 6c20 2b3d 2022 5c6e 3d20 2573 2220  bel += "\n= %s" 
-00070760: 2520 7365 6c66 2e66 696c 7465 7273 5b63  % self.filters[c
-00070770: 6f6c 5d0d 0a20 2020 2020 2020 2072 6574  ol]..        ret
-00070780: 7572 6e20 6c61 6265 6c0d 0a0d 0a0d 0a20  urn label...... 
-00070790: 2020 2064 6566 2047 6574 4e75 6d62 6572     def GetNumber
-000707a0: 526f 7773 2873 656c 6629 3a0d 0a20 2020  Rows(self):..   
-000707b0: 2020 2020 2072 6573 756c 7420 3d20 7365       result = se
-000707c0: 6c66 2e72 6f77 5f63 6f75 6e74 0d0a 2020  lf.row_count..  
-000707d0: 2020 2020 2020 6966 2073 656c 662e 6669        if self.fi
-000707e0: 6c74 6572 733a 0d0a 2020 2020 2020 2020  lters:..        
-000707f0: 2020 2020 7265 7375 6c74 203d 206c 656e      result = len
-00070800: 2873 656c 662e 726f 7773 5f63 7572 7265  (self.rows_curre
-00070810: 6e74 290d 0a20 2020 2020 2020 2072 6574  nt)..        ret
-00070820: 7572 6e20 7265 7375 6c74 0d0a 0d0a 0d0a  urn result......
-00070830: 2020 2020 6465 6620 4765 744e 756d 6265      def GetNumbe
-00070840: 7243 6f6c 7328 7365 6c66 293a 0d0a 2020  rCols(self):..  
-00070850: 2020 2020 2020 7265 7475 726e 206c 656e        return len
-00070860: 2873 656c 662e 636f 6c75 6d6e 7329 0d0a  (self.columns)..
-00070870: 0d0a 0d0a 2020 2020 6465 6620 5365 656b  ....    def Seek
-00070880: 4168 6561 6428 7365 6c66 2c20 746f 5f65  Ahead(self, to_e
-00070890: 6e64 3d46 616c 7365 293a 0d0a 2020 2020  nd=False):..    
-000708a0: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
-000708b0: 2053 6565 6b73 2061 6865 6164 206f 6e20   Seeks ahead on 
-000708c0: 7468 6520 7175 6572 7920 6375 7273 6f72  the query cursor
-000708d0: 2c20 6279 2074 6865 2063 6875 6e6b 206c  , by the chunk l
-000708e0: 656e 6774 6820 6f72 2075 6e74 696c 2074  ength or until t
-000708f0: 6865 2065 6e64 2e0d 0a0d 0a20 2020 2020  he end.....     
-00070900: 2020 2040 7061 7261 6d20 2020 746f 5f65     @param   to_e
-00070910: 6e64 2020 6966 2054 7275 652c 2072 6574  nd  if True, ret
-00070920: 7269 6576 6573 2061 6c6c 2072 6f77 730d  rieves all rows.
-00070930: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
-00070940: 2020 2020 2020 7365 656b 5f63 6f75 6e74        seek_count
-00070950: 203d 2073 656c 662e 726f 775f 636f 756e   = self.row_coun
-00070960: 7420 2b20 7365 6c66 2e53 4545 4b5f 4348  t + self.SEEK_CH
-00070970: 554e 4b5f 4c45 4e47 5448 202d 2031 0d0a  UNK_LENGTH - 1..
-00070980: 2020 2020 2020 2020 6966 2074 6f5f 656e          if to_en
-00070990: 643a 0d0a 2020 2020 2020 2020 2020 2020  d:..            
-000709a0: 7365 656b 5f63 6f75 6e74 203d 2073 7973  seek_count = sys
-000709b0: 2e6d 6178 7369 7a65 0d0a 2020 2020 2020  .maxsize..      
-000709c0: 2020 7365 6c66 2e53 6565 6b54 6f52 6f77    self.SeekToRow
-000709d0: 2873 6565 6b5f 636f 756e 7429 0d0a 0d0a  (seek_count)....
-000709e0: 0d0a 2020 2020 6465 6620 5365 656b 546f  ..    def SeekTo
-000709f0: 526f 7728 7365 6c66 2c20 726f 7729 3a0d  Row(self, row):.
-00070a00: 0a20 2020 2020 2020 2022 2222 5365 656b  .        """Seek
-00070a10: 7320 6168 6561 6420 6f6e 2074 6865 2072  s ahead on the r
-00070a20: 6f77 2069 7465 7261 746f 7220 746f 2074  ow iterator to t
-00070a30: 6865 2073 7065 6369 6669 6564 2072 6f77  he specified row
-00070a40: 2e22 2222 0d0a 2020 2020 2020 2020 726f  ."""..        ro
-00070a50: 7773 5f62 6566 6f72 6520 3d20 6c65 6e28  ws_before = len(
-00070a60: 7365 6c66 2e72 6f77 735f 616c 6c29 0d0a  self.rows_all)..
-00070a70: 2020 2020 2020 2020 7768 696c 6520 7365          while se
-00070a80: 6c66 2e72 6f77 5f69 7465 7261 746f 7220  lf.row_iterator 
-00070a90: 616e 6420 2873 656c 662e 6974 6572 6174  and (self.iterat
-00070aa0: 6f72 5f69 6e64 6578 203c 2072 6f77 293a  or_index < row):
-00070ab0: 0d0a 2020 2020 2020 2020 2020 2020 726f  ..            ro
-00070ac0: 7764 6174 6120 3d20 4e6f 6e65 0d0a 2020  wdata = None..  
-00070ad0: 2020 2020 2020 2020 2020 7472 793a 0d0a            try:..
-00070ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00070af0: 726f 7764 6174 6120 3d20 6e65 7874 2873  rowdata = next(s
-00070b00: 656c 662e 726f 775f 6974 6572 6174 6f72  elf.row_iterator
-00070b10: 290d 0a20 2020 2020 2020 2020 2020 2065  )..            e
-00070b20: 7863 6570 7420 4578 6365 7074 696f 6e3a  xcept Exception:
-00070b30: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00070b40: 2020 7061 7373 0d0a 2020 2020 2020 2020    pass..        
-00070b50: 2020 2020 6966 2072 6f77 6461 7461 3a0d      if rowdata:.
-00070b60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00070b70: 2069 6478 203d 2069 6428 726f 7764 6174   idx = id(rowdat
-00070b80: 6129 0d0a 2020 2020 2020 2020 2020 2020  a)..            
-00070b90: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
-00070ba0: 6973 5f71 7565 7279 3a0d 0a20 2020 2020  is_query:..     
-00070bb0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00070bc0: 656c 662e 726f 7769 6473 5b69 6478 5d20  elf.rowids[idx] 
-00070bd0: 3d20 726f 7764 6174 615b 7365 6c66 2e72  = rowdata[self.r
-00070be0: 6f77 6964 5f6e 616d 655d 0d0a 2020 2020  owid_name]..    
-00070bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00070c00: 6465 6c20 726f 7764 6174 615b 7365 6c66  del rowdata[self
-00070c10: 2e72 6f77 6964 5f6e 616d 655d 0d0a 2020  .rowid_name]..  
-00070c20: 2020 2020 2020 2020 2020 2020 2020 726f                ro
-00070c30: 7764 6174 615b 225f 5f69 645f 5f22 5d20  wdata["__id__"] 
-00070c40: 3d20 6964 780d 0a20 2020 2020 2020 2020  = idx..         
-00070c50: 2020 2020 2020 2072 6f77 6461 7461 5b22         rowdata["
-00070c60: 5f5f 6368 616e 6765 645f 5f22 5d20 3d20  __changed__"] = 
-00070c70: 4661 6c73 650d 0a20 2020 2020 2020 2020  False..         
-00070c80: 2020 2020 2020 2072 6f77 6461 7461 5b22         rowdata["
-00070c90: 5f5f 6e65 775f 5f22 5d20 3d20 4661 6c73  __new__"] = Fals
-00070ca0: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
-00070cb0: 2020 2072 6f77 6461 7461 5b22 5f5f 6465     rowdata["__de
-00070cc0: 6c65 7465 645f 5f22 5d20 3d20 4661 6c73  leted__"] = Fals
-00070cd0: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
-00070ce0: 2020 2073 656c 662e 726f 7773 5f61 6c6c     self.rows_all
-00070cf0: 5b69 6478 5d20 3d20 726f 7764 6174 610d  [idx] = rowdata.
-00070d00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00070d10: 2073 656c 662e 726f 7773 5f63 7572 7265   self.rows_curre
-00070d20: 6e74 2e61 7070 656e 6428 726f 7764 6174  nt.append(rowdat
-00070d30: 6129 0d0a 2020 2020 2020 2020 2020 2020  a)..            
-00070d40: 2020 2020 7365 6c66 2e69 6478 5f61 6c6c      self.idx_all
-00070d50: 2e61 7070 656e 6428 6964 7829 0d0a 2020  .append(idx)..  
-00070d60: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00070d70: 6c66 2e69 7465 7261 746f 725f 696e 6465  lf.iterator_inde
-00070d80: 7820 2b3d 2031 0d0a 2020 2020 2020 2020  x += 1..        
-00070d90: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-00070da0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00070db0: 726f 775f 6974 6572 6174 6f72 203d 204e  row_iterator = N
-00070dc0: 6f6e 650d 0a20 2020 2020 2020 2069 6620  one..        if 
-00070dd0: 7365 6c66 2e69 735f 7175 6572 793a 0d0a  self.is_query:..
-00070de0: 2020 2020 2020 2020 2020 2020 6966 2028              if (
-00070df0: 7365 6c66 2e72 6f77 5f63 6f75 6e74 2021  self.row_count !
-00070e00: 3d20 7365 6c66 2e69 7465 7261 746f 725f  = self.iterator_
-00070e10: 696e 6465 7820 2b20 3129 3a0d 0a20 2020  index + 1):..   
-00070e20: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00070e30: 662e 726f 775f 636f 756e 7420 3d20 7365  f.row_count = se
-00070e40: 6c66 2e69 7465 7261 746f 725f 696e 6465  lf.iterator_inde
-00070e50: 7820 2b20 310d 0a20 2020 2020 2020 2020  x + 1..         
-00070e60: 2020 2020 2020 2073 656c 662e 4e6f 7469         self.Noti
-00070e70: 6679 5669 6577 4368 616e 6765 2872 6f77  fyViewChange(row
-00070e80: 735f 6265 666f 7265 290d 0a0d 0a0d 0a20  s_before)...... 
-00070e90: 2020 2064 6566 2047 6574 5661 6c75 6528     def GetValue(
-00070ea0: 7365 6c66 2c20 726f 772c 2063 6f6c 293a  self, row, col):
-00070eb0: 0d0a 2020 2020 2020 2020 7661 6c75 6520  ..        value 
-00070ec0: 3d20 4e6f 6e65 0d0a 2020 2020 2020 2020  = None..        
-00070ed0: 6966 2072 6f77 203c 2073 656c 662e 726f  if row < self.ro
-00070ee0: 775f 636f 756e 743a 0d0a 2020 2020 2020  w_count:..      
-00070ef0: 2020 2020 2020 7365 6c66 2e53 6565 6b54        self.SeekT
-00070f00: 6f52 6f77 2872 6f77 290d 0a20 2020 2020  oRow(row)..     
-00070f10: 2020 2020 2020 2069 6620 726f 7720 3c20         if row < 
-00070f20: 6c65 6e28 7365 6c66 2e72 6f77 735f 6375  len(self.rows_cu
-00070f30: 7272 656e 7429 3a0d 0a20 2020 2020 2020  rrent):..       
-00070f40: 2020 2020 2020 2020 2076 616c 7565 203d           value =
-00070f50: 2073 656c 662e 726f 7773 5f63 7572 7265   self.rows_curre
-00070f60: 6e74 5b72 6f77 5d5b 7365 6c66 2e63 6f6c  nt[row][self.col
-00070f70: 756d 6e73 5b63 6f6c 5d5b 226e 616d 6522  umns[col]["name"
-00070f80: 5d5d 0d0a 2020 2020 2020 2020 2020 2020  ]]..            
-00070f90: 2020 2020 6966 2073 7973 2e76 6572 7369      if sys.versi
-00070fa0: 6f6e 5f69 6e66 6f20 3c20 2833 2c20 2920  on_info < (3, ) 
-00070fb0: 616e 6420 7479 7065 2876 616c 7565 2920  and type(value) 
-00070fc0: 6973 2062 7566 6665 723a 2020 2320 5079  is buffer:  # Py
-00070fd0: 320d 0a20 2020 2020 2020 2020 2020 2020  2..             
-00070fe0: 2020 2020 2020 2076 616c 7565 203d 2073         value = s
-00070ff0: 7472 2876 616c 7565 292e 6465 636f 6465  tr(value).decode
-00071000: 2822 6c61 7469 6e31 2229 0d0a 2020 2020  ("latin1")..    
-00071010: 2020 2020 6966 2076 616c 7565 2061 6e64      if value and
-00071020: 2022 424c 4f42 2220 3d3d 2073 656c 662e   "BLOB" == self.
-00071030: 636f 6c75 6d6e 735b 636f 6c5d 5b22 7479  columns[col]["ty
-00071040: 7065 225d 3a0d 0a20 2020 2020 2020 2020  pe"]:..         
-00071050: 2020 2023 2042 6c6f 6273 206e 6565 6420     # Blobs need 
-00071060: 7370 6563 6961 6c20 6861 6e64 6c69 6e67  special handling
-00071070: 2c20 6173 2074 6865 2074 6578 7420 6564  , as the text ed
-00071080: 6974 6f72 2064 6f65 7320 6e6f 740d 0a20  itor does not.. 
-00071090: 2020 2020 2020 2020 2020 2023 2073 7570             # sup
-000710a0: 706f 7274 2063 6f6e 7472 6f6c 2063 6861  port control cha
-000710b0: 7261 6374 6572 7320 6f72 206e 756c 6c20  racters or null 
-000710c0: 6279 7465 732e 0d0a 2020 2020 2020 2020  bytes...        
-000710d0: 2020 2020 7661 6c75 6520 3d20 7661 6c75      value = valu
-000710e0: 652e 656e 636f 6465 2822 756e 6963 6f64  e.encode("unicod
-000710f0: 652d 6573 6361 7065 2229 2e64 6563 6f64  e-escape").decod
-00071100: 6528 226c 6174 696e 3122 290d 0a20 2020  e("latin1")..   
-00071110: 2020 2020 2072 6574 7572 6e20 7661 6c75       return valu
-00071120: 6520 6966 2076 616c 7565 2069 7320 6e6f  e if value is no
-00071130: 7420 4e6f 6e65 2065 6c73 6520 2222 0d0a  t None else ""..
-00071140: 0d0a 0d0a 2020 2020 6465 6620 4765 7452  ....    def GetR
-00071150: 6f77 2873 656c 662c 2072 6f77 293a 0d0a  ow(self, row):..
-00071160: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
-00071170: 6e73 2074 6865 2064 6174 6120 6469 6374  ns the data dict
-00071180: 696f 6e61 7279 206f 6620 7468 6520 7370  ionary of the sp
-00071190: 6563 6966 6965 6420 726f 772e 2222 220d  ecified row.""".
-000711a0: 0a20 2020 2020 2020 2076 616c 7565 203d  .        value =
-000711b0: 204e 6f6e 650d 0a20 2020 2020 2020 2069   None..        i
-000711c0: 6620 726f 7720 3c20 7365 6c66 2e72 6f77  f row < self.row
-000711d0: 5f63 6f75 6e74 3a0d 0a20 2020 2020 2020  _count:..       
-000711e0: 2020 2020 2073 656c 662e 5365 656b 546f       self.SeekTo
-000711f0: 526f 7728 726f 7729 0d0a 2020 2020 2020  Row(row)..      
-00071200: 2020 2020 2020 6966 2072 6f77 203c 206c        if row < l
-00071210: 656e 2873 656c 662e 726f 7773 5f63 7572  en(self.rows_cur
-00071220: 7265 6e74 293a 0d0a 2020 2020 2020 2020  rent):..        
-00071230: 2020 2020 2020 2020 7661 6c75 6520 3d20          value = 
-00071240: 7365 6c66 2e72 6f77 735f 6375 7272 656e  self.rows_curren
-00071250: 745b 726f 775d 0d0a 2020 2020 2020 2020  t[row]..        
-00071260: 7265 7475 726e 2076 616c 7565 0d0a 0d0a  return value....
-00071270: 0d0a 2020 2020 6465 6620 4765 7452 6f77  ..    def GetRow
-00071280: 4974 6572 6174 6f72 2873 656c 6629 3a0d  Iterator(self):.
-00071290: 0a20 2020 2020 2020 2022 2222 5265 7475  .        """Retu
-000712a0: 726e 7320 6120 7365 7061 7261 7465 2069  rns a separate i
-000712b0: 7465 7261 746f 7220 7072 6f64 7563 696e  terator producin
-000712c0: 6720 616c 6c20 6772 6964 2072 6f77 732e  g all grid rows.
-000712d0: 2222 220d 0a20 2020 2020 2020 2022 2222  """..        """
-000712e0: 0d0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
-000712f0: 7320 616e 2069 7465 7261 746f 7220 7072  s an iterator pr
-00071300: 6f64 7563 696e 6720 616c 6c20 6772 6964  oducing all grid
-00071310: 2072 6f77 732c 2069 6e20 6375 7272 656e   rows, in curren
-00071320: 7420 736f 7274 206f 7264 6572 2061 6e64  t sort order and
-00071330: 0d0a 2020 2020 2020 2020 6d61 7463 6869  ..        matchi
-00071340: 6e67 2063 7572 7265 6e74 2066 696c 7465  ng current filte
-00071350: 722c 206d 616b 696e 6720 616e 2065 7874  r, making an ext
-00071360: 7261 2071 7565 7279 2069 6620 616c 6c20  ra query if all 
-00071370: 6e6f 7420 7265 7472 6965 7665 6420 7965  not retrieved ye
-00071380: 742e 0d0a 2020 2020 2020 2020 2222 220d  t...        """.
-00071390: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-000713a0: 2e72 6f77 5f69 7465 7261 746f 7220 6973  .row_iterator is
-000713b0: 204e 6f6e 653a 2072 6574 7572 6e20 6974   None: return it
-000713c0: 6572 2873 656c 662e 726f 7773 5f63 7572  er(self.rows_cur
-000713d0: 7265 6e74 2920 2320 416c 6c20 7265 7472  rent) # All retr
-000713e0: 6965 7665 640d 0a0d 0a20 2020 2020 2020  ieved....       
-000713f0: 2064 6566 2067 656e 6572 6174 6f72 2863   def generator(c
-00071400: 7572 736f 7229 3a0d 0a20 2020 2020 2020  ursor):..       
-00071410: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
-00071420: 2020 2020 2020 2020 2020 2066 6f72 2072             for r
-00071430: 6f77 2069 6e20 7365 6c66 2e72 6f77 735f  ow in self.rows_
-00071440: 6375 7272 656e 743a 2079 6965 6c64 2072  current: yield r
-00071450: 6f77 0d0a 0d0a 2020 2020 2020 2020 2020  ow....          
-00071460: 2020 2020 2020 726f 772c 2069 6e64 6578        row, index
-00071470: 203d 206e 6578 7428 6375 7273 6f72 292c   = next(cursor),
-00071480: 2030 0d0a 2020 2020 2020 2020 2020 2020   0..            
-00071490: 2020 2020 7768 696c 6520 726f 7720 616e      while row an
-000714a0: 6420 696e 6465 7820 3c20 7365 6c66 2e69  d index < self.i
-000714b0: 7465 7261 746f 725f 696e 6465 7820 2b20  terator_index + 
-000714c0: 313a 0d0a 2020 2020 2020 2020 2020 2020  1:..            
-000714d0: 2020 2020 2020 2020 726f 772c 2069 6e64          row, ind
-000714e0: 6578 203d 206e 6578 7428 6375 7273 6f72  ex = next(cursor
-000714f0: 292c 2069 6e64 6578 202b 2031 0d0a 2020  ), index + 1..  
-00071500: 2020 2020 2020 2020 2020 2020 2020 7768                wh
-00071510: 696c 6520 726f 773a 0d0a 2020 2020 2020  ile row:..      
-00071520: 2020 2020 2020 2020 2020 2020 2020 7768                wh
-00071530: 696c 6520 726f 7720 616e 6420 6e6f 7420  ile row and not 
-00071540: 7365 6c66 2e5f 6973 5f72 6f77 5f75 6e66  self._is_row_unf
-00071550: 696c 7465 7265 6428 726f 7729 3a20 726f  iltered(row): ro
-00071560: 7720 3d20 6e65 7874 2863 7572 736f 7229  w = next(cursor)
-00071570: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00071580: 2020 2020 2020 6966 2072 6f77 3a20 7969        if row: yi
-00071590: 656c 6420 726f 770d 0a20 2020 2020 2020  eld row..       
-000715a0: 2020 2020 2020 2020 2020 2020 2072 6f77               row
-000715b0: 203d 206e 6578 7428 6375 7273 6f72 290d   = next(cursor).
-000715c0: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
-000715d0: 6570 7420 2847 656e 6572 6174 6f72 4578  ept (GeneratorEx
-000715e0: 6974 2c20 5374 6f70 4974 6572 6174 696f  it, StopIteratio
-000715f0: 6e29 3a20 7061 7373 0d0a 0d0a 2020 2020  n): pass....    
-00071600: 2020 2020 7371 6c20 3d20 7365 6c66 2e73      sql = self.s
-00071610: 716c 2069 6620 7365 6c66 2e69 735f 7175  ql if self.is_qu
-00071620: 6572 7920 656c 7365 2022 5345 4c45 4354  ery else "SELECT
-00071630: 202a 2046 524f 4d20 2573 2220 2520 7365   * FROM %s" % se
-00071640: 6c66 2e74 6162 6c65 0d0a 2020 2020 2020  lf.table..      
-00071650: 2020 7265 7475 726e 2067 656e 6572 6174    return generat
-00071660: 6f72 2873 656c 662e 6462 2e65 7865 6375  or(self.db.execu
-00071670: 7465 2873 716c 2929 0d0a 0d0a 0d0a 2020  te(sql))......  
-00071680: 2020 6465 6620 5365 7456 616c 7565 2873    def SetValue(s
-00071690: 656c 662c 2072 6f77 2c20 636f 6c2c 2076  elf, row, col, v
-000716a0: 616c 293a 0d0a 2020 2020 2020 2020 6966  al):..        if
-000716b0: 206e 6f74 2028 7365 6c66 2e69 735f 7175   not (self.is_qu
-000716c0: 6572 7929 2061 6e64 2028 726f 7720 3c20  ery) and (row < 
-000716d0: 7365 6c66 2e72 6f77 5f63 6f75 6e74 293a  self.row_count):
-000716e0: 0d0a 2020 2020 2020 2020 2020 2020 6163  ..            ac
-000716f0: 6365 7074 6564 203d 2046 616c 7365 0d0a  cepted = False..
-00071700: 2020 2020 2020 2020 2020 2020 636f 6c5f              col_
-00071710: 7661 6c75 6520 3d20 4e6f 6e65 0d0a 2020  value = None..  
-00071720: 2020 2020 2020 2020 2020 6966 2022 494e            if "IN
-00071730: 5445 4745 5222 203d 3d20 7365 6c66 2e63  TEGER" == self.c
-00071740: 6f6c 756d 6e73 5b63 6f6c 5d5b 2274 7970  olumns[col]["typ
-00071750: 6522 5d3a 0d0a 2020 2020 2020 2020 2020  e"]:..          
-00071760: 2020 2020 2020 6966 206e 6f74 2076 616c        if not val
-00071770: 3a20 2320 5365 7420 636f 6c75 6d6e 2074  : # Set column t
-00071780: 6f20 4e55 4c4c 0d0a 2020 2020 2020 2020  o NULL..        
-00071790: 2020 2020 2020 2020 2020 2020 6163 6365              acce
-000717a0: 7074 6564 203d 2054 7275 650d 0a20 2020  pted = True..   
-000717b0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-000717c0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-000717d0: 2020 2020 2020 2020 7472 793a 0d0a 2020          try:..  
-000717e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000717f0: 2020 2020 2020 2320 416c 6c6f 7720 7573        # Allow us
-00071800: 6572 2074 6f20 656e 7465 7220 6120 636f  er to enter a co
-00071810: 6d6d 6120 666f 7220 6465 6369 6d61 6c20  mma for decimal 
-00071820: 7365 7061 7261 746f 722e 0d0a 2020 2020  separator...    
-00071830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00071840: 2020 2020 7661 6c63 203d 2076 616c 2e72      valc = val.r
-00071850: 6570 6c61 6365 2822 2c22 2c20 222e 2229  eplace(",", ".")
-00071860: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00071870: 2020 2020 2020 2020 2020 636f 6c5f 7661            col_va
-00071880: 6c75 6520 3d20 666c 6f61 7428 7661 6c63  lue = float(valc
-00071890: 2920 6966 2028 222e 2220 696e 2076 616c  ) if ("." in val
-000718a0: 6329 2065 6c73 6520 696e 7428 7661 6c29  c) else int(val)
-000718b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000718c0: 2020 2020 2020 2020 2020 6163 6365 7074            accept
-000718d0: 6564 203d 2054 7275 650d 0a20 2020 2020  ed = True..     
-000718e0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-000718f0: 7863 6570 7420 4578 6365 7074 696f 6e3a  xcept Exception:
-00071900: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00071910: 2020 2020 2020 2020 2020 7061 7373 0d0a            pass..
-00071920: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-00071930: 2022 424c 4f42 2220 3d3d 2073 656c 662e   "BLOB" == self.
-00071940: 636f 6c75 6d6e 735b 636f 6c5d 5b22 7479  columns[col]["ty
-00071950: 7065 225d 3a0d 0a20 2020 2020 2020 2020  pe"]:..         
-00071960: 2020 2020 2020 2023 2042 6c6f 6273 206e         # Blobs n
-00071970: 6565 6420 7370 6563 6961 6c20 6861 6e64  eed special hand
-00071980: 6c69 6e67 2c20 6173 2074 6865 2074 6578  ling, as the tex
-00071990: 7420 6564 6974 6f72 2064 6f65 7320 6e6f  t editor does no
-000719a0: 740d 0a20 2020 2020 2020 2020 2020 2020  t..             
-000719b0: 2020 2023 2073 7570 706f 7274 2063 6f6e     # support con
-000719c0: 7472 6f6c 2063 6861 7261 6374 6572 7320  trol characters 
-000719d0: 6f72 206e 756c 6c20 6279 7465 732e 0d0a  or null bytes...
-000719e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000719f0: 7472 793a 0d0a 2020 2020 2020 2020 2020  try:..          
-00071a00: 2020 2020 2020 2020 2020 636f 6c5f 7661            col_va
-00071a10: 6c75 6520 3d20 7661 6c2e 6465 636f 6465  lue = val.decode
-00071a20: 2822 756e 6963 6f64 652d 6573 6361 7065  ("unicode-escape
-00071a30: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
-00071a40: 2020 2020 2020 2020 6163 6365 7074 6564          accepted
-00071a50: 203d 2054 7275 650d 0a20 2020 2020 2020   = True..       
-00071a60: 2020 2020 2020 2020 2065 7863 6570 7420           except 
-00071a70: 556e 6963 6f64 6545 7272 6f72 3a20 2320  UnicodeError: # 
-00071a80: 5465 7874 2069 7320 6e6f 7420 7661 6c69  Text is not vali
-00071a90: 6420 6573 6361 7065 6420 556e 6963 6f64  d escaped Unicod
-00071aa0: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
-00071ab0: 2020 2020 2020 2070 6173 730d 0a20 2020         pass..   
-00071ac0: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
-00071ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00071ae0: 636f 6c5f 7661 6c75 6520 3d20 7661 6c0d  col_value = val.
-00071af0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00071b00: 2061 6363 6570 7465 6420 3d20 5472 7565   accepted = True
-00071b10: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00071b20: 2061 6363 6570 7465 643a 0d0a 2020 2020   accepted:..    
-00071b30: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00071b40: 2e53 6565 6b54 6f52 6f77 2872 6f77 290d  .SeekToRow(row).
-00071b50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00071b60: 2064 6174 6120 3d20 7365 6c66 2e72 6f77   data = self.row
-00071b70: 735f 6375 7272 656e 745b 726f 775d 0d0a  s_current[row]..
-00071b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00071b90: 6964 7820 3d20 6461 7461 5b22 5f5f 6964  idx = data["__id
-00071ba0: 5f5f 225d 0d0a 2020 2020 2020 2020 2020  __"]..          
-00071bb0: 2020 2020 2020 6966 206e 6f74 2064 6174        if not dat
-00071bc0: 615b 225f 5f6e 6577 5f5f 225d 3a0d 0a20  a["__new__"]:.. 
-00071bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00071be0: 2020 2069 6620 6964 7820 6e6f 7420 696e     if idx not in
-00071bf0: 2073 656c 662e 726f 7773 5f62 6163 6b75   self.rows_backu
-00071c00: 703a 0d0a 2020 2020 2020 2020 2020 2020  p:..            
-00071c10: 2020 2020 2020 2020 2020 2020 2320 4261              # Ba
-00071c20: 636b 7570 206f 6e6c 7920 6578 6973 7469  ckup only existi
-00071c30: 6e67 2072 6f77 732c 206e 6577 2072 6f77  ng rows, new row
-00071c40: 7320 7769 6c6c 2062 6520 6472 6f70 7065  s will be droppe
-00071c50: 640d 0a20 2020 2020 2020 2020 2020 2020  d..             
-00071c60: 2020 2020 2020 2020 2020 2023 206f 6e20             # on 
-00071c70: 726f 6c6c 6261 636b 2061 6e79 7761 792e  rollback anyway.
-00071c80: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00071c90: 2020 2020 2020 2020 2020 7365 6c66 2e72            self.r
-00071ca0: 6f77 735f 6261 636b 7570 5b69 6478 5d20  ows_backup[idx] 
-00071cb0: 3d20 6461 7461 2e63 6f70 7928 290d 0a20  = data.copy().. 
-00071cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00071cd0: 2020 2064 6174 615b 225f 5f63 6861 6e67     data["__chang
-00071ce0: 6564 5f5f 225d 203d 2054 7275 650d 0a20  ed__"] = True.. 
-00071cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00071d00: 2020 2073 656c 662e 6964 785f 6368 616e     self.idx_chan
-00071d10: 6765 642e 6164 6428 6964 7829 0d0a 2020  ged.add(idx)..  
-00071d20: 2020 2020 2020 2020 2020 2020 2020 6461                da
-00071d30: 7461 5b73 656c 662e 636f 6c75 6d6e 735b  ta[self.columns[
-00071d40: 636f 6c5d 5b22 6e61 6d65 225d 5d20 3d20  col]["name"]] = 
-00071d50: 636f 6c5f 7661 6c75 650d 0a20 2020 2020  col_value..     
-00071d60: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-00071d70: 6c66 2e56 6965 773a 2073 656c 662e 5669  lf.View: self.Vi
-00071d80: 6577 2e52 6566 7265 7368 2829 0d0a 0d0a  ew.Refresh()....
-00071d90: 0d0a 2020 2020 6465 6620 4973 4368 616e  ..    def IsChan
-00071da0: 6765 6428 7365 6c66 293a 0d0a 2020 2020  ged(self):..    
-00071db0: 2020 2020 2222 2252 6574 7572 6e73 2077      """Returns w
-00071dc0: 6865 7468 6572 2074 6865 7265 2069 7320  hether there is 
-00071dd0: 756e 636f 6d6d 6974 7465 6420 6368 616e  uncommitted chan
-00071de0: 6765 6420 6461 7461 2069 6e20 7468 6973  ged data in this
-00071df0: 2067 7269 642e 2222 220d 0a20 2020 2020   grid."""..     
-00071e00: 2020 206c 656e 6774 6873 203d 206d 6170     lengths = map
-00071e10: 286c 656e 2c20 5b73 656c 662e 6964 785f  (len, [self.idx_
-00071e20: 6368 616e 6765 642c 2073 656c 662e 6964  changed, self.id
-00071e30: 785f 6e65 772c 2073 656c 662e 726f 7773  x_new, self.rows
-00071e40: 5f64 656c 6574 6564 5d29 0d0a 2020 2020  _deleted])..    
-00071e50: 2020 2020 7265 7475 726e 2061 6e79 286c      return any(l
-00071e60: 656e 6774 6873 290d 0a0d 0a0d 0a20 2020  engths)......   
-00071e70: 2064 6566 2047 6574 4368 616e 6765 6449   def GetChangedI
-00071e80: 6e66 6f28 7365 6c66 293a 0d0a 2020 2020  nfo(self):..    
-00071e90: 2020 2020 2222 2252 6574 7572 6e73 2061      """Returns a
-00071ea0: 6e20 696e 666f 2073 7472 696e 6720 6162  n info string ab
-00071eb0: 6f75 7420 7468 6520 756e 636f 6d6d 6974  out the uncommit
-00071ec0: 6564 2063 6861 6e67 6573 2069 6e20 7468  ed changes in th
-00071ed0: 6973 2067 7269 642e 2222 220d 0a20 2020  is grid."""..   
-00071ee0: 2020 2020 2069 6e66 6f6c 6973 7420 3d20       infolist = 
-00071ef0: 5b5d 0d0a 2020 2020 2020 2020 7661 6c75  []..        valu
-00071f00: 6573 203d 207b 226e 6577 223a 206c 656e  es = {"new": len
-00071f10: 2873 656c 662e 6964 785f 6e65 7729 2c20  (self.idx_new), 
-00071f20: 2263 6861 6e67 6564 223a 206c 656e 2873  "changed": len(s
-00071f30: 656c 662e 6964 785f 6368 616e 6765 6429  elf.idx_changed)
-00071f40: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00071f50: 2020 2020 2022 6465 6c65 7465 6422 3a20       "deleted": 
-00071f60: 6c65 6e28 7365 6c66 2e72 6f77 735f 6465  len(self.rows_de
-00071f70: 6c65 7465 6429 2c20 7d0d 0a20 2020 2020  leted), }..     
-00071f80: 2020 2066 6f72 206c 6162 656c 2c20 636f     for label, co
-00071f90: 756e 7420 696e 2076 616c 7565 732e 6974  unt in values.it
-00071fa0: 656d 7328 293a 0d0a 2020 2020 2020 2020  ems():..        
-00071fb0: 2020 2020 6966 2063 6f75 6e74 3a0d 0a20      if count:.. 
-00071fc0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00071fd0: 6e66 6f6c 6973 742e 6170 7065 6e64 2822  nfolist.append("
-00071fe0: 2573 2025 7320 726f 7725 7322 0d0a 2020  %s %s row%s"..  
-00071ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00072000: 2020 2520 2863 6f75 6e74 2c20 6c61 6265    % (count, labe
-00072010: 6c2c 2022 7322 2069 6620 636f 756e 7420  l, "s" if count 
-00072020: 213d 2031 2065 6c73 6520 2222 2929 0d0a  != 1 else ""))..
-00072030: 2020 2020 2020 2020 7265 7475 726e 2022          return "
-00072040: 2c20 222e 6a6f 696e 2869 6e66 6f6c 6973  , ".join(infolis
-00072050: 7429 0d0a 0d0a 0d0a 2020 2020 6465 6620  t)......    def 
-00072060: 4765 7441 7474 7228 7365 6c66 2c20 726f  GetAttr(self, ro
-00072070: 772c 2063 6f6c 2c20 6b69 6e64 293a 0d0a  w, col, kind):..
-00072080: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
-00072090: 656c 662e 6174 7472 733a 0d0a 2020 2020  elf.attrs:..    
-000720a0: 2020 2020 2020 2020 666f 7220 6e20 696e          for n in
-000720b0: 205b 226e 6577 222c 2022 6465 6661 756c   ["new", "defaul
-000720c0: 7422 2c20 2272 6f77 5f63 6861 6e67 6564  t", "row_changed
-000720d0: 222c 2022 6365 6c6c 5f63 6861 6e67 6564  ", "cell_changed
-000720e0: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
-000720f0: 226e 6577 626c 6f62 222c 2022 6465 6661  "newblob", "defa
-00072100: 756c 7462 6c6f 6222 2c20 2272 6f77 5f63  ultblob", "row_c
-00072110: 6861 6e67 6564 626c 6f62 222c 2022 6365  hangedblob", "ce
-00072120: 6c6c 5f63 6861 6e67 6564 626c 6f62 225d  ll_changedblob"]
-00072130: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00072140: 2020 2073 656c 662e 6174 7472 735b 6e5d     self.attrs[n]
-00072150: 203d 2077 782e 6772 6964 2e47 7269 6443   = wx.grid.GridC
-00072160: 656c 6c41 7474 7228 290d 0a20 2020 2020  ellAttr()..     
-00072170: 2020 2020 2020 2066 6f72 206e 2069 6e20         for n in 
-00072180: 5b22 6e65 7722 2c20 226e 6577 626c 6f62  ["new", "newblob
-00072190: 225d 3a0d 0a20 2020 2020 2020 2020 2020  "]:..           
-000721a0: 2020 2020 2073 656c 662e 6174 7472 735b       self.attrs[
-000721b0: 6e5d 2e53 6574 4261 636b 6772 6f75 6e64  n].SetBackground
-000721c0: 436f 6c6f 7572 2863 6f6e 662e 4772 6964  Colour(conf.Grid
-000721d0: 526f 7749 6e73 6572 7465 6443 6f6c 6f75  RowInsertedColou
-000721e0: 7229 0d0a 2020 2020 2020 2020 2020 2020  r)..            
-000721f0: 666f 7220 6e20 696e 205b 2272 6f77 5f63  for n in ["row_c
-00072200: 6861 6e67 6564 222c 2022 726f 775f 6368  hanged", "row_ch
-00072210: 616e 6765 6462 6c6f 6222 5d3a 0d0a 2020  angedblob"]:..  
-00072220: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00072230: 6c66 2e61 7474 7273 5b6e 5d2e 5365 7442  lf.attrs[n].SetB
-00072240: 6163 6b67 726f 756e 6443 6f6c 6f75 7228  ackgroundColour(
-00072250: 636f 6e66 2e47 7269 6452 6f77 4368 616e  conf.GridRowChan
-00072260: 6765 6443 6f6c 6f75 7229 0d0a 2020 2020  gedColour)..    
-00072270: 2020 2020 2020 2020 666f 7220 6e20 696e          for n in
-00072280: 205b 2263 656c 6c5f 6368 616e 6765 6422   ["cell_changed"
-00072290: 2c20 2263 656c 6c5f 6368 616e 6765 6462  , "cell_changedb
-000722a0: 6c6f 6222 5d3a 0d0a 2020 2020 2020 2020  lob"]:..        
-000722b0: 2020 2020 2020 2020 7365 6c66 2e61 7474          self.att
-000722c0: 7273 5b6e 5d2e 5365 7442 6163 6b67 726f  rs[n].SetBackgro
-000722d0: 756e 6443 6f6c 6f75 7228 636f 6e66 2e47  undColour(conf.G
-000722e0: 7269 6443 656c 6c43 6861 6e67 6564 436f  ridCellChangedCo
-000722f0: 6c6f 7572 290d 0a20 2020 2020 2020 2020  lour)..         
-00072300: 2020 2066 6f72 206e 2069 6e20 5b22 6e65     for n in ["ne
-00072310: 7762 6c6f 6222 2c20 2264 6566 6175 6c74  wblob", "default
-00072320: 626c 6f62 222c 0d0a 2020 2020 2020 2020  blob",..        
-00072330: 2020 2020 2272 6f77 5f63 6861 6e67 6564      "row_changed
-00072340: 626c 6f62 222c 2022 6365 6c6c 5f63 6861  blob", "cell_cha
-00072350: 6e67 6564 626c 6f62 225d 3a0d 0a20 2020  ngedblob"]:..   
-00072360: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00072370: 662e 6174 7472 735b 6e5d 2e53 6574 4564  f.attrs[n].SetEd
-00072380: 6974 6f72 2877 782e 6772 6964 2e47 7269  itor(wx.grid.Gri
-00072390: 6443 656c 6c41 7574 6f57 7261 7053 7472  dCellAutoWrapStr
-000723a0: 696e 6745 6469 746f 7228 2929 0d0a 2020  ingEditor())..  
-000723b0: 2020 2020 2020 2320 5361 6e69 7479 2063        # Sanity c
-000723c0: 6865 636b 2c20 5549 2063 6f6e 7472 6f6c  heck, UI control
-000723d0: 7320 6361 6e20 7374 696c 6c20 6265 2072  s can still be r
-000723e0: 6566 6572 7269 6e67 2074 6f20 6120 7072  eferring to a pr
-000723f0: 6576 696f 7573 2074 6162 6c65 0d0a 2020  evious table..  
-00072400: 2020 2020 2020 636f 6c20 3d20 6d69 6e28        col = min(
-00072410: 636f 6c2c 206c 656e 2873 656c 662e 636f  col, len(self.co
-00072420: 6c75 6d6e 7329 202d 2031 290d 0a0d 0a20  lumns) - 1).... 
-00072430: 2020 2020 2020 2062 6c6f 6220 3d20 2262         blob = "b
-00072440: 6c6f 6222 2069 6620 2873 656c 662e 636f  lob" if (self.co
-00072450: 6c75 6d6e 735b 636f 6c5d 5b22 7479 7065  lumns[col]["type
-00072460: 225d 2e6c 6f77 6572 2829 203d 3d20 2262  "].lower() == "b
-00072470: 6c6f 6222 2920 656c 7365 2022 220d 0a20  lob") else "".. 
-00072480: 2020 2020 2020 2061 7474 7220 3d20 7365         attr = se
-00072490: 6c66 2e61 7474 7273 5b22 6465 6661 756c  lf.attrs["defaul
-000724a0: 7425 7322 2025 2062 6c6f 625d 0d0a 2020  t%s" % blob]..  
-000724b0: 2020 2020 2020 6966 2072 6f77 203c 206c        if row < l
-000724c0: 656e 2873 656c 662e 726f 7773 5f63 7572  en(self.rows_cur
-000724d0: 7265 6e74 293a 0d0a 2020 2020 2020 2020  rent):..        
-000724e0: 2020 2020 6966 2073 656c 662e 726f 7773      if self.rows
-000724f0: 5f63 7572 7265 6e74 5b72 6f77 5d5b 225f  _current[row]["_
-00072500: 5f63 6861 6e67 6564 5f5f 225d 3a0d 0a20  _changed__"]:.. 
-00072510: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00072520: 6478 203d 2073 656c 662e 726f 7773 5f63  dx = self.rows_c
-00072530: 7572 7265 6e74 5b72 6f77 5d5b 225f 5f69  urrent[row]["__i
-00072540: 645f 5f22 5d0d 0a20 2020 2020 2020 2020  d__"]..         
-00072550: 2020 2020 2020 2076 616c 7565 203d 2073         value = s
-00072560: 656c 662e 726f 7773 5f63 7572 7265 6e74  elf.rows_current
-00072570: 5b72 6f77 5d5b 7365 6c66 2e63 6f6c 756d  [row][self.colum
-00072580: 6e73 5b63 6f6c 5d5b 226e 616d 6522 5d5d  ns[col]["name"]]
-00072590: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000725a0: 2020 6261 636b 7570 203d 2073 656c 662e    backup = self.
-000725b0: 726f 7773 5f62 6163 6b75 705b 6964 785d  rows_backup[idx]
-000725c0: 5b73 656c 662e 636f 6c75 6d6e 735b 636f  [self.columns[co
-000725d0: 6c5d 5b22 6e61 6d65 225d 5d0d 0a20 2020  l]["name"]]..   
-000725e0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000725f0: 6261 636b 7570 2021 3d20 7661 6c75 653a  backup != value:
-00072600: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00072610: 2020 2020 2020 6174 7472 203d 2073 656c        attr = sel
-00072620: 662e 6174 7472 735b 2263 656c 6c5f 6368  f.attrs["cell_ch
-00072630: 616e 6765 6425 7322 2025 2062 6c6f 625d  anged%s" % blob]
-00072640: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00072650: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-00072660: 2020 2020 2020 2020 2020 2020 2061 7474               att
-00072670: 7220 3d20 7365 6c66 2e61 7474 7273 5b22  r = self.attrs["
-00072680: 726f 775f 6368 616e 6765 6425 7322 2025  row_changed%s" %
-00072690: 2062 6c6f 625d 0d0a 2020 2020 2020 2020   blob]..        
-000726a0: 2020 2020 656c 6966 2073 656c 662e 726f      elif self.ro
-000726b0: 7773 5f63 7572 7265 6e74 5b72 6f77 5d5b  ws_current[row][
-000726c0: 225f 5f6e 6577 5f5f 225d 3a0d 0a20 2020  "__new__"]:..   
-000726d0: 2020 2020 2020 2020 2020 2020 2061 7474               att
-000726e0: 7220 3d20 7365 6c66 2e61 7474 7273 5b22  r = self.attrs["
-000726f0: 6e65 7725 7322 2025 2062 6c6f 625d 0d0a  new%s" % blob]..
-00072700: 2020 2020 2020 2020 6174 7472 2e49 6e63          attr.Inc
-00072710: 5265 6628 290d 0a20 2020 2020 2020 2072  Ref()..        r
-00072720: 6574 7572 6e20 6174 7472 0d0a 0d0a 0d0a  eturn attr......
-00072730: 2020 2020 6465 6620 496e 7365 7274 526f      def InsertRo
-00072740: 7773 2873 656c 662c 2072 6f77 2c20 6e75  ws(self, row, nu
-00072750: 6d52 6f77 7329 3a0d 0a20 2020 2020 2020  mRows):..       
-00072760: 2022 2222 496e 7365 7274 7320 6e65 772c   """Inserts new,
-00072770: 2075 6e73 6176 6564 2072 6f77 7320 6174   unsaved rows at
-00072780: 2070 6f73 6974 696f 6e20 3020 2872 6f77   position 0 (row
-00072790: 2069 7320 6967 6e6f 7265 6429 2e22 2222   is ignored)."""
-000727a0: 0d0a 2020 2020 2020 2020 726f 7773 5f62  ..        rows_b
-000727b0: 6566 6f72 6520 3d20 6c65 6e28 7365 6c66  efore = len(self
-000727c0: 2e72 6f77 735f 6375 7272 656e 7429 0d0a  .rows_current)..
-000727d0: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
-000727e0: 2072 616e 6765 286e 756d 526f 7773 293a   range(numRows):
-000727f0: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-00072800: 436f 6e73 7472 7563 7420 656d 7074 7920  Construct empty 
-00072810: 6469 6374 2066 726f 6d20 636f 6c75 6d6e  dict from column
-00072820: 206e 616d 6573 0d0a 2020 2020 2020 2020   names..        
-00072830: 2020 2020 726f 7764 6174 6120 3d20 6469      rowdata = di
-00072840: 6374 2828 636f 6c5b 226e 616d 6522 5d2c  ct((col["name"],
-00072850: 204e 6f6e 6529 2066 6f72 2063 6f6c 2069   None) for col i
-00072860: 6e20 7365 6c66 2e63 6f6c 756d 6e73 290d  n self.columns).
-00072870: 0a20 2020 2020 2020 2020 2020 2069 6478  .            idx
-00072880: 203d 2069 6428 726f 7764 6174 6129 0d0a   = id(rowdata)..
-00072890: 2020 2020 2020 2020 2020 2020 726f 7764              rowd
-000728a0: 6174 615b 225f 5f69 645f 5f22 5d20 3d20  ata["__id__"] = 
-000728b0: 6964 780d 0a20 2020 2020 2020 2020 2020  idx..           
-000728c0: 2072 6f77 6461 7461 5b22 5f5f 6368 616e   rowdata["__chan
-000728d0: 6765 645f 5f22 5d20 3d20 4661 6c73 650d  ged__"] = False.
-000728e0: 0a20 2020 2020 2020 2020 2020 2072 6f77  .            row
-000728f0: 6461 7461 5b22 5f5f 6e65 775f 5f22 5d20  data["__new__"] 
-00072900: 3d20 5472 7565 0d0a 2020 2020 2020 2020  = True..        
-00072910: 2020 2020 726f 7764 6174 615b 225f 5f64      rowdata["__d
-00072920: 656c 6574 6564 5f5f 225d 203d 2046 616c  eleted__"] = Fal
-00072930: 7365 0d0a 2020 2020 2020 2020 2020 2020  se..            
-00072940: 2320 496e 7365 7274 2072 6f77 7320 6174  # Insert rows at
-00072950: 2074 6865 2062 6567 696e 6e69 6e67 2c20   the beginning, 
-00072960: 736f 2074 6861 7420 7468 6579 2063 616e  so that they can
-00072970: 2062 6520 6564 6974 6564 0d0a 2020 2020   be edited..    
-00072980: 2020 2020 2020 2020 2320 696d 6d65 6469          # immedi
-00072990: 6174 656c 792c 206f 7468 6572 7769 7365  ately, otherwise
-000729a0: 2077 6f75 6c64 206e 6565 6420 746f 2072   would need to r
-000729b0: 6574 7269 6576 6520 616c 6c20 726f 7773  etrieve all rows
-000729c0: 2066 6972 7374 2e0d 0a20 2020 2020 2020   first...       
-000729d0: 2020 2020 2073 656c 662e 6964 785f 616c       self.idx_al
-000729e0: 6c2e 696e 7365 7274 2830 2c20 6964 7829  l.insert(0, idx)
-000729f0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00072a00: 6c66 2e72 6f77 735f 6375 7272 656e 742e  lf.rows_current.
-00072a10: 696e 7365 7274 2830 2c20 726f 7764 6174  insert(0, rowdat
-00072a20: 6129 0d0a 2020 2020 2020 2020 2020 2020  a)..            
-00072a30: 7365 6c66 2e72 6f77 735f 616c 6c5b 6964  self.rows_all[id
-00072a40: 785d 203d 2072 6f77 6461 7461 0d0a 2020  x] = rowdata..  
-00072a50: 2020 2020 2020 2020 2020 7365 6c66 2e69            self.i
-00072a60: 6478 5f6e 6577 2e61 7070 656e 6428 6964  dx_new.append(id
-00072a70: 7829 0d0a 2020 2020 2020 2020 7365 6c66  x)..        self
-00072a80: 2e72 6f77 5f63 6f75 6e74 202b 3d20 6e75  .row_count += nu
-00072a90: 6d52 6f77 730d 0a20 2020 2020 2020 2073  mRows..        s
-00072aa0: 656c 662e 4e6f 7469 6679 5669 6577 4368  elf.NotifyViewCh
-00072ab0: 616e 6765 2872 6f77 735f 6265 666f 7265  ange(rows_before
-00072ac0: 290d 0a20 2020 2020 2020 2072 6574 7572  )..        retur
-00072ad0: 6e20 5472 7565 0d0a 0d0a 0d0a 2020 2020  n True......    
-00072ae0: 6465 6620 4465 6c65 7465 526f 7773 2873  def DeleteRows(s
-00072af0: 656c 662c 2072 6f77 2c20 6e75 6d52 6f77  elf, row, numRow
-00072b00: 7329 3a0d 0a20 2020 2020 2020 2022 2222  s):..        """
-00072b10: 4465 6c65 7465 7320 726f 7773 2066 726f  Deletes rows fro
-00072b20: 6d20 6120 7370 6563 6966 6965 6420 706f  m a specified po
-00072b30: 7369 7469 6f6e 2e22 2222 0d0a 2020 2020  sition."""..    
-00072b40: 2020 2020 6966 2072 6f77 202b 206e 756d      if row + num
-00072b50: 526f 7773 202d 2031 203c 2073 656c 662e  Rows - 1 < self.
-00072b60: 726f 775f 636f 756e 743a 0d0a 2020 2020  row_count:..    
-00072b70: 2020 2020 2020 2020 7365 6c66 2e53 6565          self.See
-00072b80: 6b54 6f52 6f77 2872 6f77 202b 206e 756d  kToRow(row + num
-00072b90: 526f 7773 202d 2031 290d 0a20 2020 2020  Rows - 1)..     
-00072ba0: 2020 2020 2020 2072 6f77 735f 6265 666f         rows_befo
-00072bb0: 7265 203d 206c 656e 2873 656c 662e 726f  re = len(self.ro
-00072bc0: 7773 5f63 7572 7265 6e74 290d 0a20 2020  ws_current)..   
-00072bd0: 2020 2020 2020 2020 2066 6f72 2069 2069           for i i
-00072be0: 6e20 7261 6e67 6528 6e75 6d52 6f77 7329  n range(numRows)
-00072bf0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00072c00: 2020 2064 6174 6120 3d20 7365 6c66 2e72     data = self.r
-00072c10: 6f77 735f 6375 7272 656e 745b 726f 775d  ows_current[row]
-00072c20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00072c30: 2020 6964 7820 3d20 6461 7461 5b22 5f5f    idx = data["__
-00072c40: 6964 5f5f 225d 0d0a 2020 2020 2020 2020  id__"]..        
-00072c50: 2020 2020 2020 2020 6465 6c20 7365 6c66          del self
-00072c60: 2e72 6f77 735f 6375 7272 656e 745b 726f  .rows_current[ro
-00072c70: 775d 0d0a 2020 2020 2020 2020 2020 2020  w]..            
-00072c80: 2020 2020 6966 2069 6478 2069 6e20 7365      if idx in se
-00072c90: 6c66 2e72 6f77 735f 6261 636b 7570 3a0d  lf.rows_backup:.
-00072ca0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00072cb0: 2020 2020 2023 2049 6620 726f 7720 7761       # If row wa
-00072cc0: 7320 6368 616e 6765 642c 2073 7769 7463  s changed, switc
-00072cd0: 6820 746f 2069 7473 2062 6163 6b75 7020  h to its backup 
-00072ce0: 6461 7461 0d0a 2020 2020 2020 2020 2020  data..          
-00072cf0: 2020 2020 2020 2020 2020 6461 7461 203d            data =
-00072d00: 2073 656c 662e 726f 7773 5f62 6163 6b75   self.rows_backu
-00072d10: 705b 6964 785d 0d0a 2020 2020 2020 2020  p[idx]..        
-00072d20: 2020 2020 2020 2020 2020 2020 6465 6c20              del 
-00072d30: 7365 6c66 2e72 6f77 735f 6261 636b 7570  self.rows_backup
-00072d40: 5b69 6478 5d0d 0a20 2020 2020 2020 2020  [idx]..         
-00072d50: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00072d60: 6964 785f 6368 616e 6765 642e 7265 6d6f  idx_changed.remo
-00072d70: 7665 2869 6478 290d 0a20 2020 2020 2020  ve(idx)..       
-00072d80: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-00072d90: 6461 7461 5b22 5f5f 6e65 775f 5f22 5d3a  data["__new__"]:
-00072da0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00072db0: 2020 2020 2020 2320 4472 6f70 206e 6577        # Drop new
-00072dc0: 2072 6f77 7320 6f6e 2064 656c 6574 652c   rows on delete,
-00072dd0: 2072 6f6c 6c62 6163 6b20 6361 6e27 7420   rollback can't 
-00072de0: 7265 7374 6f72 6520 7468 656d 2e0d 0a20  restore them... 
-00072df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00072e00: 2020 2064 6174 615b 225f 5f63 6861 6e67     data["__chang
-00072e10: 6564 5f5f 225d 203d 2046 616c 7365 0d0a  ed__"] = False..
-00072e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00072e30: 2020 2020 6461 7461 5b22 5f5f 6465 6c65      data["__dele
-00072e40: 7465 645f 5f22 5d20 3d20 5472 7565 0d0a  ted__"] = True..
-00072e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00072e60: 2020 2020 7365 6c66 2e72 6f77 735f 6465      self.rows_de
-00072e70: 6c65 7465 645b 6964 785d 203d 2064 6174  leted[idx] = dat
-00072e80: 610d 0a20 2020 2020 2020 2020 2020 2020  a..             
-00072e90: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-00072ea0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00072eb0: 6c66 2e69 6478 5f6e 6577 2e72 656d 6f76  lf.idx_new.remov
-00072ec0: 6528 6964 7829 0d0a 2020 2020 2020 2020  e(idx)..        
-00072ed0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00072ee0: 2e69 6478 5f61 6c6c 2e72 656d 6f76 6528  .idx_all.remove(
-00072ef0: 6964 7829 0d0a 2020 2020 2020 2020 2020  idx)..          
-00072f00: 2020 2020 2020 2020 2020 6465 6c20 7365            del se
-00072f10: 6c66 2e72 6f77 735f 616c 6c5b 6964 785d  lf.rows_all[idx]
-00072f20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00072f30: 2020 7365 6c66 2e72 6f77 5f63 6f75 6e74    self.row_count
-00072f40: 202d 3d20 6e75 6d52 6f77 730d 0a20 2020   -= numRows..   
-00072f50: 2020 2020 2020 2020 2073 656c 662e 4e6f           self.No
-00072f60: 7469 6679 5669 6577 4368 616e 6765 2872  tifyViewChange(r
-00072f70: 6f77 735f 6265 666f 7265 290d 0a20 2020  ows_before)..   
-00072f80: 2020 2020 2072 6574 7572 6e20 5472 7565       return True
-00072f90: 0d0a 0d0a 0d0a 2020 2020 6465 6620 4e6f  ......    def No
-00072fa0: 7469 6679 5669 6577 4368 616e 6765 2873  tifyViewChange(s
-00072fb0: 656c 662c 2072 6f77 735f 6265 666f 7265  elf, rows_before
-00072fc0: 293a 0d0a 2020 2020 2020 2020 2222 220d  ):..        """.
-00072fd0: 0a20 2020 2020 2020 204e 6f74 6966 6965  .        Notifie
-00072fe0: 7320 7468 6520 6772 6964 2076 6965 7720  s the grid view 
-00072ff0: 6f66 2061 2063 6861 6e67 6520 696e 2074  of a change in t
-00073000: 6865 2075 6e64 6572 6c79 696e 6720 6772  he underlying gr
-00073010: 6964 2074 6162 6c65 2069 660d 0a20 2020  id table if..   
-00073020: 2020 2020 2063 7572 7265 6e74 2072 6f77       current row
-00073030: 2063 6f75 6e74 2069 7320 6469 6666 6572   count is differ
-00073040: 656e 742e 0d0a 2020 2020 2020 2020 2222  ent...        ""
-00073050: 220d 0a20 2020 2020 2020 2069 6620 7365  "..        if se
-00073060: 6c66 2e56 6965 773a 0d0a 2020 2020 2020  lf.View:..      
-00073070: 2020 2020 2020 6172 6773 203d 204e 6f6e        args = Non
-00073080: 650d 0a20 2020 2020 2020 2020 2020 2072  e..            r
-00073090: 6f77 735f 6e6f 7720 3d20 6c65 6e28 7365  ows_now = len(se
-000730a0: 6c66 2e72 6f77 735f 6375 7272 656e 7429  lf.rows_current)
-000730b0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-000730c0: 2072 6f77 735f 6e6f 7720 3c20 726f 7773   rows_now < rows
-000730d0: 5f62 6566 6f72 653a 0d0a 2020 2020 2020  _before:..      
-000730e0: 2020 2020 2020 2020 2020 6172 6773 203d            args =
-000730f0: 205b 7365 6c66 2c20 7778 2e67 7269 642e   [self, wx.grid.
-00073100: 4752 4944 5441 424c 455f 4e4f 5449 4659  GRIDTABLE_NOTIFY
-00073110: 5f52 4f57 535f 4445 4c45 5445 442c 0d0a  _ROWS_DELETED,..
-00073120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00073130: 2020 2020 2020 2020 726f 7773 5f6e 6f77          rows_now
-00073140: 2c20 726f 7773 5f62 6566 6f72 6520 2d20  , rows_before - 
-00073150: 726f 7773 5f6e 6f77 5d0d 0a20 2020 2020  rows_now]..     
-00073160: 2020 2020 2020 2065 6c69 6620 726f 7773         elif rows
-00073170: 5f6e 6f77 203e 2072 6f77 735f 6265 666f  _now > rows_befo
-00073180: 7265 3a0d 0a20 2020 2020 2020 2020 2020  re:..           
-00073190: 2020 2020 2061 7267 7320 3d20 5b73 656c       args = [sel
-000731a0: 662c 2077 782e 6772 6964 2e47 5249 4454  f, wx.grid.GRIDT
-000731b0: 4142 4c45 5f4e 4f54 4946 595f 524f 5753  ABLE_NOTIFY_ROWS
-000731c0: 5f41 5050 454e 4445 442c 0d0a 2020 2020  _APPENDED,..    
-000731d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000731e0: 2020 2020 726f 7773 5f6e 6f77 202d 2072      rows_now - r
-000731f0: 6f77 735f 6265 666f 7265 5d0d 0a20 2020  ows_before]..   
-00073200: 2020 2020 2020 2020 2069 6620 6172 6773           if args
-00073210: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00073220: 2020 2073 656c 662e 5669 6577 2e50 726f     self.View.Pro
-00073230: 6365 7373 5461 626c 654d 6573 7361 6765  cessTableMessage
-00073240: 2877 782e 6772 6964 2e47 7269 6454 6162  (wx.grid.GridTab
-00073250: 6c65 4d65 7373 6167 6528 2a61 7267 7329  leMessage(*args)
-00073260: 290d 0a0d 0a0d 0a0d 0a20 2020 2064 6566  )........    def
-00073270: 2041 6464 4669 6c74 6572 2873 656c 662c   AddFilter(self,
-00073280: 2063 6f6c 2c20 7661 6c29 3a0d 0a20 2020   col, val):..   
-00073290: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-000732a0: 2020 4164 6473 2061 2066 696c 7465 7220    Adds a filter 
-000732b0: 746f 2074 6865 2067 7269 6420 6461 7461  to the grid data
-000732c0: 206f 6e20 7468 6520 7370 6563 6966 6965   on the specifie
-000732d0: 6420 636f 6c75 6d6e 2e20 4967 6e6f 7265  d column. Ignore
-000732e0: 7320 7468 650d 0a20 2020 2020 2020 2076  s the..        v
-000732f0: 616c 7565 2069 6620 696e 7661 6c69 6420  alue if invalid 
-00073300: 666f 7220 7468 6520 636f 6c75 6d6e 2028  for the column (
-00073310: 652e 672e 2061 2073 7472 696e 6720 666f  e.g. a string fo
-00073320: 7220 616e 2069 6e74 6567 6572 2063 6f6c  r an integer col
-00073330: 756d 6e29 2e0d 0a0d 0a20 2020 2020 2020  umn).....       
-00073340: 2040 7061 7261 6d20 2020 636f 6c20 2020   @param   col   
-00073350: 636f 6c75 6d6e 2069 6e64 6578 0d0a 2020  column index..  
-00073360: 2020 2020 2020 4070 6172 616d 2020 2076        @param   v
-00073370: 616c 2020 2061 2073 696d 706c 6520 7661  al   a simple va
-00073380: 6c75 6520 666f 7220 6669 6c74 6572 696e  lue for filterin
-00073390: 672e 2046 6f72 206e 756d 6572 6963 2063  g. For numeric c
-000733a0: 6f6c 756d 6e73 2c20 7468 650d 0a20 2020  olumns, the..   
-000733b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000733c0: 2020 2020 7661 6c75 6520 6973 206d 6174      value is mat
-000733d0: 6368 6564 2065 7861 6374 6c79 2c20 616e  ched exactly, an
-000733e0: 6420 666f 7220 7465 7874 2063 6f6c 756d  d for text colum
-000733f0: 6e73 2c0d 0a20 2020 2020 2020 2020 2020  ns,..           
-00073400: 2020 2020 2020 2020 2020 2020 6d61 7463              matc
-00073410: 6865 6420 6279 2073 7562 7374 7269 6e67  hed by substring
-00073420: 2e0d 0a20 2020 2020 2020 2022 2222 0d0a  ...        """..
-00073430: 2020 2020 2020 2020 6163 6365 7074 6564          accepted
-00073440: 5f76 616c 7565 203d 204e 6f6e 650d 0a20  _value = None.. 
-00073450: 2020 2020 2020 2069 6620 2249 4e54 4547         if "INTEG
-00073460: 4552 2220 3d3d 2073 656c 662e 636f 6c75  ER" == self.colu
-00073470: 6d6e 735b 636f 6c5d 5b22 7479 7065 225d  mns[col]["type"]
-00073480: 3a0d 0a20 2020 2020 2020 2020 2020 2074  :..            t
-00073490: 7279 3a0d 0a20 2020 2020 2020 2020 2020  ry:..           
-000734a0: 2020 2020 2023 2041 6c6c 6f77 2075 7365       # Allow use
-000734b0: 7220 746f 2065 6e74 6572 2061 2063 6f6d  r to enter a com
-000734c0: 6d61 2066 6f72 2064 6563 696d 616c 2073  ma for decimal s
-000734d0: 6570 6172 6174 6f72 2e0d 0a20 2020 2020  eparator...     
-000734e0: 2020 2020 2020 2020 2020 2061 6363 6570             accep
-000734f0: 7465 645f 7661 6c75 6520 3d20 666c 6f61  ted_value = floa
-00073500: 7428 7661 6c2e 7265 706c 6163 6528 222c  t(val.replace(",
-00073510: 222c 2022 2e22 2929 205c 0d0a 2020 2020  ", ".")) \..    
-00073520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00073530: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00073540: 2822 2e22 2069 6e20 7661 6c20 6f72 2022  ("." in val or "
-00073550: 2c22 2069 6e20 7661 6c29 205c 0d0a 2020  ," in val) \..  
-00073560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00073570: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00073580: 6c73 6520 696e 7428 7661 6c29 0d0a 2020  lse int(val)..  
-00073590: 2020 2020 2020 2020 2020 6578 6365 7074            except
-000735a0: 2056 616c 7565 4572 726f 723a 0d0a 2020   ValueError:..  
-000735b0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-000735c0: 7373 0d0a 2020 2020 2020 2020 656c 7365  ss..        else
-000735d0: 3a0d 0a20 2020 2020 2020 2020 2020 2061  :..            a
-000735e0: 6363 6570 7465 645f 7661 6c75 6520 3d20  ccepted_value = 
-000735f0: 7661 6c0d 0a20 2020 2020 2020 2069 6620  val..        if 
-00073600: 6163 6365 7074 6564 5f76 616c 7565 2069  accepted_value i
-00073610: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
-00073620: 2020 2020 2020 2020 2073 656c 662e 6669           self.fi
-00073630: 6c74 6572 735b 636f 6c5d 203d 2061 6363  lters[col] = acc
-00073640: 6570 7465 645f 7661 6c75 650d 0a20 2020  epted_value..   
-00073650: 2020 2020 2020 2020 2073 656c 662e 4669           self.Fi
-00073660: 6c74 6572 2829 0d0a 0d0a 0d0a 2020 2020  lter()......    
-00073670: 6465 6620 5265 6d6f 7665 4669 6c74 6572  def RemoveFilter
-00073680: 2873 656c 662c 2063 6f6c 293a 0d0a 2020  (self, col):..  
-00073690: 2020 2020 2020 2222 2252 656d 6f76 6573        """Removes
-000736a0: 2066 696c 7465 7220 6f6e 2074 6865 2073   filter on the s
-000736b0: 7065 6369 6669 6564 2063 6f6c 756d 6e2c  pecified column,
-000736c0: 2069 6620 616e 792e 2222 220d 0a20 2020   if any."""..   
-000736d0: 2020 2020 2069 6620 636f 6c20 696e 2073       if col in s
-000736e0: 656c 662e 6669 6c74 6572 733a 0d0a 2020  elf.filters:..  
-000736f0: 2020 2020 2020 2020 2020 6465 6c20 7365            del se
-00073700: 6c66 2e66 696c 7465 7273 5b63 6f6c 5d0d  lf.filters[col].
-00073710: 0a20 2020 2020 2020 2073 656c 662e 4669  .        self.Fi
-00073720: 6c74 6572 2829 0d0a 0d0a 0d0a 2020 2020  lter()......    
-00073730: 6465 6620 436c 6561 7246 696c 7465 7228  def ClearFilter(
-00073740: 7365 6c66 2c20 7265 6672 6573 683d 5472  self, refresh=Tr
-00073750: 7565 293a 0d0a 2020 2020 2020 2020 2222  ue):..        ""
-00073760: 2243 6c65 6172 7320 616c 6c20 6164 6465  "Clears all adde
-00073770: 6420 6669 6c74 6572 732e 2222 220d 0a20  d filters.""".. 
-00073780: 2020 2020 2020 2073 656c 662e 6669 6c74         self.filt
-00073790: 6572 732e 636c 6561 7228 290d 0a20 2020  ers.clear()..   
-000737a0: 2020 2020 2069 6620 7265 6672 6573 683a       if refresh:
-000737b0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-000737c0: 6c66 2e46 696c 7465 7228 290d 0a0d 0a0d  lf.Filter().....
-000737d0: 0a20 2020 2064 6566 2043 6c65 6172 536f  .    def ClearSo
-000737e0: 7274 2873 656c 662c 2072 6566 7265 7368  rt(self, refresh
-000737f0: 3d54 7275 6529 3a0d 0a20 2020 2020 2020  =True):..       
-00073800: 2022 2222 436c 6561 7273 2063 7572 7265   """Clears curre
-00073810: 6e74 2073 6f72 742e 2222 220d 0a20 2020  nt sort."""..   
-00073820: 2020 2020 2073 656c 662e 736f 7274 5f63       self.sort_c
-00073830: 6f6c 756d 6e20 3d20 4e6f 6e65 0d0a 2020  olumn = None..  
-00073840: 2020 2020 2020 6966 2072 6566 7265 7368        if refresh
-00073850: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
-00073860: 656c 662e 726f 7773 5f63 7572 7265 6e74  elf.rows_current
-00073870: 5b3a 5d2e 736f 7274 280d 0a20 2020 2020  [:].sort(..     
-00073880: 2020 2020 2020 2020 2020 206b 6579 3d6c             key=l
-00073890: 616d 6264 6120 783a 2073 656c 662e 6964  ambda x: self.id
-000738a0: 785f 616c 6c2e 696e 6465 7828 785b 225f  x_all.index(x["_
-000738b0: 5f69 645f 5f22 5d29 0d0a 2020 2020 2020  _id__"])..      
-000738c0: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
-000738d0: 2020 2020 2069 6620 7365 6c66 2e56 6965       if self.Vie
-000738e0: 773a 0d0a 2020 2020 2020 2020 2020 2020  w:..            
-000738f0: 2020 2020 7365 6c66 2e56 6965 772e 466f      self.View.Fo
-00073900: 7263 6552 6566 7265 7368 2829 0d0a 0d0a  rceRefresh()....
-00073910: 0d0a 2020 2020 6465 6620 436c 6561 7241  ..    def ClearA
-00073920: 7474 7273 2873 656c 6629 3a0d 0a20 2020  ttrs(self):..   
-00073930: 2020 2020 2022 2222 436c 6561 7273 2061       """Clears a
-00073940: 6c6c 2063 7572 7265 6e74 2072 6f77 2061  ll current row a
-00073950: 7474 7269 6275 7465 7320 616e 6420 7265  ttributes and re
-00073960: 6672 6573 6865 7320 6772 6964 2e22 2222  freshes grid."""
-00073970: 0d0a 2020 2020 2020 2020 7365 6c66 2e61  ..        self.a
-00073980: 7474 7273 2e63 6c65 6172 2829 0d0a 2020  ttrs.clear()..  
-00073990: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
-000739a0: 662e 5669 6577 3a20 7265 7475 726e 0d0a  f.View: return..
-000739b0: 2020 2020 2020 2020 666f 7220 726f 7720          for row 
-000739c0: 696e 2072 616e 6765 286c 656e 2873 656c  in range(len(sel
-000739d0: 662e 726f 7773 5f63 7572 7265 6e74 2929  f.rows_current))
-000739e0: 3a0d 0a20 2020 2020 2020 2020 2020 2066  :..            f
-000739f0: 6f72 2063 6f6c 2069 6e20 7261 6e67 6528  or col in range(
-00073a00: 6c65 6e28 7365 6c66 2e63 6f6c 756d 6e73  len(self.columns
-00073a10: 2929 3a20 7365 6c66 2e56 6965 772e 5265  )): self.View.Re
-00073a20: 6672 6573 6841 7474 7228 726f 772c 2063  freshAttr(row, c
-00073a30: 6f6c 290d 0a20 2020 2020 2020 2073 656c  ol)..        sel
-00073a40: 662e 5669 6577 2e52 6566 7265 7368 2829  f.View.Refresh()
-00073a50: 0d0a 0d0a 0d0a 2020 2020 6465 6620 4669  ......    def Fi
-00073a60: 6c74 6572 2873 656c 6629 3a0d 0a20 2020  lter(self):..   
-00073a70: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-00073a80: 2020 4669 6c74 6572 7320 7468 6520 6772    Filters the gr
-00073a90: 6964 2074 6162 6c65 2077 6974 6820 7468  id table with th
-00073aa0: 6520 6375 7272 656e 746c 7920 6164 6465  e currently adde
-00073ab0: 6420 6669 6c74 6572 732e 0d0a 2020 2020  d filters...    
-00073ac0: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
-00073ad0: 2073 656c 662e 5365 656b 546f 526f 7728   self.SeekToRow(
-00073ae0: 7365 6c66 2e72 6f77 5f63 6f75 6e74 202d  self.row_count -
-00073af0: 2031 290d 0a20 2020 2020 2020 2072 6f77   1)..        row
-00073b00: 735f 6265 666f 7265 203d 206c 656e 2873  s_before = len(s
-00073b10: 656c 662e 726f 7773 5f63 7572 7265 6e74  elf.rows_current
-00073b20: 290d 0a20 2020 2020 2020 2064 656c 2073  )..        del s
-00073b30: 656c 662e 726f 7773 5f63 7572 7265 6e74  elf.rows_current
-00073b40: 5b3a 5d0d 0a20 2020 2020 2020 2066 6f72  [:]..        for
-00073b50: 2069 6478 2069 6e20 7365 6c66 2e69 6478   idx in self.idx
-00073b60: 5f61 6c6c 3a0d 0a20 2020 2020 2020 2020  _all:..         
-00073b70: 2020 2072 6f77 203d 2073 656c 662e 726f     row = self.ro
-00073b80: 7773 5f61 6c6c 5b69 6478 5d0d 0a20 2020  ws_all[idx]..   
-00073b90: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-00073ba0: 726f 775b 225f 5f64 656c 6574 6564 5f5f  row["__deleted__
-00073bb0: 225d 2061 6e64 2073 656c 662e 5f69 735f  "] and self._is_
-00073bc0: 726f 775f 756e 6669 6c74 6572 6564 2872  row_unfiltered(r
-00073bd0: 6f77 293a 0d0a 2020 2020 2020 2020 2020  ow):..          
-00073be0: 2020 2020 2020 7365 6c66 2e72 6f77 735f        self.rows_
-00073bf0: 6375 7272 656e 742e 6170 7065 6e64 2872  current.append(r
-00073c00: 6f77 290d 0a20 2020 2020 2020 2069 6620  ow)..        if 
-00073c10: 7365 6c66 2e73 6f72 745f 636f 6c75 6d6e  self.sort_column
-00073c20: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
-00073c30: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00073c40: 736f 7274 5f61 7363 656e 6469 6e67 203d  sort_ascending =
-00073c50: 206e 6f74 2073 656c 662e 736f 7274 5f61   not self.sort_a
-00073c60: 7363 656e 6469 6e67 0d0a 2020 2020 2020  scending..      
-00073c70: 2020 2020 2020 7365 6c66 2e53 6f72 7443        self.SortC
-00073c80: 6f6c 756d 6e28 7365 6c66 2e73 6f72 745f  olumn(self.sort_
-00073c90: 636f 6c75 6d6e 290d 0a20 2020 2020 2020  column)..       
-00073ca0: 2073 656c 662e 4e6f 7469 6679 5669 6577   self.NotifyView
-00073cb0: 4368 616e 6765 2872 6f77 735f 6265 666f  Change(rows_befo
-00073cc0: 7265 290d 0a0d 0a0d 0a20 2020 2064 6566  re)......    def
-00073cd0: 2053 6f72 7443 6f6c 756d 6e28 7365 6c66   SortColumn(self
-00073ce0: 2c20 636f 6c29 3a0d 0a20 2020 2020 2020  , col):..       
-00073cf0: 2022 2222 0d0a 2020 2020 2020 2020 536f   """..        So
-00073d00: 7274 7320 7468 6520 6772 6964 2064 6174  rts the grid dat
-00073d10: 6120 6279 2074 6865 2073 7065 6369 6669  a by the specifi
-00073d20: 6564 2063 6f6c 756d 6e2c 2072 6576 6572  ed column, rever
-00073d30: 7369 6e67 2074 6865 2070 7265 7669 6f75  sing the previou
-00073d40: 730d 0a20 2020 2020 2020 2073 6f72 7420  s..        sort 
-00073d50: 6f72 6465 722c 2069 6620 616e 792e 0d0a  order, if any...
-00073d60: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
-00073d70: 2020 2020 2073 656c 662e 5365 656b 546f       self.SeekTo
-00073d80: 526f 7728 7365 6c66 2e72 6f77 5f63 6f75  Row(self.row_cou
-00073d90: 6e74 202d 2031 290d 0a20 2020 2020 2020  nt - 1)..       
-00073da0: 2073 656c 662e 736f 7274 5f61 7363 656e   self.sort_ascen
-00073db0: 6469 6e67 203d 206e 6f74 2073 656c 662e  ding = not self.
-00073dc0: 736f 7274 5f61 7363 656e 6469 6e67 0d0a  sort_ascending..
-00073dd0: 2020 2020 2020 2020 7365 6c66 2e73 6f72          self.sor
-00073de0: 745f 636f 6c75 6d6e 203d 2063 6f6c 0d0a  t_column = col..
-00073df0: 2020 2020 2020 2020 6966 2030 203c 3d20          if 0 <= 
-00073e00: 636f 6c20 3c20 6c65 6e28 7365 6c66 2e63  col < len(self.c
-00073e10: 6f6c 756d 6e73 293a 0d0a 2020 2020 2020  olumns):..      
-00073e20: 2020 2020 2020 6e61 6d65 203d 2073 656c        name = sel
-00073e30: 662e 636f 6c75 6d6e 735b 636f 6c5d 5b22  f.columns[col]["
-00073e40: 6e61 6d65 225d 0d0a 2020 2020 2020 2020  name"]..        
-00073e50: 2020 2020 7479 7065 7320 3d20 7365 7428      types = set(
-00073e60: 7479 7065 2878 5b6e 616d 655d 2920 666f  type(x[name]) fo
-00073e70: 7220 7820 696e 2073 656c 662e 726f 7773  r x in self.rows
-00073e80: 5f63 7572 7265 6e74 290d 0a20 2020 2020  _current)..     
-00073e90: 2020 2020 2020 2069 6620 7479 7065 7320         if types 
-00073ea0: 2d20 7365 7428 7369 782e 696e 7465 6765  - set(six.intege
-00073eb0: 725f 7479 7065 7320 2b20 2862 6f6f 6c2c  r_types + (bool,
-00073ec0: 2074 7970 6528 4e6f 6e65 2929 293a 2020   type(None))):  
-00073ed0: 2320 4e6f 7420 6f6e 6c79 206e 756d 6572  # Not only numer
-00073ee0: 6963 2074 7970 6573 0d0a 2020 2020 2020  ic types..      
-00073ef0: 2020 2020 2020 2020 2020 6b65 7920 3d20            key = 
-00073f00: 6c61 6d62 6461 2078 3a20 785b 6e61 6d65  lambda x: x[name
-00073f10: 5d2e 6c6f 7765 7228 2920 6966 2069 7369  ].lower() if isi
-00073f20: 6e73 7461 6e63 6528 785b 6e61 6d65 5d2c  nstance(x[name],
-00073f30: 2073 6978 2e73 7472 696e 675f 7479 7065   six.string_type
-00073f40: 7329 2065 6c73 6520 5c0d 0a20 2020 2020  s) else \..     
-00073f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00073f60: 2020 2020 2020 2020 2020 2022 2220 6966             "" if
-00073f70: 2078 5b6e 616d 655d 2069 7320 4e6f 6e65   x[name] is None
-00073f80: 2065 6c73 6520 7369 782e 7465 7874 5f74   else six.text_t
-00073f90: 7970 6528 785b 6e61 6d65 5d29 0d0a 2020  ype(x[name])..  
-00073fa0: 2020 2020 2020 2020 2020 656c 7365 3a20            else: 
-00073fb0: 2023 204f 6e6c 7920 6e75 6d65 7269 6320   # Only numeric 
-00073fc0: 7479 7065 730d 0a20 2020 2020 2020 2020  types..         
-00073fd0: 2020 2020 2020 206b 6579 203d 206c 616d         key = lam
-00073fe0: 6264 6120 783a 202d 7379 732e 6d61 7873  bda x: -sys.maxs
-00073ff0: 697a 6520 6966 2078 5b6e 616d 655d 2069  ize if x[name] i
-00074000: 7320 4e6f 6e65 2065 6c73 6520 785b 6e61  s None else x[na
-00074010: 6d65 5d0d 0a20 2020 2020 2020 2020 2020  me]..           
-00074020: 2073 656c 662e 726f 7773 5f63 7572 7265   self.rows_curre
-00074030: 6e74 2e73 6f72 7428 6b65 793d 6b65 792c  nt.sort(key=key,
-00074040: 2072 6576 6572 7365 3d73 656c 662e 736f   reverse=self.so
-00074050: 7274 5f61 7363 656e 6469 6e67 290d 0a20  rt_ascending).. 
-00074060: 2020 2020 2020 2069 6620 7365 6c66 2e56         if self.V
-00074070: 6965 773a 0d0a 2020 2020 2020 2020 2020  iew:..          
-00074080: 2020 7365 6c66 2e56 6965 772e 466f 7263    self.View.Forc
-00074090: 6552 6566 7265 7368 2829 0d0a 0d0a 0d0a  eRefresh()......
-000740a0: 2020 2020 6465 6620 436c 6f73 6528 7365      def Close(se
-000740b0: 6c66 293a 0d0a 2020 2020 2020 2020 2222  lf):..        ""
-000740c0: 2243 6c6f 7365 7320 7468 6520 756e 6465  "Closes the unde
-000740d0: 726c 7969 6e67 2071 7565 7279 2063 7572  rlying query cur
-000740e0: 736f 722c 2069 6620 616e 792e 2222 220d  sor, if any.""".
-000740f0: 0a20 2020 2020 2020 2074 7279 3a20 7365  .        try: se
-00074100: 6c66 2e72 6f77 5f69 7465 7261 746f 722e  lf.row_iterator.
-00074110: 636c 6f73 6528 290d 0a20 2020 2020 2020  close()..       
-00074120: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
-00074130: 6e3a 2070 6173 730d 0a20 2020 2020 2020  n: pass..       
-00074140: 2073 656c 662e 726f 775f 6974 6572 6174   self.row_iterat
-00074150: 6f72 203d 204e 6f6e 650d 0a0d 0a0d 0a20  or = None...... 
-00074160: 2020 2064 6566 2053 6176 6543 6861 6e67     def SaveChang
-00074170: 6573 2873 656c 6629 3a0d 0a20 2020 2020  es(self):..     
-00074180: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
-00074190: 5361 7665 7320 7468 6520 726f 7773 2074  Saves the rows t
-000741a0: 6861 7420 6861 7665 2062 6565 6e20 6368  hat have been ch
-000741b0: 616e 6765 6420 696e 2074 6869 7320 7461  anged in this ta
-000741c0: 626c 652e 2044 726f 7073 2075 6e64 6f2d  ble. Drops undo-
-000741d0: 6361 6368 652e 0d0a 2020 2020 2020 2020  cache...        
-000741e0: 2222 220d 0a20 2020 2020 2020 2074 7279  """..        try
-000741f0: 3a0d 0a20 2020 2020 2020 2020 2020 2066  :..            f
-00074200: 6f72 2069 6478 2069 6e20 7365 6c66 2e69  or idx in self.i
-00074210: 6478 5f63 6861 6e67 6564 2e63 6f70 7928  dx_changed.copy(
-00074220: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00074230: 2020 2020 726f 7720 3d20 7365 6c66 2e72      row = self.r
-00074240: 6f77 735f 616c 6c5b 6964 785d 0d0a 2020  ows_all[idx]..  
-00074250: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00074260: 6c66 2e64 622e 7570 6461 7465 5f72 6f77  lf.db.update_row
-00074270: 2873 656c 662e 7461 626c 652c 2072 6f77  (self.table, row
-00074280: 2c20 7365 6c66 2e72 6f77 735f 6261 636b  , self.rows_back
-00074290: 7570 5b69 6478 5d2c 0d0a 2020 2020 2020  up[idx],..      
-000742a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000742b0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-000742c0: 662e 726f 7769 6473 2e67 6574 2869 6478  f.rowids.get(idx
-000742d0: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
-000742e0: 2020 2020 726f 775b 225f 5f63 6861 6e67      row["__chang
-000742f0: 6564 5f5f 225d 203d 2046 616c 7365 0d0a  ed__"] = False..
-00074300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00074310: 7365 6c66 2e69 6478 5f63 6861 6e67 6564  self.idx_changed
-00074320: 2e72 656d 6f76 6528 6964 7829 0d0a 2020  .remove(idx)..  
-00074330: 2020 2020 2020 2020 2020 2020 2020 6465                de
-00074340: 6c20 7365 6c66 2e72 6f77 735f 6261 636b  l self.rows_back
-00074350: 7570 5b69 6478 5d0d 0a20 2020 2020 2020  up[idx]..       
-00074360: 2020 2020 2023 2053 6176 6520 616c 6c20       # Save all 
-00074370: 6e65 776c 7920 696e 7365 7274 6564 2072  newly inserted r
-00074380: 6f77 730d 0a20 2020 2020 2020 2020 2020  ows..           
-00074390: 2070 6b73 203d 205b 635b 226e 616d 6522   pks = [c["name"
-000743a0: 5d20 666f 7220 6320 696e 2073 656c 662e  ] for c in self.
-000743b0: 636f 6c75 6d6e 7320 6966 2063 5b22 706b  columns if c["pk
-000743c0: 225d 5d0d 0a20 2020 2020 2020 2020 2020  "]]..           
-000743d0: 2063 6f6c 5f6d 6170 203d 2064 6963 7428   col_map = dict(
-000743e0: 2863 5b22 6e61 6d65 225d 2c20 6329 2066  (c["name"], c) f
-000743f0: 6f72 2063 2069 6e20 7365 6c66 2e63 6f6c  or c in self.col
-00074400: 756d 6e73 290d 0a20 2020 2020 2020 2020  umns)..         
-00074410: 2020 2066 6f72 2069 6478 2069 6e20 7365     for idx in se
-00074420: 6c66 2e69 6478 5f6e 6577 5b3a 5d3a 0d0a  lf.idx_new[:]:..
-00074430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00074440: 726f 7720 3d20 7365 6c66 2e72 6f77 735f  row = self.rows_
-00074450: 616c 6c5b 6964 785d 0d0a 2020 2020 2020  all[idx]..      
-00074460: 2020 2020 2020 2020 2020 696e 7365 7274            insert
-00074470: 5f69 6420 3d20 7365 6c66 2e64 622e 696e  _id = self.db.in
-00074480: 7365 7274 5f72 6f77 2873 656c 662e 7461  sert_row(self.ta
-00074490: 626c 652c 2072 6f77 290d 0a20 2020 2020  ble, row)..     
-000744a0: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
-000744b0: 6e28 706b 7329 203d 3d20 3120 616e 6420  n(pks) == 1 and 
-000744c0: 726f 775b 706b 735b 305d 5d20 696e 2028  row[pks[0]] in (
-000744d0: 4e6f 6e65 2c20 2222 293a 0d0a 2020 2020  None, ""):..    
-000744e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000744f0: 6966 2022 494e 5445 4745 5222 203d 3d20  if "INTEGER" == 
-00074500: 636f 6c5f 6d61 705b 706b 735b 305d 5d5b  col_map[pks[0]][
-00074510: 2274 7970 6522 5d3a 0d0a 2020 2020 2020  "type"]:..      
-00074520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00074530: 2020 2320 4175 746f 696e 6372 656d 656e    # Autoincremen
-00074540: 7465 6420 726f 773a 2075 7064 6174 6520  ted row: update 
-00074550: 7769 7468 206e 6577 2076 616c 7565 0d0a  with new value..
-00074560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00074570: 2020 2020 2020 2020 726f 775b 706b 735b          row[pks[
-00074580: 305d 5d20 3d20 696e 7365 7274 5f69 640d  0]] = insert_id.
-00074590: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000745a0: 2020 2020 2065 6c73 653a 2023 2046 6f72       else: # For
-000745b0: 206e 6f6e 2d69 6e74 6567 6572 732c 2069   non-integers, i
-000745c0: 6e73 6572 7420 7265 7475 726e 7320 524f  nsert returns RO
-000745d0: 5749 440d 0a20 2020 2020 2020 2020 2020  WID..           
-000745e0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-000745f0: 662e 726f 7769 6473 5b69 6478 5d20 3d20  f.rowids[idx] = 
-00074600: 696e 7365 7274 5f69 640d 0a20 2020 2020  insert_id..     
-00074610: 2020 2020 2020 2020 2020 2072 6f77 5b22             row["
-00074620: 5f5f 6e65 775f 5f22 5d20 3d20 4661 6c73  __new__"] = Fals
-00074630: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
-00074640: 2020 2073 656c 662e 6964 785f 6e65 772e     self.idx_new.
-00074650: 7265 6d6f 7665 2869 6478 290d 0a20 2020  remove(idx)..   
-00074660: 2020 2020 2020 2020 2023 2044 656c 6574           # Delet
-00074670: 6564 2061 6c6c 206e 6577 6c79 2064 656c  ed all newly del
-00074680: 6574 6564 2072 6f77 730d 0a20 2020 2020  eted rows..     
-00074690: 2020 2020 2020 2066 6f72 2069 6478 2c20         for idx, 
-000746a0: 726f 7720 696e 2073 656c 662e 726f 7773  row in self.rows
-000746b0: 5f64 656c 6574 6564 2e63 6f70 7928 292e  _deleted.copy().
-000746c0: 6974 656d 7328 293a 0d0a 2020 2020 2020  items():..      
-000746d0: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
-000746e0: 622e 6465 6c65 7465 5f72 6f77 2873 656c  b.delete_row(sel
-000746f0: 662e 7461 626c 652c 2072 6f77 2c20 7365  f.table, row, se
-00074700: 6c66 2e72 6f77 6964 732e 6765 7428 6964  lf.rowids.get(id
-00074710: 7829 290d 0a20 2020 2020 2020 2020 2020  x))..           
-00074720: 2020 2020 2064 656c 2073 656c 662e 726f       del self.ro
-00074730: 7773 5f64 656c 6574 6564 5b69 6478 5d0d  ws_deleted[idx].
-00074740: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00074750: 2064 656c 2073 656c 662e 726f 7773 5f61   del self.rows_a
-00074760: 6c6c 5b69 6478 5d0d 0a20 2020 2020 2020  ll[idx]..       
-00074770: 2020 2020 2020 2020 2073 656c 662e 6964           self.id
-00074780: 785f 616c 6c2e 7265 6d6f 7665 2869 6478  x_all.remove(idx
-00074790: 290d 0a20 2020 2020 2020 2065 7863 6570  )..        excep
-000747a0: 7420 4578 6365 7074 696f 6e20 6173 2065  t Exception as e
-000747b0: 3a0d 0a20 2020 2020 2020 2020 2020 2067  :..            g
-000747c0: 7569 6261 7365 2e73 7461 7475 7328 2245  uibase.status("E
-000747d0: 7272 6f72 2073 6176 696e 6720 6368 616e  rror saving chan
-000747e0: 6765 7320 696e 2025 732e 222c 2073 656c  ges in %s.", sel
-000747f0: 662e 7461 626c 6529 0d0a 2020 2020 2020  f.table)..      
-00074800: 2020 2020 2020 6c6f 6767 6572 2e65 7863        logger.exc
-00074810: 6570 7469 6f6e 2822 4572 726f 7220 7361  eption("Error sa
-00074820: 7669 6e67 2063 6861 6e67 6573 2069 6e20  ving changes in 
-00074830: 2573 2e22 2c20 7365 6c66 2e74 6162 6c65  %s.", self.table
-00074840: 290d 0a20 2020 2020 2020 2020 2020 2077  )..            w
-00074850: 782e 4d65 7373 6167 6542 6f78 2875 7469  x.MessageBox(uti
-00074860: 6c2e 666f 726d 6174 5f65 7863 2865 292c  l.format_exc(e),
-00074870: 2063 6f6e 662e 5469 746c 652c 0d0a 2020   conf.Title,..  
-00074880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00074890: 2020 2020 2020 2020 7778 2e4f 4b20 7c20          wx.OK | 
-000748a0: 7778 2e49 434f 4e5f 5741 524e 494e 4729  wx.ICON_WARNING)
-000748b0: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
-000748c0: 662e 5669 6577 3a20 7365 6c66 2e56 6965  f.View: self.Vie
-000748d0: 772e 5265 6672 6573 6828 290d 0a0d 0a0d  w.Refresh().....
-000748e0: 0a20 2020 2064 6566 2055 6e64 6f43 6861  .    def UndoCha
-000748f0: 6e67 6573 2873 656c 6629 3a0d 0a20 2020  nges(self):..   
-00074900: 2020 2020 2022 2222 556e 646f 6573 2074       """Undoes t
-00074910: 6865 2063 6861 6e67 6573 206d 6164 6520  he changes made 
-00074920: 746f 2074 6865 2072 6f77 7320 696e 2074  to the rows in t
-00074930: 6869 7320 7461 626c 652e 2222 220d 0a20  his table.""".. 
-00074940: 2020 2020 2020 2072 6f77 735f 6265 666f         rows_befo
-00074950: 7265 203d 206c 656e 2873 656c 662e 726f  re = len(self.ro
-00074960: 7773 5f63 7572 7265 6e74 290d 0a20 2020  ws_current)..   
-00074970: 2020 2020 2023 2052 6573 746f 7265 2061       # Restore a
-00074980: 6c6c 2063 6861 6e67 6564 2072 6f77 2064  ll changed row d
-00074990: 6174 6120 6672 6f6d 2062 6163 6b75 700d  ata from backup.
-000749a0: 0a20 2020 2020 2020 2066 6f72 2069 6478  .        for idx
-000749b0: 2069 6e20 7365 6c66 2e69 6478 5f63 6861   in self.idx_cha
-000749c0: 6e67 6564 2e63 6f70 7928 293a 0d0a 2020  nged.copy():..  
-000749d0: 2020 2020 2020 2020 2020 726f 7720 3d20            row = 
-000749e0: 7365 6c66 2e72 6f77 735f 6261 636b 7570  self.rows_backup
-000749f0: 5b69 6478 5d0d 0a20 2020 2020 2020 2020  [idx]..         
-00074a00: 2020 2072 6f77 5b22 5f5f 6368 616e 6765     row["__change
-00074a10: 645f 5f22 5d20 3d20 4661 6c73 650d 0a20  d__"] = False.. 
-00074a20: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00074a30: 726f 7773 5f61 6c6c 5b69 6478 5d2e 7570  rows_all[idx].up
-00074a40: 6461 7465 2872 6f77 290d 0a20 2020 2020  date(row)..     
-00074a50: 2020 2020 2020 2073 656c 662e 6964 785f         self.idx_
-00074a60: 6368 616e 6765 642e 7265 6d6f 7665 2869  changed.remove(i
-00074a70: 6478 290d 0a20 2020 2020 2020 2020 2020  dx)..           
-00074a80: 2064 656c 2073 656c 662e 726f 7773 5f62   del self.rows_b
-00074a90: 6163 6b75 705b 6964 785d 0d0a 2020 2020  ackup[idx]..    
-00074aa0: 2020 2020 2320 4469 7363 6172 6420 616c      # Discard al
-00074ab0: 6c20 6e65 776c 7920 696e 7365 7274 6564  l newly inserted
-00074ac0: 2072 6f77 730d 0a20 2020 2020 2020 2066   rows..        f
-00074ad0: 6f72 2069 6478 2069 6e20 7365 6c66 2e69  or idx in self.i
-00074ae0: 6478 5f6e 6577 5b3a 5d3a 0d0a 2020 2020  dx_new[:]:..    
-00074af0: 2020 2020 2020 2020 726f 7720 3d20 7365          row = se
-00074b00: 6c66 2e72 6f77 735f 616c 6c5b 6964 785d  lf.rows_all[idx]
-00074b10: 0d0a 2020 2020 2020 2020 2020 2020 6465  ..            de
-00074b20: 6c20 7365 6c66 2e72 6f77 735f 616c 6c5b  l self.rows_all[
-00074b30: 6964 785d 0d0a 2020 2020 2020 2020 2020  idx]..          
-00074b40: 2020 6966 2072 6f77 2069 6e20 7365 6c66    if row in self
-00074b50: 2e72 6f77 735f 6375 7272 656e 743a 2073  .rows_current: s
-00074b60: 656c 662e 726f 7773 5f63 7572 7265 6e74  elf.rows_current
-00074b70: 2e72 656d 6f76 6528 726f 7729 0d0a 2020  .remove(row)..  
-00074b80: 2020 2020 2020 2020 2020 7365 6c66 2e69            self.i
-00074b90: 6478 5f6e 6577 2e72 656d 6f76 6528 6964  dx_new.remove(id
-00074ba0: 7829 0d0a 2020 2020 2020 2020 2020 2020  x)..            
-00074bb0: 7365 6c66 2e69 6478 5f61 6c6c 2e72 656d  self.idx_all.rem
-00074bc0: 6f76 6528 6964 7829 0d0a 2020 2020 2020  ove(idx)..      
-00074bd0: 2020 2320 556e 6465 6c65 7465 2061 6c6c    # Undelete all
-00074be0: 206e 6577 6c79 2064 656c 6574 6564 2069   newly deleted i
-00074bf0: 7465 6d73 0d0a 2020 2020 2020 2020 666f  tems..        fo
-00074c00: 7220 6964 782c 2072 6f77 2069 6e20 7365  r idx, row in se
-00074c10: 6c66 2e72 6f77 735f 6465 6c65 7465 642e  lf.rows_deleted.
-00074c20: 6974 656d 7328 293a 0d0a 2020 2020 2020  items():..      
-00074c30: 2020 2020 2020 726f 775b 225f 5f64 656c        row["__del
-00074c40: 6574 6564 5f5f 225d 203d 2046 616c 7365  eted__"] = False
-00074c50: 0d0a 2020 2020 2020 2020 2020 2020 6465  ..            de
-00074c60: 6c20 7365 6c66 2e72 6f77 735f 6465 6c65  l self.rows_dele
-00074c70: 7465 645b 6964 785d 0d0a 2020 2020 2020  ted[idx]..      
-00074c80: 2020 2020 2020 6966 2073 656c 662e 5f69        if self._i
-00074c90: 735f 726f 775f 756e 6669 6c74 6572 6564  s_row_unfiltered
-00074ca0: 2872 6f77 293a 0d0a 2020 2020 2020 2020  (row):..        
-00074cb0: 2020 2020 2020 2020 7365 6c66 2e72 6f77          self.row
-00074cc0: 735f 6375 7272 656e 742e 6170 7065 6e64  s_current.append
-00074cd0: 2872 6f77 290d 0a20 2020 2020 2020 2020  (row)..         
-00074ce0: 2020 2073 656c 662e 726f 775f 636f 756e     self.row_coun
-00074cf0: 7420 2b3d 2031 0d0a 2020 2020 2020 2020  t += 1..        
-00074d00: 7365 6c66 2e4e 6f74 6966 7956 6965 7743  self.NotifyViewC
-00074d10: 6861 6e67 6528 726f 7773 5f62 6566 6f72  hange(rows_befor
-00074d20: 6529 0d0a 2020 2020 2020 2020 6966 2073  e)..        if s
-00074d30: 656c 662e 5669 6577 3a20 7365 6c66 2e56  elf.View: self.V
-00074d40: 6965 772e 5265 6672 6573 6828 290d 0a0d  iew.Refresh()...
-00074d50: 0a0d 0a20 2020 2064 6566 205f 6973 5f72  ...    def _is_r
-00074d60: 6f77 5f75 6e66 696c 7465 7265 6428 7365  ow_unfiltered(se
-00074d70: 6c66 2c20 726f 7764 6174 6129 3a0d 0a20  lf, rowdata):.. 
-00074d80: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
-00074d90: 2020 2020 5265 7475 726e 7320 7768 6574      Returns whet
-00074da0: 6865 7220 7468 6520 726f 7720 6973 206e  her the row is n
-00074db0: 6f74 2066 696c 7465 7265 6420 6f75 7420  ot filtered out 
-00074dc0: 6279 2074 6865 2063 7572 7265 6e74 2066  by the current f
-00074dd0: 696c 7465 7269 6e67 0d0a 2020 2020 2020  iltering..      
-00074de0: 2020 6372 6974 6572 6961 2c20 6966 2061    criteria, if a
-00074df0: 6e79 2e0d 0a20 2020 2020 2020 2022 2222  ny...        """
-00074e00: 0d0a 2020 2020 2020 2020 6973 5f75 6e66  ..        is_unf
-00074e10: 696c 7465 7265 6420 3d20 5472 7565 0d0a  iltered = True..
-00074e20: 2020 2020 2020 2020 666f 7220 636f 6c2c          for col,
-00074e30: 2066 696c 7465 725f 7661 6c75 6520 696e   filter_value in
-00074e40: 2073 656c 662e 6669 6c74 6572 732e 6974   self.filters.it
-00074e50: 656d 7328 293a 0d0a 2020 2020 2020 2020  ems():..        
-00074e60: 2020 2020 636f 6c75 6d6e 5f64 6174 6120      column_data 
-00074e70: 3d20 7365 6c66 2e63 6f6c 756d 6e73 5b63  = self.columns[c
-00074e80: 6f6c 5d0d 0a20 2020 2020 2020 2020 2020  ol]..           
-00074e90: 2069 6620 2249 4e54 4547 4552 2220 3d3d   if "INTEGER" ==
-00074ea0: 2063 6f6c 756d 6e5f 6461 7461 5b22 7479   column_data["ty
-00074eb0: 7065 225d 3a0d 0a20 2020 2020 2020 2020  pe"]:..         
-00074ec0: 2020 2020 2020 2069 735f 756e 6669 6c74         is_unfilt
-00074ed0: 6572 6564 2026 3d20 2866 696c 7465 725f  ered &= (filter_
-00074ee0: 7661 6c75 6520 3d3d 2072 6f77 6461 7461  value == rowdata
-00074ef0: 5b63 6f6c 756d 6e5f 6461 7461 5b22 6e61  [column_data["na
-00074f00: 6d65 225d 5d29 0d0a 2020 2020 2020 2020  me"]])..        
-00074f10: 2020 2020 656c 6966 2022 5445 5854 2220      elif "TEXT" 
-00074f20: 3d3d 2063 6f6c 756d 6e5f 6461 7461 5b22  == column_data["
-00074f30: 7479 7065 225d 3a0d 0a20 2020 2020 2020  type"]:..       
-00074f40: 2020 2020 2020 2020 2073 7472 5f76 616c           str_val
-00074f50: 7565 203d 2028 726f 7764 6174 615b 636f  ue = (rowdata[co
-00074f60: 6c75 6d6e 5f64 6174 615b 226e 616d 6522  lumn_data["name"
-00074f70: 5d5d 206f 7220 2222 292e 6c6f 7765 7228  ]] or "").lower(
-00074f80: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00074f90: 2020 2069 735f 756e 6669 6c74 6572 6564     is_unfiltered
-00074fa0: 2026 3d20 7374 725f 7661 6c75 652e 6669   &= str_value.fi
-00074fb0: 6e64 2866 696c 7465 725f 7661 6c75 652e  nd(filter_value.
-00074fc0: 6c6f 7765 7228 2929 203e 3d20 300d 0a20  lower()) >= 0.. 
-00074fd0: 2020 2020 2020 2072 6574 7572 6e20 6973         return is
-00074fe0: 5f75 6e66 696c 7465 7265 640d 0a0d 0a0d  _unfiltered.....
-00074ff0: 0a0d 0a63 6c61 7373 2043 6861 7443 6f6e  ...class ChatCon
-00075000: 7465 6e74 5469 6d65 6c69 6e65 2877 782e  tentTimeline(wx.
-00075010: 6874 6d6c 2e53 696d 706c 6548 746d 6c4c  html.SimpleHtmlL
-00075020: 6973 7442 6f78 293a 0d0a 2020 2020 2222  istBox):..    ""
-00075030: 220d 0a20 2020 204c 6973 7462 6f78 2066  "..    Listbox f
-00075040: 6f72 2073 686f 7769 6e67 2071 7569 636b  or showing quick
-00075050: 2064 6174 6520 7365 6c65 6374 696f 6e20   date selection 
-00075060: 666f 7220 4368 6174 436f 6e74 656e 7453  for ChatContentS
-00075070: 5443 2e0d 0a20 2020 2022 2222 0d0a 2020  TC...    """..  
-00075080: 2020 4c49 4e45 5f46 4f52 4d41 5453 203d    LINE_FORMATS =
-00075090: 207b 0d0a 2020 2020 2020 2020 2279 6561   {..        "yea
-000750a0: 7222 3a20 2027 3c66 6f6e 7420 636f 6c6f  r":  '<font colo
-000750b0: 723d 2225 2846 6743 6f6c 6f75 7229 7322  r="%(FgColour)s"
-000750c0: 2073 697a 653d 353e 3c74 6162 6c65 2077   size=5><table w
-000750d0: 6964 7468 3d22 3130 3025 2522 3e3c 7472  idth="100%%"><tr
-000750e0: 3e3c 7464 206e 6f77 7261 703e 2528 6c61  ><td nowrap>%(la
-000750f0: 6265 6c29 733c 2f74 643e 3c74 6420 616c  bel)s</td><td al
-00075100: 6967 6e3d 2272 6967 6874 223e 3c66 6f6e  ign="right"><fon
-00075110: 7420 636f 6c6f 723d 2225 2844 6973 6162  t color="%(Disab
-00075120: 6c65 6443 6f6c 6f75 7229 7322 2073 697a  ledColour)s" siz
-00075130: 653d 313e 2528 636f 756e 7429 733c 2f66  e=1>%(count)s</f
-00075140: 6f6e 743e 3c2f 7464 3e3c 2f74 723e 3c2f  ont></td></tr></
-00075150: 7461 626c 653e 3c2f 666f 6e74 3e27 2c0d  table></font>',.
-00075160: 0a20 2020 2020 2020 2022 6d6f 6e74 6822  .        "month"
-00075170: 3a20 273c 666f 6e74 2063 6f6c 6f72 3d22  : '<font color="
-00075180: 2528 4667 436f 6c6f 7572 2973 223e 3c74  %(FgColour)s"><t
-00075190: 6162 6c65 2077 6964 7468 3d22 3130 3025  able width="100%
-000751a0: 2522 3e3c 7472 3e3c 7464 206e 6f77 7261  %"><tr><td nowra
-000751b0: 703e 3c66 6f6e 7420 7369 7a65 3d34 3e26  p><font size=4>&
-000751c0: 6e62 7370 3b25 286c 6162 656c 2973 203c  nbsp;%(label)s <
-000751d0: 2f66 6f6e 743e 3c66 6f6e 7420 7369 7a65  /font><font size
-000751e0: 3d32 3e25 286c 6162 656c 3229 733c 2f66  =2>%(label2)s</f
-000751f0: 6f6e 743e 3c2f 7464 3e3c 7464 2061 6c69  ont></td><td ali
-00075200: 676e 3d22 7269 6768 7422 3e3c 666f 6e74  gn="right"><font
-00075210: 2063 6f6c 6f72 3d22 2528 4469 7361 626c   color="%(Disabl
-00075220: 6564 436f 6c6f 7572 2973 2220 7369 7a65  edColour)s" size
-00075230: 3d31 3e25 2863 6f75 6e74 2973 3c2f 666f  =1>%(count)s</fo
-00075240: 6e74 3e3c 2f74 643e 3c2f 7472 3e3c 2f74  nt></td></tr></t
-00075250: 6162 6c65 3e3c 2f66 6f6e 743e 272c 0d0a  able></font>',..
-00075260: 2020 2020 2020 2020 2264 6179 223a 2020          "day":  
-00075270: 2027 3c66 6f6e 7420 636f 6c6f 723d 2225   '<font color="%
-00075280: 2846 6743 6f6c 6f75 7229 7322 3e3c 7461  (FgColour)s"><ta
-00075290: 626c 6520 7769 6474 683d 2231 3030 2525  ble width="100%%
-000752a0: 223e 3c74 723e 3c74 6420 6e6f 7772 6170  "><tr><td nowrap
-000752b0: 3e3c 666f 6e74 2073 697a 653d 343e 2528  ><font size=4>%(
-000752c0: 6c61 6265 6c29 7320 3c2f 666f 6e74 3e3c  label)s </font><
-000752d0: 666f 6e74 2073 697a 653d 323e 2528 6c61  font size=2>%(la
-000752e0: 6265 6c32 2973 3c2f 666f 6e74 3e3c 2f74  bel2)s</font></t
-000752f0: 643e 3c74 6420 616c 6967 6e3d 2272 6967  d><td align="rig
-00075300: 6874 223e 3c66 6f6e 7420 636f 6c6f 723d  ht"><font color=
-00075310: 2225 2844 6973 6162 6c65 6443 6f6c 6f75  "%(DisabledColou
-00075320: 7229 7322 2073 697a 653d 313e 2528 636f  r)s" size=1>%(co
-00075330: 756e 7429 733c 2f66 6f6e 743e 3c2f 7464  unt)s</font></td
-00075340: 3e3c 2f74 723e 3c2f 7461 626c 653e 3c2f  ></tr></table></
-00075350: 666f 6e74 3e27 2c0d 0a20 2020 2020 2020  font>',..       
-00075360: 2022 6461 7465 223a 2020 273c 666f 6e74   "date":  '<font
-00075370: 2063 6f6c 6f72 3d22 2528 4667 436f 6c6f   color="%(FgColo
-00075380: 7572 2973 2220 7369 7a65 3d33 3e3c 7461  ur)s" size=3><ta
-00075390: 626c 6520 7769 6474 683d 2231 3030 2525  ble width="100%%
-000753a0: 223e 3c74 723e 3c74 6420 6e6f 7772 6170  "><tr><td nowrap
-000753b0: 3e26 6e62 7370 3b26 6e62 7370 3b26 6e62  >&nbsp;&nbsp;&nb
-000753c0: 7370 3b26 6e62 7370 3b25 286c 6162 656c  sp;&nbsp;%(label
-000753d0: 2973 3c73 7570 3e25 286c 6162 656c 3229  )s<sup>%(label2)
-000753e0: 733c 2f73 7570 3e3c 2f74 643e 3c74 6420  s</sup></td><td 
-000753f0: 616c 6967 6e3d 2272 6967 6874 223e 3c66  align="right"><f
-00075400: 6f6e 7420 636f 6c6f 723d 2225 2844 6973  ont color="%(Dis
-00075410: 6162 6c65 6443 6f6c 6f75 7229 7322 2073  abledColour)s" s
-00075420: 697a 653d 313e 2528 636f 756e 7429 733c  ize=1>%(count)s<
-00075430: 2f66 6f6e 743e 3c2f 7464 3e3c 2f74 723e  /font></td></tr>
-00075440: 3c2f 7461 626c 653e 3c2f 666f 6e74 3e27  </table></font>'
-00075450: 2c0d 0a20 2020 2020 2020 2022 686f 7572  ,..        "hour
-00075460: 223a 2020 273c 666f 6e74 2063 6f6c 6f72  ":  '<font color
-00075470: 3d22 2528 4667 436f 6c6f 7572 2973 2220  ="%(FgColour)s" 
-00075480: 7369 7a65 3d33 3e3c 7461 626c 6520 7769  size=3><table wi
-00075490: 6474 683d 2231 3030 2525 223e 3c74 723e  dth="100%%"><tr>
-000754a0: 3c74 6420 6e6f 7772 6170 3e26 6e62 7370  <td nowrap>&nbsp
-000754b0: 3b26 6e62 7370 3b26 6e62 7370 3b26 6e62  ;&nbsp;&nbsp;&nb
-000754c0: 7370 3b25 286c 6162 656c 2973 3c2f 7464  sp;%(label)s</td
-000754d0: 3e3c 7464 2061 6c69 676e 3d22 7269 6768  ><td align="righ
-000754e0: 7422 3e3c 666f 6e74 2063 6f6c 6f72 3d22  t"><font color="
-000754f0: 2528 4469 7361 626c 6564 436f 6c6f 7572  %(DisabledColour
-00075500: 2973 2220 7369 7a65 3d31 3e25 2863 6f75  )s" size=1>%(cou
-00075510: 6e74 2973 3c2f 666f 6e74 3e3c 2f74 643e  nt)s</font></td>
-00075520: 3c2f 7472 3e3c 2f74 6162 6c65 3e3c 2f66  </tr></table></f
-00075530: 6f6e 743e 272c 0d0a 2020 2020 2020 2020  ont>',..        
-00075540: 2277 6565 6b22 3a20 2027 3c66 6f6e 7420  "week":  '<font 
-00075550: 636f 6c6f 723d 2225 2846 6743 6f6c 6f75  color="%(FgColou
-00075560: 7229 7322 2073 697a 653d 323e 3c74 6162  r)s" size=2><tab
-00075570: 6c65 2077 6964 7468 3d22 3130 3025 2522  le width="100%%"
-00075580: 3e3c 7472 3e3c 7464 206e 6f77 7261 703e  ><tr><td nowrap>
-00075590: 266e 6273 703b 266e 6273 703b 266e 6273  &nbsp;&nbsp;&nbs
-000755a0: 703b 266e 6273 703b 2528 6c61 6265 6c29  p;&nbsp;%(label)
-000755b0: 733c 2f74 643e 3c74 6420 616c 6967 6e3d  s</td><td align=
-000755c0: 2272 6967 6874 223e 3c66 6f6e 7420 636f  "right"><font co
-000755d0: 6c6f 723d 2225 2844 6973 6162 6c65 6443  lor="%(DisabledC
-000755e0: 6f6c 6f75 7229 7322 2073 697a 653d 313e  olour)s" size=1>
-000755f0: 2528 636f 756e 7429 733c 2f66 6f6e 743e  %(count)s</font>
-00075600: 3c2f 7464 3e3c 2f74 723e 3c2f 7461 626c  </td></tr></tabl
-00075610: 653e 3c2f 666f 6e74 3e27 2c0d 0a20 2020  e></font>',..   
-00075620: 207d 0d0a 2020 2020 4c49 4e45 5f46 4f52   }..    LINE_FOR
-00075630: 4d41 5453 5f48 4947 484c 4947 4854 203d  MATS_HIGHLIGHT =
-00075640: 207b 0d0a 2020 2020 2020 2020 2279 6561   {..        "yea
-00075650: 7222 3a20 2027 3c66 6f6e 7420 636f 6c6f  r":  '<font colo
-00075660: 723d 2225 2846 6743 6f6c 6f75 7229 7322  r="%(FgColour)s"
-00075670: 2073 697a 653d 353e 3c74 6162 6c65 2077   size=5><table w
-00075680: 6964 7468 3d22 3130 3025 2522 3e3c 7472  idth="100%%"><tr
-00075690: 3e3c 7464 206e 6f77 7261 703e 3c62 3e25  ><td nowrap><b>%
-000756a0: 286c 6162 656c 2973 3c2f 623e 3c2f 7464  (label)s</b></td
-000756b0: 3e3c 7464 2061 6c69 676e 3d22 7269 6768  ><td align="righ
-000756c0: 7422 3e3c 666f 6e74 2063 6f6c 6f72 3d22  t"><font color="
-000756d0: 2528 4469 7361 626c 6564 436f 6c6f 7572  %(DisabledColour
-000756e0: 2973 2220 7369 7a65 3d31 3e25 2863 6f75  )s" size=1>%(cou
-000756f0: 6e74 2973 3c2f 666f 6e74 3e3c 2f74 643e  nt)s</font></td>
-00075700: 3c2f 7472 3e3c 2f74 6162 6c65 3e3c 2f66  </tr></table></f
-00075710: 6f6e 743e 272c 0d0a 2020 2020 2020 2020  ont>',..        
-00075720: 226d 6f6e 7468 223a 2027 3c66 6f6e 7420  "month": '<font 
-00075730: 636f 6c6f 723d 2225 2846 6743 6f6c 6f75  color="%(FgColou
-00075740: 7229 7322 3e3c 7461 626c 6520 7769 6474  r)s"><table widt
-00075750: 683d 2231 3030 2525 223e 3c74 723e 3c74  h="100%%"><tr><t
-00075760: 6420 6e6f 7772 6170 3e3c 666f 6e74 2073  d nowrap><font s
-00075770: 697a 653d 343e 266e 6273 703b 2528 6c61  ize=4>&nbsp;%(la
-00075780: 6265 6c29 7320 3c2f 666f 6e74 3e3c 666f  bel)s </font><fo
-00075790: 6e74 2073 697a 653d 323e 3c62 3e25 286c  nt size=2><b>%(l
-000757a0: 6162 656c 3229 733c 2f62 3e3c 2f66 6f6e  abel2)s</b></fon
-000757b0: 743e 3c2f 7464 3e3c 7464 2061 6c69 676e  t></td><td align
-000757c0: 3d22 7269 6768 7422 3e3c 666f 6e74 2063  ="right"><font c
-000757d0: 6f6c 6f72 3d22 2528 4469 7361 626c 6564  olor="%(Disabled
-000757e0: 436f 6c6f 7572 2973 2220 7369 7a65 3d31  Colour)s" size=1
-000757f0: 3e25 2863 6f75 6e74 2973 3c2f 666f 6e74  >%(count)s</font
-00075800: 3e3c 2f74 643e 3c2f 7472 3e3c 2f74 6162  ></td></tr></tab
-00075810: 6c65 3e3c 2f66 6f6e 743e 272c 0d0a 2020  le></font>',..  
-00075820: 2020 2020 2020 2264 6179 223a 2020 2027        "day":   '
-00075830: 3c66 6f6e 7420 636f 6c6f 723d 2225 2846  <font color="%(F
-00075840: 6743 6f6c 6f75 7229 7322 3e3c 7461 626c  gColour)s"><tabl
-00075850: 6520 7769 6474 683d 2231 3030 2525 223e  e width="100%%">
-00075860: 3c74 723e 3c74 6420 6e6f 7772 6170 3e3c  <tr><td nowrap><
-00075870: 666f 6e74 2073 697a 653d 343e 2528 6c61  font size=4>%(la
-00075880: 6265 6c29 7320 3c2f 666f 6e74 3e3c 666f  bel)s </font><fo
-00075890: 6e74 2073 697a 653d 323e 3c62 3e25 286c  nt size=2><b>%(l
-000758a0: 6162 656c 3229 733c 2f62 3e3c 2f66 6f6e  abel2)s</b></fon
-000758b0: 743e 3c2f 7464 3e3c 7464 2061 6c69 676e  t></td><td align
-000758c0: 3d22 7269 6768 7422 3e3c 666f 6e74 2063  ="right"><font c
-000758d0: 6f6c 6f72 3d22 2528 4469 7361 626c 6564  olor="%(Disabled
-000758e0: 436f 6c6f 7572 2973 2220 7369 7a65 3d31  Colour)s" size=1
-000758f0: 3e25 2863 6f75 6e74 2973 3c2f 666f 6e74  >%(count)s</font
-00075900: 3e3c 2f74 643e 3c2f 7472 3e3c 2f74 6162  ></td></tr></tab
-00075910: 6c65 3e3c 2f66 6f6e 743e 272c 0d0a 2020  le></font>',..  
-00075920: 2020 2020 2020 2264 6174 6522 3a20 2027        "date":  '
-00075930: 3c66 6f6e 7420 636f 6c6f 723d 2225 2846  <font color="%(F
-00075940: 6743 6f6c 6f75 7229 7322 2073 697a 653d  gColour)s" size=
-00075950: 333e 3c74 6162 6c65 2077 6964 7468 3d22  3><table width="
-00075960: 3130 3025 2522 3e3c 7472 3e3c 7464 206e  100%%"><tr><td n
-00075970: 6f77 7261 703e 266e 6273 703b 266e 6273  owrap>&nbsp;&nbs
-00075980: 703b 266e 6273 703b 266e 6273 703b 3c62  p;&nbsp;&nbsp;<b
-00075990: 3e25 286c 6162 656c 2973 3c73 7570 3e25  >%(label)s<sup>%
-000759a0: 286c 6162 656c 3229 733c 2f62 3e3c 2f73  (label2)s</b></s
-000759b0: 7570 3e3c 2f74 643e 3c74 6420 616c 6967  up></td><td alig
-000759c0: 6e3d 2272 6967 6874 223e 3c66 6f6e 7420  n="right"><font 
-000759d0: 636f 6c6f 723d 2225 2844 6973 6162 6c65  color="%(Disable
-000759e0: 6443 6f6c 6f75 7229 7322 2073 697a 653d  dColour)s" size=
-000759f0: 313e 2528 636f 756e 7429 733c 2f66 6f6e  1>%(count)s</fon
-00075a00: 743e 3c2f 7464 3e3c 2f74 723e 3c2f 7461  t></td></tr></ta
-00075a10: 626c 653e 3c2f 666f 6e74 3e27 2c0d 0a20  ble></font>',.. 
-00075a20: 2020 2020 2020 2022 686f 7572 223a 2020         "hour":  
-00075a30: 273c 666f 6e74 2063 6f6c 6f72 3d22 2528  '<font color="%(
-00075a40: 4667 436f 6c6f 7572 2973 2220 7369 7a65  FgColour)s" size
-00075a50: 3d33 3e3c 7461 626c 6520 7769 6474 683d  =3><table width=
-00075a60: 2231 3030 2525 223e 3c74 723e 3c74 6420  "100%%"><tr><td 
-00075a70: 6e6f 7772 6170 3e26 6e62 7370 3b26 6e62  nowrap>&nbsp;&nb
-00075a80: 7370 3b26 6e62 7370 3b26 6e62 7370 3b3c  sp;&nbsp;&nbsp;<
-00075a90: 623e 2528 6c61 6265 6c29 733c 2f62 3e3c  b>%(label)s</b><
-00075aa0: 2f74 643e 3c74 6420 616c 6967 6e3d 2272  /td><td align="r
-00075ab0: 6967 6874 223e 3c66 6f6e 7420 636f 6c6f  ight"><font colo
-00075ac0: 723d 2225 2844 6973 6162 6c65 6443 6f6c  r="%(DisabledCol
-00075ad0: 6f75 7229 7322 2073 697a 653d 313e 2528  our)s" size=1>%(
-00075ae0: 636f 756e 7429 733c 2f66 6f6e 743e 3c2f  count)s</font></
-00075af0: 7464 3e3c 2f74 723e 3c2f 7461 626c 653e  td></tr></table>
-00075b00: 3c2f 666f 6e74 3e27 2c0d 0a20 2020 2020  </font>',..     
-00075b10: 2020 2022 7765 656b 223a 2020 273c 666f     "week":  '<fo
-00075b20: 6e74 2063 6f6c 6f72 3d22 2528 4667 436f  nt color="%(FgCo
-00075b30: 6c6f 7572 2973 2220 7369 7a65 3d32 3e3c  lour)s" size=2><
-00075b40: 7461 626c 6520 7769 6474 683d 2231 3030  table width="100
-00075b50: 2525 223e 3c74 723e 3c74 6420 6e6f 7772  %%"><tr><td nowr
-00075b60: 6170 3e26 6e62 7370 3b26 6e62 7370 3b26  ap>&nbsp;&nbsp;&
-00075b70: 6e62 7370 3b26 6e62 7370 3b3c 623e 2528  nbsp;&nbsp;<b>%(
-00075b80: 6c61 6265 6c29 733c 2f62 3e3c 2f74 643e  label)s</b></td>
-00075b90: 3c74 6420 616c 6967 6e3d 2272 6967 6874  <td align="right
-00075ba0: 223e 3c66 6f6e 7420 636f 6c6f 723d 2225  "><font color="%
-00075bb0: 2844 6973 6162 6c65 6443 6f6c 6f75 7229  (DisabledColour)
-00075bc0: 7322 2073 697a 653d 313e 2528 636f 756e  s" size=1>%(coun
-00075bd0: 7429 733c 2f66 6f6e 743e 3c2f 7464 3e3c  t)s</font></td><
-00075be0: 2f74 723e 3c2f 7461 626c 653e 3c2f 666f  /tr></table></fo
-00075bf0: 6e74 3e27 2c0d 0a20 2020 207d 0d0a 0d0a  nt>',..    }....
-00075c00: 0d0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
-00075c10: 5f5f 2873 656c 662c 2070 6172 656e 742c  __(self, parent,
-00075c20: 2069 643d 7778 2e49 445f 414e 592c 2070   id=wx.ID_ANY, p
-00075c30: 6f73 3d77 782e 4465 6661 756c 7450 6f73  os=wx.DefaultPos
-00075c40: 6974 696f 6e2c 0d0a 2020 2020 2020 2020  ition,..        
-00075c50: 2020 2020 2020 2020 2073 697a 653d 7778           size=wx
-00075c60: 2e44 6566 6175 6c74 5369 7a65 293a 0d0a  .DefaultSize):..
-00075c70: 2020 2020 2020 2020 7375 7065 7228 4368          super(Ch
-00075c80: 6174 436f 6e74 656e 7454 696d 656c 696e  atContentTimelin
-00075c90: 652c 2073 656c 6629 2e5f 5f69 6e69 745f  e, self).__init_
-00075ca0: 5f28 7061 7265 6e74 2c20 6964 2c20 706f  _(parent, id, po
-00075cb0: 732c 2073 697a 6529 0d0a 2020 2020 2020  s, size)..      
-00075cc0: 2020 7365 6c66 2e5f 7469 6d65 6c69 6e65    self._timeline
-00075cd0: 203d 205b 5d20 2020 2020 2023 205b 7b64   = []      # [{d
-00075ce0: 742c 206c 6162 656c 2c20 756e 6974 2c20  t, label, unit, 
-00075cf0: 6d65 7373 6167 652c 203f 6c61 6265 6c32  message, ?label2
-00075d00: 7d2c 205d 0d0a 2020 2020 2020 2020 7365  }, ]..        se
-00075d10: 6c66 2e5f 756e 6974 7320 3d20 2829 2020  lf._units = ()  
-00075d20: 2020 2020 2020 2023 2028 746f 7020 756e         # (top un
-00075d30: 6974 2c20 3f73 7562 756e 6974 290d 0a20  it, ?subunit).. 
-00075d40: 2020 2020 2020 2073 656c 662e 5f68 6967         self._hig
-00075d50: 686c 6967 6874 7320 3d20 7365 7428 2920  hlights = set() 
-00075d60: 2320 5b69 6e64 6578 206f 6620 6869 6768  # [index of high
-00075d70: 6c69 6768 7465 6420 726f 772c 205d 0d0a  lighted row, ]..
-00075d80: 2020 2020 2020 2020 7365 6c66 2e5f 7472          self._tr
-00075d90: 6163 6b69 6e67 203d 2054 7275 6520 2020  acking = True   
-00075da0: 2023 2053 6372 6f6c 6c20 6869 6768 6c69   # Scroll highli
-00075db0: 6768 7473 2069 6e74 6f20 7669 6577 0d0a  ghts into view..
-00075dc0: 2020 2020 2020 2020 436f 6c6f 7572 4d61          ColourMa
-00075dd0: 6e61 6765 722e 4d61 6e61 6765 2873 656c  nager.Manage(sel
-00075de0: 662c 2022 4261 636b 6772 6f75 6e64 436f  f, "BackgroundCo
-00075df0: 6c6f 7572 222c 2022 4267 436f 6c6f 7572  lour", "BgColour
-00075e00: 2229 0d0a 2020 2020 2020 2020 7365 6c66  ")..        self
-00075e10: 2e42 696e 6428 7778 2e45 5654 5f4c 4953  .Bind(wx.EVT_LIS
-00075e20: 5442 4f58 2c20 7365 6c66 2e5f 4f6e 5365  TBOX, self._OnSe
-00075e30: 6c65 6374 290d 0a0d 0a0d 0a20 2020 2064  lect)......    d
-00075e40: 6566 2050 6f70 756c 6174 6528 7365 6c66  ef Populate(self
-00075e50: 2c20 7469 6d65 6c69 6e65 2c20 756e 6974  , timeline, unit
-00075e60: 7329 3a0d 0a20 2020 2020 2020 2022 2222  s):..        """
-00075e70: 0d0a 2020 2020 2020 2020 506f 7075 6c61  ..        Popula
-00075e80: 7465 7320 7469 6d65 6c69 6e65 2066 726f  tes timeline fro
-00075e90: 6d20 7061 7273 6572 2073 7461 7473 2e0d  m parser stats..
-00075ea0: 0a0d 0a20 2020 2020 2020 2040 7061 7261  ...        @para
-00075eb0: 6d20 2020 7469 6d65 6c69 6e65 2020 5b7b  m   timeline  [{
-00075ec0: 6474 2c20 6c61 6265 6c2c 2075 6e69 742c  dt, label, unit,
-00075ed0: 206d 6573 7361 6765 732c 203f 6c61 6265   messages, ?labe
-00075ee0: 6c32 7d5d 0d0a 2020 2020 2020 2020 2222  l2}]..        ""
-00075ef0: 220d 0a20 2020 2020 2020 2073 656c 662e  "..        self.
-00075f00: 5365 7428 5b5d 290d 0a20 2020 2020 2020  Set([])..       
-00075f10: 2073 656c 662e 5f68 6967 686c 6967 6874   self._highlight
-00075f20: 732e 636c 6561 7228 290d 0a20 2020 2020  s.clear()..     
-00075f30: 2020 2073 656c 662e 5f74 696d 656c 696e     self._timelin
-00075f40: 655b 3a5d 203d 205b 6469 6374 2878 2c20  e[:] = [dict(x, 
-00075f50: 6d65 7373 6167 653d 785b 226d 6573 7361  message=x["messa
-00075f60: 6765 7322 5d5b 305d 2920 666f 7220 7820  ges"][0]) for x 
-00075f70: 696e 2074 696d 656c 696e 655d 0d0a 2020  in timeline]..  
-00075f80: 2020 2020 2020 7365 6c66 2e5f 756e 6974        self._unit
-00075f90: 7320 2020 2020 2020 3d20 756e 6974 730d  s       = units.
-00075fa0: 0a20 2020 2020 2020 2066 6f72 2078 2069  .        for x i
-00075fb0: 6e20 7365 6c66 2e5f 7469 6d65 6c69 6e65  n self._timeline
-00075fc0: 3a20 782e 706f 7028 226d 6573 7361 6765  : x.pop("message
-00075fd0: 7322 290d 0a20 2020 2020 2020 2073 656c  s")..        sel
-00075fe0: 662e 5265 6672 6573 6849 7465 6d73 2829  f.RefreshItems()
-00075ff0: 0d0a 0d0a 0d0a 2020 2020 6465 6620 4765  ......    def Ge
-00076000: 744d 6573 7361 6765 2873 656c 662c 2069  tMessage(self, i
-00076010: 6e64 6578 293a 0d0a 2020 2020 2020 2020  ndex):..        
-00076020: 2222 2252 6574 7572 6e73 206d 6573 7361  """Returns messa
-00076030: 6765 2049 4420 666f 7220 6974 656d 2061  ge ID for item a
-00076040: 7420 7370 6563 6966 6965 6420 696e 6465  t specified inde
-00076050: 782e 2222 220d 0a20 2020 2020 2020 2069  x."""..        i
-00076060: 6620 696e 6465 7820 3c20 303a 2069 6e64  f index < 0: ind
-00076070: 6578 2025 3d20 6c65 6e28 7365 6c66 2e5f  ex %= len(self._
-00076080: 7469 6d65 6c69 6e65 290d 0a20 2020 2020  timeline)..     
-00076090: 2020 2069 6620 696e 6465 7820 3e3d 206c     if index >= l
-000760a0: 656e 2873 656c 662e 5f74 696d 656c 696e  en(self._timelin
-000760b0: 6529 3a20 7265 7475 726e 204e 6f6e 650d  e): return None.
-000760c0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000760d0: 7365 6c66 2e5f 7469 6d65 6c69 6e65 5b69  self._timeline[i
-000760e0: 6e64 6578 5d5b 226d 6573 7361 6765 225d  ndex]["message"]
-000760f0: 0d0a 0d0a 0d0a 2020 2020 6465 6620 5265  ......    def Re
-00076100: 6672 6573 6849 7465 6d73 2873 656c 6629  freshItems(self)
-00076110: 3a0d 0a20 2020 2020 2020 2022 2222 5265  :..        """Re
-00076120: 6472 6177 7320 616c 6c20 6375 7272 656e  draws all curren
-00076130: 7420 6974 656d 732e 2222 220d 0a20 2020  t items."""..   
-00076140: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
-00076150: 2e49 7353 686f 776e 4f6e 5363 7265 656e  .IsShownOnScreen
-00076160: 2829 3a20 7265 7475 726e 0d0a 0d0a 2020  (): return....  
-00076170: 2020 2020 2020 636f 756e 7430 2c20 7365        count0, se
-00076180: 6c65 6374 6564 3020 3d20 7365 6c66 2e52  lected0 = self.R
-00076190: 6f77 436f 756e 742c 2073 656c 662e 5365  owCount, self.Se
-000761a0: 6c65 6374 696f 6e0d 0a20 2020 2020 2020  lection..       
-000761b0: 2070 6f73 3020 3d20 7365 6c66 2e47 6574   pos0 = self.Get
-000761c0: 5363 726f 6c6c 506f 7328 7778 2e56 4552  ScrollPos(wx.VER
-000761d0: 5449 4341 4c29 0d0a 2020 2020 2020 2020  TICAL)..        
-000761e0: 7365 6c66 2e46 7265 657a 6528 290d 0a20  self.Freeze().. 
-000761f0: 2020 2020 2020 2074 7279 3a0d 0a20 2020         try:..   
-00076200: 2020 2020 2020 2020 2073 656c 662e 5365           self.Se
-00076210: 7428 5b5d 290d 0a20 2020 2020 2020 2020  t([])..         
-00076220: 2020 2066 6f72 2069 2c20 6464 6963 7420     for i, ddict 
-00076230: 696e 2065 6e75 6d65 7261 7465 2873 656c  in enumerate(sel
-00076240: 662e 5f74 696d 656c 696e 6529 3a0d 0a20  f._timeline):.. 
-00076250: 2020 2020 2020 2020 2020 2020 2020 2046                 F
-00076260: 4f52 4d41 5453 203d 2073 656c 662e 4c49  ORMATS = self.LI
-00076270: 4e45 5f46 4f52 4d41 5453 5f48 4947 484c  NE_FORMATS_HIGHL
-00076280: 4947 4854 2069 6620 6920 696e 2073 656c  IGHT if i in sel
-00076290: 662e 5f68 6967 686c 6967 6874 7320 5c0d  f._highlights \.
-000762a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000762b0: 2020 2020 2020 2020 2020 2065 6c73 6520             else 
-000762c0: 7365 6c66 2e4c 494e 455f 464f 524d 4154  self.LINE_FORMAT
-000762d0: 530d 0a20 2020 2020 2020 2020 2020 2020  S..             
-000762e0: 2020 206c 6162 656c 203d 2046 4f52 4d41     label = FORMA
-000762f0: 5453 5b64 6469 6374 5b22 756e 6974 225d  TS[ddict["unit"]
-00076300: 5d20 2520 6469 6374 2876 6172 7328 636f  ] % dict(vars(co
-00076310: 6e66 292c 202a 2a64 6469 6374 290d 0a20  nf), **ddict).. 
-00076320: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00076330: 656c 662e 4170 7065 6e64 286c 6162 656c  elf.Append(label
-00076340: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
-00076350: 6620 636f 756e 7430 3a0d 0a20 2020 2020  f count0:..     
-00076360: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00076370: 5365 6c65 6374 696f 6e20 3d20 7365 6c65  Selection = sele
-00076380: 6374 6564 300d 0a20 2020 2020 2020 2020  cted0..         
-00076390: 2020 2020 2020 2073 656c 662e 5363 726f         self.Scro
-000763a0: 6c6c 546f 526f 7728 706f 7330 290d 0a20  llToRow(pos0).. 
-000763b0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-000763c0: 2073 656c 662e 5363 726f 6c6c 546f 526f   self.ScrollToRo
-000763d0: 7728 2d31 290d 0a20 2020 2020 2020 2066  w(-1)..        f
-000763e0: 696e 616c 6c79 3a20 7365 6c66 2e54 6861  inally: self.Tha
-000763f0: 7728 290d 0a0d 0a0d 0a20 2020 2064 6566  w()......    def
-00076400: 2052 6566 7265 7368 4974 656d 2873 656c   RefreshItem(sel
-00076410: 662c 2069 6e64 6578 293a 0d0a 2020 2020  f, index):..    
-00076420: 2020 2020 2222 2252 6564 7261 7773 2074      """Redraws t
-00076430: 6865 2073 7065 6369 6669 6564 2072 6f77  he specified row
-00076440: 2e22 2222 0d0a 2020 2020 2020 2020 464f  ."""..        FO
-00076450: 524d 4154 5320 3d20 7365 6c66 2e4c 494e  RMATS = self.LIN
-00076460: 455f 464f 524d 4154 535f 4849 4748 4c49  E_FORMATS_HIGHLI
-00076470: 4748 5420 6966 2069 6e64 6578 2069 6e20  GHT if index in 
-00076480: 7365 6c66 2e5f 6869 6768 6c69 6768 7473  self._highlights
-00076490: 205c 0d0a 2020 2020 2020 2020 2020 2020   \..            
-000764a0: 2020 2020 2020 656c 7365 2073 656c 662e        else self.
-000764b0: 4c49 4e45 5f46 4f52 4d41 5453 0d0a 2020  LINE_FORMATS..  
-000764c0: 2020 2020 2020 6464 6963 7420 3d20 7365        ddict = se
-000764d0: 6c66 2e5f 7469 6d65 6c69 6e65 5b69 6e64  lf._timeline[ind
-000764e0: 6578 5d0d 0a20 2020 2020 2020 206c 6162  ex]..        lab
-000764f0: 656c 203d 2046 4f52 4d41 5453 5b64 6469  el = FORMATS[ddi
-00076500: 6374 5b22 756e 6974 225d 5d20 2520 6469  ct["unit"]] % di
-00076510: 6374 2876 6172 7328 636f 6e66 292c 202a  ct(vars(conf), *
-00076520: 2a64 6469 6374 290d 0a20 2020 2020 2020  *ddict)..       
-00076530: 2073 656c 662e 5365 7453 7472 696e 6728   self.SetString(
-00076540: 696e 6465 782c 206c 6162 656c 290d 0a0d  index, label)...
-00076550: 0a0d 0a20 2020 2064 6566 2048 6967 686c  ...    def Highl
-00076560: 6967 6874 526f 7773 2873 656c 662c 206d  ightRows(self, m
-00076570: 6573 7361 6765 7329 3a0d 0a20 2020 2020  essages):..     
-00076580: 2020 2022 2222 4869 6768 6c69 6768 7473     """Highlights
-00076590: 2074 6865 2072 6f77 7320 7468 6174 2063   the rows that c
-000765a0: 6f76 6572 206d 6573 7361 6765 2074 696d  over message tim
-000765b0: 6573 7461 6d70 732e 2222 220d 0a20 2020  estamps."""..   
-000765c0: 2020 2020 2068 6967 686c 6967 6874 732c       highlights,
-000765d0: 2072 6f6f 7469 203d 2073 6574 2829 2c20   rooti = set(), 
-000765e0: 4e6f 6e65 0d0a 2020 2020 2020 2020 6461  None..        da
-000765f0: 7465 7320 3d20 5b78 5b22 6474 225d 2066  tes = [x["dt"] f
-00076600: 6f72 2078 2069 6e20 7365 6c66 2e5f 7469  or x in self._ti
-00076610: 6d65 6c69 6e65 5d20 2b20 5b64 6174 6574  meline] + [datet
-00076620: 696d 652e 6461 7465 7469 6d65 2e6d 6178  ime.datetime.max
-00076630: 5d0d 0a20 2020 2020 2020 2066 6f72 206d  ]..        for m
-00076640: 2069 6e20 6d65 7373 6167 6573 3a0d 0a20   in messages:.. 
-00076650: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
-00076660: 2c20 6474 3120 696e 2065 6e75 6d65 7261  , dt1 in enumera
-00076670: 7465 2864 6174 6573 5b3a 2d31 5d29 3a0d  te(dates[:-1]):.
-00076680: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00076690: 2069 6620 7365 6c66 2e5f 7469 6d65 6c69   if self._timeli
-000766a0: 6e65 5b69 5d5b 2275 6e69 7422 5d20 213d  ne[i]["unit"] !=
-000766b0: 2073 656c 662e 5f75 6e69 7473 5b2d 315d   self._units[-1]
-000766c0: 3a20 726f 6f74 6920 3d20 690d 0a20 2020  : rooti = i..   
-000766d0: 2020 2020 2020 2020 2020 2020 2064 7432               dt2
-000766e0: 203d 2064 6174 6573 5b69 202b 2031 5d20   = dates[i + 1] 
-000766f0: 6966 2064 6174 6573 5b69 202b 2031 5d20  if dates[i + 1] 
-00076700: 213d 2064 7431 2065 6c73 6520 6461 7465  != dt1 else date
-00076710: 735b 6920 2b20 325d 0d0a 2020 2020 2020  s[i + 2]..      
-00076720: 2020 2020 2020 2020 2020 6966 2064 7431            if dt1
-00076730: 203c 3d20 6d5b 2264 6174 6574 696d 6522   <= m["datetime"
-00076740: 5d20 3c20 6474 323a 0d0a 2020 2020 2020  ] < dt2:..      
-00076750: 2020 2020 2020 2020 2020 2020 2020 6869                hi
-00076760: 6768 6c69 6768 7473 2e61 6464 2869 290d  ghlights.add(i).
-00076770: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00076780: 2020 2020 2069 6620 726f 6f74 6920 6973       if rooti is
-00076790: 206e 6f74 204e 6f6e 653a 2068 6967 686c   not None: highl
-000767a0: 6967 6874 732e 6164 6428 726f 6f74 6929  ights.add(rooti)
-000767b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000767c0: 2020 6966 2064 6174 6573 5b69 202b 2031    if dates[i + 1
-000767d0: 5d20 3e20 6d5b 2264 6174 6574 696d 6522  ] > m["datetime"
-000767e0: 5d3a 2062 7265 616b 2023 2066 6f72 2069  ]: break # for i
-000767f0: 2c20 6474 310d 0a20 2020 2020 2020 2069  , dt1..        i
-00076800: 6620 6869 6768 6c69 6768 7473 203d 3d20  f highlights == 
-00076810: 7365 6c66 2e5f 6869 6768 6c69 6768 7473  self._highlights
-00076820: 3a20 7265 7475 726e 0d0a 0d0a 2020 2020  : return....    
-00076830: 2020 2020 756e 6869 6768 6c69 6768 7420      unhighlight 
-00076840: 3d20 7365 6c66 2e5f 6869 6768 6c69 6768  = self._highligh
-00076850: 7473 202d 2068 6967 686c 6967 6874 730d  ts - highlights.
-00076860: 0a20 2020 2020 2020 2064 6f68 6967 686c  .        dohighl
-00076870: 6967 6874 203d 2068 6967 686c 6967 6874  ight = highlight
-00076880: 7320 2d20 7365 6c66 2e5f 6869 6768 6c69  s - self._highli
-00076890: 6768 7473 0d0a 2020 2020 2020 2020 7365  ghts..        se
-000768a0: 6c66 2e5f 6869 6768 6c69 6768 7473 203d  lf._highlights =
-000768b0: 2068 6967 686c 6967 6874 730d 0a20 2020   highlights..   
-000768c0: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
-000768d0: 2e49 7353 686f 776e 4f6e 5363 7265 656e  .IsShownOnScreen
-000768e0: 2829 3a20 7265 7475 726e 0d0a 0d0a 2020  (): return....  
-000768f0: 2020 2020 2020 7365 6c66 2e46 7265 657a        self.Freez
-00076900: 6528 290d 0a20 2020 2020 2020 2074 7279  e()..        try
-00076910: 3a0d 0a20 2020 2020 2020 2020 2020 2066  :..            f
-00076920: 6f72 2069 2069 6e20 756e 6869 6768 6c69  or i in unhighli
-00076930: 6768 743a 2073 656c 662e 5265 6672 6573  ght: self.Refres
-00076940: 6849 7465 6d28 6929 0d0a 2020 2020 2020  hItem(i)..      
-00076950: 2020 2020 2020 666f 7220 6920 696e 2064        for i in d
-00076960: 6f68 6967 686c 6967 6874 3a20 7365 6c66  ohighlight: self
-00076970: 2e52 6566 7265 7368 4974 656d 2869 290d  .RefreshItem(i).
-00076980: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00076990: 6e6f 7420 7365 6c66 2e5f 7472 6163 6b69  not self._tracki
-000769a0: 6e67 3a20 7265 7475 726e 0d0a 0d0a 2020  ng: return....  
-000769b0: 2020 2020 2020 2020 2020 2320 536b 6970            # Skip
-000769c0: 2072 6f6f 7420 6c69 6e65 732c 2061 7320   root lines, as 
-000769d0: 7468 6579 2063 616e 2068 6176 6520 6d6f  they can have mo
-000769e0: 7265 2063 6869 6c64 7265 6e20 7468 616e  re children than
-000769f0: 2066 6974 7320 696e 2076 6965 770d 0a20   fits in view.. 
-00076a00: 2020 2020 2020 2020 2020 2074 7261 636b             track
-00076a10: 6c69 6e65 7320 3d20 736f 7274 6564 2869  lines = sorted(i
-00076a20: 2066 6f72 2069 2069 6e20 6869 6768 6c69   for i in highli
-00076a30: 6768 7473 0d0a 2020 2020 2020 2020 2020  ghts..          
-00076a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00076a50: 2020 2020 2020 6966 2073 656c 662e 5f74        if self._t
-00076a60: 696d 656c 696e 655b 695d 5b22 756e 6974  imeline[i]["unit
-00076a70: 225d 203d 3d20 7365 6c66 2e5f 756e 6974  "] == self._unit
-00076a80: 735b 2d31 5d29 0d0a 2020 2020 2020 2020  s[-1])..        
-00076a90: 2020 2020 7673 7061 6e20 3d20 7365 6c66      vspan = self
-00076aa0: 2e56 6973 6962 6c65 4265 6769 6e2c 2073  .VisibleBegin, s
-00076ab0: 656c 662e 5669 7369 626c 6545 6e64 0d0a  elf.VisibleEnd..
-00076ac0: 2020 2020 2020 2020 2020 2020 2320 5363              # Sc
-00076ad0: 726f 6c6c 2068 6967 686c 6967 6874 7320  roll highlights 
-00076ae0: 696e 746f 2076 6965 772c 2070 6c75 7320  into view, plus 
-00076af0: 6f6e 6520 726f 7720 6f66 2070 6164 6469  one row of paddi
-00076b00: 6e67 0d0a 2020 2020 2020 2020 2020 2020  ng..            
-00076b10: 6966 206e 6f74 2061 6c6c 2876 7370 616e  if not all(vspan
-00076b20: 5b30 5d20 3c3d 2069 202d 2031 203c 3d20  [0] <= i - 1 <= 
-00076b30: 7673 7061 6e5b 315d 2061 6e64 0d0a 2020  vspan[1] and..  
-00076b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00076b50: 2020 2020 2076 7370 616e 5b30 5d20 3c3d       vspan[0] <=
-00076b60: 2069 202b 2031 203c 3d20 7673 7061 6e5b   i + 1 <= vspan[
-00076b70: 315d 2066 6f72 2069 2069 6e20 7472 6163  1] for i in trac
-00076b80: 6b6c 696e 6573 293a 0d0a 2020 2020 2020  klines):..      
-00076b90: 2020 2020 2020 2020 2020 6966 2061 6c6c            if all
-00076ba0: 2876 7370 616e 5b30 5d20 3c20 6920 666f  (vspan[0] < i fo
-00076bb0: 7220 6920 696e 2074 7261 636b 6c69 6e65  r i in trackline
-00076bc0: 7329 3a20 2320 446f 776e 7761 7264 0d0a  s): # Downward..
-00076bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00076be0: 2020 2020 7365 6c66 2e53 6372 6f6c 6c52      self.ScrollR
-00076bf0: 6f77 7328 7472 6163 6b6c 696e 6573 5b2d  ows(tracklines[-
-00076c00: 315d 202d 2076 7370 616e 5b31 5d20 2b20  1] - vspan[1] + 
-00076c10: 3129 0d0a 2020 2020 2020 2020 2020 2020  1)..            
-00076c20: 2020 2020 656c 7365 3a20 7365 6c66 2e53      else: self.S
-00076c30: 6372 6f6c 6c54 6f52 6f77 286d 6178 2830  crollToRow(max(0
-00076c40: 2c20 7472 6163 6b6c 696e 6573 5b30 5d20  , tracklines[0] 
-00076c50: 2d20 3129 290d 0a20 2020 2020 2020 2066  - 1))..        f
-00076c60: 696e 616c 6c79 3a20 7365 6c66 2e54 6861  inally: self.Tha
-00076c70: 7728 290d 0a0d 0a0d 0a20 2020 2064 6566  w()......    def
-00076c80: 2047 6574 5669 7369 626c 6545 6e64 2873   GetVisibleEnd(s
-00076c90: 656c 6629 3a0d 0a20 2020 2020 2020 2022  elf):..        "
-00076ca0: 2222 5265 7475 726e 7320 7468 6520 696e  ""Returns the in
-00076cb0: 6465 7820 6f66 2074 6865 206c 6173 7420  dex of the last 
-00076cc0: 6675 6c6c 7920 7669 7369 626c 6520 726f  fully visible ro
-00076cd0: 772e 2222 220d 0a0d 0a20 2020 2020 2020  w."""....       
-00076ce0: 2023 2047 6574 5669 7369 626c 6545 6e64   # GetVisibleEnd
-00076cf0: 2064 6566 6175 6c74 2069 6d70 6c65 6d65   default impleme
-00076d00: 6e74 6174 696f 6e20 6973 2069 6d70 7265  ntation is impre
-00076d10: 6369 7365 0d0a 2020 2020 2020 2020 682c  cise..        h,
-00076d20: 206d 6178 682c 206c 696e 6570 7265 7620   maxh, lineprev 
-00076d30: 3d20 302c 2073 656c 662e 5369 7a65 2e48  = 0, self.Size.H
-00076d40: 6569 6768 742c 2073 656c 662e 4669 7273  eight, self.Firs
-00076d50: 7456 6973 6962 6c65 4c69 6e65 0d0a 2020  tVisibleLine..  
-00076d60: 2020 2020 2020 666f 7220 6c69 6e65 2069        for line i
-00076d70: 6e20 7261 6e67 6528 7365 6c66 2e46 6972  n range(self.Fir
-00076d80: 7374 5669 7369 626c 654c 696e 652c 2073  stVisibleLine, s
-00076d90: 656c 662e 526f 7743 6f75 6e74 293a 0d0a  elf.RowCount):..
-00076da0: 2020 2020 2020 2020 2020 2020 6820 2b3d              h +=
-00076db0: 2073 656c 662e 4f6e 4765 7452 6f77 4865   self.OnGetRowHe
-00076dc0: 6967 6874 286c 696e 6529 0d0a 2020 2020  ight(line)..    
-00076dd0: 2020 2020 2020 2020 6966 2068 203e 206d          if h > m
-00076de0: 6178 683a 2072 6574 7572 6e20 6c69 6e65  axh: return line
-00076df0: 7072 6576 0d0a 2020 2020 2020 2020 2020  prev..          
-00076e00: 2020 6c69 6e65 7072 6576 203d 206c 696e    lineprev = lin
-00076e10: 650d 0a20 2020 2020 2020 2072 6574 7572  e..        retur
-00076e20: 6e20 6c69 6e65 7072 6576 0d0a 2020 2020  n lineprev..    
-00076e30: 5669 7369 626c 6545 6e64 203d 2070 726f  VisibleEnd = pro
-00076e40: 7065 7274 7928 4765 7456 6973 6962 6c65  perty(GetVisible
-00076e50: 456e 6429 0d0a 0d0a 0d0a 2020 2020 6465  End)......    de
-00076e60: 6620 4765 7453 656c 6563 7465 6454 6578  f GetSelectedTex
-00076e70: 7443 6f6c 6f75 7228 7365 6c66 2c20 2a61  tColour(self, *a
-00076e80: 7267 732c 202a 2a6b 7761 7267 7329 3a0d  rgs, **kwargs):.
-00076e90: 0a20 2020 2020 2020 2022 2222 4f76 6572  .        """Over
-00076ea0: 7269 6465 2076 6972 7475 616c 2066 756e  ride virtual fun
-00076eb0: 6374 696f 6e20 746f 2066 6f72 6365 2070  ction to force p
-00076ec0: 726f 7065 7220 6869 6768 6c69 6768 7420  roper highlight 
-00076ed0: 636f 6c6f 7572 2e22 2222 0d0a 2020 2020  colour."""..    
-00076ee0: 2020 2020 7265 7475 726e 2043 6f6c 6f75      return Colou
-00076ef0: 724d 616e 6167 6572 2e47 6574 436f 6c6f  rManager.GetColo
-00076f00: 7572 2877 782e 5359 535f 434f 4c4f 5552  ur(wx.SYS_COLOUR
-00076f10: 5f48 4947 484c 4947 4854 5445 5854 290d  _HIGHLIGHTTEXT).
-00076f20: 0a0d 0a0d 0a20 2020 2064 6566 205f 4f6e  .....    def _On
-00076f30: 5365 6c65 6374 2873 656c 662c 2065 7665  Select(self, eve
-00076f40: 6e74 293a 0d0a 2020 2020 2020 2020 2222  nt):..        ""
-00076f50: 2248 616e 646c 6572 2066 6f72 2073 656c  "Handler for sel
-00076f60: 6563 7469 6e67 2061 6e20 6974 656d 2c20  ecting an item, 
-00076f70: 736b 6970 7320 7363 726f 6c6c 206f 6e20  skips scroll on 
-00076f80: 6e65 7874 2068 6967 686c 6967 6874 2e22  next highlight."
-00076f90: 2222 0d0a 2020 2020 2020 2020 6576 656e  ""..        even
-00076fa0: 742e 536b 6970 2829 0d0a 2020 2020 2020  t.Skip()..      
-00076fb0: 2020 7365 6c66 2e5f 7472 6163 6b69 6e67    self._tracking
-00076fc0: 203d 2046 616c 7365 0d0a 2020 2020 2020   = False..      
-00076fd0: 2020 7778 2e43 616c 6c4c 6174 6572 2835    wx.CallLater(5
-00076fe0: 3030 2c20 6c61 6d62 6461 3a20 7365 6c66  00, lambda: self
-00076ff0: 2061 6e64 2073 6574 6174 7472 2873 656c   and setattr(sel
-00077000: 662c 2022 5f74 7261 636b 696e 6722 2c20  f, "_tracking", 
-00077010: 5472 7565 2929 0d0a 0d0a 0d0a 0d0a 636c  True))........cl
-00077020: 6173 7320 4461 7948 6f75 7244 6961 6c6f  ass DayHourDialo
-00077030: 6728 7778 2e44 6961 6c6f 6729 3a0d 0a20  g(wx.Dialog):.. 
-00077040: 2020 2022 2222 506f 7075 7020 6469 616c     """Popup dial
-00077050: 6f67 2066 6f72 2065 6e74 6572 696e 6720  og for entering 
-00077060: 7477 6f20 7661 6c75 6573 2c20 6461 7973  two values, days
-00077070: 2061 6e64 2068 6f75 7273 2e22 2222 0d0a   and hours."""..
-00077080: 0d0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
-00077090: 5f5f 2873 656c 662c 2070 6172 656e 742c  __(self, parent,
-000770a0: 206d 6573 7361 6765 2c20 6361 7074 696f   message, captio
-000770b0: 6e2c 2064 6179 732c 2068 6f75 7273 293a  n, days, hours):
-000770c0: 0d0a 2020 2020 2020 2020 7778 2e44 6961  ..        wx.Dia
-000770d0: 6c6f 672e 5f5f 696e 6974 5f5f 2873 656c  log.__init__(sel
-000770e0: 662c 2070 6172 656e 743d 7061 7265 6e74  f, parent=parent
-000770f0: 2c20 7469 746c 653d 6361 7074 696f 6e2c  , title=caption,
-00077100: 2073 697a 653d 2832 3530 2c20 3230 3029   size=(250, 200)
-00077110: 290d 0a0d 0a20 2020 2020 2020 2076 626f  )....        vbo
-00077120: 7820 3d20 7365 6c66 2e53 697a 6572 203d  x = self.Sizer =
-00077130: 2077 782e 426f 7853 697a 6572 2877 782e   wx.BoxSizer(wx.
-00077140: 5645 5254 4943 414c 290d 0a0d 0a20 2020  VERTICAL)....   
-00077150: 2020 2020 2073 656c 662e 7465 7874 5f64       self.text_d
-00077160: 6179 7320 3d20 7778 2e53 7069 6e43 7472  ays = wx.SpinCtr
-00077170: 6c28 7061 7265 6e74 3d73 656c 662c 2073  l(parent=self, s
-00077180: 7479 6c65 3d77 782e 414c 4947 4e5f 4c45  tyle=wx.ALIGN_LE
-00077190: 4654 2c0d 0a20 2020 2020 2020 2020 2020  FT,..           
-000771a0: 2073 697a 653d 2832 3030 2c20 2d31 292c   size=(200, -1),
-000771b0: 2076 616c 7565 3d73 7472 2864 6179 7329   value=str(days)
-000771c0: 2c20 6d69 6e3d 2d73 7973 2e6d 6178 7369  , min=-sys.maxsi
-000771d0: 7a65 2c20 6d61 783d 7379 732e 6d61 7873  ze, max=sys.maxs
-000771e0: 697a 650d 0a20 2020 2020 2020 2029 0d0a  ize..        )..
-000771f0: 2020 2020 2020 2020 6862 6f78 3120 3d20          hbox1 = 
-00077200: 7778 2e42 6f78 5369 7a65 7228 7778 2e48  wx.BoxSizer(wx.H
-00077210: 4f52 495a 4f4e 5441 4c29 0d0a 2020 2020  ORIZONTAL)..    
-00077220: 2020 2020 6862 6f78 312e 4164 6453 7472      hbox1.AddStr
-00077230: 6574 6368 5370 6163 6572 2829 0d0a 2020  etchSpacer()..  
-00077240: 2020 2020 2020 6862 6f78 312e 4164 6428        hbox1.Add(
-00077250: 7778 2e53 7461 7469 6354 6578 7428 7061  wx.StaticText(pa
-00077260: 7265 6e74 3d73 656c 662c 206c 6162 656c  rent=self, label
-00077270: 3d22 4461 7973 3a22 292c 0d0a 2020 2020  ="Days:"),..    
-00077280: 2020 2020 2020 2020 666c 6167 3d77 782e          flag=wx.
-00077290: 414c 4947 4e5f 4345 4e54 4552 5f56 4552  ALIGN_CENTER_VER
-000772a0: 5449 4341 4c29 0d0a 2020 2020 2020 2020  TICAL)..        
-000772b0: 6862 6f78 312e 4164 6428 7365 6c66 2e74  hbox1.Add(self.t
-000772c0: 6578 745f 6461 7973 2c20 626f 7264 6572  ext_days, border
-000772d0: 3d35 2c20 666c 6167 3d77 782e 4c45 4654  =5, flag=wx.LEFT
-000772e0: 290d 0a0d 0a20 2020 2020 2020 2073 656c  )....        sel
-000772f0: 662e 7465 7874 5f68 6f75 7273 203d 2077  f.text_hours = w
-00077300: 782e 5370 696e 4374 726c 2870 6172 656e  x.SpinCtrl(paren
-00077310: 743d 7365 6c66 2c20 7374 796c 653d 7778  t=self, style=wx
-00077320: 2e41 4c49 474e 5f4c 4546 542c 0d0a 2020  .ALIGN_LEFT,..  
-00077330: 2020 2020 2020 2020 2073 697a 653d 2832           size=(2
-00077340: 3030 2c20 2d31 292c 2076 616c 7565 3d73  00, -1), value=s
-00077350: 7472 2868 6f75 7273 292c 206d 696e 3d2d  tr(hours), min=-
-00077360: 7379 732e 6d61 7873 697a 652c 206d 6178  sys.maxsize, max
-00077370: 3d73 7973 2e6d 6178 7369 7a65 290d 0a20  =sys.maxsize).. 
-00077380: 2020 2020 2020 2068 626f 7832 203d 2077         hbox2 = w
-00077390: 782e 426f 7853 697a 6572 2877 782e 484f  x.BoxSizer(wx.HO
-000773a0: 5249 5a4f 4e54 414c 290d 0a20 2020 2020  RIZONTAL)..     
-000773b0: 2020 2068 626f 7832 2e41 6464 5374 7265     hbox2.AddStre
-000773c0: 7463 6853 7061 6365 7228 290d 0a20 2020  tchSpacer()..   
-000773d0: 2020 2020 2068 626f 7832 2e41 6464 2877       hbox2.Add(w
-000773e0: 782e 5374 6174 6963 5465 7874 2870 6172  x.StaticText(par
-000773f0: 656e 743d 7365 6c66 2c20 6c61 6265 6c3d  ent=self, label=
-00077400: 2248 6f75 7273 3a22 292c 0d0a 2020 2020  "Hours:"),..    
-00077410: 2020 2020 2020 2020 2020 2020 2020 666c                fl
-00077420: 6167 3d77 782e 414c 4947 4e5f 4345 4e54  ag=wx.ALIGN_CENT
-00077430: 4552 5f56 4552 5449 4341 4c29 0d0a 2020  ER_VERTICAL)..  
-00077440: 2020 2020 2020 6862 6f78 322e 4164 6428        hbox2.Add(
-00077450: 7365 6c66 2e74 6578 745f 686f 7572 732c  self.text_hours,
-00077460: 2062 6f72 6465 723d 352c 2066 6c61 673d   border=5, flag=
-00077470: 7778 2e4c 4546 5429 0d0a 0d0a 2020 2020  wx.LEFT)....    
-00077480: 2020 2020 6275 7474 6f6e 5f6f 6b20 3d20      button_ok = 
-00077490: 7778 2e42 7574 746f 6e28 7365 6c66 2c20  wx.Button(self, 
-000774a0: 6c61 6265 6c3d 224f 4b22 290d 0a20 2020  label="OK")..   
-000774b0: 2020 2020 2062 7574 746f 6e5f 6361 6e63       button_canc
-000774c0: 656c 203d 2077 782e 4275 7474 6f6e 2873  el = wx.Button(s
-000774d0: 656c 662c 206c 6162 656c 3d22 4361 6e63  elf, label="Canc
-000774e0: 656c 222c 2069 643d 7778 2e49 445f 4341  el", id=wx.ID_CA
-000774f0: 4e43 454c 290d 0a20 2020 2020 2020 2068  NCEL)..        h
-00077500: 626f 7833 203d 2077 782e 426f 7853 697a  box3 = wx.BoxSiz
-00077510: 6572 2877 782e 484f 5249 5a4f 4e54 414c  er(wx.HORIZONTAL
-00077520: 290d 0a20 2020 2020 2020 2068 626f 7833  )..        hbox3
-00077530: 2e41 6464 5374 7265 7463 6853 7061 6365  .AddStretchSpace
-00077540: 7228 290d 0a20 2020 2020 2020 2068 626f  r()..        hbo
-00077550: 7833 2e41 6464 2862 7574 746f 6e5f 6f6b  x3.Add(button_ok
-00077560: 2c20 626f 7264 6572 3d35 2c20 666c 6167  , border=5, flag
-00077570: 3d77 782e 5249 4748 5429 0d0a 2020 2020  =wx.RIGHT)..    
-00077580: 2020 2020 6862 6f78 332e 4164 6428 6275      hbox3.Add(bu
-00077590: 7474 6f6e 5f63 616e 6365 6c2c 2062 6f72  tton_cancel, bor
-000775a0: 6465 723d 352c 2066 6c61 673d 7778 2e52  der=5, flag=wx.R
-000775b0: 4947 4854 290d 0a0d 0a20 2020 2020 2020  IGHT)....       
-000775c0: 2076 626f 782e 4164 6428 0d0a 2020 2020   vbox.Add(..    
-000775d0: 2020 2020 2020 2020 7778 2e53 7461 7469          wx.Stati
-000775e0: 6354 6578 7428 7061 7265 6e74 3d73 656c  cText(parent=sel
-000775f0: 662c 206c 6162 656c 3d6d 6573 7361 6765  f, label=message
-00077600: 292c 2062 6f72 6465 723d 3130 2c20 666c  ), border=10, fl
-00077610: 6167 3d77 782e 414c 4c29 0d0a 2020 2020  ag=wx.ALL)..    
-00077620: 2020 2020 7662 6f78 2e41 6464 5370 6163      vbox.AddSpac
-00077630: 6572 2835 290d 0a20 2020 2020 2020 2076  er(5)..        v
-00077640: 626f 782e 4164 6428 0d0a 2020 2020 2020  box.Add(..      
-00077650: 2020 2020 2020 6862 6f78 312c 2062 6f72        hbox1, bor
-00077660: 6465 723d 352c 2066 6c61 673d 7778 2e4c  der=5, flag=wx.L
-00077670: 4546 5420 7c20 7778 2e52 4947 4854 207c  EFT | wx.RIGHT |
-00077680: 2077 782e 424f 5454 4f4d 207c 2077 782e   wx.BOTTOM | wx.
-00077690: 4752 4f57 290d 0a20 2020 2020 2020 2076  GROW)..        v
-000776a0: 626f 782e 4164 6428 0d0a 2020 2020 2020  box.Add(..      
-000776b0: 2020 2020 2020 6862 6f78 322c 2062 6f72        hbox2, bor
-000776c0: 6465 723d 352c 2066 6c61 673d 7778 2e4c  der=5, flag=wx.L
-000776d0: 4546 5420 7c20 7778 2e52 4947 4854 207c  EFT | wx.RIGHT |
-000776e0: 2077 782e 424f 5454 4f4d 207c 2077 782e   wx.BOTTOM | wx.
-000776f0: 4752 4f57 290d 0a20 2020 2020 2020 2076  GROW)..        v
-00077700: 626f 782e 4164 6428 7778 2e53 7461 7469  box.Add(wx.Stati
-00077710: 634c 696e 6528 7365 6c66 292c 2062 6f72  cLine(self), bor
-00077720: 6465 723d 352c 2070 726f 706f 7274 696f  der=5, proportio
-00077730: 6e3d 312c 0d0a 2020 2020 2020 2020 2020  n=1,..          
-00077740: 2020 2020 2020 2066 6c61 673d 7778 2e4c         flag=wx.L
-00077750: 4546 5420 7c20 7778 2e52 4947 4854 207c  EFT | wx.RIGHT |
-00077760: 2077 782e 4752 4f57 290d 0a20 2020 2020   wx.GROW)..     
-00077770: 2020 2076 626f 782e 4164 6428 6862 6f78     vbox.Add(hbox
-00077780: 332c 2062 6f72 6465 723d 352c 2066 6c61  3, border=5, fla
-00077790: 673d 7778 2e41 4c4c 207c 2077 782e 4752  g=wx.ALL | wx.GR
-000777a0: 4f57 290d 0a0d 0a20 2020 2020 2020 2062  OW)....        b
-000777b0: 7574 746f 6e5f 6f6b 2e53 6574 4465 6661  utton_ok.SetDefa
-000777c0: 756c 7428 290d 0a20 2020 2020 2020 2062  ult()..        b
-000777d0: 7574 746f 6e5f 6f6b 2e42 696e 6428 7778  utton_ok.Bind(wx
-000777e0: 2e45 5654 5f42 5554 544f 4e2c 206c 616d  .EVT_BUTTON, lam
-000777f0: 6264 6120 653a 2073 656c 662e 456e 644d  bda e: self.EndM
-00077800: 6f64 616c 2877 782e 4944 5f4f 4b29 290d  odal(wx.ID_OK)).
-00077810: 0a20 2020 2020 2020 2062 7574 746f 6e5f  .        button_
-00077820: 6361 6e63 656c 2e42 696e 6428 7778 2e45  cancel.Bind(wx.E
-00077830: 5654 5f42 5554 544f 4e2c 206c 616d 6264  VT_BUTTON, lambd
-00077840: 6120 653a 7365 6c66 2e45 6e64 4d6f 6461  a e:self.EndModa
-00077850: 6c28 7778 2e49 445f 4341 4e43 454c 2929  l(wx.ID_CANCEL))
-00077860: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
-00077870: 2e4c 6179 6f75 7428 290d 0a20 2020 2020  .Layout()..     
-00077880: 2020 2073 656c 662e 5369 7a65 203d 2073     self.Size = s
-00077890: 656c 662e 4765 7445 6666 6563 7469 7665  elf.GetEffective
-000778a0: 4d69 6e53 697a 6528 290d 0a20 2020 2020  MinSize()..     
-000778b0: 2020 2073 656c 662e 4365 6e74 6572 4f6e     self.CenterOn
-000778c0: 5061 7265 6e74 2829 0d0a 0d0a 0d0a 2020  Parent()......  
-000778d0: 2020 6465 6620 4765 7456 616c 7565 7328    def GetValues(
-000778e0: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
-000778f0: 2222 2252 6574 7572 6e73 2074 6865 2065  """Returns the e
-00077900: 6e74 6572 6564 2064 6179 7320 616e 6420  ntered days and 
-00077910: 686f 7572 7320 6173 2061 2074 7570 6c65  hours as a tuple
-00077920: 206f 6620 696e 7465 6765 7273 2e22 2222   of integers."""
-00077930: 0d0a 2020 2020 2020 2020 6461 7973 203d  ..        days =
-00077940: 2073 656c 662e 7465 7874 5f64 6179 732e   self.text_days.
-00077950: 5661 6c75 650d 0a20 2020 2020 2020 2068  Value..        h
-00077960: 6f75 7273 203d 2073 656c 662e 7465 7874  ours = self.text
-00077970: 5f68 6f75 7273 2e56 616c 7565 0d0a 2020  _hours.Value..  
-00077980: 2020 2020 2020 7265 7475 726e 2064 6179        return day
-00077990: 732c 2068 6f75 7273 0d0a 0d0a 0d0a 0d0a  s, hours........
-000779a0: 636c 6173 7320 4162 6f75 7444 6961 6c6f  class AboutDialo
-000779b0: 6728 7778 2e44 6961 6c6f 6729 3a0d 0a0d  g(wx.Dialog):...
-000779c0: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
-000779d0: 5f28 7365 6c66 2c20 7061 7265 6e74 2c20  _(self, parent, 
-000779e0: 636f 6e74 656e 7429 3a0d 0a20 2020 2020  content):..     
-000779f0: 2020 2077 782e 4469 616c 6f67 2e5f 5f69     wx.Dialog.__i
-00077a00: 6e69 745f 5f28 7365 6c66 2c20 7061 7265  nit__(self, pare
-00077a10: 6e74 2c20 7469 746c 653d 2241 626f 7574  nt, title="About
-00077a20: 2025 7322 2025 2063 6f6e 662e 5469 746c   %s" % conf.Titl
-00077a30: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
-00077a40: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00077a50: 7479 6c65 3d77 782e 4341 5054 494f 4e20  tyle=wx.CAPTION 
-00077a60: 7c20 7778 2e43 4c4f 5345 5f42 4f58 290d  | wx.CLOSE_BOX).
-00077a70: 0a20 2020 2020 2020 2073 656c 662e 636f  .        self.co
-00077a80: 6e74 656e 7420 3d20 636f 6e74 656e 740d  ntent = content.
-00077a90: 0a20 2020 2020 2020 2068 746d 6c20 3d20  .        html = 
-00077aa0: 7365 6c66 2e68 746d 6c20 3d20 7778 2e68  self.html = wx.h
-00077ab0: 746d 6c2e 4874 6d6c 5769 6e64 6f77 2873  tml.HtmlWindow(s
-00077ac0: 656c 6629 0d0a 2020 2020 2020 2020 6275  elf)..        bu
-00077ad0: 7474 6f6e 5f75 7064 6174 6520 3d20 7778  tton_update = wx
-00077ae0: 2e42 7574 746f 6e28 7365 6c66 2c20 6c61  .Button(self, la
-00077af0: 6265 6c3d 2243 6865 636b 2066 6f72 2026  bel="Check for &
-00077b00: 7570 6461 7465 7322 290d 0a20 2020 2020  updates")..     
-00077b10: 2020 2062 7574 746f 6e5f 6665 6564 6261     button_feedba
-00077b20: 636b 203d 2077 782e 4275 7474 6f6e 2873  ck = wx.Button(s
-00077b30: 656c 662c 206c 6162 656c 3d22 5365 6e64  elf, label="Send
-00077b40: 2026 6665 6564 6261 636b 2229 0d0a 0d0a   &feedback")....
-00077b50: 2020 2020 2020 2020 6874 6d6c 2e53 6574          html.Set
-00077b60: 5061 6765 2863 6f6e 7465 6e74 2829 2069  Page(content() i
-00077b70: 6620 6361 6c6c 6162 6c65 2863 6f6e 7465  f callable(conte
-00077b80: 6e74 2920 656c 7365 2063 6f6e 7465 6e74  nt) else content
-00077b90: 290d 0a20 2020 2020 2020 2068 746d 6c2e  )..        html.
-00077ba0: 4261 636b 6772 6f75 6e64 436f 6c6f 7572  BackgroundColour
-00077bb0: 203d 2043 6f6c 6f75 724d 616e 6167 6572   = ColourManager
-00077bc0: 2e47 6574 436f 6c6f 7572 2877 782e 5359  .GetColour(wx.SY
-00077bd0: 535f 434f 4c4f 5552 5f57 494e 444f 5729  S_COLOUR_WINDOW)
-00077be0: 0d0a 2020 2020 2020 2020 6874 6d6c 2e42  ..        html.B
-00077bf0: 696e 6428 7778 2e68 746d 6c2e 4556 545f  ind(wx.html.EVT_
-00077c00: 4854 4d4c 5f4c 494e 4b5f 434c 4943 4b45  HTML_LINK_CLICKE
-00077c10: 442c 0d0a 2020 2020 2020 2020 2020 2020  D,..            
-00077c20: 2020 2020 2020 6c61 6d62 6461 2065 3a20        lambda e: 
-00077c30: 7765 6262 726f 7773 6572 2e6f 7065 6e28  webbrowser.open(
-00077c40: 652e 4765 744c 696e 6b49 6e66 6f28 292e  e.GetLinkInfo().
-00077c50: 4872 6566 2929 0d0a 2020 2020 2020 2020  Href))..        
-00077c60: 6275 7474 6f6e 5f75 7064 6174 652e 4269  button_update.Bi
-00077c70: 6e64 2877 782e 4556 545f 4255 5454 4f4e  nd(wx.EVT_BUTTON
-00077c80: 2c20 7061 7265 6e74 2e6f 6e5f 6368 6563  , parent.on_chec
-00077c90: 6b5f 7570 6461 7465 290d 0a20 2020 2020  k_update)..     
-00077ca0: 2020 2062 7574 746f 6e5f 6665 6564 6261     button_feedba
-00077cb0: 636b 2e42 696e 6428 7778 2e45 5654 5f42  ck.Bind(wx.EVT_B
-00077cc0: 5554 544f 4e2c 2073 656c 662e 4f6e 4f70  UTTON, self.OnOp
-00077cd0: 656e 4665 6564 6261 636b 290d 0a0d 0a20  enFeedback).... 
-00077ce0: 2020 2020 2020 2073 656c 662e 5369 7a65         self.Size
-00077cf0: 7220 3d20 7778 2e42 6f78 5369 7a65 7228  r = wx.BoxSizer(
-00077d00: 7778 2e56 4552 5449 4341 4c29 0d0a 2020  wx.VERTICAL)..  
-00077d10: 2020 2020 2020 7365 6c66 2e53 697a 6572        self.Sizer
-00077d20: 2e41 6464 2868 746d 6c2c 2070 726f 706f  .Add(html, propo
-00077d30: 7274 696f 6e3d 312c 2066 6c61 673d 7778  rtion=1, flag=wx
-00077d40: 2e47 524f 5729 0d0a 2020 2020 2020 2020  .GROW)..        
-00077d50: 7369 7a65 725f 6275 7474 6f6e 7320 3d20  sizer_buttons = 
-00077d60: 7365 6c66 2e43 7265 6174 6542 7574 746f  self.CreateButto
-00077d70: 6e53 697a 6572 2877 782e 4f4b 290d 0a20  nSizer(wx.OK).. 
-00077d80: 2020 2020 2020 2073 697a 6572 5f62 7574         sizer_but
-00077d90: 746f 6e73 2e49 6e73 6572 7428 302c 2062  tons.Insert(0, b
-00077da0: 7574 746f 6e5f 7570 6461 7465 2c20 626f  utton_update, bo
-00077db0: 7264 6572 3d35 302c 2066 6c61 673d 7778  rder=50, flag=wx
-00077dc0: 2e52 4947 4854 290d 0a20 2020 2020 2020  .RIGHT)..       
-00077dd0: 2073 697a 6572 5f62 7574 746f 6e73 2e49   sizer_buttons.I
-00077de0: 6e73 6572 7428 312c 2062 7574 746f 6e5f  nsert(1, button_
-00077df0: 6665 6564 6261 636b 2c20 626f 7264 6572  feedback, border
-00077e00: 3d35 302c 2066 6c61 673d 7778 2e52 4947  =50, flag=wx.RIG
-00077e10: 4854 290d 0a20 2020 2020 2020 2073 656c  HT)..        sel
-00077e20: 662e 5369 7a65 722e 4164 6428 7369 7a65  f.Sizer.Add(size
-00077e30: 725f 6275 7474 6f6e 732c 2062 6f72 6465  r_buttons, borde
-00077e40: 723d 382c 2066 6c61 673d 7778 2e41 4c49  r=8, flag=wx.ALI
-00077e50: 474e 5f43 454e 5445 525f 484f 5249 5a4f  GN_CENTER_HORIZO
-00077e60: 4e54 414c 207c 2077 782e 414c 4c29 0d0a  NTAL | wx.ALL)..
-00077e70: 2020 2020 2020 2020 7365 6c66 2e42 696e          self.Bin
-00077e80: 6428 7778 2e45 5654 5f53 5953 5f43 4f4c  d(wx.EVT_SYS_COL
-00077e90: 4f55 525f 4348 414e 4745 442c 2073 656c  OUR_CHANGED, sel
-00077ea0: 662e 4f6e 5379 7343 6f6c 6f75 7243 6861  f.OnSysColourCha
-00077eb0: 6e67 6529 0d0a 0d0a 2020 2020 2020 2020  nge)....        
-00077ec0: 7365 6c66 2e4c 6179 6f75 7428 290d 0a20  self.Layout().. 
-00077ed0: 2020 2020 2020 2069 6620 2277 696e 3332         if "win32
-00077ee0: 2220 213d 2073 7973 2e70 6c61 7466 6f72  " != sys.platfor
-00077ef0: 6d3a 2073 656c 662e 4d69 6e53 697a 6520  m: self.MinSize 
-00077f00: 3d20 2835 3530 2c20 2d31 290d 0a20 2020  = (550, -1)..   
-00077f10: 2020 2020 2073 656c 662e 5369 7a65 203d       self.Size =
-00077f20: 2028 7365 6c66 2e53 697a 655b 305d 2c20   (self.Size[0], 
-00077f30: 6874 6d6c 2e56 6972 7475 616c 5369 7a65  html.VirtualSize
-00077f40: 5b31 5d20 2b20 2831 3020 6966 2022 7769  [1] + (10 if "wi
-00077f50: 6e33 3222 2021 3d20 7379 732e 706c 6174  n32" != sys.plat
-00077f60: 666f 726d 2065 6c73 6520 3730 2929 0d0a  form else 70))..
-00077f70: 2020 2020 2020 2020 7365 6c66 2e43 656e          self.Cen
-00077f80: 7465 724f 6e50 6172 656e 7428 290d 0a0d  terOnParent()...
-00077f90: 0a0d 0a20 2020 2064 6566 204f 6e4f 7065  ...    def OnOpe
-00077fa0: 6e46 6565 6462 6163 6b28 7365 6c66 2c20  nFeedback(self, 
-00077fb0: 6576 656e 7429 3a0d 0a20 2020 2020 2020  event):..       
-00077fc0: 2022 2222 4861 6e64 6c65 7220 666f 7220   """Handler for 
-00077fd0: 6665 6564 6261 636b 2062 7574 746f 6e2c  feedback button,
-00077fe0: 2063 6c6f 7365 7320 6469 616c 6f67 2061   closes dialog a
-00077ff0: 6e64 206f 7065 6e73 2066 6565 6462 6163  nd opens feedbac
-00078000: 6b20 6469 616c 6f67 2e22 2222 0d0a 2020  k dialog."""..  
-00078010: 2020 2020 2020 7778 2e43 616c 6c41 6674        wx.CallAft
-00078020: 6572 2873 656c 662e 5061 7265 6e74 2e6f  er(self.Parent.o
-00078030: 6e5f 6f70 656e 5f66 6565 6462 6163 6b29  n_open_feedback)
-00078040: 0d0a 2020 2020 2020 2020 7365 6c66 2e43  ..        self.C
-00078050: 6c6f 7365 2829 0d0a 0d0a 0d0a 2020 2020  lose()......    
-00078060: 6465 6620 4f6e 5379 7343 6f6c 6f75 7243  def OnSysColourC
-00078070: 6861 6e67 6528 7365 6c66 2c20 6576 656e  hange(self, even
-00078080: 7429 3a0d 0a20 2020 2020 2020 2022 2222  t):..        """
-00078090: 4861 6e64 6c65 7220 666f 7220 7379 7374  Handler for syst
-000780a0: 656d 2063 6f6c 6f75 7220 6368 616e 6765  em colour change
-000780b0: 2c20 7265 6672 6573 6865 7320 636f 6e74  , refreshes cont
-000780c0: 656e 742e 2222 220d 0a20 2020 2020 2020  ent."""..       
-000780d0: 2065 7665 6e74 2e53 6b69 7028 290d 0a20   event.Skip().. 
-000780e0: 2020 2020 2020 2064 6566 2064 6f72 6566         def doref
-000780f0: 7265 7368 2829 3a0d 0a20 2020 2020 2020  resh():..       
-00078100: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
-00078110: 3a20 7265 7475 726e 0d0a 2020 2020 2020  : return..      
-00078120: 2020 2020 2020 7365 6c66 2e68 746d 6c2e        self.html.
-00078130: 5365 7450 6167 6528 7365 6c66 2e63 6f6e  SetPage(self.con
-00078140: 7465 6e74 2829 2069 6620 6361 6c6c 6162  tent() if callab
-00078150: 6c65 2873 656c 662e 636f 6e74 656e 7429  le(self.content)
-00078160: 2065 6c73 6520 7365 6c66 2e63 6f6e 7465   else self.conte
-00078170: 6e74 290d 0a20 2020 2020 2020 2020 2020  nt)..           
-00078180: 2073 656c 662e 6874 6d6c 2e42 6163 6b67   self.html.Backg
-00078190: 726f 756e 6443 6f6c 6f75 7220 3d20 436f  roundColour = Co
-000781a0: 6c6f 7572 4d61 6e61 6765 722e 4765 7443  lourManager.GetC
-000781b0: 6f6c 6f75 7228 7778 2e53 5953 5f43 4f4c  olour(wx.SYS_COL
-000781c0: 4f55 525f 5749 4e44 4f57 290d 0a20 2020  OUR_WINDOW)..   
-000781d0: 2020 2020 2020 2020 2073 656c 662e 6874           self.ht
-000781e0: 6d6c 2e46 6f72 6567 726f 756e 6443 6f6c  ml.ForegroundCol
-000781f0: 6f75 7220 3d20 436f 6c6f 7572 4d61 6e61  our = ColourMana
-00078200: 6765 722e 4765 7443 6f6c 6f75 7228 7778  ger.GetColour(wx
-00078210: 2e53 5953 5f43 4f4c 4f55 525f 4254 4e54  .SYS_COLOUR_BTNT
-00078220: 4558 5429 0d0a 2020 2020 2020 2020 7778  EXT)..        wx
-00078230: 2e43 616c 6c41 6674 6572 2864 6f72 6566  .CallAfter(doref
-00078240: 7265 7368 2920 2320 506f 7374 706f 6e65  resh) # Postpone
-00078250: 2074 6f20 616c 6c6f 7720 636f 6e66 2074   to allow conf t
-00078260: 6f20 7570 6461 7465 0d0a 0d0a 0d0a 0d0a  o update........
-00078270: 636c 6173 7320 4c6f 6769 6e44 6961 6c6f  class LoginDialo
-00078280: 6728 7778 2e44 6961 6c6f 672c 2077 785f  g(wx.Dialog, wx_
-00078290: 6163 6365 6c2e 4175 746f 4163 6365 6c65  accel.AutoAccele
-000782a0: 7261 746f 724d 6978 496e 293a 0d0a 2020  ratorMixIn):..  
-000782b0: 2020 2222 2244 6961 6c6f 6720 7468 6174    """Dialog that
-000782c0: 2061 736b 7320 666f 7220 7573 6572 6e61   asks for userna
-000782d0: 6d65 2061 6e64 2070 6173 7377 6f72 642e  me and password.
-000782e0: 2222 220d 0a0d 0a20 2020 2064 6566 205f  """....    def _
-000782f0: 5f69 6e69 745f 5f28 7365 6c66 2c20 7061  _init__(self, pa
-00078300: 7265 6e74 2c20 7469 746c 653d 224c 6f67  rent, title="Log
-00078310: 2069 6e22 293a 0d0a 2020 2020 2020 2020   in"):..        
-00078320: 7778 2e44 6961 6c6f 672e 5f5f 696e 6974  wx.Dialog.__init
-00078330: 5f5f 2873 656c 662c 2070 6172 656e 742c  __(self, parent,
-00078340: 2074 6974 6c65 3d74 6974 6c65 2c0d 0a20   title=title,.. 
-00078350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00078360: 2020 2020 2020 2020 2020 7374 796c 653d            style=
-00078370: 7778 2e43 4150 5449 4f4e 207c 2077 782e  wx.CAPTION | wx.
-00078380: 434c 4f53 455f 424f 5829 0d0a 0d0a 2020  CLOSE_BOX)....  
-00078390: 2020 2020 2020 6c61 6265 6c5f 6e61 6d65        label_name
-000783a0: 203d 2077 782e 5374 6174 6963 5465 7874   = wx.StaticText
-000783b0: 2873 656c 662c 206c 6162 656c 3d22 2655  (self, label="&U
-000783c0: 7365 726e 616d 653a 222c 206e 616d 653d  sername:", name=
-000783d0: 226c 6162 656c 5f75 7365 7222 290d 0a20  "label_user").. 
-000783e0: 2020 2020 2020 2065 6469 745f 6e61 6d65         edit_name
-000783f0: 2020 3d20 7365 6c66 2e65 6469 745f 6e61    = self.edit_na
-00078400: 6d65 203d 2077 782e 5465 7874 4374 726c  me = wx.TextCtrl
-00078410: 2873 656c 662c 2073 697a 653d 2832 3030  (self, size=(200
-00078420: 2c20 2d31 292c 206e 616d 653d 2275 7365  , -1), name="use
-00078430: 7222 290d 0a20 2020 2020 2020 206c 6162  r")..        lab
-00078440: 656c 5f70 6173 7320 3d20 7778 2e53 7461  el_pass = wx.Sta
-00078450: 7469 6354 6578 7428 7365 6c66 2c20 6c61  ticText(self, la
-00078460: 6265 6c3d 2226 5061 7373 776f 7264 3a22  bel="&Password:"
-00078470: 2c20 6e61 6d65 3d22 6c61 6265 6c5f 7061  , name="label_pa
-00078480: 7373 2229 0d0a 2020 2020 2020 2020 6564  ss")..        ed
-00078490: 6974 5f70 6173 7320 203d 2073 656c 662e  it_pass  = self.
-000784a0: 6564 6974 5f70 6173 7320 3d20 7778 2e54  edit_pass = wx.T
-000784b0: 6578 7443 7472 6c28 7365 6c66 2c20 7369  extCtrl(self, si
-000784c0: 7a65 3d28 3230 302c 202d 3129 2c20 7374  ze=(200, -1), st
-000784d0: 796c 653d 7778 2e54 455f 5041 5353 574f  yle=wx.TE_PASSWO
-000784e0: 5244 2c20 6e61 6d65 3d22 7061 7373 2229  RD, name="pass")
-000784f0: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
-00078500: 2e53 697a 6572 203d 2077 782e 426f 7853  .Sizer = wx.BoxS
-00078510: 697a 6572 2877 782e 5645 5254 4943 414c  izer(wx.VERTICAL
-00078520: 290d 0a20 2020 2020 2020 2073 697a 6572  )..        sizer
-00078530: 5f63 7472 6c73 203d 2077 782e 466c 6578  _ctrls = wx.Flex
-00078540: 4772 6964 5369 7a65 7228 636f 6c73 3d32  GridSizer(cols=2
-00078550: 2c20 7667 6170 3d33 2c20 6867 6170 3d31  , vgap=3, hgap=1
-00078560: 3029 0d0a 2020 2020 2020 2020 7369 7a65  0)..        size
-00078570: 725f 6275 7474 6f6e 7320 3d20 7365 6c66  r_buttons = self
-00078580: 2e43 7265 6174 6542 7574 746f 6e53 697a  .CreateButtonSiz
-00078590: 6572 2877 782e 4f4b 207c 2077 782e 4341  er(wx.OK | wx.CA
-000785a0: 4e43 454c 290d 0a20 2020 2020 2020 2073  NCEL)..        s
-000785b0: 697a 6572 5f63 7472 6c73 2e41 6464 286c  izer_ctrls.Add(l
-000785c0: 6162 656c 5f6e 616d 652c 2066 6c61 673d  abel_name, flag=
-000785d0: 7778 2e41 4c49 474e 5f43 454e 5445 525f  wx.ALIGN_CENTER_
-000785e0: 5645 5254 4943 414c 290d 0a20 2020 2020  VERTICAL)..     
-000785f0: 2020 2073 697a 6572 5f63 7472 6c73 2e41     sizer_ctrls.A
-00078600: 6464 2865 6469 745f 6e61 6d65 2c20 666c  dd(edit_name, fl
-00078610: 6167 3d77 782e 4752 4f57 290d 0a20 2020  ag=wx.GROW)..   
-00078620: 2020 2020 2073 697a 6572 5f63 7472 6c73       sizer_ctrls
-00078630: 2e41 6464 286c 6162 656c 5f70 6173 732c  .Add(label_pass,
-00078640: 2066 6c61 673d 7778 2e41 4c49 474e 5f43   flag=wx.ALIGN_C
-00078650: 454e 5445 525f 5645 5254 4943 414c 290d  ENTER_VERTICAL).
-00078660: 0a20 2020 2020 2020 2073 697a 6572 5f63  .        sizer_c
-00078670: 7472 6c73 2e41 6464 2865 6469 745f 7061  trls.Add(edit_pa
-00078680: 7373 2c20 666c 6167 3d77 782e 4752 4f57  ss, flag=wx.GROW
-00078690: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-000786a0: 5369 7a65 722e 4164 6428 7369 7a65 725f  Sizer.Add(sizer_
-000786b0: 6374 726c 732c 2020 2062 6f72 6465 723d  ctrls,   border=
-000786c0: 382c 2070 726f 706f 7274 696f 6e3d 312c  8, proportion=1,
-000786d0: 2066 6c61 673d 7778 2e41 4c4c 207c 2077   flag=wx.ALL | w
-000786e0: 782e 4752 4f57 290d 0a20 2020 2020 2020  x.GROW)..       
-000786f0: 2073 656c 662e 5369 7a65 722e 4164 6428   self.Sizer.Add(
-00078700: 7369 7a65 725f 6275 7474 6f6e 732c 2062  sizer_buttons, b
-00078710: 6f72 6465 723d 382c 2066 6c61 673d 7778  order=8, flag=wx
-00078720: 2e41 4c49 474e 5f43 454e 5445 525f 484f  .ALIGN_CENTER_HO
-00078730: 5249 5a4f 4e54 414c 207c 2077 782e 414c  RIZONTAL | wx.AL
-00078740: 4c29 0d0a 2020 2020 2020 2020 7365 6c66  L)..        self
-00078750: 2e4c 6179 6f75 7428 290d 0a20 2020 2020  .Layout()..     
-00078760: 2020 2073 656c 662e 4669 7428 290d 0a20     self.Fit().. 
-00078770: 2020 2020 2020 2073 656c 662e 4365 6e74         self.Cent
-00078780: 6572 4f6e 5061 7265 6e74 2829 0d0a 2020  erOnParent()..  
-00078790: 2020 2020 2020 7365 6c66 2e55 7064 6174        self.Updat
-000787a0: 6541 6363 656c 6572 6174 6f72 7328 290d  eAccelerators().
-000787b0: 0a20 2020 2020 2020 2065 6469 745f 6e61  .        edit_na
-000787c0: 6d65 2e53 6574 466f 6375 7328 290d 0a0d  me.SetFocus()...
-000787d0: 0a0d 0a20 2020 2064 6566 2047 6574 5573  ...    def GetUs
-000787e0: 6572 6e61 6d65 2873 656c 6629 3a0d 0a20  ername(self):.. 
-000787f0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-00078800: 6c66 2e65 6469 745f 6e61 6d65 2e56 616c  lf.edit_name.Val
-00078810: 7565 2e73 7472 6970 2829 0d0a 2020 2020  ue.strip()..    
-00078820: 5573 6572 6e61 6d65 203d 2070 726f 7065  Username = prope
-00078830: 7274 7928 4765 7455 7365 726e 616d 6529  rty(GetUsername)
-00078840: 0d0a 0d0a 0d0a 2020 2020 6465 6620 4765  ......    def Ge
-00078850: 7450 6173 7377 6f72 6428 7365 6c66 293a  tPassword(self):
-00078860: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00078870: 2073 656c 662e 6564 6974 5f70 6173 732e   self.edit_pass.
-00078880: 5661 6c75 652e 7374 7269 7028 290d 0a20  Value.strip().. 
-00078890: 2020 2050 6173 7377 6f72 6420 3d20 7072     Password = pr
-000788a0: 6f70 6572 7479 2847 6574 5061 7373 776f  operty(GetPasswo
-000788b0: 7264 290d 0a0d 0a0d 0a64 6566 2063 6865  rd)......def che
-000788c0: 636b 5f6d 6564 6961 5f65 7870 6f72 745f  ck_media_export_
-000788d0: 6c6f 6769 6e28 6462 293a 0d0a 2020 2020  login(db):..    
-000788e0: 2222 220d 0a20 2020 2052 6574 7572 6e73  """..    Returns
-000788f0: 2077 6865 7468 6572 2064 6220 6361 6e20   whether db can 
-00078900: 6c6f 6769 6e20 746f 2064 6f77 6e6c 6f61  login to downloa
-00078910: 6420 7368 6172 6564 2066 696c 6573 2074  d shared files t
-00078920: 6f20 7375 6266 6f6c 6465 7220 666f 7220  o subfolder for 
-00078930: 6578 706f 7274 0d0a 2020 2020 6f72 2077  export..    or w
-00078940: 6865 7468 6572 2075 7365 7220 636f 6e66  hether user conf
-00078950: 6972 6d73 2074 6f20 7072 6f63 6565 6420  irms to proceed 
-00078960: 7769 7468 6f75 7420 6c6f 6769 6e20 696e  without login in
-00078970: 666f 726d 6174 696f 6e2e 0d0a 2020 2020  formation...    
-00078980: 2222 220d 0a20 2020 2069 6620 2863 6f6e  """..    if (con
-00078990: 662e 5368 6172 6564 496d 6167 6541 7574  f.SharedImageAut
-000789a0: 6f44 6f77 6e6c 6f61 6420 6f72 2063 6f6e  oDownload or con
-000789b0: 662e 5368 6172 6564 4175 6469 6f56 6964  f.SharedAudioVid
-000789c0: 656f 4175 746f 446f 776e 6c6f 6164 0d0a  eoAutoDownload..
-000789d0: 2020 2020 2020 2020 6f72 2063 6f6e 662e          or conf.
-000789e0: 5368 6172 6564 4669 6c65 4175 746f 446f  SharedFileAutoDo
-000789f0: 776e 6c6f 6164 2920 5c0d 0a20 2020 2061  wnload) \..    a
-00078a00: 6e64 206e 6f74 2064 622e 6c69 7665 2e69  nd not db.live.i
-00078a10: 735f 6c6f 6767 6564 5f69 6e28 2920 5c0d  s_logged_in() \.
-00078a20: 0a20 2020 2061 6e64 206e 6f74 2063 6f6e  .    and not con
-00078a30: 662e 4c6f 6769 6e2e 6765 7428 6462 2e66  f.Login.get(db.f
-00078a40: 696c 656e 616d 652c 207b 7d29 2e67 6574  ilename, {}).get
-00078a50: 2822 7061 7373 776f 7264 2229 2061 6e64  ("password") and
-00078a60: 2077 782e 4f4b 2021 3d20 7778 2e4d 6573   wx.OK != wx.Mes
-00078a70: 7361 6765 426f 7828 0d0a 2020 2020 2020  sageBox(..      
-00078a80: 2020 2259 6f75 2068 6176 6520 7365 6c65    "You have sele
-00078a90: 6374 6564 2074 6f20 6578 706f 7274 2048  cted to export H
-00078aa0: 544d 4c20 7769 7468 2073 6861 7265 6420  TML with shared 
-00078ab0: 6669 6c65 7320 696e 2073 7562 666f 6c64  files in subfold
-00078ac0: 6572 2c20 220d 0a20 2020 2020 2020 2022  er, "..        "
-00078ad0: 6275 7420 7468 6520 6461 7461 6261 7365  but the database
-00078ae0: 2064 6f65 7320 6e6f 7420 6861 7665 206c   does not have l
-00078af0: 6f67 696e 2069 6e66 6f72 6d61 7469 6f6e  ogin information
-00078b00: 2022 0d0a 2020 2020 2020 2020 2266 6f72   "..        "for
-00078b10: 2064 6f77 6e6c 6f61 6469 6e67 206d 6564   downloading med
-00078b20: 6961 2e5c 6e5c 6e41 7265 2079 6f75 2073  ia.\n\nAre you s
-00078b30: 7572 6520 796f 7520 7761 6e74 2074 6f20  ure you want to 
-00078b40: 636f 6e74 696e 7565 3f22 2c0d 0a20 2020  continue?",..   
-00078b50: 2020 2020 2063 6f6e 662e 5469 746c 652c       conf.Title,
-00078b60: 2077 782e 4f4b 207c 2077 782e 4341 4e43   wx.OK | wx.CANC
-00078b70: 454c 207c 2077 782e 4943 4f4e 5f49 4e46  EL | wx.ICON_INF
-00078b80: 4f52 4d41 5449 4f4e 0d0a 2020 2020 293a  ORMATION..    ):
-00078b90: 2072 6574 7572 6e20 4661 6c73 650d 0a20   return False.. 
-00078ba0: 2020 2072 6574 7572 6e20 5472 7565 0d0a     return True..
-00078bb0: 0d0a 0d0a 6465 6620 6d65 7373 6167 6542  ....def messageB
-00078bc0: 6f78 286d 6573 7361 6765 2c20 7469 746c  ox(message, titl
-00078bd0: 652c 2073 7479 6c65 293a 0d0a 2020 2020  e, style):..    
-00078be0: 2222 220d 0a20 2020 2053 686f 7773 2061  """..    Shows a
-00078bf0: 206e 6f6e 2d6e 6174 6976 6520 6d65 7373   non-native mess
-00078c00: 6167 6520 626f 782c 2077 6974 6820 6e6f  age box, with no
-00078c10: 2062 656c 6c20 736f 756e 6420 666f 7220   bell sound for 
-00078c20: 616e 7920 7374 796c 652c 2072 6574 7572  any style, retur
-00078c30: 6e69 6e67 0d0a 2020 2020 7468 6520 6d65  ning..    the me
-00078c40: 7373 6167 6520 626f 7820 7265 7375 6c74  ssage box result
-00078c50: 2063 6f64 652e 2222 220d 0a20 2020 2064   code."""..    d
-00078c60: 6c67 203d 2077 782e 6c69 622e 6167 772e  lg = wx.lib.agw.
-00078c70: 6765 6e65 7269 636d 6573 7361 6765 6469  genericmessagedi
-00078c80: 616c 6f67 2e47 656e 6572 6963 4d65 7373  alog.GenericMess
-00078c90: 6167 6544 6961 6c6f 6728 0d0a 2020 2020  ageDialog(..    
-00078ca0: 2020 2020 4e6f 6e65 2c20 6d65 7373 6167      None, messag
-00078cb0: 652c 2074 6974 6c65 2c20 7374 796c 650d  e, title, style.
-00078cc0: 0a20 2020 2029 0d0a 2020 2020 7265 7375  .    )..    resu
-00078cd0: 6c74 203d 2064 6c67 2e53 686f 774d 6f64  lt = dlg.ShowMod
-00078ce0: 616c 2829 0d0a 2020 2020 646c 672e 4465  al()..    dlg.De
-00078cf0: 7374 726f 7928 290d 0a20 2020 2072 6574  stroy()..    ret
-00078d00: 7572 6e20 7265 7375 6c74 0d0a            urn result..
+0006f5e0: 2073 656c 662e 5f70 6167 652e 6368 6174   self._page.chat
+0006f5f0: 5f66 696c 7465 725b 2264 6174 6572 616e  _filter["dateran
+0006f600: 6765 225d 203d 2064 6174 6572 616e 6765  ge"] = daterange
+0006f610: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0006f620: 2020 6966 2074 6578 7420 6973 206e 6f74    if text is not
+0006f630: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+0006f640: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0006f650: 2e5f 7061 6765 2e65 6469 745f 6669 6c74  ._page.edit_filt
+0006f660: 6572 7465 7874 2e56 616c 7565 203d 2074  ertext.Value = t
+0006f670: 6578 740d 0a20 2020 2020 2020 2020 2020  ext..           
+0006f680: 2020 2020 2020 2020 2073 656c 662e 5f70           self._p
+0006f690: 6167 652e 6368 6174 5f66 696c 7465 725b  age.chat_filter[
+0006f6a0: 2274 6578 7422 5d20 2020 3d20 7465 7874  "text"]   = text
+0006f6b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0006f6c0: 2020 6966 2070 6172 7469 6369 7061 6e74    if participant
+0006f6d0: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
+0006f6e0: 2020 2020 2020 2020 706c 6973 7420 3d20          plist = 
+0006f6f0: 7365 6c66 2e5f 7061 6765 2e6c 6973 745f  self._page.list_
+0006f700: 7061 7274 6963 6970 616e 7473 0d0a 2020  participants..  
+0006f710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006f720: 2020 666f 7220 6920 696e 2072 616e 6765    for i in range
+0006f730: 2870 6c69 7374 2e47 6574 4974 656d 436f  (plist.GetItemCo
+0006f740: 756e 7428 2929 3a0d 0a20 2020 2020 2020  unt()):..       
+0006f750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006f760: 2069 6465 6e74 6974 7920 3d20 706c 6973   identity = plis
+0006f770: 742e 4765 7449 7465 6d44 6174 6128 6929  t.GetItemData(i)
+0006f780: 5b22 6964 656e 7469 7479 225d 0d0a 2020  ["identity"]..  
+0006f790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006f7a0: 2020 2020 2020 6320 3d20 706c 6973 742e        c = plist.
+0006f7b0: 4765 7449 7465 6d28 6929 0d0a 2020 2020  GetItem(i)..    
+0006f7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006f7d0: 2020 2020 632e 4368 6563 6b28 6964 656e      c.Check(iden
+0006f7e0: 7469 7479 2069 6e20 7061 7274 6963 6970  tity in particip
+0006f7f0: 616e 7473 290d 0a20 2020 2020 2020 2020  ants)..         
+0006f800: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0006f810: 6c69 7374 2e53 6574 4974 656d 2863 290d  list.SetItem(c).
+0006f820: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0006f830: 2020 2020 2070 6c69 7374 2e52 6566 7265       plist.Refre
+0006f840: 7368 2829 0d0a 2020 2020 2020 2020 2020  sh()..          
+0006f850: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+0006f860: 7061 6765 2e63 6861 745f 6669 6c74 6572  page.chat_filter
+0006f870: 5b22 7061 7274 6963 6970 616e 7473 225d  ["participants"]
+0006f880: 203d 2070 6172 7469 6369 7061 6e74 730d   = participants.
+0006f890: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0006f8a0: 662e 4669 6c74 6572 203d 2064 6963 7428  f.Filter = dict(
+0006f8b0: 7365 6c66 2e46 696c 7465 722c 202a 2a6d  self.Filter, **m
+0006f8c0: 7966 696c 7465 7229 0d0a 2020 2020 2020  yfilter)..      
+0006f8d0: 2020 2020 2020 7365 6c66 2e52 6566 7265        self.Refre
+0006f8e0: 7368 4d65 7373 6167 6573 2829 2c20 7365  shMessages(), se
+0006f8f0: 6c66 2e53 6372 6f6c 6c54 6f4c 696e 6528  lf.ScrollToLine(
+0006f900: 3029 0d0a 2020 2020 2020 2020 2020 2020  0)..            
+0006f910: 6966 2073 656c 662e 5f70 6167 653a 0d0a  if self._page:..
+0006f920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006f930: 7365 6c66 2e5f 7061 6765 2e70 6f70 756c  self._page.popul
+0006f940: 6174 655f 6368 6174 5f73 7461 7469 7374  ate_chat_statist
+0006f950: 6963 7328 290d 0a20 2020 2020 2020 2020  ics()..         
+0006f960: 2020 2020 2020 2073 656c 662e 5f70 6167         self._pag
+0006f970: 652e 6c69 7374 5f74 696d 656c 696e 652e  e.list_timeline.
+0006f980: 506f 7075 6c61 7465 282a 7365 6c66 2e47  Populate(*self.G
+0006f990: 6574 5469 6d65 6c69 6e65 4461 7461 2829  etTimelineData()
+0006f9a0: 290d 0a20 2020 2020 2020 2066 696e 616c  )..        final
+0006f9b0: 6c79 3a0d 0a20 2020 2020 2020 2020 2020  ly:..           
+0006f9c0: 2062 7573 792e 436c 6f73 6528 290d 0a0d   busy.Close()...
+0006f9d0: 0a0d 0a20 2020 2064 6566 2047 6574 5374  ...    def GetSt
+0006f9e0: 6174 6973 7469 6373 4461 7461 2873 656c  atisticsData(sel
+0006f9f0: 6629 3a0d 0a20 2020 2020 2020 2022 2222  f):..        """
+0006fa00: 0d0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
+0006fa10: 7320 7468 6520 7374 6174 6973 7469 6373  s the statistics
+0006fa20: 2063 6f6c 6c65 6374 6564 2064 7572 696e   collected durin
+0006fa30: 6720 6c61 7374 2050 6f70 756c 6174 6528  g last Populate(
+0006fa40: 292c 206f 7220 7b7d 2e0d 0a20 2020 2020  ), or {}...     
+0006fa50: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
+0006fa60: 7265 7475 726e 2073 656c 662e 5f70 6172  return self._par
+0006fa70: 7365 722e 6765 745f 636f 6c6c 6563 7465  ser.get_collecte
+0006fa80: 645f 7374 6174 7328 2920 6966 2073 656c  d_stats() if sel
+0006fa90: 662e 5f70 6172 7365 7220 656c 7365 207b  f._parser else {
+0006faa0: 7d0d 0a0d 0a0d 0a20 2020 2064 6566 2047  }......    def G
+0006fab0: 6574 5469 6d65 6c69 6e65 4461 7461 2873  etTimelineData(s
+0006fac0: 656c 6629 3a0d 0a20 2020 2020 2020 2022  elf):..        "
+0006fad0: 2222 0d0a 2020 2020 2020 2020 5265 7475  ""..        Retu
+0006fae0: 726e 7320 7468 6520 7469 6d65 6c69 6e65  rns the timeline
+0006faf0: 2063 6f6c 6c65 6374 6564 2064 7572 696e   collected durin
+0006fb00: 6720 6c61 7374 2050 6f70 756c 6174 6528  g last Populate(
+0006fb10: 292c 206f 7220 7b7d 2e0d 0a20 2020 2020  ), or {}...     
+0006fb20: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
+0006fb30: 7265 7475 726e 2073 656c 662e 5f70 6172  return self._par
+0006fb40: 7365 722e 6765 745f 7469 6d65 6c69 6e65  ser.get_timeline
+0006fb50: 5f73 7461 7473 2829 2069 6620 7365 6c66  _stats() if self
+0006fb60: 2e5f 7061 7273 6572 2065 6c73 6520 7b7d  ._parser else {}
+0006fb70: 0d0a 0d0a 0d0a 2020 2020 6465 6620 436c  ......    def Cl
+0006fb80: 6561 7241 6c6c 2873 656c 6629 3a0d 0a20  earAll(self):.. 
+0006fb90: 2020 2020 2020 2022 2222 4465 6c65 7465         """Delete
+0006fba0: 2061 6c6c 2074 6578 7420 696e 2074 6865   all text in the
+0006fbb0: 2064 6f63 756d 656e 742e 2222 220d 0a20   document.""".. 
+0006fbc0: 2020 2020 2020 2072 6561 646f 6e6c 795f         readonly_
+0006fbd0: 7374 6174 6520 3d20 7365 6c66 2e47 6574  state = self.Get
+0006fbe0: 5265 6164 4f6e 6c79 2829 0d0a 2020 2020  ReadOnly()..    
+0006fbf0: 2020 2020 7365 6c66 2e53 6574 5265 6164      self.SetRead
+0006fc00: 4f6e 6c79 2846 616c 7365 290d 0a20 2020  Only(False)..   
+0006fc10: 2020 2020 2077 782e 7374 632e 5374 796c       wx.stc.Styl
+0006fc20: 6564 5465 7874 4374 726c 2e43 6c65 6172  edTextCtrl.Clear
+0006fc30: 416c 6c28 7365 6c66 2e53 5443 290d 0a20  All(self.STC).. 
+0006fc40: 2020 2020 2020 2073 656c 662e 5365 7452         self.SetR
+0006fc50: 6561 644f 6e6c 7928 7265 6164 6f6e 6c79  eadOnly(readonly
+0006fc60: 5f73 7461 7465 290d 0a0d 0a0d 0a0d 0a63  _state)........c
+0006fc70: 6c61 7373 2053 716c 6974 6547 7269 6442  lass SqliteGridB
+0006fc80: 6173 6528 7778 2e67 7269 642e 4772 6964  ase(wx.grid.Grid
+0006fc90: 5461 626c 6542 6173 6529 3a0d 0a20 2020  TableBase):..   
+0006fca0: 2022 2222 0d0a 2020 2020 5461 626c 6520   """..    Table 
+0006fcb0: 6261 7365 2066 6f72 2077 782e 6772 6964  base for wx.grid
+0006fcc0: 2e47 7269 642c 2063 616e 2074 616b 6520  .Grid, can take 
+0006fcd0: 6974 7320 6461 7461 2066 726f 6d20 6120  its data from a 
+0006fce0: 7369 6e67 6c65 2074 6162 6c65 2c20 6f72  single table, or
+0006fcf0: 2066 726f 6d0d 0a20 2020 2074 6865 2072   from..    the r
+0006fd00: 6573 756c 7473 206f 6620 616e 7920 5345  esults of any SE
+0006fd10: 4c45 4354 2071 7565 7279 2e0d 0a20 2020  LECT query...   
+0006fd20: 2022 2222 0d0a 0d0a 2020 2020 2222 2248   """....    """H
+0006fd30: 6f77 206d 616e 7920 726f 7773 2074 6f20  ow many rows to 
+0006fd40: 7365 656b 2061 6865 6164 2066 6f72 2071  seek ahead for q
+0006fd50: 7565 7279 2067 7269 6473 2e22 2222 0d0a  uery grids."""..
+0006fd60: 2020 2020 5345 454b 5f43 4855 4e4b 5f4c      SEEK_CHUNK_L
+0006fd70: 454e 4754 4820 3d20 3130 300d 0a0d 0a0d  ENGTH = 100.....
+0006fd80: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
+0006fd90: 5f28 7365 6c66 2c20 6462 2c20 7461 626c  _(self, db, tabl
+0006fda0: 653d 2222 2c20 7371 6c3d 2222 293a 0d0a  e="", sql=""):..
+0006fdb0: 2020 2020 2020 2020 7375 7065 7228 5371          super(Sq
+0006fdc0: 6c69 7465 4772 6964 4261 7365 2c20 7365  liteGridBase, se
+0006fdd0: 6c66 292e 5f5f 696e 6974 5f5f 2829 0d0a  lf).__init__()..
+0006fde0: 2020 2020 2020 2020 7365 6c66 2e69 735f          self.is_
+0006fdf0: 7175 6572 7920 3d20 626f 6f6c 2873 716c  query = bool(sql
+0006fe00: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+0006fe10: 6462 203d 2064 620d 0a20 2020 2020 2020  db = db..       
+0006fe20: 2073 656c 662e 7371 6c20 3d20 7371 6c0d   self.sql = sql.
+0006fe30: 0a20 2020 2020 2020 2073 656c 662e 7461  .        self.ta
+0006fe40: 626c 6520 3d20 7461 626c 650d 0a20 2020  ble = table..   
+0006fe50: 2020 2020 2023 2049 4420 6865 7265 2069       # ID here i
+0006fe60: 7320 6120 756e 6971 7565 2076 616c 7565  s a unique value
+0006fe70: 2069 6465 6e74 6966 7969 6e67 2072 6f77   identifying row
+0006fe80: 7320 696e 2074 6869 7320 6f62 6a65 6374  s in this object
+0006fe90: 2c0d 0a20 2020 2020 2020 2023 206e 6f20  ,..        # no 
+0006fea0: 7265 6c61 7469 6f6e 2074 6f20 7461 626c  relation to tabl
+0006feb0: 6520 6461 7461 0d0a 2020 2020 2020 2020  e data..        
+0006fec0: 7365 6c66 2e69 6478 5f61 6c6c 203d 205b  self.idx_all = [
+0006fed0: 5d20 2320 416e 206f 7264 6572 6564 206c  ] # An ordered l
+0006fee0: 6973 7420 6f66 2072 6f77 2069 6465 6e74  ist of row ident
+0006fef0: 6966 6965 7273 2069 6e20 726f 7773 5f61  ifiers in rows_a
+0006ff00: 6c6c 0d0a 2020 2020 2020 2020 7365 6c66  ll..        self
+0006ff10: 2e72 6f77 735f 616c 6c20 3d20 7b7d 2023  .rows_all = {} #
+0006ff20: 2055 6e66 696c 7465 7265 642c 2075 6e73   Unfiltered, uns
+0006ff30: 6f72 7465 6420 726f 7773 207b 6964 3a20  orted rows {id: 
+0006ff40: 726f 772c 207d 0d0a 2020 2020 2020 2020  row, }..        
+0006ff50: 7365 6c66 2e72 6f77 735f 6375 7272 656e  self.rows_curren
+0006ff60: 7420 3d20 5b5d 2023 2043 7572 7265 6e74  t = [] # Current
+0006ff70: 6c79 2073 686f 776e 2028 6669 6c74 6572  ly shown (filter
+0006ff80: 6564 2f73 6f72 7465 6429 2072 6f77 730d  ed/sorted) rows.
+0006ff90: 0a20 2020 2020 2020 2073 656c 662e 726f  .        self.ro
+0006ffa0: 7769 6473 203d 207b 7d20 2320 5351 4c69  wids = {} # SQLi
+0006ffb0: 7465 2074 6162 6c65 2072 6f77 6964 732c  te table rowids,
+0006ffc0: 2075 7365 6420 666f 7220 5550 4441 5445   used for UPDATE
+0006ffd0: 2061 6e64 2044 454c 4554 450d 0a20 2020   and DELETE..   
+0006ffe0: 2020 2020 2073 656c 662e 6964 785f 6368       self.idx_ch
+0006fff0: 616e 6765 6420 3d20 7365 7428 2920 2320  anged = set() # 
+00070000: 7365 7420 6f66 2069 6e64 6963 6573 2066  set of indices f
+00070010: 6f72 2063 6861 6e67 6564 2072 6f77 7320  or changed rows 
+00070020: 696e 2072 6f77 735f 616c 6c0d 0a20 2020  in rows_all..   
+00070030: 2020 2020 2073 656c 662e 726f 7773 5f62       self.rows_b
+00070040: 6163 6b75 7020 3d20 7b7d 2023 2046 6f72  ackup = {} # For
+00070050: 2063 6861 6e67 6564 2072 6f77 7320 7b69   changed rows {i
+00070060: 643a 206f 7269 6769 6e61 6c5f 726f 772c  d: original_row,
+00070070: 207d 0d0a 2020 2020 2020 2020 7365 6c66   }..        self
+00070080: 2e69 6478 5f6e 6577 203d 205b 5d20 2320  .idx_new = [] # 
+00070090: 556e 7361 7665 6420 6164 6465 6420 726f  Unsaved added ro
+000700a0: 7720 696e 6469 6365 730d 0a20 2020 2020  w indices..     
+000700b0: 2020 2073 656c 662e 726f 7773 5f64 656c     self.rows_del
+000700c0: 6574 6564 203d 207b 7d20 2320 556e 636f  eted = {} # Unco
+000700d0: 6d6d 6974 7465 6420 6465 6c65 7465 6420  mmitted deleted 
+000700e0: 726f 7773 207b 6964 3a20 6465 6c65 7465  rows {id: delete
+000700f0: 645f 726f 772c 207d 0d0a 2020 2020 2020  d_row, }..      
+00070100: 2020 7365 6c66 2e72 6f77 6964 5f6e 616d    self.rowid_nam
+00070110: 6520 3d20 2252 4f57 4944 2573 2220 2520  e = "ROWID%s" % 
+00070120: 696e 7428 7469 6d65 2e74 696d 6528 2929  int(time.time())
+00070130: 2023 2041 766f 6964 2063 6f6c 6c69 7369   # Avoid collisi
+00070140: 6f6e 730d 0a20 2020 2020 2020 2073 656c  ons..        sel
+00070150: 662e 6974 6572 6174 6f72 5f69 6e64 6578  f.iterator_index
+00070160: 203d 202d 310d 0a20 2020 2020 2020 2073   = -1..        s
+00070170: 656c 662e 736f 7274 5f61 7363 656e 6469  elf.sort_ascendi
+00070180: 6e67 203d 2046 616c 7365 0d0a 2020 2020  ng = False..    
+00070190: 2020 2020 7365 6c66 2e73 6f72 745f 636f      self.sort_co
+000701a0: 6c75 6d6e 203d 204e 6f6e 6520 2320 496e  lumn = None # In
+000701b0: 6465 7820 6f66 2063 6f6c 756d 6e20 6375  dex of column cu
+000701c0: 7272 656e 746c 7920 736f 7274 6564 2062  rrently sorted b
+000701d0: 790d 0a20 2020 2020 2020 2073 656c 662e  y..        self.
+000701e0: 6669 6c74 6572 7320 3d20 7b7d 2023 207b  filters = {} # {
+000701f0: 636f 6c3a 2076 616c 7565 2c20 7d0d 0a20  col: value, }.. 
+00070200: 2020 2020 2020 2073 656c 662e 6174 7472         self.attr
+00070210: 7320 3d20 7b7d 2023 207b 226e 6577 223a  s = {} # {"new":
+00070220: 2077 782e 6772 6964 2e47 7269 6443 656c   wx.grid.GridCel
+00070230: 6c41 7474 722c 207d 0d0a 0d0a 2020 2020  lAttr, }....    
+00070240: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
+00070250: 6973 5f71 7565 7279 3a0d 0a20 2020 2020  is_query:..     
+00070260: 2020 2020 2020 2073 656c 662e 7371 6c20         self.sql 
+00070270: 3d20 2253 454c 4543 5420 726f 7769 6420  = "SELECT rowid 
+00070280: 4153 2025 732c 202a 2046 524f 4d20 2573  AS %s, * FROM %s
+00070290: 2220 2520 2873 656c 662e 726f 7769 645f  " % (self.rowid_
+000702a0: 6e61 6d65 2c20 7461 626c 6529 0d0a 2020  name, table)..  
+000702b0: 2020 2020 2020 7365 6c66 2e72 6f77 5f69        self.row_i
+000702c0: 7465 7261 746f 7220 3d20 6462 2e65 7865  terator = db.exe
+000702d0: 6375 7465 2873 656c 662e 7371 6c29 0d0a  cute(self.sql)..
+000702e0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+000702f0: 6973 5f71 7565 7279 3a0d 0a20 2020 2020  is_query:..     
+00070300: 2020 2020 2020 2073 656c 662e 636f 6c75         self.colu
+00070310: 6d6e 7320 3d20 5b7b 226e 616d 6522 3a20  mns = [{"name": 
+00070320: 635b 305d 2c20 2274 7970 6522 3a20 2254  c[0], "type": "T
+00070330: 4558 5422 7d0d 0a20 2020 2020 2020 2020  EXT"}..         
+00070340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00070350: 2020 2066 6f72 2063 2069 6e20 7365 6c66     for c in self
+00070360: 2e72 6f77 5f69 7465 7261 746f 722e 6465  .row_iterator.de
+00070370: 7363 7269 7074 696f 6e20 6f72 2028 295d  scription or ()]
+00070380: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00070390: 446f 696e 6720 736f 6d65 2074 7269 636b  Doing some trick
+000703a0: 6572 7920 6865 7265 3a20 7765 2063 616e  ery here: we can
+000703b0: 206f 6e6c 7920 6b6e 6f77 2074 6865 2072   only know the r
+000703c0: 6f77 2063 6f75 6e74 2077 6865 6e20 7765  ow count when we
+000703d0: 2068 6176 650d 0a20 2020 2020 2020 2020   have..         
+000703e0: 2020 2023 2072 6574 7269 6576 6564 2061     # retrieved a
+000703f0: 6c6c 2074 6865 2072 6f77 732c 2077 6869  ll the rows, whi
+00070400: 6368 2069 7320 7072 6566 6572 7261 626c  ch is preferrabl
+00070410: 6520 6e6f 7420 746f 2064 6f20 6174 2066  e not to do at f
+00070420: 6972 7374 2c0d 0a20 2020 2020 2020 2020  irst,..         
+00070430: 2020 2023 2073 696e 6365 2074 6865 7265     # since there
+00070440: 2069 7320 6e6f 2074 656c 6c69 6e67 2068   is no telling h
+00070450: 6f77 206d 7563 6820 7469 6d65 2069 7420  ow much time it 
+00070460: 6361 6e20 7461 6b65 2e20 496e 7374 6561  can take. Instea
+00070470: 642c 2077 650d 0a20 2020 2020 2020 2020  d, we..         
+00070480: 2020 2023 2075 7064 6174 6520 7468 6520     # update the 
+00070490: 726f 7720 636f 756e 7420 6368 756e 6b20  row count chunk 
+000704a0: 6279 2063 6875 6e6b 2e0d 0a20 2020 2020  by chunk...     
+000704b0: 2020 2020 2020 2073 656c 662e 726f 775f         self.row_
+000704c0: 636f 756e 7420 3d20 7365 6c66 2e53 4545  count = self.SEE
+000704d0: 4b5f 4348 554e 4b5f 4c45 4e47 5448 0d0a  K_CHUNK_LENGTH..
+000704e0: 2020 2020 2020 2020 2020 2020 5459 5045              TYPE
+000704f0: 5320 3d20 6469 6374 2828 762c 206b 2920  S = dict((v, k) 
+00070500: 666f 7220 6b2c 2076 7620 696e 207b 2249  for k, vv in {"I
+00070510: 4e54 4547 4552 223a 2073 6978 2e69 6e74  NTEGER": six.int
+00070520: 6567 6572 5f74 7970 6573 202b 2028 626f  eger_types + (bo
+00070530: 6f6c 2c20 292c 0d0a 2020 2020 2020 2020  ol, ),..        
+00070540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00070550: 2022 5245 414c 223a 2028 666c 6f61 742c   "REAL": (float,
+00070560: 2029 7d2e 6974 656d 7328 2920 666f 7220   )}.items() for 
+00070570: 7620 696e 2076 7629 0d0a 2020 2020 2020  v in vv)..      
+00070580: 2020 2020 2020 2320 5365 656b 2061 6865        # Seek ahe
+00070590: 6164 206f 6e20 726f 7773 2061 6e64 2067  ad on rows and g
+000705a0: 6574 2063 6f6c 756d 6e20 696e 666f 726d  et column inform
+000705b0: 6174 696f 6e20 6672 6f6d 2066 6972 7374  ation from first
+000705c0: 2076 616c 7565 730d 0a20 2020 2020 2020   values..       
+000705d0: 2020 2020 2074 7279 3a20 7365 6c66 2e53       try: self.S
+000705e0: 6565 6b54 6f52 6f77 2873 656c 662e 5345  eekToRow(self.SE
+000705f0: 454b 5f43 4855 4e4b 5f4c 454e 4754 4820  EK_CHUNK_LENGTH 
+00070600: 2d20 3129 0d0a 2020 2020 2020 2020 2020  - 1)..          
+00070610: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
+00070620: 6f6e 3a20 7061 7373 0d0a 2020 2020 2020  on: pass..      
+00070630: 2020 2020 2020 6966 2073 656c 662e 726f        if self.ro
+00070640: 7773 5f63 7572 7265 6e74 3a0d 0a20 2020  ws_current:..   
+00070650: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+00070660: 2063 6f6c 2069 6e20 7365 6c66 2e63 6f6c   col in self.col
+00070670: 756d 6e73 3a0d 0a20 2020 2020 2020 2020  umns:..         
+00070680: 2020 2020 2020 2020 2020 2076 616c 7565             value
+00070690: 203d 2073 656c 662e 726f 7773 5f63 7572   = self.rows_cur
+000706a0: 7265 6e74 5b30 5d5b 636f 6c5b 226e 616d  rent[0][col["nam
+000706b0: 6522 5d5d 0d0a 2020 2020 2020 2020 2020  e"]]..          
+000706c0: 2020 2020 2020 2020 2020 636f 6c5b 2274            col["t
+000706d0: 7970 6522 5d20 3d20 5459 5045 532e 6765  ype"] = TYPES.ge
+000706e0: 7428 7479 7065 2876 616c 7565 292c 2063  t(type(value), c
+000706f0: 6f6c 5b22 7479 7065 225d 290d 0a20 2020  ol["type"])..   
+00070700: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+00070710: 2020 2020 2020 2020 7365 6c66 2e63 6f6c          self.col
+00070720: 756d 6e73 203d 2064 622e 6765 745f 7461  umns = db.get_ta
+00070730: 626c 655f 636f 6c75 6d6e 7328 7461 626c  ble_columns(tabl
+00070740: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+00070750: 7365 6c66 2e72 6f77 5f63 6f75 6e74 203d  self.row_count =
+00070760: 206e 6578 7428 6462 2e65 7865 6375 7465   next(db.execute
+00070770: 2822 5345 4c45 4354 2043 4f55 4e54 282a  ("SELECT COUNT(*
+00070780: 2920 4153 2072 6f77 7320 4652 4f4d 2025  ) AS rows FROM %
+00070790: 7322 0d0a 2020 2020 2020 2020 2020 2020  s"..            
+000707a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000707b0: 2020 2020 2020 2520 7461 626c 6529 295b        % table))[
+000707c0: 2272 6f77 7322 5d0d 0a0d 0a0d 0a20 2020  "rows"]......   
+000707d0: 2064 6566 2047 6574 436f 6c4c 6162 656c   def GetColLabel
+000707e0: 5661 6c75 6528 7365 6c66 2c20 636f 6c29  Value(self, col)
+000707f0: 3a0d 0a20 2020 2020 2020 206c 6162 656c  :..        label
+00070800: 203d 2073 656c 662e 636f 6c75 6d6e 735b   = self.columns[
+00070810: 636f 6c5d 5b22 6e61 6d65 225d 0d0a 2020  col]["name"]..  
+00070820: 2020 2020 2020 6966 2063 6f6c 203d 3d20        if col == 
+00070830: 7365 6c66 2e73 6f72 745f 636f 6c75 6d6e  self.sort_column
+00070840: 3a0d 0a20 2020 2020 2020 2020 2020 206c  :..            l
+00070850: 6162 656c 202b 3d20 7522 20e2 8691 2220  abel += u" ..." 
+00070860: 6966 2073 656c 662e 736f 7274 5f61 7363  if self.sort_asc
+00070870: 656e 6469 6e67 2065 6c73 6520 7522 20e2  ending else u" .
+00070880: 8693 220d 0a20 2020 2020 2020 2069 6620  .."..        if 
+00070890: 636f 6c20 696e 2073 656c 662e 6669 6c74  col in self.filt
+000708a0: 6572 733a 0d0a 2020 2020 2020 2020 2020  ers:..          
+000708b0: 2020 6966 2022 5445 5854 2220 3d3d 2073    if "TEXT" == s
+000708c0: 656c 662e 636f 6c75 6d6e 735b 636f 6c5d  elf.columns[col]
+000708d0: 5b22 7479 7065 225d 3a0d 0a20 2020 2020  ["type"]:..     
+000708e0: 2020 2020 2020 2020 2020 206c 6162 656c             label
+000708f0: 202b 3d20 225c 6e6c 696b 6520 5c22 2573   += "\nlike \"%s
+00070900: 5c22 2220 2520 7365 6c66 2e66 696c 7465  \"" % self.filte
+00070910: 7273 5b63 6f6c 5d0d 0a20 2020 2020 2020  rs[col]..       
+00070920: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+00070930: 2020 2020 2020 2020 2020 2020 6c61 6265              labe
+00070940: 6c20 2b3d 2022 5c6e 3d20 2573 2220 2520  l += "\n= %s" % 
+00070950: 7365 6c66 2e66 696c 7465 7273 5b63 6f6c  self.filters[col
+00070960: 5d0d 0a20 2020 2020 2020 2072 6574 7572  ]..        retur
+00070970: 6e20 6c61 6265 6c0d 0a0d 0a0d 0a20 2020  n label......   
+00070980: 2064 6566 2047 6574 4e75 6d62 6572 526f   def GetNumberRo
+00070990: 7773 2873 656c 6629 3a0d 0a20 2020 2020  ws(self):..     
+000709a0: 2020 2072 6573 756c 7420 3d20 7365 6c66     result = self
+000709b0: 2e72 6f77 5f63 6f75 6e74 0d0a 2020 2020  .row_count..    
+000709c0: 2020 2020 6966 2073 656c 662e 6669 6c74      if self.filt
+000709d0: 6572 733a 0d0a 2020 2020 2020 2020 2020  ers:..          
+000709e0: 2020 7265 7375 6c74 203d 206c 656e 2873    result = len(s
+000709f0: 656c 662e 726f 7773 5f63 7572 7265 6e74  elf.rows_current
+00070a00: 290d 0a20 2020 2020 2020 2072 6574 7572  )..        retur
+00070a10: 6e20 7265 7375 6c74 0d0a 0d0a 0d0a 2020  n result......  
+00070a20: 2020 6465 6620 4765 744e 756d 6265 7243    def GetNumberC
+00070a30: 6f6c 7328 7365 6c66 293a 0d0a 2020 2020  ols(self):..    
+00070a40: 2020 2020 7265 7475 726e 206c 656e 2873      return len(s
+00070a50: 656c 662e 636f 6c75 6d6e 7329 0d0a 0d0a  elf.columns)....
+00070a60: 0d0a 2020 2020 6465 6620 5365 656b 4168  ..    def SeekAh
+00070a70: 6561 6428 7365 6c66 2c20 746f 5f65 6e64  ead(self, to_end
+00070a80: 3d46 616c 7365 293a 0d0a 2020 2020 2020  =False):..      
+00070a90: 2020 2222 220d 0a20 2020 2020 2020 2053    """..        S
+00070aa0: 6565 6b73 2061 6865 6164 206f 6e20 7468  eeks ahead on th
+00070ab0: 6520 7175 6572 7920 6375 7273 6f72 2c20  e query cursor, 
+00070ac0: 6279 2074 6865 2063 6875 6e6b 206c 656e  by the chunk len
+00070ad0: 6774 6820 6f72 2075 6e74 696c 2074 6865  gth or until the
+00070ae0: 2065 6e64 2e0d 0a0d 0a20 2020 2020 2020   end.....       
+00070af0: 2040 7061 7261 6d20 2020 746f 5f65 6e64   @param   to_end
+00070b00: 2020 6966 2054 7275 652c 2072 6574 7269    if True, retri
+00070b10: 6576 6573 2061 6c6c 2072 6f77 730d 0a20  eves all rows.. 
+00070b20: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
+00070b30: 2020 2020 7365 656b 5f63 6f75 6e74 203d      seek_count =
+00070b40: 2073 656c 662e 726f 775f 636f 756e 7420   self.row_count 
+00070b50: 2b20 7365 6c66 2e53 4545 4b5f 4348 554e  + self.SEEK_CHUN
+00070b60: 4b5f 4c45 4e47 5448 202d 2031 0d0a 2020  K_LENGTH - 1..  
+00070b70: 2020 2020 2020 6966 2074 6f5f 656e 643a        if to_end:
+00070b80: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00070b90: 656b 5f63 6f75 6e74 203d 2073 7973 2e6d  ek_count = sys.m
+00070ba0: 6178 7369 7a65 0d0a 2020 2020 2020 2020  axsize..        
+00070bb0: 7365 6c66 2e53 6565 6b54 6f52 6f77 2873  self.SeekToRow(s
+00070bc0: 6565 6b5f 636f 756e 7429 0d0a 0d0a 0d0a  eek_count)......
+00070bd0: 2020 2020 6465 6620 5365 656b 546f 526f      def SeekToRo
+00070be0: 7728 7365 6c66 2c20 726f 7729 3a0d 0a20  w(self, row):.. 
+00070bf0: 2020 2020 2020 2022 2222 5365 656b 7320         """Seeks 
+00070c00: 6168 6561 6420 6f6e 2074 6865 2072 6f77  ahead on the row
+00070c10: 2069 7465 7261 746f 7220 746f 2074 6865   iterator to the
+00070c20: 2073 7065 6369 6669 6564 2072 6f77 2e22   specified row."
+00070c30: 2222 0d0a 2020 2020 2020 2020 726f 7773  ""..        rows
+00070c40: 5f62 6566 6f72 6520 3d20 6c65 6e28 7365  _before = len(se
+00070c50: 6c66 2e72 6f77 735f 616c 6c29 0d0a 2020  lf.rows_all)..  
+00070c60: 2020 2020 2020 7768 696c 6520 7365 6c66        while self
+00070c70: 2e72 6f77 5f69 7465 7261 746f 7220 616e  .row_iterator an
+00070c80: 6420 2873 656c 662e 6974 6572 6174 6f72  d (self.iterator
+00070c90: 5f69 6e64 6578 203c 2072 6f77 293a 0d0a  _index < row):..
+00070ca0: 2020 2020 2020 2020 2020 2020 726f 7764              rowd
+00070cb0: 6174 6120 3d20 4e6f 6e65 0d0a 2020 2020  ata = None..    
+00070cc0: 2020 2020 2020 2020 7472 793a 0d0a 2020          try:..  
+00070cd0: 2020 2020 2020 2020 2020 2020 2020 726f                ro
+00070ce0: 7764 6174 6120 3d20 6e65 7874 2873 656c  wdata = next(sel
+00070cf0: 662e 726f 775f 6974 6572 6174 6f72 290d  f.row_iterator).
+00070d00: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
+00070d10: 6570 7420 4578 6365 7074 696f 6e3a 0d0a  ept Exception:..
+00070d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00070d30: 7061 7373 0d0a 2020 2020 2020 2020 2020  pass..          
+00070d40: 2020 6966 2072 6f77 6461 7461 3a0d 0a20    if rowdata:.. 
+00070d50: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00070d60: 6478 203d 2069 6428 726f 7764 6174 6129  dx = id(rowdata)
+00070d70: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00070d80: 2020 6966 206e 6f74 2073 656c 662e 6973    if not self.is
+00070d90: 5f71 7565 7279 3a0d 0a20 2020 2020 2020  _query:..       
+00070da0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00070db0: 662e 726f 7769 6473 5b69 6478 5d20 3d20  f.rowids[idx] = 
+00070dc0: 726f 7764 6174 615b 7365 6c66 2e72 6f77  rowdata[self.row
+00070dd0: 6964 5f6e 616d 655d 0d0a 2020 2020 2020  id_name]..      
+00070de0: 2020 2020 2020 2020 2020 2020 2020 6465                de
+00070df0: 6c20 726f 7764 6174 615b 7365 6c66 2e72  l rowdata[self.r
+00070e00: 6f77 6964 5f6e 616d 655d 0d0a 2020 2020  owid_name]..    
+00070e10: 2020 2020 2020 2020 2020 2020 726f 7764              rowd
+00070e20: 6174 615b 225f 5f69 645f 5f22 5d20 3d20  ata["__id__"] = 
+00070e30: 6964 780d 0a20 2020 2020 2020 2020 2020  idx..           
+00070e40: 2020 2020 2072 6f77 6461 7461 5b22 5f5f       rowdata["__
+00070e50: 6368 616e 6765 645f 5f22 5d20 3d20 4661  changed__"] = Fa
+00070e60: 6c73 650d 0a20 2020 2020 2020 2020 2020  lse..           
+00070e70: 2020 2020 2072 6f77 6461 7461 5b22 5f5f       rowdata["__
+00070e80: 6e65 775f 5f22 5d20 3d20 4661 6c73 650d  new__"] = False.
+00070e90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00070ea0: 2072 6f77 6461 7461 5b22 5f5f 6465 6c65   rowdata["__dele
+00070eb0: 7465 645f 5f22 5d20 3d20 4661 6c73 650d  ted__"] = False.
+00070ec0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00070ed0: 2073 656c 662e 726f 7773 5f61 6c6c 5b69   self.rows_all[i
+00070ee0: 6478 5d20 3d20 726f 7764 6174 610d 0a20  dx] = rowdata.. 
+00070ef0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00070f00: 656c 662e 726f 7773 5f63 7572 7265 6e74  elf.rows_current
+00070f10: 2e61 7070 656e 6428 726f 7764 6174 6129  .append(rowdata)
+00070f20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00070f30: 2020 7365 6c66 2e69 6478 5f61 6c6c 2e61    self.idx_all.a
+00070f40: 7070 656e 6428 6964 7829 0d0a 2020 2020  ppend(idx)..    
+00070f50: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00070f60: 2e69 7465 7261 746f 725f 696e 6465 7820  .iterator_index 
+00070f70: 2b3d 2031 0d0a 2020 2020 2020 2020 2020  += 1..          
+00070f80: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+00070f90: 2020 2020 2020 2020 2073 656c 662e 726f           self.ro
+00070fa0: 775f 6974 6572 6174 6f72 203d 204e 6f6e  w_iterator = Non
+00070fb0: 650d 0a20 2020 2020 2020 2069 6620 7365  e..        if se
+00070fc0: 6c66 2e69 735f 7175 6572 793a 0d0a 2020  lf.is_query:..  
+00070fd0: 2020 2020 2020 2020 2020 6966 2028 7365            if (se
+00070fe0: 6c66 2e72 6f77 5f63 6f75 6e74 2021 3d20  lf.row_count != 
+00070ff0: 7365 6c66 2e69 7465 7261 746f 725f 696e  self.iterator_in
+00071000: 6465 7820 2b20 3129 3a0d 0a20 2020 2020  dex + 1):..     
+00071010: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00071020: 726f 775f 636f 756e 7420 3d20 7365 6c66  row_count = self
+00071030: 2e69 7465 7261 746f 725f 696e 6465 7820  .iterator_index 
+00071040: 2b20 310d 0a20 2020 2020 2020 2020 2020  + 1..           
+00071050: 2020 2020 2073 656c 662e 4e6f 7469 6679       self.Notify
+00071060: 5669 6577 4368 616e 6765 2872 6f77 735f  ViewChange(rows_
+00071070: 6265 666f 7265 290d 0a0d 0a0d 0a20 2020  before)......   
+00071080: 2064 6566 2047 6574 5661 6c75 6528 7365   def GetValue(se
+00071090: 6c66 2c20 726f 772c 2063 6f6c 293a 0d0a  lf, row, col):..
+000710a0: 2020 2020 2020 2020 7661 6c75 6520 3d20          value = 
+000710b0: 4e6f 6e65 0d0a 2020 2020 2020 2020 6966  None..        if
+000710c0: 2072 6f77 203c 2073 656c 662e 726f 775f   row < self.row_
+000710d0: 636f 756e 743a 0d0a 2020 2020 2020 2020  count:..        
+000710e0: 2020 2020 7365 6c66 2e53 6565 6b54 6f52      self.SeekToR
+000710f0: 6f77 2872 6f77 290d 0a20 2020 2020 2020  ow(row)..       
+00071100: 2020 2020 2069 6620 726f 7720 3c20 6c65       if row < le
+00071110: 6e28 7365 6c66 2e72 6f77 735f 6375 7272  n(self.rows_curr
+00071120: 656e 7429 3a0d 0a20 2020 2020 2020 2020  ent):..         
+00071130: 2020 2020 2020 2076 616c 7565 203d 2073         value = s
+00071140: 656c 662e 726f 7773 5f63 7572 7265 6e74  elf.rows_current
+00071150: 5b72 6f77 5d5b 7365 6c66 2e63 6f6c 756d  [row][self.colum
+00071160: 6e73 5b63 6f6c 5d5b 226e 616d 6522 5d5d  ns[col]["name"]]
+00071170: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00071180: 2020 6966 2073 7973 2e76 6572 7369 6f6e    if sys.version
+00071190: 5f69 6e66 6f20 3c20 2833 2c20 2920 616e  _info < (3, ) an
+000711a0: 6420 7479 7065 2876 616c 7565 2920 6973  d type(value) is
+000711b0: 2062 7566 6665 723a 2020 2320 5079 320d   buffer:  # Py2.
+000711c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000711d0: 2020 2020 2076 616c 7565 203d 2073 7472       value = str
+000711e0: 2876 616c 7565 292e 6465 636f 6465 2822  (value).decode("
+000711f0: 6c61 7469 6e31 2229 0d0a 2020 2020 2020  latin1")..      
+00071200: 2020 6966 2076 616c 7565 2061 6e64 2022    if value and "
+00071210: 424c 4f42 2220 3d3d 2073 656c 662e 636f  BLOB" == self.co
+00071220: 6c75 6d6e 735b 636f 6c5d 5b22 7479 7065  lumns[col]["type
+00071230: 225d 3a0d 0a20 2020 2020 2020 2020 2020  "]:..           
+00071240: 2023 2042 6c6f 6273 206e 6565 6420 7370   # Blobs need sp
+00071250: 6563 6961 6c20 6861 6e64 6c69 6e67 2c20  ecial handling, 
+00071260: 6173 2074 6865 2074 6578 7420 6564 6974  as the text edit
+00071270: 6f72 2064 6f65 7320 6e6f 740d 0a20 2020  or does not..   
+00071280: 2020 2020 2020 2020 2023 2073 7570 706f           # suppo
+00071290: 7274 2063 6f6e 7472 6f6c 2063 6861 7261  rt control chara
+000712a0: 6374 6572 7320 6f72 206e 756c 6c20 6279  cters or null by
+000712b0: 7465 732e 0d0a 2020 2020 2020 2020 2020  tes...          
+000712c0: 2020 7661 6c75 6520 3d20 7661 6c75 652e    value = value.
+000712d0: 656e 636f 6465 2822 756e 6963 6f64 652d  encode("unicode-
+000712e0: 6573 6361 7065 2229 2e64 6563 6f64 6528  escape").decode(
+000712f0: 226c 6174 696e 3122 290d 0a20 2020 2020  "latin1")..     
+00071300: 2020 2072 6574 7572 6e20 7661 6c75 6520     return value 
+00071310: 6966 2076 616c 7565 2069 7320 6e6f 7420  if value is not 
+00071320: 4e6f 6e65 2065 6c73 6520 2222 0d0a 0d0a  None else ""....
+00071330: 0d0a 2020 2020 6465 6620 4765 7452 6f77  ..    def GetRow
+00071340: 2873 656c 662c 2072 6f77 293a 0d0a 2020  (self, row):..  
+00071350: 2020 2020 2020 2222 2252 6574 7572 6e73        """Returns
+00071360: 2074 6865 2064 6174 6120 6469 6374 696f   the data dictio
+00071370: 6e61 7279 206f 6620 7468 6520 7370 6563  nary of the spec
+00071380: 6966 6965 6420 726f 772e 2222 220d 0a20  ified row.""".. 
+00071390: 2020 2020 2020 2076 616c 7565 203d 204e         value = N
+000713a0: 6f6e 650d 0a20 2020 2020 2020 2069 6620  one..        if 
+000713b0: 726f 7720 3c20 7365 6c66 2e72 6f77 5f63  row < self.row_c
+000713c0: 6f75 6e74 3a0d 0a20 2020 2020 2020 2020  ount:..         
+000713d0: 2020 2073 656c 662e 5365 656b 546f 526f     self.SeekToRo
+000713e0: 7728 726f 7729 0d0a 2020 2020 2020 2020  w(row)..        
+000713f0: 2020 2020 6966 2072 6f77 203c 206c 656e      if row < len
+00071400: 2873 656c 662e 726f 7773 5f63 7572 7265  (self.rows_curre
+00071410: 6e74 293a 0d0a 2020 2020 2020 2020 2020  nt):..          
+00071420: 2020 2020 2020 7661 6c75 6520 3d20 7365        value = se
+00071430: 6c66 2e72 6f77 735f 6375 7272 656e 745b  lf.rows_current[
+00071440: 726f 775d 0d0a 2020 2020 2020 2020 7265  row]..        re
+00071450: 7475 726e 2076 616c 7565 0d0a 0d0a 0d0a  turn value......
+00071460: 2020 2020 6465 6620 4765 7452 6f77 4974      def GetRowIt
+00071470: 6572 6174 6f72 2873 656c 6629 3a0d 0a20  erator(self):.. 
+00071480: 2020 2020 2020 2022 2222 5265 7475 726e         """Return
+00071490: 7320 6120 7365 7061 7261 7465 2069 7465  s a separate ite
+000714a0: 7261 746f 7220 7072 6f64 7563 696e 6720  rator producing 
+000714b0: 616c 6c20 6772 6964 2072 6f77 732e 2222  all grid rows.""
+000714c0: 220d 0a20 2020 2020 2020 2022 2222 0d0a  "..        """..
+000714d0: 2020 2020 2020 2020 5265 7475 726e 7320          Returns 
+000714e0: 616e 2069 7465 7261 746f 7220 7072 6f64  an iterator prod
+000714f0: 7563 696e 6720 616c 6c20 6772 6964 2072  ucing all grid r
+00071500: 6f77 732c 2069 6e20 6375 7272 656e 7420  ows, in current 
+00071510: 736f 7274 206f 7264 6572 2061 6e64 0d0a  sort order and..
+00071520: 2020 2020 2020 2020 6d61 7463 6869 6e67          matching
+00071530: 2063 7572 7265 6e74 2066 696c 7465 722c   current filter,
+00071540: 206d 616b 696e 6720 616e 2065 7874 7261   making an extra
+00071550: 2071 7565 7279 2069 6620 616c 6c20 6e6f   query if all no
+00071560: 7420 7265 7472 6965 7665 6420 7965 742e  t retrieved yet.
+00071570: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
+00071580: 2020 2020 2020 2069 6620 7365 6c66 2e72         if self.r
+00071590: 6f77 5f69 7465 7261 746f 7220 6973 204e  ow_iterator is N
+000715a0: 6f6e 653a 2072 6574 7572 6e20 6974 6572  one: return iter
+000715b0: 2873 656c 662e 726f 7773 5f63 7572 7265  (self.rows_curre
+000715c0: 6e74 2920 2320 416c 6c20 7265 7472 6965  nt) # All retrie
+000715d0: 7665 640d 0a0d 0a20 2020 2020 2020 2064  ved....        d
+000715e0: 6566 2067 656e 6572 6174 6f72 2863 7572  ef generator(cur
+000715f0: 736f 7229 3a0d 0a20 2020 2020 2020 2020  sor):..         
+00071600: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
+00071610: 2020 2020 2020 2020 2066 6f72 2072 6f77           for row
+00071620: 2069 6e20 7365 6c66 2e72 6f77 735f 6375   in self.rows_cu
+00071630: 7272 656e 743a 2079 6965 6c64 2072 6f77  rrent: yield row
+00071640: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+00071650: 2020 2020 726f 772c 2069 6e64 6578 203d      row, index =
+00071660: 206e 6578 7428 6375 7273 6f72 292c 2030   next(cursor), 0
+00071670: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00071680: 2020 7768 696c 6520 726f 7720 616e 6420    while row and 
+00071690: 696e 6465 7820 3c20 7365 6c66 2e69 7465  index < self.ite
+000716a0: 7261 746f 725f 696e 6465 7820 2b20 313a  rator_index + 1:
+000716b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000716c0: 2020 2020 2020 726f 772c 2069 6e64 6578        row, index
+000716d0: 203d 206e 6578 7428 6375 7273 6f72 292c   = next(cursor),
+000716e0: 2069 6e64 6578 202b 2031 0d0a 2020 2020   index + 1..    
+000716f0: 2020 2020 2020 2020 2020 2020 7768 696c              whil
+00071700: 6520 726f 773a 0d0a 2020 2020 2020 2020  e row:..        
+00071710: 2020 2020 2020 2020 2020 2020 7768 696c              whil
+00071720: 6520 726f 7720 616e 6420 6e6f 7420 7365  e row and not se
+00071730: 6c66 2e5f 6973 5f72 6f77 5f75 6e66 696c  lf._is_row_unfil
+00071740: 7465 7265 6428 726f 7729 3a20 726f 7720  tered(row): row 
+00071750: 3d20 6e65 7874 2863 7572 736f 7229 0d0a  = next(cursor)..
+00071760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00071770: 2020 2020 6966 2072 6f77 3a20 7969 656c      if row: yiel
+00071780: 6420 726f 770d 0a20 2020 2020 2020 2020  d row..         
+00071790: 2020 2020 2020 2020 2020 2072 6f77 203d             row =
+000717a0: 206e 6578 7428 6375 7273 6f72 290d 0a20   next(cursor).. 
+000717b0: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+000717c0: 7420 2847 656e 6572 6174 6f72 4578 6974  t (GeneratorExit
+000717d0: 2c20 5374 6f70 4974 6572 6174 696f 6e29  , StopIteration)
+000717e0: 3a20 7061 7373 0d0a 0d0a 2020 2020 2020  : pass....      
+000717f0: 2020 7371 6c20 3d20 7365 6c66 2e73 716c    sql = self.sql
+00071800: 2069 6620 7365 6c66 2e69 735f 7175 6572   if self.is_quer
+00071810: 7920 656c 7365 2022 5345 4c45 4354 202a  y else "SELECT *
+00071820: 2046 524f 4d20 2573 2220 2520 7365 6c66   FROM %s" % self
+00071830: 2e74 6162 6c65 0d0a 2020 2020 2020 2020  .table..        
+00071840: 7265 7475 726e 2067 656e 6572 6174 6f72  return generator
+00071850: 2873 656c 662e 6462 2e65 7865 6375 7465  (self.db.execute
+00071860: 2873 716c 2929 0d0a 0d0a 0d0a 2020 2020  (sql))......    
+00071870: 6465 6620 5365 7456 616c 7565 2873 656c  def SetValue(sel
+00071880: 662c 2072 6f77 2c20 636f 6c2c 2076 616c  f, row, col, val
+00071890: 293a 0d0a 2020 2020 2020 2020 6966 206e  ):..        if n
+000718a0: 6f74 2028 7365 6c66 2e69 735f 7175 6572  ot (self.is_quer
+000718b0: 7929 2061 6e64 2028 726f 7720 3c20 7365  y) and (row < se
+000718c0: 6c66 2e72 6f77 5f63 6f75 6e74 293a 0d0a  lf.row_count):..
+000718d0: 2020 2020 2020 2020 2020 2020 6163 6365              acce
+000718e0: 7074 6564 203d 2046 616c 7365 0d0a 2020  pted = False..  
+000718f0: 2020 2020 2020 2020 2020 636f 6c5f 7661            col_va
+00071900: 6c75 6520 3d20 4e6f 6e65 0d0a 2020 2020  lue = None..    
+00071910: 2020 2020 2020 2020 6966 2022 494e 5445          if "INTE
+00071920: 4745 5222 203d 3d20 7365 6c66 2e63 6f6c  GER" == self.col
+00071930: 756d 6e73 5b63 6f6c 5d5b 2274 7970 6522  umns[col]["type"
+00071940: 5d3a 0d0a 2020 2020 2020 2020 2020 2020  ]:..            
+00071950: 2020 2020 6966 206e 6f74 2076 616c 3a20      if not val: 
+00071960: 2320 5365 7420 636f 6c75 6d6e 2074 6f20  # Set column to 
+00071970: 4e55 4c4c 0d0a 2020 2020 2020 2020 2020  NULL..          
+00071980: 2020 2020 2020 2020 2020 6163 6365 7074            accept
+00071990: 6564 203d 2054 7275 650d 0a20 2020 2020  ed = True..     
+000719a0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+000719b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000719c0: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
+000719d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000719e0: 2020 2020 2320 416c 6c6f 7720 7573 6572      # Allow user
+000719f0: 2074 6f20 656e 7465 7220 6120 636f 6d6d   to enter a comm
+00071a00: 6120 666f 7220 6465 6369 6d61 6c20 7365  a for decimal se
+00071a10: 7061 7261 746f 722e 0d0a 2020 2020 2020  parator...      
+00071a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00071a30: 2020 7661 6c63 203d 2076 616c 2e72 6570    valc = val.rep
+00071a40: 6c61 6365 2822 2c22 2c20 222e 2229 0d0a  lace(",", ".")..
+00071a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00071a60: 2020 2020 2020 2020 636f 6c5f 7661 6c75          col_valu
+00071a70: 6520 3d20 666c 6f61 7428 7661 6c63 2920  e = float(valc) 
+00071a80: 6966 2028 222e 2220 696e 2076 616c 6329  if ("." in valc)
+00071a90: 2065 6c73 6520 696e 7428 7661 6c29 0d0a   else int(val)..
+00071aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00071ab0: 2020 2020 2020 2020 6163 6365 7074 6564          accepted
+00071ac0: 203d 2054 7275 650d 0a20 2020 2020 2020   = True..       
+00071ad0: 2020 2020 2020 2020 2020 2020 2065 7863               exc
+00071ae0: 6570 7420 4578 6365 7074 696f 6e3a 0d0a  ept Exception:..
+00071af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00071b00: 2020 2020 2020 2020 7061 7373 0d0a 2020          pass..  
+00071b10: 2020 2020 2020 2020 2020 656c 6966 2022            elif "
+00071b20: 424c 4f42 2220 3d3d 2073 656c 662e 636f  BLOB" == self.co
+00071b30: 6c75 6d6e 735b 636f 6c5d 5b22 7479 7065  lumns[col]["type
+00071b40: 225d 3a0d 0a20 2020 2020 2020 2020 2020  "]:..           
+00071b50: 2020 2020 2023 2042 6c6f 6273 206e 6565       # Blobs nee
+00071b60: 6420 7370 6563 6961 6c20 6861 6e64 6c69  d special handli
+00071b70: 6e67 2c20 6173 2074 6865 2074 6578 7420  ng, as the text 
+00071b80: 6564 6974 6f72 2064 6f65 7320 6e6f 740d  editor does not.
+00071b90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00071ba0: 2023 2073 7570 706f 7274 2063 6f6e 7472   # support contr
+00071bb0: 6f6c 2063 6861 7261 6374 6572 7320 6f72  ol characters or
+00071bc0: 206e 756c 6c20 6279 7465 732e 0d0a 2020   null bytes...  
+00071bd0: 2020 2020 2020 2020 2020 2020 2020 7472                tr
+00071be0: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
+00071bf0: 2020 2020 2020 2020 636f 6c5f 7661 6c75          col_valu
+00071c00: 6520 3d20 7661 6c2e 6465 636f 6465 2822  e = val.decode("
+00071c10: 756e 6963 6f64 652d 6573 6361 7065 2229  unicode-escape")
+00071c20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00071c30: 2020 2020 2020 6163 6365 7074 6564 203d        accepted =
+00071c40: 2054 7275 650d 0a20 2020 2020 2020 2020   True..         
+00071c50: 2020 2020 2020 2065 7863 6570 7420 556e         except Un
+00071c60: 6963 6f64 6545 7272 6f72 3a20 2320 5465  icodeError: # Te
+00071c70: 7874 2069 7320 6e6f 7420 7661 6c69 6420  xt is not valid 
+00071c80: 6573 6361 7065 6420 556e 6963 6f64 650d  escaped Unicode.
+00071c90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00071ca0: 2020 2020 2070 6173 730d 0a20 2020 2020       pass..     
+00071cb0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+00071cc0: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00071cd0: 6c5f 7661 6c75 6520 3d20 7661 6c0d 0a20  l_value = val.. 
+00071ce0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00071cf0: 6363 6570 7465 6420 3d20 5472 7565 0d0a  ccepted = True..
+00071d00: 2020 2020 2020 2020 2020 2020 6966 2061              if a
+00071d10: 6363 6570 7465 643a 0d0a 2020 2020 2020  ccepted:..      
+00071d20: 2020 2020 2020 2020 2020 7365 6c66 2e53            self.S
+00071d30: 6565 6b54 6f52 6f77 2872 6f77 290d 0a20  eekToRow(row).. 
+00071d40: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00071d50: 6174 6120 3d20 7365 6c66 2e72 6f77 735f  ata = self.rows_
+00071d60: 6375 7272 656e 745b 726f 775d 0d0a 2020  current[row]..  
+00071d70: 2020 2020 2020 2020 2020 2020 2020 6964                id
+00071d80: 7820 3d20 6461 7461 5b22 5f5f 6964 5f5f  x = data["__id__
+00071d90: 225d 0d0a 2020 2020 2020 2020 2020 2020  "]..            
+00071da0: 2020 2020 6966 206e 6f74 2064 6174 615b      if not data[
+00071db0: 225f 5f6e 6577 5f5f 225d 3a0d 0a20 2020  "__new__"]:..   
+00071dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00071dd0: 2069 6620 6964 7820 6e6f 7420 696e 2073   if idx not in s
+00071de0: 656c 662e 726f 7773 5f62 6163 6b75 703a  elf.rows_backup:
+00071df0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00071e00: 2020 2020 2020 2020 2020 2320 4261 636b            # Back
+00071e10: 7570 206f 6e6c 7920 6578 6973 7469 6e67  up only existing
+00071e20: 2072 6f77 732c 206e 6577 2072 6f77 7320   rows, new rows 
+00071e30: 7769 6c6c 2062 6520 6472 6f70 7065 640d  will be dropped.
+00071e40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00071e50: 2020 2020 2020 2020 2023 206f 6e20 726f           # on ro
+00071e60: 6c6c 6261 636b 2061 6e79 7761 792e 0d0a  llback anyway...
+00071e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00071e80: 2020 2020 2020 2020 7365 6c66 2e72 6f77          self.row
+00071e90: 735f 6261 636b 7570 5b69 6478 5d20 3d20  s_backup[idx] = 
+00071ea0: 6461 7461 2e63 6f70 7928 290d 0a20 2020  data.copy()..   
+00071eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00071ec0: 2064 6174 615b 225f 5f63 6861 6e67 6564   data["__changed
+00071ed0: 5f5f 225d 203d 2054 7275 650d 0a20 2020  __"] = True..   
+00071ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00071ef0: 2073 656c 662e 6964 785f 6368 616e 6765   self.idx_change
+00071f00: 642e 6164 6428 6964 7829 0d0a 2020 2020  d.add(idx)..    
+00071f10: 2020 2020 2020 2020 2020 2020 6461 7461              data
+00071f20: 5b73 656c 662e 636f 6c75 6d6e 735b 636f  [self.columns[co
+00071f30: 6c5d 5b22 6e61 6d65 225d 5d20 3d20 636f  l]["name"]] = co
+00071f40: 6c5f 7661 6c75 650d 0a20 2020 2020 2020  l_value..       
+00071f50: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+00071f60: 2e56 6965 773a 2073 656c 662e 5669 6577  .View: self.View
+00071f70: 2e52 6566 7265 7368 2829 0d0a 0d0a 0d0a  .Refresh()......
+00071f80: 2020 2020 6465 6620 4973 4368 616e 6765      def IsChange
+00071f90: 6428 7365 6c66 293a 0d0a 2020 2020 2020  d(self):..      
+00071fa0: 2020 2222 2252 6574 7572 6e73 2077 6865    """Returns whe
+00071fb0: 7468 6572 2074 6865 7265 2069 7320 756e  ther there is un
+00071fc0: 636f 6d6d 6974 7465 6420 6368 616e 6765  committed change
+00071fd0: 6420 6461 7461 2069 6e20 7468 6973 2067  d data in this g
+00071fe0: 7269 642e 2222 220d 0a20 2020 2020 2020  rid."""..       
+00071ff0: 206c 656e 6774 6873 203d 206d 6170 286c   lengths = map(l
+00072000: 656e 2c20 5b73 656c 662e 6964 785f 6368  en, [self.idx_ch
+00072010: 616e 6765 642c 2073 656c 662e 6964 785f  anged, self.idx_
+00072020: 6e65 772c 2073 656c 662e 726f 7773 5f64  new, self.rows_d
+00072030: 656c 6574 6564 5d29 0d0a 2020 2020 2020  eleted])..      
+00072040: 2020 7265 7475 726e 2061 6e79 286c 656e    return any(len
+00072050: 6774 6873 290d 0a0d 0a0d 0a20 2020 2064  gths)......    d
+00072060: 6566 2047 6574 4368 616e 6765 6449 6e66  ef GetChangedInf
+00072070: 6f28 7365 6c66 293a 0d0a 2020 2020 2020  o(self):..      
+00072080: 2020 2222 2252 6574 7572 6e73 2061 6e20    """Returns an 
+00072090: 696e 666f 2073 7472 696e 6720 6162 6f75  info string abou
+000720a0: 7420 7468 6520 756e 636f 6d6d 6974 6564  t the uncommited
+000720b0: 2063 6861 6e67 6573 2069 6e20 7468 6973   changes in this
+000720c0: 2067 7269 642e 2222 220d 0a20 2020 2020   grid."""..     
+000720d0: 2020 2069 6e66 6f6c 6973 7420 3d20 5b5d     infolist = []
+000720e0: 0d0a 2020 2020 2020 2020 7661 6c75 6573  ..        values
+000720f0: 203d 207b 226e 6577 223a 206c 656e 2873   = {"new": len(s
+00072100: 656c 662e 6964 785f 6e65 7729 2c20 2263  elf.idx_new), "c
+00072110: 6861 6e67 6564 223a 206c 656e 2873 656c  hanged": len(sel
+00072120: 662e 6964 785f 6368 616e 6765 6429 2c0d  f.idx_changed),.
+00072130: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00072140: 2020 2022 6465 6c65 7465 6422 3a20 6c65     "deleted": le
+00072150: 6e28 7365 6c66 2e72 6f77 735f 6465 6c65  n(self.rows_dele
+00072160: 7465 6429 2c20 7d0d 0a20 2020 2020 2020  ted), }..       
+00072170: 2066 6f72 206c 6162 656c 2c20 636f 756e   for label, coun
+00072180: 7420 696e 2076 616c 7565 732e 6974 656d  t in values.item
+00072190: 7328 293a 0d0a 2020 2020 2020 2020 2020  s():..          
+000721a0: 2020 6966 2063 6f75 6e74 3a0d 0a20 2020    if count:..   
+000721b0: 2020 2020 2020 2020 2020 2020 2069 6e66               inf
+000721c0: 6f6c 6973 742e 6170 7065 6e64 2822 2573  olist.append("%s
+000721d0: 2025 7320 726f 7725 7322 0d0a 2020 2020   %s row%s"..    
+000721e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000721f0: 2520 2863 6f75 6e74 2c20 6c61 6265 6c2c  % (count, label,
+00072200: 2022 7322 2069 6620 636f 756e 7420 213d   "s" if count !=
+00072210: 2031 2065 6c73 6520 2222 2929 0d0a 2020   1 else ""))..  
+00072220: 2020 2020 2020 7265 7475 726e 2022 2c20        return ", 
+00072230: 222e 6a6f 696e 2869 6e66 6f6c 6973 7429  ".join(infolist)
+00072240: 0d0a 0d0a 0d0a 2020 2020 6465 6620 4765  ......    def Ge
+00072250: 7441 7474 7228 7365 6c66 2c20 726f 772c  tAttr(self, row,
+00072260: 2063 6f6c 2c20 6b69 6e64 293a 0d0a 2020   col, kind):..  
+00072270: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
+00072280: 662e 6174 7472 733a 0d0a 2020 2020 2020  f.attrs:..      
+00072290: 2020 2020 2020 666f 7220 6e20 696e 205b        for n in [
+000722a0: 226e 6577 222c 2022 6465 6661 756c 7422  "new", "default"
+000722b0: 2c20 2272 6f77 5f63 6861 6e67 6564 222c  , "row_changed",
+000722c0: 2022 6365 6c6c 5f63 6861 6e67 6564 222c   "cell_changed",
+000722d0: 0d0a 2020 2020 2020 2020 2020 2020 226e  ..            "n
+000722e0: 6577 626c 6f62 222c 2022 6465 6661 756c  ewblob", "defaul
+000722f0: 7462 6c6f 6222 2c20 2272 6f77 5f63 6861  tblob", "row_cha
+00072300: 6e67 6564 626c 6f62 222c 2022 6365 6c6c  ngedblob", "cell
+00072310: 5f63 6861 6e67 6564 626c 6f62 225d 3a0d  _changedblob"]:.
+00072320: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00072330: 2073 656c 662e 6174 7472 735b 6e5d 203d   self.attrs[n] =
+00072340: 2077 782e 6772 6964 2e47 7269 6443 656c   wx.grid.GridCel
+00072350: 6c41 7474 7228 290d 0a20 2020 2020 2020  lAttr()..       
+00072360: 2020 2020 2066 6f72 206e 2069 6e20 5b22       for n in ["
+00072370: 6e65 7722 2c20 226e 6577 626c 6f62 225d  new", "newblob"]
+00072380: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00072390: 2020 2073 656c 662e 6174 7472 735b 6e5d     self.attrs[n]
+000723a0: 2e53 6574 4261 636b 6772 6f75 6e64 436f  .SetBackgroundCo
+000723b0: 6c6f 7572 2863 6f6e 662e 4772 6964 526f  lour(conf.GridRo
+000723c0: 7749 6e73 6572 7465 6443 6f6c 6f75 7229  wInsertedColour)
+000723d0: 0d0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
+000723e0: 7220 6e20 696e 205b 2272 6f77 5f63 6861  r n in ["row_cha
+000723f0: 6e67 6564 222c 2022 726f 775f 6368 616e  nged", "row_chan
+00072400: 6765 6462 6c6f 6222 5d3a 0d0a 2020 2020  gedblob"]:..    
+00072410: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00072420: 2e61 7474 7273 5b6e 5d2e 5365 7442 6163  .attrs[n].SetBac
+00072430: 6b67 726f 756e 6443 6f6c 6f75 7228 636f  kgroundColour(co
+00072440: 6e66 2e47 7269 6452 6f77 4368 616e 6765  nf.GridRowChange
+00072450: 6443 6f6c 6f75 7229 0d0a 2020 2020 2020  dColour)..      
+00072460: 2020 2020 2020 666f 7220 6e20 696e 205b        for n in [
+00072470: 2263 656c 6c5f 6368 616e 6765 6422 2c20  "cell_changed", 
+00072480: 2263 656c 6c5f 6368 616e 6765 6462 6c6f  "cell_changedblo
+00072490: 6222 5d3a 0d0a 2020 2020 2020 2020 2020  b"]:..          
+000724a0: 2020 2020 2020 7365 6c66 2e61 7474 7273        self.attrs
+000724b0: 5b6e 5d2e 5365 7442 6163 6b67 726f 756e  [n].SetBackgroun
+000724c0: 6443 6f6c 6f75 7228 636f 6e66 2e47 7269  dColour(conf.Gri
+000724d0: 6443 656c 6c43 6861 6e67 6564 436f 6c6f  dCellChangedColo
+000724e0: 7572 290d 0a20 2020 2020 2020 2020 2020  ur)..           
+000724f0: 2066 6f72 206e 2069 6e20 5b22 6e65 7762   for n in ["newb
+00072500: 6c6f 6222 2c20 2264 6566 6175 6c74 626c  lob", "defaultbl
+00072510: 6f62 222c 0d0a 2020 2020 2020 2020 2020  ob",..          
+00072520: 2020 2272 6f77 5f63 6861 6e67 6564 626c    "row_changedbl
+00072530: 6f62 222c 2022 6365 6c6c 5f63 6861 6e67  ob", "cell_chang
+00072540: 6564 626c 6f62 225d 3a0d 0a20 2020 2020  edblob"]:..     
+00072550: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00072560: 6174 7472 735b 6e5d 2e53 6574 4564 6974  attrs[n].SetEdit
+00072570: 6f72 2877 782e 6772 6964 2e47 7269 6443  or(wx.grid.GridC
+00072580: 656c 6c41 7574 6f57 7261 7053 7472 696e  ellAutoWrapStrin
+00072590: 6745 6469 746f 7228 2929 0d0a 2020 2020  gEditor())..    
+000725a0: 2020 2020 2320 5361 6e69 7479 2063 6865      # Sanity che
+000725b0: 636b 2c20 5549 2063 6f6e 7472 6f6c 7320  ck, UI controls 
+000725c0: 6361 6e20 7374 696c 6c20 6265 2072 6566  can still be ref
+000725d0: 6572 7269 6e67 2074 6f20 6120 7072 6576  erring to a prev
+000725e0: 696f 7573 2074 6162 6c65 0d0a 2020 2020  ious table..    
+000725f0: 2020 2020 636f 6c20 3d20 6d69 6e28 636f      col = min(co
+00072600: 6c2c 206c 656e 2873 656c 662e 636f 6c75  l, len(self.colu
+00072610: 6d6e 7329 202d 2031 290d 0a0d 0a20 2020  mns) - 1)....   
+00072620: 2020 2020 2062 6c6f 6220 3d20 2262 6c6f       blob = "blo
+00072630: 6222 2069 6620 2873 656c 662e 636f 6c75  b" if (self.colu
+00072640: 6d6e 735b 636f 6c5d 5b22 7479 7065 225d  mns[col]["type"]
+00072650: 2e6c 6f77 6572 2829 203d 3d20 2262 6c6f  .lower() == "blo
+00072660: 6222 2920 656c 7365 2022 220d 0a20 2020  b") else ""..   
+00072670: 2020 2020 2061 7474 7220 3d20 7365 6c66       attr = self
+00072680: 2e61 7474 7273 5b22 6465 6661 756c 7425  .attrs["default%
+00072690: 7322 2025 2062 6c6f 625d 0d0a 2020 2020  s" % blob]..    
+000726a0: 2020 2020 6966 2072 6f77 203c 206c 656e      if row < len
+000726b0: 2873 656c 662e 726f 7773 5f63 7572 7265  (self.rows_curre
+000726c0: 6e74 293a 0d0a 2020 2020 2020 2020 2020  nt):..          
+000726d0: 2020 6966 2073 656c 662e 726f 7773 5f63    if self.rows_c
+000726e0: 7572 7265 6e74 5b72 6f77 5d5b 225f 5f63  urrent[row]["__c
+000726f0: 6861 6e67 6564 5f5f 225d 3a0d 0a20 2020  hanged__"]:..   
+00072700: 2020 2020 2020 2020 2020 2020 2069 6478               idx
+00072710: 203d 2073 656c 662e 726f 7773 5f63 7572   = self.rows_cur
+00072720: 7265 6e74 5b72 6f77 5d5b 225f 5f69 645f  rent[row]["__id_
+00072730: 5f22 5d0d 0a20 2020 2020 2020 2020 2020  _"]..           
+00072740: 2020 2020 2076 616c 7565 203d 2073 656c       value = sel
+00072750: 662e 726f 7773 5f63 7572 7265 6e74 5b72  f.rows_current[r
+00072760: 6f77 5d5b 7365 6c66 2e63 6f6c 756d 6e73  ow][self.columns
+00072770: 5b63 6f6c 5d5b 226e 616d 6522 5d5d 0d0a  [col]["name"]]..
+00072780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00072790: 6261 636b 7570 203d 2073 656c 662e 726f  backup = self.ro
+000727a0: 7773 5f62 6163 6b75 705b 6964 785d 5b73  ws_backup[idx][s
+000727b0: 656c 662e 636f 6c75 6d6e 735b 636f 6c5d  elf.columns[col]
+000727c0: 5b22 6e61 6d65 225d 5d0d 0a20 2020 2020  ["name"]]..     
+000727d0: 2020 2020 2020 2020 2020 2069 6620 6261             if ba
+000727e0: 636b 7570 2021 3d20 7661 6c75 653a 0d0a  ckup != value:..
+000727f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00072800: 2020 2020 6174 7472 203d 2073 656c 662e      attr = self.
+00072810: 6174 7472 735b 2263 656c 6c5f 6368 616e  attrs["cell_chan
+00072820: 6765 6425 7322 2025 2062 6c6f 625d 0d0a  ged%s" % blob]..
+00072830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00072840: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+00072850: 2020 2020 2020 2020 2020 2061 7474 7220             attr 
+00072860: 3d20 7365 6c66 2e61 7474 7273 5b22 726f  = self.attrs["ro
+00072870: 775f 6368 616e 6765 6425 7322 2025 2062  w_changed%s" % b
+00072880: 6c6f 625d 0d0a 2020 2020 2020 2020 2020  lob]..          
+00072890: 2020 656c 6966 2073 656c 662e 726f 7773    elif self.rows
+000728a0: 5f63 7572 7265 6e74 5b72 6f77 5d5b 225f  _current[row]["_
+000728b0: 5f6e 6577 5f5f 225d 3a0d 0a20 2020 2020  _new__"]:..     
+000728c0: 2020 2020 2020 2020 2020 2061 7474 7220             attr 
+000728d0: 3d20 7365 6c66 2e61 7474 7273 5b22 6e65  = self.attrs["ne
+000728e0: 7725 7322 2025 2062 6c6f 625d 0d0a 2020  w%s" % blob]..  
+000728f0: 2020 2020 2020 6174 7472 2e49 6e63 5265        attr.IncRe
+00072900: 6628 290d 0a20 2020 2020 2020 2072 6574  f()..        ret
+00072910: 7572 6e20 6174 7472 0d0a 0d0a 0d0a 2020  urn attr......  
+00072920: 2020 6465 6620 496e 7365 7274 526f 7773    def InsertRows
+00072930: 2873 656c 662c 2072 6f77 2c20 6e75 6d52  (self, row, numR
+00072940: 6f77 7329 3a0d 0a20 2020 2020 2020 2022  ows):..        "
+00072950: 2222 496e 7365 7274 7320 6e65 772c 2075  ""Inserts new, u
+00072960: 6e73 6176 6564 2072 6f77 7320 6174 2070  nsaved rows at p
+00072970: 6f73 6974 696f 6e20 3020 2872 6f77 2069  osition 0 (row i
+00072980: 7320 6967 6e6f 7265 6429 2e22 2222 0d0a  s ignored)."""..
+00072990: 2020 2020 2020 2020 726f 7773 5f62 6566          rows_bef
+000729a0: 6f72 6520 3d20 6c65 6e28 7365 6c66 2e72  ore = len(self.r
+000729b0: 6f77 735f 6375 7272 656e 7429 0d0a 2020  ows_current)..  
+000729c0: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
+000729d0: 616e 6765 286e 756d 526f 7773 293a 0d0a  ange(numRows):..
+000729e0: 2020 2020 2020 2020 2020 2020 2320 436f              # Co
+000729f0: 6e73 7472 7563 7420 656d 7074 7920 6469  nstruct empty di
+00072a00: 6374 2066 726f 6d20 636f 6c75 6d6e 206e  ct from column n
+00072a10: 616d 6573 0d0a 2020 2020 2020 2020 2020  ames..          
+00072a20: 2020 726f 7764 6174 6120 3d20 6469 6374    rowdata = dict
+00072a30: 2828 636f 6c5b 226e 616d 6522 5d2c 204e  ((col["name"], N
+00072a40: 6f6e 6529 2066 6f72 2063 6f6c 2069 6e20  one) for col in 
+00072a50: 7365 6c66 2e63 6f6c 756d 6e73 290d 0a20  self.columns).. 
+00072a60: 2020 2020 2020 2020 2020 2069 6478 203d             idx =
+00072a70: 2069 6428 726f 7764 6174 6129 0d0a 2020   id(rowdata)..  
+00072a80: 2020 2020 2020 2020 2020 726f 7764 6174            rowdat
+00072a90: 615b 225f 5f69 645f 5f22 5d20 3d20 6964  a["__id__"] = id
+00072aa0: 780d 0a20 2020 2020 2020 2020 2020 2072  x..            r
+00072ab0: 6f77 6461 7461 5b22 5f5f 6368 616e 6765  owdata["__change
+00072ac0: 645f 5f22 5d20 3d20 4661 6c73 650d 0a20  d__"] = False.. 
+00072ad0: 2020 2020 2020 2020 2020 2072 6f77 6461             rowda
+00072ae0: 7461 5b22 5f5f 6e65 775f 5f22 5d20 3d20  ta["__new__"] = 
+00072af0: 5472 7565 0d0a 2020 2020 2020 2020 2020  True..          
+00072b00: 2020 726f 7764 6174 615b 225f 5f64 656c    rowdata["__del
+00072b10: 6574 6564 5f5f 225d 203d 2046 616c 7365  eted__"] = False
+00072b20: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00072b30: 496e 7365 7274 2072 6f77 7320 6174 2074  Insert rows at t
+00072b40: 6865 2062 6567 696e 6e69 6e67 2c20 736f  he beginning, so
+00072b50: 2074 6861 7420 7468 6579 2063 616e 2062   that they can b
+00072b60: 6520 6564 6974 6564 0d0a 2020 2020 2020  e edited..      
+00072b70: 2020 2020 2020 2320 696d 6d65 6469 6174        # immediat
+00072b80: 656c 792c 206f 7468 6572 7769 7365 2077  ely, otherwise w
+00072b90: 6f75 6c64 206e 6565 6420 746f 2072 6574  ould need to ret
+00072ba0: 7269 6576 6520 616c 6c20 726f 7773 2066  rieve all rows f
+00072bb0: 6972 7374 2e0d 0a20 2020 2020 2020 2020  irst...         
+00072bc0: 2020 2073 656c 662e 6964 785f 616c 6c2e     self.idx_all.
+00072bd0: 696e 7365 7274 2830 2c20 6964 7829 0d0a  insert(0, idx)..
+00072be0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00072bf0: 2e72 6f77 735f 6375 7272 656e 742e 696e  .rows_current.in
+00072c00: 7365 7274 2830 2c20 726f 7764 6174 6129  sert(0, rowdata)
+00072c10: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00072c20: 6c66 2e72 6f77 735f 616c 6c5b 6964 785d  lf.rows_all[idx]
+00072c30: 203d 2072 6f77 6461 7461 0d0a 2020 2020   = rowdata..    
+00072c40: 2020 2020 2020 2020 7365 6c66 2e69 6478          self.idx
+00072c50: 5f6e 6577 2e61 7070 656e 6428 6964 7829  _new.append(idx)
+00072c60: 0d0a 2020 2020 2020 2020 7365 6c66 2e72  ..        self.r
+00072c70: 6f77 5f63 6f75 6e74 202b 3d20 6e75 6d52  ow_count += numR
+00072c80: 6f77 730d 0a20 2020 2020 2020 2073 656c  ows..        sel
+00072c90: 662e 4e6f 7469 6679 5669 6577 4368 616e  f.NotifyViewChan
+00072ca0: 6765 2872 6f77 735f 6265 666f 7265 290d  ge(rows_before).
+00072cb0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00072cc0: 5472 7565 0d0a 0d0a 0d0a 2020 2020 6465  True......    de
+00072cd0: 6620 4465 6c65 7465 526f 7773 2873 656c  f DeleteRows(sel
+00072ce0: 662c 2072 6f77 2c20 6e75 6d52 6f77 7329  f, row, numRows)
+00072cf0: 3a0d 0a20 2020 2020 2020 2022 2222 4465  :..        """De
+00072d00: 6c65 7465 7320 726f 7773 2066 726f 6d20  letes rows from 
+00072d10: 6120 7370 6563 6966 6965 6420 706f 7369  a specified posi
+00072d20: 7469 6f6e 2e22 2222 0d0a 2020 2020 2020  tion."""..      
+00072d30: 2020 6966 2072 6f77 202b 206e 756d 526f    if row + numRo
+00072d40: 7773 202d 2031 203c 2073 656c 662e 726f  ws - 1 < self.ro
+00072d50: 775f 636f 756e 743a 0d0a 2020 2020 2020  w_count:..      
+00072d60: 2020 2020 2020 7365 6c66 2e53 6565 6b54        self.SeekT
+00072d70: 6f52 6f77 2872 6f77 202b 206e 756d 526f  oRow(row + numRo
+00072d80: 7773 202d 2031 290d 0a20 2020 2020 2020  ws - 1)..       
+00072d90: 2020 2020 2072 6f77 735f 6265 666f 7265       rows_before
+00072da0: 203d 206c 656e 2873 656c 662e 726f 7773   = len(self.rows
+00072db0: 5f63 7572 7265 6e74 290d 0a20 2020 2020  _current)..     
+00072dc0: 2020 2020 2020 2066 6f72 2069 2069 6e20         for i in 
+00072dd0: 7261 6e67 6528 6e75 6d52 6f77 7329 3a0d  range(numRows):.
+00072de0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00072df0: 2064 6174 6120 3d20 7365 6c66 2e72 6f77   data = self.row
+00072e00: 735f 6375 7272 656e 745b 726f 775d 0d0a  s_current[row]..
+00072e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00072e20: 6964 7820 3d20 6461 7461 5b22 5f5f 6964  idx = data["__id
+00072e30: 5f5f 225d 0d0a 2020 2020 2020 2020 2020  __"]..          
+00072e40: 2020 2020 2020 6465 6c20 7365 6c66 2e72        del self.r
+00072e50: 6f77 735f 6375 7272 656e 745b 726f 775d  ows_current[row]
+00072e60: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00072e70: 2020 6966 2069 6478 2069 6e20 7365 6c66    if idx in self
+00072e80: 2e72 6f77 735f 6261 636b 7570 3a0d 0a20  .rows_backup:.. 
+00072e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00072ea0: 2020 2023 2049 6620 726f 7720 7761 7320     # If row was 
+00072eb0: 6368 616e 6765 642c 2073 7769 7463 6820  changed, switch 
+00072ec0: 746f 2069 7473 2062 6163 6b75 7020 6461  to its backup da
+00072ed0: 7461 0d0a 2020 2020 2020 2020 2020 2020  ta..            
+00072ee0: 2020 2020 2020 2020 6461 7461 203d 2073          data = s
+00072ef0: 656c 662e 726f 7773 5f62 6163 6b75 705b  elf.rows_backup[
+00072f00: 6964 785d 0d0a 2020 2020 2020 2020 2020  idx]..          
+00072f10: 2020 2020 2020 2020 2020 6465 6c20 7365            del se
+00072f20: 6c66 2e72 6f77 735f 6261 636b 7570 5b69  lf.rows_backup[i
+00072f30: 6478 5d0d 0a20 2020 2020 2020 2020 2020  dx]..           
+00072f40: 2020 2020 2020 2020 2073 656c 662e 6964           self.id
+00072f50: 785f 6368 616e 6765 642e 7265 6d6f 7665  x_changed.remove
+00072f60: 2869 6478 290d 0a20 2020 2020 2020 2020  (idx)..         
+00072f70: 2020 2020 2020 2069 6620 6e6f 7420 6461         if not da
+00072f80: 7461 5b22 5f5f 6e65 775f 5f22 5d3a 0d0a  ta["__new__"]:..
+00072f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00072fa0: 2020 2020 2320 4472 6f70 206e 6577 2072      # Drop new r
+00072fb0: 6f77 7320 6f6e 2064 656c 6574 652c 2072  ows on delete, r
+00072fc0: 6f6c 6c62 6163 6b20 6361 6e27 7420 7265  ollback can't re
+00072fd0: 7374 6f72 6520 7468 656d 2e0d 0a20 2020  store them...   
+00072fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00072ff0: 2064 6174 615b 225f 5f63 6861 6e67 6564   data["__changed
+00073000: 5f5f 225d 203d 2046 616c 7365 0d0a 2020  __"] = False..  
+00073010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00073020: 2020 6461 7461 5b22 5f5f 6465 6c65 7465    data["__delete
+00073030: 645f 5f22 5d20 3d20 5472 7565 0d0a 2020  d__"] = True..  
+00073040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00073050: 2020 7365 6c66 2e72 6f77 735f 6465 6c65    self.rows_dele
+00073060: 7465 645b 6964 785d 203d 2064 6174 610d  ted[idx] = data.
+00073070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00073080: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+00073090: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000730a0: 2e69 6478 5f6e 6577 2e72 656d 6f76 6528  .idx_new.remove(
+000730b0: 6964 7829 0d0a 2020 2020 2020 2020 2020  idx)..          
+000730c0: 2020 2020 2020 2020 2020 7365 6c66 2e69            self.i
+000730d0: 6478 5f61 6c6c 2e72 656d 6f76 6528 6964  dx_all.remove(id
+000730e0: 7829 0d0a 2020 2020 2020 2020 2020 2020  x)..            
+000730f0: 2020 2020 2020 2020 6465 6c20 7365 6c66          del self
+00073100: 2e72 6f77 735f 616c 6c5b 6964 785d 0d0a  .rows_all[idx]..
+00073110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00073120: 7365 6c66 2e72 6f77 5f63 6f75 6e74 202d  self.row_count -
+00073130: 3d20 6e75 6d52 6f77 730d 0a20 2020 2020  = numRows..     
+00073140: 2020 2020 2020 2073 656c 662e 4e6f 7469         self.Noti
+00073150: 6679 5669 6577 4368 616e 6765 2872 6f77  fyViewChange(row
+00073160: 735f 6265 666f 7265 290d 0a20 2020 2020  s_before)..     
+00073170: 2020 2072 6574 7572 6e20 5472 7565 0d0a     return True..
+00073180: 0d0a 0d0a 2020 2020 6465 6620 4e6f 7469  ....    def Noti
+00073190: 6679 5669 6577 4368 616e 6765 2873 656c  fyViewChange(sel
+000731a0: 662c 2072 6f77 735f 6265 666f 7265 293a  f, rows_before):
+000731b0: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
+000731c0: 2020 2020 2020 204e 6f74 6966 6965 7320         Notifies 
+000731d0: 7468 6520 6772 6964 2076 6965 7720 6f66  the grid view of
+000731e0: 2061 2063 6861 6e67 6520 696e 2074 6865   a change in the
+000731f0: 2075 6e64 6572 6c79 696e 6720 6772 6964   underlying grid
+00073200: 2074 6162 6c65 2069 660d 0a20 2020 2020   table if..     
+00073210: 2020 2063 7572 7265 6e74 2072 6f77 2063     current row c
+00073220: 6f75 6e74 2069 7320 6469 6666 6572 656e  ount is differen
+00073230: 742e 0d0a 2020 2020 2020 2020 2222 220d  t...        """.
+00073240: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00073250: 2e56 6965 773a 0d0a 2020 2020 2020 2020  .View:..        
+00073260: 2020 2020 6172 6773 203d 204e 6f6e 650d      args = None.
+00073270: 0a20 2020 2020 2020 2020 2020 2072 6f77  .            row
+00073280: 735f 6e6f 7720 3d20 6c65 6e28 7365 6c66  s_now = len(self
+00073290: 2e72 6f77 735f 6375 7272 656e 7429 0d0a  .rows_current)..
+000732a0: 2020 2020 2020 2020 2020 2020 6966 2072              if r
+000732b0: 6f77 735f 6e6f 7720 3c20 726f 7773 5f62  ows_now < rows_b
+000732c0: 6566 6f72 653a 0d0a 2020 2020 2020 2020  efore:..        
+000732d0: 2020 2020 2020 2020 6172 6773 203d 205b          args = [
+000732e0: 7365 6c66 2c20 7778 2e67 7269 642e 4752  self, wx.grid.GR
+000732f0: 4944 5441 424c 455f 4e4f 5449 4659 5f52  IDTABLE_NOTIFY_R
+00073300: 4f57 535f 4445 4c45 5445 442c 0d0a 2020  OWS_DELETED,..  
+00073310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00073320: 2020 2020 2020 726f 7773 5f6e 6f77 2c20        rows_now, 
+00073330: 726f 7773 5f62 6566 6f72 6520 2d20 726f  rows_before - ro
+00073340: 7773 5f6e 6f77 5d0d 0a20 2020 2020 2020  ws_now]..       
+00073350: 2020 2020 2065 6c69 6620 726f 7773 5f6e       elif rows_n
+00073360: 6f77 203e 2072 6f77 735f 6265 666f 7265  ow > rows_before
+00073370: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00073380: 2020 2061 7267 7320 3d20 5b73 656c 662c     args = [self,
+00073390: 2077 782e 6772 6964 2e47 5249 4454 4142   wx.grid.GRIDTAB
+000733a0: 4c45 5f4e 4f54 4946 595f 524f 5753 5f41  LE_NOTIFY_ROWS_A
+000733b0: 5050 454e 4445 442c 0d0a 2020 2020 2020  PPENDED,..      
+000733c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000733d0: 2020 726f 7773 5f6e 6f77 202d 2072 6f77    rows_now - row
+000733e0: 735f 6265 666f 7265 5d0d 0a20 2020 2020  s_before]..     
+000733f0: 2020 2020 2020 2069 6620 6172 6773 3a0d         if args:.
+00073400: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00073410: 2073 656c 662e 5669 6577 2e50 726f 6365   self.View.Proce
+00073420: 7373 5461 626c 654d 6573 7361 6765 2877  ssTableMessage(w
+00073430: 782e 6772 6964 2e47 7269 6454 6162 6c65  x.grid.GridTable
+00073440: 4d65 7373 6167 6528 2a61 7267 7329 290d  Message(*args)).
+00073450: 0a0d 0a0d 0a0d 0a20 2020 2064 6566 2041  .......    def A
+00073460: 6464 4669 6c74 6572 2873 656c 662c 2063  ddFilter(self, c
+00073470: 6f6c 2c20 7661 6c29 3a0d 0a20 2020 2020  ol, val):..     
+00073480: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
+00073490: 4164 6473 2061 2066 696c 7465 7220 746f  Adds a filter to
+000734a0: 2074 6865 2067 7269 6420 6461 7461 206f   the grid data o
+000734b0: 6e20 7468 6520 7370 6563 6966 6965 6420  n the specified 
+000734c0: 636f 6c75 6d6e 2e20 4967 6e6f 7265 7320  column. Ignores 
+000734d0: 7468 650d 0a20 2020 2020 2020 2076 616c  the..        val
+000734e0: 7565 2069 6620 696e 7661 6c69 6420 666f  ue if invalid fo
+000734f0: 7220 7468 6520 636f 6c75 6d6e 2028 652e  r the column (e.
+00073500: 672e 2061 2073 7472 696e 6720 666f 7220  g. a string for 
+00073510: 616e 2069 6e74 6567 6572 2063 6f6c 756d  an integer colum
+00073520: 6e29 2e0d 0a0d 0a20 2020 2020 2020 2040  n).....        @
+00073530: 7061 7261 6d20 2020 636f 6c20 2020 636f  param   col   co
+00073540: 6c75 6d6e 2069 6e64 6578 0d0a 2020 2020  lumn index..    
+00073550: 2020 2020 4070 6172 616d 2020 2076 616c      @param   val
+00073560: 2020 2061 2073 696d 706c 6520 7661 6c75     a simple valu
+00073570: 6520 666f 7220 6669 6c74 6572 696e 672e  e for filtering.
+00073580: 2046 6f72 206e 756d 6572 6963 2063 6f6c   For numeric col
+00073590: 756d 6e73 2c20 7468 650d 0a20 2020 2020  umns, the..     
+000735a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000735b0: 2020 7661 6c75 6520 6973 206d 6174 6368    value is match
+000735c0: 6564 2065 7861 6374 6c79 2c20 616e 6420  ed exactly, and 
+000735d0: 666f 7220 7465 7874 2063 6f6c 756d 6e73  for text columns
+000735e0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+000735f0: 2020 2020 2020 2020 2020 6d61 7463 6865            matche
+00073600: 6420 6279 2073 7562 7374 7269 6e67 2e0d  d by substring..
+00073610: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
+00073620: 2020 2020 2020 6163 6365 7074 6564 5f76        accepted_v
+00073630: 616c 7565 203d 204e 6f6e 650d 0a20 2020  alue = None..   
+00073640: 2020 2020 2069 6620 2249 4e54 4547 4552       if "INTEGER
+00073650: 2220 3d3d 2073 656c 662e 636f 6c75 6d6e  " == self.column
+00073660: 735b 636f 6c5d 5b22 7479 7065 225d 3a0d  s[col]["type"]:.
+00073670: 0a20 2020 2020 2020 2020 2020 2074 7279  .            try
+00073680: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00073690: 2020 2023 2041 6c6c 6f77 2075 7365 7220     # Allow user 
+000736a0: 746f 2065 6e74 6572 2061 2063 6f6d 6d61  to enter a comma
+000736b0: 2066 6f72 2064 6563 696d 616c 2073 6570   for decimal sep
+000736c0: 6172 6174 6f72 2e0d 0a20 2020 2020 2020  arator...       
+000736d0: 2020 2020 2020 2020 2061 6363 6570 7465           accepte
+000736e0: 645f 7661 6c75 6520 3d20 666c 6f61 7428  d_value = float(
+000736f0: 7661 6c2e 7265 706c 6163 6528 222c 222c  val.replace(",",
+00073700: 2022 2e22 2929 205c 0d0a 2020 2020 2020   ".")) \..      
+00073710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00073720: 2020 2020 2020 2020 2020 2069 6620 2822             if ("
+00073730: 2e22 2069 6e20 7661 6c20 6f72 2022 2c22  ." in val or ","
+00073740: 2069 6e20 7661 6c29 205c 0d0a 2020 2020   in val) \..    
+00073750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00073760: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+00073770: 6520 696e 7428 7661 6c29 0d0a 2020 2020  e int(val)..    
+00073780: 2020 2020 2020 2020 6578 6365 7074 2056          except V
+00073790: 616c 7565 4572 726f 723a 0d0a 2020 2020  alueError:..    
+000737a0: 2020 2020 2020 2020 2020 2020 7061 7373              pass
+000737b0: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
+000737c0: 0a20 2020 2020 2020 2020 2020 2061 6363  .            acc
+000737d0: 6570 7465 645f 7661 6c75 6520 3d20 7661  epted_value = va
+000737e0: 6c0d 0a20 2020 2020 2020 2069 6620 6163  l..        if ac
+000737f0: 6365 7074 6564 5f76 616c 7565 2069 7320  cepted_value is 
+00073800: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
+00073810: 2020 2020 2020 2073 656c 662e 6669 6c74         self.filt
+00073820: 6572 735b 636f 6c5d 203d 2061 6363 6570  ers[col] = accep
+00073830: 7465 645f 7661 6c75 650d 0a20 2020 2020  ted_value..     
+00073840: 2020 2020 2020 2073 656c 662e 4669 6c74         self.Filt
+00073850: 6572 2829 0d0a 0d0a 0d0a 2020 2020 6465  er()......    de
+00073860: 6620 5265 6d6f 7665 4669 6c74 6572 2873  f RemoveFilter(s
+00073870: 656c 662c 2063 6f6c 293a 0d0a 2020 2020  elf, col):..    
+00073880: 2020 2020 2222 2252 656d 6f76 6573 2066      """Removes f
+00073890: 696c 7465 7220 6f6e 2074 6865 2073 7065  ilter on the spe
+000738a0: 6369 6669 6564 2063 6f6c 756d 6e2c 2069  cified column, i
+000738b0: 6620 616e 792e 2222 220d 0a20 2020 2020  f any."""..     
+000738c0: 2020 2069 6620 636f 6c20 696e 2073 656c     if col in sel
+000738d0: 662e 6669 6c74 6572 733a 0d0a 2020 2020  f.filters:..    
+000738e0: 2020 2020 2020 2020 6465 6c20 7365 6c66          del self
+000738f0: 2e66 696c 7465 7273 5b63 6f6c 5d0d 0a20  .filters[col].. 
+00073900: 2020 2020 2020 2073 656c 662e 4669 6c74         self.Filt
+00073910: 6572 2829 0d0a 0d0a 0d0a 2020 2020 6465  er()......    de
+00073920: 6620 436c 6561 7246 696c 7465 7228 7365  f ClearFilter(se
+00073930: 6c66 2c20 7265 6672 6573 683d 5472 7565  lf, refresh=True
+00073940: 293a 0d0a 2020 2020 2020 2020 2222 2243  ):..        """C
+00073950: 6c65 6172 7320 616c 6c20 6164 6465 6420  lears all added 
+00073960: 6669 6c74 6572 732e 2222 220d 0a20 2020  filters."""..   
+00073970: 2020 2020 2073 656c 662e 6669 6c74 6572       self.filter
+00073980: 732e 636c 6561 7228 290d 0a20 2020 2020  s.clear()..     
+00073990: 2020 2069 6620 7265 6672 6573 683a 0d0a     if refresh:..
+000739a0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000739b0: 2e46 696c 7465 7228 290d 0a0d 0a0d 0a20  .Filter()...... 
+000739c0: 2020 2064 6566 2043 6c65 6172 536f 7274     def ClearSort
+000739d0: 2873 656c 662c 2072 6566 7265 7368 3d54  (self, refresh=T
+000739e0: 7275 6529 3a0d 0a20 2020 2020 2020 2022  rue):..        "
+000739f0: 2222 436c 6561 7273 2063 7572 7265 6e74  ""Clears current
+00073a00: 2073 6f72 742e 2222 220d 0a20 2020 2020   sort."""..     
+00073a10: 2020 2073 656c 662e 736f 7274 5f63 6f6c     self.sort_col
+00073a20: 756d 6e20 3d20 4e6f 6e65 0d0a 2020 2020  umn = None..    
+00073a30: 2020 2020 6966 2072 6566 7265 7368 3a0d      if refresh:.
+00073a40: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00073a50: 662e 726f 7773 5f63 7572 7265 6e74 5b3a  f.rows_current[:
+00073a60: 5d2e 736f 7274 280d 0a20 2020 2020 2020  ].sort(..       
+00073a70: 2020 2020 2020 2020 206b 6579 3d6c 616d           key=lam
+00073a80: 6264 6120 783a 2073 656c 662e 6964 785f  bda x: self.idx_
+00073a90: 616c 6c2e 696e 6465 7828 785b 225f 5f69  all.index(x["__i
+00073aa0: 645f 5f22 5d29 0d0a 2020 2020 2020 2020  d__"])..        
+00073ab0: 2020 2020 290d 0a20 2020 2020 2020 2020      )..         
+00073ac0: 2020 2069 6620 7365 6c66 2e56 6965 773a     if self.View:
+00073ad0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00073ae0: 2020 7365 6c66 2e56 6965 772e 466f 7263    self.View.Forc
+00073af0: 6552 6566 7265 7368 2829 0d0a 0d0a 0d0a  eRefresh()......
+00073b00: 2020 2020 6465 6620 436c 6561 7241 7474      def ClearAtt
+00073b10: 7273 2873 656c 6629 3a0d 0a20 2020 2020  rs(self):..     
+00073b20: 2020 2022 2222 436c 6561 7273 2061 6c6c     """Clears all
+00073b30: 2063 7572 7265 6e74 2072 6f77 2061 7474   current row att
+00073b40: 7269 6275 7465 7320 616e 6420 7265 6672  ributes and refr
+00073b50: 6573 6865 7320 6772 6964 2e22 2222 0d0a  eshes grid."""..
+00073b60: 2020 2020 2020 2020 7365 6c66 2e61 7474          self.att
+00073b70: 7273 2e63 6c65 6172 2829 0d0a 2020 2020  rs.clear()..    
+00073b80: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
+00073b90: 5669 6577 3a20 7265 7475 726e 0d0a 2020  View: return..  
+00073ba0: 2020 2020 2020 666f 7220 726f 7720 696e        for row in
+00073bb0: 2072 616e 6765 286c 656e 2873 656c 662e   range(len(self.
+00073bc0: 726f 7773 5f63 7572 7265 6e74 2929 3a0d  rows_current)):.
+00073bd0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+00073be0: 2063 6f6c 2069 6e20 7261 6e67 6528 6c65   col in range(le
+00073bf0: 6e28 7365 6c66 2e63 6f6c 756d 6e73 2929  n(self.columns))
+00073c00: 3a20 7365 6c66 2e56 6965 772e 5265 6672  : self.View.Refr
+00073c10: 6573 6841 7474 7228 726f 772c 2063 6f6c  eshAttr(row, col
+00073c20: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00073c30: 5669 6577 2e52 6566 7265 7368 2829 0d0a  View.Refresh()..
+00073c40: 0d0a 0d0a 2020 2020 6465 6620 4669 6c74  ....    def Filt
+00073c50: 6572 2873 656c 6629 3a0d 0a20 2020 2020  er(self):..     
+00073c60: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
+00073c70: 4669 6c74 6572 7320 7468 6520 6772 6964  Filters the grid
+00073c80: 2074 6162 6c65 2077 6974 6820 7468 6520   table with the 
+00073c90: 6375 7272 656e 746c 7920 6164 6465 6420  currently added 
+00073ca0: 6669 6c74 6572 732e 0d0a 2020 2020 2020  filters...      
+00073cb0: 2020 2222 220d 0a20 2020 2020 2020 2073    """..        s
+00073cc0: 656c 662e 5365 656b 546f 526f 7728 7365  elf.SeekToRow(se
+00073cd0: 6c66 2e72 6f77 5f63 6f75 6e74 202d 2031  lf.row_count - 1
+00073ce0: 290d 0a20 2020 2020 2020 2072 6f77 735f  )..        rows_
+00073cf0: 6265 666f 7265 203d 206c 656e 2873 656c  before = len(sel
+00073d00: 662e 726f 7773 5f63 7572 7265 6e74 290d  f.rows_current).
+00073d10: 0a20 2020 2020 2020 2064 656c 2073 656c  .        del sel
+00073d20: 662e 726f 7773 5f63 7572 7265 6e74 5b3a  f.rows_current[:
+00073d30: 5d0d 0a20 2020 2020 2020 2066 6f72 2069  ]..        for i
+00073d40: 6478 2069 6e20 7365 6c66 2e69 6478 5f61  dx in self.idx_a
+00073d50: 6c6c 3a0d 0a20 2020 2020 2020 2020 2020  ll:..           
+00073d60: 2072 6f77 203d 2073 656c 662e 726f 7773   row = self.rows
+00073d70: 5f61 6c6c 5b69 6478 5d0d 0a20 2020 2020  _all[idx]..     
+00073d80: 2020 2020 2020 2069 6620 6e6f 7420 726f         if not ro
+00073d90: 775b 225f 5f64 656c 6574 6564 5f5f 225d  w["__deleted__"]
+00073da0: 2061 6e64 2073 656c 662e 5f69 735f 726f   and self._is_ro
+00073db0: 775f 756e 6669 6c74 6572 6564 2872 6f77  w_unfiltered(row
+00073dc0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00073dd0: 2020 2020 7365 6c66 2e72 6f77 735f 6375      self.rows_cu
+00073de0: 7272 656e 742e 6170 7065 6e64 2872 6f77  rrent.append(row
+00073df0: 290d 0a20 2020 2020 2020 2069 6620 7365  )..        if se
+00073e00: 6c66 2e73 6f72 745f 636f 6c75 6d6e 2069  lf.sort_column i
+00073e10: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
+00073e20: 2020 2020 2020 2020 2073 656c 662e 736f           self.so
+00073e30: 7274 5f61 7363 656e 6469 6e67 203d 206e  rt_ascending = n
+00073e40: 6f74 2073 656c 662e 736f 7274 5f61 7363  ot self.sort_asc
+00073e50: 656e 6469 6e67 0d0a 2020 2020 2020 2020  ending..        
+00073e60: 2020 2020 7365 6c66 2e53 6f72 7443 6f6c      self.SortCol
+00073e70: 756d 6e28 7365 6c66 2e73 6f72 745f 636f  umn(self.sort_co
+00073e80: 6c75 6d6e 290d 0a20 2020 2020 2020 2073  lumn)..        s
+00073e90: 656c 662e 4e6f 7469 6679 5669 6577 4368  elf.NotifyViewCh
+00073ea0: 616e 6765 2872 6f77 735f 6265 666f 7265  ange(rows_before
+00073eb0: 290d 0a0d 0a0d 0a20 2020 2064 6566 2053  )......    def S
+00073ec0: 6f72 7443 6f6c 756d 6e28 7365 6c66 2c20  ortColumn(self, 
+00073ed0: 636f 6c29 3a0d 0a20 2020 2020 2020 2022  col):..        "
+00073ee0: 2222 0d0a 2020 2020 2020 2020 536f 7274  ""..        Sort
+00073ef0: 7320 7468 6520 6772 6964 2064 6174 6120  s the grid data 
+00073f00: 6279 2074 6865 2073 7065 6369 6669 6564  by the specified
+00073f10: 2063 6f6c 756d 6e2c 2072 6576 6572 7369   column, reversi
+00073f20: 6e67 2074 6865 2070 7265 7669 6f75 730d  ng the previous.
+00073f30: 0a20 2020 2020 2020 2073 6f72 7420 6f72  .        sort or
+00073f40: 6465 722c 2069 6620 616e 792e 0d0a 2020  der, if any...  
+00073f50: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
+00073f60: 2020 2073 656c 662e 5365 656b 546f 526f     self.SeekToRo
+00073f70: 7728 7365 6c66 2e72 6f77 5f63 6f75 6e74  w(self.row_count
+00073f80: 202d 2031 290d 0a20 2020 2020 2020 2073   - 1)..        s
+00073f90: 656c 662e 736f 7274 5f61 7363 656e 6469  elf.sort_ascendi
+00073fa0: 6e67 203d 206e 6f74 2073 656c 662e 736f  ng = not self.so
+00073fb0: 7274 5f61 7363 656e 6469 6e67 0d0a 2020  rt_ascending..  
+00073fc0: 2020 2020 2020 7365 6c66 2e73 6f72 745f        self.sort_
+00073fd0: 636f 6c75 6d6e 203d 2063 6f6c 0d0a 2020  column = col..  
+00073fe0: 2020 2020 2020 6966 2030 203c 3d20 636f        if 0 <= co
+00073ff0: 6c20 3c20 6c65 6e28 7365 6c66 2e63 6f6c  l < len(self.col
+00074000: 756d 6e73 293a 0d0a 2020 2020 2020 2020  umns):..        
+00074010: 2020 2020 6e61 6d65 203d 2073 656c 662e      name = self.
+00074020: 636f 6c75 6d6e 735b 636f 6c5d 5b22 6e61  columns[col]["na
+00074030: 6d65 225d 0d0a 2020 2020 2020 2020 2020  me"]..          
+00074040: 2020 7479 7065 7320 3d20 7365 7428 7479    types = set(ty
+00074050: 7065 2878 5b6e 616d 655d 2920 666f 7220  pe(x[name]) for 
+00074060: 7820 696e 2073 656c 662e 726f 7773 5f63  x in self.rows_c
+00074070: 7572 7265 6e74 290d 0a20 2020 2020 2020  urrent)..       
+00074080: 2020 2020 2069 6620 7479 7065 7320 2d20       if types - 
+00074090: 7365 7428 7369 782e 696e 7465 6765 725f  set(six.integer_
+000740a0: 7479 7065 7320 2b20 2862 6f6f 6c2c 2074  types + (bool, t
+000740b0: 7970 6528 4e6f 6e65 2929 293a 2020 2320  ype(None))):  # 
+000740c0: 4e6f 7420 6f6e 6c79 206e 756d 6572 6963  Not only numeric
+000740d0: 2074 7970 6573 0d0a 2020 2020 2020 2020   types..        
+000740e0: 2020 2020 2020 2020 6b65 7920 3d20 6c61          key = la
+000740f0: 6d62 6461 2078 3a20 785b 6e61 6d65 5d2e  mbda x: x[name].
+00074100: 6c6f 7765 7228 2920 6966 2069 7369 6e73  lower() if isins
+00074110: 7461 6e63 6528 785b 6e61 6d65 5d2c 2073  tance(x[name], s
+00074120: 6978 2e73 7472 696e 675f 7479 7065 7329  ix.string_types)
+00074130: 2065 6c73 6520 5c0d 0a20 2020 2020 2020   else \..       
+00074140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00074150: 2020 2020 2020 2020 2022 2220 6966 2078           "" if x
+00074160: 5b6e 616d 655d 2069 7320 4e6f 6e65 2065  [name] is None e
+00074170: 6c73 6520 7369 782e 7465 7874 5f74 7970  lse six.text_typ
+00074180: 6528 785b 6e61 6d65 5d29 0d0a 2020 2020  e(x[name])..    
+00074190: 2020 2020 2020 2020 656c 7365 3a20 2023          else:  #
+000741a0: 204f 6e6c 7920 6e75 6d65 7269 6320 7479   Only numeric ty
+000741b0: 7065 730d 0a20 2020 2020 2020 2020 2020  pes..           
+000741c0: 2020 2020 206b 6579 203d 206c 616d 6264       key = lambd
+000741d0: 6120 783a 202d 7379 732e 6d61 7873 697a  a x: -sys.maxsiz
+000741e0: 6520 6966 2078 5b6e 616d 655d 2069 7320  e if x[name] is 
+000741f0: 4e6f 6e65 2065 6c73 6520 785b 6e61 6d65  None else x[name
+00074200: 5d0d 0a20 2020 2020 2020 2020 2020 2073  ]..            s
+00074210: 656c 662e 726f 7773 5f63 7572 7265 6e74  elf.rows_current
+00074220: 2e73 6f72 7428 6b65 793d 6b65 792c 2072  .sort(key=key, r
+00074230: 6576 6572 7365 3d73 656c 662e 736f 7274  everse=self.sort
+00074240: 5f61 7363 656e 6469 6e67 290d 0a20 2020  _ascending)..   
+00074250: 2020 2020 2069 6620 7365 6c66 2e56 6965       if self.Vie
+00074260: 773a 0d0a 2020 2020 2020 2020 2020 2020  w:..            
+00074270: 7365 6c66 2e56 6965 772e 466f 7263 6552  self.View.ForceR
+00074280: 6566 7265 7368 2829 0d0a 0d0a 0d0a 2020  efresh()......  
+00074290: 2020 6465 6620 436c 6f73 6528 7365 6c66    def Close(self
+000742a0: 293a 0d0a 2020 2020 2020 2020 2222 2243  ):..        """C
+000742b0: 6c6f 7365 7320 7468 6520 756e 6465 726c  loses the underl
+000742c0: 7969 6e67 2071 7565 7279 2063 7572 736f  ying query curso
+000742d0: 722c 2069 6620 616e 792e 2222 220d 0a20  r, if any.""".. 
+000742e0: 2020 2020 2020 2074 7279 3a20 7365 6c66         try: self
+000742f0: 2e72 6f77 5f69 7465 7261 746f 722e 636c  .row_iterator.cl
+00074300: 6f73 6528 290d 0a20 2020 2020 2020 2065  ose()..        e
+00074310: 7863 6570 7420 4578 6365 7074 696f 6e3a  xcept Exception:
+00074320: 2070 6173 730d 0a20 2020 2020 2020 2073   pass..        s
+00074330: 656c 662e 726f 775f 6974 6572 6174 6f72  elf.row_iterator
+00074340: 203d 204e 6f6e 650d 0a0d 0a0d 0a20 2020   = None......   
+00074350: 2064 6566 2053 6176 6543 6861 6e67 6573   def SaveChanges
+00074360: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
+00074370: 2022 2222 0d0a 2020 2020 2020 2020 5361   """..        Sa
+00074380: 7665 7320 7468 6520 726f 7773 2074 6861  ves the rows tha
+00074390: 7420 6861 7665 2062 6565 6e20 6368 616e  t have been chan
+000743a0: 6765 6420 696e 2074 6869 7320 7461 626c  ged in this tabl
+000743b0: 652e 2044 726f 7073 2075 6e64 6f2d 6361  e. Drops undo-ca
+000743c0: 6368 652e 0d0a 2020 2020 2020 2020 2222  che...        ""
+000743d0: 220d 0a20 2020 2020 2020 2074 7279 3a0d  "..        try:.
+000743e0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+000743f0: 2069 6478 2069 6e20 7365 6c66 2e69 6478   idx in self.idx
+00074400: 5f63 6861 6e67 6564 2e63 6f70 7928 293a  _changed.copy():
+00074410: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00074420: 2020 726f 7720 3d20 7365 6c66 2e72 6f77    row = self.row
+00074430: 735f 616c 6c5b 6964 785d 0d0a 2020 2020  s_all[idx]..    
+00074440: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00074450: 2e64 622e 7570 6461 7465 5f72 6f77 2873  .db.update_row(s
+00074460: 656c 662e 7461 626c 652c 2072 6f77 2c20  elf.table, row, 
+00074470: 7365 6c66 2e72 6f77 735f 6261 636b 7570  self.rows_backup
+00074480: 5b69 6478 5d2c 0d0a 2020 2020 2020 2020  [idx],..        
+00074490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000744a0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000744b0: 726f 7769 6473 2e67 6574 2869 6478 2929  rowids.get(idx))
+000744c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000744d0: 2020 726f 775b 225f 5f63 6861 6e67 6564    row["__changed
+000744e0: 5f5f 225d 203d 2046 616c 7365 0d0a 2020  __"] = False..  
+000744f0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00074500: 6c66 2e69 6478 5f63 6861 6e67 6564 2e72  lf.idx_changed.r
+00074510: 656d 6f76 6528 6964 7829 0d0a 2020 2020  emove(idx)..    
+00074520: 2020 2020 2020 2020 2020 2020 6465 6c20              del 
+00074530: 7365 6c66 2e72 6f77 735f 6261 636b 7570  self.rows_backup
+00074540: 5b69 6478 5d0d 0a20 2020 2020 2020 2020  [idx]..         
+00074550: 2020 2023 2053 6176 6520 616c 6c20 6e65     # Save all ne
+00074560: 776c 7920 696e 7365 7274 6564 2072 6f77  wly inserted row
+00074570: 730d 0a20 2020 2020 2020 2020 2020 2070  s..            p
+00074580: 6b73 203d 205b 635b 226e 616d 6522 5d20  ks = [c["name"] 
+00074590: 666f 7220 6320 696e 2073 656c 662e 636f  for c in self.co
+000745a0: 6c75 6d6e 7320 6966 2063 5b22 706b 225d  lumns if c["pk"]
+000745b0: 5d0d 0a20 2020 2020 2020 2020 2020 2063  ]..            c
+000745c0: 6f6c 5f6d 6170 203d 2064 6963 7428 2863  ol_map = dict((c
+000745d0: 5b22 6e61 6d65 225d 2c20 6329 2066 6f72  ["name"], c) for
+000745e0: 2063 2069 6e20 7365 6c66 2e63 6f6c 756d   c in self.colum
+000745f0: 6e73 290d 0a20 2020 2020 2020 2020 2020  ns)..           
+00074600: 2066 6f72 2069 6478 2069 6e20 7365 6c66   for idx in self
+00074610: 2e69 6478 5f6e 6577 5b3a 5d3a 0d0a 2020  .idx_new[:]:..  
+00074620: 2020 2020 2020 2020 2020 2020 2020 726f                ro
+00074630: 7720 3d20 7365 6c66 2e72 6f77 735f 616c  w = self.rows_al
+00074640: 6c5b 6964 785d 0d0a 2020 2020 2020 2020  l[idx]..        
+00074650: 2020 2020 2020 2020 696e 7365 7274 5f69          insert_i
+00074660: 6420 3d20 7365 6c66 2e64 622e 696e 7365  d = self.db.inse
+00074670: 7274 5f72 6f77 2873 656c 662e 7461 626c  rt_row(self.tabl
+00074680: 652c 2072 6f77 290d 0a20 2020 2020 2020  e, row)..       
+00074690: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
+000746a0: 706b 7329 203d 3d20 3120 616e 6420 726f  pks) == 1 and ro
+000746b0: 775b 706b 735b 305d 5d20 696e 2028 4e6f  w[pks[0]] in (No
+000746c0: 6e65 2c20 2222 293a 0d0a 2020 2020 2020  ne, ""):..      
+000746d0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000746e0: 2022 494e 5445 4745 5222 203d 3d20 636f   "INTEGER" == co
+000746f0: 6c5f 6d61 705b 706b 735b 305d 5d5b 2274  l_map[pks[0]]["t
+00074700: 7970 6522 5d3a 0d0a 2020 2020 2020 2020  ype"]:..        
+00074710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00074720: 2320 4175 746f 696e 6372 656d 656e 7465  # Autoincremente
+00074730: 6420 726f 773a 2075 7064 6174 6520 7769  d row: update wi
+00074740: 7468 206e 6577 2076 616c 7565 0d0a 2020  th new value..  
+00074750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00074760: 2020 2020 2020 726f 775b 706b 735b 305d        row[pks[0]
+00074770: 5d20 3d20 696e 7365 7274 5f69 640d 0a20  ] = insert_id.. 
+00074780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00074790: 2020 2065 6c73 653a 2023 2046 6f72 206e     else: # For n
+000747a0: 6f6e 2d69 6e74 6567 6572 732c 2069 6e73  on-integers, ins
+000747b0: 6572 7420 7265 7475 726e 7320 524f 5749  ert returns ROWI
+000747c0: 440d 0a20 2020 2020 2020 2020 2020 2020  D..             
+000747d0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000747e0: 726f 7769 6473 5b69 6478 5d20 3d20 696e  rowids[idx] = in
+000747f0: 7365 7274 5f69 640d 0a20 2020 2020 2020  sert_id..       
+00074800: 2020 2020 2020 2020 2072 6f77 5b22 5f5f           row["__
+00074810: 6e65 775f 5f22 5d20 3d20 4661 6c73 650d  new__"] = False.
+00074820: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00074830: 2073 656c 662e 6964 785f 6e65 772e 7265   self.idx_new.re
+00074840: 6d6f 7665 2869 6478 290d 0a20 2020 2020  move(idx)..     
+00074850: 2020 2020 2020 2023 2044 656c 6574 6564         # Deleted
+00074860: 2061 6c6c 206e 6577 6c79 2064 656c 6574   all newly delet
+00074870: 6564 2072 6f77 730d 0a20 2020 2020 2020  ed rows..       
+00074880: 2020 2020 2066 6f72 2069 6478 2c20 726f       for idx, ro
+00074890: 7720 696e 2073 656c 662e 726f 7773 5f64  w in self.rows_d
+000748a0: 656c 6574 6564 2e63 6f70 7928 292e 6974  eleted.copy().it
+000748b0: 656d 7328 293a 0d0a 2020 2020 2020 2020  ems():..        
+000748c0: 2020 2020 2020 2020 7365 6c66 2e64 622e          self.db.
+000748d0: 6465 6c65 7465 5f72 6f77 2873 656c 662e  delete_row(self.
+000748e0: 7461 626c 652c 2072 6f77 2c20 7365 6c66  table, row, self
+000748f0: 2e72 6f77 6964 732e 6765 7428 6964 7829  .rowids.get(idx)
+00074900: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00074910: 2020 2064 656c 2073 656c 662e 726f 7773     del self.rows
+00074920: 5f64 656c 6574 6564 5b69 6478 5d0d 0a20  _deleted[idx].. 
+00074930: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00074940: 656c 2073 656c 662e 726f 7773 5f61 6c6c  el self.rows_all
+00074950: 5b69 6478 5d0d 0a20 2020 2020 2020 2020  [idx]..         
+00074960: 2020 2020 2020 2073 656c 662e 6964 785f         self.idx_
+00074970: 616c 6c2e 7265 6d6f 7665 2869 6478 290d  all.remove(idx).
+00074980: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+00074990: 4578 6365 7074 696f 6e20 6173 2065 3a0d  Exception as e:.
+000749a0: 0a20 2020 2020 2020 2020 2020 2067 7569  .            gui
+000749b0: 6261 7365 2e73 7461 7475 7328 2245 7272  base.status("Err
+000749c0: 6f72 2073 6176 696e 6720 6368 616e 6765  or saving change
+000749d0: 7320 696e 2025 732e 222c 2073 656c 662e  s in %s.", self.
+000749e0: 7461 626c 6529 0d0a 2020 2020 2020 2020  table)..        
+000749f0: 2020 2020 6c6f 6767 6572 2e65 7863 6570      logger.excep
+00074a00: 7469 6f6e 2822 4572 726f 7220 7361 7669  tion("Error savi
+00074a10: 6e67 2063 6861 6e67 6573 2069 6e20 2573  ng changes in %s
+00074a20: 2e22 2c20 7365 6c66 2e74 6162 6c65 290d  .", self.table).
+00074a30: 0a20 2020 2020 2020 2020 2020 2077 782e  .            wx.
+00074a40: 4d65 7373 6167 6542 6f78 2875 7469 6c2e  MessageBox(util.
+00074a50: 666f 726d 6174 5f65 7863 2865 292c 2063  format_exc(e), c
+00074a60: 6f6e 662e 5469 746c 652c 0d0a 2020 2020  onf.Title,..    
+00074a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00074a80: 2020 2020 2020 7778 2e4f 4b20 7c20 7778        wx.OK | wx
+00074a90: 2e49 434f 4e5f 5741 524e 494e 4729 0d0a  .ICON_WARNING)..
+00074aa0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00074ab0: 5669 6577 3a20 7365 6c66 2e56 6965 772e  View: self.View.
+00074ac0: 5265 6672 6573 6828 290d 0a0d 0a0d 0a20  Refresh()...... 
+00074ad0: 2020 2064 6566 2055 6e64 6f43 6861 6e67     def UndoChang
+00074ae0: 6573 2873 656c 6629 3a0d 0a20 2020 2020  es(self):..     
+00074af0: 2020 2022 2222 556e 646f 6573 2074 6865     """Undoes the
+00074b00: 2063 6861 6e67 6573 206d 6164 6520 746f   changes made to
+00074b10: 2074 6865 2072 6f77 7320 696e 2074 6869   the rows in thi
+00074b20: 7320 7461 626c 652e 2222 220d 0a20 2020  s table."""..   
+00074b30: 2020 2020 2072 6f77 735f 6265 666f 7265       rows_before
+00074b40: 203d 206c 656e 2873 656c 662e 726f 7773   = len(self.rows
+00074b50: 5f63 7572 7265 6e74 290d 0a20 2020 2020  _current)..     
+00074b60: 2020 2023 2052 6573 746f 7265 2061 6c6c     # Restore all
+00074b70: 2063 6861 6e67 6564 2072 6f77 2064 6174   changed row dat
+00074b80: 6120 6672 6f6d 2062 6163 6b75 700d 0a20  a from backup.. 
+00074b90: 2020 2020 2020 2066 6f72 2069 6478 2069         for idx i
+00074ba0: 6e20 7365 6c66 2e69 6478 5f63 6861 6e67  n self.idx_chang
+00074bb0: 6564 2e63 6f70 7928 293a 0d0a 2020 2020  ed.copy():..    
+00074bc0: 2020 2020 2020 2020 726f 7720 3d20 7365          row = se
+00074bd0: 6c66 2e72 6f77 735f 6261 636b 7570 5b69  lf.rows_backup[i
+00074be0: 6478 5d0d 0a20 2020 2020 2020 2020 2020  dx]..           
+00074bf0: 2072 6f77 5b22 5f5f 6368 616e 6765 645f   row["__changed_
+00074c00: 5f22 5d20 3d20 4661 6c73 650d 0a20 2020  _"] = False..   
+00074c10: 2020 2020 2020 2020 2073 656c 662e 726f           self.ro
+00074c20: 7773 5f61 6c6c 5b69 6478 5d2e 7570 6461  ws_all[idx].upda
+00074c30: 7465 2872 6f77 290d 0a20 2020 2020 2020  te(row)..       
+00074c40: 2020 2020 2073 656c 662e 6964 785f 6368       self.idx_ch
+00074c50: 616e 6765 642e 7265 6d6f 7665 2869 6478  anged.remove(idx
+00074c60: 290d 0a20 2020 2020 2020 2020 2020 2064  )..            d
+00074c70: 656c 2073 656c 662e 726f 7773 5f62 6163  el self.rows_bac
+00074c80: 6b75 705b 6964 785d 0d0a 2020 2020 2020  kup[idx]..      
+00074c90: 2020 2320 4469 7363 6172 6420 616c 6c20    # Discard all 
+00074ca0: 6e65 776c 7920 696e 7365 7274 6564 2072  newly inserted r
+00074cb0: 6f77 730d 0a20 2020 2020 2020 2066 6f72  ows..        for
+00074cc0: 2069 6478 2069 6e20 7365 6c66 2e69 6478   idx in self.idx
+00074cd0: 5f6e 6577 5b3a 5d3a 0d0a 2020 2020 2020  _new[:]:..      
+00074ce0: 2020 2020 2020 726f 7720 3d20 7365 6c66        row = self
+00074cf0: 2e72 6f77 735f 616c 6c5b 6964 785d 0d0a  .rows_all[idx]..
+00074d00: 2020 2020 2020 2020 2020 2020 6465 6c20              del 
+00074d10: 7365 6c66 2e72 6f77 735f 616c 6c5b 6964  self.rows_all[id
+00074d20: 785d 0d0a 2020 2020 2020 2020 2020 2020  x]..            
+00074d30: 6966 2072 6f77 2069 6e20 7365 6c66 2e72  if row in self.r
+00074d40: 6f77 735f 6375 7272 656e 743a 2073 656c  ows_current: sel
+00074d50: 662e 726f 7773 5f63 7572 7265 6e74 2e72  f.rows_current.r
+00074d60: 656d 6f76 6528 726f 7729 0d0a 2020 2020  emove(row)..    
+00074d70: 2020 2020 2020 2020 7365 6c66 2e69 6478          self.idx
+00074d80: 5f6e 6577 2e72 656d 6f76 6528 6964 7829  _new.remove(idx)
+00074d90: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00074da0: 6c66 2e69 6478 5f61 6c6c 2e72 656d 6f76  lf.idx_all.remov
+00074db0: 6528 6964 7829 0d0a 2020 2020 2020 2020  e(idx)..        
+00074dc0: 2320 556e 6465 6c65 7465 2061 6c6c 206e  # Undelete all n
+00074dd0: 6577 6c79 2064 656c 6574 6564 2069 7465  ewly deleted ite
+00074de0: 6d73 0d0a 2020 2020 2020 2020 666f 7220  ms..        for 
+00074df0: 6964 782c 2072 6f77 2069 6e20 7365 6c66  idx, row in self
+00074e00: 2e72 6f77 735f 6465 6c65 7465 642e 6974  .rows_deleted.it
+00074e10: 656d 7328 293a 0d0a 2020 2020 2020 2020  ems():..        
+00074e20: 2020 2020 726f 775b 225f 5f64 656c 6574      row["__delet
+00074e30: 6564 5f5f 225d 203d 2046 616c 7365 0d0a  ed__"] = False..
+00074e40: 2020 2020 2020 2020 2020 2020 6465 6c20              del 
+00074e50: 7365 6c66 2e72 6f77 735f 6465 6c65 7465  self.rows_delete
+00074e60: 645b 6964 785d 0d0a 2020 2020 2020 2020  d[idx]..        
+00074e70: 2020 2020 6966 2073 656c 662e 5f69 735f      if self._is_
+00074e80: 726f 775f 756e 6669 6c74 6572 6564 2872  row_unfiltered(r
+00074e90: 6f77 293a 0d0a 2020 2020 2020 2020 2020  ow):..          
+00074ea0: 2020 2020 2020 7365 6c66 2e72 6f77 735f        self.rows_
+00074eb0: 6375 7272 656e 742e 6170 7065 6e64 2872  current.append(r
+00074ec0: 6f77 290d 0a20 2020 2020 2020 2020 2020  ow)..           
+00074ed0: 2073 656c 662e 726f 775f 636f 756e 7420   self.row_count 
+00074ee0: 2b3d 2031 0d0a 2020 2020 2020 2020 7365  += 1..        se
+00074ef0: 6c66 2e4e 6f74 6966 7956 6965 7743 6861  lf.NotifyViewCha
+00074f00: 6e67 6528 726f 7773 5f62 6566 6f72 6529  nge(rows_before)
+00074f10: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
+00074f20: 662e 5669 6577 3a20 7365 6c66 2e56 6965  f.View: self.Vie
+00074f30: 772e 5265 6672 6573 6828 290d 0a0d 0a0d  w.Refresh().....
+00074f40: 0a20 2020 2064 6566 205f 6973 5f72 6f77  .    def _is_row
+00074f50: 5f75 6e66 696c 7465 7265 6428 7365 6c66  _unfiltered(self
+00074f60: 2c20 726f 7764 6174 6129 3a0d 0a20 2020  , rowdata):..   
+00074f70: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
+00074f80: 2020 5265 7475 726e 7320 7768 6574 6865    Returns whethe
+00074f90: 7220 7468 6520 726f 7720 6973 206e 6f74  r the row is not
+00074fa0: 2066 696c 7465 7265 6420 6f75 7420 6279   filtered out by
+00074fb0: 2074 6865 2063 7572 7265 6e74 2066 696c   the current fil
+00074fc0: 7465 7269 6e67 0d0a 2020 2020 2020 2020  tering..        
+00074fd0: 6372 6974 6572 6961 2c20 6966 2061 6e79  criteria, if any
+00074fe0: 2e0d 0a20 2020 2020 2020 2022 2222 0d0a  ...        """..
+00074ff0: 2020 2020 2020 2020 6973 5f75 6e66 696c          is_unfil
+00075000: 7465 7265 6420 3d20 5472 7565 0d0a 2020  tered = True..  
+00075010: 2020 2020 2020 666f 7220 636f 6c2c 2066        for col, f
+00075020: 696c 7465 725f 7661 6c75 6520 696e 2073  ilter_value in s
+00075030: 656c 662e 6669 6c74 6572 732e 6974 656d  elf.filters.item
+00075040: 7328 293a 0d0a 2020 2020 2020 2020 2020  s():..          
+00075050: 2020 636f 6c75 6d6e 5f64 6174 6120 3d20    column_data = 
+00075060: 7365 6c66 2e63 6f6c 756d 6e73 5b63 6f6c  self.columns[col
+00075070: 5d0d 0a20 2020 2020 2020 2020 2020 2069  ]..            i
+00075080: 6620 2249 4e54 4547 4552 2220 3d3d 2063  f "INTEGER" == c
+00075090: 6f6c 756d 6e5f 6461 7461 5b22 7479 7065  olumn_data["type
+000750a0: 225d 3a0d 0a20 2020 2020 2020 2020 2020  "]:..           
+000750b0: 2020 2020 2069 735f 756e 6669 6c74 6572       is_unfilter
+000750c0: 6564 2026 3d20 2866 696c 7465 725f 7661  ed &= (filter_va
+000750d0: 6c75 6520 3d3d 2072 6f77 6461 7461 5b63  lue == rowdata[c
+000750e0: 6f6c 756d 6e5f 6461 7461 5b22 6e61 6d65  olumn_data["name
+000750f0: 225d 5d29 0d0a 2020 2020 2020 2020 2020  "]])..          
+00075100: 2020 656c 6966 2022 5445 5854 2220 3d3d    elif "TEXT" ==
+00075110: 2063 6f6c 756d 6e5f 6461 7461 5b22 7479   column_data["ty
+00075120: 7065 225d 3a0d 0a20 2020 2020 2020 2020  pe"]:..         
+00075130: 2020 2020 2020 2073 7472 5f76 616c 7565         str_value
+00075140: 203d 2028 726f 7764 6174 615b 636f 6c75   = (rowdata[colu
+00075150: 6d6e 5f64 6174 615b 226e 616d 6522 5d5d  mn_data["name"]]
+00075160: 206f 7220 2222 292e 6c6f 7765 7228 290d   or "").lower().
+00075170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00075180: 2069 735f 756e 6669 6c74 6572 6564 2026   is_unfiltered &
+00075190: 3d20 7374 725f 7661 6c75 652e 6669 6e64  = str_value.find
+000751a0: 2866 696c 7465 725f 7661 6c75 652e 6c6f  (filter_value.lo
+000751b0: 7765 7228 2929 203e 3d20 300d 0a20 2020  wer()) >= 0..   
+000751c0: 2020 2020 2072 6574 7572 6e20 6973 5f75       return is_u
+000751d0: 6e66 696c 7465 7265 640d 0a0d 0a0d 0a0d  nfiltered.......
+000751e0: 0a63 6c61 7373 2043 6861 7443 6f6e 7465  .class ChatConte
+000751f0: 6e74 5469 6d65 6c69 6e65 2877 782e 6874  ntTimeline(wx.ht
+00075200: 6d6c 2e53 696d 706c 6548 746d 6c4c 6973  ml.SimpleHtmlLis
+00075210: 7442 6f78 293a 0d0a 2020 2020 2222 220d  tBox):..    """.
+00075220: 0a20 2020 204c 6973 7462 6f78 2066 6f72  .    Listbox for
+00075230: 2073 686f 7769 6e67 2071 7569 636b 2064   showing quick d
+00075240: 6174 6520 7365 6c65 6374 696f 6e20 666f  ate selection fo
+00075250: 7220 4368 6174 436f 6e74 656e 7453 5443  r ChatContentSTC
+00075260: 2e0d 0a20 2020 2022 2222 0d0a 2020 2020  ...    """..    
+00075270: 4c49 4e45 5f46 4f52 4d41 5453 203d 207b  LINE_FORMATS = {
+00075280: 0d0a 2020 2020 2020 2020 2279 6561 7222  ..        "year"
+00075290: 3a20 2027 3c66 6f6e 7420 636f 6c6f 723d  :  '<font color=
+000752a0: 2225 2846 6743 6f6c 6f75 7229 7322 2073  "%(FgColour)s" s
+000752b0: 697a 653d 353e 3c74 6162 6c65 2077 6964  ize=5><table wid
+000752c0: 7468 3d22 3130 3025 2522 3e3c 7472 3e3c  th="100%%"><tr><
+000752d0: 7464 206e 6f77 7261 703e 2528 6c61 6265  td nowrap>%(labe
+000752e0: 6c29 733c 2f74 643e 3c74 6420 616c 6967  l)s</td><td alig
+000752f0: 6e3d 2272 6967 6874 223e 3c66 6f6e 7420  n="right"><font 
+00075300: 636f 6c6f 723d 2225 2844 6973 6162 6c65  color="%(Disable
+00075310: 6443 6f6c 6f75 7229 7322 2073 697a 653d  dColour)s" size=
+00075320: 313e 2528 636f 756e 7429 733c 2f66 6f6e  1>%(count)s</fon
+00075330: 743e 3c2f 7464 3e3c 2f74 723e 3c2f 7461  t></td></tr></ta
+00075340: 626c 653e 3c2f 666f 6e74 3e27 2c0d 0a20  ble></font>',.. 
+00075350: 2020 2020 2020 2022 6d6f 6e74 6822 3a20         "month": 
+00075360: 273c 666f 6e74 2063 6f6c 6f72 3d22 2528  '<font color="%(
+00075370: 4667 436f 6c6f 7572 2973 223e 3c74 6162  FgColour)s"><tab
+00075380: 6c65 2077 6964 7468 3d22 3130 3025 2522  le width="100%%"
+00075390: 3e3c 7472 3e3c 7464 206e 6f77 7261 703e  ><tr><td nowrap>
+000753a0: 3c66 6f6e 7420 7369 7a65 3d34 3e26 6e62  <font size=4>&nb
+000753b0: 7370 3b25 286c 6162 656c 2973 203c 2f66  sp;%(label)s </f
+000753c0: 6f6e 743e 3c66 6f6e 7420 7369 7a65 3d32  ont><font size=2
+000753d0: 3e25 286c 6162 656c 3229 733c 2f66 6f6e  >%(label2)s</fon
+000753e0: 743e 3c2f 7464 3e3c 7464 2061 6c69 676e  t></td><td align
+000753f0: 3d22 7269 6768 7422 3e3c 666f 6e74 2063  ="right"><font c
+00075400: 6f6c 6f72 3d22 2528 4469 7361 626c 6564  olor="%(Disabled
+00075410: 436f 6c6f 7572 2973 2220 7369 7a65 3d31  Colour)s" size=1
+00075420: 3e25 2863 6f75 6e74 2973 3c2f 666f 6e74  >%(count)s</font
+00075430: 3e3c 2f74 643e 3c2f 7472 3e3c 2f74 6162  ></td></tr></tab
+00075440: 6c65 3e3c 2f66 6f6e 743e 272c 0d0a 2020  le></font>',..  
+00075450: 2020 2020 2020 2264 6179 223a 2020 2027        "day":   '
+00075460: 3c66 6f6e 7420 636f 6c6f 723d 2225 2846  <font color="%(F
+00075470: 6743 6f6c 6f75 7229 7322 3e3c 7461 626c  gColour)s"><tabl
+00075480: 6520 7769 6474 683d 2231 3030 2525 223e  e width="100%%">
+00075490: 3c74 723e 3c74 6420 6e6f 7772 6170 3e3c  <tr><td nowrap><
+000754a0: 666f 6e74 2073 697a 653d 343e 2528 6c61  font size=4>%(la
+000754b0: 6265 6c29 7320 3c2f 666f 6e74 3e3c 666f  bel)s </font><fo
+000754c0: 6e74 2073 697a 653d 323e 2528 6c61 6265  nt size=2>%(labe
+000754d0: 6c32 2973 3c2f 666f 6e74 3e3c 2f74 643e  l2)s</font></td>
+000754e0: 3c74 6420 616c 6967 6e3d 2272 6967 6874  <td align="right
+000754f0: 223e 3c66 6f6e 7420 636f 6c6f 723d 2225  "><font color="%
+00075500: 2844 6973 6162 6c65 6443 6f6c 6f75 7229  (DisabledColour)
+00075510: 7322 2073 697a 653d 313e 2528 636f 756e  s" size=1>%(coun
+00075520: 7429 733c 2f66 6f6e 743e 3c2f 7464 3e3c  t)s</font></td><
+00075530: 2f74 723e 3c2f 7461 626c 653e 3c2f 666f  /tr></table></fo
+00075540: 6e74 3e27 2c0d 0a20 2020 2020 2020 2022  nt>',..        "
+00075550: 6461 7465 223a 2020 273c 666f 6e74 2063  date":  '<font c
+00075560: 6f6c 6f72 3d22 2528 4667 436f 6c6f 7572  olor="%(FgColour
+00075570: 2973 2220 7369 7a65 3d33 3e3c 7461 626c  )s" size=3><tabl
+00075580: 6520 7769 6474 683d 2231 3030 2525 223e  e width="100%%">
+00075590: 3c74 723e 3c74 6420 6e6f 7772 6170 3e26  <tr><td nowrap>&
+000755a0: 6e62 7370 3b26 6e62 7370 3b26 6e62 7370  nbsp;&nbsp;&nbsp
+000755b0: 3b26 6e62 7370 3b25 286c 6162 656c 2973  ;&nbsp;%(label)s
+000755c0: 3c73 7570 3e25 286c 6162 656c 3229 733c  <sup>%(label2)s<
+000755d0: 2f73 7570 3e3c 2f74 643e 3c74 6420 616c  /sup></td><td al
+000755e0: 6967 6e3d 2272 6967 6874 223e 3c66 6f6e  ign="right"><fon
+000755f0: 7420 636f 6c6f 723d 2225 2844 6973 6162  t color="%(Disab
+00075600: 6c65 6443 6f6c 6f75 7229 7322 2073 697a  ledColour)s" siz
+00075610: 653d 313e 2528 636f 756e 7429 733c 2f66  e=1>%(count)s</f
+00075620: 6f6e 743e 3c2f 7464 3e3c 2f74 723e 3c2f  ont></td></tr></
+00075630: 7461 626c 653e 3c2f 666f 6e74 3e27 2c0d  table></font>',.
+00075640: 0a20 2020 2020 2020 2022 686f 7572 223a  .        "hour":
+00075650: 2020 273c 666f 6e74 2063 6f6c 6f72 3d22    '<font color="
+00075660: 2528 4667 436f 6c6f 7572 2973 2220 7369  %(FgColour)s" si
+00075670: 7a65 3d33 3e3c 7461 626c 6520 7769 6474  ze=3><table widt
+00075680: 683d 2231 3030 2525 223e 3c74 723e 3c74  h="100%%"><tr><t
+00075690: 6420 6e6f 7772 6170 3e26 6e62 7370 3b26  d nowrap>&nbsp;&
+000756a0: 6e62 7370 3b26 6e62 7370 3b26 6e62 7370  nbsp;&nbsp;&nbsp
+000756b0: 3b25 286c 6162 656c 2973 3c2f 7464 3e3c  ;%(label)s</td><
+000756c0: 7464 2061 6c69 676e 3d22 7269 6768 7422  td align="right"
+000756d0: 3e3c 666f 6e74 2063 6f6c 6f72 3d22 2528  ><font color="%(
+000756e0: 4469 7361 626c 6564 436f 6c6f 7572 2973  DisabledColour)s
+000756f0: 2220 7369 7a65 3d31 3e25 2863 6f75 6e74  " size=1>%(count
+00075700: 2973 3c2f 666f 6e74 3e3c 2f74 643e 3c2f  )s</font></td></
+00075710: 7472 3e3c 2f74 6162 6c65 3e3c 2f66 6f6e  tr></table></fon
+00075720: 743e 272c 0d0a 2020 2020 2020 2020 2277  t>',..        "w
+00075730: 6565 6b22 3a20 2027 3c66 6f6e 7420 636f  eek":  '<font co
+00075740: 6c6f 723d 2225 2846 6743 6f6c 6f75 7229  lor="%(FgColour)
+00075750: 7322 2073 697a 653d 323e 3c74 6162 6c65  s" size=2><table
+00075760: 2077 6964 7468 3d22 3130 3025 2522 3e3c   width="100%%"><
+00075770: 7472 3e3c 7464 206e 6f77 7261 703e 266e  tr><td nowrap>&n
+00075780: 6273 703b 266e 6273 703b 266e 6273 703b  bsp;&nbsp;&nbsp;
+00075790: 266e 6273 703b 2528 6c61 6265 6c29 733c  &nbsp;%(label)s<
+000757a0: 2f74 643e 3c74 6420 616c 6967 6e3d 2272  /td><td align="r
+000757b0: 6967 6874 223e 3c66 6f6e 7420 636f 6c6f  ight"><font colo
+000757c0: 723d 2225 2844 6973 6162 6c65 6443 6f6c  r="%(DisabledCol
+000757d0: 6f75 7229 7322 2073 697a 653d 313e 2528  our)s" size=1>%(
+000757e0: 636f 756e 7429 733c 2f66 6f6e 743e 3c2f  count)s</font></
+000757f0: 7464 3e3c 2f74 723e 3c2f 7461 626c 653e  td></tr></table>
+00075800: 3c2f 666f 6e74 3e27 2c0d 0a20 2020 207d  </font>',..    }
+00075810: 0d0a 2020 2020 4c49 4e45 5f46 4f52 4d41  ..    LINE_FORMA
+00075820: 5453 5f48 4947 484c 4947 4854 203d 207b  TS_HIGHLIGHT = {
+00075830: 0d0a 2020 2020 2020 2020 2279 6561 7222  ..        "year"
+00075840: 3a20 2027 3c66 6f6e 7420 636f 6c6f 723d  :  '<font color=
+00075850: 2225 2846 6743 6f6c 6f75 7229 7322 2073  "%(FgColour)s" s
+00075860: 697a 653d 353e 3c74 6162 6c65 2077 6964  ize=5><table wid
+00075870: 7468 3d22 3130 3025 2522 3e3c 7472 3e3c  th="100%%"><tr><
+00075880: 7464 206e 6f77 7261 703e 3c62 3e25 286c  td nowrap><b>%(l
+00075890: 6162 656c 2973 3c2f 623e 3c2f 7464 3e3c  abel)s</b></td><
+000758a0: 7464 2061 6c69 676e 3d22 7269 6768 7422  td align="right"
+000758b0: 3e3c 666f 6e74 2063 6f6c 6f72 3d22 2528  ><font color="%(
+000758c0: 4469 7361 626c 6564 436f 6c6f 7572 2973  DisabledColour)s
+000758d0: 2220 7369 7a65 3d31 3e25 2863 6f75 6e74  " size=1>%(count
+000758e0: 2973 3c2f 666f 6e74 3e3c 2f74 643e 3c2f  )s</font></td></
+000758f0: 7472 3e3c 2f74 6162 6c65 3e3c 2f66 6f6e  tr></table></fon
+00075900: 743e 272c 0d0a 2020 2020 2020 2020 226d  t>',..        "m
+00075910: 6f6e 7468 223a 2027 3c66 6f6e 7420 636f  onth": '<font co
+00075920: 6c6f 723d 2225 2846 6743 6f6c 6f75 7229  lor="%(FgColour)
+00075930: 7322 3e3c 7461 626c 6520 7769 6474 683d  s"><table width=
+00075940: 2231 3030 2525 223e 3c74 723e 3c74 6420  "100%%"><tr><td 
+00075950: 6e6f 7772 6170 3e3c 666f 6e74 2073 697a  nowrap><font siz
+00075960: 653d 343e 266e 6273 703b 2528 6c61 6265  e=4>&nbsp;%(labe
+00075970: 6c29 7320 3c2f 666f 6e74 3e3c 666f 6e74  l)s </font><font
+00075980: 2073 697a 653d 323e 3c62 3e25 286c 6162   size=2><b>%(lab
+00075990: 656c 3229 733c 2f62 3e3c 2f66 6f6e 743e  el2)s</b></font>
+000759a0: 3c2f 7464 3e3c 7464 2061 6c69 676e 3d22  </td><td align="
+000759b0: 7269 6768 7422 3e3c 666f 6e74 2063 6f6c  right"><font col
+000759c0: 6f72 3d22 2528 4469 7361 626c 6564 436f  or="%(DisabledCo
+000759d0: 6c6f 7572 2973 2220 7369 7a65 3d31 3e25  lour)s" size=1>%
+000759e0: 2863 6f75 6e74 2973 3c2f 666f 6e74 3e3c  (count)s</font><
+000759f0: 2f74 643e 3c2f 7472 3e3c 2f74 6162 6c65  /td></tr></table
+00075a00: 3e3c 2f66 6f6e 743e 272c 0d0a 2020 2020  ></font>',..    
+00075a10: 2020 2020 2264 6179 223a 2020 2027 3c66      "day":   '<f
+00075a20: 6f6e 7420 636f 6c6f 723d 2225 2846 6743  ont color="%(FgC
+00075a30: 6f6c 6f75 7229 7322 3e3c 7461 626c 6520  olour)s"><table 
+00075a40: 7769 6474 683d 2231 3030 2525 223e 3c74  width="100%%"><t
+00075a50: 723e 3c74 6420 6e6f 7772 6170 3e3c 666f  r><td nowrap><fo
+00075a60: 6e74 2073 697a 653d 343e 2528 6c61 6265  nt size=4>%(labe
+00075a70: 6c29 7320 3c2f 666f 6e74 3e3c 666f 6e74  l)s </font><font
+00075a80: 2073 697a 653d 323e 3c62 3e25 286c 6162   size=2><b>%(lab
+00075a90: 656c 3229 733c 2f62 3e3c 2f66 6f6e 743e  el2)s</b></font>
+00075aa0: 3c2f 7464 3e3c 7464 2061 6c69 676e 3d22  </td><td align="
+00075ab0: 7269 6768 7422 3e3c 666f 6e74 2063 6f6c  right"><font col
+00075ac0: 6f72 3d22 2528 4469 7361 626c 6564 436f  or="%(DisabledCo
+00075ad0: 6c6f 7572 2973 2220 7369 7a65 3d31 3e25  lour)s" size=1>%
+00075ae0: 2863 6f75 6e74 2973 3c2f 666f 6e74 3e3c  (count)s</font><
+00075af0: 2f74 643e 3c2f 7472 3e3c 2f74 6162 6c65  /td></tr></table
+00075b00: 3e3c 2f66 6f6e 743e 272c 0d0a 2020 2020  ></font>',..    
+00075b10: 2020 2020 2264 6174 6522 3a20 2027 3c66      "date":  '<f
+00075b20: 6f6e 7420 636f 6c6f 723d 2225 2846 6743  ont color="%(FgC
+00075b30: 6f6c 6f75 7229 7322 2073 697a 653d 333e  olour)s" size=3>
+00075b40: 3c74 6162 6c65 2077 6964 7468 3d22 3130  <table width="10
+00075b50: 3025 2522 3e3c 7472 3e3c 7464 206e 6f77  0%%"><tr><td now
+00075b60: 7261 703e 266e 6273 703b 266e 6273 703b  rap>&nbsp;&nbsp;
+00075b70: 266e 6273 703b 266e 6273 703b 3c62 3e25  &nbsp;&nbsp;<b>%
+00075b80: 286c 6162 656c 2973 3c73 7570 3e25 286c  (label)s<sup>%(l
+00075b90: 6162 656c 3229 733c 2f62 3e3c 2f73 7570  abel2)s</b></sup
+00075ba0: 3e3c 2f74 643e 3c74 6420 616c 6967 6e3d  ></td><td align=
+00075bb0: 2272 6967 6874 223e 3c66 6f6e 7420 636f  "right"><font co
+00075bc0: 6c6f 723d 2225 2844 6973 6162 6c65 6443  lor="%(DisabledC
+00075bd0: 6f6c 6f75 7229 7322 2073 697a 653d 313e  olour)s" size=1>
+00075be0: 2528 636f 756e 7429 733c 2f66 6f6e 743e  %(count)s</font>
+00075bf0: 3c2f 7464 3e3c 2f74 723e 3c2f 7461 626c  </td></tr></tabl
+00075c00: 653e 3c2f 666f 6e74 3e27 2c0d 0a20 2020  e></font>',..   
+00075c10: 2020 2020 2022 686f 7572 223a 2020 273c       "hour":  '<
+00075c20: 666f 6e74 2063 6f6c 6f72 3d22 2528 4667  font color="%(Fg
+00075c30: 436f 6c6f 7572 2973 2220 7369 7a65 3d33  Colour)s" size=3
+00075c40: 3e3c 7461 626c 6520 7769 6474 683d 2231  ><table width="1
+00075c50: 3030 2525 223e 3c74 723e 3c74 6420 6e6f  00%%"><tr><td no
+00075c60: 7772 6170 3e26 6e62 7370 3b26 6e62 7370  wrap>&nbsp;&nbsp
+00075c70: 3b26 6e62 7370 3b26 6e62 7370 3b3c 623e  ;&nbsp;&nbsp;<b>
+00075c80: 2528 6c61 6265 6c29 733c 2f62 3e3c 2f74  %(label)s</b></t
+00075c90: 643e 3c74 6420 616c 6967 6e3d 2272 6967  d><td align="rig
+00075ca0: 6874 223e 3c66 6f6e 7420 636f 6c6f 723d  ht"><font color=
+00075cb0: 2225 2844 6973 6162 6c65 6443 6f6c 6f75  "%(DisabledColou
+00075cc0: 7229 7322 2073 697a 653d 313e 2528 636f  r)s" size=1>%(co
+00075cd0: 756e 7429 733c 2f66 6f6e 743e 3c2f 7464  unt)s</font></td
+00075ce0: 3e3c 2f74 723e 3c2f 7461 626c 653e 3c2f  ></tr></table></
+00075cf0: 666f 6e74 3e27 2c0d 0a20 2020 2020 2020  font>',..       
+00075d00: 2022 7765 656b 223a 2020 273c 666f 6e74   "week":  '<font
+00075d10: 2063 6f6c 6f72 3d22 2528 4667 436f 6c6f   color="%(FgColo
+00075d20: 7572 2973 2220 7369 7a65 3d32 3e3c 7461  ur)s" size=2><ta
+00075d30: 626c 6520 7769 6474 683d 2231 3030 2525  ble width="100%%
+00075d40: 223e 3c74 723e 3c74 6420 6e6f 7772 6170  "><tr><td nowrap
+00075d50: 3e26 6e62 7370 3b26 6e62 7370 3b26 6e62  >&nbsp;&nbsp;&nb
+00075d60: 7370 3b26 6e62 7370 3b3c 623e 2528 6c61  sp;&nbsp;<b>%(la
+00075d70: 6265 6c29 733c 2f62 3e3c 2f74 643e 3c74  bel)s</b></td><t
+00075d80: 6420 616c 6967 6e3d 2272 6967 6874 223e  d align="right">
+00075d90: 3c66 6f6e 7420 636f 6c6f 723d 2225 2844  <font color="%(D
+00075da0: 6973 6162 6c65 6443 6f6c 6f75 7229 7322  isabledColour)s"
+00075db0: 2073 697a 653d 313e 2528 636f 756e 7429   size=1>%(count)
+00075dc0: 733c 2f66 6f6e 743e 3c2f 7464 3e3c 2f74  s</font></td></t
+00075dd0: 723e 3c2f 7461 626c 653e 3c2f 666f 6e74  r></table></font
+00075de0: 3e27 2c0d 0a20 2020 207d 0d0a 0d0a 0d0a  >',..    }......
+00075df0: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
+00075e00: 2873 656c 662c 2070 6172 656e 742c 2069  (self, parent, i
+00075e10: 643d 7778 2e49 445f 414e 592c 2070 6f73  d=wx.ID_ANY, pos
+00075e20: 3d77 782e 4465 6661 756c 7450 6f73 6974  =wx.DefaultPosit
+00075e30: 696f 6e2c 0d0a 2020 2020 2020 2020 2020  ion,..          
+00075e40: 2020 2020 2020 2073 697a 653d 7778 2e44         size=wx.D
+00075e50: 6566 6175 6c74 5369 7a65 293a 0d0a 2020  efaultSize):..  
+00075e60: 2020 2020 2020 7375 7065 7228 4368 6174        super(Chat
+00075e70: 436f 6e74 656e 7454 696d 656c 696e 652c  ContentTimeline,
+00075e80: 2073 656c 6629 2e5f 5f69 6e69 745f 5f28   self).__init__(
+00075e90: 7061 7265 6e74 2c20 6964 2c20 706f 732c  parent, id, pos,
+00075ea0: 2073 697a 6529 0d0a 2020 2020 2020 2020   size)..        
+00075eb0: 7365 6c66 2e5f 7469 6d65 6c69 6e65 203d  self._timeline =
+00075ec0: 205b 5d20 2020 2020 2023 205b 7b64 742c   []      # [{dt,
+00075ed0: 206c 6162 656c 2c20 756e 6974 2c20 6d65   label, unit, me
+00075ee0: 7373 6167 652c 203f 6c61 6265 6c32 7d2c  ssage, ?label2},
+00075ef0: 205d 0d0a 2020 2020 2020 2020 7365 6c66   ]..        self
+00075f00: 2e5f 756e 6974 7320 3d20 2829 2020 2020  ._units = ()    
+00075f10: 2020 2020 2023 2028 746f 7020 756e 6974       # (top unit
+00075f20: 2c20 3f73 7562 756e 6974 290d 0a20 2020  , ?subunit)..   
+00075f30: 2020 2020 2073 656c 662e 5f68 6967 686c       self._highl
+00075f40: 6967 6874 7320 3d20 7365 7428 2920 2320  ights = set() # 
+00075f50: 5b69 6e64 6578 206f 6620 6869 6768 6c69  [index of highli
+00075f60: 6768 7465 6420 726f 772c 205d 0d0a 2020  ghted row, ]..  
+00075f70: 2020 2020 2020 7365 6c66 2e5f 7472 6163        self._trac
+00075f80: 6b69 6e67 203d 2054 7275 6520 2020 2023  king = True    #
+00075f90: 2053 6372 6f6c 6c20 6869 6768 6c69 6768   Scroll highligh
+00075fa0: 7473 2069 6e74 6f20 7669 6577 0d0a 2020  ts into view..  
+00075fb0: 2020 2020 2020 436f 6c6f 7572 4d61 6e61        ColourMana
+00075fc0: 6765 722e 4d61 6e61 6765 2873 656c 662c  ger.Manage(self,
+00075fd0: 2022 4261 636b 6772 6f75 6e64 436f 6c6f   "BackgroundColo
+00075fe0: 7572 222c 2022 4267 436f 6c6f 7572 2229  ur", "BgColour")
+00075ff0: 0d0a 2020 2020 2020 2020 7365 6c66 2e42  ..        self.B
+00076000: 696e 6428 7778 2e45 5654 5f4c 4953 5442  ind(wx.EVT_LISTB
+00076010: 4f58 2c20 7365 6c66 2e5f 4f6e 5365 6c65  OX, self._OnSele
+00076020: 6374 290d 0a0d 0a0d 0a20 2020 2064 6566  ct)......    def
+00076030: 2050 6f70 756c 6174 6528 7365 6c66 2c20   Populate(self, 
+00076040: 7469 6d65 6c69 6e65 2c20 756e 6974 7329  timeline, units)
+00076050: 3a0d 0a20 2020 2020 2020 2022 2222 0d0a  :..        """..
+00076060: 2020 2020 2020 2020 506f 7075 6c61 7465          Populate
+00076070: 7320 7469 6d65 6c69 6e65 2066 726f 6d20  s timeline from 
+00076080: 7061 7273 6572 2073 7461 7473 2e0d 0a0d  parser stats....
+00076090: 0a20 2020 2020 2020 2040 7061 7261 6d20  .        @param 
+000760a0: 2020 7469 6d65 6c69 6e65 2020 5b7b 6474    timeline  [{dt
+000760b0: 2c20 6c61 6265 6c2c 2075 6e69 742c 206d  , label, unit, m
+000760c0: 6573 7361 6765 732c 203f 6c61 6265 6c32  essages, ?label2
+000760d0: 7d5d 0d0a 2020 2020 2020 2020 2222 220d  }]..        """.
+000760e0: 0a20 2020 2020 2020 2073 656c 662e 5365  .        self.Se
+000760f0: 7428 5b5d 290d 0a20 2020 2020 2020 2073  t([])..        s
+00076100: 656c 662e 5f68 6967 686c 6967 6874 732e  elf._highlights.
+00076110: 636c 6561 7228 290d 0a20 2020 2020 2020  clear()..       
+00076120: 2073 656c 662e 5f74 696d 656c 696e 655b   self._timeline[
+00076130: 3a5d 203d 205b 6469 6374 2878 2c20 6d65  :] = [dict(x, me
+00076140: 7373 6167 653d 785b 226d 6573 7361 6765  ssage=x["message
+00076150: 7322 5d5b 305d 2920 666f 7220 7820 696e  s"][0]) for x in
+00076160: 2074 696d 656c 696e 655d 0d0a 2020 2020   timeline]..    
+00076170: 2020 2020 7365 6c66 2e5f 756e 6974 7320      self._units 
+00076180: 2020 2020 2020 3d20 756e 6974 730d 0a20        = units.. 
+00076190: 2020 2020 2020 2066 6f72 2078 2069 6e20         for x in 
+000761a0: 7365 6c66 2e5f 7469 6d65 6c69 6e65 3a20  self._timeline: 
+000761b0: 782e 706f 7028 226d 6573 7361 6765 7322  x.pop("messages"
+000761c0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+000761d0: 5265 6672 6573 6849 7465 6d73 2829 0d0a  RefreshItems()..
+000761e0: 0d0a 0d0a 2020 2020 6465 6620 4765 744d  ....    def GetM
+000761f0: 6573 7361 6765 2873 656c 662c 2069 6e64  essage(self, ind
+00076200: 6578 293a 0d0a 2020 2020 2020 2020 2222  ex):..        ""
+00076210: 2252 6574 7572 6e73 206d 6573 7361 6765  "Returns message
+00076220: 2049 4420 666f 7220 6974 656d 2061 7420   ID for item at 
+00076230: 7370 6563 6966 6965 6420 696e 6465 782e  specified index.
+00076240: 2222 220d 0a20 2020 2020 2020 2069 6620  """..        if 
+00076250: 696e 6465 7820 3c20 303a 2069 6e64 6578  index < 0: index
+00076260: 2025 3d20 6c65 6e28 7365 6c66 2e5f 7469   %= len(self._ti
+00076270: 6d65 6c69 6e65 290d 0a20 2020 2020 2020  meline)..       
+00076280: 2069 6620 696e 6465 7820 3e3d 206c 656e   if index >= len
+00076290: 2873 656c 662e 5f74 696d 656c 696e 6529  (self._timeline)
+000762a0: 3a20 7265 7475 726e 204e 6f6e 650d 0a20  : return None.. 
+000762b0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+000762c0: 6c66 2e5f 7469 6d65 6c69 6e65 5b69 6e64  lf._timeline[ind
+000762d0: 6578 5d5b 226d 6573 7361 6765 225d 0d0a  ex]["message"]..
+000762e0: 0d0a 0d0a 2020 2020 6465 6620 5265 6672  ....    def Refr
+000762f0: 6573 6849 7465 6d73 2873 656c 6629 3a0d  eshItems(self):.
+00076300: 0a20 2020 2020 2020 2022 2222 5265 6472  .        """Redr
+00076310: 6177 7320 616c 6c20 6375 7272 656e 7420  aws all current 
+00076320: 6974 656d 732e 2222 220d 0a20 2020 2020  items."""..     
+00076330: 2020 2069 6620 6e6f 7420 7365 6c66 2e49     if not self.I
+00076340: 7353 686f 776e 4f6e 5363 7265 656e 2829  sShownOnScreen()
+00076350: 3a20 7265 7475 726e 0d0a 0d0a 2020 2020  : return....    
+00076360: 2020 2020 636f 756e 7430 2c20 7365 6c65      count0, sele
+00076370: 6374 6564 3020 3d20 7365 6c66 2e52 6f77  cted0 = self.Row
+00076380: 436f 756e 742c 2073 656c 662e 5365 6c65  Count, self.Sele
+00076390: 6374 696f 6e0d 0a20 2020 2020 2020 2070  ction..        p
+000763a0: 6f73 3020 3d20 7365 6c66 2e47 6574 5363  os0 = self.GetSc
+000763b0: 726f 6c6c 506f 7328 7778 2e56 4552 5449  rollPos(wx.VERTI
+000763c0: 4341 4c29 0d0a 2020 2020 2020 2020 7365  CAL)..        se
+000763d0: 6c66 2e46 7265 657a 6528 290d 0a20 2020  lf.Freeze()..   
+000763e0: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
+000763f0: 2020 2020 2020 2073 656c 662e 5365 7428         self.Set(
+00076400: 5b5d 290d 0a20 2020 2020 2020 2020 2020  [])..           
+00076410: 2066 6f72 2069 2c20 6464 6963 7420 696e   for i, ddict in
+00076420: 2065 6e75 6d65 7261 7465 2873 656c 662e   enumerate(self.
+00076430: 5f74 696d 656c 696e 6529 3a0d 0a20 2020  _timeline):..   
+00076440: 2020 2020 2020 2020 2020 2020 2046 4f52               FOR
+00076450: 4d41 5453 203d 2073 656c 662e 4c49 4e45  MATS = self.LINE
+00076460: 5f46 4f52 4d41 5453 5f48 4947 484c 4947  _FORMATS_HIGHLIG
+00076470: 4854 2069 6620 6920 696e 2073 656c 662e  HT if i in self.
+00076480: 5f68 6967 686c 6967 6874 7320 5c0d 0a20  _highlights \.. 
+00076490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000764a0: 2020 2020 2020 2020 2065 6c73 6520 7365           else se
+000764b0: 6c66 2e4c 494e 455f 464f 524d 4154 530d  lf.LINE_FORMATS.
+000764c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000764d0: 206c 6162 656c 203d 2046 4f52 4d41 5453   label = FORMATS
+000764e0: 5b64 6469 6374 5b22 756e 6974 225d 5d20  [ddict["unit"]] 
+000764f0: 2520 6469 6374 2876 6172 7328 636f 6e66  % dict(vars(conf
+00076500: 292c 202a 2a64 6469 6374 290d 0a20 2020  ), **ddict)..   
+00076510: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00076520: 662e 4170 7065 6e64 286c 6162 656c 290d  f.Append(label).
+00076530: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00076540: 636f 756e 7430 3a0d 0a20 2020 2020 2020  count0:..       
+00076550: 2020 2020 2020 2020 2073 656c 662e 5365           self.Se
+00076560: 6c65 6374 696f 6e20 3d20 7365 6c65 6374  lection = select
+00076570: 6564 300d 0a20 2020 2020 2020 2020 2020  ed0..           
+00076580: 2020 2020 2073 656c 662e 5363 726f 6c6c       self.Scroll
+00076590: 546f 526f 7728 706f 7330 290d 0a20 2020  ToRow(pos0)..   
+000765a0: 2020 2020 2020 2020 2065 6c73 653a 2073           else: s
+000765b0: 656c 662e 5363 726f 6c6c 546f 526f 7728  elf.ScrollToRow(
+000765c0: 2d31 290d 0a20 2020 2020 2020 2066 696e  -1)..        fin
+000765d0: 616c 6c79 3a20 7365 6c66 2e54 6861 7728  ally: self.Thaw(
+000765e0: 290d 0a0d 0a0d 0a20 2020 2064 6566 2052  )......    def R
+000765f0: 6566 7265 7368 4974 656d 2873 656c 662c  efreshItem(self,
+00076600: 2069 6e64 6578 293a 0d0a 2020 2020 2020   index):..      
+00076610: 2020 2222 2252 6564 7261 7773 2074 6865    """Redraws the
+00076620: 2073 7065 6369 6669 6564 2072 6f77 2e22   specified row."
+00076630: 2222 0d0a 2020 2020 2020 2020 464f 524d  ""..        FORM
+00076640: 4154 5320 3d20 7365 6c66 2e4c 494e 455f  ATS = self.LINE_
+00076650: 464f 524d 4154 535f 4849 4748 4c49 4748  FORMATS_HIGHLIGH
+00076660: 5420 6966 2069 6e64 6578 2069 6e20 7365  T if index in se
+00076670: 6c66 2e5f 6869 6768 6c69 6768 7473 205c  lf._highlights \
+00076680: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00076690: 2020 2020 656c 7365 2073 656c 662e 4c49      else self.LI
+000766a0: 4e45 5f46 4f52 4d41 5453 0d0a 2020 2020  NE_FORMATS..    
+000766b0: 2020 2020 6464 6963 7420 3d20 7365 6c66      ddict = self
+000766c0: 2e5f 7469 6d65 6c69 6e65 5b69 6e64 6578  ._timeline[index
+000766d0: 5d0d 0a20 2020 2020 2020 206c 6162 656c  ]..        label
+000766e0: 203d 2046 4f52 4d41 5453 5b64 6469 6374   = FORMATS[ddict
+000766f0: 5b22 756e 6974 225d 5d20 2520 6469 6374  ["unit"]] % dict
+00076700: 2876 6172 7328 636f 6e66 292c 202a 2a64  (vars(conf), **d
+00076710: 6469 6374 290d 0a20 2020 2020 2020 2073  dict)..        s
+00076720: 656c 662e 5365 7453 7472 696e 6728 696e  elf.SetString(in
+00076730: 6465 782c 206c 6162 656c 290d 0a0d 0a0d  dex, label).....
+00076740: 0a20 2020 2064 6566 2048 6967 686c 6967  .    def Highlig
+00076750: 6874 526f 7773 2873 656c 662c 206d 6573  htRows(self, mes
+00076760: 7361 6765 7329 3a0d 0a20 2020 2020 2020  sages):..       
+00076770: 2022 2222 4869 6768 6c69 6768 7473 2074   """Highlights t
+00076780: 6865 2072 6f77 7320 7468 6174 2063 6f76  he rows that cov
+00076790: 6572 206d 6573 7361 6765 2074 696d 6573  er message times
+000767a0: 7461 6d70 732e 2222 220d 0a20 2020 2020  tamps."""..     
+000767b0: 2020 2068 6967 686c 6967 6874 732c 2072     highlights, r
+000767c0: 6f6f 7469 203d 2073 6574 2829 2c20 4e6f  ooti = set(), No
+000767d0: 6e65 0d0a 2020 2020 2020 2020 6461 7465  ne..        date
+000767e0: 7320 3d20 5b78 5b22 6474 225d 2066 6f72  s = [x["dt"] for
+000767f0: 2078 2069 6e20 7365 6c66 2e5f 7469 6d65   x in self._time
+00076800: 6c69 6e65 5d20 2b20 5b64 6174 6574 696d  line] + [datetim
+00076810: 652e 6461 7465 7469 6d65 2e6d 6178 5d0d  e.datetime.max].
+00076820: 0a20 2020 2020 2020 2066 6f72 206d 2069  .        for m i
+00076830: 6e20 6d65 7373 6167 6573 3a0d 0a20 2020  n messages:..   
+00076840: 2020 2020 2020 2020 2066 6f72 2069 2c20           for i, 
+00076850: 6474 3120 696e 2065 6e75 6d65 7261 7465  dt1 in enumerate
+00076860: 2864 6174 6573 5b3a 2d31 5d29 3a0d 0a20  (dates[:-1]):.. 
+00076870: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00076880: 6620 7365 6c66 2e5f 7469 6d65 6c69 6e65  f self._timeline
+00076890: 5b69 5d5b 2275 6e69 7422 5d20 213d 2073  [i]["unit"] != s
+000768a0: 656c 662e 5f75 6e69 7473 5b2d 315d 3a20  elf._units[-1]: 
+000768b0: 726f 6f74 6920 3d20 690d 0a20 2020 2020  rooti = i..     
+000768c0: 2020 2020 2020 2020 2020 2064 7432 203d             dt2 =
+000768d0: 2064 6174 6573 5b69 202b 2031 5d20 6966   dates[i + 1] if
+000768e0: 2064 6174 6573 5b69 202b 2031 5d20 213d   dates[i + 1] !=
+000768f0: 2064 7431 2065 6c73 6520 6461 7465 735b   dt1 else dates[
+00076900: 6920 2b20 325d 0d0a 2020 2020 2020 2020  i + 2]..        
+00076910: 2020 2020 2020 2020 6966 2064 7431 203c          if dt1 <
+00076920: 3d20 6d5b 2264 6174 6574 696d 6522 5d20  = m["datetime"] 
+00076930: 3c20 6474 323a 0d0a 2020 2020 2020 2020  < dt2:..        
+00076940: 2020 2020 2020 2020 2020 2020 6869 6768              high
+00076950: 6c69 6768 7473 2e61 6464 2869 290d 0a20  lights.add(i).. 
+00076960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00076970: 2020 2069 6620 726f 6f74 6920 6973 206e     if rooti is n
+00076980: 6f74 204e 6f6e 653a 2068 6967 686c 6967  ot None: highlig
+00076990: 6874 732e 6164 6428 726f 6f74 6929 0d0a  hts.add(rooti)..
+000769a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000769b0: 6966 2064 6174 6573 5b69 202b 2031 5d20  if dates[i + 1] 
+000769c0: 3e20 6d5b 2264 6174 6574 696d 6522 5d3a  > m["datetime"]:
+000769d0: 2062 7265 616b 2023 2066 6f72 2069 2c20   break # for i, 
+000769e0: 6474 310d 0a20 2020 2020 2020 2069 6620  dt1..        if 
+000769f0: 6869 6768 6c69 6768 7473 203d 3d20 7365  highlights == se
+00076a00: 6c66 2e5f 6869 6768 6c69 6768 7473 3a20  lf._highlights: 
+00076a10: 7265 7475 726e 0d0a 0d0a 2020 2020 2020  return....      
+00076a20: 2020 756e 6869 6768 6c69 6768 7420 3d20    unhighlight = 
+00076a30: 7365 6c66 2e5f 6869 6768 6c69 6768 7473  self._highlights
+00076a40: 202d 2068 6967 686c 6967 6874 730d 0a20   - highlights.. 
+00076a50: 2020 2020 2020 2064 6f68 6967 686c 6967         dohighlig
+00076a60: 6874 203d 2068 6967 686c 6967 6874 7320  ht = highlights 
+00076a70: 2d20 7365 6c66 2e5f 6869 6768 6c69 6768  - self._highligh
+00076a80: 7473 0d0a 2020 2020 2020 2020 7365 6c66  ts..        self
+00076a90: 2e5f 6869 6768 6c69 6768 7473 203d 2068  ._highlights = h
+00076aa0: 6967 686c 6967 6874 730d 0a20 2020 2020  ighlights..     
+00076ab0: 2020 2069 6620 6e6f 7420 7365 6c66 2e49     if not self.I
+00076ac0: 7353 686f 776e 4f6e 5363 7265 656e 2829  sShownOnScreen()
+00076ad0: 3a20 7265 7475 726e 0d0a 0d0a 2020 2020  : return....    
+00076ae0: 2020 2020 7365 6c66 2e46 7265 657a 6528      self.Freeze(
+00076af0: 290d 0a20 2020 2020 2020 2074 7279 3a0d  )..        try:.
+00076b00: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+00076b10: 2069 2069 6e20 756e 6869 6768 6c69 6768   i in unhighligh
+00076b20: 743a 2073 656c 662e 5265 6672 6573 6849  t: self.RefreshI
+00076b30: 7465 6d28 6929 0d0a 2020 2020 2020 2020  tem(i)..        
+00076b40: 2020 2020 666f 7220 6920 696e 2064 6f68      for i in doh
+00076b50: 6967 686c 6967 6874 3a20 7365 6c66 2e52  ighlight: self.R
+00076b60: 6566 7265 7368 4974 656d 2869 290d 0a20  efreshItem(i).. 
+00076b70: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+00076b80: 7420 7365 6c66 2e5f 7472 6163 6b69 6e67  t self._tracking
+00076b90: 3a20 7265 7475 726e 0d0a 0d0a 2020 2020  : return....    
+00076ba0: 2020 2020 2020 2020 2320 536b 6970 2072          # Skip r
+00076bb0: 6f6f 7420 6c69 6e65 732c 2061 7320 7468  oot lines, as th
+00076bc0: 6579 2063 616e 2068 6176 6520 6d6f 7265  ey can have more
+00076bd0: 2063 6869 6c64 7265 6e20 7468 616e 2066   children than f
+00076be0: 6974 7320 696e 2076 6965 770d 0a20 2020  its in view..   
+00076bf0: 2020 2020 2020 2020 2074 7261 636b 6c69           trackli
+00076c00: 6e65 7320 3d20 736f 7274 6564 2869 2066  nes = sorted(i f
+00076c10: 6f72 2069 2069 6e20 6869 6768 6c69 6768  or i in highligh
+00076c20: 7473 0d0a 2020 2020 2020 2020 2020 2020  ts..            
+00076c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00076c40: 2020 2020 6966 2073 656c 662e 5f74 696d      if self._tim
+00076c50: 656c 696e 655b 695d 5b22 756e 6974 225d  eline[i]["unit"]
+00076c60: 203d 3d20 7365 6c66 2e5f 756e 6974 735b   == self._units[
+00076c70: 2d31 5d29 0d0a 2020 2020 2020 2020 2020  -1])..          
+00076c80: 2020 7673 7061 6e20 3d20 7365 6c66 2e56    vspan = self.V
+00076c90: 6973 6962 6c65 4265 6769 6e2c 2073 656c  isibleBegin, sel
+00076ca0: 662e 5669 7369 626c 6545 6e64 0d0a 2020  f.VisibleEnd..  
+00076cb0: 2020 2020 2020 2020 2020 2320 5363 726f            # Scro
+00076cc0: 6c6c 2068 6967 686c 6967 6874 7320 696e  ll highlights in
+00076cd0: 746f 2076 6965 772c 2070 6c75 7320 6f6e  to view, plus on
+00076ce0: 6520 726f 7720 6f66 2070 6164 6469 6e67  e row of padding
+00076cf0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00076d00: 206e 6f74 2061 6c6c 2876 7370 616e 5b30   not all(vspan[0
+00076d10: 5d20 3c3d 2069 202d 2031 203c 3d20 7673  ] <= i - 1 <= vs
+00076d20: 7061 6e5b 315d 2061 6e64 0d0a 2020 2020  pan[1] and..    
+00076d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00076d40: 2020 2076 7370 616e 5b30 5d20 3c3d 2069     vspan[0] <= i
+00076d50: 202b 2031 203c 3d20 7673 7061 6e5b 315d   + 1 <= vspan[1]
+00076d60: 2066 6f72 2069 2069 6e20 7472 6163 6b6c   for i in trackl
+00076d70: 696e 6573 293a 0d0a 2020 2020 2020 2020  ines):..        
+00076d80: 2020 2020 2020 2020 6966 2061 6c6c 2876          if all(v
+00076d90: 7370 616e 5b30 5d20 3c20 6920 666f 7220  span[0] < i for 
+00076da0: 6920 696e 2074 7261 636b 6c69 6e65 7329  i in tracklines)
+00076db0: 3a20 2320 446f 776e 7761 7264 0d0a 2020  : # Downward..  
+00076dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00076dd0: 2020 7365 6c66 2e53 6372 6f6c 6c52 6f77    self.ScrollRow
+00076de0: 7328 7472 6163 6b6c 696e 6573 5b2d 315d  s(tracklines[-1]
+00076df0: 202d 2076 7370 616e 5b31 5d20 2b20 3129   - vspan[1] + 1)
+00076e00: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00076e10: 2020 656c 7365 3a20 7365 6c66 2e53 6372    else: self.Scr
+00076e20: 6f6c 6c54 6f52 6f77 286d 6178 2830 2c20  ollToRow(max(0, 
+00076e30: 7472 6163 6b6c 696e 6573 5b30 5d20 2d20  tracklines[0] - 
+00076e40: 3129 290d 0a20 2020 2020 2020 2066 696e  1))..        fin
+00076e50: 616c 6c79 3a20 7365 6c66 2e54 6861 7728  ally: self.Thaw(
+00076e60: 290d 0a0d 0a0d 0a20 2020 2064 6566 2047  )......    def G
+00076e70: 6574 5669 7369 626c 6545 6e64 2873 656c  etVisibleEnd(sel
+00076e80: 6629 3a0d 0a20 2020 2020 2020 2022 2222  f):..        """
+00076e90: 5265 7475 726e 7320 7468 6520 696e 6465  Returns the inde
+00076ea0: 7820 6f66 2074 6865 206c 6173 7420 6675  x of the last fu
+00076eb0: 6c6c 7920 7669 7369 626c 6520 726f 772e  lly visible row.
+00076ec0: 2222 220d 0a0d 0a20 2020 2020 2020 2023  """....        #
+00076ed0: 2047 6574 5669 7369 626c 6545 6e64 2064   GetVisibleEnd d
+00076ee0: 6566 6175 6c74 2069 6d70 6c65 6d65 6e74  efault implement
+00076ef0: 6174 696f 6e20 6973 2069 6d70 7265 6369  ation is impreci
+00076f00: 7365 0d0a 2020 2020 2020 2020 682c 206d  se..        h, m
+00076f10: 6178 682c 206c 696e 6570 7265 7620 3d20  axh, lineprev = 
+00076f20: 302c 2073 656c 662e 5369 7a65 2e48 6569  0, self.Size.Hei
+00076f30: 6768 742c 2073 656c 662e 4669 7273 7456  ght, self.FirstV
+00076f40: 6973 6962 6c65 4c69 6e65 0d0a 2020 2020  isibleLine..    
+00076f50: 2020 2020 666f 7220 6c69 6e65 2069 6e20      for line in 
+00076f60: 7261 6e67 6528 7365 6c66 2e46 6972 7374  range(self.First
+00076f70: 5669 7369 626c 654c 696e 652c 2073 656c  VisibleLine, sel
+00076f80: 662e 526f 7743 6f75 6e74 293a 0d0a 2020  f.RowCount):..  
+00076f90: 2020 2020 2020 2020 2020 6820 2b3d 2073            h += s
+00076fa0: 656c 662e 4f6e 4765 7452 6f77 4865 6967  elf.OnGetRowHeig
+00076fb0: 6874 286c 696e 6529 0d0a 2020 2020 2020  ht(line)..      
+00076fc0: 2020 2020 2020 6966 2068 203e 206d 6178        if h > max
+00076fd0: 683a 2072 6574 7572 6e20 6c69 6e65 7072  h: return linepr
+00076fe0: 6576 0d0a 2020 2020 2020 2020 2020 2020  ev..            
+00076ff0: 6c69 6e65 7072 6576 203d 206c 696e 650d  lineprev = line.
+00077000: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00077010: 6c69 6e65 7072 6576 0d0a 2020 2020 5669  lineprev..    Vi
+00077020: 7369 626c 6545 6e64 203d 2070 726f 7065  sibleEnd = prope
+00077030: 7274 7928 4765 7456 6973 6962 6c65 456e  rty(GetVisibleEn
+00077040: 6429 0d0a 0d0a 0d0a 2020 2020 6465 6620  d)......    def 
+00077050: 4765 7453 656c 6563 7465 6454 6578 7443  GetSelectedTextC
+00077060: 6f6c 6f75 7228 7365 6c66 2c20 2a61 7267  olour(self, *arg
+00077070: 732c 202a 2a6b 7761 7267 7329 3a0d 0a20  s, **kwargs):.. 
+00077080: 2020 2020 2020 2022 2222 4f76 6572 7269         """Overri
+00077090: 6465 2076 6972 7475 616c 2066 756e 6374  de virtual funct
+000770a0: 696f 6e20 746f 2066 6f72 6365 2070 726f  ion to force pro
+000770b0: 7065 7220 6869 6768 6c69 6768 7420 636f  per highlight co
+000770c0: 6c6f 7572 2e22 2222 0d0a 2020 2020 2020  lour."""..      
+000770d0: 2020 7265 7475 726e 2043 6f6c 6f75 724d    return ColourM
+000770e0: 616e 6167 6572 2e47 6574 436f 6c6f 7572  anager.GetColour
+000770f0: 2877 782e 5359 535f 434f 4c4f 5552 5f48  (wx.SYS_COLOUR_H
+00077100: 4947 484c 4947 4854 5445 5854 290d 0a0d  IGHLIGHTTEXT)...
+00077110: 0a0d 0a20 2020 2064 6566 205f 4f6e 5365  ...    def _OnSe
+00077120: 6c65 6374 2873 656c 662c 2065 7665 6e74  lect(self, event
+00077130: 293a 0d0a 2020 2020 2020 2020 2222 2248  ):..        """H
+00077140: 616e 646c 6572 2066 6f72 2073 656c 6563  andler for selec
+00077150: 7469 6e67 2061 6e20 6974 656d 2c20 736b  ting an item, sk
+00077160: 6970 7320 7363 726f 6c6c 206f 6e20 6e65  ips scroll on ne
+00077170: 7874 2068 6967 686c 6967 6874 2e22 2222  xt highlight."""
+00077180: 0d0a 2020 2020 2020 2020 6576 656e 742e  ..        event.
+00077190: 536b 6970 2829 0d0a 2020 2020 2020 2020  Skip()..        
+000771a0: 7365 6c66 2e5f 7472 6163 6b69 6e67 203d  self._tracking =
+000771b0: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
+000771c0: 7778 2e43 616c 6c4c 6174 6572 2835 3030  wx.CallLater(500
+000771d0: 2c20 6c61 6d62 6461 3a20 7365 6c66 2061  , lambda: self a
+000771e0: 6e64 2073 6574 6174 7472 2873 656c 662c  nd setattr(self,
+000771f0: 2022 5f74 7261 636b 696e 6722 2c20 5472   "_tracking", Tr
+00077200: 7565 2929 0d0a 0d0a 0d0a 0d0a 636c 6173  ue))........clas
+00077210: 7320 4461 7948 6f75 7244 6961 6c6f 6728  s DayHourDialog(
+00077220: 7778 2e44 6961 6c6f 6729 3a0d 0a20 2020  wx.Dialog):..   
+00077230: 2022 2222 506f 7075 7020 6469 616c 6f67   """Popup dialog
+00077240: 2066 6f72 2065 6e74 6572 696e 6720 7477   for entering tw
+00077250: 6f20 7661 6c75 6573 2c20 6461 7973 2061  o values, days a
+00077260: 6e64 2068 6f75 7273 2e22 2222 0d0a 0d0a  nd hours."""....
+00077270: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
+00077280: 2873 656c 662c 2070 6172 656e 742c 206d  (self, parent, m
+00077290: 6573 7361 6765 2c20 6361 7074 696f 6e2c  essage, caption,
+000772a0: 2064 6179 732c 2068 6f75 7273 293a 0d0a   days, hours):..
+000772b0: 2020 2020 2020 2020 7778 2e44 6961 6c6f          wx.Dialo
+000772c0: 672e 5f5f 696e 6974 5f5f 2873 656c 662c  g.__init__(self,
+000772d0: 2070 6172 656e 743d 7061 7265 6e74 2c20   parent=parent, 
+000772e0: 7469 746c 653d 6361 7074 696f 6e2c 2073  title=caption, s
+000772f0: 697a 653d 2832 3530 2c20 3230 3029 290d  ize=(250, 200)).
+00077300: 0a0d 0a20 2020 2020 2020 2076 626f 7820  ...        vbox 
+00077310: 3d20 7365 6c66 2e53 697a 6572 203d 2077  = self.Sizer = w
+00077320: 782e 426f 7853 697a 6572 2877 782e 5645  x.BoxSizer(wx.VE
+00077330: 5254 4943 414c 290d 0a0d 0a20 2020 2020  RTICAL)....     
+00077340: 2020 2073 656c 662e 7465 7874 5f64 6179     self.text_day
+00077350: 7320 3d20 7778 2e53 7069 6e43 7472 6c28  s = wx.SpinCtrl(
+00077360: 7061 7265 6e74 3d73 656c 662c 2073 7479  parent=self, sty
+00077370: 6c65 3d77 782e 414c 4947 4e5f 4c45 4654  le=wx.ALIGN_LEFT
+00077380: 2c0d 0a20 2020 2020 2020 2020 2020 2073  ,..            s
+00077390: 697a 653d 2832 3030 2c20 2d31 292c 2076  ize=(200, -1), v
+000773a0: 616c 7565 3d73 7472 2864 6179 7329 2c20  alue=str(days), 
+000773b0: 6d69 6e3d 2d73 7973 2e6d 6178 7369 7a65  min=-sys.maxsize
+000773c0: 2c20 6d61 783d 7379 732e 6d61 7873 697a  , max=sys.maxsiz
+000773d0: 650d 0a20 2020 2020 2020 2029 0d0a 2020  e..        )..  
+000773e0: 2020 2020 2020 6862 6f78 3120 3d20 7778        hbox1 = wx
+000773f0: 2e42 6f78 5369 7a65 7228 7778 2e48 4f52  .BoxSizer(wx.HOR
+00077400: 495a 4f4e 5441 4c29 0d0a 2020 2020 2020  IZONTAL)..      
+00077410: 2020 6862 6f78 312e 4164 6453 7472 6574    hbox1.AddStret
+00077420: 6368 5370 6163 6572 2829 0d0a 2020 2020  chSpacer()..    
+00077430: 2020 2020 6862 6f78 312e 4164 6428 7778      hbox1.Add(wx
+00077440: 2e53 7461 7469 6354 6578 7428 7061 7265  .StaticText(pare
+00077450: 6e74 3d73 656c 662c 206c 6162 656c 3d22  nt=self, label="
+00077460: 4461 7973 3a22 292c 0d0a 2020 2020 2020  Days:"),..      
+00077470: 2020 2020 2020 666c 6167 3d77 782e 414c        flag=wx.AL
+00077480: 4947 4e5f 4345 4e54 4552 5f56 4552 5449  IGN_CENTER_VERTI
+00077490: 4341 4c29 0d0a 2020 2020 2020 2020 6862  CAL)..        hb
+000774a0: 6f78 312e 4164 6428 7365 6c66 2e74 6578  ox1.Add(self.tex
+000774b0: 745f 6461 7973 2c20 626f 7264 6572 3d35  t_days, border=5
+000774c0: 2c20 666c 6167 3d77 782e 4c45 4654 290d  , flag=wx.LEFT).
+000774d0: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
+000774e0: 7465 7874 5f68 6f75 7273 203d 2077 782e  text_hours = wx.
+000774f0: 5370 696e 4374 726c 2870 6172 656e 743d  SpinCtrl(parent=
+00077500: 7365 6c66 2c20 7374 796c 653d 7778 2e41  self, style=wx.A
+00077510: 4c49 474e 5f4c 4546 542c 0d0a 2020 2020  LIGN_LEFT,..    
+00077520: 2020 2020 2020 2073 697a 653d 2832 3030         size=(200
+00077530: 2c20 2d31 292c 2076 616c 7565 3d73 7472  , -1), value=str
+00077540: 2868 6f75 7273 292c 206d 696e 3d2d 7379  (hours), min=-sy
+00077550: 732e 6d61 7873 697a 652c 206d 6178 3d73  s.maxsize, max=s
+00077560: 7973 2e6d 6178 7369 7a65 290d 0a20 2020  ys.maxsize)..   
+00077570: 2020 2020 2068 626f 7832 203d 2077 782e       hbox2 = wx.
+00077580: 426f 7853 697a 6572 2877 782e 484f 5249  BoxSizer(wx.HORI
+00077590: 5a4f 4e54 414c 290d 0a20 2020 2020 2020  ZONTAL)..       
+000775a0: 2068 626f 7832 2e41 6464 5374 7265 7463   hbox2.AddStretc
+000775b0: 6853 7061 6365 7228 290d 0a20 2020 2020  hSpacer()..     
+000775c0: 2020 2068 626f 7832 2e41 6464 2877 782e     hbox2.Add(wx.
+000775d0: 5374 6174 6963 5465 7874 2870 6172 656e  StaticText(paren
+000775e0: 743d 7365 6c66 2c20 6c61 6265 6c3d 2248  t=self, label="H
+000775f0: 6f75 7273 3a22 292c 0d0a 2020 2020 2020  ours:"),..      
+00077600: 2020 2020 2020 2020 2020 2020 666c 6167              flag
+00077610: 3d77 782e 414c 4947 4e5f 4345 4e54 4552  =wx.ALIGN_CENTER
+00077620: 5f56 4552 5449 4341 4c29 0d0a 2020 2020  _VERTICAL)..    
+00077630: 2020 2020 6862 6f78 322e 4164 6428 7365      hbox2.Add(se
+00077640: 6c66 2e74 6578 745f 686f 7572 732c 2062  lf.text_hours, b
+00077650: 6f72 6465 723d 352c 2066 6c61 673d 7778  order=5, flag=wx
+00077660: 2e4c 4546 5429 0d0a 0d0a 2020 2020 2020  .LEFT)....      
+00077670: 2020 6275 7474 6f6e 5f6f 6b20 3d20 7778    button_ok = wx
+00077680: 2e42 7574 746f 6e28 7365 6c66 2c20 6c61  .Button(self, la
+00077690: 6265 6c3d 224f 4b22 290d 0a20 2020 2020  bel="OK")..     
+000776a0: 2020 2062 7574 746f 6e5f 6361 6e63 656c     button_cancel
+000776b0: 203d 2077 782e 4275 7474 6f6e 2873 656c   = wx.Button(sel
+000776c0: 662c 206c 6162 656c 3d22 4361 6e63 656c  f, label="Cancel
+000776d0: 222c 2069 643d 7778 2e49 445f 4341 4e43  ", id=wx.ID_CANC
+000776e0: 454c 290d 0a20 2020 2020 2020 2068 626f  EL)..        hbo
+000776f0: 7833 203d 2077 782e 426f 7853 697a 6572  x3 = wx.BoxSizer
+00077700: 2877 782e 484f 5249 5a4f 4e54 414c 290d  (wx.HORIZONTAL).
+00077710: 0a20 2020 2020 2020 2068 626f 7833 2e41  .        hbox3.A
+00077720: 6464 5374 7265 7463 6853 7061 6365 7228  ddStretchSpacer(
+00077730: 290d 0a20 2020 2020 2020 2068 626f 7833  )..        hbox3
+00077740: 2e41 6464 2862 7574 746f 6e5f 6f6b 2c20  .Add(button_ok, 
+00077750: 626f 7264 6572 3d35 2c20 666c 6167 3d77  border=5, flag=w
+00077760: 782e 5249 4748 5429 0d0a 2020 2020 2020  x.RIGHT)..      
+00077770: 2020 6862 6f78 332e 4164 6428 6275 7474    hbox3.Add(butt
+00077780: 6f6e 5f63 616e 6365 6c2c 2062 6f72 6465  on_cancel, borde
+00077790: 723d 352c 2066 6c61 673d 7778 2e52 4947  r=5, flag=wx.RIG
+000777a0: 4854 290d 0a0d 0a20 2020 2020 2020 2076  HT)....        v
+000777b0: 626f 782e 4164 6428 0d0a 2020 2020 2020  box.Add(..      
+000777c0: 2020 2020 2020 7778 2e53 7461 7469 6354        wx.StaticT
+000777d0: 6578 7428 7061 7265 6e74 3d73 656c 662c  ext(parent=self,
+000777e0: 206c 6162 656c 3d6d 6573 7361 6765 292c   label=message),
+000777f0: 2062 6f72 6465 723d 3130 2c20 666c 6167   border=10, flag
+00077800: 3d77 782e 414c 4c29 0d0a 2020 2020 2020  =wx.ALL)..      
+00077810: 2020 7662 6f78 2e41 6464 5370 6163 6572    vbox.AddSpacer
+00077820: 2835 290d 0a20 2020 2020 2020 2076 626f  (5)..        vbo
+00077830: 782e 4164 6428 0d0a 2020 2020 2020 2020  x.Add(..        
+00077840: 2020 2020 6862 6f78 312c 2062 6f72 6465      hbox1, borde
+00077850: 723d 352c 2066 6c61 673d 7778 2e4c 4546  r=5, flag=wx.LEF
+00077860: 5420 7c20 7778 2e52 4947 4854 207c 2077  T | wx.RIGHT | w
+00077870: 782e 424f 5454 4f4d 207c 2077 782e 4752  x.BOTTOM | wx.GR
+00077880: 4f57 290d 0a20 2020 2020 2020 2076 626f  OW)..        vbo
+00077890: 782e 4164 6428 0d0a 2020 2020 2020 2020  x.Add(..        
+000778a0: 2020 2020 6862 6f78 322c 2062 6f72 6465      hbox2, borde
+000778b0: 723d 352c 2066 6c61 673d 7778 2e4c 4546  r=5, flag=wx.LEF
+000778c0: 5420 7c20 7778 2e52 4947 4854 207c 2077  T | wx.RIGHT | w
+000778d0: 782e 424f 5454 4f4d 207c 2077 782e 4752  x.BOTTOM | wx.GR
+000778e0: 4f57 290d 0a20 2020 2020 2020 2076 626f  OW)..        vbo
+000778f0: 782e 4164 6428 7778 2e53 7461 7469 634c  x.Add(wx.StaticL
+00077900: 696e 6528 7365 6c66 292c 2062 6f72 6465  ine(self), borde
+00077910: 723d 352c 2070 726f 706f 7274 696f 6e3d  r=5, proportion=
+00077920: 312c 0d0a 2020 2020 2020 2020 2020 2020  1,..            
+00077930: 2020 2020 2066 6c61 673d 7778 2e4c 4546       flag=wx.LEF
+00077940: 5420 7c20 7778 2e52 4947 4854 207c 2077  T | wx.RIGHT | w
+00077950: 782e 4752 4f57 290d 0a20 2020 2020 2020  x.GROW)..       
+00077960: 2076 626f 782e 4164 6428 6862 6f78 332c   vbox.Add(hbox3,
+00077970: 2062 6f72 6465 723d 352c 2066 6c61 673d   border=5, flag=
+00077980: 7778 2e41 4c4c 207c 2077 782e 4752 4f57  wx.ALL | wx.GROW
+00077990: 290d 0a0d 0a20 2020 2020 2020 2062 7574  )....        but
+000779a0: 746f 6e5f 6f6b 2e53 6574 4465 6661 756c  ton_ok.SetDefaul
+000779b0: 7428 290d 0a20 2020 2020 2020 2062 7574  t()..        but
+000779c0: 746f 6e5f 6f6b 2e42 696e 6428 7778 2e45  ton_ok.Bind(wx.E
+000779d0: 5654 5f42 5554 544f 4e2c 206c 616d 6264  VT_BUTTON, lambd
+000779e0: 6120 653a 2073 656c 662e 456e 644d 6f64  a e: self.EndMod
+000779f0: 616c 2877 782e 4944 5f4f 4b29 290d 0a20  al(wx.ID_OK)).. 
+00077a00: 2020 2020 2020 2062 7574 746f 6e5f 6361         button_ca
+00077a10: 6e63 656c 2e42 696e 6428 7778 2e45 5654  ncel.Bind(wx.EVT
+00077a20: 5f42 5554 544f 4e2c 206c 616d 6264 6120  _BUTTON, lambda 
+00077a30: 653a 7365 6c66 2e45 6e64 4d6f 6461 6c28  e:self.EndModal(
+00077a40: 7778 2e49 445f 4341 4e43 454c 2929 0d0a  wx.ID_CANCEL))..
+00077a50: 0d0a 2020 2020 2020 2020 7365 6c66 2e4c  ..        self.L
+00077a60: 6179 6f75 7428 290d 0a20 2020 2020 2020  ayout()..       
+00077a70: 2073 656c 662e 5369 7a65 203d 2073 656c   self.Size = sel
+00077a80: 662e 4765 7445 6666 6563 7469 7665 4d69  f.GetEffectiveMi
+00077a90: 6e53 697a 6528 290d 0a20 2020 2020 2020  nSize()..       
+00077aa0: 2073 656c 662e 4365 6e74 6572 4f6e 5061   self.CenterOnPa
+00077ab0: 7265 6e74 2829 0d0a 0d0a 0d0a 2020 2020  rent()......    
+00077ac0: 6465 6620 4765 7456 616c 7565 7328 7365  def GetValues(se
+00077ad0: 6c66 293a 0d0a 2020 2020 2020 2020 2222  lf):..        ""
+00077ae0: 2252 6574 7572 6e73 2074 6865 2065 6e74  "Returns the ent
+00077af0: 6572 6564 2064 6179 7320 616e 6420 686f  ered days and ho
+00077b00: 7572 7320 6173 2061 2074 7570 6c65 206f  urs as a tuple o
+00077b10: 6620 696e 7465 6765 7273 2e22 2222 0d0a  f integers."""..
+00077b20: 2020 2020 2020 2020 6461 7973 203d 2073          days = s
+00077b30: 656c 662e 7465 7874 5f64 6179 732e 5661  elf.text_days.Va
+00077b40: 6c75 650d 0a20 2020 2020 2020 2068 6f75  lue..        hou
+00077b50: 7273 203d 2073 656c 662e 7465 7874 5f68  rs = self.text_h
+00077b60: 6f75 7273 2e56 616c 7565 0d0a 2020 2020  ours.Value..    
+00077b70: 2020 2020 7265 7475 726e 2064 6179 732c      return days,
+00077b80: 2068 6f75 7273 0d0a 0d0a 0d0a 0d0a 636c   hours........cl
+00077b90: 6173 7320 4162 6f75 7444 6961 6c6f 6728  ass AboutDialog(
+00077ba0: 7778 2e44 6961 6c6f 6729 3a0d 0a0d 0a20  wx.Dialog):.... 
+00077bb0: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
+00077bc0: 7365 6c66 2c20 7061 7265 6e74 2c20 636f  self, parent, co
+00077bd0: 6e74 656e 7429 3a0d 0a20 2020 2020 2020  ntent):..       
+00077be0: 2077 782e 4469 616c 6f67 2e5f 5f69 6e69   wx.Dialog.__ini
+00077bf0: 745f 5f28 7365 6c66 2c20 7061 7265 6e74  t__(self, parent
+00077c00: 2c20 7469 746c 653d 2241 626f 7574 2025  , title="About %
+00077c10: 7322 2025 2063 6f6e 662e 5469 746c 652c  s" % conf.Title,
+00077c20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00077c30: 2020 2020 2020 2020 2020 2020 2073 7479               sty
+00077c40: 6c65 3d77 782e 4341 5054 494f 4e20 7c20  le=wx.CAPTION | 
+00077c50: 7778 2e43 4c4f 5345 5f42 4f58 290d 0a20  wx.CLOSE_BOX).. 
+00077c60: 2020 2020 2020 2073 656c 662e 636f 6e74         self.cont
+00077c70: 656e 7420 3d20 636f 6e74 656e 740d 0a20  ent = content.. 
+00077c80: 2020 2020 2020 2068 746d 6c20 3d20 7365         html = se
+00077c90: 6c66 2e68 746d 6c20 3d20 7778 2e68 746d  lf.html = wx.htm
+00077ca0: 6c2e 4874 6d6c 5769 6e64 6f77 2873 656c  l.HtmlWindow(sel
+00077cb0: 6629 0d0a 2020 2020 2020 2020 6275 7474  f)..        butt
+00077cc0: 6f6e 5f75 7064 6174 6520 3d20 7778 2e42  on_update = wx.B
+00077cd0: 7574 746f 6e28 7365 6c66 2c20 6c61 6265  utton(self, labe
+00077ce0: 6c3d 2243 6865 636b 2066 6f72 2026 7570  l="Check for &up
+00077cf0: 6461 7465 7322 290d 0a20 2020 2020 2020  dates")..       
+00077d00: 2062 7574 746f 6e5f 6665 6564 6261 636b   button_feedback
+00077d10: 203d 2077 782e 4275 7474 6f6e 2873 656c   = wx.Button(sel
+00077d20: 662c 206c 6162 656c 3d22 5365 6e64 2026  f, label="Send &
+00077d30: 6665 6564 6261 636b 2229 0d0a 0d0a 2020  feedback")....  
+00077d40: 2020 2020 2020 6874 6d6c 2e53 6574 5061        html.SetPa
+00077d50: 6765 2863 6f6e 7465 6e74 2829 2069 6620  ge(content() if 
+00077d60: 6361 6c6c 6162 6c65 2863 6f6e 7465 6e74  callable(content
+00077d70: 2920 656c 7365 2063 6f6e 7465 6e74 290d  ) else content).
+00077d80: 0a20 2020 2020 2020 2068 746d 6c2e 4261  .        html.Ba
+00077d90: 636b 6772 6f75 6e64 436f 6c6f 7572 203d  ckgroundColour =
+00077da0: 2043 6f6c 6f75 724d 616e 6167 6572 2e47   ColourManager.G
+00077db0: 6574 436f 6c6f 7572 2877 782e 5359 535f  etColour(wx.SYS_
+00077dc0: 434f 4c4f 5552 5f57 494e 444f 5729 0d0a  COLOUR_WINDOW)..
+00077dd0: 2020 2020 2020 2020 6874 6d6c 2e42 696e          html.Bin
+00077de0: 6428 7778 2e68 746d 6c2e 4556 545f 4854  d(wx.html.EVT_HT
+00077df0: 4d4c 5f4c 494e 4b5f 434c 4943 4b45 442c  ML_LINK_CLICKED,
+00077e00: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00077e10: 2020 2020 6c61 6d62 6461 2065 3a20 7765      lambda e: we
+00077e20: 6262 726f 7773 6572 2e6f 7065 6e28 652e  bbrowser.open(e.
+00077e30: 4765 744c 696e 6b49 6e66 6f28 292e 4872  GetLinkInfo().Hr
+00077e40: 6566 2929 0d0a 2020 2020 2020 2020 6275  ef))..        bu
+00077e50: 7474 6f6e 5f75 7064 6174 652e 4269 6e64  tton_update.Bind
+00077e60: 2877 782e 4556 545f 4255 5454 4f4e 2c20  (wx.EVT_BUTTON, 
+00077e70: 7061 7265 6e74 2e6f 6e5f 6368 6563 6b5f  parent.on_check_
+00077e80: 7570 6461 7465 290d 0a20 2020 2020 2020  update)..       
+00077e90: 2062 7574 746f 6e5f 6665 6564 6261 636b   button_feedback
+00077ea0: 2e42 696e 6428 7778 2e45 5654 5f42 5554  .Bind(wx.EVT_BUT
+00077eb0: 544f 4e2c 2073 656c 662e 4f6e 4f70 656e  TON, self.OnOpen
+00077ec0: 4665 6564 6261 636b 290d 0a0d 0a20 2020  Feedback)....   
+00077ed0: 2020 2020 2073 656c 662e 5369 7a65 7220       self.Sizer 
+00077ee0: 3d20 7778 2e42 6f78 5369 7a65 7228 7778  = wx.BoxSizer(wx
+00077ef0: 2e56 4552 5449 4341 4c29 0d0a 2020 2020  .VERTICAL)..    
+00077f00: 2020 2020 7365 6c66 2e53 697a 6572 2e41      self.Sizer.A
+00077f10: 6464 2868 746d 6c2c 2070 726f 706f 7274  dd(html, proport
+00077f20: 696f 6e3d 312c 2066 6c61 673d 7778 2e47  ion=1, flag=wx.G
+00077f30: 524f 5729 0d0a 2020 2020 2020 2020 7369  ROW)..        si
+00077f40: 7a65 725f 6275 7474 6f6e 7320 3d20 7365  zer_buttons = se
+00077f50: 6c66 2e43 7265 6174 6542 7574 746f 6e53  lf.CreateButtonS
+00077f60: 697a 6572 2877 782e 4f4b 290d 0a20 2020  izer(wx.OK)..   
+00077f70: 2020 2020 2073 697a 6572 5f62 7574 746f       sizer_butto
+00077f80: 6e73 2e49 6e73 6572 7428 302c 2062 7574  ns.Insert(0, but
+00077f90: 746f 6e5f 7570 6461 7465 2c20 626f 7264  ton_update, bord
+00077fa0: 6572 3d35 302c 2066 6c61 673d 7778 2e52  er=50, flag=wx.R
+00077fb0: 4947 4854 290d 0a20 2020 2020 2020 2073  IGHT)..        s
+00077fc0: 697a 6572 5f62 7574 746f 6e73 2e49 6e73  izer_buttons.Ins
+00077fd0: 6572 7428 312c 2062 7574 746f 6e5f 6665  ert(1, button_fe
+00077fe0: 6564 6261 636b 2c20 626f 7264 6572 3d35  edback, border=5
+00077ff0: 302c 2066 6c61 673d 7778 2e52 4947 4854  0, flag=wx.RIGHT
+00078000: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00078010: 5369 7a65 722e 4164 6428 7369 7a65 725f  Sizer.Add(sizer_
+00078020: 6275 7474 6f6e 732c 2062 6f72 6465 723d  buttons, border=
+00078030: 382c 2066 6c61 673d 7778 2e41 4c49 474e  8, flag=wx.ALIGN
+00078040: 5f43 454e 5445 525f 484f 5249 5a4f 4e54  _CENTER_HORIZONT
+00078050: 414c 207c 2077 782e 414c 4c29 0d0a 2020  AL | wx.ALL)..  
+00078060: 2020 2020 2020 7365 6c66 2e42 696e 6428        self.Bind(
+00078070: 7778 2e45 5654 5f53 5953 5f43 4f4c 4f55  wx.EVT_SYS_COLOU
+00078080: 525f 4348 414e 4745 442c 2073 656c 662e  R_CHANGED, self.
+00078090: 4f6e 5379 7343 6f6c 6f75 7243 6861 6e67  OnSysColourChang
+000780a0: 6529 0d0a 0d0a 2020 2020 2020 2020 7365  e)....        se
+000780b0: 6c66 2e4c 6179 6f75 7428 290d 0a20 2020  lf.Layout()..   
+000780c0: 2020 2020 2069 6620 2277 696e 3332 2220       if "win32" 
+000780d0: 213d 2073 7973 2e70 6c61 7466 6f72 6d3a  != sys.platform:
+000780e0: 2073 656c 662e 4d69 6e53 697a 6520 3d20   self.MinSize = 
+000780f0: 2835 3530 2c20 2d31 290d 0a20 2020 2020  (550, -1)..     
+00078100: 2020 2073 656c 662e 5369 7a65 203d 2028     self.Size = (
+00078110: 7365 6c66 2e53 697a 655b 305d 2c20 6874  self.Size[0], ht
+00078120: 6d6c 2e56 6972 7475 616c 5369 7a65 5b31  ml.VirtualSize[1
+00078130: 5d20 2b20 2831 3020 6966 2022 7769 6e33  ] + (10 if "win3
+00078140: 3222 2021 3d20 7379 732e 706c 6174 666f  2" != sys.platfo
+00078150: 726d 2065 6c73 6520 3730 2929 0d0a 2020  rm else 70))..  
+00078160: 2020 2020 2020 7365 6c66 2e43 656e 7465        self.Cente
+00078170: 724f 6e50 6172 656e 7428 290d 0a0d 0a0d  rOnParent().....
+00078180: 0a20 2020 2064 6566 204f 6e4f 7065 6e46  .    def OnOpenF
+00078190: 6565 6462 6163 6b28 7365 6c66 2c20 6576  eedback(self, ev
+000781a0: 656e 7429 3a0d 0a20 2020 2020 2020 2022  ent):..        "
+000781b0: 2222 4861 6e64 6c65 7220 666f 7220 6665  ""Handler for fe
+000781c0: 6564 6261 636b 2062 7574 746f 6e2c 2063  edback button, c
+000781d0: 6c6f 7365 7320 6469 616c 6f67 2061 6e64  loses dialog and
+000781e0: 206f 7065 6e73 2066 6565 6462 6163 6b20   opens feedback 
+000781f0: 6469 616c 6f67 2e22 2222 0d0a 2020 2020  dialog."""..    
+00078200: 2020 2020 7778 2e43 616c 6c41 6674 6572      wx.CallAfter
+00078210: 2873 656c 662e 5061 7265 6e74 2e6f 6e5f  (self.Parent.on_
+00078220: 6f70 656e 5f66 6565 6462 6163 6b29 0d0a  open_feedback)..
+00078230: 2020 2020 2020 2020 7365 6c66 2e43 6c6f          self.Clo
+00078240: 7365 2829 0d0a 0d0a 0d0a 2020 2020 6465  se()......    de
+00078250: 6620 4f6e 5379 7343 6f6c 6f75 7243 6861  f OnSysColourCha
+00078260: 6e67 6528 7365 6c66 2c20 6576 656e 7429  nge(self, event)
+00078270: 3a0d 0a20 2020 2020 2020 2022 2222 4861  :..        """Ha
+00078280: 6e64 6c65 7220 666f 7220 7379 7374 656d  ndler for system
+00078290: 2063 6f6c 6f75 7220 6368 616e 6765 2c20   colour change, 
+000782a0: 7265 6672 6573 6865 7320 636f 6e74 656e  refreshes conten
+000782b0: 742e 2222 220d 0a20 2020 2020 2020 2065  t."""..        e
+000782c0: 7665 6e74 2e53 6b69 7028 290d 0a20 2020  vent.Skip()..   
+000782d0: 2020 2020 2064 6566 2064 6f72 6566 7265       def dorefre
+000782e0: 7368 2829 3a0d 0a20 2020 2020 2020 2020  sh():..         
+000782f0: 2020 2069 6620 6e6f 7420 7365 6c66 3a20     if not self: 
+00078300: 7265 7475 726e 0d0a 2020 2020 2020 2020  return..        
+00078310: 2020 2020 7365 6c66 2e68 746d 6c2e 5365      self.html.Se
+00078320: 7450 6167 6528 7365 6c66 2e63 6f6e 7465  tPage(self.conte
+00078330: 6e74 2829 2069 6620 6361 6c6c 6162 6c65  nt() if callable
+00078340: 2873 656c 662e 636f 6e74 656e 7429 2065  (self.content) e
+00078350: 6c73 6520 7365 6c66 2e63 6f6e 7465 6e74  lse self.content
+00078360: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
+00078370: 656c 662e 6874 6d6c 2e42 6163 6b67 726f  elf.html.Backgro
+00078380: 756e 6443 6f6c 6f75 7220 3d20 436f 6c6f  undColour = Colo
+00078390: 7572 4d61 6e61 6765 722e 4765 7443 6f6c  urManager.GetCol
+000783a0: 6f75 7228 7778 2e53 5953 5f43 4f4c 4f55  our(wx.SYS_COLOU
+000783b0: 525f 5749 4e44 4f57 290d 0a20 2020 2020  R_WINDOW)..     
+000783c0: 2020 2020 2020 2073 656c 662e 6874 6d6c         self.html
+000783d0: 2e46 6f72 6567 726f 756e 6443 6f6c 6f75  .ForegroundColou
+000783e0: 7220 3d20 436f 6c6f 7572 4d61 6e61 6765  r = ColourManage
+000783f0: 722e 4765 7443 6f6c 6f75 7228 7778 2e53  r.GetColour(wx.S
+00078400: 5953 5f43 4f4c 4f55 525f 4254 4e54 4558  YS_COLOUR_BTNTEX
+00078410: 5429 0d0a 2020 2020 2020 2020 7778 2e43  T)..        wx.C
+00078420: 616c 6c41 6674 6572 2864 6f72 6566 7265  allAfter(dorefre
+00078430: 7368 2920 2320 506f 7374 706f 6e65 2074  sh) # Postpone t
+00078440: 6f20 616c 6c6f 7720 636f 6e66 2074 6f20  o allow conf to 
+00078450: 7570 6461 7465 0d0a 0d0a 0d0a 0d0a 636c  update........cl
+00078460: 6173 7320 4c6f 6769 6e44 6961 6c6f 6728  ass LoginDialog(
+00078470: 7778 2e44 6961 6c6f 672c 2077 785f 6163  wx.Dialog, wx_ac
+00078480: 6365 6c2e 4175 746f 4163 6365 6c65 7261  cel.AutoAccelera
+00078490: 746f 724d 6978 496e 293a 0d0a 2020 2020  torMixIn):..    
+000784a0: 2222 2244 6961 6c6f 6720 7468 6174 2061  """Dialog that a
+000784b0: 736b 7320 666f 7220 7573 6572 6e61 6d65  sks for username
+000784c0: 2061 6e64 2070 6173 7377 6f72 642e 2222   and password.""
+000784d0: 220d 0a0d 0a20 2020 2064 6566 205f 5f69  "....    def __i
+000784e0: 6e69 745f 5f28 7365 6c66 2c20 7061 7265  nit__(self, pare
+000784f0: 6e74 2c20 7469 746c 653d 224c 6f67 2069  nt, title="Log i
+00078500: 6e22 293a 0d0a 2020 2020 2020 2020 7778  n"):..        wx
+00078510: 2e44 6961 6c6f 672e 5f5f 696e 6974 5f5f  .Dialog.__init__
+00078520: 2873 656c 662c 2070 6172 656e 742c 2074  (self, parent, t
+00078530: 6974 6c65 3d74 6974 6c65 2c0d 0a20 2020  itle=title,..   
+00078540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00078550: 2020 2020 2020 2020 7374 796c 653d 7778          style=wx
+00078560: 2e43 4150 5449 4f4e 207c 2077 782e 434c  .CAPTION | wx.CL
+00078570: 4f53 455f 424f 5829 0d0a 0d0a 2020 2020  OSE_BOX)....    
+00078580: 2020 2020 6c61 6265 6c5f 6e61 6d65 203d      label_name =
+00078590: 2077 782e 5374 6174 6963 5465 7874 2873   wx.StaticText(s
+000785a0: 656c 662c 206c 6162 656c 3d22 2655 7365  elf, label="&Use
+000785b0: 726e 616d 653a 222c 206e 616d 653d 226c  rname:", name="l
+000785c0: 6162 656c 5f75 7365 7222 290d 0a20 2020  abel_user")..   
+000785d0: 2020 2020 2065 6469 745f 6e61 6d65 2020       edit_name  
+000785e0: 3d20 7365 6c66 2e65 6469 745f 6e61 6d65  = self.edit_name
+000785f0: 203d 2077 782e 5465 7874 4374 726c 2873   = wx.TextCtrl(s
+00078600: 656c 662c 2073 697a 653d 2832 3030 2c20  elf, size=(200, 
+00078610: 2d31 292c 206e 616d 653d 2275 7365 7222  -1), name="user"
+00078620: 290d 0a20 2020 2020 2020 206c 6162 656c  )..        label
+00078630: 5f70 6173 7320 3d20 7778 2e53 7461 7469  _pass = wx.Stati
+00078640: 6354 6578 7428 7365 6c66 2c20 6c61 6265  cText(self, labe
+00078650: 6c3d 2226 5061 7373 776f 7264 3a22 2c20  l="&Password:", 
+00078660: 6e61 6d65 3d22 6c61 6265 6c5f 7061 7373  name="label_pass
+00078670: 2229 0d0a 2020 2020 2020 2020 6564 6974  ")..        edit
+00078680: 5f70 6173 7320 203d 2073 656c 662e 6564  _pass  = self.ed
+00078690: 6974 5f70 6173 7320 3d20 7778 2e54 6578  it_pass = wx.Tex
+000786a0: 7443 7472 6c28 7365 6c66 2c20 7369 7a65  tCtrl(self, size
+000786b0: 3d28 3230 302c 202d 3129 2c20 7374 796c  =(200, -1), styl
+000786c0: 653d 7778 2e54 455f 5041 5353 574f 5244  e=wx.TE_PASSWORD
+000786d0: 2c20 6e61 6d65 3d22 7061 7373 2229 0d0a  , name="pass")..
+000786e0: 0d0a 2020 2020 2020 2020 7365 6c66 2e53  ..        self.S
+000786f0: 697a 6572 203d 2077 782e 426f 7853 697a  izer = wx.BoxSiz
+00078700: 6572 2877 782e 5645 5254 4943 414c 290d  er(wx.VERTICAL).
+00078710: 0a20 2020 2020 2020 2073 697a 6572 5f63  .        sizer_c
+00078720: 7472 6c73 203d 2077 782e 466c 6578 4772  trls = wx.FlexGr
+00078730: 6964 5369 7a65 7228 636f 6c73 3d32 2c20  idSizer(cols=2, 
+00078740: 7667 6170 3d33 2c20 6867 6170 3d31 3029  vgap=3, hgap=10)
+00078750: 0d0a 2020 2020 2020 2020 7369 7a65 725f  ..        sizer_
+00078760: 6275 7474 6f6e 7320 3d20 7365 6c66 2e43  buttons = self.C
+00078770: 7265 6174 6542 7574 746f 6e53 697a 6572  reateButtonSizer
+00078780: 2877 782e 4f4b 207c 2077 782e 4341 4e43  (wx.OK | wx.CANC
+00078790: 454c 290d 0a20 2020 2020 2020 2073 697a  EL)..        siz
+000787a0: 6572 5f63 7472 6c73 2e41 6464 286c 6162  er_ctrls.Add(lab
+000787b0: 656c 5f6e 616d 652c 2066 6c61 673d 7778  el_name, flag=wx
+000787c0: 2e41 4c49 474e 5f43 454e 5445 525f 5645  .ALIGN_CENTER_VE
+000787d0: 5254 4943 414c 290d 0a20 2020 2020 2020  RTICAL)..       
+000787e0: 2073 697a 6572 5f63 7472 6c73 2e41 6464   sizer_ctrls.Add
+000787f0: 2865 6469 745f 6e61 6d65 2c20 666c 6167  (edit_name, flag
+00078800: 3d77 782e 4752 4f57 290d 0a20 2020 2020  =wx.GROW)..     
+00078810: 2020 2073 697a 6572 5f63 7472 6c73 2e41     sizer_ctrls.A
+00078820: 6464 286c 6162 656c 5f70 6173 732c 2066  dd(label_pass, f
+00078830: 6c61 673d 7778 2e41 4c49 474e 5f43 454e  lag=wx.ALIGN_CEN
+00078840: 5445 525f 5645 5254 4943 414c 290d 0a20  TER_VERTICAL).. 
+00078850: 2020 2020 2020 2073 697a 6572 5f63 7472         sizer_ctr
+00078860: 6c73 2e41 6464 2865 6469 745f 7061 7373  ls.Add(edit_pass
+00078870: 2c20 666c 6167 3d77 782e 4752 4f57 290d  , flag=wx.GROW).
+00078880: 0a20 2020 2020 2020 2073 656c 662e 5369  .        self.Si
+00078890: 7a65 722e 4164 6428 7369 7a65 725f 6374  zer.Add(sizer_ct
+000788a0: 726c 732c 2020 2062 6f72 6465 723d 382c  rls,   border=8,
+000788b0: 2070 726f 706f 7274 696f 6e3d 312c 2066   proportion=1, f
+000788c0: 6c61 673d 7778 2e41 4c4c 207c 2077 782e  lag=wx.ALL | wx.
+000788d0: 4752 4f57 290d 0a20 2020 2020 2020 2073  GROW)..        s
+000788e0: 656c 662e 5369 7a65 722e 4164 6428 7369  elf.Sizer.Add(si
+000788f0: 7a65 725f 6275 7474 6f6e 732c 2062 6f72  zer_buttons, bor
+00078900: 6465 723d 382c 2066 6c61 673d 7778 2e41  der=8, flag=wx.A
+00078910: 4c49 474e 5f43 454e 5445 525f 484f 5249  LIGN_CENTER_HORI
+00078920: 5a4f 4e54 414c 207c 2077 782e 414c 4c29  ZONTAL | wx.ALL)
+00078930: 0d0a 2020 2020 2020 2020 7365 6c66 2e4c  ..        self.L
+00078940: 6179 6f75 7428 290d 0a20 2020 2020 2020  ayout()..       
+00078950: 2073 656c 662e 4669 7428 290d 0a20 2020   self.Fit()..   
+00078960: 2020 2020 2073 656c 662e 4365 6e74 6572       self.Center
+00078970: 4f6e 5061 7265 6e74 2829 0d0a 2020 2020  OnParent()..    
+00078980: 2020 2020 7365 6c66 2e55 7064 6174 6541      self.UpdateA
+00078990: 6363 656c 6572 6174 6f72 7328 290d 0a20  ccelerators().. 
+000789a0: 2020 2020 2020 2065 6469 745f 6e61 6d65         edit_name
+000789b0: 2e53 6574 466f 6375 7328 290d 0a0d 0a0d  .SetFocus().....
+000789c0: 0a20 2020 2064 6566 2047 6574 5573 6572  .    def GetUser
+000789d0: 6e61 6d65 2873 656c 6629 3a0d 0a20 2020  name(self):..   
+000789e0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+000789f0: 2e65 6469 745f 6e61 6d65 2e56 616c 7565  .edit_name.Value
+00078a00: 2e73 7472 6970 2829 0d0a 2020 2020 5573  .strip()..    Us
+00078a10: 6572 6e61 6d65 203d 2070 726f 7065 7274  ername = propert
+00078a20: 7928 4765 7455 7365 726e 616d 6529 0d0a  y(GetUsername)..
+00078a30: 0d0a 0d0a 2020 2020 6465 6620 4765 7450  ....    def GetP
+00078a40: 6173 7377 6f72 6428 7365 6c66 293a 0d0a  assword(self):..
+00078a50: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00078a60: 656c 662e 6564 6974 5f70 6173 732e 5661  elf.edit_pass.Va
+00078a70: 6c75 652e 7374 7269 7028 290d 0a20 2020  lue.strip()..   
+00078a80: 2050 6173 7377 6f72 6420 3d20 7072 6f70   Password = prop
+00078a90: 6572 7479 2847 6574 5061 7373 776f 7264  erty(GetPassword
+00078aa0: 290d 0a0d 0a0d 0a64 6566 2063 6865 636b  )......def check
+00078ab0: 5f6d 6564 6961 5f65 7870 6f72 745f 6c6f  _media_export_lo
+00078ac0: 6769 6e28 6462 293a 0d0a 2020 2020 2222  gin(db):..    ""
+00078ad0: 220d 0a20 2020 2052 6574 7572 6e73 2077  "..    Returns w
+00078ae0: 6865 7468 6572 2064 6220 6361 6e20 6c6f  hether db can lo
+00078af0: 6769 6e20 746f 2064 6f77 6e6c 6f61 6420  gin to download 
+00078b00: 7368 6172 6564 2066 696c 6573 2074 6f20  shared files to 
+00078b10: 7375 6266 6f6c 6465 7220 666f 7220 6578  subfolder for ex
+00078b20: 706f 7274 0d0a 2020 2020 6f72 2077 6865  port..    or whe
+00078b30: 7468 6572 2075 7365 7220 636f 6e66 6972  ther user confir
+00078b40: 6d73 2074 6f20 7072 6f63 6565 6420 7769  ms to proceed wi
+00078b50: 7468 6f75 7420 6c6f 6769 6e20 696e 666f  thout login info
+00078b60: 726d 6174 696f 6e2e 0d0a 2020 2020 2222  rmation...    ""
+00078b70: 220d 0a20 2020 2069 6620 2863 6f6e 662e  "..    if (conf.
+00078b80: 5368 6172 6564 496d 6167 6541 7574 6f44  SharedImageAutoD
+00078b90: 6f77 6e6c 6f61 6420 6f72 2063 6f6e 662e  ownload or conf.
+00078ba0: 5368 6172 6564 4175 6469 6f56 6964 656f  SharedAudioVideo
+00078bb0: 4175 746f 446f 776e 6c6f 6164 0d0a 2020  AutoDownload..  
+00078bc0: 2020 2020 2020 6f72 2063 6f6e 662e 5368        or conf.Sh
+00078bd0: 6172 6564 4669 6c65 4175 746f 446f 776e  aredFileAutoDown
+00078be0: 6c6f 6164 2920 5c0d 0a20 2020 2061 6e64  load) \..    and
+00078bf0: 206e 6f74 2064 622e 6c69 7665 2e69 735f   not db.live.is_
+00078c00: 6c6f 6767 6564 5f69 6e28 2920 5c0d 0a20  logged_in() \.. 
+00078c10: 2020 2061 6e64 206e 6f74 2063 6f6e 662e     and not conf.
+00078c20: 4c6f 6769 6e2e 6765 7428 6462 2e66 696c  Login.get(db.fil
+00078c30: 656e 616d 652c 207b 7d29 2e67 6574 2822  ename, {}).get("
+00078c40: 7061 7373 776f 7264 2229 2061 6e64 2077  password") and w
+00078c50: 782e 4f4b 2021 3d20 7778 2e4d 6573 7361  x.OK != wx.Messa
+00078c60: 6765 426f 7828 0d0a 2020 2020 2020 2020  geBox(..        
+00078c70: 2259 6f75 2068 6176 6520 7365 6c65 6374  "You have select
+00078c80: 6564 2074 6f20 6578 706f 7274 2048 544d  ed to export HTM
+00078c90: 4c20 7769 7468 2073 6861 7265 6420 6669  L with shared fi
+00078ca0: 6c65 7320 696e 2073 7562 666f 6c64 6572  les in subfolder
+00078cb0: 2c20 220d 0a20 2020 2020 2020 2022 6275  , "..        "bu
+00078cc0: 7420 7468 6520 6461 7461 6261 7365 2064  t the database d
+00078cd0: 6f65 7320 6e6f 7420 6861 7665 206c 6f67  oes not have log
+00078ce0: 696e 2069 6e66 6f72 6d61 7469 6f6e 2022  in information "
+00078cf0: 0d0a 2020 2020 2020 2020 2266 6f72 2064  ..        "for d
+00078d00: 6f77 6e6c 6f61 6469 6e67 206d 6564 6961  ownloading media
+00078d10: 2e5c 6e5c 6e41 7265 2079 6f75 2073 7572  .\n\nAre you sur
+00078d20: 6520 796f 7520 7761 6e74 2074 6f20 636f  e you want to co
+00078d30: 6e74 696e 7565 3f22 2c0d 0a20 2020 2020  ntinue?",..     
+00078d40: 2020 2063 6f6e 662e 5469 746c 652c 2077     conf.Title, w
+00078d50: 782e 4f4b 207c 2077 782e 4341 4e43 454c  x.OK | wx.CANCEL
+00078d60: 207c 2077 782e 4943 4f4e 5f49 4e46 4f52   | wx.ICON_INFOR
+00078d70: 4d41 5449 4f4e 0d0a 2020 2020 293a 2072  MATION..    ): r
+00078d80: 6574 7572 6e20 4661 6c73 650d 0a20 2020  eturn False..   
+00078d90: 2072 6574 7572 6e20 5472 7565 0d0a 0d0a   return True....
+00078da0: 0d0a 6465 6620 6d65 7373 6167 6542 6f78  ..def messageBox
+00078db0: 286d 6573 7361 6765 2c20 7469 746c 652c  (message, title,
+00078dc0: 2073 7479 6c65 293a 0d0a 2020 2020 2222   style):..    ""
+00078dd0: 220d 0a20 2020 2053 686f 7773 2061 206e  "..    Shows a n
+00078de0: 6f6e 2d6e 6174 6976 6520 6d65 7373 6167  on-native messag
+00078df0: 6520 626f 782c 2077 6974 6820 6e6f 2062  e box, with no b
+00078e00: 656c 6c20 736f 756e 6420 666f 7220 616e  ell sound for an
+00078e10: 7920 7374 796c 652c 2072 6574 7572 6e69  y style, returni
+00078e20: 6e67 0d0a 2020 2020 7468 6520 6d65 7373  ng..    the mess
+00078e30: 6167 6520 626f 7820 7265 7375 6c74 2063  age box result c
+00078e40: 6f64 652e 2222 220d 0a20 2020 2064 6c67  ode."""..    dlg
+00078e50: 203d 2077 782e 6c69 622e 6167 772e 6765   = wx.lib.agw.ge
+00078e60: 6e65 7269 636d 6573 7361 6765 6469 616c  nericmessagedial
+00078e70: 6f67 2e47 656e 6572 6963 4d65 7373 6167  og.GenericMessag
+00078e80: 6544 6961 6c6f 6728 0d0a 2020 2020 2020  eDialog(..      
+00078e90: 2020 4e6f 6e65 2c20 6d65 7373 6167 652c    None, message,
+00078ea0: 2074 6974 6c65 2c20 7374 796c 650d 0a20   title, style.. 
+00078eb0: 2020 2029 0d0a 2020 2020 7265 7375 6c74     )..    result
+00078ec0: 203d 2064 6c67 2e53 686f 774d 6f64 616c   = dlg.ShowModal
+00078ed0: 2829 0d0a 2020 2020 646c 672e 4465 7374  ()..    dlg.Dest
+00078ee0: 726f 7928 290d 0a20 2020 2072 6574 7572  roy()..    retur
+00078ef0: 6e20 7265 7375 6c74 0d0a                 n result..
```

## skyperious/live.py

```diff
@@ -4,15 +4,15 @@
 
 ------------------------------------------------------------------------------
 This file is part of Skyperious - Skype chat history tool.
 Released under the MIT License.
 
 @author      Erki Suurjaak
 @created     08.07.2020
-@modified    12.10.2022
+@modified    18.07.2023
 ------------------------------------------------------------------------------
 """
 import collections
 import datetime
 import glob
 import json
 import logging
@@ -268,21 +268,26 @@
 
         identity = dbitem["skypename"] if table in ("accounts", "contacts") else \
                    dbitem["identity"]  if "chats" == table else dbitem.get("pk_id")
         dbitem0 = self.cache[table].get(identity)
 
         if "contacts" == table and not dbitem0 \
         and not (identity or "").startswith(skypedata.ID_PREFIX_BOT):
-            # Bot accounts from live are without bot prefix
+            # Bot accounts from live can be without bot prefix
             dbitem0 = self.cache[table].get(skypedata.ID_PREFIX_BOT + identity)
             if dbitem0:
                 identity = skypedata.ID_PREFIX_BOT + identity
                 dbitem["skypename"] = dbitem1["skypename"] = identity
                 dbitem["type"] = dbitem1["type"] = skypedata.CONTACT_TYPE_BOT
 
+        if "contacts" == table and not dbitem0 \
+        and (identity or "").startswith(skypedata.ID_PREFIX_BOT):
+            # Fix bot entries in database not having bot prefix
+            dbitem0 = self.cache[table].get(identity[len(skypedata.ID_PREFIX_BOT):])
+
         if "messages" == table and dbitem.get("remote_id") \
         and not isinstance(item, (skpy.SkypeCallMsg, skpy.SkypeMemberMsg, skpy.msg.SkypePropertyMsg)):
             # Look up message by remote_id instead, to detect edited messages
             dbitem0 = next((v for v in self.cache[table].values()
                             if v.get("remote_id") == dbitem["remote_id"]
                             and v["convo_id"] == dbitem["convo_id"]), dbitem0)
 
@@ -340,14 +345,25 @@
                     dbitem["body_xml"] = dbitem0["body_xml"]
                 dbitem1 = dict(dbitem)
 
             self.db.update_row(dbtable, dbitem, dbitem0, log=False)
             for k, v in dbitem0.items():
                 if k not in dbitem: dbitem[k] = v
             dbitem["__updated__"] = True
+
+            if "contacts" == table and identity.startswith(skypedata.ID_PREFIX_BOT) \
+            and not dbitem0["skypename"].startswith(skypedata.ID_PREFIX_BOT):
+                # Fix bot entries in database not having bot prefix
+                self.db.execute("UPDATE participants SET identity = :id WHERE identity = :id0",
+                                {"id": identity, "id0": dbitem0["skypename"]})
+                self.db.execute("UPDATE transfers SET partner_handle = :id WHERE partner_handle = :id0",
+                                {"id": identity, "id0": dbitem0["skypename"]})
+                self.db.execute("UPDATE messages SET author = :id WHERE author = :id0",
+                                {"id": identity, "id0": dbitem0["skypename"]})
+                dbitem0["skypename"] = identity
         else:
             dbitem["id"] = self.db.insert_row(dbtable, dbitem, log=False)
             dbitem["__inserted__"] = True
             self.sync_counts["%s_new" % table] += 1
             result = self.SAVE.INSERT
 
         if "messages" == table and dbitem1.get("remote_id") is not None \
@@ -418,15 +434,15 @@
             uids = chat.userIds if isinstance(chat, skpy.SkypeGroupChat) \
                    else set([self.skype.userId, chat.userId])
             for uid in uids:
                 user = self.request(self.skype.contacts.__getitem__, uid)
                 uidentity = user.id if user else uid
                 # Keep bot prefixes on bot accounts
                 if uidentity != self.skype.userId and not uidentity.startswith(skypedata.ID_PREFIX_BOT) \
-                and (isinstance(user, skpy.SkypeBotUser) or chat.id.startswith(skypedata.ID_PREFIX_BOT)):
+                and (is_bot(user) or chat.id.startswith(skypedata.ID_PREFIX_BOT)):
                     uidentity = skypedata.ID_PREFIX_BOT + uidentity
                 p = dict(is_permanent=1, convo_id=row["id"], identity=uidentity)
                 if isinstance(chat, skpy.SkypeGroupChat) and (user.id if user else uid) == chat.creatorId:
                     p.update(rank=1)
                 participants.append(p)
 
             existing = set()
@@ -566,43 +582,41 @@
                     # https://api.asm.skype.com/v1/objects/0-weu-d14-abcdef..
                     raw = self.get_api_content(item.picture, category="avatar", cache=False)
                     # main.db has NULL-byte in front of image binary
                     if raw: result.update(meta_picture="\0" + raw.decode("latin1"))
             else: result = None
 
         elif "contacts" == table:
-            result.update(type=skypedata.CONTACT_TYPE_BOT
-                          if isinstance(item, skpy.SkypeBotUser)
+            result.update(type=skypedata.CONTACT_TYPE_BOT if is_bot(item)
                           else skypedata.CONTACT_TYPE_NORMAL,
                           isblocked=getattr(item, "blocked", False),
                           isauthorized=getattr(item, "authorised", False))
             if item.name and item.name.first:
                 result.update(firstname=item.name.first)
             if item.name and item.name.last:
                 result.update(lastname=item.name.last)
             if item.mood:
                 result.update(mood_text=item.mood.plain, rich_mood_text=item.mood.rich)
             if item.avatar:
                 result.update(avatar_url=item.avatar)
-            if isinstance(item, skpy.SkypeBotUser) \
-            and not item.id.startswith(skypedata.ID_PREFIX_BOT):
+            if is_bot(item) and not item.id.startswith(skypedata.ID_PREFIX_BOT):
                 result.update(skypename=skypedata.ID_PREFIX_BOT + item.id)
 
         elif "messages" == table:
 
             ts__ms = util.datetime_to_millis(item.time)
             pk_id, guid = make_message_ids(item.id)
             result.update(is_permanent=1, timestamp=ts__ms // 1000, pk_id=pk_id, guid=guid,
                           author=self.prefixify(item.userId),
                           from_dispname=self.get_contact_name(item.userId),
                           body_xml=item.content, timestamp__ms=ts__ms)
 
             if parent:
                 identity = parent.id if isinstance(parent, skpy.SkypeGroupChat) \
-                           or isinstance(parent.user, skpy.SkypeBotUser) \
+                           or is_bot(parent.user) \
                            or result["author"].startswith(skypedata.ID_PREFIX_BOT) else parent.userId
                 chat = self.cache["chats"].get(identity)
                 if not chat:
                     self.save("chats", parent)
                     chat = self.cache["chats"].get(identity)
                 result.update(convo_id=chat["id"])
             remote_id = item.raw.get("skypeeditedid") or item.clientId
@@ -845,16 +859,15 @@
         @param   chats_processed     state parameter: set of chat identities processed
         @param   chats_updated       state parameter: set of chat identities updated
         @param   chats_completed     state parameter: set of chat identities finished
         @param   messages_processed  state parameter: set of message identities processed
         @return                      whether further progress should continue
         """
         result = True
-        cidentity = chat.id if isinstance(chat, skpy.SkypeGroupChat) \
-                    or isinstance(chat.user, skpy.SkypeBotUser) \
+        cidentity = chat.id if isinstance(chat, skpy.SkypeGroupChat) or is_bot(chat.user) \
                     or chat.id.startswith(skypedata.ID_PREFIX_BOT) else chat.userId
         if chat.id.startswith(skypedata.ID_PREFIX_SPECIAL): # Skip specials like "48:calllogs"
             return result
         if isinstance(chat, skpy.SkypeGroupChat) and not chat.userIds:
             # Weird empty conversation, getMsgs raises 404
             return result
         if isinstance(chat, skpy.SkypeSingleChat) and chat.userId == self.skype.userId:
@@ -993,20 +1006,25 @@
                 return r.content
         except Exception: pass
         return None
 
 
     def get_contact(self, identity):
         """Returns cached contact, if any."""
-        return self.cache["contacts"].get(identity) if identity else None
+        result = self.cache["contacts"].get(identity) if identity else None
+        if not result and identity and not identity.startswith(skypedata.ID_PREFIX_BOT):
+            result = self.cache["contacts"].get(skypedata.ID_PREFIX_BOT + identity)
+        return result
 
 
     def get_contact_name(self, identity):
         """Returns contact displayname or fullname or identity."""
         result, contact = None, self.get_contact(identity)
+        if not contact: contact = self.get_contact(identity)
+            
         if contact:
             result = contact.get("displayname") or contact.get("fullname")
         result = result or identity
         return result
 
 
     def prefixify(self, identity):
@@ -1129,14 +1147,15 @@
             util.try_ignore(self.clear_cache)
             self.export_parsed = True
 
 
     def export_parse(self, f, progress=None):
         """Parses JSON data from file pointer and inserts to database."""
         parser = ijson.parse(f)
+        PREFIX_RGX = re.compile(r"^\d+\:")  # Matching and stripping numeric prefix
 
         self.get_tables()
         self.table_objects.setdefault("contacts", {})
         self.table_rows.setdefault("participants", [])
         chat, msg, edited_msgs, skip_chat, skip_msg = {}, {}, {}, False, False
         counts = {"chats": 0, "messages": 0}
         lastcounts = dict(counts)
@@ -1213,16 +1232,17 @@
 
                 elif "conversations.item.id" == prefix:
                     try:
                         # Skip specials like "48:calllogs"
                         skip_chat = value.startswith(skypedata.ID_PREFIX_SPECIAL)
                         chat["identity"] = value
                         chat["type"] = skypedata.CHATS_TYPE_GROUP
-                        if value.startswith(skypedata.ID_PREFIX_SINGLE):
-                            chat["identity"] = value[len(skypedata.ID_PREFIX_SINGLE):]
+                        if not value.startswith(skypedata.ID_PREFIX_GROUP):
+                            if not value.startswith(skypedata.ID_PREFIX_BOT):
+                                chat["identity"] = PREFIX_RGX.sub("", value)
                             chat["type"] = skypedata.CHATS_TYPE_SINGLE
                     except Exception:
                         logger.warning("Error parsing chat identity %r for %s.", value, chat, exc_info=True)
                         skip_chat = True
 
                 elif "conversations.item.displayName" == prefix:
                     if isinstance(value, six.string_types):
@@ -1231,20 +1251,26 @@
                 elif "conversations.item.threadProperties.topic" == prefix:
                     if isinstance(value, six.string_types):
                         chat["meta_topic"] = value
 
                 elif "conversations.item.threadProperties.members" == prefix:
                     if skip_chat: continue # while True
                     try:
-                        for identity in map(id_to_identity, json.loads(value)):
+                        if value is not None or skypedata.CHATS_TYPE_GROUP == chat["type"]:
+                            identities = map(id_to_identity, json.loads(value))
+                        else: identities = [self.id, chat["identity"]]
+                        for identity in identities:
                             if not identity: continue # for identity
                             if identity not in self.table_objects["contacts"] and identity != self.id:
                                 contact = dict(skypename=identity, is_permanent=1)
                                 if identity.startswith(skypedata.ID_PREFIX_BOT):
                                     contact["type"] = skypedata.CONTACT_TYPE_NORMAL
+                                if skypedata.CHATS_TYPE_GROUP != chat["type"] \
+                                and identity == chat["identity"] and chat.get("displayname"):
+                                    contact["displayname"] = chat["displayname"]
                                 contact["id"] = self.insert_row("contacts", contact)
                                 self.table_objects["contacts"][identity] = contact
                             p = dict(is_permanent=1, convo_id=chat["id"], identity=identity)
                             p["id"] = self.insert_row("participants", p, log=False)
                             self.table_rows["participants"].append(p)
                     except Exception:
                         logger.warning("Error parsing chat members from %s for %s.", value, chat, exc_info=True)
@@ -1593,14 +1619,23 @@
         if result.startswith("#"):
             result = "19:%s@p2p.thread.skype" % util.b64encode(result)
         elif not result.endswith("thread.skype") and not re.match(r"^\d+\:", result):
             result = "%s%s" % (skypedata.ID_PREFIX_SINGLE, result)
     return result
 
 
+def is_bot(user):
+    """Returns whether the given skpy.SkypeUser is a bot."""
+    return isinstance(user, skpy.SkypeBotUser) \
+    or (isinstance(user, skpy.SkypeUser) and isinstance(getattr(user, "raw", None), dict)
+        and isinstance(user.raw.get("person_id"), six.string_types)
+        and user.raw["person_id"].startswith(skypedata.ID_PREFIX_BOT)
+    ) # Workaround for skpy bug of presenting bots in some contexts as plain contacts
+
+
 def make_db_path(username):
     """Returns the default database path for username."""
     base = util.safe_filename(username)
     if base != username: base += "_%x" % util.hash_string(username)
     return os.path.join(conf.VarDirectory, "%s.main.db" % base)
```

## skyperious/support.py

```diff
@@ -4,15 +4,15 @@
 
 ------------------------------------------------------------------------------
 This file is part of Skyperious - Skype chat history tool.
 Released under the MIT License.
 
 @author      Erki Suurjaak
 @created     16.04.2013
-@modified    27.03.2022
+@modified    09.01.2023
 ------------------------------------------------------------------------------
 """
 import datetime
 import logging
 import os
 import platform
 import re
@@ -234,19 +234,19 @@
     else:
         result = "x86"
     return result
 
 
 def canonic_version(v):
     """Returns a numeric version representation: "1.3.2a" to 10301,99885."""
-    nums = [int(re.sub("[^\\d]", "", x)) for x in v.split(".")][::-1]
+    nums = [int(re.sub("[^\\d].*$", "", x)) for x in v.split(".") if re.match("^\\d", x)][::-1]
     nums[0:0] = [0] * (3 - len(nums)) # Zero-pad if version like 1.4 or just 2
     # Like 1.4a: subtract 1 and add fractions to last number to make < 1.4
-    if re.findall("\\d+([\\D]+)$", v):
-        ords = [ord(x) for x in re.findall("\\d+([\\D]+)$", v)[0]]
+    if re.findall("[.\\d]([^.\\d][^.]+)$", v):
+        ords = [ord(x) for x in re.findall("[.\\d]([^.\\d][^.]+)$", v)[0]]
         nums[0] += sum(x / (65536. ** (i + 1)) for i, x in enumerate(ords)) - 1
     return sum((x * 100 ** i) for i, x in enumerate(nums))
 
 
 
 class FeedbackDialog(wx_accel.AutoAcceleratorMixIn, wx.Dialog):
     """
```

## skyperious/lib/wx_accel.py

```diff
@@ -8,16 +8,17 @@
 
 Supported controls:
 - wx.Button       click handler called
 - wx.CheckBox     value is reversed, control focused, change handler called
 - wx.TextCtrl     control focused, all text selected
 - wx.RadioButton  control focused, value selected
 - wx.Control      control focused
-- wx.ToolBar      tool event is called, if the tool shorthelp includes a
-                  parseable shortcut key like (Alt-S)
+- wx.ToolBar      tool event is called, if the tool label contains shortcut
+                  or if the tool shorthelp includes a parseable shortcut key
+                  like "(Alt-S)"
 - wx.ToggleButton ToggleButton handler called
 
 Uses primitive heuristic analysis to detect connected label-control pairs:
 - wx.StaticTexts whose next sibling is a focusable control
 - wx.StaticTexts that have an Id one less from a focusable control (created
   immediately before creating the control)
 - wx.StaticTexts that have the same Name as a control with "label" appended or
@@ -26,15 +27,15 @@
 
 ------------------------------------------------------------------------------
 This file is part of Skyperious - Skype chat history tool.
 Released under the MIT License.
 
 @author      Erki Suurjaak
 @created     19.11.2011
-@modified    26.03.2022
+@modified    18.07.2023
 ------------------------------------------------------------------------------
 """
 import functools
 import re
 
 import wx
 
@@ -83,14 +84,50 @@
         if not hasattr(self, "__shortcuts"):
             self.__shortcuts = None # {shortcut char: target control, }
         self.__use_heuristics = use_heuristics
         self.__shortcuts = accelerate(self, self.__use_heuristics)
 
 
 
+def parse_label(text):
+    """Returns first suitable ampersanded shortcut key from text, in lowercase, or None."""
+    for part in filter(len, text.split("&")[1:]):
+        key = part[0].lower() # Find usable ampersand, preceding a valid character
+        if key > " ": return key
+    return None
+
+
+def parse_shortcuts(ctrl):
+    """
+    Parses the shortcut keys from the control label, if any.
+    If wx.ToolBar, parses tool labels, and shorthelps for explicit shortcut texts.
+
+    @return    {key: control or toolbar tool ID}
+    """
+    result = {}
+    if isinstance(ctrl, wx.ToolBar):
+        for i in range(ctrl.GetToolsCount()):
+            tool = ctrl.GetToolByPos(i)
+            if not tool: continue  # for i
+            key = parse_label(tool.Label)
+            if key:
+                result.setdefault(key, tool.Id)
+                if DEBUG: print("Parsed '%s' in tool label '%s'." % (key, tool.Label))
+            parts = re.split("\\(Alt-(.)\\)", tool.ShortHelp, maxsplit=1)
+            if len(parts) > 1:
+                result.setdefault(parts[1].lower(), tool.Id)
+    # wx.TextCtrl.Label is the same as its value, so must not use that
+    elif hasattr(ctrl, "Label") and not isinstance(ctrl, wx.TextCtrl):
+        key = parse_label(ctrl.Label)
+        if key:
+            result[key] = ctrl.Id
+            if DEBUG: print("Parsed '%s' in label '%s'." % (key, ctrl.Label))
+    return result
+
+
 def collect_shortcuts(control, use_heuristics=True):
     """
     Returns a map of detected shortcut keys and target controls under the
     specified control.
 
     @param   control         the control to start from
     @param   use_heuristics  whether to use heuristic analysis to detect
@@ -101,58 +138,28 @@
                              e.g. controls on different pages of a Notebook)
     """
 
     result  = {} # {char: [(control), (control, statictext), ], }
     nameds  = {} # collected controls with Name {name: control, }
     statics = {} # collected StaticTexts with a shortcut {control: char, }
 
-    def parse_shortcuts(ctrl):
-        """
-        Parses the shortcut keys from the control label, if any.
-
-        @return    [keys]
-        """
-        result = []
-        # wx.TextCtrl.Label is the same as its value, so must not use that
-        if isinstance(ctrl, wx.ToolBar):
-            for i in range(ctrl.GetToolsCount()):
-                tool = ctrl.GetToolByPos(i)
-                if not tool: continue  # for i
-                text = ctrl.GetToolShortHelp(tool.GetId())
-                parts = re.split("\\(Alt-(.)\\)", text, maxsplit=1)
-                if len(parts) > 1:
-                    result.append(parts[1].lower())
-        elif hasattr(ctrl, "Label") and not isinstance(ctrl, wx.TextCtrl):
-            for part in filter(len, ctrl.Label.split("&")[1:]):
-                # Labels have potentially multiple ampersands - find one that
-                # is usable (preceding a valid character. 32 and lower are
-                # spaces, punctuation, control characters, etc).
-                key = part[0].lower()
-                if ord(key) > 32:
-                    result.append(key)
-                    if DEBUG and key:
-                        print("Parsed '%s' in label '%s'." % (key, ctrl.Label))
-                    break # for part
-        return result
-
 
     def collect_recurse(ctrl, result, nameds, statics):
         """
         Goes through the control and all its children and collects accelerated
         controls.
 
         @return    {key: control, }
         """
         if hasattr(ctrl, "GetChildren"):
             children = ctrl.GetChildren()
             for i in range(len(children)):
                 collect_recurse(children[i], result, nameds, statics)
 
-        keys = parse_shortcuts(ctrl)
-        for key in keys:
+        for key in parse_shortcuts(ctrl):
             if isinstance(ctrl, wx.StaticText):
                 statics[ctrl] = key
             else:
                 if key not in result:
                     result[key] = []
                 if ctrl not in result[key]:
                     result[key].append((ctrl, ))
@@ -226,32 +233,30 @@
         basename = strip_rgx.sub("", name).lower()
         if basename == name or not isinstance(ctrl, wx.StaticText):
             continue # for name, ctrl
         target = nameds_lc.get(basename)
         if not target:
             continue # for name, ctrl
 
-        key = (parse_shortcuts(ctrl) + [""]).pop(0)
+        key = next(iter(parse_shortcuts(ctrl)), "")
         if DEBUG:
-            print("Name %s matches potential %s, key=%s." % (
-                  name, basename, key))
+            print("Name %s matches potential %s, key=%s." % (name, basename, key))
         if target not in result_values:
             if target not in result.get(key, []):
                 result.setdefault(key, []).append((target, ctrl))
             result_values.add(target)
             if DEBUG:
                 print("Selected '%s' by named StaticText '%s' "
                       "(%s.ID=%s, %s.Name=%s, wxStaticText.Name=%s)." %
                       (key, ctrl.Label, target.ClassName, target.ClassName,
                        target.Id, target.Name, ctrl.Name))
 
     return result
 
 
-
 def accelerate(window, use_heuristics=True, skipclicklabels=None, accelerators=None):
     """
     Assigns global keyboard shortcuts to all controls under the specified
     wx.Window that have a shortcut key defined in their label (e.g. a button
     labeled "E&xit" gets assigned the shortcut Alt-X). Resets previously
     set accelerators, if any.
 
@@ -276,16 +281,15 @@
         @param   targets         list of target controls. If there is more than
                                  one target control, the first non-disabled
                                  and visible is chosen.
         @param   key             the event shortcut key, like 's'
         @param   shortcut_event  menu event generated by the accelerator table
         """
         if DEBUG:
-            print("Handling target %s" %
-                  [(type(t), t.Id, t.Label) for t in targets])
+            print("Handling target %s" % [(type(t), t.Id, t.Label) for t in targets])
         event, target = None, None
         for target in targets:
             if not target or not isinstance(target, wx.Control) \
             or not target.IsShownOnScreen() or not target.Enabled:
                 continue # for target
 
             if isinstance(target, wx.Button):
@@ -304,31 +308,22 @@
                 event.SetEventObject(target)
                 # Need to change value, as event goes directly to handler
                 if target.Is3State():
                     target.Set3StateValue(CHK_3STATE_NEXT[target.Get3StateValue()])
                 else: target.Value = not target.Value
                 target.SetFocus()
             elif isinstance(target, wx.ToolBar):
-                # Toolbar shortcuts are defined in their shorthelp texts
-                toolsmap, tb = dict(), target
-                for i in range(tb.GetToolsCount() + 1):
-                    try:
-                        tool = tb.FindToolForPosition(i * tb.ToolSize[0], 0)
-                        toolsmap[repr(tool)] = tool
-                    except Exception: pass # FindTool not implemented in GTK
-                for tool in filter(bool, toolsmap.values()):
-                    id = tool.GetId()
-                    text = tb.GetToolShortHelp(id)
-                    parts = re.split("\\(Alt-(%s)\\)" % key, text,
-                                     maxsplit=1, flags=re.IGNORECASE)
-                    if len(parts) > 1:
-                        event = wx.CommandEvent(wx.EVT_TOOL.typeId, id)
-                        event.SetEventObject(target)
-                        target.ToggleTool(id, not target.GetToolState(id))
-                        break # for tool
+                # Toolbar shortcuts are defined in tool labels and shorthelp texts
+                id_tool = parse_shortcuts(target).get(key)
+                if id_tool:
+                    event = wx.CommandEvent(wx.EVT_TOOL.typeId, id_tool)
+                    event.SetEventObject(target)
+                    event.SetInt(not target.GetToolState(id_tool))
+                    target.ToggleTool(id_tool, not target.GetToolState(id_tool))
+                    break # for tool
             else:
                 target.SetFocus()
                 if isinstance(target, wx.TextCtrl):
                     target.SelectAll()
             break # for target
         if event:
             if DEBUG: print("Chose target %s." % (target.Label or target))
@@ -352,16 +347,15 @@
                 if label in skipclicklabels: continue # for ctrl, label
                 if DEBUG:
                     print("Binding click from label %s to %s." % (label, ctrl))
                 label.Bind(wx.EVT_LEFT_UP, functools.partial(eventhandler, [ctrl], ""))
                 skipclicklabels.add(label)
             if not key: continue # for key, targets
             ctrls = [t[0] for t in targets]
-            if DEBUG: print("Binding %s to targets %s." %
-                            (key, [type(t) for t in ctrls]))
+            if DEBUG: print("Binding %s to targets %s." % (key, [type(t) for t in ctrls]))
             menu_item = dummy_menu.Append(wx.ID_ANY, "&%s" % key)
             window.Bind(wx.EVT_MENU, functools.partial(eventhandler, ctrls, key),
                         menu_item)
             accelerators.append((wx.ACCEL_ALT, ord(key), menu_item.Id))
         window.SetAcceleratorTable(wx.AcceleratorTable(accelerators))
         window.__ampersand_shortcut_menu = dummy_menu
     return accelerators, shortcuts
```

## Comparing `skyperious-5.4.1.dist-info/LICENSE.md` & `skyperious-5.5.dist-info/LICENSE.md`

 * *Files identical despite different names*

## Comparing `skyperious-5.4.1.dist-info/METADATA` & `skyperious-5.5.dist-info/METADATA`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: skyperious
-Version: 5.4.1
+Version: 5.5
 Summary: Skype chat history tool
 Home-page: https://github.com/suurjaak/Skyperious
 Author: Erki Suurjaak
 Author-email: erki@lap.ee
 License: MIT
 Keywords: skype sqlite merge export
 Platform: any
@@ -18,14 +18,15 @@
 Classifier: Topic :: Desktop Environment
 Classifier: Topic :: Utilities
 Classifier: License :: OSI Approved :: MIT License
 Classifier: Programming Language :: Python :: 2
 Classifier: Programming Language :: Python :: 2.7
 Classifier: Programming Language :: Python :: 3
 Description-Content-Type: text/markdown
+License-File: LICENSE.md
 Requires-Dist: appdirs
 Requires-Dist: beautifulsoup4
 Requires-Dist: ijson
 Requires-Dist: pyparsing
 Requires-Dist: Pillow
 Requires-Dist: six
 Requires-Dist: SkPy
@@ -101,17 +102,16 @@
 Skyperious can log into Skype online service and download and save new messages
 into the local database file. It can also create a new `main.db` database from
 scratch, by downloading all available history.
 
 Skyperious can read chat history archives exported from Skype, and merge their
 contents into an existing database, or create a new database from their contents.
 
-(Skype export is available in Skype client v8.5 under
- Settings -> Messaging -> Export chat history from Skype 7.x;
- and in Skype web interface under My account -> Export files and chat history.
+(Skype export is available in Skype web interface under 
+ My account -> Export files and chat history.
  The result is a `.tar` archive containing a `messages.json` file.)
 
 HTML export can download shared photos and embed them in the resulting HTML,
 if password for the Skype account has been entered in online-page.
 This can be disabled in File -> Advanced Options -> SharedImageAutoDownload.
 Image download is also supported in the command-line interface.
 
@@ -230,9 +230,7 @@
 
 License
 -------
 
 Copyright (c) by Erki Suurjaak.
 Released as free open source software under the MIT License,
 see [LICENSE.md](https://github.com/suurjaak/Skyperious/blob/master/LICENSE.md) for full details.
-
-
```

## Comparing `skyperious-5.4.1.dist-info/RECORD` & `skyperious-5.5.dist-info/RECORD`

 * *Files 14% similar despite different names*

```diff
@@ -1,32 +1,32 @@
 skyperious/__init__.py,sha256=mgWnKo3Y6AQUI6FMaFYghlhhUEWw_8O4e-aF8bs1uvk,76
 skyperious/__main__.py,sha256=dLLEHzSyAMiFo7-zsAQhqzR2nvoiC23WKBBUCuuHl_4,94
-skyperious/conf.py,sha256=lrUSp_dSKnUR5bF4T6VTo7emCFvTAXLYUr-szVY8sjI,17002
+skyperious/conf.py,sha256=pKCtgCVYgR2NC8veTdK6aNiuXUyvPtR1cI287mCamMQ,17124
 skyperious/emoticons.py,sha256=_qIj0roS_l_Rmp6B9hdh0Sf8uk_C20fBuekNz0xebgE,91712
-skyperious/export.py,sha256=EXVmqnoR5QWSxgNUMPCuywDwC4aao4ULDdAy1TvKfv8,31739
-skyperious/gui.py,sha256=FM0UOt1vyGTIE4hnbqrh8Qv5hDRDn2kNQOUG2KIc7Qs,494860
+skyperious/export.py,sha256=IYhioEpScTDGv0J4LKelTL3C8utLMU3IbssgJIZENaA,32002
+skyperious/gui.py,sha256=kSxZN-RX7KZlW08w55iAqpRRuoI1_fycuK6K3bHZaBo,495354
 skyperious/guibase.py,sha256=EMbEDjd6SED-mpkXpaR5Qx612wnlecOVonZoT2Yu378,12401
 skyperious/images.py,sha256=kLbVTq_k12kTzx9VcdotwYLWEnQDdYsez8yyHnJEyHk,186899
-skyperious/live.py,sha256=1s7-FcH1joNYwwaalGzCgQ48Fgbw8tye0LYhj2ySgMc,86498
+skyperious/live.py,sha256=CssFzlV7xRa8xfMlosdg0OibYlwpj_r6DwK7jFcKf00,88736
 skyperious/main.py,sha256=LUR7ET7S65IDAW7ds6diT_OzvSZ1ciJawu0VwsASB2Q,67173
 skyperious/searchparser.py,sha256=CsbqrKTFvo77PQR3z5JFzFo50QzCHIgBO2IuWi3nVHs,19373
 skyperious/skypedata.py,sha256=auQAf8qhbHaKPyyaRX24sDFf-hOQlrMvfv6h0WrYLQM,178820
 skyperious/skyperious.ini,sha256=Pm4bRaVz3pZxmYEa93zwpEPHcL6uuA1OmZ40tmGPtC0,533
-skyperious/support.py,sha256=WK-sY2xKBYm5l48x2-hzClxS3707pz2xKnsnVWLh0yI,18792
+skyperious/support.py,sha256=mXtFwMDmXVygGO6jigIeaFLwcJkuhV0LRDybtkW7F4M,18834
 skyperious/templates.py,sha256=OJ93I8Hufo_N2dNuOFNWPAEE16ruad6INy4z1LdyGsc,155393
 skyperious/workers.py,sha256=9CI9SW9ppqopS3y9eJvSfr8tnRu74v9L5G0LL2cSGbE,43196
 skyperious/lib/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 skyperious/lib/controls.py,sha256=ZH2jqqHQjX0OM-F7VSv1Fp0F08rU782HJBSuJPCzFps,211677
 skyperious/lib/util.py,sha256=ooSmFt8bXkVHUDO_KtQafseGvlL46IHYMT1WeCSVYVg,27613
 skyperious/lib/wordcloud.py,sha256=wCbZh-RQxDDptTVRtff-SnDg7Khd50VBqrXvTLzK7po,16676
-skyperious/lib/wx_accel.py,sha256=z3VTvGhl7iWpKu4Poz-iVvLOTVx2oC0bhrWT11AxUv4,17033
+skyperious/lib/wx_accel.py,sha256=qAmwsihmHyr0rBBDHu_iKU8VXeXLNYGEeIIyQyi1Su4,16629
 skyperious/lib/vendor/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 skyperious/lib/vendor/step.py,sha256=gII2XSFghfMkHENPGqUCCsnSoWAyjecDyMydgf6k-a8,7639
 skyperious/res/Carlito.ttf,sha256=tP8jujcMyVo8NJM2tz-cKFFKE3EhD4mDLvyFxLHqcTE,635996
 skyperious/res/CarlitoBold.ttf,sha256=D2KrNK1dB5oKKPrAG898enJKTbTWy5nKucq_84L7uA8,690516
 skyperious/res/emoticons.zip,sha256=g6pDIm3xgRgMYgFrsavNVtgYJcaXOyuL6fwYogMmADQ,3696407
-skyperious-5.4.1.dist-info/LICENSE.md,sha256=8aobp-pJz5ACZbwUo0bP1BPDk_w3iQa2AYjVvf6JAmI,13002
-skyperious-5.4.1.dist-info/METADATA,sha256=m1HMd8bE2btKUyymizw8glaI7xizPLodFVnqAC9NOtY,9651
-skyperious-5.4.1.dist-info/WHEEL,sha256=6T3TYZE4YFi2HTS1BeZHNXAi8N52OZT4O-dJ6-ome_4,116
-skyperious-5.4.1.dist-info/entry_points.txt,sha256=ipNvsuFtnnGtir-kJdwBv0owCBZQUxhtCn4VKBd2RKA,48
-skyperious-5.4.1.dist-info/top_level.txt,sha256=N2MKQgj4-6zFNlAttgS0DF7PhqO1PtVzJ6KVc8xb2vs,11
-skyperious-5.4.1.dist-info/RECORD,,
+skyperious-5.5.dist-info/LICENSE.md,sha256=8aobp-pJz5ACZbwUo0bP1BPDk_w3iQa2AYjVvf6JAmI,13002
+skyperious-5.5.dist-info/METADATA,sha256=9IKyi0j-meUIw1deEH_S8UuWVBCCT8QVvFJlRu_xSL4,9578
+skyperious-5.5.dist-info/WHEEL,sha256=a-zpFRIJzOq5QfuhBzbhiA1eHTzNCJn8OdRvhdNX0Rk,110
+skyperious-5.5.dist-info/entry_points.txt,sha256=LRLlEJXYEkSTRSbLF21h9EDTb-IOz6nHOe4krgeYIHs,47
+skyperious-5.5.dist-info/top_level.txt,sha256=N2MKQgj4-6zFNlAttgS0DF7PhqO1PtVzJ6KVc8xb2vs,11
+skyperious-5.5.dist-info/RECORD,,
```

