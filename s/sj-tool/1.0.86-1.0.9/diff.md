# Comparing `tmp/sj_tool-1.0.86-py3-none-any.whl.zip` & `tmp/sj_tool-1.0.9-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,48 +1,32 @@
-Zip file size: 38888 bytes, number of entries: 46
+Zip file size: 13444 bytes, number of entries: 30
 -rw-rw-rw-  2.0 fat        0 b- defN 23-Mar-14 09:37 sj_tool/__init__.py
 -rw-rw-rw-  2.0 fat      226 b- defN 23-Apr-10 10:09 sj_tool/decorator.py
 -rw-rw-rw-  2.0 fat      476 b- defN 23-Apr-01 13:00 sj_tool/email.py
--rw-rw-rw-  2.0 fat     1164 b- defN 23-Jul-10 03:40 sj_tool/file.py
--rw-rw-rw-  2.0 fat      484 b- defN 23-May-19 02:07 sj_tool/http_util.py
+-rw-rw-rw-  2.0 fat      476 b- defN 23-Apr-01 13:00 sj_tool/email_sender.py
+-rw-rw-rw-  2.0 fat      155 b- defN 23-Mar-14 09:42 sj_tool/file.py
 -rw-rw-rw-  2.0 fat      313 b- defN 23-Apr-04 05:43 sj_tool/json.py
--rw-rw-rw-  2.0 fat      313 b- defN 23-May-19 02:07 sj_tool/json_util.py
 -rw-rw-rw-  2.0 fat      273 b- defN 23-Apr-23 03:10 sj_tool/language.py
 -rw-rw-rw-  2.0 fat      335 b- defN 23-Apr-14 09:33 sj_tool/parallel.py
--rw-rw-rw-  2.0 fat      440 b- defN 23-Jul-10 03:37 sj_tool/parallel_util.py
 -rw-rw-rw-  2.0 fat     2180 b- defN 23-Apr-10 10:28 sj_tool/scheduler.py
 -rw-rw-rw-  2.0 fat      245 b- defN 23-Apr-04 05:43 sj_tool/system.py
--rw-rw-rw-  2.0 fat     1348 b- defN 23-Jul-13 03:22 sj_tool/util.py
+-rw-rw-rw-  2.0 fat     1002 b- defN 23-Apr-10 10:05 sj_tool/util.py
 -rw-rw-rw-  2.0 fat        0 b- defN 23-Mar-14 09:40 sj_tool/db/__init__.py
--rw-rw-rw-  2.0 fat     5082 b- defN 23-Jul-13 03:22 sj_tool/db/mongo.py
--rw-rw-rw-  2.0 fat     4899 b- defN 23-May-04 13:39 sj_tool/db/mongo_util.py
--rw-rw-rw-  2.0 fat     1519 b- defN 23-May-04 09:09 sj_tool/db/mysql.py
--rw-rw-rw-  2.0 fat     2664 b- defN 23-Jul-12 03:30 sj_tool/db/sql_util.py
+-rw-rw-rw-  2.0 fat     5626 b- defN 23-Apr-08 09:02 sj_tool/db/mongo.py
+-rw-rw-rw-  2.0 fat     1237 b- defN 23-Apr-08 08:39 sj_tool/db/mysql.py
 -rw-rw-rw-  2.0 fat        0 b- defN 23-Mar-27 08:29 sj_tool/fjsp/__init__.py
--rw-rw-rw-  2.0 fat    13712 b- defN 23-Jul-12 05:38 sj_tool/fjsp/builder.py
--rw-rw-rw-  2.0 fat     3448 b- defN 23-May-31 03:59 sj_tool/fjsp/check.py
--rw-rw-rw-  2.0 fat     3951 b- defN 23-Jul-17 07:59 sj_tool/fjsp/result_generator.py
--rw-rw-rw-  2.0 fat    13233 b- defN 23-Jul-10 03:37 sj_tool/fjsp/time_util.py
 -rw-rw-rw-  2.0 fat        0 b- defN 23-Mar-27 08:30 sj_tool/fjsp/entity/__init__.py
--rw-rw-rw-  2.0 fat      818 b- defN 23-May-19 03:34 sj_tool/fjsp/entity/changeover.py
--rw-rw-rw-  2.0 fat     1225 b- defN 23-May-19 03:47 sj_tool/fjsp/entity/fjsp_pool.py
--rw-rw-rw-  2.0 fat      966 b- defN 23-May-30 08:33 sj_tool/fjsp/entity/job.py
--rw-rw-rw-  2.0 fat     1868 b- defN 23-Jul-13 03:19 sj_tool/fjsp/entity/machine.py
--rw-rw-rw-  2.0 fat     1494 b- defN 23-Jul-10 03:37 sj_tool/fjsp/entity/operation.py
--rw-rw-rw-  2.0 fat      139 b- defN 23-May-19 03:05 sj_tool/fjsp/entity/order.py
--rw-rw-rw-  2.0 fat      202 b- defN 23-May-19 02:07 sj_tool/fjsp/entity/process.py
--rw-rw-rw-  2.0 fat      515 b- defN 23-May-19 02:07 sj_tool/fjsp/entity/product.py
--rw-rw-rw-  2.0 fat      373 b- defN 23-May-19 02:07 sj_tool/fjsp/entity/standing_time.py
--rw-rw-rw-  2.0 fat      156 b- defN 23-Jun-15 11:17 sj_tool/fjsp/erp_next/__init__.py
--rw-rw-rw-  2.0 fat       50 b- defN 23-Jul-05 02:02 sj_tool/fjsp/erp_next/constant.py
--rw-rw-rw-  2.0 fat    31809 b- defN 23-Jul-18 06:26 sj_tool/fjsp/erp_next/data_sync.py
--rw-rw-rw-  2.0 fat     8002 b- defN 23-Jul-18 06:15 sj_tool/fjsp/erp_next/data_write_back.py
--rw-rw-rw-  2.0 fat     3441 b- defN 23-Jul-18 06:02 sj_tool/fjsp/erp_next/util.py
+-rw-rw-rw-  2.0 fat      580 b- defN 23-Apr-15 09:09 sj_tool/fjsp/entity/changeover.py
+-rw-rw-rw-  2.0 fat      897 b- defN 23-Apr-10 09:07 sj_tool/fjsp/entity/fjsp_pool.py
+-rw-rw-rw-  2.0 fat      897 b- defN 23-Apr-10 09:07 sj_tool/fjsp/entity/global_pool.py
+-rw-rw-rw-  2.0 fat      736 b- defN 23-Apr-15 11:54 sj_tool/fjsp/entity/job.py
+-rw-rw-rw-  2.0 fat      411 b- defN 23-Apr-09 05:22 sj_tool/fjsp/entity/machine.py
+-rw-rw-rw-  2.0 fat      829 b- defN 23-Apr-15 11:54 sj_tool/fjsp/entity/operation.py
+-rw-rw-rw-  2.0 fat      113 b- defN 23-Apr-09 09:02 sj_tool/fjsp/entity/product.py
 -rw-rw-rw-  2.0 fat        0 b- defN 23-Mar-30 02:45 sj_tool/logger/__init__.py
--rw-rw-rw-  2.0 fat     1571 b- defN 23-May-19 02:07 sj_tool/logger/logger.py
--rw-rw-rw-  2.0 fat     2231 b- defN 23-Apr-24 15:02 sj_tool/logger/text_logger.py
+-rw-rw-rw-  2.0 fat     2250 b- defN 23-Apr-21 10:38 sj_tool/logger/text_logger.py
 -rw-rw-rw-  2.0 fat     2753 b- defN 23-Apr-19 09:41 sj_tool/logger/visual_logger.py
--rw-rw-rw-  2.0 fat      499 b- defN 23-Jul-18 06:26 sj_tool-1.0.86.dist-info/METADATA
--rw-rw-rw-  2.0 fat       92 b- defN 23-Jul-18 06:26 sj_tool-1.0.86.dist-info/WHEEL
--rw-rw-rw-  2.0 fat        8 b- defN 23-Jul-18 06:26 sj_tool-1.0.86.dist-info/top_level.txt
-?rw-rw-r--  2.0 fat     3721 b- defN 23-Jul-18 06:26 sj_tool-1.0.86.dist-info/RECORD
-46 files, 118238 bytes uncompressed, 32992 bytes compressed:  72.1%
+-rw-rw-rw-  2.0 fat      492 b- defN 23-Apr-23 03:35 sj_tool-1.0.9.dist-info/METADATA
+-rw-rw-rw-  2.0 fat       92 b- defN 23-Apr-23 03:35 sj_tool-1.0.9.dist-info/WHEEL
+-rw-rw-rw-  2.0 fat        8 b- defN 23-Apr-23 03:35 sj_tool-1.0.9.dist-info/top_level.txt
+?rw-rw-r--  2.0 fat     2364 b- defN 23-Apr-23 03:35 sj_tool-1.0.9.dist-info/RECORD
+30 files, 24966 bytes uncompressed, 9654 bytes compressed:  61.3%
```

## zipnote {}

```diff
@@ -3,35 +3,29 @@
 
 Filename: sj_tool/decorator.py
 Comment: 
 
 Filename: sj_tool/email.py
 Comment: 
 
-Filename: sj_tool/file.py
+Filename: sj_tool/email_sender.py
 Comment: 
 
-Filename: sj_tool/http_util.py
+Filename: sj_tool/file.py
 Comment: 
 
 Filename: sj_tool/json.py
 Comment: 
 
-Filename: sj_tool/json_util.py
-Comment: 
-
 Filename: sj_tool/language.py
 Comment: 
 
 Filename: sj_tool/parallel.py
 Comment: 
 
-Filename: sj_tool/parallel_util.py
-Comment: 
-
 Filename: sj_tool/scheduler.py
 Comment: 
 
 Filename: sj_tool/system.py
 Comment: 
 
 Filename: sj_tool/util.py
@@ -39,101 +33,59 @@
 
 Filename: sj_tool/db/__init__.py
 Comment: 
 
 Filename: sj_tool/db/mongo.py
 Comment: 
 
-Filename: sj_tool/db/mongo_util.py
-Comment: 
-
 Filename: sj_tool/db/mysql.py
 Comment: 
 
-Filename: sj_tool/db/sql_util.py
-Comment: 
-
 Filename: sj_tool/fjsp/__init__.py
 Comment: 
 
-Filename: sj_tool/fjsp/builder.py
-Comment: 
-
-Filename: sj_tool/fjsp/check.py
-Comment: 
-
-Filename: sj_tool/fjsp/result_generator.py
-Comment: 
-
-Filename: sj_tool/fjsp/time_util.py
-Comment: 
-
 Filename: sj_tool/fjsp/entity/__init__.py
 Comment: 
 
 Filename: sj_tool/fjsp/entity/changeover.py
 Comment: 
 
 Filename: sj_tool/fjsp/entity/fjsp_pool.py
 Comment: 
 
+Filename: sj_tool/fjsp/entity/global_pool.py
+Comment: 
+
 Filename: sj_tool/fjsp/entity/job.py
 Comment: 
 
 Filename: sj_tool/fjsp/entity/machine.py
 Comment: 
 
 Filename: sj_tool/fjsp/entity/operation.py
 Comment: 
 
-Filename: sj_tool/fjsp/entity/order.py
-Comment: 
-
-Filename: sj_tool/fjsp/entity/process.py
-Comment: 
-
 Filename: sj_tool/fjsp/entity/product.py
 Comment: 
 
-Filename: sj_tool/fjsp/entity/standing_time.py
-Comment: 
-
-Filename: sj_tool/fjsp/erp_next/__init__.py
-Comment: 
-
-Filename: sj_tool/fjsp/erp_next/constant.py
-Comment: 
-
-Filename: sj_tool/fjsp/erp_next/data_sync.py
-Comment: 
-
-Filename: sj_tool/fjsp/erp_next/data_write_back.py
-Comment: 
-
-Filename: sj_tool/fjsp/erp_next/util.py
-Comment: 
-
 Filename: sj_tool/logger/__init__.py
 Comment: 
 
-Filename: sj_tool/logger/logger.py
-Comment: 
-
 Filename: sj_tool/logger/text_logger.py
 Comment: 
 
 Filename: sj_tool/logger/visual_logger.py
 Comment: 
 
-Filename: sj_tool-1.0.86.dist-info/METADATA
+Filename: sj_tool-1.0.9.dist-info/METADATA
 Comment: 
 
-Filename: sj_tool-1.0.86.dist-info/WHEEL
+Filename: sj_tool-1.0.9.dist-info/WHEEL
 Comment: 
 
-Filename: sj_tool-1.0.86.dist-info/top_level.txt
+Filename: sj_tool-1.0.9.dist-info/top_level.txt
 Comment: 
 
-Filename: sj_tool-1.0.86.dist-info/RECORD
+Filename: sj_tool-1.0.9.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## sj_tool/file.py

```diff
@@ -1,46 +1,8 @@
-import json
 import os
-import re
 import shutil
-import yaml
 
 
 def makedir(path, delete_old=False):
     if delete_old:
         shutil.rmtree(path)
     os.makedirs(path, exist_ok=True)
-
-
-def sanitize_filename(filename, alter_char="_"):
-    """
-    将文件名中的不合法字符替换为某个合法字符
-    :param filename:
-    :param alter_char:
-    :return:
-    """
-    # 定义不合法的字符正则表达式模式
-    illegal_chars = r'[\/:*?"<>|]'
-
-    # 使用"#"替换不合法字符
-    sanitized_filename = re.sub(illegal_chars, alter_char, filename)
-
-    return sanitized_filename
-
-
-def load_yaml(filename):
-    with open(filename, "r", encoding="utf-8") as f:
-        return yaml.load(f.read(), Loader=yaml.FullLoader)
-
-
-def load_json(filename):
-    """加载json文件"""
-    if os.path.exists(filename) and os.path.isfile(filename):
-        with open(filename, encoding="utf-8") as f:
-            return json.load(f)
-    return None
-
-
-def dump_json(obj, filename):
-    """保存为json文件"""
-    with open(filename, "w", encoding="utf-8") as f:
-        return json.dump(obj, f, ensure_ascii=False)
```

### encoding

```diff
@@ -1 +1 @@
-utf-8
+us-ascii
```

## sj_tool/util.py

```diff
@@ -1,30 +1,17 @@
 import os
 import random
 import importlib
 
 import numpy as np
 
-from sj_tool.file import sanitize_filename
-
-
-def get_root_dir() -> str:
-    """
-    Get the absolute path of the project root
-
-    Returns
-    -------
-
-    """
-    return os.path.join(os.path.dirname(__file__), "..")
-
 
 def package_exists(package_name):
     """
-    检查是否存在某个python包
+    检查是否存在某个包
     :param package_name: 包名
     :return:
     """
     try:
         importlib.import_module(package_name)
         return True
     except ImportError:
@@ -48,11 +35,7 @@
         torch.backends.cudnn.deterministic = True
         torch.backends.cudnn.benchmark = False
         torch.manual_seed(seed)
 
         if torch.cuda.is_available():
             torch.cuda.manual_seed_all(seed)
             torch.cuda.manual_seed(seed)
-
-
-def get_mongo_name(owner: str, collection: str):
-    return sanitize_filename(f"{owner}_{collection}")
```

## sj_tool/db/mongo.py

```diff
@@ -1,136 +1,162 @@
 import pymongo
 from pymongo import database
 from pymongo.results import InsertOneResult, InsertManyResult, UpdateResult, DeleteResult
 from typing import List, Dict
-from flask_pymongo import PyMongo
 
-from sj_tool.file import sanitize_filename
 
+def connect_mongodb_database(url: str, database_name: str) -> database.Database:
+    """
+    连接 MongoDB 数据库，并返回指定的数据库实例
 
-def format_collection_name(owner: str, collection: str):
-    return sanitize_filename(f"{owner}_{collection}")
+    Args:
+        url: 数据库地址
+        database_name: 数据库名称
 
+    Returns:
+        返回 database.Database 对象，代表连接到的 MongoDB 数据库实例
+    """
+    if url is None:
+        url = "mongodb://localhost:27017/"
+        print("用户未提供地址，将使用默认地址: ", url)
+    client = pymongo.MongoClient(url)
+    return client[database_name]
 
-class MongoUtil:
-    def __init__(self, client: PyMongo = None):
-        self.client = client
-
-    def init_client(self, client):
-        self.client = client
-
-    def insert_one_doc(self, collection: str, doc: Dict) -> InsertOneResult:
-        """
-        向 MongoDB 集合中插入一条文档
-
-        Args:
-            collection: str类型，代表要插入文档的 MongoDB 集合名字
-            doc: 要插入的文档数据，一个 Python 字典对象
-
-        Returns:
-            返回 InsertOneResult 对象，代表插入操作的结果
-        """
-        return self.client.db[collection].insert_one(doc)
-
-    def insert_many_docs(self, collection: str, docs: List[Dict]) -> InsertManyResult:
-        """
-        向 MongoDB 集合中插入多条文档
-
-        Args:
-            collection: str 对象，代表要插入文档的 MongoDB 集合
-            docs: 要插入的多个文档数据，一个 Python 字典对象的列表
-
-        Returns:
-            返回 results.InsertManyResult 对象，代表插入操作的结果
-        """
-        return self.client.db[collection].insert_many(docs)
-
-    def find_one_doc(self, collection: str) -> Dict:
-        """
-        查询 MongoDB 集合中的一条文档
-
-        Args:
-            collection: str 对象，代表要查询的 MongoDB 集合
-
-        Returns:
-            返回一个 Python 字典对象，代表查询到的 MongoDB 文档数据
-        """
-        return self.client.db[collection].find_one()
-
-    def find_all_docs(self, collection: str) -> pymongo.cursor.Cursor:
-        """
-        查询 MongoDB 集合中的所有文档
-
-        Args:
-            collection: str 对象，代表要查询的 MongoDB 集合
-
-        Returns:
-            返回一个 pymongo.cursor.Cursor 对象，代表查询到的 MongoDB 文档的游标
-        """
-        return self.client.db[collection].find()
-
-    def find_docs_by_query(self, collection: str, query: Dict) -> pymongo.cursor.Cursor:
-        """
-        根据查询条件查询 MongoDB 集合中的文档
-
-        Args:
-            collection: str 对象，代表要查询的 MongoDB 集合
-            query: 查询条件，一个 Python 字典对象，例如 {"age": 30}
-
-        Returns:
-            返回一个 pymongo.cursor.Cursor 对象，代表
-        """
-        return self.client.db[collection].find(query)
-
-    def delete_one_doc(self, collection: str, query: Dict) -> DeleteResult:
-        """
-        从 MongoDB 集合中删除一条文档
-
-        Args:
-            collection: str 对象，代表要删除文档的 MongoDB 集合
-            query: 删除条件，一个 Python 字典对象，例如 {"name": "John"}
-
-        Returns:
-            返回 DeleteResult 对象，代表删除操作的结果
-        """
-        return self.client.db[collection].delete_one(query)
-
-    def delete_many_docs(self, collection: str, query: Dict) -> DeleteResult:
-        """
-        从 MongoDB 集合中删除多条文档
-
-        Args:
-            collection: str 对象，代表要删除文档的 MongoDB 集合
-            query: 删除条件，一个 Python 字典对象，例如 {"age": {"$gt": 25}}，若为{}，则删除所有文档
-
-        Returns:
-            返回 DeleteResult 对象，代表删除操作的结果
-        """
-        return self.client.db[collection].delete_many(query)
-
-    def update_one_doc(self, collection: str, query: Dict, update: Dict) -> UpdateResult:
-        """
-        更新 MongoDB 集合中的一条文档
-
-        Args:
-            collection: str 对象，代表要更新文档的 MongoDB 集合
-            query: 更新条件，一个 Python 字典对象，例如 {"name": "John"}
-            update: 要更新的文档数据，一个 Python 字典对象，例如 {"$set": {"age": 25}}
-
-        Returns:
-            返回 UpdateResult 对象，代表更新操作的结果
-        """
-        return self.client.db[collection].update_one(query, {"$set": update})
-
-    def update_many_docs(self, collection: str, query: Dict, update: Dict) -> UpdateResult:
-        """
-        更新 MongoDB 集合中的多条文档
-
-        Args:
-            collection: str 对象，代表要更新文档的 MongoDB 集合
-            query: 更新条件，一个 Python 字典对象，例如 {"age": {"$lt": 30}}
-            update: 要更新的文档数据，一个 Python 字典对象，例如 {"$set": {"age": 30}}
-
-        Returns:
-            返回 UpdateResult 对象，代表更新操作的结果
-        """
-        return self.client.db[collection].update_many(query, {"$set": update})
+
+def create_mongodb_collection(database: database.Database, collection_name: str) -> pymongo.collection.Collection:
+    """
+    在指定的 MongoDB 数据库中创建一个集合
+
+    Args:
+        database: database.Database 对象，代表要创建集合的数据库实例
+        collection_name: 要创建的集合名称
+
+    Returns:
+        返回 pymongo.collection.Collection 对象，代表创建的 MongoDB 集合
+    """
+    return database[collection_name]
+
+
+def insert_one(collection: pymongo.collection.Collection, doc: Dict) -> InsertOneResult:
+    """
+    向 MongoDB 集合中插入一条文档
+
+    Args:
+        collection: pymongo.collection.Collection 对象，代表要插入文档的 MongoDB 集合
+        doc: 要插入的文档数据，一个 Python 字典对象
+
+    Returns:
+        返回 InsertOneResult 对象，代表插入操作的结果
+    """
+    return collection.insert_one(doc)
+
+
+def insert_many(collection: pymongo.collection.Collection, docs: List[Dict]) -> InsertManyResult:
+    """
+    向 MongoDB 集合中插入多条文档
+
+    Args:
+        collection: pymongo.collection.Collection 对象，代表要插入文档的 MongoDB 集合
+        docs: 要插入的多个文档数据，一个 Python 字典对象的列表
+
+    Returns:
+        返回 results.InsertManyResult 对象，代表插入操作的结果
+    """
+    return collection.insert_many(docs)
+
+
+def find_one(collection: pymongo.collection.Collection) -> Dict:
+    """
+    查询 MongoDB 集合中的一条文档
+
+    Args:
+        collection: pymongo.collection.Collection 对象，代表要查询的 MongoDB 集合
+
+    Returns:
+        返回一个 Python 字典对象，代表查询到的 MongoDB 文档数据
+    """
+    return collection.find_one()
+
+
+def find_all(collection: pymongo.collection.Collection) -> pymongo.cursor.Cursor:
+    """
+    查询 MongoDB 集合中的所有文档
+
+    Args:
+        collection: pymongo.collection.Collection 对象，代表要查询的 MongoDB 集合
+
+    Returns:
+        返回一个 pymongo.cursor.Cursor 对象，代表查询到的 MongoDB 文档的游标
+    """
+    return collection.find()
+
+
+def find_by_query(collection: pymongo.collection.Collection, query: Dict) -> pymongo.cursor.Cursor:
+    """
+    根据查询条件查询 MongoDB 集合中的文档
+
+    Args:
+        collection: pymongo.collection.Collection 对象，代表要查询的 MongoDB 集合
+        query: 查询条件，一个 Python 字典对象，例如 {"age": 30}
+
+    Returns:
+        返回一个 pymongo.cursor.Cursor 对象，代表
+    """
+    return collection.find(query)
+
+
+def delete_one(collection: pymongo.collection.Collection, query: Dict) -> DeleteResult:
+    """
+    从 MongoDB 集合中删除一条文档
+
+    Args:
+        collection: pymongo.collection.Collection 对象，代表要删除文档的 MongoDB 集合
+        query: 删除条件，一个 Python 字典对象，例如 {"name": "John"}
+
+    Returns:
+        返回 DeleteResult 对象，代表删除操作的结果
+    """
+    return collection.delete_one(query)
+
+
+def delete_many(collection: pymongo.collection.Collection, query: Dict) -> DeleteResult:
+    """
+    从 MongoDB 集合中删除多条文档
+
+    Args:
+        collection: pymongo.collection.Collection 对象，代表要删除文档的 MongoDB 集合
+        query: 删除条件，一个 Python 字典对象，例如 {"age": {"$gt": 25}}，若为{}，则删除所有文档
+
+    Returns:
+        返回 DeleteResult 对象，代表删除操作的结果
+    """
+    return collection.delete_many(query)
+
+
+def update_one(collection: pymongo.collection.Collection, query: Dict, update: Dict) -> UpdateResult:
+    """
+    更新 MongoDB 集合中的一条文档
+
+    Args:
+        collection: pymongo.collection.Collection 对象，代表要更新文档的 MongoDB 集合
+        query: 更新条件，一个 Python 字典对象，例如 {"name": "John"}
+        update: 要更新的文档数据，一个 Python 字典对象，例如 {"$set": {"age": 25}}
+
+    Returns:
+        返回 UpdateResult 对象，代表更新操作的结果
+    """
+    return collection.update_one(query, update)
+
+
+def update_many(collection: pymongo.collection.Collection, query: Dict, update: Dict) -> UpdateResult:
+    """
+    更新 MongoDB 集合中的多条文档
+
+    Args:
+        collection: pymongo.collection.Collection 对象，代表要更新文档的 MongoDB 集合
+        query: 更新条件，一个 Python 字典对象，例如 {"age": {"$lt": 30}}
+        update: 要更新的文档数据，一个 Python 字典对象，例如 {"$set": {"age": 30}}
+
+    Returns:
+        返回 UpdateResult 对象，代表更新操作的结果
+    """
+    return collection.update_many(query, update)
```

## sj_tool/db/mysql.py

```diff
@@ -1,36 +1,24 @@
 from playhouse.pool import PooledMySQLDatabase
 
 
 # 定义数据库连接池
-def manual_connect(database, user, password, host, port=3306, max_connections=8, stale_timeout=300, **kwargs):
+def create_connection_pool(database, user, password, host, port=3306, max_connections=8, stale_timeout=300, **kwargs):
     return PooledMySQLDatabase(
         database,
         user=user,
         password=password,
         host=host,
         port=port,
         max_connections=max_connections,
         stale_timeout=stale_timeout,
         **kwargs
     )
 
 
-def init_config(database, user, password, host, port=3306):
-    return {
-        "database": database,
-        # "engine": "peewee.MySQLDatabase",
-        "user": user,
-        "password": password,
-        "host": host,
-        "port": port,
-        "charset": "utf8",
-    }
-
-
 # 定义通用增删改查函数
 def create_record(db, model_class, **kwargs):
     with db.atomic():
         record = model_class.create(**kwargs)
         return record.id
```

## sj_tool/fjsp/entity/changeover.py

```diff
@@ -1,23 +1,19 @@
 from typing import Dict
 
 
+class BasicOpInfo(object):
+    def __init__(self, op_type, name, machine_times: Dict[int, float]):
+        self.op_type = op_type
+        self.name = name
+        self.machine_times = machine_times
+
+
 class Changeover(object):
     def __init__(self):
         self.info = {}
 
-    def add(self, pre_model, pre_op_type, post_model, cur_op_type, machine, time_length):
-        """
-        :param pre_model: 前置产品的系列 或者 半成品
-        :param pre_op_type:
-        :param post_model:
-        :param cur_op_type:
-        :param machine:
-        :param time_length:
-        :return:
-        """
-        self.info[(pre_model, pre_op_type, post_model, cur_op_type, machine)] = time_length
-
-    def get(self, pre_model, pre_op_type, post_model, cur_op_type, machine):
-        if (pre_model, pre_op_type, post_model, cur_op_type, machine) not in self.info:
-            return 0
-        return self.info[(pre_model, pre_op_type, post_model, cur_op_type, machine)]
+    def add(self, pre_mtm, pre_op_type, cur_mtm, cur_op_type, processing_time):
+        self.info[(pre_op_type, cur_op_type)] = processing_time
+
+    def get(self, pre_mtm, pre_op_type, cur_mtm, cur_op_type):
+        return self.info[(pre_op_type, cur_op_type)]
```

### encoding

```diff
@@ -1 +1 @@
-utf-8
+us-ascii
```

## sj_tool/fjsp/entity/fjsp_pool.py

```diff
@@ -1,31 +1,22 @@
 from dataclasses import dataclass, field
 from typing import Dict, Union
+
 from sj_tool.fjsp.entity.job import BaseJob
 from sj_tool.fjsp.entity.machine import BaseMachine
 from sj_tool.fjsp.entity.operation import BaseOperation
-from sj_tool.fjsp.entity.process import BaseProcess
+from sj_tool.fjsp.entity.changeover import BasicOpInfo
 from sj_tool.fjsp.entity.product import BaseProduct
-from sj_tool.fjsp.entity.changeover import Changeover
-from sj_tool.fjsp.entity.standing_time import StandingTime
 
 
 @dataclass
 class FjspPool:
     # 工单列表
     job_dict: Dict[Union[int, str], BaseJob] = field(default_factory=dict)
-    # 工序基础信息
-    process_dict: Dict[Union[int, str], BaseProcess] = field(default_factory=dict)
-    # operation 列表
+    # 所有的工序列表
     op_dict: Dict[Union[int, str], BaseOperation] = field(default_factory=dict)
+    # 工序基础信息
+    op_info_dict: Dict[Union[int, str], BasicOpInfo] = field(default_factory=dict)
     # 机器列表
     machine_dict: Dict[Union[int, str], BaseMachine] = field(default_factory=dict)
     # 产品列表
     product_dict: Dict[Union[int, str], BaseProduct] = field(default_factory=dict)
-    # 换型基础信息
-    changeover: Changeover = None
-    # 静置基础信息
-    standing_time: StandingTime = None
-    # 排程开始时间
-    plan_start_date: str = None
-    # 班制
-    shift: str = None
```

## sj_tool/fjsp/entity/job.py

```diff
@@ -1,32 +1,24 @@
 from typing import Union
 
 import pandas as pd
 
 
 class BaseJob(object):
     def __init__(
-        self,
-        job_id: Union[int, str],
-        product_id: Union[int, str],
-        arrival_time: Union[str, int],
-        ots_time: Union[str, int],
-        demand: Union[int, float],
+        self, job_id: Union[int, str], product_code: str, arrival_time: str, ots_time: str, demand: Union[int, float]
     ):
         """
 
         :param job_id:
-        :param product_id: 产品编码
+        :param product_code: 产品编码
         :param arrival_time: job到达时间，即最早可开始时间
         :param ots_time: 截止时间
         :param demand: 需求量
         """
         self.id = job_id
-        self.product_id = product_id
-        self.arrival_time = pd.to_datetime(arrival_time) if isinstance(arrival_time, str) else arrival_time
-        self.ots_time = pd.to_datetime(ots_time) if isinstance(ots_time, str) else ots_time
+        self.product_code = product_code
+        self.arrival_time = pd.to_datetime(arrival_time)
+        self.ots_time = pd.to_datetime(ots_time)
         self.demand = demand
         self.start_operations = []
         self.operations = []
-
-        self.job_start = None
-        self.job_end = None
```

## sj_tool/fjsp/entity/machine.py

```diff
@@ -1,54 +1,14 @@
 from typing import List
-from typing import Union
-from datetime import timedelta
 
 
 class BaseMachine(object):
-    def __init__(self, idx, name, available_ops: List[Union[str, int]] = None, unit_times=None):
+    def __init__(self, idx, name, available_ops: List[str] = [], unit_times={}):
         """
 
-            :param machine_id:
-            :param available_ops:
-
-            {
-            "_id": {
-                "$oid": "63ad5dc38e83107f8b8092ce"
-            },
-            "prodLine": "EZP10",
-            "planName": "CML",
-            "calendarTime": {
-                "$date": "2022-02-28T16:00:00.000Z"
-            },
-            "week": "二",
-            "workTime": "12",
-            "userName": "duchengkun",
-            "createTime": {
-                "$date": "2022-12-29T09:28:35.126Z"
-            },
-            "updateTime": {
-                "$date": "2022-12-29T09:28:35.126Z"
-            }
-        }
-
+        :param machine_id:
+        :param available_ops:
         """
         self.id = idx
         self.name = name
-        self.unit_times = {} if unit_times is None else unit_times  # {('product_id','process_id'):单个的节拍 }
-        self.available_ops = [] if available_ops is None else available_ops
-        self.scheduled_ops = []
-
-        # {"8小时":["08:00-11:30,12:15-16:45,"],"12小时":["08:00-11:30,12:15-16:45,17:30-21:30,"],"16小时":["08:00-16:45,17:30-00:45,"],"24小时":["08:00-11:30,12:15-16:45,17:30-20:00,20:00-00:00,00:30-08:00,"],"0小时":["08:00-08:00,"]}
-        self.calendar = {}
-        self.earlist_st = None
-        self.last_model = None
-        self.last_process = None
-
-    def get_calendar(self, calendar, day):
-        calendar_dict = calendar.get(
-            day,
-            {
-                "shift": timedelta(hours=24),
-                "c_list": [{"s_t": day, "shift": timedelta(hours=24), "e_t": day + timedelta(hours=24)}],
-            },
-        )
-        return calendar_dict
+        self.available_ops = available_ops
+        self.unit_times = unit_times  # {('product_id','operation_type'):单个的节拍 }
```

## sj_tool/fjsp/entity/operation.py

```diff
@@ -2,43 +2,25 @@
 
 
 class BaseOperation:
     def __init__(
         self,
         idx: Union[int, str],
         job_id: Union[int, str],
-        product_id: Union[int, str],
-        demand: Union[int, float],
-        process_id: Union[int, str],
-        machine_times: Dict,
-        pre_ops: List = None,
-        next_ops: List = None,
+        op_type: Union[int, str],
+        machine_times: Dict[int, float] = None,
     ):
         """
 
         :param idx: 工序id
         :param job_id: 工单id
-
+        :param op_type: 工序类型
+        :param machine_times: 操作在不同机器上的所需时间列表，例：{1:2,2:2,3:4},
+                其中每个tuple的第一个元素表示机器id，第二个元素表示工序在对应机器上的单个所需时间
         """
         self.id = idx
         self.job_id = job_id
-        self.process_id = process_id
-        self.product_id = product_id
-
-        self.pre_ops = [] if pre_ops is None else pre_ops
-        self.next_ops = [] if next_ops is None else next_ops
-        self.machine_times = machine_times  # 设备处理总数量所需时间 {"machine_id":float/int}
-        self.available_machines = list(machine_times.keys())
-        self.demand = demand
-
-        self.op_start = None
-        self.op_end = None
-        self.detailed_time = []  # 生产的详细时间[(start_time1, end_time1)]
-        self.changeover_start = None
-        self.changeover_end = None
-        self.detailed_changeover_time = []  # 换型的详细时间[(start_time1, end_time1)]
-        self.mad = ""
-        self.ots_time = ""
-        # 所使用的机器
-        self.scheduled_machine = None
-        # 排程结果的换型开始结束，例：(2022-01-01 10:20:00, 2022-01-01 10:40:00)
-        self.changeover: Tuple = None
+        self.op_type = op_type
+        # op ids
+        self.pre_ops = []
+        self.next_ops = []
+        self.machine_times = machine_times
```

## sj_tool/fjsp/entity/product.py

```diff
@@ -1,13 +1,4 @@
-from typing import Union
-
-
 class BaseProduct(object):
-    def __init__(self, idx: Union[int, str], name: Union[int, str], model: Union[int, str]):
+    def __init__(self, idx, name):
         self.id = idx
         self.name = name
-        self.model = model  # 产品类型
-        self.start_process = 0
-        self.end_process = -1
-        self.next_op_dict = {}  # 所需要工序 {op 编号: [下道工序 op 编号]}
-        self.pre_op_dict = {}  # 所需要工序 {op 编号: [上道工序 op 编号]}
-        self.operations = []
```

### encoding

```diff
@@ -1 +1 @@
-utf-8
+us-ascii
```

## sj_tool/logger/text_logger.py

```diff
@@ -54,10 +54,10 @@
     if not logdir:
         current_time = datetime.now().strftime("%b%d_%H-%M-%S")
         if "" != comment:
             comment = "." + comment
         logdir = os.path.join("runs", current_time + comment)
 
     if save_log:
-        logger.add(os.path.join(logdir, filename), rotation=max_filesize, level=level)
+        logger.add(os.path.join(logdir, filename), rotation=max_filesize, compression="zip", level=level)
 
     return logger
```

