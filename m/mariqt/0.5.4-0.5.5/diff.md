# Comparing `tmp/mariqt-0.5.4-py2.py3-none-any.whl.zip` & `tmp/mariqt-0.5.5-py2.py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,33 +1,33 @@
-Zip file size: 213730 bytes, number of entries: 31
--rw-r--r--  2.0 unx     5876 b- defN 23-Jul-17 09:07 mariqt/converters.py
--rw-r--r--  2.0 unx    14710 b- defN 23-Jul-17 09:07 mariqt/core.py
--rw-r--r--  2.0 unx     8485 b- defN 23-Jul-17 09:07 mariqt/directories.py
--rw-r--r--  2.0 unx      465 b- defN 23-Jul-17 09:07 mariqt/equipment.py
--rw-r--r--  2.0 unx    16621 b- defN 23-Jul-17 09:07 mariqt/files.py
--rw-r--r--  2.0 unx    27845 b- defN 23-Jul-17 09:07 mariqt/geo.py
--rw-r--r--  2.0 unx    23207 b- defN 23-Jul-17 09:07 mariqt/image.py
--rw-r--r--  2.0 unx     3090 b- defN 23-Jul-17 09:07 mariqt/misc.py
--rw-r--r--  2.0 unx    40059 b- defN 23-Jul-17 09:07 mariqt/navigation.py
--rw-r--r--  2.0 unx     7345 b- defN 23-Jul-17 09:07 mariqt/provenance.py
--rw-r--r--  2.0 unx    22316 b- defN 23-Jul-17 09:07 mariqt/reports.py
--rw-r--r--  2.0 unx     4376 b- defN 23-Jul-17 09:07 mariqt/settings.py
--rw-r--r--  2.0 unx     8323 b- defN 23-Jul-17 09:07 mariqt/tests.py
--rw-r--r--  2.0 unx     9613 b- defN 23-Jul-17 09:07 mariqt/variables.py
--rw-r--r--  2.0 unx       21 b- defN 23-Jul-17 09:07 mariqt/version.py
--rw-rw-rw-  2.0 unx     6175 b- defN 23-Jul-17 09:07 mariqt/resources/fair-marine-images/docs/schemas/annotation-v2.0.0.json
--rw-rw-rw-  2.0 unx    42461 b- defN 23-Jul-17 09:07 mariqt/resources/fair-marine-images/docs/schemas/ifdo-v2.0.0.json
--rw-rw-rw-  2.0 unx     3218 b- defN 23-Jul-17 09:07 mariqt/resources/fair-marine-images/docs/schemas/provenance-v0.1.0.json
--rw-r--r--  2.0 unx    12135 b- defN 23-Jul-17 09:07 mariqt/sources/dship.py
--rw-r--r--  2.0 unx     4586 b- defN 23-Jul-17 09:07 mariqt/sources/dship_settings.py
--rw-r--r--  2.0 unx     2177 b- defN 23-Jul-17 09:07 mariqt/sources/elements.py
--rw-r--r--  2.0 unx   114744 b- defN 23-Jul-17 09:07 mariqt/sources/ifdo.py
--rw-r--r--  2.0 unx     5533 b- defN 23-Jul-17 09:07 mariqt/sources/ofop.py
--rw-r--r--  2.0 unx   650149 b- defN 23-Jul-17 09:07 mariqt/sources/svgs.py
--rw-r--r--  2.0 unx     3728 b- defN 23-Jul-17 09:07 mariqt/sources/underway.py
--rw-rw-rw-  2.0 unx      162 b- defN 23-Jul-17 09:08 mariqt-0.5.4.dist-info/AUTHORS.md
--rw-rw-rw-  2.0 unx    35140 b- defN 23-Jul-17 09:08 mariqt-0.5.4.dist-info/LICENSE
--rw-r--r--  2.0 unx     1133 b- defN 23-Jul-17 09:08 mariqt-0.5.4.dist-info/METADATA
--rw-r--r--  2.0 unx      110 b- defN 23-Jul-17 09:08 mariqt-0.5.4.dist-info/WHEEL
--rw-r--r--  2.0 unx        7 b- defN 23-Jul-17 09:08 mariqt-0.5.4.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     2542 b- defN 23-Jul-17 09:08 mariqt-0.5.4.dist-info/RECORD
-31 files, 1076352 bytes uncompressed, 209704 bytes compressed:  80.5%
+Zip file size: 214436 bytes, number of entries: 31
+-rw-r--r--  2.0 unx     5876 b- defN 23-Jul-18 09:18 mariqt/converters.py
+-rw-r--r--  2.0 unx    14710 b- defN 23-Jul-18 09:18 mariqt/core.py
+-rw-r--r--  2.0 unx     8485 b- defN 23-Jul-18 09:18 mariqt/directories.py
+-rw-r--r--  2.0 unx      465 b- defN 23-Jul-18 09:18 mariqt/equipment.py
+-rw-r--r--  2.0 unx    16621 b- defN 23-Jul-18 09:18 mariqt/files.py
+-rw-r--r--  2.0 unx    28565 b- defN 23-Jul-18 14:49 mariqt/geo.py
+-rw-r--r--  2.0 unx    23207 b- defN 23-Jul-18 09:18 mariqt/image.py
+-rw-r--r--  2.0 unx     3090 b- defN 23-Jul-18 09:18 mariqt/misc.py
+-rw-r--r--  2.0 unx    40159 b- defN 23-Jul-18 14:49 mariqt/navigation.py
+-rw-r--r--  2.0 unx     7345 b- defN 23-Jul-18 09:18 mariqt/provenance.py
+-rw-r--r--  2.0 unx    22316 b- defN 23-Jul-18 09:18 mariqt/reports.py
+-rw-r--r--  2.0 unx     4376 b- defN 23-Jul-18 09:18 mariqt/settings.py
+-rw-r--r--  2.0 unx     8323 b- defN 23-Jul-18 09:18 mariqt/tests.py
+-rw-r--r--  2.0 unx     9613 b- defN 23-Jul-18 09:18 mariqt/variables.py
+-rw-r--r--  2.0 unx       21 b- defN 23-Jul-18 15:08 mariqt/version.py
+-rw-rw-rw-  2.0 unx     6175 b- defN 23-Jul-18 09:18 mariqt/resources/fair-marine-images/docs/schemas/annotation-v2.0.0.json
+-rw-rw-rw-  2.0 unx    42461 b- defN 23-Jul-18 09:18 mariqt/resources/fair-marine-images/docs/schemas/ifdo-v2.0.0.json
+-rw-rw-rw-  2.0 unx     3218 b- defN 23-Jul-18 09:18 mariqt/resources/fair-marine-images/docs/schemas/provenance-v0.1.0.json
+-rw-r--r--  2.0 unx    12135 b- defN 23-Jul-18 09:18 mariqt/sources/dship.py
+-rw-r--r--  2.0 unx     4684 b- defN 23-Jul-18 09:18 mariqt/sources/dship_settings.py
+-rw-r--r--  2.0 unx     2177 b- defN 23-Jul-18 09:18 mariqt/sources/elements.py
+-rw-r--r--  2.0 unx   117195 b- defN 23-Jul-18 14:59 mariqt/sources/ifdo.py
+-rw-r--r--  2.0 unx     5533 b- defN 23-Jul-18 09:18 mariqt/sources/ofop.py
+-rw-r--r--  2.0 unx   650149 b- defN 23-Jul-18 09:18 mariqt/sources/svgs.py
+-rw-r--r--  2.0 unx     3728 b- defN 23-Jul-18 09:18 mariqt/sources/underway.py
+-rw-rw-rw-  2.0 unx      162 b- defN 23-Jul-18 15:10 mariqt-0.5.5.dist-info/AUTHORS.md
+-rw-rw-rw-  2.0 unx    35140 b- defN 23-Jul-18 15:10 mariqt-0.5.5.dist-info/LICENSE
+-rw-r--r--  2.0 unx     1133 b- defN 23-Jul-18 15:10 mariqt-0.5.5.dist-info/METADATA
+-rw-r--r--  2.0 unx      110 b- defN 23-Jul-18 15:10 mariqt-0.5.5.dist-info/WHEEL
+-rw-r--r--  2.0 unx        7 b- defN 23-Jul-18 15:10 mariqt-0.5.5.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     2542 b- defN 23-Jul-18 15:10 mariqt-0.5.5.dist-info/RECORD
+31 files, 1079721 bytes uncompressed, 210410 bytes compressed:  80.5%
```

## zipnote {}

```diff
@@ -69,26 +69,26 @@
 
 Filename: mariqt/sources/svgs.py
 Comment: 
 
 Filename: mariqt/sources/underway.py
 Comment: 
 
-Filename: mariqt-0.5.4.dist-info/AUTHORS.md
+Filename: mariqt-0.5.5.dist-info/AUTHORS.md
 Comment: 
 
-Filename: mariqt-0.5.4.dist-info/LICENSE
+Filename: mariqt-0.5.5.dist-info/LICENSE
 Comment: 
 
-Filename: mariqt-0.5.4.dist-info/METADATA
+Filename: mariqt-0.5.5.dist-info/METADATA
 Comment: 
 
-Filename: mariqt-0.5.4.dist-info/WHEEL
+Filename: mariqt-0.5.5.dist-info/WHEEL
 Comment: 
 
-Filename: mariqt-0.5.4.dist-info/top_level.txt
+Filename: mariqt-0.5.5.dist-info/top_level.txt
 Comment: 
 
-Filename: mariqt-0.5.4.dist-info/RECORD
+Filename: mariqt-0.5.5.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## mariqt/geo.py

```diff
@@ -33,14 +33,18 @@
 		self.uncert = uncert
 		# utm 
 		self.east = None
 		self.north = None
 		self.zone = None
 		self.Nhemis = None # is northern hemisphere 
 
+	def __eq__(self, other):
+		""" Does not compare utc, uncert and utm """
+		return self.lat == other.lat and self.lon == other.lon and self.dep == other.dep and self.hgt == other.hgt
+
 	def dateTime(self):
 		return datetime.datetime.utcfromtimestamp(self.utc / 1000)
 
 	def __str__(self) -> str:
 		return "utc: " + str(self.dateTime()) + ", lat: " + str(self.lat) + ", lon: " + str(self.lon) + ", dep: " + str(self.dep) + ", hgt: " + str(self.hgt) + ", uncert: " + str(self.uncert)
 
 	def containsNoneValue(self):
@@ -85,14 +89,31 @@
 		self.__clearNoneCleandValueLists()
 	def keys(self):
 		return self.positions.keys()
 
 	def __str__(self):
 		return str("\n".join([str(self.positions[e]) for e in self.positions]))
 
+	def invert_lat(self):
+		for pos in self.positions.values():
+			pos.lat *= -1
+
+	def invert_lon(self):
+		for pos in self.positions.values():
+			pos.lon *= -1
+
+	def invert_dep(self):
+		for pos in self.positions.values():
+			pos.dep *= -1
+
+	def invert_hgt(self):
+		for pos in self.positions.values():
+			pos.hgt *= -1
+
+	
 	def interpolateNones(self):
 		""" fills None values by interpolation """
 
 		time_points = list(self.positions.keys())
 		sorted_time_points = copy.deepcopy(time_points)
 		for utc in time_points:
 			if self.positions[utc].lat is None and self.positions[utc].lon is None and self.positions[utc].dep is None and (self.positions[utc].hgt is None or self.positions[utc].hgt == -1):
@@ -330,15 +351,15 @@
 			else:
 				raise ex
 
 	def dateTime(self):
 		return datetime.datetime.utcfromtimestamp(self.utc / 1000)
 
 	def __eq__(self, __o: object) -> bool:
-		if self.utc == __o.utc and self.yaw == __o.yaw and self.pitch == __o.pitch and self.roll == __o.roll:
+		if self.yaw == __o.yaw and self.pitch == __o.pitch and self.roll == __o.roll:
 			return True
 		return False
 
 	def __str__(self) -> str:
 		return "utc: " + str(self.dateTime()) + ", yaw: " + str(self.yaw) + ", pitch: " + str(self.pitch) + ", roll: " + str(self.roll)
 
 	def containsNoneValue(self):
@@ -384,14 +405,26 @@
 		""" inits None cleaned value time point lists  """
 		# here it's assumed yaw, pitch and roll come from same record so they are not checked separatelys for None entries
 		self.noneCleandTimePoints_att = [t for t in sorted_time_points if not self.attitudes[t].containsNoneValue()]
 
 	def __clearNoneCleandValueLists(self):
 		self.noneCleandTimePoints_att = []
 
+	def invert_yaw(self):
+		for att in self.attitudes.values():
+			att.yaw *= -1
+
+	def invert_pitch(self):
+		for att in self.attitudes.values():
+			att.pitch *= -1
+
+	def invert_roll(self):
+		for att in self.attitudes.values():
+			att.roll *= -1
+
 	def interpolateAtTime(self,utc:int,sorted_time_points:list = None ,startIndex:int = 0):
 		""" returns att_interpolated, lastIndex """
 
 		if utc in self.attitudes and not self.attitudes[utc].containsNoneValue():
 			return self.attitudes[utc], startIndex
 
 		if sorted_time_points is None:
```

## mariqt/navigation.py

```diff
@@ -1014,14 +1014,16 @@
 				break
 
 	# Construct output file header
 	if header_format not in miqtv.pos_header:
 		raise ValueError("Output type "+ header_format + " not implemented")
 	new_header = ""
 	for col in miqtv.pos_header[header_format]:
+		if col == "alt": # sticking to depth here instead of negative depth as in iFDOv.2.0.0
+			continue
 		if col == "dep" and not with_depth:
 			continue
 		elif col == "hgt" and not with_height:
 			continue
 		elif col == "uncert" and not with_uncert:
 			continue
 		new_header += miqtv.pos_header[header_format][col] + "\t"
```

## mariqt/version.py

```diff
@@ -1 +1 @@
-__version__ = '0.5.4'
+__version__ = '0.5.5'
```

## mariqt/sources/dship_settings.py

```diff
@@ -1,13 +1,14 @@
 """ Various settings to connect to a DSHIP API"""
 
 # URLs for the rest api: where to get the data from
 # URLs exist for various sources
 urls = {'SO':'http://dship2.bsh.de:8080/dship-extraction/rest-presentation/datalog/createOrder',
 		'MSM':'http://dship3.bsh.de:8080/dship-extraction/rest-presentation/datalog/createOrder',
+        'MET':'http://dship4.bsh.de:8080/dship-extraction/rest-presentation/datalog/createOrder',
 		'MSMlive':'http://dship1:8080/dship-extraction/rest-presentation/datalog/createOrder'}
 
 # HTTP request header to be sent
 headers = {"Accept":"*/*","Accept-Encoding":"gzip, deflate","Accept-Language":"de,en-US;q=0.7,en;q=0.3","Connection":"keep-alive","Content-Type":"application/x-www-form-urlencoded; charset=UTF-8","X-Requested-With":"XMLHttpRequest"}
 
 request = 'user=__USERNAME__&name=__EXPORTNAME__&order=__ORDER__&saveOrderTemplate=false'
```

## mariqt/sources/ifdo.py

```diff
@@ -12,7161 +12,7314 @@
 000000b0: 0a69 6d70 6f72 7420 636f 7079 0a69 6d70  .import copy.imp
 000000c0: 6f72 7420 6461 7465 7469 6d65 0a66 726f  ort datetime.fro
 000000d0: 6d20 7070 7269 6e74 2069 6d70 6f72 7420  m pprint import 
 000000e0: 7070 7269 6e74 0a66 726f 6d20 6465 6570  pprint.from deep
 000000f0: 6469 6666 2069 6d70 6f72 7420 4465 6570  diff import Deep
 00000100: 4469 6666 0a66 726f 6d20 7061 636b 6167  Diff.from packag
 00000110: 696e 672e 7665 7273 696f 6e20 696d 706f  ing.version impo
-00000120: 7274 2056 6572 7369 6f6e 0a0a 696d 706f  rt Version..impo
-00000130: 7274 206d 6172 6971 742e 636f 7265 2061  rt mariqt.core a
-00000140: 7320 6d69 7174 630a 696d 706f 7274 206d  s miqtc.import m
-00000150: 6172 6971 742e 6469 7265 6374 6f72 6965  ariqt.directorie
-00000160: 7320 6173 206d 6971 7464 0a69 6d70 6f72  s as miqtd.impor
-00000170: 7420 6d61 7269 7174 2e66 696c 6573 2061  t mariqt.files a
-00000180: 7320 6d69 7174 660a 696d 706f 7274 206d  s miqtf.import m
-00000190: 6172 6971 742e 7661 7269 6162 6c65 7320  ariqt.variables 
-000001a0: 6173 206d 6971 7476 0a69 6d70 6f72 7420  as miqtv.import 
-000001b0: 6d61 7269 7174 2e69 6d61 6765 2061 7320  mariqt.image as 
-000001c0: 6d69 7174 690a 696d 706f 7274 206d 6172  miqti.import mar
-000001d0: 6971 742e 7465 7374 7320 6173 206d 6971  iqt.tests as miq
-000001e0: 7474 0a69 6d70 6f72 7420 6d61 7269 7174  tt.import mariqt
-000001f0: 2e6e 6176 6967 6174 696f 6e20 6173 206d  .navigation as m
-00000200: 6971 746e 0a69 6d70 6f72 7420 6d61 7269  iqtn.import mari
-00000210: 7174 2e73 6574 7469 6e67 7320 6173 206d  qt.settings as m
-00000220: 6971 7473 0a69 6d70 6f72 7420 6d61 7269  iqts.import mari
-00000230: 7174 2e70 726f 7665 6e61 6e63 6520 6173  qt.provenance as
-00000240: 206d 6971 7470 0a69 6d70 6f72 7420 6d61   miqtp.import ma
-00000250: 7269 7174 2e67 656f 2061 7320 6d69 7174  riqt.geo as miqt
-00000260: 670a 0a0a 636c 6173 7320 6e6f 6e43 6f72  g...class nonCor
-00000270: 6546 6965 6c64 496e 7465 726d 6564 6961  eFieldIntermedia
-00000280: 7465 4974 656d 496e 666f 4669 6c65 3a0a  teItemInfoFile:.
-00000290: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
-000002a0: 2873 656c 662c 2066 696c 654e 616d 653a  (self, fileName:
-000002b0: 7374 722c 2073 6570 6172 6174 6f72 3a73  str, separator:s
-000002c0: 7472 2c20 6865 6164 6572 3a64 6963 742c  tr, header:dict,
-000002d0: 2064 6174 6574 696d 655f 666f 726d 6174   datetime_format
-000002e0: 3a73 7472 3d6d 6971 7476 2e64 6174 655f  :str=miqtv.date_
-000002f0: 666f 726d 6174 735b 276d 6172 6971 7427  formats['mariqt'
-00000300: 5d29 3a0a 2020 2020 2020 2020 7365 6c66  ]):.        self
-00000310: 2e66 696c 654e 616d 6520 3d20 6669 6c65  .fileName = file
-00000320: 4e61 6d65 0a20 2020 2020 2020 2073 656c  Name.        sel
-00000330: 662e 7365 7061 7261 746f 7220 3d20 7365  f.separator = se
-00000340: 7061 7261 746f 720a 2020 2020 2020 2020  parator.        
-00000350: 7365 6c66 2e68 6561 6465 7220 3d20 6865  self.header = he
-00000360: 6164 6572 0a20 2020 2020 2020 2073 656c  ader.        sel
-00000370: 662e 6461 7465 7469 6d65 5f66 6f72 6d61  f.datetime_forma
-00000380: 7420 3d20 6461 7465 7469 6d65 5f66 6f72  t = datetime_for
-00000390: 6d61 740a 0a20 2020 2064 6566 205f 5f65  mat..    def __e
-000003a0: 715f 5f28 7365 6c66 2c20 6f74 6865 7229  q__(self, other)
-000003b0: 3a0a 2020 2020 2020 2020 6966 2073 656c  :.        if sel
-000003c0: 662e 6669 6c65 4e61 6d65 3d3d 6f74 6865  f.fileName==othe
-000003d0: 722e 6669 6c65 4e61 6d65 2061 6e64 2073  r.fileName and s
-000003e0: 656c 662e 7365 7061 7261 746f 7220 3d3d  elf.separator ==
-000003f0: 206f 7468 6572 2e73 6570 6172 6174 6f72   other.separator
-00000400: 2061 6e64 2073 656c 662e 6865 6164 6572   and self.header
-00000410: 3d3d 6f74 6865 722e 6865 6164 6572 2061  ==other.header a
-00000420: 6e64 2073 656c 662e 6461 7465 7469 6d65  nd self.datetime
-00000430: 5f66 6f72 6d61 743d 3d6f 7468 6572 2e64  _format==other.d
-00000440: 6174 6574 696d 655f 666f 726d 6174 3a0a  atetime_format:.
-00000450: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00000460: 726e 2054 7275 650a 2020 2020 2020 2020  rn True.        
-00000470: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00000480: 2020 7265 7475 726e 2046 616c 7365 0a0a    return False..
-00000490: 6465 6620 6669 6e64 4669 656c 6428 6966  def findField(if
-000004a0: 646f 5f64 6963 742c 6b65 7973 293a 0a20  do_dict,keys):. 
-000004b0: 2020 2020 2020 2022 2222 204c 6f6f 6b73         """ Looks
-000004c0: 2066 6f72 2020 6b65 7973 2028 226b 6579   for  keys ("key
-000004d0: 2220 6f72 205b 6b65 7931 2c6b 6579 325d  " or [key1,key2]
-000004e0: 2920 696e 2069 6664 6f5f 6469 6374 2061  ) in ifdo_dict a
-000004f0: 6e64 2072 6574 7572 6e73 2069 7473 2076  nd returns its v
-00000500: 616c 7565 206f 7220 616e 2065 6d70 7479  alue or an empty
-00000510: 2073 7472 696e 6720 6966 206b 6579 206e   string if key n
-00000520: 6f74 2066 6f75 6e64 2222 220a 2020 2020  ot found""".    
-00000530: 2020 2020 6966 206e 6f74 2069 7369 6e73      if not isins
-00000540: 7461 6e63 6528 6b65 7973 2c20 6c69 7374  tance(keys, list
-00000550: 293a 0a20 2020 2020 2020 2020 2020 206b  ):.            k
-00000560: 6579 7320 3d20 5b6b 6579 735d 0a0a 2020  eys = [keys]..  
-00000570: 2020 2020 2020 6172 203d 2069 6664 6f5f        ar = ifdo_
-00000580: 6469 6374 0a20 2020 2020 2020 2066 6f72  dict.        for
-00000590: 206b 2069 6e20 6b65 7973 3a0a 2020 2020   k in keys:.    
-000005a0: 2020 2020 2020 2020 6966 206b 2069 6e20          if k in 
-000005b0: 6172 3a0a 2020 2020 2020 2020 2020 2020  ar:.            
-000005c0: 2020 2020 6172 203d 2061 725b 6b5d 0a20      ar = ar[k]. 
-000005d0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-000005e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000005f0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-00000600: 2020 2020 2020 2020 2020 6b20 3d20 696e            k = in
-00000610: 7428 6b29 0a20 2020 2020 2020 2020 2020  t(k).           
-00000620: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-00000630: 6973 696e 7374 616e 6365 2861 722c 6c69  isinstance(ar,li
-00000640: 7374 2920 6f72 206c 656e 2861 7229 203c  st) or len(ar) <
-00000650: 206b 3a0a 2020 2020 2020 2020 2020 2020   k:.            
-00000660: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00000670: 6520 5661 6c75 6545 7272 6f72 2822 496e  e ValueError("In
-00000680: 6465 7822 2c6b 2c22 6f75 7420 6f66 2062  dex",k,"out of b
-00000690: 6f75 6e64 7322 2c6c 656e 2861 7229 290a  ounds",len(ar)).
-000006a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000006b0: 6578 6365 7074 3a0a 2020 2020 2020 2020  except:.        
-000006c0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000006d0: 726e 2022 220a 2020 2020 2020 2020 2020  rn "".          
-000006e0: 2020 2020 2020 6172 203d 2061 725b 6b5d        ar = ar[k]
-000006f0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00000700: 6172 0a0a 0a63 6c61 7373 2069 4644 4f5f  ar...class iFDO_
-00000710: 5265 6164 6572 3a0a 2020 2020 2220 5072  Reader:.    " Pr
-00000720: 6f76 6964 6573 2063 6f6e 7665 6e69 656e  ovides convenien
-00000730: 7420 6675 6e63 7469 6f6e 7320 666f 7220  t functions for 
-00000740: 7265 6164 696e 6720 6461 7461 2066 726f  reading data fro
-00000750: 6d20 6946 444f 2066 696c 6573 2022 0a0a  m iFDO files "..
-00000760: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
-00000770: 2873 656c 662c 2069 4644 4f66 696c 653a  (self, iFDOfile:
-00000780: 7374 7229 3a0a 2020 2020 2020 2020 2220  str):.        " 
-00000790: 5072 6f76 6964 6573 2063 6f6e 7665 6e69  Provides conveni
-000007a0: 656e 7420 6675 6e63 7469 6f6e 7320 666f  ent functions fo
-000007b0: 7220 7265 6164 696e 6720 6461 7461 2066  r reading data f
-000007c0: 726f 6d20 6946 444f 2066 696c 6573 2022  rom iFDO files "
-000007d0: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
-000007e0: 2020 7365 6c66 2e69 4644 4f66 696c 6520    self.iFDOfile 
-000007f0: 3d20 6946 444f 6669 6c65 0a20 2020 2020  = iFDOfile.     
-00000800: 2020 206f 203d 206f 7065 6e28 7365 6c66     o = open(self
-00000810: 2e69 4644 4f66 696c 652c 2027 7227 290a  .iFDOfile, 'r').
-00000820: 2020 2020 2020 2020 7365 6c66 2e69 6664          self.ifd
-00000830: 6f20 3d20 7961 6d6c 2e6c 6f61 6428 6f2c  o = yaml.load(o,
-00000840: 2020 4c6f 6164 6572 3d79 616d 6c2e 434c    Loader=yaml.CL
-00000850: 6f61 6465 7229 0a20 2020 2020 2020 206f  oader).        o
-00000860: 2e63 6c6f 7365 2829 0a0a 0a20 2020 2064  .close()...    d
-00000870: 6566 205f 5f67 6574 6974 656d 5f5f 2873  ef __getitem__(s
-00000880: 656c 662c 206b 6579 7329 3a0a 2020 2020  elf, keys):.    
-00000890: 2020 2020 2222 2220 5265 7475 726e 7320      """ Returns 
-000008a0: 636f 7079 206f 6620 6368 6563 6b65 6420  copy of checked 
-000008b0: 6966 646f 2073 6574 206f 7220 6974 656d  ifdo set or item
-000008c0: 2066 6965 6c64 2076 616c 7565 2c20 616c   field value, al
-000008d0: 736f 2063 6f6e 7369 6465 726e 6720 6465  so considerng de
-000008e0: 6661 756c 7420 7661 6c75 6573 2066 726f  fault values fro
-000008f0: 6d20 6865 6164 6572 2e0a 2020 2020 2020  m header..      
-00000900: 2020 2020 2020 5573 6520 6b65 7973 2061        Use keys a
-00000910: 7320 652e 672e 2027 3c69 7465 6d3e 3a3c  s e.g. '<item>:<
-00000920: 6b65 793e 3a2e 2e2e 272e 2043 616e 2062  key>:...'. Can b
-00000930: 6520 7573 6564 2066 6f72 2068 6561 6465  e used for heade
-00000940: 7220 6669 656c 6473 2061 7320 7765 6c6c  r fields as well
-00000950: 2061 7320 6974 656d 2066 6965 6c64 732e   as item fields.
-00000960: 0a20 2020 2020 2020 2020 2020 2049 7465  .            Ite
-00000970: 6d20 696e 6465 7820 6361 6e20 6265 206c  m index can be l
-00000980: 6567 6c65 6374 6564 2c20 696e 2063 6173  eglected, in cas
-00000990: 6520 6f66 2076 6964 656f 2061 2064 6963  e of video a dic
-000009a0: 7420 7b3c 696d 6167 652d 6461 7461 7469  t {<image-datati
-000009b0: 6d65 3e3a 3c76 616c 7565 3e2c 2e2e 2e7d  me>:<value>,...}
-000009c0: 2069 7320 7265 7475 726e 6564 2e0a 2020   is returned..  
-000009d0: 2020 2020 2020 2020 2020 5261 6973 6573            Raises
-000009e0: 2049 6664 6f45 7863 6570 7469 6f6e 2069   IfdoException i
-000009f0: 6620 6974 656d 2064 6f65 7320 6e6f 7420  f item does not 
-00000a00: 6578 6973 742e 2022 2222 0a20 2020 2020  exist. """.     
-00000a10: 2020 206b 6579 7320 3d20 6b65 7973 2e73     keys = keys.s
-00000a20: 706c 6974 2827 3a27 290a 2020 2020 2020  plit(':').      
-00000a30: 2020 7265 7475 726e 2069 4644 4f2e 5f69    return iFDO._i
-00000a40: 4644 4f5f 5f67 6574 4669 656c 6456 616c  FDO__getFieldVal
-00000a50: 7565 2873 656c 662e 6966 646f 2c6b 6579  ue(self.ifdo,key
-00000a60: 7329 0a0a 0a20 2020 2064 6566 2067 6574  s)...    def get
-00000a70: 496d 6167 6573 506f 7369 7469 6f6e 7328  ImagesPositions(
-00000a80: 7365 6c66 2c69 6d61 6765 5f74 7970 6573  self,image_types
-00000a90: 3d6d 6971 7476 2e69 6d61 6765 5f74 7970  =miqtv.image_typ
-00000aa0: 6573 293a 0a20 2020 2020 2020 2022 2222  es):.        """
-00000ab0: 2052 6574 7572 6e73 2069 6d61 6765 7320   Returns images 
-00000ac0: 6669 7273 7420 706f 7369 7469 6f6e 2873  first position(s
-00000ad0: 2920 0a20 2020 2020 2020 2020 2020 2040  ) .            @
-00000ae0: 7265 7475 726e 3a20 7b27 696d 6167 654e  return: {'imageN
-00000af0: 616d 6527 3a20 5b7b 276c 6174 273a 2076  ame': [{'lat': v
-00000b00: 616c 7565 2c20 276c 6f6e 273a 2076 616c  alue, 'lon': val
-00000b10: 7565 2c20 2764 6174 6574 696d 6527 3a20  ue, 'datetime': 
-00000b20: 7661 6c75 657d 5d7d 2c20 696d 6167 652d  value}]}, image-
-00000b30: 636f 6f72 6469 6e61 7465 2d72 6566 6572  coordinate-refer
-00000b40: 656e 6365 2d73 7973 7465 6d20 2222 220a  ence-system """.
-00000b50: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-00000b60: 2072 6574 4469 6374 203d 207b 7d0a 2020   retDict = {}.  
-00000b70: 2020 2020 2020 7265 7452 6566 7379 7320        retRefsys 
-00000b80: 3d20 7365 6c66 2e69 6664 6f5b 6d69 7174  = self.ifdo[miqt
-00000b90: 762e 696d 6167 655f 7365 745f 6865 6164  v.image_set_head
-00000ba0: 6572 5f6b 6579 5d5b 2769 6d61 6765 2d63  er_key]['image-c
-00000bb0: 6f6f 7264 696e 6174 652d 7265 6665 7265  oordinate-refere
-00000bc0: 6e63 652d 7379 7374 656d 275d 0a0a 2020  nce-system']..  
-00000bd0: 2020 2020 2020 6865 6164 6572 5661 6c4c        headerValL
-00000be0: 6174 203d 204e 6f6e 650a 2020 2020 2020  at = None.      
-00000bf0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-00000c00: 2020 2068 6561 6465 7256 616c 4c61 7420     headerValLat 
-00000c10: 3d20 7365 6c66 2e69 6664 6f5b 6d69 7174  = self.ifdo[miqt
-00000c20: 762e 696d 6167 655f 7365 745f 6865 6164  v.image_set_head
-00000c30: 6572 5f6b 6579 5d5b 2769 6d61 6765 2d6c  er_key]['image-l
-00000c40: 6174 6974 7564 6527 5d0a 2020 2020 2020  atitude'].      
-00000c50: 2020 6578 6365 7074 204b 6579 4572 726f    except KeyErro
-00000c60: 723a 0a20 2020 2020 2020 2020 2020 2070  r:.            p
-00000c70: 6173 730a 0a20 2020 2020 2020 2068 6561  ass..        hea
-00000c80: 6465 7256 616c 4c6f 6e20 3d20 4e6f 6e65  derValLon = None
-00000c90: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-00000ca0: 2020 2020 2020 2020 2020 6865 6164 6572            header
-00000cb0: 5661 6c4c 6f6e 203d 2073 656c 662e 6966  ValLon = self.if
-00000cc0: 646f 5b6d 6971 7476 2e69 6d61 6765 5f73  do[miqtv.image_s
-00000cd0: 6574 5f68 6561 6465 725f 6b65 795d 5b27  et_header_key]['
-00000ce0: 696d 6167 652d 6c6f 6e67 6974 7564 6527  image-longitude'
-00000cf0: 5d0a 2020 2020 2020 2020 6578 6365 7074  ].        except
-00000d00: 204b 6579 4572 726f 723a 0a20 2020 2020   KeyError:.     
-00000d10: 2020 2020 2020 2070 6173 730a 0a0a 2020         pass...  
-00000d20: 2020 2020 2020 666f 7220 6669 6c65 4e61        for fileNa
-00000d30: 6d65 2069 6e20 7365 6c66 2e69 6664 6f5b  me in self.ifdo[
-00000d40: 6d69 7174 762e 696d 6167 655f 7365 745f  miqtv.image_set_
-00000d50: 6974 656d 735f 6b65 795d 3a0a 2020 2020  items_key]:.    
-00000d60: 2020 2020 2020 2020 6966 2066 696c 654e          if fileN
-00000d70: 616d 652e 7370 6c69 7428 272e 2729 5b2d  ame.split('.')[-
-00000d80: 315d 2e6c 6f77 6572 2829 2069 6e20 696d  1].lower() in im
-00000d90: 6167 655f 7479 7065 733a 0a20 2020 2020  age_types:.     
-00000da0: 2020 2020 2020 2020 2020 2072 6574 4469             retDi
-00000db0: 6374 5b66 696c 654e 616d 655d 203d 2073  ct[fileName] = s
-00000dc0: 656c 662e 5f5f 6765 7449 7465 6d4c 6174  elf.__getItemLat
-00000dd0: 4c6f 6e28 6669 6c65 4e61 6d65 2c68 6561  Lon(fileName,hea
-00000de0: 6465 7256 616c 4c61 742c 6865 6164 6572  derValLat,header
-00000df0: 5661 6c4c 6f6e 290a 0a20 2020 2020 2020  ValLon)..       
-00000e00: 2072 6574 7572 6e20 7265 7444 6963 742c   return retDict,
-00000e10: 2072 6574 5265 6673 7973 0a0a 0a20 2020   retRefsys...   
-00000e20: 2064 6566 2077 7269 7465 576f 726c 6446   def writeWorldF
-00000e30: 696c 6573 466f 7250 686f 746f 7328 7365  ilesForPhotos(se
-00000e40: 6c66 2c64 6573 7444 6972 3a73 7472 2c69  lf,destDir:str,i
-00000e50: 6d61 6765 536f 7572 6365 4469 723a 7374  mageSourceDir:st
-00000e60: 7229 3a0a 2020 2020 2020 2020 2222 2220  r):.        """ 
-00000e70: 5772 6974 6573 2077 6f72 6c64 2066 696c  Writes world fil
-00000e80: 6573 2066 6f72 2070 686f 746f 7320 6966  es for photos if
-00000e90: 2061 6c6c 2072 6571 7569 7265 6420 6669   all required fi
-00000ea0: 656c 6473 2061 7265 2074 6865 7265 2075  elds are there u
-00000eb0: 6e64 6572 2074 6865 2061 7373 756d 7074  nder the assumpt
-00000ec0: 696f 6e20 7468 6174 2074 6865 2063 616d  ion that the cam
-00000ed0: 6572 6120 7761 7320 6c6f 6f6b 696e 6720  era was looking 
-00000ee0: 7374 7261 6967 6874 2064 6f77 6e20 2870  straight down (p
-00000ef0: 6974 6368 2061 6e64 2072 6f6c 6c20 6172  itch and roll ar
-00000f00: 6520 6967 6e6f 7265 6421 292e 200a 2020  e ignored!). .  
-00000f10: 2020 2020 2020 2020 2020 5265 7475 726e            Return
-00000f20: 7320 6120 6c69 7374 206f 6620 6974 656d  s a list of item
-00000f30: 7320 666f 7220 7768 6963 6820 6372 6561  s for which crea
-00000f40: 7469 6f6e 2066 6169 6c65 643a 205b 5b69  tion failed: [[i
-00000f50: 7465 6d2c 6d73 675d 2c2e 2e2e 5d22 2222  tem,msg],...]"""
-00000f60: 0a0a 2020 2020 2020 2020 2320 544f 444f  ..        # TODO
-00000f70: 2067 6574 2069 6d61 6765 7320 6f6e 6c69   get images onli
-00000f80: 6e65 2066 726f 6d20 6272 6f6b 6572 0a0a  ne from broker..
-00000f90: 2020 2020 2020 2020 6946 444f 6578 6365          iFDOexce
-00000fa0: 7074 696f 6e73 203d 205b 5d0a 0a20 2020  ptions = []..   
-00000fb0: 2020 2020 2023 2067 6574 2069 6d61 6765       # get image
-00000fc0: 7320 706f 7369 7469 6f6e 0a20 2020 2020  s position.     
-00000fd0: 2020 2070 6f73 6974 696f 6e73 4c61 744c     positionsLatL
-00000fe0: 6f6e 2c20 7265 6673 7973 203d 2073 656c  on, refsys = sel
-00000ff0: 662e 6765 7449 6d61 6765 7350 6f73 6974  f.getImagesPosit
-00001000: 696f 6e73 2869 6d61 6765 5f74 7970 6573  ions(image_types
-00001010: 3d6d 6971 7476 2e70 686f 746f 5f74 7970  =miqtv.photo_typ
-00001020: 6573 290a 2020 2020 2020 2020 6372 7346  es).        crsF
-00001030: 6965 6c64 546d 7020 3d20 2727 2e6a 6f69  ieldTmp = ''.joi
-00001040: 6e28 6520 666f 7220 6520 696e 2072 6566  n(e for e in ref
-00001050: 7379 7320 6966 2065 2e69 7361 6c6e 756d  sys if e.isalnum
-00001060: 2829 292e 6c6f 7765 7228 290a 2020 2020  ()).lower().    
-00001070: 2020 2020 6966 2063 7273 4669 656c 6454      if crsFieldT
-00001080: 6d70 203d 3d20 2777 6773 3834 2720 6f72  mp == 'wgs84' or
-00001090: 2063 7273 4669 656c 6454 6d70 203d 3d20   crsFieldTmp == 
-000010a0: 2765 7073 6734 3332 3627 3a0a 2020 2020  'epsg4326':.    
-000010b0: 2020 2020 2020 2020 7265 6673 7973 203d          refsys =
-000010c0: 2022 5747 5338 3422 0a20 2020 2020 2020   "WGS84".       
-000010d0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-000010e0: 2020 2069 4644 4f65 7863 6570 7469 6f6e     iFDOexception
-000010f0: 732e 6170 7065 6e64 285b 2222 2c22 436f  s.append(["","Co
-00001100: 6f72 6469 6e61 7465 7320 7265 6665 7265  ordinates refere
-00001110: 6e63 6520 7379 7374 656d 205c 2222 202b  nce system \"" +
-00001120: 2072 6566 7379 7320 2b20 225c 2220 6361   refsys + "\" ca
-00001130: 6e20 6e6f 7420 6265 2068 616e 646c 6564  n not be handled
-00001140: 2e20 5573 6520 7072 6566 6572 6162 6c79  . Use preferably
-00001150: 2045 5053 473a 3433 3236 206f 7220 5747   EPSG:4326 or WG
-00001160: 5338 3422 5d29 0a20 2020 2020 2020 2020  S84"]).         
-00001170: 2020 2072 6574 7572 6e20 6946 444f 6578     return iFDOex
-00001180: 6365 7074 696f 6e73 0a0a 0a20 2020 2020  ceptions...     
-00001190: 2020 2066 6f72 2070 686f 746f 2069 6e20     for photo in 
-000011a0: 706f 7369 7469 6f6e 734c 6174 4c6f 6e3a  positionsLatLon:
-000011b0: 0a20 2020 2020 2020 2020 2020 2074 7279  .            try
-000011c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000011d0: 2020 7365 6c66 2e63 6865 636b 4974 656d    self.checkItem
-000011e0: 4861 7368 2870 686f 746f 2c69 6d61 6765  Hash(photo,image
-000011f0: 536f 7572 6365 4469 7229 2023 2054 4f44  SourceDir) # TOD
-00001200: 4f20 636f 756c 6420 6265 2069 6e20 6469  O could be in di
-00001210: 6666 6572 656e 7420 7375 6266 6f6c 6465  fferent subfolde
-00001220: 7220 6f72 2066 726f 6d20 6f6e 6c69 6e65  r or from online
-00001230: 2062 726f 6b65 720a 0a20 2020 2020 2020   broker..       
-00001240: 2020 2020 2020 2020 2023 2063 6f6e 7665           # conve
-00001250: 7274 2074 6f20 7574 6d20 746f 2061 766f  rt to utm to avo
-00001260: 6964 2070 7265 6369 7369 6f6e 2069 7373  id precision iss
-00001270: 7565 2077 6974 6820 6c61 742f 6c6f 6e20  ue with lat/lon 
-00001280: 7661 6c75 6573 2069 6e20 776f 726c 6420  values in world 
-00001290: 6669 6c65 730a 2020 2020 2020 2020 2020  files.          
-000012a0: 2020 2020 2020 6c61 7420 3d20 706f 7369        lat = posi
-000012b0: 7469 6f6e 734c 6174 4c6f 6e5b 7068 6f74  tionsLatLon[phot
-000012c0: 6f5d 5b30 5d5b 276c 6174 275d 0a20 2020  o][0]['lat'].   
-000012d0: 2020 2020 2020 2020 2020 2020 206c 6f6e               lon
-000012e0: 203d 2070 6f73 6974 696f 6e73 4c61 744c   = positionsLatL
-000012f0: 6f6e 5b70 686f 746f 5d5b 305d 5b27 6c6f  on[photo][0]['lo
-00001300: 6e27 5d0a 2020 2020 2020 2020 2020 2020  n'].            
-00001310: 2020 2020 6561 7374 696e 672c 6e6f 7274      easting,nort
-00001320: 6869 6e67 2c7a 6f6e 652c 6973 4e6f 7274  hing,zone,isNort
-00001330: 6820 3d20 6d69 7174 672e 6c61 744c 6f6e  h = miqtg.latLon
-00001340: 3275 746d 286c 6174 2c6c 6f6e 2c72 6566  2utm(lat,lon,ref
-00001350: 7379 7329 0a20 2020 2020 2020 2020 2020  sys).           
-00001360: 2020 2020 2065 7869 6620 3d20 7365 6c66       exif = self
-00001370: 2e5f 5f67 6574 4974 656d 4465 6661 756c  .__getItemDefaul
-00001380: 7456 616c 7565 2870 686f 746f 2c27 696d  tValue(photo,'im
-00001390: 6167 652d 6163 7175 6973 6974 696f 6e2d  age-acquisition-
-000013a0: 7365 7474 696e 6773 2729 2023 2054 4f44  settings') # TOD
-000013b0: 4f20 7768 6174 2069 6620 6e6f 7420 7468  O what if not th
-000013c0: 6572 653f 2072 6561 6420 6672 6f6d 2069  ere? read from i
-000013d0: 6d61 6765 2064 6972 6563 746c 793f 2053  mage directly? S
-000013e0: 686f 756c 6420 6265 2063 6865 636b 6564  hould be checked
-000013f0: 2069 6620 6861 7368 206d 6174 6368 6573   if hash matches
-00001400: 3f20 496d 6167 6520 636f 756c 6420 6861  ? Image could ha
-00001410: 7665 2062 6565 6e20 6372 6f70 7065 6420  ve been cropped 
-00001420: 6166 7465 7220 6946 444f 2063 7265 6174  after iFDO creat
-00001430: 696f 6e0a 2020 2020 2020 2020 2020 2020  ion.            
-00001440: 2020 2020 696d 6167 6557 6964 7468 203d      imageWidth =
-00001450: 2069 6e74 2873 7472 2865 7869 665b 2749   int(str(exif['I
-00001460: 6d61 6765 2057 6964 7468 275d 292e 7374  mage Width']).st
-00001470: 7269 7028 275c 2727 2929 0a20 2020 2020  rip('\'')).     
-00001480: 2020 2020 2020 2020 2020 2069 6d61 6765             image
-00001490: 4865 6967 6874 203d 2069 6e74 2873 7472  Height = int(str
-000014a0: 2865 7869 665b 2749 6d61 6765 2048 6569  (exif['Image Hei
-000014b0: 6768 7427 5d29 2e73 7472 6970 2827 5c27  ght']).strip('\'
-000014c0: 2729 290a 2020 2020 2020 2020 2020 2020  ')).            
-000014d0: 2020 2020 6865 6164 696e 6720 3d20 7365      heading = se
-000014e0: 6c66 2e5f 5f67 6574 4974 656d 4465 6661  lf.__getItemDefa
-000014f0: 756c 7456 616c 7565 2870 686f 746f 2c27  ultValue(photo,'
-00001500: 696d 6167 652d 6361 6d65 7261 2d79 6177  image-camera-yaw
-00001510: 2d64 6567 7265 6573 2729 0a20 2020 2020  -degrees').     
-00001520: 2020 2020 2020 2020 2020 2061 6c74 6974             altit
-00001530: 7564 6520 3d20 7365 6c66 2e5f 5f67 6574  ude = self.__get
-00001540: 4974 656d 4465 6661 756c 7456 616c 7565  ItemDefaultValue
-00001550: 2870 686f 746f 2c27 696d 6167 652d 6d65  (photo,'image-me
-00001560: 7465 7273 2d61 626f 7665 2d67 726f 756e  ters-above-groun
-00001570: 6427 290a 0a20 2020 2020 2020 2020 2020  d')..           
-00001580: 2020 2020 2064 6f6d 6550 6f72 742c 6d73       domePort,ms
-00001590: 6720 3d20 7365 6c66 2e5f 5f74 7279 4765  g = self.__tryGe
-000015a0: 7449 7344 6f6d 6550 6f72 7428 7068 6f74  tIsDomePort(phot
-000015b0: 6f29 0a20 2020 2020 2020 2020 2020 2020  o).             
-000015c0: 2020 2066 6f63 616c 4c65 6e67 6850 6978     focalLenghPix
-000015d0: 656c 732c 206d 7367 203d 2073 656c 662e  els, msg = self.
-000015e0: 5f5f 7472 7947 6574 466f 6361 6c4c 656e  __tryGetFocalLen
-000015f0: 6774 6849 6e50 6978 656c 7328 7068 6f74  gthInPixels(phot
-00001600: 6f2c 2064 6f6d 6550 6f72 7429 0a20 2020  o, domePort).   
-00001610: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00001620: 666f 6361 6c4c 656e 6768 5069 7865 6c73  focalLenghPixels
-00001630: 203d 3d20 5b2d 312c 2d31 5d20 6f72 2066   == [-1,-1] or f
-00001640: 6f63 616c 4c65 6e67 6850 6978 656c 7320  ocalLenghPixels 
-00001650: 3d3d 202d 313a 0a20 2020 2020 2020 2020  == -1:.         
-00001660: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00001670: 206d 6971 7463 2e49 6664 6f45 7863 6570   miqtc.IfdoExcep
-00001680: 7469 6f6e 286d 7367 290a 2020 2020 2020  tion(msg).      
-00001690: 2020 2020 2020 2020 2020 6d69 7174 672e            miqtg.
-000016a0: 7772 6974 6553 696d 706c 6555 746d 576f  writeSimpleUtmWo
-000016b0: 726c 6446 696c 6528 6f73 2e70 6174 682e  rldFile(os.path.
-000016c0: 6a6f 696e 2864 6573 7444 6972 2c6d 6971  join(destDir,miq
-000016d0: 7467 2e63 6f6e 7665 7274 496d 6167 654e  tg.convertImageN
-000016e0: 616d 6554 6f57 6f72 6c64 4669 6c65 4e61  ameToWorldFileNa
-000016f0: 6d65 2870 686f 746f 2929 2c65 6173 7469  me(photo)),easti
-00001700: 6e67 2c6e 6f72 7468 696e 672c 7a6f 6e65  ng,northing,zone
-00001710: 2c69 734e 6f72 7468 2c69 6d61 6765 5769  ,isNorth,imageWi
-00001720: 6474 682c 696d 6167 6548 6569 6768 742c  dth,imageHeight,
-00001730: 6865 6164 696e 672c 616c 7469 7475 6465  heading,altitude
-00001740: 2c66 6f63 616c 4c65 6e67 6850 6978 656c  ,focalLenghPixel
-00001750: 735b 305d 2c66 6f63 616c 4c65 6e67 6850  s[0],focalLenghP
-00001760: 6978 656c 735b 315d 290a 2020 2020 2020  ixels[1]).      
-00001770: 2020 2020 2020 6578 6365 7074 206d 6971        except miq
-00001780: 7463 2e49 6664 6f45 7863 6570 7469 6f6e  tc.IfdoException
-00001790: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
-000017a0: 2020 2020 2020 2069 4644 4f65 7863 6570         iFDOexcep
-000017b0: 7469 6f6e 732e 6170 7065 6e64 285b 7068  tions.append([ph
-000017c0: 6f74 6f2c 7374 7228 652e 6172 6773 295d  oto,str(e.args)]
-000017d0: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
-000017e0: 6e20 6946 444f 6578 6365 7074 696f 6e73  n iFDOexceptions
-000017f0: 0a0a 0a20 2020 2064 6566 2063 6865 636b  ...    def check
-00001800: 4974 656d 4861 7368 2873 656c 662c 6974  ItemHash(self,it
-00001810: 656d 3a73 7472 2c66 696c 6544 6972 3a73  em:str,fileDir:s
-00001820: 7472 293a 0a20 2020 2020 2020 2022 2222  tr):.        """
-00001830: 2063 6f6d 7061 7265 7320 6669 6c65 2773   compares file's
-00001840: 2068 6173 6820 7769 7468 2068 6173 6820   hash with hash 
-00001850: 696e 2069 4644 4f20 616e 6420 7468 726f  in iFDO and thro
-00001860: 7773 2065 7863 6570 7469 6f6e 2069 6620  ws exception if 
-00001870: 7468 6579 2064 6f6e 2774 206d 6174 6368  they don't match
-00001880: 2022 2222 0a0a 2020 2020 2020 2020 6669   """..        fi
-00001890: 6c65 203d 206f 732e 7061 7468 2e6a 6f69  le = os.path.joi
-000018a0: 6e28 6669 6c65 4469 722c 6974 656d 290a  n(fileDir,item).
-000018b0: 2020 2020 2020 2020 6966 206e 6f74 206f          if not o
-000018c0: 732e 7061 7468 2e69 7366 696c 6528 6669  s.path.isfile(fi
-000018d0: 6c65 293a 0a20 2020 2020 2020 2020 2020  le):.           
-000018e0: 2072 6169 7365 206d 6971 7463 2e49 6664   raise miqtc.Ifd
-000018f0: 6f45 7863 6570 7469 6f6e 2822 4669 6c65  oException("File
-00001900: 205c 2222 202b 2069 7465 6d20 2b20 225c   \"" + item + "\
-00001910: 2220 6e6f 7420 666f 756e 6420 696e 2064  " not found in d
-00001920: 6972 205c 2222 202b 2066 696c 6544 6972  ir \"" + fileDir
-00001930: 202b 2022 5c22 2229 0a0a 2020 2020 2020   + "\"")..      
-00001940: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-00001950: 7365 6c66 2e69 6664 6f5b 6d69 7174 762e  self.ifdo[miqtv.
-00001960: 696d 6167 655f 7365 745f 6974 656d 735f  image_set_items_
-00001970: 6b65 795d 5b69 7465 6d5d 2c6c 6973 7429  key][item],list)
-00001980: 3a20 2320 696e 2063 6173 6520 6f66 2076  : # in case of v
-00001990: 6964 656f 2077 6974 6820 6974 656d 2061  ideo with item a
-000019a0: 7320 6c69 7374 2074 6865 2066 6972 7374  s list the first
-000019b0: 2065 6e74 7279 2068 6f6c 6473 2074 6865   entry holds the
-000019c0: 2064 6566 6175 6c74 2061 6e64 2074 6865   default and the
-000019d0: 2068 6173 6820 6361 6e6e 6f74 2076 6172   hash cannot var
-000019e0: 7920 666f 7220 7468 6520 7361 6d65 2069  y for the same i
-000019f0: 6d61 6765 0a20 2020 2020 2020 2020 2020  mage.           
-00001a00: 2069 7465 6d45 6e74 7279 203d 2073 656c   itemEntry = sel
-00001a10: 662e 6966 646f 5b6d 6971 7476 2e69 6d61  f.ifdo[miqtv.ima
-00001a20: 6765 5f73 6574 5f69 7465 6d73 5f6b 6579  ge_set_items_key
-00001a30: 5d5b 6974 656d 5d5b 305d 200a 2020 2020  ][item][0] .    
-00001a40: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00001a50: 2020 2020 2020 6974 656d 456e 7472 7920        itemEntry 
-00001a60: 3d20 7365 6c66 2e69 6664 6f5b 6d69 7174  = self.ifdo[miqt
-00001a70: 762e 696d 6167 655f 7365 745f 6974 656d  v.image_set_item
-00001a80: 735f 6b65 795d 5b69 7465 6d5d 0a20 2020  s_key][item].   
-00001a90: 2020 2020 2069 6620 6e6f 7420 6974 656d       if not item
-00001aa0: 456e 7472 795b 2769 6d61 6765 2d68 6173  Entry['image-has
-00001ab0: 682d 7368 6132 3536 275d 203d 3d20 6d69  h-sha256'] == mi
-00001ac0: 7174 632e 7368 6132 3536 4861 7368 4669  qtc.sha256HashFi
-00001ad0: 6c65 2866 696c 6529 3a0a 2020 2020 2020  le(file):.      
-00001ae0: 2020 2020 2020 7261 6973 6520 6d69 7174        raise miqt
-00001af0: 632e 4966 646f 4578 6365 7074 696f 6e28  c.IfdoException(
-00001b00: 6974 656d 2c20 2269 4644 4f20 656e 7472  item, "iFDO entr
-00001b10: 7920 6973 206e 6f74 2075 7020 746f 2064  y is not up to d
-00001b20: 6174 652c 2069 6d61 6765 2068 6173 6820  ate, image hash 
-00001b30: 646f 6573 206e 6f74 206d 6174 6368 2e22  does not match."
-00001b40: 290a 0a20 2020 2064 6566 2067 6574 496d  )..    def getIm
-00001b50: 6167 6544 6972 6563 746f 7279 2873 656c  ageDirectory(sel
-00001b60: 6629 3a0a 2020 2020 2020 2020 2222 2220  f):.        """ 
-00001b70: 5265 7475 726e 7320 7468 6520 6c6f 7765  Returns the lowe
-00001b80: 726d 6f73 7420 6c6f 6361 6c20 6469 7265  rmost local dire
-00001b90: 6374 6f72 7920 636f 6e74 6169 6e69 6e67  ctory containing
-00001ba0: 2074 6865 2069 6d61 6765 2066 696c 6573   the image files
-00001bb0: 2069 6e66 6572 7265 6420 6672 6f6d 2027   inferred from '
-00001bc0: 696d 6167 652d 6c6f 6361 6c2d 7061 7468  image-local-path
-00001bd0: 272e 2049 6620 2769 6d61 6765 2d6c 6f63  '. If 'image-loc
-00001be0: 616c 2d70 6174 6827 206e 6f74 2070 726f  al-path' not pro
-00001bf0: 7669 6465 6420 666f 7220 616c 6c20 696d  vided for all im
-00001c00: 6167 6520 6974 656d 7320 7468 6520 6946  age items the iF
-00001c10: 444f 2773 2070 6172 656e 7420 6469 7265  DO's parent dire
-00001c20: 6374 6f72 7920 6973 2072 6574 7572 6e65  ctory is returne
-00001c30: 642e 2022 2222 0a20 2020 2020 2020 206c  d. """.        l
-00001c40: 6f63 616c 5061 7468 7320 3d20 5b5d 0a20  ocalPaths = []. 
-00001c50: 2020 2020 2020 2069 4644 4f46 696c 6550         iFDOFileP
-00001c60: 6172 656e 7444 6972 203d 206f 732e 7061  arentDir = os.pa
-00001c70: 7468 2e64 6972 6e61 6d65 286f 732e 7061  th.dirname(os.pa
-00001c80: 7468 2e64 6972 6e61 6d65 2873 656c 662e  th.dirname(self.
-00001c90: 6946 444f 6669 6c65 2929 0a20 2020 2020  iFDOfile)).     
-00001ca0: 2020 2066 6f72 2069 7465 6d20 696e 2073     for item in s
-00001cb0: 656c 662e 6966 646f 5b6d 6971 7476 2e69  elf.ifdo[miqtv.i
-00001cc0: 6d61 6765 5f73 6574 5f69 7465 6d73 5f6b  mage_set_items_k
-00001cd0: 6579 5d3a 0a20 2020 2020 2020 2020 2020  ey]:.           
-00001ce0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-00001cf0: 2020 2020 2020 6974 656d 4c6f 6361 6c50        itemLocalP
-00001d00: 6174 6820 3d20 7365 6c66 2e5f 5f67 6574  ath = self.__get
-00001d10: 4974 656d 4465 6661 756c 7456 616c 7565  ItemDefaultValue
-00001d20: 2869 7465 6d2c 2769 6d61 6765 2d6c 6f63  (item,'image-loc
-00001d30: 616c 2d70 6174 6827 290a 2020 2020 2020  al-path').      
-00001d40: 2020 2020 2020 6578 6365 7074 206d 6971        except miq
-00001d50: 7463 2e49 6664 6f45 7863 6570 7469 6f6e  tc.IfdoException
-00001d60: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00001d70: 2020 6974 656d 4c6f 6361 6c50 6174 6820    itemLocalPath 
-00001d80: 3d20 6946 444f 4669 6c65 5061 7265 6e74  = iFDOFileParent
-00001d90: 4469 720a 2020 2020 2020 2020 2020 2020  Dir.            
-00001da0: 6966 2069 7465 6d4c 6f63 616c 5061 7468  if itemLocalPath
-00001db0: 206e 6f74 2069 6e20 6c6f 6361 6c50 6174   not in localPat
-00001dc0: 6873 3a0a 2020 2020 2020 2020 2020 2020  hs:.            
-00001dd0: 2020 2020 6c6f 6361 6c50 6174 6873 2e61      localPaths.a
-00001de0: 7070 656e 6428 6974 656d 4c6f 6361 6c50  ppend(itemLocalP
-00001df0: 6174 6829 0a20 2020 2020 2020 2063 6f6d  ath).        com
-00001e00: 6d6f 6e50 6174 6820 3d20 6f73 2e70 6174  monPath = os.pat
-00001e10: 682e 636f 6d6d 6f6e 7061 7468 286c 6f63  h.commonpath(loc
-00001e20: 616c 5061 7468 7329 0a20 2020 2020 2020  alPaths).       
-00001e30: 2069 6620 6e6f 7420 6f73 2e70 6174 682e   if not os.path.
-00001e40: 6973 6162 7328 636f 6d6d 6f6e 5061 7468  isabs(commonPath
-00001e50: 293a 0a20 2020 2020 2020 2020 2020 2063  ):.            c
-00001e60: 6f6d 6d6f 6e50 6174 6820 3d20 6f73 2e70  ommonPath = os.p
-00001e70: 6174 682e 6e6f 726d 7061 7468 286f 732e  ath.normpath(os.
-00001e80: 7061 7468 2e6a 6f69 6e28 6f73 2e70 6174  path.join(os.pat
-00001e90: 682e 6469 726e 616d 6528 7365 6c66 2e69  h.dirname(self.i
-00001ea0: 4644 4f66 696c 6529 2c20 636f 6d6d 6f6e  FDOfile), common
-00001eb0: 5061 7468 2929 0a20 2020 2020 2020 2072  Path)).        r
-00001ec0: 6574 7572 6e20 636f 6d6d 6f6e 5061 7468  eturn commonPath
-00001ed0: 0a0a 0a20 2020 2064 6566 205f 5f74 7279  ...    def __try
-00001ee0: 4765 7449 7344 6f6d 6550 6f72 7428 7365  GetIsDomePort(se
-00001ef0: 6c66 2c69 7465 6d29 3a0a 2020 2020 2020  lf,item):.      
-00001f00: 2020 2222 2220 5472 6965 7320 746f 2072    """ Tries to r
-00001f10: 6561 6420 706f 7274 2074 7970 6520 6672  ead port type fr
-00001f20: 6f6d 2027 696d 6167 652d 6361 6d65 7261  om 'image-camera
-00001f30: 2d68 6f75 7369 6e67 2d76 6965 7770 6f72  -housing-viewpor
-00001f40: 7427 5b76 6965 7770 6f72 742d 7479 7065  t'[viewport-type
-00001f50: 5d20 6f72 2027 696d 6167 652d 666c 6174  ] or 'image-flat
-00001f60: 706f 7274 2d70 6172 616d 6574 6572 7327  port-parameters'
-00001f70: 2f27 696d 6167 652d 646f 6d65 706f 7274  /'image-domeport
-00001f80: 2d70 6172 616d 6574 6572 7327 200a 2020  -parameters' .  
-00001f90: 2020 2020 2020 2020 2020 5265 7475 726e            Return
-00001fa0: 7320 5472 7565 2c6d 7367 2069 6620 646f  s True,msg if do
-00001fb0: 6d65 2070 6f72 742c 2046 616c 7365 2c6d  me port, False,m
-00001fc0: 7367 2069 6620 666c 6174 2070 6f72 742c  sg if flat port,
-00001fd0: 204e 6f6e 652c 6d73 6720 6f74 6865 7277   None,msg otherw
-00001fe0: 6973 6520 2222 220a 0a20 2020 2020 2020  ise """..       
-00001ff0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-00002000: 2020 706f 7274 5479 7065 5374 7220 3d20    portTypeStr = 
-00002010: 7365 6c66 2e5f 5f67 6574 4974 656d 4465  self.__getItemDe
-00002020: 6661 756c 7456 616c 7565 2869 7465 6d2c  faultValue(item,
-00002030: 2769 6d61 6765 2d63 616d 6572 612d 686f  'image-camera-ho
-00002040: 7573 696e 672d 7669 6577 706f 7274 2729  using-viewport')
-00002050: 0a20 2020 2020 2020 2020 2020 2070 6f72  .            por
-00002060: 7454 7970 6553 7472 203d 2070 6f72 7454  tTypeStr = portT
-00002070: 7970 6553 7472 5b27 7669 6577 706f 7274  ypeStr['viewport
-00002080: 2d74 7970 6527 5d0a 2020 2020 2020 2020  -type'].        
-00002090: 2020 2020 6966 2027 646f 6d65 2720 696e      if 'dome' in
-000020a0: 2070 6f72 7454 7970 6553 7472 2e6c 6f77   portTypeStr.low
-000020b0: 6572 2829 2061 6e64 206e 6f74 2027 666c  er() and not 'fl
-000020c0: 6174 2720 696e 2070 6f72 7454 7970 6553  at' in portTypeS
-000020d0: 7472 2e6c 6f77 6572 2829 3a0a 2020 2020  tr.lower():.    
-000020e0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000020f0: 726e 2054 7275 652c 2250 6172 7365 6420  rn True,"Parsed 
-00002100: 6672 6f6d 2027 696d 6167 652d 6361 6d65  from 'image-came
-00002110: 7261 2d68 6f75 7369 6e67 2d76 6965 7770  ra-housing-viewp
-00002120: 6f72 7427 5b27 7669 6577 706f 7274 2d74  ort'['viewport-t
-00002130: 7970 6527 5d22 0a20 2020 2020 2020 2020  ype']".         
-00002140: 2020 2065 6c69 6620 6e6f 7420 2764 6f6d     elif not 'dom
-00002150: 6527 2069 6e20 706f 7274 5479 7065 5374  e' in portTypeSt
-00002160: 722e 6c6f 7765 7228 2920 616e 6420 2766  r.lower() and 'f
-00002170: 6c61 7427 2069 6e20 706f 7274 5479 7065  lat' in portType
-00002180: 5374 722e 6c6f 7765 7228 293a 0a20 2020  Str.lower():.   
-00002190: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-000021a0: 7572 6e20 4661 6c73 652c 2250 6172 7365  urn False,"Parse
-000021b0: 6420 6672 6f6d 2027 696d 6167 652d 6361  d from 'image-ca
-000021c0: 6d65 7261 2d68 6f75 7369 6e67 2d76 6965  mera-housing-vie
-000021d0: 7770 6f72 7427 5b27 7669 6577 706f 7274  wport'['viewport
-000021e0: 2d74 7970 6527 5d22 0a20 2020 2020 2020  -type']".       
-000021f0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00002200: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00002210: 6e20 4e6f 6e65 2c22 436f 756c 6420 6e6f  n None,"Could no
-00002220: 7420 7265 6164 2070 6f72 7420 7479 7065  t read port type
-00002230: 2066 726f 6d20 2769 6d61 6765 2d63 616d   from 'image-cam
-00002240: 6572 612d 686f 7573 696e 672d 7669 6577  era-housing-view
-00002250: 706f 7274 275b 2776 6965 7770 6f72 742d  port'['viewport-
-00002260: 7479 7065 275d 2069 6e20 6974 656d 3a20  type'] in item: 
-00002270: 2220 2b20 6974 656d 0a20 2020 2020 2020  " + item.       
-00002280: 2065 7863 6570 7420 286d 6971 7463 2e49   except (miqtc.I
-00002290: 6664 6f45 7863 6570 7469 6f6e 2c20 4b65  fdoException, Ke
-000022a0: 7945 7272 6f72 293a 0a20 2020 2020 2020  yError):.       
-000022b0: 2020 2020 2070 6173 730a 0a20 2020 2020       pass..     
-000022c0: 2020 2066 6c61 7450 6f72 7450 6172 616d     flatPortParam
-000022d0: 7346 6f75 6e64 203d 2046 616c 7365 0a20  sFound = False. 
-000022e0: 2020 2020 2020 2074 7279 3a20 0a20 2020         try: .   
-000022f0: 2020 2020 2020 2020 2066 6c61 7450 6f72           flatPor
-00002300: 7450 6172 616d 7320 3d20 7365 6c66 2e5f  tParams = self._
-00002310: 5f67 6574 4974 656d 4465 6661 756c 7456  _getItemDefaultV
-00002320: 616c 7565 2869 7465 6d2c 2769 6d61 6765  alue(item,'image
-00002330: 2d66 6c61 7470 6f72 742d 7061 7261 6d65  -flatport-parame
-00002340: 7465 7273 2729 0a20 2020 2020 2020 2020  ters').         
-00002350: 2020 2066 6c61 7450 6f72 7450 6172 616d     flatPortParam
-00002360: 7346 6f75 6e64 203d 2054 7275 650a 2020  sFound = True.  
-00002370: 2020 2020 2020 6578 6365 7074 206d 6971        except miq
-00002380: 7463 2e49 6664 6f45 7863 6570 7469 6f6e  tc.IfdoException
-00002390: 3a0a 2020 2020 2020 2020 2020 2020 7061  :.            pa
-000023a0: 7373 0a20 2020 2020 2020 2064 6f6d 6550  ss.        domeP
-000023b0: 6f72 7450 6172 616d 7346 6f75 6e64 203d  ortParamsFound =
-000023c0: 2046 616c 7365 0a20 2020 2020 2020 2074   False.        t
-000023d0: 7279 3a20 0a20 2020 2020 2020 2020 2020  ry: .           
-000023e0: 2064 6f6d 6550 6f72 7450 6172 616d 7320   domePortParams 
-000023f0: 3d20 7365 6c66 2e5f 5f67 6574 4974 656d  = self.__getItem
-00002400: 4465 6661 756c 7456 616c 7565 2869 7465  DefaultValue(ite
-00002410: 6d2c 2769 6d61 6765 2d64 6f6d 6570 6f72  m,'image-domepor
-00002420: 742d 7061 7261 6d65 7465 7273 2729 0a20  t-parameters'). 
-00002430: 2020 2020 2020 2020 2020 2064 6f6d 6550             domeP
-00002440: 6f72 7450 6172 616d 7346 6f75 6e64 203d  ortParamsFound =
-00002450: 2054 7275 650a 2020 2020 2020 2020 6578   True.        ex
-00002460: 6365 7074 206d 6971 7463 2e49 6664 6f45  cept miqtc.IfdoE
-00002470: 7863 6570 7469 6f6e 3a0a 2020 2020 2020  xception:.      
-00002480: 2020 2020 2020 7061 7373 0a0a 2020 2020        pass..    
-00002490: 2020 2020 6966 2066 6c61 7450 6f72 7450      if flatPortP
-000024a0: 6172 616d 7346 6f75 6e64 2061 6e64 2064  aramsFound and d
-000024b0: 6f6d 6550 6f72 7450 6172 616d 7346 6f75  omePortParamsFou
-000024c0: 6e64 3a0a 2020 2020 2020 2020 2020 2020  nd:.            
-000024d0: 7265 7475 726e 204e 6f6e 652c 2243 6f75  return None,"Cou
-000024e0: 6c64 206e 6f74 2072 6561 6420 706f 7274  ld not read port
-000024f0: 2074 7970 6520 6672 6f6d 2069 7465 6d20   type from item 
-00002500: 6173 2069 7420 636f 6e74 6169 6e73 2069  as it contains i
-00002510: 6e66 6f20 6f6e 2062 6f74 6820 666c 6174  nfo on both flat
-00002520: 2061 6e64 2064 6f6d 6520 706f 7274 3a20   and dome port: 
-00002530: 2220 2b20 6974 656d 0a20 2020 2020 2020  " + item.       
-00002540: 2069 6620 666c 6174 506f 7274 5061 7261   if flatPortPara
-00002550: 6d73 466f 756e 643a 0a20 2020 2020 2020  msFound:.       
-00002560: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-00002570: 652c 2241 7373 756d 6564 2061 7320 666c  e,"Assumed as fl
-00002580: 6174 2070 6f72 7420 6173 2027 696d 6167  at port as 'imag
-00002590: 652d 666c 6174 706f 7274 2d70 6172 616d  e-flatport-param
-000025a0: 6574 6572 7327 2066 6f75 6e64 2069 6e20  eters' found in 
-000025b0: 6974 656d 3a20 2220 2b20 6974 656d 0a20  item: " + item. 
-000025c0: 2020 2020 2020 2069 6620 646f 6d65 506f         if domePo
-000025d0: 7274 5061 7261 6d73 466f 756e 643a 0a20  rtParamsFound:. 
-000025e0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-000025f0: 6e20 5472 7565 2c22 4173 7375 6d65 6420  n True,"Assumed 
-00002600: 6173 2064 6f6d 6520 706f 7274 2061 7320  as dome port as 
-00002610: 2769 6d61 6765 2d64 6f6d 6570 6f72 742d  'image-domeport-
-00002620: 7061 7261 6d65 7465 7273 2720 666f 756e  parameters' foun
-00002630: 6420 696e 2069 7465 6d3a 2022 202b 2069  d in item: " + i
-00002640: 7465 6d0a 2020 2020 2020 2020 7265 7475  tem.        retu
-00002650: 726e 204e 6f6e 652c 2243 6f75 6c64 206e  rn None,"Could n
-00002660: 6f74 2072 6561 6420 706f 7274 2074 7970  ot read port typ
-00002670: 6520 6672 6f6d 2069 7465 6d3a 2022 202b  e from item: " +
-00002680: 2069 7465 6d0a 0a0a 2020 2020 6465 6620   item...    def 
-00002690: 5f5f 7472 7947 6574 466f 6361 6c4c 656e  __tryGetFocalLen
-000026a0: 6774 6849 6e50 6978 656c 7328 7365 6c66  gthInPixels(self
-000026b0: 2c69 7465 6d3a 7374 722c 646f 6d65 506f  ,item:str,domePo
-000026c0: 7274 3d4e 6f6e 6529 3a0a 2020 2020 2020  rt=None):.      
-000026d0: 2020 2222 2220 0a20 2020 2020 2020 2054    """ .        T
-000026e0: 7269 6573 2074 6f20 7265 6164 2f64 6574  ries to read/det
-000026f0: 6572 6d69 6e65 2066 6f63 616c 206c 656e  ermine focal len
-00002700: 6774 6820 696e 2070 6978 656c 7320 6569  gth in pixels ei
-00002710: 7468 6572 2066 726f 6d20 2769 6d61 6765  ther from 'image
-00002720: 2d63 616d 6572 612d 6361 6c69 6272 6174  -camera-calibrat
-00002730: 696f 6e2d 6d6f 6465 6c27 5b27 6361 6c69  ion-model'['cali
-00002740: 6272 6174 696f 6e2d 666f 6361 6c2d 6c65  bration-focal-le
-00002750: 6e67 7468 2d78 792d 7069 7865 6c27 5d20  ngth-xy-pixel'] 
-00002760: 6f72 2066 726f 6d20 6578 6966 2076 616c  or from exif val
-00002770: 7565 732e 0a20 2020 2020 2020 2069 6620  ues..        if 
-00002780: 646f 6d65 506f 7274 203d 2046 616c 7365  domePort = False
-00002790: 2c20 666c 6174 2070 6f72 7420 6973 2061  , flat port is a
-000027a0: 7373 756d 6564 2061 6e64 2061 2063 6f72  ssumed and a cor
-000027b0: 7265 6374 696f 6e20 6661 6374 6f72 206f  rection factor o
-000027c0: 6620 312e 3333 2069 7320 6170 706c 6965  f 1.33 is applie
-000027d0: 6420 666f 7220 666f 6361 6c20 6c65 6e67  d for focal leng
-000027e0: 7468 2064 6574 6572 6d69 6e65 6420 6672  th determined fr
-000027f0: 6f6d 2065 7869 6620 7661 6c75 6573 0a20  om exif values. 
-00002800: 2020 2020 2020 2052 6574 7572 6e73 2065         Returns e
-00002810: 6974 6865 7220 666f 6361 6c4c 656e 6774  ither focalLengt
-00002820: 682c 206d 6573 7361 6765 206f 7220 5b66  h, message or [f
-00002830: 6f63 616c 4c65 6e67 7468 582c 666f 6361  ocalLengthX,foca
-00002840: 6c4c 656e 6774 6859 5d2c 206d 6573 7361  lLengthY], messa
-00002850: 6765 2e20 4966 2075 6e73 7563 6365 7373  ge. If unsuccess
-00002860: 6675 6c20 666f 6361 6c4c 656e 6774 6820  ful focalLength 
-00002870: 3d20 2d31 0a20 2020 2020 2020 2022 2222  = -1.        """
-00002880: 0a0a 2020 2020 2020 2020 2320 7472 7920  ..        # try 
-00002890: 7265 6164 2066 726f 6d20 2769 6d61 6765  read from 'image
-000028a0: 2d63 616d 6572 612d 6361 6c69 6272 6174  -camera-calibrat
-000028b0: 696f 6e2d 6d6f 6465 6c27 5b27 6361 6c69  ion-model'['cali
-000028c0: 6272 6174 696f 6e2d 666f 6361 6c2d 6c65  bration-focal-le
-000028d0: 6e67 7468 2d78 792d 7069 7865 6c27 5d0a  ngth-xy-pixel'].
-000028e0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-000028f0: 2020 2020 2020 2020 2066 6f63 616c 4c65           focalLe
-00002900: 6e67 7468 5859 203d 2073 656c 662e 5f5f  ngthXY = self.__
-00002910: 6765 7449 7465 6d44 6566 6175 6c74 5661  getItemDefaultVa
-00002920: 6c75 6528 6974 656d 2c27 696d 6167 652d  lue(item,'image-
-00002930: 6361 6d65 7261 2d63 616c 6962 7261 7469  camera-calibrati
-00002940: 6f6e 2d6d 6f64 656c 2729 0a20 2020 2020  on-model').     
-00002950: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-00002960: 2020 2020 2020 2020 2020 2020 666f 6361              foca
-00002970: 6c4c 656e 6774 6858 5920 3d20 666f 6361  lLengthXY = foca
-00002980: 6c4c 656e 6774 6858 595b 2763 616c 6962  lLengthXY['calib
-00002990: 7261 7469 6f6e 2d66 6f63 616c 2d6c 656e  ration-focal-len
-000029a0: 6774 682d 7879 2d70 6978 656c 275d 0a20  gth-xy-pixel']. 
-000029b0: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-000029c0: 7420 4b65 7945 7272 6f72 3a0a 2020 2020  t KeyError:.    
-000029d0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-000029e0: 6520 6d69 7174 632e 4966 646f 4578 6365  e miqtc.IfdoExce
-000029f0: 7074 696f 6e28 6974 656d 2c22 646f 6573  ption(item,"does
-00002a00: 206e 6f74 2063 6f6e 7461 696e 2027 696d   not contain 'im
-00002a10: 6167 652d 6361 6d65 7261 2d63 616c 6962  age-camera-calib
-00002a20: 7261 7469 6f6e 2d6d 6f64 656c 275b 2763  ration-model'['c
-00002a30: 616c 6962 7261 7469 6f6e 2d66 6f63 616c  alibration-focal
-00002a40: 2d6c 656e 6774 682d 7879 2d70 6978 656c  -length-xy-pixel
-00002a50: 275d 2229 0a0a 2020 2020 2020 2020 2020  ']")..          
-00002a60: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
-00002a70: 6e63 6528 666f 6361 6c4c 656e 6774 6858  nce(focalLengthX
-00002a80: 592c 6c69 7374 293a 2023 2078 2061 6e64  Y,list): # x and
-00002a90: 2079 2076 616c 7565 2061 7265 2069 6465   y value are ide
-00002aa0: 6e74 6963 616c 0a20 2020 2020 2020 2020  ntical.         
-00002ab0: 2020 2020 2020 2066 6f63 616c 4c65 6e67         focalLeng
-00002ac0: 7468 5859 203d 205b 666f 6361 6c4c 656e  thXY = [focalLen
-00002ad0: 6774 6858 592c 666f 6361 6c4c 656e 6774  gthXY,focalLengt
-00002ae0: 6858 595d 0a20 2020 2020 2020 2020 2020  hXY].           
-00002af0: 2069 6620 6c65 6e28 666f 6361 6c4c 656e   if len(focalLen
-00002b00: 6774 6858 5929 2021 3d20 323a 0a20 2020  gthXY) != 2:.   
-00002b10: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-00002b20: 7365 206d 6971 7463 2e49 6664 6f45 7863  se miqtc.IfdoExc
-00002b30: 6570 7469 6f6e 2869 7465 6d2c 2249 6e76  eption(item,"Inv
-00002b40: 616c 6964 2065 6e74 7279 2066 6f72 2027  alid entry for '
-00002b50: 696d 6167 652d 6361 6d65 7261 2d63 616c  image-camera-cal
-00002b60: 6962 7261 7469 6f6e 2d6d 6f64 656c 275b  ibration-model'[
-00002b70: 2763 616c 6962 7261 7469 6f6e 2d66 6f63  'calibration-foc
-00002b80: 616c 2d6c 656e 6774 682d 7879 2d70 6978  al-length-xy-pix
-00002b90: 656c 275d 203a 2022 202b 2073 7472 2866  el'] : " + str(f
-00002ba0: 6f63 616c 4c65 6e67 7468 5859 2920 290a  ocalLengthXY) ).
-00002bb0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00002bc0: 6e6f 7420 6973 696e 7374 616e 6365 2866  not isinstance(f
-00002bd0: 6f63 616c 4c65 6e67 7468 5859 5b30 5d2c  ocalLengthXY[0],
-00002be0: 666c 6f61 7429 206f 7220 6e6f 7420 6973  float) or not is
-00002bf0: 696e 7374 616e 6365 2866 6f63 616c 4c65  instance(focalLe
-00002c00: 6e67 7468 5859 5b30 5d2c 696e 7429 206f  ngthXY[0],int) o
-00002c10: 7220 6e6f 7420 6973 696e 7374 616e 6365  r not isinstance
-00002c20: 2866 6f63 616c 4c65 6e67 7468 5859 5b31  (focalLengthXY[1
-00002c30: 5d2c 666c 6f61 7429 206f 7220 6e6f 7420  ],float) or not 
-00002c40: 6973 696e 7374 616e 6365 2866 6f63 616c  isinstance(focal
-00002c50: 4c65 6e67 7468 5859 5b31 5d2c 696e 7429  LengthXY[1],int)
-00002c60: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00002c70: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-00002c80: 2020 2020 2020 2020 2020 2066 6f63 616c             focal
-00002c90: 4c65 6e67 7468 5859 203d 205b 666c 6f61  LengthXY = [floa
-00002ca0: 7428 666f 6361 6c4c 656e 6774 6858 595b  t(focalLengthXY[
-00002cb0: 305d 292c 666c 6f61 7428 666f 6361 6c4c  0]),float(focalL
-00002cc0: 656e 6774 6858 595b 315d 295d 0a20 2020  engthXY[1])].   
-00002cd0: 2020 2020 2020 2020 2020 2020 2065 7863               exc
-00002ce0: 6570 7420 5661 6c75 6545 7272 6f72 3a0a  ept ValueError:.
-00002cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002d00: 2020 2020 7261 6973 6520 6d69 7174 632e      raise miqtc.
-00002d10: 4966 646f 4578 6365 7074 696f 6e28 6974  IfdoException(it
-00002d20: 656d 2c22 496e 7661 6c69 6420 656e 7472  em,"Invalid entr
-00002d30: 7920 666f 7220 2769 6d61 6765 2d63 616d  y for 'image-cam
-00002d40: 6572 612d 6361 6c69 6272 6174 696f 6e2d  era-calibration-
-00002d50: 6d6f 6465 6c27 5b27 6361 6c69 6272 6174  model'['calibrat
-00002d60: 696f 6e2d 666f 6361 6c2d 6c65 6e67 7468  ion-focal-length
-00002d70: 2d78 792d 7069 7865 6c27 5d20 3a20 2220  -xy-pixel'] : " 
-00002d80: 2b20 7374 7228 666f 6361 6c4c 656e 6774  + str(focalLengt
-00002d90: 6858 5929 2029 0a20 2020 2020 2020 2020  hXY) ).         
-00002da0: 2020 200a 2020 2020 2020 2020 2020 2020     .            
-00002db0: 7265 7475 726e 2066 6f63 616c 4c65 6e67  return focalLeng
-00002dc0: 7468 5859 2c20 2250 6172 7365 6420 6672  thXY, "Parsed fr
-00002dd0: 6f6d 2027 696d 6167 652d 6361 6d65 7261  om 'image-camera
-00002de0: 2d63 616c 6962 7261 7469 6f6e 2d6d 6f64  -calibration-mod
-00002df0: 656c 275b 2763 616c 6962 7261 7469 6f6e  el'['calibration
-00002e00: 2d66 6f63 616c 2d6c 656e 6774 682d 7879  -focal-length-xy
-00002e10: 2d70 6978 656c 275d 220a 2020 2020 2020  -pixel']".      
-00002e20: 2020 6578 6365 7074 206d 6971 7463 2e49    except miqtc.I
-00002e30: 6664 6f45 7863 6570 7469 6f6e 3a0a 2020  fdoException:.  
-00002e40: 2020 2020 2020 2020 2020 7061 7373 0a0a            pass..
-00002e50: 2020 2020 2020 2020 756e 6465 7277 6174          underwat
-00002e60: 6572 496d 6167 6520 3d20 5472 7565 0a20  erImage = True. 
-00002e70: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-00002e80: 2020 2020 2020 2020 616c 7430 203d 2073          alt0 = s
-00002e90: 656c 665b 6974 656d 2b27 303a 696d 6167  elf[item+'0:imag
-00002ea0: 652d 616c 7469 7475 6465 2d6d 6574 6572  e-altitude-meter
-00002eb0: 7327 5d20 2373 656c 662e 5f5f 6765 7449  s'] #self.__getI
-00002ec0: 7465 6d44 6566 6175 6c74 5661 6c75 6528  temDefaultValue(
-00002ed0: 6974 656d 2c20 2769 6d61 6765 2d61 6c74  item, 'image-alt
-00002ee0: 6974 7564 652d 6d65 7465 7273 2729 0a20  itude-meters'). 
-00002ef0: 2020 2020 2020 2020 2020 2069 6620 616c             if al
-00002f00: 7430 203e 2030 3a0a 2020 2020 2020 2020  t0 > 0:.        
-00002f10: 2020 2020 2020 2020 756e 6465 7277 6174          underwat
-00002f20: 6572 496d 6167 6520 3d20 4661 6c73 650a  erImage = False.
-00002f30: 2020 2020 2020 2020 6578 6365 7074 206d          except m
-00002f40: 6971 7463 2e49 6664 6f45 7863 6570 7469  iqtc.IfdoExcepti
-00002f50: 6f6e 3a0a 2020 2020 2020 2020 2020 2020  on:.            
-00002f60: 7061 7373 0a0a 2020 2020 2020 2020 2320  pass..        # 
-00002f70: 6164 6420 636f 7272 6563 7469 6f6e 2066  add correction f
-00002f80: 6163 746f 7220 666f 7220 666c 6174 2070  actor for flat p
-00002f90: 6f72 740a 2020 2020 2020 2020 6966 2064  ort.        if d
-00002fa0: 6f6d 6550 6f72 7420 6973 204e 6f6e 6520  omePort is None 
-00002fb0: 616e 6420 756e 6465 7277 6174 6572 496d  and underwaterIm
-00002fc0: 6167 653a 0a20 2020 2020 2020 2020 2020  age:.           
-00002fd0: 2072 6574 7572 6e20 5b2d 312c 2d31 5d2c   return [-1,-1],
-00002fe0: 2022 436f 756c 6420 6e6f 7420 6465 7465   "Could not dete
-00002ff0: 726d 696e 6520 666f 6361 6c20 6c65 6e67  rmine focal leng
-00003000: 7468 2066 726f 6d20 2769 6d61 6765 2d63  th from 'image-c
-00003010: 616d 6572 612d 6361 6c69 6272 6174 696f  amera-calibratio
-00003020: 6e2d 6d6f 6465 6c27 5b27 6361 6c69 6272  n-model'['calibr
-00003030: 6174 696f 6e2d 666f 6361 6c2d 6c65 6e67  ation-focal-leng
-00003040: 7468 2d78 792d 7069 7865 6c27 5d20 616e  th-xy-pixel'] an
-00003050: 6420 706f 7274 2074 7970 652c 2077 6869  d port type, whi
-00003060: 6368 2069 7320 7265 7175 6972 6564 2066  ch is required f
-00003070: 6f72 2063 6f72 7265 6374 2065 7661 6c75  or correct evalu
-00003080: 6174 696f 6e20 6f66 2065 7869 6620 7661  ation of exif va
-00003090: 6c75 6573 2c20 6973 206e 6f74 2070 726f  lues, is not pro
-000030a0: 7669 6465 6421 220a 2020 2020 2020 2020  vided!".        
-000030b0: 636f 7272 6563 7469 6f6e 466b 7420 3d20  correctionFkt = 
-000030c0: 312e 300a 2020 2020 2020 2020 6966 2064  1.0.        if d
-000030d0: 6f6d 6550 6f72 7420 3d3d 2046 616c 7365  omePort == False
-000030e0: 2061 6e64 2075 6e64 6572 7761 7465 7249   and underwaterI
-000030f0: 6d61 6765 3a0a 2020 2020 2020 2020 2020  mage:.          
-00003100: 2020 636f 7272 6563 7469 6f6e 466b 7420    correctionFkt 
-00003110: 3d20 312e 3333 0a0a 2020 2020 2020 2020  = 1.33..        
-00003120: 2320 6f74 6865 7277 6973 6520 7472 7920  # otherwise try 
-00003130: 6465 7269 7665 2066 726f 6d20 6578 6966  derive from exif
-00003140: 2074 6167 730a 2020 2020 2020 2020 6578   tags.        ex
-00003150: 6966 203d 2073 656c 662e 5f5f 6765 7449  if = self.__getI
-00003160: 7465 6d44 6566 6175 6c74 5661 6c75 6528  temDefaultValue(
-00003170: 6974 656d 2c27 696d 6167 652d 6163 7175  item,'image-acqu
-00003180: 6973 6974 696f 6e2d 7365 7474 696e 6773  isition-settings
-00003190: 2729 0a20 2020 2020 2020 2023 2320 6672  ').        ## fr
-000031a0: 6f6d 2046 6f63 616c 204c 656e 6774 682c  om Focal Length,
-000031b0: 2046 6f63 616c 2050 6c61 6e65 2058 2052   Focal Plane X R
-000031c0: 6573 6f6c 7574 696f 6e2c 2046 6f63 616c  esolution, Focal
-000031d0: 2050 6c61 6e65 2059 2052 6573 6f6c 7574   Plane Y Resolut
-000031e0: 696f 6e2c 2046 6f63 616c 2050 6c61 6e65  ion, Focal Plane
-000031f0: 2052 6573 6f6c 7574 696f 6e20 556e 6974   Resolution Unit
-00003200: 0a20 2020 2020 2020 2066 6f63 616c 4c65  .        focalLe
-00003210: 6e67 7468 5859 2c20 6d73 6720 3d20 7365  ngthXY, msg = se
-00003220: 6c66 2e5f 5f74 7279 4465 7465 726d 696e  lf.__tryDetermin
-00003230: 6546 6f63 616c 4c65 6e67 6874 496e 5069  eFocalLenghtInPi
-00003240: 7865 6c73 4672 6f6d 4578 6966 5f31 2865  xelsFromExif_1(e
-00003250: 7869 6629 0a20 2020 2020 2020 2069 6620  xif).        if 
-00003260: 666f 6361 6c4c 656e 6774 6858 5920 213d  focalLengthXY !=
-00003270: 205b 2d31 2c2d 315d 3a0a 2020 2020 2020   [-1,-1]:.      
-00003280: 2020 2020 2020 7265 7475 726e 205b 652a        return [e*
-00003290: 636f 7272 6563 7469 6f6e 466b 7420 666f  correctionFkt fo
-000032a0: 7220 6520 696e 2066 6f63 616c 4c65 6e67  r e in focalLeng
-000032b0: 7468 5859 5d2c 2027 4465 7269 7665 6420  thXY], 'Derived 
-000032c0: 6672 6f6d 2065 7869 6620 7461 6773 2046  from exif tags F
-000032d0: 6f63 616c 204c 656e 6774 682c 2046 6f63  ocal Length, Foc
-000032e0: 616c 2050 6c61 6e65 2058 2052 6573 6f6c  al Plane X Resol
-000032f0: 7574 696f 6e2c 2046 6f63 616c 2050 6c61  ution, Focal Pla
-00003300: 6e65 2059 2052 6573 6f6c 7574 696f 6e2c  ne Y Resolution,
-00003310: 2046 6f63 616c 2050 6c61 6e65 2052 6573   Focal Plane Res
-00003320: 6f6c 7574 696f 6e20 556e 6974 270a 2020  olution Unit'.  
-00003330: 2020 2020 2020 2323 2066 726f 6d20 6672        ## from fr
-00003340: 6f6d 2033 3520 6d6d 2065 7175 6976 616c  om 35 mm equival
-00003350: 656e 7420 666f 6361 6c20 6c65 6e67 7468  ent focal length
-00003360: 0a20 2020 2020 2020 2066 6f63 616c 4c65  .        focalLe
-00003370: 6e67 7468 5859 2c20 6d73 6720 3d20 7365  ngthXY, msg = se
-00003380: 6c66 2e5f 5f74 7279 4465 7465 726d 696e  lf.__tryDetermin
-00003390: 6546 6f63 616c 4c65 6e67 6874 496e 5069  eFocalLenghtInPi
-000033a0: 7865 6c73 4672 6f6d 4578 6966 5f32 2865  xelsFromExif_2(e
-000033b0: 7869 6629 0a20 2020 2020 2020 2069 6620  xif).        if 
-000033c0: 666f 6361 6c4c 656e 6774 6858 5920 213d  focalLengthXY !=
-000033d0: 205b 2d31 2c2d 315d 3a0a 2020 2020 2020   [-1,-1]:.      
-000033e0: 2020 2020 2020 7265 7475 726e 205b 652a        return [e*
-000033f0: 636f 7272 6563 7469 6f6e 466b 7420 666f  correctionFkt fo
-00003400: 7220 6520 696e 2066 6f63 616c 4c65 6e67  r e in focalLeng
-00003410: 7468 5859 5d2c 2027 4465 7269 7665 6420  thXY], 'Derived 
-00003420: 6672 6f6d 2065 7869 6620 7461 6720 466f  from exif tag Fo
-00003430: 6361 6c20 4c65 6e67 7468 2077 6974 6820  cal Length with 
-00003440: 3335 206d 6d20 6571 7569 7661 6c65 6e74  35 mm equivalent
-00003450: 270a 200a 2020 2020 2020 2020 7265 7475  '. .        retu
-00003460: 726e 205b 2d31 2c2d 315d 2c20 2243 6f75  rn [-1,-1], "Cou
-00003470: 6c64 206e 6f74 2064 6574 6572 6d69 6e65  ld not determine
-00003480: 2066 726f 6d20 666f 6361 6c20 6c65 6e67   from focal leng
-00003490: 7468 2069 6e20 7069 7865 6c73 2066 726f  th in pixels fro
-000034a0: 6d20 6e65 6974 6865 7220 2769 6d61 6765  m neither 'image
-000034b0: 2d63 616d 6572 612d 6361 6c69 6272 6174  -camera-calibrat
-000034c0: 696f 6e2d 6d6f 6465 6c27 5b27 6361 6c69  ion-model'['cali
-000034d0: 6272 6174 696f 6e2d 666f 6361 6c2d 6c65  bration-focal-le
-000034e0: 6e67 7468 2d78 792d 7069 7865 6c27 5d20  ngth-xy-pixel'] 
-000034f0: 6e6f 7220 6578 6966 2074 6167 7320 466f  nor exif tags Fo
-00003500: 6361 6c20 4c65 6e67 7468 2c20 466f 6361  cal Length, Foca
-00003510: 6c20 506c 616e 6520 5820 5265 736f 6c75  l Plane X Resolu
-00003520: 7469 6f6e 2c20 466f 6361 6c20 506c 616e  tion, Focal Plan
-00003530: 6520 5920 5265 736f 6c75 7469 6f6e 2c20  e Y Resolution, 
-00003540: 466f 6361 6c20 506c 616e 6520 5265 736f  Focal Plane Reso
-00003550: 6c75 7469 6f6e 2055 6e69 7422 0a0a 0a20  lution Unit"... 
-00003560: 2020 2064 6566 205f 5f74 7279 4465 7465     def __tryDete
-00003570: 726d 696e 6546 6f63 616c 4c65 6e67 6874  rmineFocalLenght
-00003580: 496e 5069 7865 6c73 4672 6f6d 4578 6966  InPixelsFromExif
-00003590: 5f31 2873 656c 662c 6578 6966 4469 6374  _1(self,exifDict
-000035a0: 3a64 6963 7429 3a0a 2020 2020 2020 2020  :dict):.        
-000035b0: 2222 2220 7472 7920 746f 2064 6574 6572  """ try to deter
-000035c0: 6d69 6e65 2066 6f63 616c 206c 656e 6774  mine focal lengt
-000035d0: 6820 696e 2070 6978 656c 7320 6672 6f6d  h in pixels from
-000035e0: 2065 7869 6620 7461 6773 2046 6f63 616c   exif tags Focal
-000035f0: 204c 656e 6774 682c 2046 6f63 616c 2050   Length, Focal P
-00003600: 6c61 6e65 2058 2052 6573 6f6c 7574 696f  lane X Resolutio
-00003610: 6e2c 2046 6f63 616c 2050 6c61 6e65 2059  n, Focal Plane Y
-00003620: 2052 6573 6f6c 7574 696f 6e2c 2046 6f63   Resolution, Foc
-00003630: 616c 2050 6c61 6e65 2052 6573 6f6c 7574  al Plane Resolut
-00003640: 696f 6e20 556e 6974 2e0a 2020 2020 2020  ion Unit..      
-00003650: 2020 2020 2020 5265 7472 756e 7320 5b66        Retruns [f
-00003660: 6f63 616c 4c65 6e67 7468 5069 7865 6c73  ocalLengthPixels
-00003670: 5f78 2c66 6f63 616c 4c65 6e67 7468 5069  _x,focalLengthPi
-00003680: 7865 6c73 5f79 5d2c 206d 6573 7361 6765  xels_y], message
-00003690: 0a20 2020 2020 2020 2020 2020 2052 6574  .            Ret
-000036a0: 7275 6e73 2066 6f63 616c 4c65 6e67 7468  runs focalLength
-000036b0: 5069 7865 6c73 203d 202d 3120 6966 206e  Pixels = -1 if n
-000036c0: 6f74 2073 7563 6365 7373 6675 6c6c 2022  ot successfull "
-000036d0: 2222 0a0a 2020 2020 2020 2020 7472 793a  ""..        try:
-000036e0: 0a20 2020 2020 2020 2020 2020 2066 6f63  .            foc
-000036f0: 616c 4c65 6e67 7468 203d 2073 7472 2865  alLength = str(e
-00003700: 7869 6644 6963 745b 2746 6f63 616c 204c  xifDict['Focal L
-00003710: 656e 6774 6827 5d29 0a20 2020 2020 2020  ength']).       
-00003720: 2020 2020 2066 6f63 616c 506c 616e 6552       focalPlaneR
-00003730: 6573 5f78 203d 2066 6c6f 6174 2873 7472  es_x = float(str
-00003740: 2865 7869 6644 6963 745b 2746 6f63 616c  (exifDict['Focal
-00003750: 2050 6c61 6e65 2058 2052 6573 6f6c 7574   Plane X Resolut
-00003760: 696f 6e27 5d29 2e73 7472 6970 2827 5c27  ion']).strip('\'
-00003770: 2729 290a 2020 2020 2020 2020 2020 2020  ')).            
-00003780: 666f 6361 6c50 6c61 6e65 5265 735f 7920  focalPlaneRes_y 
-00003790: 3d20 666c 6f61 7428 7374 7228 6578 6966  = float(str(exif
-000037a0: 4469 6374 5b27 466f 6361 6c20 506c 616e  Dict['Focal Plan
-000037b0: 6520 5920 5265 736f 6c75 7469 6f6e 275d  e Y Resolution']
-000037c0: 292e 7374 7269 7028 275c 2727 2929 0a20  ).strip('\'')). 
-000037d0: 2020 2020 2020 2020 2020 2066 6f63 616c             focal
-000037e0: 506c 616e 6552 6573 5f75 6e69 7420 3d20  PlaneRes_unit = 
-000037f0: 7374 7228 6578 6966 4469 6374 5b27 466f  str(exifDict['Fo
-00003800: 6361 6c20 506c 616e 6520 5265 736f 6c75  cal Plane Resolu
-00003810: 7469 6f6e 2055 6e69 7427 5d29 2e73 7472  tion Unit']).str
-00003820: 6970 2827 5c27 2729 0a20 2020 2020 2020  ip('\'').       
-00003830: 2065 7863 6570 7420 284b 6579 4572 726f   except (KeyErro
-00003840: 722c 2056 616c 7565 4572 726f 7229 3a0a  r, ValueError):.
-00003850: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00003860: 726e 205b 2d31 2c2d 315d 2c20 2243 6f75  rn [-1,-1], "Cou
-00003870: 6c64 206e 6f74 2066 696e 6420 616c 6c20  ld not find all 
-00003880: 7265 7175 6972 6564 2066 6965 6c64 7320  required fields 
-00003890: 466f 6361 6c20 4c65 6e67 7468 2c20 466f  Focal Length, Fo
-000038a0: 6361 6c20 506c 616e 6520 5820 5265 736f  cal Plane X Reso
-000038b0: 6c75 7469 6f6e 2c20 466f 6361 6c20 506c  lution, Focal Pl
-000038c0: 616e 6520 5920 5265 736f 6c75 7469 6f6e  ane Y Resolution
-000038d0: 2c20 466f 6361 6c20 506c 616e 6520 5265  , Focal Plane Re
-000038e0: 736f 6c75 7469 6f6e 2055 6e69 7422 0a20  solution Unit". 
-000038f0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-00003900: 2320 7061 7273 6520 666f 6361 6c20 6c65  # parse focal le
-00003910: 6e67 7468 2066 726f 6d20 6c65 6674 2028  ngth from left (
-00003920: 6d61 7920 6265 2027 372e 3520 6d6d 2028  may be '7.5 mm (
-00003930: 2e2e 2e29 2729 0a20 2020 2020 2020 2066  ...)').        f
-00003940: 6f63 616c 4c65 6e67 7468 5374 7269 7070  ocalLengthStripp
-00003950: 6564 203d 2066 6f63 616c 4c65 6e67 7468  ed = focalLength
-00003960: 2e73 7472 6970 2829 0a20 2020 2020 2020  .strip().       
-00003970: 2066 6f63 616c 4c65 6e67 7468 466c 6f61   focalLengthFloa
-00003980: 7420 3d20 4e6f 6e65 0a20 2020 2020 2020  t = None.       
-00003990: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
-000039a0: 6c65 6e28 666f 6361 6c4c 656e 6774 6853  len(focalLengthS
-000039b0: 7472 6970 7065 6429 293a 0a20 2020 2020  tripped)):.     
-000039c0: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-000039d0: 2020 2020 2020 2020 2020 2020 666f 6361              foca
-000039e0: 6c4c 656e 6774 6846 6c6f 6174 203d 2066  lLengthFloat = f
-000039f0: 6c6f 6174 2866 6f63 616c 4c65 6e67 7468  loat(focalLength
-00003a00: 5374 7269 7070 6564 5b30 3a69 2b31 5d29  Stripped[0:i+1])
-00003a10: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
-00003a20: 6570 7420 5661 6c75 6545 7272 6f72 3a0a  ept ValueError:.
-00003a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003a40: 7061 7373 0a20 2020 2020 2020 2069 6620  pass.        if 
-00003a50: 666f 6361 6c4c 656e 6774 6846 6c6f 6174  focalLengthFloat
-00003a60: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-00003a70: 2020 2020 2020 7265 7475 726e 205b 2d31        return [-1
-00003a80: 2c2d 315d 2c20 2243 6f75 6c64 206e 6f74  ,-1], "Could not
-00003a90: 2070 6172 7365 2066 6f72 6361 6c20 6c65   parse forcal le
-00003aa0: 6e67 7468 2066 726f 6d20 2746 6f63 616c  ngth from 'Focal
-00003ab0: 204c 656e 6774 6827 3a20 2220 2b20 666f   Length': " + fo
-00003ac0: 6361 6c4c 656e 6774 680a 2020 2020 2020  calLength.      
-00003ad0: 2020 7363 616c 6546 6b74 5f66 6f63 616c    scaleFkt_focal
-00003ae0: 203d 2073 656c 662e 5f5f 756e 6974 436f   = self.__unitCo
-00003af0: 6e76 6572 7369 6f6e 4661 6374 326d 6d28  nversionFact2mm(
-00003b00: 666f 6361 6c4c 656e 6774 6829 0a20 2020  focalLength).   
-00003b10: 2020 2020 2069 6620 7363 616c 6546 6b74       if scaleFkt
-00003b20: 5f66 6f63 616c 203d 3d20 2d31 3a0a 2020  _focal == -1:.  
-00003b30: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00003b40: 205b 2d31 2c2d 315d 2c20 2243 6f75 6c64   [-1,-1], "Could
-00003b50: 206e 6f74 2070 6172 7365 2066 6f72 6361   not parse forca
-00003b60: 6c20 6c65 6e67 7468 2075 6e69 7420 6672  l length unit fr
-00003b70: 6f6d 2027 466f 6361 6c20 4c65 6e67 7468  om 'Focal Length
-00003b80: 273a 2022 202b 2066 6f63 616c 4c65 6e67  ': " + focalLeng
-00003b90: 7468 0a20 2020 2020 2020 2066 6f63 616c  th.        focal
-00003ba0: 4c65 6e67 7468 5f6d 6d20 3d20 666f 6361  Length_mm = foca
-00003bb0: 6c4c 656e 6774 6846 6c6f 6174 202a 2073  lLengthFloat * s
-00003bc0: 6361 6c65 466b 745f 666f 6361 6c0a 0a20  caleFkt_focal.. 
-00003bd0: 2020 2020 2020 2073 6361 6c65 466b 745f         scaleFkt_
-00003be0: 7265 7320 3d20 7365 6c66 2e5f 5f75 6e69  res = self.__uni
-00003bf0: 7443 6f6e 7665 7273 696f 6e46 6163 7432  tConversionFact2
-00003c00: 6d6d 2866 6f63 616c 506c 616e 6552 6573  mm(focalPlaneRes
-00003c10: 5f75 6e69 7429 0a20 2020 2020 2020 2069  _unit).        i
-00003c20: 6620 7363 616c 6546 6b74 5f72 6573 203d  f scaleFkt_res =
-00003c30: 3d20 2d31 3a0a 2020 2020 2020 2020 2020  = -1:.          
-00003c40: 2020 7265 7475 726e 205b 2d31 2c2d 315d    return [-1,-1]
-00003c50: 2c20 2243 6f75 6c64 206e 6f74 2070 6172  , "Could not par
-00003c60: 7365 2046 6f63 616c 2050 6c61 6e65 2052  se Focal Plane R
-00003c70: 6573 6f6c 7574 696f 6e20 556e 6974 2066  esolution Unit f
-00003c80: 726f 6d20 2746 6f63 616c 2050 6c61 6e65  rom 'Focal Plane
-00003c90: 2052 6573 6f6c 7574 696f 6e20 556e 6974   Resolution Unit
-00003ca0: 273a 2022 202b 2066 6f63 616c 506c 616e  ': " + focalPlan
-00003cb0: 6552 6573 5f75 6e69 740a 0a20 2020 2020  eRes_unit..     
-00003cc0: 2020 2066 6f63 616c 4c65 6e67 7468 5069     focalLengthPi
-00003cd0: 7865 6c73 5f78 203d 2066 6f63 616c 4c65  xels_x = focalLe
-00003ce0: 6e67 7468 5f6d 6d20 2a20 666f 6361 6c50  ngth_mm * focalP
-00003cf0: 6c61 6e65 5265 735f 7820 2f20 7363 616c  laneRes_x / scal
-00003d00: 6546 6b74 5f72 6573 0a20 2020 2020 2020  eFkt_res.       
-00003d10: 2066 6f63 616c 4c65 6e67 7468 5069 7865   focalLengthPixe
-00003d20: 6c73 5f79 203d 2066 6f63 616c 4c65 6e67  ls_y = focalLeng
-00003d30: 7468 5f6d 6d20 2a20 666f 6361 6c50 6c61  th_mm * focalPla
-00003d40: 6e65 5265 735f 7920 2f20 7363 616c 6546  neRes_y / scaleF
-00003d50: 6b74 5f72 6573 0a0a 2020 2020 2020 2020  kt_res..        
-00003d60: 7265 7475 726e 205b 666f 6361 6c4c 656e  return [focalLen
-00003d70: 6774 6850 6978 656c 735f 782c 666f 6361  gthPixels_x,foca
-00003d80: 6c4c 656e 6774 6850 6978 656c 735f 795d  lLengthPixels_y]
-00003d90: 2c20 2222 0a0a 0a20 2020 2064 6566 205f  , ""...    def _
-00003da0: 5f74 7279 4465 7465 726d 696e 6546 6f63  _tryDetermineFoc
-00003db0: 616c 4c65 6e67 6874 496e 5069 7865 6c73  alLenghtInPixels
-00003dc0: 4672 6f6d 4578 6966 5f32 2873 656c 662c  FromExif_2(self,
-00003dd0: 6578 6966 4469 6374 3a64 6963 7429 3a0a  exifDict:dict):.
-00003de0: 2020 2020 2020 2020 2222 2220 7472 7920          """ try 
-00003df0: 746f 2064 6574 6572 6d69 6e65 2066 6f63  to determine foc
-00003e00: 616c 206c 656e 6774 6820 696e 2070 6978  al length in pix
-00003e10: 656c 7320 6672 6f6d 2033 3520 6d6d 2065  els from 35 mm e
-00003e20: 7175 6976 616c 656e 7420 666f 6361 6c20  quivalent focal 
-00003e30: 6c65 6e67 7468 2069 6e20 6578 6966 2074  length in exif t
-00003e40: 6167 2046 6f63 616c 204c 656e 6774 6827  ag Focal Length'
-00003e50: 7320 6164 6420 6f6e 2065 2e67 2e20 2737  s add on e.g. '7
-00003e60: 2e30 206d 6d20 2833 3520 6d6d 2065 7175  .0 mm (35 mm equ
-00003e70: 6976 616c 656e 743a 2033 382e 3820 6d6d  ivalent: 38.8 mm
-00003e80: 2927 2e0a 2020 2020 2020 2020 2020 2020  )'..            
-00003e90: 5265 7472 756e 7320 5b66 6f63 616c 4c65  Retruns [focalLe
-00003ea0: 6e67 7468 5069 7865 6c73 5f78 2c66 6f63  ngthPixels_x,foc
-00003eb0: 616c 4c65 6e67 7468 5069 7865 6c73 5f79  alLengthPixels_y
-00003ec0: 5d2c 206d 6573 7361 6765 0a20 2020 2020  ], message.     
-00003ed0: 2020 2020 2020 2052 6574 7275 6e73 2066         Retruns f
-00003ee0: 6f63 616c 4c65 6e67 7468 5069 7865 6c73  ocalLengthPixels
-00003ef0: 203d 202d 3120 6966 206e 6f74 2073 7563   = -1 if not suc
-00003f00: 6365 7373 6675 6c6c 2022 2222 0a0a 2020  cessfull """..  
-00003f10: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-00003f20: 2020 2020 2020 2066 6f63 616c 4c65 6e67         focalLeng
-00003f30: 7468 203d 2073 7472 2865 7869 6644 6963  th = str(exifDic
-00003f40: 745b 2746 6f63 616c 204c 656e 6774 6827  t['Focal Length'
-00003f50: 5d29 0a20 2020 2020 2020 2020 2020 2069  ]).            i
-00003f60: 6d61 6765 5769 6474 6820 3d20 696e 7428  mageWidth = int(
-00003f70: 7374 7228 6578 6966 4469 6374 5b27 496d  str(exifDict['Im
-00003f80: 6167 6520 5769 6474 6827 5d29 2e73 7472  age Width']).str
-00003f90: 6970 2827 5c27 2729 290a 2020 2020 2020  ip('\'')).      
-00003fa0: 2020 6578 6365 7074 2028 4b65 7945 7272    except (KeyErr
-00003fb0: 6f72 2c20 5661 6c75 6545 7272 6f72 293a  or, ValueError):
-00003fc0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00003fd0: 7572 6e20 5b2d 312c 2d31 5d2c 2022 436f  urn [-1,-1], "Co
-00003fe0: 756c 6420 6e6f 7420 6669 6e64 2061 6c6c  uld not find all
-00003ff0: 2072 6571 7569 7265 6420 6669 656c 6473   required fields
-00004000: 2046 6f63 616c 204c 656e 6774 682c 2049   Focal Length, I
-00004010: 6d61 6765 2057 6964 7468 220a 0a20 2020  mage Width"..   
-00004020: 2020 2020 2023 2074 7279 2070 6172 7365       # try parse
-00004030: 2033 3520 6d6d 2065 7175 6976 616c 656e   35 mm equivalen
-00004040: 7420 6672 6f6d 2065 2e67 2e3a 2020 372e  t from e.g.:  7.
-00004050: 3020 6d6d 2028 3335 206d 6d20 6571 7569  0 mm (35 mm equi
-00004060: 7661 6c65 6e74 3a20 3338 2e38 206d 6d29  valent: 38.8 mm)
-00004070: 0a20 2020 2020 2020 2063 6f6c 6f6e 496e  .        colonIn
-00004080: 6465 7820 3d20 666f 6361 6c4c 656e 6774  dex = focalLengt
-00004090: 682e 6669 6e64 2827 3a27 290a 2020 2020  h.find(':').    
-000040a0: 2020 2020 6966 2063 6f6c 6f6e 496e 6465      if colonInde
-000040b0: 7820 3d3d 202d 313a 0a20 2020 2020 2020  x == -1:.       
-000040c0: 2020 2020 2072 6574 7572 6e20 5b2d 312c       return [-1,
-000040d0: 2d31 5d2c 2022 436f 756c 6420 6e6f 7420  -1], "Could not 
-000040e0: 7061 7273 6520 3335 206d 6d20 6571 7569  parse 35 mm equi
-000040f0: 7661 6c65 6e74 2066 6f63 616c 206c 656e  valent focal len
-00004100: 6774 6820 6672 6f6d 2027 466f 6361 6c20  gth from 'Focal 
-00004110: 4c65 6e67 7468 273a 2022 202b 2066 6f63  Length': " + foc
-00004120: 616c 4c65 6e67 7468 0a20 2020 2020 2020  alLength.       
-00004130: 2066 6f63 616c 4c65 6e67 7468 4571 3335   focalLengthEq35
-00004140: 6d6d 466c 6f61 7420 3d20 4e6f 6e65 0a20  mmFloat = None. 
-00004150: 2020 2020 2020 2065 7175 616c 3335 6d6d         equal35mm
-00004160: 5061 7274 203d 2066 6f63 616c 4c65 6e67  Part = focalLeng
-00004170: 7468 5b63 6f6c 6f6e 496e 6465 782b 313a  th[colonIndex+1:
-00004180: 3a5d 2e73 7472 6970 2829 0a20 2020 2020  :].strip().     
-00004190: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
-000041a0: 6528 6c65 6e28 6571 7561 6c33 356d 6d50  e(len(equal35mmP
-000041b0: 6172 7429 293a 0a20 2020 2020 2020 2020  art)):.         
-000041c0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-000041d0: 2020 2020 2020 2020 666f 6361 6c4c 656e          focalLen
-000041e0: 6774 6845 7133 356d 6d46 6c6f 6174 203d  gthEq35mmFloat =
-000041f0: 2066 6c6f 6174 2865 7175 616c 3335 6d6d   float(equal35mm
-00004200: 5061 7274 5b30 3a69 2b31 5d29 0a20 2020  Part[0:i+1]).   
-00004210: 2020 2020 2020 2020 2065 7863 6570 7420           except 
-00004220: 5661 6c75 6545 7272 6f72 3a0a 2020 2020  ValueError:.    
-00004230: 2020 2020 2020 2020 2020 2020 7061 7373              pass
-00004240: 0a20 2020 2020 2020 2073 6361 6c65 466b  .        scaleFk
-00004250: 7420 3d20 7365 6c66 2e5f 5f75 6e69 7443  t = self.__unitC
-00004260: 6f6e 7665 7273 696f 6e46 6163 7432 6d6d  onversionFact2mm
-00004270: 2866 6f63 616c 4c65 6e67 7468 5b63 6f6c  (focalLength[col
-00004280: 6f6e 496e 6465 782b 313a 3a5d 290a 2020  onIndex+1::]).  
-00004290: 2020 2020 2020 6966 2066 6f63 616c 4c65        if focalLe
-000042a0: 6e67 7468 4571 3335 6d6d 466c 6f61 7420  ngthEq35mmFloat 
-000042b0: 6973 204e 6f6e 6520 6f72 2073 6361 6c65  is None or scale
-000042c0: 466b 7420 3d3d 202d 313a 0a20 2020 2020  Fkt == -1:.     
-000042d0: 2020 2020 2020 2072 6574 7572 6e20 5b2d         return [-
-000042e0: 312c 2d31 5d2c 2022 436f 756c 6420 6e6f  1,-1], "Could no
-000042f0: 7420 7061 7273 6520 3335 206d 6d20 6571  t parse 35 mm eq
-00004300: 7569 7661 6c65 6e74 2066 6f63 616c 206c  uivalent focal l
-00004310: 656e 6774 6820 6672 6f6d 2027 466f 6361  ength from 'Foca
-00004320: 6c20 4c65 6e67 7468 273a 2022 202b 2066  l Length': " + f
-00004330: 6f63 616c 4c65 6e67 7468 0a20 2020 2020  ocalLength.     
-00004340: 2020 200a 2020 2020 2020 2020 666f 6361     .        foca
-00004350: 6c4c 656e 6774 6850 6978 656c 7320 3d20  lLengthPixels = 
-00004360: 666f 6361 6c4c 656e 6774 6845 7133 356d  focalLengthEq35m
-00004370: 6d46 6c6f 6174 202a 2073 6361 6c65 466b  mFloat * scaleFk
-00004380: 7420 2a20 696d 6167 6557 6964 7468 202f  t * imageWidth /
-00004390: 2033 362e 300a 2020 2020 2020 2020 7265   36.0.        re
-000043a0: 7475 726e 205b 666f 6361 6c4c 656e 6774  turn [focalLengt
-000043b0: 6850 6978 656c 732c 666f 6361 6c4c 656e  hPixels,focalLen
-000043c0: 6774 6850 6978 656c 735d 2c20 2222 0a0a  gthPixels], ""..
-000043d0: 0a20 2020 2064 6566 205f 5f75 6e69 7443  .    def __unitC
-000043e0: 6f6e 7665 7273 696f 6e46 6163 7432 6d6d  onversionFact2mm
-000043f0: 2873 656c 662c 756e 6974 3a73 7472 293a  (self,unit:str):
-00004400: 0a20 2020 2020 2020 2022 2222 206c 6f6f  .        """ loo
-00004410: 6b73 2066 6f72 206c 6574 7465 7220 7365  ks for letter se
-00004420: 7175 656e 6365 2069 6e20 756e 6974 2061  quence in unit a
-00004430: 6e64 2063 6865 636b 7320 6966 2069 7427  nd checks if it'
-00004440: 7320 2769 6e63 6865 7327 2c27 6d27 2c27  s 'inches','m','
-00004450: 636d 272c 276d 6d27 2c27 756d 2720 6f72  cm','mm','um' or
-00004460: 2027 2720 616e 6420 7265 7475 726e 7320   '' and returns 
-00004470: 7265 7370 6563 7469 7665 2063 6f6e 7665  respective conve
-00004480: 7273 696f 6e20 6661 6374 6f72 2074 6f20  rsion factor to 
-00004490: 6d6d 2028 6966 2074 6865 7265 2061 7265  mm (if there are
-000044a0: 206e 6f20 6c65 7474 6572 7320 6974 2072   no letters it r
-000044b0: 6574 7572 6e73 2031 292e 204f 7468 6572  eturns 1). Other
-000044c0: 7769 7365 2072 6574 7572 6e20 2d31 2022  wise return -1 "
-000044d0: 2222 0a0a 2020 2020 2020 2020 6669 7273  ""..        firs
-000044e0: 744c 6574 7465 7253 6571 203d 2022 220a  tLetterSeq = "".
-000044f0: 2020 2020 2020 2020 6669 7273 7446 6f75          firstFou
-00004500: 6e64 203d 2046 616c 7365 0a20 2020 2020  nd = False.     
-00004510: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
-00004520: 6528 6c65 6e28 756e 6974 2929 3a0a 2020  e(len(unit)):.  
-00004530: 2020 2020 2020 2020 2020 6966 2075 6e69            if uni
-00004540: 745b 695d 2e69 7361 6c70 6861 2829 3a0a  t[i].isalpha():.
-00004550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004560: 6669 7273 7446 6f75 6e64 203d 2054 7275  firstFound = Tru
-00004570: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00004580: 2020 6669 7273 744c 6574 7465 7253 6571    firstLetterSeq
-00004590: 202b 3d20 756e 6974 5b69 5d0a 2020 2020   += unit[i].    
-000045a0: 2020 2020 2020 2020 6966 206e 6f74 2075          if not u
-000045b0: 6e69 745b 695d 2e69 7361 6c70 6861 2829  nit[i].isalpha()
-000045c0: 2061 6e64 2066 6972 7374 466f 756e 6420   and firstFound 
-000045d0: 3d3d 2054 7275 653a 0a20 2020 2020 2020  == True:.       
-000045e0: 2020 2020 2020 2020 2062 7265 616b 0a0a           break..
-000045f0: 2020 2020 2020 2020 6966 2066 6972 7374          if first
-00004600: 4c65 7474 6572 5365 712e 6c6f 7765 7228  LetterSeq.lower(
-00004610: 2920 3d3d 2022 696e 6368 6573 223a 0a20  ) == "inches":. 
-00004620: 2020 2020 2020 2020 2020 2073 6361 6c65             scale
-00004630: 466b 7420 3d20 3235 2e34 0a20 2020 2020  Fkt = 25.4.     
-00004640: 2020 2065 6c69 6620 6669 7273 744c 6574     elif firstLet
-00004650: 7465 7253 6571 2e6c 6f77 6572 2829 203d  terSeq.lower() =
-00004660: 3d20 226d 223a 0a20 2020 2020 2020 2020  = "m":.         
-00004670: 2020 2073 6361 6c65 466b 7420 3d20 3130     scaleFkt = 10
-00004680: 3030 2e30 3b0a 2020 2020 2020 2020 656c  00.0;.        el
-00004690: 6966 2066 6972 7374 4c65 7474 6572 5365  if firstLetterSe
-000046a0: 712e 6c6f 7765 7228 2920 3d3d 2022 636d  q.lower() == "cm
-000046b0: 223a 0a20 2020 2020 2020 2020 2020 2073  ":.            s
-000046c0: 6361 6c65 466b 7420 3d20 3130 2e30 3b0a  caleFkt = 10.0;.
-000046d0: 2020 2020 2020 2020 656c 6966 2066 6972          elif fir
-000046e0: 7374 4c65 7474 6572 5365 712e 6c6f 7765  stLetterSeq.lowe
-000046f0: 7228 2920 3d3d 2022 6d6d 223a 0a20 2020  r() == "mm":.   
-00004700: 2020 2020 2020 2020 2073 6361 6c65 466b           scaleFk
-00004710: 7420 3d20 312e 303b 0a20 2020 2020 2020  t = 1.0;.       
-00004720: 2065 6c69 6620 6669 7273 744c 6574 7465   elif firstLette
-00004730: 7253 6571 2e6c 6f77 6572 2829 203d 3d20  rSeq.lower() == 
-00004740: 2275 6d22 3a0a 2020 2020 2020 2020 2020  "um":.          
-00004750: 2020 7363 616c 6546 6b74 203d 2031 2f31    scaleFkt = 1/1
-00004760: 3030 303b 0a20 2020 2020 2020 2065 6c69  000;.        eli
-00004770: 6620 6669 7273 744c 6574 7465 7253 6571  f firstLetterSeq
-00004780: 2e6c 6f77 6572 2829 203d 3d20 2222 3a0a  .lower() == "":.
-00004790: 2020 2020 2020 2020 2020 2020 7363 616c              scal
-000047a0: 6546 6b74 203d 2031 3b0a 2020 2020 2020  eFkt = 1;.      
-000047b0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-000047c0: 2020 2020 7363 616c 6546 6b74 203d 202d      scaleFkt = -
-000047d0: 310a 0a20 2020 2020 2020 2072 6574 7572  1..        retur
-000047e0: 6e20 7363 616c 6546 6b74 0a0a 0a20 2020  n scaleFkt...   
-000047f0: 2064 6566 205f 5f67 6574 4974 656d 4465   def __getItemDe
-00004800: 6661 756c 7456 616c 7565 2873 656c 662c  faultValue(self,
-00004810: 6974 656d 3a73 7472 2c66 6965 6c64 4e61  item:str,fieldNa
-00004820: 6d65 3a73 7472 293a 0a20 2020 2020 2020  me:str):.       
-00004830: 2022 2222 2072 6574 7572 6e73 2069 7465   """ returns ite
-00004840: 6d20 7661 6c75 6573 2028 6669 7273 7420  m values (first 
-00004850: 656e 7472 7920 696e 2063 6173 6520 6f66  entry in case of
-00004860: 2076 6964 656f 7329 2e20 5468 726f 7773   videos). Throws
-00004870: 206d 6172 6971 742e 636f 7265 2e49 6664   mariqt.core.Ifd
-00004880: 6f45 7863 6570 7469 6f6e 2069 6620 6669  oException if fi
-00004890: 656c 6420 6e6f 7420 666f 756e 642e 2022  eld not found. "
-000048a0: 2222 0a0a 2020 2020 2020 2020 7265 7420  ""..        ret 
-000048b0: 3d20 7365 6c66 5b22 3a22 2e6a 6f69 6e28  = self[":".join(
-000048c0: 5b69 7465 6d2c 2730 272c 6669 656c 644e  [item,'0',fieldN
-000048d0: 616d 655d 295d 0a20 2020 2020 2020 2069  ame])].        i
-000048e0: 6620 7265 7420 3d3d 2022 223a 0a20 2020  f ret == "":.   
-000048f0: 2020 2020 2020 2020 7261 6973 6520 6d69          raise mi
-00004900: 7174 632e 4966 646f 4578 6365 7074 696f  qtc.IfdoExceptio
-00004910: 6e28 2245 7272 6f72 3a20 4669 656c 6420  n("Error: Field 
-00004920: 7b30 7d20 6e65 6974 6865 7220 666f 756e  {0} neither foun
-00004930: 6420 696e 2069 7465 6d20 7b31 7d20 6e6f  d in item {1} no
-00004940: 7220 6865 6164 6572 222e 666f 726d 6174  r header".format
-00004950: 2866 6965 6c64 4e61 6d65 2c69 7465 6d29  (fieldName,item)
-00004960: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-00004970: 2072 6574 0a0a 0a20 2020 2064 6566 205f   ret...    def _
-00004980: 5f67 6574 4974 656d 4c61 744c 6f6e 2873  _getItemLatLon(s
-00004990: 656c 662c 6974 656d 3a73 7472 2c68 6561  elf,item:str,hea
-000049a0: 6465 7256 616c 4c61 742c 6865 6164 6572  derValLat,header
-000049b0: 5661 6c4c 6f6e 293a 0a20 2020 2020 2020  ValLon):.       
-000049c0: 2022 2222 2072 6574 7572 6e73 207b 276c   """ returns {'l
-000049d0: 6174 273a 2076 616c 7565 2c20 276c 6f6e  at': value, 'lon
-000049e0: 273a 2076 616c 7565 2c20 2764 6174 6574  ': value, 'datet
-000049f0: 696d 6527 3a20 7661 6c75 657d 206f 6620  ime': value} of 
-00004a00: 6c69 7374 206f 6620 7468 6f73 6520 2222  list of those ""
-00004a10: 220a 0a20 2020 2020 2020 2069 7465 6d56  "..        itemV
-00004a20: 616c 203d 2073 656c 662e 6966 646f 5b6d  al = self.ifdo[m
-00004a30: 6971 7476 2e69 6d61 6765 5f73 6574 5f69  iqtv.image_set_i
-00004a40: 7465 6d73 5f6b 6579 5d5b 6974 656d 5d0a  tems_key][item].
-00004a50: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
-00004a60: 7369 6e73 7461 6e63 6528 6974 656d 5661  sinstance(itemVa
-00004a70: 6c2c 6c69 7374 293a 0a20 2020 2020 2020  l,list):.       
-00004a80: 2020 2020 2072 6574 203d 2073 656c 662e       ret = self.
-00004a90: 5f5f 7061 7273 6532 4c61 744c 6f6e 4469  __parse2LatLonDi
-00004aa0: 6374 2869 7465 6d56 616c 2c68 6561 6465  ct(itemVal,heade
-00004ab0: 7256 616c 4c61 742c 6865 6164 6572 5661  rValLat,headerVa
-00004ac0: 6c4c 6f6e 290a 2020 2020 2020 2020 656c  lLon).        el
-00004ad0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00004ae0: 7265 7420 3d20 5b5d 0a20 2020 2020 2020  ret = [].       
-00004af0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-00004b00: 2020 2020 2020 2020 2020 6974 656d 4c61            itemLa
-00004b10: 7444 6566 6175 6c74 203d 2069 7465 6d56  tDefault = itemV
-00004b20: 616c 5b30 5d5b 2769 6d61 6765 2d6c 6174  al[0]['image-lat
-00004b30: 6974 7564 6527 5d0a 2020 2020 2020 2020  itude'].        
-00004b40: 2020 2020 6578 6365 7074 204b 6579 4572      except KeyEr
-00004b50: 726f 723a 0a20 2020 2020 2020 2020 2020  ror:.           
-00004b60: 2020 2020 2069 7465 6d4c 6174 4465 6661       itemLatDefa
-00004b70: 756c 7420 3d20 6865 6164 6572 5661 6c4c  ult = headerValL
-00004b80: 6174 0a20 2020 2020 2020 2020 2020 2020  at.             
-00004b90: 2020 2023 6966 2069 7465 6d4c 6174 4465     #if itemLatDe
-00004ba0: 6661 756c 7420 6973 204e 6f6e 653a 0a20  fault is None:. 
-00004bb0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00004bc0: 2020 2020 7261 6973 6520 4578 6365 7074      raise Except
-00004bd0: 696f 6e28 2245 7272 6f72 3a20 4669 656c  ion("Error: Fiel
-00004be0: 6420 7b30 7d20 6e65 6974 6865 7220 666f  d {0} neither fo
-00004bf0: 756e 6420 696e 2069 7465 6d20 7b31 7d20  und in item {1} 
-00004c00: 6e6f 7220 6865 6164 6572 222e 666f 726d  nor header".form
-00004c10: 6174 2827 696d 6167 652d 6c61 7469 7475  at('image-latitu
-00004c20: 6465 272c 6974 656d 2929 0a0a 2020 2020  de',item))..    
-00004c30: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-00004c40: 2020 2020 2020 2020 2020 2020 2069 7465               ite
-00004c50: 6d4c 6f6e 4465 6661 756c 7420 3d20 6974  mLonDefault = it
-00004c60: 656d 5661 6c5b 305d 5b27 696d 6167 652d  emVal[0]['image-
-00004c70: 6c6f 6e67 6974 7564 6527 5d0a 2020 2020  longitude'].    
-00004c80: 2020 2020 2020 2020 6578 6365 7074 204b          except K
-00004c90: 6579 4572 726f 723a 0a20 2020 2020 2020  eyError:.       
-00004ca0: 2020 2020 2020 2020 2069 7465 6d4c 6f6e           itemLon
-00004cb0: 4465 6661 756c 7420 3d20 6865 6164 6572  Default = header
-00004cc0: 5661 6c4c 6f6e 0a20 2020 2020 2020 2020  ValLon.         
-00004cd0: 2020 2020 2020 2023 6966 2069 7465 6d4c         #if itemL
-00004ce0: 6f6e 4465 6661 756c 7420 6973 204e 6f6e  onDefault is Non
-00004cf0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00004d00: 2020 2023 2020 2020 7261 6973 6520 4578     #    raise Ex
-00004d10: 6365 7074 696f 6e28 2245 7272 6f72 3a20  ception("Error: 
-00004d20: 4669 656c 6420 7b30 7d20 6e65 6974 6865  Field {0} neithe
-00004d30: 7220 666f 756e 6420 696e 2069 7465 6d20  r found in item 
-00004d40: 7b31 7d20 6e6f 7220 6865 6164 6572 222e  {1} nor header".
-00004d50: 666f 726d 6174 2827 696d 6167 652d 6c61  format('image-la
-00004d60: 7469 7475 6465 272c 6974 656d 2929 0a0a  titude',item))..
-00004d70: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00004d80: 7375 6245 6e74 7279 2069 6e20 6974 656d  subEntry in item
-00004d90: 5661 6c3a 0a20 2020 2020 2020 2020 2020  Val:.           
-00004da0: 2020 2020 2072 6574 2e61 7070 656e 6428       ret.append(
-00004db0: 7365 6c66 2e5f 5f70 6172 7365 324c 6174  self.__parse2Lat
-00004dc0: 4c6f 6e44 6963 7428 7375 6245 6e74 7279  LonDict(subEntry
-00004dd0: 2c69 7465 6d4c 6174 4465 6661 756c 742c  ,itemLatDefault,
-00004de0: 6974 656d 4c6f 6e44 6566 6175 6c74 2929  itemLonDefault))
-00004df0: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00004e00: 2072 6574 0a20 2020 2020 2020 2020 2020   ret.           
-00004e10: 200a 0a20 2020 2064 6566 205f 5f70 6172   ..    def __par
-00004e20: 7365 324c 6174 4c6f 6e44 6963 7428 7365  se2LatLonDict(se
-00004e30: 6c66 2c69 7465 6d56 616c 2c68 6561 6465  lf,itemVal,heade
-00004e40: 7256 616c 4c61 742c 6865 6164 6572 5661  rValLat,headerVa
-00004e50: 6c4c 6f6e 293a 0a20 2020 2020 2020 2022  lLon):.        "
-00004e60: 2222 2072 6574 7572 6e73 207b 276c 6174  "" returns {'lat
-00004e70: 273a 6c61 742c 276c 6f6e 273a 6c6f 6e2c  ':lat,'lon':lon,
-00004e80: 2764 6174 6574 696d 6527 3a64 6174 6574  'datetime':datet
-00004e90: 696d 657d 2022 2222 0a20 2020 2020 2020  ime} """.       
-00004ea0: 2064 6174 6574 696d 6520 3d20 6974 656d   datetime = item
-00004eb0: 5661 6c5b 2769 6d61 6765 2d64 6174 6574  Val['image-datet
-00004ec0: 696d 6527 5d0a 2020 2020 2020 2020 7472  ime'].        tr
-00004ed0: 793a 0a20 2020 2020 2020 2020 2020 206c  y:.            l
-00004ee0: 6174 203d 2069 7465 6d56 616c 5b27 696d  at = itemVal['im
-00004ef0: 6167 652d 6c61 7469 7475 6465 275d 0a20  age-latitude']. 
-00004f00: 2020 2020 2020 2065 7863 6570 7420 4b65         except Ke
-00004f10: 7945 7272 6f72 3a0a 2020 2020 2020 2020  yError:.        
-00004f20: 2020 2020 6c61 7420 3d20 6865 6164 6572      lat = header
-00004f30: 5661 6c4c 6174 0a20 2020 2020 2020 2020  ValLat.         
-00004f40: 2020 2069 6620 6c61 7420 6973 204e 6f6e     if lat is Non
-00004f50: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00004f60: 2020 2072 6169 7365 2045 7863 6570 7469     raise Excepti
-00004f70: 6f6e 2822 4572 726f 723a 2046 6965 6c64  on("Error: Field
-00004f80: 207b 307d 206e 6569 7468 6572 2066 6f75   {0} neither fou
-00004f90: 6e64 2069 6e20 6974 656d 207b 317d 206e  nd in item {1} n
-00004fa0: 6f72 2068 6561 6465 7222 2e66 6f72 6d61  or header".forma
-00004fb0: 7428 2769 6d61 6765 2d6c 6174 6974 7564  t('image-latitud
-00004fc0: 6527 2c69 7465 6d56 616c 2929 0a20 2020  e',itemVal)).   
-00004fd0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-00004fe0: 2020 2020 2020 6c6f 6e20 3d20 6974 656d        lon = item
-00004ff0: 5661 6c5b 2769 6d61 6765 2d6c 6f6e 6769  Val['image-longi
-00005000: 7475 6465 275d 0a20 2020 2020 2020 2065  tude'].        e
-00005010: 7863 6570 7420 4b65 7945 7272 6f72 3a0a  xcept KeyError:.
-00005020: 2020 2020 2020 2020 2020 2020 6c6f 6e20              lon 
-00005030: 3d20 6865 6164 6572 5661 6c4c 6f6e 0a20  = headerValLon. 
-00005040: 2020 2020 2020 2020 2020 2069 6620 6c6f             if lo
-00005050: 6e20 6973 204e 6f6e 653a 0a20 2020 2020  n is None:.     
-00005060: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00005070: 2045 7863 6570 7469 6f6e 2822 4572 726f   Exception("Erro
-00005080: 723a 2046 6965 6c64 207b 307d 206e 6569  r: Field {0} nei
-00005090: 7468 6572 2066 6f75 6e64 2069 6e20 6974  ther found in it
-000050a0: 656d 207b 317d 206e 6f72 2068 6561 6465  em {1} nor heade
-000050b0: 7222 2e66 6f72 6d61 7428 2769 6d61 6765  r".format('image
-000050c0: 2d6c 6f6e 6769 7475 6465 272c 6974 656d  -longitude',item
-000050d0: 5661 6c29 290a 2020 2020 2020 2020 7265  Val)).        re
-000050e0: 7475 726e 207b 276c 6174 273a 6c61 742c  turn {'lat':lat,
-000050f0: 276c 6f6e 273a 6c6f 6e2c 2764 6174 6574  'lon':lon,'datet
-00005100: 696d 6527 3a64 6174 6574 696d 657d 0a0a  ime':datetime}..
-00005110: 0a64 6566 2069 4644 4f46 726f 6d46 696c  .def iFDOFromFil
-00005120: 6528 6946 444f 6669 6c65 3a73 7472 2c68  e(iFDOfile:str,h
-00005130: 616e 646c 655f 7072 6566 6978 3d27 3230  andle_prefix='20
-00005140: 2e35 3030 2e31 3230 3835 272c 7072 6f76  .500.12085',prov
-00005150: 656e 616e 6365 203d 204e 6f6e 652c 7665  enance = None,ve
-00005160: 7262 6f73 653d 5472 7565 2c69 676e 6f72  rbose=True,ignor
-00005170: 655f 696d 6167 655f 6669 6c65 733d 4661  e_image_files=Fa
-00005180: 6c73 652c 7772 6974 6554 6d70 5072 6f76  lse,writeTmpProv
-00005190: 4669 6c65 3d54 7275 652c 696d 6167 655f  File=True,image_
-000051a0: 6272 6f6b 6572 5f75 7569 643d 2265 6532  broker_uuid="ee2
-000051b0: 3737 3537 382d 6139 3131 2d34 3834 642d  77578-a911-484d-
-000051c0: 6135 3135 2d39 6337 3831 6437 3961 6139  a515-9c781d79aa9
-000051d0: 3122 293a 0a20 2020 2022 2222 2043 6f6e  1"):.    """ Con
-000051e0: 7665 6e69 656e 6365 2066 756e 6374 696f  venience functio
-000051f0: 6e20 746f 2063 7265 6174 6520 616e 2069  n to create an i
-00005200: 4644 4f20 6f62 6a65 6374 2064 6972 6563  FDO object direc
-00005210: 746c 7920 666f 726d 2061 6e20 6578 6973  tly form an exis
-00005220: 7469 6e67 2069 4644 4f20 6669 6c65 2e20  ting iFDO file. 
-00005230: 5472 6965 7320 746f 2069 6e66 6572 2069  Tries to infer i
-00005240: 6d61 6765 2066 696c 6573 206c 6f63 6174  mage files locat
-00005250: 696f 6e20 6672 6f6d 2027 696d 6167 652d  ion from 'image-
-00005260: 6c6f 6361 6c2d 7061 7468 272e 2052 6574  local-path'. Ret
-00005270: 7572 6e73 2069 4644 4f20 6f62 6a65 6374  urns iFDO object
-00005280: 2e20 0a20 2020 2020 2020 202d 2069 4644  . .        - iFD
-00005290: 4f66 696c 653a 2073 7472 696e 6720 7061  Ofile: string pa
-000052a0: 7468 2074 6f20 6c6f 6164 2061 6e20 6578  th to load an ex
-000052b0: 706c 6963 6974 2069 4644 4f20 6669 6c65  plicit iFDO file
-000052c0: 2e0a 2020 2020 2020 2020 2d20 6861 6e64  ..        - hand
-000052d0: 6c65 5f70 7265 6669 783a 2073 7472 696e  le_prefix: strin
-000052e0: 6720 7072 6566 6978 206f 6620 7468 6520  g prefix of the 
-000052f0: 6861 6e64 6c65 2073 6572 7665 722e 2044  handle server. D
-00005300: 6566 6175 6c74 3a20 7468 6520 6f6e 6520  efault: the one 
-00005310: 666f 7220 4765 6f6d 6172 2e0a 2020 2020  for Geomar..    
-00005320: 2020 2020 2d20 7072 6f76 656e 616e 6365      - provenance
-00005330: 3a20 6d61 7269 7174 2e70 726f 7665 6e63  : mariqt.provenc
-00005340: 616e 6365 2e50 726f 7665 6e61 6e63 6520  ance.Provenance 
-00005350: 6f62 6a65 6374 2074 6f20 7472 6163 6b20  object to track 
-00005360: 6461 7461 2070 726f 7665 6e61 6e63 652e  data provenance.
-00005370: 2044 6566 6175 6c74 3a20 6120 6e65 7720   Default: a new 
-00005380: 7072 6f76 656e 616e 6365 206f 626a 6563  provenance objec
-00005390: 7420 6973 2063 7265 6174 6564 2069 6e20  t is created in 
-000053a0: 7468 6520 2770 726f 746f 636f 6c27 2073  the 'protocol' s
-000053b0: 7562 666f 6c64 6572 2e0a 2020 2020 2020  ubfolder..      
-000053c0: 2020 2d20 7665 7262 6f73 653a 2062 6f6f    - verbose: boo
-000053d0: 6c20 7768 6574 6865 7220 746f 2070 7269  l whether to pri
-000053e0: 6e74 206f 7574 2069 6e66 6f72 6d61 7469  nt out informati
-000053f0: 6f6e 2e20 5072 6f63 6573 7369 6e67 2069  on. Processing i
-00005400: 7320 6661 7374 6572 2069 6620 7665 7262  s faster if verb
-00005410: 6f73 6520 6973 2046 616c 7365 2e20 4465  ose is False. De
-00005420: 6661 756c 743a 2054 7275 652e 0a20 2020  fault: True..   
-00005430: 2020 2020 202d 2069 676e 6f72 655f 696d       - ignore_im
-00005440: 6167 655f 6669 6c65 733a 2062 6f6f 6c20  age_files: bool 
-00005450: 7768 6574 6865 7220 6974 2773 2061 6363  whether it's acc
-00005460: 6570 7465 6420 7468 6174 2074 6865 7265  epted that there
-00005470: 2061 7265 206e 6f74 2069 6d61 6765 7320   are not images 
-00005480: 7965 7420 696e 2027 6469 7227 2e20 4465  yet in 'dir'. De
-00005490: 6661 756c 743a 2046 616c 7365 2e0a 2020  fault: False..  
-000054a0: 2020 2020 2020 2d20 7772 6974 6554 6d70        - writeTmp
-000054b0: 5072 6f76 4669 6c65 3a20 626f 6f6c 2077  ProvFile: bool w
-000054c0: 6865 7468 6572 2074 6f20 7772 6974 6520  hether to write 
-000054d0: 6120 7465 6d70 6f72 6172 7920 7072 6f76  a temporary prov
-000054e0: 656e 616e 6365 2066 696c 6520 6475 7269  enance file duri
-000054f0: 6e67 2074 6865 2069 4644 4f20 6372 6561  ng the iFDO crea
-00005500: 7469 6f6e 2070 726f 6365 7373 2077 6869  tion process whi
-00005510: 6368 2077 696c 6c20 6265 2072 6570 6c61  ch will be repla
-00005520: 6365 6420 6279 2061 2066 696e 616c 206f  ced by a final o
-00005530: 6e65 2069 6e20 7468 6520 656e 642e 2044  ne in the end. D
-00005540: 6566 6175 6c74 3a20 5472 7565 0a20 2020  efault: True.   
-00005550: 2020 2020 202d 2069 6d61 6765 5f62 726f       - image_bro
-00005560: 6b65 725f 7575 6964 3a20 7575 6964 206f  ker_uuid: uuid o
-00005570: 6620 696d 6167 6520 6272 6f6b 6572 2074  f image broker t
-00005580: 6f20 6372 6561 7465 2069 6d61 6765 2068  o create image h
-00005590: 616e 646c 6573 2061 7320 6874 7470 733a  andles as https:
-000055a0: 2f2f 6864 6c2e 6861 6e64 6c65 2e6e 6574  //hdl.handle.net
-000055b0: 2f3c 6861 6e64 6c65 5f70 7265 6669 783e  /<handle_prefix>
-000055c0: 2f3c 696d 6167 655f 6272 6f6b 6572 5f75  /<image_broker_u
-000055d0: 7569 643e 403c 696d 6167 652d 7575 6964  uid>@<image-uuid
-000055e0: 3e20 2222 220a 2020 2020 7265 6164 6572  > """.    reader
-000055f0: 203d 2069 4644 4f5f 5265 6164 6572 2869   = iFDO_Reader(i
-00005600: 4644 4f66 696c 6529 0a20 2020 2069 6d61  FDOfile).    ima
-00005610: 6765 7344 6972 203d 206d 6971 7463 2e74  gesDir = miqtc.t
-00005620: 6f55 6e69 7850 6174 6828 6f73 2e70 6174  oUnixPath(os.pat
-00005630: 682e 6e6f 726d 7061 7468 286d 6971 7463  h.normpath(miqtc
-00005640: 2e74 6f55 6e69 7850 6174 6828 7265 6164  .toUnixPath(read
-00005650: 6572 2e67 6574 496d 6167 6544 6972 6563  er.getImageDirec
-00005660: 746f 7279 2829 2929 290a 2020 2020 6261  tory()))).    ba
-00005670: 7365 4469 7220 3d20 6d69 7174 632e 746f  seDir = miqtc.to
-00005680: 556e 6978 5061 7468 286f 732e 7061 7468  UnixPath(os.path
-00005690: 2e63 6f6d 6d6f 6e70 6174 6828 5b69 4644  .commonpath([iFD
-000056a0: 4f66 696c 652c 696d 6167 6573 4469 725d  Ofile,imagesDir]
-000056b0: 2929 0a20 2020 2069 6d61 6765 4461 7461  )).    imageData
-000056c0: 5479 7065 466f 6c64 6572 203d 205b 6520  TypeFolder = [e 
-000056d0: 666f 7220 6520 696e 2069 6d61 6765 7344  for e in imagesD
-000056e0: 6972 2e72 6570 6c61 6365 2862 6173 6544  ir.replace(baseD
-000056f0: 6972 2c22 2229 2e73 706c 6974 2822 2f22  ir,"").split("/"
-00005700: 2920 6966 2065 2021 3d20 2222 5d5b 305d  ) if e != ""][0]
-00005710: 0a20 2020 2069 6620 696d 6167 6544 6174  .    if imageDat
-00005720: 6154 7970 6546 6f6c 6465 7220 6e6f 7420  aTypeFolder not 
-00005730: 696e 206d 6971 7464 2e44 6972 2e64 742e  in miqtd.Dir.dt.
-00005740: 5f5f 6d65 6d62 6572 735f 5f3a 0a20 2020  __members__:.   
-00005750: 2020 2020 2072 6169 7365 206d 6971 7463       raise miqtc
-00005760: 2e49 6664 6f45 7863 6570 7469 6f6e 2822  .IfdoException("
-00005770: 496d 6167 6573 2061 7265 206e 6f74 206c  Images are not l
-00005780: 6f63 6174 6564 2069 6e20 6120 7661 6c69  ocated in a vali
-00005790: 6420 6461 7461 2074 7970 6520 6469 7265  d data type dire
-000057a0: 6374 6f72 7920 2872 6177 2c20 696e 7465  ctory (raw, inte
-000057b0: 726d 6564 6961 7465 2c20 7072 6f63 6573  rmediate, proces
-000057c0: 7365 642c 202e 2e2e 2920 696e 2074 6865  sed, ...) in the
-000057d0: 2073 616d 6520 7072 6f6a 6563 7420 6173   same project as
-000057e0: 2069 4644 4f20 6669 6c65 2e22 290a 2020   iFDO file.").  
-000057f0: 2020 696d 6167 6573 4461 7461 5479 7065    imagesDataType
-00005800: 4469 7220 3d20 6f73 2e70 6174 682e 6a6f  Dir = os.path.jo
-00005810: 696e 2862 6173 6544 6972 2c69 6d61 6765  in(baseDir,image
-00005820: 4461 7461 5479 7065 466f 6c64 6572 290a  DataTypeFolder).
-00005830: 2020 2020 6469 724f 626a 203d 206d 6971      dirObj = miq
-00005840: 7464 2e44 6972 2822 222c 696d 6167 6573  td.Dir("",images
-00005850: 4461 7461 5479 7065 4469 722c 2063 7265  DataTypeDir, cre
-00005860: 6174 653d 4661 6c73 652c 2077 6974 685f  ate=False, with_
-00005870: 6765 6172 3d46 616c 7365 290a 2020 2020  gear=False).    
-00005880: 7265 7475 726e 2069 4644 4f28 6469 723d  return iFDO(dir=
-00005890: 6469 724f 626a 2c68 616e 646c 655f 7072  dirObj,handle_pr
-000058a0: 6566 6978 3d68 616e 646c 655f 7072 6566  efix=handle_pref
-000058b0: 6978 2c70 726f 7665 6e61 6e63 653d 7072  ix,provenance=pr
-000058c0: 6f76 656e 616e 6365 2c76 6572 626f 7365  ovenance,verbose
-000058d0: 3d76 6572 626f 7365 2c69 676e 6f72 655f  =verbose,ignore_
-000058e0: 696d 6167 655f 6669 6c65 733d 6967 6e6f  image_files=igno
-000058f0: 7265 5f69 6d61 6765 5f66 696c 6573 2c77  re_image_files,w
-00005900: 7269 7465 546d 7050 726f 7646 696c 653d  riteTmpProvFile=
-00005910: 7772 6974 6554 6d70 5072 6f76 4669 6c65  writeTmpProvFile
-00005920: 2c69 4644 4f66 696c 653d 6946 444f 6669  ,iFDOfile=iFDOfi
-00005930: 6c65 2c69 6d61 6765 5f62 726f 6b65 725f  le,image_broker_
-00005940: 7575 6964 3d69 6d61 6765 5f62 726f 6b65  uuid=image_broke
-00005950: 725f 7575 6964 290a 0a0a 636c 6173 7320  r_uuid)...class 
-00005960: 6946 444f 3a0a 2020 2020 2220 436c 6173  iFDO:.    " Clas
-00005970: 7320 666f 7220 6372 6561 7469 6e67 2061  s for creating a
-00005980: 6e64 2065 6469 7469 6e67 2069 4644 4f2e  nd editing iFDO.
-00005990: 7961 6d6c 2066 696c 6573 2022 0a0a 2020  yaml files "..  
-000059a0: 2020 6465 6620 5f5f 696e 6974 5f5f 2873    def __init__(s
-000059b0: 656c 662c 2064 6972 3a6d 6971 7464 2e44  elf, dir:miqtd.D
-000059c0: 6972 2c20 6861 6e64 6c65 5f70 7265 6669  ir, handle_prefi
-000059d0: 783d 2732 302e 3530 302e 3132 3038 3527  x='20.500.12085'
-000059e0: 2c70 726f 7665 6e61 6e63 6520 3d20 4e6f  ,provenance = No
-000059f0: 6e65 2c76 6572 626f 7365 3d54 7275 652c  ne,verbose=True,
-00005a00: 6967 6e6f 7265 5f69 6d61 6765 5f66 696c  ignore_image_fil
-00005a10: 6573 3d46 616c 7365 2c77 7269 7465 546d  es=False,writeTm
-00005a20: 7050 726f 7646 696c 653d 5472 7565 2c69  pProvFile=True,i
-00005a30: 4644 4f66 696c 653d 4e6f 6e65 2c69 6d61  FDOfile=None,ima
-00005a40: 6765 5f62 726f 6b65 725f 7575 6964 3d22  ge_broker_uuid="
-00005a50: 6565 3237 3735 3738 2d61 3931 312d 3438  ee277578-a911-48
-00005a60: 3464 2d61 3531 352d 3963 3738 3164 3739  4d-a515-9c781d79
-00005a70: 6161 3931 2229 3a0a 2020 2020 2020 2020  aa91"):.        
-00005a80: 2222 2220 4372 6561 7465 7320 616e 2069  """ Creates an i
-00005a90: 464f 4420 6f62 6a65 6374 2e20 5265 7175  FOD object. Requ
-00005aa0: 6972 6573 2061 2076 616c 6964 2064 6972  ires a valid dir
-00005ab0: 6563 746f 7279 2063 6f6e 7461 696e 696e  ectory containin
-00005ac0: 6720 696d 6167 6520 6461 7461 206f 722f  g image data or/
-00005ad0: 616e 6420 616e 6420 6946 444f 2066 696c  and and iFDO fil
-00005ae0: 6520 616e 6420 6120 6861 6e64 6c65 2070  e and a handle p
-00005af0: 7265 6669 7820 6966 2069 7427 7320 6e6f  refix if it's no
-00005b00: 7420 7468 6520 4765 6f6d 6172 206f 6e65  t the Geomar one
-00005b10: 2e20 4c6f 6164 7320 6469 7265 6374 6f72  . Loads director
-00005b20: 7927 7320 6946 444f 2066 696c 6520 6966  y's iFDO file if
-00005b30: 2069 7420 6578 6973 7473 2061 6c72 6561   it exists alrea
-00005b40: 6479 2e0a 2020 2020 2020 2020 2020 2020  dy..            
-00005b50: 2d20 6469 723a 206d 6172 6971 742e 6469  - dir: mariqt.di
-00005b60: 7265 6374 6f72 6965 732e 4469 7220 6f62  rectories.Dir ob
-00005b70: 6a65 6374 2070 6f69 6e74 696e 6720 746f  ject pointing to
-00005b80: 2061 2076 616c 6964 2064 6174 6120 7479   a valid data ty
-00005b90: 7065 2064 6972 6563 746f 7279 2028 7261  pe directory (ra
-00005ba0: 772c 2069 6e74 6572 6d65 6469 6174 652c  w, intermediate,
-00005bb0: 2070 726f 6365 7373 6564 2c20 2e2e 2e29   processed, ...)
-00005bc0: 2063 6f6e 7461 696e 696e 6720 7468 6520   containing the 
-00005bd0: 696d 6167 6520 6461 7461 2e0a 2020 2020  image data..    
-00005be0: 2020 2020 2020 2020 2d20 6861 6e64 6c65          - handle
-00005bf0: 5f70 7265 6669 783a 2073 7472 696e 6720  _prefix: string 
-00005c00: 7072 6566 6978 206f 6620 7468 6520 6861  prefix of the ha
-00005c10: 6e64 6c65 2073 6572 7665 722e 2044 6566  ndle server. Def
-00005c20: 6175 6c74 3a20 7468 6520 6f6e 6520 666f  ault: the one fo
-00005c30: 7220 4765 6f6d 6172 2e0a 2020 2020 2020  r Geomar..      
-00005c40: 2020 2020 2020 2d20 7072 6f76 656e 616e        - provenan
-00005c50: 6365 3a20 6d61 7269 7174 2e70 726f 7665  ce: mariqt.prove
-00005c60: 6e63 616e 6365 2e50 726f 7665 6e61 6e63  ncance.Provenanc
-00005c70: 6520 6f62 6a65 6374 2074 6f20 7472 6163  e object to trac
-00005c80: 6b20 6461 7461 2070 726f 7665 6e61 6e63  k data provenanc
-00005c90: 652e 2044 6566 6175 6c74 3a20 6120 6e65  e. Default: a ne
-00005ca0: 7720 7072 6f76 656e 616e 6365 206f 626a  w provenance obj
-00005cb0: 6563 7420 6973 2063 7265 6174 6564 2069  ect is created i
-00005cc0: 6e20 7468 6520 2770 726f 746f 636f 6c27  n the 'protocol'
-00005cd0: 2073 7562 666f 6c64 6572 2e0a 2020 2020   subfolder..    
-00005ce0: 2020 2020 2020 2020 2d20 7665 7262 6f73          - verbos
-00005cf0: 653a 2062 6f6f 6c20 7768 6574 6865 7220  e: bool whether 
-00005d00: 746f 2070 7269 6e74 206f 7574 2069 6e66  to print out inf
-00005d10: 6f72 6d61 7469 6f6e 2e20 4465 6661 756c  ormation. Defaul
-00005d20: 743a 2054 7275 652e 0a20 2020 2020 2020  t: True..       
-00005d30: 2020 2020 202d 2069 676e 6f72 655f 696d       - ignore_im
-00005d40: 6167 655f 6669 6c65 733a 2069 6d61 6765  age_files: image
-00005d50: 7320 6669 6c65 7320 6172 6520 6967 6e6f  s files are igno
-00005d60: 7265 642e 2054 6865 7920 6172 6520 6e6f  red. They are no
-00005d70: 7420 7365 6172 6368 6564 2066 6f72 2069  t searched for i
-00005d80: 6e20 2772 6177 2720 616e 6420 6974 656d  n 'raw' and item
-00005d90: 7320 7661 6c75 6573 2061 7265 206e 6f74  s values are not
-00005da0: 2075 7064 6174 6564 206e 6f72 2063 6865   updated nor che
-00005db0: 636b 6564 2e20 4465 6661 756c 7420 3d20  cked. Default = 
-00005dc0: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
-00005dd0: 2020 2d20 7772 6974 6554 6d70 5072 6f76    - writeTmpProv
-00005de0: 4669 6c65 3a20 626f 6f6c 2077 6865 7468  File: bool wheth
-00005df0: 6572 2074 6f20 7772 6974 6520 6120 7465  er to write a te
-00005e00: 6d70 6f72 6172 7920 7072 6f76 656e 616e  mporary provenan
-00005e10: 6365 2066 696c 6520 6475 7269 6e67 2074  ce file during t
-00005e20: 6865 2069 4644 4f20 6372 6561 7469 6f6e  he iFDO creation
-00005e30: 2070 726f 6365 7373 2077 6869 6368 2077   process which w
-00005e40: 696c 6c20 6265 2072 6570 6c61 6365 6420  ill be replaced 
-00005e50: 6279 2061 2066 696e 616c 206f 6e65 2069  by a final one i
-00005e60: 6e20 7468 6520 656e 642e 2044 6566 6175  n the end. Defau
-00005e70: 6c74 3a20 5472 7565 0a20 2020 2020 2020  lt: True.       
-00005e80: 2020 2020 202d 2069 4644 4f66 696c 653a       - iFDOfile:
-00005e90: 2073 7472 696e 6720 7061 7468 2074 6f20   string path to 
-00005ea0: 6c6f 6164 2061 6e20 6578 706c 6963 6974  load an explicit
-00005eb0: 2069 4644 4f20 6669 6c65 2e20 4966 206e   iFDO file. If n
-00005ec0: 6f74 2070 726f 7669 6465 6420 6120 6d61  ot provided a ma
-00005ed0: 7463 6869 6e67 2069 4644 4f20 6669 6c65  tching iFDO file
-00005ee0: 2028 6966 2069 7420 616c 7265 6164 7920   (if it already 
-00005ef0: 6578 6973 7473 2920 7769 6c6c 2062 6520  exists) will be 
-00005f00: 6c6f 6164 6564 2066 726f 6d20 7468 6520  loaded from the 
-00005f10: 2770 726f 6475 6374 7327 2073 7562 6469  'products' subdi
-00005f20: 7265 6374 6f72 792e 2044 6566 6175 6c74  rectory. Default
-00005f30: 3a20 4e6f 6e65 200a 2020 2020 2020 2020  : None .        
-00005f40: 2020 2020 2d20 696d 6167 655f 6272 6f6b      - image_brok
-00005f50: 6572 5f75 7569 643a 2075 7569 6420 6f66  er_uuid: uuid of
-00005f60: 2069 6d61 6765 2062 726f 6b65 7220 746f   image broker to
-00005f70: 2063 7265 6174 6520 696d 6167 6520 6861   create image ha
-00005f80: 6e64 6c65 7320 6173 2068 7474 7073 3a2f  ndles as https:/
-00005f90: 2f68 646c 2e68 616e 646c 652e 6e65 742f  /hdl.handle.net/
-00005fa0: 3c68 616e 646c 655f 7072 6566 6978 3e2f  <handle_prefix>/
-00005fb0: 3c69 6d61 6765 5f62 726f 6b65 725f 7575  <image_broker_uu
-00005fc0: 6964 3e40 3c69 6d61 6765 2d75 7569 643e  id>@<image-uuid>
-00005fd0: 2022 2222 0a0a 2020 2020 2020 2020 2320   """..        # 
-00005fe0: 6368 6563 6b20 7468 6174 2061 7420 6469  check that at di
-00005ff0: 7220 6f72 2069 4644 4f66 696c 6520 7072  r or iFDOfile pr
-00006000: 6f76 6964 6564 0a20 2020 2020 2020 2069  ovided.        i
-00006010: 6620 6469 7220 6973 204e 6f6e 6520 616e  f dir is None an
-00006020: 6420 6946 444f 6669 6c65 2069 7320 4e6f  d iFDOfile is No
-00006030: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00006040: 7261 6973 6520 6d69 7174 632e 4966 646f  raise miqtc.Ifdo
-00006050: 4578 6365 7074 696f 6e28 224e 6569 7468  Exception("Neith
-00006060: 6572 2064 6972 206e 6f72 2069 4644 4f66  er dir nor iFDOf
-00006070: 696c 6520 7072 6f76 6964 6564 2066 6f72  ile provided for
-00006080: 2069 4644 4f2e 2229 0a0a 2020 2020 2020   iFDO.")..      
-00006090: 2020 7365 6c66 2e64 6972 203d 2064 6972    self.dir = dir
-000060a0: 0a20 2020 2020 2020 2073 656c 662e 696d  .        self.im
-000060b0: 6167 6573 4469 7220 3d20 6469 722e 746f  agesDir = dir.to
-000060c0: 7479 7065 2829 0a20 2020 2020 2020 2073  type().        s
-000060d0: 656c 662e 6469 722e 6372 6561 7465 5479  elf.dir.createTy
-000060e0: 7065 466f 6c64 6572 2829 0a20 2020 2020  peFolder().     
-000060f0: 2020 2073 656c 662e 6861 6e64 6c65 5f70     self.handle_p
-00006100: 7265 6669 7820 3d20 2268 7474 7073 3a2f  refix = "https:/
-00006110: 2f68 646c 2e68 616e 646c 652e 6e65 742f  /hdl.handle.net/
-00006120: 2220 2b20 6861 6e64 6c65 5f70 7265 6669  " + handle_prefi
-00006130: 780a 2020 2020 2020 2020 7365 6c66 2e69  x.        self.i
-00006140: 6d61 6765 5f68 616e 646c 655f 7072 6566  mage_handle_pref
-00006150: 6978 203d 2073 656c 662e 6861 6e64 6c65  ix = self.handle
-00006160: 5f70 7265 6669 7820 2b20 222f 2220 2b20  _prefix + "/" + 
-00006170: 696d 6167 655f 6272 6f6b 6572 5f75 7569  image_broker_uui
-00006180: 640a 2020 2020 2020 2020 7365 6c66 2e69  d.        self.i
-00006190: 676e 6f72 655f 696d 6167 655f 6669 6c65  gnore_image_file
-000061a0: 7320 3d20 6967 6e6f 7265 5f69 6d61 6765  s = ignore_image
-000061b0: 5f66 696c 6573 0a0a 2020 2020 2020 2020  _files..        
-000061c0: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
-000061d0: 6465 724b 6579 203d 206d 6971 7476 2e69  derKey = miqtv.i
-000061e0: 6d61 6765 5f73 6574 5f68 6561 6465 725f  mage_set_header_
-000061f0: 6b65 790a 2020 2020 2020 2020 7365 6c66  key.        self
-00006200: 2e69 6d61 6765 5365 7449 7465 6d73 4b65  .imageSetItemsKe
-00006210: 7920 3d20 6d69 7174 762e 696d 6167 655f  y = miqtv.image_
-00006220: 7365 745f 6974 656d 735f 6b65 790a 2020  set_items_key.  
-00006230: 2020 2020 2020 7365 6c66 2e69 6664 6f5f        self.ifdo_
-00006240: 746d 7020 3d20 7b73 656c 662e 696d 6167  tmp = {self.imag
-00006250: 6553 6574 4865 6164 6572 4b65 793a 207b  eSetHeaderKey: {
-00006260: 7d2c 0a20 2020 2020 2020 2020 2020 2020  },.             
-00006270: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00006280: 2e69 6d61 6765 5365 7449 7465 6d73 4b65  .imageSetItemsKe
-00006290: 793a 207b 7d7d 0a20 2020 2020 2020 2073  y: {}}.        s
-000062a0: 656c 662e 6966 646f 5f70 6172 7365 6420  elf.ifdo_parsed 
-000062b0: 3d20 4e6f 6e65 0a20 2020 2020 2020 2073  = None.        s
-000062c0: 656c 662e 6966 646f 5f63 6865 636b 6564  elf.ifdo_checked
-000062d0: 203d 2063 6f70 792e 6465 6570 636f 7079   = copy.deepcopy
-000062e0: 2873 656c 662e 6966 646f 5f74 6d70 2920  (self.ifdo_tmp) 
-000062f0: 2023 2074 6f20 6265 2073 6574 2062 7920   # to be set by 
-00006300: 6372 6561 7465 6946 444f 2829 206f 6e6c  createiFDO() onl
-00006310: 7921 0a20 2020 2020 2020 2073 656c 662e  y!.        self.
-00006320: 5f5f 616c 6c55 5549 4473 4368 6563 6b65  __allUUIDsChecke
-00006330: 6420 3d20 4661 6c73 650a 2020 2020 2020  d = False.      
-00006340: 2020 7365 6c66 2e70 726f 7620 3d20 7072    self.prov = pr
-00006350: 6f76 656e 616e 6365 0a20 2020 2020 2020  ovenance.       
-00006360: 2069 6620 7072 6f76 656e 616e 6365 203d   if provenance =
-00006370: 3d20 4e6f 6e65 3a0a 2020 2020 2020 2020  = None:.        
-00006380: 2020 2020 746d 7046 696c 6550 6174 6820      tmpFilePath 
-00006390: 3d20 2222 0a20 2020 2020 2020 2020 2020  = "".           
-000063a0: 2069 6620 7772 6974 6554 6d70 5072 6f76   if writeTmpProv
-000063b0: 4669 6c65 3a0a 2020 2020 2020 2020 2020  File:.          
-000063c0: 2020 2020 2020 746d 7046 696c 6550 6174        tmpFilePat
-000063d0: 6820 3d20 7365 6c66 2e64 6972 2e74 6f28  h = self.dir.to(
-000063e0: 7365 6c66 2e64 6972 2e64 742e 7072 6f74  self.dir.dt.prot
-000063f0: 6f63 6f6c 290a 2020 2020 2020 2020 2020  ocol).          
-00006400: 2020 7365 6c66 2e70 726f 7620 3d20 6d69    self.prov = mi
-00006410: 7174 702e 5072 6f76 656e 616e 6365 2822  qtp.Provenance("
-00006420: 6946 444f 222c 7665 7262 6f73 653d 7665  iFDO",verbose=ve
-00006430: 7262 6f73 652c 746d 7046 696c 6550 6174  rbose,tmpFilePat
-00006440: 683d 746d 7046 696c 6550 6174 6829 0a0a  h=tmpFilePath)..
-00006450: 2020 2020 2020 2020 2320 7365 7420 676c          # set gl
-00006460: 6f62 616c 2076 6572 626f 7369 7479 0a20  obal verbosity. 
-00006470: 2020 2020 2020 206d 6971 7476 2e73 6574         miqtv.set
-00006480: 476c 6f62 616c 5665 7262 6f73 6528 7665  GlobalVerbose(ve
-00006490: 7262 6f73 6529 0a0a 2020 2020 2020 2020  rbose)..        
-000064a0: 6966 206e 6f74 2064 6972 2e65 7869 7374  if not dir.exist
-000064b0: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
-000064c0: 2072 6169 7365 2045 7863 6570 7469 6f6e   raise Exception
-000064d0: 2822 6469 7265 6374 726f 7922 2c20 6469  ("directroy", di
-000064e0: 722e 7374 7228 292c 2022 646f 6573 206e  r.str(), "does n
-000064f0: 6f74 2065 7869 7374 2e22 290a 0a20 2020  ot exist.")..   
-00006500: 2020 2020 2069 6620 6e6f 7420 6469 722e       if not dir.
-00006510: 7661 6c69 6444 6174 6144 6972 2829 3a0a  validDataDir():.
-00006520: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00006530: 6520 4578 6365 7074 696f 6e28 2264 6972  e Exception("dir
-00006540: 6563 7472 6f79 222c 2064 6972 2e73 7472  ectroy", dir.str
-00006550: 2829 2c20 226e 6f74 2076 616c 6964 2e20  (), "not valid. 
-00006560: 446f 6573 206e 6f74 2063 6f6d 706c 7920  Does not comply 
-00006570: 7769 7468 2073 7472 7563 7475 7265 202f  with structure /
-00006580: 6261 7365 2f70 726f 6a65 6374 2f5b 4765  base/project/[Ge
-00006590: 6172 2f5d 6576 656e 742f 7365 6e73 6f72  ar/]event/sensor
-000065a0: 2f64 6174 615f 7479 7065 2f22 290a 0a20  /data_type/").. 
-000065b0: 2020 2020 2020 2023 2063 6865 636b 2069         # check i
-000065c0: 4644 4f20 6669 6c65 0a20 2020 2020 2020  FDO file.       
-000065d0: 2073 656c 662e 6946 444f 6669 6c65 5f20   self.iFDOfile_ 
-000065e0: 3d20 2222 2023 2069 7320 7365 7420 6279  = "" # is set by
-000065f0: 2073 6574 6946 444f 4669 6c65 4e61 6d65   setiFDOFileName
-00006600: 2829 0a20 2020 2020 2020 206c 6f61 6465  ().        loade
-00006610: 6469 4644 4f20 3d20 4661 6c73 650a 2020  diFDO = False.  
-00006620: 2020 2020 2020 6966 206e 6f74 2069 4644        if not iFD
-00006630: 4f66 696c 6520 6973 204e 6f6e 653a 0a20  Ofile is None:. 
-00006640: 2020 2020 2020 2020 2020 2069 4644 4f66             iFDOf
-00006650: 696c 655f 203d 2069 4644 4f66 696c 650a  ile_ = iFDOfile.
-00006660: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00006670: 2e73 6574 6946 444f 4669 6c65 4e61 6d65  .setiFDOFileName
-00006680: 2869 4644 4f66 696c 655f 290a 2020 2020  (iFDOfile_).    
-00006690: 2020 2020 2020 2020 6966 206e 6f74 206f          if not o
-000066a0: 732e 7061 7468 2e69 7366 696c 6528 6946  s.path.isfile(iF
-000066b0: 444f 6669 6c65 5f29 3a0a 2020 2020 2020  DOfile_):.      
-000066c0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-000066d0: 6d69 7174 632e 4966 646f 4578 6365 7074  miqtc.IfdoExcept
-000066e0: 696f 6e28 2269 4644 4f20 6669 6c65 206e  ion("iFDO file n
-000066f0: 6f74 2066 6f75 6e64 3a20 2220 2b20 6946  ot found: " + iF
-00006700: 444f 6669 6c65 5f29 0a20 2020 2020 2020  DOfile_).       
-00006710: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00006720: 2020 2069 4644 4f66 696c 655f 203d 2073     iFDOfile_ = s
-00006730: 656c 662e 6469 722e 746f 2873 656c 662e  elf.dir.to(self.
-00006740: 6469 722e 6474 2e70 726f 6475 6374 7329  dir.dt.products)
-00006750: 2b73 656c 662e 636f 6e73 7472 7563 7469  +self.constructi
-00006760: 4644 4f66 696c 654e 616d 6528 7365 6c66  FDOfileName(self
-00006770: 2e64 6972 2e70 726f 6a65 6374 2829 2c73  .dir.project(),s
-00006780: 656c 662e 6469 722e 6576 656e 7428 292c  elf.dir.event(),
-00006790: 7365 6c66 2e64 6972 2e73 656e 736f 7228  self.dir.sensor(
-000067a0: 2929 0a0a 2020 2020 2020 2020 0a20 2020  ))..        .   
-000067b0: 2020 2020 2073 656c 662e 5f69 6d61 6765       self._image
-000067c0: 7349 6e49 6d61 6765 7344 6972 203d 205b  sInImagesDir = [
-000067d0: 5d0a 2020 2020 2020 2020 6966 2073 656c  ].        if sel
-000067e0: 662e 6967 6e6f 7265 5f69 6d61 6765 5f66  f.ignore_image_f
-000067f0: 696c 6573 3a0a 2020 2020 2020 2020 2020  iles:.          
-00006800: 2020 7072 696e 7428 2243 6175 7469 6f6e    print("Caution
-00006810: 2120 7275 6e6e 696e 6720 696e 2069 676e  ! running in ign
-00006820: 6f72 655f 696d 6167 655f 6669 6c65 7320  ore_image_files 
-00006830: 6d6f 6465 2e22 290a 2020 2020 2020 2020  mode.").        
-00006840: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00006850: 2020 7365 6c66 2e5f 696d 6167 6573 496e    self._imagesIn
-00006860: 496d 6167 6573 4469 7220 3d20 6d69 7174  ImagesDir = miqt
-00006870: 692e 6272 6f77 7365 466f 7249 6d61 6765  i.browseForImage
-00006880: 4669 6c65 7328 7365 6c66 2e69 6d61 6765  Files(self.image
-00006890: 7344 6972 290a 2020 2020 2020 2020 7365  sDir).        se
-000068a0: 6c66 2e5f 696d 6167 6573 496e 496d 6167  lf._imagesInImag
-000068b0: 6573 4469 7253 6f72 7465 644c 6973 7420  esDirSortedList 
-000068c0: 3d20 5b66 696c 6520 666f 7220 6669 6c65  = [file for file
-000068d0: 2069 6e20 7365 6c66 2e5f 696d 6167 6573   in self._images
-000068e0: 496e 496d 6167 6573 4469 725d 0a20 2020  InImagesDir].   
-000068f0: 2020 2020 2073 656c 662e 5f69 6d61 6765       self._image
-00006900: 7349 6e49 6d61 6765 7344 6972 536f 7274  sInImagesDirSort
-00006910: 6564 4c69 7374 2e73 6f72 7428 290a 2020  edList.sort().  
-00006920: 2020 2020 2020 7365 6c66 2e5f 696d 6167        self._imag
-00006930: 654e 616d 6573 496d 6167 6573 4469 7220  eNamesImagesDir 
-00006940: 3d20 5b6f 732e 7061 7468 2e62 6173 656e  = [os.path.basen
-00006950: 616d 6528 6669 6c65 2920 666f 7220 6669  ame(file) for fi
-00006960: 6c65 2069 6e20 7365 6c66 2e5f 696d 6167  le in self._imag
-00006970: 6573 496e 496d 6167 6573 4469 725d 0a0a  esInImagesDir]..
-00006980: 2020 2020 2020 2020 6966 206c 656e 2873          if len(s
-00006990: 656c 662e 5f69 6d61 6765 7349 6e49 6d61  elf._imagesInIma
-000069a0: 6765 7344 6972 2920 3d3d 2030 2061 6e64  gesDir) == 0 and
-000069b0: 206e 6f74 2069 676e 6f72 655f 696d 6167   not ignore_imag
-000069c0: 655f 6669 6c65 733a 0a20 2020 2020 2020  e_files:.       
-000069d0: 2020 2020 2072 6169 7365 2045 7863 6570       raise Excep
-000069e0: 7469 6f6e 2822 4e6f 2069 6d61 6765 7320  tion("No images 
-000069f0: 6669 6c65 7320 666f 756e 6420 696e 2022  files found in "
-00006a00: 202b 2073 656c 662e 696d 6167 6573 4469   + self.imagesDi
-00006a10: 7220 2b20 2220 616e 6420 6974 7320 7375  r + " and its su
-00006a20: 6264 6972 6563 746f 7269 6573 2229 0a0a  bdirectories")..
-00006a30: 2020 2020 2020 2020 756e 6971 7565 2c20          unique, 
-00006a40: 6475 7020 3d20 6d69 7174 742e 6669 6c65  dup = miqtt.file
-00006a50: 7348 6176 6555 6e69 7175 654e 616d 6528  sHaveUniqueName(
-00006a60: 7365 6c66 2e5f 696d 6167 6573 496e 496d  self._imagesInIm
-00006a70: 6167 6573 4469 7229 0a20 2020 2020 2020  agesDir).       
-00006a80: 2069 6620 6e6f 7420 756e 6971 7565 3a0a   if not unique:.
-00006a90: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00006aa0: 6520 4578 6365 7074 696f 6e28 0a20 2020  e Exception(.   
-00006ab0: 2020 2020 2020 2020 2020 2020 2022 4e6f               "No
-00006ac0: 7420 616c 6c20 6669 6c65 7320 6861 7665  t all files have
-00006ad0: 2075 6e69 7175 6520 6e61 6d65 732e 2044   unique names. D
-00006ae0: 7570 6c69 6361 7465 733a 2022 202b 2073  uplicates: " + s
-00006af0: 7472 2864 7570 2929 0a0a 2020 2020 2020  tr(dup))..      
-00006b00: 2020 616c 6c76 616c 6964 2c20 6d73 6720    allvalid, msg 
-00006b10: 3d20 6d69 7174 742e 616c 6c49 6d61 6765  = miqtt.allImage
-00006b20: 4e61 6d65 7356 616c 6964 2873 656c 662e  NamesValid(self.
-00006b30: 5f69 6d61 6765 7349 6e49 6d61 6765 7344  _imagesInImagesD
-00006b40: 6972 2920 0a20 2020 2020 2020 2069 6620  ir) .        if 
-00006b50: 6e6f 7420 616c 6c76 616c 6964 3a0a 2020  not allvalid:.  
-00006b60: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00006b70: 4578 6365 7074 696f 6e28 6d73 6729 0a0a  Exception(msg)..
-00006b80: 2020 2020 2020 2020 7365 6c66 2e70 726f          self.pro
-00006b90: 762e 6c6f 6728 7374 7228 6c65 6e28 7365  v.log(str(len(se
-00006ba0: 6c66 2e5f 696d 6167 6573 496e 496d 6167  lf._imagesInImag
-00006bb0: 6573 4469 7229 2920 2b20 2220 696d 6167  esDir)) + " imag
-00006bc0: 6520 6669 6c65 7320 666f 756e 642e 2229  e files found.")
-00006bd0: 0a20 2020 2020 2020 2073 656c 662e 7072  .        self.pr
-00006be0: 6f76 2e6c 6f67 2822 2229 0a20 2020 2020  ov.log("").     
-00006bf0: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
-00006c00: 2822 466f 6c6c 6f77 696e 6720 696e 666f  ("Following info
-00006c10: 726d 6174 696f 6e20 7761 7320 7061 7273  rmation was pars
-00006c20: 6564 2066 726f 6d20 6469 7265 6374 6f72  ed from director
-00006c30: 792c 2070 6c65 6173 6520 6368 6563 6b20  y, please check 
-00006c40: 666f 7220 636f 7272 6563 746e 6573 733a  for correctness:
-00006c50: 2229 0a20 2020 2020 2020 2073 656c 662e  ").        self.
-00006c60: 7072 6f76 2e6c 6f67 2822 5072 6f6a 6563  prov.log("Projec
-00006c70: 743a 5c74 222b 7365 6c66 2e64 6972 2e70  t:\t"+self.dir.p
-00006c80: 726f 6a65 6374 2829 290a 2020 2020 2020  roject()).      
-00006c90: 2020 6966 2073 656c 662e 6469 722e 7769    if self.dir.wi
-00006ca0: 7468 5f67 6561 723a 0a20 2020 2020 2020  th_gear:.       
-00006cb0: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
-00006cc0: 6f67 2822 4765 6172 3a5c 745c 7422 2b73  og("Gear:\t\t"+s
-00006cd0: 656c 662e 6469 722e 6765 6172 2829 290a  elf.dir.gear()).
-00006ce0: 2020 2020 2020 2020 7365 6c66 2e70 726f          self.pro
-00006cf0: 762e 6c6f 6728 2245 7665 6e74 3a5c 745c  v.log("Event:\t\
-00006d00: 7422 2b73 656c 662e 6469 722e 6576 656e  t"+self.dir.even
-00006d10: 7428 2929 0a20 2020 2020 2020 2073 656c  t()).        sel
-00006d20: 662e 7072 6f76 2e6c 6f67 2822 5365 6e73  f.prov.log("Sens
-00006d30: 6f72 3a5c 745c 7422 2b73 656c 662e 6469  or:\t\t"+self.di
-00006d40: 722e 7365 6e73 6f72 2829 290a 2020 2020  r.sensor()).    
-00006d50: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
-00006d60: 6728 2222 290a 0a20 2020 2020 2020 2023  g("")..        #
-00006d70: 2069 6e74 6572 6d65 6469 6174 6520 6669   intermediate fi
-00006d80: 6c65 730a 2020 2020 2020 2020 7365 6c66  les.        self
-00006d90: 2e5f 5f69 6e69 7449 6e74 6572 6d65 6469  .__initIntermedi
-00006da0: 6174 6546 696c 6573 2829 2020 2020 0a0a  ateFiles()    ..
-00006db0: 2020 2020 2020 2020 2320 7472 7920 6c6f          # try lo
-00006dc0: 6164 2065 7869 7374 696e 6720 6946 444f  ad existing iFDO
-00006dd0: 2066 696c 650a 2020 2020 2020 2020 6966   file.        if
-00006de0: 2873 656c 662e 7265 6164 6946 444f 6669  (self.readiFDOfi
-00006df0: 6c65 2869 4644 4f66 696c 655f 2929 3a0a  le(iFDOfile_)):.
-00006e00: 2020 2020 2020 2020 2020 2020 6c6f 6164              load
-00006e10: 6564 6946 444f 203d 2054 7275 650a 2020  ediFDO = True.  
-00006e20: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00006e30: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-00006e40: 2020 2020 2020 2020 2020 2020 2070 6174               pat
-00006e50: 6820 3d20 7365 6c66 2e64 6972 2e74 6f28  h = self.dir.to(
-00006e60: 7365 6c66 2e64 6972 2e64 742e 7072 6f64  self.dir.dt.prod
-00006e70: 7563 7473 290a 2020 2020 2020 2020 2020  ucts).          
-00006e80: 2020 2020 2020 666f 7220 6669 6c65 5f20        for file_ 
-00006e90: 696e 206f 732e 6c69 7374 6469 7228 7061  in os.listdir(pa
-00006ea0: 7468 293a 0a20 2020 2020 2020 2020 2020  th):.           
-00006eb0: 2020 2020 2020 2020 2069 6620 6669 6c65           if file
-00006ec0: 5f5b 2d31 303a 2d34 5d20 3d3d 2022 5f69  _[-10:-4] == "_i
-00006ed0: 4644 4f2e 2220 616e 6420 7365 6c66 2e72  FDO." and self.r
-00006ee0: 6561 6469 4644 4f66 696c 6528 7061 7468  eadiFDOfile(path
-00006ef0: 2b66 696c 655f 293a 0a20 2020 2020 2020  +file_):.       
-00006f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006f10: 206c 6f61 6465 6469 4644 4f20 3d20 5472   loadediFDO = Tr
-00006f20: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
-00006f30: 2020 2020 2020 2020 2020 2069 4644 4f66             iFDOf
-00006f40: 696c 655f 203d 2070 6174 682b 6669 6c65  ile_ = path+file
-00006f50: 5f0a 2020 2020 2020 2020 2020 2020 2020  _.              
-00006f60: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
-00006f70: 2020 2020 2020 2020 2020 2020 6578 6365              exce
-00006f80: 7074 2046 696c 654e 6f74 466f 756e 6445  pt FileNotFoundE
-00006f90: 7272 6f72 3a0a 2020 2020 2020 2020 2020  rror:.          
-00006fa0: 2020 2020 2020 7061 7373 2020 2020 2020        pass      
-00006fb0: 2020 0a0a 2020 2020 2020 2020 7365 6c66    ..        self
-00006fc0: 2e74 7279 4175 746f 5365 7448 6561 6465  .tryAutoSetHeade
-00006fd0: 7246 6965 6c64 7328 290a 2020 2020 2020  rFields().      
-00006fe0: 2020 7365 6c66 2e73 6574 4865 6164 6572    self.setHeader
-00006ff0: 496d 6167 654c 6f63 616c 5061 7468 4669  ImageLocalPathFi
-00007000: 656c 6428 290a 2020 2020 2020 2020 6966  eld().        if
-00007010: 206c 6f61 6465 6469 4644 4f3a 0a20 2020   loadediFDO:.   
-00007020: 2020 2020 2020 2020 2073 656c 662e 7365           self.se
-00007030: 7469 4644 4f46 696c 654e 616d 6528 6946  tiFDOFileName(iF
-00007040: 444f 6669 6c65 5f29 0a0a 0a20 2020 2064  DOfile_)...    d
-00007050: 6566 2072 6561 6469 4644 4f66 696c 6528  ef readiFDOfile(
-00007060: 7365 6c66 2c66 696c 653a 7374 7229 3a0a  self,file:str):.
-00007070: 2020 2020 2020 2020 2222 2220 7265 6164          """ read
-00007080: 7320 6946 444f 2066 696c 6520 2222 220a  s iFDO file """.
-00007090: 2020 2020 2020 2020 7472 795f 7961 6d6c          try_yaml
-000070a0: 203d 2046 616c 7365 0a0a 2020 2020 2020   = False..      
-000070b0: 2020 2320 6966 2066 696c 6520 6973 2079    # if file is y
-000070c0: 616d 6c20 6669 6c65 206c 6f61 6420 6974  aml file load it
-000070d0: 2061 7320 7375 6368 0a20 2020 2020 2020   as such.       
-000070e0: 2069 6620 6669 6c65 2e73 706c 6974 2827   if file.split('
-000070f0: 2e27 295b 2d31 5d20 3d3d 2027 7961 6d6c  .')[-1] == 'yaml
-00007100: 273a 0a20 2020 2020 2020 2020 2020 2074  ':.            t
-00007110: 7279 5f79 616d 6c20 3d20 5472 7565 0a20  ry_yaml = True. 
-00007120: 2020 2020 2020 2020 2020 2066 696c 655f             file_
-00007130: 7961 6d6c 203d 2066 696c 650a 0a20 2020  yaml = file..   
-00007140: 2020 2020 2069 6620 6e6f 7420 6f73 2e70       if not os.p
-00007150: 6174 682e 6973 6669 6c65 2866 696c 6529  ath.isfile(file)
-00007160: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-00007170: 6966 2066 696c 6520 646f 6573 206e 6f74  if file does not
-00007180: 2065 7869 7374 2063 6865 636b 2069 6620   exist check if 
-00007190: 7961 6d6c 2076 6572 7369 6f6e 2065 7873  yaml version exs
-000071a0: 6973 7420 616e 6420 7472 7920 746f 206c  ist and try to l
-000071b0: 6f61 6420 7468 6174 206f 6e65 0a20 2020  oad that one.   
-000071c0: 2020 2020 2020 2020 2066 696c 655f 7961           file_ya
-000071d0: 6d6c 203d 2066 696c 652e 7265 706c 6163  ml = file.replac
-000071e0: 6528 272e 6a73 6f6e 272c 272e 7961 6d6c  e('.json','.yaml
-000071f0: 2729 0a20 2020 2020 2020 2020 2020 2069  ').            i
-00007200: 6620 6f73 2e70 6174 682e 6973 6669 6c65  f os.path.isfile
-00007210: 2866 696c 655f 7961 6d6c 293a 0a20 2020  (file_yaml):.   
-00007220: 2020 2020 2020 2020 2020 2020 2074 7279               try
-00007230: 5f79 616d 6c20 3d20 5472 7565 0a20 2020  _yaml = True.   
-00007240: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00007250: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00007260: 6574 7572 6e20 4661 6c73 650a 0a20 2020  eturn False..   
-00007270: 2020 2020 2073 203d 206d 6971 7463 2e50       s = miqtc.P
-00007280: 7269 6e74 4c6f 6164 696e 674d 7367 2822  rintLoadingMsg("
-00007290: 4c6f 6164 696e 6720 6946 444f 2066 696c  Loading iFDO fil
-000072a0: 6522 290a 2020 2020 2020 2020 7472 793a  e").        try:
-000072b0: 0a20 2020 2020 2020 2020 2020 2023 2074  .            # t
-000072c0: 7279 206c 6f61 6420 6a73 6f6e 2c20 6f74  ry load json, ot
-000072d0: 6865 7277 6973 6520 7472 7920 7961 6d6c  herwise try yaml
-000072e0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000072f0: 7472 795f 7961 6d6c 3a0a 2020 2020 2020  try_yaml:.      
-00007300: 2020 2020 2020 2020 2020 6f20 3d20 6f70            o = op
-00007310: 656e 2866 696c 655f 7961 6d6c 2c20 2772  en(file_yaml, 'r
-00007320: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-00007330: 2020 2073 656c 662e 6966 646f 5f74 6d70     self.ifdo_tmp
-00007340: 203d 2079 616d 6c2e 6c6f 6164 286f 2c20   = yaml.load(o, 
-00007350: 204c 6f61 6465 723d 7961 6d6c 2e43 4c6f   Loader=yaml.CLo
-00007360: 6164 6572 290a 2020 2020 2020 2020 2020  ader).          
-00007370: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00007380: 2020 2020 2020 2020 6f20 3d20 6f70 656e          o = open
-00007390: 2866 696c 652c 2027 7227 290a 2020 2020  (file, 'r').    
-000073a0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000073b0: 2e69 6664 6f5f 746d 7020 3d20 6a73 6f6e  .ifdo_tmp = json
-000073c0: 2e6c 6f61 6428 6f29 0a0a 2020 2020 2020  .load(o)..      
-000073d0: 2020 2020 2020 7365 6c66 2e69 6664 6f5f        self.ifdo_
-000073e0: 7061 7273 6564 203d 2063 6f70 792e 6465  parsed = copy.de
-000073f0: 6570 636f 7079 2873 656c 662e 6966 646f  epcopy(self.ifdo
-00007400: 5f74 6d70 290a 2020 2020 2020 2020 2020  _tmp).          
-00007410: 2020 6f2e 636c 6f73 6528 290a 2020 2020    o.close().    
-00007420: 2020 2020 2020 2020 732e 7374 6f70 2829          s.stop()
-00007430: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00007440: 662e 7072 6f76 2e61 6464 5072 6576 696f  f.prov.addPrevio
-00007450: 7573 5072 6f76 656e 616e 6365 2873 656c  usProvenance(sel
-00007460: 662e 7072 6f76 2e67 6574 4c61 7374 5072  f.prov.getLastPr
-00007470: 6f76 656e 616e 6365 4669 6c65 2873 656c  ovenanceFile(sel
-00007480: 662e 6469 722e 746f 2873 656c 662e 6469  f.dir.to(self.di
-00007490: 722e 6474 2e70 726f 746f 636f 6c29 2c73  r.dt.protocol),s
-000074a0: 656c 662e 7072 6f76 2e65 7865 6375 7461  elf.prov.executa
-000074b0: 626c 6529 290a 2020 2020 2020 2020 6578  ble)).        ex
-000074c0: 6365 7074 2045 7863 6570 7469 6f6e 2061  cept Exception a
-000074d0: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
-000074e0: 2073 656c 662e 7072 6f76 2e6c 6f67 2873   self.prov.log(s
-000074f0: 7472 2865 2e61 7267 7329 290a 2020 2020  tr(e.args)).    
-00007500: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-00007510: 616c 7365 0a20 2020 2020 2020 2073 2e73  alse.        s.s
-00007520: 746f 7028 290a 0a20 2020 2020 2020 2023  top()..        #
-00007530: 2074 7279 2074 6f20 7061 7273 6520 652e   try to parse e.
-00007540: 672e 2073 7472 696e 6773 2074 6861 7420  g. strings that 
-00007550: 7265 7072 6573 656e 7420 6469 6374 730a  represent dicts.
-00007560: 2020 2020 2020 2020 6d69 7174 632e 7265          miqtc.re
-00007570: 6375 7273 6976 6545 7661 6c28 7365 6c66  cursiveEval(self
-00007580: 2e69 6664 6f5f 746d 7029 0a0a 2020 2020  .ifdo_tmp)..    
-00007590: 2020 2020 6966 2073 656c 662e 696d 6167      if self.imag
-000075a0: 6553 6574 4865 6164 6572 4b65 7920 6e6f  eSetHeaderKey no
-000075b0: 7420 696e 2073 656c 662e 6966 646f 5f74  t in self.ifdo_t
-000075c0: 6d70 3a0a 2020 2020 2020 2020 2020 2020  mp:.            
-000075d0: 7261 6973 6520 4578 6365 7074 696f 6e28  raise Exception(
-000075e0: 2245 7272 6f72 206c 6f61 6469 6e67 2069  "Error loading i
-000075f0: 4644 4f20 6669 6c65 222c 6669 6c65 2c22  FDO file",file,"
-00007600: 646f 6573 206e 6f74 2063 6f6e 7461 696e  does not contain
-00007610: 222c 7365 6c66 2e69 6d61 6765 5365 7448  ",self.imageSetH
-00007620: 6561 6465 724b 6579 290a 2020 2020 2020  eaderKey).      
-00007630: 2020 6966 2073 656c 662e 696d 6167 6553    if self.imageS
-00007640: 6574 4974 656d 734b 6579 206e 6f74 2069  etItemsKey not i
-00007650: 6e20 7365 6c66 2e69 6664 6f5f 746d 703a  n self.ifdo_tmp:
-00007660: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00007670: 7365 2045 7863 6570 7469 6f6e 2822 4572  se Exception("Er
-00007680: 726f 7220 6c6f 6164 696e 6720 6946 444f  ror loading iFDO
-00007690: 2066 696c 6522 2c66 696c 652c 2264 6f65   file",file,"doe
-000076a0: 7320 6e6f 7420 636f 6e74 6169 6e22 2c73  s not contain",s
-000076b0: 656c 662e 696d 6167 6553 6574 4974 656d  elf.imageSetItem
-000076c0: 734b 6579 290a 0a20 2020 2020 2020 2069  sKey)..        i
-000076d0: 6620 2073 656c 662e 6966 646f 5f74 6d70  f  self.ifdo_tmp
-000076e0: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
-000076f0: 6164 6572 4b65 795d 203d 3d20 4e6f 6e65  aderKey] == None
-00007700: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-00007710: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
-00007720: 2e69 6d61 6765 5365 7448 6561 6465 724b  .imageSetHeaderK
-00007730: 6579 5d20 3d20 7b7d 0a20 2020 2020 2020  ey] = {}.       
-00007740: 2069 6620 7365 6c66 2e69 6664 6f5f 746d   if self.ifdo_tm
-00007750: 705b 7365 6c66 2e69 6d61 6765 5365 7449  p[self.imageSetI
-00007760: 7465 6d73 4b65 795d 203d 3d20 4e6f 6e65  temsKey] == None
-00007770: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-00007780: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
-00007790: 2e69 6d61 6765 5365 7449 7465 6d73 4b65  .imageSetItemsKe
-000077a0: 795d 203d 207b 7d0a 0a20 2020 2020 2020  y] = {}..       
-000077b0: 2073 656c 662e 7072 6f76 2e6c 6f67 2822   self.prov.log("
-000077c0: 6946 444f 2066 696c 6520 6c6f 6164 6564  iFDO file loaded
-000077d0: 3a5c 7422 2b6f 732e 7061 7468 2e62 6173  :\t"+os.path.bas
-000077e0: 656e 616d 6528 6669 6c65 2929 0a0a 2020  ename(file))..  
-000077f0: 2020 2020 2020 2320 6368 6563 6b20 6946        # check iF
-00007800: 444f 2076 6572 7369 6f6e 0a20 2020 2020  DO version.     
-00007810: 2020 2072 6561 6456 6572 7369 6f6e 203d     readVersion =
-00007820: 2022 762e 312e 302e 3022 2023 2064 6964   "v.1.0.0" # did
-00007830: 206e 6f74 2068 6176 6520 7468 6520 2769   not have the 'i
-00007840: 6d61 6765 2d73 6574 2d69 6664 6f2d 7665  mage-set-ifdo-ve
-00007850: 7273 696f 6e27 2066 6965 6c64 2079 6574  rsion' field yet
-00007860: 0a20 2020 2020 2020 2074 7279 3a20 0a20  .        try: . 
-00007870: 2020 2020 2020 2020 2020 2072 6561 6456             readV
-00007880: 6572 7369 6f6e 203d 2073 656c 662e 6669  ersion = self.fi
-00007890: 6e64 546d 7046 6965 6c64 2827 696d 6167  ndTmpField('imag
-000078a0: 652d 7365 742d 6966 646f 2d76 6572 7369  e-set-ifdo-versi
-000078b0: 6f6e 2729 0a20 2020 2020 2020 2065 7863  on').        exc
-000078c0: 6570 7420 4b65 7945 7272 6f72 3a0a 2020  ept KeyError:.  
-000078d0: 2020 2020 2020 2020 2020 7061 7373 0a20            pass. 
-000078e0: 2020 2020 2020 2069 6e74 5265 6164 5665         intReadVe
-000078f0: 7273 696f 6e20 3d20 5665 7273 696f 6e28  rsion = Version(
-00007900: 7265 6164 5665 7273 696f 6e29 0a20 2020  readVersion).   
-00007910: 2020 2020 2069 6e74 5468 6973 5665 7273       intThisVers
-00007920: 696f 6e20 3d20 5665 7273 696f 6e28 6d69  ion = Version(mi
-00007930: 7174 762e 6946 444f 5f76 6572 7369 6f6e  qtv.iFDO_version
-00007940: 290a 2020 2020 2020 2020 6966 2069 6e74  ).        if int
-00007950: 5265 6164 5665 7273 696f 6e20 3c20 696e  ReadVersion < in
-00007960: 7454 6869 7356 6572 7369 6f6e 3a0a 2020  tThisVersion:.  
-00007970: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
-00007980: 726f 762e 6c6f 6728 224c 6f61 6465 6420  rov.log("Loaded 
-00007990: 6946 444f 2068 6173 2076 6572 7369 6f6e  iFDO has version
-000079a0: 2022 202b 2072 6561 6456 6572 7369 6f6e   " + readVersion
-000079b0: 202b 2022 2061 6e64 2077 696c 6c20 6265   + " and will be
-000079c0: 2075 7064 6174 6564 2074 6f20 7665 7273   updated to vers
-000079d0: 696f 6e20 2220 2b20 6d69 7174 762e 6946  ion " + miqtv.iF
-000079e0: 444f 5f76 6572 7369 6f6e 290a 2020 2020  DO_version).    
-000079f0: 2020 2020 6966 2069 6e74 5265 6164 5665      if intReadVe
-00007a00: 7273 696f 6e20 3e20 696e 7454 6869 7356  rsion > intThisV
-00007a10: 6572 7369 6f6e 3a0a 2020 2020 2020 2020  ersion:.        
-00007a20: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
-00007a30: 6728 2243 6175 7469 6f6e 2120 4c6f 6164  g("Caution! Load
-00007a40: 6564 2069 4644 4f20 6861 7320 7665 7273  ed iFDO has vers
-00007a50: 696f 6e20 2220 2b20 7265 6164 5665 7273  ion " + readVers
-00007a60: 696f 6e20 2b20 2220 6973 2061 6865 6164  ion + " is ahead
-00007a70: 206f 6620 7665 7273 696f 6e20 7573 6564   of version used
-00007a80: 2068 6572 653a 2022 202b 206d 6971 7476   here: " + miqtv
-00007a90: 2e69 4644 4f5f 7665 7273 696f 6e29 0a0a  .iFDO_version)..
-00007aa0: 2020 2020 2020 2020 2320 666f 7220 736f          # for so
-00007ab0: 6f6f 6f6f 6d65 2072 6561 736f 6e20 7468  oooome reason th
-00007ac0: 6973 2066 6978 6573 2061 2068 6963 6b75  is fixes a hicku
-00007ad0: 7020 6f66 2074 6865 2070 726f 6720 696e  p of the prog in
-00007ae0: 2063 7265 6174 6569 4644 4f28 290a 2020   createiFDO().  
-00007af0: 2020 2020 2020 7072 6f67 203d 206d 6971        prog = miq
-00007b00: 7463 2e50 7269 6e74 4b6e 6f77 6e50 726f  tc.PrintKnownPro
-00007b10: 6772 6573 734d 7367 2822 666f 6f22 2c20  gressMsg("foo", 
-00007b20: 312c 6d6f 6475 6c6f 3d31 290a 2020 2020  1,modulo=1).    
-00007b30: 2020 2020 7072 6f67 2e63 6c65 6172 2829      prog.clear()
-00007b40: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-00007b50: 2020 2020 2020 2020 2020 7365 6c66 2e63            self.c
-00007b60: 6f6e 7665 7274 546f 4465 6661 756c 7444  onvertToDefaultD
-00007b70: 6174 6554 696d 6546 6f72 6d61 7428 7365  ateTimeFormat(se
-00007b80: 6c66 2e69 6664 6f5f 746d 7029 0a20 2020  lf.ifdo_tmp).   
-00007b90: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
-00007ba0: 7074 696f 6e20 6173 2065 783a 0a20 2020  ption as ex:.   
-00007bb0: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
-00007bc0: 6f76 2e6c 6f67 2822 4368 6563 6b69 6e67  ov.log("Checking
-00007bd0: 2064 6174 6574 696d 6520 666f 726d 6174   datetime format
-00007be0: 3a20 2220 2b20 7374 7228 6578 2929 0a0a  : " + str(ex))..
-00007bf0: 2020 2020 2020 2020 2320 666f 7220 736f          # for so
-00007c00: 6f6f 6f6f 6d65 2072 6561 736f 6e20 7468  oooome reason th
-00007c10: 6973 2066 6978 6573 2061 2068 6963 6b75  is fixes a hicku
-00007c20: 7020 6f66 2074 6865 2070 726f 6720 696e  p of the prog in
-00007c30: 2063 7265 6174 6569 4644 4f28 290a 2020   createiFDO().  
-00007c40: 2020 2020 2020 7072 6f67 203d 206d 6971        prog = miq
-00007c50: 7463 2e50 7269 6e74 4b6e 6f77 6e50 726f  tc.PrintKnownPro
-00007c60: 6772 6573 734d 7367 2822 666f 6f22 2c20  gressMsg("foo", 
-00007c70: 312c 6d6f 6475 6c6f 3d31 290a 2020 2020  1,modulo=1).    
-00007c80: 2020 2020 7072 6f67 2e63 6c65 6172 2829      prog.clear()
-00007c90: 0a0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
-00007ca0: 7472 795f 7570 6772 6164 655f 746f 5f69  try_upgrade_to_i
-00007cb0: 6664 6f5f 7665 7273 696f 6e5f 3278 2829  fdo_version_2x()
-00007cc0: 0a0a 2020 2020 2020 2020 2320 6368 6563  ..        # chec
-00007cd0: 6b20 7265 6164 2069 4644 4f20 6669 6c65  k read iFDO file
-00007ce0: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-00007cf0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-00007d00: 2073 656c 662e 6967 6e6f 7265 5f69 6d61   self.ignore_ima
-00007d10: 6765 5f66 696c 6573 3a0a 2020 2020 2020  ge_files:.      
-00007d20: 2020 2020 2020 2020 2020 7365 6c66 2e63            self.c
-00007d30: 7265 6174 6569 4644 4f28 7365 6c66 2e69  reateiFDO(self.i
-00007d40: 6664 6f5f 746d 705b 7365 6c66 2e69 6d61  fdo_tmp[self.ima
-00007d50: 6765 5365 7448 6561 6465 724b 6579 5d2c  geSetHeaderKey],
-00007d60: 206d 6971 7469 2e63 7265 6174 6549 6d61   miqti.createIma
-00007d70: 6765 4974 656d 734c 6973 7446 726f 6d49  geItemsListFromI
-00007d80: 6d61 6765 4974 656d 7344 6963 7428 7365  mageItemsDict(se
-00007d90: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
-00007da0: 2e69 6d61 6765 5365 7449 7465 6d73 4b65  .imageSetItemsKe
-00007db0: 795d 2929 0a20 2020 2020 2020 2020 2020  y])).           
-00007dc0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00007dd0: 2020 2020 2020 2073 656c 662e 7570 6461         self.upda
-00007de0: 7465 6946 444f 2873 656c 662e 6966 646f  teiFDO(self.ifdo
-00007df0: 5f74 6d70 5b73 656c 662e 696d 6167 6553  _tmp[self.imageS
-00007e00: 6574 4865 6164 6572 4b65 795d 2c20 6d69  etHeaderKey], mi
-00007e10: 7174 692e 6372 6561 7465 496d 6167 6549  qti.createImageI
-00007e20: 7465 6d73 4c69 7374 4672 6f6d 496d 6167  temsListFromImag
-00007e30: 6549 7465 6d73 4469 6374 2873 656c 662e  eItemsDict(self.
-00007e40: 6966 646f 5f74 6d70 5b73 656c 662e 696d  ifdo_tmp[self.im
-00007e50: 6167 6553 6574 4974 656d 734b 6579 5d29  ageSetItemsKey])
-00007e60: 2c68 6561 6465 725f 6f6e 6c79 3d73 656c  ,header_only=sel
-00007e70: 662e 6967 6e6f 7265 5f69 6d61 6765 5f66  f.ignore_image_f
-00007e80: 696c 6573 290a 2020 2020 2020 2020 6578  iles).        ex
-00007e90: 6365 7074 2045 7863 6570 7469 6f6e 2061  cept Exception a
-00007ea0: 7320 6578 3a0a 2020 2020 2020 2020 2020  s ex:.          
-00007eb0: 2020 7365 6c66 2e70 726f 762e 6c6f 6728    self.prov.log(
-00007ec0: 224c 6f61 6465 6420 6946 444f 2066 696c  "Loaded iFDO fil
-00007ed0: 6520 6e6f 7420 7661 6c69 6420 7965 743a  e not valid yet:
-00007ee0: 2022 202b 2073 7472 2865 7829 290a 0a20   " + str(ex)).. 
-00007ef0: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
-00007f00: 7565 0a0a 0a20 2020 2064 6566 2077 7269  ue...    def wri
-00007f10: 7465 5f69 6664 6f5f 6669 6c65 2873 656c  te_ifdo_file(sel
-00007f20: 662c 616c 6c6f 775f 6d69 7373 696e 675f  f,allow_missing_
-00007f30: 7265 7175 6972 6564 3d46 616c 7365 293a  required=False):
-00007f40: 0a20 2020 2020 2020 2022 2222 2057 7269  .        """ Wri
-00007f50: 7465 7320 616e 2069 4644 4f20 6669 6c65  tes an iFDO file
-00007f60: 2074 6f20 6469 736b 2e20 4f76 6572 7772   to disk. Overwr
-00007f70: 6974 6573 2070 6f74 656e 7469 616c 6c79  ites potentially
-00007f80: 2065 7869 7374 696e 6720 6669 6c65 2e22   existing file."
-00007f90: 2222 0a0a 2020 2020 2020 2020 7320 3d20  ""..        s = 
-00007fa0: 6d69 7174 632e 5072 696e 744c 6f61 6469  miqtc.PrintLoadi
-00007fb0: 6e67 4d73 6728 2257 7269 7469 6e67 2069  ngMsg("Writing i
-00007fc0: 4644 4f20 6669 6c65 2229 0a0a 2020 2020  FDO file")..    
-00007fd0: 2020 2020 2320 6368 6563 6b20 6669 656c      # check fiel
-00007fe0: 6473 2061 6761 696e 2069 6620 6368 616e  ds again if chan
-00007ff0: 6765 6420 7369 6e63 6520 6c61 7374 2063  ged since last c
-00008000: 6865 636b 2028 6372 6561 7465 6946 444f  heck (createiFDO
-00008010: 290a 2020 2020 2020 2020 6966 2073 656c  ).        if sel
-00008020: 662e 6966 646f 5f74 6d70 2021 3d20 7365  f.ifdo_tmp != se
-00008030: 6c66 2e69 6664 6f5f 6368 6563 6b65 643a  lf.ifdo_checked:
-00008040: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00008050: 662e 6372 6561 7465 6946 444f 2873 656c  f.createiFDO(sel
-00008060: 662e 6966 646f 5f74 6d70 5b73 656c 662e  f.ifdo_tmp[self.
-00008070: 696d 6167 6553 6574 4865 6164 6572 4b65  imageSetHeaderKe
-00008080: 795d 2c20 6d69 7174 692e 6372 6561 7465  y], miqti.create
-00008090: 496d 6167 6549 7465 6d73 4c69 7374 4672  ImageItemsListFr
-000080a0: 6f6d 496d 6167 6549 7465 6d73 4469 6374  omImageItemsDict
-000080b0: 2873 656c 662e 6966 646f 5f74 6d70 5b73  (self.ifdo_tmp[s
-000080c0: 656c 662e 696d 6167 6553 6574 4974 656d  elf.imageSetItem
-000080d0: 734b 6579 5d29 2c0a 2020 2020 2020 2020  sKey]),.        
-000080e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000080f0: 2020 2020 616c 6c6f 775f 6d69 7373 696e      allow_missin
-00008100: 675f 7265 7175 6972 6564 3d61 6c6c 6f77  g_required=allow
-00008110: 5f6d 6973 7369 6e67 5f72 6571 7569 7265  _missing_require
-00008120: 6429 0a20 2020 2020 2020 200a 2020 2020  d).        .    
-00008130: 2020 2020 2320 6164 6420 2224 7363 6865      # add "$sche
-00008140: 6d61 220a 2020 2020 2020 2020 7365 6c66  ma".        self
-00008150: 2e69 6664 6f5f 6368 6563 6b65 645b 2224  .ifdo_checked["$
-00008160: 7363 6865 6d61 225d 203d 206d 6971 7476  schema"] = miqtv
-00008170: 2e69 6664 6f5f 7363 6865 6d61 5b27 2469  .ifdo_schema['$i
-00008180: 6427 5d0a 2020 2020 2020 2020 0a20 2020  d'].        .   
-00008190: 2020 2020 2069 4644 4f5f 7061 7468 203d       iFDO_path =
-000081a0: 2073 656c 662e 6765 7469 4644 4f46 696c   self.getiFDOFil
-000081b0: 654e 616d 6528 6f76 6572 7772 6974 653d  eName(overwrite=
-000081c0: 5472 7565 290a 0a20 2020 2020 2020 2023  True)..        #
-000081d0: 2070 7574 7320 6576 6572 7974 6869 6e67   puts everything
-000081e0: 2069 6e20 6f6e 6520 6c69 6e65 0a20 2020   in one line.   
-000081f0: 2020 2020 2023 7769 7468 206f 7065 6e28       #with open(
-00008200: 6946 444f 5f70 6174 682e 7265 706c 6163  iFDO_path.replac
-00008210: 6528 2279 616d 6c22 2c22 6a73 6f6e 2229  e("yaml","json")
-00008220: 2c20 2777 2729 2061 7320 6670 3a0a 2020  , 'w') as fp:.  
-00008230: 2020 2020 2020 2320 2020 206a 736f 6e2e        #    json.
-00008240: 6475 6d70 2873 656c 662e 6966 646f 5f63  dump(self.ifdo_c
-00008250: 6865 636b 6564 2c20 6670 290a 0a20 2020  hecked, fp)..   
-00008260: 2020 2020 2023 2063 6f6e 7665 7274 2064       # convert d
-00008270: 6963 7469 6f6e 6172 7920 746f 204a 534f  ictionary to JSO
-00008280: 4e20 7374 7269 6e67 0a20 2020 2020 2020  N string.       
-00008290: 206a 736f 6e5f 6461 7461 203d 206a 736f   json_data = jso
-000082a0: 6e2e 6475 6d70 7328 7365 6c66 2e69 6664  n.dumps(self.ifd
-000082b0: 6f5f 6368 6563 6b65 642c 2069 6e64 656e  o_checked, inden
-000082c0: 7420 3d20 342c 2073 6f72 745f 6b65 7973  t = 4, sort_keys
-000082d0: 3d54 7275 6529 0a0a 2020 2020 2020 2020  =True)..        
-000082e0: 2320 7772 6974 6520 7468 6520 4a53 4f4e  # write the JSON
-000082f0: 2073 7472 696e 6720 746f 2061 2066 696c   string to a fil
-00008300: 650a 2020 2020 2020 2020 7769 7468 206f  e.        with o
-00008310: 7065 6e28 6946 444f 5f70 6174 682c 2027  pen(iFDO_path, '
-00008320: 7727 2920 6173 2066 3a0a 2020 2020 2020  w') as f:.      
-00008330: 2020 2020 2020 662e 7772 6974 6528 6a73        f.write(js
-00008340: 6f6e 5f64 6174 6129 0a20 2020 2020 2020  on_data).       
-00008350: 200a 2020 2020 2020 2020 2320 6c6f 6720   .        # log 
-00008360: 6368 616e 6765 730a 2020 2020 2020 2020  changes.        
-00008370: 6966 206e 6f74 2073 656c 662e 6966 646f  if not self.ifdo
-00008380: 5f70 6172 7365 6420 6973 204e 6f6e 653a  _parsed is None:
-00008390: 0a20 2020 2020 2020 2020 2020 2069 6664  .            ifd
-000083a0: 6f5f 7570 6461 7465 203d 2044 6565 7044  o_update = DeepD
-000083b0: 6966 6628 7365 6c66 2e69 6664 6f5f 7061  iff(self.ifdo_pa
-000083c0: 7273 6564 2c73 656c 662e 6966 646f 5f63  rsed,self.ifdo_c
-000083d0: 6865 636b 6564 290a 2020 2020 2020 2020  hecked).        
-000083e0: 2020 2020 2370 7072 696e 7428 6966 646f      #pprint(ifdo
-000083f0: 5f75 7064 6174 6529 0a20 2020 2020 2020  _update).       
-00008400: 2020 2020 2069 6620 6966 646f 5f75 7064       if ifdo_upd
-00008410: 6174 6520 213d 207b 7d3a 0a20 2020 2020  ate != {}:.     
-00008420: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00008430: 7072 6f76 2e6c 6f67 2822 6946 444f 2075  prov.log("iFDO u
-00008440: 7064 6174 6564 2229 0a20 2020 2020 2020  pdated").       
-00008450: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
-00008460: 6f76 2e6c 6f67 2873 7472 2869 6664 6f5f  ov.log(str(ifdo_
-00008470: 7570 6461 7465 292c 646f 6e74 5368 6f77  update),dontShow
-00008480: 3d54 7275 6529 0a20 2020 2020 2020 2073  =True).        s
-00008490: 656c 662e 7072 6f76 2e6c 6f67 2822 5772  elf.prov.log("Wr
-000084a0: 6f74 6520 6946 444f 2074 6f20 6669 6c65  ote iFDO to file
-000084b0: 2022 202b 2069 4644 4f5f 7061 7468 290a   " + iFDO_path).
-000084c0: 2020 2020 2020 2020 7365 6c66 2e70 726f          self.pro
-000084d0: 762e 7772 6974 6528 7365 6c66 2e64 6972  v.write(self.dir
-000084e0: 2e74 6f28 7365 6c66 2e64 6972 2e64 742e  .to(self.dir.dt.
-000084f0: 7072 6f74 6f63 6f6c 2929 0a20 2020 2020  protocol)).     
-00008500: 2020 2073 2e73 746f 7028 290a 0a20 2020     s.stop()..   
-00008510: 2064 6566 2077 7269 7465 6946 444f 6669   def writeiFDOfi
-00008520: 6c65 2873 656c 662c 616c 6c6f 775f 6d69  le(self,allow_mi
-00008530: 7373 696e 675f 7265 7175 6972 6564 3d46  ssing_required=F
-00008540: 616c 7365 293a 0a20 2020 2020 2020 2022  alse):.        "
-00008550: 2222 2044 6570 7265 6361 7465 6420 2d20  "" Deprecated - 
-00008560: 7573 6520 7772 6974 655f 6966 646f 5f66  use write_ifdo_f
-00008570: 696c 6520 2222 220a 2020 2020 2020 2020  ile """.        
-00008580: 7365 6c66 2e77 7269 7465 5f69 6664 6f5f  self.write_ifdo_
-00008590: 6669 6c65 2861 6c6c 6f77 5f6d 6973 7369  file(allow_missi
-000085a0: 6e67 5f72 6571 7569 7265 6429 0a0a 0a20  ng_required)... 
-000085b0: 2020 2064 6566 2073 6574 6946 444f 4669     def setiFDOFi
-000085c0: 6c65 4e61 6d65 2873 656c 662c 6946 444f  leName(self,iFDO
-000085d0: 6669 6c65 3a73 7472 293a 0a20 2020 2020  file:str):.     
-000085e0: 2020 2022 2222 2053 6574 2074 6865 2063     """ Set the c
-000085f0: 7572 7265 6e74 2069 4644 4f20 6669 6c65  urrent iFDO file
-00008600: 206e 616d 6520 7769 7468 2070 6174 682e   name with path.
-00008610: 2053 6574 2074 6f20 2222 2069 6e20 6f72   Set to "" in or
-00008620: 6465 7220 746f 2067 6574 2064 6566 6175  der to get defau
-00008630: 6c74 206e 616d 6520 616e 6420 6c6f 6361  lt name and loca
-00008640: 7469 6f6e 2e20 2222 220a 2020 2020 2020  tion. """.      
-00008650: 2020 7365 6c66 2e69 4644 4f66 696c 655f    self.iFDOfile_
-00008660: 203d 2069 4644 4f66 696c 650a 2020 2020   = iFDOfile.    
-00008670: 2020 2020 7365 6c66 2e69 4644 4f66 696c      self.iFDOfil
-00008680: 655f 203d 2073 656c 662e 6765 7469 4644  e_ = self.getiFD
-00008690: 4f46 696c 654e 616d 6528 2920 2320 636f  OFileName() # co
-000086a0: 6e73 7472 7563 7420 6465 6661 756c 7420  nstruct default 
-000086b0: 6e61 6d65 2069 6620 656d 7074 790a 2020  name if empty.  
-000086c0: 2020 2020 2020 6966 206d 6971 7463 2e61        if miqtc.a
-000086d0: 7373 6572 7453 6c61 7368 286f 732e 7061  ssertSlash(os.pa
-000086e0: 7468 2e64 6972 6e61 6d65 2873 656c 662e  th.dirname(self.
-000086f0: 6946 444f 6669 6c65 5f29 2920 213d 206d  iFDOfile_)) != m
-00008700: 6971 7463 2e61 7373 6572 7453 6c61 7368  iqtc.assertSlash
-00008710: 2873 656c 662e 6469 722e 746f 2873 656c  (self.dir.to(sel
-00008720: 662e 6469 722e 6474 2e70 726f 6475 6374  f.dir.dt.product
-00008730: 7329 293a 0a20 2020 2020 2020 2020 2020  s)):.           
-00008740: 2073 656c 662e 7072 6f76 2e6c 6f67 2822   self.prov.log("
-00008750: 4361 7574 696f 6e21 2069 4644 4f20 6669  Caution! iFDO fi
-00008760: 6c65 2070 6174 6820 6973 206e 6f74 2069  le path is not i
-00008770: 6e20 2770 726f 6475 6374 7327 2073 7562  n 'products' sub
-00008780: 2066 6f6c 6465 7220 6173 2072 6563 6f6d   folder as recom
-00008790: 6d65 6e64 6564 2e20 436f 6e73 6964 6572  mended. Consider
-000087a0: 2072 6573 6574 7469 6e67 2077 6974 6820   resetting with 
-000087b0: 7365 7469 4644 4f46 696c 654e 616d 6528  setiFDOFileName(
-000087c0: 292e 2022 202b 2069 4644 4f66 696c 6529  ). " + iFDOfile)
-000087d0: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-000087e0: 2020 2020 2020 2020 2020 6576 656e 7420            event 
-000087f0: 3d20 7365 6c66 2e66 696e 6454 6d70 4669  = self.findTmpFi
-00008800: 656c 6428 2769 6d61 6765 2d65 7665 6e74  eld('image-event
-00008810: 2729 5b27 6e61 6d65 275d 0a20 2020 2020  ')['name'].     
-00008820: 2020 2020 2020 2073 656e 736f 7220 3d20         sensor = 
-00008830: 7365 6c66 2e66 696e 6454 6d70 4669 656c  self.findTmpFiel
-00008840: 6428 2769 6d61 6765 2d73 656e 736f 7227  d('image-sensor'
-00008850: 295b 276e 616d 6527 5d0a 2020 2020 2020  )['name'].      
-00008860: 2020 6578 6365 7074 206d 6971 7463 2e49    except miqtc.I
-00008870: 6664 6f45 7863 6570 7469 6f6e 3a0a 2020  fdoException:.  
-00008880: 2020 2020 2020 2020 2020 6576 656e 7420            event 
-00008890: 3d20 7365 6c66 2e64 6972 2e65 7665 6e74  = self.dir.event
-000088a0: 2829 0a20 2020 2020 2020 2020 2020 2073  ().            s
-000088b0: 656e 736f 7220 3d20 7365 6c66 2e64 6972  ensor = self.dir
-000088c0: 2e73 656e 736f 7228 290a 0a20 2020 2020  .sensor()..     
-000088d0: 2020 2069 4644 4f66 696c 654e 616d 6520     iFDOfileName 
-000088e0: 3d20 6f73 2e70 6174 682e 6261 7365 6e61  = os.path.basena
-000088f0: 6d65 2873 656c 662e 6946 444f 6669 6c65  me(self.iFDOfile
-00008900: 5f29 0a20 2020 2020 2020 2069 6620 6e6f  _).        if no
-00008910: 7420 6576 656e 7420 696e 2069 4644 4f66  t event in iFDOf
-00008920: 696c 654e 616d 6520 6f72 206e 6f74 2069  ileName or not i
-00008930: 4644 4f2e 6765 7453 686f 7274 4571 7569  FDO.getShortEqui
-00008940: 706d 656e 7449 4428 7365 6e73 6f72 2920  pmentID(sensor) 
-00008950: 696e 2069 4644 4f66 696c 654e 616d 653a  in iFDOfileName:
-00008960: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00008970: 662e 7072 6f76 2e6c 6f67 2822 4361 7574  f.prov.log("Caut
-00008980: 696f 6e21 2069 4644 4f20 6669 6c65 206e  ion! iFDO file n
-00008990: 616d 6520 646f 6573 206e 6f74 2063 6f6e  ame does not con
-000089a0: 7461 696e 2070 726f 6a65 6374 2c20 6576  tain project, ev
-000089b0: 656e 7420 616e 6420 7365 6e73 6f72 206e  ent and sensor n
-000089c0: 616d 6520 6173 2072 6563 6f6d 6d65 6e64  ame as recommend
-000089d0: 6564 2e20 436f 6e73 6964 6572 2072 6573  ed. Consider res
-000089e0: 6574 7469 6e67 2077 6974 6820 7365 7469  etting with seti
-000089f0: 4644 4f46 696c 654e 616d 6528 292e 2022  FDOFileName(). "
-00008a00: 202b 2069 4644 4f66 696c 6529 0a0a 0a20   + iFDOfile)... 
-00008a10: 2020 2064 6566 2067 6574 6946 444f 4669     def getiFDOFi
-00008a20: 6c65 4e61 6d65 2873 656c 662c 6f76 6572  leName(self,over
-00008a30: 7772 6974 653d 4661 6c73 6529 3a0a 2020  write=False):.  
-00008a40: 2020 2020 2020 2222 2220 5265 7475 726e        """ Return
-00008a50: 7320 7468 6520 6375 7272 656e 7420 6946  s the current iF
-00008a60: 444f 2066 696c 6527 7320 6e61 6d65 2077  DO file's name w
-00008a70: 6974 6820 7061 7468 2e20 4966 206e 6f74  ith path. If not
-00008a80: 2073 6574 2079 6574 206f 7220 6f76 6572   set yet or over
-00008a90: 7772 6974 653d 3d54 7275 6520 6974 2072  write==True it r
-00008aa0: 6574 7572 6e73 2074 6865 206f 6e65 206d  eturns the one m
-00008ab0: 6174 6368 696e 6720 696d 6167 652d 7365  atching image-se
-00008ac0: 742d 6e61 6d65 2e20 2222 220a 2020 2020  t-name. """.    
-00008ad0: 2020 2020 6966 2073 656c 662e 6946 444f      if self.iFDO
-00008ae0: 6669 6c65 5f20 3d3d 2022 2220 6f72 206f  file_ == "" or o
-00008af0: 7665 7277 7269 7465 3a0a 2020 2020 2020  verwrite:.      
-00008b00: 2020 2020 2020 6669 6c65 5f6e 616d 6520        file_name 
-00008b10: 3d20 7365 6c66 2e66 696e 6454 6d70 4669  = self.findTmpFi
-00008b20: 656c 6428 2769 6d61 6765 2d73 6574 2d6e  eld('image-set-n
-00008b30: 616d 6527 2920 2b20 275f 6946 444f 2e6a  ame') + '_iFDO.j
-00008b40: 736f 6e27 0a20 2020 2020 2020 2020 2020  son'.           
-00008b50: 2069 6620 7365 6c66 2e69 4644 4f66 696c   if self.iFDOfil
-00008b60: 655f 2021 3d20 2222 3a0a 2020 2020 2020  e_ != "":.      
-00008b70: 2020 2020 2020 2020 2020 2320 7265 6e61            # rena
-00008b80: 6d65 2066 696c 6520 6275 7420 6b65 6570  me file but keep
-00008b90: 206c 6f63 6174 696f 6e0a 2020 2020 2020   location.      
-00008ba0: 2020 2020 2020 2020 2020 6966 2066 696c            if fil
-00008bb0: 655f 6e61 6d65 2021 3d20 6f73 2e70 6174  e_name != os.pat
-00008bc0: 682e 6261 7365 6e61 6d65 2873 656c 662e  h.basename(self.
-00008bd0: 6946 444f 6669 6c65 5f29 2061 6e64 206f  iFDOfile_) and o
-00008be0: 732e 7061 7468 2e65 7869 7374 7328 7365  s.path.exists(se
-00008bf0: 6c66 2e69 4644 4f66 696c 655f 293a 0a20  lf.iFDOfile_):. 
-00008c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008c10: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
-00008c20: 2822 4361 7574 696f 6e21 2069 6664 6f20  ("Caution! ifdo 
-00008c30: 6669 6c65 2072 656e 616d 6564 2074 6f20  file renamed to 
-00008c40: 2220 2b20 6669 6c65 5f6e 616d 6529 0a20  " + file_name). 
-00008c50: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00008c60: 656c 662e 6946 444f 6669 6c65 5f20 3d20  elf.iFDOfile_ = 
-00008c70: 6f73 2e70 6174 682e 6a6f 696e 286f 732e  os.path.join(os.
-00008c80: 7061 7468 2e64 6972 6e61 6d65 2873 656c  path.dirname(sel
-00008c90: 662e 6946 444f 6669 6c65 5f29 2c66 696c  f.iFDOfile_),fil
-00008ca0: 655f 6e61 6d65 290a 2020 2020 2020 2020  e_name).        
-00008cb0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00008cc0: 2020 2020 2020 2020 2020 7365 6c66 2e69            self.i
-00008cd0: 4644 4f66 696c 655f 203d 206f 732e 7061  FDOfile_ = os.pa
-00008ce0: 7468 2e6a 6f69 6e28 7365 6c66 2e64 6972  th.join(self.dir
-00008cf0: 2e74 6f28 7365 6c66 2e64 6972 2e64 742e  .to(self.dir.dt.
-00008d00: 7072 6f64 7563 7473 292c 2066 696c 655f  products), file_
-00008d10: 6e61 6d65 290a 2020 2020 2020 2020 7265  name).        re
-00008d20: 7475 726e 2073 656c 662e 6946 444f 6669  turn self.iFDOfi
-00008d30: 6c65 5f0a 0a0a 2020 2020 6465 6620 7365  le_...    def se
-00008d40: 745f 696d 6167 655f 7365 745f 6e61 6d65  t_image_set_name
-00008d50: 5f66 6965 6c64 5f66 726f 6d5f 7072 6f6a  _field_from_proj
-00008d60: 6563 745f 6576 656e 745f 7365 6e73 6f72  ect_event_sensor
-00008d70: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00008d80: 2222 2220 5365 7473 2066 6965 6c64 2069  """ Sets field i
-00008d90: 6d61 6765 2d73 6574 2d6e 616d 6520 6672  mage-set-name fr
-00008da0: 6f6d 2063 7572 7265 6e74 2074 6d70 2066  om current tmp f
-00008db0: 6965 6c64 7320 666f 7220 7072 6f6a 6563  ields for projec
-00008dc0: 742c 2065 7665 6e74 2061 6e64 2073 656e  t, event and sen
-00008dd0: 736f 722e 200a 2020 2020 2020 2020 5265  sor. .        Re
-00008de0: 7475 726e 7320 696d 6167 652d 7365 742d  turns image-set-
-00008df0: 6e61 6d65 2076 616c 7565 2e20 2222 220a  name value. """.
-00008e00: 2020 2020 2020 2020 6e65 775f 696d 6167          new_imag
-00008e10: 655f 7365 745f 6e61 6d65 203d 2073 656c  e_set_name = sel
-00008e20: 662e 636f 6e73 7472 7563 7449 6d61 6765  f.constructImage
-00008e30: 5365 744e 616d 6528 7365 6c66 2e69 6664  SetName(self.ifd
-00008e40: 6f5f 746d 705b 7365 6c66 2e69 6d61 6765  o_tmp[self.image
-00008e50: 5365 7448 6561 6465 724b 6579 5d5b 2769  SetHeaderKey]['i
-00008e60: 6d61 6765 2d70 726f 6a65 6374 275d 5b27  mage-project']['
-00008e70: 6e61 6d65 275d 2c0a 2020 2020 2020 2020  name'],.        
-00008e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000120: 7274 2056 6572 7369 6f6e 0a69 6d70 6f72  rt Version.impor
+00000130: 7420 7374 6174 6973 7469 6373 0a0a 696d  t statistics..im
+00000140: 706f 7274 206d 6172 6971 742e 636f 7265  port mariqt.core
+00000150: 2061 7320 6d69 7174 630a 696d 706f 7274   as miqtc.import
+00000160: 206d 6172 6971 742e 6469 7265 6374 6f72   mariqt.director
+00000170: 6965 7320 6173 206d 6971 7464 0a69 6d70  ies as miqtd.imp
+00000180: 6f72 7420 6d61 7269 7174 2e66 696c 6573  ort mariqt.files
+00000190: 2061 7320 6d69 7174 660a 696d 706f 7274   as miqtf.import
+000001a0: 206d 6172 6971 742e 7661 7269 6162 6c65   mariqt.variable
+000001b0: 7320 6173 206d 6971 7476 0a69 6d70 6f72  s as miqtv.impor
+000001c0: 7420 6d61 7269 7174 2e69 6d61 6765 2061  t mariqt.image a
+000001d0: 7320 6d69 7174 690a 696d 706f 7274 206d  s miqti.import m
+000001e0: 6172 6971 742e 7465 7374 7320 6173 206d  ariqt.tests as m
+000001f0: 6971 7474 0a69 6d70 6f72 7420 6d61 7269  iqtt.import mari
+00000200: 7174 2e6e 6176 6967 6174 696f 6e20 6173  qt.navigation as
+00000210: 206d 6971 746e 0a69 6d70 6f72 7420 6d61   miqtn.import ma
+00000220: 7269 7174 2e73 6574 7469 6e67 7320 6173  riqt.settings as
+00000230: 206d 6971 7473 0a69 6d70 6f72 7420 6d61   miqts.import ma
+00000240: 7269 7174 2e70 726f 7665 6e61 6e63 6520  riqt.provenance 
+00000250: 6173 206d 6971 7470 0a69 6d70 6f72 7420  as miqtp.import 
+00000260: 6d61 7269 7174 2e67 656f 2061 7320 6d69  mariqt.geo as mi
+00000270: 7174 670a 0a0a 636c 6173 7320 6e6f 6e43  qtg...class nonC
+00000280: 6f72 6546 6965 6c64 496e 7465 726d 6564  oreFieldIntermed
+00000290: 6961 7465 4974 656d 496e 666f 4669 6c65  iateItemInfoFile
+000002a0: 3a0a 2020 2020 6465 6620 5f5f 696e 6974  :.    def __init
+000002b0: 5f5f 2873 656c 662c 2066 696c 654e 616d  __(self, fileNam
+000002c0: 653a 7374 722c 2073 6570 6172 6174 6f72  e:str, separator
+000002d0: 3a73 7472 2c20 6865 6164 6572 3a64 6963  :str, header:dic
+000002e0: 742c 2064 6174 6574 696d 655f 666f 726d  t, datetime_form
+000002f0: 6174 3a73 7472 3d6d 6971 7476 2e64 6174  at:str=miqtv.dat
+00000300: 655f 666f 726d 6174 735b 276d 6172 6971  e_formats['mariq
+00000310: 7427 5d29 3a0a 2020 2020 2020 2020 7365  t']):.        se
+00000320: 6c66 2e66 696c 654e 616d 6520 3d20 6669  lf.fileName = fi
+00000330: 6c65 4e61 6d65 0a20 2020 2020 2020 2073  leName.        s
+00000340: 656c 662e 7365 7061 7261 746f 7220 3d20  elf.separator = 
+00000350: 7365 7061 7261 746f 720a 2020 2020 2020  separator.      
+00000360: 2020 7365 6c66 2e68 6561 6465 7220 3d20    self.header = 
+00000370: 6865 6164 6572 0a20 2020 2020 2020 2073  header.        s
+00000380: 656c 662e 6461 7465 7469 6d65 5f66 6f72  elf.datetime_for
+00000390: 6d61 7420 3d20 6461 7465 7469 6d65 5f66  mat = datetime_f
+000003a0: 6f72 6d61 740a 0a20 2020 2064 6566 205f  ormat..    def _
+000003b0: 5f65 715f 5f28 7365 6c66 2c20 6f74 6865  _eq__(self, othe
+000003c0: 7229 3a0a 2020 2020 2020 2020 6966 2073  r):.        if s
+000003d0: 656c 662e 6669 6c65 4e61 6d65 3d3d 6f74  elf.fileName==ot
+000003e0: 6865 722e 6669 6c65 4e61 6d65 2061 6e64  her.fileName and
+000003f0: 2073 656c 662e 7365 7061 7261 746f 7220   self.separator 
+00000400: 3d3d 206f 7468 6572 2e73 6570 6172 6174  == other.separat
+00000410: 6f72 2061 6e64 2073 656c 662e 6865 6164  or and self.head
+00000420: 6572 3d3d 6f74 6865 722e 6865 6164 6572  er==other.header
+00000430: 2061 6e64 2073 656c 662e 6461 7465 7469   and self.dateti
+00000440: 6d65 5f66 6f72 6d61 743d 3d6f 7468 6572  me_format==other
+00000450: 2e64 6174 6574 696d 655f 666f 726d 6174  .datetime_format
+00000460: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00000470: 7475 726e 2054 7275 650a 2020 2020 2020  turn True.      
+00000480: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00000490: 2020 2020 7265 7475 726e 2046 616c 7365      return False
+000004a0: 0a0a 6465 6620 6669 6e64 4669 656c 6428  ..def findField(
+000004b0: 6966 646f 5f64 6963 742c 6b65 7973 293a  ifdo_dict,keys):
+000004c0: 0a20 2020 2020 2020 2022 2222 204c 6f6f  .        """ Loo
+000004d0: 6b73 2066 6f72 2020 6b65 7973 2028 226b  ks for  keys ("k
+000004e0: 6579 2220 6f72 205b 6b65 7931 2c6b 6579  ey" or [key1,key
+000004f0: 325d 2920 696e 2069 6664 6f5f 6469 6374  2]) in ifdo_dict
+00000500: 2061 6e64 2072 6574 7572 6e73 2069 7473   and returns its
+00000510: 2076 616c 7565 206f 7220 616e 2065 6d70   value or an emp
+00000520: 7479 2073 7472 696e 6720 6966 206b 6579  ty string if key
+00000530: 206e 6f74 2066 6f75 6e64 2222 220a 2020   not found""".  
+00000540: 2020 2020 2020 6966 206e 6f74 2069 7369        if not isi
+00000550: 6e73 7461 6e63 6528 6b65 7973 2c20 6c69  nstance(keys, li
+00000560: 7374 293a 0a20 2020 2020 2020 2020 2020  st):.           
+00000570: 206b 6579 7320 3d20 5b6b 6579 735d 0a0a   keys = [keys]..
+00000580: 2020 2020 2020 2020 6172 203d 2069 6664          ar = ifd
+00000590: 6f5f 6469 6374 0a20 2020 2020 2020 2066  o_dict.        f
+000005a0: 6f72 206b 2069 6e20 6b65 7973 3a0a 2020  or k in keys:.  
+000005b0: 2020 2020 2020 2020 2020 6966 206b 2069            if k i
+000005c0: 6e20 6172 3a0a 2020 2020 2020 2020 2020  n ar:.          
+000005d0: 2020 2020 2020 6172 203d 2061 725b 6b5d        ar = ar[k]
+000005e0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+000005f0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00000600: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+00000610: 2020 2020 2020 2020 2020 2020 6b20 3d20              k = 
+00000620: 696e 7428 6b29 0a20 2020 2020 2020 2020  int(k).         
+00000630: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+00000640: 7420 6973 696e 7374 616e 6365 2861 722c  t isinstance(ar,
+00000650: 6c69 7374 2920 6f72 206c 656e 2861 7229  list) or len(ar)
+00000660: 203c 206b 3a0a 2020 2020 2020 2020 2020   < k:.          
+00000670: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+00000680: 6973 6520 5661 6c75 6545 7272 6f72 2822  ise ValueError("
+00000690: 496e 6465 7822 2c6b 2c22 6f75 7420 6f66  Index",k,"out of
+000006a0: 2062 6f75 6e64 7322 2c6c 656e 2861 7229   bounds",len(ar)
+000006b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000006c0: 2020 6578 6365 7074 3a0a 2020 2020 2020    except:.      
+000006d0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+000006e0: 7475 726e 2022 220a 2020 2020 2020 2020  turn "".        
+000006f0: 2020 2020 2020 2020 6172 203d 2061 725b          ar = ar[
+00000700: 6b5d 0a20 2020 2020 2020 2072 6574 7572  k].        retur
+00000710: 6e20 6172 0a0a 0a63 6c61 7373 2069 4644  n ar...class iFD
+00000720: 4f5f 5265 6164 6572 3a0a 2020 2020 2220  O_Reader:.    " 
+00000730: 5072 6f76 6964 6573 2063 6f6e 7665 6e69  Provides conveni
+00000740: 656e 7420 6675 6e63 7469 6f6e 7320 666f  ent functions fo
+00000750: 7220 7265 6164 696e 6720 6461 7461 2066  r reading data f
+00000760: 726f 6d20 6946 444f 2066 696c 6573 2022  rom iFDO files "
+00000770: 0a0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
+00000780: 5f5f 2873 656c 662c 2069 4644 4f66 696c  __(self, iFDOfil
+00000790: 653a 7374 7229 3a0a 2020 2020 2020 2020  e:str):.        
+000007a0: 2220 5072 6f76 6964 6573 2063 6f6e 7665  " Provides conve
+000007b0: 6e69 656e 7420 6675 6e63 7469 6f6e 7320  nient functions 
+000007c0: 666f 7220 7265 6164 696e 6720 6461 7461  for reading data
+000007d0: 2066 726f 6d20 6946 444f 2066 696c 6573   from iFDO files
+000007e0: 2022 0a20 2020 2020 2020 200a 2020 2020   ".        .    
+000007f0: 2020 2020 7365 6c66 2e69 4644 4f66 696c      self.iFDOfil
+00000800: 6520 3d20 6946 444f 6669 6c65 0a20 2020  e = iFDOfile.   
+00000810: 2020 2020 206f 203d 206f 7065 6e28 7365       o = open(se
+00000820: 6c66 2e69 4644 4f66 696c 652c 2027 7227  lf.iFDOfile, 'r'
+00000830: 290a 2020 2020 2020 2020 7365 6c66 2e69  ).        self.i
+00000840: 6664 6f20 3d20 7961 6d6c 2e6c 6f61 6428  fdo = yaml.load(
+00000850: 6f2c 2020 4c6f 6164 6572 3d79 616d 6c2e  o,  Loader=yaml.
+00000860: 434c 6f61 6465 7229 0a20 2020 2020 2020  CLoader).       
+00000870: 206f 2e63 6c6f 7365 2829 0a0a 0a20 2020   o.close()...   
+00000880: 2064 6566 205f 5f67 6574 6974 656d 5f5f   def __getitem__
+00000890: 2873 656c 662c 206b 6579 7329 3a0a 2020  (self, keys):.  
+000008a0: 2020 2020 2020 2222 2220 5265 7475 726e        """ Return
+000008b0: 7320 636f 7079 206f 6620 6368 6563 6b65  s copy of checke
+000008c0: 6420 6966 646f 2073 6574 206f 7220 6974  d ifdo set or it
+000008d0: 656d 2066 6965 6c64 2076 616c 7565 2c20  em field value, 
+000008e0: 616c 736f 2063 6f6e 7369 6465 726e 6720  also considerng 
+000008f0: 6465 6661 756c 7420 7661 6c75 6573 2066  default values f
+00000900: 726f 6d20 6865 6164 6572 2e0a 2020 2020  rom header..    
+00000910: 2020 2020 2020 2020 5573 6520 6b65 7973          Use keys
+00000920: 2061 7320 652e 672e 2027 3c69 7465 6d3e   as e.g. '<item>
+00000930: 3a3c 6b65 793e 3a2e 2e2e 272e 2043 616e  :<key>:...'. Can
+00000940: 2062 6520 7573 6564 2066 6f72 2068 6561   be used for hea
+00000950: 6465 7220 6669 656c 6473 2061 7320 7765  der fields as we
+00000960: 6c6c 2061 7320 6974 656d 2066 6965 6c64  ll as item field
+00000970: 732e 0a20 2020 2020 2020 2020 2020 2049  s..            I
+00000980: 7465 6d20 696e 6465 7820 6361 6e20 6265  tem index can be
+00000990: 206c 6567 6c65 6374 6564 2c20 696e 2063   leglected, in c
+000009a0: 6173 6520 6f66 2076 6964 656f 2061 2064  ase of video a d
+000009b0: 6963 7420 7b3c 696d 6167 652d 6461 7461  ict {<image-data
+000009c0: 7469 6d65 3e3a 3c76 616c 7565 3e2c 2e2e  time>:<value>,..
+000009d0: 2e7d 2069 7320 7265 7475 726e 6564 2e0a  .} is returned..
+000009e0: 2020 2020 2020 2020 2020 2020 5261 6973              Rais
+000009f0: 6573 2049 6664 6f45 7863 6570 7469 6f6e  es IfdoException
+00000a00: 2069 6620 6974 656d 2064 6f65 7320 6e6f   if item does no
+00000a10: 7420 6578 6973 742e 2022 2222 0a20 2020  t exist. """.   
+00000a20: 2020 2020 206b 6579 7320 3d20 6b65 7973       keys = keys
+00000a30: 2e73 706c 6974 2827 3a27 290a 2020 2020  .split(':').    
+00000a40: 2020 2020 7265 7475 726e 2069 4644 4f2e      return iFDO.
+00000a50: 5f69 4644 4f5f 5f67 6574 4669 656c 6456  _iFDO__getFieldV
+00000a60: 616c 7565 2873 656c 662e 6966 646f 2c6b  alue(self.ifdo,k
+00000a70: 6579 7329 0a0a 0a20 2020 2064 6566 2067  eys)...    def g
+00000a80: 6574 496d 6167 6573 506f 7369 7469 6f6e  etImagesPosition
+00000a90: 7328 7365 6c66 2c69 6d61 6765 5f74 7970  s(self,image_typ
+00000aa0: 6573 3d6d 6971 7476 2e69 6d61 6765 5f74  es=miqtv.image_t
+00000ab0: 7970 6573 293a 0a20 2020 2020 2020 2022  ypes):.        "
+00000ac0: 2222 2052 6574 7572 6e73 2069 6d61 6765  "" Returns image
+00000ad0: 7320 6669 7273 7420 706f 7369 7469 6f6e  s first position
+00000ae0: 2873 2920 0a20 2020 2020 2020 2020 2020  (s) .           
+00000af0: 2040 7265 7475 726e 3a20 7b27 696d 6167   @return: {'imag
+00000b00: 654e 616d 6527 3a20 5b7b 276c 6174 273a  eName': [{'lat':
+00000b10: 2076 616c 7565 2c20 276c 6f6e 273a 2076   value, 'lon': v
+00000b20: 616c 7565 2c20 2764 6174 6574 696d 6527  alue, 'datetime'
+00000b30: 3a20 7661 6c75 657d 5d7d 2c20 696d 6167  : value}]}, imag
+00000b40: 652d 636f 6f72 6469 6e61 7465 2d72 6566  e-coordinate-ref
+00000b50: 6572 656e 6365 2d73 7973 7465 6d20 2222  erence-system ""
+00000b60: 220a 2020 2020 2020 2020 0a20 2020 2020  ".        .     
+00000b70: 2020 2072 6574 4469 6374 203d 207b 7d0a     retDict = {}.
+00000b80: 2020 2020 2020 2020 7265 7452 6566 7379          retRefsy
+00000b90: 7320 3d20 7365 6c66 2e69 6664 6f5b 6d69  s = self.ifdo[mi
+00000ba0: 7174 762e 696d 6167 655f 7365 745f 6865  qtv.image_set_he
+00000bb0: 6164 6572 5f6b 6579 5d5b 2769 6d61 6765  ader_key]['image
+00000bc0: 2d63 6f6f 7264 696e 6174 652d 7265 6665  -coordinate-refe
+00000bd0: 7265 6e63 652d 7379 7374 656d 275d 0a0a  rence-system']..
+00000be0: 2020 2020 2020 2020 6865 6164 6572 5661          headerVa
+00000bf0: 6c4c 6174 203d 204e 6f6e 650a 2020 2020  lLat = None.    
+00000c00: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+00000c10: 2020 2020 2068 6561 6465 7256 616c 4c61       headerValLa
+00000c20: 7420 3d20 7365 6c66 2e69 6664 6f5b 6d69  t = self.ifdo[mi
+00000c30: 7174 762e 696d 6167 655f 7365 745f 6865  qtv.image_set_he
+00000c40: 6164 6572 5f6b 6579 5d5b 2769 6d61 6765  ader_key]['image
+00000c50: 2d6c 6174 6974 7564 6527 5d0a 2020 2020  -latitude'].    
+00000c60: 2020 2020 6578 6365 7074 204b 6579 4572      except KeyEr
+00000c70: 726f 723a 0a20 2020 2020 2020 2020 2020  ror:.           
+00000c80: 2070 6173 730a 0a20 2020 2020 2020 2068   pass..        h
+00000c90: 6561 6465 7256 616c 4c6f 6e20 3d20 4e6f  eaderValLon = No
+00000ca0: 6e65 0a20 2020 2020 2020 2074 7279 3a0a  ne.        try:.
+00000cb0: 2020 2020 2020 2020 2020 2020 6865 6164              head
+00000cc0: 6572 5661 6c4c 6f6e 203d 2073 656c 662e  erValLon = self.
+00000cd0: 6966 646f 5b6d 6971 7476 2e69 6d61 6765  ifdo[miqtv.image
+00000ce0: 5f73 6574 5f68 6561 6465 725f 6b65 795d  _set_header_key]
+00000cf0: 5b27 696d 6167 652d 6c6f 6e67 6974 7564  ['image-longitud
+00000d00: 6527 5d0a 2020 2020 2020 2020 6578 6365  e'].        exce
+00000d10: 7074 204b 6579 4572 726f 723a 0a20 2020  pt KeyError:.   
+00000d20: 2020 2020 2020 2020 2070 6173 730a 0a0a           pass...
+00000d30: 2020 2020 2020 2020 666f 7220 6669 6c65          for file
+00000d40: 4e61 6d65 2069 6e20 7365 6c66 2e69 6664  Name in self.ifd
+00000d50: 6f5b 6d69 7174 762e 696d 6167 655f 7365  o[miqtv.image_se
+00000d60: 745f 6974 656d 735f 6b65 795d 3a0a 2020  t_items_key]:.  
+00000d70: 2020 2020 2020 2020 2020 6966 2066 696c            if fil
+00000d80: 654e 616d 652e 7370 6c69 7428 272e 2729  eName.split('.')
+00000d90: 5b2d 315d 2e6c 6f77 6572 2829 2069 6e20  [-1].lower() in 
+00000da0: 696d 6167 655f 7479 7065 733a 0a20 2020  image_types:.   
+00000db0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00000dc0: 4469 6374 5b66 696c 654e 616d 655d 203d  Dict[fileName] =
+00000dd0: 2073 656c 662e 5f5f 6765 7449 7465 6d4c   self.__getItemL
+00000de0: 6174 4c6f 6e28 6669 6c65 4e61 6d65 2c68  atLon(fileName,h
+00000df0: 6561 6465 7256 616c 4c61 742c 6865 6164  eaderValLat,head
+00000e00: 6572 5661 6c4c 6f6e 290a 0a20 2020 2020  erValLon)..     
+00000e10: 2020 2072 6574 7572 6e20 7265 7444 6963     return retDic
+00000e20: 742c 2072 6574 5265 6673 7973 0a0a 0a20  t, retRefsys... 
+00000e30: 2020 2064 6566 2077 7269 7465 576f 726c     def writeWorl
+00000e40: 6446 696c 6573 466f 7250 686f 746f 7328  dFilesForPhotos(
+00000e50: 7365 6c66 2c64 6573 7444 6972 3a73 7472  self,destDir:str
+00000e60: 2c69 6d61 6765 536f 7572 6365 4469 723a  ,imageSourceDir:
+00000e70: 7374 7229 3a0a 2020 2020 2020 2020 2222  str):.        ""
+00000e80: 2220 5772 6974 6573 2077 6f72 6c64 2066  " Writes world f
+00000e90: 696c 6573 2066 6f72 2070 686f 746f 7320  iles for photos 
+00000ea0: 6966 2061 6c6c 2072 6571 7569 7265 6420  if all required 
+00000eb0: 6669 656c 6473 2061 7265 2074 6865 7265  fields are there
+00000ec0: 2075 6e64 6572 2074 6865 2061 7373 756d   under the assum
+00000ed0: 7074 696f 6e20 7468 6174 2074 6865 2063  ption that the c
+00000ee0: 616d 6572 6120 7761 7320 6c6f 6f6b 696e  amera was lookin
+00000ef0: 6720 7374 7261 6967 6874 2064 6f77 6e20  g straight down 
+00000f00: 2870 6974 6368 2061 6e64 2072 6f6c 6c20  (pitch and roll 
+00000f10: 6172 6520 6967 6e6f 7265 6421 292e 200a  are ignored!). .
+00000f20: 2020 2020 2020 2020 2020 2020 5265 7475              Retu
+00000f30: 726e 7320 6120 6c69 7374 206f 6620 6974  rns a list of it
+00000f40: 656d 7320 666f 7220 7768 6963 6820 6372  ems for which cr
+00000f50: 6561 7469 6f6e 2066 6169 6c65 643a 205b  eation failed: [
+00000f60: 5b69 7465 6d2c 6d73 675d 2c2e 2e2e 5d22  [item,msg],...]"
+00000f70: 2222 0a0a 2020 2020 2020 2020 2320 544f  ""..        # TO
+00000f80: 444f 2067 6574 2069 6d61 6765 7320 6f6e  DO get images on
+00000f90: 6c69 6e65 2066 726f 6d20 6272 6f6b 6572  line from broker
+00000fa0: 0a0a 2020 2020 2020 2020 6946 444f 6578  ..        iFDOex
+00000fb0: 6365 7074 696f 6e73 203d 205b 5d0a 0a20  ceptions = [].. 
+00000fc0: 2020 2020 2020 2023 2067 6574 2069 6d61         # get ima
+00000fd0: 6765 7320 706f 7369 7469 6f6e 0a20 2020  ges position.   
+00000fe0: 2020 2020 2070 6f73 6974 696f 6e73 4c61       positionsLa
+00000ff0: 744c 6f6e 2c20 7265 6673 7973 203d 2073  tLon, refsys = s
+00001000: 656c 662e 6765 7449 6d61 6765 7350 6f73  elf.getImagesPos
+00001010: 6974 696f 6e73 2869 6d61 6765 5f74 7970  itions(image_typ
+00001020: 6573 3d6d 6971 7476 2e70 686f 746f 5f74  es=miqtv.photo_t
+00001030: 7970 6573 290a 2020 2020 2020 2020 6372  ypes).        cr
+00001040: 7346 6965 6c64 546d 7020 3d20 2727 2e6a  sFieldTmp = ''.j
+00001050: 6f69 6e28 6520 666f 7220 6520 696e 2072  oin(e for e in r
+00001060: 6566 7379 7320 6966 2065 2e69 7361 6c6e  efsys if e.isaln
+00001070: 756d 2829 292e 6c6f 7765 7228 290a 2020  um()).lower().  
+00001080: 2020 2020 2020 6966 2063 7273 4669 656c        if crsFiel
+00001090: 6454 6d70 203d 3d20 2777 6773 3834 2720  dTmp == 'wgs84' 
+000010a0: 6f72 2063 7273 4669 656c 6454 6d70 203d  or crsFieldTmp =
+000010b0: 3d20 2765 7073 6734 3332 3627 3a0a 2020  = 'epsg4326':.  
+000010c0: 2020 2020 2020 2020 2020 7265 6673 7973            refsys
+000010d0: 203d 2022 5747 5338 3422 0a20 2020 2020   = "WGS84".     
+000010e0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+000010f0: 2020 2020 2069 4644 4f65 7863 6570 7469       iFDOexcepti
+00001100: 6f6e 732e 6170 7065 6e64 285b 2222 2c22  ons.append(["","
+00001110: 436f 6f72 6469 6e61 7465 7320 7265 6665  Coordinates refe
+00001120: 7265 6e63 6520 7379 7374 656d 205c 2222  rence system \""
+00001130: 202b 2072 6566 7379 7320 2b20 225c 2220   + refsys + "\" 
+00001140: 6361 6e20 6e6f 7420 6265 2068 616e 646c  can not be handl
+00001150: 6564 2e20 5573 6520 7072 6566 6572 6162  ed. Use preferab
+00001160: 6c79 2045 5053 473a 3433 3236 206f 7220  ly EPSG:4326 or 
+00001170: 5747 5338 3422 5d29 0a20 2020 2020 2020  WGS84"]).       
+00001180: 2020 2020 2072 6574 7572 6e20 6946 444f       return iFDO
+00001190: 6578 6365 7074 696f 6e73 0a0a 0a20 2020  exceptions...   
+000011a0: 2020 2020 2066 6f72 2070 686f 746f 2069       for photo i
+000011b0: 6e20 706f 7369 7469 6f6e 734c 6174 4c6f  n positionsLatLo
+000011c0: 6e3a 0a20 2020 2020 2020 2020 2020 2074  n:.            t
+000011d0: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+000011e0: 2020 2020 7365 6c66 2e63 6865 636b 4974      self.checkIt
+000011f0: 656d 4861 7368 2870 686f 746f 2c69 6d61  emHash(photo,ima
+00001200: 6765 536f 7572 6365 4469 7229 2023 2054  geSourceDir) # T
+00001210: 4f44 4f20 636f 756c 6420 6265 2069 6e20  ODO could be in 
+00001220: 6469 6666 6572 656e 7420 7375 6266 6f6c  different subfol
+00001230: 6465 7220 6f72 2066 726f 6d20 6f6e 6c69  der or from onli
+00001240: 6e65 2062 726f 6b65 720a 0a20 2020 2020  ne broker..     
+00001250: 2020 2020 2020 2020 2020 2023 2063 6f6e             # con
+00001260: 7665 7274 2074 6f20 7574 6d20 746f 2061  vert to utm to a
+00001270: 766f 6964 2070 7265 6369 7369 6f6e 2069  void precision i
+00001280: 7373 7565 2077 6974 6820 6c61 742f 6c6f  ssue with lat/lo
+00001290: 6e20 7661 6c75 6573 2069 6e20 776f 726c  n values in worl
+000012a0: 6420 6669 6c65 730a 2020 2020 2020 2020  d files.        
+000012b0: 2020 2020 2020 2020 6c61 7420 3d20 706f          lat = po
+000012c0: 7369 7469 6f6e 734c 6174 4c6f 6e5b 7068  sitionsLatLon[ph
+000012d0: 6f74 6f5d 5b30 5d5b 276c 6174 275d 0a20  oto][0]['lat']. 
+000012e0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+000012f0: 6f6e 203d 2070 6f73 6974 696f 6e73 4c61  on = positionsLa
+00001300: 744c 6f6e 5b70 686f 746f 5d5b 305d 5b27  tLon[photo][0]['
+00001310: 6c6f 6e27 5d0a 2020 2020 2020 2020 2020  lon'].          
+00001320: 2020 2020 2020 6561 7374 696e 672c 6e6f        easting,no
+00001330: 7274 6869 6e67 2c7a 6f6e 652c 6973 4e6f  rthing,zone,isNo
+00001340: 7274 6820 3d20 6d69 7174 672e 6c61 744c  rth = miqtg.latL
+00001350: 6f6e 3275 746d 286c 6174 2c6c 6f6e 2c72  on2utm(lat,lon,r
+00001360: 6566 7379 7329 0a20 2020 2020 2020 2020  efsys).         
+00001370: 2020 2020 2020 2065 7869 6620 3d20 7365         exif = se
+00001380: 6c66 2e5f 5f67 6574 4974 656d 4465 6661  lf.__getItemDefa
+00001390: 756c 7456 616c 7565 2870 686f 746f 2c27  ultValue(photo,'
+000013a0: 696d 6167 652d 6163 7175 6973 6974 696f  image-acquisitio
+000013b0: 6e2d 7365 7474 696e 6773 2729 2023 2054  n-settings') # T
+000013c0: 4f44 4f20 7768 6174 2069 6620 6e6f 7420  ODO what if not 
+000013d0: 7468 6572 653f 2072 6561 6420 6672 6f6d  there? read from
+000013e0: 2069 6d61 6765 2064 6972 6563 746c 793f   image directly?
+000013f0: 2053 686f 756c 6420 6265 2063 6865 636b   Should be check
+00001400: 6564 2069 6620 6861 7368 206d 6174 6368  ed if hash match
+00001410: 6573 3f20 496d 6167 6520 636f 756c 6420  es? Image could 
+00001420: 6861 7665 2062 6565 6e20 6372 6f70 7065  have been croppe
+00001430: 6420 6166 7465 7220 6946 444f 2063 7265  d after iFDO cre
+00001440: 6174 696f 6e0a 2020 2020 2020 2020 2020  ation.          
+00001450: 2020 2020 2020 696d 6167 6557 6964 7468        imageWidth
+00001460: 203d 2069 6e74 2873 7472 2865 7869 665b   = int(str(exif[
+00001470: 2749 6d61 6765 2057 6964 7468 275d 292e  'Image Width']).
+00001480: 7374 7269 7028 275c 2727 2929 0a20 2020  strip('\'')).   
+00001490: 2020 2020 2020 2020 2020 2020 2069 6d61               ima
+000014a0: 6765 4865 6967 6874 203d 2069 6e74 2873  geHeight = int(s
+000014b0: 7472 2865 7869 665b 2749 6d61 6765 2048  tr(exif['Image H
+000014c0: 6569 6768 7427 5d29 2e73 7472 6970 2827  eight']).strip('
+000014d0: 5c27 2729 290a 2020 2020 2020 2020 2020  \'')).          
+000014e0: 2020 2020 2020 6865 6164 696e 6720 3d20        heading = 
+000014f0: 7365 6c66 2e5f 5f67 6574 4974 656d 4465  self.__getItemDe
+00001500: 6661 756c 7456 616c 7565 2870 686f 746f  faultValue(photo
+00001510: 2c27 696d 6167 652d 6361 6d65 7261 2d79  ,'image-camera-y
+00001520: 6177 2d64 6567 7265 6573 2729 0a20 2020  aw-degrees').   
+00001530: 2020 2020 2020 2020 2020 2020 2061 6c74               alt
+00001540: 6974 7564 6520 3d20 7365 6c66 2e5f 5f67  itude = self.__g
+00001550: 6574 4974 656d 4465 6661 756c 7456 616c  etItemDefaultVal
+00001560: 7565 2870 686f 746f 2c27 696d 6167 652d  ue(photo,'image-
+00001570: 6d65 7465 7273 2d61 626f 7665 2d67 726f  meters-above-gro
+00001580: 756e 6427 290a 0a20 2020 2020 2020 2020  und')..         
+00001590: 2020 2020 2020 2064 6f6d 6550 6f72 742c         domePort,
+000015a0: 6d73 6720 3d20 7365 6c66 2e5f 5f74 7279  msg = self.__try
+000015b0: 4765 7449 7344 6f6d 6550 6f72 7428 7068  GetIsDomePort(ph
+000015c0: 6f74 6f29 0a20 2020 2020 2020 2020 2020  oto).           
+000015d0: 2020 2020 2066 6f63 616c 4c65 6e67 6850       focalLenghP
+000015e0: 6978 656c 732c 206d 7367 203d 2073 656c  ixels, msg = sel
+000015f0: 662e 5f5f 7472 7947 6574 466f 6361 6c4c  f.__tryGetFocalL
+00001600: 656e 6774 6849 6e50 6978 656c 7328 7068  engthInPixels(ph
+00001610: 6f74 6f2c 2064 6f6d 6550 6f72 7429 0a20  oto, domePort). 
+00001620: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00001630: 6620 666f 6361 6c4c 656e 6768 5069 7865  f focalLenghPixe
+00001640: 6c73 203d 3d20 5b2d 312c 2d31 5d20 6f72  ls == [-1,-1] or
+00001650: 2066 6f63 616c 4c65 6e67 6850 6978 656c   focalLenghPixel
+00001660: 7320 3d3d 202d 313a 0a20 2020 2020 2020  s == -1:.       
+00001670: 2020 2020 2020 2020 2020 2020 2072 6169               rai
+00001680: 7365 206d 6971 7463 2e49 6664 6f45 7863  se miqtc.IfdoExc
+00001690: 6570 7469 6f6e 286d 7367 290a 2020 2020  eption(msg).    
+000016a0: 2020 2020 2020 2020 2020 2020 6d69 7174              miqt
+000016b0: 672e 7772 6974 6553 696d 706c 6555 746d  g.writeSimpleUtm
+000016c0: 576f 726c 6446 696c 6528 6f73 2e70 6174  WorldFile(os.pat
+000016d0: 682e 6a6f 696e 2864 6573 7444 6972 2c6d  h.join(destDir,m
+000016e0: 6971 7467 2e63 6f6e 7665 7274 496d 6167  iqtg.convertImag
+000016f0: 654e 616d 6554 6f57 6f72 6c64 4669 6c65  eNameToWorldFile
+00001700: 4e61 6d65 2870 686f 746f 2929 2c65 6173  Name(photo)),eas
+00001710: 7469 6e67 2c6e 6f72 7468 696e 672c 7a6f  ting,northing,zo
+00001720: 6e65 2c69 734e 6f72 7468 2c69 6d61 6765  ne,isNorth,image
+00001730: 5769 6474 682c 696d 6167 6548 6569 6768  Width,imageHeigh
+00001740: 742c 6865 6164 696e 672c 616c 7469 7475  t,heading,altitu
+00001750: 6465 2c66 6f63 616c 4c65 6e67 6850 6978  de,focalLenghPix
+00001760: 656c 735b 305d 2c66 6f63 616c 4c65 6e67  els[0],focalLeng
+00001770: 6850 6978 656c 735b 315d 290a 2020 2020  hPixels[1]).    
+00001780: 2020 2020 2020 2020 6578 6365 7074 206d          except m
+00001790: 6971 7463 2e49 6664 6f45 7863 6570 7469  iqtc.IfdoExcepti
+000017a0: 6f6e 2061 7320 653a 0a20 2020 2020 2020  on as e:.       
+000017b0: 2020 2020 2020 2020 2069 4644 4f65 7863           iFDOexc
+000017c0: 6570 7469 6f6e 732e 6170 7065 6e64 285b  eptions.append([
+000017d0: 7068 6f74 6f2c 7374 7228 652e 6172 6773  photo,str(e.args
+000017e0: 295d 290a 0a20 2020 2020 2020 2072 6574  )])..        ret
+000017f0: 7572 6e20 6946 444f 6578 6365 7074 696f  urn iFDOexceptio
+00001800: 6e73 0a0a 0a20 2020 2064 6566 2063 6865  ns...    def che
+00001810: 636b 4974 656d 4861 7368 2873 656c 662c  ckItemHash(self,
+00001820: 6974 656d 3a73 7472 2c66 696c 6544 6972  item:str,fileDir
+00001830: 3a73 7472 293a 0a20 2020 2020 2020 2022  :str):.        "
+00001840: 2222 2063 6f6d 7061 7265 7320 6669 6c65  "" compares file
+00001850: 2773 2068 6173 6820 7769 7468 2068 6173  's hash with has
+00001860: 6820 696e 2069 4644 4f20 616e 6420 7468  h in iFDO and th
+00001870: 726f 7773 2065 7863 6570 7469 6f6e 2069  rows exception i
+00001880: 6620 7468 6579 2064 6f6e 2774 206d 6174  f they don't mat
+00001890: 6368 2022 2222 0a0a 2020 2020 2020 2020  ch """..        
+000018a0: 6669 6c65 203d 206f 732e 7061 7468 2e6a  file = os.path.j
+000018b0: 6f69 6e28 6669 6c65 4469 722c 6974 656d  oin(fileDir,item
+000018c0: 290a 2020 2020 2020 2020 6966 206e 6f74  ).        if not
+000018d0: 206f 732e 7061 7468 2e69 7366 696c 6528   os.path.isfile(
+000018e0: 6669 6c65 293a 0a20 2020 2020 2020 2020  file):.         
+000018f0: 2020 2072 6169 7365 206d 6971 7463 2e49     raise miqtc.I
+00001900: 6664 6f45 7863 6570 7469 6f6e 2822 4669  fdoException("Fi
+00001910: 6c65 205c 2222 202b 2069 7465 6d20 2b20  le \"" + item + 
+00001920: 225c 2220 6e6f 7420 666f 756e 6420 696e  "\" not found in
+00001930: 2064 6972 205c 2222 202b 2066 696c 6544   dir \"" + fileD
+00001940: 6972 202b 2022 5c22 2229 0a0a 2020 2020  ir + "\"")..    
+00001950: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+00001960: 6528 7365 6c66 2e69 6664 6f5b 6d69 7174  e(self.ifdo[miqt
+00001970: 762e 696d 6167 655f 7365 745f 6974 656d  v.image_set_item
+00001980: 735f 6b65 795d 5b69 7465 6d5d 2c6c 6973  s_key][item],lis
+00001990: 7429 3a20 2320 696e 2063 6173 6520 6f66  t): # in case of
+000019a0: 2076 6964 656f 2077 6974 6820 6974 656d   video with item
+000019b0: 2061 7320 6c69 7374 2074 6865 2066 6972   as list the fir
+000019c0: 7374 2065 6e74 7279 2068 6f6c 6473 2074  st entry holds t
+000019d0: 6865 2064 6566 6175 6c74 2061 6e64 2074  he default and t
+000019e0: 6865 2068 6173 6820 6361 6e6e 6f74 2076  he hash cannot v
+000019f0: 6172 7920 666f 7220 7468 6520 7361 6d65  ary for the same
+00001a00: 2069 6d61 6765 0a20 2020 2020 2020 2020   image.         
+00001a10: 2020 2069 7465 6d45 6e74 7279 203d 2073     itemEntry = s
+00001a20: 656c 662e 6966 646f 5b6d 6971 7476 2e69  elf.ifdo[miqtv.i
+00001a30: 6d61 6765 5f73 6574 5f69 7465 6d73 5f6b  mage_set_items_k
+00001a40: 6579 5d5b 6974 656d 5d5b 305d 200a 2020  ey][item][0] .  
+00001a50: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00001a60: 2020 2020 2020 2020 6974 656d 456e 7472          itemEntr
+00001a70: 7920 3d20 7365 6c66 2e69 6664 6f5b 6d69  y = self.ifdo[mi
+00001a80: 7174 762e 696d 6167 655f 7365 745f 6974  qtv.image_set_it
+00001a90: 656d 735f 6b65 795d 5b69 7465 6d5d 0a20  ems_key][item]. 
+00001aa0: 2020 2020 2020 2069 6620 6e6f 7420 6974         if not it
+00001ab0: 656d 456e 7472 795b 2769 6d61 6765 2d68  emEntry['image-h
+00001ac0: 6173 682d 7368 6132 3536 275d 203d 3d20  ash-sha256'] == 
+00001ad0: 6d69 7174 632e 7368 6132 3536 4861 7368  miqtc.sha256Hash
+00001ae0: 4669 6c65 2866 696c 6529 3a0a 2020 2020  File(file):.    
+00001af0: 2020 2020 2020 2020 7261 6973 6520 6d69          raise mi
+00001b00: 7174 632e 4966 646f 4578 6365 7074 696f  qtc.IfdoExceptio
+00001b10: 6e28 6974 656d 2c20 2269 4644 4f20 656e  n(item, "iFDO en
+00001b20: 7472 7920 6973 206e 6f74 2075 7020 746f  try is not up to
+00001b30: 2064 6174 652c 2069 6d61 6765 2068 6173   date, image has
+00001b40: 6820 646f 6573 206e 6f74 206d 6174 6368  h does not match
+00001b50: 2e22 290a 0a20 2020 2064 6566 2067 6574  .")..    def get
+00001b60: 496d 6167 6544 6972 6563 746f 7279 2873  ImageDirectory(s
+00001b70: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
+00001b80: 2220 5265 7475 726e 7320 7468 6520 6c6f  " Returns the lo
+00001b90: 7765 726d 6f73 7420 6c6f 6361 6c20 6469  wermost local di
+00001ba0: 7265 6374 6f72 7920 636f 6e74 6169 6e69  rectory containi
+00001bb0: 6e67 2074 6865 2069 6d61 6765 2066 696c  ng the image fil
+00001bc0: 6573 2069 6e66 6572 7265 6420 6672 6f6d  es inferred from
+00001bd0: 2027 696d 6167 652d 6c6f 6361 6c2d 7061   'image-local-pa
+00001be0: 7468 272e 2049 6620 2769 6d61 6765 2d6c  th'. If 'image-l
+00001bf0: 6f63 616c 2d70 6174 6827 206e 6f74 2070  ocal-path' not p
+00001c00: 726f 7669 6465 6420 666f 7220 616c 6c20  rovided for all 
+00001c10: 696d 6167 6520 6974 656d 7320 7468 6520  image items the 
+00001c20: 6946 444f 2773 2070 6172 656e 7420 6469  iFDO's parent di
+00001c30: 7265 6374 6f72 7920 6973 2072 6574 7572  rectory is retur
+00001c40: 6e65 642e 2022 2222 0a20 2020 2020 2020  ned. """.       
+00001c50: 206c 6f63 616c 5061 7468 7320 3d20 5b5d   localPaths = []
+00001c60: 0a20 2020 2020 2020 2069 4644 4f46 696c  .        iFDOFil
+00001c70: 6550 6172 656e 7444 6972 203d 206f 732e  eParentDir = os.
+00001c80: 7061 7468 2e64 6972 6e61 6d65 286f 732e  path.dirname(os.
+00001c90: 7061 7468 2e64 6972 6e61 6d65 2873 656c  path.dirname(sel
+00001ca0: 662e 6946 444f 6669 6c65 2929 0a20 2020  f.iFDOfile)).   
+00001cb0: 2020 2020 2066 6f72 2069 7465 6d20 696e       for item in
+00001cc0: 2073 656c 662e 6966 646f 5b6d 6971 7476   self.ifdo[miqtv
+00001cd0: 2e69 6d61 6765 5f73 6574 5f69 7465 6d73  .image_set_items
+00001ce0: 5f6b 6579 5d3a 0a20 2020 2020 2020 2020  _key]:.         
+00001cf0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+00001d00: 2020 2020 2020 2020 6974 656d 4c6f 6361          itemLoca
+00001d10: 6c50 6174 6820 3d20 7365 6c66 2e5f 5f67  lPath = self.__g
+00001d20: 6574 4974 656d 4465 6661 756c 7456 616c  etItemDefaultVal
+00001d30: 7565 2869 7465 6d2c 2769 6d61 6765 2d6c  ue(item,'image-l
+00001d40: 6f63 616c 2d70 6174 6827 290a 2020 2020  ocal-path').    
+00001d50: 2020 2020 2020 2020 6578 6365 7074 206d          except m
+00001d60: 6971 7463 2e49 6664 6f45 7863 6570 7469  iqtc.IfdoExcepti
+00001d70: 6f6e 3a0a 2020 2020 2020 2020 2020 2020  on:.            
+00001d80: 2020 2020 6974 656d 4c6f 6361 6c50 6174      itemLocalPat
+00001d90: 6820 3d20 6946 444f 4669 6c65 5061 7265  h = iFDOFilePare
+00001da0: 6e74 4469 720a 2020 2020 2020 2020 2020  ntDir.          
+00001db0: 2020 6966 2069 7465 6d4c 6f63 616c 5061    if itemLocalPa
+00001dc0: 7468 206e 6f74 2069 6e20 6c6f 6361 6c50  th not in localP
+00001dd0: 6174 6873 3a0a 2020 2020 2020 2020 2020  aths:.          
+00001de0: 2020 2020 2020 6c6f 6361 6c50 6174 6873        localPaths
+00001df0: 2e61 7070 656e 6428 6974 656d 4c6f 6361  .append(itemLoca
+00001e00: 6c50 6174 6829 0a20 2020 2020 2020 2063  lPath).        c
+00001e10: 6f6d 6d6f 6e50 6174 6820 3d20 6f73 2e70  ommonPath = os.p
+00001e20: 6174 682e 636f 6d6d 6f6e 7061 7468 286c  ath.commonpath(l
+00001e30: 6f63 616c 5061 7468 7329 0a20 2020 2020  ocalPaths).     
+00001e40: 2020 2069 6620 6e6f 7420 6f73 2e70 6174     if not os.pat
+00001e50: 682e 6973 6162 7328 636f 6d6d 6f6e 5061  h.isabs(commonPa
+00001e60: 7468 293a 0a20 2020 2020 2020 2020 2020  th):.           
+00001e70: 2063 6f6d 6d6f 6e50 6174 6820 3d20 6f73   commonPath = os
+00001e80: 2e70 6174 682e 6e6f 726d 7061 7468 286f  .path.normpath(o
+00001e90: 732e 7061 7468 2e6a 6f69 6e28 6f73 2e70  s.path.join(os.p
+00001ea0: 6174 682e 6469 726e 616d 6528 7365 6c66  ath.dirname(self
+00001eb0: 2e69 4644 4f66 696c 6529 2c20 636f 6d6d  .iFDOfile), comm
+00001ec0: 6f6e 5061 7468 2929 0a20 2020 2020 2020  onPath)).       
+00001ed0: 2072 6574 7572 6e20 636f 6d6d 6f6e 5061   return commonPa
+00001ee0: 7468 0a0a 0a20 2020 2064 6566 205f 5f74  th...    def __t
+00001ef0: 7279 4765 7449 7344 6f6d 6550 6f72 7428  ryGetIsDomePort(
+00001f00: 7365 6c66 2c69 7465 6d29 3a0a 2020 2020  self,item):.    
+00001f10: 2020 2020 2222 2220 5472 6965 7320 746f      """ Tries to
+00001f20: 2072 6561 6420 706f 7274 2074 7970 6520   read port type 
+00001f30: 6672 6f6d 2027 696d 6167 652d 6361 6d65  from 'image-came
+00001f40: 7261 2d68 6f75 7369 6e67 2d76 6965 7770  ra-housing-viewp
+00001f50: 6f72 7427 5b76 6965 7770 6f72 742d 7479  ort'[viewport-ty
+00001f60: 7065 5d20 6f72 2027 696d 6167 652d 666c  pe] or 'image-fl
+00001f70: 6174 706f 7274 2d70 6172 616d 6574 6572  atport-parameter
+00001f80: 7327 2f27 696d 6167 652d 646f 6d65 706f  s'/'image-domepo
+00001f90: 7274 2d70 6172 616d 6574 6572 7327 200a  rt-parameters' .
+00001fa0: 2020 2020 2020 2020 2020 2020 5265 7475              Retu
+00001fb0: 726e 7320 5472 7565 2c6d 7367 2069 6620  rns True,msg if 
+00001fc0: 646f 6d65 2070 6f72 742c 2046 616c 7365  dome port, False
+00001fd0: 2c6d 7367 2069 6620 666c 6174 2070 6f72  ,msg if flat por
+00001fe0: 742c 204e 6f6e 652c 6d73 6720 6f74 6865  t, None,msg othe
+00001ff0: 7277 6973 6520 2222 220a 0a20 2020 2020  rwise """..     
+00002000: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+00002010: 2020 2020 706f 7274 5479 7065 5374 7220      portTypeStr 
+00002020: 3d20 7365 6c66 2e5f 5f67 6574 4974 656d  = self.__getItem
+00002030: 4465 6661 756c 7456 616c 7565 2869 7465  DefaultValue(ite
+00002040: 6d2c 2769 6d61 6765 2d63 616d 6572 612d  m,'image-camera-
+00002050: 686f 7573 696e 672d 7669 6577 706f 7274  housing-viewport
+00002060: 2729 0a20 2020 2020 2020 2020 2020 2070  ').            p
+00002070: 6f72 7454 7970 6553 7472 203d 2070 6f72  ortTypeStr = por
+00002080: 7454 7970 6553 7472 5b27 7669 6577 706f  tTypeStr['viewpo
+00002090: 7274 2d74 7970 6527 5d0a 2020 2020 2020  rt-type'].      
+000020a0: 2020 2020 2020 6966 2027 646f 6d65 2720        if 'dome' 
+000020b0: 696e 2070 6f72 7454 7970 6553 7472 2e6c  in portTypeStr.l
+000020c0: 6f77 6572 2829 2061 6e64 206e 6f74 2027  ower() and not '
+000020d0: 666c 6174 2720 696e 2070 6f72 7454 7970  flat' in portTyp
+000020e0: 6553 7472 2e6c 6f77 6572 2829 3a0a 2020  eStr.lower():.  
+000020f0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00002100: 7475 726e 2054 7275 652c 2250 6172 7365  turn True,"Parse
+00002110: 6420 6672 6f6d 2027 696d 6167 652d 6361  d from 'image-ca
+00002120: 6d65 7261 2d68 6f75 7369 6e67 2d76 6965  mera-housing-vie
+00002130: 7770 6f72 7427 5b27 7669 6577 706f 7274  wport'['viewport
+00002140: 2d74 7970 6527 5d22 0a20 2020 2020 2020  -type']".       
+00002150: 2020 2020 2065 6c69 6620 6e6f 7420 2764       elif not 'd
+00002160: 6f6d 6527 2069 6e20 706f 7274 5479 7065  ome' in portType
+00002170: 5374 722e 6c6f 7765 7228 2920 616e 6420  Str.lower() and 
+00002180: 2766 6c61 7427 2069 6e20 706f 7274 5479  'flat' in portTy
+00002190: 7065 5374 722e 6c6f 7765 7228 293a 0a20  peStr.lower():. 
+000021a0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+000021b0: 6574 7572 6e20 4661 6c73 652c 2250 6172  eturn False,"Par
+000021c0: 7365 6420 6672 6f6d 2027 696d 6167 652d  sed from 'image-
+000021d0: 6361 6d65 7261 2d68 6f75 7369 6e67 2d76  camera-housing-v
+000021e0: 6965 7770 6f72 7427 5b27 7669 6577 706f  iewport'['viewpo
+000021f0: 7274 2d74 7970 6527 5d22 0a20 2020 2020  rt-type']".     
+00002200: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00002210: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00002220: 7572 6e20 4e6f 6e65 2c22 436f 756c 6420  urn None,"Could 
+00002230: 6e6f 7420 7265 6164 2070 6f72 7420 7479  not read port ty
+00002240: 7065 2066 726f 6d20 2769 6d61 6765 2d63  pe from 'image-c
+00002250: 616d 6572 612d 686f 7573 696e 672d 7669  amera-housing-vi
+00002260: 6577 706f 7274 275b 2776 6965 7770 6f72  ewport'['viewpor
+00002270: 742d 7479 7065 275d 2069 6e20 6974 656d  t-type'] in item
+00002280: 3a20 2220 2b20 6974 656d 0a20 2020 2020  : " + item.     
+00002290: 2020 2065 7863 6570 7420 286d 6971 7463     except (miqtc
+000022a0: 2e49 6664 6f45 7863 6570 7469 6f6e 2c20  .IfdoException, 
+000022b0: 4b65 7945 7272 6f72 293a 0a20 2020 2020  KeyError):.     
+000022c0: 2020 2020 2020 2070 6173 730a 0a20 2020         pass..   
+000022d0: 2020 2020 2066 6c61 7450 6f72 7450 6172       flatPortPar
+000022e0: 616d 7346 6f75 6e64 203d 2046 616c 7365  amsFound = False
+000022f0: 0a20 2020 2020 2020 2074 7279 3a20 0a20  .        try: . 
+00002300: 2020 2020 2020 2020 2020 2066 6c61 7450             flatP
+00002310: 6f72 7450 6172 616d 7320 3d20 7365 6c66  ortParams = self
+00002320: 2e5f 5f67 6574 4974 656d 4465 6661 756c  .__getItemDefaul
+00002330: 7456 616c 7565 2869 7465 6d2c 2769 6d61  tValue(item,'ima
+00002340: 6765 2d66 6c61 7470 6f72 742d 7061 7261  ge-flatport-para
+00002350: 6d65 7465 7273 2729 0a20 2020 2020 2020  meters').       
+00002360: 2020 2020 2066 6c61 7450 6f72 7450 6172       flatPortPar
+00002370: 616d 7346 6f75 6e64 203d 2054 7275 650a  amsFound = True.
+00002380: 2020 2020 2020 2020 6578 6365 7074 206d          except m
+00002390: 6971 7463 2e49 6664 6f45 7863 6570 7469  iqtc.IfdoExcepti
+000023a0: 6f6e 3a0a 2020 2020 2020 2020 2020 2020  on:.            
+000023b0: 7061 7373 0a20 2020 2020 2020 2064 6f6d  pass.        dom
+000023c0: 6550 6f72 7450 6172 616d 7346 6f75 6e64  ePortParamsFound
+000023d0: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
+000023e0: 2074 7279 3a20 0a20 2020 2020 2020 2020   try: .         
+000023f0: 2020 2064 6f6d 6550 6f72 7450 6172 616d     domePortParam
+00002400: 7320 3d20 7365 6c66 2e5f 5f67 6574 4974  s = self.__getIt
+00002410: 656d 4465 6661 756c 7456 616c 7565 2869  emDefaultValue(i
+00002420: 7465 6d2c 2769 6d61 6765 2d64 6f6d 6570  tem,'image-domep
+00002430: 6f72 742d 7061 7261 6d65 7465 7273 2729  ort-parameters')
+00002440: 0a20 2020 2020 2020 2020 2020 2064 6f6d  .            dom
+00002450: 6550 6f72 7450 6172 616d 7346 6f75 6e64  ePortParamsFound
+00002460: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
+00002470: 6578 6365 7074 206d 6971 7463 2e49 6664  except miqtc.Ifd
+00002480: 6f45 7863 6570 7469 6f6e 3a0a 2020 2020  oException:.    
+00002490: 2020 2020 2020 2020 7061 7373 0a0a 2020          pass..  
+000024a0: 2020 2020 2020 6966 2066 6c61 7450 6f72        if flatPor
+000024b0: 7450 6172 616d 7346 6f75 6e64 2061 6e64  tParamsFound and
+000024c0: 2064 6f6d 6550 6f72 7450 6172 616d 7346   domePortParamsF
+000024d0: 6f75 6e64 3a0a 2020 2020 2020 2020 2020  ound:.          
+000024e0: 2020 7265 7475 726e 204e 6f6e 652c 2243    return None,"C
+000024f0: 6f75 6c64 206e 6f74 2072 6561 6420 706f  ould not read po
+00002500: 7274 2074 7970 6520 6672 6f6d 2069 7465  rt type from ite
+00002510: 6d20 6173 2069 7420 636f 6e74 6169 6e73  m as it contains
+00002520: 2069 6e66 6f20 6f6e 2062 6f74 6820 666c   info on both fl
+00002530: 6174 2061 6e64 2064 6f6d 6520 706f 7274  at and dome port
+00002540: 3a20 2220 2b20 6974 656d 0a20 2020 2020  : " + item.     
+00002550: 2020 2069 6620 666c 6174 506f 7274 5061     if flatPortPa
+00002560: 7261 6d73 466f 756e 643a 0a20 2020 2020  ramsFound:.     
+00002570: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
+00002580: 6c73 652c 2241 7373 756d 6564 2061 7320  lse,"Assumed as 
+00002590: 666c 6174 2070 6f72 7420 6173 2027 696d  flat port as 'im
+000025a0: 6167 652d 666c 6174 706f 7274 2d70 6172  age-flatport-par
+000025b0: 616d 6574 6572 7327 2066 6f75 6e64 2069  ameters' found i
+000025c0: 6e20 6974 656d 3a20 2220 2b20 6974 656d  n item: " + item
+000025d0: 0a20 2020 2020 2020 2069 6620 646f 6d65  .        if dome
+000025e0: 506f 7274 5061 7261 6d73 466f 756e 643a  PortParamsFound:
+000025f0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00002600: 7572 6e20 5472 7565 2c22 4173 7375 6d65  urn True,"Assume
+00002610: 6420 6173 2064 6f6d 6520 706f 7274 2061  d as dome port a
+00002620: 7320 2769 6d61 6765 2d64 6f6d 6570 6f72  s 'image-domepor
+00002630: 742d 7061 7261 6d65 7465 7273 2720 666f  t-parameters' fo
+00002640: 756e 6420 696e 2069 7465 6d3a 2022 202b  und in item: " +
+00002650: 2069 7465 6d0a 2020 2020 2020 2020 7265   item.        re
+00002660: 7475 726e 204e 6f6e 652c 2243 6f75 6c64  turn None,"Could
+00002670: 206e 6f74 2072 6561 6420 706f 7274 2074   not read port t
+00002680: 7970 6520 6672 6f6d 2069 7465 6d3a 2022  ype from item: "
+00002690: 202b 2069 7465 6d0a 0a0a 2020 2020 6465   + item...    de
+000026a0: 6620 5f5f 7472 7947 6574 466f 6361 6c4c  f __tryGetFocalL
+000026b0: 656e 6774 6849 6e50 6978 656c 7328 7365  engthInPixels(se
+000026c0: 6c66 2c69 7465 6d3a 7374 722c 646f 6d65  lf,item:str,dome
+000026d0: 506f 7274 3d4e 6f6e 6529 3a0a 2020 2020  Port=None):.    
+000026e0: 2020 2020 2222 2220 0a20 2020 2020 2020      """ .       
+000026f0: 2054 7269 6573 2074 6f20 7265 6164 2f64   Tries to read/d
+00002700: 6574 6572 6d69 6e65 2066 6f63 616c 206c  etermine focal l
+00002710: 656e 6774 6820 696e 2070 6978 656c 7320  ength in pixels 
+00002720: 6569 7468 6572 2066 726f 6d20 2769 6d61  either from 'ima
+00002730: 6765 2d63 616d 6572 612d 6361 6c69 6272  ge-camera-calibr
+00002740: 6174 696f 6e2d 6d6f 6465 6c27 5b27 6361  ation-model'['ca
+00002750: 6c69 6272 6174 696f 6e2d 666f 6361 6c2d  libration-focal-
+00002760: 6c65 6e67 7468 2d78 792d 7069 7865 6c27  length-xy-pixel'
+00002770: 5d20 6f72 2066 726f 6d20 6578 6966 2076  ] or from exif v
+00002780: 616c 7565 732e 0a20 2020 2020 2020 2069  alues..        i
+00002790: 6620 646f 6d65 506f 7274 203d 2046 616c  f domePort = Fal
+000027a0: 7365 2c20 666c 6174 2070 6f72 7420 6973  se, flat port is
+000027b0: 2061 7373 756d 6564 2061 6e64 2061 2063   assumed and a c
+000027c0: 6f72 7265 6374 696f 6e20 6661 6374 6f72  orrection factor
+000027d0: 206f 6620 312e 3333 2069 7320 6170 706c   of 1.33 is appl
+000027e0: 6965 6420 666f 7220 666f 6361 6c20 6c65  ied for focal le
+000027f0: 6e67 7468 2064 6574 6572 6d69 6e65 6420  ngth determined 
+00002800: 6672 6f6d 2065 7869 6620 7661 6c75 6573  from exif values
+00002810: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
+00002820: 2065 6974 6865 7220 666f 6361 6c4c 656e   either focalLen
+00002830: 6774 682c 206d 6573 7361 6765 206f 7220  gth, message or 
+00002840: 5b66 6f63 616c 4c65 6e67 7468 582c 666f  [focalLengthX,fo
+00002850: 6361 6c4c 656e 6774 6859 5d2c 206d 6573  calLengthY], mes
+00002860: 7361 6765 2e20 4966 2075 6e73 7563 6365  sage. If unsucce
+00002870: 7373 6675 6c20 666f 6361 6c4c 656e 6774  ssful focalLengt
+00002880: 6820 3d20 2d31 0a20 2020 2020 2020 2022  h = -1.        "
+00002890: 2222 0a0a 2020 2020 2020 2020 2320 7472  ""..        # tr
+000028a0: 7920 7265 6164 2066 726f 6d20 2769 6d61  y read from 'ima
+000028b0: 6765 2d63 616d 6572 612d 6361 6c69 6272  ge-camera-calibr
+000028c0: 6174 696f 6e2d 6d6f 6465 6c27 5b27 6361  ation-model'['ca
+000028d0: 6c69 6272 6174 696f 6e2d 666f 6361 6c2d  libration-focal-
+000028e0: 6c65 6e67 7468 2d78 792d 7069 7865 6c27  length-xy-pixel'
+000028f0: 5d0a 2020 2020 2020 2020 7472 793a 0a20  ].        try:. 
+00002900: 2020 2020 2020 2020 2020 2066 6f63 616c             focal
+00002910: 4c65 6e67 7468 5859 203d 2073 656c 662e  LengthXY = self.
+00002920: 5f5f 6765 7449 7465 6d44 6566 6175 6c74  __getItemDefault
+00002930: 5661 6c75 6528 6974 656d 2c27 696d 6167  Value(item,'imag
+00002940: 652d 6361 6d65 7261 2d63 616c 6962 7261  e-camera-calibra
+00002950: 7469 6f6e 2d6d 6f64 656c 2729 0a20 2020  tion-model').   
+00002960: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
+00002970: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+00002980: 6361 6c4c 656e 6774 6858 5920 3d20 666f  calLengthXY = fo
+00002990: 6361 6c4c 656e 6774 6858 595b 2763 616c  calLengthXY['cal
+000029a0: 6962 7261 7469 6f6e 2d66 6f63 616c 2d6c  ibration-focal-l
+000029b0: 656e 6774 682d 7879 2d70 6978 656c 275d  ength-xy-pixel']
+000029c0: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
+000029d0: 6570 7420 4b65 7945 7272 6f72 3a0a 2020  ept KeyError:.  
+000029e0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+000029f0: 6973 6520 6d69 7174 632e 4966 646f 4578  ise miqtc.IfdoEx
+00002a00: 6365 7074 696f 6e28 6974 656d 2c22 646f  ception(item,"do
+00002a10: 6573 206e 6f74 2063 6f6e 7461 696e 2027  es not contain '
+00002a20: 696d 6167 652d 6361 6d65 7261 2d63 616c  image-camera-cal
+00002a30: 6962 7261 7469 6f6e 2d6d 6f64 656c 275b  ibration-model'[
+00002a40: 2763 616c 6962 7261 7469 6f6e 2d66 6f63  'calibration-foc
+00002a50: 616c 2d6c 656e 6774 682d 7879 2d70 6978  al-length-xy-pix
+00002a60: 656c 275d 2229 0a0a 2020 2020 2020 2020  el']")..        
+00002a70: 2020 2020 6966 206e 6f74 2069 7369 6e73      if not isins
+00002a80: 7461 6e63 6528 666f 6361 6c4c 656e 6774  tance(focalLengt
+00002a90: 6858 592c 6c69 7374 293a 2023 2078 2061  hXY,list): # x a
+00002aa0: 6e64 2079 2076 616c 7565 2061 7265 2069  nd y value are i
+00002ab0: 6465 6e74 6963 616c 0a20 2020 2020 2020  dentical.       
+00002ac0: 2020 2020 2020 2020 2066 6f63 616c 4c65           focalLe
+00002ad0: 6e67 7468 5859 203d 205b 666f 6361 6c4c  ngthXY = [focalL
+00002ae0: 656e 6774 6858 592c 666f 6361 6c4c 656e  engthXY,focalLen
+00002af0: 6774 6858 595d 0a20 2020 2020 2020 2020  gthXY].         
+00002b00: 2020 2069 6620 6c65 6e28 666f 6361 6c4c     if len(focalL
+00002b10: 656e 6774 6858 5929 2021 3d20 323a 0a20  engthXY) != 2:. 
+00002b20: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00002b30: 6169 7365 206d 6971 7463 2e49 6664 6f45  aise miqtc.IfdoE
+00002b40: 7863 6570 7469 6f6e 2869 7465 6d2c 2249  xception(item,"I
+00002b50: 6e76 616c 6964 2065 6e74 7279 2066 6f72  nvalid entry for
+00002b60: 2027 696d 6167 652d 6361 6d65 7261 2d63   'image-camera-c
+00002b70: 616c 6962 7261 7469 6f6e 2d6d 6f64 656c  alibration-model
+00002b80: 275b 2763 616c 6962 7261 7469 6f6e 2d66  '['calibration-f
+00002b90: 6f63 616c 2d6c 656e 6774 682d 7879 2d70  ocal-length-xy-p
+00002ba0: 6978 656c 275d 203a 2022 202b 2073 7472  ixel'] : " + str
+00002bb0: 2866 6f63 616c 4c65 6e67 7468 5859 2920  (focalLengthXY) 
+00002bc0: 290a 0a20 2020 2020 2020 2020 2020 2069  )..            i
+00002bd0: 6620 6e6f 7420 6973 696e 7374 616e 6365  f not isinstance
+00002be0: 2866 6f63 616c 4c65 6e67 7468 5859 5b30  (focalLengthXY[0
+00002bf0: 5d2c 666c 6f61 7429 206f 7220 6e6f 7420  ],float) or not 
+00002c00: 6973 696e 7374 616e 6365 2866 6f63 616c  isinstance(focal
+00002c10: 4c65 6e67 7468 5859 5b30 5d2c 696e 7429  LengthXY[0],int)
+00002c20: 206f 7220 6e6f 7420 6973 696e 7374 616e   or not isinstan
+00002c30: 6365 2866 6f63 616c 4c65 6e67 7468 5859  ce(focalLengthXY
+00002c40: 5b31 5d2c 666c 6f61 7429 206f 7220 6e6f  [1],float) or no
+00002c50: 7420 6973 696e 7374 616e 6365 2866 6f63  t isinstance(foc
+00002c60: 616c 4c65 6e67 7468 5859 5b31 5d2c 696e  alLengthXY[1],in
+00002c70: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
+00002c80: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+00002c90: 2020 2020 2020 2020 2020 2020 2066 6f63               foc
+00002ca0: 616c 4c65 6e67 7468 5859 203d 205b 666c  alLengthXY = [fl
+00002cb0: 6f61 7428 666f 6361 6c4c 656e 6774 6858  oat(focalLengthX
+00002cc0: 595b 305d 292c 666c 6f61 7428 666f 6361  Y[0]),float(foca
+00002cd0: 6c4c 656e 6774 6858 595b 315d 295d 0a20  lLengthXY[1])]. 
+00002ce0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00002cf0: 7863 6570 7420 5661 6c75 6545 7272 6f72  xcept ValueError
+00002d00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00002d10: 2020 2020 2020 7261 6973 6520 6d69 7174        raise miqt
+00002d20: 632e 4966 646f 4578 6365 7074 696f 6e28  c.IfdoException(
+00002d30: 6974 656d 2c22 496e 7661 6c69 6420 656e  item,"Invalid en
+00002d40: 7472 7920 666f 7220 2769 6d61 6765 2d63  try for 'image-c
+00002d50: 616d 6572 612d 6361 6c69 6272 6174 696f  amera-calibratio
+00002d60: 6e2d 6d6f 6465 6c27 5b27 6361 6c69 6272  n-model'['calibr
+00002d70: 6174 696f 6e2d 666f 6361 6c2d 6c65 6e67  ation-focal-leng
+00002d80: 7468 2d78 792d 7069 7865 6c27 5d20 3a20  th-xy-pixel'] : 
+00002d90: 2220 2b20 7374 7228 666f 6361 6c4c 656e  " + str(focalLen
+00002da0: 6774 6858 5929 2029 0a20 2020 2020 2020  gthXY) ).       
+00002db0: 2020 2020 200a 2020 2020 2020 2020 2020       .          
+00002dc0: 2020 7265 7475 726e 2066 6f63 616c 4c65    return focalLe
+00002dd0: 6e67 7468 5859 2c20 2250 6172 7365 6420  ngthXY, "Parsed 
+00002de0: 6672 6f6d 2027 696d 6167 652d 6361 6d65  from 'image-came
+00002df0: 7261 2d63 616c 6962 7261 7469 6f6e 2d6d  ra-calibration-m
+00002e00: 6f64 656c 275b 2763 616c 6962 7261 7469  odel'['calibrati
+00002e10: 6f6e 2d66 6f63 616c 2d6c 656e 6774 682d  on-focal-length-
+00002e20: 7879 2d70 6978 656c 275d 220a 2020 2020  xy-pixel']".    
+00002e30: 2020 2020 6578 6365 7074 206d 6971 7463      except miqtc
+00002e40: 2e49 6664 6f45 7863 6570 7469 6f6e 3a0a  .IfdoException:.
+00002e50: 2020 2020 2020 2020 2020 2020 7061 7373              pass
+00002e60: 0a0a 2020 2020 2020 2020 756e 6465 7277  ..        underw
+00002e70: 6174 6572 496d 6167 6520 3d20 5472 7565  aterImage = True
+00002e80: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
+00002e90: 2020 2020 2020 2020 2020 616c 7430 203d            alt0 =
+00002ea0: 2073 656c 665b 6974 656d 2b27 303a 696d   self[item+'0:im
+00002eb0: 6167 652d 616c 7469 7475 6465 2d6d 6574  age-altitude-met
+00002ec0: 6572 7327 5d20 2373 656c 662e 5f5f 6765  ers'] #self.__ge
+00002ed0: 7449 7465 6d44 6566 6175 6c74 5661 6c75  tItemDefaultValu
+00002ee0: 6528 6974 656d 2c20 2769 6d61 6765 2d61  e(item, 'image-a
+00002ef0: 6c74 6974 7564 652d 6d65 7465 7273 2729  ltitude-meters')
+00002f00: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00002f10: 616c 7430 203e 2030 3a0a 2020 2020 2020  alt0 > 0:.      
+00002f20: 2020 2020 2020 2020 2020 756e 6465 7277            underw
+00002f30: 6174 6572 496d 6167 6520 3d20 4661 6c73  aterImage = Fals
+00002f40: 650a 2020 2020 2020 2020 6578 6365 7074  e.        except
+00002f50: 206d 6971 7463 2e49 6664 6f45 7863 6570   miqtc.IfdoExcep
+00002f60: 7469 6f6e 3a0a 2020 2020 2020 2020 2020  tion:.          
+00002f70: 2020 7061 7373 0a0a 2020 2020 2020 2020    pass..        
+00002f80: 2320 6164 6420 636f 7272 6563 7469 6f6e  # add correction
+00002f90: 2066 6163 746f 7220 666f 7220 666c 6174   factor for flat
+00002fa0: 2070 6f72 740a 2020 2020 2020 2020 6966   port.        if
+00002fb0: 2064 6f6d 6550 6f72 7420 6973 204e 6f6e   domePort is Non
+00002fc0: 6520 616e 6420 756e 6465 7277 6174 6572  e and underwater
+00002fd0: 496d 6167 653a 0a20 2020 2020 2020 2020  Image:.         
+00002fe0: 2020 2072 6574 7572 6e20 5b2d 312c 2d31     return [-1,-1
+00002ff0: 5d2c 2022 436f 756c 6420 6e6f 7420 6465  ], "Could not de
+00003000: 7465 726d 696e 6520 666f 6361 6c20 6c65  termine focal le
+00003010: 6e67 7468 2066 726f 6d20 2769 6d61 6765  ngth from 'image
+00003020: 2d63 616d 6572 612d 6361 6c69 6272 6174  -camera-calibrat
+00003030: 696f 6e2d 6d6f 6465 6c27 5b27 6361 6c69  ion-model'['cali
+00003040: 6272 6174 696f 6e2d 666f 6361 6c2d 6c65  bration-focal-le
+00003050: 6e67 7468 2d78 792d 7069 7865 6c27 5d20  ngth-xy-pixel'] 
+00003060: 616e 6420 706f 7274 2074 7970 652c 2077  and port type, w
+00003070: 6869 6368 2069 7320 7265 7175 6972 6564  hich is required
+00003080: 2066 6f72 2063 6f72 7265 6374 2065 7661   for correct eva
+00003090: 6c75 6174 696f 6e20 6f66 2065 7869 6620  luation of exif 
+000030a0: 7661 6c75 6573 2c20 6973 206e 6f74 2070  values, is not p
+000030b0: 726f 7669 6465 6421 220a 2020 2020 2020  rovided!".      
+000030c0: 2020 636f 7272 6563 7469 6f6e 466b 7420    correctionFkt 
+000030d0: 3d20 312e 300a 2020 2020 2020 2020 6966  = 1.0.        if
+000030e0: 2064 6f6d 6550 6f72 7420 3d3d 2046 616c   domePort == Fal
+000030f0: 7365 2061 6e64 2075 6e64 6572 7761 7465  se and underwate
+00003100: 7249 6d61 6765 3a0a 2020 2020 2020 2020  rImage:.        
+00003110: 2020 2020 636f 7272 6563 7469 6f6e 466b      correctionFk
+00003120: 7420 3d20 312e 3333 0a0a 2020 2020 2020  t = 1.33..      
+00003130: 2020 2320 6f74 6865 7277 6973 6520 7472    # otherwise tr
+00003140: 7920 6465 7269 7665 2066 726f 6d20 6578  y derive from ex
+00003150: 6966 2074 6167 730a 2020 2020 2020 2020  if tags.        
+00003160: 6578 6966 203d 2073 656c 662e 5f5f 6765  exif = self.__ge
+00003170: 7449 7465 6d44 6566 6175 6c74 5661 6c75  tItemDefaultValu
+00003180: 6528 6974 656d 2c27 696d 6167 652d 6163  e(item,'image-ac
+00003190: 7175 6973 6974 696f 6e2d 7365 7474 696e  quisition-settin
+000031a0: 6773 2729 0a20 2020 2020 2020 2023 2320  gs').        ## 
+000031b0: 6672 6f6d 2046 6f63 616c 204c 656e 6774  from Focal Lengt
+000031c0: 682c 2046 6f63 616c 2050 6c61 6e65 2058  h, Focal Plane X
+000031d0: 2052 6573 6f6c 7574 696f 6e2c 2046 6f63   Resolution, Foc
+000031e0: 616c 2050 6c61 6e65 2059 2052 6573 6f6c  al Plane Y Resol
+000031f0: 7574 696f 6e2c 2046 6f63 616c 2050 6c61  ution, Focal Pla
+00003200: 6e65 2052 6573 6f6c 7574 696f 6e20 556e  ne Resolution Un
+00003210: 6974 0a20 2020 2020 2020 2066 6f63 616c  it.        focal
+00003220: 4c65 6e67 7468 5859 2c20 6d73 6720 3d20  LengthXY, msg = 
+00003230: 7365 6c66 2e5f 5f74 7279 4465 7465 726d  self.__tryDeterm
+00003240: 696e 6546 6f63 616c 4c65 6e67 6874 496e  ineFocalLenghtIn
+00003250: 5069 7865 6c73 4672 6f6d 4578 6966 5f31  PixelsFromExif_1
+00003260: 2865 7869 6629 0a20 2020 2020 2020 2069  (exif).        i
+00003270: 6620 666f 6361 6c4c 656e 6774 6858 5920  f focalLengthXY 
+00003280: 213d 205b 2d31 2c2d 315d 3a0a 2020 2020  != [-1,-1]:.    
+00003290: 2020 2020 2020 2020 7265 7475 726e 205b          return [
+000032a0: 652a 636f 7272 6563 7469 6f6e 466b 7420  e*correctionFkt 
+000032b0: 666f 7220 6520 696e 2066 6f63 616c 4c65  for e in focalLe
+000032c0: 6e67 7468 5859 5d2c 2027 4465 7269 7665  ngthXY], 'Derive
+000032d0: 6420 6672 6f6d 2065 7869 6620 7461 6773  d from exif tags
+000032e0: 2046 6f63 616c 204c 656e 6774 682c 2046   Focal Length, F
+000032f0: 6f63 616c 2050 6c61 6e65 2058 2052 6573  ocal Plane X Res
+00003300: 6f6c 7574 696f 6e2c 2046 6f63 616c 2050  olution, Focal P
+00003310: 6c61 6e65 2059 2052 6573 6f6c 7574 696f  lane Y Resolutio
+00003320: 6e2c 2046 6f63 616c 2050 6c61 6e65 2052  n, Focal Plane R
+00003330: 6573 6f6c 7574 696f 6e20 556e 6974 270a  esolution Unit'.
+00003340: 2020 2020 2020 2020 2323 2066 726f 6d20          ## from 
+00003350: 6672 6f6d 2033 3520 6d6d 2065 7175 6976  from 35 mm equiv
+00003360: 616c 656e 7420 666f 6361 6c20 6c65 6e67  alent focal leng
+00003370: 7468 0a20 2020 2020 2020 2066 6f63 616c  th.        focal
+00003380: 4c65 6e67 7468 5859 2c20 6d73 6720 3d20  LengthXY, msg = 
+00003390: 7365 6c66 2e5f 5f74 7279 4465 7465 726d  self.__tryDeterm
+000033a0: 696e 6546 6f63 616c 4c65 6e67 6874 496e  ineFocalLenghtIn
+000033b0: 5069 7865 6c73 4672 6f6d 4578 6966 5f32  PixelsFromExif_2
+000033c0: 2865 7869 6629 0a20 2020 2020 2020 2069  (exif).        i
+000033d0: 6620 666f 6361 6c4c 656e 6774 6858 5920  f focalLengthXY 
+000033e0: 213d 205b 2d31 2c2d 315d 3a0a 2020 2020  != [-1,-1]:.    
+000033f0: 2020 2020 2020 2020 7265 7475 726e 205b          return [
+00003400: 652a 636f 7272 6563 7469 6f6e 466b 7420  e*correctionFkt 
+00003410: 666f 7220 6520 696e 2066 6f63 616c 4c65  for e in focalLe
+00003420: 6e67 7468 5859 5d2c 2027 4465 7269 7665  ngthXY], 'Derive
+00003430: 6420 6672 6f6d 2065 7869 6620 7461 6720  d from exif tag 
+00003440: 466f 6361 6c20 4c65 6e67 7468 2077 6974  Focal Length wit
+00003450: 6820 3335 206d 6d20 6571 7569 7661 6c65  h 35 mm equivale
+00003460: 6e74 270a 200a 2020 2020 2020 2020 7265  nt'. .        re
+00003470: 7475 726e 205b 2d31 2c2d 315d 2c20 2243  turn [-1,-1], "C
+00003480: 6f75 6c64 206e 6f74 2064 6574 6572 6d69  ould not determi
+00003490: 6e65 2066 726f 6d20 666f 6361 6c20 6c65  ne from focal le
+000034a0: 6e67 7468 2069 6e20 7069 7865 6c73 2066  ngth in pixels f
+000034b0: 726f 6d20 6e65 6974 6865 7220 2769 6d61  rom neither 'ima
+000034c0: 6765 2d63 616d 6572 612d 6361 6c69 6272  ge-camera-calibr
+000034d0: 6174 696f 6e2d 6d6f 6465 6c27 5b27 6361  ation-model'['ca
+000034e0: 6c69 6272 6174 696f 6e2d 666f 6361 6c2d  libration-focal-
+000034f0: 6c65 6e67 7468 2d78 792d 7069 7865 6c27  length-xy-pixel'
+00003500: 5d20 6e6f 7220 6578 6966 2074 6167 7320  ] nor exif tags 
+00003510: 466f 6361 6c20 4c65 6e67 7468 2c20 466f  Focal Length, Fo
+00003520: 6361 6c20 506c 616e 6520 5820 5265 736f  cal Plane X Reso
+00003530: 6c75 7469 6f6e 2c20 466f 6361 6c20 506c  lution, Focal Pl
+00003540: 616e 6520 5920 5265 736f 6c75 7469 6f6e  ane Y Resolution
+00003550: 2c20 466f 6361 6c20 506c 616e 6520 5265  , Focal Plane Re
+00003560: 736f 6c75 7469 6f6e 2055 6e69 7422 0a0a  solution Unit"..
+00003570: 0a20 2020 2064 6566 205f 5f74 7279 4465  .    def __tryDe
+00003580: 7465 726d 696e 6546 6f63 616c 4c65 6e67  termineFocalLeng
+00003590: 6874 496e 5069 7865 6c73 4672 6f6d 4578  htInPixelsFromEx
+000035a0: 6966 5f31 2873 656c 662c 6578 6966 4469  if_1(self,exifDi
+000035b0: 6374 3a64 6963 7429 3a0a 2020 2020 2020  ct:dict):.      
+000035c0: 2020 2222 2220 7472 7920 746f 2064 6574    """ try to det
+000035d0: 6572 6d69 6e65 2066 6f63 616c 206c 656e  ermine focal len
+000035e0: 6774 6820 696e 2070 6978 656c 7320 6672  gth in pixels fr
+000035f0: 6f6d 2065 7869 6620 7461 6773 2046 6f63  om exif tags Foc
+00003600: 616c 204c 656e 6774 682c 2046 6f63 616c  al Length, Focal
+00003610: 2050 6c61 6e65 2058 2052 6573 6f6c 7574   Plane X Resolut
+00003620: 696f 6e2c 2046 6f63 616c 2050 6c61 6e65  ion, Focal Plane
+00003630: 2059 2052 6573 6f6c 7574 696f 6e2c 2046   Y Resolution, F
+00003640: 6f63 616c 2050 6c61 6e65 2052 6573 6f6c  ocal Plane Resol
+00003650: 7574 696f 6e20 556e 6974 2e0a 2020 2020  ution Unit..    
+00003660: 2020 2020 2020 2020 5265 7472 756e 7320          Retruns 
+00003670: 5b66 6f63 616c 4c65 6e67 7468 5069 7865  [focalLengthPixe
+00003680: 6c73 5f78 2c66 6f63 616c 4c65 6e67 7468  ls_x,focalLength
+00003690: 5069 7865 6c73 5f79 5d2c 206d 6573 7361  Pixels_y], messa
+000036a0: 6765 0a20 2020 2020 2020 2020 2020 2052  ge.            R
+000036b0: 6574 7275 6e73 2066 6f63 616c 4c65 6e67  etruns focalLeng
+000036c0: 7468 5069 7865 6c73 203d 202d 3120 6966  thPixels = -1 if
+000036d0: 206e 6f74 2073 7563 6365 7373 6675 6c6c   not successfull
+000036e0: 2022 2222 0a0a 2020 2020 2020 2020 7472   """..        tr
+000036f0: 793a 0a20 2020 2020 2020 2020 2020 2066  y:.            f
+00003700: 6f63 616c 4c65 6e67 7468 203d 2073 7472  ocalLength = str
+00003710: 2865 7869 6644 6963 745b 2746 6f63 616c  (exifDict['Focal
+00003720: 204c 656e 6774 6827 5d29 0a20 2020 2020   Length']).     
+00003730: 2020 2020 2020 2066 6f63 616c 506c 616e         focalPlan
+00003740: 6552 6573 5f78 203d 2066 6c6f 6174 2873  eRes_x = float(s
+00003750: 7472 2865 7869 6644 6963 745b 2746 6f63  tr(exifDict['Foc
+00003760: 616c 2050 6c61 6e65 2058 2052 6573 6f6c  al Plane X Resol
+00003770: 7574 696f 6e27 5d29 2e73 7472 6970 2827  ution']).strip('
+00003780: 5c27 2729 290a 2020 2020 2020 2020 2020  \'')).          
+00003790: 2020 666f 6361 6c50 6c61 6e65 5265 735f    focalPlaneRes_
+000037a0: 7920 3d20 666c 6f61 7428 7374 7228 6578  y = float(str(ex
+000037b0: 6966 4469 6374 5b27 466f 6361 6c20 506c  ifDict['Focal Pl
+000037c0: 616e 6520 5920 5265 736f 6c75 7469 6f6e  ane Y Resolution
+000037d0: 275d 292e 7374 7269 7028 275c 2727 2929  ']).strip('\''))
+000037e0: 0a20 2020 2020 2020 2020 2020 2066 6f63  .            foc
+000037f0: 616c 506c 616e 6552 6573 5f75 6e69 7420  alPlaneRes_unit 
+00003800: 3d20 7374 7228 6578 6966 4469 6374 5b27  = str(exifDict['
+00003810: 466f 6361 6c20 506c 616e 6520 5265 736f  Focal Plane Reso
+00003820: 6c75 7469 6f6e 2055 6e69 7427 5d29 2e73  lution Unit']).s
+00003830: 7472 6970 2827 5c27 2729 0a20 2020 2020  trip('\'').     
+00003840: 2020 2065 7863 6570 7420 284b 6579 4572     except (KeyEr
+00003850: 726f 722c 2056 616c 7565 4572 726f 7229  ror, ValueError)
+00003860: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00003870: 7475 726e 205b 2d31 2c2d 315d 2c20 2243  turn [-1,-1], "C
+00003880: 6f75 6c64 206e 6f74 2066 696e 6420 616c  ould not find al
+00003890: 6c20 7265 7175 6972 6564 2066 6965 6c64  l required field
+000038a0: 7320 466f 6361 6c20 4c65 6e67 7468 2c20  s Focal Length, 
+000038b0: 466f 6361 6c20 506c 616e 6520 5820 5265  Focal Plane X Re
+000038c0: 736f 6c75 7469 6f6e 2c20 466f 6361 6c20  solution, Focal 
+000038d0: 506c 616e 6520 5920 5265 736f 6c75 7469  Plane Y Resoluti
+000038e0: 6f6e 2c20 466f 6361 6c20 506c 616e 6520  on, Focal Plane 
+000038f0: 5265 736f 6c75 7469 6f6e 2055 6e69 7422  Resolution Unit"
+00003900: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
+00003910: 2020 2320 7061 7273 6520 666f 6361 6c20    # parse focal 
+00003920: 6c65 6e67 7468 2066 726f 6d20 6c65 6674  length from left
+00003930: 2028 6d61 7920 6265 2027 372e 3520 6d6d   (may be '7.5 mm
+00003940: 2028 2e2e 2e29 2729 0a20 2020 2020 2020   (...)').       
+00003950: 2066 6f63 616c 4c65 6e67 7468 5374 7269   focalLengthStri
+00003960: 7070 6564 203d 2066 6f63 616c 4c65 6e67  pped = focalLeng
+00003970: 7468 2e73 7472 6970 2829 0a20 2020 2020  th.strip().     
+00003980: 2020 2066 6f63 616c 4c65 6e67 7468 466c     focalLengthFl
+00003990: 6f61 7420 3d20 4e6f 6e65 0a20 2020 2020  oat = None.     
+000039a0: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
+000039b0: 6528 6c65 6e28 666f 6361 6c4c 656e 6774  e(len(focalLengt
+000039c0: 6853 7472 6970 7065 6429 293a 0a20 2020  hStripped)):.   
+000039d0: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
+000039e0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+000039f0: 6361 6c4c 656e 6774 6846 6c6f 6174 203d  calLengthFloat =
+00003a00: 2066 6c6f 6174 2866 6f63 616c 4c65 6e67   float(focalLeng
+00003a10: 7468 5374 7269 7070 6564 5b30 3a69 2b31  thStripped[0:i+1
+00003a20: 5d29 0a20 2020 2020 2020 2020 2020 2065  ]).            e
+00003a30: 7863 6570 7420 5661 6c75 6545 7272 6f72  xcept ValueError
+00003a40: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00003a50: 2020 7061 7373 0a20 2020 2020 2020 2069    pass.        i
+00003a60: 6620 666f 6361 6c4c 656e 6774 6846 6c6f  f focalLengthFlo
+00003a70: 6174 2069 7320 4e6f 6e65 3a0a 2020 2020  at is None:.    
+00003a80: 2020 2020 2020 2020 7265 7475 726e 205b          return [
+00003a90: 2d31 2c2d 315d 2c20 2243 6f75 6c64 206e  -1,-1], "Could n
+00003aa0: 6f74 2070 6172 7365 2066 6f72 6361 6c20  ot parse forcal 
+00003ab0: 6c65 6e67 7468 2066 726f 6d20 2746 6f63  length from 'Foc
+00003ac0: 616c 204c 656e 6774 6827 3a20 2220 2b20  al Length': " + 
+00003ad0: 666f 6361 6c4c 656e 6774 680a 2020 2020  focalLength.    
+00003ae0: 2020 2020 7363 616c 6546 6b74 5f66 6f63      scaleFkt_foc
+00003af0: 616c 203d 2073 656c 662e 5f5f 756e 6974  al = self.__unit
+00003b00: 436f 6e76 6572 7369 6f6e 4661 6374 326d  ConversionFact2m
+00003b10: 6d28 666f 6361 6c4c 656e 6774 6829 0a20  m(focalLength). 
+00003b20: 2020 2020 2020 2069 6620 7363 616c 6546         if scaleF
+00003b30: 6b74 5f66 6f63 616c 203d 3d20 2d31 3a0a  kt_focal == -1:.
+00003b40: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00003b50: 726e 205b 2d31 2c2d 315d 2c20 2243 6f75  rn [-1,-1], "Cou
+00003b60: 6c64 206e 6f74 2070 6172 7365 2066 6f72  ld not parse for
+00003b70: 6361 6c20 6c65 6e67 7468 2075 6e69 7420  cal length unit 
+00003b80: 6672 6f6d 2027 466f 6361 6c20 4c65 6e67  from 'Focal Leng
+00003b90: 7468 273a 2022 202b 2066 6f63 616c 4c65  th': " + focalLe
+00003ba0: 6e67 7468 0a20 2020 2020 2020 2066 6f63  ngth.        foc
+00003bb0: 616c 4c65 6e67 7468 5f6d 6d20 3d20 666f  alLength_mm = fo
+00003bc0: 6361 6c4c 656e 6774 6846 6c6f 6174 202a  calLengthFloat *
+00003bd0: 2073 6361 6c65 466b 745f 666f 6361 6c0a   scaleFkt_focal.
+00003be0: 0a20 2020 2020 2020 2073 6361 6c65 466b  .        scaleFk
+00003bf0: 745f 7265 7320 3d20 7365 6c66 2e5f 5f75  t_res = self.__u
+00003c00: 6e69 7443 6f6e 7665 7273 696f 6e46 6163  nitConversionFac
+00003c10: 7432 6d6d 2866 6f63 616c 506c 616e 6552  t2mm(focalPlaneR
+00003c20: 6573 5f75 6e69 7429 0a20 2020 2020 2020  es_unit).       
+00003c30: 2069 6620 7363 616c 6546 6b74 5f72 6573   if scaleFkt_res
+00003c40: 203d 3d20 2d31 3a0a 2020 2020 2020 2020   == -1:.        
+00003c50: 2020 2020 7265 7475 726e 205b 2d31 2c2d      return [-1,-
+00003c60: 315d 2c20 2243 6f75 6c64 206e 6f74 2070  1], "Could not p
+00003c70: 6172 7365 2046 6f63 616c 2050 6c61 6e65  arse Focal Plane
+00003c80: 2052 6573 6f6c 7574 696f 6e20 556e 6974   Resolution Unit
+00003c90: 2066 726f 6d20 2746 6f63 616c 2050 6c61   from 'Focal Pla
+00003ca0: 6e65 2052 6573 6f6c 7574 696f 6e20 556e  ne Resolution Un
+00003cb0: 6974 273a 2022 202b 2066 6f63 616c 506c  it': " + focalPl
+00003cc0: 616e 6552 6573 5f75 6e69 740a 0a20 2020  aneRes_unit..   
+00003cd0: 2020 2020 2066 6f63 616c 4c65 6e67 7468       focalLength
+00003ce0: 5069 7865 6c73 5f78 203d 2066 6f63 616c  Pixels_x = focal
+00003cf0: 4c65 6e67 7468 5f6d 6d20 2a20 666f 6361  Length_mm * foca
+00003d00: 6c50 6c61 6e65 5265 735f 7820 2f20 7363  lPlaneRes_x / sc
+00003d10: 616c 6546 6b74 5f72 6573 0a20 2020 2020  aleFkt_res.     
+00003d20: 2020 2066 6f63 616c 4c65 6e67 7468 5069     focalLengthPi
+00003d30: 7865 6c73 5f79 203d 2066 6f63 616c 4c65  xels_y = focalLe
+00003d40: 6e67 7468 5f6d 6d20 2a20 666f 6361 6c50  ngth_mm * focalP
+00003d50: 6c61 6e65 5265 735f 7920 2f20 7363 616c  laneRes_y / scal
+00003d60: 6546 6b74 5f72 6573 0a0a 2020 2020 2020  eFkt_res..      
+00003d70: 2020 7265 7475 726e 205b 666f 6361 6c4c    return [focalL
+00003d80: 656e 6774 6850 6978 656c 735f 782c 666f  engthPixels_x,fo
+00003d90: 6361 6c4c 656e 6774 6850 6978 656c 735f  calLengthPixels_
+00003da0: 795d 2c20 2222 0a0a 0a20 2020 2064 6566  y], ""...    def
+00003db0: 205f 5f74 7279 4465 7465 726d 696e 6546   __tryDetermineF
+00003dc0: 6f63 616c 4c65 6e67 6874 496e 5069 7865  ocalLenghtInPixe
+00003dd0: 6c73 4672 6f6d 4578 6966 5f32 2873 656c  lsFromExif_2(sel
+00003de0: 662c 6578 6966 4469 6374 3a64 6963 7429  f,exifDict:dict)
+00003df0: 3a0a 2020 2020 2020 2020 2222 2220 7472  :.        """ tr
+00003e00: 7920 746f 2064 6574 6572 6d69 6e65 2066  y to determine f
+00003e10: 6f63 616c 206c 656e 6774 6820 696e 2070  ocal length in p
+00003e20: 6978 656c 7320 6672 6f6d 2033 3520 6d6d  ixels from 35 mm
+00003e30: 2065 7175 6976 616c 656e 7420 666f 6361   equivalent foca
+00003e40: 6c20 6c65 6e67 7468 2069 6e20 6578 6966  l length in exif
+00003e50: 2074 6167 2046 6f63 616c 204c 656e 6774   tag Focal Lengt
+00003e60: 6827 7320 6164 6420 6f6e 2065 2e67 2e20  h's add on e.g. 
+00003e70: 2737 2e30 206d 6d20 2833 3520 6d6d 2065  '7.0 mm (35 mm e
+00003e80: 7175 6976 616c 656e 743a 2033 382e 3820  quivalent: 38.8 
+00003e90: 6d6d 2927 2e0a 2020 2020 2020 2020 2020  mm)'..          
+00003ea0: 2020 5265 7472 756e 7320 5b66 6f63 616c    Retruns [focal
+00003eb0: 4c65 6e67 7468 5069 7865 6c73 5f78 2c66  LengthPixels_x,f
+00003ec0: 6f63 616c 4c65 6e67 7468 5069 7865 6c73  ocalLengthPixels
+00003ed0: 5f79 5d2c 206d 6573 7361 6765 0a20 2020  _y], message.   
+00003ee0: 2020 2020 2020 2020 2052 6574 7275 6e73           Retruns
+00003ef0: 2066 6f63 616c 4c65 6e67 7468 5069 7865   focalLengthPixe
+00003f00: 6c73 203d 202d 3120 6966 206e 6f74 2073  ls = -1 if not s
+00003f10: 7563 6365 7373 6675 6c6c 2022 2222 0a0a  uccessfull """..
+00003f20: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+00003f30: 2020 2020 2020 2020 2066 6f63 616c 4c65           focalLe
+00003f40: 6e67 7468 203d 2073 7472 2865 7869 6644  ngth = str(exifD
+00003f50: 6963 745b 2746 6f63 616c 204c 656e 6774  ict['Focal Lengt
+00003f60: 6827 5d29 0a20 2020 2020 2020 2020 2020  h']).           
+00003f70: 2069 6d61 6765 5769 6474 6820 3d20 696e   imageWidth = in
+00003f80: 7428 7374 7228 6578 6966 4469 6374 5b27  t(str(exifDict['
+00003f90: 496d 6167 6520 5769 6474 6827 5d29 2e73  Image Width']).s
+00003fa0: 7472 6970 2827 5c27 2729 290a 2020 2020  trip('\'')).    
+00003fb0: 2020 2020 6578 6365 7074 2028 4b65 7945      except (KeyE
+00003fc0: 7272 6f72 2c20 5661 6c75 6545 7272 6f72  rror, ValueError
+00003fd0: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
+00003fe0: 6574 7572 6e20 5b2d 312c 2d31 5d2c 2022  eturn [-1,-1], "
+00003ff0: 436f 756c 6420 6e6f 7420 6669 6e64 2061  Could not find a
+00004000: 6c6c 2072 6571 7569 7265 6420 6669 656c  ll required fiel
+00004010: 6473 2046 6f63 616c 204c 656e 6774 682c  ds Focal Length,
+00004020: 2049 6d61 6765 2057 6964 7468 220a 0a20   Image Width".. 
+00004030: 2020 2020 2020 2023 2074 7279 2070 6172         # try par
+00004040: 7365 2033 3520 6d6d 2065 7175 6976 616c  se 35 mm equival
+00004050: 656e 7420 6672 6f6d 2065 2e67 2e3a 2020  ent from e.g.:  
+00004060: 372e 3020 6d6d 2028 3335 206d 6d20 6571  7.0 mm (35 mm eq
+00004070: 7569 7661 6c65 6e74 3a20 3338 2e38 206d  uivalent: 38.8 m
+00004080: 6d29 0a20 2020 2020 2020 2063 6f6c 6f6e  m).        colon
+00004090: 496e 6465 7820 3d20 666f 6361 6c4c 656e  Index = focalLen
+000040a0: 6774 682e 6669 6e64 2827 3a27 290a 2020  gth.find(':').  
+000040b0: 2020 2020 2020 6966 2063 6f6c 6f6e 496e        if colonIn
+000040c0: 6465 7820 3d3d 202d 313a 0a20 2020 2020  dex == -1:.     
+000040d0: 2020 2020 2020 2072 6574 7572 6e20 5b2d         return [-
+000040e0: 312c 2d31 5d2c 2022 436f 756c 6420 6e6f  1,-1], "Could no
+000040f0: 7420 7061 7273 6520 3335 206d 6d20 6571  t parse 35 mm eq
+00004100: 7569 7661 6c65 6e74 2066 6f63 616c 206c  uivalent focal l
+00004110: 656e 6774 6820 6672 6f6d 2027 466f 6361  ength from 'Foca
+00004120: 6c20 4c65 6e67 7468 273a 2022 202b 2066  l Length': " + f
+00004130: 6f63 616c 4c65 6e67 7468 0a20 2020 2020  ocalLength.     
+00004140: 2020 2066 6f63 616c 4c65 6e67 7468 4571     focalLengthEq
+00004150: 3335 6d6d 466c 6f61 7420 3d20 4e6f 6e65  35mmFloat = None
+00004160: 0a20 2020 2020 2020 2065 7175 616c 3335  .        equal35
+00004170: 6d6d 5061 7274 203d 2066 6f63 616c 4c65  mmPart = focalLe
+00004180: 6e67 7468 5b63 6f6c 6f6e 496e 6465 782b  ngth[colonIndex+
+00004190: 313a 3a5d 2e73 7472 6970 2829 0a20 2020  1::].strip().   
+000041a0: 2020 2020 2066 6f72 2069 2069 6e20 7261       for i in ra
+000041b0: 6e67 6528 6c65 6e28 6571 7561 6c33 356d  nge(len(equal35m
+000041c0: 6d50 6172 7429 293a 0a20 2020 2020 2020  mPart)):.       
+000041d0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+000041e0: 2020 2020 2020 2020 2020 666f 6361 6c4c            focalL
+000041f0: 656e 6774 6845 7133 356d 6d46 6c6f 6174  engthEq35mmFloat
+00004200: 203d 2066 6c6f 6174 2865 7175 616c 3335   = float(equal35
+00004210: 6d6d 5061 7274 5b30 3a69 2b31 5d29 0a20  mmPart[0:i+1]). 
+00004220: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+00004230: 7420 5661 6c75 6545 7272 6f72 3a0a 2020  t ValueError:.  
+00004240: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+00004250: 7373 0a20 2020 2020 2020 2073 6361 6c65  ss.        scale
+00004260: 466b 7420 3d20 7365 6c66 2e5f 5f75 6e69  Fkt = self.__uni
+00004270: 7443 6f6e 7665 7273 696f 6e46 6163 7432  tConversionFact2
+00004280: 6d6d 2866 6f63 616c 4c65 6e67 7468 5b63  mm(focalLength[c
+00004290: 6f6c 6f6e 496e 6465 782b 313a 3a5d 290a  olonIndex+1::]).
+000042a0: 2020 2020 2020 2020 6966 2066 6f63 616c          if focal
+000042b0: 4c65 6e67 7468 4571 3335 6d6d 466c 6f61  LengthEq35mmFloa
+000042c0: 7420 6973 204e 6f6e 6520 6f72 2073 6361  t is None or sca
+000042d0: 6c65 466b 7420 3d3d 202d 313a 0a20 2020  leFkt == -1:.   
+000042e0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+000042f0: 5b2d 312c 2d31 5d2c 2022 436f 756c 6420  [-1,-1], "Could 
+00004300: 6e6f 7420 7061 7273 6520 3335 206d 6d20  not parse 35 mm 
+00004310: 6571 7569 7661 6c65 6e74 2066 6f63 616c  equivalent focal
+00004320: 206c 656e 6774 6820 6672 6f6d 2027 466f   length from 'Fo
+00004330: 6361 6c20 4c65 6e67 7468 273a 2022 202b  cal Length': " +
+00004340: 2066 6f63 616c 4c65 6e67 7468 0a20 2020   focalLength.   
+00004350: 2020 2020 200a 2020 2020 2020 2020 666f       .        fo
+00004360: 6361 6c4c 656e 6774 6850 6978 656c 7320  calLengthPixels 
+00004370: 3d20 666f 6361 6c4c 656e 6774 6845 7133  = focalLengthEq3
+00004380: 356d 6d46 6c6f 6174 202a 2073 6361 6c65  5mmFloat * scale
+00004390: 466b 7420 2a20 696d 6167 6557 6964 7468  Fkt * imageWidth
+000043a0: 202f 2033 362e 300a 2020 2020 2020 2020   / 36.0.        
+000043b0: 7265 7475 726e 205b 666f 6361 6c4c 656e  return [focalLen
+000043c0: 6774 6850 6978 656c 732c 666f 6361 6c4c  gthPixels,focalL
+000043d0: 656e 6774 6850 6978 656c 735d 2c20 2222  engthPixels], ""
+000043e0: 0a0a 0a20 2020 2064 6566 205f 5f75 6e69  ...    def __uni
+000043f0: 7443 6f6e 7665 7273 696f 6e46 6163 7432  tConversionFact2
+00004400: 6d6d 2873 656c 662c 756e 6974 3a73 7472  mm(self,unit:str
+00004410: 293a 0a20 2020 2020 2020 2022 2222 206c  ):.        """ l
+00004420: 6f6f 6b73 2066 6f72 206c 6574 7465 7220  ooks for letter 
+00004430: 7365 7175 656e 6365 2069 6e20 756e 6974  sequence in unit
+00004440: 2061 6e64 2063 6865 636b 7320 6966 2069   and checks if i
+00004450: 7427 7320 2769 6e63 6865 7327 2c27 6d27  t's 'inches','m'
+00004460: 2c27 636d 272c 276d 6d27 2c27 756d 2720  ,'cm','mm','um' 
+00004470: 6f72 2027 2720 616e 6420 7265 7475 726e  or '' and return
+00004480: 7320 7265 7370 6563 7469 7665 2063 6f6e  s respective con
+00004490: 7665 7273 696f 6e20 6661 6374 6f72 2074  version factor t
+000044a0: 6f20 6d6d 2028 6966 2074 6865 7265 2061  o mm (if there a
+000044b0: 7265 206e 6f20 6c65 7474 6572 7320 6974  re no letters it
+000044c0: 2072 6574 7572 6e73 2031 292e 204f 7468   returns 1). Oth
+000044d0: 6572 7769 7365 2072 6574 7572 6e20 2d31  erwise return -1
+000044e0: 2022 2222 0a0a 2020 2020 2020 2020 6669   """..        fi
+000044f0: 7273 744c 6574 7465 7253 6571 203d 2022  rstLetterSeq = "
+00004500: 220a 2020 2020 2020 2020 6669 7273 7446  ".        firstF
+00004510: 6f75 6e64 203d 2046 616c 7365 0a20 2020  ound = False.   
+00004520: 2020 2020 2066 6f72 2069 2069 6e20 7261       for i in ra
+00004530: 6e67 6528 6c65 6e28 756e 6974 2929 3a0a  nge(len(unit)):.
+00004540: 2020 2020 2020 2020 2020 2020 6966 2075              if u
+00004550: 6e69 745b 695d 2e69 7361 6c70 6861 2829  nit[i].isalpha()
+00004560: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00004570: 2020 6669 7273 7446 6f75 6e64 203d 2054    firstFound = T
+00004580: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
+00004590: 2020 2020 6669 7273 744c 6574 7465 7253      firstLetterS
+000045a0: 6571 202b 3d20 756e 6974 5b69 5d0a 2020  eq += unit[i].  
+000045b0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+000045c0: 2075 6e69 745b 695d 2e69 7361 6c70 6861   unit[i].isalpha
+000045d0: 2829 2061 6e64 2066 6972 7374 466f 756e  () and firstFoun
+000045e0: 6420 3d3d 2054 7275 653a 0a20 2020 2020  d == True:.     
+000045f0: 2020 2020 2020 2020 2020 2062 7265 616b             break
+00004600: 0a0a 2020 2020 2020 2020 6966 2066 6972  ..        if fir
+00004610: 7374 4c65 7474 6572 5365 712e 6c6f 7765  stLetterSeq.lowe
+00004620: 7228 2920 3d3d 2022 696e 6368 6573 223a  r() == "inches":
+00004630: 0a20 2020 2020 2020 2020 2020 2073 6361  .            sca
+00004640: 6c65 466b 7420 3d20 3235 2e34 0a20 2020  leFkt = 25.4.   
+00004650: 2020 2020 2065 6c69 6620 6669 7273 744c       elif firstL
+00004660: 6574 7465 7253 6571 2e6c 6f77 6572 2829  etterSeq.lower()
+00004670: 203d 3d20 226d 223a 0a20 2020 2020 2020   == "m":.       
+00004680: 2020 2020 2073 6361 6c65 466b 7420 3d20       scaleFkt = 
+00004690: 3130 3030 2e30 3b0a 2020 2020 2020 2020  1000.0;.        
+000046a0: 656c 6966 2066 6972 7374 4c65 7474 6572  elif firstLetter
+000046b0: 5365 712e 6c6f 7765 7228 2920 3d3d 2022  Seq.lower() == "
+000046c0: 636d 223a 0a20 2020 2020 2020 2020 2020  cm":.           
+000046d0: 2073 6361 6c65 466b 7420 3d20 3130 2e30   scaleFkt = 10.0
+000046e0: 3b0a 2020 2020 2020 2020 656c 6966 2066  ;.        elif f
+000046f0: 6972 7374 4c65 7474 6572 5365 712e 6c6f  irstLetterSeq.lo
+00004700: 7765 7228 2920 3d3d 2022 6d6d 223a 0a20  wer() == "mm":. 
+00004710: 2020 2020 2020 2020 2020 2073 6361 6c65             scale
+00004720: 466b 7420 3d20 312e 303b 0a20 2020 2020  Fkt = 1.0;.     
+00004730: 2020 2065 6c69 6620 6669 7273 744c 6574     elif firstLet
+00004740: 7465 7253 6571 2e6c 6f77 6572 2829 203d  terSeq.lower() =
+00004750: 3d20 2275 6d22 3a0a 2020 2020 2020 2020  = "um":.        
+00004760: 2020 2020 7363 616c 6546 6b74 203d 2031      scaleFkt = 1
+00004770: 2f31 3030 303b 0a20 2020 2020 2020 2065  /1000;.        e
+00004780: 6c69 6620 6669 7273 744c 6574 7465 7253  lif firstLetterS
+00004790: 6571 2e6c 6f77 6572 2829 203d 3d20 2222  eq.lower() == ""
+000047a0: 3a0a 2020 2020 2020 2020 2020 2020 7363  :.            sc
+000047b0: 616c 6546 6b74 203d 2031 3b0a 2020 2020  aleFkt = 1;.    
+000047c0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000047d0: 2020 2020 2020 7363 616c 6546 6b74 203d        scaleFkt =
+000047e0: 202d 310a 0a20 2020 2020 2020 2072 6574   -1..        ret
+000047f0: 7572 6e20 7363 616c 6546 6b74 0a0a 0a20  urn scaleFkt... 
+00004800: 2020 2064 6566 205f 5f67 6574 4974 656d     def __getItem
+00004810: 4465 6661 756c 7456 616c 7565 2873 656c  DefaultValue(sel
+00004820: 662c 6974 656d 3a73 7472 2c66 6965 6c64  f,item:str,field
+00004830: 4e61 6d65 3a73 7472 293a 0a20 2020 2020  Name:str):.     
+00004840: 2020 2022 2222 2072 6574 7572 6e73 2069     """ returns i
+00004850: 7465 6d20 7661 6c75 6573 2028 6669 7273  tem values (firs
+00004860: 7420 656e 7472 7920 696e 2063 6173 6520  t entry in case 
+00004870: 6f66 2076 6964 656f 7329 2e20 5468 726f  of videos). Thro
+00004880: 7773 206d 6172 6971 742e 636f 7265 2e49  ws mariqt.core.I
+00004890: 6664 6f45 7863 6570 7469 6f6e 2069 6620  fdoException if 
+000048a0: 6669 656c 6420 6e6f 7420 666f 756e 642e  field not found.
+000048b0: 2022 2222 0a0a 2020 2020 2020 2020 7265   """..        re
+000048c0: 7420 3d20 7365 6c66 5b22 3a22 2e6a 6f69  t = self[":".joi
+000048d0: 6e28 5b69 7465 6d2c 2730 272c 6669 656c  n([item,'0',fiel
+000048e0: 644e 616d 655d 295d 0a20 2020 2020 2020  dName])].       
+000048f0: 2069 6620 7265 7420 3d3d 2022 223a 0a20   if ret == "":. 
+00004900: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00004910: 6d69 7174 632e 4966 646f 4578 6365 7074  miqtc.IfdoExcept
+00004920: 696f 6e28 2245 7272 6f72 3a20 4669 656c  ion("Error: Fiel
+00004930: 6420 7b30 7d20 6e65 6974 6865 7220 666f  d {0} neither fo
+00004940: 756e 6420 696e 2069 7465 6d20 7b31 7d20  und in item {1} 
+00004950: 6e6f 7220 6865 6164 6572 222e 666f 726d  nor header".form
+00004960: 6174 2866 6965 6c64 4e61 6d65 2c69 7465  at(fieldName,ite
+00004970: 6d29 290a 2020 2020 2020 2020 7265 7475  m)).        retu
+00004980: 726e 2072 6574 0a0a 0a20 2020 2064 6566  rn ret...    def
+00004990: 205f 5f67 6574 4974 656d 4c61 744c 6f6e   __getItemLatLon
+000049a0: 2873 656c 662c 6974 656d 3a73 7472 2c68  (self,item:str,h
+000049b0: 6561 6465 7256 616c 4c61 742c 6865 6164  eaderValLat,head
+000049c0: 6572 5661 6c4c 6f6e 293a 0a20 2020 2020  erValLon):.     
+000049d0: 2020 2022 2222 2072 6574 7572 6e73 207b     """ returns {
+000049e0: 276c 6174 273a 2076 616c 7565 2c20 276c  'lat': value, 'l
+000049f0: 6f6e 273a 2076 616c 7565 2c20 2764 6174  on': value, 'dat
+00004a00: 6574 696d 6527 3a20 7661 6c75 657d 206f  etime': value} o
+00004a10: 6620 6c69 7374 206f 6620 7468 6f73 6520  f list of those 
+00004a20: 2222 220a 0a20 2020 2020 2020 2069 7465  """..        ite
+00004a30: 6d56 616c 203d 2073 656c 662e 6966 646f  mVal = self.ifdo
+00004a40: 5b6d 6971 7476 2e69 6d61 6765 5f73 6574  [miqtv.image_set
+00004a50: 5f69 7465 6d73 5f6b 6579 5d5b 6974 656d  _items_key][item
+00004a60: 5d0a 2020 2020 2020 2020 6966 206e 6f74  ].        if not
+00004a70: 2069 7369 6e73 7461 6e63 6528 6974 656d   isinstance(item
+00004a80: 5661 6c2c 6c69 7374 293a 0a20 2020 2020  Val,list):.     
+00004a90: 2020 2020 2020 2072 6574 203d 2073 656c         ret = sel
+00004aa0: 662e 5f5f 7061 7273 6532 4c61 744c 6f6e  f.__parse2LatLon
+00004ab0: 4469 6374 2869 7465 6d56 616c 2c68 6561  Dict(itemVal,hea
+00004ac0: 6465 7256 616c 4c61 742c 6865 6164 6572  derValLat,header
+00004ad0: 5661 6c4c 6f6e 290a 2020 2020 2020 2020  ValLon).        
+00004ae0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00004af0: 2020 7265 7420 3d20 5b5d 0a20 2020 2020    ret = [].     
+00004b00: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+00004b10: 2020 2020 2020 2020 2020 2020 6974 656d              item
+00004b20: 4c61 7444 6566 6175 6c74 203d 2069 7465  LatDefault = ite
+00004b30: 6d56 616c 5b30 5d5b 2769 6d61 6765 2d6c  mVal[0]['image-l
+00004b40: 6174 6974 7564 6527 5d0a 2020 2020 2020  atitude'].      
+00004b50: 2020 2020 2020 6578 6365 7074 204b 6579        except Key
+00004b60: 4572 726f 723a 0a20 2020 2020 2020 2020  Error:.         
+00004b70: 2020 2020 2020 2069 7465 6d4c 6174 4465         itemLatDe
+00004b80: 6661 756c 7420 3d20 6865 6164 6572 5661  fault = headerVa
+00004b90: 6c4c 6174 0a20 2020 2020 2020 2020 2020  lLat.           
+00004ba0: 2020 2020 2023 6966 2069 7465 6d4c 6174       #if itemLat
+00004bb0: 4465 6661 756c 7420 6973 204e 6f6e 653a  Default is None:
+00004bc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004bd0: 2023 2020 2020 7261 6973 6520 4578 6365   #    raise Exce
+00004be0: 7074 696f 6e28 2245 7272 6f72 3a20 4669  ption("Error: Fi
+00004bf0: 656c 6420 7b30 7d20 6e65 6974 6865 7220  eld {0} neither 
+00004c00: 666f 756e 6420 696e 2069 7465 6d20 7b31  found in item {1
+00004c10: 7d20 6e6f 7220 6865 6164 6572 222e 666f  } nor header".fo
+00004c20: 726d 6174 2827 696d 6167 652d 6c61 7469  rmat('image-lati
+00004c30: 7475 6465 272c 6974 656d 2929 0a0a 2020  tude',item))..  
+00004c40: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
+00004c50: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00004c60: 7465 6d4c 6f6e 4465 6661 756c 7420 3d20  temLonDefault = 
+00004c70: 6974 656d 5661 6c5b 305d 5b27 696d 6167  itemVal[0]['imag
+00004c80: 652d 6c6f 6e67 6974 7564 6527 5d0a 2020  e-longitude'].  
+00004c90: 2020 2020 2020 2020 2020 6578 6365 7074            except
+00004ca0: 204b 6579 4572 726f 723a 0a20 2020 2020   KeyError:.     
+00004cb0: 2020 2020 2020 2020 2020 2069 7465 6d4c             itemL
+00004cc0: 6f6e 4465 6661 756c 7420 3d20 6865 6164  onDefault = head
+00004cd0: 6572 5661 6c4c 6f6e 0a20 2020 2020 2020  erValLon.       
+00004ce0: 2020 2020 2020 2020 2023 6966 2069 7465           #if ite
+00004cf0: 6d4c 6f6e 4465 6661 756c 7420 6973 204e  mLonDefault is N
+00004d00: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00004d10: 2020 2020 2023 2020 2020 7261 6973 6520       #    raise 
+00004d20: 4578 6365 7074 696f 6e28 2245 7272 6f72  Exception("Error
+00004d30: 3a20 4669 656c 6420 7b30 7d20 6e65 6974  : Field {0} neit
+00004d40: 6865 7220 666f 756e 6420 696e 2069 7465  her found in ite
+00004d50: 6d20 7b31 7d20 6e6f 7220 6865 6164 6572  m {1} nor header
+00004d60: 222e 666f 726d 6174 2827 696d 6167 652d  ".format('image-
+00004d70: 6c61 7469 7475 6465 272c 6974 656d 2929  latitude',item))
+00004d80: 0a0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
+00004d90: 7220 7375 6245 6e74 7279 2069 6e20 6974  r subEntry in it
+00004da0: 656d 5661 6c3a 0a20 2020 2020 2020 2020  emVal:.         
+00004db0: 2020 2020 2020 2072 6574 2e61 7070 656e         ret.appen
+00004dc0: 6428 7365 6c66 2e5f 5f70 6172 7365 324c  d(self.__parse2L
+00004dd0: 6174 4c6f 6e44 6963 7428 7375 6245 6e74  atLonDict(subEnt
+00004de0: 7279 2c69 7465 6d4c 6174 4465 6661 756c  ry,itemLatDefaul
+00004df0: 742c 6974 656d 4c6f 6e44 6566 6175 6c74  t,itemLonDefault
+00004e00: 2929 0a0a 2020 2020 2020 2020 7265 7475  ))..        retu
+00004e10: 726e 2072 6574 0a20 2020 2020 2020 2020  rn ret.         
+00004e20: 2020 200a 0a20 2020 2064 6566 205f 5f70     ..    def __p
+00004e30: 6172 7365 324c 6174 4c6f 6e44 6963 7428  arse2LatLonDict(
+00004e40: 7365 6c66 2c69 7465 6d56 616c 2c68 6561  self,itemVal,hea
+00004e50: 6465 7256 616c 4c61 742c 6865 6164 6572  derValLat,header
+00004e60: 5661 6c4c 6f6e 293a 0a20 2020 2020 2020  ValLon):.       
+00004e70: 2022 2222 2072 6574 7572 6e73 207b 276c   """ returns {'l
+00004e80: 6174 273a 6c61 742c 276c 6f6e 273a 6c6f  at':lat,'lon':lo
+00004e90: 6e2c 2764 6174 6574 696d 6527 3a64 6174  n,'datetime':dat
+00004ea0: 6574 696d 657d 2022 2222 0a20 2020 2020  etime} """.     
+00004eb0: 2020 2064 6174 6574 696d 6520 3d20 6974     datetime = it
+00004ec0: 656d 5661 6c5b 2769 6d61 6765 2d64 6174  emVal['image-dat
+00004ed0: 6574 696d 6527 5d0a 2020 2020 2020 2020  etime'].        
+00004ee0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+00004ef0: 206c 6174 203d 2069 7465 6d56 616c 5b27   lat = itemVal['
+00004f00: 696d 6167 652d 6c61 7469 7475 6465 275d  image-latitude']
+00004f10: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+00004f20: 4b65 7945 7272 6f72 3a0a 2020 2020 2020  KeyError:.      
+00004f30: 2020 2020 2020 6c61 7420 3d20 6865 6164        lat = head
+00004f40: 6572 5661 6c4c 6174 0a20 2020 2020 2020  erValLat.       
+00004f50: 2020 2020 2069 6620 6c61 7420 6973 204e       if lat is N
+00004f60: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00004f70: 2020 2020 2072 6169 7365 2045 7863 6570       raise Excep
+00004f80: 7469 6f6e 2822 4572 726f 723a 2046 6965  tion("Error: Fie
+00004f90: 6c64 207b 307d 206e 6569 7468 6572 2066  ld {0} neither f
+00004fa0: 6f75 6e64 2069 6e20 6974 656d 207b 317d  ound in item {1}
+00004fb0: 206e 6f72 2068 6561 6465 7222 2e66 6f72   nor header".for
+00004fc0: 6d61 7428 2769 6d61 6765 2d6c 6174 6974  mat('image-latit
+00004fd0: 7564 6527 2c69 7465 6d56 616c 2929 0a20  ude',itemVal)). 
+00004fe0: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+00004ff0: 2020 2020 2020 2020 6c6f 6e20 3d20 6974          lon = it
+00005000: 656d 5661 6c5b 2769 6d61 6765 2d6c 6f6e  emVal['image-lon
+00005010: 6769 7475 6465 275d 0a20 2020 2020 2020  gitude'].       
+00005020: 2065 7863 6570 7420 4b65 7945 7272 6f72   except KeyError
+00005030: 3a0a 2020 2020 2020 2020 2020 2020 6c6f  :.            lo
+00005040: 6e20 3d20 6865 6164 6572 5661 6c4c 6f6e  n = headerValLon
+00005050: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00005060: 6c6f 6e20 6973 204e 6f6e 653a 0a20 2020  lon is None:.   
+00005070: 2020 2020 2020 2020 2020 2020 2072 6169               rai
+00005080: 7365 2045 7863 6570 7469 6f6e 2822 4572  se Exception("Er
+00005090: 726f 723a 2046 6965 6c64 207b 307d 206e  ror: Field {0} n
+000050a0: 6569 7468 6572 2066 6f75 6e64 2069 6e20  either found in 
+000050b0: 6974 656d 207b 317d 206e 6f72 2068 6561  item {1} nor hea
+000050c0: 6465 7222 2e66 6f72 6d61 7428 2769 6d61  der".format('ima
+000050d0: 6765 2d6c 6f6e 6769 7475 6465 272c 6974  ge-longitude',it
+000050e0: 656d 5661 6c29 290a 2020 2020 2020 2020  emVal)).        
+000050f0: 7265 7475 726e 207b 276c 6174 273a 6c61  return {'lat':la
+00005100: 742c 276c 6f6e 273a 6c6f 6e2c 2764 6174  t,'lon':lon,'dat
+00005110: 6574 696d 6527 3a64 6174 6574 696d 657d  etime':datetime}
+00005120: 0a0a 0a64 6566 2069 4644 4f46 726f 6d46  ...def iFDOFromF
+00005130: 696c 6528 6946 444f 6669 6c65 3a73 7472  ile(iFDOfile:str
+00005140: 2c68 616e 646c 655f 7072 6566 6978 3d27  ,handle_prefix='
+00005150: 3230 2e35 3030 2e31 3230 3835 272c 7072  20.500.12085',pr
+00005160: 6f76 656e 616e 6365 203d 204e 6f6e 652c  ovenance = None,
+00005170: 7665 7262 6f73 653d 5472 7565 2c69 676e  verbose=True,ign
+00005180: 6f72 655f 696d 6167 655f 6669 6c65 733d  ore_image_files=
+00005190: 4661 6c73 652c 7772 6974 6554 6d70 5072  False,writeTmpPr
+000051a0: 6f76 4669 6c65 3d54 7275 652c 696d 6167  ovFile=True,imag
+000051b0: 655f 6272 6f6b 6572 5f75 7569 643d 2265  e_broker_uuid="e
+000051c0: 6532 3737 3537 382d 6139 3131 2d34 3834  e277578-a911-484
+000051d0: 642d 6135 3135 2d39 6337 3831 6437 3961  d-a515-9c781d79a
+000051e0: 6139 3122 293a 0a20 2020 2022 2222 2043  a91"):.    """ C
+000051f0: 6f6e 7665 6e69 656e 6365 2066 756e 6374  onvenience funct
+00005200: 696f 6e20 746f 2063 7265 6174 6520 616e  ion to create an
+00005210: 2069 4644 4f20 6f62 6a65 6374 2064 6972   iFDO object dir
+00005220: 6563 746c 7920 666f 726d 2061 6e20 6578  ectly form an ex
+00005230: 6973 7469 6e67 2069 4644 4f20 6669 6c65  isting iFDO file
+00005240: 2e20 5472 6965 7320 746f 2069 6e66 6572  . Tries to infer
+00005250: 2069 6d61 6765 2066 696c 6573 206c 6f63   image files loc
+00005260: 6174 696f 6e20 6672 6f6d 2027 696d 6167  ation from 'imag
+00005270: 652d 6c6f 6361 6c2d 7061 7468 272e 2052  e-local-path'. R
+00005280: 6574 7572 6e73 2069 4644 4f20 6f62 6a65  eturns iFDO obje
+00005290: 6374 2e20 0a20 2020 2020 2020 202d 2069  ct. .        - i
+000052a0: 4644 4f66 696c 653a 2073 7472 696e 6720  FDOfile: string 
+000052b0: 7061 7468 2074 6f20 6c6f 6164 2061 6e20  path to load an 
+000052c0: 6578 706c 6963 6974 2069 4644 4f20 6669  explicit iFDO fi
+000052d0: 6c65 2e0a 2020 2020 2020 2020 2d20 6861  le..        - ha
+000052e0: 6e64 6c65 5f70 7265 6669 783a 2073 7472  ndle_prefix: str
+000052f0: 696e 6720 7072 6566 6978 206f 6620 7468  ing prefix of th
+00005300: 6520 6861 6e64 6c65 2073 6572 7665 722e  e handle server.
+00005310: 2044 6566 6175 6c74 3a20 7468 6520 6f6e   Default: the on
+00005320: 6520 666f 7220 4765 6f6d 6172 2e0a 2020  e for Geomar..  
+00005330: 2020 2020 2020 2d20 7072 6f76 656e 616e        - provenan
+00005340: 6365 3a20 6d61 7269 7174 2e70 726f 7665  ce: mariqt.prove
+00005350: 6e63 616e 6365 2e50 726f 7665 6e61 6e63  ncance.Provenanc
+00005360: 6520 6f62 6a65 6374 2074 6f20 7472 6163  e object to trac
+00005370: 6b20 6461 7461 2070 726f 7665 6e61 6e63  k data provenanc
+00005380: 652e 2044 6566 6175 6c74 3a20 6120 6e65  e. Default: a ne
+00005390: 7720 7072 6f76 656e 616e 6365 206f 626a  w provenance obj
+000053a0: 6563 7420 6973 2063 7265 6174 6564 2069  ect is created i
+000053b0: 6e20 7468 6520 2770 726f 746f 636f 6c27  n the 'protocol'
+000053c0: 2073 7562 666f 6c64 6572 2e0a 2020 2020   subfolder..    
+000053d0: 2020 2020 2d20 7665 7262 6f73 653a 2062      - verbose: b
+000053e0: 6f6f 6c20 7768 6574 6865 7220 746f 2070  ool whether to p
+000053f0: 7269 6e74 206f 7574 2069 6e66 6f72 6d61  rint out informa
+00005400: 7469 6f6e 2e20 5072 6f63 6573 7369 6e67  tion. Processing
+00005410: 2069 7320 6661 7374 6572 2069 6620 7665   is faster if ve
+00005420: 7262 6f73 6520 6973 2046 616c 7365 2e20  rbose is False. 
+00005430: 4465 6661 756c 743a 2054 7275 652e 0a20  Default: True.. 
+00005440: 2020 2020 2020 202d 2069 676e 6f72 655f         - ignore_
+00005450: 696d 6167 655f 6669 6c65 733a 2062 6f6f  image_files: boo
+00005460: 6c20 7768 6574 6865 7220 6974 2773 2061  l whether it's a
+00005470: 6363 6570 7465 6420 7468 6174 2074 6865  ccepted that the
+00005480: 7265 2061 7265 206e 6f74 2069 6d61 6765  re are not image
+00005490: 7320 7965 7420 696e 2027 6469 7227 2e20  s yet in 'dir'. 
+000054a0: 4465 6661 756c 743a 2046 616c 7365 2e0a  Default: False..
+000054b0: 2020 2020 2020 2020 2d20 7772 6974 6554          - writeT
+000054c0: 6d70 5072 6f76 4669 6c65 3a20 626f 6f6c  mpProvFile: bool
+000054d0: 2077 6865 7468 6572 2074 6f20 7772 6974   whether to writ
+000054e0: 6520 6120 7465 6d70 6f72 6172 7920 7072  e a temporary pr
+000054f0: 6f76 656e 616e 6365 2066 696c 6520 6475  ovenance file du
+00005500: 7269 6e67 2074 6865 2069 4644 4f20 6372  ring the iFDO cr
+00005510: 6561 7469 6f6e 2070 726f 6365 7373 2077  eation process w
+00005520: 6869 6368 2077 696c 6c20 6265 2072 6570  hich will be rep
+00005530: 6c61 6365 6420 6279 2061 2066 696e 616c  laced by a final
+00005540: 206f 6e65 2069 6e20 7468 6520 656e 642e   one in the end.
+00005550: 2044 6566 6175 6c74 3a20 5472 7565 0a20   Default: True. 
+00005560: 2020 2020 2020 202d 2069 6d61 6765 5f62         - image_b
+00005570: 726f 6b65 725f 7575 6964 3a20 7575 6964  roker_uuid: uuid
+00005580: 206f 6620 696d 6167 6520 6272 6f6b 6572   of image broker
+00005590: 2074 6f20 6372 6561 7465 2069 6d61 6765   to create image
+000055a0: 2068 616e 646c 6573 2061 7320 6874 7470   handles as http
+000055b0: 733a 2f2f 6864 6c2e 6861 6e64 6c65 2e6e  s://hdl.handle.n
+000055c0: 6574 2f3c 6861 6e64 6c65 5f70 7265 6669  et/<handle_prefi
+000055d0: 783e 2f3c 696d 6167 655f 6272 6f6b 6572  x>/<image_broker
+000055e0: 5f75 7569 643e 403c 696d 6167 652d 7575  _uuid>@<image-uu
+000055f0: 6964 3e20 2222 220a 2020 2020 7265 6164  id> """.    read
+00005600: 6572 203d 2069 4644 4f5f 5265 6164 6572  er = iFDO_Reader
+00005610: 2869 4644 4f66 696c 6529 0a20 2020 2069  (iFDOfile).    i
+00005620: 6d61 6765 7344 6972 203d 206d 6971 7463  magesDir = miqtc
+00005630: 2e74 6f55 6e69 7850 6174 6828 6f73 2e70  .toUnixPath(os.p
+00005640: 6174 682e 6e6f 726d 7061 7468 286d 6971  ath.normpath(miq
+00005650: 7463 2e74 6f55 6e69 7850 6174 6828 7265  tc.toUnixPath(re
+00005660: 6164 6572 2e67 6574 496d 6167 6544 6972  ader.getImageDir
+00005670: 6563 746f 7279 2829 2929 290a 2020 2020  ectory()))).    
+00005680: 6261 7365 4469 7220 3d20 6d69 7174 632e  baseDir = miqtc.
+00005690: 746f 556e 6978 5061 7468 286f 732e 7061  toUnixPath(os.pa
+000056a0: 7468 2e63 6f6d 6d6f 6e70 6174 6828 5b69  th.commonpath([i
+000056b0: 4644 4f66 696c 652c 696d 6167 6573 4469  FDOfile,imagesDi
+000056c0: 725d 2929 0a20 2020 2069 6d61 6765 4461  r])).    imageDa
+000056d0: 7461 5479 7065 466f 6c64 6572 203d 205b  taTypeFolder = [
+000056e0: 6520 666f 7220 6520 696e 2069 6d61 6765  e for e in image
+000056f0: 7344 6972 2e72 6570 6c61 6365 2862 6173  sDir.replace(bas
+00005700: 6544 6972 2c22 2229 2e73 706c 6974 2822  eDir,"").split("
+00005710: 2f22 2920 6966 2065 2021 3d20 2222 5d5b  /") if e != ""][
+00005720: 305d 0a20 2020 2069 6620 696d 6167 6544  0].    if imageD
+00005730: 6174 6154 7970 6546 6f6c 6465 7220 6e6f  ataTypeFolder no
+00005740: 7420 696e 206d 6971 7464 2e44 6972 2e64  t in miqtd.Dir.d
+00005750: 742e 5f5f 6d65 6d62 6572 735f 5f3a 0a20  t.__members__:. 
+00005760: 2020 2020 2020 2072 6169 7365 206d 6971         raise miq
+00005770: 7463 2e49 6664 6f45 7863 6570 7469 6f6e  tc.IfdoException
+00005780: 2822 496d 6167 6573 2061 7265 206e 6f74  ("Images are not
+00005790: 206c 6f63 6174 6564 2069 6e20 6120 7661   located in a va
+000057a0: 6c69 6420 6461 7461 2074 7970 6520 6469  lid data type di
+000057b0: 7265 6374 6f72 7920 2872 6177 2c20 696e  rectory (raw, in
+000057c0: 7465 726d 6564 6961 7465 2c20 7072 6f63  termediate, proc
+000057d0: 6573 7365 642c 202e 2e2e 2920 696e 2074  essed, ...) in t
+000057e0: 6865 2073 616d 6520 7072 6f6a 6563 7420  he same project 
+000057f0: 6173 2069 4644 4f20 6669 6c65 2e22 290a  as iFDO file.").
+00005800: 2020 2020 696d 6167 6573 4461 7461 5479      imagesDataTy
+00005810: 7065 4469 7220 3d20 6f73 2e70 6174 682e  peDir = os.path.
+00005820: 6a6f 696e 2862 6173 6544 6972 2c69 6d61  join(baseDir,ima
+00005830: 6765 4461 7461 5479 7065 466f 6c64 6572  geDataTypeFolder
+00005840: 290a 2020 2020 6469 724f 626a 203d 206d  ).    dirObj = m
+00005850: 6971 7464 2e44 6972 2822 222c 696d 6167  iqtd.Dir("",imag
+00005860: 6573 4461 7461 5479 7065 4469 722c 2063  esDataTypeDir, c
+00005870: 7265 6174 653d 4661 6c73 652c 2077 6974  reate=False, wit
+00005880: 685f 6765 6172 3d46 616c 7365 290a 2020  h_gear=False).  
+00005890: 2020 7265 7475 726e 2069 4644 4f28 6469    return iFDO(di
+000058a0: 723d 6469 724f 626a 2c68 616e 646c 655f  r=dirObj,handle_
+000058b0: 7072 6566 6978 3d68 616e 646c 655f 7072  prefix=handle_pr
+000058c0: 6566 6978 2c70 726f 7665 6e61 6e63 653d  efix,provenance=
+000058d0: 7072 6f76 656e 616e 6365 2c76 6572 626f  provenance,verbo
+000058e0: 7365 3d76 6572 626f 7365 2c69 676e 6f72  se=verbose,ignor
+000058f0: 655f 696d 6167 655f 6669 6c65 733d 6967  e_image_files=ig
+00005900: 6e6f 7265 5f69 6d61 6765 5f66 696c 6573  nore_image_files
+00005910: 2c77 7269 7465 546d 7050 726f 7646 696c  ,writeTmpProvFil
+00005920: 653d 7772 6974 6554 6d70 5072 6f76 4669  e=writeTmpProvFi
+00005930: 6c65 2c69 4644 4f66 696c 653d 6946 444f  le,iFDOfile=iFDO
+00005940: 6669 6c65 2c69 6d61 6765 5f62 726f 6b65  file,image_broke
+00005950: 725f 7575 6964 3d69 6d61 6765 5f62 726f  r_uuid=image_bro
+00005960: 6b65 725f 7575 6964 290a 0a0a 636c 6173  ker_uuid)...clas
+00005970: 7320 6946 444f 3a0a 2020 2020 2220 436c  s iFDO:.    " Cl
+00005980: 6173 7320 666f 7220 6372 6561 7469 6e67  ass for creating
+00005990: 2061 6e64 2065 6469 7469 6e67 2069 4644   and editing iFD
+000059a0: 4f2e 7961 6d6c 2066 696c 6573 2022 0a0a  O.yaml files "..
+000059b0: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
+000059c0: 2873 656c 662c 2064 6972 3a6d 6971 7464  (self, dir:miqtd
+000059d0: 2e44 6972 2c20 6861 6e64 6c65 5f70 7265  .Dir, handle_pre
+000059e0: 6669 783d 2732 302e 3530 302e 3132 3038  fix='20.500.1208
+000059f0: 3527 2c70 726f 7665 6e61 6e63 6520 3d20  5',provenance = 
+00005a00: 4e6f 6e65 2c76 6572 626f 7365 3d54 7275  None,verbose=Tru
+00005a10: 652c 6967 6e6f 7265 5f69 6d61 6765 5f66  e,ignore_image_f
+00005a20: 696c 6573 3d46 616c 7365 2c77 7269 7465  iles=False,write
+00005a30: 546d 7050 726f 7646 696c 653d 5472 7565  TmpProvFile=True
+00005a40: 2c69 4644 4f66 696c 653d 4e6f 6e65 2c69  ,iFDOfile=None,i
+00005a50: 6d61 6765 5f62 726f 6b65 725f 7575 6964  mage_broker_uuid
+00005a60: 3d22 6565 3237 3735 3738 2d61 3931 312d  ="ee277578-a911-
+00005a70: 3438 3464 2d61 3531 352d 3963 3738 3164  484d-a515-9c781d
+00005a80: 3739 6161 3931 2229 3a0a 2020 2020 2020  79aa91"):.      
+00005a90: 2020 2222 2220 4372 6561 7465 7320 616e    """ Creates an
+00005aa0: 2069 464f 4420 6f62 6a65 6374 2e20 5265   iFOD object. Re
+00005ab0: 7175 6972 6573 2061 2076 616c 6964 2064  quires a valid d
+00005ac0: 6972 6563 746f 7279 2063 6f6e 7461 696e  irectory contain
+00005ad0: 696e 6720 696d 6167 6520 6461 7461 206f  ing image data o
+00005ae0: 722f 616e 6420 616e 6420 6946 444f 2066  r/and and iFDO f
+00005af0: 696c 6520 616e 6420 6120 6861 6e64 6c65  ile and a handle
+00005b00: 2070 7265 6669 7820 6966 2069 7427 7320   prefix if it's 
+00005b10: 6e6f 7420 7468 6520 4765 6f6d 6172 206f  not the Geomar o
+00005b20: 6e65 2e20 4c6f 6164 7320 6469 7265 6374  ne. Loads direct
+00005b30: 6f72 7927 7320 6946 444f 2066 696c 6520  ory's iFDO file 
+00005b40: 6966 2069 7420 6578 6973 7473 2061 6c72  if it exists alr
+00005b50: 6561 6479 2e0a 2020 2020 2020 2020 2020  eady..          
+00005b60: 2020 2d20 6469 723a 206d 6172 6971 742e    - dir: mariqt.
+00005b70: 6469 7265 6374 6f72 6965 732e 4469 7220  directories.Dir 
+00005b80: 6f62 6a65 6374 2070 6f69 6e74 696e 6720  object pointing 
+00005b90: 746f 2061 2076 616c 6964 2064 6174 6120  to a valid data 
+00005ba0: 7479 7065 2064 6972 6563 746f 7279 2028  type directory (
+00005bb0: 7261 772c 2069 6e74 6572 6d65 6469 6174  raw, intermediat
+00005bc0: 652c 2070 726f 6365 7373 6564 2c20 2e2e  e, processed, ..
+00005bd0: 2e29 2063 6f6e 7461 696e 696e 6720 7468  .) containing th
+00005be0: 6520 696d 6167 6520 6461 7461 2e0a 2020  e image data..  
+00005bf0: 2020 2020 2020 2020 2020 2d20 6861 6e64            - hand
+00005c00: 6c65 5f70 7265 6669 783a 2073 7472 696e  le_prefix: strin
+00005c10: 6720 7072 6566 6978 206f 6620 7468 6520  g prefix of the 
+00005c20: 6861 6e64 6c65 2073 6572 7665 722e 2044  handle server. D
+00005c30: 6566 6175 6c74 3a20 7468 6520 6f6e 6520  efault: the one 
+00005c40: 666f 7220 4765 6f6d 6172 2e0a 2020 2020  for Geomar..    
+00005c50: 2020 2020 2020 2020 2d20 7072 6f76 656e          - proven
+00005c60: 616e 6365 3a20 6d61 7269 7174 2e70 726f  ance: mariqt.pro
+00005c70: 7665 6e63 616e 6365 2e50 726f 7665 6e61  vencance.Provena
+00005c80: 6e63 6520 6f62 6a65 6374 2074 6f20 7472  nce object to tr
+00005c90: 6163 6b20 6461 7461 2070 726f 7665 6e61  ack data provena
+00005ca0: 6e63 652e 2044 6566 6175 6c74 3a20 6120  nce. Default: a 
+00005cb0: 6e65 7720 7072 6f76 656e 616e 6365 206f  new provenance o
+00005cc0: 626a 6563 7420 6973 2063 7265 6174 6564  bject is created
+00005cd0: 2069 6e20 7468 6520 2770 726f 746f 636f   in the 'protoco
+00005ce0: 6c27 2073 7562 666f 6c64 6572 2e0a 2020  l' subfolder..  
+00005cf0: 2020 2020 2020 2020 2020 2d20 7665 7262            - verb
+00005d00: 6f73 653a 2062 6f6f 6c20 7768 6574 6865  ose: bool whethe
+00005d10: 7220 746f 2070 7269 6e74 206f 7574 2069  r to print out i
+00005d20: 6e66 6f72 6d61 7469 6f6e 2e20 4465 6661  nformation. Defa
+00005d30: 756c 743a 2054 7275 652e 0a20 2020 2020  ult: True..     
+00005d40: 2020 2020 2020 202d 2069 676e 6f72 655f         - ignore_
+00005d50: 696d 6167 655f 6669 6c65 733a 2069 6d61  image_files: ima
+00005d60: 6765 7320 6669 6c65 7320 6172 6520 6967  ges files are ig
+00005d70: 6e6f 7265 642e 2054 6865 7920 6172 6520  nored. They are 
+00005d80: 6e6f 7420 7365 6172 6368 6564 2066 6f72  not searched for
+00005d90: 2069 6e20 2772 6177 2720 616e 6420 6974   in 'raw' and it
+00005da0: 656d 7320 7661 6c75 6573 2061 7265 206e  ems values are n
+00005db0: 6f74 2075 7064 6174 6564 206e 6f72 2063  ot updated nor c
+00005dc0: 6865 636b 6564 2e20 4465 6661 756c 7420  hecked. Default 
+00005dd0: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
+00005de0: 2020 2020 2d20 7772 6974 6554 6d70 5072      - writeTmpPr
+00005df0: 6f76 4669 6c65 3a20 626f 6f6c 2077 6865  ovFile: bool whe
+00005e00: 7468 6572 2074 6f20 7772 6974 6520 6120  ther to write a 
+00005e10: 7465 6d70 6f72 6172 7920 7072 6f76 656e  temporary proven
+00005e20: 616e 6365 2066 696c 6520 6475 7269 6e67  ance file during
+00005e30: 2074 6865 2069 4644 4f20 6372 6561 7469   the iFDO creati
+00005e40: 6f6e 2070 726f 6365 7373 2077 6869 6368  on process which
+00005e50: 2077 696c 6c20 6265 2072 6570 6c61 6365   will be replace
+00005e60: 6420 6279 2061 2066 696e 616c 206f 6e65  d by a final one
+00005e70: 2069 6e20 7468 6520 656e 642e 2044 6566   in the end. Def
+00005e80: 6175 6c74 3a20 5472 7565 0a20 2020 2020  ault: True.     
+00005e90: 2020 2020 2020 202d 2069 4644 4f66 696c         - iFDOfil
+00005ea0: 653a 2073 7472 696e 6720 7061 7468 2074  e: string path t
+00005eb0: 6f20 6c6f 6164 2061 6e20 6578 706c 6963  o load an explic
+00005ec0: 6974 2069 4644 4f20 6669 6c65 2e20 4966  it iFDO file. If
+00005ed0: 206e 6f74 2070 726f 7669 6465 6420 6120   not provided a 
+00005ee0: 6d61 7463 6869 6e67 2069 4644 4f20 6669  matching iFDO fi
+00005ef0: 6c65 2028 6966 2069 7420 616c 7265 6164  le (if it alread
+00005f00: 7920 6578 6973 7473 2920 7769 6c6c 2062  y exists) will b
+00005f10: 6520 6c6f 6164 6564 2066 726f 6d20 7468  e loaded from th
+00005f20: 6520 2770 726f 6475 6374 7327 2073 7562  e 'products' sub
+00005f30: 6469 7265 6374 6f72 792e 2044 6566 6175  directory. Defau
+00005f40: 6c74 3a20 4e6f 6e65 200a 2020 2020 2020  lt: None .      
+00005f50: 2020 2020 2020 2d20 696d 6167 655f 6272        - image_br
+00005f60: 6f6b 6572 5f75 7569 643a 2075 7569 6420  oker_uuid: uuid 
+00005f70: 6f66 2069 6d61 6765 2062 726f 6b65 7220  of image broker 
+00005f80: 746f 2063 7265 6174 6520 696d 6167 6520  to create image 
+00005f90: 6861 6e64 6c65 7320 6173 2068 7474 7073  handles as https
+00005fa0: 3a2f 2f68 646c 2e68 616e 646c 652e 6e65  ://hdl.handle.ne
+00005fb0: 742f 3c68 616e 646c 655f 7072 6566 6978  t/<handle_prefix
+00005fc0: 3e2f 3c69 6d61 6765 5f62 726f 6b65 725f  >/<image_broker_
+00005fd0: 7575 6964 3e40 3c69 6d61 6765 2d75 7569  uuid>@<image-uui
+00005fe0: 643e 2022 2222 0a0a 2020 2020 2020 2020  d> """..        
+00005ff0: 2320 6368 6563 6b20 7468 6174 2061 7420  # check that at 
+00006000: 6469 7220 6f72 2069 4644 4f66 696c 6520  dir or iFDOfile 
+00006010: 7072 6f76 6964 6564 0a20 2020 2020 2020  provided.       
+00006020: 2069 6620 6469 7220 6973 204e 6f6e 6520   if dir is None 
+00006030: 616e 6420 6946 444f 6669 6c65 2069 7320  and iFDOfile is 
+00006040: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00006050: 2020 7261 6973 6520 6d69 7174 632e 4966    raise miqtc.If
+00006060: 646f 4578 6365 7074 696f 6e28 224e 6569  doException("Nei
+00006070: 7468 6572 2064 6972 206e 6f72 2069 4644  ther dir nor iFD
+00006080: 4f66 696c 6520 7072 6f76 6964 6564 2066  Ofile provided f
+00006090: 6f72 2069 4644 4f2e 2229 0a0a 2020 2020  or iFDO.")..    
+000060a0: 2020 2020 7365 6c66 2e64 6972 203d 2064      self.dir = d
+000060b0: 6972 0a20 2020 2020 2020 2073 656c 662e  ir.        self.
+000060c0: 696d 6167 6573 4469 7220 3d20 6469 722e  imagesDir = dir.
+000060d0: 746f 7479 7065 2829 0a20 2020 2020 2020  totype().       
+000060e0: 2073 656c 662e 6469 722e 6372 6561 7465   self.dir.create
+000060f0: 5479 7065 466f 6c64 6572 2829 0a20 2020  TypeFolder().   
+00006100: 2020 2020 2073 656c 662e 6861 6e64 6c65       self.handle
+00006110: 5f70 7265 6669 7820 3d20 2268 7474 7073  _prefix = "https
+00006120: 3a2f 2f68 646c 2e68 616e 646c 652e 6e65  ://hdl.handle.ne
+00006130: 742f 2220 2b20 6861 6e64 6c65 5f70 7265  t/" + handle_pre
+00006140: 6669 780a 2020 2020 2020 2020 7365 6c66  fix.        self
+00006150: 2e69 6d61 6765 5f68 616e 646c 655f 7072  .image_handle_pr
+00006160: 6566 6978 203d 2073 656c 662e 6861 6e64  efix = self.hand
+00006170: 6c65 5f70 7265 6669 7820 2b20 222f 2220  le_prefix + "/" 
+00006180: 2b20 696d 6167 655f 6272 6f6b 6572 5f75  + image_broker_u
+00006190: 7569 640a 2020 2020 2020 2020 7365 6c66  uid.        self
+000061a0: 2e69 676e 6f72 655f 696d 6167 655f 6669  .ignore_image_fi
+000061b0: 6c65 7320 3d20 6967 6e6f 7265 5f69 6d61  les = ignore_ima
+000061c0: 6765 5f66 696c 6573 0a0a 2020 2020 2020  ge_files..      
+000061d0: 2020 7365 6c66 2e69 6d61 6765 5365 7448    self.imageSetH
+000061e0: 6561 6465 724b 6579 203d 206d 6971 7476  eaderKey = miqtv
+000061f0: 2e69 6d61 6765 5f73 6574 5f68 6561 6465  .image_set_heade
+00006200: 725f 6b65 790a 2020 2020 2020 2020 7365  r_key.        se
+00006210: 6c66 2e69 6d61 6765 5365 7449 7465 6d73  lf.imageSetItems
+00006220: 4b65 7920 3d20 6d69 7174 762e 696d 6167  Key = miqtv.imag
+00006230: 655f 7365 745f 6974 656d 735f 6b65 790a  e_set_items_key.
+00006240: 2020 2020 2020 2020 7365 6c66 2e69 6664          self.ifd
+00006250: 6f5f 746d 7020 3d20 7b73 656c 662e 696d  o_tmp = {self.im
+00006260: 6167 6553 6574 4865 6164 6572 4b65 793a  ageSetHeaderKey:
+00006270: 207b 7d2c 0a20 2020 2020 2020 2020 2020   {},.           
+00006280: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00006290: 6c66 2e69 6d61 6765 5365 7449 7465 6d73  lf.imageSetItems
+000062a0: 4b65 793a 207b 7d7d 0a20 2020 2020 2020  Key: {}}.       
+000062b0: 2073 656c 662e 6966 646f 5f70 6172 7365   self.ifdo_parse
+000062c0: 6420 3d20 4e6f 6e65 0a20 2020 2020 2020  d = None.       
+000062d0: 2073 656c 662e 6966 646f 5f63 6865 636b   self.ifdo_check
+000062e0: 6564 203d 2063 6f70 792e 6465 6570 636f  ed = copy.deepco
+000062f0: 7079 2873 656c 662e 6966 646f 5f74 6d70  py(self.ifdo_tmp
+00006300: 2920 2023 2074 6f20 6265 2073 6574 2062  )  # to be set b
+00006310: 7920 6372 6561 7465 6946 444f 2829 206f  y createiFDO() o
+00006320: 6e6c 7921 0a20 2020 2020 2020 2073 656c  nly!.        sel
+00006330: 662e 5f5f 616c 6c55 5549 4473 4368 6563  f.__allUUIDsChec
+00006340: 6b65 6420 3d20 4661 6c73 650a 2020 2020  ked = False.    
+00006350: 2020 2020 7365 6c66 2e70 726f 7620 3d20      self.prov = 
+00006360: 7072 6f76 656e 616e 6365 0a20 2020 2020  provenance.     
+00006370: 2020 2069 6620 7072 6f76 656e 616e 6365     if provenance
+00006380: 203d 3d20 4e6f 6e65 3a0a 2020 2020 2020   == None:.      
+00006390: 2020 2020 2020 746d 7046 696c 6550 6174        tmpFilePat
+000063a0: 6820 3d20 2222 0a20 2020 2020 2020 2020  h = "".         
+000063b0: 2020 2069 6620 7772 6974 6554 6d70 5072     if writeTmpPr
+000063c0: 6f76 4669 6c65 3a0a 2020 2020 2020 2020  ovFile:.        
+000063d0: 2020 2020 2020 2020 746d 7046 696c 6550          tmpFileP
+000063e0: 6174 6820 3d20 7365 6c66 2e64 6972 2e74  ath = self.dir.t
+000063f0: 6f28 7365 6c66 2e64 6972 2e64 742e 7072  o(self.dir.dt.pr
+00006400: 6f74 6f63 6f6c 290a 2020 2020 2020 2020  otocol).        
+00006410: 2020 2020 7365 6c66 2e70 726f 7620 3d20      self.prov = 
+00006420: 6d69 7174 702e 5072 6f76 656e 616e 6365  miqtp.Provenance
+00006430: 2822 6946 444f 222c 7665 7262 6f73 653d  ("iFDO",verbose=
+00006440: 7665 7262 6f73 652c 746d 7046 696c 6550  verbose,tmpFileP
+00006450: 6174 683d 746d 7046 696c 6550 6174 6829  ath=tmpFilePath)
+00006460: 0a0a 2020 2020 2020 2020 2320 7365 7420  ..        # set 
+00006470: 676c 6f62 616c 2076 6572 626f 7369 7479  global verbosity
+00006480: 0a20 2020 2020 2020 206d 6971 7476 2e73  .        miqtv.s
+00006490: 6574 476c 6f62 616c 5665 7262 6f73 6528  etGlobalVerbose(
+000064a0: 7665 7262 6f73 6529 0a0a 2020 2020 2020  verbose)..      
+000064b0: 2020 6966 206e 6f74 2064 6972 2e65 7869    if not dir.exi
+000064c0: 7374 7328 293a 0a20 2020 2020 2020 2020  sts():.         
+000064d0: 2020 2072 6169 7365 2045 7863 6570 7469     raise Excepti
+000064e0: 6f6e 2822 6469 7265 6374 726f 7922 2c20  on("directroy", 
+000064f0: 6469 722e 7374 7228 292c 2022 646f 6573  dir.str(), "does
+00006500: 206e 6f74 2065 7869 7374 2e22 290a 0a20   not exist.").. 
+00006510: 2020 2020 2020 2069 6620 6e6f 7420 6469         if not di
+00006520: 722e 7661 6c69 6444 6174 6144 6972 2829  r.validDataDir()
+00006530: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+00006540: 6973 6520 4578 6365 7074 696f 6e28 2264  ise Exception("d
+00006550: 6972 6563 7472 6f79 222c 2064 6972 2e73  irectroy", dir.s
+00006560: 7472 2829 2c20 226e 6f74 2076 616c 6964  tr(), "not valid
+00006570: 2e20 446f 6573 206e 6f74 2063 6f6d 706c  . Does not compl
+00006580: 7920 7769 7468 2073 7472 7563 7475 7265  y with structure
+00006590: 202f 6261 7365 2f70 726f 6a65 6374 2f5b   /base/project/[
+000065a0: 4765 6172 2f5d 6576 656e 742f 7365 6e73  Gear/]event/sens
+000065b0: 6f72 2f64 6174 615f 7479 7065 2f22 290a  or/data_type/").
+000065c0: 0a20 2020 2020 2020 2023 2063 6865 636b  .        # check
+000065d0: 2069 4644 4f20 6669 6c65 0a20 2020 2020   iFDO file.     
+000065e0: 2020 2073 656c 662e 6946 444f 6669 6c65     self.iFDOfile
+000065f0: 5f20 3d20 2222 2023 2069 7320 7365 7420  _ = "" # is set 
+00006600: 6279 2073 6574 6946 444f 4669 6c65 4e61  by setiFDOFileNa
+00006610: 6d65 2829 0a20 2020 2020 2020 206c 6f61  me().        loa
+00006620: 6465 6469 4644 4f20 3d20 4661 6c73 650a  dediFDO = False.
+00006630: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
+00006640: 4644 4f66 696c 6520 6973 204e 6f6e 653a  FDOfile is None:
+00006650: 0a20 2020 2020 2020 2020 2020 2069 4644  .            iFD
+00006660: 4f66 696c 655f 203d 2069 4644 4f66 696c  Ofile_ = iFDOfil
+00006670: 650a 2020 2020 2020 2020 2020 2020 7365  e.            se
+00006680: 6c66 2e73 6574 6946 444f 4669 6c65 4e61  lf.setiFDOFileNa
+00006690: 6d65 2869 4644 4f66 696c 655f 290a 2020  me(iFDOfile_).  
+000066a0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+000066b0: 206f 732e 7061 7468 2e69 7366 696c 6528   os.path.isfile(
+000066c0: 6946 444f 6669 6c65 5f29 3a0a 2020 2020  iFDOfile_):.    
+000066d0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+000066e0: 6520 6d69 7174 632e 4966 646f 4578 6365  e miqtc.IfdoExce
+000066f0: 7074 696f 6e28 2269 4644 4f20 6669 6c65  ption("iFDO file
+00006700: 206e 6f74 2066 6f75 6e64 3a20 2220 2b20   not found: " + 
+00006710: 6946 444f 6669 6c65 5f29 0a20 2020 2020  iFDOfile_).     
+00006720: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00006730: 2020 2020 2069 4644 4f66 696c 655f 203d       iFDOfile_ =
+00006740: 2073 656c 662e 6469 722e 746f 2873 656c   self.dir.to(sel
+00006750: 662e 6469 722e 6474 2e70 726f 6475 6374  f.dir.dt.product
+00006760: 7329 2b73 656c 662e 636f 6e73 7472 7563  s)+self.construc
+00006770: 7469 4644 4f66 696c 654e 616d 6528 7365  tiFDOfileName(se
+00006780: 6c66 2e64 6972 2e70 726f 6a65 6374 2829  lf.dir.project()
+00006790: 2c73 656c 662e 6469 722e 6576 656e 7428  ,self.dir.event(
+000067a0: 292c 7365 6c66 2e64 6972 2e73 656e 736f  ),self.dir.senso
+000067b0: 7228 2929 0a0a 2020 2020 2020 2020 0a20  r())..        . 
+000067c0: 2020 2020 2020 2073 656c 662e 5f69 6d61         self._ima
+000067d0: 6765 7349 6e49 6d61 6765 7344 6972 203d  gesInImagesDir =
+000067e0: 205b 5d0a 2020 2020 2020 2020 6966 2073   [].        if s
+000067f0: 656c 662e 6967 6e6f 7265 5f69 6d61 6765  elf.ignore_image
+00006800: 5f66 696c 6573 3a0a 2020 2020 2020 2020  _files:.        
+00006810: 2020 2020 7072 696e 7428 2243 6175 7469      print("Cauti
+00006820: 6f6e 2120 7275 6e6e 696e 6720 696e 2069  on! running in i
+00006830: 676e 6f72 655f 696d 6167 655f 6669 6c65  gnore_image_file
+00006840: 7320 6d6f 6465 2e22 290a 2020 2020 2020  s mode.").      
+00006850: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00006860: 2020 2020 7365 6c66 2e5f 696d 6167 6573      self._images
+00006870: 496e 496d 6167 6573 4469 7220 3d20 6d69  InImagesDir = mi
+00006880: 7174 692e 6272 6f77 7365 466f 7249 6d61  qti.browseForIma
+00006890: 6765 4669 6c65 7328 7365 6c66 2e69 6d61  geFiles(self.ima
+000068a0: 6765 7344 6972 290a 2020 2020 2020 2020  gesDir).        
+000068b0: 7365 6c66 2e5f 696d 6167 6573 496e 496d  self._imagesInIm
+000068c0: 6167 6573 4469 7253 6f72 7465 644c 6973  agesDirSortedLis
+000068d0: 7420 3d20 5b66 696c 6520 666f 7220 6669  t = [file for fi
+000068e0: 6c65 2069 6e20 7365 6c66 2e5f 696d 6167  le in self._imag
+000068f0: 6573 496e 496d 6167 6573 4469 725d 0a20  esInImagesDir]. 
+00006900: 2020 2020 2020 2073 656c 662e 5f69 6d61         self._ima
+00006910: 6765 7349 6e49 6d61 6765 7344 6972 536f  gesInImagesDirSo
+00006920: 7274 6564 4c69 7374 2e73 6f72 7428 290a  rtedList.sort().
+00006930: 2020 2020 2020 2020 7365 6c66 2e5f 696d          self._im
+00006940: 6167 654e 616d 6573 496d 6167 6573 4469  ageNamesImagesDi
+00006950: 7220 3d20 5b6f 732e 7061 7468 2e62 6173  r = [os.path.bas
+00006960: 656e 616d 6528 6669 6c65 2920 666f 7220  ename(file) for 
+00006970: 6669 6c65 2069 6e20 7365 6c66 2e5f 696d  file in self._im
+00006980: 6167 6573 496e 496d 6167 6573 4469 725d  agesInImagesDir]
+00006990: 0a0a 2020 2020 2020 2020 6966 206c 656e  ..        if len
+000069a0: 2873 656c 662e 5f69 6d61 6765 7349 6e49  (self._imagesInI
+000069b0: 6d61 6765 7344 6972 2920 3d3d 2030 2061  magesDir) == 0 a
+000069c0: 6e64 206e 6f74 2069 676e 6f72 655f 696d  nd not ignore_im
+000069d0: 6167 655f 6669 6c65 733a 0a20 2020 2020  age_files:.     
+000069e0: 2020 2020 2020 2072 6169 7365 2045 7863         raise Exc
+000069f0: 6570 7469 6f6e 2822 4e6f 2069 6d61 6765  eption("No image
+00006a00: 7320 6669 6c65 7320 666f 756e 6420 696e  s files found in
+00006a10: 2022 202b 2073 656c 662e 696d 6167 6573   " + self.images
+00006a20: 4469 7220 2b20 2220 616e 6420 6974 7320  Dir + " and its 
+00006a30: 7375 6264 6972 6563 746f 7269 6573 2229  subdirectories")
+00006a40: 0a0a 2020 2020 2020 2020 756e 6971 7565  ..        unique
+00006a50: 2c20 6475 7020 3d20 6d69 7174 742e 6669  , dup = miqtt.fi
+00006a60: 6c65 7348 6176 6555 6e69 7175 654e 616d  lesHaveUniqueNam
+00006a70: 6528 7365 6c66 2e5f 696d 6167 6573 496e  e(self._imagesIn
+00006a80: 496d 6167 6573 4469 7229 0a20 2020 2020  ImagesDir).     
+00006a90: 2020 2069 6620 6e6f 7420 756e 6971 7565     if not unique
+00006aa0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+00006ab0: 6973 6520 4578 6365 7074 696f 6e28 0a20  ise Exception(. 
+00006ac0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00006ad0: 4e6f 7420 616c 6c20 6669 6c65 7320 6861  Not all files ha
+00006ae0: 7665 2075 6e69 7175 6520 6e61 6d65 732e  ve unique names.
+00006af0: 2044 7570 6c69 6361 7465 733a 2022 202b   Duplicates: " +
+00006b00: 2073 7472 2864 7570 2929 0a0a 2020 2020   str(dup))..    
+00006b10: 2020 2020 616c 6c76 616c 6964 2c20 6d73      allvalid, ms
+00006b20: 6720 3d20 6d69 7174 742e 616c 6c49 6d61  g = miqtt.allIma
+00006b30: 6765 4e61 6d65 7356 616c 6964 2873 656c  geNamesValid(sel
+00006b40: 662e 5f69 6d61 6765 7349 6e49 6d61 6765  f._imagesInImage
+00006b50: 7344 6972 2920 0a20 2020 2020 2020 2069  sDir) .        i
+00006b60: 6620 6e6f 7420 616c 6c76 616c 6964 3a0a  f not allvalid:.
+00006b70: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00006b80: 6520 4578 6365 7074 696f 6e28 6d73 6729  e Exception(msg)
+00006b90: 0a0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
+00006ba0: 726f 762e 6c6f 6728 7374 7228 6c65 6e28  rov.log(str(len(
+00006bb0: 7365 6c66 2e5f 696d 6167 6573 496e 496d  self._imagesInIm
+00006bc0: 6167 6573 4469 7229 2920 2b20 2220 696d  agesDir)) + " im
+00006bd0: 6167 6520 6669 6c65 7320 666f 756e 642e  age files found.
+00006be0: 2229 0a20 2020 2020 2020 2073 656c 662e  ").        self.
+00006bf0: 7072 6f76 2e6c 6f67 2822 2229 0a20 2020  prov.log("").   
+00006c00: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
+00006c10: 6f67 2822 466f 6c6c 6f77 696e 6720 696e  og("Following in
+00006c20: 666f 726d 6174 696f 6e20 7761 7320 7061  formation was pa
+00006c30: 7273 6564 2066 726f 6d20 6469 7265 6374  rsed from direct
+00006c40: 6f72 792c 2070 6c65 6173 6520 6368 6563  ory, please chec
+00006c50: 6b20 666f 7220 636f 7272 6563 746e 6573  k for correctnes
+00006c60: 733a 2229 0a20 2020 2020 2020 2073 656c  s:").        sel
+00006c70: 662e 7072 6f76 2e6c 6f67 2822 5072 6f6a  f.prov.log("Proj
+00006c80: 6563 743a 5c74 222b 7365 6c66 2e64 6972  ect:\t"+self.dir
+00006c90: 2e70 726f 6a65 6374 2829 290a 2020 2020  .project()).    
+00006ca0: 2020 2020 6966 2073 656c 662e 6469 722e      if self.dir.
+00006cb0: 7769 7468 5f67 6561 723a 0a20 2020 2020  with_gear:.     
+00006cc0: 2020 2020 2020 2073 656c 662e 7072 6f76         self.prov
+00006cd0: 2e6c 6f67 2822 4765 6172 3a5c 745c 7422  .log("Gear:\t\t"
+00006ce0: 2b73 656c 662e 6469 722e 6765 6172 2829  +self.dir.gear()
+00006cf0: 290a 2020 2020 2020 2020 7365 6c66 2e70  ).        self.p
+00006d00: 726f 762e 6c6f 6728 2245 7665 6e74 3a5c  rov.log("Event:\
+00006d10: 745c 7422 2b73 656c 662e 6469 722e 6576  t\t"+self.dir.ev
+00006d20: 656e 7428 2929 0a20 2020 2020 2020 2073  ent()).        s
+00006d30: 656c 662e 7072 6f76 2e6c 6f67 2822 5365  elf.prov.log("Se
+00006d40: 6e73 6f72 3a5c 745c 7422 2b73 656c 662e  nsor:\t\t"+self.
+00006d50: 6469 722e 7365 6e73 6f72 2829 290a 2020  dir.sensor()).  
+00006d60: 2020 2020 2020 7365 6c66 2e70 726f 762e        self.prov.
+00006d70: 6c6f 6728 2222 290a 0a20 2020 2020 2020  log("")..       
+00006d80: 2023 2069 6e74 6572 6d65 6469 6174 6520   # intermediate 
+00006d90: 6669 6c65 730a 2020 2020 2020 2020 7365  files.        se
+00006da0: 6c66 2e5f 5f69 6e69 7449 6e74 6572 6d65  lf.__initInterme
+00006db0: 6469 6174 6546 696c 6573 2829 2020 2020  diateFiles()    
+00006dc0: 0a0a 2020 2020 2020 2020 2320 7472 7920  ..        # try 
+00006dd0: 6c6f 6164 2065 7869 7374 696e 6720 6946  load existing iF
+00006de0: 444f 2066 696c 650a 2020 2020 2020 2020  DO file.        
+00006df0: 6966 2873 656c 662e 7265 6164 6946 444f  if(self.readiFDO
+00006e00: 6669 6c65 2869 4644 4f66 696c 655f 2929  file(iFDOfile_))
+00006e10: 3a0a 2020 2020 2020 2020 2020 2020 6c6f  :.            lo
+00006e20: 6164 6564 6946 444f 203d 2054 7275 650a  adediFDO = True.
+00006e30: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00006e40: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
+00006e50: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00006e60: 6174 6820 3d20 7365 6c66 2e64 6972 2e74  ath = self.dir.t
+00006e70: 6f28 7365 6c66 2e64 6972 2e64 742e 7072  o(self.dir.dt.pr
+00006e80: 6f64 7563 7473 290a 2020 2020 2020 2020  oducts).        
+00006e90: 2020 2020 2020 2020 666f 7220 6669 6c65          for file
+00006ea0: 5f20 696e 206f 732e 6c69 7374 6469 7228  _ in os.listdir(
+00006eb0: 7061 7468 293a 0a20 2020 2020 2020 2020  path):.         
+00006ec0: 2020 2020 2020 2020 2020 2069 6620 6669             if fi
+00006ed0: 6c65 5f5b 2d31 303a 2d34 5d20 3d3d 2022  le_[-10:-4] == "
+00006ee0: 5f69 4644 4f2e 2220 616e 6420 7365 6c66  _iFDO." and self
+00006ef0: 2e72 6561 6469 4644 4f66 696c 6528 7061  .readiFDOfile(pa
+00006f00: 7468 2b66 696c 655f 293a 0a20 2020 2020  th+file_):.     
+00006f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006f20: 2020 206c 6f61 6465 6469 4644 4f20 3d20     loadediFDO = 
+00006f30: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
+00006f40: 2020 2020 2020 2020 2020 2020 2069 4644               iFD
+00006f50: 4f66 696c 655f 203d 2070 6174 682b 6669  Ofile_ = path+fi
+00006f60: 6c65 5f0a 2020 2020 2020 2020 2020 2020  le_.            
+00006f70: 2020 2020 2020 2020 2020 2020 6272 6561              brea
+00006f80: 6b0a 2020 2020 2020 2020 2020 2020 6578  k.            ex
+00006f90: 6365 7074 2046 696c 654e 6f74 466f 756e  cept FileNotFoun
+00006fa0: 6445 7272 6f72 3a0a 2020 2020 2020 2020  dError:.        
+00006fb0: 2020 2020 2020 2020 7061 7373 2020 2020          pass    
+00006fc0: 2020 2020 0a0a 2020 2020 2020 2020 7365      ..        se
+00006fd0: 6c66 2e74 7279 4175 746f 5365 7448 6561  lf.tryAutoSetHea
+00006fe0: 6465 7246 6965 6c64 7328 290a 2020 2020  derFields().    
+00006ff0: 2020 2020 7365 6c66 2e73 6574 4865 6164      self.setHead
+00007000: 6572 496d 6167 654c 6f63 616c 5061 7468  erImageLocalPath
+00007010: 4669 656c 6428 290a 2020 2020 2020 2020  Field().        
+00007020: 6966 206c 6f61 6465 6469 4644 4f3a 0a20  if loadediFDO:. 
+00007030: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00007040: 7365 7469 4644 4f46 696c 654e 616d 6528  setiFDOFileName(
+00007050: 6946 444f 6669 6c65 5f29 0a0a 0a20 2020  iFDOfile_)...   
+00007060: 2064 6566 2072 6561 6469 4644 4f66 696c   def readiFDOfil
+00007070: 6528 7365 6c66 2c66 696c 653a 7374 7229  e(self,file:str)
+00007080: 3a0a 2020 2020 2020 2020 2222 2220 7265  :.        """ re
+00007090: 6164 7320 6946 444f 2066 696c 6520 2222  ads iFDO file ""
+000070a0: 220a 2020 2020 2020 2020 7472 795f 7961  ".        try_ya
+000070b0: 6d6c 203d 2046 616c 7365 0a0a 2020 2020  ml = False..    
+000070c0: 2020 2020 2320 6966 2066 696c 6520 6973      # if file is
+000070d0: 2079 616d 6c20 6669 6c65 206c 6f61 6420   yaml file load 
+000070e0: 6974 2061 7320 7375 6368 0a20 2020 2020  it as such.     
+000070f0: 2020 2069 6620 6669 6c65 2e73 706c 6974     if file.split
+00007100: 2827 2e27 295b 2d31 5d20 3d3d 2027 7961  ('.')[-1] == 'ya
+00007110: 6d6c 273a 0a20 2020 2020 2020 2020 2020  ml':.           
+00007120: 2074 7279 5f79 616d 6c20 3d20 5472 7565   try_yaml = True
+00007130: 0a20 2020 2020 2020 2020 2020 2066 696c  .            fil
+00007140: 655f 7961 6d6c 203d 2066 696c 650a 0a20  e_yaml = file.. 
+00007150: 2020 2020 2020 2069 6620 6e6f 7420 6f73         if not os
+00007160: 2e70 6174 682e 6973 6669 6c65 2866 696c  .path.isfile(fil
+00007170: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+00007180: 2320 6966 2066 696c 6520 646f 6573 206e  # if file does n
+00007190: 6f74 2065 7869 7374 2063 6865 636b 2069  ot exist check i
+000071a0: 6620 7961 6d6c 2076 6572 7369 6f6e 2065  f yaml version e
+000071b0: 7873 6973 7420 616e 6420 7472 7920 746f  xsist and try to
+000071c0: 206c 6f61 6420 7468 6174 206f 6e65 0a20   load that one. 
+000071d0: 2020 2020 2020 2020 2020 2066 696c 655f             file_
+000071e0: 7961 6d6c 203d 2066 696c 652e 7265 706c  yaml = file.repl
+000071f0: 6163 6528 272e 6a73 6f6e 272c 272e 7961  ace('.json','.ya
+00007200: 6d6c 2729 0a20 2020 2020 2020 2020 2020  ml').           
+00007210: 2069 6620 6f73 2e70 6174 682e 6973 6669   if os.path.isfi
+00007220: 6c65 2866 696c 655f 7961 6d6c 293a 0a20  le(file_yaml):. 
+00007230: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00007240: 7279 5f79 616d 6c20 3d20 5472 7565 0a20  ry_yaml = True. 
+00007250: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00007260: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007270: 2072 6574 7572 6e20 4661 6c73 650a 0a20   return False.. 
+00007280: 2020 2020 2020 2073 203d 206d 6971 7463         s = miqtc
+00007290: 2e50 7269 6e74 4c6f 6164 696e 674d 7367  .PrintLoadingMsg
+000072a0: 2822 4c6f 6164 696e 6720 6946 444f 2066  ("Loading iFDO f
+000072b0: 696c 6522 290a 2020 2020 2020 2020 7472  ile").        tr
+000072c0: 793a 0a20 2020 2020 2020 2020 2020 2023  y:.            #
+000072d0: 2074 7279 206c 6f61 6420 6a73 6f6e 2c20   try load json, 
+000072e0: 6f74 6865 7277 6973 6520 7472 7920 7961  otherwise try ya
+000072f0: 6d6c 0a20 2020 2020 2020 2020 2020 2069  ml.            i
+00007300: 6620 7472 795f 7961 6d6c 3a0a 2020 2020  f try_yaml:.    
+00007310: 2020 2020 2020 2020 2020 2020 6f20 3d20              o = 
+00007320: 6f70 656e 2866 696c 655f 7961 6d6c 2c20  open(file_yaml, 
+00007330: 2772 2729 0a20 2020 2020 2020 2020 2020  'r').           
+00007340: 2020 2020 2073 656c 662e 6966 646f 5f74       self.ifdo_t
+00007350: 6d70 203d 2079 616d 6c2e 6c6f 6164 286f  mp = yaml.load(o
+00007360: 2c20 204c 6f61 6465 723d 7961 6d6c 2e43  ,  Loader=yaml.C
+00007370: 4c6f 6164 6572 290a 2020 2020 2020 2020  Loader).        
+00007380: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00007390: 2020 2020 2020 2020 2020 6f20 3d20 6f70            o = op
+000073a0: 656e 2866 696c 652c 2027 7227 290a 2020  en(file, 'r').  
+000073b0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+000073c0: 6c66 2e69 6664 6f5f 746d 7020 3d20 6a73  lf.ifdo_tmp = js
+000073d0: 6f6e 2e6c 6f61 6428 6f29 0a0a 2020 2020  on.load(o)..    
+000073e0: 2020 2020 2020 2020 7365 6c66 2e69 6664          self.ifd
+000073f0: 6f5f 7061 7273 6564 203d 2063 6f70 792e  o_parsed = copy.
+00007400: 6465 6570 636f 7079 2873 656c 662e 6966  deepcopy(self.if
+00007410: 646f 5f74 6d70 290a 2020 2020 2020 2020  do_tmp).        
+00007420: 2020 2020 6f2e 636c 6f73 6528 290a 2020      o.close().  
+00007430: 2020 2020 2020 2020 2020 732e 7374 6f70            s.stop
+00007440: 2829 0a20 2020 2020 2020 2020 2020 2073  ().            s
+00007450: 656c 662e 7072 6f76 2e61 6464 5072 6576  elf.prov.addPrev
+00007460: 696f 7573 5072 6f76 656e 616e 6365 2873  iousProvenance(s
+00007470: 656c 662e 7072 6f76 2e67 6574 4c61 7374  elf.prov.getLast
+00007480: 5072 6f76 656e 616e 6365 4669 6c65 2873  ProvenanceFile(s
+00007490: 656c 662e 6469 722e 746f 2873 656c 662e  elf.dir.to(self.
+000074a0: 6469 722e 6474 2e70 726f 746f 636f 6c29  dir.dt.protocol)
+000074b0: 2c73 656c 662e 7072 6f76 2e65 7865 6375  ,self.prov.execu
+000074c0: 7461 626c 6529 290a 2020 2020 2020 2020  table)).        
+000074d0: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
+000074e0: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
+000074f0: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
+00007500: 2873 7472 2865 2e61 7267 7329 290a 2020  (str(e.args)).  
+00007510: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00007520: 2046 616c 7365 0a20 2020 2020 2020 2073   False.        s
+00007530: 2e73 746f 7028 290a 0a20 2020 2020 2020  .stop()..       
+00007540: 2023 2074 7279 2074 6f20 7061 7273 6520   # try to parse 
+00007550: 652e 672e 2073 7472 696e 6773 2074 6861  e.g. strings tha
+00007560: 7420 7265 7072 6573 656e 7420 6469 6374  t represent dict
+00007570: 730a 2020 2020 2020 2020 6d69 7174 632e  s.        miqtc.
+00007580: 7265 6375 7273 6976 6545 7661 6c28 7365  recursiveEval(se
+00007590: 6c66 2e69 6664 6f5f 746d 7029 0a0a 2020  lf.ifdo_tmp)..  
+000075a0: 2020 2020 2020 6966 2073 656c 662e 696d        if self.im
+000075b0: 6167 6553 6574 4865 6164 6572 4b65 7920  ageSetHeaderKey 
+000075c0: 6e6f 7420 696e 2073 656c 662e 6966 646f  not in self.ifdo
+000075d0: 5f74 6d70 3a0a 2020 2020 2020 2020 2020  _tmp:.          
+000075e0: 2020 7261 6973 6520 4578 6365 7074 696f    raise Exceptio
+000075f0: 6e28 2245 7272 6f72 206c 6f61 6469 6e67  n("Error loading
+00007600: 2069 4644 4f20 6669 6c65 222c 6669 6c65   iFDO file",file
+00007610: 2c22 646f 6573 206e 6f74 2063 6f6e 7461  ,"does not conta
+00007620: 696e 222c 7365 6c66 2e69 6d61 6765 5365  in",self.imageSe
+00007630: 7448 6561 6465 724b 6579 290a 2020 2020  tHeaderKey).    
+00007640: 2020 2020 6966 2073 656c 662e 696d 6167      if self.imag
+00007650: 6553 6574 4974 656d 734b 6579 206e 6f74  eSetItemsKey not
+00007660: 2069 6e20 7365 6c66 2e69 6664 6f5f 746d   in self.ifdo_tm
+00007670: 703a 0a20 2020 2020 2020 2020 2020 2072  p:.            r
+00007680: 6169 7365 2045 7863 6570 7469 6f6e 2822  aise Exception("
+00007690: 4572 726f 7220 6c6f 6164 696e 6720 6946  Error loading iF
+000076a0: 444f 2066 696c 6522 2c66 696c 652c 2264  DO file",file,"d
+000076b0: 6f65 7320 6e6f 7420 636f 6e74 6169 6e22  oes not contain"
+000076c0: 2c73 656c 662e 696d 6167 6553 6574 4974  ,self.imageSetIt
+000076d0: 656d 734b 6579 290a 0a20 2020 2020 2020  emsKey)..       
+000076e0: 2069 6620 2073 656c 662e 6966 646f 5f74   if  self.ifdo_t
+000076f0: 6d70 5b73 656c 662e 696d 6167 6553 6574  mp[self.imageSet
+00007700: 4865 6164 6572 4b65 795d 203d 3d20 4e6f  HeaderKey] == No
+00007710: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00007720: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
+00007730: 6c66 2e69 6d61 6765 5365 7448 6561 6465  lf.imageSetHeade
+00007740: 724b 6579 5d20 3d20 7b7d 0a20 2020 2020  rKey] = {}.     
+00007750: 2020 2069 6620 7365 6c66 2e69 6664 6f5f     if self.ifdo_
+00007760: 746d 705b 7365 6c66 2e69 6d61 6765 5365  tmp[self.imageSe
+00007770: 7449 7465 6d73 4b65 795d 203d 3d20 4e6f  tItemsKey] == No
+00007780: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00007790: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
+000077a0: 6c66 2e69 6d61 6765 5365 7449 7465 6d73  lf.imageSetItems
+000077b0: 4b65 795d 203d 207b 7d0a 0a20 2020 2020  Key] = {}..     
+000077c0: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
+000077d0: 2822 6946 444f 2066 696c 6520 6c6f 6164  ("iFDO file load
+000077e0: 6564 3a5c 7422 2b6f 732e 7061 7468 2e62  ed:\t"+os.path.b
+000077f0: 6173 656e 616d 6528 6669 6c65 2929 0a0a  asename(file))..
+00007800: 2020 2020 2020 2020 2320 6368 6563 6b20          # check 
+00007810: 6946 444f 2076 6572 7369 6f6e 0a20 2020  iFDO version.   
+00007820: 2020 2020 2072 6561 6456 6572 7369 6f6e       readVersion
+00007830: 203d 2022 762e 312e 302e 3022 2023 2064   = "v.1.0.0" # d
+00007840: 6964 206e 6f74 2068 6176 6520 7468 6520  id not have the 
+00007850: 2769 6d61 6765 2d73 6574 2d69 6664 6f2d  'image-set-ifdo-
+00007860: 7665 7273 696f 6e27 2066 6965 6c64 2079  version' field y
+00007870: 6574 0a20 2020 2020 2020 2074 7279 3a20  et.        try: 
+00007880: 0a20 2020 2020 2020 2020 2020 2072 6561  .            rea
+00007890: 6456 6572 7369 6f6e 203d 2073 656c 662e  dVersion = self.
+000078a0: 6669 6e64 546d 7046 6965 6c64 2827 696d  findTmpField('im
+000078b0: 6167 652d 7365 742d 6966 646f 2d76 6572  age-set-ifdo-ver
+000078c0: 7369 6f6e 2729 0a20 2020 2020 2020 2065  sion').        e
+000078d0: 7863 6570 7420 4b65 7945 7272 6f72 3a0a  xcept KeyError:.
+000078e0: 2020 2020 2020 2020 2020 2020 7061 7373              pass
+000078f0: 0a20 2020 2020 2020 2069 6e74 5265 6164  .        intRead
+00007900: 5665 7273 696f 6e20 3d20 5665 7273 696f  Version = Versio
+00007910: 6e28 7265 6164 5665 7273 696f 6e29 0a20  n(readVersion). 
+00007920: 2020 2020 2020 2069 6e74 5468 6973 5665         intThisVe
+00007930: 7273 696f 6e20 3d20 5665 7273 696f 6e28  rsion = Version(
+00007940: 6d69 7174 762e 6946 444f 5f76 6572 7369  miqtv.iFDO_versi
+00007950: 6f6e 290a 2020 2020 2020 2020 6966 2069  on).        if i
+00007960: 6e74 5265 6164 5665 7273 696f 6e20 3c20  ntReadVersion < 
+00007970: 696e 7454 6869 7356 6572 7369 6f6e 3a0a  intThisVersion:.
+00007980: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00007990: 2e70 726f 762e 6c6f 6728 224c 6f61 6465  .prov.log("Loade
+000079a0: 6420 6946 444f 2068 6173 2076 6572 7369  d iFDO has versi
+000079b0: 6f6e 2022 202b 2072 6561 6456 6572 7369  on " + readVersi
+000079c0: 6f6e 202b 2022 2061 6e64 2077 696c 6c20  on + " and will 
+000079d0: 6265 2075 7064 6174 6564 2074 6f20 7665  be updated to ve
+000079e0: 7273 696f 6e20 2220 2b20 6d69 7174 762e  rsion " + miqtv.
+000079f0: 6946 444f 5f76 6572 7369 6f6e 290a 2020  iFDO_version).  
+00007a00: 2020 2020 2020 6966 2069 6e74 5265 6164        if intRead
+00007a10: 5665 7273 696f 6e20 3e20 696e 7454 6869  Version > intThi
+00007a20: 7356 6572 7369 6f6e 3a0a 2020 2020 2020  sVersion:.      
+00007a30: 2020 2020 2020 7365 6c66 2e70 726f 762e        self.prov.
+00007a40: 6c6f 6728 2243 6175 7469 6f6e 2120 4c6f  log("Caution! Lo
+00007a50: 6164 6564 2069 4644 4f20 6861 7320 7665  aded iFDO has ve
+00007a60: 7273 696f 6e20 2220 2b20 7265 6164 5665  rsion " + readVe
+00007a70: 7273 696f 6e20 2b20 2220 6973 2061 6865  rsion + " is ahe
+00007a80: 6164 206f 6620 7665 7273 696f 6e20 7573  ad of version us
+00007a90: 6564 2068 6572 653a 2022 202b 206d 6971  ed here: " + miq
+00007aa0: 7476 2e69 4644 4f5f 7665 7273 696f 6e29  tv.iFDO_version)
+00007ab0: 0a0a 2020 2020 2020 2020 2320 666f 7220  ..        # for 
+00007ac0: 736f 6f6f 6f6f 6d65 2072 6561 736f 6e20  sooooome reason 
+00007ad0: 7468 6973 2066 6978 6573 2061 2068 6963  this fixes a hic
+00007ae0: 6b75 7020 6f66 2074 6865 2070 726f 6720  kup of the prog 
+00007af0: 696e 2063 7265 6174 6569 4644 4f28 290a  in createiFDO().
+00007b00: 2020 2020 2020 2020 7072 6f67 203d 206d          prog = m
+00007b10: 6971 7463 2e50 7269 6e74 4b6e 6f77 6e50  iqtc.PrintKnownP
+00007b20: 726f 6772 6573 734d 7367 2822 666f 6f22  rogressMsg("foo"
+00007b30: 2c20 312c 6d6f 6475 6c6f 3d31 290a 2020  , 1,modulo=1).  
+00007b40: 2020 2020 2020 7072 6f67 2e63 6c65 6172        prog.clear
+00007b50: 2829 0a20 2020 2020 2020 2074 7279 3a0a  ().        try:.
+00007b60: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00007b70: 2e63 6f6e 7665 7274 546f 4465 6661 756c  .convertToDefaul
+00007b80: 7444 6174 6554 696d 6546 6f72 6d61 7428  tDateTimeFormat(
+00007b90: 7365 6c66 2e69 6664 6f5f 746d 7029 0a20  self.ifdo_tmp). 
+00007ba0: 2020 2020 2020 2065 7863 6570 7420 4578         except Ex
+00007bb0: 6365 7074 696f 6e20 6173 2065 783a 0a20  ception as ex:. 
+00007bc0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00007bd0: 7072 6f76 2e6c 6f67 2822 4368 6563 6b69  prov.log("Checki
+00007be0: 6e67 2064 6174 6574 696d 6520 666f 726d  ng datetime form
+00007bf0: 6174 3a20 2220 2b20 7374 7228 6578 2929  at: " + str(ex))
+00007c00: 0a0a 2020 2020 2020 2020 2320 666f 7220  ..        # for 
+00007c10: 736f 6f6f 6f6f 6d65 2072 6561 736f 6e20  sooooome reason 
+00007c20: 7468 6973 2066 6978 6573 2061 2068 6963  this fixes a hic
+00007c30: 6b75 7020 6f66 2074 6865 2070 726f 6720  kup of the prog 
+00007c40: 696e 2063 7265 6174 6569 4644 4f28 290a  in createiFDO().
+00007c50: 2020 2020 2020 2020 7072 6f67 203d 206d          prog = m
+00007c60: 6971 7463 2e50 7269 6e74 4b6e 6f77 6e50  iqtc.PrintKnownP
+00007c70: 726f 6772 6573 734d 7367 2822 666f 6f22  rogressMsg("foo"
+00007c80: 2c20 312c 6d6f 6475 6c6f 3d31 290a 2020  , 1,modulo=1).  
+00007c90: 2020 2020 2020 7072 6f67 2e63 6c65 6172        prog.clear
+00007ca0: 2829 0a0a 2020 2020 2020 2020 7365 6c66  ()..        self
+00007cb0: 2e5f 7472 795f 7570 6772 6164 655f 746f  ._try_upgrade_to
+00007cc0: 5f69 6664 6f5f 7665 7273 696f 6e5f 3278  _ifdo_version_2x
+00007cd0: 2829 0a0a 2020 2020 2020 2020 2320 6368  ()..        # ch
+00007ce0: 6563 6b20 7265 6164 2069 4644 4f20 6669  eck read iFDO fi
+00007cf0: 6c65 0a20 2020 2020 2020 2074 7279 3a0a  le.        try:.
+00007d00: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+00007d10: 6f74 2073 656c 662e 6967 6e6f 7265 5f69  ot self.ignore_i
+00007d20: 6d61 6765 5f66 696c 6573 3a0a 2020 2020  mage_files:.    
+00007d30: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00007d40: 2e63 7265 6174 6569 4644 4f28 7365 6c66  .createiFDO(self
+00007d50: 2e69 6664 6f5f 746d 705b 7365 6c66 2e69  .ifdo_tmp[self.i
+00007d60: 6d61 6765 5365 7448 6561 6465 724b 6579  mageSetHeaderKey
+00007d70: 5d2c 206d 6971 7469 2e63 7265 6174 6549  ], miqti.createI
+00007d80: 6d61 6765 4974 656d 734c 6973 7446 726f  mageItemsListFro
+00007d90: 6d49 6d61 6765 4974 656d 7344 6963 7428  mImageItemsDict(
+00007da0: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
+00007db0: 6c66 2e69 6d61 6765 5365 7449 7465 6d73  lf.imageSetItems
+00007dc0: 4b65 795d 2929 0a20 2020 2020 2020 2020  Key])).         
+00007dd0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00007de0: 2020 2020 2020 2020 2073 656c 662e 7570           self.up
+00007df0: 6461 7465 6946 444f 2873 656c 662e 6966  dateiFDO(self.if
+00007e00: 646f 5f74 6d70 5b73 656c 662e 696d 6167  do_tmp[self.imag
+00007e10: 6553 6574 4865 6164 6572 4b65 795d 2c20  eSetHeaderKey], 
+00007e20: 6d69 7174 692e 6372 6561 7465 496d 6167  miqti.createImag
+00007e30: 6549 7465 6d73 4c69 7374 4672 6f6d 496d  eItemsListFromIm
+00007e40: 6167 6549 7465 6d73 4469 6374 2873 656c  ageItemsDict(sel
+00007e50: 662e 6966 646f 5f74 6d70 5b73 656c 662e  f.ifdo_tmp[self.
+00007e60: 696d 6167 6553 6574 4974 656d 734b 6579  imageSetItemsKey
+00007e70: 5d29 2c68 6561 6465 725f 6f6e 6c79 3d73  ]),header_only=s
+00007e80: 656c 662e 6967 6e6f 7265 5f69 6d61 6765  elf.ignore_image
+00007e90: 5f66 696c 6573 290a 2020 2020 2020 2020  _files).        
+00007ea0: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
+00007eb0: 2061 7320 6578 3a0a 2020 2020 2020 2020   as ex:.        
+00007ec0: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
+00007ed0: 6728 224c 6f61 6465 6420 6946 444f 2066  g("Loaded iFDO f
+00007ee0: 696c 6520 6e6f 7420 7661 6c69 6420 7965  ile not valid ye
+00007ef0: 743a 2022 202b 2073 7472 2865 7829 290a  t: " + str(ex)).
+00007f00: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00007f10: 5472 7565 0a0a 0a20 2020 2064 6566 2077  True...    def w
+00007f20: 7269 7465 5f69 6664 6f5f 6669 6c65 2873  rite_ifdo_file(s
+00007f30: 656c 662c 616c 6c6f 775f 6d69 7373 696e  elf,allow_missin
+00007f40: 675f 7265 7175 6972 6564 3d46 616c 7365  g_required=False
+00007f50: 293a 0a20 2020 2020 2020 2022 2222 2057  ):.        """ W
+00007f60: 7269 7465 7320 616e 2069 4644 4f20 6669  rites an iFDO fi
+00007f70: 6c65 2074 6f20 6469 736b 2e20 4f76 6572  le to disk. Over
+00007f80: 7772 6974 6573 2070 6f74 656e 7469 616c  writes potential
+00007f90: 6c79 2065 7869 7374 696e 6720 6669 6c65  ly existing file
+00007fa0: 2e22 2222 0a0a 2020 2020 2020 2020 7320  ."""..        s 
+00007fb0: 3d20 6d69 7174 632e 5072 696e 744c 6f61  = miqtc.PrintLoa
+00007fc0: 6469 6e67 4d73 6728 2257 7269 7469 6e67  dingMsg("Writing
+00007fd0: 2069 4644 4f20 6669 6c65 2229 0a0a 2020   iFDO file")..  
+00007fe0: 2020 2020 2020 2320 6368 6563 6b20 6669        # check fi
+00007ff0: 656c 6473 2061 6761 696e 2069 6620 6368  elds again if ch
+00008000: 616e 6765 6420 7369 6e63 6520 6c61 7374  anged since last
+00008010: 2063 6865 636b 2028 6372 6561 7465 6946   check (createiF
+00008020: 444f 290a 2020 2020 2020 2020 6966 2073  DO).        if s
+00008030: 656c 662e 6966 646f 5f74 6d70 2021 3d20  elf.ifdo_tmp != 
+00008040: 7365 6c66 2e69 6664 6f5f 6368 6563 6b65  self.ifdo_checke
+00008050: 643a 0a20 2020 2020 2020 2020 2020 2073  d:.            s
+00008060: 656c 662e 6372 6561 7465 6946 444f 2873  elf.createiFDO(s
+00008070: 656c 662e 6966 646f 5f74 6d70 5b73 656c  elf.ifdo_tmp[sel
+00008080: 662e 696d 6167 6553 6574 4865 6164 6572  f.imageSetHeader
+00008090: 4b65 795d 2c20 6d69 7174 692e 6372 6561  Key], miqti.crea
+000080a0: 7465 496d 6167 6549 7465 6d73 4c69 7374  teImageItemsList
+000080b0: 4672 6f6d 496d 6167 6549 7465 6d73 4469  FromImageItemsDi
+000080c0: 6374 2873 656c 662e 6966 646f 5f74 6d70  ct(self.ifdo_tmp
+000080d0: 5b73 656c 662e 696d 6167 6553 6574 4974  [self.imageSetIt
+000080e0: 656d 734b 6579 5d29 2c0a 2020 2020 2020  emsKey]),.      
+000080f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008100: 2020 2020 2020 616c 6c6f 775f 6d69 7373        allow_miss
+00008110: 696e 675f 7265 7175 6972 6564 3d61 6c6c  ing_required=all
+00008120: 6f77 5f6d 6973 7369 6e67 5f72 6571 7569  ow_missing_requi
+00008130: 7265 6429 0a20 2020 2020 2020 200a 2020  red).        .  
+00008140: 2020 2020 2020 2320 6164 6420 2224 7363        # add "$sc
+00008150: 6865 6d61 220a 2020 2020 2020 2020 7365  hema".        se
+00008160: 6c66 2e69 6664 6f5f 6368 6563 6b65 645b  lf.ifdo_checked[
+00008170: 2224 7363 6865 6d61 225d 203d 206d 6971  "$schema"] = miq
+00008180: 7476 2e69 6664 6f5f 7363 6865 6d61 5b27  tv.ifdo_schema['
+00008190: 2469 6427 5d0a 2020 2020 2020 2020 0a20  $id'].        . 
+000081a0: 2020 2020 2020 2069 4644 4f5f 7061 7468         iFDO_path
+000081b0: 203d 2073 656c 662e 6765 7469 4644 4f46   = self.getiFDOF
+000081c0: 696c 654e 616d 6528 6f76 6572 7772 6974  ileName(overwrit
+000081d0: 653d 5472 7565 290a 0a20 2020 2020 2020  e=True)..       
+000081e0: 2023 2070 7574 7320 6576 6572 7974 6869   # puts everythi
+000081f0: 6e67 2069 6e20 6f6e 6520 6c69 6e65 0a20  ng in one line. 
+00008200: 2020 2020 2020 2023 7769 7468 206f 7065         #with ope
+00008210: 6e28 6946 444f 5f70 6174 682e 7265 706c  n(iFDO_path.repl
+00008220: 6163 6528 2279 616d 6c22 2c22 6a73 6f6e  ace("yaml","json
+00008230: 2229 2c20 2777 2729 2061 7320 6670 3a0a  "), 'w') as fp:.
+00008240: 2020 2020 2020 2020 2320 2020 206a 736f          #    jso
+00008250: 6e2e 6475 6d70 2873 656c 662e 6966 646f  n.dump(self.ifdo
+00008260: 5f63 6865 636b 6564 2c20 6670 290a 0a20  _checked, fp).. 
+00008270: 2020 2020 2020 2023 2063 6f6e 7665 7274         # convert
+00008280: 2064 6963 7469 6f6e 6172 7920 746f 204a   dictionary to J
+00008290: 534f 4e20 7374 7269 6e67 0a20 2020 2020  SON string.     
+000082a0: 2020 206a 736f 6e5f 6461 7461 203d 206a     json_data = j
+000082b0: 736f 6e2e 6475 6d70 7328 7365 6c66 2e69  son.dumps(self.i
+000082c0: 6664 6f5f 6368 6563 6b65 642c 2069 6e64  fdo_checked, ind
+000082d0: 656e 7420 3d20 342c 2073 6f72 745f 6b65  ent = 4, sort_ke
+000082e0: 7973 3d54 7275 6529 0a0a 2020 2020 2020  ys=True)..      
+000082f0: 2020 2320 7772 6974 6520 7468 6520 4a53    # write the JS
+00008300: 4f4e 2073 7472 696e 6720 746f 2061 2066  ON string to a f
+00008310: 696c 650a 2020 2020 2020 2020 7769 7468  ile.        with
+00008320: 206f 7065 6e28 6946 444f 5f70 6174 682c   open(iFDO_path,
+00008330: 2027 7727 2920 6173 2066 3a0a 2020 2020   'w') as f:.    
+00008340: 2020 2020 2020 2020 662e 7772 6974 6528          f.write(
+00008350: 6a73 6f6e 5f64 6174 6129 0a20 2020 2020  json_data).     
+00008360: 2020 200a 2020 2020 2020 2020 2320 6c6f     .        # lo
+00008370: 6720 6368 616e 6765 730a 2020 2020 2020  g changes.      
+00008380: 2020 6966 206e 6f74 2073 656c 662e 6966    if not self.if
+00008390: 646f 5f70 6172 7365 6420 6973 204e 6f6e  do_parsed is Non
+000083a0: 653a 0a20 2020 2020 2020 2020 2020 2069  e:.            i
+000083b0: 6664 6f5f 7570 6461 7465 203d 2044 6565  fdo_update = Dee
+000083c0: 7044 6966 6628 7365 6c66 2e69 6664 6f5f  pDiff(self.ifdo_
+000083d0: 7061 7273 6564 2c73 656c 662e 6966 646f  parsed,self.ifdo
+000083e0: 5f63 6865 636b 6564 290a 2020 2020 2020  _checked).      
+000083f0: 2020 2020 2020 2370 7072 696e 7428 6966        #pprint(if
+00008400: 646f 5f75 7064 6174 6529 0a20 2020 2020  do_update).     
+00008410: 2020 2020 2020 2069 6620 6966 646f 5f75         if ifdo_u
+00008420: 7064 6174 6520 213d 207b 7d3a 0a20 2020  pdate != {}:.   
+00008430: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00008440: 662e 7072 6f76 2e6c 6f67 2822 6946 444f  f.prov.log("iFDO
+00008450: 2075 7064 6174 6564 2229 0a20 2020 2020   updated").     
+00008460: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00008470: 7072 6f76 2e6c 6f67 2873 7472 2869 6664  prov.log(str(ifd
+00008480: 6f5f 7570 6461 7465 292c 646f 6e74 5368  o_update),dontSh
+00008490: 6f77 3d54 7275 6529 0a20 2020 2020 2020  ow=True).       
+000084a0: 2073 656c 662e 7072 6f76 2e6c 6f67 2822   self.prov.log("
+000084b0: 5772 6f74 6520 6946 444f 2074 6f20 6669  Wrote iFDO to fi
+000084c0: 6c65 2022 202b 2069 4644 4f5f 7061 7468  le " + iFDO_path
+000084d0: 290a 2020 2020 2020 2020 7365 6c66 2e70  ).        self.p
+000084e0: 726f 762e 7772 6974 6528 7365 6c66 2e64  rov.write(self.d
+000084f0: 6972 2e74 6f28 7365 6c66 2e64 6972 2e64  ir.to(self.dir.d
+00008500: 742e 7072 6f74 6f63 6f6c 2929 0a20 2020  t.protocol)).   
+00008510: 2020 2020 2073 2e73 746f 7028 290a 0a20       s.stop().. 
+00008520: 2020 2064 6566 2077 7269 7465 6946 444f     def writeiFDO
+00008530: 6669 6c65 2873 656c 662c 616c 6c6f 775f  file(self,allow_
+00008540: 6d69 7373 696e 675f 7265 7175 6972 6564  missing_required
+00008550: 3d46 616c 7365 293a 0a20 2020 2020 2020  =False):.       
+00008560: 2022 2222 2044 6570 7265 6361 7465 6420   """ Deprecated 
+00008570: 2d20 7573 6520 7772 6974 655f 6966 646f  - use write_ifdo
+00008580: 5f66 696c 6520 2222 220a 2020 2020 2020  _file """.      
+00008590: 2020 7365 6c66 2e77 7269 7465 5f69 6664    self.write_ifd
+000085a0: 6f5f 6669 6c65 2861 6c6c 6f77 5f6d 6973  o_file(allow_mis
+000085b0: 7369 6e67 5f72 6571 7569 7265 6429 0a0a  sing_required)..
+000085c0: 0a20 2020 2064 6566 2073 6574 6946 444f  .    def setiFDO
+000085d0: 4669 6c65 4e61 6d65 2873 656c 662c 6946  FileName(self,iF
+000085e0: 444f 6669 6c65 3a73 7472 293a 0a20 2020  DOfile:str):.   
+000085f0: 2020 2020 2022 2222 2053 6574 2074 6865       """ Set the
+00008600: 2063 7572 7265 6e74 2069 4644 4f20 6669   current iFDO fi
+00008610: 6c65 206e 616d 6520 7769 7468 2070 6174  le name with pat
+00008620: 682e 2053 6574 2074 6f20 2222 2069 6e20  h. Set to "" in 
+00008630: 6f72 6465 7220 746f 2067 6574 2064 6566  order to get def
+00008640: 6175 6c74 206e 616d 6520 616e 6420 6c6f  ault name and lo
+00008650: 6361 7469 6f6e 2e20 2222 220a 2020 2020  cation. """.    
+00008660: 2020 2020 7365 6c66 2e69 4644 4f66 696c      self.iFDOfil
+00008670: 655f 203d 2069 4644 4f66 696c 650a 2020  e_ = iFDOfile.  
+00008680: 2020 2020 2020 7365 6c66 2e69 4644 4f66        self.iFDOf
+00008690: 696c 655f 203d 2073 656c 662e 6765 7469  ile_ = self.geti
+000086a0: 4644 4f46 696c 654e 616d 6528 2920 2320  FDOFileName() # 
+000086b0: 636f 6e73 7472 7563 7420 6465 6661 756c  construct defaul
+000086c0: 7420 6e61 6d65 2069 6620 656d 7074 790a  t name if empty.
+000086d0: 2020 2020 2020 2020 6966 206d 6971 7463          if miqtc
+000086e0: 2e61 7373 6572 7453 6c61 7368 286f 732e  .assertSlash(os.
+000086f0: 7061 7468 2e64 6972 6e61 6d65 2873 656c  path.dirname(sel
+00008700: 662e 6946 444f 6669 6c65 5f29 2920 213d  f.iFDOfile_)) !=
+00008710: 206d 6971 7463 2e61 7373 6572 7453 6c61   miqtc.assertSla
+00008720: 7368 2873 656c 662e 6469 722e 746f 2873  sh(self.dir.to(s
+00008730: 656c 662e 6469 722e 6474 2e70 726f 6475  elf.dir.dt.produ
+00008740: 6374 7329 293a 0a20 2020 2020 2020 2020  cts)):.         
+00008750: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
+00008760: 2822 4361 7574 696f 6e21 2069 4644 4f20  ("Caution! iFDO 
+00008770: 6669 6c65 2070 6174 6820 6973 206e 6f74  file path is not
+00008780: 2069 6e20 2770 726f 6475 6374 7327 2073   in 'products' s
+00008790: 7562 2066 6f6c 6465 7220 6173 2072 6563  ub folder as rec
+000087a0: 6f6d 6d65 6e64 6564 2e20 436f 6e73 6964  ommended. Consid
+000087b0: 6572 2072 6573 6574 7469 6e67 2077 6974  er resetting wit
+000087c0: 6820 7365 7469 4644 4f46 696c 654e 616d  h setiFDOFileNam
+000087d0: 6528 292e 2022 202b 2069 4644 4f66 696c  e(). " + iFDOfil
+000087e0: 6529 0a20 2020 2020 2020 2074 7279 3a0a  e).        try:.
+000087f0: 2020 2020 2020 2020 2020 2020 6576 656e              even
+00008800: 7420 3d20 7365 6c66 2e66 696e 6454 6d70  t = self.findTmp
+00008810: 4669 656c 6428 2769 6d61 6765 2d65 7665  Field('image-eve
+00008820: 6e74 2729 5b27 6e61 6d65 275d 0a20 2020  nt')['name'].   
+00008830: 2020 2020 2020 2020 2073 656e 736f 7220           sensor 
+00008840: 3d20 7365 6c66 2e66 696e 6454 6d70 4669  = self.findTmpFi
+00008850: 656c 6428 2769 6d61 6765 2d73 656e 736f  eld('image-senso
+00008860: 7227 295b 276e 616d 6527 5d0a 2020 2020  r')['name'].    
+00008870: 2020 2020 6578 6365 7074 206d 6971 7463      except miqtc
+00008880: 2e49 6664 6f45 7863 6570 7469 6f6e 3a0a  .IfdoException:.
+00008890: 2020 2020 2020 2020 2020 2020 6576 656e              even
+000088a0: 7420 3d20 7365 6c66 2e64 6972 2e65 7665  t = self.dir.eve
+000088b0: 6e74 2829 0a20 2020 2020 2020 2020 2020  nt().           
+000088c0: 2073 656e 736f 7220 3d20 7365 6c66 2e64   sensor = self.d
+000088d0: 6972 2e73 656e 736f 7228 290a 0a20 2020  ir.sensor()..   
+000088e0: 2020 2020 2069 4644 4f66 696c 654e 616d       iFDOfileNam
+000088f0: 6520 3d20 6f73 2e70 6174 682e 6261 7365  e = os.path.base
+00008900: 6e61 6d65 2873 656c 662e 6946 444f 6669  name(self.iFDOfi
+00008910: 6c65 5f29 0a20 2020 2020 2020 2069 6620  le_).        if 
+00008920: 6e6f 7420 6576 656e 7420 696e 2069 4644  not event in iFD
+00008930: 4f66 696c 654e 616d 6520 6f72 206e 6f74  OfileName or not
+00008940: 2069 4644 4f2e 6765 7453 686f 7274 4571   iFDO.getShortEq
+00008950: 7569 706d 656e 7449 4428 7365 6e73 6f72  uipmentID(sensor
+00008960: 2920 696e 2069 4644 4f66 696c 654e 616d  ) in iFDOfileNam
+00008970: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
+00008980: 656c 662e 7072 6f76 2e6c 6f67 2822 4361  elf.prov.log("Ca
+00008990: 7574 696f 6e21 2069 4644 4f20 6669 6c65  ution! iFDO file
+000089a0: 206e 616d 6520 646f 6573 206e 6f74 2063   name does not c
+000089b0: 6f6e 7461 696e 2070 726f 6a65 6374 2c20  ontain project, 
+000089c0: 6576 656e 7420 616e 6420 7365 6e73 6f72  event and sensor
+000089d0: 206e 616d 6520 6173 2072 6563 6f6d 6d65   name as recomme
+000089e0: 6e64 6564 2e20 436f 6e73 6964 6572 2072  nded. Consider r
+000089f0: 6573 6574 7469 6e67 2077 6974 6820 7365  esetting with se
+00008a00: 7469 4644 4f46 696c 654e 616d 6528 292e  tiFDOFileName().
+00008a10: 2022 202b 2069 4644 4f66 696c 6529 0a0a   " + iFDOfile)..
+00008a20: 0a20 2020 2064 6566 2067 6574 6946 444f  .    def getiFDO
+00008a30: 4669 6c65 4e61 6d65 2873 656c 662c 6f76  FileName(self,ov
+00008a40: 6572 7772 6974 653d 4661 6c73 6529 3a0a  erwrite=False):.
+00008a50: 2020 2020 2020 2020 2222 2220 5265 7475          """ Retu
+00008a60: 726e 7320 7468 6520 6375 7272 656e 7420  rns the current 
+00008a70: 6946 444f 2066 696c 6527 7320 6e61 6d65  iFDO file's name
+00008a80: 2077 6974 6820 7061 7468 2e20 4966 206e   with path. If n
+00008a90: 6f74 2073 6574 2079 6574 206f 7220 6f76  ot set yet or ov
+00008aa0: 6572 7772 6974 653d 3d54 7275 6520 6974  erwrite==True it
+00008ab0: 2072 6574 7572 6e73 2074 6865 206f 6e65   returns the one
+00008ac0: 206d 6174 6368 696e 6720 696d 6167 652d   matching image-
+00008ad0: 7365 742d 6e61 6d65 2e20 2222 220a 2020  set-name. """.  
+00008ae0: 2020 2020 2020 6966 2073 656c 662e 6946        if self.iF
+00008af0: 444f 6669 6c65 5f20 3d3d 2022 2220 6f72  DOfile_ == "" or
+00008b00: 206f 7665 7277 7269 7465 3a0a 2020 2020   overwrite:.    
+00008b10: 2020 2020 2020 2020 6669 6c65 5f6e 616d          file_nam
+00008b20: 6520 3d20 7365 6c66 2e66 696e 6454 6d70  e = self.findTmp
+00008b30: 4669 656c 6428 2769 6d61 6765 2d73 6574  Field('image-set
+00008b40: 2d6e 616d 6527 2920 2b20 275f 6946 444f  -name') + '_iFDO
+00008b50: 2e6a 736f 6e27 0a20 2020 2020 2020 2020  .json'.         
+00008b60: 2020 2069 6620 7365 6c66 2e69 4644 4f66     if self.iFDOf
+00008b70: 696c 655f 2021 3d20 2222 3a0a 2020 2020  ile_ != "":.    
+00008b80: 2020 2020 2020 2020 2020 2020 2320 7265              # re
+00008b90: 6e61 6d65 2066 696c 6520 6275 7420 6b65  name file but ke
+00008ba0: 6570 206c 6f63 6174 696f 6e0a 2020 2020  ep location.    
+00008bb0: 2020 2020 2020 2020 2020 2020 6966 2066              if f
+00008bc0: 696c 655f 6e61 6d65 2021 3d20 6f73 2e70  ile_name != os.p
+00008bd0: 6174 682e 6261 7365 6e61 6d65 2873 656c  ath.basename(sel
+00008be0: 662e 6946 444f 6669 6c65 5f29 2061 6e64  f.iFDOfile_) and
+00008bf0: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
+00008c00: 7365 6c66 2e69 4644 4f66 696c 655f 293a  self.iFDOfile_):
+00008c10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008c20: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
+00008c30: 6f67 2822 4361 7574 696f 6e21 2069 6664  og("Caution! ifd
+00008c40: 6f20 6669 6c65 2072 656e 616d 6564 2074  o file renamed t
+00008c50: 6f20 2220 2b20 6669 6c65 5f6e 616d 6529  o " + file_name)
+00008c60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008c70: 2073 656c 662e 6946 444f 6669 6c65 5f20   self.iFDOfile_ 
+00008c80: 3d20 6f73 2e70 6174 682e 6a6f 696e 286f  = os.path.join(o
+00008c90: 732e 7061 7468 2e64 6972 6e61 6d65 2873  s.path.dirname(s
+00008ca0: 656c 662e 6946 444f 6669 6c65 5f29 2c66  elf.iFDOfile_),f
+00008cb0: 696c 655f 6e61 6d65 290a 2020 2020 2020  ile_name).      
+00008cc0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00008cd0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00008ce0: 2e69 4644 4f66 696c 655f 203d 206f 732e  .iFDOfile_ = os.
+00008cf0: 7061 7468 2e6a 6f69 6e28 7365 6c66 2e64  path.join(self.d
+00008d00: 6972 2e74 6f28 7365 6c66 2e64 6972 2e64  ir.to(self.dir.d
+00008d10: 742e 7072 6f64 7563 7473 292c 2066 696c  t.products), fil
+00008d20: 655f 6e61 6d65 290a 2020 2020 2020 2020  e_name).        
+00008d30: 7265 7475 726e 2073 656c 662e 6946 444f  return self.iFDO
+00008d40: 6669 6c65 5f0a 0a0a 2020 2020 6465 6620  file_...    def 
+00008d50: 7365 745f 696d 6167 655f 7365 745f 6e61  set_image_set_na
+00008d60: 6d65 5f66 6965 6c64 5f66 726f 6d5f 7072  me_field_from_pr
+00008d70: 6f6a 6563 745f 6576 656e 745f 7365 6e73  oject_event_sens
+00008d80: 6f72 2873 656c 6629 3a0a 2020 2020 2020  or(self):.      
+00008d90: 2020 2222 2220 5365 7473 2066 6965 6c64    """ Sets field
+00008da0: 2069 6d61 6765 2d73 6574 2d6e 616d 6520   image-set-name 
+00008db0: 6672 6f6d 2063 7572 7265 6e74 2074 6d70  from current tmp
+00008dc0: 2066 6965 6c64 7320 666f 7220 7072 6f6a   fields for proj
+00008dd0: 6563 742c 2065 7665 6e74 2061 6e64 2073  ect, event and s
+00008de0: 656e 736f 722e 200a 2020 2020 2020 2020  ensor. .        
+00008df0: 5265 7475 726e 7320 696d 6167 652d 7365  Returns image-se
+00008e00: 742d 6e61 6d65 2076 616c 7565 2e20 2222  t-name value. ""
+00008e10: 220a 2020 2020 2020 2020 6e65 775f 696d  ".        new_im
+00008e20: 6167 655f 7365 745f 6e61 6d65 203d 2073  age_set_name = s
+00008e30: 656c 662e 636f 6e73 7472 7563 7449 6d61  elf.constructIma
+00008e40: 6765 5365 744e 616d 6528 7365 6c66 2e69  geSetName(self.i
+00008e50: 6664 6f5f 746d 705b 7365 6c66 2e69 6d61  fdo_tmp[self.ima
+00008e60: 6765 5365 7448 6561 6465 724b 6579 5d5b  geSetHeaderKey][
+00008e70: 2769 6d61 6765 2d70 726f 6a65 6374 275d  'image-project']
+00008e80: 5b27 6e61 6d65 275d 2c0a 2020 2020 2020  ['name'],.      
 00008e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008ea0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00008eb0: 2e69 6664 6f5f 746d 705b 7365 6c66 2e69  .ifdo_tmp[self.i
-00008ec0: 6d61 6765 5365 7448 6561 6465 724b 6579  mageSetHeaderKey
-00008ed0: 5d5b 2769 6d61 6765 2d65 7665 6e74 275d  ]['image-event']
-00008ee0: 5b27 6e61 6d65 275d 2c0a 2020 2020 2020  ['name'],.      
-00008ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008eb0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00008ec0: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
+00008ed0: 2e69 6d61 6765 5365 7448 6561 6465 724b  .imageSetHeaderK
+00008ee0: 6579 5d5b 2769 6d61 6765 2d65 7665 6e74  ey]['image-event
+00008ef0: 275d 5b27 6e61 6d65 275d 2c0a 2020 2020  ']['name'],.    
 00008f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008f10: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00008f20: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
-00008f30: 2e69 6d61 6765 5365 7448 6561 6465 724b  .imageSetHeaderK
-00008f40: 6579 5d5b 2769 6d61 6765 2d73 656e 736f  ey]['image-senso
-00008f50: 7227 5d5b 276e 616d 6527 5d29 0a20 2020  r']['name']).   
-00008f60: 2020 2020 2073 656c 662e 6966 646f 5f74       self.ifdo_t
-00008f70: 6d70 5b73 656c 662e 696d 6167 6553 6574  mp[self.imageSet
-00008f80: 4865 6164 6572 4b65 795d 5b27 696d 6167  HeaderKey]['imag
-00008f90: 652d 7365 742d 6e61 6d65 275d 203d 206e  e-set-name'] = n
-00008fa0: 6577 5f69 6d61 6765 5f73 6574 5f6e 616d  ew_image_set_nam
-00008fb0: 650a 2020 2020 2020 2020 7265 7475 726e  e.        return
-00008fc0: 206e 6577 5f69 6d61 6765 5f73 6574 5f6e   new_image_set_n
-00008fd0: 616d 650a 2020 2020 2020 2020 0a0a 2020  ame.        ..  
-00008fe0: 2020 4073 7461 7469 636d 6574 686f 640a    @staticmethod.
-00008ff0: 2020 2020 6465 6620 636f 6e73 7472 7563      def construc
-00009000: 7449 6d61 6765 5365 744e 616d 6528 7072  tImageSetName(pr
-00009010: 6f6a 6563 743a 7374 722c 6576 656e 743a  oject:str,event:
-00009020: 7374 722c 7365 6e73 6f72 3a73 7472 293a  str,sensor:str):
-00009030: 0a20 2020 2020 2020 2022 2222 2072 6574  .        """ ret
-00009040: 7572 6e73 203c 7072 6f6a 6563 743e 5f3c  urns <project>_<
-00009050: 6576 656e 743e 5f3c 7365 6e73 6f72 3e2c  event>_<sensor>,
-00009060: 2077 6974 6820 7368 6f72 7420 7665 7273   with short vers
-00009070: 696f 6e20 6f66 203c 7365 6e73 6f72 3e20  ion of <sensor> 
-00009080: 286f 6e6c 7920 6964 292c 2070 7265 7665  (only id), preve
-00009090: 6e74 696e 6720 706f 7465 6e74 6961 6c20  nting potential 
-000090a0: 646f 7562 6c69 6e67 206f 6620 3c70 726f  doubling of <pro
-000090b0: 6a65 6374 3e20 2022 2222 0a20 2020 2020  ject>  """.     
-000090c0: 2020 2073 656e 736f 725f 7368 6f72 7420     sensor_short 
-000090d0: 3d20 6946 444f 2e67 6574 5368 6f72 7445  = iFDO.getShortE
-000090e0: 7175 6970 6d65 6e74 4944 2873 656e 736f  quipmentID(senso
-000090f0: 7229 0a20 2020 2020 2020 2069 6620 6c65  r).        if le
-00009100: 6e28 6576 656e 7429 203e 206c 656e 2870  n(event) > len(p
-00009110: 726f 6a65 6374 2920 616e 6420 6576 656e  roject) and even
-00009120: 745b 303a 6c65 6e28 7072 6f6a 6563 7429  t[0:len(project)
-00009130: 5d20 3d3d 2070 726f 6a65 6374 3a0a 2020  ] == project:.  
-00009140: 2020 2020 2020 2020 2020 696d 6167 655f            image_
-00009150: 7365 745f 6e61 6d65 5f20 3d20 6576 656e  set_name_ = even
-00009160: 7420 2b20 225f 2220 2b20 7365 6e73 6f72  t + "_" + sensor
-00009170: 5f73 686f 7274 0a20 2020 2020 2020 2065  _short.        e
-00009180: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00009190: 2069 6d61 6765 5f73 6574 5f6e 616d 655f   image_set_name_
-000091a0: 203d 2070 726f 6a65 6374 202b 2022 5f22   = project + "_"
-000091b0: 202b 2065 7665 6e74 202b 2022 5f22 202b   + event + "_" +
-000091c0: 2073 656e 736f 725f 7368 6f72 740a 2020   sensor_short.  
-000091d0: 2020 2020 2020 7265 7475 726e 2069 6d61        return ima
-000091e0: 6765 5f73 6574 5f6e 616d 655f 2023 2054  ge_set_name_ # T
-000091f0: 4f44 4f20 696e 636c 7564 6520 6461 7461  ODO include data
-00009200: 5479 7065 3f0a 0a0a 2020 2020 4073 7461  Type?...    @sta
-00009210: 7469 636d 6574 686f 640a 2020 2020 6465  ticmethod.    de
-00009220: 6620 6765 7453 686f 7274 4571 7569 706d  f getShortEquipm
-00009230: 656e 7449 4428 6571 7569 706d 656e 7449  entID(equipmentI
-00009240: 443a 7374 7229 3a0a 2020 2020 2020 2020  D:str):.        
-00009250: 2222 2220 7265 7475 726e 7320 6571 7569  """ returns equi
-00009260: 706d 656e 7420 6964 2077 6974 686f 7574  pment id without
-00009270: 2070 6f74 656e 7469 616c 6c20 6c6f 6e67   potentiall long
-00009280: 203c 6e61 6d65 3e20 7061 7274 2c20 692e   <name> part, i.
-00009290: 652e 3a20 3c6f 776e 6572 3e5f 3c74 7970  e.: <owner>_<typ
-000092a0: 653e 2d3c 7479 7065 2069 6e64 6578 5b5f  e>-<type index[_
-000092b0: 3c73 7562 7479 7065 3e5d 2022 2222 0a20  <subtype>] """. 
-000092c0: 2020 2020 2020 2072 6574 7572 6e20 275f         return '_
-000092d0: 272e 6a6f 696e 2865 7175 6970 6d65 6e74  '.join(equipment
-000092e0: 4944 2e73 706c 6974 2827 5f27 295b 303a  ID.split('_')[0:
-000092f0: 335d 290a 0a20 2020 2040 7374 6174 6963  3])..    @static
-00009300: 6d65 7468 6f64 0a20 2020 2064 6566 2063  method.    def c
-00009310: 6f6e 7374 7275 6374 6946 444f 6669 6c65  onstructiFDOfile
-00009320: 4e61 6d65 2870 726f 6a65 6374 3a73 7472  Name(project:str
-00009330: 2c65 7665 6e74 3a73 7472 2c73 656e 736f  ,event:str,senso
-00009340: 723a 7374 7229 3a0a 2020 2020 2020 2020  r:str):.        
-00009350: 2222 2220 7265 7475 726e 7320 3c63 6f6e  """ returns <con
-00009360: 7374 7275 6374 496d 6167 6553 6574 4e61  structImageSetNa
-00009370: 6d65 2829 3e5f 6946 444f 2e6a 736f 6e20  me()>_iFDO.json 
-00009380: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
-00009390: 726e 2069 4644 4f2e 636f 6e73 7472 7563  rn iFDO.construc
-000093a0: 7449 6d61 6765 5365 744e 616d 6528 7072  tImageSetName(pr
-000093b0: 6f6a 6563 742c 6576 656e 742c 7365 6e73  oject,event,sens
-000093c0: 6f72 2920 2b20 275f 6946 444f 2e6a 736f  or) + '_iFDO.jso
-000093d0: 6e27 200a 0a20 2020 200a 2020 2020 4073  n' ..    .    @s
-000093e0: 7461 7469 636d 6574 686f 640a 2020 2020  taticmethod.    
-000093f0: 6465 6620 5f5f 6765 7446 6965 6c64 5661  def __getFieldVa
-00009400: 6c75 6528 6966 646f 3a64 6963 742c 6b65  lue(ifdo:dict,ke
-00009410: 7973 3a6c 6973 742c 6465 6661 756c 745f  ys:list,default_
-00009420: 6f6e 6c79 203d 2046 616c 7365 293a 0a20  only = False):. 
-00009430: 2020 2020 2020 2022 2222 2072 6574 7572         """ retur
-00009440: 6e73 2063 6f70 7920 6f66 2073 6574 206f  ns copy of set o
-00009450: 7220 6974 656d 2066 6965 6c64 2076 616c  r item field val
-00009460: 7565 2c20 616c 736f 2063 6f6e 7369 6465  ue, also conside
-00009470: 726e 6720 6465 6661 756c 7420 7661 6c75  rng default valu
-00009480: 6573 2066 726f 6d20 6865 6164 6572 2e0a  es from header..
-00009490: 2020 2020 2020 2020 2020 2020 5573 6520              Use 
-000094a0: 6b65 7973 2061 7320 652e 672e 205b 3c69  keys as e.g. [<i
-000094b0: 7465 6d3e 2c3c 6b65 793e 2c2e 2e5d 2e20  tem>,<key>,..]. 
-000094c0: 4361 6e20 6265 2075 7365 6420 666f 7220  Can be used for 
-000094d0: 6865 6164 6572 2066 6965 6c64 7320 6173  header fields as
-000094e0: 2077 656c 6c20 6173 2069 7465 6d20 6669   well as item fi
-000094f0: 656c 6473 2e0a 2020 2020 2020 2020 2020  elds..          
-00009500: 2020 4974 656d 2069 6e64 6578 2063 616e    Item index can
-00009510: 2062 6520 6e65 676c 6563 7465 642c 2069   be neglected, i
-00009520: 6e20 6361 7365 206f 6620 7669 6465 6f20  n case of video 
-00009530: 6120 6469 6374 207b 3c69 6d61 6765 2d64  a dict {<image-d
-00009540: 6174 6174 696d 653e 3a3c 7661 6c75 653e  atatime>:<value>
-00009550: 2c2e 2e2e 7d20 6973 2072 6574 7572 6e65  ,...} is returne
-00009560: 640a 2020 2020 2020 2020 2020 2020 756e  d.            un
-00009570: 6c65 7373 2064 6566 6175 6c74 5f6f 6e6c  less default_onl
-00009580: 7920 3d20 4661 6c73 652c 2074 6865 6e20  y = False, then 
-00009590: 6465 6661 756c 7420 7661 6c75 6573 2061  default values a
-000095a0: 7420 696e 6465 7820 3020 6973 2072 6574  t index 0 is ret
-000095b0: 7572 6e65 642e 0a20 2020 2020 2020 2020  urned..         
-000095c0: 2020 2052 6169 7365 7320 4966 646f 4578     Raises IfdoEx
-000095d0: 6365 7074 696f 6e20 6966 206b 6579 7320  ception if keys 
-000095e0: 646f 206e 6f74 2065 7869 7374 2e20 2222  do not exist. ""
-000095f0: 220a 0a20 2020 2020 2020 2069 6620 6e6f  "..        if no
-00009600: 7420 6d69 7174 762e 696d 6167 655f 7365  t miqtv.image_se
-00009610: 745f 6974 656d 735f 6b65 7920 696e 2069  t_items_key in i
-00009620: 6664 6f20 6f72 206e 6f74 206d 6971 7476  fdo or not miqtv
-00009630: 2e69 6d61 6765 5f73 6574 5f68 6561 6465  .image_set_heade
-00009640: 725f 6b65 7920 696e 2069 6664 6f3a 0a20  r_key in ifdo:. 
-00009650: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00009660: 206d 6971 7463 2e49 6664 6f45 7863 6570   miqtc.IfdoExcep
-00009670: 7469 6f6e 2822 496e 7661 6c69 6420 6966  tion("Invalid if
-00009680: 646f 2064 6963 742c 206d 6973 7369 6e67  do dict, missing
-00009690: 2069 7465 6d73 206f 7220 6865 6164 6572   items or header
-000096a0: 206b 6579 3a20 2220 2b20 7374 7228 6966   key: " + str(if
-000096b0: 646f 2929 0a20 2020 2020 2020 200a 2020  do)).        .  
-000096c0: 2020 2020 2020 6966 206e 6f74 2069 7369        if not isi
-000096d0: 6e73 7461 6e63 6528 6b65 7973 2c6c 6973  nstance(keys,lis
-000096e0: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
-000096f0: 6b65 7973 203d 205b 6b65 7973 5d0a 0a20  keys = [keys].. 
-00009700: 2020 2020 2020 2023 2072 656d 6f76 6520         # remove 
-00009710: 6865 6164 6572 206f 7220 6974 656d 2070  header or item p
-00009720: 7265 6669 7865 7320 6966 2074 6865 7265  refixes if there
-00009730: 0a20 2020 2020 2020 2069 6620 6b65 7973  .        if keys
-00009740: 5b30 5d20 3d3d 206d 6971 7476 2e69 6d61  [0] == miqtv.ima
-00009750: 6765 5f73 6574 5f69 7465 6d73 5f6b 6579  ge_set_items_key
-00009760: 206f 7220 6b65 7973 5b30 5d20 3d3d 206d   or keys[0] == m
-00009770: 6971 7476 2e69 6d61 6765 5f73 6574 5f68  iqtv.image_set_h
-00009780: 6561 6465 725f 6b65 793a 0a20 2020 2020  eader_key:.     
-00009790: 2020 2020 2020 206b 6579 7320 3d20 6b65         keys = ke
-000097a0: 7973 5b31 3a3a 5d0a 0a20 2020 2020 2020  ys[1::]..       
-000097b0: 2068 6561 6465 7220 3d20 6966 646f 5b6d   header = ifdo[m
-000097c0: 6971 7476 2e69 6d61 6765 5f73 6574 5f68  iqtv.image_set_h
-000097d0: 6561 6465 725f 6b65 795d 0a20 2020 2020  eader_key].     
-000097e0: 2020 2069 7465 6d73 203d 2069 6664 6f5b     items = ifdo[
-000097f0: 6d69 7174 762e 696d 6167 655f 7365 745f  miqtv.image_set_
-00009800: 6974 656d 735f 6b65 795d 0a20 2020 2020  items_key].     
-00009810: 2020 2023 206c 6f6f 6b20 666f 7220 6465     # look for de
-00009820: 6661 756c 7420 7661 6c75 650a 2020 2020  fault value.    
-00009830: 2020 2020 666f 7220 736b 6970 7065 6449      for skippedI
-00009840: 6e48 6561 6465 7220 696e 2072 616e 6765  nHeader in range
-00009850: 286c 656e 286b 6579 7329 293a 0a20 2020  (len(keys)):.   
-00009860: 2020 2020 2020 2020 2064 6566 6175 6c74           default
-00009870: 5661 6c20 3d20 6669 6e64 4669 656c 6428  Val = findField(
-00009880: 6865 6164 6572 2c6b 6579 735b 736b 6970  header,keys[skip
-00009890: 7065 6449 6e48 6561 6465 723a 3a5d 290a  pedInHeader::]).
-000098a0: 2020 2020 2020 2020 2020 2020 6966 2064              if d
-000098b0: 6566 6175 6c74 5661 6c20 213d 2022 223a  efaultVal != "":
-000098c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000098d0: 2062 7265 616b 0a0a 2020 2020 2020 2020   break..        
-000098e0: 2323 206c 6f6f 6b20 666f 7220 6974 656d  ## look for item
-000098f0: 2076 616c 7565 0a20 2020 2020 2020 2023   value.        #
-00009900: 2068 6561 6465 7220 6f6e 6c79 2076 616c   header only val
-00009910: 7565 2c20 646f 6e27 7420 6368 6563 6b20  ue, don't check 
-00009920: 696e 2069 7465 6d73 0a20 2020 2020 2020  in items.       
-00009930: 2069 6620 6669 6e64 4669 656c 6428 6974   if findField(it
-00009940: 656d 732c 6b65 7973 5b30 3a31 5d29 203d  ems,keys[0:1]) =
-00009950: 3d20 2222 2061 6e64 2073 6b69 7070 6564  = "" and skipped
-00009960: 496e 4865 6164 6572 203d 3d20 303a 0a20  InHeader == 0:. 
-00009970: 2020 2020 2020 2020 2020 2072 6574 203d             ret =
-00009980: 2064 6566 6175 6c74 5661 6c0a 2020 2020   defaultVal.    
-00009990: 2020 2020 2020 2020 6966 2072 6574 203d          if ret =
-000099a0: 3d20 2222 3a0a 2020 2020 2020 2020 2020  = "":.          
-000099b0: 2020 2020 2020 7261 6973 6520 6d69 7174        raise miqt
-000099c0: 632e 4966 646f 4578 6365 7074 696f 6e28  c.IfdoException(
-000099d0: 226b 6579 2064 6f65 7320 6e6f 7420 6578  "key does not ex
-000099e0: 6973 743a 2220 2b20 7374 7228 6b65 7973  ist:" + str(keys
-000099f0: 2929 0a20 2020 2020 2020 2065 6c73 653a  )).        else:
-00009a00: 0a20 2020 2020 2020 2020 2020 2023 2069  .            # i
-00009a10: 6620 6669 7273 7420 6b65 7920 6e6f 7420  f first key not 
-00009a20: 666f 756e 6420 696e 2069 7465 6d73 2c20  found in items, 
-00009a30: 692e 652e 2069 7320 6e6f 7420 6120 696d  i.e. is not a im
-00009a40: 6167 6520 6e61 6d65 2c20 616e 6420 6669  age name, and fi
-00009a50: 7273 7420 6b65 7920 6973 206e 6f74 2061  rst key is not a
-00009a60: 2068 6561 6465 7220 6b65 793a 0a20 2020   header key:.   
-00009a70: 2020 2020 2020 2020 2069 6620 6669 6e64           if find
-00009a80: 4669 656c 6428 6974 656d 732c 6b65 7973  Field(items,keys
-00009a90: 5b30 3a31 5d29 203d 3d20 2222 2061 6e64  [0:1]) == "" and
-00009aa0: 2073 6b69 7070 6564 496e 4865 6164 6572   skippedInHeader
-00009ab0: 2021 3d20 303a 0a20 2020 2020 2020 2020   != 0:.         
-00009ac0: 2020 2020 2020 2072 6169 7365 206d 6971         raise miq
-00009ad0: 7463 2e49 6664 6f45 7863 6570 7469 6f6e  tc.IfdoException
-00009ae0: 2822 6974 656d 2064 6f65 7320 6e6f 7420  ("item does not 
-00009af0: 6578 6973 743a 2220 2b20 7374 7228 6b65  exist:" + str(ke
-00009b00: 7973 5b30 3a31 5d29 290a 0a20 2020 2020  ys[0:1]))..     
-00009b10: 2020 2020 2020 2023 2063 6865 636b 2069         # check i
-00009b20: 6620 696e 6465 7820 7072 6f76 6964 6564  f index provided
-00009b30: 0a20 2020 2020 2020 2020 2020 2069 6e64  .            ind
-00009b40: 6578 5072 6f76 6964 6564 203d 2054 7275  exProvided = Tru
-00009b50: 650a 2020 2020 2020 2020 2020 2020 6966  e.            if
-00009b60: 206c 656e 286b 6579 7329 203e 2031 3a0a   len(keys) > 1:.
-00009b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009b80: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-00009b90: 2020 2020 2020 2020 2069 6e64 6578 203d           index =
-00009ba0: 2069 6e74 286b 6579 735b 315d 290a 2020   int(keys[1]).  
-00009bb0: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-00009bc0: 6365 7074 2045 7863 6570 7469 6f6e 3a0a  cept Exception:.
-00009bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009be0: 2020 2020 696e 6465 7850 726f 7669 6465      indexProvide
-00009bf0: 6420 3d20 4661 6c73 650a 2020 2020 2020  d = False.      
-00009c00: 2020 2020 2020 656c 6966 206c 656e 286b        elif len(k
-00009c10: 6579 7329 203d 3d20 313a 0a20 2020 2020  eys) == 1:.     
-00009c20: 2020 2020 2020 2020 2020 2069 6e64 6578             index
-00009c30: 5072 6f76 6964 6564 203d 2046 616c 7365  Provided = False
-00009c40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009c50: 200a 2020 2020 2020 2020 2020 2020 696d   .            im
-00009c60: 6167 6549 7465 6d54 696d 6550 6f69 6e74  ageItemTimePoint
-00009c70: 7320 3d20 6974 656d 735b 6b65 7973 5b30  s = items[keys[0
-00009c80: 5d5d 0a0a 2020 2020 2020 2020 2020 2020  ]]..            
-00009c90: 6966 2069 6e64 6578 5072 6f76 6964 6564  if indexProvided
-00009ca0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00009cb0: 2020 2320 6966 206b 6579 2069 7320 7768    # if key is wh
-00009cc0: 6f6c 6520 696d 6167 6520 6164 6420 616c  ole image add al
-00009cd0: 6c20 7661 6c75 6573 2066 726f 6d20 6865  l values from he
-00009ce0: 6164 6572 0a20 2020 2020 2020 2020 2020  ader.           
-00009cf0: 2020 2020 2069 6620 6c65 6e28 6b65 7973       if len(keys
-00009d00: 2920 3d3d 2032 3a0a 2020 2020 2020 2020  ) == 2:.        
-00009d10: 2020 2020 2020 2020 2020 2020 6465 6661              defa
-00009d20: 756c 7456 616c 203d 2068 6561 6465 720a  ultVal = header.
-00009d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009d40: 2320 6164 6420 6465 6661 756c 7420 6672  # add default fr
-00009d50: 6f6d 2069 6e64 6578 2030 0a20 2020 2020  om index 0.     
-00009d60: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
-00009d70: 6e28 6b65 7973 2920 3e20 3120 616e 6420  n(keys) > 1 and 
-00009d80: 696e 6465 7820 213d 2030 3a0a 2020 2020  index != 0:.    
-00009d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009da0: 6b65 7973 5f30 203d 2063 6f70 792e 6465  keys_0 = copy.de
-00009db0: 6570 636f 7079 286b 6579 7329 0a20 2020  epcopy(keys).   
-00009dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009dd0: 206b 6579 735f 305b 315d 203d 2030 0a20   keys_0[1] = 0. 
-00009de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009df0: 2020 2072 6574 5f30 203d 2069 4644 4f2e     ret_0 = iFDO.
-00009e00: 5f5f 6765 7449 7465 6d56 616c 7565 2869  __getItemValue(i
-00009e10: 7465 6d73 2c6b 6579 735f 302c 736b 6970  tems,keys_0,skip
-00009e20: 7065 6449 6e48 6561 6465 722c 6465 6661  pedInHeader,defa
-00009e30: 756c 7456 616c 290a 2020 2020 2020 2020  ultVal).        
-00009e40: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-00009e50: 7369 6e73 7461 6e63 6528 7265 745f 302c  sinstance(ret_0,
-00009e60: 6469 6374 293a 0a20 2020 2020 2020 2020  dict):.         
-00009e70: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00009e80: 6566 6175 6c74 5661 6c20 3d20 7b2a 2a64  efaultVal = {**d
-00009e90: 6566 6175 6c74 5661 6c2c 2a2a 7265 745f  efaultVal,**ret_
-00009ea0: 307d 0a20 2020 2020 2020 2020 2020 2020  0}.             
-00009eb0: 2020 2072 6574 203d 2069 4644 4f2e 5f5f     ret = iFDO.__
-00009ec0: 6765 7449 7465 6d56 616c 7565 2869 7465  getItemValue(ite
-00009ed0: 6d73 2c6b 6579 732c 736b 6970 7065 6449  ms,keys,skippedI
-00009ee0: 6e48 6561 6465 722c 6465 6661 756c 7456  nHeader,defaultV
-00009ef0: 616c 290a 2020 2020 2020 2020 2020 2020  al).            
-00009f00: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-00009f10: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00009f20: 2020 2023 2069 6620 6b65 7920 6973 2077     # if key is w
-00009f30: 686f 6c65 2069 6d61 6765 2061 6464 2061  hole image add a
-00009f40: 6c6c 2076 616c 7565 7320 6672 6f6d 2068  ll values from h
-00009f50: 6561 6465 720a 2020 2020 2020 2020 2020  eader.          
-00009f60: 2020 2020 2020 6966 206c 656e 286b 6579        if len(key
-00009f70: 7329 203d 3d20 313a 0a20 2020 2020 2020  s) == 1:.       
-00009f80: 2020 2020 2020 2020 2020 2020 2064 6566               def
-00009f90: 6175 6c74 5661 6c20 3d20 6865 6164 6572  aultVal = header
-00009fa0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00009fb0: 2020 2320 7069 6374 7572 6520 2d3e 206a    # picture -> j
-00009fc0: 7573 7420 6f6e 6520 656e 7472 792c 2069  ust one entry, i
-00009fd0: 6e73 6572 7420 696e 6465 7820 300a 2020  nsert index 0.  
-00009fe0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00009ff0: 206c 656e 2869 6d61 6765 4974 656d 5469   len(imageItemTi
-0000a000: 6d65 506f 696e 7473 2920 3d3d 2031 3a0a  mePoints) == 1:.
-0000a010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a020: 2020 2020 6b65 7973 203d 206b 6579 735b      keys = keys[
-0000a030: 303a 315d 202b 205b 305d 202b 206b 6579  0:1] + [0] + key
-0000a040: 735b 313a 3a5d 0a20 2020 2020 2020 2020  s[1::].         
-0000a050: 2020 2020 2020 2020 2020 2072 6574 203d             ret =
-0000a060: 2069 4644 4f2e 5f5f 6765 7449 7465 6d56   iFDO.__getItemV
-0000a070: 616c 7565 2869 7465 6d73 2c6b 6579 732c  alue(items,keys,
-0000a080: 736b 6970 7065 6449 6e48 6561 6465 722c  skippedInHeader,
-0000a090: 6465 6661 756c 7456 616c 290a 2020 2020  defaultVal).    
-0000a0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a0b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a0c0: 2023 2076 6964 656f 202d 3e20 7265 7475   # video -> retu
-0000a0d0: 726e 2076 616c 7565 7320 666f 7220 6561  rn values for ea
-0000a0e0: 6368 2074 696d 6520 7374 616d 700a 2020  ch time stamp.  
-0000a0f0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-0000a100: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0000a110: 2020 2020 2020 2020 7265 7420 3d20 7b7d          ret = {}
-0000a120: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a130: 2020 2020 2066 6f72 2069 2069 6e20 7261       for i in ra
-0000a140: 6e67 6528 6c65 6e28 696d 6167 6549 7465  nge(len(imageIte
-0000a150: 6d54 696d 6550 6f69 6e74 7329 293a 0a20  mTimePoints)):. 
-0000a160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a170: 2020 2020 2020 2074 696d 6550 6f69 6e74         timePoint
-0000a180: 4461 7461 203d 2069 6d61 6765 4974 656d  Data = imageItem
-0000a190: 5469 6d65 506f 696e 7473 5b69 5d0a 2020  TimePoints[i].  
-0000a1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a1b0: 2020 2020 2020 6b65 7973 5f69 203d 206b        keys_i = k
-0000a1c0: 6579 735b 303a 315d 202b 205b 695d 202b  eys[0:1] + [i] +
-0000a1d0: 206b 6579 735b 313a 3a5d 0a20 2020 2020   keys[1::].     
-0000a1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a1f0: 2020 2076 616c 5f69 203d 2069 4644 4f2e     val_i = iFDO.
-0000a200: 5f5f 6765 7449 7465 6d56 616c 7565 2869  __getItemValue(i
-0000a210: 7465 6d73 2c6b 6579 735f 692c 736b 6970  tems,keys_i,skip
-0000a220: 7065 6449 6e48 6561 6465 722c 6465 6661  pedInHeader,defa
-0000a230: 756c 7456 616c 290a 2020 2020 2020 2020  ultVal).        
-0000a240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a250: 2320 6465 6661 756c 7420 6f6e 6c79 0a20  # default only. 
-0000a260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a270: 2020 2020 2020 2069 6620 6465 6661 756c         if defaul
-0000a280: 745f 6f6e 6c79 3a0a 2020 2020 2020 2020  t_only:.        
-0000a290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a2a0: 2020 2020 7265 7420 3d20 7661 6c5f 690a      ret = val_i.
-0000a2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a2c0: 2020 2020 2020 2020 2020 2020 6272 6561              brea
-0000a2d0: 6b0a 2020 2020 2020 2020 2020 2020 2020  k.              
-0000a2e0: 2020 2020 2020 2020 2020 7265 745b 7469            ret[ti
-0000a2f0: 6d65 506f 696e 7444 6174 615b 2769 6d61  mePointData['ima
-0000a300: 6765 2d64 6174 6574 696d 6527 5d5d 203d  ge-datetime']] =
-0000a310: 2076 616c 5f69 0a20 2020 2020 2020 2020   val_i.         
-0000a320: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0000a330: 2072 656d 6f76 6520 696d 6167 652d 6461   remove image-da
-0000a340: 7465 7469 6d65 2069 6620 7468 6572 650a  tetime if there.
-0000a350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a360: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-0000a370: 7461 6e63 6528 7265 745b 7469 6d65 506f  tance(ret[timePo
-0000a380: 696e 7444 6174 615b 2769 6d61 6765 2d64  intData['image-d
-0000a390: 6174 6574 696d 6527 5d5d 2c64 6963 7429  atetime']],dict)
-0000a3a0: 2061 6e64 2027 696d 6167 652d 6461 7465   and 'image-date
-0000a3b0: 7469 6d65 2720 696e 2072 6574 5b74 696d  time' in ret[tim
-0000a3c0: 6550 6f69 6e74 4461 7461 5b27 696d 6167  ePointData['imag
-0000a3d0: 652d 6461 7465 7469 6d65 275d 5d3a 0a20  e-datetime']]:. 
-0000a3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a3f0: 2020 2020 2020 2020 2020 2064 656c 2072             del r
-0000a400: 6574 5b74 696d 6550 6f69 6e74 4461 7461  et[timePointData
-0000a410: 5b27 696d 6167 652d 6461 7465 7469 6d65  ['image-datetime
-0000a420: 275d 5d5b 2769 6d61 6765 2d64 6174 6574  ']]['image-datet
-0000a430: 696d 6527 5d0a 2020 2020 2020 2020 2020  ime'].          
-0000a440: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0000a450: 7669 6465 6f20 6465 6661 756c 7473 0a20  video defaults. 
-0000a460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a470: 2020 2020 2020 2069 6620 6920 3d3d 2030         if i == 0
-0000a480: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000a490: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0000a4a0: 2069 7369 6e73 7461 6e63 6528 7265 745b   isinstance(ret[
-0000a4b0: 7469 6d65 506f 696e 7444 6174 615b 2769  timePointData['i
-0000a4c0: 6d61 6765 2d64 6174 6574 696d 6527 5d5d  mage-datetime']]
-0000a4d0: 2c64 6963 7429 3a0a 2020 2020 2020 2020  ,dict):.        
-0000a4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a4f0: 2020 2020 2020 2020 6465 6661 756c 7456          defaultV
-0000a500: 616c 203d 207b 2a2a 6465 6661 756c 7456  al = {**defaultV
-0000a510: 616c 2c2a 2a72 6574 5b74 696d 6550 6f69  al,**ret[timePoi
-0000a520: 6e74 4461 7461 5b27 696d 6167 652d 6461  ntData['image-da
-0000a530: 7465 7469 6d65 275d 5d7d 0a20 2020 2020  tetime']]}.     
-0000a540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a550: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0000a560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a570: 2020 2020 2020 2020 2020 2020 2064 6566               def
-0000a580: 6175 6c74 5661 6c20 3d20 7265 745b 7469  aultVal = ret[ti
-0000a590: 6d65 506f 696e 7444 6174 615b 2769 6d61  mePointData['ima
-0000a5a0: 6765 2d64 6174 6574 696d 6527 5d5d 0a0a  ge-datetime']]..
-0000a5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a5c0: 2020 2020 2020 2020 6920 2b3d 2031 0a0a          i += 1..
-0000a5d0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-0000a5e0: 7461 6e63 6528 7265 742c 6469 6374 2920  tance(ret,dict) 
-0000a5f0: 6f72 2069 7369 6e73 7461 6e63 6528 7265  or isinstance(re
-0000a600: 742c 6c69 7374 293a 0a20 2020 2020 2020  t,list):.       
-0000a610: 2020 2020 2072 6574 203d 2063 6f70 792e       ret = copy.
-0000a620: 6465 6570 636f 7079 2872 6574 290a 2020  deepcopy(ret).  
-0000a630: 2020 2020 2020 6966 2072 6574 203d 3d20        if ret == 
-0000a640: 2222 206f 7220 7265 7420 3d3d 207b 7d3a  "" or ret == {}:
-0000a650: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-0000a660: 7365 206d 6971 7463 2e49 6664 6f45 7863  se miqtc.IfdoExc
-0000a670: 6570 7469 6f6e 2822 6b65 7973 2064 6f20  eption("keys do 
-0000a680: 6e6f 7420 6578 6973 743a 2220 2b20 7374  not exist:" + st
-0000a690: 7228 6b65 7973 2929 0a20 2020 2020 2020  r(keys)).       
-0000a6a0: 2072 6574 7572 6e20 7265 740a 0a0a 2020   return ret...  
-0000a6b0: 2020 4073 7461 7469 636d 6574 686f 640a    @staticmethod.
-0000a6c0: 2020 2020 6465 6620 5f5f 6765 7449 7465      def __getIte
-0000a6d0: 6d56 616c 7565 2869 7465 6d73 2c6b 6579  mValue(items,key
-0000a6e0: 732c 736b 6970 7065 6449 6e48 6561 6465  s,skippedInHeade
-0000a6f0: 722c 6465 6661 756c 7456 616c 293a 0a20  r,defaultVal):. 
-0000a700: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-0000a710: 2320 696e 2063 6173 6520 6974 656d 2069  # in case item i
-0000a720: 7320 6e6f 7420 6120 6c69 7374 2028 7368  s not a list (sh
-0000a730: 6f75 6c64 206e 6f74 2062 6520 706f 7373  ould not be poss
-0000a740: 6962 6c65 290a 2020 2020 2020 2020 6966  ible).        if
-0000a750: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
-0000a760: 6974 656d 735b 6b65 7973 5b30 5d5d 2c6c  items[keys[0]],l
-0000a770: 6973 7429 3a0a 2020 2020 2020 2020 2020  ist):.          
-0000a780: 2020 6974 656d 735b 6b65 7973 5b30 5d5d    items[keys[0]]
-0000a790: 203d 205b 6974 656d 735b 6b65 7973 5b30   = [items[keys[0
-0000a7a0: 5d5d 5d0a 0a20 2020 2020 2020 2069 7465  ]]]..        ite
-0000a7b0: 6d56 616c 7565 203d 2066 696e 6446 6965  mValue = findFie
-0000a7c0: 6c64 2869 7465 6d73 2c6b 6579 7329 0a0a  ld(items,keys)..
-0000a7d0: 2020 2020 2020 2020 6966 2069 7465 6d56          if itemV
-0000a7e0: 616c 7565 203d 3d20 2222 3a0a 2020 2020  alue == "":.    
-0000a7f0: 2020 2020 2020 2020 7265 7420 3d20 6465          ret = de
-0000a800: 6661 756c 7456 616c 0a20 2020 2020 2020  faultVal.       
-0000a810: 2023 2069 6e20 6361 7365 206f 6620 6469   # in case of di
-0000a820: 6374 7320 6a6f 696e 7420 6865 6164 6572  cts joint header
-0000a830: 2061 6e64 2069 7465 6d20 6669 656c 6473   and item fields
-0000a840: 0a20 2020 2020 2020 2065 6c69 6620 6973  .        elif is
-0000a850: 696e 7374 616e 6365 2869 7465 6d56 616c  instance(itemVal
-0000a860: 7565 2c64 6963 7429 2061 6e64 2064 6566  ue,dict) and def
-0000a870: 6175 6c74 5661 6c20 213d 2022 223a 0a20  aultVal != "":. 
-0000a880: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-0000a890: 7420 6973 696e 7374 616e 6365 2864 6566  t isinstance(def
-0000a8a0: 6175 6c74 5661 6c2c 6469 6374 293a 0a20  aultVal,dict):. 
-0000a8b0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000a8c0: 6169 7365 206d 6971 7463 2e49 6664 6f45  aise miqtc.IfdoE
-0000a8d0: 7863 6570 7469 6f6e 2822 4974 656d 2066  xception("Item f
-0000a8e0: 6965 6c64 2069 7320 6469 6374 2062 7574  ield is dict but
-0000a8f0: 2064 6566 6175 6c74 2076 616c 7565 2069   default value i
-0000a900: 6e20 6865 6164 6572 2069 7320 6e6f 743a  n header is not:
-0000a910: 2022 202b 2073 7472 286b 6579 7329 290a   " + str(keys)).
-0000a920: 2020 2020 2020 2020 2020 2020 7265 7420              ret 
-0000a930: 3d20 7b2a 2a64 6566 6175 6c74 5661 6c2c  = {**defaultVal,
-0000a940: 2a2a 6974 656d 5661 6c75 657d 0a20 2020  **itemValue}.   
-0000a950: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0000a960: 2020 2020 2020 2072 6574 203d 2069 7465         ret = ite
-0000a970: 6d56 616c 7565 0a20 2020 2020 2020 2072  mValue.        r
-0000a980: 6574 7572 6e20 7265 740a 0a0a 2020 2020  eturn ret...    
-0000a990: 6465 6620 5f5f 7374 725f 5f28 7365 6c66  def __str__(self
-0000a9a0: 2920 2d3e 2073 7472 3a0a 2020 2020 2020  ) -> str:.      
-0000a9b0: 2020 2222 2220 5072 696e 7473 2063 7572    """ Prints cur
-0000a9c0: 7265 6e74 2069 4644 4f20 6669 6c65 2022  rent iFDO file "
-0000a9d0: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
-0000a9e0: 6e20 7961 6d6c 2e64 756d 7028 7365 6c66  n yaml.dump(self
-0000a9f0: 2e69 6664 6f5f 6368 6563 6b65 642c 2064  .ifdo_checked, d
-0000aa00: 6566 6175 6c74 5f73 7479 6c65 3d4e 6f6e  efault_style=Non
-0000aa10: 652c 2064 6566 6175 6c74 5f66 6c6f 775f  e, default_flow_
-0000aa20: 7374 796c 653d 4e6f 6e65 2c20 616c 6c6f  style=None, allo
-0000aa30: 775f 756e 6963 6f64 653d 5472 7565 2c20  w_unicode=True, 
-0000aa40: 7769 6474 683d 666c 6f61 7428 2269 6e66  width=float("inf
-0000aa50: 2229 290a 0a0a 2020 2020 6465 6620 5f5f  "))...    def __
-0000aa60: 6765 7469 7465 6d5f 5f28 7365 6c66 2c20  getitem__(self, 
-0000aa70: 6b65 7973 293a 0a20 2020 2020 2020 2022  keys):.        "
-0000aa80: 2222 2052 6574 7572 6e73 2063 6f70 7920  "" Returns copy 
-0000aa90: 6f66 2063 6865 636b 6564 2069 6664 6f20  of checked ifdo 
-0000aaa0: 7365 7420 6f72 2069 7465 6d20 6669 656c  set or item fiel
-0000aab0: 6420 7661 6c75 652c 2061 6c73 6f20 636f  d value, also co
-0000aac0: 6e73 6964 6572 6e67 2064 6566 6175 6c74  nsiderng default
-0000aad0: 2076 616c 7565 7320 6672 6f6d 2068 6561   values from hea
-0000aae0: 6465 722e 0a20 2020 2020 2020 2020 2020  der..           
-0000aaf0: 2055 7365 206b 6579 7320 6173 2065 2e67   Use keys as e.g
-0000ab00: 2e20 273c 6974 656d 3e3a 3c6b 6579 3e3a  . '<item>:<key>:
-0000ab10: 2e2e 2e27 2e20 4361 6e20 6265 2075 7365  ...'. Can be use
-0000ab20: 6420 666f 7220 6865 6164 6572 2066 6965  d for header fie
-0000ab30: 6c64 7320 6173 2077 656c 6c20 6173 2069  lds as well as i
-0000ab40: 7465 6d20 6669 656c 6473 2e0a 2020 2020  tem fields..    
-0000ab50: 2020 2020 2020 2020 4974 656d 2069 6e64          Item ind
-0000ab60: 6578 2063 616e 2062 6520 6c65 676c 6563  ex can be leglec
-0000ab70: 7465 642c 2069 6e20 6361 7365 206f 6620  ted, in case of 
-0000ab80: 7669 6465 6f20 6120 6469 6374 207b 3c69  video a dict {<i
-0000ab90: 6d61 6765 2d64 6174 6174 696d 653e 3a3c  mage-datatime>:<
-0000aba0: 7661 6c75 653e 2c2e 2e2e 7d20 6973 2072  value>,...} is r
-0000abb0: 6574 7572 6e65 642e 0a20 2020 2020 2020  eturned..       
-0000abc0: 2020 2020 2052 6169 7365 7320 4966 646f       Raises Ifdo
-0000abd0: 4578 6365 7074 696f 6e20 6966 2069 7465  Exception if ite
-0000abe0: 6d20 646f 6573 206e 6f74 2065 7869 7374  m does not exist
-0000abf0: 2e20 2222 220a 2020 2020 2020 2020 6b65  . """.        ke
-0000ac00: 7973 203d 206b 6579 732e 7370 6c69 7428  ys = keys.split(
-0000ac10: 273a 2729 0a20 2020 2020 2020 2072 6574  ':').        ret
-0000ac20: 7572 6e20 7365 6c66 2e5f 5f67 6574 4669  urn self.__getFi
-0000ac30: 656c 6456 616c 7565 2873 656c 662e 6966  eldValue(self.if
-0000ac40: 646f 5f63 6865 636b 6564 2c6b 6579 7329  do_checked,keys)
-0000ac50: 0a0a 0a20 2020 2064 6566 2066 696e 6454  ...    def findT
-0000ac60: 6d70 4669 656c 6428 7365 6c66 2c6b 6579  mpField(self,key
-0000ac70: 7329 3a0a 2020 2020 2020 2020 2222 2220  s):.        """ 
-0000ac80: 5265 7475 726e 7320 636f 7079 206f 6620  Returns copy of 
-0000ac90: 7465 6d70 6f72 6172 7920 756e 6368 6563  temporary unchec
-0000aca0: 6b65 6420 6966 646f 2073 6574 206f 7220  ked ifdo set or 
-0000acb0: 6974 656d 2066 6965 6c64 2076 616c 7565  item field value
-0000acc0: 2c20 616c 736f 2063 6f6e 7369 6465 726e  , also considern
-0000acd0: 6720 6465 6661 756c 7420 7661 6c75 6573  g default values
-0000ace0: 2066 726f 6d20 6865 6164 6572 2e0a 2020   from header..  
-0000acf0: 2020 2020 2020 2020 2020 5573 6520 6b65            Use ke
-0000ad00: 7973 2061 7320 652e 672e 2027 3c69 7465  ys as e.g. '<ite
-0000ad10: 6d3e 3a3c 6b65 793e 3a2e 2e2e 272e 2043  m>:<key>:...'. C
-0000ad20: 616e 2062 6520 7573 6564 2066 6f72 2068  an be used for h
-0000ad30: 6561 6465 7220 6669 656c 6473 2061 7320  eader fields as 
-0000ad40: 7765 6c6c 2061 7320 6974 656d 2066 6965  well as item fie
-0000ad50: 6c64 732e 0a20 2020 2020 2020 2020 2020  lds..           
-0000ad60: 2049 7465 6d20 696e 6465 7820 6361 6e20   Item index can 
-0000ad70: 6265 206c 6567 6c65 6374 6564 2c20 696e  be leglected, in
-0000ad80: 2063 6173 6520 6f66 2076 6964 656f 2061   case of video a
-0000ad90: 2064 6963 7420 7b3c 696d 6167 652d 6461   dict {<image-da
-0000ada0: 7461 7469 6d65 3e3a 3c76 616c 7565 3e2c  tatime>:<value>,
-0000adb0: 2e2e 2e7d 2069 7320 7265 7475 726e 6564  ...} is returned
-0000adc0: 2e0a 2020 2020 2020 2020 2020 2020 5261  ..            Ra
-0000add0: 6973 6573 2049 6664 6f45 7863 6570 7469  ises IfdoExcepti
-0000ade0: 6f6e 2069 6620 6974 656d 2064 6f65 7320  on if item does 
-0000adf0: 6e6f 7420 6578 6973 742e 2022 2222 0a20  not exist. """. 
-0000ae00: 2020 2020 2020 206b 6579 7320 3d20 6b65         keys = ke
-0000ae10: 7973 2e73 706c 6974 2827 3a27 290a 2020  ys.split(':').  
-0000ae20: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0000ae30: 662e 5f5f 6765 7446 6965 6c64 5661 6c75  f.__getFieldValu
-0000ae40: 6528 7365 6c66 2e69 6664 6f5f 746d 702c  e(self.ifdo_tmp,
-0000ae50: 6b65 7973 290a 2020 2020 0a0a 2020 2020  keys).    ..    
-0000ae60: 6465 6620 6669 6e64 546d 7046 6965 6c64  def findTmpField
-0000ae70: 3228 7365 6c66 2c6b 6579 7329 3a0a 2020  2(self,keys):.  
-0000ae80: 2020 2020 2020 2222 2220 5361 6d65 2061        """ Same a
-0000ae90: 7320 6669 6e64 546d 7046 6965 6c64 2069  s findTmpField i
-0000aea0: 6e73 7465 6164 206f 6620 7261 6973 696e  nstead of raisin
-0000aeb0: 6720 6578 6365 7074 696f 6e20 6974 2072  g exception it r
-0000aec0: 6574 7572 6e20 656d 7074 7920 7374 7269  eturn empty stri
-0000aed0: 6e67 2e20 2222 220a 2020 2020 2020 2020  ng. """.        
-0000aee0: 6b65 7973 203d 206b 6579 732e 7370 6c69  keys = keys.spli
-0000aef0: 7428 273a 2729 0a20 2020 2020 2020 2074  t(':').        t
-0000af00: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-0000af10: 7265 7420 3d20 7365 6c66 2e5f 5f67 6574  ret = self.__get
-0000af20: 4669 656c 6456 616c 7565 2873 656c 662e  FieldValue(self.
-0000af30: 6966 646f 5f74 6d70 2c6b 6579 7329 0a20  ifdo_tmp,keys). 
-0000af40: 2020 2020 2020 2065 7863 6570 7420 6d69         except mi
-0000af50: 7174 632e 4966 646f 4578 6365 7074 696f  qtc.IfdoExceptio
-0000af60: 6e3a 0a20 2020 2020 2020 2020 2020 2072  n:.            r
-0000af70: 6574 203d 2022 220a 2020 2020 2020 2020  et = "".        
-0000af80: 7265 7475 726e 2072 6574 0a0a 0a20 2020  return ret...   
-0000af90: 2064 6566 2073 6574 6946 444f 4865 6164   def setiFDOHead
-0000afa0: 6572 4669 656c 6473 2873 656c 662c 2068  erFields(self, h
-0000afb0: 6561 6465 723a 2064 6963 7429 3a0a 2020  eader: dict):.  
-0000afc0: 2020 2020 2020 2222 2220 436c 6561 7273        """ Clears
-0000afd0: 2063 7572 7265 6e74 2068 6561 6465 7220   current header 
-0000afe0: 6669 656c 6473 2075 6e64 2073 6574 7320  fields und sets 
-0000aff0: 7072 6f76 6964 6564 2066 6965 6c64 2076  provided field v
-0000b000: 616c 7565 732e 2046 6f72 2075 7064 6174  alues. For updat
-0000b010: 696e 6720 6578 6973 7469 6e67 206f 6e65  ing existing one
-0000b020: 7320 7573 6520 7570 6461 7465 5f69 6664  s use update_ifd
-0000b030: 6f5f 6865 6164 6572 5f66 6965 6c64 7328  o_header_fields(
-0000b040: 2920 2222 220a 2020 2020 2020 2020 7365  ) """.        se
-0000b050: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
-0000b060: 2e69 6d61 6765 5365 7448 6561 6465 724b  .imageSetHeaderK
-0000b070: 6579 5d20 3d20 7b7d 0a20 2020 2020 2020  ey] = {}.       
-0000b080: 2069 6620 7365 6c66 2e69 6d61 6765 5365   if self.imageSe
-0000b090: 7448 6561 6465 724b 6579 2069 6e20 6865  tHeaderKey in he
-0000b0a0: 6164 6572 3a0a 2020 2020 2020 2020 2020  ader:.          
-0000b0b0: 2020 6865 6164 6572 203d 2068 6561 6465    header = heade
-0000b0c0: 725b 7365 6c66 2e69 6d61 6765 5365 7448  r[self.imageSetH
-0000b0d0: 6561 6465 724b 6579 5d0a 2020 2020 2020  eaderKey].      
-0000b0e0: 2020 666f 7220 6669 656c 6420 696e 2068    for field in h
-0000b0f0: 6561 6465 723a 0a20 2020 2020 2020 2020  eader:.         
-0000b100: 2020 2023 6966 2066 6965 6c64 206e 6f74     #if field not
-0000b110: 2069 6e20 6d69 7174 762e 6966 646f 5f68   in miqtv.ifdo_h
-0000b120: 6561 6465 725f 636f 7265 5f66 6965 6c64  eader_core_field
-0000b130: 733a 0a20 2020 2020 2020 2020 2020 2023  s:.            #
-0000b140: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
-0000b150: 6728 2243 6175 7469 6f6e 2120 556e 6b6e  g("Caution! Unkn
-0000b160: 6f77 6e20 6865 6164 6572 2066 6965 6c64  own header field
-0000b170: 205c 2222 202b 2066 6965 6c64 202b 2022   \"" + field + "
-0000b180: 5c22 2e20 4d61 7962 6520 6120 7479 706f  \". Maybe a typo
-0000b190: 3f20 4f74 6865 7277 6973 6520 6967 6e6f  ? Otherwise igno
-0000b1a0: 7265 206d 652e 2229 0a20 2020 2020 2020  re me.").       
-0000b1b0: 2020 2020 2073 656c 662e 6966 646f 5f74       self.ifdo_t
-0000b1c0: 6d70 5b73 656c 662e 696d 6167 6553 6574  mp[self.imageSet
-0000b1d0: 4865 6164 6572 4b65 795d 5b66 6965 6c64  HeaderKey][field
-0000b1e0: 5d20 3d20 6865 6164 6572 5b66 6965 6c64  ] = header[field
-0000b1f0: 5d0a 0a0a 2020 2020 6465 6620 7570 6461  ]...    def upda
-0000b200: 7465 5f69 6664 6f5f 6865 6164 6572 5f66  te_ifdo_header_f
-0000b210: 6965 6c64 7328 7365 6c66 2c20 6865 6164  ields(self, head
-0000b220: 6572 3a20 6469 6374 293a 0a20 2020 2020  er: dict):.     
-0000b230: 2020 2022 2222 2055 7064 6174 6573 2065     """ Updates e
-0000b240: 7869 7374 696e 6720 6865 6164 6572 2066  xisting header f
-0000b250: 6965 6c64 7320 2222 220a 2020 2020 2020  ields """.      
-0000b260: 2020 6966 2073 656c 662e 696d 6167 6553    if self.imageS
-0000b270: 6574 4865 6164 6572 4b65 7920 696e 2068  etHeaderKey in h
-0000b280: 6561 6465 723a 0a20 2020 2020 2020 2020  eader:.         
-0000b290: 2020 2068 6561 6465 7220 3d20 6865 6164     header = head
-0000b2a0: 6572 5b73 656c 662e 696d 6167 6553 6574  er[self.imageSet
-0000b2b0: 4865 6164 6572 4b65 795d 0a20 2020 2020  HeaderKey].     
-0000b2c0: 2020 206c 6f67 203d 206d 6971 7463 2e72     log = miqtc.r
-0000b2d0: 6563 7572 7369 7665 6c79 5570 6461 7465  ecursivelyUpdate
-0000b2e0: 4469 6374 7328 7365 6c66 2e69 6664 6f5f  Dicts(self.ifdo_
-0000b2f0: 746d 705b 7365 6c66 2e69 6d61 6765 5365  tmp[self.imageSe
-0000b300: 7448 6561 6465 724b 6579 5d2c 2068 6561  tHeaderKey], hea
-0000b310: 6465 7229 0a20 2020 2020 2020 2073 656c  der).        sel
-0000b320: 662e 7072 6f76 2e6c 6f67 286c 6f67 2c64  f.prov.log(log,d
-0000b330: 6f6e 7453 686f 773d 5472 7565 290a 0a20  ontShow=True).. 
-0000b340: 2020 2064 6566 2075 7064 6174 6569 4644     def updateiFD
-0000b350: 4f48 6561 6465 7246 6965 6c64 7328 7365  OHeaderFields(se
-0000b360: 6c66 2c20 6865 6164 6572 3a20 6469 6374  lf, header: dict
-0000b370: 293a 0a20 2020 2020 2020 2022 2222 2044  ):.        """ D
-0000b380: 6570 7265 6361 7465 6420 2d20 7573 6520  eprecated - use 
-0000b390: 7570 6461 7465 5f69 6664 6f5f 6865 6164  update_ifdo_head
-0000b3a0: 6572 5f66 6965 6c64 7320 2222 220a 2020  er_fields """.  
-0000b3b0: 2020 2020 2020 7365 6c66 2e75 7064 6174        self.updat
-0000b3c0: 655f 6966 646f 5f68 6561 6465 725f 6669  e_ifdo_header_fi
-0000b3d0: 656c 6473 2868 6561 6465 7229 0a0a 0a20  elds(header)... 
-0000b3e0: 2020 2064 6566 205f 7472 795f 7570 6772     def _try_upgr
-0000b3f0: 6164 655f 746f 5f69 6664 6f5f 7665 7273  ade_to_ifdo_vers
-0000b400: 696f 6e5f 3278 2873 656c 6629 3a0a 2020  ion_2x(self):.  
-0000b410: 2020 2020 2020 2222 2220 5472 7920 746f        """ Try to
-0000b420: 2063 6f6e 7665 7274 2066 6965 6c64 7320   convert fields 
-0000b430: 6672 6f6d 2069 4644 4f20 7665 7273 696f  from iFDO versio
-0000b440: 6e20 3c20 322e 302e 3020 746f 2032 2e78  n < 2.0.0 to 2.x
-0000b450: 2022 2222 0a20 2020 2020 2020 2072 6561   """.        rea
-0000b460: 645f 7665 7273 696f 6e5f 7374 7220 3d20  d_version_str = 
-0000b470: 2276 312e 302e 3022 2023 2064 6964 206e  "v1.0.0" # did n
-0000b480: 6f74 2068 6176 6520 7468 6520 2769 6d61  ot have the 'ima
-0000b490: 6765 2d73 6574 2d69 6664 6f2d 7665 7273  ge-set-ifdo-vers
-0000b4a0: 696f 6e27 2066 6965 6c64 2079 6574 0a20  ion' field yet. 
-0000b4b0: 2020 2020 2020 2074 7279 3a20 0a20 2020         try: .   
-0000b4c0: 2020 2020 2020 2020 2072 6561 645f 7665           read_ve
-0000b4d0: 7273 696f 6e5f 7374 7220 3d20 7365 6c66  rsion_str = self
-0000b4e0: 2e66 696e 6454 6d70 4669 656c 6428 2769  .findTmpField('i
-0000b4f0: 6d61 6765 2d73 6574 2d69 6664 6f2d 7665  mage-set-ifdo-ve
-0000b500: 7273 696f 6e27 290a 2020 2020 2020 2020  rsion').        
-0000b510: 6578 6365 7074 206d 6971 7463 2e49 6664  except miqtc.Ifd
-0000b520: 6f45 7863 6570 7469 6f6e 3a0a 2020 2020  oException:.    
-0000b530: 2020 2020 2020 2020 7061 7373 0a20 2020          pass.   
-0000b540: 2020 2020 2072 6561 645f 7665 7273 696f       read_versio
-0000b550: 6e20 3d20 5665 7273 696f 6e28 7265 6164  n = Version(read
-0000b560: 5f76 6572 7369 6f6e 5f73 7472 290a 0a20  _version_str).. 
-0000b570: 2020 2020 2020 2069 6620 7265 6164 5f76         if read_v
-0000b580: 6572 7369 6f6e 203c 2056 6572 7369 6f6e  ersion < Version
-0000b590: 2822 322e 302e 3022 293a 0a20 2020 2020  ("2.0.0"):.     
-0000b5a0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-0000b5b0: 2020 2020 2320 6e65 7720 5552 4920 6f62      # new URI ob
-0000b5c0: 6a65 6374 2066 6965 6c64 730a 2020 2020  ject fields.    
-0000b5d0: 2020 2020 2020 2020 6e65 775f 7572 695f          new_uri_
-0000b5e0: 6669 656c 6473 203d 205b 2769 6d61 6765  fields = ['image
-0000b5f0: 2d73 656e 736f 7227 2c27 696d 6167 652d  -sensor','image-
-0000b600: 6576 656e 7427 2c27 696d 6167 652d 7072  event','image-pr
-0000b610: 6f6a 6563 7427 2c27 696d 6167 652d 636f  oject','image-co
-0000b620: 6e74 6578 7427 2c27 696d 6167 652d 6c69  ntext','image-li
-0000b630: 6365 6e73 6527 2c27 696d 6167 652d 706c  cense','image-pl
-0000b640: 6174 666f 726d 275d 0a20 2020 2020 2020  atform'].       
-0000b650: 2020 2020 2066 6f72 2075 7269 5f66 6965       for uri_fie
-0000b660: 6c64 2069 6e20 6e65 775f 7572 695f 6669  ld in new_uri_fi
-0000b670: 656c 6473 3a0a 2020 2020 2020 2020 2020  elds:.          
-0000b680: 2020 2020 2020 6f6c 645f 7374 725f 7661        old_str_va
-0000b690: 6c20 3d20 7365 6c66 2e66 696e 6454 6d70  l = self.findTmp
-0000b6a0: 4669 656c 6432 2875 7269 5f66 6965 6c64  Field2(uri_field
-0000b6b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000b6c0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-0000b6d0: 6f6c 645f 7374 725f 7661 6c2c 7374 7229  old_str_val,str)
-0000b6e0: 2061 6e64 206f 6c64 5f73 7472 5f76 616c   and old_str_val
-0000b6f0: 2021 3d20 2222 3a20 2020 2020 2020 2020   != "":         
-0000b700: 2020 2020 2020 2020 2020 200a 2020 2020             .    
-0000b710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b720: 6e65 775f 6f62 6a5f 7661 6c20 3d20 7b27  new_obj_val = {'
-0000b730: 6e61 6d65 273a 206f 6c64 5f73 7472 5f76  name': old_str_v
-0000b740: 616c 7d0a 2020 2020 2020 2020 2020 2020  al}.            
-0000b750: 2020 2020 2020 2020 6973 5f75 7269 2c20          is_uri, 
-0000b760: 6d73 6720 3d20 6d69 7174 742e 7661 6c69  msg = miqtt.vali
-0000b770: 6461 7465 5f61 6761 696e 7374 5f73 6368  date_against_sch
-0000b780: 656d 6128 6f6c 645f 7374 725f 7661 6c2c  ema(old_str_val,
-0000b790: 7b22 7479 7065 223a 2022 7374 7269 6e67  {"type": "string
-0000b7a0: 222c 2266 6f72 6d61 7422 3a20 2275 7269  ","format": "uri
-0000b7b0: 227d 290a 2020 2020 2020 2020 2020 2020  "}).            
-0000b7c0: 2020 2020 2020 2020 6966 2069 735f 7572          if is_ur
-0000b7d0: 693a 0a20 2020 2020 2020 2020 2020 2020  i:.             
-0000b7e0: 2020 2020 2020 2020 2020 206e 6577 5f6f             new_o
-0000b7f0: 626a 5f76 616c 5b27 7572 6927 5d20 3d20  bj_val['uri'] = 
-0000b800: 6f6c 645f 7374 725f 7661 6c0a 2020 2020  old_str_val.    
-0000b810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b820: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
-0000b830: 6c66 2e69 6d61 6765 5365 7448 6561 6465  lf.imageSetHeade
-0000b840: 724b 6579 5d5b 7572 695f 6669 656c 645d  rKey][uri_field]
-0000b850: 203d 206e 6577 5f6f 626a 5f76 616c 0a20   = new_obj_val. 
-0000b860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b870: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
-0000b880: 2822 4175 746f 2d75 7067 7261 6465 6420  ("Auto-upgraded 
-0000b890: 2220 2b20 7572 695f 6669 656c 6420 2b20  " + uri_field + 
-0000b8a0: 2220 6672 6f6d 2022 202b 206f 6c64 5f73  " from " + old_s
-0000b8b0: 7472 5f76 616c 202b 2022 2074 6f20 2220  tr_val + " to " 
-0000b8c0: 2b20 7374 7228 6e65 775f 6f62 6a5f 7661  + str(new_obj_va
-0000b8d0: 6c29 290a 0a0a 0a20 2020 2064 6566 2074  l))....    def t
-0000b8e0: 7279 4175 746f 5365 7448 6561 6465 7246  ryAutoSetHeaderF
-0000b8f0: 6965 6c64 7328 7365 6c66 293a 0a20 2020  ields(self):.   
-0000b900: 2020 2020 2022 2222 2053 6574 7320 6365       """ Sets ce
-0000b910: 7274 6169 6e20 6865 6164 6572 2066 6965  rtain header fie
-0000b920: 6c64 7320 652e 672e 2066 726f 6d20 6469  lds e.g. from di
-0000b930: 7265 6374 6f72 7920 6966 2074 6865 7920  rectory if they 
-0000b940: 6172 6520 6e6f 7420 7365 7420 7965 7420  are not set yet 
-0000b950: 2222 220a 0a20 2020 2020 2020 2069 6620  """..        if 
-0000b960: 7365 6c66 2e66 696e 6454 6d70 4669 656c  self.findTmpFiel
-0000b970: 6432 2827 696d 6167 652d 7365 6e73 6f72  d2('image-sensor
-0000b980: 2729 203d 3d20 2222 3a0a 2020 2020 2020  ') == "":.      
-0000b990: 2020 2020 2020 7365 6c66 2e69 6664 6f5f        self.ifdo_
-0000b9a0: 746d 705b 7365 6c66 2e69 6d61 6765 5365  tmp[self.imageSe
-0000b9b0: 7448 6561 6465 724b 6579 5d5b 2769 6d61  tHeaderKey]['ima
-0000b9c0: 6765 2d73 656e 736f 7227 5d20 3d20 7b27  ge-sensor'] = {'
-0000b9d0: 6e61 6d65 273a 2073 656c 662e 6469 722e  name': self.dir.
-0000b9e0: 7365 6e73 6f72 2829 7d0a 2020 2020 2020  sensor()}.      
-0000b9f0: 2020 656c 6966 2073 656c 662e 6669 6e64    elif self.find
-0000ba00: 546d 7046 6965 6c64 2827 696d 6167 652d  TmpField('image-
-0000ba10: 7365 6e73 6f72 2729 5b27 6e61 6d65 275d  sensor')['name']
-0000ba20: 2021 3d20 7365 6c66 2e64 6972 2e73 656e   != self.dir.sen
-0000ba30: 736f 7228 293a 0a20 2020 2020 2020 2020  sor():.         
-0000ba40: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
-0000ba50: 2822 4361 7574 696f 6e21 2027 696d 6167  ("Caution! 'imag
-0000ba60: 652d 7365 6e73 6f72 2720 222b 2073 7472  e-sensor' "+ str
-0000ba70: 2873 656c 662e 6669 6e64 546d 7046 6965  (self.findTmpFie
-0000ba80: 6c64 2827 696d 6167 652d 7365 6e73 6f72  ld('image-sensor
-0000ba90: 2729 2920 2b20 2220 6469 6666 6572 7320  ')) + " differs 
-0000baa0: 6672 6f6d 2073 656e 736f 7220 7061 7273  from sensor pars
-0000bab0: 6564 2066 726f 6d20 6469 7265 6374 6f72  ed from director
-0000bac0: 793a 2022 202b 2073 656c 662e 6469 722e  y: " + self.dir.
-0000bad0: 7365 6e73 6f72 2829 290a 0a20 2020 2020  sensor())..     
-0000bae0: 2020 2069 6620 7365 6c66 2e66 696e 6454     if self.findT
-0000baf0: 6d70 4669 656c 6432 2827 696d 6167 652d  mpField2('image-
-0000bb00: 6576 656e 7427 2920 3d3d 2022 223a 0a20  event') == "":. 
-0000bb10: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000bb20: 6966 646f 5f74 6d70 5b73 656c 662e 696d  ifdo_tmp[self.im
-0000bb30: 6167 6553 6574 4865 6164 6572 4b65 795d  ageSetHeaderKey]
-0000bb40: 5b27 696d 6167 652d 6576 656e 7427 5d20  ['image-event'] 
-0000bb50: 3d20 7b27 6e61 6d65 273a 2073 656c 662e  = {'name': self.
-0000bb60: 6469 722e 6576 656e 7428 297d 0a20 2020  dir.event()}.   
-0000bb70: 2020 2020 2065 6c69 6620 7365 6c66 2e66       elif self.f
-0000bb80: 696e 6454 6d70 4669 656c 6428 2769 6d61  indTmpField('ima
-0000bb90: 6765 2d65 7665 6e74 2729 5b27 6e61 6d65  ge-event')['name
-0000bba0: 275d 2021 3d20 7365 6c66 2e64 6972 2e65  '] != self.dir.e
-0000bbb0: 7665 6e74 2829 3a0a 2020 2020 2020 2020  vent():.        
-0000bbc0: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
-0000bbd0: 6728 2243 6175 7469 6f6e 2120 2769 6d61  g("Caution! 'ima
-0000bbe0: 6765 2d65 7665 6e74 2720 2220 2b20 7374  ge-event' " + st
-0000bbf0: 7228 7365 6c66 2e66 696e 6454 6d70 4669  r(self.findTmpFi
-0000bc00: 656c 6428 2769 6d61 6765 2d65 7665 6e74  eld('image-event
-0000bc10: 2729 2920 2b20 2220 6469 6666 6572 7320  ')) + " differs 
-0000bc20: 6672 6f6d 2065 7665 6e74 2070 6172 7365  from event parse
-0000bc30: 6420 6672 6f6d 2064 6972 6563 746f 7279  d from directory
-0000bc40: 3a20 2220 2b20 7365 6c66 2e64 6972 2e65  : " + self.dir.e
-0000bc50: 7665 6e74 2829 290a 0a20 2020 2020 2020  vent())..       
-0000bc60: 2069 6620 7365 6c66 2e66 696e 6454 6d70   if self.findTmp
-0000bc70: 4669 656c 6432 2827 696d 6167 652d 7072  Field2('image-pr
-0000bc80: 6f6a 6563 7427 2920 3d3d 2022 223a 0a20  oject') == "":. 
-0000bc90: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000bca0: 6966 646f 5f74 6d70 5b73 656c 662e 696d  ifdo_tmp[self.im
-0000bcb0: 6167 6553 6574 4865 6164 6572 4b65 795d  ageSetHeaderKey]
-0000bcc0: 5b27 696d 6167 652d 7072 6f6a 6563 7427  ['image-project'
-0000bcd0: 5d20 3d20 207b 276e 616d 6527 3a20 7365  ] =  {'name': se
-0000bce0: 6c66 2e64 6972 2e70 726f 6a65 6374 2829  lf.dir.project()
-0000bcf0: 7d0a 2020 2020 2020 2020 656c 6966 2073  }.        elif s
-0000bd00: 656c 662e 6669 6e64 546d 7046 6965 6c64  elf.findTmpField
-0000bd10: 2827 696d 6167 652d 7072 6f6a 6563 7427  ('image-project'
-0000bd20: 295b 276e 616d 6527 5d20 213d 2073 656c  )['name'] != sel
-0000bd30: 662e 6469 722e 7072 6f6a 6563 7428 293a  f.dir.project():
-0000bd40: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0000bd50: 662e 7072 6f76 2e6c 6f67 2822 4361 7574  f.prov.log("Caut
-0000bd60: 696f 6e21 2027 696d 6167 652d 7072 6f6a  ion! 'image-proj
-0000bd70: 6563 7427 2022 202b 2073 7472 2873 656c  ect' " + str(sel
-0000bd80: 662e 6669 6e64 546d 7046 6965 6c64 2827  f.findTmpField('
-0000bd90: 696d 6167 652d 7072 6f6a 6563 7427 2929  image-project'))
-0000bda0: 202b 2022 2064 6966 6665 7273 2066 726f   + " differs fro
-0000bdb0: 6d20 7072 6f6a 6563 7420 7061 7273 6564  m project parsed
-0000bdc0: 2066 726f 6d20 6469 7265 6374 6f72 793a   from directory:
-0000bdd0: 2022 202b 2073 656c 662e 6469 722e 7072   " + self.dir.pr
-0000bde0: 6f6a 6563 7428 2929 0a0a 2020 2020 2020  oject())..      
-0000bdf0: 2020 6966 2073 656c 662e 6669 6e64 546d    if self.findTm
-0000be00: 7046 6965 6c64 3228 2769 6d61 6765 2d70  pField2('image-p
-0000be10: 6c61 7466 6f72 6d27 2920 3d3d 2022 2220  latform') == "" 
-0000be20: 616e 6420 7365 6c66 2e64 6972 2e67 6561  and self.dir.gea
-0000be30: 7228 2920 213d 2022 223a 0a20 2020 2020  r() != "":.     
-0000be40: 2020 2020 2020 2073 656c 662e 6966 646f         self.ifdo
-0000be50: 5f74 6d70 5b73 656c 662e 696d 6167 6553  _tmp[self.imageS
-0000be60: 6574 4865 6164 6572 4b65 795d 5b27 696d  etHeaderKey]['im
-0000be70: 6167 652d 706c 6174 666f 726d 275d 203d  age-platform'] =
-0000be80: 207b 276e 616d 6527 3a20 7365 6c66 2e64   {'name': self.d
-0000be90: 6972 2e67 6561 7228 297d 0a0a 2020 2020  ir.gear()}..    
-0000bea0: 2020 2020 6966 206e 6f74 2027 696d 6167      if not 'imag
-0000beb0: 652d 7365 742d 7575 6964 2720 696e 2073  e-set-uuid' in s
-0000bec0: 656c 662e 6966 646f 5f74 6d70 5b73 656c  elf.ifdo_tmp[sel
-0000bed0: 662e 696d 6167 6553 6574 4865 6164 6572  f.imageSetHeader
-0000bee0: 4b65 795d 3a0a 2020 2020 2020 2020 2020  Key]:.          
-0000bef0: 2020 7365 6c66 2e69 6664 6f5f 746d 705b    self.ifdo_tmp[
-0000bf00: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
-0000bf10: 6465 724b 6579 5d5b 2769 6d61 6765 2d73  derKey]['image-s
-0000bf20: 6574 2d75 7569 6427 5d20 3d20 7374 7228  et-uuid'] = str(
-0000bf30: 6d69 7174 632e 7575 6964 3428 2929 0a20  miqtc.uuid4()). 
-0000bf40: 2020 2020 2020 2069 6620 6e6f 7420 2769         if not 'i
-0000bf50: 6d61 6765 2d73 6574 2d68 616e 646c 6527  mage-set-handle'
-0000bf60: 2069 6e20 7365 6c66 2e69 6664 6f5f 746d   in self.ifdo_tm
-0000bf70: 705b 7365 6c66 2e69 6d61 6765 5365 7448  p[self.imageSetH
-0000bf80: 6561 6465 724b 6579 5d3a 0a20 2020 2020  eaderKey]:.     
-0000bf90: 2020 2020 2020 2073 656c 662e 6966 646f         self.ifdo
-0000bfa0: 5f74 6d70 5b73 656c 662e 696d 6167 6553  _tmp[self.imageS
-0000bfb0: 6574 4865 6164 6572 4b65 795d 5b27 696d  etHeaderKey]['im
-0000bfc0: 6167 652d 7365 742d 6861 6e64 6c65 275d  age-set-handle']
-0000bfd0: 203d 2073 656c 662e 6861 6e64 6c65 5f70   = self.handle_p
-0000bfe0: 7265 6669 7820 2b20 222f 2220 2b20 7365  refix + "/" + se
-0000bff0: 6c66 2e66 696e 6454 6d70 4669 656c 6428  lf.findTmpField(
-0000c000: 2769 6d61 6765 2d73 6574 2d75 7569 6427  'image-set-uuid'
-0000c010: 290a 2020 2020 2020 2020 6966 206e 6f74  ).        if not
-0000c020: 2027 696d 6167 652d 7365 742d 6e61 6d65   'image-set-name
-0000c030: 2720 696e 2073 656c 662e 6966 646f 5f74  ' in self.ifdo_t
-0000c040: 6d70 5b73 656c 662e 696d 6167 6553 6574  mp[self.imageSet
-0000c050: 4865 6164 6572 4b65 795d 206f 7220 7365  HeaderKey] or se
-0000c060: 6c66 2e66 696e 6454 6d70 4669 656c 6432  lf.findTmpField2
-0000c070: 2827 696d 6167 652d 7365 742d 6e61 6d65  ('image-set-name
-0000c080: 2729 203d 3d20 2222 3a0a 2020 2020 2020  ') == "":.      
-0000c090: 2020 2020 2020 2320 636f 6e73 7472 7563        # construc
-0000c0a0: 7420 6173 203c 7072 6f6a 6563 743e 5f3c  t as <project>_<
-0000c0b0: 6576 656e 743e 5f3c 7365 6e73 6f72 3e0a  event>_<sensor>.
-0000c0c0: 2020 2020 2020 2020 2020 2020 7072 6f6a              proj
-0000c0d0: 6563 745f 203d 2073 656c 662e 6669 6e64  ect_ = self.find
-0000c0e0: 546d 7046 6965 6c64 3228 2269 6d61 6765  TmpField2("image
-0000c0f0: 2d70 726f 6a65 6374 2229 5b27 6e61 6d65  -project")['name
-0000c100: 275d 0a20 2020 2020 2020 2020 2020 2065  '].            e
-0000c110: 7665 6e74 5f20 3d20 7365 6c66 2e66 696e  vent_ = self.fin
-0000c120: 6454 6d70 4669 656c 6432 2822 696d 6167  dTmpField2("imag
-0000c130: 652d 6576 656e 7422 295b 276e 616d 6527  e-event")['name'
-0000c140: 5d0a 2020 2020 2020 2020 2020 2020 6966  ].            if
-0000c150: 2065 7665 6e74 5f20 3d3d 2022 223a 0a20   event_ == "":. 
-0000c160: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0000c170: 7665 6e74 5f20 3d20 7365 6c66 2e64 6972  vent_ = self.dir
-0000c180: 2e65 7665 6e74 2829 0a20 2020 2020 2020  .event().       
-0000c190: 2020 2020 2073 656e 736f 725f 203d 2073       sensor_ = s
-0000c1a0: 656c 662e 6669 6e64 546d 7046 6965 6c64  elf.findTmpField
-0000c1b0: 3228 2269 6d61 6765 2d73 656e 736f 7222  2("image-sensor"
-0000c1c0: 295b 276e 616d 6527 5d0a 2020 2020 2020  )['name'].      
-0000c1d0: 2020 2020 2020 6966 2073 656e 736f 725f        if sensor_
-0000c1e0: 203d 3d20 2222 3a0a 2020 2020 2020 2020   == "":.        
-0000c1f0: 2020 2020 2020 2020 7365 6e73 6f72 5f20          sensor_ 
-0000c200: 3d20 7365 6c66 2e64 6972 2e73 656e 736f  = self.dir.senso
-0000c210: 7228 290a 2020 2020 2020 2020 2020 2020  r().            
-0000c220: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
-0000c230: 6c66 2e69 6d61 6765 5365 7448 6561 6465  lf.imageSetHeade
-0000c240: 724b 6579 5d5b 2769 6d61 6765 2d73 6574  rKey]['image-set
-0000c250: 2d6e 616d 6527 5d20 3d20 6946 444f 2e63  -name'] = iFDO.c
-0000c260: 6f6e 7374 7275 6374 496d 6167 6553 6574  onstructImageSet
-0000c270: 4e61 6d65 2870 726f 6a65 6374 5f2c 6576  Name(project_,ev
-0000c280: 656e 745f 2c73 656e 736f 725f 290a 0a20  ent_,sensor_).. 
-0000c290: 2020 2020 2020 2023 2073 6574 2076 6572         # set ver
-0000c2a0: 7369 6f6e 0a20 2020 2020 2020 2073 656c  sion.        sel
-0000c2b0: 662e 6966 646f 5f74 6d70 5b73 656c 662e  f.ifdo_tmp[self.
-0000c2c0: 696d 6167 6553 6574 4865 6164 6572 4b65  imageSetHeaderKe
-0000c2d0: 795d 5b27 696d 6167 652d 7365 742d 6966  y]['image-set-if
-0000c2e0: 646f 2d76 6572 7369 6f6e 275d 203d 206d  do-version'] = m
-0000c2f0: 6971 7476 2e69 4644 4f5f 7665 7273 696f  iqtv.iFDO_versio
-0000c300: 6e0a 0a0a 2020 2020 6465 6620 7365 7448  n...    def setH
-0000c310: 6561 6465 7249 6d61 6765 4c6f 6361 6c50  eaderImageLocalP
-0000c320: 6174 6846 6965 6c64 2873 656c 6629 3a0a  athField(self):.
-0000c330: 2020 2020 2020 2020 2222 2220 5365 7473          """ Sets
-0000c340: 2068 6561 6465 7220 6669 656c 6420 2769   header field 'i
-0000c350: 6d61 6765 2d6c 6f63 616c 2d70 6174 6827  mage-local-path'
-0000c360: 2066 726f 6d20 696d 6167 6520 6469 7220   from image dir 
-0000c370: 2222 220a 2020 2020 2020 2020 7365 6c66  """.        self
-0000c380: 2e69 6664 6f5f 746d 705b 7365 6c66 2e69  .ifdo_tmp[self.i
-0000c390: 6d61 6765 5365 7448 6561 6465 724b 6579  mageSetHeaderKey
-0000c3a0: 5d5b 2769 6d61 6765 2d6c 6f63 616c 2d70  ]['image-local-p
-0000c3b0: 6174 6827 5d20 3d20 6f73 2e70 6174 682e  ath'] = os.path.
-0000c3c0: 7265 6c70 6174 6828 7365 6c66 2e69 6d61  relpath(self.ima
-0000c3d0: 6765 7344 6972 2c20 6f73 2e70 6174 682e  gesDir, os.path.
-0000c3e0: 6469 726e 616d 6528 7365 6c66 2e67 6574  dirname(self.get
-0000c3f0: 6946 444f 4669 6c65 4e61 6d65 2829 2929  iFDOFileName()))
-0000c400: 0a0a 0a20 2020 2064 6566 2063 7265 6174  ...    def creat
-0000c410: 655f 6669 656c 6473 2873 656c 662c 2061  e_fields(self, a
-0000c420: 6c6c 6f77 5f6d 6973 7369 6e67 5f72 6571  llow_missing_req
-0000c430: 7569 7265 643d 4661 6c73 6529 3a0a 2020  uired=False):.  
-0000c440: 2020 2020 2020 2222 2220 4372 6561 7465        """ Create
-0000c450: 2061 6e64 2076 616c 6964 6174 6520 6375   and validate cu
-0000c460: 7272 656e 7420 6865 6164 6572 2066 6965  rrent header fie
-0000c470: 6c64 7320 616e 6420 6974 656d 2066 6965  lds and item fie
-0000c480: 6c64 7320 6672 6f6d 2069 6e74 6572 6d65  lds from interme
-0000c490: 6469 6174 6520 6669 6c65 732e 204f 7665  diate files. Ove
-0000c4a0: 7277 7269 7465 7320 6578 6973 7469 6e67  rwrites existing
-0000c4b0: 2066 6965 6c64 732e 2022 2222 0a20 2020   fields. """.   
-0000c4c0: 2020 2020 2069 7465 6d5f 6461 7461 203d       item_data =
-0000c4d0: 2073 656c 662e 5f67 6574 5f69 7465 6d5f   self._get_item_
-0000c4e0: 6461 7461 5f66 726f 6d5f 696e 7465 726d  data_from_interm
-0000c4f0: 6564 6961 7465 5f66 696c 6573 2829 0a20  ediate_files(). 
-0000c500: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-0000c510: 6c66 2e63 7265 6174 6569 4644 4f28 7365  lf.createiFDO(se
-0000c520: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
-0000c530: 2e69 6d61 6765 5365 7448 6561 6465 724b  .imageSetHeaderK
-0000c540: 6579 5d2c 2069 7465 6d5f 6461 7461 2e76  ey], item_data.v
-0000c550: 616c 7565 7328 292c 2061 6c6c 6f77 5f6d  alues(), allow_m
-0000c560: 6973 7369 6e67 5f72 6571 7569 7265 643d  issing_required=
-0000c570: 616c 6c6f 775f 6d69 7373 696e 675f 7265  allow_missing_re
-0000c580: 7175 6972 6564 290a 0a0a 2020 2020 6465  quired)...    de
-0000c590: 6620 7570 6461 7465 5f66 6965 6c64 7328  f update_fields(
-0000c5a0: 7365 6c66 2c20 6865 6164 6572 5f6f 6e6c  self, header_onl
-0000c5b0: 793a 626f 6f6c 3d4e 6f6e 6529 3a0a 2020  y:bool=None):.  
-0000c5c0: 2020 2020 2020 2222 2220 5570 6461 7465        """ Update
-0000c5d0: 2061 6e64 2076 616c 6964 6174 6520 6375   and validate cu
-0000c5e0: 7272 656e 7420 6865 6164 6572 2066 6965  rrent header fie
-0000c5f0: 6c64 7320 616e 6420 6974 656d 2066 6965  lds and item fie
-0000c600: 6c64 7320 6672 6f6d 2069 6e74 6572 6d65  lds from interme
-0000c610: 6469 6174 6520 6669 6c65 732e 2022 2222  diate files. """
-0000c620: 0a20 2020 2020 2020 2069 6620 6865 6164  .        if head
-0000c630: 6572 5f6f 6e6c 7920 6973 204e 6f6e 653a  er_only is None:
-0000c640: 0a20 2020 2020 2020 2020 2020 2068 6561  .            hea
-0000c650: 6465 725f 6f6e 6c79 203d 2073 656c 662e  der_only = self.
-0000c660: 6967 6e6f 7265 5f69 6d61 6765 5f66 696c  ignore_image_fil
-0000c670: 6573 0a20 2020 2020 2020 2069 6620 6e6f  es.        if no
-0000c680: 7420 6865 6164 6572 5f6f 6e6c 793a 0a20  t header_only:. 
-0000c690: 2020 2020 2020 2020 2020 2069 7465 6d5f             item_
-0000c6a0: 6461 7461 203d 2073 656c 662e 5f67 6574  data = self._get
-0000c6b0: 5f69 7465 6d5f 6461 7461 5f66 726f 6d5f  _item_data_from_
-0000c6c0: 696e 7465 726d 6564 6961 7465 5f66 696c  intermediate_fil
-0000c6d0: 6573 2829 0a20 2020 2020 2020 2020 2020  es().           
-0000c6e0: 2072 6574 7572 6e20 7365 6c66 2e75 7064   return self.upd
-0000c6f0: 6174 6569 4644 4f28 7365 6c66 2e69 6664  ateiFDO(self.ifd
-0000c700: 6f5f 746d 705b 7365 6c66 2e69 6d61 6765  o_tmp[self.image
-0000c710: 5365 7448 6561 6465 724b 6579 5d2c 2069  SetHeaderKey], i
-0000c720: 7465 6d5f 6461 7461 2e76 616c 7565 7328  tem_data.values(
-0000c730: 2929 0a20 2020 2020 2020 2065 6c73 653a  )).        else:
-0000c740: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0000c750: 7572 6e20 7365 6c66 2e75 7064 6174 6569  urn self.updatei
-0000c760: 4644 4f28 7365 6c66 2e69 6664 6f5f 746d  FDO(self.ifdo_tm
-0000c770: 705b 7365 6c66 2e69 6d61 6765 5365 7448  p[self.imageSetH
-0000c780: 6561 6465 724b 6579 5d2c 205b 5d2c 2068  eaderKey], [], h
-0000c790: 6561 6465 725f 6f6e 6c79 3d54 7275 6529  eader_only=True)
-0000c7a0: 0a0a 0a20 2020 2064 6566 2063 7265 6174  ...    def creat
-0000c7b0: 6543 6f72 6546 6965 6c64 7328 7365 6c66  eCoreFields(self
-0000c7c0: 293a 0a20 2020 2020 2020 2022 2222 2044  ):.        """ D
-0000c7d0: 4550 5245 4341 4445 542c 2075 7365 2063  EPRECADET, use c
-0000c7e0: 7265 6174 655f 6669 656c 6473 2829 206f  reate_fields() o
-0000c7f0: 7220 7570 6461 7465 5f66 6965 6c64 7328  r update_fields(
-0000c800: 2920 696e 7374 6564 2e0a 2020 2020 2020  ) insted..      
-0000c810: 2020 4669 6c6c 7320 7468 6520 6946 444f    Fills the iFDO
-0000c820: 2063 6f72 6520 6669 656c 6473 2066 726f   core fields fro
-0000c830: 6d20 696e 7465 726d 6564 6961 7465 2066  m intermediate f
-0000c840: 696c 6573 2e20 5769 7468 6f75 7420 7468  iles. Without th
-0000c850: 656d 206e 6f20 7661 6c69 6420 6946 444f  em no valid iFDO
-0000c860: 2063 616e 2062 6520 6372 6561 7465 642e   can be created.
-0000c870: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0000c880: 2020 2020 2069 7465 6d5f 6461 7461 203d       item_data =
-0000c890: 2073 656c 662e 5f67 6574 5f69 7465 6d5f   self._get_item_
-0000c8a0: 6461 7461 5f66 726f 6d5f 696e 7465 726d  data_from_interm
-0000c8b0: 6564 6961 7465 5f66 696c 6573 5f63 6f72  ediate_files_cor
-0000c8c0: 6528 290a 2020 2020 2020 2020 2320 6368  e().        # ch
-0000c8d0: 6563 6b20 6669 656c 6473 2066 6f72 2076  eck fields for v
-0000c8e0: 616c 6964 6974 790a 2020 2020 2020 2020  alidity.        
-0000c8f0: 2320 6974 656d 5f64 6174 6120 636f 6e74  # item_data cont
-0000c900: 6169 6e73 2066 6965 6c64 2069 6d61 6765  ains field image
-0000c910: 2d66 696c 656e 616d 652c 2077 6869 6368  -filename, which
-0000c920: 2077 6869 6368 2077 696c 6c20 6e6f 7420   which will not 
-0000c930: 6265 2073 746f 7265 6420 6173 2061 6e20  be stored as an 
-0000c940: 6974 656d 2066 6965 6c64 2069 6e20 6946  item field in iF
-0000c950: 4f44 2062 7574 2061 7320 7468 6520 6974  OD but as the it
-0000c960: 656d 206e 616d 6520 6974 7365 6c66 0a20  em name itself. 
-0000c970: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-0000c980: 6c66 2e75 7064 6174 6569 4644 4f28 7365  lf.updateiFDO(se
-0000c990: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
-0000c9a0: 2e69 6d61 6765 5365 7448 6561 6465 724b  .imageSetHeaderK
-0000c9b0: 6579 5d2c 2069 7465 6d5f 6461 7461 2e76  ey], item_data.v
-0000c9c0: 616c 7565 7328 2929 0a0a 0a20 2020 2064  alues())...    d
-0000c9d0: 6566 2063 7265 6174 6543 6170 7475 7265  ef createCapture
-0000c9e0: 416e 6443 6f6e 7465 6e74 4669 656c 6473  AndContentFields
-0000c9f0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-0000ca00: 2222 2220 4445 5052 4543 4144 4554 2c20  """ DEPRECADET, 
-0000ca10: 7573 6520 6372 6561 7465 5f66 6965 6c64  use create_field
-0000ca20: 7328 2920 6f72 2075 7064 6174 655f 6669  s() or update_fi
-0000ca30: 656c 6473 2829 2069 6e73 7465 642e 0a20  elds() insted.. 
-0000ca40: 2020 2020 2020 2046 696c 6c73 2074 6865         Fills the
-0000ca50: 2069 4644 4f20 6361 7075 7472 6520 616e   iFDO caputre an
-0000ca60: 6420 636f 6e74 656e 7420 6669 6564 7320  d content fieds 
-0000ca70: 6672 6f6d 2070 726f 7669 6465 6420 6461  from provided da
-0000ca80: 7461 2066 6965 6c64 7320 0a20 2020 2020  ta fields .     
-0000ca90: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-0000caa0: 7465 6d5f 6461 7461 203d 2073 656c 662e  tem_data = self.
-0000cab0: 5f67 6574 5f69 7465 6d5f 6461 7461 5f66  _get_item_data_f
-0000cac0: 726f 6d5f 696e 7465 726d 6564 6961 7465  rom_intermediate
-0000cad0: 5f66 696c 6573 5f6e 6f6e 655f 636f 7265  _files_none_core
-0000cae0: 2829 0a20 2020 2020 2020 2023 2063 6865  ().        # che
-0000caf0: 636b 2066 6965 6c64 7320 666f 7220 7661  ck fields for va
-0000cb00: 6c69 6469 7479 0a20 2020 2020 2020 2023  lidity.        #
-0000cb10: 2069 7465 6d5f 6461 7461 2063 6f6e 7461   item_data conta
-0000cb20: 696e 7320 6669 656c 6420 696d 6167 652d  ins field image-
-0000cb30: 6669 6c65 6e61 6d65 2c20 7768 6963 6820  filename, which 
-0000cb40: 7768 6963 6820 7769 6c6c 206e 6f74 2062  which will not b
-0000cb50: 6520 7374 6f72 6564 2061 7320 616e 2069  e stored as an i
-0000cb60: 7465 6d20 6669 656c 6420 696e 2069 464f  tem field in iFO
-0000cb70: 4420 6275 7420 6173 2074 6865 2069 7465  D but as the ite
-0000cb80: 6d20 6e61 6d65 2069 7473 656c 660a 2020  m name itself.  
-0000cb90: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0000cba0: 662e 7570 6461 7465 6946 444f 2873 656c  f.updateiFDO(sel
-0000cbb0: 662e 6966 646f 5f74 6d70 5b73 656c 662e  f.ifdo_tmp[self.
-0000cbc0: 696d 6167 6553 6574 4865 6164 6572 4b65  imageSetHeaderKe
-0000cbd0: 795d 2c20 6974 656d 5f64 6174 612e 7661  y], item_data.va
-0000cbe0: 6c75 6573 2829 290a 0a20 2020 200a 2020  lues())..    .  
-0000cbf0: 2020 6465 6620 5f67 6574 5f69 7465 6d5f    def _get_item_
-0000cc00: 6461 7461 5f66 726f 6d5f 696e 7465 726d  data_from_interm
-0000cc10: 6564 6961 7465 5f66 696c 6573 2873 656c  ediate_files(sel
-0000cc20: 6629 3a0a 2020 2020 2020 2020 2222 2220  f):.        """ 
-0000cc30: 5265 6164 2064 6174 6120 6672 6f6d 2063  Read data from c
-0000cc40: 6f72 6520 616e 6420 6e6f 6e65 2d63 6f72  ore and none-cor
-0000cc50: 6520 696e 7465 726d 6465 6174 6520 6669  e intermdeate fi
-0000cc60: 6c65 732c 2063 6865 636b 2066 696c 6573  les, check files
-0000cc70: 2065 7869 7374 2c20 6164 6420 2769 6d61   exist, add 'ima
-0000cc80: 6765 2d68 616e 646c 6527 2e0a 2020 2020  ge-handle'..    
-0000cc90: 2020 2020 5265 7475 726e 7320 6469 6374      Returns dict
-0000cca0: 206f 6620 666f 726d 207b 696d 6167 652d   of form {image-
-0000ccb0: 6669 6c65 2d6e 616d 653a 7b66 6965 6c64  file-name:{field
-0000ccc0: 3a76 616c 7565 7d2c 2e2e 2e7d 200a 2020  :value},...} .  
-0000ccd0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0000cce0: 2020 6974 656d 5f64 6174 615f 636f 7265    item_data_core
-0000ccf0: 203d 2073 656c 662e 5f67 6574 5f69 7465   = self._get_ite
-0000cd00: 6d5f 6461 7461 5f66 726f 6d5f 696e 7465  m_data_from_inte
-0000cd10: 726d 6564 6961 7465 5f66 696c 6573 5f63  rmediate_files_c
-0000cd20: 6f72 6528 290a 2020 2020 2020 2020 6974  ore().        it
-0000cd30: 656d 5f64 6174 615f 6e6f 6e65 5f63 6f72  em_data_none_cor
-0000cd40: 6520 3d20 7365 6c66 2e5f 6765 745f 6974  e = self._get_it
-0000cd50: 656d 5f64 6174 615f 6672 6f6d 5f69 6e74  em_data_from_int
-0000cd60: 6572 6d65 6469 6174 655f 6669 6c65 735f  ermediate_files_
-0000cd70: 6e6f 6e65 5f63 6f72 6528 290a 2020 2020  none_core().    
-0000cd80: 2020 2020 2370 7072 696e 7428 6974 656d      #pprint(item
-0000cd90: 5f64 6174 615f 6e6f 6e65 5f63 6f72 6529  _data_none_core)
-0000cda0: 0a20 2020 2020 2020 2023 7070 7269 6e74  .        #pprint
-0000cdb0: 2869 7465 6d5f 6461 7461 5f63 6f72 6529  (item_data_core)
-0000cdc0: 0a20 2020 2020 2020 2069 7465 6d5f 6461  .        item_da
-0000cdd0: 7461 203d 2069 7465 6d5f 6461 7461 5f63  ta = item_data_c
-0000cde0: 6f72 650a 2020 2020 2020 2020 6c6f 6720  ore.        log 
-0000cdf0: 3d20 6d69 7174 632e 7265 6375 7273 6976  = miqtc.recursiv
-0000ce00: 656c 7955 7064 6174 6544 6963 7473 2869  elyUpdateDicts(i
-0000ce10: 7465 6d5f 6461 7461 2c20 6974 656d 5f64  tem_data, item_d
-0000ce20: 6174 615f 6e6f 6e65 5f63 6f72 6529 0a20  ata_none_core). 
-0000ce30: 2020 2020 2020 2023 7070 7269 6e74 2869         #pprint(i
-0000ce40: 7465 6d5f 6461 7461 290a 2020 2020 2020  tem_data).      
-0000ce50: 2020 7365 6c66 2e70 726f 762e 6c6f 6728    self.prov.log(
-0000ce60: 6c6f 672c 646f 6e74 5368 6f77 3d54 7275  log,dontShow=Tru
-0000ce70: 6529 0a20 2020 2020 2020 2072 6574 7572  e).        retur
-0000ce80: 6e20 6974 656d 5f64 6174 610a 0a20 2020  n item_data..   
-0000ce90: 2064 6566 205f 6765 745f 6974 656d 5f64   def _get_item_d
-0000cea0: 6174 615f 6672 6f6d 5f69 6e74 6572 6d65  ata_from_interme
-0000ceb0: 6469 6174 655f 6669 6c65 735f 6e6f 6e65  diate_files_none
-0000cec0: 5f63 6f72 6528 7365 6c66 293a 0a20 2020  _core(self):.   
-0000ced0: 2020 2020 2022 2222 2052 6561 6420 6461       """ Read da
-0000cee0: 7461 2066 726f 6d20 6e6f 6e2d 636f 7265  ta from non-core
-0000cef0: 2069 6e74 6572 6d64 6561 7465 2066 696c   intermdeate fil
-0000cf00: 6573 2e0a 2020 2020 2020 2020 5265 7475  es..        Retu
-0000cf10: 726e 7320 6469 6374 206f 6620 666f 726d  rns dict of form
-0000cf20: 207b 696d 6167 652d 6669 6c65 2d6e 616d   {image-file-nam
-0000cf30: 653a 7b66 6965 6c64 3a76 616c 7565 7d2c  e:{field:value},
-0000cf40: 2e2e 2e7d 200a 2020 2020 2020 2020 2222  ...} .        ""
-0000cf50: 220a 2020 2020 2020 2020 7265 7120 3d20  ".        req = 
-0000cf60: 7365 6c66 2e6e 6f6e 436f 7265 4669 656c  self.nonCoreFiel
-0000cf70: 6449 6e74 6572 6d65 6469 6174 6549 7465  dIntermediateIte
-0000cf80: 6d49 6e66 6f46 696c 6573 0a0a 2020 2020  mInfoFiles..    
-0000cf90: 2020 2020 6974 656d 5f64 6174 6120 3d20      item_data = 
-0000cfa0: 7b7d 0a20 2020 2020 2020 2066 6f72 2072  {}.        for r
-0000cfb0: 2069 6e20 7265 713a 0a20 2020 2020 2020   in req:.       
-0000cfc0: 2020 2020 2069 6620 6f73 2e70 6174 682e       if os.path.
-0000cfd0: 6578 6973 7473 2872 2e66 696c 654e 616d  exists(r.fileNam
-0000cfe0: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
-0000cff0: 2020 2020 7365 6c66 2e70 7261 7365 4974      self.praseIt
-0000d000: 656d 4461 7461 4672 6f6d 4669 6c65 2869  emDataFromFile(i
-0000d010: 7465 6d5f 6461 7461 2c72 2e66 696c 654e  tem_data,r.fileN
-0000d020: 616d 652c 722e 7365 7061 7261 746f 722c  ame,r.separator,
-0000d030: 722e 6865 6164 6572 2c20 722e 6461 7465  r.header, r.date
-0000d040: 7469 6d65 5f66 6f72 6d61 7429 0a20 2020  time_format).   
-0000d050: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0000d060: 662e 7072 6f76 2e6c 6f67 2822 5061 7273  f.prov.log("Pars
-0000d070: 6564 2069 7465 6d20 6461 7461 2066 726f  ed item data fro
-0000d080: 6d3a 2022 202b 2072 2e66 696c 654e 616d  m: " + r.fileNam
-0000d090: 6529 0a20 2020 2020 2020 2020 2020 2065  e).            e
-0000d0a0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0000d0b0: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
-0000d0c0: 6f67 2822 4669 6c65 2064 6f65 7320 6e6f  og("File does no
-0000d0d0: 7420 6578 6973 7473 3a20 2220 2b20 722e  t exists: " + r.
-0000d0e0: 6669 6c65 4e61 6d65 290a 0a20 2020 2020  fileName)..     
-0000d0f0: 2020 2023 2063 6865 636b 2066 696c 6573     # check files
-0000d100: 2065 7869 7374 0a20 2020 2020 2020 2072   exist.        r
-0000d110: 656d 6f76 6520 3d20 5b5d 0a20 2020 2020  emove = [].     
-0000d120: 2020 2066 6f72 2069 6d67 2069 6e20 6974     for img in it
-0000d130: 656d 5f64 6174 613a 0a20 2020 2020 2020  em_data:.       
-0000d140: 2020 2020 2069 6620 6e6f 7420 696d 6720       if not img 
-0000d150: 696e 2073 656c 662e 5f69 6d61 6765 4e61  in self._imageNa
-0000d160: 6d65 7349 6d61 6765 7344 6972 3a0a 2020  mesImagesDir:.  
-0000d170: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0000d180: 6d6f 7665 2e61 7070 656e 6428 696d 6729  move.append(img)
-0000d190: 0a20 2020 2020 2020 2066 6f72 2069 6d67  .        for img
-0000d1a0: 2069 6e20 7265 6d6f 7665 3a0a 2020 2020   in remove:.    
-0000d1b0: 2020 2020 2020 2020 6465 6c20 6974 656d          del item
-0000d1c0: 5f64 6174 615b 696d 675d 0a0a 2020 2020  _data[img]..    
-0000d1d0: 2020 2020 7265 7475 726e 2069 7465 6d5f      return item_
-0000d1e0: 6461 7461 0a0a 0a20 2020 2064 6566 205f  data...    def _
-0000d1f0: 6765 745f 6974 656d 5f64 6174 615f 6672  get_item_data_fr
-0000d200: 6f6d 5f69 6e74 6572 6d65 6469 6174 655f  om_intermediate_
-0000d210: 6669 6c65 735f 636f 7265 2873 656c 6629  files_core(self)
-0000d220: 3a0a 2020 2020 2020 2020 2222 2220 5265  :.        """ Re
-0000d230: 6164 2064 6174 6120 6672 6f6d 2063 6f72  ad data from cor
-0000d240: 6520 696e 7465 726d 6465 6174 6520 6669  e intermdeate fi
-0000d250: 6c65 732c 2063 6865 636b 2066 696c 6573  les, check files
-0000d260: 2065 7869 7374 2c20 6164 6420 2769 6d61   exist, add 'ima
-0000d270: 6765 2d68 616e 646c 6527 2e0a 2020 2020  ge-handle'..    
-0000d280: 2020 2020 5265 7475 726e 7320 6469 6374      Returns dict
-0000d290: 206f 6620 666f 726d 207b 696d 6167 652d   of form {image-
-0000d2a0: 6669 6c65 2d6e 616d 653a 7b66 6965 6c64  file-name:{field
-0000d2b0: 3a76 616c 7565 7d2c 2e2e 2e7d 200a 2020  :value},...} .  
-0000d2c0: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
-0000d2d0: 2020 2023 2057 6869 6368 2066 696c 6573     # Which files
-0000d2e0: 2063 6f6e 7461 696e 2074 6865 2069 6e66   contain the inf
-0000d2f0: 6f72 6d61 7469 6f6e 206e 6565 6465 6420  ormation needed 
-0000d300: 746f 2063 7265 6174 6520 7468 6520 6946  to create the iF
-0000d310: 444f 2069 7465 6d73 2063 6f72 6520 696e  DO items core in
-0000d320: 666f 726d 6174 696f 6e20 616e 6420 7768  formation and wh
-0000d330: 6963 6820 636f 6c75 6d6e 7320 7368 616c  ich columns shal
-0000d340: 6c20 6265 2075 7365 640a 2020 2020 2020  l be used.      
-0000d350: 2020 7265 7120 3d20 7365 6c66 2e69 6e74    req = self.int
-0000d360: 6572 6d65 6469 6174 6546 696c 6573 4465  ermediateFilesDe
-0000d370: 665f 636f 7265 0a0a 2020 2020 2020 2020  f_core..        
-0000d380: 6974 656d 5f64 6174 6120 3d20 7b7d 0a20  item_data = {}. 
-0000d390: 2020 2020 2020 2070 726f 6720 3d20 6d69         prog = mi
-0000d3a0: 7174 632e 5072 696e 744b 6e6f 776e 5072  qtc.PrintKnownPr
-0000d3b0: 6f67 7265 7373 4d73 6728 2250 6172 7369  ogressMsg("Parsi
-0000d3c0: 6e67 2069 6e74 6572 6d65 6469 6174 6520  ng intermediate 
-0000d3d0: 6461 7461 222c 206c 656e 2872 6571 2929  data", len(req))
-0000d3e0: 0a20 2020 2020 2020 2066 6f72 2072 2069  .        for r i
-0000d3f0: 6e20 7265 713a 0a20 2020 2020 2020 2020  n req:.         
-0000d400: 2020 2070 726f 672e 7072 6f67 7265 7373     prog.progress
-0000d410: 2829 0a20 2020 2020 2020 2020 2020 2066  ().            f
-0000d420: 696c 6520 3d20 7365 6c66 2e5f 5f67 6574  ile = self.__get
-0000d430: 5f69 6e74 5f66 696c 655f 7072 6566 6978  _int_file_prefix
-0000d440: 2829 202b 2072 6571 5b72 5d5b 2773 7566  () + req[r]['suf
-0000d450: 6669 7827 5d0a 2020 2020 2020 2020 2020  fix'].          
-0000d460: 2020 6966 206e 6f74 206f 732e 7061 7468    if not os.path
-0000d470: 2e65 7869 7374 7328 6669 6c65 293a 0a20  .exists(file):. 
-0000d480: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000d490: 656c 662e 7072 6f76 2e6c 6f67 2822 5741  elf.prov.log("WA
-0000d4a0: 524e 494e 4721 2046 6f72 2061 6368 6965  RNING! For achie
-0000d4b0: 7669 6e67 2046 4149 526e 6573 7320 616e  ving FAIRness an
-0000d4c0: 2069 6e74 6572 6d65 6469 6174 6520 696d   intermediate im
-0000d4d0: 6167 6520 696e 666f 2066 696c 6520 6973  age info file is
-0000d4e0: 206d 6973 7369 6e67 3a20 222b 2073 656c   missing: "+ sel
-0000d4f0: 662e 5f5f 6765 745f 696e 745f 6669 6c65  f.__get_int_file
-0000d500: 5f70 7265 6669 7828 2920 2b20 7265 715b  _prefix() + req[
-0000d510: 725d 5b27 7375 6666 6978 275d 2b20 2220  r]['suffix']+ " 
-0000d520: 7275 6e20 6669 7273 743a 2022 202b 2072  run first: " + r
-0000d530: 6571 5b72 5d5b 2763 7265 6174 696f 6e46  eq[r]['creationF
-0000d540: 6374 275d 290a 2020 2020 2020 2020 2020  ct']).          
-0000d550: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000d560: 2020 2020 2020 2020 7365 6c66 2e70 6172          self.par
-0000d570: 7365 4974 656d 4461 7461 6672 6f6d 5461  seItemDatafromTa
-0000d580: 6246 696c 6544 6174 6128 6974 656d 5f64  bFileData(item_d
-0000d590: 6174 612c 2066 696c 652c 2072 6571 5b72  ata, file, req[r
-0000d5a0: 5d5b 2763 6f6c 7327 5d2c 2072 6571 5b72  ]['cols'], req[r
-0000d5b0: 5d5b 276f 7074 696f 6e61 6c27 5d29 0a20  ]['optional']). 
-0000d5c0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000d5d0: 656c 662e 7072 6f76 2e6c 6f67 2822 5061  elf.prov.log("Pa
-0000d5e0: 7273 6564 2069 7465 6d20 6461 7461 2066  rsed item data f
-0000d5f0: 726f 6d3a 2022 202b 2066 696c 6529 0a0a  rom: " + file)..
-0000d600: 2020 2020 2020 2020 7072 6f67 2e63 6c65          prog.cle
-0000d610: 6172 2829 0a20 2020 2020 2020 2069 6620  ar().        if 
-0000d620: 6c65 6e28 6974 656d 5f64 6174 6129 203d  len(item_data) =
-0000d630: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
-0000d640: 2072 6169 7365 2045 7863 6570 7469 6f6e   raise Exception
-0000d650: 2822 4e6f 2069 4644 4f20 6974 656d 7322  ("No iFDO items"
-0000d660: 290a 0a20 2020 2020 2020 2023 2063 6865  )..        # che
-0000d670: 636b 2066 696c 6573 2065 7869 7374 0a20  ck files exist. 
-0000d680: 2020 2020 2020 2072 656d 6f76 6520 3d20         remove = 
-0000d690: 5b5d 0a20 2020 2020 2020 2066 6f72 2069  [].        for i
-0000d6a0: 6d67 2069 6e20 6974 656d 5f64 6174 613a  mg in item_data:
-0000d6b0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000d6c0: 6e6f 7420 696d 6720 696e 2073 656c 662e  not img in self.
-0000d6d0: 5f69 6d61 6765 4e61 6d65 7349 6d61 6765  _imageNamesImage
-0000d6e0: 7344 6972 3a0a 2020 2020 2020 2020 2020  sDir:.          
-0000d6f0: 2020 2020 2020 7265 6d6f 7665 2e61 7070        remove.app
-0000d700: 656e 6428 696d 6729 0a20 2020 2020 2020  end(img).       
-0000d710: 2066 6f72 2069 6d67 2069 6e20 7265 6d6f   for img in remo
-0000d720: 7665 3a0a 2020 2020 2020 2020 2020 2020  ve:.            
-0000d730: 6465 6c20 6974 656d 5f64 6174 615b 696d  del item_data[im
-0000d740: 675d 0a0a 2020 2020 2020 2020 2320 6164  g]..        # ad
-0000d750: 6420 696d 6167 652d 7572 6c0a 2020 2020  d image-url.    
-0000d760: 2020 2020 666f 7220 696d 6720 696e 2069      for img in i
-0000d770: 7465 6d5f 6461 7461 3a0a 2020 2020 2020  tem_data:.      
-0000d780: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-0000d790: 6e63 6528 6974 656d 5f64 6174 615b 696d  nce(item_data[im
-0000d7a0: 675d 2c6c 6973 7429 3a20 2320 6974 656d  g],list): # item
-0000d7b0: 2069 7320 616c 7265 6164 7920 6120 6c69   is already a li
-0000d7c0: 7374 2028 7669 6465 6f29 2062 7574 2070  st (video) but p
-0000d7d0: 6172 7365 6420 6461 7461 2069 7320 6e6f  arsed data is no
-0000d7e0: 742c 2069 2e65 2e20 7061 7273 6564 2064  t, i.e. parsed d
-0000d7f0: 6174 6120 7265 6665 7273 2074 6f20 7768  ata refers to wh
-0000d800: 6f6c 6520 7669 6465 6f20 2874 696d 6520  ole video (time 
-0000d810: 696e 6465 7065 6e64 656e 7429 2c20 692e  independent), i.
-0000d820: 652e 2077 7269 7465 2074 6f20 6669 7273  e. write to firs
-0000d830: 7420 656e 7472 790a 2020 2020 2020 2020  t entry.        
-0000d840: 2020 2020 2020 2020 7575 6964 203d 2066          uuid = f
-0000d850: 696e 6446 6965 6c64 2869 7465 6d5f 6461  indField(item_da
-0000d860: 7461 5b69 6d67 5d5b 305d 2c27 696d 6167  ta[img][0],'imag
-0000d870: 652d 7575 6964 2729 0a20 2020 2020 2020  e-uuid').       
-0000d880: 2020 2020 2020 2020 2069 6620 7575 6964           if uuid
-0000d890: 203d 3d20 2222 3a0a 2020 2020 2020 2020   == "":.        
-0000d8a0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-0000d8b0: 7428 6974 656d 5f64 6174 615b 696d 675d  t(item_data[img]
-0000d8c0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000d8d0: 2020 2020 2020 7261 6973 6520 6d69 7174        raise miqt
-0000d8e0: 632e 4966 646f 4578 6365 7074 696f 6e28  c.IfdoException(
-0000d8f0: 2275 7569 6420 6e6f 7420 666f 756e 6420  "uuid not found 
-0000d900: 2861 2922 290a 2020 2020 2020 2020 2020  (a)").          
-0000d910: 2020 2020 2020 6974 656d 5f64 6174 615b        item_data[
-0000d920: 696d 675d 5b30 5d5b 2769 6d61 6765 2d68  img][0]['image-h
-0000d930: 616e 646c 6527 5d20 3d20 7365 6c66 2e69  andle'] = self.i
-0000d940: 6d61 6765 5f68 616e 646c 655f 7072 6566  mage_handle_pref
-0000d950: 6978 202b 2027 4027 202b 2075 7569 640a  ix + '@' + uuid.
-0000d960: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0000d970: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000d980: 2020 7575 6964 203d 2066 696e 6446 6965    uuid = findFie
-0000d990: 6c64 2869 7465 6d5f 6461 7461 5b69 6d67  ld(item_data[img
-0000d9a0: 5d2c 2769 6d61 6765 2d75 7569 6427 290a  ],'image-uuid').
-0000d9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d9c0: 6966 2075 7569 6420 3d3d 2022 223a 0a20  if uuid == "":. 
-0000d9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d9e0: 2020 2072 6169 7365 206d 6971 7463 2e49     raise miqtc.I
-0000d9f0: 6664 6f45 7863 6570 7469 6f6e 2822 7575  fdoException("uu
-0000da00: 6964 206e 6f74 2066 6f75 6e64 2028 6229  id not found (b)
-0000da10: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-0000da20: 2020 2069 7465 6d5f 6461 7461 5b69 6d67     item_data[img
-0000da30: 5d5b 2769 6d61 6765 2d68 616e 646c 6527  ]['image-handle'
-0000da40: 5d20 3d20 7365 6c66 2e69 6d61 6765 5f68  ] = self.image_h
-0000da50: 616e 646c 655f 7072 6566 6978 202b 2027  andle_prefix + '
-0000da60: 4027 202b 2075 7569 640a 0a20 2020 2020  @' + uuid..     
-0000da70: 2020 2072 6574 7572 6e20 6974 656d 5f64     return item_d
-0000da80: 6174 610a 0a0a 2020 2020 6465 6620 6164  ata...    def ad
-0000da90: 645f 6974 656d 5f69 6e66 6f5f 7461 625f  d_item_info_tab_
-0000daa0: 6669 6c65 2873 656c 662c 2066 696c 654e  file(self, fileN
-0000dab0: 616d 653a 2073 7472 2c20 7365 7061 7261  ame: str, separa
-0000dac0: 746f 723a 7374 722c 2068 6561 6465 723a  tor:str, header:
-0000dad0: 6469 6374 2c20 6461 7465 7469 6d65 5f66  dict, datetime_f
-0000dae0: 6f72 6d61 7420 3d20 6d69 7174 762e 6461  ormat = miqtv.da
-0000daf0: 7465 5f66 6f72 6d61 7473 5b27 6d61 7269  te_formats['mari
-0000db00: 7174 275d 293a 0a20 2020 2020 2020 2022  qt']):.        "
-0000db10: 2222 2041 6464 2061 2063 6f6c 756d 6e20  "" Add a column 
-0000db20: 7365 7065 7261 7465 6420 7465 7874 2066  seperated text f
-0000db30: 696c 6520 746f 2070 6172 7365 2069 7465  ile to parse ite
-0000db40: 6d20 6461 7461 2066 726f 6d20 6279 2063  m data from by c
-0000db50: 7265 6174 6543 6170 7475 7265 416e 6443  reateCaptureAndC
-0000db60: 6f6e 7465 6e74 4669 656c 6473 2829 2e20  ontentFields(). 
-0000db70: 0a20 2020 2020 2020 2043 6f6c 756d 6e73  .        Columns
-0000db80: 2068 6561 6465 7273 2077 696c 6c20 6265   headers will be
-0000db90: 2073 6574 2061 7320 6974 656d 2066 6965   set as item fie
-0000dba0: 6c64 206e 616d 6573 2e20 4d75 7374 2063  ld names. Must c
-0000dbb0: 6f6e 7461 696e 2063 6f6c 756d 6e20 2769  ontain column 'i
-0000dbc0: 6d61 6765 2d66 696c 656e 616d 6527 2e0a  mage-filename'..
-0000dbd0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0000dbe0: 2020 2020 6966 2066 696c 654e 616d 6520      if fileName 
-0000dbf0: 3d3d 204e 6f6e 6520 6f72 206e 6f74 206f  == None or not o
-0000dc00: 732e 7061 7468 2e65 7869 7374 7328 6669  s.path.exists(fi
-0000dc10: 6c65 4e61 6d65 293a 0a20 2020 2020 2020  leName):.       
-0000dc20: 2020 2020 2072 6169 7365 2045 7863 6570       raise Excep
-0000dc30: 7469 6f6e 2822 4669 6c65 222c 6669 6c65  tion("File",file
-0000dc40: 4e61 6d65 2c22 6e6f 7420 666f 756e 6422  Name,"not found"
-0000dc50: 290a 0a20 2020 2020 2020 2066 6f72 2066  )..        for f
-0000dc60: 6965 6c64 2069 6e20 6865 6164 6572 3a0a  ield in header:.
-0000dc70: 2020 2020 2020 2020 2020 2020 6966 2068              if h
-0000dc80: 6561 6465 725b 6669 656c 645d 206e 6f74  eader[field] not
-0000dc90: 2069 6e20 6d69 7174 662e 7461 6246 696c   in miqtf.tabFil
-0000dca0: 6543 6f6c 756d 6e4e 616d 6573 2866 696c  eColumnNames(fil
-0000dcb0: 654e 616d 652c 636f 6c5f 7365 7061 7261  eName,col_separa
-0000dcc0: 746f 723d 7365 7061 7261 746f 7229 3a0a  tor=separator):.
-0000dcd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dce0: 7261 6973 6520 4578 6365 7074 696f 6e28  raise Exception(
-0000dcf0: 2243 6f6c 756d 6e22 2c20 6865 6164 6572  "Column", header
-0000dd00: 5b66 6965 6c64 5d2c 2022 6e6f 7420 696e  [field], "not in
-0000dd10: 2066 696c 6522 2c20 6669 6c65 4e61 6d65   file", fileName
-0000dd20: 290a 0a20 2020 2020 2020 2069 6620 6d69  )..        if mi
-0000dd30: 7174 632e 6173 7365 7274 536c 6173 6828  qtc.assertSlash(
-0000dd40: 6f73 2e70 6174 682e 6469 726e 616d 6528  os.path.dirname(
-0000dd50: 6669 6c65 4e61 6d65 2929 2021 3d20 6d69  fileName)) != mi
-0000dd60: 7174 632e 6173 7365 7274 536c 6173 6828  qtc.assertSlash(
-0000dd70: 7365 6c66 2e64 6972 2e74 6f28 7365 6c66  self.dir.to(self
-0000dd80: 2e64 6972 2e64 742e 696e 7465 726d 6564  .dir.dt.intermed
-0000dd90: 6961 7465 2929 3a0a 2020 2020 2020 2020  iate)):.        
-0000dda0: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
-0000ddb0: 6728 2022 4361 7574 696f 6e21 2049 7420  g( "Caution! It 
-0000ddc0: 6973 2072 6563 6f6d 6d65 6e64 6564 2074  is recommended t
-0000ddd0: 6f20 7075 7420 6669 6c65 2069 6e20 7468  o put file in th
-0000dde0: 6520 6469 7265 6374 6f72 7927 7320 2769  e directory's 'i
-0000ddf0: 6e74 6572 6d65 6469 6174 6527 2066 6f6c  ntermediate' fol
-0000de00: 6465 723a 2022 202b 2066 696c 654e 616d  der: " + fileNam
-0000de10: 6529 0a20 2020 2020 2020 206e 6366 6969  e).        ncfii
-0000de20: 6620 3d20 6e6f 6e43 6f72 6546 6965 6c64  f = nonCoreField
-0000de30: 496e 7465 726d 6564 6961 7465 4974 656d  IntermediateItem
-0000de40: 496e 666f 4669 6c65 2866 696c 654e 616d  InfoFile(fileNam
-0000de50: 652c 2073 6570 6172 6174 6f72 2c20 6865  e, separator, he
-0000de60: 6164 6572 2c20 6461 7465 7469 6d65 5f66  ader, datetime_f
-0000de70: 6f72 6d61 7429 0a20 2020 2020 2020 2069  ormat).        i
-0000de80: 6620 6e63 6669 6966 206e 6f74 2069 6e20  f ncfiif not in 
-0000de90: 7365 6c66 2e6e 6f6e 436f 7265 4669 656c  self.nonCoreFiel
-0000dea0: 6449 6e74 6572 6d65 6469 6174 6549 7465  dIntermediateIte
-0000deb0: 6d49 6e66 6f46 696c 6573 3a20 0a20 2020  mInfoFiles: .   
-0000dec0: 2020 2020 2020 2020 2073 656c 662e 6e6f           self.no
-0000ded0: 6e43 6f72 6546 6965 6c64 496e 7465 726d  nCoreFieldInterm
-0000dee0: 6564 6961 7465 4974 656d 496e 666f 4669  ediateItemInfoFi
-0000def0: 6c65 732e 6170 7065 6e64 286e 6366 6969  les.append(ncfii
-0000df00: 6629 0a0a 2020 2020 6465 6620 6164 6449  f)..    def addI
-0000df10: 7465 6d49 6e66 6f54 6162 4669 6c65 2873  temInfoTabFile(s
-0000df20: 656c 662c 2066 696c 654e 616d 653a 2073  elf, fileName: s
-0000df30: 7472 2c20 7365 7061 7261 746f 723a 7374  tr, separator:st
-0000df40: 722c 2068 6561 6465 723a 6469 6374 2c20  r, header:dict, 
-0000df50: 6461 7465 7469 6d65 5f66 6f72 6d61 7420  datetime_format 
-0000df60: 3d20 6d69 7174 762e 6461 7465 5f66 6f72  = miqtv.date_for
-0000df70: 6d61 7473 5b27 6d61 7269 7174 275d 293a  mats['mariqt']):
-0000df80: 0a20 2020 2020 2020 2022 2222 2044 6570  .        """ Dep
-0000df90: 7265 6361 7465 6420 2d20 7573 6520 6164  recated - use ad
-0000dfa0: 645f 6974 656d 5f69 6e66 6f5f 7461 625f  d_item_info_tab_
-0000dfb0: 6669 6c65 2022 2222 0a20 2020 2020 2020  file """.       
-0000dfc0: 2073 656c 662e 6164 645f 6974 656d 5f69   self.add_item_i
-0000dfd0: 6e66 6f5f 7461 625f 6669 6c65 2866 696c  nfo_tab_file(fil
-0000dfe0: 654e 616d 652c 7365 7061 7261 746f 722c  eName,separator,
-0000dff0: 6865 6164 6572 2c64 6174 6574 696d 655f  header,datetime_
-0000e000: 666f 726d 6174 290a 0a20 2020 2020 2020  format)..       
-0000e010: 200a 2020 2020 6465 6620 7265 6d6f 7665   .    def remove
-0000e020: 4974 656d 496e 666f 5461 6246 696c 6528  ItemInfoTabFile(
-0000e030: 7365 6c66 2c20 6669 6c65 4e61 6d65 3a20  self, fileName: 
-0000e040: 7374 722c 2073 6570 6172 6174 6f72 3a73  str, separator:s
-0000e050: 7472 2c20 6865 6164 6572 3a64 6963 742c  tr, header:dict,
-0000e060: 2064 6174 6574 696d 655f 666f 726d 6174   datetime_format
-0000e070: 3a73 7472 293a 0a20 2020 2020 2020 2022  :str):.        "
-0000e080: 2222 2072 656d 6f76 6573 2066 696c 6520  "" removes file 
-0000e090: 6974 656d 2066 726f 6d20 6c69 7374 206f  item from list o
-0000e0a0: 6620 6669 6c65 7320 746f 2070 6172 7365  f files to parse
-0000e0b0: 2069 7465 6d20 6461 7461 2066 726f 6d20   item data from 
-0000e0c0: 6279 2063 7265 6174 6543 6170 7475 7265  by createCapture
-0000e0d0: 416e 6443 6f6e 7465 6e74 4669 656c 6473  AndContentFields
-0000e0e0: 2829 2022 2222 0a20 2020 2020 2020 206e  () """.        n
-0000e0f0: 6366 6969 6620 3d20 6e6f 6e43 6f72 6546  cfiif = nonCoreF
-0000e100: 6965 6c64 496e 7465 726d 6564 6961 7465  ieldIntermediate
-0000e110: 4974 656d 496e 666f 4669 6c65 2866 696c  ItemInfoFile(fil
-0000e120: 654e 616d 652c 2073 6570 6172 6174 6f72  eName, separator
-0000e130: 2c20 6865 6164 6572 2c20 6461 7465 7469  , header, dateti
-0000e140: 6d65 5f66 6f72 6d61 7429 0a20 2020 2020  me_format).     
-0000e150: 2020 2069 6620 6e63 6669 6966 2069 6e20     if ncfiif in 
-0000e160: 7365 6c66 2e6e 6f6e 436f 7265 4669 656c  self.nonCoreFiel
-0000e170: 6449 6e74 6572 6d65 6469 6174 6549 7465  dIntermediateIte
-0000e180: 6d49 6e66 6f46 696c 6573 3a20 0a20 2020  mInfoFiles: .   
-0000e190: 2020 2020 2020 2020 2073 656c 662e 6e6f           self.no
-0000e1a0: 6e43 6f72 6546 6965 6c64 496e 7465 726d  nCoreFieldInterm
-0000e1b0: 6564 6961 7465 4974 656d 496e 666f 4669  ediateItemInfoFi
-0000e1c0: 6c65 732e 7265 6d6f 7665 286e 6366 6969  les.remove(ncfii
-0000e1d0: 6629 0a0a 0a20 2020 2064 6566 2075 7064  f)...    def upd
-0000e1e0: 6174 6569 4644 4f28 7365 6c66 2c20 6865  ateiFDO(self, he
-0000e1f0: 6164 6572 3a20 6469 6374 2c20 6974 656d  ader: dict, item
-0000e200: 733a 206c 6973 742c 2068 6561 6465 725f  s: list, header_
-0000e210: 6f6e 6c79 3d46 616c 7365 293a 0a20 2020  only=False):.   
-0000e220: 2020 2020 2022 2222 2055 7064 6174 6573       """ Updates
-0000e230: 2074 6865 2063 7572 7265 6e74 2076 616c   the current val
-0000e240: 7565 7320 6946 444f 2077 6974 6820 7468  ues iFDO with th
-0000e250: 6520 7072 6f76 6964 6564 206e 6577 2076  e provided new v
-0000e260: 616c 7565 7320 2222 220a 2020 2020 2020  alues """.      
-0000e270: 2020 7265 7475 726e 2073 656c 662e 6372    return self.cr
-0000e280: 6561 7465 6946 444f 2868 6561 6465 722c  eateiFDO(header,
-0000e290: 2069 7465 6d73 2c20 7570 6461 7465 4578   items, updateEx
-0000e2a0: 6973 7469 6e67 3d54 7275 652c 2068 6561  isting=True, hea
-0000e2b0: 6465 724f 6e6c 793d 6865 6164 6572 5f6f  derOnly=header_o
-0000e2c0: 6e6c 7929 0a0a 0a20 2020 2064 6566 2063  nly)...    def c
-0000e2d0: 7265 6174 6569 4644 4f28 7365 6c66 2c20  reateiFDO(self, 
-0000e2e0: 6865 6164 6572 3a20 6469 6374 2c20 6974  header: dict, it
-0000e2f0: 656d 733a 206c 6973 742c 2075 7064 6174  ems: list, updat
-0000e300: 6545 7869 7374 696e 673d 4661 6c73 652c  eExisting=False,
-0000e310: 6865 6164 6572 4f6e 6c79 3d46 616c 7365  headerOnly=False
-0000e320: 2c61 6c6c 6f77 5f6d 6973 7369 6e67 5f72  ,allow_missing_r
-0000e330: 6571 7569 7265 643d 4661 6c73 6529 3a0a  equired=False):.
-0000e340: 2020 2020 2020 2020 2222 2220 4372 6561          """ Crea
-0000e350: 7465 7320 4641 4952 2064 6967 6974 616c  tes FAIR digital
-0000e360: 206f 626a 6563 7420 666f 7220 7468 6520   object for the 
-0000e370: 696d 6167 6520 6461 7461 2069 7473 656c  image data itsel
-0000e380: 662e 2054 6869 7320 636f 6e73 6973 7473  f. This consists
-0000e390: 206f 6620 6865 6164 6572 2069 6e66 6f72   of header infor
-0000e3a0: 6d61 7469 6f6e 2061 6e64 2069 7465 6d20  mation and item 
-0000e3b0: 696e 666f 726d 6174 696f 6e2e 0a20 2020  information..   
-0000e3c0: 2020 2020 2075 7064 6174 6545 7869 7374       updateExist
-0000e3d0: 696e 673a 2069 6620 4661 6c73 6520 6f6c  ing: if False ol
-0000e3e0: 6420 7661 6c75 6573 2061 7265 2072 656d  d values are rem
-0000e3f0: 6f76 6564 2c20 6f74 6865 7277 6973 6520  oved, otherwise 
-0000e400: 7468 6579 2061 7265 2075 7064 6174 6564  they are updated
-0000e410: 2e0a 2020 2020 2020 2020 6865 6164 6572  ..        header
-0000e420: 4f6e 6c79 3a20 6966 2054 7275 6520 6974  Only: if True it
-0000e430: 656d 7320 6d61 7920 6265 2065 6d70 7479  ems may be empty
-0000e440: 206c 6973 742e 0a20 2020 2020 2020 2061   list..        a
-0000e450: 6c6c 6f77 5f6d 6973 7369 6e67 5f72 6571  llow_missing_req
-0000e460: 7569 7265 643a 2069 6620 5472 7565 2c20  uired: if True, 
-0000e470: 6e6f 2065 7863 6570 7469 6f6e 2072 6973  no exception ris
-0000e480: 656e 2069 6620 6120 7265 7175 6972 6564  en if a required
-0000e490: 2066 6965 6c64 2069 7320 6d69 7373 696e   field is missin
-0000e4a0: 672e 2020 2222 220a 0a20 2020 2020 2020  g.  """..       
-0000e4b0: 2069 6620 6e6f 7420 7570 6461 7465 4578   if not updateEx
-0000e4c0: 6973 7469 6e67 2061 6e64 206c 656e 2869  isting and len(i
-0000e4d0: 7465 6d73 2920 3d3d 2030 2061 6e64 206e  tems) == 0 and n
-0000e4e0: 6f74 2068 6561 6465 724f 6e6c 793a 0a20  ot headerOnly:. 
-0000e4f0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0000e500: 2045 7863 6570 7469 6f6e 2827 4e6f 2069   Exception('No i
-0000e510: 7465 6d20 696e 666f 726d 6174 696f 6e20  tem information 
-0000e520: 6769 7665 6e27 290a 0a20 2020 2020 2020  given')..       
-0000e530: 2069 6620 7570 6461 7465 4578 6973 7469   if updateExisti
-0000e540: 6e67 3a0a 2020 2020 2020 2020 2020 2020  ng:.            
-0000e550: 2320 6865 6164 6572 0a20 2020 2020 2020  # header.       
-0000e560: 2020 2020 2073 656c 662e 7570 6461 7465       self.update
-0000e570: 5f69 6664 6f5f 6865 6164 6572 5f66 6965  _ifdo_header_fie
-0000e580: 6c64 7328 6865 6164 6572 290a 2020 2020  lds(header).    
-0000e590: 2020 2020 2020 2020 2320 6974 656d 730a          # items.
-0000e5a0: 2020 2020 2020 2020 2020 2020 2320 7570              # up
-0000e5b0: 6461 7465 2063 6f70 7920 6f66 2063 7572  date copy of cur
-0000e5c0: 7265 6e74 2069 7465 6d73 2077 6974 6820  rent items with 
-0000e5d0: 6e65 7720 6974 656d 7320 6669 656c 6473  new items fields
-0000e5e0: 0a20 2020 2020 2020 2020 2020 2069 7465  .            ite
-0000e5f0: 6d73 4469 6374 203d 206d 6971 7469 2e63  msDict = miqti.c
-0000e600: 7265 6174 6549 6d61 6765 4974 656d 7344  reateImageItemsD
-0000e610: 6963 7446 726f 6d49 6d61 6765 4974 656d  ictFromImageItem
-0000e620: 734c 6973 7428 6974 656d 7329 0a20 2020  sList(items).   
-0000e630: 2020 2020 2020 2020 2075 7064 6174 6564           updated
-0000e640: 4974 656d 735f 636f 7079 203d 2063 6f70  Items_copy = cop
-0000e650: 792e 6465 6570 636f 7079 2873 656c 662e  y.deepcopy(self.
-0000e660: 6966 646f 5f74 6d70 5b73 656c 662e 696d  ifdo_tmp[self.im
-0000e670: 6167 6553 6574 4974 656d 734b 6579 5d29  ageSetItemsKey])
-0000e680: 0a20 2020 2020 2020 2020 2020 206c 6f67  .            log
-0000e690: 203d 206d 6971 7463 2e72 6563 7572 7369   = miqtc.recursi
-0000e6a0: 7665 6c79 5570 6461 7465 4469 6374 7328  velyUpdateDicts(
-0000e6b0: 7570 6461 7465 6449 7465 6d73 5f63 6f70  updatedItems_cop
-0000e6c0: 792c 2069 7465 6d73 4469 6374 290a 2020  y, itemsDict).  
-0000e6d0: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
-0000e6e0: 726f 762e 6c6f 6728 6c6f 672c 646f 6e74  rov.log(log,dont
-0000e6f0: 5368 6f77 3d54 7275 6529 0a20 2020 2020  Show=True).     
-0000e700: 2020 2020 2020 2069 7465 6d73 203d 206d         items = m
-0000e710: 6971 7469 2e63 7265 6174 6549 6d61 6765  iqti.createImage
-0000e720: 4974 656d 734c 6973 7446 726f 6d49 6d61  ItemsListFromIma
-0000e730: 6765 4974 656d 7344 6963 7428 7570 6461  geItemsDict(upda
-0000e740: 7465 6449 7465 6d73 5f63 6f70 7929 0a0a  tedItems_copy)..
-0000e750: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0000e760: 2020 2020 2020 2020 2020 2320 6f76 6572            # over
-0000e770: 7772 6974 6520 6865 6164 6572 0a20 2020  write header.   
-0000e780: 2020 2020 2020 2020 2073 656c 662e 7365           self.se
-0000e790: 7469 4644 4f48 6561 6465 7246 6965 6c64  tiFDOHeaderField
-0000e7a0: 7328 6865 6164 6572 290a 2020 2020 2020  s(header).      
-0000e7b0: 2020 2020 2020 2320 636c 6561 7220 6974        # clear it
-0000e7c0: 656d 7320 7365 6374 696f 6e0a 2020 2020  ems section.    
-0000e7d0: 2020 2020 2020 2020 7365 6c66 2e69 6664          self.ifd
-0000e7e0: 6f5f 746d 705b 7365 6c66 2e69 6d61 6765  o_tmp[self.image
-0000e7f0: 5365 7449 7465 6d73 4b65 795d 203d 207b  SetItemsKey] = {
-0000e800: 7d0a 0a0a 2020 2020 2020 2020 2320 5061  }...        # Pa
-0000e810: 7273 6520 696d 6167 652d 6162 7374 7261  rse image-abstra
-0000e820: 6374 2061 6e64 2066 696c 6c20 6974 7320  ct and fill its 
-0000e830: 706c 6163 6568 6f6c 6465 7273 2077 6974  placeholders wit
-0000e840: 6820 696e 666f 726d 6174 696f 6e0a 2020  h information.  
-0000e850: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-0000e860: 2020 2020 2020 2073 656c 662e 6966 646f         self.ifdo
-0000e870: 5f74 6d70 5b73 656c 662e 696d 6167 6553  _tmp[self.imageS
-0000e880: 6574 4865 6164 6572 4b65 795d 5b27 696d  etHeaderKey]['im
-0000e890: 6167 652d 6162 7374 7261 6374 275d 203d  age-abstract'] =
-0000e8a0: 206d 6971 7473 2e70 6172 7365 5265 706c   miqts.parseRepl
-0000e8b0: 6163 6556 616c 2873 656c 662e 6966 646f  aceVal(self.ifdo
-0000e8c0: 5f74 6d70 5b73 656c 662e 696d 6167 6553  _tmp[self.imageS
-0000e8d0: 6574 4865 6164 6572 4b65 795d 2c20 2769  etHeaderKey], 'i
-0000e8e0: 6d61 6765 2d61 6273 7472 6163 7427 290a  mage-abstract').
-0000e8f0: 2020 2020 2020 2020 6578 6365 7074 2045          except E
-0000e900: 7863 6570 7469 6f6e 2061 7320 6578 3a0a  xception as ex:.
-0000e910: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000e920: 2e70 726f 762e 6c6f 6728 2243 6f75 6c64  .prov.log("Could
-0000e930: 206e 6f74 2072 6570 6c61 6365 206b 6579   not replace key
-0000e940: 7320 696e 205c 2769 6d61 6765 2d61 6273  s in \'image-abs
-0000e950: 7472 6163 745c 273a 2022 202b 2073 7472  tract\': " + str
-0000e960: 2865 7829 290a 0a0a 2020 2020 2020 2020  (ex))...        
-0000e970: 2320 7365 7420 7665 7273 696f 6e20 2873  # set version (s
-0000e980: 6f20 6974 2063 616e 6e6f 7420 6265 2063  o it cannot be c
-0000e990: 6861 6e67 6564 2062 7920 7573 6572 290a  hanged by user).
-0000e9a0: 2020 2020 2020 2020 7365 6c66 2e69 6664          self.ifd
-0000e9b0: 6f5f 746d 705b 7365 6c66 2e69 6d61 6765  o_tmp[self.image
-0000e9c0: 5365 7448 6561 6465 724b 6579 5d5b 2769  SetHeaderKey]['i
-0000e9d0: 6d61 6765 2d73 6574 2d69 6664 6f2d 7665  mage-set-ifdo-ve
-0000e9e0: 7273 696f 6e27 5d20 3d20 6d69 7174 762e  rsion'] = miqtv.
-0000e9f0: 6946 444f 5f76 6572 7369 6f6e 0a0a 2020  iFDO_version..  
-0000ea00: 2020 2020 2020 2320 5661 6c69 6461 7465        # Validate
-0000ea10: 2069 7465 6d20 696e 666f 726d 6174 696f   item informatio
-0000ea20: 6e0a 2020 2020 2020 2020 696d 6167 655f  n.        image_
-0000ea30: 7365 745f 6974 656d 7320 3d20 7b7d 0a20  set_items = {}. 
-0000ea40: 2020 2020 2020 2069 6620 6865 6164 6572         if header
-0000ea50: 4f6e 6c79 3a0a 2020 2020 2020 2020 2020  Only:.          
-0000ea60: 2020 7365 6c66 2e70 726f 762e 6c6f 6728    self.prov.log(
-0000ea70: 2243 6175 7469 6f6e 2120 6946 444f 2063  "Caution! iFDO c
-0000ea80: 7265 6174 6564 2069 6e20 6865 6164 6572  reated in header
-0000ea90: 5f6f 6e6c 792f 6967 6e6f 7265 5f69 6d61  _only/ignore_ima
-0000eaa0: 6765 5f66 696c 6520 6d6f 6465 2e20 496d  ge_file mode. Im
-0000eab0: 6167 6520 6974 656d 7320 6172 6520 6e65  age items are ne
-0000eac0: 6974 6865 7220 7570 6461 7465 6420 6e6f  ither updated no
-0000ead0: 7220 6368 6563 6b65 642e 2229 0a20 2020  r checked.").   
-0000eae0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0000eaf0: 2020 2020 2020 2069 6e76 616c 6964 5f69         invalid_i
-0000eb00: 7465 6d73 203d 2030 0a0a 2020 2020 2020  tems = 0..      
-0000eb10: 2020 2020 2020 7072 6f67 203d 206d 6971        prog = miq
-0000eb20: 7463 2e50 7269 6e74 4b6e 6f77 6e50 726f  tc.PrintKnownPro
-0000eb30: 6772 6573 734d 7367 2822 4368 6563 6b69  gressMsg("Checki
-0000eb40: 6e67 2069 7465 6d73 222c 206c 656e 2869  ng items", len(i
-0000eb50: 7465 6d73 292c 6d6f 6475 6c6f 3d35 290a  tems),modulo=5).
-0000eb60: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0000eb70: 6974 656d 2069 6e20 6974 656d 733a 0a20  item in items:. 
-0000eb80: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0000eb90: 726f 672e 7072 6f67 7265 7373 2829 0a20  rog.progress(). 
-0000eba0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0000ebb0: 2063 6865 636b 2069 6620 616c 6c20 636f   check if all co
-0000ebc0: 7265 2066 6965 6c64 7320 6172 6520 6669  re fields are fi
-0000ebd0: 6c6c 6564 2061 6e64 2061 7265 2066 696c  lled and are fil
-0000ebe0: 6c65 6420 7661 6c69 646c 790a 2020 2020  led validly.    
-0000ebf0: 2020 2020 2020 2020 2020 2020 7472 793a              try:
-0000ec00: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000ec10: 2020 2020 2020 2320 6368 6563 6b20 6974        # check it
-0000ec20: 656d 2069 6d61 6765 2065 7869 7374 730a  em image exists.
+00008f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008f30: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
+00008f40: 6c66 2e69 6d61 6765 5365 7448 6561 6465  lf.imageSetHeade
+00008f50: 724b 6579 5d5b 2769 6d61 6765 2d73 656e  rKey]['image-sen
+00008f60: 736f 7227 5d5b 276e 616d 6527 5d29 0a20  sor']['name']). 
+00008f70: 2020 2020 2020 2073 656c 662e 6966 646f         self.ifdo
+00008f80: 5f74 6d70 5b73 656c 662e 696d 6167 6553  _tmp[self.imageS
+00008f90: 6574 4865 6164 6572 4b65 795d 5b27 696d  etHeaderKey]['im
+00008fa0: 6167 652d 7365 742d 6e61 6d65 275d 203d  age-set-name'] =
+00008fb0: 206e 6577 5f69 6d61 6765 5f73 6574 5f6e   new_image_set_n
+00008fc0: 616d 650a 2020 2020 2020 2020 7265 7475  ame.        retu
+00008fd0: 726e 206e 6577 5f69 6d61 6765 5f73 6574  rn new_image_set
+00008fe0: 5f6e 616d 650a 2020 2020 2020 2020 0a0a  _name.        ..
+00008ff0: 2020 2020 4073 7461 7469 636d 6574 686f      @staticmetho
+00009000: 640a 2020 2020 6465 6620 636f 6e73 7472  d.    def constr
+00009010: 7563 7449 6d61 6765 5365 744e 616d 6528  uctImageSetName(
+00009020: 7072 6f6a 6563 743a 7374 722c 6576 656e  project:str,even
+00009030: 743a 7374 722c 7365 6e73 6f72 3a73 7472  t:str,sensor:str
+00009040: 293a 0a20 2020 2020 2020 2022 2222 2072  ):.        """ r
+00009050: 6574 7572 6e73 203c 7072 6f6a 6563 743e  eturns <project>
+00009060: 5f3c 6576 656e 743e 5f3c 7365 6e73 6f72  _<event>_<sensor
+00009070: 3e2c 2077 6974 6820 7368 6f72 7420 7665  >, with short ve
+00009080: 7273 696f 6e20 6f66 203c 7365 6e73 6f72  rsion of <sensor
+00009090: 3e20 286f 6e6c 7920 6964 292c 2070 7265  > (only id), pre
+000090a0: 7665 6e74 696e 6720 706f 7465 6e74 6961  venting potentia
+000090b0: 6c20 646f 7562 6c69 6e67 206f 6620 3c70  l doubling of <p
+000090c0: 726f 6a65 6374 3e20 2022 2222 0a20 2020  roject>  """.   
+000090d0: 2020 2020 2073 656e 736f 725f 7368 6f72       sensor_shor
+000090e0: 7420 3d20 6946 444f 2e67 6574 5368 6f72  t = iFDO.getShor
+000090f0: 7445 7175 6970 6d65 6e74 4944 2873 656e  tEquipmentID(sen
+00009100: 736f 7229 0a20 2020 2020 2020 2069 6620  sor).        if 
+00009110: 6c65 6e28 6576 656e 7429 203e 206c 656e  len(event) > len
+00009120: 2870 726f 6a65 6374 2920 616e 6420 6576  (project) and ev
+00009130: 656e 745b 303a 6c65 6e28 7072 6f6a 6563  ent[0:len(projec
+00009140: 7429 5d20 3d3d 2070 726f 6a65 6374 3a0a  t)] == project:.
+00009150: 2020 2020 2020 2020 2020 2020 696d 6167              imag
+00009160: 655f 7365 745f 6e61 6d65 5f20 3d20 6576  e_set_name_ = ev
+00009170: 656e 7420 2b20 225f 2220 2b20 7365 6e73  ent + "_" + sens
+00009180: 6f72 5f73 686f 7274 0a20 2020 2020 2020  or_short.       
+00009190: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+000091a0: 2020 2069 6d61 6765 5f73 6574 5f6e 616d     image_set_nam
+000091b0: 655f 203d 2070 726f 6a65 6374 202b 2022  e_ = project + "
+000091c0: 5f22 202b 2065 7665 6e74 202b 2022 5f22  _" + event + "_"
+000091d0: 202b 2073 656e 736f 725f 7368 6f72 740a   + sensor_short.
+000091e0: 2020 2020 2020 2020 7265 7475 726e 2069          return i
+000091f0: 6d61 6765 5f73 6574 5f6e 616d 655f 2023  mage_set_name_ #
+00009200: 2054 4f44 4f20 696e 636c 7564 6520 6461   TODO include da
+00009210: 7461 5479 7065 3f0a 0a0a 2020 2020 4073  taType?...    @s
+00009220: 7461 7469 636d 6574 686f 640a 2020 2020  taticmethod.    
+00009230: 6465 6620 6765 7453 686f 7274 4571 7569  def getShortEqui
+00009240: 706d 656e 7449 4428 6571 7569 706d 656e  pmentID(equipmen
+00009250: 7449 443a 7374 7229 3a0a 2020 2020 2020  tID:str):.      
+00009260: 2020 2222 2220 7265 7475 726e 7320 6571    """ returns eq
+00009270: 7569 706d 656e 7420 6964 2077 6974 686f  uipment id witho
+00009280: 7574 2070 6f74 656e 7469 616c 6c20 6c6f  ut potentiall lo
+00009290: 6e67 203c 6e61 6d65 3e20 7061 7274 2c20  ng <name> part, 
+000092a0: 692e 652e 3a20 3c6f 776e 6572 3e5f 3c74  i.e.: <owner>_<t
+000092b0: 7970 653e 2d3c 7479 7065 2069 6e64 6578  ype>-<type index
+000092c0: 5b5f 3c73 7562 7479 7065 3e5d 2022 2222  [_<subtype>] """
+000092d0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000092e0: 275f 272e 6a6f 696e 2865 7175 6970 6d65  '_'.join(equipme
+000092f0: 6e74 4944 2e73 706c 6974 2827 5f27 295b  ntID.split('_')[
+00009300: 303a 335d 290a 0a20 2020 2040 7374 6174  0:3])..    @stat
+00009310: 6963 6d65 7468 6f64 0a20 2020 2064 6566  icmethod.    def
+00009320: 2063 6f6e 7374 7275 6374 6946 444f 6669   constructiFDOfi
+00009330: 6c65 4e61 6d65 2870 726f 6a65 6374 3a73  leName(project:s
+00009340: 7472 2c65 7665 6e74 3a73 7472 2c73 656e  tr,event:str,sen
+00009350: 736f 723a 7374 7229 3a0a 2020 2020 2020  sor:str):.      
+00009360: 2020 2222 2220 7265 7475 726e 7320 3c63    """ returns <c
+00009370: 6f6e 7374 7275 6374 496d 6167 6553 6574  onstructImageSet
+00009380: 4e61 6d65 2829 3e5f 6946 444f 2e6a 736f  Name()>_iFDO.jso
+00009390: 6e20 2222 220a 2020 2020 2020 2020 7265  n """.        re
+000093a0: 7475 726e 2069 4644 4f2e 636f 6e73 7472  turn iFDO.constr
+000093b0: 7563 7449 6d61 6765 5365 744e 616d 6528  uctImageSetName(
+000093c0: 7072 6f6a 6563 742c 6576 656e 742c 7365  project,event,se
+000093d0: 6e73 6f72 2920 2b20 275f 6946 444f 2e6a  nsor) + '_iFDO.j
+000093e0: 736f 6e27 200a 0a20 2020 200a 2020 2020  son' ..    .    
+000093f0: 4073 7461 7469 636d 6574 686f 640a 2020  @staticmethod.  
+00009400: 2020 6465 6620 5f5f 6765 7446 6965 6c64    def __getField
+00009410: 5661 6c75 6528 6966 646f 3a64 6963 742c  Value(ifdo:dict,
+00009420: 6b65 7973 3a6c 6973 742c 6465 6661 756c  keys:list,defaul
+00009430: 745f 6f6e 6c79 203d 2046 616c 7365 293a  t_only = False):
+00009440: 0a20 2020 2020 2020 2022 2222 2072 6574  .        """ ret
+00009450: 7572 6e73 2063 6f70 7920 6f66 2073 6574  urns copy of set
+00009460: 206f 7220 6974 656d 2066 6965 6c64 2076   or item field v
+00009470: 616c 7565 2c20 616c 736f 2063 6f6e 7369  alue, also consi
+00009480: 6465 726e 6720 6465 6661 756c 7420 7661  derng default va
+00009490: 6c75 6573 2066 726f 6d20 6865 6164 6572  lues from header
+000094a0: 2e0a 2020 2020 2020 2020 2020 2020 5573  ..            Us
+000094b0: 6520 6b65 7973 2061 7320 652e 672e 205b  e keys as e.g. [
+000094c0: 3c69 7465 6d3e 2c3c 6b65 793e 2c2e 2e5d  <item>,<key>,..]
+000094d0: 2e20 4361 6e20 6265 2075 7365 6420 666f  . Can be used fo
+000094e0: 7220 6865 6164 6572 2066 6965 6c64 7320  r header fields 
+000094f0: 6173 2077 656c 6c20 6173 2069 7465 6d20  as well as item 
+00009500: 6669 656c 6473 2e0a 2020 2020 2020 2020  fields..        
+00009510: 2020 2020 4974 656d 2069 6e64 6578 2063      Item index c
+00009520: 616e 2062 6520 6e65 676c 6563 7465 642c  an be neglected,
+00009530: 2069 6e20 6361 7365 206f 6620 7669 6465   in case of vide
+00009540: 6f20 6120 6469 6374 207b 3c69 6d61 6765  o a dict {<image
+00009550: 2d64 6174 6174 696d 653e 3a3c 7661 6c75  -datatime>:<valu
+00009560: 653e 2c2e 2e2e 7d20 6973 2072 6574 7572  e>,...} is retur
+00009570: 6e65 640a 2020 2020 2020 2020 2020 2020  ned.            
+00009580: 756e 6c65 7373 2064 6566 6175 6c74 5f6f  unless default_o
+00009590: 6e6c 7920 3d20 4661 6c73 652c 2074 6865  nly = False, the
+000095a0: 6e20 6465 6661 756c 7420 7661 6c75 6573  n default values
+000095b0: 2061 7420 696e 6465 7820 3020 6973 2072   at index 0 is r
+000095c0: 6574 7572 6e65 642e 0a20 2020 2020 2020  eturned..       
+000095d0: 2020 2020 2052 6169 7365 7320 4966 646f       Raises Ifdo
+000095e0: 4578 6365 7074 696f 6e20 6966 206b 6579  Exception if key
+000095f0: 7320 646f 206e 6f74 2065 7869 7374 2e20  s do not exist. 
+00009600: 2222 220a 0a20 2020 2020 2020 2069 6620  """..        if 
+00009610: 6e6f 7420 6d69 7174 762e 696d 6167 655f  not miqtv.image_
+00009620: 7365 745f 6974 656d 735f 6b65 7920 696e  set_items_key in
+00009630: 2069 6664 6f20 6f72 206e 6f74 206d 6971   ifdo or not miq
+00009640: 7476 2e69 6d61 6765 5f73 6574 5f68 6561  tv.image_set_hea
+00009650: 6465 725f 6b65 7920 696e 2069 6664 6f3a  der_key in ifdo:
+00009660: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+00009670: 7365 206d 6971 7463 2e49 6664 6f45 7863  se miqtc.IfdoExc
+00009680: 6570 7469 6f6e 2822 496e 7661 6c69 6420  eption("Invalid 
+00009690: 6966 646f 2064 6963 742c 206d 6973 7369  ifdo dict, missi
+000096a0: 6e67 2069 7465 6d73 206f 7220 6865 6164  ng items or head
+000096b0: 6572 206b 6579 3a20 2220 2b20 7374 7228  er key: " + str(
+000096c0: 6966 646f 2929 0a20 2020 2020 2020 200a  ifdo)).        .
+000096d0: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
+000096e0: 7369 6e73 7461 6e63 6528 6b65 7973 2c6c  sinstance(keys,l
+000096f0: 6973 7429 3a0a 2020 2020 2020 2020 2020  ist):.          
+00009700: 2020 6b65 7973 203d 205b 6b65 7973 5d0a    keys = [keys].
+00009710: 0a20 2020 2020 2020 2023 2072 656d 6f76  .        # remov
+00009720: 6520 6865 6164 6572 206f 7220 6974 656d  e header or item
+00009730: 2070 7265 6669 7865 7320 6966 2074 6865   prefixes if the
+00009740: 7265 0a20 2020 2020 2020 2069 6620 6b65  re.        if ke
+00009750: 7973 5b30 5d20 3d3d 206d 6971 7476 2e69  ys[0] == miqtv.i
+00009760: 6d61 6765 5f73 6574 5f69 7465 6d73 5f6b  mage_set_items_k
+00009770: 6579 206f 7220 6b65 7973 5b30 5d20 3d3d  ey or keys[0] ==
+00009780: 206d 6971 7476 2e69 6d61 6765 5f73 6574   miqtv.image_set
+00009790: 5f68 6561 6465 725f 6b65 793a 0a20 2020  _header_key:.   
+000097a0: 2020 2020 2020 2020 206b 6579 7320 3d20           keys = 
+000097b0: 6b65 7973 5b31 3a3a 5d0a 0a20 2020 2020  keys[1::]..     
+000097c0: 2020 2068 6561 6465 7220 3d20 6966 646f     header = ifdo
+000097d0: 5b6d 6971 7476 2e69 6d61 6765 5f73 6574  [miqtv.image_set
+000097e0: 5f68 6561 6465 725f 6b65 795d 0a20 2020  _header_key].   
+000097f0: 2020 2020 2069 7465 6d73 203d 2069 6664       items = ifd
+00009800: 6f5b 6d69 7174 762e 696d 6167 655f 7365  o[miqtv.image_se
+00009810: 745f 6974 656d 735f 6b65 795d 0a20 2020  t_items_key].   
+00009820: 2020 2020 2023 206c 6f6f 6b20 666f 7220       # look for 
+00009830: 6465 6661 756c 7420 7661 6c75 650a 2020  default value.  
+00009840: 2020 2020 2020 666f 7220 736b 6970 7065        for skippe
+00009850: 6449 6e48 6561 6465 7220 696e 2072 616e  dInHeader in ran
+00009860: 6765 286c 656e 286b 6579 7329 293a 0a20  ge(len(keys)):. 
+00009870: 2020 2020 2020 2020 2020 2064 6566 6175             defau
+00009880: 6c74 5661 6c20 3d20 6669 6e64 4669 656c  ltVal = findFiel
+00009890: 6428 6865 6164 6572 2c6b 6579 735b 736b  d(header,keys[sk
+000098a0: 6970 7065 6449 6e48 6561 6465 723a 3a5d  ippedInHeader::]
+000098b0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+000098c0: 2064 6566 6175 6c74 5661 6c20 213d 2022   defaultVal != "
+000098d0: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
+000098e0: 2020 2062 7265 616b 0a0a 2020 2020 2020     break..      
+000098f0: 2020 2323 206c 6f6f 6b20 666f 7220 6974    ## look for it
+00009900: 656d 2076 616c 7565 0a20 2020 2020 2020  em value.       
+00009910: 2023 2068 6561 6465 7220 6f6e 6c79 2076   # header only v
+00009920: 616c 7565 2c20 646f 6e27 7420 6368 6563  alue, don't chec
+00009930: 6b20 696e 2069 7465 6d73 0a20 2020 2020  k in items.     
+00009940: 2020 2069 6620 6669 6e64 4669 656c 6428     if findField(
+00009950: 6974 656d 732c 6b65 7973 5b30 3a31 5d29  items,keys[0:1])
+00009960: 203d 3d20 2222 2061 6e64 2073 6b69 7070   == "" and skipp
+00009970: 6564 496e 4865 6164 6572 203d 3d20 303a  edInHeader == 0:
+00009980: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00009990: 203d 2064 6566 6175 6c74 5661 6c0a 2020   = defaultVal.  
+000099a0: 2020 2020 2020 2020 2020 6966 2072 6574            if ret
+000099b0: 203d 3d20 2222 3a0a 2020 2020 2020 2020   == "":.        
+000099c0: 2020 2020 2020 2020 7261 6973 6520 6d69          raise mi
+000099d0: 7174 632e 4966 646f 4578 6365 7074 696f  qtc.IfdoExceptio
+000099e0: 6e28 226b 6579 2064 6f65 7320 6e6f 7420  n("key does not 
+000099f0: 6578 6973 743a 2220 2b20 7374 7228 6b65  exist:" + str(ke
+00009a00: 7973 2929 0a20 2020 2020 2020 2065 6c73  ys)).        els
+00009a10: 653a 0a20 2020 2020 2020 2020 2020 2023  e:.            #
+00009a20: 2069 6620 6669 7273 7420 6b65 7920 6e6f   if first key no
+00009a30: 7420 666f 756e 6420 696e 2069 7465 6d73  t found in items
+00009a40: 2c20 692e 652e 2069 7320 6e6f 7420 6120  , i.e. is not a 
+00009a50: 696d 6167 6520 6e61 6d65 2c20 616e 6420  image name, and 
+00009a60: 6669 7273 7420 6b65 7920 6973 206e 6f74  first key is not
+00009a70: 2061 2068 6561 6465 7220 6b65 793a 0a20   a header key:. 
+00009a80: 2020 2020 2020 2020 2020 2069 6620 6669             if fi
+00009a90: 6e64 4669 656c 6428 6974 656d 732c 6b65  ndField(items,ke
+00009aa0: 7973 5b30 3a31 5d29 203d 3d20 2222 2061  ys[0:1]) == "" a
+00009ab0: 6e64 2073 6b69 7070 6564 496e 4865 6164  nd skippedInHead
+00009ac0: 6572 2021 3d20 303a 0a20 2020 2020 2020  er != 0:.       
+00009ad0: 2020 2020 2020 2020 2072 6169 7365 206d           raise m
+00009ae0: 6971 7463 2e49 6664 6f45 7863 6570 7469  iqtc.IfdoExcepti
+00009af0: 6f6e 2822 6974 656d 2064 6f65 7320 6e6f  on("item does no
+00009b00: 7420 6578 6973 743a 2220 2b20 7374 7228  t exist:" + str(
+00009b10: 6b65 7973 5b30 3a31 5d29 290a 0a20 2020  keys[0:1]))..   
+00009b20: 2020 2020 2020 2020 2023 2063 6865 636b           # check
+00009b30: 2069 6620 696e 6465 7820 7072 6f76 6964   if index provid
+00009b40: 6564 0a20 2020 2020 2020 2020 2020 2069  ed.            i
+00009b50: 6e64 6578 5072 6f76 6964 6564 203d 2054  ndexProvided = T
+00009b60: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
+00009b70: 6966 206c 656e 286b 6579 7329 203e 2031  if len(keys) > 1
+00009b80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00009b90: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+00009ba0: 2020 2020 2020 2020 2020 2069 6e64 6578             index
+00009bb0: 203d 2069 6e74 286b 6579 735b 315d 290a   = int(keys[1]).
+00009bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009bd0: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
+00009be0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00009bf0: 2020 2020 2020 696e 6465 7850 726f 7669        indexProvi
+00009c00: 6465 6420 3d20 4661 6c73 650a 2020 2020  ded = False.    
+00009c10: 2020 2020 2020 2020 656c 6966 206c 656e          elif len
+00009c20: 286b 6579 7329 203d 3d20 313a 0a20 2020  (keys) == 1:.   
+00009c30: 2020 2020 2020 2020 2020 2020 2069 6e64               ind
+00009c40: 6578 5072 6f76 6964 6564 203d 2046 616c  exProvided = Fal
+00009c50: 7365 0a20 2020 2020 2020 2020 2020 2020  se.             
+00009c60: 2020 200a 2020 2020 2020 2020 2020 2020     .            
+00009c70: 696d 6167 6549 7465 6d54 696d 6550 6f69  imageItemTimePoi
+00009c80: 6e74 7320 3d20 6974 656d 735b 6b65 7973  nts = items[keys
+00009c90: 5b30 5d5d 0a0a 2020 2020 2020 2020 2020  [0]]..          
+00009ca0: 2020 6966 2069 6e64 6578 5072 6f76 6964    if indexProvid
+00009cb0: 6564 3a0a 2020 2020 2020 2020 2020 2020  ed:.            
+00009cc0: 2020 2020 2320 6966 206b 6579 2069 7320      # if key is 
+00009cd0: 7768 6f6c 6520 696d 6167 6520 6164 6420  whole image add 
+00009ce0: 616c 6c20 7661 6c75 6573 2066 726f 6d20  all values from 
+00009cf0: 6865 6164 6572 0a20 2020 2020 2020 2020  header.         
+00009d00: 2020 2020 2020 2069 6620 6c65 6e28 6b65         if len(ke
+00009d10: 7973 2920 3d3d 2032 3a0a 2020 2020 2020  ys) == 2:.      
+00009d20: 2020 2020 2020 2020 2020 2020 2020 6465                de
+00009d30: 6661 756c 7456 616c 203d 2068 6561 6465  faultVal = heade
+00009d40: 720a 2020 2020 2020 2020 2020 2020 2020  r.              
+00009d50: 2020 2320 6164 6420 6465 6661 756c 7420    # add default 
+00009d60: 6672 6f6d 2069 6e64 6578 2030 0a20 2020  from index 0.   
+00009d70: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00009d80: 6c65 6e28 6b65 7973 2920 3e20 3120 616e  len(keys) > 1 an
+00009d90: 6420 696e 6465 7820 213d 2030 3a0a 2020  d index != 0:.  
+00009da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009db0: 2020 6b65 7973 5f30 203d 2063 6f70 792e    keys_0 = copy.
+00009dc0: 6465 6570 636f 7079 286b 6579 7329 0a20  deepcopy(keys). 
+00009dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009de0: 2020 206b 6579 735f 305b 315d 203d 2030     keys_0[1] = 0
+00009df0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009e00: 2020 2020 2072 6574 5f30 203d 2069 4644       ret_0 = iFD
+00009e10: 4f2e 5f5f 6765 7449 7465 6d56 616c 7565  O.__getItemValue
+00009e20: 2869 7465 6d73 2c6b 6579 735f 302c 736b  (items,keys_0,sk
+00009e30: 6970 7065 6449 6e48 6561 6465 722c 6465  ippedInHeader,de
+00009e40: 6661 756c 7456 616c 290a 2020 2020 2020  faultVal).      
+00009e50: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00009e60: 2069 7369 6e73 7461 6e63 6528 7265 745f   isinstance(ret_
+00009e70: 302c 6469 6374 293a 0a20 2020 2020 2020  0,dict):.       
+00009e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009e90: 2064 6566 6175 6c74 5661 6c20 3d20 7b2a   defaultVal = {*
+00009ea0: 2a64 6566 6175 6c74 5661 6c2c 2a2a 7265  *defaultVal,**re
+00009eb0: 745f 307d 0a20 2020 2020 2020 2020 2020  t_0}.           
+00009ec0: 2020 2020 2072 6574 203d 2069 4644 4f2e       ret = iFDO.
+00009ed0: 5f5f 6765 7449 7465 6d56 616c 7565 2869  __getItemValue(i
+00009ee0: 7465 6d73 2c6b 6579 732c 736b 6970 7065  tems,keys,skippe
+00009ef0: 6449 6e48 6561 6465 722c 6465 6661 756c  dInHeader,defaul
+00009f00: 7456 616c 290a 2020 2020 2020 2020 2020  tVal).          
+00009f10: 2020 0a20 2020 2020 2020 2020 2020 2065    .            e
+00009f20: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00009f30: 2020 2020 2023 2069 6620 6b65 7920 6973       # if key is
+00009f40: 2077 686f 6c65 2069 6d61 6765 2061 6464   whole image add
+00009f50: 2061 6c6c 2076 616c 7565 7320 6672 6f6d   all values from
+00009f60: 2068 6561 6465 720a 2020 2020 2020 2020   header.        
+00009f70: 2020 2020 2020 2020 6966 206c 656e 286b          if len(k
+00009f80: 6579 7329 203d 3d20 313a 0a20 2020 2020  eys) == 1:.     
+00009f90: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00009fa0: 6566 6175 6c74 5661 6c20 3d20 6865 6164  efaultVal = head
+00009fb0: 6572 0a0a 2020 2020 2020 2020 2020 2020  er..            
+00009fc0: 2020 2020 2320 7069 6374 7572 6520 2d3e      # picture ->
+00009fd0: 206a 7573 7420 6f6e 6520 656e 7472 792c   just one entry,
+00009fe0: 2069 6e73 6572 7420 696e 6465 7820 300a   insert index 0.
+00009ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a000: 6966 206c 656e 2869 6d61 6765 4974 656d  if len(imageItem
+0000a010: 5469 6d65 506f 696e 7473 2920 3d3d 2031  TimePoints) == 1
+0000a020: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000a030: 2020 2020 2020 6b65 7973 203d 206b 6579        keys = key
+0000a040: 735b 303a 315d 202b 205b 305d 202b 206b  s[0:1] + [0] + k
+0000a050: 6579 735b 313a 3a5d 0a20 2020 2020 2020  eys[1::].       
+0000a060: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0000a070: 203d 2069 4644 4f2e 5f5f 6765 7449 7465   = iFDO.__getIte
+0000a080: 6d56 616c 7565 2869 7465 6d73 2c6b 6579  mValue(items,key
+0000a090: 732c 736b 6970 7065 6449 6e48 6561 6465  s,skippedInHeade
+0000a0a0: 722c 6465 6661 756c 7456 616c 290a 2020  r,defaultVal).  
+0000a0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a0c0: 2020 0a20 2020 2020 2020 2020 2020 2020    .             
+0000a0d0: 2020 2023 2076 6964 656f 202d 3e20 7265     # video -> re
+0000a0e0: 7475 726e 2076 616c 7565 7320 666f 7220  turn values for 
+0000a0f0: 6561 6368 2074 696d 6520 7374 616d 700a  each time stamp.
+0000a100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a110: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0000a120: 2020 2020 2020 2020 2020 7265 7420 3d20            ret = 
+0000a130: 7b7d 0a20 2020 2020 2020 2020 2020 2020  {}.             
+0000a140: 2020 2020 2020 2066 6f72 2069 2069 6e20         for i in 
+0000a150: 7261 6e67 6528 6c65 6e28 696d 6167 6549  range(len(imageI
+0000a160: 7465 6d54 696d 6550 6f69 6e74 7329 293a  temTimePoints)):
+0000a170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a180: 2020 2020 2020 2020 2074 696d 6550 6f69           timePoi
+0000a190: 6e74 4461 7461 203d 2069 6d61 6765 4974  ntData = imageIt
+0000a1a0: 656d 5469 6d65 506f 696e 7473 5b69 5d0a  emTimePoints[i].
+0000a1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a1c0: 2020 2020 2020 2020 6b65 7973 5f69 203d          keys_i =
+0000a1d0: 206b 6579 735b 303a 315d 202b 205b 695d   keys[0:1] + [i]
+0000a1e0: 202b 206b 6579 735b 313a 3a5d 0a20 2020   + keys[1::].   
+0000a1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a200: 2020 2020 2076 616c 5f69 203d 2069 4644       val_i = iFD
+0000a210: 4f2e 5f5f 6765 7449 7465 6d56 616c 7565  O.__getItemValue
+0000a220: 2869 7465 6d73 2c6b 6579 735f 692c 736b  (items,keys_i,sk
+0000a230: 6970 7065 6449 6e48 6561 6465 722c 6465  ippedInHeader,de
+0000a240: 6661 756c 7456 616c 290a 2020 2020 2020  faultVal).      
+0000a250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a260: 2020 2320 6465 6661 756c 7420 6f6e 6c79    # default only
+0000a270: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a280: 2020 2020 2020 2020 2069 6620 6465 6661           if defa
+0000a290: 756c 745f 6f6e 6c79 3a0a 2020 2020 2020  ult_only:.      
+0000a2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a2b0: 2020 2020 2020 7265 7420 3d20 7661 6c5f        ret = val_
+0000a2c0: 690a 2020 2020 2020 2020 2020 2020 2020  i.              
+0000a2d0: 2020 2020 2020 2020 2020 2020 2020 6272                br
+0000a2e0: 6561 6b0a 2020 2020 2020 2020 2020 2020  eak.            
+0000a2f0: 2020 2020 2020 2020 2020 2020 7265 745b              ret[
+0000a300: 7469 6d65 506f 696e 7444 6174 615b 2769  timePointData['i
+0000a310: 6d61 6765 2d64 6174 6574 696d 6527 5d5d  mage-datetime']]
+0000a320: 203d 2076 616c 5f69 0a20 2020 2020 2020   = val_i.       
+0000a330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a340: 2023 2072 656d 6f76 6520 696d 6167 652d   # remove image-
+0000a350: 6461 7465 7469 6d65 2069 6620 7468 6572  datetime if ther
+0000a360: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+0000a370: 2020 2020 2020 2020 2020 6966 2069 7369            if isi
+0000a380: 6e73 7461 6e63 6528 7265 745b 7469 6d65  nstance(ret[time
+0000a390: 506f 696e 7444 6174 615b 2769 6d61 6765  PointData['image
+0000a3a0: 2d64 6174 6574 696d 6527 5d5d 2c64 6963  -datetime']],dic
+0000a3b0: 7429 2061 6e64 2027 696d 6167 652d 6461  t) and 'image-da
+0000a3c0: 7465 7469 6d65 2720 696e 2072 6574 5b74  tetime' in ret[t
+0000a3d0: 696d 6550 6f69 6e74 4461 7461 5b27 696d  imePointData['im
+0000a3e0: 6167 652d 6461 7465 7469 6d65 275d 5d3a  age-datetime']]:
+0000a3f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a400: 2020 2020 2020 2020 2020 2020 2064 656c               del
+0000a410: 2072 6574 5b74 696d 6550 6f69 6e74 4461   ret[timePointDa
+0000a420: 7461 5b27 696d 6167 652d 6461 7465 7469  ta['image-dateti
+0000a430: 6d65 275d 5d5b 2769 6d61 6765 2d64 6174  me']]['image-dat
+0000a440: 6574 696d 6527 5d0a 2020 2020 2020 2020  etime'].        
+0000a450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a460: 2320 7669 6465 6f20 6465 6661 756c 7473  # video defaults
+0000a470: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a480: 2020 2020 2020 2020 2069 6620 6920 3d3d           if i ==
+0000a490: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+0000a4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a4b0: 6966 2069 7369 6e73 7461 6e63 6528 7265  if isinstance(re
+0000a4c0: 745b 7469 6d65 506f 696e 7444 6174 615b  t[timePointData[
+0000a4d0: 2769 6d61 6765 2d64 6174 6574 696d 6527  'image-datetime'
+0000a4e0: 5d5d 2c64 6963 7429 3a0a 2020 2020 2020  ]],dict):.      
+0000a4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a500: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
+0000a510: 7456 616c 203d 207b 2a2a 6465 6661 756c  tVal = {**defaul
+0000a520: 7456 616c 2c2a 2a72 6574 5b74 696d 6550  tVal,**ret[timeP
+0000a530: 6f69 6e74 4461 7461 5b27 696d 6167 652d  ointData['image-
+0000a540: 6461 7465 7469 6d65 275d 5d7d 0a20 2020  datetime']]}.   
+0000a550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a560: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0000a570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a580: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0000a590: 6566 6175 6c74 5661 6c20 3d20 7265 745b  efaultVal = ret[
+0000a5a0: 7469 6d65 506f 696e 7444 6174 615b 2769  timePointData['i
+0000a5b0: 6d61 6765 2d64 6174 6574 696d 6527 5d5d  mage-datetime']]
+0000a5c0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000a5d0: 2020 2020 2020 2020 2020 6920 2b3d 2031            i += 1
+0000a5e0: 0a0a 2020 2020 2020 2020 6966 2069 7369  ..        if isi
+0000a5f0: 6e73 7461 6e63 6528 7265 742c 6469 6374  nstance(ret,dict
+0000a600: 2920 6f72 2069 7369 6e73 7461 6e63 6528  ) or isinstance(
+0000a610: 7265 742c 6c69 7374 293a 0a20 2020 2020  ret,list):.     
+0000a620: 2020 2020 2020 2072 6574 203d 2063 6f70         ret = cop
+0000a630: 792e 6465 6570 636f 7079 2872 6574 290a  y.deepcopy(ret).
+0000a640: 2020 2020 2020 2020 6966 2072 6574 203d          if ret =
+0000a650: 3d20 2222 206f 7220 7265 7420 3d3d 207b  = "" or ret == {
+0000a660: 7d3a 0a20 2020 2020 2020 2020 2020 2072  }:.            r
+0000a670: 6169 7365 206d 6971 7463 2e49 6664 6f45  aise miqtc.IfdoE
+0000a680: 7863 6570 7469 6f6e 2822 6b65 7973 2064  xception("keys d
+0000a690: 6f20 6e6f 7420 6578 6973 743a 2220 2b20  o not exist:" + 
+0000a6a0: 7374 7228 6b65 7973 2929 0a20 2020 2020  str(keys)).     
+0000a6b0: 2020 2072 6574 7572 6e20 7265 740a 0a0a     return ret...
+0000a6c0: 2020 2020 4073 7461 7469 636d 6574 686f      @staticmetho
+0000a6d0: 640a 2020 2020 6465 6620 5f5f 6765 7449  d.    def __getI
+0000a6e0: 7465 6d56 616c 7565 2869 7465 6d73 2c6b  temValue(items,k
+0000a6f0: 6579 732c 736b 6970 7065 6449 6e48 6561  eys,skippedInHea
+0000a700: 6465 722c 6465 6661 756c 7456 616c 293a  der,defaultVal):
+0000a710: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
+0000a720: 2020 2320 696e 2063 6173 6520 6974 656d    # in case item
+0000a730: 2069 7320 6e6f 7420 6120 6c69 7374 2028   is not a list (
+0000a740: 7368 6f75 6c64 206e 6f74 2062 6520 706f  should not be po
+0000a750: 7373 6962 6c65 290a 2020 2020 2020 2020  ssible).        
+0000a760: 6966 206e 6f74 2069 7369 6e73 7461 6e63  if not isinstanc
+0000a770: 6528 6974 656d 735b 6b65 7973 5b30 5d5d  e(items[keys[0]]
+0000a780: 2c6c 6973 7429 3a0a 2020 2020 2020 2020  ,list):.        
+0000a790: 2020 2020 6974 656d 735b 6b65 7973 5b30      items[keys[0
+0000a7a0: 5d5d 203d 205b 6974 656d 735b 6b65 7973  ]] = [items[keys
+0000a7b0: 5b30 5d5d 5d0a 0a20 2020 2020 2020 2069  [0]]]..        i
+0000a7c0: 7465 6d56 616c 7565 203d 2066 696e 6446  temValue = findF
+0000a7d0: 6965 6c64 2869 7465 6d73 2c6b 6579 7329  ield(items,keys)
+0000a7e0: 0a0a 2020 2020 2020 2020 6966 2069 7465  ..        if ite
+0000a7f0: 6d56 616c 7565 203d 3d20 2222 3a0a 2020  mValue == "":.  
+0000a800: 2020 2020 2020 2020 2020 7265 7420 3d20            ret = 
+0000a810: 6465 6661 756c 7456 616c 0a20 2020 2020  defaultVal.     
+0000a820: 2020 2023 2069 6e20 6361 7365 206f 6620     # in case of 
+0000a830: 6469 6374 7320 6a6f 696e 7420 6865 6164  dicts joint head
+0000a840: 6572 2061 6e64 2069 7465 6d20 6669 656c  er and item fiel
+0000a850: 6473 0a20 2020 2020 2020 2065 6c69 6620  ds.        elif 
+0000a860: 6973 696e 7374 616e 6365 2869 7465 6d56  isinstance(itemV
+0000a870: 616c 7565 2c64 6963 7429 2061 6e64 2064  alue,dict) and d
+0000a880: 6566 6175 6c74 5661 6c20 213d 2022 223a  efaultVal != "":
+0000a890: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000a8a0: 6e6f 7420 6973 696e 7374 616e 6365 2864  not isinstance(d
+0000a8b0: 6566 6175 6c74 5661 6c2c 6469 6374 293a  efaultVal,dict):
+0000a8c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a8d0: 2072 6169 7365 206d 6971 7463 2e49 6664   raise miqtc.Ifd
+0000a8e0: 6f45 7863 6570 7469 6f6e 2822 4974 656d  oException("Item
+0000a8f0: 2066 6965 6c64 2069 7320 6469 6374 2062   field is dict b
+0000a900: 7574 2064 6566 6175 6c74 2076 616c 7565  ut default value
+0000a910: 2069 6e20 6865 6164 6572 2069 7320 6e6f   in header is no
+0000a920: 743a 2022 202b 2073 7472 286b 6579 7329  t: " + str(keys)
+0000a930: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+0000a940: 7420 3d20 7b2a 2a64 6566 6175 6c74 5661  t = {**defaultVa
+0000a950: 6c2c 2a2a 6974 656d 5661 6c75 657d 0a20  l,**itemValue}. 
+0000a960: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0000a970: 2020 2020 2020 2020 2072 6574 203d 2069           ret = i
+0000a980: 7465 6d56 616c 7565 0a20 2020 2020 2020  temValue.       
+0000a990: 2072 6574 7572 6e20 7265 740a 0a0a 2020   return ret...  
+0000a9a0: 2020 6465 6620 5f5f 7374 725f 5f28 7365    def __str__(se
+0000a9b0: 6c66 2920 2d3e 2073 7472 3a0a 2020 2020  lf) -> str:.    
+0000a9c0: 2020 2020 2222 2220 5072 696e 7473 2063      """ Prints c
+0000a9d0: 7572 7265 6e74 2069 4644 4f20 6669 6c65  urrent iFDO file
+0000a9e0: 2022 2222 0a20 2020 2020 2020 2072 6574   """.        ret
+0000a9f0: 7572 6e20 7961 6d6c 2e64 756d 7028 7365  urn yaml.dump(se
+0000aa00: 6c66 2e69 6664 6f5f 6368 6563 6b65 642c  lf.ifdo_checked,
+0000aa10: 2064 6566 6175 6c74 5f73 7479 6c65 3d4e   default_style=N
+0000aa20: 6f6e 652c 2064 6566 6175 6c74 5f66 6c6f  one, default_flo
+0000aa30: 775f 7374 796c 653d 4e6f 6e65 2c20 616c  w_style=None, al
+0000aa40: 6c6f 775f 756e 6963 6f64 653d 5472 7565  low_unicode=True
+0000aa50: 2c20 7769 6474 683d 666c 6f61 7428 2269  , width=float("i
+0000aa60: 6e66 2229 290a 0a0a 2020 2020 6465 6620  nf"))...    def 
+0000aa70: 5f5f 6765 7469 7465 6d5f 5f28 7365 6c66  __getitem__(self
+0000aa80: 2c20 6b65 7973 293a 0a20 2020 2020 2020  , keys):.       
+0000aa90: 2022 2222 2052 6574 7572 6e73 2063 6f70   """ Returns cop
+0000aaa0: 7920 6f66 2063 6865 636b 6564 2069 6664  y of checked ifd
+0000aab0: 6f20 7365 7420 6f72 2069 7465 6d20 6669  o set or item fi
+0000aac0: 656c 6420 7661 6c75 652c 2061 6c73 6f20  eld value, also 
+0000aad0: 636f 6e73 6964 6572 6e67 2064 6566 6175  considerng defau
+0000aae0: 6c74 2076 616c 7565 7320 6672 6f6d 2068  lt values from h
+0000aaf0: 6561 6465 722e 0a20 2020 2020 2020 2020  eader..         
+0000ab00: 2020 2055 7365 206b 6579 7320 6173 2065     Use keys as e
+0000ab10: 2e67 2e20 273c 6974 656d 3e3a 3c6b 6579  .g. '<item>:<key
+0000ab20: 3e3a 2e2e 2e27 2e20 4361 6e20 6265 2075  >:...'. Can be u
+0000ab30: 7365 6420 666f 7220 6865 6164 6572 2066  sed for header f
+0000ab40: 6965 6c64 7320 6173 2077 656c 6c20 6173  ields as well as
+0000ab50: 2069 7465 6d20 6669 656c 6473 2e0a 2020   item fields..  
+0000ab60: 2020 2020 2020 2020 2020 4974 656d 2069            Item i
+0000ab70: 6e64 6578 2063 616e 2062 6520 6c65 676c  ndex can be legl
+0000ab80: 6563 7465 642c 2069 6e20 6361 7365 206f  ected, in case o
+0000ab90: 6620 7669 6465 6f20 6120 6469 6374 207b  f video a dict {
+0000aba0: 3c69 6d61 6765 2d64 6174 6174 696d 653e  <image-datatime>
+0000abb0: 3a3c 7661 6c75 653e 2c2e 2e2e 7d20 6973  :<value>,...} is
+0000abc0: 2072 6574 7572 6e65 642e 0a20 2020 2020   returned..     
+0000abd0: 2020 2020 2020 2052 6169 7365 7320 4966         Raises If
+0000abe0: 646f 4578 6365 7074 696f 6e20 6966 2069  doException if i
+0000abf0: 7465 6d20 646f 6573 206e 6f74 2065 7869  tem does not exi
+0000ac00: 7374 2e20 2222 220a 2020 2020 2020 2020  st. """.        
+0000ac10: 6b65 7973 203d 206b 6579 732e 7370 6c69  keys = keys.spli
+0000ac20: 7428 273a 2729 0a20 2020 2020 2020 2072  t(':').        r
+0000ac30: 6574 7572 6e20 7365 6c66 2e5f 5f67 6574  eturn self.__get
+0000ac40: 4669 656c 6456 616c 7565 2873 656c 662e  FieldValue(self.
+0000ac50: 6966 646f 5f63 6865 636b 6564 2c6b 6579  ifdo_checked,key
+0000ac60: 7329 0a0a 0a20 2020 2064 6566 2066 696e  s)...    def fin
+0000ac70: 6454 6d70 4669 656c 6428 7365 6c66 2c6b  dTmpField(self,k
+0000ac80: 6579 7329 3a0a 2020 2020 2020 2020 2222  eys):.        ""
+0000ac90: 2220 5265 7475 726e 7320 636f 7079 206f  " Returns copy o
+0000aca0: 6620 7465 6d70 6f72 6172 7920 756e 6368  f temporary unch
+0000acb0: 6563 6b65 6420 6966 646f 2073 6574 206f  ecked ifdo set o
+0000acc0: 7220 6974 656d 2066 6965 6c64 2076 616c  r item field val
+0000acd0: 7565 2c20 616c 736f 2063 6f6e 7369 6465  ue, also conside
+0000ace0: 726e 6720 6465 6661 756c 7420 7661 6c75  rng default valu
+0000acf0: 6573 2066 726f 6d20 6865 6164 6572 2e0a  es from header..
+0000ad00: 2020 2020 2020 2020 2020 2020 5573 6520              Use 
+0000ad10: 6b65 7973 2061 7320 652e 672e 2027 3c69  keys as e.g. '<i
+0000ad20: 7465 6d3e 3a3c 6b65 793e 3a2e 2e2e 272e  tem>:<key>:...'.
+0000ad30: 2043 616e 2062 6520 7573 6564 2066 6f72   Can be used for
+0000ad40: 2068 6561 6465 7220 6669 656c 6473 2061   header fields a
+0000ad50: 7320 7765 6c6c 2061 7320 6974 656d 2066  s well as item f
+0000ad60: 6965 6c64 732e 0a20 2020 2020 2020 2020  ields..         
+0000ad70: 2020 2049 7465 6d20 696e 6465 7820 6361     Item index ca
+0000ad80: 6e20 6265 206c 6567 6c65 6374 6564 2c20  n be leglected, 
+0000ad90: 696e 2063 6173 6520 6f66 2076 6964 656f  in case of video
+0000ada0: 2061 2064 6963 7420 7b3c 696d 6167 652d   a dict {<image-
+0000adb0: 6461 7461 7469 6d65 3e3a 3c76 616c 7565  datatime>:<value
+0000adc0: 3e2c 2e2e 2e7d 2069 7320 7265 7475 726e  >,...} is return
+0000add0: 6564 2e0a 2020 2020 2020 2020 2020 2020  ed..            
+0000ade0: 5261 6973 6573 2049 6664 6f45 7863 6570  Raises IfdoExcep
+0000adf0: 7469 6f6e 2069 6620 6974 656d 2064 6f65  tion if item doe
+0000ae00: 7320 6e6f 7420 6578 6973 742e 2022 2222  s not exist. """
+0000ae10: 0a20 2020 2020 2020 206b 6579 7320 3d20  .        keys = 
+0000ae20: 6b65 7973 2e73 706c 6974 2827 3a27 290a  keys.split(':').
+0000ae30: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0000ae40: 656c 662e 5f5f 6765 7446 6965 6c64 5661  elf.__getFieldVa
+0000ae50: 6c75 6528 7365 6c66 2e69 6664 6f5f 746d  lue(self.ifdo_tm
+0000ae60: 702c 6b65 7973 290a 2020 2020 0a0a 2020  p,keys).    ..  
+0000ae70: 2020 6465 6620 6669 6e64 546d 7046 6965    def findTmpFie
+0000ae80: 6c64 3228 7365 6c66 2c6b 6579 7329 3a0a  ld2(self,keys):.
+0000ae90: 2020 2020 2020 2020 2222 2220 5361 6d65          """ Same
+0000aea0: 2061 7320 6669 6e64 546d 7046 6965 6c64   as findTmpField
+0000aeb0: 2069 6e73 7465 6164 206f 6620 7261 6973   instead of rais
+0000aec0: 696e 6720 6578 6365 7074 696f 6e20 6974  ing exception it
+0000aed0: 2072 6574 7572 6e20 656d 7074 7920 7374   return empty st
+0000aee0: 7269 6e67 2e20 2222 220a 2020 2020 2020  ring. """.      
+0000aef0: 2020 6b65 7973 203d 206b 6579 732e 7370    keys = keys.sp
+0000af00: 6c69 7428 273a 2729 0a20 2020 2020 2020  lit(':').       
+0000af10: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+0000af20: 2020 7265 7420 3d20 7365 6c66 2e5f 5f67    ret = self.__g
+0000af30: 6574 4669 656c 6456 616c 7565 2873 656c  etFieldValue(sel
+0000af40: 662e 6966 646f 5f74 6d70 2c6b 6579 7329  f.ifdo_tmp,keys)
+0000af50: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+0000af60: 6d69 7174 632e 4966 646f 4578 6365 7074  miqtc.IfdoExcept
+0000af70: 696f 6e3a 0a20 2020 2020 2020 2020 2020  ion:.           
+0000af80: 2072 6574 203d 2022 220a 2020 2020 2020   ret = "".      
+0000af90: 2020 7265 7475 726e 2072 6574 0a0a 0a20    return ret... 
+0000afa0: 2020 2064 6566 2073 6574 6946 444f 4865     def setiFDOHe
+0000afb0: 6164 6572 4669 656c 6473 2873 656c 662c  aderFields(self,
+0000afc0: 2068 6561 6465 723a 2064 6963 7429 3a0a   header: dict):.
+0000afd0: 2020 2020 2020 2020 2222 2220 436c 6561          """ Clea
+0000afe0: 7273 2063 7572 7265 6e74 2068 6561 6465  rs current heade
+0000aff0: 7220 6669 656c 6473 2075 6e64 2073 6574  r fields und set
+0000b000: 7320 7072 6f76 6964 6564 2066 6965 6c64  s provided field
+0000b010: 2076 616c 7565 732e 2046 6f72 2075 7064   values. For upd
+0000b020: 6174 696e 6720 6578 6973 7469 6e67 206f  ating existing o
+0000b030: 6e65 7320 7573 6520 7570 6461 7465 5f69  nes use update_i
+0000b040: 6664 6f5f 6865 6164 6572 5f66 6965 6c64  fdo_header_field
+0000b050: 7328 2920 2222 220a 2020 2020 2020 2020  s() """.        
+0000b060: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
+0000b070: 6c66 2e69 6d61 6765 5365 7448 6561 6465  lf.imageSetHeade
+0000b080: 724b 6579 5d20 3d20 7b7d 0a20 2020 2020  rKey] = {}.     
+0000b090: 2020 2069 6620 7365 6c66 2e69 6d61 6765     if self.image
+0000b0a0: 5365 7448 6561 6465 724b 6579 2069 6e20  SetHeaderKey in 
+0000b0b0: 6865 6164 6572 3a0a 2020 2020 2020 2020  header:.        
+0000b0c0: 2020 2020 6865 6164 6572 203d 2068 6561      header = hea
+0000b0d0: 6465 725b 7365 6c66 2e69 6d61 6765 5365  der[self.imageSe
+0000b0e0: 7448 6561 6465 724b 6579 5d0a 2020 2020  tHeaderKey].    
+0000b0f0: 2020 2020 666f 7220 6669 656c 6420 696e      for field in
+0000b100: 2068 6561 6465 723a 0a20 2020 2020 2020   header:.       
+0000b110: 2020 2020 2023 6966 2066 6965 6c64 206e       #if field n
+0000b120: 6f74 2069 6e20 6d69 7174 762e 6966 646f  ot in miqtv.ifdo
+0000b130: 5f68 6561 6465 725f 636f 7265 5f66 6965  _header_core_fie
+0000b140: 6c64 733a 0a20 2020 2020 2020 2020 2020  lds:.           
+0000b150: 2023 2020 2020 7365 6c66 2e70 726f 762e   #    self.prov.
+0000b160: 6c6f 6728 2243 6175 7469 6f6e 2120 556e  log("Caution! Un
+0000b170: 6b6e 6f77 6e20 6865 6164 6572 2066 6965  known header fie
+0000b180: 6c64 205c 2222 202b 2066 6965 6c64 202b  ld \"" + field +
+0000b190: 2022 5c22 2e20 4d61 7962 6520 6120 7479   "\". Maybe a ty
+0000b1a0: 706f 3f20 4f74 6865 7277 6973 6520 6967  po? Otherwise ig
+0000b1b0: 6e6f 7265 206d 652e 2229 0a20 2020 2020  nore me.").     
+0000b1c0: 2020 2020 2020 2073 656c 662e 6966 646f         self.ifdo
+0000b1d0: 5f74 6d70 5b73 656c 662e 696d 6167 6553  _tmp[self.imageS
+0000b1e0: 6574 4865 6164 6572 4b65 795d 5b66 6965  etHeaderKey][fie
+0000b1f0: 6c64 5d20 3d20 6865 6164 6572 5b66 6965  ld] = header[fie
+0000b200: 6c64 5d0a 0a0a 2020 2020 6465 6620 7570  ld]...    def up
+0000b210: 6461 7465 5f69 6664 6f5f 6865 6164 6572  date_ifdo_header
+0000b220: 5f66 6965 6c64 7328 7365 6c66 2c20 6865  _fields(self, he
+0000b230: 6164 6572 3a20 6469 6374 293a 0a20 2020  ader: dict):.   
+0000b240: 2020 2020 2022 2222 2055 7064 6174 6573       """ Updates
+0000b250: 2065 7869 7374 696e 6720 6865 6164 6572   existing header
+0000b260: 2066 6965 6c64 7320 2222 220a 2020 2020   fields """.    
+0000b270: 2020 2020 6966 2073 656c 662e 696d 6167      if self.imag
+0000b280: 6553 6574 4865 6164 6572 4b65 7920 696e  eSetHeaderKey in
+0000b290: 2068 6561 6465 723a 0a20 2020 2020 2020   header:.       
+0000b2a0: 2020 2020 2068 6561 6465 7220 3d20 6865       header = he
+0000b2b0: 6164 6572 5b73 656c 662e 696d 6167 6553  ader[self.imageS
+0000b2c0: 6574 4865 6164 6572 4b65 795d 0a20 2020  etHeaderKey].   
+0000b2d0: 2020 2020 206c 6f67 203d 206d 6971 7463       log = miqtc
+0000b2e0: 2e72 6563 7572 7369 7665 6c79 5570 6461  .recursivelyUpda
+0000b2f0: 7465 4469 6374 7328 7365 6c66 2e69 6664  teDicts(self.ifd
+0000b300: 6f5f 746d 705b 7365 6c66 2e69 6d61 6765  o_tmp[self.image
+0000b310: 5365 7448 6561 6465 724b 6579 5d2c 2068  SetHeaderKey], h
+0000b320: 6561 6465 7229 0a20 2020 2020 2020 2073  eader).        s
+0000b330: 656c 662e 7072 6f76 2e6c 6f67 286c 6f67  elf.prov.log(log
+0000b340: 2c64 6f6e 7453 686f 773d 5472 7565 290a  ,dontShow=True).
+0000b350: 0a20 2020 2064 6566 2075 7064 6174 6569  .    def updatei
+0000b360: 4644 4f48 6561 6465 7246 6965 6c64 7328  FDOHeaderFields(
+0000b370: 7365 6c66 2c20 6865 6164 6572 3a20 6469  self, header: di
+0000b380: 6374 293a 0a20 2020 2020 2020 2022 2222  ct):.        """
+0000b390: 2044 6570 7265 6361 7465 6420 2d20 7573   Deprecated - us
+0000b3a0: 6520 7570 6461 7465 5f69 6664 6f5f 6865  e update_ifdo_he
+0000b3b0: 6164 6572 5f66 6965 6c64 7320 2222 220a  ader_fields """.
+0000b3c0: 2020 2020 2020 2020 7365 6c66 2e75 7064          self.upd
+0000b3d0: 6174 655f 6966 646f 5f68 6561 6465 725f  ate_ifdo_header_
+0000b3e0: 6669 656c 6473 2868 6561 6465 7229 0a0a  fields(header)..
+0000b3f0: 0a20 2020 2064 6566 205f 7472 795f 7570  .    def _try_up
+0000b400: 6772 6164 655f 746f 5f69 6664 6f5f 7665  grade_to_ifdo_ve
+0000b410: 7273 696f 6e5f 3278 2873 656c 6629 3a0a  rsion_2x(self):.
+0000b420: 2020 2020 2020 2020 2222 2220 5472 7920          """ Try 
+0000b430: 746f 2063 6f6e 7665 7274 2066 6965 6c64  to convert field
+0000b440: 7320 6672 6f6d 2069 4644 4f20 7665 7273  s from iFDO vers
+0000b450: 696f 6e20 3c20 322e 302e 3020 746f 2032  ion < 2.0.0 to 2
+0000b460: 2e78 2022 2222 0a20 2020 2020 2020 2072  .x """.        r
+0000b470: 6561 645f 7665 7273 696f 6e5f 7374 7220  ead_version_str 
+0000b480: 3d20 2276 312e 302e 3022 2023 2064 6964  = "v1.0.0" # did
+0000b490: 206e 6f74 2068 6176 6520 7468 6520 2769   not have the 'i
+0000b4a0: 6d61 6765 2d73 6574 2d69 6664 6f2d 7665  mage-set-ifdo-ve
+0000b4b0: 7273 696f 6e27 2066 6965 6c64 2079 6574  rsion' field yet
+0000b4c0: 0a20 2020 2020 2020 2074 7279 3a20 0a20  .        try: . 
+0000b4d0: 2020 2020 2020 2020 2020 2072 6561 645f             read_
+0000b4e0: 7665 7273 696f 6e5f 7374 7220 3d20 7365  version_str = se
+0000b4f0: 6c66 2e66 696e 6454 6d70 4669 656c 6428  lf.findTmpField(
+0000b500: 2769 6d61 6765 2d73 6574 2d69 6664 6f2d  'image-set-ifdo-
+0000b510: 7665 7273 696f 6e27 290a 2020 2020 2020  version').      
+0000b520: 2020 6578 6365 7074 206d 6971 7463 2e49    except miqtc.I
+0000b530: 6664 6f45 7863 6570 7469 6f6e 3a0a 2020  fdoException:.  
+0000b540: 2020 2020 2020 2020 2020 7061 7373 0a20            pass. 
+0000b550: 2020 2020 2020 2072 6561 645f 7665 7273         read_vers
+0000b560: 696f 6e20 3d20 5665 7273 696f 6e28 7265  ion = Version(re
+0000b570: 6164 5f76 6572 7369 6f6e 5f73 7472 290a  ad_version_str).
+0000b580: 0a20 2020 2020 2020 2069 6620 7265 6164  .        if read
+0000b590: 5f76 6572 7369 6f6e 203c 2056 6572 7369  _version < Versi
+0000b5a0: 6f6e 2822 322e 302e 3022 293a 0a20 2020  on("2.0.0"):.   
+0000b5b0: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+0000b5c0: 2020 2020 2020 2320 6e65 7720 5552 4920        # new URI 
+0000b5d0: 6f62 6a65 6374 2066 6965 6c64 730a 2020  object fields.  
+0000b5e0: 2020 2020 2020 2020 2020 6e65 775f 7572            new_ur
+0000b5f0: 695f 6669 656c 6473 203d 205b 2769 6d61  i_fields = ['ima
+0000b600: 6765 2d73 656e 736f 7227 2c27 696d 6167  ge-sensor','imag
+0000b610: 652d 6576 656e 7427 2c27 696d 6167 652d  e-event','image-
+0000b620: 7072 6f6a 6563 7427 2c27 696d 6167 652d  project','image-
+0000b630: 636f 6e74 6578 7427 2c27 696d 6167 652d  context','image-
+0000b640: 6c69 6365 6e73 6527 2c27 696d 6167 652d  license','image-
+0000b650: 706c 6174 666f 726d 275d 0a20 2020 2020  platform'].     
+0000b660: 2020 2020 2020 2066 6f72 2075 7269 5f66         for uri_f
+0000b670: 6965 6c64 2069 6e20 6e65 775f 7572 695f  ield in new_uri_
+0000b680: 6669 656c 6473 3a0a 2020 2020 2020 2020  fields:.        
+0000b690: 2020 2020 2020 2020 6f6c 645f 7374 725f          old_str_
+0000b6a0: 7661 6c20 3d20 7365 6c66 2e66 696e 6454  val = self.findT
+0000b6b0: 6d70 4669 656c 6432 2875 7269 5f66 6965  mpField2(uri_fie
+0000b6c0: 6c64 290a 2020 2020 2020 2020 2020 2020  ld).            
+0000b6d0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+0000b6e0: 6528 6f6c 645f 7374 725f 7661 6c2c 7374  e(old_str_val,st
+0000b6f0: 7229 2061 6e64 206f 6c64 5f73 7472 5f76  r) and old_str_v
+0000b700: 616c 2021 3d20 2222 3a20 2020 2020 2020  al != "":       
+0000b710: 2020 2020 2020 2020 2020 2020 200a 2020               .  
+0000b720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b730: 2020 6e65 775f 6f62 6a5f 7661 6c20 3d20    new_obj_val = 
+0000b740: 7b27 6e61 6d65 273a 206f 6c64 5f73 7472  {'name': old_str
+0000b750: 5f76 616c 7d0a 2020 2020 2020 2020 2020  _val}.          
+0000b760: 2020 2020 2020 2020 2020 6973 5f75 7269            is_uri
+0000b770: 2c20 6d73 6720 3d20 6d69 7174 742e 7661  , msg = miqtt.va
+0000b780: 6c69 6461 7465 5f61 6761 696e 7374 5f73  lidate_against_s
+0000b790: 6368 656d 6128 6f6c 645f 7374 725f 7661  chema(old_str_va
+0000b7a0: 6c2c 7b22 7479 7065 223a 2022 7374 7269  l,{"type": "stri
+0000b7b0: 6e67 222c 2266 6f72 6d61 7422 3a20 2275  ng","format": "u
+0000b7c0: 7269 227d 290a 2020 2020 2020 2020 2020  ri"}).          
+0000b7d0: 2020 2020 2020 2020 2020 6966 2069 735f            if is_
+0000b7e0: 7572 693a 0a20 2020 2020 2020 2020 2020  uri:.           
+0000b7f0: 2020 2020 2020 2020 2020 2020 206e 6577               new
+0000b800: 5f6f 626a 5f76 616c 5b27 7572 6927 5d20  _obj_val['uri'] 
+0000b810: 3d20 6f6c 645f 7374 725f 7661 6c0a 2020  = old_str_val.  
+0000b820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b830: 2020 7365 6c66 2e69 6664 6f5f 746d 705b    self.ifdo_tmp[
+0000b840: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
+0000b850: 6465 724b 6579 5d5b 7572 695f 6669 656c  derKey][uri_fiel
+0000b860: 645d 203d 206e 6577 5f6f 626a 5f76 616c  d] = new_obj_val
+0000b870: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b880: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
+0000b890: 6f67 2822 4175 746f 2d75 7067 7261 6465  og("Auto-upgrade
+0000b8a0: 6420 2220 2b20 7572 695f 6669 656c 6420  d " + uri_field 
+0000b8b0: 2b20 2220 6672 6f6d 2022 202b 206f 6c64  + " from " + old
+0000b8c0: 5f73 7472 5f76 616c 202b 2022 2074 6f20  _str_val + " to 
+0000b8d0: 2220 2b20 7374 7228 6e65 775f 6f62 6a5f  " + str(new_obj_
+0000b8e0: 7661 6c29 290a 0a0a 0a20 2020 2064 6566  val))....    def
+0000b8f0: 2074 7279 4175 746f 5365 7448 6561 6465   tryAutoSetHeade
+0000b900: 7246 6965 6c64 7328 7365 6c66 293a 0a20  rFields(self):. 
+0000b910: 2020 2020 2020 2022 2222 2053 6574 7320         """ Sets 
+0000b920: 6365 7274 6169 6e20 6865 6164 6572 2066  certain header f
+0000b930: 6965 6c64 7320 652e 672e 2066 726f 6d20  ields e.g. from 
+0000b940: 6469 7265 6374 6f72 7920 6966 2074 6865  directory if the
+0000b950: 7920 6172 6520 6e6f 7420 7365 7420 7965  y are not set ye
+0000b960: 7420 2222 220a 0a20 2020 2020 2020 2069  t """..        i
+0000b970: 6620 7365 6c66 2e66 696e 6454 6d70 4669  f self.findTmpFi
+0000b980: 656c 6432 2827 696d 6167 652d 7365 6e73  eld2('image-sens
+0000b990: 6f72 2729 203d 3d20 2222 3a0a 2020 2020  or') == "":.    
+0000b9a0: 2020 2020 2020 2020 7365 6c66 2e69 6664          self.ifd
+0000b9b0: 6f5f 746d 705b 7365 6c66 2e69 6d61 6765  o_tmp[self.image
+0000b9c0: 5365 7448 6561 6465 724b 6579 5d5b 2769  SetHeaderKey]['i
+0000b9d0: 6d61 6765 2d73 656e 736f 7227 5d20 3d20  mage-sensor'] = 
+0000b9e0: 7b27 6e61 6d65 273a 2073 656c 662e 6469  {'name': self.di
+0000b9f0: 722e 7365 6e73 6f72 2829 7d0a 2020 2020  r.sensor()}.    
+0000ba00: 2020 2020 656c 6966 2073 656c 662e 6669      elif self.fi
+0000ba10: 6e64 546d 7046 6965 6c64 2827 696d 6167  ndTmpField('imag
+0000ba20: 652d 7365 6e73 6f72 2729 5b27 6e61 6d65  e-sensor')['name
+0000ba30: 275d 2021 3d20 7365 6c66 2e64 6972 2e73  '] != self.dir.s
+0000ba40: 656e 736f 7228 293a 0a20 2020 2020 2020  ensor():.       
+0000ba50: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
+0000ba60: 6f67 2822 4361 7574 696f 6e21 2027 696d  og("Caution! 'im
+0000ba70: 6167 652d 7365 6e73 6f72 2720 222b 2073  age-sensor' "+ s
+0000ba80: 7472 2873 656c 662e 6669 6e64 546d 7046  tr(self.findTmpF
+0000ba90: 6965 6c64 2827 696d 6167 652d 7365 6e73  ield('image-sens
+0000baa0: 6f72 2729 2920 2b20 2220 6469 6666 6572  or')) + " differ
+0000bab0: 7320 6672 6f6d 2073 656e 736f 7220 7061  s from sensor pa
+0000bac0: 7273 6564 2066 726f 6d20 6469 7265 6374  rsed from direct
+0000bad0: 6f72 793a 2022 202b 2073 656c 662e 6469  ory: " + self.di
+0000bae0: 722e 7365 6e73 6f72 2829 290a 0a20 2020  r.sensor())..   
+0000baf0: 2020 2020 2069 6620 7365 6c66 2e66 696e       if self.fin
+0000bb00: 6454 6d70 4669 656c 6432 2827 696d 6167  dTmpField2('imag
+0000bb10: 652d 6576 656e 7427 2920 3d3d 2022 223a  e-event') == "":
+0000bb20: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000bb30: 662e 6966 646f 5f74 6d70 5b73 656c 662e  f.ifdo_tmp[self.
+0000bb40: 696d 6167 6553 6574 4865 6164 6572 4b65  imageSetHeaderKe
+0000bb50: 795d 5b27 696d 6167 652d 6576 656e 7427  y]['image-event'
+0000bb60: 5d20 3d20 7b27 6e61 6d65 273a 2073 656c  ] = {'name': sel
+0000bb70: 662e 6469 722e 6576 656e 7428 297d 0a20  f.dir.event()}. 
+0000bb80: 2020 2020 2020 2065 6c69 6620 7365 6c66         elif self
+0000bb90: 2e66 696e 6454 6d70 4669 656c 6428 2769  .findTmpField('i
+0000bba0: 6d61 6765 2d65 7665 6e74 2729 5b27 6e61  mage-event')['na
+0000bbb0: 6d65 275d 2021 3d20 7365 6c66 2e64 6972  me'] != self.dir
+0000bbc0: 2e65 7665 6e74 2829 3a0a 2020 2020 2020  .event():.      
+0000bbd0: 2020 2020 2020 7365 6c66 2e70 726f 762e        self.prov.
+0000bbe0: 6c6f 6728 2243 6175 7469 6f6e 2120 2769  log("Caution! 'i
+0000bbf0: 6d61 6765 2d65 7665 6e74 2720 2220 2b20  mage-event' " + 
+0000bc00: 7374 7228 7365 6c66 2e66 696e 6454 6d70  str(self.findTmp
+0000bc10: 4669 656c 6428 2769 6d61 6765 2d65 7665  Field('image-eve
+0000bc20: 6e74 2729 2920 2b20 2220 6469 6666 6572  nt')) + " differ
+0000bc30: 7320 6672 6f6d 2065 7665 6e74 2070 6172  s from event par
+0000bc40: 7365 6420 6672 6f6d 2064 6972 6563 746f  sed from directo
+0000bc50: 7279 3a20 2220 2b20 7365 6c66 2e64 6972  ry: " + self.dir
+0000bc60: 2e65 7665 6e74 2829 290a 0a20 2020 2020  .event())..     
+0000bc70: 2020 2069 6620 7365 6c66 2e66 696e 6454     if self.findT
+0000bc80: 6d70 4669 656c 6432 2827 696d 6167 652d  mpField2('image-
+0000bc90: 7072 6f6a 6563 7427 2920 3d3d 2022 223a  project') == "":
+0000bca0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000bcb0: 662e 6966 646f 5f74 6d70 5b73 656c 662e  f.ifdo_tmp[self.
+0000bcc0: 696d 6167 6553 6574 4865 6164 6572 4b65  imageSetHeaderKe
+0000bcd0: 795d 5b27 696d 6167 652d 7072 6f6a 6563  y]['image-projec
+0000bce0: 7427 5d20 3d20 207b 276e 616d 6527 3a20  t'] =  {'name': 
+0000bcf0: 7365 6c66 2e64 6972 2e70 726f 6a65 6374  self.dir.project
+0000bd00: 2829 7d0a 2020 2020 2020 2020 656c 6966  ()}.        elif
+0000bd10: 2073 656c 662e 6669 6e64 546d 7046 6965   self.findTmpFie
+0000bd20: 6c64 2827 696d 6167 652d 7072 6f6a 6563  ld('image-projec
+0000bd30: 7427 295b 276e 616d 6527 5d20 213d 2073  t')['name'] != s
+0000bd40: 656c 662e 6469 722e 7072 6f6a 6563 7428  elf.dir.project(
+0000bd50: 293a 0a20 2020 2020 2020 2020 2020 2073  ):.            s
+0000bd60: 656c 662e 7072 6f76 2e6c 6f67 2822 4361  elf.prov.log("Ca
+0000bd70: 7574 696f 6e21 2027 696d 6167 652d 7072  ution! 'image-pr
+0000bd80: 6f6a 6563 7427 2022 202b 2073 7472 2873  oject' " + str(s
+0000bd90: 656c 662e 6669 6e64 546d 7046 6965 6c64  elf.findTmpField
+0000bda0: 2827 696d 6167 652d 7072 6f6a 6563 7427  ('image-project'
+0000bdb0: 2929 202b 2022 2064 6966 6665 7273 2066  )) + " differs f
+0000bdc0: 726f 6d20 7072 6f6a 6563 7420 7061 7273  rom project pars
+0000bdd0: 6564 2066 726f 6d20 6469 7265 6374 6f72  ed from director
+0000bde0: 793a 2022 202b 2073 656c 662e 6469 722e  y: " + self.dir.
+0000bdf0: 7072 6f6a 6563 7428 2929 0a0a 2020 2020  project())..    
+0000be00: 2020 2020 6966 2073 656c 662e 6669 6e64      if self.find
+0000be10: 546d 7046 6965 6c64 3228 2769 6d61 6765  TmpField2('image
+0000be20: 2d70 6c61 7466 6f72 6d27 2920 3d3d 2022  -platform') == "
+0000be30: 2220 616e 6420 7365 6c66 2e64 6972 2e67  " and self.dir.g
+0000be40: 6561 7228 2920 213d 2022 223a 0a20 2020  ear() != "":.   
+0000be50: 2020 2020 2020 2020 2073 656c 662e 6966           self.if
+0000be60: 646f 5f74 6d70 5b73 656c 662e 696d 6167  do_tmp[self.imag
+0000be70: 6553 6574 4865 6164 6572 4b65 795d 5b27  eSetHeaderKey]['
+0000be80: 696d 6167 652d 706c 6174 666f 726d 275d  image-platform']
+0000be90: 203d 207b 276e 616d 6527 3a20 7365 6c66   = {'name': self
+0000bea0: 2e64 6972 2e67 6561 7228 297d 0a0a 2020  .dir.gear()}..  
+0000beb0: 2020 2020 2020 6966 206e 6f74 2027 696d        if not 'im
+0000bec0: 6167 652d 7365 742d 7575 6964 2720 696e  age-set-uuid' in
+0000bed0: 2073 656c 662e 6966 646f 5f74 6d70 5b73   self.ifdo_tmp[s
+0000bee0: 656c 662e 696d 6167 6553 6574 4865 6164  elf.imageSetHead
+0000bef0: 6572 4b65 795d 3a0a 2020 2020 2020 2020  erKey]:.        
+0000bf00: 2020 2020 7365 6c66 2e69 6664 6f5f 746d      self.ifdo_tm
+0000bf10: 705b 7365 6c66 2e69 6d61 6765 5365 7448  p[self.imageSetH
+0000bf20: 6561 6465 724b 6579 5d5b 2769 6d61 6765  eaderKey]['image
+0000bf30: 2d73 6574 2d75 7569 6427 5d20 3d20 7374  -set-uuid'] = st
+0000bf40: 7228 6d69 7174 632e 7575 6964 3428 2929  r(miqtc.uuid4())
+0000bf50: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+0000bf60: 2769 6d61 6765 2d73 6574 2d68 616e 646c  'image-set-handl
+0000bf70: 6527 2069 6e20 7365 6c66 2e69 6664 6f5f  e' in self.ifdo_
+0000bf80: 746d 705b 7365 6c66 2e69 6d61 6765 5365  tmp[self.imageSe
+0000bf90: 7448 6561 6465 724b 6579 5d3a 0a20 2020  tHeaderKey]:.   
+0000bfa0: 2020 2020 2020 2020 2073 656c 662e 6966           self.if
+0000bfb0: 646f 5f74 6d70 5b73 656c 662e 696d 6167  do_tmp[self.imag
+0000bfc0: 6553 6574 4865 6164 6572 4b65 795d 5b27  eSetHeaderKey]['
+0000bfd0: 696d 6167 652d 7365 742d 6861 6e64 6c65  image-set-handle
+0000bfe0: 275d 203d 2073 656c 662e 6861 6e64 6c65  '] = self.handle
+0000bff0: 5f70 7265 6669 7820 2b20 222f 2220 2b20  _prefix + "/" + 
+0000c000: 7365 6c66 2e66 696e 6454 6d70 4669 656c  self.findTmpFiel
+0000c010: 6428 2769 6d61 6765 2d73 6574 2d75 7569  d('image-set-uui
+0000c020: 6427 290a 2020 2020 2020 2020 6966 206e  d').        if n
+0000c030: 6f74 2027 696d 6167 652d 7365 742d 6e61  ot 'image-set-na
+0000c040: 6d65 2720 696e 2073 656c 662e 6966 646f  me' in self.ifdo
+0000c050: 5f74 6d70 5b73 656c 662e 696d 6167 6553  _tmp[self.imageS
+0000c060: 6574 4865 6164 6572 4b65 795d 206f 7220  etHeaderKey] or 
+0000c070: 7365 6c66 2e66 696e 6454 6d70 4669 656c  self.findTmpFiel
+0000c080: 6432 2827 696d 6167 652d 7365 742d 6e61  d2('image-set-na
+0000c090: 6d65 2729 203d 3d20 2222 3a0a 2020 2020  me') == "":.    
+0000c0a0: 2020 2020 2020 2020 2320 636f 6e73 7472          # constr
+0000c0b0: 7563 7420 6173 203c 7072 6f6a 6563 743e  uct as <project>
+0000c0c0: 5f3c 6576 656e 743e 5f3c 7365 6e73 6f72  _<event>_<sensor
+0000c0d0: 3e0a 2020 2020 2020 2020 2020 2020 7072  >.            pr
+0000c0e0: 6f6a 6563 745f 203d 2073 656c 662e 6669  oject_ = self.fi
+0000c0f0: 6e64 546d 7046 6965 6c64 3228 2269 6d61  ndTmpField2("ima
+0000c100: 6765 2d70 726f 6a65 6374 2229 5b27 6e61  ge-project")['na
+0000c110: 6d65 275d 0a20 2020 2020 2020 2020 2020  me'].           
+0000c120: 2065 7665 6e74 5f20 3d20 7365 6c66 2e66   event_ = self.f
+0000c130: 696e 6454 6d70 4669 656c 6432 2822 696d  indTmpField2("im
+0000c140: 6167 652d 6576 656e 7422 295b 276e 616d  age-event")['nam
+0000c150: 6527 5d0a 2020 2020 2020 2020 2020 2020  e'].            
+0000c160: 6966 2065 7665 6e74 5f20 3d3d 2022 223a  if event_ == "":
+0000c170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c180: 2065 7665 6e74 5f20 3d20 7365 6c66 2e64   event_ = self.d
+0000c190: 6972 2e65 7665 6e74 2829 0a20 2020 2020  ir.event().     
+0000c1a0: 2020 2020 2020 2073 656e 736f 725f 203d         sensor_ =
+0000c1b0: 2073 656c 662e 6669 6e64 546d 7046 6965   self.findTmpFie
+0000c1c0: 6c64 3228 2269 6d61 6765 2d73 656e 736f  ld2("image-senso
+0000c1d0: 7222 295b 276e 616d 6527 5d0a 2020 2020  r")['name'].    
+0000c1e0: 2020 2020 2020 2020 6966 2073 656e 736f          if senso
+0000c1f0: 725f 203d 3d20 2222 3a0a 2020 2020 2020  r_ == "":.      
+0000c200: 2020 2020 2020 2020 2020 7365 6e73 6f72            sensor
+0000c210: 5f20 3d20 7365 6c66 2e64 6972 2e73 656e  _ = self.dir.sen
+0000c220: 736f 7228 290a 2020 2020 2020 2020 2020  sor().          
+0000c230: 2020 7365 6c66 2e69 6664 6f5f 746d 705b    self.ifdo_tmp[
+0000c240: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
+0000c250: 6465 724b 6579 5d5b 2769 6d61 6765 2d73  derKey]['image-s
+0000c260: 6574 2d6e 616d 6527 5d20 3d20 6946 444f  et-name'] = iFDO
+0000c270: 2e63 6f6e 7374 7275 6374 496d 6167 6553  .constructImageS
+0000c280: 6574 4e61 6d65 2870 726f 6a65 6374 5f2c  etName(project_,
+0000c290: 6576 656e 745f 2c73 656e 736f 725f 290a  event_,sensor_).
+0000c2a0: 0a20 2020 2020 2020 2023 2073 6574 2076  .        # set v
+0000c2b0: 6572 7369 6f6e 0a20 2020 2020 2020 2073  ersion.        s
+0000c2c0: 656c 662e 6966 646f 5f74 6d70 5b73 656c  elf.ifdo_tmp[sel
+0000c2d0: 662e 696d 6167 6553 6574 4865 6164 6572  f.imageSetHeader
+0000c2e0: 4b65 795d 5b27 696d 6167 652d 7365 742d  Key]['image-set-
+0000c2f0: 6966 646f 2d76 6572 7369 6f6e 275d 203d  ifdo-version'] =
+0000c300: 206d 6971 7476 2e69 4644 4f5f 7665 7273   miqtv.iFDO_vers
+0000c310: 696f 6e0a 0a0a 2020 2020 6465 6620 7365  ion...    def se
+0000c320: 7448 6561 6465 7249 6d61 6765 4c6f 6361  tHeaderImageLoca
+0000c330: 6c50 6174 6846 6965 6c64 2873 656c 6629  lPathField(self)
+0000c340: 3a0a 2020 2020 2020 2020 2222 2220 5365  :.        """ Se
+0000c350: 7473 2068 6561 6465 7220 6669 656c 6420  ts header field 
+0000c360: 2769 6d61 6765 2d6c 6f63 616c 2d70 6174  'image-local-pat
+0000c370: 6827 2066 726f 6d20 696d 6167 6520 6469  h' from image di
+0000c380: 7220 2222 220a 2020 2020 2020 2020 7365  r """.        se
+0000c390: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
+0000c3a0: 2e69 6d61 6765 5365 7448 6561 6465 724b  .imageSetHeaderK
+0000c3b0: 6579 5d5b 2769 6d61 6765 2d6c 6f63 616c  ey]['image-local
+0000c3c0: 2d70 6174 6827 5d20 3d20 6f73 2e70 6174  -path'] = os.pat
+0000c3d0: 682e 7265 6c70 6174 6828 7365 6c66 2e69  h.relpath(self.i
+0000c3e0: 6d61 6765 7344 6972 2c20 6f73 2e70 6174  magesDir, os.pat
+0000c3f0: 682e 6469 726e 616d 6528 7365 6c66 2e67  h.dirname(self.g
+0000c400: 6574 6946 444f 4669 6c65 4e61 6d65 2829  etiFDOFileName()
+0000c410: 2929 0a0a 0a20 2020 2064 6566 2063 7265  ))...    def cre
+0000c420: 6174 655f 6669 656c 6473 2873 656c 662c  ate_fields(self,
+0000c430: 2061 6c6c 6f77 5f6d 6973 7369 6e67 5f72   allow_missing_r
+0000c440: 6571 7569 7265 643d 4661 6c73 6529 3a0a  equired=False):.
+0000c450: 2020 2020 2020 2020 2222 2220 4372 6561          """ Crea
+0000c460: 7465 2061 6e64 2076 616c 6964 6174 6520  te and validate 
+0000c470: 6375 7272 656e 7420 6865 6164 6572 2066  current header f
+0000c480: 6965 6c64 7320 616e 6420 6974 656d 2066  ields and item f
+0000c490: 6965 6c64 7320 6672 6f6d 2069 6e74 6572  ields from inter
+0000c4a0: 6d65 6469 6174 6520 6669 6c65 732e 204f  mediate files. O
+0000c4b0: 7665 7277 7269 7465 7320 6578 6973 7469  verwrites existi
+0000c4c0: 6e67 2066 6965 6c64 732e 2022 2222 0a20  ng fields. """. 
+0000c4d0: 2020 2020 2020 2069 7465 6d5f 6461 7461         item_data
+0000c4e0: 203d 2073 656c 662e 5f67 6574 5f69 7465   = self._get_ite
+0000c4f0: 6d5f 6461 7461 5f66 726f 6d5f 696e 7465  m_data_from_inte
+0000c500: 726d 6564 6961 7465 5f66 696c 6573 2829  rmediate_files()
+0000c510: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000c520: 7365 6c66 2e63 7265 6174 6569 4644 4f28  self.createiFDO(
+0000c530: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
+0000c540: 6c66 2e69 6d61 6765 5365 7448 6561 6465  lf.imageSetHeade
+0000c550: 724b 6579 5d2c 2069 7465 6d5f 6461 7461  rKey], item_data
+0000c560: 2e76 616c 7565 7328 292c 2061 6c6c 6f77  .values(), allow
+0000c570: 5f6d 6973 7369 6e67 5f72 6571 7569 7265  _missing_require
+0000c580: 643d 616c 6c6f 775f 6d69 7373 696e 675f  d=allow_missing_
+0000c590: 7265 7175 6972 6564 290a 0a0a 2020 2020  required)...    
+0000c5a0: 6465 6620 7570 6461 7465 5f66 6965 6c64  def update_field
+0000c5b0: 7328 7365 6c66 2c20 6865 6164 6572 5f6f  s(self, header_o
+0000c5c0: 6e6c 793a 626f 6f6c 3d4e 6f6e 6529 3a0a  nly:bool=None):.
+0000c5d0: 2020 2020 2020 2020 2222 2220 5570 6461          """ Upda
+0000c5e0: 7465 2061 6e64 2076 616c 6964 6174 6520  te and validate 
+0000c5f0: 6375 7272 656e 7420 6865 6164 6572 2066  current header f
+0000c600: 6965 6c64 7320 616e 6420 6974 656d 2066  ields and item f
+0000c610: 6965 6c64 7320 6672 6f6d 2069 6e74 6572  ields from inter
+0000c620: 6d65 6469 6174 6520 6669 6c65 732e 2022  mediate files. "
+0000c630: 2222 0a20 2020 2020 2020 2069 6620 6865  "".        if he
+0000c640: 6164 6572 5f6f 6e6c 7920 6973 204e 6f6e  ader_only is Non
+0000c650: 653a 0a20 2020 2020 2020 2020 2020 2068  e:.            h
+0000c660: 6561 6465 725f 6f6e 6c79 203d 2073 656c  eader_only = sel
+0000c670: 662e 6967 6e6f 7265 5f69 6d61 6765 5f66  f.ignore_image_f
+0000c680: 696c 6573 0a20 2020 2020 2020 2069 6620  iles.        if 
+0000c690: 6e6f 7420 6865 6164 6572 5f6f 6e6c 793a  not header_only:
+0000c6a0: 0a20 2020 2020 2020 2020 2020 2069 7465  .            ite
+0000c6b0: 6d5f 6461 7461 203d 2073 656c 662e 5f67  m_data = self._g
+0000c6c0: 6574 5f69 7465 6d5f 6461 7461 5f66 726f  et_item_data_fro
+0000c6d0: 6d5f 696e 7465 726d 6564 6961 7465 5f66  m_intermediate_f
+0000c6e0: 696c 6573 2829 0a20 2020 2020 2020 2020  iles().         
+0000c6f0: 2020 2072 6574 7572 6e20 7365 6c66 2e75     return self.u
+0000c700: 7064 6174 6569 4644 4f28 7365 6c66 2e69  pdateiFDO(self.i
+0000c710: 6664 6f5f 746d 705b 7365 6c66 2e69 6d61  fdo_tmp[self.ima
+0000c720: 6765 5365 7448 6561 6465 724b 6579 5d2c  geSetHeaderKey],
+0000c730: 2069 7465 6d5f 6461 7461 2e76 616c 7565   item_data.value
+0000c740: 7328 2929 0a20 2020 2020 2020 2065 6c73  s()).        els
+0000c750: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+0000c760: 6574 7572 6e20 7365 6c66 2e75 7064 6174  eturn self.updat
+0000c770: 6569 4644 4f28 7365 6c66 2e69 6664 6f5f  eiFDO(self.ifdo_
+0000c780: 746d 705b 7365 6c66 2e69 6d61 6765 5365  tmp[self.imageSe
+0000c790: 7448 6561 6465 724b 6579 5d2c 205b 5d2c  tHeaderKey], [],
+0000c7a0: 2068 6561 6465 725f 6f6e 6c79 3d54 7275   header_only=Tru
+0000c7b0: 6529 0a0a 0a20 2020 2064 6566 2063 7265  e)...    def cre
+0000c7c0: 6174 6543 6f72 6546 6965 6c64 7328 7365  ateCoreFields(se
+0000c7d0: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
+0000c7e0: 2044 4550 5245 4341 4445 542c 2075 7365   DEPRECADET, use
+0000c7f0: 2063 7265 6174 655f 6669 656c 6473 2829   create_fields()
+0000c800: 206f 7220 7570 6461 7465 5f66 6965 6c64   or update_field
+0000c810: 7328 2920 696e 7374 6564 2e0a 2020 2020  s() insted..    
+0000c820: 2020 2020 4669 6c6c 7320 7468 6520 6946      Fills the iF
+0000c830: 444f 2063 6f72 6520 6669 656c 6473 2066  DO core fields f
+0000c840: 726f 6d20 696e 7465 726d 6564 6961 7465  rom intermediate
+0000c850: 2066 696c 6573 2e20 5769 7468 6f75 7420   files. Without 
+0000c860: 7468 656d 206e 6f20 7661 6c69 6420 6946  them no valid iF
+0000c870: 444f 2063 616e 2062 6520 6372 6561 7465  DO can be create
+0000c880: 642e 0a20 2020 2020 2020 2022 2222 0a20  d..        """. 
+0000c890: 2020 2020 2020 2069 7465 6d5f 6461 7461         item_data
+0000c8a0: 203d 2073 656c 662e 5f67 6574 5f69 7465   = self._get_ite
+0000c8b0: 6d5f 6461 7461 5f66 726f 6d5f 696e 7465  m_data_from_inte
+0000c8c0: 726d 6564 6961 7465 5f66 696c 6573 5f63  rmediate_files_c
+0000c8d0: 6f72 6528 290a 2020 2020 2020 2020 2320  ore().        # 
+0000c8e0: 6368 6563 6b20 6669 656c 6473 2066 6f72  check fields for
+0000c8f0: 2076 616c 6964 6974 790a 2020 2020 2020   validity.      
+0000c900: 2020 2320 6974 656d 5f64 6174 6120 636f    # item_data co
+0000c910: 6e74 6169 6e73 2066 6965 6c64 2069 6d61  ntains field ima
+0000c920: 6765 2d66 696c 656e 616d 652c 2077 6869  ge-filename, whi
+0000c930: 6368 2077 6869 6368 2077 696c 6c20 6e6f  ch which will no
+0000c940: 7420 6265 2073 746f 7265 6420 6173 2061  t be stored as a
+0000c950: 6e20 6974 656d 2066 6965 6c64 2069 6e20  n item field in 
+0000c960: 6946 4f44 2062 7574 2061 7320 7468 6520  iFOD but as the 
+0000c970: 6974 656d 206e 616d 6520 6974 7365 6c66  item name itself
+0000c980: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000c990: 7365 6c66 2e75 7064 6174 6569 4644 4f28  self.updateiFDO(
+0000c9a0: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
+0000c9b0: 6c66 2e69 6d61 6765 5365 7448 6561 6465  lf.imageSetHeade
+0000c9c0: 724b 6579 5d2c 2069 7465 6d5f 6461 7461  rKey], item_data
+0000c9d0: 2e76 616c 7565 7328 2929 0a0a 0a20 2020  .values())...   
+0000c9e0: 2064 6566 2063 7265 6174 6543 6170 7475   def createCaptu
+0000c9f0: 7265 416e 6443 6f6e 7465 6e74 4669 656c  reAndContentFiel
+0000ca00: 6473 2873 656c 6629 3a0a 2020 2020 2020  ds(self):.      
+0000ca10: 2020 2222 2220 4445 5052 4543 4144 4554    """ DEPRECADET
+0000ca20: 2c20 7573 6520 6372 6561 7465 5f66 6965  , use create_fie
+0000ca30: 6c64 7328 2920 6f72 2075 7064 6174 655f  lds() or update_
+0000ca40: 6669 656c 6473 2829 2069 6e73 7465 642e  fields() insted.
+0000ca50: 0a20 2020 2020 2020 2046 696c 6c73 2074  .        Fills t
+0000ca60: 6865 2069 4644 4f20 6361 7075 7472 6520  he iFDO caputre 
+0000ca70: 616e 6420 636f 6e74 656e 7420 6669 6564  and content fied
+0000ca80: 7320 6672 6f6d 2070 726f 7669 6465 6420  s from provided 
+0000ca90: 6461 7461 2066 6965 6c64 7320 0a20 2020  data fields .   
+0000caa0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0000cab0: 2069 7465 6d5f 6461 7461 203d 2073 656c   item_data = sel
+0000cac0: 662e 5f67 6574 5f69 7465 6d5f 6461 7461  f._get_item_data
+0000cad0: 5f66 726f 6d5f 696e 7465 726d 6564 6961  _from_intermedia
+0000cae0: 7465 5f66 696c 6573 5f6e 6f6e 655f 636f  te_files_none_co
+0000caf0: 7265 2829 0a20 2020 2020 2020 2023 2063  re().        # c
+0000cb00: 6865 636b 2066 6965 6c64 7320 666f 7220  heck fields for 
+0000cb10: 7661 6c69 6469 7479 0a20 2020 2020 2020  validity.       
+0000cb20: 2023 2069 7465 6d5f 6461 7461 2063 6f6e   # item_data con
+0000cb30: 7461 696e 7320 6669 656c 6420 696d 6167  tains field imag
+0000cb40: 652d 6669 6c65 6e61 6d65 2c20 7768 6963  e-filename, whic
+0000cb50: 6820 7768 6963 6820 7769 6c6c 206e 6f74  h which will not
+0000cb60: 2062 6520 7374 6f72 6564 2061 7320 616e   be stored as an
+0000cb70: 2069 7465 6d20 6669 656c 6420 696e 2069   item field in i
+0000cb80: 464f 4420 6275 7420 6173 2074 6865 2069  FOD but as the i
+0000cb90: 7465 6d20 6e61 6d65 2069 7473 656c 660a  tem name itself.
+0000cba0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0000cbb0: 656c 662e 7570 6461 7465 6946 444f 2873  elf.updateiFDO(s
+0000cbc0: 656c 662e 6966 646f 5f74 6d70 5b73 656c  elf.ifdo_tmp[sel
+0000cbd0: 662e 696d 6167 6553 6574 4865 6164 6572  f.imageSetHeader
+0000cbe0: 4b65 795d 2c20 6974 656d 5f64 6174 612e  Key], item_data.
+0000cbf0: 7661 6c75 6573 2829 290a 0a20 2020 200a  values())..    .
+0000cc00: 2020 2020 6465 6620 5f67 6574 5f69 7465      def _get_ite
+0000cc10: 6d5f 6461 7461 5f66 726f 6d5f 696e 7465  m_data_from_inte
+0000cc20: 726d 6564 6961 7465 5f66 696c 6573 2873  rmediate_files(s
+0000cc30: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
+0000cc40: 2220 5265 6164 2064 6174 6120 6672 6f6d  " Read data from
+0000cc50: 2063 6f72 6520 616e 6420 6e6f 6e65 2d63   core and none-c
+0000cc60: 6f72 6520 696e 7465 726d 6465 6174 6520  ore intermdeate 
+0000cc70: 6669 6c65 732c 2063 6865 636b 2066 696c  files, check fil
+0000cc80: 6573 2065 7869 7374 2c20 6164 6420 2769  es exist, add 'i
+0000cc90: 6d61 6765 2d68 616e 646c 6527 2e0a 2020  mage-handle'..  
+0000cca0: 2020 2020 2020 5265 7475 726e 7320 6469        Returns di
+0000ccb0: 6374 206f 6620 666f 726d 207b 696d 6167  ct of form {imag
+0000ccc0: 652d 6669 6c65 2d6e 616d 653a 7b66 6965  e-file-name:{fie
+0000ccd0: 6c64 3a76 616c 7565 7d2c 2e2e 2e7d 200a  ld:value},...} .
+0000cce0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000ccf0: 2020 2020 6974 656d 5f64 6174 615f 636f      item_data_co
+0000cd00: 7265 203d 2073 656c 662e 5f67 6574 5f69  re = self._get_i
+0000cd10: 7465 6d5f 6461 7461 5f66 726f 6d5f 696e  tem_data_from_in
+0000cd20: 7465 726d 6564 6961 7465 5f66 696c 6573  termediate_files
+0000cd30: 5f63 6f72 6528 290a 2020 2020 2020 2020  _core().        
+0000cd40: 6974 656d 5f64 6174 615f 6e6f 6e65 5f63  item_data_none_c
+0000cd50: 6f72 6520 3d20 7365 6c66 2e5f 6765 745f  ore = self._get_
+0000cd60: 6974 656d 5f64 6174 615f 6672 6f6d 5f69  item_data_from_i
+0000cd70: 6e74 6572 6d65 6469 6174 655f 6669 6c65  ntermediate_file
+0000cd80: 735f 6e6f 6e65 5f63 6f72 6528 290a 2020  s_none_core().  
+0000cd90: 2020 2020 2020 2370 7072 696e 7428 6974        #pprint(it
+0000cda0: 656d 5f64 6174 615f 6e6f 6e65 5f63 6f72  em_data_none_cor
+0000cdb0: 6529 0a20 2020 2020 2020 2023 7070 7269  e).        #ppri
+0000cdc0: 6e74 2869 7465 6d5f 6461 7461 5f63 6f72  nt(item_data_cor
+0000cdd0: 6529 0a20 2020 2020 2020 2069 7465 6d5f  e).        item_
+0000cde0: 6461 7461 203d 2069 7465 6d5f 6461 7461  data = item_data
+0000cdf0: 5f63 6f72 650a 2020 2020 2020 2020 6c6f  _core.        lo
+0000ce00: 6720 3d20 6d69 7174 632e 7265 6375 7273  g = miqtc.recurs
+0000ce10: 6976 656c 7955 7064 6174 6544 6963 7473  ivelyUpdateDicts
+0000ce20: 2869 7465 6d5f 6461 7461 2c20 6974 656d  (item_data, item
+0000ce30: 5f64 6174 615f 6e6f 6e65 5f63 6f72 6529  _data_none_core)
+0000ce40: 0a20 2020 2020 2020 2023 7070 7269 6e74  .        #pprint
+0000ce50: 2869 7465 6d5f 6461 7461 290a 2020 2020  (item_data).    
+0000ce60: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
+0000ce70: 6728 6c6f 672c 646f 6e74 5368 6f77 3d54  g(log,dontShow=T
+0000ce80: 7275 6529 0a20 2020 2020 2020 2072 6574  rue).        ret
+0000ce90: 7572 6e20 6974 656d 5f64 6174 610a 0a20  urn item_data.. 
+0000cea0: 2020 2064 6566 205f 6765 745f 6974 656d     def _get_item
+0000ceb0: 5f64 6174 615f 6672 6f6d 5f69 6e74 6572  _data_from_inter
+0000cec0: 6d65 6469 6174 655f 6669 6c65 735f 6e6f  mediate_files_no
+0000ced0: 6e65 5f63 6f72 6528 7365 6c66 293a 0a20  ne_core(self):. 
+0000cee0: 2020 2020 2020 2022 2222 2052 6561 6420         """ Read 
+0000cef0: 6461 7461 2066 726f 6d20 6e6f 6e2d 636f  data from non-co
+0000cf00: 7265 2069 6e74 6572 6d64 6561 7465 2066  re intermdeate f
+0000cf10: 696c 6573 2e0a 2020 2020 2020 2020 5265  iles..        Re
+0000cf20: 7475 726e 7320 6469 6374 206f 6620 666f  turns dict of fo
+0000cf30: 726d 207b 696d 6167 652d 6669 6c65 2d6e  rm {image-file-n
+0000cf40: 616d 653a 7b66 6965 6c64 3a76 616c 7565  ame:{field:value
+0000cf50: 7d2c 2e2e 2e7d 200a 2020 2020 2020 2020  },...} .        
+0000cf60: 2222 220a 2020 2020 2020 2020 7265 7120  """.        req 
+0000cf70: 3d20 7365 6c66 2e6e 6f6e 436f 7265 4669  = self.nonCoreFi
+0000cf80: 656c 6449 6e74 6572 6d65 6469 6174 6549  eldIntermediateI
+0000cf90: 7465 6d49 6e66 6f46 696c 6573 0a0a 2020  temInfoFiles..  
+0000cfa0: 2020 2020 2020 6974 656d 5f64 6174 6120        item_data 
+0000cfb0: 3d20 7b7d 0a20 2020 2020 2020 2066 6f72  = {}.        for
+0000cfc0: 2072 2069 6e20 7265 713a 0a20 2020 2020   r in req:.     
+0000cfd0: 2020 2020 2020 2069 6620 6f73 2e70 6174         if os.pat
+0000cfe0: 682e 6578 6973 7473 2872 2e66 696c 654e  h.exists(r.fileN
+0000cff0: 616d 6529 3a0a 2020 2020 2020 2020 2020  ame):.          
+0000d000: 2020 2020 2020 7365 6c66 2e70 7261 7365        self.prase
+0000d010: 4974 656d 4461 7461 4672 6f6d 4669 6c65  ItemDataFromFile
+0000d020: 2869 7465 6d5f 6461 7461 2c72 2e66 696c  (item_data,r.fil
+0000d030: 654e 616d 652c 722e 7365 7061 7261 746f  eName,r.separato
+0000d040: 722c 722e 6865 6164 6572 2c20 722e 6461  r,r.header, r.da
+0000d050: 7465 7469 6d65 5f66 6f72 6d61 7429 0a20  tetime_format). 
+0000d060: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000d070: 656c 662e 7072 6f76 2e6c 6f67 2822 5061  elf.prov.log("Pa
+0000d080: 7273 6564 2069 7465 6d20 6461 7461 2066  rsed item data f
+0000d090: 726f 6d3a 2022 202b 2072 2e66 696c 654e  rom: " + r.fileN
+0000d0a0: 616d 6529 0a20 2020 2020 2020 2020 2020  ame).           
+0000d0b0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0000d0c0: 2020 2020 2020 2073 656c 662e 7072 6f76         self.prov
+0000d0d0: 2e6c 6f67 2822 4669 6c65 2064 6f65 7320  .log("File does 
+0000d0e0: 6e6f 7420 6578 6973 7473 3a20 2220 2b20  not exists: " + 
+0000d0f0: 722e 6669 6c65 4e61 6d65 290a 0a20 2020  r.fileName)..   
+0000d100: 2020 2020 2023 2063 6865 636b 2066 696c       # check fil
+0000d110: 6573 2065 7869 7374 0a20 2020 2020 2020  es exist.       
+0000d120: 2072 656d 6f76 6520 3d20 5b5d 0a20 2020   remove = [].   
+0000d130: 2020 2020 2066 6f72 2069 6d67 2069 6e20       for img in 
+0000d140: 6974 656d 5f64 6174 613a 0a20 2020 2020  item_data:.     
+0000d150: 2020 2020 2020 2069 6620 6e6f 7420 696d         if not im
+0000d160: 6720 696e 2073 656c 662e 5f69 6d61 6765  g in self._image
+0000d170: 4e61 6d65 7349 6d61 6765 7344 6972 3a0a  NamesImagesDir:.
+0000d180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d190: 7265 6d6f 7665 2e61 7070 656e 6428 696d  remove.append(im
+0000d1a0: 6729 0a20 2020 2020 2020 2066 6f72 2069  g).        for i
+0000d1b0: 6d67 2069 6e20 7265 6d6f 7665 3a0a 2020  mg in remove:.  
+0000d1c0: 2020 2020 2020 2020 2020 6465 6c20 6974            del it
+0000d1d0: 656d 5f64 6174 615b 696d 675d 0a0a 2020  em_data[img]..  
+0000d1e0: 2020 2020 2020 7265 7475 726e 2069 7465        return ite
+0000d1f0: 6d5f 6461 7461 0a0a 0a20 2020 2064 6566  m_data...    def
+0000d200: 205f 6765 745f 6974 656d 5f64 6174 615f   _get_item_data_
+0000d210: 6672 6f6d 5f69 6e74 6572 6d65 6469 6174  from_intermediat
+0000d220: 655f 6669 6c65 735f 636f 7265 2873 656c  e_files_core(sel
+0000d230: 6629 3a0a 2020 2020 2020 2020 2222 2220  f):.        """ 
+0000d240: 5265 6164 2064 6174 6120 6672 6f6d 2063  Read data from c
+0000d250: 6f72 6520 696e 7465 726d 6465 6174 6520  ore intermdeate 
+0000d260: 6669 6c65 732c 2063 6865 636b 2066 696c  files, check fil
+0000d270: 6573 2065 7869 7374 2c20 6164 6420 2769  es exist, add 'i
+0000d280: 6d61 6765 2d68 616e 646c 6527 2e0a 2020  mage-handle'..  
+0000d290: 2020 2020 2020 5265 7475 726e 7320 6469        Returns di
+0000d2a0: 6374 206f 6620 666f 726d 207b 696d 6167  ct of form {imag
+0000d2b0: 652d 6669 6c65 2d6e 616d 653a 7b66 6965  e-file-name:{fie
+0000d2c0: 6c64 3a76 616c 7565 7d2c 2e2e 2e7d 200a  ld:value},...} .
+0000d2d0: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
+0000d2e0: 2020 2020 2023 2057 6869 6368 2066 696c       # Which fil
+0000d2f0: 6573 2063 6f6e 7461 696e 2074 6865 2069  es contain the i
+0000d300: 6e66 6f72 6d61 7469 6f6e 206e 6565 6465  nformation neede
+0000d310: 6420 746f 2063 7265 6174 6520 7468 6520  d to create the 
+0000d320: 6946 444f 2069 7465 6d73 2063 6f72 6520  iFDO items core 
+0000d330: 696e 666f 726d 6174 696f 6e20 616e 6420  information and 
+0000d340: 7768 6963 6820 636f 6c75 6d6e 7320 7368  which columns sh
+0000d350: 616c 6c20 6265 2075 7365 640a 2020 2020  all be used.    
+0000d360: 2020 2020 7265 7120 3d20 7365 6c66 2e69      req = self.i
+0000d370: 6e74 6572 6d65 6469 6174 6546 696c 6573  ntermediateFiles
+0000d380: 4465 665f 636f 7265 0a0a 2020 2020 2020  Def_core..      
+0000d390: 2020 6974 656d 5f64 6174 6120 3d20 7b7d    item_data = {}
+0000d3a0: 0a20 2020 2020 2020 2070 726f 6720 3d20  .        prog = 
+0000d3b0: 6d69 7174 632e 5072 696e 744b 6e6f 776e  miqtc.PrintKnown
+0000d3c0: 5072 6f67 7265 7373 4d73 6728 2250 6172  ProgressMsg("Par
+0000d3d0: 7369 6e67 2069 6e74 6572 6d65 6469 6174  sing intermediat
+0000d3e0: 6520 6461 7461 222c 206c 656e 2872 6571  e data", len(req
+0000d3f0: 2929 0a20 2020 2020 2020 2066 6f72 2072  )).        for r
+0000d400: 2069 6e20 7265 713a 0a20 2020 2020 2020   in req:.       
+0000d410: 2020 2020 2070 726f 672e 7072 6f67 7265       prog.progre
+0000d420: 7373 2829 0a20 2020 2020 2020 2020 2020  ss().           
+0000d430: 2066 696c 6520 3d20 7365 6c66 2e5f 5f67   file = self.__g
+0000d440: 6574 5f69 6e74 5f66 696c 655f 7072 6566  et_int_file_pref
+0000d450: 6978 2829 202b 2072 6571 5b72 5d5b 2773  ix() + req[r]['s
+0000d460: 7566 6669 7827 5d0a 2020 2020 2020 2020  uffix'].        
+0000d470: 2020 2020 6966 206e 6f74 206f 732e 7061      if not os.pa
+0000d480: 7468 2e65 7869 7374 7328 6669 6c65 293a  th.exists(file):
+0000d490: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d4a0: 2073 656c 662e 7072 6f76 2e6c 6f67 2822   self.prov.log("
+0000d4b0: 5741 524e 494e 4721 2046 6f72 2061 6368  WARNING! For ach
+0000d4c0: 6965 7669 6e67 2046 4149 526e 6573 7320  ieving FAIRness 
+0000d4d0: 616e 2069 6e74 6572 6d65 6469 6174 6520  an intermediate 
+0000d4e0: 696d 6167 6520 696e 666f 2066 696c 6520  image info file 
+0000d4f0: 6973 206d 6973 7369 6e67 3a20 222b 2073  is missing: "+ s
+0000d500: 656c 662e 5f5f 6765 745f 696e 745f 6669  elf.__get_int_fi
+0000d510: 6c65 5f70 7265 6669 7828 2920 2b20 7265  le_prefix() + re
+0000d520: 715b 725d 5b27 7375 6666 6978 275d 2b20  q[r]['suffix']+ 
+0000d530: 2220 7275 6e20 6669 7273 743a 2022 202b  " run first: " +
+0000d540: 2072 6571 5b72 5d5b 2763 7265 6174 696f   req[r]['creatio
+0000d550: 6e46 6374 275d 290a 2020 2020 2020 2020  nFct']).        
+0000d560: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0000d570: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+0000d580: 6172 7365 4974 656d 4461 7461 6672 6f6d  arseItemDatafrom
+0000d590: 5461 6246 696c 6544 6174 6128 6974 656d  TabFileData(item
+0000d5a0: 5f64 6174 612c 2066 696c 652c 2072 6571  _data, file, req
+0000d5b0: 5b72 5d5b 2763 6f6c 7327 5d2c 2072 6571  [r]['cols'], req
+0000d5c0: 5b72 5d5b 276f 7074 696f 6e61 6c27 5d29  [r]['optional'])
+0000d5d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d5e0: 2073 656c 662e 7072 6f76 2e6c 6f67 2822   self.prov.log("
+0000d5f0: 5061 7273 6564 2069 7465 6d20 6461 7461  Parsed item data
+0000d600: 2066 726f 6d3a 2022 202b 2066 696c 6529   from: " + file)
+0000d610: 0a0a 2020 2020 2020 2020 7072 6f67 2e63  ..        prog.c
+0000d620: 6c65 6172 2829 0a20 2020 2020 2020 2069  lear().        i
+0000d630: 6620 6c65 6e28 6974 656d 5f64 6174 6129  f len(item_data)
+0000d640: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
+0000d650: 2020 2072 6169 7365 2045 7863 6570 7469     raise Excepti
+0000d660: 6f6e 2822 4e6f 2069 4644 4f20 6974 656d  on("No iFDO item
+0000d670: 7322 290a 0a20 2020 2020 2020 2023 2063  s")..        # c
+0000d680: 6865 636b 2066 696c 6573 2065 7869 7374  heck files exist
+0000d690: 0a20 2020 2020 2020 2072 656d 6f76 6520  .        remove 
+0000d6a0: 3d20 5b5d 0a20 2020 2020 2020 2066 6f72  = [].        for
+0000d6b0: 2069 6d67 2069 6e20 6974 656d 5f64 6174   img in item_dat
+0000d6c0: 613a 0a20 2020 2020 2020 2020 2020 2069  a:.            i
+0000d6d0: 6620 6e6f 7420 696d 6720 696e 2073 656c  f not img in sel
+0000d6e0: 662e 5f69 6d61 6765 4e61 6d65 7349 6d61  f._imageNamesIma
+0000d6f0: 6765 7344 6972 3a0a 2020 2020 2020 2020  gesDir:.        
+0000d700: 2020 2020 2020 2020 7265 6d6f 7665 2e61          remove.a
+0000d710: 7070 656e 6428 696d 6729 0a20 2020 2020  ppend(img).     
+0000d720: 2020 2066 6f72 2069 6d67 2069 6e20 7265     for img in re
+0000d730: 6d6f 7665 3a0a 2020 2020 2020 2020 2020  move:.          
+0000d740: 2020 6465 6c20 6974 656d 5f64 6174 615b    del item_data[
+0000d750: 696d 675d 0a0a 2020 2020 2020 2020 2320  img]..        # 
+0000d760: 6164 6420 696d 6167 652d 7572 6c0a 2020  add image-url.  
+0000d770: 2020 2020 2020 666f 7220 696d 6720 696e        for img in
+0000d780: 2069 7465 6d5f 6461 7461 3a0a 2020 2020   item_data:.    
+0000d790: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+0000d7a0: 7461 6e63 6528 6974 656d 5f64 6174 615b  tance(item_data[
+0000d7b0: 696d 675d 2c6c 6973 7429 3a20 2320 6974  img],list): # it
+0000d7c0: 656d 2069 7320 616c 7265 6164 7920 6120  em is already a 
+0000d7d0: 6c69 7374 2028 7669 6465 6f29 2062 7574  list (video) but
+0000d7e0: 2070 6172 7365 6420 6461 7461 2069 7320   parsed data is 
+0000d7f0: 6e6f 742c 2069 2e65 2e20 7061 7273 6564  not, i.e. parsed
+0000d800: 2064 6174 6120 7265 6665 7273 2074 6f20   data refers to 
+0000d810: 7768 6f6c 6520 7669 6465 6f20 2874 696d  whole video (tim
+0000d820: 6520 696e 6465 7065 6e64 656e 7429 2c20  e independent), 
+0000d830: 692e 652e 2077 7269 7465 2074 6f20 6669  i.e. write to fi
+0000d840: 7273 7420 656e 7472 790a 2020 2020 2020  rst entry.      
+0000d850: 2020 2020 2020 2020 2020 7575 6964 203d            uuid =
+0000d860: 2066 696e 6446 6965 6c64 2869 7465 6d5f   findField(item_
+0000d870: 6461 7461 5b69 6d67 5d5b 305d 2c27 696d  data[img][0],'im
+0000d880: 6167 652d 7575 6964 2729 0a20 2020 2020  age-uuid').     
+0000d890: 2020 2020 2020 2020 2020 2069 6620 7575             if uu
+0000d8a0: 6964 203d 3d20 2222 3a0a 2020 2020 2020  id == "":.      
+0000d8b0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+0000d8c0: 696e 7428 6974 656d 5f64 6174 615b 696d  int(item_data[im
+0000d8d0: 675d 290a 2020 2020 2020 2020 2020 2020  g]).            
+0000d8e0: 2020 2020 2020 2020 7261 6973 6520 6d69          raise mi
+0000d8f0: 7174 632e 4966 646f 4578 6365 7074 696f  qtc.IfdoExceptio
+0000d900: 6e28 2275 7569 6420 6e6f 7420 666f 756e  n("uuid not foun
+0000d910: 6420 2861 2922 290a 2020 2020 2020 2020  d (a)").        
+0000d920: 2020 2020 2020 2020 6974 656d 5f64 6174          item_dat
+0000d930: 615b 696d 675d 5b30 5d5b 2769 6d61 6765  a[img][0]['image
+0000d940: 2d68 616e 646c 6527 5d20 3d20 7365 6c66  -handle'] = self
+0000d950: 2e69 6d61 6765 5f68 616e 646c 655f 7072  .image_handle_pr
+0000d960: 6566 6978 202b 2027 4027 202b 2075 7569  efix + '@' + uui
+0000d970: 640a 2020 2020 2020 2020 2020 2020 656c  d.            el
+0000d980: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0000d990: 2020 2020 7575 6964 203d 2066 696e 6446      uuid = findF
+0000d9a0: 6965 6c64 2869 7465 6d5f 6461 7461 5b69  ield(item_data[i
+0000d9b0: 6d67 5d2c 2769 6d61 6765 2d75 7569 6427  mg],'image-uuid'
+0000d9c0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000d9d0: 2020 6966 2075 7569 6420 3d3d 2022 223a    if uuid == "":
+0000d9e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d9f0: 2020 2020 2072 6169 7365 206d 6971 7463       raise miqtc
+0000da00: 2e49 6664 6f45 7863 6570 7469 6f6e 2822  .IfdoException("
+0000da10: 7575 6964 206e 6f74 2066 6f75 6e64 2028  uuid not found (
+0000da20: 6229 2229 0a20 2020 2020 2020 2020 2020  b)").           
+0000da30: 2020 2020 2069 7465 6d5f 6461 7461 5b69       item_data[i
+0000da40: 6d67 5d5b 2769 6d61 6765 2d68 616e 646c  mg]['image-handl
+0000da50: 6527 5d20 3d20 7365 6c66 2e69 6d61 6765  e'] = self.image
+0000da60: 5f68 616e 646c 655f 7072 6566 6978 202b  _handle_prefix +
+0000da70: 2027 4027 202b 2075 7569 640a 0a20 2020   '@' + uuid..   
+0000da80: 2020 2020 2072 6574 7572 6e20 6974 656d       return item
+0000da90: 5f64 6174 610a 0a0a 2020 2020 6465 6620  _data...    def 
+0000daa0: 6164 645f 6974 656d 5f69 6e66 6f5f 7461  add_item_info_ta
+0000dab0: 625f 6669 6c65 2873 656c 662c 2066 696c  b_file(self, fil
+0000dac0: 654e 616d 653a 2073 7472 2c20 7365 7061  eName: str, sepa
+0000dad0: 7261 746f 723a 7374 722c 2068 6561 6465  rator:str, heade
+0000dae0: 723a 6469 6374 2c20 6461 7465 7469 6d65  r:dict, datetime
+0000daf0: 5f66 6f72 6d61 7420 3d20 6d69 7174 762e  _format = miqtv.
+0000db00: 6461 7465 5f66 6f72 6d61 7473 5b27 6d61  date_formats['ma
+0000db10: 7269 7174 275d 293a 0a20 2020 2020 2020  riqt']):.       
+0000db20: 2022 2222 2041 6464 2061 2063 6f6c 756d   """ Add a colum
+0000db30: 6e20 7365 7065 7261 7465 6420 7465 7874  n seperated text
+0000db40: 2066 696c 6520 746f 2070 6172 7365 2069   file to parse i
+0000db50: 7465 6d20 6461 7461 2066 726f 6d20 6279  tem data from by
+0000db60: 2063 7265 6174 6543 6170 7475 7265 416e   createCaptureAn
+0000db70: 6443 6f6e 7465 6e74 4669 656c 6473 2829  dContentFields()
+0000db80: 2e20 0a20 2020 2020 2020 2043 6f6c 756d  . .        Colum
+0000db90: 6e73 2068 6561 6465 7273 2077 696c 6c20  ns headers will 
+0000dba0: 6265 2073 6574 2061 7320 6974 656d 2066  be set as item f
+0000dbb0: 6965 6c64 206e 616d 6573 2e20 4d75 7374  ield names. Must
+0000dbc0: 2063 6f6e 7461 696e 2063 6f6c 756d 6e20   contain column 
+0000dbd0: 2769 6d61 6765 2d66 696c 656e 616d 6527  'image-filename'
+0000dbe0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+0000dbf0: 2020 2020 2020 6966 2066 696c 654e 616d        if fileNam
+0000dc00: 6520 3d3d 204e 6f6e 6520 6f72 206e 6f74  e == None or not
+0000dc10: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
+0000dc20: 6669 6c65 4e61 6d65 293a 0a20 2020 2020  fileName):.     
+0000dc30: 2020 2020 2020 2072 6169 7365 2045 7863         raise Exc
+0000dc40: 6570 7469 6f6e 2822 4669 6c65 222c 6669  eption("File",fi
+0000dc50: 6c65 4e61 6d65 2c22 6e6f 7420 666f 756e  leName,"not foun
+0000dc60: 6422 290a 0a20 2020 2020 2020 2066 6f72  d")..        for
+0000dc70: 2066 6965 6c64 2069 6e20 6865 6164 6572   field in header
+0000dc80: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+0000dc90: 2068 6561 6465 725b 6669 656c 645d 206e   header[field] n
+0000dca0: 6f74 2069 6e20 6d69 7174 662e 7461 6246  ot in miqtf.tabF
+0000dcb0: 696c 6543 6f6c 756d 6e4e 616d 6573 2866  ileColumnNames(f
+0000dcc0: 696c 654e 616d 652c 636f 6c5f 7365 7061  ileName,col_sepa
+0000dcd0: 7261 746f 723d 7365 7061 7261 746f 7229  rator=separator)
+0000dce0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000dcf0: 2020 7261 6973 6520 4578 6365 7074 696f    raise Exceptio
+0000dd00: 6e28 2243 6f6c 756d 6e22 2c20 6865 6164  n("Column", head
+0000dd10: 6572 5b66 6965 6c64 5d2c 2022 6e6f 7420  er[field], "not 
+0000dd20: 696e 2066 696c 6522 2c20 6669 6c65 4e61  in file", fileNa
+0000dd30: 6d65 290a 0a20 2020 2020 2020 2069 6620  me)..        if 
+0000dd40: 6d69 7174 632e 6173 7365 7274 536c 6173  miqtc.assertSlas
+0000dd50: 6828 6f73 2e70 6174 682e 6469 726e 616d  h(os.path.dirnam
+0000dd60: 6528 6669 6c65 4e61 6d65 2929 2021 3d20  e(fileName)) != 
+0000dd70: 6d69 7174 632e 6173 7365 7274 536c 6173  miqtc.assertSlas
+0000dd80: 6828 7365 6c66 2e64 6972 2e74 6f28 7365  h(self.dir.to(se
+0000dd90: 6c66 2e64 6972 2e64 742e 696e 7465 726d  lf.dir.dt.interm
+0000dda0: 6564 6961 7465 2929 3a0a 2020 2020 2020  ediate)):.      
+0000ddb0: 2020 2020 2020 7365 6c66 2e70 726f 762e        self.prov.
+0000ddc0: 6c6f 6728 2022 4361 7574 696f 6e21 2049  log( "Caution! I
+0000ddd0: 7420 6973 2072 6563 6f6d 6d65 6e64 6564  t is recommended
+0000dde0: 2074 6f20 7075 7420 6669 6c65 2069 6e20   to put file in 
+0000ddf0: 7468 6520 6469 7265 6374 6f72 7927 7320  the directory's 
+0000de00: 2769 6e74 6572 6d65 6469 6174 6527 2066  'intermediate' f
+0000de10: 6f6c 6465 723a 2022 202b 2066 696c 654e  older: " + fileN
+0000de20: 616d 6529 0a20 2020 2020 2020 206e 6366  ame).        ncf
+0000de30: 6969 6620 3d20 6e6f 6e43 6f72 6546 6965  iif = nonCoreFie
+0000de40: 6c64 496e 7465 726d 6564 6961 7465 4974  ldIntermediateIt
+0000de50: 656d 496e 666f 4669 6c65 2866 696c 654e  emInfoFile(fileN
+0000de60: 616d 652c 2073 6570 6172 6174 6f72 2c20  ame, separator, 
+0000de70: 6865 6164 6572 2c20 6461 7465 7469 6d65  header, datetime
+0000de80: 5f66 6f72 6d61 7429 0a20 2020 2020 2020  _format).       
+0000de90: 2069 6620 6e63 6669 6966 206e 6f74 2069   if ncfiif not i
+0000dea0: 6e20 7365 6c66 2e6e 6f6e 436f 7265 4669  n self.nonCoreFi
+0000deb0: 656c 6449 6e74 6572 6d65 6469 6174 6549  eldIntermediateI
+0000dec0: 7465 6d49 6e66 6f46 696c 6573 3a20 0a20  temInfoFiles: . 
+0000ded0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000dee0: 6e6f 6e43 6f72 6546 6965 6c64 496e 7465  nonCoreFieldInte
+0000def0: 726d 6564 6961 7465 4974 656d 496e 666f  rmediateItemInfo
+0000df00: 4669 6c65 732e 6170 7065 6e64 286e 6366  Files.append(ncf
+0000df10: 6969 6629 0a0a 2020 2020 6465 6620 6164  iif)..    def ad
+0000df20: 6449 7465 6d49 6e66 6f54 6162 4669 6c65  dItemInfoTabFile
+0000df30: 2873 656c 662c 2066 696c 654e 616d 653a  (self, fileName:
+0000df40: 2073 7472 2c20 7365 7061 7261 746f 723a   str, separator:
+0000df50: 7374 722c 2068 6561 6465 723a 6469 6374  str, header:dict
+0000df60: 2c20 6461 7465 7469 6d65 5f66 6f72 6d61  , datetime_forma
+0000df70: 7420 3d20 6d69 7174 762e 6461 7465 5f66  t = miqtv.date_f
+0000df80: 6f72 6d61 7473 5b27 6d61 7269 7174 275d  ormats['mariqt']
+0000df90: 293a 0a20 2020 2020 2020 2022 2222 2044  ):.        """ D
+0000dfa0: 6570 7265 6361 7465 6420 2d20 7573 6520  eprecated - use 
+0000dfb0: 6164 645f 6974 656d 5f69 6e66 6f5f 7461  add_item_info_ta
+0000dfc0: 625f 6669 6c65 2022 2222 0a20 2020 2020  b_file """.     
+0000dfd0: 2020 2073 656c 662e 6164 645f 6974 656d     self.add_item
+0000dfe0: 5f69 6e66 6f5f 7461 625f 6669 6c65 2866  _info_tab_file(f
+0000dff0: 696c 654e 616d 652c 7365 7061 7261 746f  ileName,separato
+0000e000: 722c 6865 6164 6572 2c64 6174 6574 696d  r,header,datetim
+0000e010: 655f 666f 726d 6174 290a 0a20 2020 2020  e_format)..     
+0000e020: 2020 200a 2020 2020 6465 6620 7265 6d6f     .    def remo
+0000e030: 7665 4974 656d 496e 666f 5461 6246 696c  veItemInfoTabFil
+0000e040: 6528 7365 6c66 2c20 6669 6c65 4e61 6d65  e(self, fileName
+0000e050: 3a20 7374 722c 2073 6570 6172 6174 6f72  : str, separator
+0000e060: 3a73 7472 2c20 6865 6164 6572 3a64 6963  :str, header:dic
+0000e070: 742c 2064 6174 6574 696d 655f 666f 726d  t, datetime_form
+0000e080: 6174 3a73 7472 293a 0a20 2020 2020 2020  at:str):.       
+0000e090: 2022 2222 2072 656d 6f76 6573 2066 696c   """ removes fil
+0000e0a0: 6520 6974 656d 2066 726f 6d20 6c69 7374  e item from list
+0000e0b0: 206f 6620 6669 6c65 7320 746f 2070 6172   of files to par
+0000e0c0: 7365 2069 7465 6d20 6461 7461 2066 726f  se item data fro
+0000e0d0: 6d20 6279 2063 7265 6174 6543 6170 7475  m by createCaptu
+0000e0e0: 7265 416e 6443 6f6e 7465 6e74 4669 656c  reAndContentFiel
+0000e0f0: 6473 2829 2022 2222 0a20 2020 2020 2020  ds() """.       
+0000e100: 206e 6366 6969 6620 3d20 6e6f 6e43 6f72   ncfiif = nonCor
+0000e110: 6546 6965 6c64 496e 7465 726d 6564 6961  eFieldIntermedia
+0000e120: 7465 4974 656d 496e 666f 4669 6c65 2866  teItemInfoFile(f
+0000e130: 696c 654e 616d 652c 2073 6570 6172 6174  ileName, separat
+0000e140: 6f72 2c20 6865 6164 6572 2c20 6461 7465  or, header, date
+0000e150: 7469 6d65 5f66 6f72 6d61 7429 0a20 2020  time_format).   
+0000e160: 2020 2020 2069 6620 6e63 6669 6966 2069       if ncfiif i
+0000e170: 6e20 7365 6c66 2e6e 6f6e 436f 7265 4669  n self.nonCoreFi
+0000e180: 656c 6449 6e74 6572 6d65 6469 6174 6549  eldIntermediateI
+0000e190: 7465 6d49 6e66 6f46 696c 6573 3a20 0a20  temInfoFiles: . 
+0000e1a0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000e1b0: 6e6f 6e43 6f72 6546 6965 6c64 496e 7465  nonCoreFieldInte
+0000e1c0: 726d 6564 6961 7465 4974 656d 496e 666f  rmediateItemInfo
+0000e1d0: 4669 6c65 732e 7265 6d6f 7665 286e 6366  Files.remove(ncf
+0000e1e0: 6969 6629 0a0a 0a20 2020 2064 6566 2075  iif)...    def u
+0000e1f0: 7064 6174 6569 4644 4f28 7365 6c66 2c20  pdateiFDO(self, 
+0000e200: 6865 6164 6572 3a20 6469 6374 2c20 6974  header: dict, it
+0000e210: 656d 733a 206c 6973 742c 2068 6561 6465  ems: list, heade
+0000e220: 725f 6f6e 6c79 3d46 616c 7365 293a 0a20  r_only=False):. 
+0000e230: 2020 2020 2020 2022 2222 2055 7064 6174         """ Updat
+0000e240: 6573 2074 6865 2063 7572 7265 6e74 2076  es the current v
+0000e250: 616c 7565 7320 6946 444f 2077 6974 6820  alues iFDO with 
+0000e260: 7468 6520 7072 6f76 6964 6564 206e 6577  the provided new
+0000e270: 2076 616c 7565 7320 2222 220a 2020 2020   values """.    
+0000e280: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+0000e290: 6372 6561 7465 6946 444f 2868 6561 6465  createiFDO(heade
+0000e2a0: 722c 2069 7465 6d73 2c20 7570 6461 7465  r, items, update
+0000e2b0: 4578 6973 7469 6e67 3d54 7275 652c 2068  Existing=True, h
+0000e2c0: 6561 6465 724f 6e6c 793d 6865 6164 6572  eaderOnly=header
+0000e2d0: 5f6f 6e6c 7929 0a0a 0a20 2020 2064 6566  _only)...    def
+0000e2e0: 2063 7265 6174 6569 4644 4f28 7365 6c66   createiFDO(self
+0000e2f0: 2c20 6865 6164 6572 3a20 6469 6374 2c20  , header: dict, 
+0000e300: 6974 656d 733a 206c 6973 742c 2075 7064  items: list, upd
+0000e310: 6174 6545 7869 7374 696e 673d 4661 6c73  ateExisting=Fals
+0000e320: 652c 6865 6164 6572 4f6e 6c79 3d46 616c  e,headerOnly=Fal
+0000e330: 7365 2c61 6c6c 6f77 5f6d 6973 7369 6e67  se,allow_missing
+0000e340: 5f72 6571 7569 7265 643d 4661 6c73 652c  _required=False,
+0000e350: 7661 6c69 6461 7465 5f73 696e 676c 655f  validate_single_
+0000e360: 6974 656d 733d 4661 6c73 6529 3a0a 2020  items=False):.  
+0000e370: 2020 2020 2020 2222 2220 4372 6561 7465        """ Create
+0000e380: 7320 4641 4952 2064 6967 6974 616c 206f  s FAIR digital o
+0000e390: 626a 6563 7420 666f 7220 7468 6520 696d  bject for the im
+0000e3a0: 6167 6520 6461 7461 2069 7473 656c 662e  age data itself.
+0000e3b0: 2054 6869 7320 636f 6e73 6973 7473 206f   This consists o
+0000e3c0: 6620 6865 6164 6572 2069 6e66 6f72 6d61  f header informa
+0000e3d0: 7469 6f6e 2061 6e64 2069 7465 6d20 696e  tion and item in
+0000e3e0: 666f 726d 6174 696f 6e2e 0a20 2020 2020  formation..     
+0000e3f0: 2020 2075 7064 6174 6545 7869 7374 696e     updateExistin
+0000e400: 673a 2069 6620 4661 6c73 6520 6f6c 6420  g: if False old 
+0000e410: 7661 6c75 6573 2061 7265 2072 656d 6f76  values are remov
+0000e420: 6564 2c20 6f74 6865 7277 6973 6520 7468  ed, otherwise th
+0000e430: 6579 2061 7265 2075 7064 6174 6564 2e0a  ey are updated..
+0000e440: 2020 2020 2020 2020 6865 6164 6572 4f6e          headerOn
+0000e450: 6c79 3a20 6966 2054 7275 6520 6974 656d  ly: if True item
+0000e460: 7320 6d61 7920 6265 2065 6d70 7479 206c  s may be empty l
+0000e470: 6973 742e 0a20 2020 2020 2020 2061 6c6c  ist..        all
+0000e480: 6f77 5f6d 6973 7369 6e67 5f72 6571 7569  ow_missing_requi
+0000e490: 7265 643a 2069 6620 5472 7565 2c20 6e6f  red: if True, no
+0000e4a0: 2065 7863 6570 7469 6f6e 2072 6973 656e   exception risen
+0000e4b0: 2069 6620 6120 7265 7175 6972 6564 2066   if a required f
+0000e4c0: 6965 6c64 2069 7320 6d69 7373 696e 672e  ield is missing.
+0000e4d0: 2020 2222 220a 0a20 2020 2020 2020 2069    """..        i
+0000e4e0: 6620 6e6f 7420 7570 6461 7465 4578 6973  f not updateExis
+0000e4f0: 7469 6e67 2061 6e64 206c 656e 2869 7465  ting and len(ite
+0000e500: 6d73 2920 3d3d 2030 2061 6e64 206e 6f74  ms) == 0 and not
+0000e510: 2068 6561 6465 724f 6e6c 793a 0a20 2020   headerOnly:.   
+0000e520: 2020 2020 2020 2020 2072 6169 7365 2045           raise E
+0000e530: 7863 6570 7469 6f6e 2827 4e6f 2069 7465  xception('No ite
+0000e540: 6d20 696e 666f 726d 6174 696f 6e20 6769  m information gi
+0000e550: 7665 6e27 290a 0a20 2020 2020 2020 2069  ven')..        i
+0000e560: 6620 7570 6461 7465 4578 6973 7469 6e67  f updateExisting
+0000e570: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+0000e580: 6865 6164 6572 0a20 2020 2020 2020 2020  header.         
+0000e590: 2020 2073 656c 662e 7570 6461 7465 5f69     self.update_i
+0000e5a0: 6664 6f5f 6865 6164 6572 5f66 6965 6c64  fdo_header_field
+0000e5b0: 7328 6865 6164 6572 290a 2020 2020 2020  s(header).      
+0000e5c0: 2020 2020 2020 2320 6974 656d 730a 2020        # items.  
+0000e5d0: 2020 2020 2020 2020 2020 2320 7570 6461            # upda
+0000e5e0: 7465 2063 6f70 7920 6f66 2063 7572 7265  te copy of curre
+0000e5f0: 6e74 2069 7465 6d73 2077 6974 6820 6e65  nt items with ne
+0000e600: 7720 6974 656d 7320 6669 656c 6473 0a20  w items fields. 
+0000e610: 2020 2020 2020 2020 2020 2069 7465 6d73             items
+0000e620: 4469 6374 203d 206d 6971 7469 2e63 7265  Dict = miqti.cre
+0000e630: 6174 6549 6d61 6765 4974 656d 7344 6963  ateImageItemsDic
+0000e640: 7446 726f 6d49 6d61 6765 4974 656d 734c  tFromImageItemsL
+0000e650: 6973 7428 6974 656d 7329 0a20 2020 2020  ist(items).     
+0000e660: 2020 2020 2020 2075 7064 6174 6564 4974         updatedIt
+0000e670: 656d 735f 636f 7079 203d 2063 6f70 792e  ems_copy = copy.
+0000e680: 6465 6570 636f 7079 2873 656c 662e 6966  deepcopy(self.if
+0000e690: 646f 5f74 6d70 5b73 656c 662e 696d 6167  do_tmp[self.imag
+0000e6a0: 6553 6574 4974 656d 734b 6579 5d29 0a20  eSetItemsKey]). 
+0000e6b0: 2020 2020 2020 2020 2020 206c 6f67 203d             log =
+0000e6c0: 206d 6971 7463 2e72 6563 7572 7369 7665   miqtc.recursive
+0000e6d0: 6c79 5570 6461 7465 4469 6374 7328 7570  lyUpdateDicts(up
+0000e6e0: 6461 7465 6449 7465 6d73 5f63 6f70 792c  datedItems_copy,
+0000e6f0: 2069 7465 6d73 4469 6374 290a 2020 2020   itemsDict).    
+0000e700: 2020 2020 2020 2020 7365 6c66 2e70 726f          self.pro
+0000e710: 762e 6c6f 6728 6c6f 672c 646f 6e74 5368  v.log(log,dontSh
+0000e720: 6f77 3d54 7275 6529 0a20 2020 2020 2020  ow=True).       
+0000e730: 2020 2020 2069 7465 6d73 203d 206d 6971       items = miq
+0000e740: 7469 2e63 7265 6174 6549 6d61 6765 4974  ti.createImageIt
+0000e750: 656d 734c 6973 7446 726f 6d49 6d61 6765  emsListFromImage
+0000e760: 4974 656d 7344 6963 7428 7570 6461 7465  ItemsDict(update
+0000e770: 6449 7465 6d73 5f63 6f70 7929 0a0a 2020  dItems_copy)..  
+0000e780: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0000e790: 2020 2020 2020 2020 2320 6f76 6572 7772          # overwr
+0000e7a0: 6974 6520 6865 6164 6572 0a20 2020 2020  ite header.     
+0000e7b0: 2020 2020 2020 2073 656c 662e 7365 7469         self.seti
+0000e7c0: 4644 4f48 6561 6465 7246 6965 6c64 7328  FDOHeaderFields(
+0000e7d0: 6865 6164 6572 290a 2020 2020 2020 2020  header).        
+0000e7e0: 2020 2020 2320 636c 6561 7220 6974 656d      # clear item
+0000e7f0: 7320 7365 6374 696f 6e0a 2020 2020 2020  s section.      
+0000e800: 2020 2020 2020 7365 6c66 2e69 6664 6f5f        self.ifdo_
+0000e810: 746d 705b 7365 6c66 2e69 6d61 6765 5365  tmp[self.imageSe
+0000e820: 7449 7465 6d73 4b65 795d 203d 207b 7d0a  tItemsKey] = {}.
+0000e830: 0a0a 2020 2020 2020 2020 2320 5061 7273  ..        # Pars
+0000e840: 6520 696d 6167 652d 6162 7374 7261 6374  e image-abstract
+0000e850: 2061 6e64 2066 696c 6c20 6974 7320 706c   and fill its pl
+0000e860: 6163 6568 6f6c 6465 7273 2077 6974 6820  aceholders with 
+0000e870: 696e 666f 726d 6174 696f 6e0a 2020 2020  information.    
+0000e880: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+0000e890: 2020 2020 2073 656c 662e 6966 646f 5f74       self.ifdo_t
+0000e8a0: 6d70 5b73 656c 662e 696d 6167 6553 6574  mp[self.imageSet
+0000e8b0: 4865 6164 6572 4b65 795d 5b27 696d 6167  HeaderKey]['imag
+0000e8c0: 652d 6162 7374 7261 6374 275d 203d 206d  e-abstract'] = m
+0000e8d0: 6971 7473 2e70 6172 7365 5265 706c 6163  iqts.parseReplac
+0000e8e0: 6556 616c 2873 656c 662e 6966 646f 5f74  eVal(self.ifdo_t
+0000e8f0: 6d70 5b73 656c 662e 696d 6167 6553 6574  mp[self.imageSet
+0000e900: 4865 6164 6572 4b65 795d 2c20 2769 6d61  HeaderKey], 'ima
+0000e910: 6765 2d61 6273 7472 6163 7427 290a 2020  ge-abstract').  
+0000e920: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
+0000e930: 6570 7469 6f6e 2061 7320 6578 3a0a 2020  eption as ex:.  
+0000e940: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+0000e950: 726f 762e 6c6f 6728 2243 6f75 6c64 206e  rov.log("Could n
+0000e960: 6f74 2072 6570 6c61 6365 206b 6579 7320  ot replace keys 
+0000e970: 696e 205c 2769 6d61 6765 2d61 6273 7472  in \'image-abstr
+0000e980: 6163 745c 273a 2022 202b 2073 7472 2865  act\': " + str(e
+0000e990: 7829 290a 0a0a 2020 2020 2020 2020 2320  x))...        # 
+0000e9a0: 7365 7420 7665 7273 696f 6e20 2873 6f20  set version (so 
+0000e9b0: 6974 2063 616e 6e6f 7420 6265 2063 6861  it cannot be cha
+0000e9c0: 6e67 6564 2062 7920 7573 6572 290a 2020  nged by user).  
+0000e9d0: 2020 2020 2020 7365 6c66 2e69 6664 6f5f        self.ifdo_
+0000e9e0: 746d 705b 7365 6c66 2e69 6d61 6765 5365  tmp[self.imageSe
+0000e9f0: 7448 6561 6465 724b 6579 5d5b 2769 6d61  tHeaderKey]['ima
+0000ea00: 6765 2d73 6574 2d69 6664 6f2d 7665 7273  ge-set-ifdo-vers
+0000ea10: 696f 6e27 5d20 3d20 6d69 7174 762e 6946  ion'] = miqtv.iF
+0000ea20: 444f 5f76 6572 7369 6f6e 0a0a 2020 2020  DO_version..    
+0000ea30: 2020 2020 2320 5661 6c69 6461 7465 2069      # Validate i
+0000ea40: 7465 6d20 696e 666f 726d 6174 696f 6e0a  tem information.
+0000ea50: 2020 2020 2020 2020 696d 6167 655f 7365          image_se
+0000ea60: 745f 6974 656d 7320 3d20 7b7d 0a20 2020  t_items = {}.   
+0000ea70: 2020 2020 2069 6620 6865 6164 6572 4f6e       if headerOn
+0000ea80: 6c79 3a0a 2020 2020 2020 2020 2020 2020  ly:.            
+0000ea90: 7365 6c66 2e70 726f 762e 6c6f 6728 2243  self.prov.log("C
+0000eaa0: 6175 7469 6f6e 2120 6946 444f 2063 7265  aution! iFDO cre
+0000eab0: 6174 6564 2069 6e20 6865 6164 6572 5f6f  ated in header_o
+0000eac0: 6e6c 792f 6967 6e6f 7265 5f69 6d61 6765  nly/ignore_image
+0000ead0: 5f66 696c 6520 6d6f 6465 2e20 496d 6167  _file mode. Imag
+0000eae0: 6520 6974 656d 7320 6172 6520 6e65 6974  e items are neit
+0000eaf0: 6865 7220 7570 6461 7465 6420 6e6f 7220  her updated nor 
+0000eb00: 6368 6563 6b65 642e 2229 0a20 2020 2020  checked.").     
+0000eb10: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0000eb20: 2020 2020 2069 6e76 616c 6964 5f69 7465       invalid_ite
+0000eb30: 6d73 203d 2030 0a0a 2020 2020 2020 2020  ms = 0..        
+0000eb40: 2020 2020 7072 6f67 203d 206d 6971 7463      prog = miqtc
+0000eb50: 2e50 7269 6e74 4b6e 6f77 6e50 726f 6772  .PrintKnownProgr
+0000eb60: 6573 734d 7367 2822 4368 6563 6b69 6e67  essMsg("Checking
+0000eb70: 2069 7465 6d73 222c 206c 656e 2869 7465   items", len(ite
+0000eb80: 6d73 292c 6d6f 6475 6c6f 3d35 290a 2020  ms),modulo=5).  
+0000eb90: 2020 2020 2020 2020 2020 666f 7220 6974            for it
+0000eba0: 656d 2069 6e20 6974 656d 733a 0a20 2020  em in items:.   
+0000ebb0: 2020 2020 2020 2020 2020 2020 2070 726f               pro
+0000ebc0: 672e 7072 6f67 7265 7373 2829 0a20 2020  g.progress().   
+0000ebd0: 2020 2020 2020 2020 2020 2020 2023 2063               # c
+0000ebe0: 6865 636b 2069 6620 616c 6c20 636f 7265  heck if all core
+0000ebf0: 2066 6965 6c64 7320 6172 6520 6669 6c6c   fields are fill
+0000ec00: 6564 2061 6e64 2061 7265 2066 696c 6c65  ed and are fille
+0000ec10: 6420 7661 6c69 646c 790a 2020 2020 2020  d validly.      
+0000ec20: 2020 2020 2020 2020 2020 7472 793a 0a0a            try:..
 0000ec30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ec40: 2020 2020 2320 6966 2069 7465 6d20 6973      # if item is
-0000ec50: 2061 206c 6973 7420 2876 6964 656f 292c   a list (video),
-0000ec60: 206f 6e65 2077 6f75 6c64 2068 6176 6520   one would have 
-0000ec70: 746f 2063 6865 636b 2069 6620 6561 6368  to check if each
-0000ec80: 2065 6e74 7279 2069 7320 7661 6c69 6420   entry is valid 
-0000ec90: 6769 7665 6e20 7468 6520 6465 6661 756c  given the defaul
-0000eca0: 7420 7661 6c75 6573 2069 6e20 6669 7273  t values in firs
-0000ecb0: 7420 656e 7472 7920 706c 7573 2067 6976  t entry plus giv
-0000ecc0: 656e 2064 6566 6175 6c74 2076 616c 7565  en default value
-0000ecd0: 7320 696e 2068 6561 6465 720a 2020 2020  s in header.    
-0000ece0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ecf0: 6966 206e 6f74 2069 7369 6e73 7461 6e63  if not isinstanc
-0000ed00: 6528 6974 656d 2c6c 6973 7429 3a0a 2020  e(item,list):.  
-0000ed10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ed20: 2020 2020 2020 6974 656d 203d 205b 6974        item = [it
-0000ed30: 656d 5d0a 2020 2020 2020 2020 2020 2020  em].            
-0000ed40: 2020 2020 2020 2020 7375 6249 7465 6d44          subItemD
-0000ed50: 6566 6175 6c74 203d 2069 7465 6d5b 305d  efault = item[0]
-0000ed60: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-0000ed70: 2020 2020 2020 666f 7220 7375 6249 7465        for subIte
-0000ed80: 6d20 696e 2069 7465 6d3a 0a20 2020 2020  m in item:.     
+0000ec40: 2020 2020 2320 6368 6563 6b20 6974 656d      # check item
+0000ec50: 2069 6d61 6765 2065 7869 7374 730a 2020   image exists.  
+0000ec60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ec70: 2020 2320 6966 2069 7465 6d20 6973 2061    # if item is a
+0000ec80: 206c 6973 7420 2876 6964 656f 292c 206f   list (video), o
+0000ec90: 6e65 2077 6f75 6c64 2068 6176 6520 746f  ne would have to
+0000eca0: 2063 6865 636b 2069 6620 6561 6368 2065   check if each e
+0000ecb0: 6e74 7279 2069 7320 7661 6c69 6420 6769  ntry is valid gi
+0000ecc0: 7665 6e20 7468 6520 6465 6661 756c 7420  ven the default 
+0000ecd0: 7661 6c75 6573 2069 6e20 6669 7273 7420  values in first 
+0000ece0: 656e 7472 7920 706c 7573 2067 6976 656e  entry plus given
+0000ecf0: 2064 6566 6175 6c74 2076 616c 7565 7320   default values 
+0000ed00: 696e 2068 6561 6465 720a 2020 2020 2020  in header.      
+0000ed10: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0000ed20: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
+0000ed30: 6974 656d 2c6c 6973 7429 3a0a 2020 2020  item,list):.    
+0000ed40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ed50: 2020 2020 6974 656d 203d 205b 6974 656d      item = [item
+0000ed60: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+0000ed70: 2020 2020 2020 7375 6249 7465 6d44 6566        subItemDef
+0000ed80: 6175 6c74 203d 2069 7465 6d5b 305d 200a  ault = item[0] .
 0000ed90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eda0: 2020 2066 696c 655f 6e61 6d65 203d 2073     file_name = s
-0000edb0: 7562 4974 656d 5b27 696d 6167 652d 6669  ubItem['image-fi
-0000edc0: 6c65 6e61 6d65 275d 0a20 2020 2020 2020  lename'].       
-0000edd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ede0: 2069 6620 6e6f 7420 7365 6c66 2e69 676e   if not self.ign
-0000edf0: 6f72 655f 696d 6167 655f 6669 6c65 7320  ore_image_files 
-0000ee00: 616e 6420 6669 6c65 5f6e 616d 6520 6e6f  and file_name no
-0000ee10: 7420 696e 2073 656c 662e 5f69 6d61 6765  t in self._image
-0000ee20: 4e61 6d65 7349 6d61 6765 7344 6972 3a0a  NamesImagesDir:.
-0000ee30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ee40: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0000ee50: 6520 4578 6365 7074 696f 6e28 2249 7465  e Exception("Ite
-0000ee60: 6d20 2722 202b 2066 696c 655f 6e61 6d65  m '" + file_name
-0000ee70: 202b 2022 2720 6e6f 7420 666f 756e 6420   + "' not found 
-0000ee80: 696e 202f 7261 7720 6469 7265 6374 6f72  in /raw director
-0000ee90: 792e 2229 0a0a 2020 2020 2020 2020 2020  y.")..          
-0000eea0: 2020 2020 2020 2020 2020 2020 2020 6d69                mi
-0000eeb0: 7174 742e 6172 655f 7661 6c69 645f 6966  qtt.are_valid_if
-0000eec0: 646f 5f66 6965 6c64 7328 7375 6249 7465  do_fields(subIte
-0000eed0: 6d29 2020 2020 2020 2020 2020 2020 2020  m)              
-0000eee0: 2020 2020 2020 2020 2020 200a 0a20 2020             ..   
-0000eef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ef00: 2069 6d61 6765 5f73 6574 5f69 7465 6d73   image_set_items
-0000ef10: 5b73 7562 4974 656d 4465 6661 756c 745b  [subItemDefault[
-0000ef20: 2769 6d61 6765 2d66 696c 656e 616d 6527  'image-filename'
-0000ef30: 5d5d 203d 205b 5d20 2320 636f 756c 6420  ]] = [] # could 
-0000ef40: 6d61 6b65 2061 6e20 6578 7472 6120 6361  make an extra ca
-0000ef50: 7365 2066 6f72 2069 6d61 6765 7320 6f6d  se for images om
-0000ef60: 6974 7469 6e67 2074 6865 206c 6973 740a  itting the list.
-0000ef70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ef80: 2020 2020 666f 7220 7375 6249 7465 6d20      for subItem 
-0000ef90: 696e 2069 7465 6d3a 0a20 2020 2020 2020  in item:.       
+0000eda0: 2020 2020 666f 7220 7375 6249 7465 6d20      for subItem 
+0000edb0: 696e 2069 7465 6d3a 0a20 2020 2020 2020  in item:.       
+0000edc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000edd0: 2066 696c 655f 6e61 6d65 203d 2073 7562   file_name = sub
+0000ede0: 4974 656d 5b27 696d 6167 652d 6669 6c65  Item['image-file
+0000edf0: 6e61 6d65 275d 0a20 2020 2020 2020 2020  name'].         
+0000ee00: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000ee10: 6620 6e6f 7420 7365 6c66 2e69 676e 6f72  f not self.ignor
+0000ee20: 655f 696d 6167 655f 6669 6c65 7320 616e  e_image_files an
+0000ee30: 6420 6669 6c65 5f6e 616d 6520 6e6f 7420  d file_name not 
+0000ee40: 696e 2073 656c 662e 5f69 6d61 6765 4e61  in self._imageNa
+0000ee50: 6d65 7349 6d61 6765 7344 6972 3a0a 2020  mesImagesDir:.  
+0000ee60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ee70: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0000ee80: 4578 6365 7074 696f 6e28 2249 7465 6d20  Exception("Item 
+0000ee90: 2722 202b 2066 696c 655f 6e61 6d65 202b  '" + file_name +
+0000eea0: 2022 2720 6e6f 7420 666f 756e 6420 696e   "' not found in
+0000eeb0: 202f 7261 7720 6469 7265 6374 6f72 792e   /raw directory.
+0000eec0: 2229 0a0a 2020 2020 2020 2020 2020 2020  ")..            
+0000eed0: 2020 2020 2020 2020 2020 2020 6966 2076              if v
+0000eee0: 616c 6964 6174 655f 7369 6e67 6c65 5f69  alidate_single_i
+0000eef0: 7465 6d73 3a0a 2020 2020 2020 2020 2020  tems:.          
+0000ef00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ef10: 2020 6d69 7174 742e 6172 655f 7661 6c69    miqtt.are_vali
+0000ef20: 645f 6966 646f 5f66 6965 6c64 7328 7375  d_ifdo_fields(su
+0000ef30: 6249 7465 6d29 0a20 2020 2020 2020 2020  bItem).         
+0000ef40: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000ef50: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0000ef60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ef70: 2066 6f72 2066 6965 6c64 5f6e 616d 652c   for field_name,
+0000ef80: 6669 656c 645f 7661 6c20 696e 2073 7562  field_val in sub
+0000ef90: 4974 656d 2e69 7465 6d73 2829 3a0a 2020  Item.items():.  
 0000efa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000efb0: 2073 7562 4974 656d 4469 6374 203d 207b   subItemDict = {
-0000efc0: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
-0000efd0: 2020 2020 2020 2020 2020 666f 7220 6974            for it
-0000efe0: 2069 6e20 7375 6249 7465 6d3a 0a20 2020   in subItem:.   
-0000eff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f000: 2020 2020 2020 2020 2069 6620 6974 2021           if it !
-0000f010: 3d20 2769 6d61 6765 2d66 696c 656e 616d  = 'image-filenam
-0000f020: 6527 3a0a 2020 2020 2020 2020 2020 2020  e':.            
-0000f030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f040: 2020 2020 7375 6249 7465 6d44 6963 745b      subItemDict[
-0000f050: 6974 5d20 3d20 7375 6249 7465 6d5b 6974  it] = subItem[it
-0000f060: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-0000f070: 2020 2020 2020 2020 2020 696d 6167 655f            image_
-0000f080: 7365 745f 6974 656d 735b 7375 6249 7465  set_items[subIte
-0000f090: 6d44 6566 6175 6c74 5b27 696d 6167 652d  mDefault['image-
-0000f0a0: 6669 6c65 6e61 6d65 275d 5d2e 6170 7065  filename']].appe
-0000f0b0: 6e64 2873 7562 4974 656d 4469 6374 290a  nd(subItemDict).
+0000efb0: 2020 2020 2020 2020 2020 2020 2020 6d69                mi
+0000efc0: 7174 742e 6966 646f 5f66 6965 6c64 5f61  qtt.ifdo_field_a
+0000efd0: 6464 6974 696f 6e61 6c5f 6368 6563 6b73  dditional_checks
+0000efe0: 2866 6965 6c64 5f6e 616d 652c 6669 656c  (field_name,fiel
+0000eff0: 645f 7661 6c29 2020 2020 2020 2020 2020  d_val)          
+0000f000: 2020 2020 2020 2020 2020 2020 2020 0a0a                ..
+0000f010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f020: 2020 2020 696d 6167 655f 7365 745f 6974      image_set_it
+0000f030: 656d 735b 7375 6249 7465 6d44 6566 6175  ems[subItemDefau
+0000f040: 6c74 5b27 696d 6167 652d 6669 6c65 6e61  lt['image-filena
+0000f050: 6d65 275d 5d20 3d20 5b5d 2023 2063 6f75  me']] = [] # cou
+0000f060: 6c64 206d 616b 6520 616e 2065 7874 7261  ld make an extra
+0000f070: 2063 6173 6520 666f 7220 696d 6167 6573   case for images
+0000f080: 206f 6d69 7474 696e 6720 7468 6520 6c69   omitting the li
+0000f090: 7374 0a20 2020 2020 2020 2020 2020 2020  st.             
+0000f0a0: 2020 2020 2020 2066 6f72 2073 7562 4974         for subIt
+0000f0b0: 656d 2069 6e20 6974 656d 3a0a 2020 2020  em in item:.    
 0000f0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f0d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f0e0: 2065 7863 6570 7420 6d69 7174 632e 4966   except miqtc.If
-0000f0f0: 646f 4578 6365 7074 696f 6e20 6173 2065  doException as e
-0000f100: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000f110: 2020 2020 2020 696e 7661 6c69 645f 6974        invalid_it
-0000f120: 656d 7320 2b3d 2031 0a20 2020 2020 2020  ems += 1.       
-0000f130: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0000f140: 662e 7072 6f76 2e6c 6f67 2822 496e 7661  f.prov.log("Inva
-0000f150: 6c69 6420 696d 6167 6520 6974 656d 3a20  lid image item: 
-0000f160: 222b 2073 7472 2869 7465 6d29 2c64 6f6e  "+ str(item),don
-0000f170: 7453 686f 773d 5472 7565 290a 2020 2020  tShow=True).    
-0000f180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f190: 7365 6c66 2e70 726f 762e 6c6f 6728 2245  self.prov.log("E
-0000f1a0: 7863 6570 7469 6f6e 3a5c 6e22 2b20 7374  xception:\n"+ st
-0000f1b0: 7228 652e 6172 6773 292c 646f 6e74 5368  r(e.args),dontSh
-0000f1c0: 6f77 3d54 7275 6529 0a20 2020 2020 2020  ow=True).       
-0000f1d0: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-0000f1e0: 7365 206d 6971 7463 2e49 6664 6f45 7863  se miqtc.IfdoExc
-0000f1f0: 6570 7469 6f6e 2822 496e 7661 6c69 6420  eption("Invalid 
-0000f200: 696d 6167 6520 6974 656d 2022 2b20 6669  image item "+ fi
-0000f210: 6c65 5f6e 616d 6520 2b20 223a 5c6e 4578  le_name + ":\nEx
-0000f220: 6365 7074 696f 6e3a 5c6e 222b 2073 7472  ception:\n"+ str
-0000f230: 2865 2e61 7267 7329 2920 2320 6f74 6865  (e.args)) # othe
-0000f240: 7277 6973 652c 2069 6e20 6361 7365 206f  rwise, in case o
-0000f250: 6620 6d61 6e79 2069 6d61 6765 732c 2069  f many images, i
-0000f260: 7420 6d61 7920 6b65 6570 2072 756e 6e69  t may keep runni
-0000f270: 6e67 2061 6e64 2074 6872 6f77 696e 6720  ng and throwing 
-0000f280: 6572 726f 7273 2066 6f72 2071 7569 7420  errors for quit 
-0000f290: 736f 6d65 2074 696d 650a 2020 2020 2020  some time.      
-0000f2a0: 2020 2020 2020 7072 6f67 2e63 6c65 6172        prog.clear
-0000f2b0: 2829 0a0a 2020 2020 2020 2020 2020 2020  ()..            
-0000f2c0: 6966 206c 656e 2869 7465 6d73 2920 213d  if len(items) !=
-0000f2d0: 2030 2061 6e64 2069 6e76 616c 6964 5f69   0 and invalid_i
-0000f2e0: 7465 6d73 203d 3d20 6c65 6e28 6974 656d  tems == len(item
-0000f2f0: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
-0000f300: 2020 2020 7261 6973 6520 4578 6365 7074      raise Except
-0000f310: 696f 6e28 2241 6c6c 2069 7465 6d73 2061  ion("All items a
-0000f320: 7265 2069 6e76 616c 6964 2229 0a20 2020  re invalid").   
-0000f330: 2020 2020 2020 2020 2065 6c69 6620 696e           elif in
-0000f340: 7661 6c69 645f 6974 656d 7320 3e20 303a  valid_items > 0:
-0000f350: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f360: 2073 656c 662e 7072 6f76 2e6c 6f67 2822   self.prov.log("
-0000f370: 4174 206c 6561 7374 2022 202b 2073 7472  At least " + str
-0000f380: 2869 6e76 616c 6964 5f69 7465 6d73 2920  (invalid_items) 
-0000f390: 2b20 2220 6974 656d 7320 7765 7265 2069  + " items were i
-0000f3a0: 6e76 616c 6964 2028 6f66 2220 2b20 7374  nvalid (of" + st
-0000f3b0: 7228 6c65 6e28 6974 656d 7329 292b 2022  r(len(items))+ "
-0000f3c0: 2922 290a 0a20 2020 2020 2020 2023 2056  )")..        # V
-0000f3d0: 616c 6964 6174 6520 6865 6164 6572 2069  alidate header i
-0000f3e0: 6e66 6f72 6d61 7469 6f6e 0a20 2020 2020  nformation.     
-0000f3f0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-0000f400: 2020 2020 6d69 7174 742e 6172 655f 7661      miqtt.are_va
-0000f410: 6c69 645f 6966 646f 5f66 6965 6c64 7328  lid_ifdo_fields(
-0000f420: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
-0000f430: 6c66 2e69 6d61 6765 5365 7448 6561 6465  lf.imageSetHeade
-0000f440: 724b 6579 5d29 0a20 2020 2020 2020 2065  rKey]).        e
-0000f450: 7863 6570 7420 6d69 7174 632e 4966 646f  xcept miqtc.Ifdo
-0000f460: 4578 6365 7074 696f 6e20 6173 2065 783a  Exception as ex:
-0000f470: 0a20 2020 2020 2020 2020 2020 206d 7367  .            msg
-0000f480: 203d 2022 496e 7661 6c69 6420 6865 6164   = "Invalid head
-0000f490: 6572 2066 6965 6c64 3a20 2220 2b20 7374  er field: " + st
-0000f4a0: 7228 6578 290a 2020 2020 2020 2020 2020  r(ex).          
-0000f4b0: 2020 7365 6c66 2e70 726f 762e 6c6f 6728    self.prov.log(
-0000f4c0: 2245 7863 6570 7469 6f6e 3a20 2220 2b20  "Exception: " + 
-0000f4d0: 6d73 672c 2064 6f6e 7453 686f 773d 5472  msg, dontShow=Tr
-0000f4e0: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
-0000f4f0: 7261 6973 6520 6d69 7174 632e 4966 646f  raise miqtc.Ifdo
-0000f500: 4578 6365 7074 696f 6e28 6d73 6729 0a0a  Exception(msg)..
-0000f510: 2020 2020 2020 2020 2320 7075 7420 6974          # put it
-0000f520: 656d 2069 6e66 6f20 696e 746f 2073 656c  em info into sel
-0000f530: 662e 6966 646f 5f74 6d70 0a20 2020 2020  f.ifdo_tmp.     
-0000f540: 2020 2073 203d 206d 6971 7463 2e50 7269     s = miqtc.Pri
-0000f550: 6e74 4c6f 6164 696e 674d 7367 2822 5570  ntLoadingMsg("Up
-0000f560: 6461 7469 6e67 2229 0a20 2020 2020 2020  dating").       
-0000f570: 206c 6f67 203d 206d 6971 7463 2e72 6563   log = miqtc.rec
-0000f580: 7572 7369 7665 6c79 5570 6461 7465 4469  ursivelyUpdateDi
-0000f590: 6374 7328 7365 6c66 2e69 6664 6f5f 746d  cts(self.ifdo_tm
-0000f5a0: 705b 7365 6c66 2e69 6d61 6765 5365 7449  p[self.imageSetI
-0000f5b0: 7465 6d73 4b65 795d 2c20 696d 6167 655f  temsKey], image_
-0000f5c0: 7365 745f 6974 656d 7329 0a20 2020 2020  set_items).     
-0000f5d0: 2020 2073 2e73 746f 7028 290a 2020 2020     s.stop().    
-0000f5e0: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
-0000f5f0: 6728 6c6f 6729 0a0a 2020 2020 2020 2020  g(log)..        
-0000f600: 2320 7365 7420 6c61 7420 6c6f 6e20 626f  # set lat lon bo
-0000f610: 756e 6469 6e67 2062 6f78 0a20 2020 2020  unding box.     
-0000f620: 2020 2073 656c 662e 5f73 6574 5f6c 6174     self._set_lat
-0000f630: 5f6c 6f6e 5f62 6f75 6e64 696e 675f 626f  _lon_bounding_bo
-0000f640: 7828 7365 6c66 2e69 6664 6f5f 746d 7029  x(self.ifdo_tmp)
-0000f650: 0a0a 2020 2020 2020 2020 2320 7365 7420  ..        # set 
-0000f660: 7265 7072 6573 656e 7461 7469 7665 2068  representative h
-0000f670: 6561 6465 7220 6669 656c 6473 2064 6174  eader fields dat
-0000f680: 6574 696d 652c 206c 6174 2c20 6c6f 6e2c  etime, lat, lon,
-0000f690: 2061 6c74 0a20 2020 2020 2020 2073 656c   alt.        sel
-0000f6a0: 662e 5f73 6574 5f72 6570 5f68 6561 6465  f._set_rep_heade
-0000f6b0: 725f 6669 656c 6473 5f64 745f 6c61 745f  r_fields_dt_lat_
-0000f6c0: 6c6f 6e5f 616c 7428 7365 6c66 2e69 6664  lon_alt(self.ifd
-0000f6d0: 6f5f 746d 7029 0a0a 2020 2020 2020 2020  o_tmp)..        
-0000f6e0: 7365 6c66 2e5f 7365 745f 696d 6167 655f  self._set_image_
-0000f6f0: 6974 656d 5f69 6465 6e74 6966 6963 6174  item_identificat
-0000f700: 696f 6e5f 7363 6865 6d65 2873 656c 662e  ion_scheme(self.
-0000f710: 6966 646f 5f74 6d70 290a 0a20 2020 2020  ifdo_tmp)..     
-0000f720: 2020 2023 2072 656d 6f76 6520 656d 7470     # remove emtp
-0000f730: 7920 6669 656c 6473 0a20 2020 2020 2020  y fields.       
-0000f740: 2073 203d 206d 6971 7463 2e50 7269 6e74   s = miqtc.Print
-0000f750: 4c6f 6164 696e 674d 7367 2822 5265 6d6f  LoadingMsg("Remo
-0000f760: 7669 6e67 2065 6d70 7479 2066 6965 6c64  ving empty field
-0000f770: 7322 290a 2020 2020 2020 2020 7365 6c66  s").        self
-0000f780: 2e69 6664 6f5f 746d 7020 3d20 6d69 7174  .ifdo_tmp = miqt
-0000f790: 632e 7265 6375 7273 6976 656c 7952 656d  c.recursivelyRem
-0000f7a0: 6f76 6545 6d70 7479 4669 656c 6473 2873  oveEmptyFields(s
-0000f7b0: 656c 662e 6966 646f 5f74 6d70 290a 2020  elf.ifdo_tmp).  
-0000f7c0: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
-0000f7d0: 662e 696d 6167 6553 6574 4974 656d 734b  f.imageSetItemsK
-0000f7e0: 6579 2069 6e20 7365 6c66 2e69 6664 6f5f  ey in self.ifdo_
-0000f7f0: 746d 703a 0a20 2020 2020 2020 2020 2020  tmp:.           
-0000f800: 2073 656c 662e 6966 646f 5f74 6d70 5b73   self.ifdo_tmp[s
-0000f810: 656c 662e 696d 6167 6553 6574 4974 656d  elf.imageSetItem
-0000f820: 734b 6579 5d20 3d20 5b5d 0a20 2020 2020  sKey] = [].     
-0000f830: 2020 2023 2072 656d 6f76 6520 6669 656c     # remove fiel
-0000f840: 6473 2074 6861 7420 636f 6e74 6169 6e20  ds that contain 
-0000f850: 2769 6d61 6765 2d64 6174 6574 696d 6527  'image-datetime'
-0000f860: 206f 6e6c 790a 2020 2020 2020 2020 7365   only.        se
-0000f870: 6c66 2e72 656d 6f76 6549 7465 6d46 6965  lf.removeItemFie
-0000f880: 6c64 7357 6974 684f 6e6c 7944 6174 6554  ldsWithOnlyDateT
-0000f890: 696d 6528 290a 2020 2020 2020 2020 732e  ime().        s.
-0000f8a0: 7374 6f70 2829 0a0a 2020 2020 2020 2020  stop()..        
-0000f8b0: 6966 206e 6f74 2073 656c 662e 6967 6e6f  if not self.igno
-0000f8c0: 7265 5f69 6d61 6765 5f66 696c 6573 3a0a  re_image_files:.
-0000f8d0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000f8e0: 2e63 6865 636b 416c 6c49 7465 6d48 6173  .checkAllItemHas
-0000f8f0: 6865 7328 290a 0a20 2020 2020 2020 2023  hes()..        #
-0000f900: 2063 6865 636b 2061 6761 696e 7374 2073   check against s
-0000f910: 6368 656d 610a 2020 2020 2020 2020 7661  chema.        va
-0000f920: 6c69 642c 206d 7367 203d 206d 6971 7474  lid, msg = miqtt
-0000f930: 2e76 616c 6964 6174 655f 6966 646f 2873  .validate_ifdo(s
-0000f940: 656c 662e 6966 646f 5f74 6d70 290a 2020  elf.ifdo_tmp).  
-0000f950: 2020 2020 2020 6966 206e 6f74 2076 616c        if not val
-0000f960: 6964 2061 6e64 206e 6f74 2061 6c6c 6f77  id and not allow
-0000f970: 5f6d 6973 7369 6e67 5f72 6571 7569 7265  _missing_require
-0000f980: 643a 0a20 2020 2020 2020 2020 2020 2073  d:.            s
-0000f990: 656c 662e 7072 6f76 2e6c 6f67 2822 5761  elf.prov.log("Wa
-0000f9a0: 726e 696e 6721 2069 4644 4f20 6e6f 2076  rning! iFDO no v
-0000f9b0: 616c 6964 2079 6574 3a20 2220 2b20 6d73  alid yet: " + ms
-0000f9c0: 6729 0a20 2020 2020 2020 2020 2020 2072  g).            r
-0000f9d0: 6169 7365 206d 6971 7463 2e49 6664 6f45  aise miqtc.IfdoE
-0000f9e0: 7863 6570 7469 6f6e 286d 7367 290a 0a20  xception(msg).. 
-0000f9f0: 2020 2020 2020 2023 2073 6574 2066 696e         # set fin
-0000fa00: 616c 206f 6e65 0a20 2020 2020 2020 2073  al one.        s
-0000fa10: 656c 662e 6966 646f 5f63 6865 636b 6564  elf.ifdo_checked
-0000fa20: 203d 2063 6f70 792e 6465 6570 636f 7079   = copy.deepcopy
-0000fa30: 2873 656c 662e 6966 646f 5f74 6d70 290a  (self.ifdo_tmp).
-0000fa40: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0000fa50: 656c 662e 6966 646f 5f63 6865 636b 6564  elf.ifdo_checked
-0000fa60: 0a0a 0a20 2020 2064 6566 205f 7365 745f  ...    def _set_
-0000fa70: 696d 6167 655f 6974 656d 5f69 6465 6e74  image_item_ident
-0000fa80: 6966 6963 6174 696f 6e5f 7363 6865 6d65  ification_scheme
-0000fa90: 2873 656c 662c 6966 646f 3a64 6963 7429  (self,ifdo:dict)
-0000faa0: 3a0a 2020 2020 2020 2020 2222 2220 5365  :.        """ Se
-0000fab0: 7420 696d 6167 652d 6974 656d 2d69 6465  t image-item-ide
-0000fac0: 6e74 6966 6963 6174 696f 6e2d 7363 6865  ntification-sche
-0000fad0: 6d65 2074 6f20 6069 6d61 6765 2d70 726f  me to `image-pro
-0000fae0: 6a65 6374 5f69 6d61 6765 2d65 7665 6e74  ject_image-event
-0000faf0: 5f69 6d61 6765 2d73 656e 736f 725f 696d  _image-sensor_im
-0000fb00: 6167 652d 6461 7465 7469 6d65 2e65 7874  age-datetime.ext
-0000fb10: 6020 6966 2065 6d70 7479 2e20 2222 220a  ` if empty. """.
-0000fb20: 2020 2020 2020 2020 6966 2066 696e 6446          if findF
-0000fb30: 6965 6c64 2869 6664 6f5b 7365 6c66 2e69  ield(ifdo[self.i
-0000fb40: 6d61 6765 5365 7448 6561 6465 724b 6579  mageSetHeaderKey
-0000fb50: 5d2c 2769 6d61 6765 2d69 7465 6d2d 6964  ],'image-item-id
-0000fb60: 656e 7469 6669 6361 7469 6f6e 2d73 6368  entification-sch
-0000fb70: 656d 6527 2920 3d3d 2022 223a 0a20 2020  eme') == "":.   
-0000fb80: 2020 2020 2020 2020 2069 6664 6f5b 7365           ifdo[se
-0000fb90: 6c66 2e69 6d61 6765 5365 7448 6561 6465  lf.imageSetHeade
-0000fba0: 724b 6579 5d5b 2769 6d61 6765 2d69 7465  rKey]['image-ite
-0000fbb0: 6d2d 6964 656e 7469 6669 6361 7469 6f6e  m-identification
-0000fbc0: 2d73 6368 656d 6527 5d20 3d20 2027 696d  -scheme'] =  'im
-0000fbd0: 6167 652d 7072 6f6a 6563 745f 696d 6167  age-project_imag
-0000fbe0: 652d 6576 656e 745f 696d 6167 652d 7365  e-event_image-se
-0000fbf0: 6e73 6f72 5f69 6d61 6765 2d64 6174 6574  nsor_image-datet
-0000fc00: 696d 652e 6578 7427 0a0a 0a20 2020 2064  ime.ext'...    d
-0000fc10: 6566 205f 7365 745f 7265 705f 6865 6164  ef _set_rep_head
-0000fc20: 6572 5f66 6965 6c64 735f 6474 5f6c 6174  er_fields_dt_lat
-0000fc30: 5f6c 6f6e 5f61 6c74 2873 656c 662c 6966  _lon_alt(self,if
-0000fc40: 646f 3a64 6963 7429 3a0a 2020 2020 2020  do:dict):.      
-0000fc50: 2020 2222 2220 4669 6c6c 2068 6561 6465    """ Fill heade
-0000fc60: 7220 6669 656c 6473 2069 6d61 6765 2d64  r fields image-d
-0000fc70: 6174 6574 696d 652c 202d 6c61 7469 7475  atetime, -latitu
-0000fc80: 6465 2c20 2d6c 6f6e 6769 7475 6564 652c  de, -longituede,
-0000fc90: 202d 616c 7469 7475 6465 2d6d 6574 6572   -altitude-meter
-0000fca0: 732c 2069 6620 656d 7074 792c 0a20 2020  s, if empty,.   
-0000fcb0: 2020 2020 2072 6570 7265 7365 6e74 6174       representat
-0000fcc0: 6976 656c 7920 7769 7468 2076 616c 7565  ively with value
-0000fcd0: 7320 6672 6f6d 2066 6972 7374 2069 7465  s from first ite
-0000fce0: 6d2e 2022 2222 0a20 2020 2020 2020 2066  m. """.        f
-0000fcf0: 6972 7374 5f69 6d61 6765 203d 2073 6f72  irst_image = sor
-0000fd00: 7465 6428 6966 646f 5b73 656c 662e 696d  ted(ifdo[self.im
-0000fd10: 6167 6553 6574 4974 656d 734b 6579 5d2e  ageSetItemsKey].
-0000fd20: 6b65 7973 2829 295b 305d 0a20 2020 2020  keys())[0].     
-0000fd30: 2020 2072 6570 5f68 6561 6465 725f 6669     rep_header_fi
-0000fd40: 656c 6473 203d 205b 2769 6d61 6765 2d64  elds = ['image-d
-0000fd50: 6174 6574 696d 6527 2c27 696d 6167 652d  atetime','image-
-0000fd60: 6c61 7469 7475 6465 272c 2769 6d61 6765  latitude','image
-0000fd70: 2d6c 6f6e 6769 7475 6465 272c 2769 6d61  -longitude','ima
-0000fd80: 6765 2d61 6c74 6974 7564 652d 6d65 7465  ge-altitude-mete
-0000fd90: 7273 275d 0a20 2020 2020 2020 2066 6f72  rs'].        for
-0000fda0: 2066 6965 6c64 2069 6e20 7265 705f 6865   field in rep_he
-0000fdb0: 6164 6572 5f66 6965 6c64 733a 0a20 2020  ader_fields:.   
-0000fdc0: 2020 2020 2020 2020 2069 6620 6669 6e64           if find
-0000fdd0: 4669 656c 6428 6966 646f 5b73 656c 662e  Field(ifdo[self.
-0000fde0: 696d 6167 6553 6574 4865 6164 6572 4b65  imageSetHeaderKe
-0000fdf0: 795d 2c66 6965 6c64 2920 3d3d 2022 223a  y],field) == "":
-0000fe00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000fe10: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-0000fe20: 2020 2020 2020 2020 2020 6966 646f 5b73            ifdo[s
-0000fe30: 656c 662e 696d 6167 6553 6574 4865 6164  elf.imageSetHead
-0000fe40: 6572 4b65 795d 5b66 6965 6c64 5d20 3d20  erKey][field] = 
-0000fe50: 7365 6c66 2e5f 5f67 6574 4669 656c 6456  self.__getFieldV
-0000fe60: 616c 7565 2869 6664 6f2c 5b66 6972 7374  alue(ifdo,[first
-0000fe70: 5f69 6d61 6765 2c66 6965 6c64 5d2c 6465  _image,field],de
-0000fe80: 6661 756c 745f 6f6e 6c79 3d54 7275 6529  fault_only=True)
-0000fe90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000fea0: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
-0000feb0: 6f67 2822 5365 7420 7265 7072 6573 656e  og("Set represen
-0000fec0: 7461 7469 7665 2068 6561 6465 7220 6669  tative header fi
-0000fed0: 656c 6420 2722 202b 2066 6965 6c64 202b  eld '" + field +
-0000fee0: 2022 2720 746f 2022 202b 2073 7472 2869   "' to " + str(i
-0000fef0: 6664 6f5b 7365 6c66 2e69 6d61 6765 5365  fdo[self.imageSe
-0000ff00: 7448 6561 6465 724b 6579 5d5b 6669 656c  tHeaderKey][fiel
-0000ff10: 645d 2920 2b20 2220 6672 6f6d 2066 6972  d]) + " from fir
-0000ff20: 7374 2069 6d61 6765 2e22 290a 2020 2020  st image.").    
-0000ff30: 2020 2020 2020 2020 2020 2020 6578 6365              exce
-0000ff40: 7074 206d 6971 7463 2e49 6664 6f45 7863  pt miqtc.IfdoExc
-0000ff50: 6570 7469 6f6e 2061 7320 6578 3a0a 2020  eption as ex:.  
-0000ff60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ff70: 2020 7365 6c66 2e70 726f 762e 6c6f 6728    self.prov.log(
-0000ff80: 2243 6f75 6c64 206e 6f74 2073 6574 2072  "Could not set r
-0000ff90: 6570 7265 7365 6e74 6174 6976 6520 6865  epresentative he
-0000ffa0: 6164 6572 2066 6965 6c64 3a20 2220 2b20  ader field: " + 
-0000ffb0: 7374 7228 6578 2929 0a20 2020 2020 2020  str(ex)).       
-0000ffc0: 2020 2020 2020 2020 2020 2020 2070 6173               pas
-0000ffd0: 730a 0a0a 2020 2020 6465 6620 5f73 6574  s...    def _set
-0000ffe0: 5f6c 6174 5f6c 6f6e 5f62 6f75 6e64 696e  _lat_lon_boundin
-0000fff0: 675f 626f 7828 7365 6c66 2c69 6664 6f3a  g_box(self,ifdo:
-00010000: 6469 6374 293a 0a20 2020 2020 2020 2022  dict):.        "
-00010010: 2222 2053 6574 2069 6d61 6765 2d73 6574  "" Set image-set
-00010020: 2d5b 6d69 6e2c 6d61 785d 2d5b 6c61 7469  -[min,max]-[lati
-00010030: 7475 6465 2c6c 6f6e 6769 7475 6465 5d2d  tude,longitude]-
-00010040: 6465 6772 6565 7320 2222 220a 2020 2020  degrees """.    
-00010050: 2020 2020 6c61 745f 6d69 6e2c 206c 6174      lat_min, lat
-00010060: 5f6d 6178 2c20 6c6f 6e5f 6d69 6e2c 206c  _max, lon_min, l
-00010070: 6f6e 5f6d 6178 203d 2073 656c 662e 5f67  on_max = self._g
-00010080: 6574 5f6c 6174 5f6c 6f6e 5f62 6f75 6e64  et_lat_lon_bound
-00010090: 696e 675f 626f 7828 6966 646f 5b73 656c  ing_box(ifdo[sel
-000100a0: 662e 696d 6167 6553 6574 4974 656d 734b  f.imageSetItemsK
-000100b0: 6579 5d29 0a20 2020 2020 2020 2069 6620  ey]).        if 
-000100c0: 6e6f 7420 4e6f 6e65 2069 6e20 5b6c 6174  not None in [lat
-000100d0: 5f6d 696e 2c20 6c61 745f 6d61 782c 206c  _min, lat_max, l
-000100e0: 6f6e 5f6d 696e 2c20 6c6f 6e5f 6d61 785d  on_min, lon_max]
-000100f0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00010100: 646f 5b73 656c 662e 696d 6167 6553 6574  do[self.imageSet
-00010110: 4865 6164 6572 4b65 795d 5b27 696d 6167  HeaderKey]['imag
-00010120: 652d 7365 742d 6d69 6e2d 6c61 7469 7475  e-set-min-latitu
-00010130: 6465 2d64 6567 7265 6573 275d 203d 206c  de-degrees'] = l
-00010140: 6174 5f6d 696e 0a20 2020 2020 2020 2020  at_min.         
-00010150: 2020 2069 6664 6f5b 7365 6c66 2e69 6d61     ifdo[self.ima
-00010160: 6765 5365 7448 6561 6465 724b 6579 5d5b  geSetHeaderKey][
-00010170: 2769 6d61 6765 2d73 6574 2d6d 6178 2d6c  'image-set-max-l
-00010180: 6174 6974 7564 652d 6465 6772 6565 7327  atitude-degrees'
-00010190: 5d20 3d20 6c61 745f 6d61 780a 2020 2020  ] = lat_max.    
-000101a0: 2020 2020 2020 2020 6966 646f 5b73 656c          ifdo[sel
-000101b0: 662e 696d 6167 6553 6574 4865 6164 6572  f.imageSetHeader
-000101c0: 4b65 795d 5b27 696d 6167 652d 7365 742d  Key]['image-set-
-000101d0: 6d69 6e2d 6c6f 6e67 6974 7564 652d 6465  min-longitude-de
-000101e0: 6772 6565 7327 5d20 3d20 6c6f 6e5f 6d69  grees'] = lon_mi
-000101f0: 6e0a 2020 2020 2020 2020 2020 2020 6966  n.            if
-00010200: 646f 5b73 656c 662e 696d 6167 6553 6574  do[self.imageSet
-00010210: 4865 6164 6572 4b65 795d 5b27 696d 6167  HeaderKey]['imag
-00010220: 652d 7365 742d 6d61 782d 6c6f 6e67 6974  e-set-max-longit
-00010230: 7564 652d 6465 6772 6565 7327 5d20 3d20  ude-degrees'] = 
-00010240: 6c6f 6e5f 6d61 780a 0a0a 2020 2020 4073  lon_max...    @s
-00010250: 7461 7469 636d 6574 686f 640a 2020 2020  taticmethod.    
-00010260: 6465 6620 5f67 6574 5f6c 6174 5f6c 6f6e  def _get_lat_lon
-00010270: 5f62 6f75 6e64 696e 675f 626f 7828 6974  _bounding_box(it
-00010280: 656d 733a 6469 6374 293a 0a20 2020 2020  ems:dict):.     
-00010290: 2020 2022 2222 2052 6574 7572 6e73 206c     """ Returns l
-000102a0: 6174 5f6d 696e 2c20 6c61 745f 6d61 782c  at_min, lat_max,
-000102b0: 206c 6f6e 5f6d 696e 2c20 6c6f 6e5f 6d61   lon_min, lon_ma
-000102c0: 7820 2222 220a 2020 2020 2020 2020 6c61  x """.        la
-000102d0: 745f 6d69 6e2c 206c 6174 5f6d 6178 2c20  t_min, lat_max, 
-000102e0: 6c6f 6e5f 6d69 6e2c 206c 6f6e 5f6d 6178  lon_min, lon_max
-000102f0: 203d 204e 6f6e 652c 204e 6f6e 652c 204e   = None, None, N
-00010300: 6f6e 652c 204e 6f6e 650a 2020 2020 2020  one, None.      
-00010310: 2020 6920 3d20 300a 2020 2020 2020 2020    i = 0.        
-00010320: 666f 7220 696d 6167 652c 2064 6174 6120  for image, data 
-00010330: 696e 2069 7465 6d73 2e69 7465 6d73 2829  in items.items()
-00010340: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-00010350: 6d61 6b65 2069 6d61 6765 2065 6e74 7279  make image entry
-00010360: 206c 6973 7420 2861 6c73 6f20 6966 2069   list (also if i
-00010370: 7473 2061 2070 6963 7475 7265 290a 2020  ts a picture).  
-00010380: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-00010390: 2069 7369 6e73 7461 6e63 6528 6461 7461   isinstance(data
-000103a0: 2c20 6c69 7374 293a 0a20 2020 2020 2020  , list):.       
-000103b0: 2020 2020 2020 2020 2064 6174 6120 3d20           data = 
-000103c0: 5b64 6174 615d 0a20 2020 2020 2020 2020  [data].         
-000103d0: 2020 200a 2020 2020 2020 2020 2020 2020     .            
-000103e0: 666f 7220 7469 6d65 706f 696e 745f 6461  for timepoint_da
-000103f0: 7461 2069 6e20 6461 7461 3a0a 2020 2020  ta in data:.    
-00010400: 2020 2020 2020 2020 2020 2020 7472 793a              try:
-00010410: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010420: 2020 2020 206c 6174 203d 2074 696d 6570       lat = timep
-00010430: 6f69 6e74 5f64 6174 615b 2769 6d61 6765  oint_data['image
-00010440: 2d6c 6174 6974 7564 6527 5d0a 2020 2020  -latitude'].    
-00010450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010460: 6c6f 6e20 3d20 7469 6d65 706f 696e 745f  lon = timepoint_
-00010470: 6461 7461 5b27 696d 6167 652d 6c6f 6e67  data['image-long
-00010480: 6974 7564 6527 5d0a 2020 2020 2020 2020  itude'].        
-00010490: 2020 2020 2020 2020 6578 6365 7074 204b          except K
-000104a0: 6579 4572 726f 7220 6173 2065 783a 0a20  eyError as ex:. 
-000104b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000104c0: 2020 2063 6f6e 7469 6e75 650a 0a20 2020     continue..   
-000104d0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000104e0: 6920 3d3d 2030 3a0a 2020 2020 2020 2020  i == 0:.        
-000104f0: 2020 2020 2020 2020 2020 2020 6c61 745f              lat_
-00010500: 6d69 6e2c 206c 6174 5f6d 6178 203d 206c  min, lat_max = l
-00010510: 6174 2c20 6c61 740a 2020 2020 2020 2020  at, lat.        
-00010520: 2020 2020 2020 2020 2020 2020 6c6f 6e5f              lon_
-00010530: 6d69 6e2c 206c 6f6e 5f6d 6178 203d 206c  min, lon_max = l
-00010540: 6f6e 2c20 6c6f 6e0a 2020 2020 2020 2020  on, lon.        
-00010550: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00010560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010570: 2020 6966 206c 6174 203c 206c 6174 5f6d    if lat < lat_m
-00010580: 696e 3a0a 2020 2020 2020 2020 2020 2020  in:.            
-00010590: 2020 2020 2020 2020 2020 2020 6c61 745f              lat_
-000105a0: 6d69 6e20 3d20 6c61 740a 2020 2020 2020  min = lat.      
-000105b0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-000105c0: 206c 6174 203e 206c 6174 5f6d 6178 3a0a   lat > lat_max:.
-000105d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000105e0: 2020 2020 2020 2020 6c61 745f 6d61 7820          lat_max 
-000105f0: 3d20 6c61 740a 2020 2020 2020 2020 2020  = lat.          
-00010600: 2020 2020 2020 2020 2020 6966 206c 6f6e            if lon
-00010610: 203c 206c 6f6e 5f6d 696e 3a0a 2020 2020   < lon_min:.    
-00010620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010630: 2020 2020 6c6f 6e5f 6d69 6e20 3d20 6c6f      lon_min = lo
-00010640: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
-00010650: 2020 2020 2020 6966 206c 6f6e 203e 206c        if lon > l
-00010660: 6f6e 5f6d 6178 3a0a 2020 2020 2020 2020  on_max:.        
-00010670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010680: 6c6f 6e5f 6d61 7820 3d20 6c6f 6e0a 2020  lon_max = lon.  
-00010690: 2020 2020 2020 2020 2020 2020 2020 6920                i 
-000106a0: 2b3d 2031 0a20 2020 2020 2020 2072 6574  += 1.        ret
-000106b0: 7572 6e20 6c61 745f 6d69 6e2c 206c 6174  urn lat_min, lat
-000106c0: 5f6d 6178 2c20 6c6f 6e5f 6d69 6e2c 206c  _max, lon_min, l
-000106d0: 6f6e 5f6d 6178 0a0a 0a20 2020 2064 6566  on_max...    def
-000106e0: 2072 656d 6f76 6549 7465 6d46 6965 6c64   removeItemField
-000106f0: 7357 6974 684f 6e6c 7944 6174 6554 696d  sWithOnlyDateTim
-00010700: 6528 7365 6c66 293a 0a20 2020 2020 2020  e(self):.       
-00010710: 2022 2222 2069 7420 6361 6e20 6861 7070   """ it can happ
-00010720: 656e 2074 6861 7420 616e 2069 6d61 6765  en that an image
-00010730: 2074 696d 6573 7461 6d70 2064 6f65 7320   timestamp does 
-00010740: 6e6f 7420 636f 6e74 6169 6e20 616e 7920  not contain any 
-00010750: 6669 656c 6473 2062 7574 2074 6865 2074  fields but the t
-00010760: 696d 6573 7461 6d70 2061 6e79 206d 6f72  imestamp any mor
-00010770: 652e 2054 686f 7365 2061 7265 2072 656d  e. Those are rem
-00010780: 6f76 6564 2068 6572 652e 2022 2222 200a  oved here. """ .
-00010790: 2020 2020 2020 2020 666f 7220 6974 656d          for item
-000107a0: 2069 6e20 7365 6c66 2e69 6664 6f5f 746d   in self.ifdo_tm
-000107b0: 705b 7365 6c66 2e69 6d61 6765 5365 7449  p[self.imageSetI
-000107c0: 7465 6d73 4b65 795d 3a0a 2020 2020 2020  temsKey]:.      
-000107d0: 2020 2020 2020 6966 206e 6f74 2069 7369        if not isi
-000107e0: 6e73 7461 6e63 6528 7365 6c66 2e69 6664  nstance(self.ifd
-000107f0: 6f5f 746d 705b 7365 6c66 2e69 6d61 6765  o_tmp[self.image
-00010800: 5365 7449 7465 6d73 4b65 795d 5b69 7465  SetItemsKey][ite
-00010810: 6d5d 2c6c 6973 7429 3a0a 2020 2020 2020  m],list):.      
-00010820: 2020 2020 2020 2020 2020 7365 6c66 2e69            self.i
-00010830: 6664 6f5f 746d 705b 7365 6c66 2e69 6d61  fdo_tmp[self.ima
-00010840: 6765 5365 7449 7465 6d73 4b65 795d 5b69  geSetItemsKey][i
-00010850: 7465 6d5d 203d 205b 7365 6c66 2e69 6664  tem] = [self.ifd
-00010860: 6f5f 746d 705b 7365 6c66 2e69 6d61 6765  o_tmp[self.image
-00010870: 5365 7449 7465 6d73 4b65 795d 5b69 7465  SetItemsKey][ite
-00010880: 6d5d 5d0a 2020 2020 2020 2020 2020 2020  m]].            
-00010890: 746f 4265 5265 6d6f 7665 6420 3d20 5b5d  toBeRemoved = []
-000108a0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-000108b0: 2065 6e74 7279 2069 6e20 7365 6c66 2e69   entry in self.i
-000108c0: 6664 6f5f 746d 705b 7365 6c66 2e69 6d61  fdo_tmp[self.ima
-000108d0: 6765 5365 7449 7465 6d73 4b65 795d 5b69  geSetItemsKey][i
-000108e0: 7465 6d5d 3a0a 2020 2020 2020 2020 2020  tem]:.          
-000108f0: 2020 2020 2020 2370 7269 6e74 2865 6e74        #print(ent
-00010900: 7279 290a 2020 2020 2020 2020 2020 2020  ry).            
-00010910: 2020 2020 6966 206c 656e 2865 6e74 7279      if len(entry
-00010920: 2920 3d3d 2031 2061 6e64 2027 696d 6167  ) == 1 and 'imag
-00010930: 652d 6461 7465 7469 6d65 2720 696e 2065  e-datetime' in e
-00010940: 6e74 7279 3a0a 2020 2020 2020 2020 2020  ntry:.          
-00010950: 2020 2020 2020 2020 2020 746f 4265 5265            toBeRe
-00010960: 6d6f 7665 642e 6170 7065 6e64 2865 6e74  moved.append(ent
-00010970: 7279 290a 2020 2020 2020 2020 2020 2020  ry).            
-00010980: 666f 7220 656e 7472 7920 696e 2074 6f42  for entry in toB
-00010990: 6552 656d 6f76 6564 3a0a 2020 2020 2020  eRemoved:.      
-000109a0: 2020 2020 2020 2020 2020 7365 6c66 2e69            self.i
-000109b0: 6664 6f5f 746d 705b 7365 6c66 2e69 6d61  fdo_tmp[self.ima
-000109c0: 6765 5365 7449 7465 6d73 4b65 795d 5b69  geSetItemsKey][i
-000109d0: 7465 6d5d 2e72 656d 6f76 6528 656e 7472  tem].remove(entr
-000109e0: 7929 200a 0a0a 2020 2020 6465 6620 6368  y) ...    def ch
-000109f0: 6563 6b41 6c6c 4974 656d 4861 7368 6573  eckAllItemHashes
-00010a00: 2873 656c 662c 2068 6172 643d 4661 6c73  (self, hard=Fals
-00010a10: 652c 2072 6169 7365 4578 6365 7074 696f  e, raiseExceptio
-00010a20: 6e20 3d20 5472 7565 293a 0a20 2020 2020  n = True):.     
-00010a30: 2020 2022 2222 200a 2020 2020 2020 2020     """ .        
-00010a40: 4368 6563 6b73 2069 6620 6861 7368 6573  Checks if hashes
-00010a50: 2069 6e20 6946 444f 206d 6174 6368 2068   in iFDO match h
-00010a60: 6173 6865 7320 696e 2069 6e74 6572 6d65  ashes in interme
-00010a70: 6964 6174 6520 6861 7368 2066 696c 6520  idate hash file 
-00010a80: 6966 2074 6865 206c 6174 7465 7220 7761  if the latter wa
-00010a90: 7320 6368 616e 6765 6420 6c61 7374 2061  s changed last a
-00010aa0: 6674 6572 2074 6865 2069 6d61 6765 7320  fter the images 
-00010ab0: 6861 7320 6368 616e 6765 642e 0a20 2020  has changed..   
-00010ac0: 2020 2020 204f 7468 6572 7769 7365 206f       Otherwise o
-00010ad0: 7220 6966 2068 6172 643d 3d54 7275 6520  r if hard==True 
-00010ae0: 6974 2072 6564 6574 6572 6d69 6e65 7320  it redetermines 
-00010af0: 7468 6520 6163 7475 616c 6c20 6669 6c65  the actuall file
-00010b00: 2773 2068 6173 6820 616e 6420 636f 6d70  's hash and comp
-00010b10: 6172 6573 2074 6865 2069 4644 4f20 6974  ares the iFDO it
-00010b20: 656d 2773 2068 6173 6820 7769 7468 2074  em's hash with t
-00010b30: 6861 742e 0a20 2020 2020 2020 2049 6620  hat..        If 
-00010b40: 6861 7368 6573 2064 6f20 6e6f 7420 6d61  hashes do not ma
-00010b50: 7463 6820 6120 6d61 7269 7174 2e63 6f72  tch a mariqt.cor
-00010b60: 652e 4966 646f 4578 6365 7074 696f 6e20  e.IfdoException 
-00010b70: 6973 2072 6973 656e 2075 6e73 6c65 7373  is risen unsless
-00010b80: 2072 6169 7365 4578 6365 7074 696f 6e20   raiseException 
-00010b90: 3d3d 2046 616c 7365 2c20 7468 656e 2061  == False, then a
-00010ba0: 206c 6973 7420 6f66 206c 6973 7473 205b   list of lists [
-00010bb0: 3c66 696c 653e 2c3c 6578 6365 7074 696f  <file>,<exceptio
-00010bc0: 6e3e 5d20 6973 2072 6574 7572 6e65 642e  n>] is returned.
-00010bd0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00010be0: 2020 2020 2068 6173 6865 7320 3d20 7b7d       hashes = {}
-00010bf0: 0a20 2020 2020 2020 2068 6173 6846 696c  .        hashFil
-00010c00: 654d 6f64 5469 6d65 203d 2031 3065 2b31  eModTime = 10e+1
-00010c10: 3030 0a20 2020 2020 2020 2069 6620 6f73  00.        if os
-00010c20: 2e70 6174 682e 6578 6973 7473 2873 656c  .path.exists(sel
-00010c30: 662e 6765 745f 696e 745f 6861 7368 5f66  f.get_int_hash_f
-00010c40: 696c 6528 2929 3a0a 2020 2020 2020 2020  ile()):.        
-00010c50: 2020 2020 6861 7368 6573 203d 206d 6971      hashes = miq
-00010c60: 7466 2e74 6162 4669 6c65 4461 7461 2873  tf.tabFileData(s
-00010c70: 656c 662e 6765 745f 696e 745f 6861 7368  elf.get_int_hash
-00010c80: 5f66 696c 6528 292c 205b 6d69 7174 762e  _file(), [miqtv.
-00010c90: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
-00010ca0: 7174 275d 5b27 696d 6727 5d2c 206d 6971  qt']['img'], miq
-00010cb0: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
-00010cc0: 6172 6971 7427 5d5b 2768 6173 6827 5d5d  ariqt']['hash']]
-00010cd0: 2c20 6b65 795f 636f 6c3d 6d69 7174 762e  , key_col=miqtv.
-00010ce0: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
-00010cf0: 7174 275d 5b27 696d 6727 5d29 0a20 2020  qt']['img']).   
-00010d00: 2020 2020 2020 2020 2068 6173 6846 696c           hashFil
-00010d10: 654d 6f64 5469 6d65 203d 206f 732e 7061  eModTime = os.pa
-00010d20: 7468 2e67 6574 6d74 696d 6528 7365 6c66  th.getmtime(self
-00010d30: 2e67 6574 5f69 6e74 5f68 6173 685f 6669  .get_int_hash_fi
-00010d40: 6c65 2829 290a 0a20 2020 2020 2020 2065  le())..        e
-00010d50: 7863 6570 7469 6f6e 4c69 7374 203d 205b  xceptionList = [
-00010d60: 5d0a 0a20 2020 2020 2020 2068 6173 6855  ]..        hashU
-00010d70: 6e63 6865 636b 496d 6167 6573 496e 5261  ncheckImagesInRa
-00010d80: 7720 3d20 7365 6c66 2e69 6d61 6765 7349  w = self.imagesI
-00010d90: 6e49 6d61 6765 7344 6972 2829 0a20 2020  nImagesDir().   
-00010da0: 2020 2020 2070 726f 6720 3d20 6d69 7174       prog = miqt
-00010db0: 632e 5072 696e 744b 6e6f 776e 5072 6f67  c.PrintKnownProg
-00010dc0: 7265 7373 4d73 6728 2243 6865 636b 696e  ressMsg("Checkin
-00010dd0: 6720 6974 656d 2068 6173 6865 7322 2c20  g item hashes", 
-00010de0: 6c65 6e28 7365 6c66 2e69 6664 6f5f 746d  len(self.ifdo_tm
-00010df0: 705b 7365 6c66 2e69 6d61 6765 5365 7449  p[self.imageSetI
-00010e00: 7465 6d73 4b65 795d 2929 0a20 2020 2020  temsKey])).     
-00010e10: 2020 2066 6f72 2069 7465 6d20 696e 2073     for item in s
-00010e20: 656c 662e 6966 646f 5f74 6d70 5b73 656c  elf.ifdo_tmp[sel
-00010e30: 662e 696d 6167 6553 6574 4974 656d 734b  f.imageSetItemsK
-00010e40: 6579 5d3a 0a20 2020 2020 2020 2020 2020  ey]:.           
-00010e50: 2070 726f 672e 7072 6f67 7265 7373 2829   prog.progress()
-00010e60: 0a0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
-00010e70: 756e 6420 3d20 4661 6c73 650a 2020 2020  und = False.    
-00010e80: 2020 2020 2020 2020 666f 7220 696d 6167          for imag
-00010e90: 6520 696e 2068 6173 6855 6e63 6865 636b  e in hashUncheck
-00010ea0: 496d 6167 6573 496e 5261 773a 0a20 2020  ImagesInRaw:.   
-00010eb0: 2020 2020 2020 2020 2020 2020 2066 696c               fil
-00010ec0: 654e 616d 6520 3d20 6f73 2e70 6174 682e  eName = os.path.
-00010ed0: 6261 7365 6e61 6d65 2869 6d61 6765 290a  basename(image).
-00010ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010ef0: 6966 2066 696c 654e 616d 6520 3d3d 2069  if fileName == i
-00010f00: 7465 6d3a 0a20 2020 2020 2020 2020 2020  tem:.           
-00010f10: 2020 2020 2020 2020 2066 6f75 6e64 203d           found =
-00010f20: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
-00010f30: 2020 2020 2020 2020 2020 6966 2069 7369            if isi
-00010f40: 6e73 7461 6e63 6528 7365 6c66 2e69 6664  nstance(self.ifd
-00010f50: 6f5f 746d 705b 7365 6c66 2e69 6d61 6765  o_tmp[self.image
-00010f60: 5365 7449 7465 6d73 4b65 795d 5b69 7465  SetItemsKey][ite
-00010f70: 6d5d 2c6c 6973 7429 3a20 2320 696e 2063  m],list): # in c
-00010f80: 6173 6520 6f66 2076 6964 656f 2077 6974  ase of video wit
-00010f90: 6820 6974 656d 2061 7320 6c69 7374 2074  h item as list t
-00010fa0: 6865 2066 6972 7374 2065 6e74 7279 2068  he first entry h
-00010fb0: 6f6c 6473 2074 6865 2064 6566 6175 6c74  olds the default
-00010fc0: 2061 6e64 2074 6865 2068 6173 6820 6361   and the hash ca
-00010fd0: 6e6e 6f74 2076 6172 7920 666f 7220 7468  nnot vary for th
-00010fe0: 6520 7361 6d65 2069 6d61 6765 0a20 2020  e same image.   
-00010ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011000: 2020 2020 2069 7465 6d45 6e74 7279 203d       itemEntry =
-00011010: 2073 656c 662e 6966 646f 5f74 6d70 5b73   self.ifdo_tmp[s
-00011020: 656c 662e 696d 6167 6553 6574 4974 656d  elf.imageSetItem
-00011030: 734b 6579 5d5b 6974 656d 5d5b 305d 200a  sKey][item][0] .
-00011040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011050: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00011060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011070: 2020 6974 656d 456e 7472 7920 3d20 7365    itemEntry = se
-00011080: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
-00011090: 2e69 6d61 6765 5365 7449 7465 6d73 4b65  .imageSetItemsKe
-000110a0: 795d 5b69 7465 6d5d 0a0a 2020 2020 2020  y][item]..      
-000110b0: 2020 2020 2020 2020 2020 2020 2020 696d                im
-000110c0: 6167 654d 6f64 5469 6d65 203d 206f 732e  ageModTime = os.
-000110d0: 7061 7468 2e67 6574 6d74 696d 6528 696d  path.getmtime(im
-000110e0: 6167 6529 0a20 2020 2020 2020 2020 2020  age).           
-000110f0: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-00011100: 6861 7264 2061 6e64 2069 6d61 6765 4d6f  hard and imageMo
-00011110: 6454 696d 6520 3c20 6861 7368 4669 6c65  dTime < hashFile
-00011120: 4d6f 6454 696d 653a 0a20 2020 2020 2020  ModTime:.       
-00011130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011140: 2069 6620 6e6f 7420 6f73 2e70 6174 682e   if not os.path.
-00011150: 6261 7365 6e61 6d65 2869 6d61 6765 2920  basename(image) 
-00011160: 696e 2068 6173 6865 733a 0a20 2020 2020  in hashes:.     
-00011170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011180: 2020 2020 2020 2069 6620 7261 6973 6545         if raiseE
-00011190: 7863 6570 7469 6f6e 3a0a 2020 2020 2020  xception:.      
-000111a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000111b0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-000111c0: 6d69 7174 632e 4966 646f 4578 6365 7074  miqtc.IfdoExcept
-000111d0: 696f 6e28 6974 656d 2c20 226e 6f74 2066  ion(item, "not f
-000111e0: 6f75 6e64 2069 6e20 696e 7465 726d 6569  ound in intermei
-000111f0: 6461 7465 2068 6173 6820 6669 6c65 222c  date hash file",
-00011200: 7365 6c66 2e67 6574 5f69 6e74 5f68 6173  self.get_int_has
-00011210: 685f 6669 6c65 2829 2c22 2072 756e 2063  h_file()," run c
-00011220: 7265 6174 655f 696d 6167 655f 7368 6132  reate_image_sha2
-00011230: 3536 5f66 696c 6528 2920 6669 7273 7422  56_file() first"
-00011240: 2920 0a20 2020 2020 2020 2020 2020 2020  ) .             
-00011250: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00011260: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00011270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011280: 2020 2020 2065 7863 6570 7469 6f6e 4c69       exceptionLi
-00011290: 7374 2e61 7070 656e 6428 5b66 696c 654e  st.append([fileN
-000112a0: 616d 652c 226e 6f74 2066 6f75 6e64 2069  ame,"not found i
-000112b0: 6e20 696e 7465 726d 6569 6461 7465 2068  n intermeidate h
-000112c0: 6173 6820 6669 6c65 2022 202b 2073 7472  ash file " + str
-000112d0: 2873 656c 662e 6765 745f 696e 745f 6861  (self.get_int_ha
-000112e0: 7368 5f66 696c 6528 2929 5d29 0a20 2020  sh_file())]).   
-000112f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011300: 2020 2020 2069 6620 6e6f 7420 6974 656d       if not item
-00011310: 456e 7472 795b 2769 6d61 6765 2d68 6173  Entry['image-has
-00011320: 682d 7368 6132 3536 275d 203d 3d20 6861  h-sha256'] == ha
-00011330: 7368 6573 5b6f 732e 7061 7468 2e62 6173  shes[os.path.bas
-00011340: 656e 616d 6528 696d 6167 6529 5d5b 2769  ename(image)]['i
-00011350: 6d61 6765 2d68 6173 682d 7368 6132 3536  mage-hash-sha256
-00011360: 275d 3a0a 2020 2020 2020 2020 2020 2020  ']:.            
-00011370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011380: 6966 2072 6169 7365 4578 6365 7074 696f  if raiseExceptio
-00011390: 6e3a 0a20 2020 2020 2020 2020 2020 2020  n:.             
-000113a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000113b0: 2020 2072 6169 7365 206d 6971 7463 2e49     raise miqtc.I
-000113c0: 6664 6f45 7863 6570 7469 6f6e 2869 7465  fdoException(ite
-000113d0: 6d2c 2022 696e 636f 7272 6563 7420 7368  m, "incorrect sh
-000113e0: 6132 3536 2068 6173 6822 2c20 6974 656d  a256 hash", item
-000113f0: 456e 7472 795b 2769 6d61 6765 2d68 6173  Entry['image-has
-00011400: 682d 7368 6132 3536 275d 2c22 666f 7220  h-sha256'],"for 
-00011410: 6669 6c65 222c 6669 6c65 4e61 6d65 2c22  file",fileName,"
-00011420: 2072 756e 2063 7265 6174 655f 696d 6167   run create_imag
-00011430: 655f 7368 6132 3536 5f66 696c 6528 2920  e_sha256_file() 
-00011440: 6669 7273 7422 290a 2020 2020 2020 2020  first").        
-00011450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011460: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00011470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011480: 2020 2020 2020 2020 2020 6578 6365 7074            except
-00011490: 696f 6e4c 6973 742e 6170 7065 6e64 285b  ionList.append([
-000114a0: 6669 6c65 4e61 6d65 2c22 696e 636f 7272  fileName,"incorr
-000114b0: 6563 7420 7368 6132 3536 2068 6173 6822  ect sha256 hash"
-000114c0: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
-000114d0: 2020 2020 2020 2065 6c69 6620 6e6f 7420         elif not 
-000114e0: 6974 656d 456e 7472 795b 2769 6d61 6765  itemEntry['image
-000114f0: 2d68 6173 682d 7368 6132 3536 275d 203d  -hash-sha256'] =
-00011500: 3d20 6d69 7174 632e 7368 6132 3536 4861  = miqtc.sha256Ha
-00011510: 7368 4669 6c65 2869 6d61 6765 293a 0a20  shFile(image):. 
-00011520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011530: 2020 2020 2020 2069 6620 7261 6973 6545         if raiseE
-00011540: 7863 6570 7469 6f6e 3a0a 2020 2020 2020  xception:.      
-00011550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011560: 2020 2020 2020 7261 6973 6520 6d69 7174        raise miqt
-00011570: 632e 4966 646f 4578 6365 7074 696f 6e28  c.IfdoException(
-00011580: 6974 656d 2c20 2269 6e63 6f72 7265 6374  item, "incorrect
-00011590: 2073 6861 3235 3620 6861 7368 222c 2069   sha256 hash", i
-000115a0: 7465 6d45 6e74 7279 5b27 696d 6167 652d  temEntry['image-
-000115b0: 6861 7368 2d73 6861 3235 3627 5d2c 2266  hash-sha256'],"f
-000115c0: 6f72 2066 696c 6522 2c66 696c 654e 616d  or file",fileNam
-000115d0: 652c 2220 7275 6e20 6372 6561 7465 5f69  e," run create_i
-000115e0: 6d61 6765 5f73 6861 3235 365f 6669 6c65  mage_sha256_file
-000115f0: 2829 2066 6972 7374 2229 0a20 2020 2020  () first").     
-00011600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011610: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0000f0d0: 2020 2020 7375 6249 7465 6d44 6963 7420      subItemDict 
+0000f0e0: 3d20 7b7d 0a20 2020 2020 2020 2020 2020  = {}.           
+0000f0f0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0000f100: 2069 7420 696e 2073 7562 4974 656d 3a0a   it in subItem:.
+0000f110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f120: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+0000f130: 7420 213d 2027 696d 6167 652d 6669 6c65  t != 'image-file
+0000f140: 6e61 6d65 273a 0a20 2020 2020 2020 2020  name':.         
+0000f150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f160: 2020 2020 2020 2073 7562 4974 656d 4469         subItemDi
+0000f170: 6374 5b69 745d 203d 2073 7562 4974 656d  ct[it] = subItem
+0000f180: 5b69 745d 0a20 2020 2020 2020 2020 2020  [it].           
+0000f190: 2020 2020 2020 2020 2020 2020 2069 6d61               ima
+0000f1a0: 6765 5f73 6574 5f69 7465 6d73 5b73 7562  ge_set_items[sub
+0000f1b0: 4974 656d 4465 6661 756c 745b 2769 6d61  ItemDefault['ima
+0000f1c0: 6765 2d66 696c 656e 616d 6527 5d5d 2e61  ge-filename']].a
+0000f1d0: 7070 656e 6428 7375 6249 7465 6d44 6963  ppend(subItemDic
+0000f1e0: 7429 0a20 2020 2020 2020 2020 2020 2020  t).             
+0000f1f0: 2020 200a 2020 2020 2020 2020 2020 2020     .            
+0000f200: 2020 2020 6578 6365 7074 206d 6971 7463      except miqtc
+0000f210: 2e49 6664 6f45 7863 6570 7469 6f6e 2061  .IfdoException a
+0000f220: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
+0000f230: 2020 2020 2020 2020 2069 6e76 616c 6964           invalid
+0000f240: 5f69 7465 6d73 202b 3d20 310a 2020 2020  _items += 1.    
+0000f250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f260: 7365 6c66 2e70 726f 762e 6c6f 6728 2249  self.prov.log("I
+0000f270: 6e76 616c 6964 2069 6d61 6765 2069 7465  nvalid image ite
+0000f280: 6d3a 2022 2b20 7374 7228 6974 656d 292c  m: "+ str(item),
+0000f290: 646f 6e74 5368 6f77 3d54 7275 6529 0a20  dontShow=True). 
+0000f2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f2b0: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
+0000f2c0: 2822 4578 6365 7074 696f 6e3a 5c6e 222b  ("Exception:\n"+
+0000f2d0: 2073 7472 2865 2e61 7267 7329 2c64 6f6e   str(e.args),don
+0000f2e0: 7453 686f 773d 5472 7565 290a 2020 2020  tShow=True).    
+0000f2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f300: 7261 6973 6520 6d69 7174 632e 4966 646f  raise miqtc.Ifdo
+0000f310: 4578 6365 7074 696f 6e28 2249 6e76 616c  Exception("Inval
+0000f320: 6964 2069 6d61 6765 2069 7465 6d20 222b  id image item "+
+0000f330: 2066 696c 655f 6e61 6d65 202b 2022 3a5c   file_name + ":\
+0000f340: 6e45 7863 6570 7469 6f6e 3a5c 6e22 2b20  nException:\n"+ 
+0000f350: 7374 7228 652e 6172 6773 2929 2023 206f  str(e.args)) # o
+0000f360: 7468 6572 7769 7365 2c20 696e 2063 6173  therwise, in cas
+0000f370: 6520 6f66 206d 616e 7920 696d 6167 6573  e of many images
+0000f380: 2c20 6974 206d 6179 206b 6565 7020 7275  , it may keep ru
+0000f390: 6e6e 696e 6720 616e 6420 7468 726f 7769  nning and throwi
+0000f3a0: 6e67 2065 7272 6f72 7320 666f 7220 7175  ng errors for qu
+0000f3b0: 6974 2073 6f6d 6520 7469 6d65 0a20 2020  it some time.   
+0000f3c0: 2020 2020 2020 2020 2070 726f 672e 636c           prog.cl
+0000f3d0: 6561 7228 290a 0a20 2020 2020 2020 2020  ear()..         
+0000f3e0: 2020 2069 6620 6c65 6e28 6974 656d 7329     if len(items)
+0000f3f0: 2021 3d20 3020 616e 6420 696e 7661 6c69   != 0 and invali
+0000f400: 645f 6974 656d 7320 3d3d 206c 656e 2869  d_items == len(i
+0000f410: 7465 6d73 293a 0a20 2020 2020 2020 2020  tems):.         
+0000f420: 2020 2020 2020 2072 6169 7365 2045 7863         raise Exc
+0000f430: 6570 7469 6f6e 2822 416c 6c20 6974 656d  eption("All item
+0000f440: 7320 6172 6520 696e 7661 6c69 6422 290a  s are invalid").
+0000f450: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+0000f460: 2069 6e76 616c 6964 5f69 7465 6d73 203e   invalid_items >
+0000f470: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+0000f480: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
+0000f490: 6728 2241 7420 6c65 6173 7420 2220 2b20  g("At least " + 
+0000f4a0: 7374 7228 696e 7661 6c69 645f 6974 656d  str(invalid_item
+0000f4b0: 7329 202b 2022 2069 7465 6d73 2077 6572  s) + " items wer
+0000f4c0: 6520 696e 7661 6c69 6420 286f 6622 202b  e invalid (of" +
+0000f4d0: 2073 7472 286c 656e 2869 7465 6d73 2929   str(len(items))
+0000f4e0: 2b20 2229 2229 0a0a 2020 2020 2020 2020  + ")")..        
+0000f4f0: 2320 5661 6c69 6461 7465 2068 6561 6465  # Validate heade
+0000f500: 7220 696e 666f 726d 6174 696f 6e0a 2020  r information.  
+0000f510: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+0000f520: 2020 2020 2020 206d 6971 7474 2e61 7265         miqtt.are
+0000f530: 5f76 616c 6964 5f69 6664 6f5f 6669 656c  _valid_ifdo_fiel
+0000f540: 6473 2873 656c 662e 6966 646f 5f74 6d70  ds(self.ifdo_tmp
+0000f550: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
+0000f560: 6164 6572 4b65 795d 290a 2020 2020 2020  aderKey]).      
+0000f570: 2020 6578 6365 7074 206d 6971 7463 2e49    except miqtc.I
+0000f580: 6664 6f45 7863 6570 7469 6f6e 2061 7320  fdoException as 
+0000f590: 6578 3a0a 2020 2020 2020 2020 2020 2020  ex:.            
+0000f5a0: 6d73 6720 3d20 2249 6e76 616c 6964 2068  msg = "Invalid h
+0000f5b0: 6561 6465 7220 6669 656c 643a 2022 202b  eader field: " +
+0000f5c0: 2073 7472 2865 7829 0a20 2020 2020 2020   str(ex).       
+0000f5d0: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
+0000f5e0: 6f67 2822 4578 6365 7074 696f 6e3a 2022  og("Exception: "
+0000f5f0: 202b 206d 7367 2c20 646f 6e74 5368 6f77   + msg, dontShow
+0000f600: 3d54 7275 6529 0a20 2020 2020 2020 2020  =True).         
+0000f610: 2020 2072 6169 7365 206d 6971 7463 2e49     raise miqtc.I
+0000f620: 6664 6f45 7863 6570 7469 6f6e 286d 7367  fdoException(msg
+0000f630: 290a 0a20 2020 2020 2020 2023 2070 7574  )..        # put
+0000f640: 2069 7465 6d20 696e 666f 2069 6e74 6f20   item info into 
+0000f650: 7365 6c66 2e69 6664 6f5f 746d 700a 2020  self.ifdo_tmp.  
+0000f660: 2020 2020 2020 7320 3d20 6d69 7174 632e        s = miqtc.
+0000f670: 5072 696e 744c 6f61 6469 6e67 4d73 6728  PrintLoadingMsg(
+0000f680: 2255 7064 6174 696e 6722 290a 2020 2020  "Updating").    
+0000f690: 2020 2020 6c6f 6720 3d20 6d69 7174 632e      log = miqtc.
+0000f6a0: 7265 6375 7273 6976 656c 7955 7064 6174  recursivelyUpdat
+0000f6b0: 6544 6963 7473 2873 656c 662e 6966 646f  eDicts(self.ifdo
+0000f6c0: 5f74 6d70 5b73 656c 662e 696d 6167 6553  _tmp[self.imageS
+0000f6d0: 6574 4974 656d 734b 6579 5d2c 2069 6d61  etItemsKey], ima
+0000f6e0: 6765 5f73 6574 5f69 7465 6d73 290a 2020  ge_set_items).  
+0000f6f0: 2020 2020 2020 732e 7374 6f70 2829 0a20        s.stop(). 
+0000f700: 2020 2020 2020 2073 656c 662e 7072 6f76         self.prov
+0000f710: 2e6c 6f67 286c 6f67 290a 0a20 2020 2020  .log(log)..     
+0000f720: 2020 2023 2073 6574 206c 6174 206c 6f6e     # set lat lon
+0000f730: 2062 6f75 6e64 696e 6720 626f 780a 2020   bounding box.  
+0000f740: 2020 2020 2020 7365 6c66 2e5f 7365 745f        self._set_
+0000f750: 6c61 745f 6c6f 6e5f 626f 756e 6469 6e67  lat_lon_bounding
+0000f760: 5f62 6f78 2873 656c 662e 6966 646f 5f74  _box(self.ifdo_t
+0000f770: 6d70 290a 0a20 2020 2020 2020 2023 2073  mp)..        # s
+0000f780: 6574 2072 6570 7265 7365 6e74 6174 6976  et representativ
+0000f790: 6520 6865 6164 6572 2066 6965 6c64 7320  e header fields 
+0000f7a0: 6461 7465 7469 6d65 2c20 6c61 742c 206c  datetime, lat, l
+0000f7b0: 6f6e 2c20 616c 740a 2020 2020 2020 2020  on, alt.        
+0000f7c0: 7365 6c66 2e5f 7365 745f 7265 705f 6865  self._set_rep_he
+0000f7d0: 6164 6572 5f66 6965 6c64 735f 6474 5f6c  ader_fields_dt_l
+0000f7e0: 6174 5f6c 6f6e 5f61 6c74 2873 656c 662e  at_lon_alt(self.
+0000f7f0: 6966 646f 5f74 6d70 290a 0a20 2020 2020  ifdo_tmp)..     
+0000f800: 2020 2073 656c 662e 5f73 6574 5f69 6d61     self._set_ima
+0000f810: 6765 5f69 7465 6d5f 6964 656e 7469 6669  ge_item_identifi
+0000f820: 6361 7469 6f6e 5f73 6368 656d 6528 7365  cation_scheme(se
+0000f830: 6c66 2e69 6664 6f5f 746d 7029 0a0a 2020  lf.ifdo_tmp)..  
+0000f840: 2020 2020 2020 2320 7265 6d6f 7665 2065        # remove e
+0000f850: 6d74 7079 2066 6965 6c64 730a 2020 2020  mtpy fields.    
+0000f860: 2020 2020 7320 3d20 6d69 7174 632e 5072      s = miqtc.Pr
+0000f870: 696e 744c 6f61 6469 6e67 4d73 6728 2252  intLoadingMsg("R
+0000f880: 656d 6f76 696e 6720 656d 7074 7920 6669  emoving empty fi
+0000f890: 656c 6473 2229 0a20 2020 2020 2020 2073  elds").        s
+0000f8a0: 656c 662e 6966 646f 5f74 6d70 203d 206d  elf.ifdo_tmp = m
+0000f8b0: 6971 7463 2e72 6563 7572 7369 7665 6c79  iqtc.recursively
+0000f8c0: 5265 6d6f 7665 456d 7074 7946 6965 6c64  RemoveEmptyField
+0000f8d0: 7328 7365 6c66 2e69 6664 6f5f 746d 7029  s(self.ifdo_tmp)
+0000f8e0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+0000f8f0: 7365 6c66 2e69 6d61 6765 5365 7449 7465  self.imageSetIte
+0000f900: 6d73 4b65 7920 696e 2073 656c 662e 6966  msKey in self.if
+0000f910: 646f 5f74 6d70 3a0a 2020 2020 2020 2020  do_tmp:.        
+0000f920: 2020 2020 7365 6c66 2e69 6664 6f5f 746d      self.ifdo_tm
+0000f930: 705b 7365 6c66 2e69 6d61 6765 5365 7449  p[self.imageSetI
+0000f940: 7465 6d73 4b65 795d 203d 205b 5d0a 2020  temsKey] = [].  
+0000f950: 2020 2020 2020 2320 7265 6d6f 7665 2066        # remove f
+0000f960: 6965 6c64 7320 7468 6174 2063 6f6e 7461  ields that conta
+0000f970: 696e 2027 696d 6167 652d 6461 7465 7469  in 'image-dateti
+0000f980: 6d65 2720 6f6e 6c79 0a20 2020 2020 2020  me' only.       
+0000f990: 2073 656c 662e 7265 6d6f 7665 4974 656d   self.removeItem
+0000f9a0: 4669 656c 6473 5769 7468 4f6e 6c79 4461  FieldsWithOnlyDa
+0000f9b0: 7465 5469 6d65 2829 0a20 2020 2020 2020  teTime().       
+0000f9c0: 2073 2e73 746f 7028 290a 0a20 2020 2020   s.stop()..     
+0000f9d0: 2020 2069 6620 6e6f 7420 7365 6c66 2e69     if not self.i
+0000f9e0: 676e 6f72 655f 696d 6167 655f 6669 6c65  gnore_image_file
+0000f9f0: 733a 0a20 2020 2020 2020 2020 2020 2073  s:.            s
+0000fa00: 656c 662e 6368 6563 6b41 6c6c 4974 656d  elf.checkAllItem
+0000fa10: 4861 7368 6573 2829 0a0a 2020 2020 2020  Hashes()..      
+0000fa20: 2020 2320 6368 6563 6b20 6167 6169 6e73    # check agains
+0000fa30: 7420 7363 6865 6d61 0a20 2020 2020 2020  t schema.       
+0000fa40: 2076 616c 6964 2c20 6d73 6720 3d20 6d69   valid, msg = mi
+0000fa50: 7174 742e 7661 6c69 6461 7465 5f69 6664  qtt.validate_ifd
+0000fa60: 6f28 7365 6c66 2e69 6664 6f5f 746d 7029  o(self.ifdo_tmp)
+0000fa70: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+0000fa80: 7661 6c69 6420 616e 6420 6e6f 7420 616c  valid and not al
+0000fa90: 6c6f 775f 6d69 7373 696e 675f 7265 7175  low_missing_requ
+0000faa0: 6972 6564 3a0a 2020 2020 2020 2020 2020  ired:.          
+0000fab0: 2020 7365 6c66 2e70 726f 762e 6c6f 6728    self.prov.log(
+0000fac0: 2257 6172 6e69 6e67 2120 6946 444f 206e  "Warning! iFDO n
+0000fad0: 6f20 7661 6c69 6420 7965 743a 2022 202b  o valid yet: " +
+0000fae0: 206d 7367 290a 2020 2020 2020 2020 2020   msg).          
+0000faf0: 2020 7261 6973 6520 6d69 7174 632e 4966    raise miqtc.If
+0000fb00: 646f 4578 6365 7074 696f 6e28 6d73 6729  doException(msg)
+0000fb10: 0a0a 2020 2020 2020 2020 2320 7365 7420  ..        # set 
+0000fb20: 6669 6e61 6c20 6f6e 650a 2020 2020 2020  final one.      
+0000fb30: 2020 7365 6c66 2e69 6664 6f5f 6368 6563    self.ifdo_chec
+0000fb40: 6b65 6420 3d20 636f 7079 2e64 6565 7063  ked = copy.deepc
+0000fb50: 6f70 7928 7365 6c66 2e69 6664 6f5f 746d  opy(self.ifdo_tm
+0000fb60: 7029 0a20 2020 2020 2020 2072 6574 7572  p).        retur
+0000fb70: 6e20 7365 6c66 2e69 6664 6f5f 6368 6563  n self.ifdo_chec
+0000fb80: 6b65 640a 0a0a 2020 2020 6465 6620 5f73  ked...    def _s
+0000fb90: 6574 5f69 6d61 6765 5f69 7465 6d5f 6964  et_image_item_id
+0000fba0: 656e 7469 6669 6361 7469 6f6e 5f73 6368  entification_sch
+0000fbb0: 656d 6528 7365 6c66 2c69 6664 6f3a 6469  eme(self,ifdo:di
+0000fbc0: 6374 293a 0a20 2020 2020 2020 2022 2222  ct):.        """
+0000fbd0: 2053 6574 2069 6d61 6765 2d69 7465 6d2d   Set image-item-
+0000fbe0: 6964 656e 7469 6669 6361 7469 6f6e 2d73  identification-s
+0000fbf0: 6368 656d 6520 746f 2060 696d 6167 652d  cheme to `image-
+0000fc00: 7072 6f6a 6563 745f 696d 6167 652d 6576  project_image-ev
+0000fc10: 656e 745f 696d 6167 652d 7365 6e73 6f72  ent_image-sensor
+0000fc20: 5f69 6d61 6765 2d64 6174 6574 696d 652e  _image-datetime.
+0000fc30: 6578 7460 2069 6620 656d 7074 792e 2022  ext` if empty. "
+0000fc40: 2222 0a20 2020 2020 2020 2069 6620 6669  "".        if fi
+0000fc50: 6e64 4669 656c 6428 6966 646f 5b73 656c  ndField(ifdo[sel
+0000fc60: 662e 696d 6167 6553 6574 4865 6164 6572  f.imageSetHeader
+0000fc70: 4b65 795d 2c27 696d 6167 652d 6974 656d  Key],'image-item
+0000fc80: 2d69 6465 6e74 6966 6963 6174 696f 6e2d  -identification-
+0000fc90: 7363 6865 6d65 2729 203d 3d20 2222 3a0a  scheme') == "":.
+0000fca0: 2020 2020 2020 2020 2020 2020 6966 646f              ifdo
+0000fcb0: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
+0000fcc0: 6164 6572 4b65 795d 5b27 696d 6167 652d  aderKey]['image-
+0000fcd0: 6974 656d 2d69 6465 6e74 6966 6963 6174  item-identificat
+0000fce0: 696f 6e2d 7363 6865 6d65 275d 203d 2020  ion-scheme'] =  
+0000fcf0: 2769 6d61 6765 2d70 726f 6a65 6374 5f69  'image-project_i
+0000fd00: 6d61 6765 2d65 7665 6e74 5f69 6d61 6765  mage-event_image
+0000fd10: 2d73 656e 736f 725f 696d 6167 652d 6461  -sensor_image-da
+0000fd20: 7465 7469 6d65 2e65 7874 270a 0a0a 2020  tetime.ext'...  
+0000fd30: 2020 6465 6620 5f73 6574 5f72 6570 5f68    def _set_rep_h
+0000fd40: 6561 6465 725f 6669 656c 6473 5f64 745f  eader_fields_dt_
+0000fd50: 6c61 745f 6c6f 6e5f 616c 7428 7365 6c66  lat_lon_alt(self
+0000fd60: 2c69 6664 6f3a 6469 6374 293a 0a20 2020  ,ifdo:dict):.   
+0000fd70: 2020 2020 2022 2222 2046 696c 6c20 6865       """ Fill he
+0000fd80: 6164 6572 2066 6965 6c64 7320 696d 6167  ader fields imag
+0000fd90: 652d 6461 7465 7469 6d65 2061 6e64 202d  e-datetime and -
+0000fda0: 6c61 7469 7475 6465 2c20 2d6c 6f6e 6769  latitude, -longi
+0000fdb0: 7475 6564 652c 202d 616c 7469 7475 6465  tuede, -altitude
+0000fdc0: 2d6d 6574 6572 732c 202d 636f 6f72 6469  -meters, -coordi
+0000fdd0: 6e61 7465 2d75 6e63 6572 7461 696e 7479  nate-uncertainty
+0000fde0: 2d6d 6574 6572 732c 2069 6620 656d 7074  -meters, if empt
+0000fdf0: 792c 0a20 2020 2020 2020 2072 6570 7265  y,.        repre
+0000fe00: 7365 6e74 6174 6976 656c 7920 7769 7468  sentatively with
+0000fe10: 2066 6972 7374 2069 7465 6d73 2065 6e74   first items ent
+0000fe20: 7279 2061 6e64 206d 6564 6961 6e20 6f66  ry and median of
+0000fe30: 2061 6c6c 2069 7465 6d73 2076 616c 7565   all items value
+0000fe40: 732c 2072 6573 7065 6374 6976 656c 792e  s, respectively.
+0000fe50: 2022 2222 0a0a 2020 2020 2020 2020 2320   """..        # 
+0000fe60: 2769 6d61 6765 2d64 6174 6574 696d 6527  'image-datetime'
+0000fe70: 0a20 2020 2020 2020 2066 6972 7374 5f69  .        first_i
+0000fe80: 6d61 6765 203d 2073 6f72 7465 6428 6966  mage = sorted(if
+0000fe90: 646f 5b73 656c 662e 696d 6167 6553 6574  do[self.imageSet
+0000fea0: 4974 656d 734b 6579 5d2e 6b65 7973 2829  ItemsKey].keys()
+0000feb0: 295b 305d 0a20 2020 2020 2020 2066 6965  )[0].        fie
+0000fec0: 6c64 203d 2027 696d 6167 652d 6461 7465  ld = 'image-date
+0000fed0: 7469 6d65 270a 2020 2020 2020 2020 6966  time'.        if
+0000fee0: 2066 696e 6446 6965 6c64 2869 6664 6f5b   findField(ifdo[
+0000fef0: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
+0000ff00: 6465 724b 6579 5d2c 6669 656c 6429 203d  derKey],field) =
+0000ff10: 3d20 2222 3a0a 2020 2020 2020 2020 2020  = "":.          
+0000ff20: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+0000ff30: 2020 2020 2020 2069 6664 6f5b 7365 6c66         ifdo[self
+0000ff40: 2e69 6d61 6765 5365 7448 6561 6465 724b  .imageSetHeaderK
+0000ff50: 6579 5d5b 6669 656c 645d 203d 2073 656c  ey][field] = sel
+0000ff60: 662e 5f5f 6765 7446 6965 6c64 5661 6c75  f.__getFieldValu
+0000ff70: 6528 6966 646f 2c5b 6669 7273 745f 696d  e(ifdo,[first_im
+0000ff80: 6167 652c 6669 656c 645d 2c64 6566 6175  age,field],defau
+0000ff90: 6c74 5f6f 6e6c 793d 5472 7565 290a 2020  lt_only=True).  
+0000ffa0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0000ffb0: 6c66 2e70 726f 762e 6c6f 6728 2253 6574  lf.prov.log("Set
+0000ffc0: 2072 6570 7265 7365 6e74 6174 6976 6520   representative 
+0000ffd0: 6865 6164 6572 2066 6965 6c64 2027 2220  header field '" 
+0000ffe0: 2b20 6669 656c 6420 2b20 2227 2074 6f20  + field + "' to 
+0000fff0: 2220 2b20 7374 7228 6966 646f 5b73 656c  " + str(ifdo[sel
+00010000: 662e 696d 6167 6553 6574 4865 6164 6572  f.imageSetHeader
+00010010: 4b65 795d 5b66 6965 6c64 5d29 202b 2022  Key][field]) + "
+00010020: 2066 726f 6d20 6669 7273 7420 696d 6167   from first imag
+00010030: 652e 2229 0a20 2020 2020 2020 2020 2020  e.").           
+00010040: 2065 7863 6570 7420 6d69 7174 632e 4966   except miqtc.If
+00010050: 646f 4578 6365 7074 696f 6e20 6173 2065  doException as e
+00010060: 783a 0a20 2020 2020 2020 2020 2020 2020  x:.             
+00010070: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
+00010080: 2822 436f 756c 6420 6e6f 7420 7365 7420  ("Could not set 
+00010090: 7265 7072 6573 656e 7461 7469 7665 2068  representative h
+000100a0: 6561 6465 7220 6669 656c 643a 2022 202b  eader field: " +
+000100b0: 2073 7472 2865 7829 290a 2020 2020 2020   str(ex)).      
+000100c0: 2020 2020 2020 2020 2020 7061 7373 0a0a            pass..
+000100d0: 2020 2020 2020 2020 2320 7265 7374 0a20          # rest. 
+000100e0: 2020 2020 2020 2072 6570 5f68 6561 6465         rep_heade
+000100f0: 725f 6669 656c 6473 5f6d 6564 6961 6e20  r_fields_median 
+00010100: 3d20 5b27 696d 6167 652d 6c61 7469 7475  = ['image-latitu
+00010110: 6465 272c 2769 6d61 6765 2d6c 6f6e 6769  de','image-longi
+00010120: 7475 6465 272c 2769 6d61 6765 2d61 6c74  tude','image-alt
+00010130: 6974 7564 652d 6d65 7465 7273 272c 2769  itude-meters','i
+00010140: 6d61 6765 2d63 6f6f 7264 696e 6174 652d  mage-coordinate-
+00010150: 756e 6365 7274 6169 6e74 792d 6d65 7465  uncertainty-mete
+00010160: 7273 275d 0a20 2020 2020 2020 2066 6f72  rs'].        for
+00010170: 2066 6965 6c64 2069 6e20 7265 705f 6865   field in rep_he
+00010180: 6164 6572 5f66 6965 6c64 735f 6d65 6469  ader_fields_medi
+00010190: 616e 3a0a 2020 2020 2020 2020 2020 2020  an:.            
+000101a0: 6966 2066 696e 6446 6965 6c64 2869 6664  if findField(ifd
+000101b0: 6f5b 7365 6c66 2e69 6d61 6765 5365 7448  o[self.imageSetH
+000101c0: 6561 6465 724b 6579 5d2c 6669 656c 6429  eaderKey],field)
+000101d0: 203d 3d20 2222 3a0a 2020 2020 2020 2020   == "":.        
+000101e0: 2020 2020 2020 2020 7661 6c75 6573 203d          values =
+000101f0: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
+00010200: 2020 2020 666f 7220 696d 6167 655f 6e61      for image_na
+00010210: 6d65 2069 6e20 6966 646f 5b73 656c 662e  me in ifdo[self.
+00010220: 696d 6167 6553 6574 4974 656d 734b 6579  imageSetItemsKey
+00010230: 5d2e 6b65 7973 2829 3a0a 2020 2020 2020  ].keys():.      
+00010240: 2020 2020 2020 2020 2020 2020 2020 7472                tr
+00010250: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
+00010260: 2020 2020 2020 2020 2020 2069 7465 6d5f             item_
+00010270: 7661 6c20 3d20 7365 6c66 2e5f 5f67 6574  val = self.__get
+00010280: 4669 656c 6456 616c 7565 2869 6664 6f2c  FieldValue(ifdo,
+00010290: 5b69 6d61 6765 5f6e 616d 652c 6669 656c  [image_name,fiel
+000102a0: 645d 290a 2020 2020 2020 2020 2020 2020  d]).            
+000102b0: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+000102c0: 7369 6e73 7461 6e63 6528 6974 656d 5f76  sinstance(item_v
+000102d0: 616c 2c64 6963 7429 3a0a 2020 2020 2020  al,dict):.      
+000102e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000102f0: 2020 2020 2020 7661 6c75 6573 202b 3d20        values += 
+00010300: 6c69 7374 2869 7465 6d5f 7661 6c2e 7661  list(item_val.va
+00010310: 6c75 6573 2829 290a 2020 2020 2020 2020  lues()).        
+00010320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010330: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00010340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010350: 2020 7661 6c75 6573 2e61 7070 656e 6428    values.append(
+00010360: 6974 656d 5f76 616c 290a 2020 2020 2020  item_val).      
+00010370: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+00010380: 6365 7074 206d 6971 7463 2e49 6664 6f45  cept miqtc.IfdoE
+00010390: 7863 6570 7469 6f6e 2061 7320 6578 3a0a  xception as ex:.
+000103a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000103b0: 2020 2020 2020 2020 7061 7373 0a20 2020          pass.   
+000103c0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000103d0: 6c65 6e28 7661 6c75 6573 2920 3d3d 2030  len(values) == 0
+000103e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000103f0: 2020 2020 2020 7365 6c66 2e70 726f 762e        self.prov.
+00010400: 6c6f 6728 2243 6f75 6c64 206e 6f74 2073  log("Could not s
+00010410: 6574 2072 6570 7265 7365 6e74 6174 6976  et representativ
+00010420: 6520 6865 6164 6572 2066 6965 6c64 2c20  e header field, 
+00010430: 6e6f 2076 616c 7565 7320 666f 756e 643a  no values found:
+00010440: 2022 202b 2066 6965 6c64 290a 2020 2020   " + field).    
+00010450: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00010460: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00010470: 2020 2020 2020 6966 646f 5b73 656c 662e        ifdo[self.
+00010480: 696d 6167 6553 6574 4865 6164 6572 4b65  imageSetHeaderKe
+00010490: 795d 5b66 6965 6c64 5d20 3d20 7374 6174  y][field] = stat
+000104a0: 6973 7469 6373 2e6d 6564 6961 6e28 7661  istics.median(va
+000104b0: 6c75 6573 290a 2020 2020 2020 2020 2020  lues).          
+000104c0: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+000104d0: 726f 762e 6c6f 6728 2253 6574 2072 6570  rov.log("Set rep
+000104e0: 7265 7365 6e74 6174 6976 6520 6865 6164  resentative head
+000104f0: 6572 2066 6965 6c64 2027 2220 2b20 6669  er field '" + fi
+00010500: 656c 6420 2b20 2227 2074 6f20 6d65 6469  eld + "' to medi
+00010510: 616e 3a20 2220 2b20 7374 7228 6966 646f  an: " + str(ifdo
+00010520: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
+00010530: 6164 6572 4b65 795d 5b66 6965 6c64 5d29  aderKey][field])
+00010540: 202b 2022 2e22 290a 0a0a 2020 2020 6465   + ".")...    de
+00010550: 6620 5f73 6574 5f6c 6174 5f6c 6f6e 5f62  f _set_lat_lon_b
+00010560: 6f75 6e64 696e 675f 626f 7828 7365 6c66  ounding_box(self
+00010570: 2c69 6664 6f3a 6469 6374 293a 0a20 2020  ,ifdo:dict):.   
+00010580: 2020 2020 2022 2222 2053 6574 2069 6d61       """ Set ima
+00010590: 6765 2d73 6574 2d5b 6d69 6e2c 6d61 785d  ge-set-[min,max]
+000105a0: 2d5b 6c61 7469 7475 6465 2c6c 6f6e 6769  -[latitude,longi
+000105b0: 7475 6465 5d2d 6465 6772 6565 7320 2222  tude]-degrees ""
+000105c0: 220a 2020 2020 2020 2020 6c61 745f 6d69  ".        lat_mi
+000105d0: 6e2c 206c 6174 5f6d 6178 2c20 6c6f 6e5f  n, lat_max, lon_
+000105e0: 6d69 6e2c 206c 6f6e 5f6d 6178 203d 2073  min, lon_max = s
+000105f0: 656c 662e 5f67 6574 5f6c 6174 5f6c 6f6e  elf._get_lat_lon
+00010600: 5f62 6f75 6e64 696e 675f 626f 7828 6966  _bounding_box(if
+00010610: 646f 5b73 656c 662e 696d 6167 6553 6574  do[self.imageSet
+00010620: 4974 656d 734b 6579 5d29 0a20 2020 2020  ItemsKey]).     
+00010630: 2020 2069 6620 6e6f 7420 4e6f 6e65 2069     if not None i
+00010640: 6e20 5b6c 6174 5f6d 696e 2c20 6c61 745f  n [lat_min, lat_
+00010650: 6d61 782c 206c 6f6e 5f6d 696e 2c20 6c6f  max, lon_min, lo
+00010660: 6e5f 6d61 785d 3a0a 2020 2020 2020 2020  n_max]:.        
+00010670: 2020 2020 6966 646f 5b73 656c 662e 696d      ifdo[self.im
+00010680: 6167 6553 6574 4865 6164 6572 4b65 795d  ageSetHeaderKey]
+00010690: 5b27 696d 6167 652d 7365 742d 6d69 6e2d  ['image-set-min-
+000106a0: 6c61 7469 7475 6465 2d64 6567 7265 6573  latitude-degrees
+000106b0: 275d 203d 206c 6174 5f6d 696e 0a20 2020  '] = lat_min.   
+000106c0: 2020 2020 2020 2020 2069 6664 6f5b 7365           ifdo[se
+000106d0: 6c66 2e69 6d61 6765 5365 7448 6561 6465  lf.imageSetHeade
+000106e0: 724b 6579 5d5b 2769 6d61 6765 2d73 6574  rKey]['image-set
+000106f0: 2d6d 6178 2d6c 6174 6974 7564 652d 6465  -max-latitude-de
+00010700: 6772 6565 7327 5d20 3d20 6c61 745f 6d61  grees'] = lat_ma
+00010710: 780a 2020 2020 2020 2020 2020 2020 6966  x.            if
+00010720: 646f 5b73 656c 662e 696d 6167 6553 6574  do[self.imageSet
+00010730: 4865 6164 6572 4b65 795d 5b27 696d 6167  HeaderKey]['imag
+00010740: 652d 7365 742d 6d69 6e2d 6c6f 6e67 6974  e-set-min-longit
+00010750: 7564 652d 6465 6772 6565 7327 5d20 3d20  ude-degrees'] = 
+00010760: 6c6f 6e5f 6d69 6e0a 2020 2020 2020 2020  lon_min.        
+00010770: 2020 2020 6966 646f 5b73 656c 662e 696d      ifdo[self.im
+00010780: 6167 6553 6574 4865 6164 6572 4b65 795d  ageSetHeaderKey]
+00010790: 5b27 696d 6167 652d 7365 742d 6d61 782d  ['image-set-max-
+000107a0: 6c6f 6e67 6974 7564 652d 6465 6772 6565  longitude-degree
+000107b0: 7327 5d20 3d20 6c6f 6e5f 6d61 780a 0a0a  s'] = lon_max...
+000107c0: 2020 2020 4073 7461 7469 636d 6574 686f      @staticmetho
+000107d0: 640a 2020 2020 6465 6620 5f67 6574 5f6c  d.    def _get_l
+000107e0: 6174 5f6c 6f6e 5f62 6f75 6e64 696e 675f  at_lon_bounding_
+000107f0: 626f 7828 6974 656d 733a 6469 6374 293a  box(items:dict):
+00010800: 0a20 2020 2020 2020 2022 2222 2052 6574  .        """ Ret
+00010810: 7572 6e73 206c 6174 5f6d 696e 2c20 6c61  urns lat_min, la
+00010820: 745f 6d61 782c 206c 6f6e 5f6d 696e 2c20  t_max, lon_min, 
+00010830: 6c6f 6e5f 6d61 7820 2222 220a 2020 2020  lon_max """.    
+00010840: 2020 2020 6c61 745f 6d69 6e2c 206c 6174      lat_min, lat
+00010850: 5f6d 6178 2c20 6c6f 6e5f 6d69 6e2c 206c  _max, lon_min, l
+00010860: 6f6e 5f6d 6178 203d 204e 6f6e 652c 204e  on_max = None, N
+00010870: 6f6e 652c 204e 6f6e 652c 204e 6f6e 650a  one, None, None.
+00010880: 2020 2020 2020 2020 6920 3d20 300a 2020          i = 0.  
+00010890: 2020 2020 2020 666f 7220 696d 6167 652c        for image,
+000108a0: 2064 6174 6120 696e 2069 7465 6d73 2e69   data in items.i
+000108b0: 7465 6d73 2829 3a0a 2020 2020 2020 2020  tems():.        
+000108c0: 2020 2020 2320 6d61 6b65 2069 6d61 6765      # make image
+000108d0: 2065 6e74 7279 206c 6973 7420 2861 6c73   entry list (als
+000108e0: 6f20 6966 2069 7473 2061 2070 6963 7475  o if its a pictu
+000108f0: 7265 290a 2020 2020 2020 2020 2020 2020  re).            
+00010900: 6966 206e 6f74 2069 7369 6e73 7461 6e63  if not isinstanc
+00010910: 6528 6461 7461 2c20 6c69 7374 293a 0a20  e(data, list):. 
+00010920: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00010930: 6174 6120 3d20 5b64 6174 615d 0a20 2020  ata = [data].   
+00010940: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+00010950: 2020 2020 2020 666f 7220 7469 6d65 706f        for timepo
+00010960: 696e 745f 6461 7461 2069 6e20 6461 7461  int_data in data
+00010970: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00010980: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+00010990: 2020 2020 2020 2020 2020 206c 6174 203d             lat =
+000109a0: 2074 696d 6570 6f69 6e74 5f64 6174 615b   timepoint_data[
+000109b0: 2769 6d61 6765 2d6c 6174 6974 7564 6527  'image-latitude'
+000109c0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+000109d0: 2020 2020 2020 6c6f 6e20 3d20 7469 6d65        lon = time
+000109e0: 706f 696e 745f 6461 7461 5b27 696d 6167  point_data['imag
+000109f0: 652d 6c6f 6e67 6974 7564 6527 5d0a 2020  e-longitude'].  
+00010a00: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+00010a10: 6365 7074 204b 6579 4572 726f 7220 6173  cept KeyError as
+00010a20: 2065 783a 0a20 2020 2020 2020 2020 2020   ex:.           
+00010a30: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
+00010a40: 650a 0a20 2020 2020 2020 2020 2020 2020  e..             
+00010a50: 2020 2069 6620 6920 3d3d 2030 3a0a 2020     if i == 0:.  
+00010a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010a70: 2020 6c61 745f 6d69 6e2c 206c 6174 5f6d    lat_min, lat_m
+00010a80: 6178 203d 206c 6174 2c20 6c61 740a 2020  ax = lat, lat.  
+00010a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010aa0: 2020 6c6f 6e5f 6d69 6e2c 206c 6f6e 5f6d    lon_min, lon_m
+00010ab0: 6178 203d 206c 6f6e 2c20 6c6f 6e0a 2020  ax = lon, lon.  
+00010ac0: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00010ad0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00010ae0: 2020 2020 2020 2020 6966 206c 6174 203c          if lat <
+00010af0: 206c 6174 5f6d 696e 3a0a 2020 2020 2020   lat_min:.      
+00010b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010b10: 2020 6c61 745f 6d69 6e20 3d20 6c61 740a    lat_min = lat.
+00010b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010b30: 2020 2020 6966 206c 6174 203e 206c 6174      if lat > lat
+00010b40: 5f6d 6178 3a0a 2020 2020 2020 2020 2020  _max:.          
+00010b50: 2020 2020 2020 2020 2020 2020 2020 6c61                la
+00010b60: 745f 6d61 7820 3d20 6c61 740a 2020 2020  t_max = lat.    
+00010b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010b80: 6966 206c 6f6e 203c 206c 6f6e 5f6d 696e  if lon < lon_min
+00010b90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00010ba0: 2020 2020 2020 2020 2020 6c6f 6e5f 6d69            lon_mi
+00010bb0: 6e20 3d20 6c6f 6e0a 2020 2020 2020 2020  n = lon.        
+00010bc0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+00010bd0: 6f6e 203e 206c 6f6e 5f6d 6178 3a0a 2020  on > lon_max:.  
+00010be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010bf0: 2020 2020 2020 6c6f 6e5f 6d61 7820 3d20        lon_max = 
+00010c00: 6c6f 6e0a 2020 2020 2020 2020 2020 2020  lon.            
+00010c10: 2020 2020 6920 2b3d 2031 0a20 2020 2020      i += 1.     
+00010c20: 2020 2072 6574 7572 6e20 6c61 745f 6d69     return lat_mi
+00010c30: 6e2c 206c 6174 5f6d 6178 2c20 6c6f 6e5f  n, lat_max, lon_
+00010c40: 6d69 6e2c 206c 6f6e 5f6d 6178 0a0a 0a20  min, lon_max... 
+00010c50: 2020 2064 6566 2072 656d 6f76 6549 7465     def removeIte
+00010c60: 6d46 6965 6c64 7357 6974 684f 6e6c 7944  mFieldsWithOnlyD
+00010c70: 6174 6554 696d 6528 7365 6c66 293a 0a20  ateTime(self):. 
+00010c80: 2020 2020 2020 2022 2222 2069 7420 6361         """ it ca
+00010c90: 6e20 6861 7070 656e 2074 6861 7420 616e  n happen that an
+00010ca0: 2069 6d61 6765 2074 696d 6573 7461 6d70   image timestamp
+00010cb0: 2064 6f65 7320 6e6f 7420 636f 6e74 6169   does not contai
+00010cc0: 6e20 616e 7920 6669 656c 6473 2062 7574  n any fields but
+00010cd0: 2074 6865 2074 696d 6573 7461 6d70 2061   the timestamp a
+00010ce0: 6e79 206d 6f72 652e 2054 686f 7365 2061  ny more. Those a
+00010cf0: 7265 2072 656d 6f76 6564 2068 6572 652e  re removed here.
+00010d00: 2022 2222 200a 2020 2020 2020 2020 666f   """ .        fo
+00010d10: 7220 6974 656d 2069 6e20 7365 6c66 2e69  r item in self.i
+00010d20: 6664 6f5f 746d 705b 7365 6c66 2e69 6d61  fdo_tmp[self.ima
+00010d30: 6765 5365 7449 7465 6d73 4b65 795d 3a0a  geSetItemsKey]:.
+00010d40: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+00010d50: 6f74 2069 7369 6e73 7461 6e63 6528 7365  ot isinstance(se
+00010d60: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
+00010d70: 2e69 6d61 6765 5365 7449 7465 6d73 4b65  .imageSetItemsKe
+00010d80: 795d 5b69 7465 6d5d 2c6c 6973 7429 3a0a  y][item],list):.
+00010d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010da0: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
+00010db0: 6c66 2e69 6d61 6765 5365 7449 7465 6d73  lf.imageSetItems
+00010dc0: 4b65 795d 5b69 7465 6d5d 203d 205b 7365  Key][item] = [se
+00010dd0: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
+00010de0: 2e69 6d61 6765 5365 7449 7465 6d73 4b65  .imageSetItemsKe
+00010df0: 795d 5b69 7465 6d5d 5d0a 2020 2020 2020  y][item]].      
+00010e00: 2020 2020 2020 746f 4265 5265 6d6f 7665        toBeRemove
+00010e10: 6420 3d20 5b5d 0a20 2020 2020 2020 2020  d = [].         
+00010e20: 2020 2066 6f72 2065 6e74 7279 2069 6e20     for entry in 
+00010e30: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
+00010e40: 6c66 2e69 6d61 6765 5365 7449 7465 6d73  lf.imageSetItems
+00010e50: 4b65 795d 5b69 7465 6d5d 3a0a 2020 2020  Key][item]:.    
+00010e60: 2020 2020 2020 2020 2020 2020 2370 7269              #pri
+00010e70: 6e74 2865 6e74 7279 290a 2020 2020 2020  nt(entry).      
+00010e80: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+00010e90: 2865 6e74 7279 2920 3d3d 2031 2061 6e64  (entry) == 1 and
+00010ea0: 2027 696d 6167 652d 6461 7465 7469 6d65   'image-datetime
+00010eb0: 2720 696e 2065 6e74 7279 3a0a 2020 2020  ' in entry:.    
+00010ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010ed0: 746f 4265 5265 6d6f 7665 642e 6170 7065  toBeRemoved.appe
+00010ee0: 6e64 2865 6e74 7279 290a 2020 2020 2020  nd(entry).      
+00010ef0: 2020 2020 2020 666f 7220 656e 7472 7920        for entry 
+00010f00: 696e 2074 6f42 6552 656d 6f76 6564 3a0a  in toBeRemoved:.
+00010f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010f20: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
+00010f30: 6c66 2e69 6d61 6765 5365 7449 7465 6d73  lf.imageSetItems
+00010f40: 4b65 795d 5b69 7465 6d5d 2e72 656d 6f76  Key][item].remov
+00010f50: 6528 656e 7472 7929 200a 0a0a 2020 2020  e(entry) ...    
+00010f60: 6465 6620 6368 6563 6b41 6c6c 4974 656d  def checkAllItem
+00010f70: 4861 7368 6573 2873 656c 662c 2068 6172  Hashes(self, har
+00010f80: 643d 4661 6c73 652c 2072 6169 7365 4578  d=False, raiseEx
+00010f90: 6365 7074 696f 6e20 3d20 5472 7565 293a  ception = True):
+00010fa0: 0a20 2020 2020 2020 2022 2222 200a 2020  .        """ .  
+00010fb0: 2020 2020 2020 4368 6563 6b73 2069 6620        Checks if 
+00010fc0: 6861 7368 6573 2069 6e20 6946 444f 206d  hashes in iFDO m
+00010fd0: 6174 6368 2068 6173 6865 7320 696e 2069  atch hashes in i
+00010fe0: 6e74 6572 6d65 6964 6174 6520 6861 7368  ntermeidate hash
+00010ff0: 2066 696c 6520 6966 2074 6865 206c 6174   file if the lat
+00011000: 7465 7220 7761 7320 6368 616e 6765 6420  ter was changed 
+00011010: 6c61 7374 2061 6674 6572 2074 6865 2069  last after the i
+00011020: 6d61 6765 7320 6861 7320 6368 616e 6765  mages has change
+00011030: 642e 0a20 2020 2020 2020 204f 7468 6572  d..        Other
+00011040: 7769 7365 206f 7220 6966 2068 6172 643d  wise or if hard=
+00011050: 3d54 7275 6520 6974 2072 6564 6574 6572  =True it redeter
+00011060: 6d69 6e65 7320 7468 6520 6163 7475 616c  mines the actual
+00011070: 6c20 6669 6c65 2773 2068 6173 6820 616e  l file's hash an
+00011080: 6420 636f 6d70 6172 6573 2074 6865 2069  d compares the i
+00011090: 4644 4f20 6974 656d 2773 2068 6173 6820  FDO item's hash 
+000110a0: 7769 7468 2074 6861 742e 0a20 2020 2020  with that..     
+000110b0: 2020 2049 6620 6861 7368 6573 2064 6f20     If hashes do 
+000110c0: 6e6f 7420 6d61 7463 6820 6120 6d61 7269  not match a mari
+000110d0: 7174 2e63 6f72 652e 4966 646f 4578 6365  qt.core.IfdoExce
+000110e0: 7074 696f 6e20 6973 2072 6973 656e 2075  ption is risen u
+000110f0: 6e73 6c65 7373 2072 6169 7365 4578 6365  nsless raiseExce
+00011100: 7074 696f 6e20 3d3d 2046 616c 7365 2c20  ption == False, 
+00011110: 7468 656e 2061 206c 6973 7420 6f66 206c  then a list of l
+00011120: 6973 7473 205b 3c66 696c 653e 2c3c 6578  ists [<file>,<ex
+00011130: 6365 7074 696f 6e3e 5d20 6973 2072 6574  ception>] is ret
+00011140: 7572 6e65 642e 0a20 2020 2020 2020 2022  urned..        "
+00011150: 2222 0a20 2020 2020 2020 2068 6173 6865  "".        hashe
+00011160: 7320 3d20 7b7d 0a20 2020 2020 2020 2068  s = {}.        h
+00011170: 6173 6846 696c 654d 6f64 5469 6d65 203d  ashFileModTime =
+00011180: 2031 3065 2b31 3030 0a20 2020 2020 2020   10e+100.       
+00011190: 2069 6620 6f73 2e70 6174 682e 6578 6973   if os.path.exis
+000111a0: 7473 2873 656c 662e 6765 745f 696e 745f  ts(self.get_int_
+000111b0: 6861 7368 5f66 696c 6528 2929 3a0a 2020  hash_file()):.  
+000111c0: 2020 2020 2020 2020 2020 6861 7368 6573            hashes
+000111d0: 203d 206d 6971 7466 2e74 6162 4669 6c65   = miqtf.tabFile
+000111e0: 4461 7461 2873 656c 662e 6765 745f 696e  Data(self.get_in
+000111f0: 745f 6861 7368 5f66 696c 6528 292c 205b  t_hash_file(), [
+00011200: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
+00011210: 5b27 6d61 7269 7174 275d 5b27 696d 6727  ['mariqt']['img'
+00011220: 5d2c 206d 6971 7476 2e63 6f6c 5f68 6561  ], miqtv.col_hea
+00011230: 6465 725b 276d 6172 6971 7427 5d5b 2768  der['mariqt']['h
+00011240: 6173 6827 5d5d 2c20 6b65 795f 636f 6c3d  ash']], key_col=
+00011250: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
+00011260: 5b27 6d61 7269 7174 275d 5b27 696d 6727  ['mariqt']['img'
+00011270: 5d29 0a20 2020 2020 2020 2020 2020 2068  ]).            h
+00011280: 6173 6846 696c 654d 6f64 5469 6d65 203d  ashFileModTime =
+00011290: 206f 732e 7061 7468 2e67 6574 6d74 696d   os.path.getmtim
+000112a0: 6528 7365 6c66 2e67 6574 5f69 6e74 5f68  e(self.get_int_h
+000112b0: 6173 685f 6669 6c65 2829 290a 0a20 2020  ash_file())..   
+000112c0: 2020 2020 2065 7863 6570 7469 6f6e 4c69       exceptionLi
+000112d0: 7374 203d 205b 5d0a 0a20 2020 2020 2020  st = []..       
+000112e0: 2068 6173 6855 6e63 6865 636b 496d 6167   hashUncheckImag
+000112f0: 6573 496e 5261 7720 3d20 7365 6c66 2e69  esInRaw = self.i
+00011300: 6d61 6765 7349 6e49 6d61 6765 7344 6972  magesInImagesDir
+00011310: 2829 0a20 2020 2020 2020 2070 726f 6720  ().        prog 
+00011320: 3d20 6d69 7174 632e 5072 696e 744b 6e6f  = miqtc.PrintKno
+00011330: 776e 5072 6f67 7265 7373 4d73 6728 2243  wnProgressMsg("C
+00011340: 6865 636b 696e 6720 6974 656d 2068 6173  hecking item has
+00011350: 6865 7322 2c20 6c65 6e28 7365 6c66 2e69  hes", len(self.i
+00011360: 6664 6f5f 746d 705b 7365 6c66 2e69 6d61  fdo_tmp[self.ima
+00011370: 6765 5365 7449 7465 6d73 4b65 795d 2929  geSetItemsKey]))
+00011380: 0a20 2020 2020 2020 2066 6f72 2069 7465  .        for ite
+00011390: 6d20 696e 2073 656c 662e 6966 646f 5f74  m in self.ifdo_t
+000113a0: 6d70 5b73 656c 662e 696d 6167 6553 6574  mp[self.imageSet
+000113b0: 4974 656d 734b 6579 5d3a 0a20 2020 2020  ItemsKey]:.     
+000113c0: 2020 2020 2020 2070 726f 672e 7072 6f67         prog.prog
+000113d0: 7265 7373 2829 0a0a 2020 2020 2020 2020  ress()..        
+000113e0: 2020 2020 666f 756e 6420 3d20 4661 6c73      found = Fals
+000113f0: 650a 2020 2020 2020 2020 2020 2020 666f  e.            fo
+00011400: 7220 696d 6167 6520 696e 2068 6173 6855  r image in hashU
+00011410: 6e63 6865 636b 496d 6167 6573 496e 5261  ncheckImagesInRa
+00011420: 773a 0a20 2020 2020 2020 2020 2020 2020  w:.             
+00011430: 2020 2066 696c 654e 616d 6520 3d20 6f73     fileName = os
+00011440: 2e70 6174 682e 6261 7365 6e61 6d65 2869  .path.basename(i
+00011450: 6d61 6765 290a 2020 2020 2020 2020 2020  mage).          
+00011460: 2020 2020 2020 6966 2066 696c 654e 616d        if fileNam
+00011470: 6520 3d3d 2069 7465 6d3a 0a20 2020 2020  e == item:.     
+00011480: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00011490: 6f75 6e64 203d 2054 7275 650a 2020 2020  ound = True.    
+000114a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000114b0: 6966 2069 7369 6e73 7461 6e63 6528 7365  if isinstance(se
+000114c0: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
+000114d0: 2e69 6d61 6765 5365 7449 7465 6d73 4b65  .imageSetItemsKe
+000114e0: 795d 5b69 7465 6d5d 2c6c 6973 7429 3a20  y][item],list): 
+000114f0: 2320 696e 2063 6173 6520 6f66 2076 6964  # in case of vid
+00011500: 656f 2077 6974 6820 6974 656d 2061 7320  eo with item as 
+00011510: 6c69 7374 2074 6865 2066 6972 7374 2065  list the first e
+00011520: 6e74 7279 2068 6f6c 6473 2074 6865 2064  ntry holds the d
+00011530: 6566 6175 6c74 2061 6e64 2074 6865 2068  efault and the h
+00011540: 6173 6820 6361 6e6e 6f74 2076 6172 7920  ash cannot vary 
+00011550: 666f 7220 7468 6520 7361 6d65 2069 6d61  for the same ima
+00011560: 6765 0a20 2020 2020 2020 2020 2020 2020  ge.             
+00011570: 2020 2020 2020 2020 2020 2069 7465 6d45             itemE
+00011580: 6e74 7279 203d 2073 656c 662e 6966 646f  ntry = self.ifdo
+00011590: 5f74 6d70 5b73 656c 662e 696d 6167 6553  _tmp[self.imageS
+000115a0: 6574 4974 656d 734b 6579 5d5b 6974 656d  etItemsKey][item
+000115b0: 5d5b 305d 200a 2020 2020 2020 2020 2020  ][0] .          
+000115c0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+000115d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000115e0: 2020 2020 2020 2020 6974 656d 456e 7472          itemEntr
+000115f0: 7920 3d20 7365 6c66 2e69 6664 6f5f 746d  y = self.ifdo_tm
+00011600: 705b 7365 6c66 2e69 6d61 6765 5365 7449  p[self.imageSetI
+00011610: 7465 6d73 4b65 795d 5b69 7465 6d5d 0a0a  temsKey][item]..
 00011620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011630: 2020 2020 2065 7863 6570 7469 6f6e 4c69       exceptionLi
-00011640: 7374 2e61 7070 656e 6428 5b66 696c 654e  st.append([fileN
-00011650: 616d 652c 2269 6e63 6f72 7265 6374 2073  ame,"incorrect s
-00011660: 6861 3235 3620 6861 7368 225d 290a 2020  ha256 hash"]).  
-00011670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011680: 2020 6272 6561 6b0a 2020 2020 2020 2020    break.        
-00011690: 2020 2020 6966 2066 6f75 6e64 3a0a 2020      if found:.  
-000116a0: 2020 2020 2020 2020 2020 2020 2020 6465                de
-000116b0: 6c20 6861 7368 556e 6368 6563 6b49 6d61  l hashUncheckIma
-000116c0: 6765 7349 6e52 6177 5b69 6d61 6765 5d0a  gesInRaw[image].
-000116d0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-000116e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000116f0: 2020 6966 2072 6169 7365 4578 6365 7074    if raiseExcept
-00011700: 696f 6e3a 0a20 2020 2020 2020 2020 2020  ion:.           
-00011710: 2020 2020 2020 2020 2072 6169 7365 206d           raise m
-00011720: 6971 7463 2e49 6664 6f45 7863 6570 7469  iqtc.IfdoExcepti
-00011730: 6f6e 2820 2269 6d61 6765 222c 2069 7465  on( "image", ite
-00011740: 6d2c 2022 6e6f 7420 666f 756e 6420 696e  m, "not found in
-00011750: 2064 6972 6563 746f 7279 2773 2072 6177   directory's raw
-00011760: 2066 6f6c 6465 7221 2229 0a20 2020 2020   folder!").     
-00011770: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00011780: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011790: 2020 2020 2065 7863 6570 7469 6f6e 4c69       exceptionLi
-000117a0: 7374 2e61 7070 656e 6428 5b66 696c 654e  st.append([fileN
-000117b0: 616d 652c 2266 696c 6520 6e6f 7420 666f  ame,"file not fo
-000117c0: 756e 6422 5d29 0a20 2020 2020 2020 2070  und"]).        p
-000117d0: 726f 672e 636c 6561 7228 290a 2020 2020  rog.clear().    
-000117e0: 2020 2020 6966 206e 6f74 2072 6169 7365      if not raise
-000117f0: 4578 6365 7074 696f 6e3a 0a20 2020 2020  Exception:.     
-00011800: 2020 2020 2020 2072 6574 7572 6e20 6578         return ex
-00011810: 6365 7074 696f 6e4c 6973 740a 0a0a 2020  ceptionList...  
-00011820: 2020 6465 6620 6372 6561 7465 5f75 7569    def create_uui
-00011830: 645f 6669 6c65 2873 656c 662c 636c 6561  d_file(self,clea
-00011840: 6e3d 5472 7565 293a 0a20 2020 2020 2020  n=True):.       
-00011850: 2022 2222 2043 7265 6174 6573 2069 6e20   """ Creates in 
-00011860: 2f69 6e74 6572 6d65 6469 6174 6520 6120  /intermediate a 
-00011870: 7465 7874 2066 696c 6520 636f 6e74 6169  text file contai
-00011880: 6e69 6e67 2070 6572 2069 6d61 6765 2061  ning per image a
-00011890: 2063 7265 6174 6564 2075 7569 6420 2876   created uuid (v
-000118a0: 6572 7369 6f6e 2034 292e 0a0a 2020 2020  ersion 4)...    
-000118b0: 2020 2020 5468 6520 5555 4944 2069 7320      The UUID is 
-000118c0: 6f6e 6c79 202a 7461 6b65 6e2a 2066 726f  only *taken* fro
-000118d0: 6d20 7468 6520 6d65 7461 6461 7461 206f  m the metadata o
-000118e0: 6620 7468 6520 696d 6167 6573 2e20 4974  f the images. It
-000118f0: 2064 6f65 7320 6e6f 7420 7772 6974 6520   does not write 
-00011900: 5555 4944 7320 746f 2074 6865 206d 6574  UUIDs to the met
-00011910: 6164 6174 6120 696e 2063 6173 6520 736f  adata in case so
-00011920: 6d65 2066 696c 6573 2061 7265 206d 6973  me files are mis
-00011930: 7369 6e67 2069 742e 0a20 2020 2020 2020  sing it..       
-00011940: 2042 7574 2c20 6974 2063 7265 6174 6573   But, it creates
-00011950: 2061 2043 5356 2066 696c 6520 696e 2074   a CSV file in t
-00011960: 6861 7420 6361 7365 2074 6861 7420 796f  hat case that yo
-00011970: 7520 6361 6e20 7573 6520 746f 6765 7468  u can use togeth
-00011980: 6572 2077 6974 6820 6578 6966 746f 6f6c  er with exiftool
-00011990: 2074 6f20 6164 6420 7468 6520 5555 4944   to add the UUID
-000119a0: 2074 6f20 796f 7572 2064 6174 612e 2042   to your data. B
-000119b0: 6577 6172 6521 2074 6869 7320 6361 6e20  eware! this can 
-000119c0: 6465 7374 726f 7920 796f 7572 2069 6d61  destroy your ima
-000119d0: 6765 730a 2020 2020 2020 2020 6966 206e  ges.        if n
-000119e0: 6f74 2064 6f6e 6520 7072 6f70 6572 6c79  ot done properly
-000119f0: 2120 4e6f 2067 7561 7261 6e74 6565 2069  ! No guarantee i
-00011a00: 7320 6769 7665 6e20 6974 2077 696c 6c20  s given it will 
-00011a10: 776f 726b 2e20 4265 2063 6172 6566 756c  work. Be careful
-00011a20: 210a 0a20 2020 2020 2020 2055 7365 2063  !..        Use c
-00011a30: 6c65 616e 3d46 616c 7365 2074 6f20 6e6f  lean=False to no
-00011a40: 7420 6368 6563 6b20 7468 6f73 6520 6669  t check those fi
-00011a50: 6c65 7320 6167 6169 6e20 7768 6963 6820  les again which 
-00011a60: 6172 6520 616c 7265 6164 7920 666f 756e  are already foun
-00011a70: 6420 696e 2069 6e74 6572 6d65 6469 6174  d in intermediat
-00011a80: 6520 7575 6964 2066 696c 650a 2020 2020  e uuid file.    
-00011a90: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
-00011aa0: 2075 7569 6473 203d 207b 7d0a 2020 2020   uuids = {}.    
-00011ab0: 2020 2020 2320 4368 6563 6b20 7768 6574      # Check whet
-00011ac0: 6865 7220 6120 6669 6c65 2077 6974 6820  her a file with 
-00011ad0: 5555 4944 7320 6578 6973 7473 2c20 7468  UUIDs exists, th
-00011ae0: 656e 2072 6561 6420 6974 0a20 2020 2020  en read it.     
-00011af0: 2020 2069 6620 6e6f 7420 636c 6561 6e20     if not clean 
-00011b00: 616e 6420 6f73 2e70 6174 682e 6578 6973  and os.path.exis
-00011b10: 7473 2873 656c 662e 6765 745f 696e 745f  ts(self.get_int_
-00011b20: 7575 6964 5f66 696c 6528 2929 3a0a 2020  uuid_file()):.  
-00011b30: 2020 2020 2020 2020 2020 7575 6964 7320            uuids 
-00011b40: 3d20 6d69 7174 662e 7461 6246 696c 6544  = miqtf.tabFileD
-00011b50: 6174 6128 7365 6c66 2e67 6574 5f69 6e74  ata(self.get_int
-00011b60: 5f75 7569 645f 6669 6c65 2829 2c20 5b6d  _uuid_file(), [m
-00011b70: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
-00011b80: 276d 6172 6971 7427 5d5b 2769 6d67 275d  'mariqt']['img']
-00011b90: 2c20 6d69 7174 762e 636f 6c5f 6865 6164  , miqtv.col_head
-00011ba0: 6572 5b27 6d61 7269 7174 275d 5b27 7575  er['mariqt']['uu
-00011bb0: 6964 275d 5d2c 206b 6579 5f63 6f6c 3d6d  id']], key_col=m
-00011bc0: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
-00011bd0: 276d 6172 6971 7427 5d5b 2769 6d67 275d  'mariqt']['img']
-00011be0: 290a 2020 2020 2020 2020 2020 2020 0a20  ).            . 
-00011bf0: 2020 2020 2020 2069 6620 6f73 2e70 6174         if os.pat
-00011c00: 682e 6578 6973 7473 2873 656c 662e 696d  h.exists(self.im
-00011c10: 6167 6573 4469 7229 3a0a 0a20 2020 2020  agesDir):..     
-00011c20: 2020 2020 2020 206d 6973 7369 6e67 5f75         missing_u
-00011c30: 7569 6473 203d 207b 7d0a 2020 2020 2020  uids = {}.      
-00011c40: 2020 2020 2020 6164 6465 645f 7575 6964        added_uuid
-00011c50: 7320 3d20 300a 0a20 2020 2020 2020 2020  s = 0..         
-00011c60: 2020 2075 6e6b 6e6f 776e 4669 6c65 7320     unknownFiles 
-00011c70: 3d20 5b5d 0a20 2020 2020 2020 2020 2020  = [].           
-00011c80: 2066 6f72 2066 696c 6520 696e 2073 656c   for file in sel
-00011c90: 662e 696d 6167 6573 496e 496d 6167 6573  f.imagesInImages
-00011ca0: 4469 7228 293a 0a20 2020 2020 2020 2020  Dir():.         
-00011cb0: 2020 2020 2020 2066 696c 655f 6e61 6d65         file_name
-00011cc0: 203d 206f 732e 7061 7468 2e62 6173 656e   = os.path.basen
-00011cd0: 616d 6528 6669 6c65 290a 2020 2020 2020  ame(file).      
-00011ce0: 2020 2020 2020 2020 2020 6966 2066 696c            if fil
-00011cf0: 655f 6e61 6d65 206e 6f74 2069 6e20 7575  e_name not in uu
-00011d00: 6964 733a 0a20 2020 2020 2020 2020 2020  ids:.           
-00011d10: 2020 2020 2020 2020 2075 6e6b 6e6f 776e           unknown
-00011d20: 4669 6c65 732e 6170 7065 6e64 2866 696c  Files.append(fil
-00011d30: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-00011d40: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00011d50: 2020 2020 2020 2020 2020 2020 2075 7569               uui
-00011d60: 6473 5b66 696c 655f 6e61 6d65 5d20 3d20  ds[file_name] = 
-00011d70: 7575 6964 735b 6669 6c65 5f6e 616d 655d  uuids[file_name]
-00011d80: 5b6d 6971 7476 2e63 6f6c 5f68 6561 6465  [miqtv.col_heade
-00011d90: 725b 276d 6172 6971 7427 5d5b 2775 7569  r['mariqt']['uui
-00011da0: 6427 5d5d 0a0a 2020 2020 2020 2020 2020  d']]..          
-00011db0: 2020 756e 6b6e 6f77 6e46 696c 6573 5555    unknownFilesUU
-00011dc0: 4944 7320 3d20 6d69 7174 692e 696d 6167  IDs = miqti.imag
-00011dd0: 6573 436f 6e74 6169 6e56 616c 6964 5555  esContainValidUU
-00011de0: 4944 2875 6e6b 6e6f 776e 4669 6c65 7329  ID(unknownFiles)
-00011df0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00011e00: 2066 696c 6520 696e 2075 6e6b 6e6f 776e   file in unknown
-00011e10: 4669 6c65 7355 5549 4473 3a0a 2020 2020  FilesUUIDs:.    
-00011e20: 2020 2020 2020 2020 2020 2020 6669 6c65              file
-00011e30: 5f6e 616d 6520 3d20 6f73 2e70 6174 682e  _name = os.path.
-00011e40: 6261 7365 6e61 6d65 2866 696c 6529 0a20  basename(file). 
-00011e50: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00011e60: 6620 6e6f 7420 756e 6b6e 6f77 6e46 696c  f not unknownFil
-00011e70: 6573 5555 4944 735b 6669 6c65 5d5b 2776  esUUIDs[file]['v
-00011e80: 616c 6964 275d 3a0a 2020 2020 2020 2020  alid']:.        
-00011e90: 2020 2020 2020 2020 2020 2020 7575 6964              uuid
-00011ea0: 203d 206d 6971 7463 2e75 7569 6434 2829   = miqtc.uuid4()
-00011eb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011ec0: 2020 2020 206d 6973 7369 6e67 5f75 7569       missing_uui
-00011ed0: 6473 5b66 696c 655d 203d 2075 7569 640a  ds[file] = uuid.
-00011ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011ef0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00011f00: 2020 2020 2020 2020 2020 7575 6964 735b            uuids[
-00011f10: 6669 6c65 5f6e 616d 655d 203d 2075 6e6b  file_name] = unk
-00011f20: 6e6f 776e 4669 6c65 7355 5549 4473 5b66  nownFilesUUIDs[f
-00011f30: 696c 655d 5b27 7575 6964 275d 0a20 2020  ile]['uuid'].   
-00011f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011f50: 2061 6464 6564 5f75 7569 6473 202b 3d20   added_uuids += 
-00011f60: 310a 0a20 2020 2020 2020 2020 2020 2023  1..            #
-00011f70: 2049 6620 7072 6576 696f 7573 6c79 2075   If previously u
-00011f80: 6e6b 6e6f 776e 2055 5549 4473 2077 6572  nknown UUIDs wer
-00011f90: 6520 666f 756e 6420 696e 2074 6865 2066  e found in the f
-00011fa0: 696c 6520 6865 6164 6572 732c 2061 6464  ile headers, add
-00011fb0: 2074 6865 6d20 746f 2074 6865 2055 5549   them to the UUI
-00011fc0: 4420 6669 6c65 0a20 2020 2020 2020 2020  D file.         
-00011fd0: 2020 2069 6620 6164 6465 645f 7575 6964     if added_uuid
-00011fe0: 7320 3e20 303a 0a20 2020 2020 2020 2020  s > 0:.         
-00011ff0: 2020 2020 2020 2072 6573 203d 206f 7065         res = ope
-00012000: 6e28 7365 6c66 2e67 6574 5f69 6e74 5f75  n(self.get_int_u
-00012010: 7569 645f 6669 6c65 2829 2c20 2277 2229  uid_file(), "w")
-00012020: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012030: 2072 6573 2e77 7269 7465 286d 6971 7476   res.write(miqtv
-00012040: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
-00012050: 6971 7427 5d5b 2769 6d67 275d 202b 225c  iqt']['img'] +"\
-00012060: 7422 2b6d 6971 7476 2e63 6f6c 5f68 6561  t"+miqtv.col_hea
-00012070: 6465 725b 276d 6172 6971 7427 5d5b 2775  der['mariqt']['u
-00012080: 7569 6427 5d2b 225c 6e22 290a 2020 2020  uid']+"\n").    
-00012090: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-000120a0: 6669 6c65 2069 6e20 7575 6964 733a 0a20  file in uuids:. 
-000120b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000120c0: 2020 2072 6573 2e77 7269 7465 2866 696c     res.write(fil
-000120d0: 652b 225c 7422 2b73 7472 2875 7569 6473  e+"\t"+str(uuids
-000120e0: 5b66 696c 655d 292b 225c 6e22 290a 2020  [file])+"\n").  
-000120f0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00012100: 732e 636c 6f73 6528 290a 0a20 2020 2020  s.close()..     
-00012110: 2020 2020 2020 2069 6620 6c65 6e28 6d69         if len(mi
-00012120: 7373 696e 675f 7575 6964 7329 203e 2030  ssing_uuids) > 0
-00012130: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00012140: 2020 6563 7376 5f70 6174 6820 3d20 7365    ecsv_path = se
-00012150: 6c66 2e5f 5f67 6574 5f69 6e74 5f66 696c  lf.__get_int_fil
-00012160: 655f 7072 6566 6978 2829 202b 2022 5f65  e_prefix() + "_e
-00012170: 7869 662d 6164 642d 7575 6964 2e63 7376  xif-add-uuid.csv
-00012180: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00012190: 2020 6373 7620 3d20 6f70 656e 2865 6373    csv = open(ecs
-000121a0: 765f 7061 7468 2c20 2277 2229 0a20 2020  v_path, "w").   
-000121b0: 2020 2020 2020 2020 2020 2020 2063 7376               csv
-000121c0: 2e77 7269 7465 286d 6971 7476 2e63 6f6c  .write(miqtv.col
-000121d0: 5f68 6561 6465 725b 2765 7869 6627 5d5b  _header['exif'][
-000121e0: 2769 6d67 275d 202b 0a20 2020 2020 2020  'img'] +.       
-000121f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012200: 2020 2022 2c22 2b6d 6971 7476 2e63 6f6c     ","+miqtv.col
-00012210: 5f68 6561 6465 725b 2765 7869 6627 5d5b  _header['exif'][
-00012220: 2775 7569 6427 5d2b 225c 6e22 290a 2020  'uuid']+"\n").  
-00012230: 2020 2020 2020 2020 2020 2020 2020 6469                di
-00012240: 6666 6572 656e 745f 7061 7468 7320 3d20  fferent_paths = 
-00012250: 5b5d 0a20 2020 2020 2020 2020 2020 2020  [].             
-00012260: 2020 2066 6f72 2069 6d67 2069 6e20 6d69     for img in mi
-00012270: 7373 696e 675f 7575 6964 733a 0a20 2020  ssing_uuids:.   
-00012280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012290: 2069 6620 6f73 2e70 6174 682e 6261 7365   if os.path.base
-000122a0: 6e61 6d65 2869 6d67 2920 6e6f 7420 696e  name(img) not in
-000122b0: 2064 6966 6665 7265 6e74 5f70 6174 6873   different_paths
-000122c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000122d0: 2020 2020 2020 2020 2020 6469 6666 6572            differ
-000122e0: 656e 745f 7061 7468 732e 6170 7065 6e64  ent_paths.append
-000122f0: 286f 732e 7061 7468 2e62 6173 656e 616d  (os.path.basenam
-00012300: 6528 696d 6729 290a 2020 2020 2020 2020  e(img)).        
-00012310: 2020 2020 2020 2020 2020 2020 6373 762e              csv.
-00012320: 7772 6974 6528 696d 672b 222c 222b 7374  write(img+","+st
-00012330: 7228 6d69 7373 696e 675f 7575 6964 735b  r(missing_uuids[
-00012340: 696d 675d 292b 225c 6e22 290a 2020 2020  img])+"\n").    
-00012350: 2020 2020 2020 2020 2020 2020 2372 6574              #ret
-00012360: 7572 6e20 4661 6c73 652c 2022 6578 6966  urn False, "exif
-00012370: 746f 6f6c 202d 6373 763d 222b 6563 7376  tool -csv="+ecsv
-00012380: 5f70 6174 682b 2220 222b 2220 222e 6a6f  _path+" "+" ".jo
-00012390: 696e 2864 6966 6665 7265 6e74 5f70 6174  in(different_pat
-000123a0: 6873 290a 2020 2020 2020 2020 2020 2020  hs).            
-000123b0: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-000123c0: 2c20 224e 6f74 2061 6c6c 2069 6d61 6765  , "Not all image
-000123d0: 7320 6861 7665 2076 616c 6964 2055 5549  s have valid UUI
-000123e0: 4473 2e20 4d69 7373 696e 6720 666f 7220  Ds. Missing for 
-000123f0: 666f 6c6c 6f77 696e 6720 6669 6c65 733a  following files:
-00012400: 5c6e 222b 225c c586 222e 6a6f 696e 2864  \n"+"\..".join(d
-00012410: 6966 6665 7265 6e74 5f70 6174 6873 290a  ifferent_paths).
-00012420: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
-00012430: 2020 2020 2020 2020 2073 656c 662e 5f5f           self.__
-00012440: 616c 6c55 5549 4473 4368 6563 6b65 6420  allUUIDsChecked 
-00012450: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
-00012460: 2020 2072 6574 7572 6e20 5472 7565 2c20     return True, 
-00012470: 2241 6c6c 2069 6d61 6765 7320 6861 7665  "All images have
-00012480: 2061 2055 5549 4422 0a20 2020 2020 2020   a UUID".       
-00012490: 2072 6574 7572 6e20 4661 6c73 652c 2022   return False, "
-000124a0: 5061 7468 2022 2b73 656c 662e 696d 6167  Path "+self.imag
-000124b0: 6573 4469 7220 2b20 2220 6e6f 7420 666f  esDir + " not fo
-000124c0: 756e 642e 220a 0a20 2020 2064 6566 2063  und."..    def c
-000124d0: 7265 6174 6555 5549 4446 696c 6528 7365  reateUUIDFile(se
-000124e0: 6c66 2c63 6c65 616e 3d54 7275 6529 3a0a  lf,clean=True):.
-000124f0: 2020 2020 2020 2020 2222 2220 4465 7072          """ Depr
-00012500: 6563 6174 6564 202d 2075 7365 2063 7265  ecated - use cre
-00012510: 6174 655f 7575 6964 5f66 696c 6520 2222  ate_uuid_file ""
-00012520: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
-00012530: 2073 656c 662e 6372 6561 7465 5f75 7569   self.create_uui
-00012540: 645f 6669 6c65 2863 6c65 616e 290a 0a0a  d_file(clean)...
-00012550: 2020 2020 6465 6620 7365 745f 696d 6167      def set_imag
-00012560: 655f 7365 745f 6174 7469 7475 6465 2873  e_set_attitude(s
-00012570: 656c 662c 7961 775f 6672 616d 653a 666c  elf,yaw_frame:fl
-00012580: 6f61 742c 7069 7463 685f 6672 616d 653a  oat,pitch_frame:
-00012590: 666c 6f61 742c 726f 6c6c 5f66 7261 6d65  float,roll_frame
-000125a0: 3a66 6c6f 6174 2c79 6177 5f63 616d 3266  :float,yaw_cam2f
-000125b0: 7261 6d65 3a66 6c6f 6174 2c70 6974 6368  rame:float,pitch
-000125c0: 5f63 616d 3266 7261 6d65 3a66 6c6f 6174  _cam2frame:float
-000125d0: 2c72 6f6c 6c5f 6361 6d32 6672 616d 653a  ,roll_cam2frame:
-000125e0: 666c 6f61 7429 3a0a 2020 2020 2020 2020  float):.        
-000125f0: 2222 2220 6361 6c63 756c 6174 6573 2074  """ calculates t
-00012600: 6865 2074 6865 2063 616d 6572 6173 2061  he the cameras a
-00012610: 6273 6f6c 7574 6520 6174 7469 7475 6465  bsolute attitude
-00012620: 2061 6e64 2073 6574 7320 6974 2074 6f20   and sets it to 
-00012630: 696d 6167 6520 7365 7420 6865 6164 6572  image set header
-00012640: 2e20 416c 6c20 616e 676c 6573 2061 7265  . All angles are
-00012650: 2065 7870 6563 7465 6420 696e 2064 6567   expected in deg
-00012660: 7265 6573 2e20 0a20 2020 2020 2020 2063  rees. .        c
-00012670: 616d 6572 6132 6672 616d 6520 616e 676c  amera2frame angl
-00012680: 6573 3a20 726f 7461 7469 6f6e 206f 6620  es: rotation of 
-00012690: 6361 6d65 7261 2063 6f6f 7264 696e 6174  camera coordinat
-000126a0: 6573 2028 782c 792c 7a20 3d20 746f 702c  es (x,y,z = top,
-000126b0: 2072 6967 6874 2c20 6c69 6e65 206f 6620   right, line of 
-000126c0: 7369 6768 7429 2077 6974 6820 7265 7370  sight) with resp
-000126d0: 6563 7420 746f 2076 6568 6963 6c65 2063  ect to vehicle c
-000126e0: 6f6f 7264 696e 6174 6573 2028 782c 792c  oordinates (x,y,
-000126f0: 7a20 3d20 666f 7277 6172 642c 7269 6768  z = forward,righ
-00012700: 742c 646f 776e 2920 0a20 2020 2020 2020  t,down) .       
-00012710: 2069 6e20 6163 636f 7264 616e 6365 2077   in accordance w
-00012720: 6974 6820 7468 6520 7961 772c 7069 7463  ith the yaw,pitc
-00012730: 682c 726f 6c6c 2072 6f74 6174 696f 6e20  h,roll rotation 
-00012740: 6f72 6465 7220 636f 6e76 656e 7469 6f6e  order convention
-00012750: 3a0a 0a20 2020 2020 2020 2031 2e20 7961  :..        1. ya
-00012760: 7720 6172 6f75 6e64 207a 2c0a 2020 2020  w around z,.    
-00012770: 2020 2020 322e 2070 6974 6368 2061 726f      2. pitch aro
-00012780: 756e 6420 726f 7461 7465 6420 792c 0a20  und rotated y,. 
-00012790: 2020 2020 2020 2033 2e20 726f 6c6c 2061         3. roll a
-000127a0: 726f 756e 6420 726f 7461 7465 6420 780a  round rotated x.
-000127b0: 0a20 2020 2020 2020 2052 6f74 6174 696f  .        Rotatio
-000127c0: 6e20 6469 7265 6374 696f 6e73 2061 6363  n directions acc
-000127d0: 6f72 6469 6e67 2074 6f20 5c27 7269 6768  ording to \'righ
-000127e0: 742d 6861 6e64 2072 756c 655c 272e 0a0a  t-hand rule\'...
-000127f0: 2020 2020 2020 2020 492e 652e 2063 616d          I.e. cam
-00012800: 6572 6132 4672 616d 6520 616e 676c 6573  era2Frame angles
-00012810: 203d 2030 2c30 2c30 2063 616d 6572 6120   = 0,0,0 camera 
-00012820: 6973 2066 6163 696e 6720 646f 776e 7761  is facing downwa
-00012830: 7264 2077 6974 6820 746f 7020 7369 6465  rd with top side
-00012840: 2074 6f77 6172 6473 2076 6568 6963 6c65   towards vehicle
-00012850: 2773 2066 6f72 7761 7264 2064 6972 6563  's forward direc
-00012860: 7469 6f6e 2720 2222 220a 0a20 2020 2020  tion' """..     
-00012870: 2020 2052 5f66 7261 6d65 326e 6564 203d     R_frame2ned =
-00012880: 206d 6971 7467 2e52 5f59 6177 5069 7463   miqtg.R_YawPitc
-00012890: 6852 6f6c 6c28 7961 775f 6672 616d 652c  hRoll(yaw_frame,
-000128a0: 7069 7463 685f 6672 616d 652c 726f 6c6c  pitch_frame,roll
-000128b0: 5f66 7261 6d65 290a 2020 2020 2020 2020  _frame).        
-000128c0: 525f 6361 6d32 6672 616d 6520 3d20 6d69  R_cam2frame = mi
-000128d0: 7174 672e 525f 5961 7750 6974 6368 526f  qtg.R_YawPitchRo
-000128e0: 6c6c 2879 6177 5f63 616d 3266 7261 6d65  ll(yaw_cam2frame
-000128f0: 2c70 6974 6368 5f63 616d 3266 7261 6d65  ,pitch_cam2frame
-00012900: 2c72 6f6c 6c5f 6361 6d32 6672 616d 6529  ,roll_cam2frame)
-00012910: 0a20 2020 2020 2020 2052 5f63 616d 326e  .        R_cam2n
-00012920: 6564 203d 2052 5f66 7261 6d65 326e 6564  ed = R_frame2ned
-00012930: 2e64 6f74 2852 5f63 616d 3266 7261 6d65  .dot(R_cam2frame
-00012940: 290a 2020 2020 2020 2020 7961 772c 7069  ).        yaw,pi
-00012950: 7463 682c 726f 6c6c 203d 206d 6971 7467  tch,roll = miqtg
-00012960: 2e79 6177 5069 7463 6852 6f6c 6c28 525f  .yawPitchRoll(R_
-00012970: 6361 6d32 6e65 6429 0a0a 2020 2020 2020  cam2ned)..      
-00012980: 2020 2320 706f 7365 206d 6174 7269 7820    # pose matrix 
-00012990: 6361 6d32 7574 6d0a 2020 2020 2020 2020  cam2utm.        
-000129a0: 525f 6361 6d53 7464 3275 746d 203d 2073  R_camStd2utm = s
-000129b0: 656c 662e 6765 745f 525f 6361 6d53 7464  elf.get_R_camStd
-000129c0: 3275 746d 2852 5f63 616d 3266 7261 6d65  2utm(R_cam2frame
-000129d0: 2c52 5f66 7261 6d65 326e 6564 290a 0a20  ,R_frame2ned).. 
-000129e0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-000129f0: 2020 2078 203d 206e 702e 6172 7261 7928     x = np.array(
-00012a00: 5b31 2c30 2c30 5d29 0a20 2020 2020 2020  [1,0,0]).       
-00012a10: 2079 203d 206e 702e 6172 7261 7928 5b30   y = np.array([0
-00012a20: 2c31 2c30 5d29 0a20 2020 2020 2020 207a  ,1,0]).        z
-00012a30: 203d 206e 702e 6172 7261 7928 5b30 2c30   = np.array([0,0
-00012a40: 2c31 5d29 0a20 2020 2020 2020 2070 7269  ,1]).        pri
-00012a50: 6e74 2827 7827 2c52 5f63 616d 5374 6432  nt('x',R_camStd2
-00012a60: 7574 6d2e 646f 7428 7829 2e72 6f75 6e64  utm.dot(x).round
-00012a70: 2835 2929 0a20 2020 2020 2020 2070 7269  (5)).        pri
-00012a80: 6e74 2827 7927 2c52 5f63 616d 5374 6432  nt('y',R_camStd2
-00012a90: 7574 6d2e 646f 7428 7929 2e72 6f75 6e64  utm.dot(y).round
-00012aa0: 2835 2929 0a20 2020 2020 2020 2070 7269  (5)).        pri
-00012ab0: 6e74 2827 7a27 2c52 5f63 616d 5374 6432  nt('z',R_camStd2
-00012ac0: 7574 6d2e 646f 7428 7a29 2e72 6f75 6e64  utm.dot(z).round
-00012ad0: 2835 2929 0a20 2020 2020 2020 2022 2222  (5)).        """
-00012ae0: 0a0a 2020 2020 2020 2020 6865 6164 6572  ..        header
-00012af0: 5570 6461 7465 203d 207b 0a20 2020 2020  Update = {.     
-00012b00: 2020 2020 2020 206d 6971 7476 2e63 6f6c         miqtv.col
-00012b10: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
-00012b20: 5d5b 2779 6177 275d 3a79 6177 2c0a 2020  ]['yaw']:yaw,.  
-00012b30: 2020 2020 2020 2020 2020 6d69 7174 762e            miqtv.
-00012b40: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
-00012b50: 7174 275d 5b27 7069 7463 6827 5d3a 7069  qt']['pitch']:pi
-00012b60: 7463 682c 0a20 2020 2020 2020 2020 2020  tch,.           
-00012b70: 206d 6971 7476 2e63 6f6c 5f68 6561 6465   miqtv.col_heade
-00012b80: 725b 276d 6172 6971 7427 5d5b 2772 6f6c  r['mariqt']['rol
-00012b90: 6c27 5d3a 726f 6c6c 2c0a 2020 2020 2020  l']:roll,.      
-00012ba0: 2020 2020 2020 6d69 7174 762e 636f 6c5f        miqtv.col_
-00012bb0: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
-00012bc0: 5b27 706f 7365 275d 3a7b 2770 6f73 652d  ['pose']:{'pose-
-00012bd0: 6162 736f 6c75 7465 2d6f 7269 656e 7461  absolute-orienta
-00012be0: 7469 6f6e 2d75 746d 2d6d 6174 7269 7827  tion-utm-matrix'
-00012bf0: 3a52 5f63 616d 5374 6432 7574 6d2e 666c  :R_camStd2utm.fl
-00012c00: 6174 7465 6e28 292e 746f 6c69 7374 2829  atten().tolist()
-00012c10: 7d0a 2020 2020 2020 2020 7d0a 2020 2020  }.        }.    
-00012c20: 2020 2020 7365 6c66 2e75 7064 6174 655f      self.update_
-00012c30: 6966 646f 5f68 6561 6465 725f 6669 656c  ifdo_header_fiel
-00012c40: 6473 2868 6561 6465 7255 7064 6174 6529  ds(headerUpdate)
-00012c50: 0a0a 2020 2020 6465 6620 7365 7449 6d61  ..    def setIma
-00012c60: 6765 5365 7441 7474 6974 7564 6528 7365  geSetAttitude(se
-00012c70: 6c66 2c79 6177 5f66 7261 6d65 3a66 6c6f  lf,yaw_frame:flo
-00012c80: 6174 2c70 6974 6368 5f66 7261 6d65 3a66  at,pitch_frame:f
-00012c90: 6c6f 6174 2c72 6f6c 6c5f 6672 616d 653a  loat,roll_frame:
-00012ca0: 666c 6f61 742c 7961 775f 6361 6d32 6672  float,yaw_cam2fr
-00012cb0: 616d 653a 666c 6f61 742c 7069 7463 685f  ame:float,pitch_
-00012cc0: 6361 6d32 6672 616d 653a 666c 6f61 742c  cam2frame:float,
-00012cd0: 726f 6c6c 5f63 616d 3266 7261 6d65 3a66  roll_cam2frame:f
-00012ce0: 6c6f 6174 293a 0a20 2020 2020 2020 2022  loat):.        "
-00012cf0: 2222 2044 6570 7265 6361 7465 6420 2d20  "" Deprecated - 
-00012d00: 7573 6520 7365 745f 696d 6167 655f 7365  use set_image_se
-00012d10: 745f 6174 7469 7475 6465 2022 2222 0a20  t_attitude """. 
-00012d20: 2020 2020 2020 2073 656c 662e 7365 745f         self.set_
-00012d30: 696d 6167 655f 7365 745f 6174 7469 7475  image_set_attitu
-00012d40: 6465 2879 6177 5f66 7261 6d65 2c20 7069  de(yaw_frame, pi
-00012d50: 7463 685f 6672 616d 652c 2072 6f6c 6c5f  tch_frame, roll_
-00012d60: 6672 616d 652c 2079 6177 5f63 616d 3266  frame, yaw_cam2f
-00012d70: 7261 6d65 2c20 7069 7463 685f 6361 6d32  rame, pitch_cam2
-00012d80: 6672 616d 652c 2072 6f6c 6c5f 6361 6d32  frame, roll_cam2
-00012d90: 6672 616d 6529 0a0a 0a20 2020 2064 6566  frame)...    def
-00012da0: 2063 7265 6174 655f 696d 6167 655f 6174   create_image_at
-00012db0: 7469 7475 6465 5f66 696c 6528 7365 6c66  titude_file(self
-00012dc0: 2c20 6174 745f 7061 7468 3a73 7472 2c20  , att_path:str, 
-00012dd0: 6672 616d 655f 6174 745f 6865 6164 6572  frame_att_header
-00012de0: 3a64 6963 742c 2063 616d 6572 6132 4672  :dict, camera2Fr
-00012df0: 616d 655f 7961 773a 666c 6f61 742c 6361  ame_yaw:float,ca
-00012e00: 6d65 7261 3246 7261 6d65 5f70 6974 6368  mera2Frame_pitch
-00012e10: 3a66 6c6f 6174 2c63 616d 6572 6132 4672  :float,camera2Fr
-00012e20: 616d 655f 726f 6c6c 3a66 6c6f 6174 2c0a  ame_roll:float,.
-00012e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012e50: 6461 7465 5f66 6f72 6d61 743d 6d69 7174  date_format=miqt
-00012e60: 762e 6461 7465 5f66 6f72 6d61 7473 5b27  v.date_formats['
-00012e70: 7061 6e67 6165 6127 5d2c 2063 6f6e 7374  pangaea'], const
-00012e80: 5f76 616c 7565 7320 3d20 7b7d 2c20 6f76  _values = {}, ov
-00012e90: 6572 7772 6974 653d 4661 6c73 652c 2063  erwrite=False, c
-00012ea0: 6f6c 5f73 6570 6172 6174 6f72 203d 2022  ol_separator = "
-00012eb0: 5c74 222c 0a20 2020 2020 2020 2020 2020  \t",.           
-00012ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012ed0: 2020 2020 2061 7474 5f70 6174 685f 616e       att_path_an
-00012ee0: 676c 6573 5f69 6e5f 7261 6420 3d20 4661  gles_in_rad = Fa
-00012ef0: 6c73 652c 2076 6964 656f 5361 6d70 6c65  lse, videoSample
-00012f00: 5365 636f 6e64 733d 312c 7265 636f 7264  Seconds=1,record
-00012f10: 7332 6265 496e 7665 7274 6564 3d5b 5d29  s2beInverted=[])
-00012f20: 3a0a 2020 2020 2020 2020 2222 2220 4372  :.        """ Cr
-00012f30: 6561 7465 7320 696e 202f 696e 7465 726d  eates in /interm
-00012f40: 6564 6961 7465 2061 2074 6578 7420 6669  ediate a text fi
-00012f50: 6c65 2077 6974 6820 6361 6d65 7261 2061  le with camera a
-00012f60: 7474 6974 7564 6520 6461 7461 2066 6f72  ttitude data for
-00012f70: 2065 6163 6820 696d 6167 652e 2041 6c6c   each image. All
-00012f80: 2061 6e67 6c65 7320 6172 6520 6578 7065   angles are expe
-00012f90: 6374 6564 2069 6e20 6465 6772 6565 732e  cted in degrees.
-00012fa0: 2055 7365 2061 7474 5f70 6174 685f 616e   Use att_path_an
-00012fb0: 676c 6573 5f69 6e5f 7261 6420 6966 206e  gles_in_rad if n
-00012fc0: 6563 6573 7361 7279 2e20 0a20 2020 2020  ecessary. .     
-00012fd0: 2020 2063 616d 6572 6132 4672 616d 6520     camera2Frame 
-00012fe0: 616e 676c 6573 3a20 726f 7461 7469 6f6e  angles: rotation
-00012ff0: 206f 6620 6361 6d65 7261 2063 6f6f 7264   of camera coord
-00013000: 696e 6174 6573 2028 782c 792c 7a20 3d20  inates (x,y,z = 
-00013010: 746f 702c 2072 6967 6874 2c20 6c69 6e65  top, right, line
-00013020: 206f 6620 7369 6768 7429 2077 6974 6820   of sight) with 
-00013030: 7265 7370 6563 7420 746f 2076 6568 6963  respect to vehic
-00013040: 6c65 2063 6f6f 7264 696e 6174 6573 2028  le coordinates (
-00013050: 782c 792c 7a20 3d20 666f 7277 6172 642c  x,y,z = forward,
-00013060: 7269 6768 742c 646f 776e 2920 0a20 2020  right,down) .   
-00013070: 2020 2020 2069 6e20 6163 636f 7264 616e       in accordan
-00013080: 6365 2077 6974 6820 7468 6520 7961 772c  ce with the yaw,
-00013090: 7069 7463 682c 726f 6c6c 2072 6f74 6174  pitch,roll rotat
-000130a0: 696f 6e20 6f72 6465 7220 636f 6e76 656e  ion order conven
-000130b0: 7469 6f6e 3a0a 2020 2020 2020 2020 312e  tion:.        1.
-000130c0: 2079 6177 2061 726f 756e 6420 7a2c 0a20   yaw around z,. 
-000130d0: 2020 2020 2020 2032 2e20 7069 7463 6820         2. pitch 
-000130e0: 6172 6f75 6e64 2072 6f74 6174 6564 2079  around rotated y
-000130f0: 2c0a 2020 2020 2020 2020 332e 2072 6f6c  ,.        3. rol
-00013100: 6c20 6172 6f75 6e64 2072 6f74 6174 6564  l around rotated
-00013110: 2078 0a0a 2020 2020 2020 2020 526f 7461   x..        Rota
-00013120: 7469 6f6e 2064 6972 6563 7469 6f6e 7320  tion directions 
-00013130: 6163 636f 7264 696e 6720 746f 205c 2772  according to \'r
-00013140: 6967 6874 2d68 616e 6420 7275 6c65 5c27  ight-hand rule\'
-00013150: 2e0a 0a20 2020 2020 2020 2049 2e65 2e20  ...        I.e. 
-00013160: 6361 6d65 7261 3246 7261 6d65 2061 6e67  camera2Frame ang
-00013170: 6c65 7320 3d20 302c 302c 3020 6361 6d65  les = 0,0,0 came
-00013180: 7261 2069 7320 6661 6369 6e67 2064 6f77  ra is facing dow
-00013190: 6e77 6172 6420 7769 7468 2074 6f70 2073  nward with top s
-000131a0: 6964 6520 746f 7761 7264 7320 7665 6869  ide towards vehi
-000131b0: 636c 6527 7320 666f 7277 6172 6420 6469  cle's forward di
-000131c0: 7265 6374 696f 6e27 2022 2222 0a0a 2020  rection' """..  
-000131d0: 2020 2020 2020 696e 745f 6174 7475 7475        int_attutu
-000131e0: 6465 5f66 696c 6520 3d20 7365 6c66 2e5f  de_file = self._
-000131f0: 5f67 6574 5f69 6e74 5f66 696c 655f 7072  _get_int_file_pr
-00013200: 6566 6978 2829 202b 2027 5f69 6d61 6765  efix() + '_image
-00013210: 2d61 7474 6974 7564 652e 7478 7427 0a20  -attitude.txt'. 
-00013220: 2020 2020 2020 206f 7574 7075 745f 6865         output_he
-00013230: 6164 6572 5f61 7474 203d 207b 2020 206d  ader_att = {   m
-00013240: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
-00013250: 276d 6172 6971 7427 5d5b 2769 6d67 275d  'mariqt']['img']
-00013260: 3a20 206d 6971 7476 2e63 6f6c 5f68 6561  :  miqtv.col_hea
-00013270: 6465 725b 276d 6172 6971 7427 5d5b 2769  der['mariqt']['i
-00013280: 6d67 275d 2c0a 2020 2020 2020 2020 2020  mg'],.          
-00013290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000132a0: 2020 2020 2020 6d69 7174 762e 636f 6c5f        miqtv.col_
-000132b0: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
-000132c0: 5b27 7574 6327 5d3a 6d69 7174 762e 636f  ['utc']:miqtv.co
-000132d0: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
-000132e0: 275d 5b27 7574 6327 5d2c 0a20 2020 2020  ']['utc'],.     
-000132f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013300: 2020 2020 2020 2020 2020 206d 6971 7476             miqtv
-00013310: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
-00013320: 6971 7427 5d5b 2779 6177 275d 3a6d 6971  iqt']['yaw']:miq
-00013330: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
-00013340: 6172 6971 7427 5d5b 2779 6177 275d 2c0a  ariqt']['yaw'],.
-00013350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013370: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
-00013380: 5b27 6d61 7269 7174 275d 5b27 7069 7463  ['mariqt']['pitc
-00013390: 6827 5d3a 6d69 7174 762e 636f 6c5f 6865  h']:miqtv.col_he
-000133a0: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
-000133b0: 7069 7463 6827 5d2c 0a20 2020 2020 2020  pitch'],.       
-000133c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000133d0: 2020 2020 2020 2020 206d 6971 7476 2e63           miqtv.c
-000133e0: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
-000133f0: 7427 5d5b 2772 6f6c 6c27 5d3a 6d69 7174  t']['roll']:miqt
-00013400: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
-00013410: 7269 7174 275d 5b27 726f 6c6c 275d 2c0a  riqt']['roll'],.
-00013420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013430: 2020 2020 2020 2020 2020 2020 7d0a 0a20              }.. 
-00013440: 2020 2020 2020 2069 6e74 5f70 6f73 655f         int_pose_
-00013450: 6669 6c65 203d 2073 656c 662e 5f5f 6765  file = self.__ge
-00013460: 745f 696e 745f 6669 6c65 5f70 7265 6669  t_int_file_prefi
-00013470: 7828 2920 2b20 275f 696d 6167 652d 6361  x() + '_image-ca
-00013480: 6d65 7261 2d70 6f73 652e 7478 7427 0a20  mera-pose.txt'. 
-00013490: 2020 2020 2020 206f 7574 7075 745f 6865         output_he
-000134a0: 6164 6572 5f70 6f73 6520 3d20 7b20 206d  ader_pose = {  m
-000134b0: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
-000134c0: 276d 6172 6971 7427 5d5b 2769 6d67 275d  'mariqt']['img']
-000134d0: 3a6d 6971 7476 2e63 6f6c 5f68 6561 6465  :miqtv.col_heade
-000134e0: 725b 276d 6172 6971 7427 5d5b 2769 6d67  r['mariqt']['img
-000134f0: 275d 2c0a 2020 2020 2020 2020 2020 2020  '],.            
-00013500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013510: 2020 2020 6d69 7174 762e 636f 6c5f 6865      miqtv.col_he
-00013520: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
-00013530: 7574 6327 5d3a 6d69 7174 762e 636f 6c5f  utc']:miqtv.col_
-00013540: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
-00013550: 5b27 7574 6327 5d2c 0a20 2020 2020 2020  ['utc'],.       
-00013560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013570: 2020 2020 2020 2020 206d 6971 7476 2e63           miqtv.c
-00013580: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
-00013590: 7427 5d5b 2770 6f73 6527 5d3a 6d69 7174  t']['pose']:miqt
-000135a0: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
-000135b0: 7269 7174 275d 5b27 706f 7365 275d 2c0a  riqt']['pose'],.
-000135c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000135d0: 2020 2020 2020 2020 2020 2020 7d0a 0a20              }.. 
-000135e0: 2020 2020 2020 2069 6620 6f73 2e70 6174         if os.pat
-000135f0: 682e 6578 6973 7473 2869 6e74 5f61 7474  h.exists(int_att
-00013600: 7574 7564 655f 6669 6c65 2920 616e 6420  utude_file) and 
-00013610: 6e6f 7420 6f76 6572 7772 6974 653a 0a20  not overwrite:. 
-00013620: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00013630: 6164 645f 6974 656d 5f69 6e66 6f5f 7461  add_item_info_ta
-00013640: 625f 6669 6c65 2869 6e74 5f61 7474 7574  b_file(int_attut
-00013650: 7564 655f 6669 6c65 2c22 5c74 222c 6f75  ude_file,"\t",ou
-00013660: 7470 7574 5f68 6561 6465 725f 6174 7429  tput_header_att)
-00013670: 0a20 2020 2020 2020 2020 2020 2065 7874  .            ext
-00013680: 7261 5f6d 7367 203d 2022 220a 2020 2020  ra_msg = "".    
-00013690: 2020 2020 2020 2020 6966 206f 732e 7061          if os.pa
-000136a0: 7468 2e65 7869 7374 7328 696e 745f 706f  th.exists(int_po
-000136b0: 7365 5f66 696c 6529 3a0a 2020 2020 2020  se_file):.      
-000136c0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-000136d0: 6464 5f69 7465 6d5f 696e 666f 5f74 6162  dd_item_info_tab
-000136e0: 5f66 696c 6528 696e 745f 706f 7365 5f66  _file(int_pose_f
-000136f0: 696c 652c 225c 7422 2c6f 7574 7075 745f  ile,"\t",output_
-00013700: 6865 6164 6572 5f70 6f73 6529 0a20 2020  header_pose).   
-00013710: 2020 2020 2020 2020 2020 2020 2065 7874               ext
-00013720: 7261 5f6d 7367 203d 2022 2c20 2220 2b20  ra_msg = ", " + 
-00013730: 696e 745f 706f 7365 5f66 696c 650a 2020  int_pose_file.  
-00013740: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00013750: 2054 7275 652c 2022 4f75 7470 7574 2066   True, "Output f
-00013760: 696c 6520 6578 6973 7473 3a20 222b 696e  ile exists: "+in
-00013770: 745f 6174 7475 7475 6465 5f66 696c 6520  t_attutude_file 
-00013780: 2b20 6578 7472 615f 6d73 670a 0a20 2020  + extra_msg..   
-00013790: 2020 2020 2069 6620 6e6f 7420 6f73 2e70       if not os.p
-000137a0: 6174 682e 6578 6973 7473 2861 7474 5f70  ath.exists(att_p
-000137b0: 6174 6829 3a0a 2020 2020 2020 2020 2020  ath):.          
-000137c0: 2020 7265 7475 726e 2046 616c 7365 2c20    return False, 
-000137d0: 2241 7474 6974 7564 6520 6669 6c65 206e  "Attitude file n
-000137e0: 6f74 2066 6f75 6e64 3a20 222b 6174 745f  ot found: "+att_
-000137f0: 7061 7468 0a0a 2020 2020 2020 2020 6966  path..        if
-00013800: 206e 6f74 206f 732e 7061 7468 2e65 7869   not os.path.exi
-00013810: 7374 7328 7365 6c66 2e69 6d61 6765 7344  sts(self.imagesD
-00013820: 6972 293a 0a20 2020 2020 2020 2020 2020  ir):.           
-00013830: 2072 6574 7572 6e20 4661 6c73 652c 2022   return False, "
-00013840: 496d 6167 6520 666f 6c64 6572 206e 6f74  Image folder not
-00013850: 2066 6f75 6e64 3a20 222b 2073 656c 662e   found: "+ self.
-00013860: 696d 6167 6573 4469 720a 0a20 2020 2020  imagesDir..     
-00013870: 2020 2073 203d 206d 6971 7463 2e50 7269     s = miqtc.Pri
-00013880: 6e74 4c6f 6164 696e 674d 7367 2822 4372  ntLoadingMsg("Cr
-00013890: 6561 7469 6e67 2069 7465 6d73 2720 6174  eating items' at
-000138a0: 7469 7475 6465 2064 6174 6122 290a 0a20  titude data").. 
-000138b0: 2020 2020 2020 2023 206c 6f61 6420 6672         # load fr
-000138c0: 616d 6520 6174 7469 7475 6465 2064 6174  ame attitude dat
-000138d0: 6120 6672 6f6d 2066 696c 650a 2020 2020  a from file.    
-000138e0: 2020 2020 6174 745f 6461 7461 2c20 7061      att_data, pa
-000138f0: 7273 654d 7367 203d 206d 6971 746e 2e72  rseMsg = miqtn.r
-00013900: 6561 6441 6c6c 4174 7469 7475 6465 7346  eadAllAttitudesF
-00013910: 726f 6d46 696c 6550 6174 6828 6174 745f  romFilePath(att_
-00013920: 7061 7468 2c20 6672 616d 655f 6174 745f  path, frame_att_
-00013930: 6865 6164 6572 2c20 6461 7465 5f66 6f72  header, date_for
-00013940: 6d61 742c 636f 6c5f 7365 7061 7261 746f  mat,col_separato
-00013950: 723d 636f 6c5f 7365 7061 7261 746f 722c  r=col_separator,
-00013960: 636f 6e73 745f 7661 6c75 6573 3d63 6f6e  const_values=con
-00013970: 7374 5f76 616c 7565 732c 616e 676c 6573  st_values,angles
-00013980: 496e 5261 643d 6174 745f 7061 7468 5f61  InRad=att_path_a
-00013990: 6e67 6c65 735f 696e 5f72 6164 290a 2020  ngles_in_rad).  
-000139a0: 2020 2020 2020 6966 2070 6172 7365 4d73        if parseMs
-000139b0: 6720 213d 2022 223a 0a20 2020 2020 2020  g != "":.       
-000139c0: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
-000139d0: 6f67 2870 6172 7365 4d73 672c 646f 6e74  og(parseMsg,dont
-000139e0: 5368 6f77 3d54 7275 6529 0a20 2020 2020  Show=True).     
-000139f0: 2020 2020 2020 2070 6172 7365 4d73 6720         parseMsg 
-00013a00: 3d20 225c 6e22 202b 2070 6172 7365 4d73  = "\n" + parseMs
-00013a10: 670a 0a20 2020 2020 2020 2023 2066 696e  g..        # fin
-00013a20: 6420 666f 7220 6561 6368 2069 6d61 6765  d for each image
-00013a30: 2074 6865 2072 6573 7065 6374 6976 6520   the respective 
-00013a40: 6e61 7669 6761 7469 6f6e 2064 6174 610a  navigation data.
-00013a50: 2020 2020 2020 2020 732e 7374 6f70 2829          s.stop()
-00013a60: 0a20 2020 2020 2020 2073 7563 6365 7373  .        success
-00013a70: 2c20 696d 6167 655f 6474 732c 206d 7367  , image_dts, msg
-00013a80: 203d 2073 656c 662e 6669 6e64 4e61 7644   = self.findNavD
-00013a90: 6174 6146 6f72 496d 6167 6528 6174 745f  ataForImage(att_
-00013aa0: 6461 7461 2c76 6964 656f 5361 6d70 6c65  data,videoSample
-00013ab0: 5365 636f 6e64 7329 0a20 2020 2020 2020  Seconds).       
-00013ac0: 2069 6620 6e6f 7420 7375 6363 6573 733a   if not success:
-00013ad0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00013ae0: 7572 6e20 4661 6c73 652c 206d 7367 202b  urn False, msg +
-00013af0: 2070 6172 7365 4d73 670a 2020 2020 2020   parseMsg.      
-00013b00: 2020 7320 3d20 6d69 7174 632e 5072 696e    s = miqtc.Prin
-00013b10: 744c 6f61 6469 6e67 4d73 6728 2243 7265  tLoadingMsg("Cre
-00013b20: 6174 696e 6720 6974 656d 7327 2061 7474  ating items' att
-00013b30: 6974 7564 6520 6461 7461 2229 0a0a 2020  itude data")..  
-00013b40: 2020 2020 2020 2320 6164 6420 6361 6d65        # add came
-00013b50: 7261 3246 7261 6d65 2061 6e67 6c65 730a  ra2Frame angles.
-00013b60: 2020 2020 2020 2020 525f 6361 6d32 6672          R_cam2fr
-00013b70: 616d 6520 3d20 6d69 7174 672e 525f 5961  ame = miqtg.R_Ya
-00013b80: 7750 6974 6368 526f 6c6c 2863 616d 6572  wPitchRoll(camer
-00013b90: 6132 4672 616d 655f 7961 772c 6361 6d65  a2Frame_yaw,came
-00013ba0: 7261 3246 7261 6d65 5f70 6974 6368 2c63  ra2Frame_pitch,c
-00013bb0: 616d 6572 6132 4672 616d 655f 726f 6c6c  amera2Frame_roll
-00013bc0: 290a 2020 2020 2020 2020 525f 6361 6d32  ).        R_cam2
-00013bd0: 7574 6d5f 6c69 7374 203d 205b 5d0a 2020  utm_list = [].  
-00013be0: 2020 2020 2020 666f 7220 6669 6c65 2069        for file i
-00013bf0: 6e20 696d 6167 655f 6474 733a 0a20 2020  n image_dts:.   
-00013c00: 2020 2020 2020 2020 2066 6f72 2074 696d           for tim
-00013c10: 6570 6f69 6e74 2069 6e20 696d 6167 655f  epoint in image_
-00013c20: 6474 735b 6669 6c65 5d3a 0a20 2020 2020  dts[file]:.     
-00013c30: 2020 2020 2020 2020 2020 2061 7474 6974             attit
-00013c40: 7564 6520 3d20 7469 6d65 706f 696e 740a  ude = timepoint.
-00013c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013c60: 6966 2061 7474 6974 7564 652e 7961 7720  if attitude.yaw 
-00013c70: 6973 204e 6f6e 6520 6f72 2061 7474 6974  is None or attit
-00013c80: 7564 652e 7069 7463 6820 6973 204e 6f6e  ude.pitch is Non
-00013c90: 6520 6f72 2061 7474 6974 7564 652e 726f  e or attitude.ro
-00013ca0: 6c6c 2069 7320 4e6f 6e65 3a0a 2020 2020  ll is None:.    
-00013cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013cc0: 525f 6361 6d32 7574 6d5f 6c69 7374 2e61  R_cam2utm_list.a
-00013cd0: 7070 656e 6428 2222 290a 2020 2020 2020  ppend("").      
-00013ce0: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00013cf0: 6e74 696e 7565 0a20 2020 2020 2020 2020  ntinue.         
-00013d00: 2020 2020 2020 2052 5f66 7261 6d65 326e         R_frame2n
-00013d10: 6564 203d 206d 6971 7467 2e52 5f59 6177  ed = miqtg.R_Yaw
-00013d20: 5069 7463 6852 6f6c 6c28 6174 7469 7475  PitchRoll(attitu
-00013d30: 6465 2e79 6177 2c61 7474 6974 7564 652e  de.yaw,attitude.
-00013d40: 7069 7463 682c 6174 7469 7475 6465 2e72  pitch,attitude.r
-00013d50: 6f6c 6c29 0a20 2020 2020 2020 2020 2020  oll).           
-00013d60: 2020 2020 2052 5f63 616d 326e 6564 203d       R_cam2ned =
-00013d70: 2052 5f66 7261 6d65 326e 6564 2e64 6f74   R_frame2ned.dot
-00013d80: 2852 5f63 616d 3266 7261 6d65 290a 2020  (R_cam2frame).  
-00013d90: 2020 2020 2020 2020 2020 2020 2020 7961                ya
-00013da0: 772c 7069 7463 682c 726f 6c6c 203d 206d  w,pitch,roll = m
-00013db0: 6971 7467 2e79 6177 5069 7463 6852 6f6c  iqtg.yawPitchRol
-00013dc0: 6c28 525f 6361 6d32 6e65 6429 0a20 2020  l(R_cam2ned).   
-00013dd0: 2020 2020 2020 2020 2020 2020 2061 7474               att
-00013de0: 6974 7564 652e 7961 7720 3d20 7961 770a  itude.yaw = yaw.
-00013df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013e00: 6174 7469 7475 6465 2e70 6974 6368 203d  attitude.pitch =
-00013e10: 2070 6974 6368 0a20 2020 2020 2020 2020   pitch.         
-00013e20: 2020 2020 2020 2061 7474 6974 7564 652e         attitude.
-00013e30: 726f 6c6c 203d 2072 6f6c 6c0a 0a20 2020  roll = roll..   
-00013e40: 2020 2020 2020 2020 2020 2020 2052 5f63               R_c
-00013e50: 616d 5374 6432 7574 6d20 3d20 7365 6c66  amStd2utm = self
-00013e60: 2e67 6574 5f52 5f63 616d 5374 6432 7574  .get_R_camStd2ut
-00013e70: 6d28 525f 6361 6d32 6672 616d 652c 525f  m(R_cam2frame,R_
-00013e80: 6672 616d 6532 6e65 6429 0a20 2020 2020  frame2ned).     
-00013e90: 2020 2020 2020 2020 2020 2052 5f63 616d             R_cam
-00013ea0: 3275 746d 5f6c 6973 742e 6170 7065 6e64  2utm_list.append
-00013eb0: 2852 5f63 616d 5374 6432 7574 6d2e 666c  (R_camStd2utm.fl
-00013ec0: 6174 7465 6e28 292e 746f 6c69 7374 2829  atten().tolist()
-00013ed0: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00013ee0: 7072 6f76 2e6c 6f67 2822 6170 706c 6965  prov.log("applie
-00013ef0: 6420 6672 616d 6520 746f 2063 616d 6572  d frame to camer
-00013f00: 6120 726f 7461 7469 6f6e 2079 6177 2c70  a rotation yaw,p
-00013f10: 6974 6368 2c72 6f6c 6c20 3d20 2220 2b20  itch,roll = " + 
-00013f20: 7374 7228 6361 6d65 7261 3246 7261 6d65  str(camera2Frame
-00013f30: 5f79 6177 2920 2b20 222c 2220 2b20 7374  _yaw) + "," + st
-00013f40: 7228 6361 6d65 7261 3246 7261 6d65 5f70  r(camera2Frame_p
-00013f50: 6974 6368 2920 2b20 222c 2220 2b20 7374  itch) + "," + st
-00013f60: 7228 6361 6d65 7261 3246 7261 6d65 5f72  r(camera2Frame_r
-00013f70: 6f6c 6c29 2c64 6f6e 7453 686f 773d 5472  oll),dontShow=Tr
-00013f80: 7565 290a 0a20 2020 2020 2020 2069 6620  ue)..        if 
-00013f90: 6c65 6e28 696d 6167 655f 6474 7329 203e  len(image_dts) >
-00013fa0: 2030 3a0a 0a20 2020 2020 2020 2020 2020   0:..           
-00013fb0: 2023 2057 7269 7465 2074 6f20 6e61 7669   # Write to navi
-00013fc0: 6761 7469 6f6e 2074 7874 2066 696c 650a  gation txt file.
-00013fd0: 2020 2020 2020 2020 2020 2020 2320 6865              # he
-00013fe0: 6164 6572 0a20 2020 2020 2020 2020 2020  ader.           
-00013ff0: 2072 6573 203d 206f 7065 6e28 696e 745f   res = open(int_
-00014000: 6174 7475 7475 6465 5f66 696c 652c 2022  attutude_file, "
-00014010: 7722 290a 2020 2020 2020 2020 2020 2020  w").            
-00014020: 7265 732e 7772 6974 6528 6d69 7174 762e  res.write(miqtv.
-00014030: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
-00014040: 7174 275d 5b27 696d 6727 5d2b 225c 7422  qt']['img']+"\t"
-00014050: 2b6d 6971 7476 2e63 6f6c 5f68 6561 6465  +miqtv.col_heade
-00014060: 725b 276d 6172 6971 7427 5d5b 2775 7463  r['mariqt']['utc
-00014070: 275d 290a 2020 2020 2020 2020 2020 2020  ']).            
-00014080: 7265 732e 7772 6974 6528 225c 7422 2b6d  res.write("\t"+m
-00014090: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
-000140a0: 276d 6172 6971 7427 5d5b 2779 6177 275d  'mariqt']['yaw']
-000140b0: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-000140c0: 732e 7772 6974 6528 225c 7422 2b6d 6971  s.write("\t"+miq
-000140d0: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
-000140e0: 6172 6971 7427 5d5b 2770 6974 6368 275d  ariqt']['pitch']
-000140f0: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-00014100: 732e 7772 6974 6528 225c 7422 2b6d 6971  s.write("\t"+miq
-00014110: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
-00014120: 6172 6971 7427 5d5b 2772 6f6c 6c27 5d29  ariqt']['roll'])
-00014130: 0a0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-00014140: 732e 7772 6974 6528 225c 6e22 290a 2020  s.write("\n").  
-00014150: 2020 2020 2020 2020 2020 2320 6461 7461            # data
-00014160: 206c 696e 6573 0a20 2020 2020 2020 2020   lines.         
-00014170: 2020 2066 6f72 2066 696c 6520 696e 2069     for file in i
-00014180: 6d61 6765 5f64 7473 3a0a 2020 2020 2020  mage_dts:.      
-00014190: 2020 2020 2020 2020 2020 666f 7220 7469            for ti
-000141a0: 6d65 706f 696e 7420 696e 2069 6d61 6765  mepoint in image
-000141b0: 5f64 7473 5b66 696c 655d 3a0a 2020 2020  _dts[file]:.    
-000141c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000141d0: 7265 732e 7772 6974 6528 6669 6c65 2b22  res.write(file+"
-000141e0: 5c74 222b 7469 6d65 706f 696e 742e 6461  \t"+timepoint.da
-000141f0: 7465 5469 6d65 2829 2e73 7472 6674 696d  teTime().strftim
-00014200: 6528 6d69 7174 762e 6461 7465 5f66 6f72  e(miqtv.date_for
-00014210: 6d61 7473 5b27 6d61 7269 7174 275d 2929  mats['mariqt']))
-00014220: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-00014230: 2020 2020 2020 7661 6c20 3d20 7469 6d65        val = time
-00014240: 706f 696e 742e 7961 770a 2020 2020 2020  point.yaw.      
-00014250: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00014260: 2027 7961 7727 2069 6e20 7265 636f 7264   'yaw' in record
-00014270: 7332 6265 496e 7665 7274 6564 3a0a 2020  s2beInverted:.  
-00014280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014290: 2020 2020 2020 7661 6c20 2a3d 202d 310a        val *= -1.
+00011630: 2020 2020 696d 6167 654d 6f64 5469 6d65      imageModTime
+00011640: 203d 206f 732e 7061 7468 2e67 6574 6d74   = os.path.getmt
+00011650: 696d 6528 696d 6167 6529 0a20 2020 2020  ime(image).     
+00011660: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00011670: 6620 6e6f 7420 6861 7264 2061 6e64 2069  f not hard and i
+00011680: 6d61 6765 4d6f 6454 696d 6520 3c20 6861  mageModTime < ha
+00011690: 7368 4669 6c65 4d6f 6454 696d 653a 0a20  shFileModTime:. 
+000116a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000116b0: 2020 2020 2020 2069 6620 6e6f 7420 6f73         if not os
+000116c0: 2e70 6174 682e 6261 7365 6e61 6d65 2869  .path.basename(i
+000116d0: 6d61 6765 2920 696e 2068 6173 6865 733a  mage) in hashes:
+000116e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000116f0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00011700: 7261 6973 6545 7863 6570 7469 6f6e 3a0a  raiseException:.
+00011710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011730: 7261 6973 6520 6d69 7174 632e 4966 646f  raise miqtc.Ifdo
+00011740: 4578 6365 7074 696f 6e28 6974 656d 2c20  Exception(item, 
+00011750: 226e 6f74 2066 6f75 6e64 2069 6e20 696e  "not found in in
+00011760: 7465 726d 6569 6461 7465 2068 6173 6820  termeidate hash 
+00011770: 6669 6c65 222c 7365 6c66 2e67 6574 5f69  file",self.get_i
+00011780: 6e74 5f68 6173 685f 6669 6c65 2829 2c22  nt_hash_file(),"
+00011790: 2072 756e 2063 7265 6174 655f 696d 6167   run create_imag
+000117a0: 655f 7368 6132 3536 5f66 696c 6528 2920  e_sha256_file() 
+000117b0: 6669 7273 7422 2920 0a20 2020 2020 2020  first") .       
+000117c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000117d0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+000117e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000117f0: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+00011800: 7469 6f6e 4c69 7374 2e61 7070 656e 6428  tionList.append(
+00011810: 5b66 696c 654e 616d 652c 226e 6f74 2066  [fileName,"not f
+00011820: 6f75 6e64 2069 6e20 696e 7465 726d 6569  ound in intermei
+00011830: 6461 7465 2068 6173 6820 6669 6c65 2022  date hash file "
+00011840: 202b 2073 7472 2873 656c 662e 6765 745f   + str(self.get_
+00011850: 696e 745f 6861 7368 5f66 696c 6528 2929  int_hash_file())
+00011860: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
+00011870: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+00011880: 7420 6974 656d 456e 7472 795b 2769 6d61  t itemEntry['ima
+00011890: 6765 2d68 6173 682d 7368 6132 3536 275d  ge-hash-sha256']
+000118a0: 203d 3d20 6861 7368 6573 5b6f 732e 7061   == hashes[os.pa
+000118b0: 7468 2e62 6173 656e 616d 6528 696d 6167  th.basename(imag
+000118c0: 6529 5d5b 2769 6d61 6765 2d68 6173 682d  e)]['image-hash-
+000118d0: 7368 6132 3536 275d 3a0a 2020 2020 2020  sha256']:.      
+000118e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000118f0: 2020 2020 2020 6966 2072 6169 7365 4578        if raiseEx
+00011900: 6365 7074 696f 6e3a 0a20 2020 2020 2020  ception:.       
+00011910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011920: 2020 2020 2020 2020 2072 6169 7365 206d           raise m
+00011930: 6971 7463 2e49 6664 6f45 7863 6570 7469  iqtc.IfdoExcepti
+00011940: 6f6e 2869 7465 6d2c 2022 696e 636f 7272  on(item, "incorr
+00011950: 6563 7420 7368 6132 3536 2068 6173 6822  ect sha256 hash"
+00011960: 2c20 6974 656d 456e 7472 795b 2769 6d61  , itemEntry['ima
+00011970: 6765 2d68 6173 682d 7368 6132 3536 275d  ge-hash-sha256']
+00011980: 2c22 666f 7220 6669 6c65 222c 6669 6c65  ,"for file",file
+00011990: 4e61 6d65 2c22 2072 756e 2063 7265 6174  Name," run creat
+000119a0: 655f 696d 6167 655f 7368 6132 3536 5f66  e_image_sha256_f
+000119b0: 696c 6528 2920 6669 7273 7422 290a 2020  ile() first").  
+000119c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000119d0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+000119e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000119f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011a00: 6578 6365 7074 696f 6e4c 6973 742e 6170  exceptionList.ap
+00011a10: 7065 6e64 285b 6669 6c65 4e61 6d65 2c22  pend([fileName,"
+00011a20: 696e 636f 7272 6563 7420 7368 6132 3536  incorrect sha256
+00011a30: 2068 6173 6822 5d29 0a20 2020 2020 2020   hash"]).       
+00011a40: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
+00011a50: 6620 6e6f 7420 6974 656d 456e 7472 795b  f not itemEntry[
+00011a60: 2769 6d61 6765 2d68 6173 682d 7368 6132  'image-hash-sha2
+00011a70: 3536 275d 203d 3d20 6d69 7174 632e 7368  56'] == miqtc.sh
+00011a80: 6132 3536 4861 7368 4669 6c65 2869 6d61  a256HashFile(ima
+00011a90: 6765 293a 0a20 2020 2020 2020 2020 2020  ge):.           
+00011aa0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00011ab0: 7261 6973 6545 7863 6570 7469 6f6e 3a0a  raiseException:.
+00011ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011ad0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00011ae0: 6520 6d69 7174 632e 4966 646f 4578 6365  e miqtc.IfdoExce
+00011af0: 7074 696f 6e28 6974 656d 2c20 2269 6e63  ption(item, "inc
+00011b00: 6f72 7265 6374 2073 6861 3235 3620 6861  orrect sha256 ha
+00011b10: 7368 222c 2069 7465 6d45 6e74 7279 5b27  sh", itemEntry['
+00011b20: 696d 6167 652d 6861 7368 2d73 6861 3235  image-hash-sha25
+00011b30: 3627 5d2c 2266 6f72 2066 696c 6522 2c66  6'],"for file",f
+00011b40: 696c 654e 616d 652c 2220 7275 6e20 6372  ileName," run cr
+00011b50: 6561 7465 5f69 6d61 6765 5f73 6861 3235  eate_image_sha25
+00011b60: 365f 6669 6c65 2829 2066 6972 7374 2229  6_file() first")
+00011b70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011b80: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00011b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011ba0: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+00011bb0: 7469 6f6e 4c69 7374 2e61 7070 656e 6428  tionList.append(
+00011bc0: 5b66 696c 654e 616d 652c 2269 6e63 6f72  [fileName,"incor
+00011bd0: 7265 6374 2073 6861 3235 3620 6861 7368  rect sha256 hash
+00011be0: 225d 290a 2020 2020 2020 2020 2020 2020  "]).            
+00011bf0: 2020 2020 2020 2020 6272 6561 6b0a 2020          break.  
+00011c00: 2020 2020 2020 2020 2020 6966 2066 6f75            if fou
+00011c10: 6e64 3a0a 2020 2020 2020 2020 2020 2020  nd:.            
+00011c20: 2020 2020 6465 6c20 6861 7368 556e 6368      del hashUnch
+00011c30: 6563 6b49 6d61 6765 7349 6e52 6177 5b69  eckImagesInRaw[i
+00011c40: 6d61 6765 5d0a 2020 2020 2020 2020 2020  mage].          
+00011c50: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00011c60: 2020 2020 2020 2020 6966 2072 6169 7365          if raise
+00011c70: 4578 6365 7074 696f 6e3a 0a20 2020 2020  Exception:.     
+00011c80: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00011c90: 6169 7365 206d 6971 7463 2e49 6664 6f45  aise miqtc.IfdoE
+00011ca0: 7863 6570 7469 6f6e 2820 2269 6d61 6765  xception( "image
+00011cb0: 222c 2069 7465 6d2c 2022 6e6f 7420 666f  ", item, "not fo
+00011cc0: 756e 6420 696e 2064 6972 6563 746f 7279  und in directory
+00011cd0: 2773 2072 6177 2066 6f6c 6465 7221 2229  's raw folder!")
+00011ce0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011cf0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00011d00: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+00011d10: 7469 6f6e 4c69 7374 2e61 7070 656e 6428  tionList.append(
+00011d20: 5b66 696c 654e 616d 652c 2266 696c 6520  [fileName,"file 
+00011d30: 6e6f 7420 666f 756e 6422 5d29 0a20 2020  not found"]).   
+00011d40: 2020 2020 2070 726f 672e 636c 6561 7228       prog.clear(
+00011d50: 290a 2020 2020 2020 2020 6966 206e 6f74  ).        if not
+00011d60: 2072 6169 7365 4578 6365 7074 696f 6e3a   raiseException:
+00011d70: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00011d80: 7572 6e20 6578 6365 7074 696f 6e4c 6973  urn exceptionLis
+00011d90: 740a 0a0a 2020 2020 6465 6620 6372 6561  t...    def crea
+00011da0: 7465 5f75 7569 645f 6669 6c65 2873 656c  te_uuid_file(sel
+00011db0: 662c 636c 6561 6e3d 5472 7565 293a 0a20  f,clean=True):. 
+00011dc0: 2020 2020 2020 2022 2222 2043 7265 6174         """ Creat
+00011dd0: 6573 2069 6e20 2f69 6e74 6572 6d65 6469  es in /intermedi
+00011de0: 6174 6520 6120 7465 7874 2066 696c 6520  ate a text file 
+00011df0: 636f 6e74 6169 6e69 6e67 2070 6572 2069  containing per i
+00011e00: 6d61 6765 2061 2063 7265 6174 6564 2075  mage a created u
+00011e10: 7569 6420 2876 6572 7369 6f6e 2034 292e  uid (version 4).
+00011e20: 0a0a 2020 2020 2020 2020 5468 6520 5555  ..        The UU
+00011e30: 4944 2069 7320 6f6e 6c79 202a 7461 6b65  ID is only *take
+00011e40: 6e2a 2066 726f 6d20 7468 6520 6d65 7461  n* from the meta
+00011e50: 6461 7461 206f 6620 7468 6520 696d 6167  data of the imag
+00011e60: 6573 2e20 4974 2064 6f65 7320 6e6f 7420  es. It does not 
+00011e70: 7772 6974 6520 5555 4944 7320 746f 2074  write UUIDs to t
+00011e80: 6865 206d 6574 6164 6174 6120 696e 2063  he metadata in c
+00011e90: 6173 6520 736f 6d65 2066 696c 6573 2061  ase some files a
+00011ea0: 7265 206d 6973 7369 6e67 2069 742e 0a20  re missing it.. 
+00011eb0: 2020 2020 2020 2042 7574 2c20 6974 2063         But, it c
+00011ec0: 7265 6174 6573 2061 2043 5356 2066 696c  reates a CSV fil
+00011ed0: 6520 696e 2074 6861 7420 6361 7365 2074  e in that case t
+00011ee0: 6861 7420 796f 7520 6361 6e20 7573 6520  hat you can use 
+00011ef0: 746f 6765 7468 6572 2077 6974 6820 6578  together with ex
+00011f00: 6966 746f 6f6c 2074 6f20 6164 6420 7468  iftool to add th
+00011f10: 6520 5555 4944 2074 6f20 796f 7572 2064  e UUID to your d
+00011f20: 6174 612e 2042 6577 6172 6521 2074 6869  ata. Beware! thi
+00011f30: 7320 6361 6e20 6465 7374 726f 7920 796f  s can destroy yo
+00011f40: 7572 2069 6d61 6765 730a 2020 2020 2020  ur images.      
+00011f50: 2020 6966 206e 6f74 2064 6f6e 6520 7072    if not done pr
+00011f60: 6f70 6572 6c79 2120 4e6f 2067 7561 7261  operly! No guara
+00011f70: 6e74 6565 2069 7320 6769 7665 6e20 6974  ntee is given it
+00011f80: 2077 696c 6c20 776f 726b 2e20 4265 2063   will work. Be c
+00011f90: 6172 6566 756c 210a 0a20 2020 2020 2020  areful!..       
+00011fa0: 2055 7365 2063 6c65 616e 3d46 616c 7365   Use clean=False
+00011fb0: 2074 6f20 6e6f 7420 6368 6563 6b20 7468   to not check th
+00011fc0: 6f73 6520 6669 6c65 7320 6167 6169 6e20  ose files again 
+00011fd0: 7768 6963 6820 6172 6520 616c 7265 6164  which are alread
+00011fe0: 7920 666f 756e 6420 696e 2069 6e74 6572  y found in inter
+00011ff0: 6d65 6469 6174 6520 7575 6964 2066 696c  mediate uuid fil
+00012000: 650a 2020 2020 2020 2020 2222 220a 0a20  e.        """.. 
+00012010: 2020 2020 2020 2075 7569 6473 203d 207b         uuids = {
+00012020: 7d0a 2020 2020 2020 2020 2320 4368 6563  }.        # Chec
+00012030: 6b20 7768 6574 6865 7220 6120 6669 6c65  k whether a file
+00012040: 2077 6974 6820 5555 4944 7320 6578 6973   with UUIDs exis
+00012050: 7473 2c20 7468 656e 2072 6561 6420 6974  ts, then read it
+00012060: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+00012070: 636c 6561 6e20 616e 6420 6f73 2e70 6174  clean and os.pat
+00012080: 682e 6578 6973 7473 2873 656c 662e 6765  h.exists(self.ge
+00012090: 745f 696e 745f 7575 6964 5f66 696c 6528  t_int_uuid_file(
+000120a0: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
+000120b0: 7575 6964 7320 3d20 6d69 7174 662e 7461  uuids = miqtf.ta
+000120c0: 6246 696c 6544 6174 6128 7365 6c66 2e67  bFileData(self.g
+000120d0: 6574 5f69 6e74 5f75 7569 645f 6669 6c65  et_int_uuid_file
+000120e0: 2829 2c20 5b6d 6971 7476 2e63 6f6c 5f68  (), [miqtv.col_h
+000120f0: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
+00012100: 2769 6d67 275d 2c20 6d69 7174 762e 636f  'img'], miqtv.co
+00012110: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
+00012120: 275d 5b27 7575 6964 275d 5d2c 206b 6579  ']['uuid']], key
+00012130: 5f63 6f6c 3d6d 6971 7476 2e63 6f6c 5f68  _col=miqtv.col_h
+00012140: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
+00012150: 2769 6d67 275d 290a 2020 2020 2020 2020  'img']).        
+00012160: 2020 2020 0a20 2020 2020 2020 2069 6620      .        if 
+00012170: 6f73 2e70 6174 682e 6578 6973 7473 2873  os.path.exists(s
+00012180: 656c 662e 696d 6167 6573 4469 7229 3a0a  elf.imagesDir):.
+00012190: 0a20 2020 2020 2020 2020 2020 206d 6973  .            mis
+000121a0: 7369 6e67 5f75 7569 6473 203d 207b 7d0a  sing_uuids = {}.
+000121b0: 2020 2020 2020 2020 2020 2020 6164 6465              adde
+000121c0: 645f 7575 6964 7320 3d20 300a 0a20 2020  d_uuids = 0..   
+000121d0: 2020 2020 2020 2020 2075 6e6b 6e6f 776e           unknown
+000121e0: 4669 6c65 7320 3d20 5b5d 0a20 2020 2020  Files = [].     
+000121f0: 2020 2020 2020 2066 6f72 2066 696c 6520         for file 
+00012200: 696e 2073 656c 662e 696d 6167 6573 496e  in self.imagesIn
+00012210: 496d 6167 6573 4469 7228 293a 0a20 2020  ImagesDir():.   
+00012220: 2020 2020 2020 2020 2020 2020 2066 696c               fil
+00012230: 655f 6e61 6d65 203d 206f 732e 7061 7468  e_name = os.path
+00012240: 2e62 6173 656e 616d 6528 6669 6c65 290a  .basename(file).
+00012250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012260: 6966 2066 696c 655f 6e61 6d65 206e 6f74  if file_name not
+00012270: 2069 6e20 7575 6964 733a 0a20 2020 2020   in uuids:.     
+00012280: 2020 2020 2020 2020 2020 2020 2020 2075                 u
+00012290: 6e6b 6e6f 776e 4669 6c65 732e 6170 7065  nknownFiles.appe
+000122a0: 6e64 2866 696c 6529 0a20 2020 2020 2020  nd(file).       
+000122b0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+000122c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000122d0: 2020 2075 7569 6473 5b66 696c 655f 6e61     uuids[file_na
+000122e0: 6d65 5d20 3d20 7575 6964 735b 6669 6c65  me] = uuids[file
+000122f0: 5f6e 616d 655d 5b6d 6971 7476 2e63 6f6c  _name][miqtv.col
+00012300: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
+00012310: 5d5b 2775 7569 6427 5d5d 0a0a 2020 2020  ]['uuid']]..    
+00012320: 2020 2020 2020 2020 756e 6b6e 6f77 6e46          unknownF
+00012330: 696c 6573 5555 4944 7320 3d20 6d69 7174  ilesUUIDs = miqt
+00012340: 692e 696d 6167 6573 436f 6e74 6169 6e56  i.imagesContainV
+00012350: 616c 6964 5555 4944 2875 6e6b 6e6f 776e  alidUUID(unknown
+00012360: 4669 6c65 7329 0a20 2020 2020 2020 2020  Files).         
+00012370: 2020 2066 6f72 2066 696c 6520 696e 2075     for file in u
+00012380: 6e6b 6e6f 776e 4669 6c65 7355 5549 4473  nknownFilesUUIDs
+00012390: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000123a0: 2020 6669 6c65 5f6e 616d 6520 3d20 6f73    file_name = os
+000123b0: 2e70 6174 682e 6261 7365 6e61 6d65 2866  .path.basename(f
+000123c0: 696c 6529 0a20 2020 2020 2020 2020 2020  ile).           
+000123d0: 2020 2020 2069 6620 6e6f 7420 756e 6b6e       if not unkn
+000123e0: 6f77 6e46 696c 6573 5555 4944 735b 6669  ownFilesUUIDs[fi
+000123f0: 6c65 5d5b 2776 616c 6964 275d 3a0a 2020  le]['valid']:.  
+00012400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012410: 2020 7575 6964 203d 206d 6971 7463 2e75    uuid = miqtc.u
+00012420: 7569 6434 2829 0a20 2020 2020 2020 2020  uid4().         
+00012430: 2020 2020 2020 2020 2020 206d 6973 7369             missi
+00012440: 6e67 5f75 7569 6473 5b66 696c 655d 203d  ng_uuids[file] =
+00012450: 2075 7569 640a 2020 2020 2020 2020 2020   uuid.          
+00012460: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00012470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012480: 7575 6964 735b 6669 6c65 5f6e 616d 655d  uuids[file_name]
+00012490: 203d 2075 6e6b 6e6f 776e 4669 6c65 7355   = unknownFilesU
+000124a0: 5549 4473 5b66 696c 655d 5b27 7575 6964  UIDs[file]['uuid
+000124b0: 275d 0a20 2020 2020 2020 2020 2020 2020  '].             
+000124c0: 2020 2020 2020 2061 6464 6564 5f75 7569         added_uui
+000124d0: 6473 202b 3d20 310a 0a20 2020 2020 2020  ds += 1..       
+000124e0: 2020 2020 2023 2049 6620 7072 6576 696f       # If previo
+000124f0: 7573 6c79 2075 6e6b 6e6f 776e 2055 5549  usly unknown UUI
+00012500: 4473 2077 6572 6520 666f 756e 6420 696e  Ds were found in
+00012510: 2074 6865 2066 696c 6520 6865 6164 6572   the file header
+00012520: 732c 2061 6464 2074 6865 6d20 746f 2074  s, add them to t
+00012530: 6865 2055 5549 4420 6669 6c65 0a20 2020  he UUID file.   
+00012540: 2020 2020 2020 2020 2069 6620 6164 6465           if adde
+00012550: 645f 7575 6964 7320 3e20 303a 0a20 2020  d_uuids > 0:.   
+00012560: 2020 2020 2020 2020 2020 2020 2072 6573               res
+00012570: 203d 206f 7065 6e28 7365 6c66 2e67 6574   = open(self.get
+00012580: 5f69 6e74 5f75 7569 645f 6669 6c65 2829  _int_uuid_file()
+00012590: 2c20 2277 2229 0a20 2020 2020 2020 2020  , "w").         
+000125a0: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
+000125b0: 286d 6971 7476 2e63 6f6c 5f68 6561 6465  (miqtv.col_heade
+000125c0: 725b 276d 6172 6971 7427 5d5b 2769 6d67  r['mariqt']['img
+000125d0: 275d 202b 225c 7422 2b6d 6971 7476 2e63  '] +"\t"+miqtv.c
+000125e0: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
+000125f0: 7427 5d5b 2775 7569 6427 5d2b 225c 6e22  t']['uuid']+"\n"
+00012600: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00012610: 2020 666f 7220 6669 6c65 2069 6e20 7575    for file in uu
+00012620: 6964 733a 0a20 2020 2020 2020 2020 2020  ids:.           
+00012630: 2020 2020 2020 2020 2072 6573 2e77 7269           res.wri
+00012640: 7465 2866 696c 652b 225c 7422 2b73 7472  te(file+"\t"+str
+00012650: 2875 7569 6473 5b66 696c 655d 292b 225c  (uuids[file])+"\
+00012660: 6e22 290a 2020 2020 2020 2020 2020 2020  n").            
+00012670: 2020 2020 7265 732e 636c 6f73 6528 290a      res.close().
+00012680: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00012690: 6c65 6e28 6d69 7373 696e 675f 7575 6964  len(missing_uuid
+000126a0: 7329 203e 2030 3a0a 2020 2020 2020 2020  s) > 0:.        
+000126b0: 2020 2020 2020 2020 6563 7376 5f70 6174          ecsv_pat
+000126c0: 6820 3d20 7365 6c66 2e5f 5f67 6574 5f69  h = self.__get_i
+000126d0: 6e74 5f66 696c 655f 7072 6566 6978 2829  nt_file_prefix()
+000126e0: 202b 2022 5f65 7869 662d 6164 642d 7575   + "_exif-add-uu
+000126f0: 6964 2e63 7376 220a 2020 2020 2020 2020  id.csv".        
+00012700: 2020 2020 2020 2020 6373 7620 3d20 6f70          csv = op
+00012710: 656e 2865 6373 765f 7061 7468 2c20 2277  en(ecsv_path, "w
+00012720: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+00012730: 2020 2063 7376 2e77 7269 7465 286d 6971     csv.write(miq
+00012740: 7476 2e63 6f6c 5f68 6561 6465 725b 2765  tv.col_header['e
+00012750: 7869 6627 5d5b 2769 6d67 275d 202b 0a20  xif']['img'] +. 
+00012760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012770: 2020 2020 2020 2020 2022 2c22 2b6d 6971           ","+miq
+00012780: 7476 2e63 6f6c 5f68 6561 6465 725b 2765  tv.col_header['e
+00012790: 7869 6627 5d5b 2775 7569 6427 5d2b 225c  xif']['uuid']+"\
+000127a0: 6e22 290a 2020 2020 2020 2020 2020 2020  n").            
+000127b0: 2020 2020 6469 6666 6572 656e 745f 7061      different_pa
+000127c0: 7468 7320 3d20 5b5d 0a20 2020 2020 2020  ths = [].       
+000127d0: 2020 2020 2020 2020 2066 6f72 2069 6d67           for img
+000127e0: 2069 6e20 6d69 7373 696e 675f 7575 6964   in missing_uuid
+000127f0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+00012800: 2020 2020 2020 2069 6620 6f73 2e70 6174         if os.pat
+00012810: 682e 6261 7365 6e61 6d65 2869 6d67 2920  h.basename(img) 
+00012820: 6e6f 7420 696e 2064 6966 6665 7265 6e74  not in different
+00012830: 5f70 6174 6873 3a0a 2020 2020 2020 2020  _paths:.        
+00012840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012850: 6469 6666 6572 656e 745f 7061 7468 732e  different_paths.
+00012860: 6170 7065 6e64 286f 732e 7061 7468 2e62  append(os.path.b
+00012870: 6173 656e 616d 6528 696d 6729 290a 2020  asename(img)).  
+00012880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012890: 2020 6373 762e 7772 6974 6528 696d 672b    csv.write(img+
+000128a0: 222c 222b 7374 7228 6d69 7373 696e 675f  ","+str(missing_
+000128b0: 7575 6964 735b 696d 675d 292b 225c 6e22  uuids[img])+"\n"
+000128c0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000128d0: 2020 2372 6574 7572 6e20 4661 6c73 652c    #return False,
+000128e0: 2022 6578 6966 746f 6f6c 202d 6373 763d   "exiftool -csv=
+000128f0: 222b 6563 7376 5f70 6174 682b 2220 222b  "+ecsv_path+" "+
+00012900: 2220 222e 6a6f 696e 2864 6966 6665 7265  " ".join(differe
+00012910: 6e74 5f70 6174 6873 290a 2020 2020 2020  nt_paths).      
+00012920: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00012930: 2046 616c 7365 2c20 224e 6f74 2061 6c6c   False, "Not all
+00012940: 2069 6d61 6765 7320 6861 7665 2076 616c   images have val
+00012950: 6964 2055 5549 4473 2e20 4d69 7373 696e  id UUIDs. Missin
+00012960: 6720 666f 7220 666f 6c6c 6f77 696e 6720  g for following 
+00012970: 6669 6c65 733a 5c6e 222b 225c c586 222e  files:\n"+"\..".
+00012980: 6a6f 696e 2864 6966 6665 7265 6e74 5f70  join(different_p
+00012990: 6174 6873 290a 2020 2020 2020 2020 2020  aths).          
+000129a0: 2020 0a20 2020 2020 2020 2020 2020 2073    .            s
+000129b0: 656c 662e 5f5f 616c 6c55 5549 4473 4368  elf.__allUUIDsCh
+000129c0: 6563 6b65 6420 3d20 5472 7565 0a20 2020  ecked = True.   
+000129d0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+000129e0: 5472 7565 2c20 2241 6c6c 2069 6d61 6765  True, "All image
+000129f0: 7320 6861 7665 2061 2055 5549 4422 0a20  s have a UUID". 
+00012a00: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
+00012a10: 6c73 652c 2022 5061 7468 2022 2b73 656c  lse, "Path "+sel
+00012a20: 662e 696d 6167 6573 4469 7220 2b20 2220  f.imagesDir + " 
+00012a30: 6e6f 7420 666f 756e 642e 220a 0a20 2020  not found."..   
+00012a40: 2064 6566 2063 7265 6174 6555 5549 4446   def createUUIDF
+00012a50: 696c 6528 7365 6c66 2c63 6c65 616e 3d54  ile(self,clean=T
+00012a60: 7275 6529 3a0a 2020 2020 2020 2020 2222  rue):.        ""
+00012a70: 2220 4465 7072 6563 6174 6564 202d 2075  " Deprecated - u
+00012a80: 7365 2063 7265 6174 655f 7575 6964 5f66  se create_uuid_f
+00012a90: 696c 6520 2222 220a 2020 2020 2020 2020  ile """.        
+00012aa0: 7265 7475 726e 2073 656c 662e 6372 6561  return self.crea
+00012ab0: 7465 5f75 7569 645f 6669 6c65 2863 6c65  te_uuid_file(cle
+00012ac0: 616e 290a 0a0a 2020 2020 6465 6620 7365  an)...    def se
+00012ad0: 745f 696d 6167 655f 7365 745f 6174 7469  t_image_set_atti
+00012ae0: 7475 6465 2873 656c 662c 7961 775f 6672  tude(self,yaw_fr
+00012af0: 616d 653a 666c 6f61 742c 7069 7463 685f  ame:float,pitch_
+00012b00: 6672 616d 653a 666c 6f61 742c 726f 6c6c  frame:float,roll
+00012b10: 5f66 7261 6d65 3a66 6c6f 6174 2c79 6177  _frame:float,yaw
+00012b20: 5f63 616d 3266 7261 6d65 3a66 6c6f 6174  _cam2frame:float
+00012b30: 2c70 6974 6368 5f63 616d 3266 7261 6d65  ,pitch_cam2frame
+00012b40: 3a66 6c6f 6174 2c72 6f6c 6c5f 6361 6d32  :float,roll_cam2
+00012b50: 6672 616d 653a 666c 6f61 7429 3a0a 2020  frame:float):.  
+00012b60: 2020 2020 2020 2222 2220 6361 6c63 756c        """ calcul
+00012b70: 6174 6573 2074 6865 2074 6865 2063 616d  ates the the cam
+00012b80: 6572 6173 2061 6273 6f6c 7574 6520 6174  eras absolute at
+00012b90: 7469 7475 6465 2061 6e64 2073 6574 7320  titude and sets 
+00012ba0: 6974 2074 6f20 696d 6167 6520 7365 7420  it to image set 
+00012bb0: 6865 6164 6572 2e20 416c 6c20 616e 676c  header. All angl
+00012bc0: 6573 2061 7265 2065 7870 6563 7465 6420  es are expected 
+00012bd0: 696e 2064 6567 7265 6573 2e20 0a20 2020  in degrees. .   
+00012be0: 2020 2020 2063 616d 6572 6132 6672 616d       camera2fram
+00012bf0: 6520 616e 676c 6573 3a20 726f 7461 7469  e angles: rotati
+00012c00: 6f6e 206f 6620 6361 6d65 7261 2063 6f6f  on of camera coo
+00012c10: 7264 696e 6174 6573 2028 782c 792c 7a20  rdinates (x,y,z 
+00012c20: 3d20 746f 702c 2072 6967 6874 2c20 6c69  = top, right, li
+00012c30: 6e65 206f 6620 7369 6768 7429 2077 6974  ne of sight) wit
+00012c40: 6820 7265 7370 6563 7420 746f 2076 6568  h respect to veh
+00012c50: 6963 6c65 2063 6f6f 7264 696e 6174 6573  icle coordinates
+00012c60: 2028 782c 792c 7a20 3d20 666f 7277 6172   (x,y,z = forwar
+00012c70: 642c 7269 6768 742c 646f 776e 2920 0a20  d,right,down) . 
+00012c80: 2020 2020 2020 2069 6e20 6163 636f 7264         in accord
+00012c90: 616e 6365 2077 6974 6820 7468 6520 7961  ance with the ya
+00012ca0: 772c 7069 7463 682c 726f 6c6c 2072 6f74  w,pitch,roll rot
+00012cb0: 6174 696f 6e20 6f72 6465 7220 636f 6e76  ation order conv
+00012cc0: 656e 7469 6f6e 3a0a 0a20 2020 2020 2020  ention:..       
+00012cd0: 2031 2e20 7961 7720 6172 6f75 6e64 207a   1. yaw around z
+00012ce0: 2c0a 2020 2020 2020 2020 322e 2070 6974  ,.        2. pit
+00012cf0: 6368 2061 726f 756e 6420 726f 7461 7465  ch around rotate
+00012d00: 6420 792c 0a20 2020 2020 2020 2033 2e20  d y,.        3. 
+00012d10: 726f 6c6c 2061 726f 756e 6420 726f 7461  roll around rota
+00012d20: 7465 6420 780a 0a20 2020 2020 2020 2052  ted x..        R
+00012d30: 6f74 6174 696f 6e20 6469 7265 6374 696f  otation directio
+00012d40: 6e73 2061 6363 6f72 6469 6e67 2074 6f20  ns according to 
+00012d50: 5c27 7269 6768 742d 6861 6e64 2072 756c  \'right-hand rul
+00012d60: 655c 272e 0a0a 2020 2020 2020 2020 492e  e\'...        I.
+00012d70: 652e 2063 616d 6572 6132 4672 616d 6520  e. camera2Frame 
+00012d80: 616e 676c 6573 203d 2030 2c30 2c30 2063  angles = 0,0,0 c
+00012d90: 616d 6572 6120 6973 2066 6163 696e 6720  amera is facing 
+00012da0: 646f 776e 7761 7264 2077 6974 6820 746f  downward with to
+00012db0: 7020 7369 6465 2074 6f77 6172 6473 2076  p side towards v
+00012dc0: 6568 6963 6c65 2773 2066 6f72 7761 7264  ehicle's forward
+00012dd0: 2064 6972 6563 7469 6f6e 2720 2222 220a   direction' """.
+00012de0: 0a20 2020 2020 2020 2052 5f66 7261 6d65  .        R_frame
+00012df0: 326e 6564 203d 206d 6971 7467 2e52 5f59  2ned = miqtg.R_Y
+00012e00: 6177 5069 7463 6852 6f6c 6c28 7961 775f  awPitchRoll(yaw_
+00012e10: 6672 616d 652c 7069 7463 685f 6672 616d  frame,pitch_fram
+00012e20: 652c 726f 6c6c 5f66 7261 6d65 290a 2020  e,roll_frame).  
+00012e30: 2020 2020 2020 525f 6361 6d32 6672 616d        R_cam2fram
+00012e40: 6520 3d20 6d69 7174 672e 525f 5961 7750  e = miqtg.R_YawP
+00012e50: 6974 6368 526f 6c6c 2879 6177 5f63 616d  itchRoll(yaw_cam
+00012e60: 3266 7261 6d65 2c70 6974 6368 5f63 616d  2frame,pitch_cam
+00012e70: 3266 7261 6d65 2c72 6f6c 6c5f 6361 6d32  2frame,roll_cam2
+00012e80: 6672 616d 6529 0a20 2020 2020 2020 2052  frame).        R
+00012e90: 5f63 616d 326e 6564 203d 2052 5f66 7261  _cam2ned = R_fra
+00012ea0: 6d65 326e 6564 2e64 6f74 2852 5f63 616d  me2ned.dot(R_cam
+00012eb0: 3266 7261 6d65 290a 2020 2020 2020 2020  2frame).        
+00012ec0: 7961 772c 7069 7463 682c 726f 6c6c 203d  yaw,pitch,roll =
+00012ed0: 206d 6971 7467 2e79 6177 5069 7463 6852   miqtg.yawPitchR
+00012ee0: 6f6c 6c28 525f 6361 6d32 6e65 6429 0a0a  oll(R_cam2ned)..
+00012ef0: 2020 2020 2020 2020 2320 706f 7365 206d          # pose m
+00012f00: 6174 7269 7820 6361 6d32 7574 6d0a 2020  atrix cam2utm.  
+00012f10: 2020 2020 2020 525f 6361 6d53 7464 3275        R_camStd2u
+00012f20: 746d 203d 2073 656c 662e 6765 745f 525f  tm = self.get_R_
+00012f30: 6361 6d53 7464 3275 746d 2852 5f63 616d  camStd2utm(R_cam
+00012f40: 3266 7261 6d65 2c52 5f66 7261 6d65 326e  2frame,R_frame2n
+00012f50: 6564 290a 0a20 2020 2020 2020 2022 2222  ed)..        """
+00012f60: 0a20 2020 2020 2020 2078 203d 206e 702e  .        x = np.
+00012f70: 6172 7261 7928 5b31 2c30 2c30 5d29 0a20  array([1,0,0]). 
+00012f80: 2020 2020 2020 2079 203d 206e 702e 6172         y = np.ar
+00012f90: 7261 7928 5b30 2c31 2c30 5d29 0a20 2020  ray([0,1,0]).   
+00012fa0: 2020 2020 207a 203d 206e 702e 6172 7261       z = np.arra
+00012fb0: 7928 5b30 2c30 2c31 5d29 0a20 2020 2020  y([0,0,1]).     
+00012fc0: 2020 2070 7269 6e74 2827 7827 2c52 5f63     print('x',R_c
+00012fd0: 616d 5374 6432 7574 6d2e 646f 7428 7829  amStd2utm.dot(x)
+00012fe0: 2e72 6f75 6e64 2835 2929 0a20 2020 2020  .round(5)).     
+00012ff0: 2020 2070 7269 6e74 2827 7927 2c52 5f63     print('y',R_c
+00013000: 616d 5374 6432 7574 6d2e 646f 7428 7929  amStd2utm.dot(y)
+00013010: 2e72 6f75 6e64 2835 2929 0a20 2020 2020  .round(5)).     
+00013020: 2020 2070 7269 6e74 2827 7a27 2c52 5f63     print('z',R_c
+00013030: 616d 5374 6432 7574 6d2e 646f 7428 7a29  amStd2utm.dot(z)
+00013040: 2e72 6f75 6e64 2835 2929 0a20 2020 2020  .round(5)).     
+00013050: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
+00013060: 6865 6164 6572 5570 6461 7465 203d 207b  headerUpdate = {
+00013070: 0a20 2020 2020 2020 2020 2020 206d 6971  .            miq
+00013080: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
+00013090: 6172 6971 7427 5d5b 2779 6177 275d 3a79  ariqt']['yaw']:y
+000130a0: 6177 2c0a 2020 2020 2020 2020 2020 2020  aw,.            
+000130b0: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
+000130c0: 5b27 6d61 7269 7174 275d 5b27 7069 7463  ['mariqt']['pitc
+000130d0: 6827 5d3a 7069 7463 682c 0a20 2020 2020  h']:pitch,.     
+000130e0: 2020 2020 2020 206d 6971 7476 2e63 6f6c         miqtv.col
+000130f0: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
+00013100: 5d5b 2772 6f6c 6c27 5d3a 726f 6c6c 2c0a  ]['roll']:roll,.
+00013110: 2020 2020 2020 2020 2020 2020 6d69 7174              miqt
+00013120: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
+00013130: 7269 7174 275d 5b27 706f 7365 275d 3a7b  riqt']['pose']:{
+00013140: 2770 6f73 652d 6162 736f 6c75 7465 2d6f  'pose-absolute-o
+00013150: 7269 656e 7461 7469 6f6e 2d75 746d 2d6d  rientation-utm-m
+00013160: 6174 7269 7827 3a52 5f63 616d 5374 6432  atrix':R_camStd2
+00013170: 7574 6d2e 666c 6174 7465 6e28 292e 746f  utm.flatten().to
+00013180: 6c69 7374 2829 7d0a 2020 2020 2020 2020  list()}.        
+00013190: 7d0a 2020 2020 2020 2020 7365 6c66 2e75  }.        self.u
+000131a0: 7064 6174 655f 6966 646f 5f68 6561 6465  pdate_ifdo_heade
+000131b0: 725f 6669 656c 6473 2868 6561 6465 7255  r_fields(headerU
+000131c0: 7064 6174 6529 0a0a 2020 2020 6465 6620  pdate)..    def 
+000131d0: 7365 7449 6d61 6765 5365 7441 7474 6974  setImageSetAttit
+000131e0: 7564 6528 7365 6c66 2c79 6177 5f66 7261  ude(self,yaw_fra
+000131f0: 6d65 3a66 6c6f 6174 2c70 6974 6368 5f66  me:float,pitch_f
+00013200: 7261 6d65 3a66 6c6f 6174 2c72 6f6c 6c5f  rame:float,roll_
+00013210: 6672 616d 653a 666c 6f61 742c 7961 775f  frame:float,yaw_
+00013220: 6361 6d32 6672 616d 653a 666c 6f61 742c  cam2frame:float,
+00013230: 7069 7463 685f 6361 6d32 6672 616d 653a  pitch_cam2frame:
+00013240: 666c 6f61 742c 726f 6c6c 5f63 616d 3266  float,roll_cam2f
+00013250: 7261 6d65 3a66 6c6f 6174 293a 0a20 2020  rame:float):.   
+00013260: 2020 2020 2022 2222 2044 6570 7265 6361       """ Depreca
+00013270: 7465 6420 2d20 7573 6520 7365 745f 696d  ted - use set_im
+00013280: 6167 655f 7365 745f 6174 7469 7475 6465  age_set_attitude
+00013290: 2022 2222 0a20 2020 2020 2020 2073 656c   """.        sel
+000132a0: 662e 7365 745f 696d 6167 655f 7365 745f  f.set_image_set_
+000132b0: 6174 7469 7475 6465 2879 6177 5f66 7261  attitude(yaw_fra
+000132c0: 6d65 2c20 7069 7463 685f 6672 616d 652c  me, pitch_frame,
+000132d0: 2072 6f6c 6c5f 6672 616d 652c 2079 6177   roll_frame, yaw
+000132e0: 5f63 616d 3266 7261 6d65 2c20 7069 7463  _cam2frame, pitc
+000132f0: 685f 6361 6d32 6672 616d 652c 2072 6f6c  h_cam2frame, rol
+00013300: 6c5f 6361 6d32 6672 616d 6529 0a0a 0a20  l_cam2frame)... 
+00013310: 2020 2064 6566 2063 7265 6174 655f 696d     def create_im
+00013320: 6167 655f 6174 7469 7475 6465 5f66 696c  age_attitude_fil
+00013330: 6528 7365 6c66 2c20 6174 745f 7061 7468  e(self, att_path
+00013340: 3a73 7472 2c20 6672 616d 655f 6174 745f  :str, frame_att_
+00013350: 6865 6164 6572 3a64 6963 742c 2063 616d  header:dict, cam
+00013360: 6572 6132 4672 616d 655f 7961 773a 666c  era2Frame_yaw:fl
+00013370: 6f61 742c 6361 6d65 7261 3246 7261 6d65  oat,camera2Frame
+00013380: 5f70 6974 6368 3a66 6c6f 6174 2c63 616d  _pitch:float,cam
+00013390: 6572 6132 4672 616d 655f 726f 6c6c 3a66  era2Frame_roll:f
+000133a0: 6c6f 6174 2c0a 2020 2020 2020 2020 2020  loat,.          
+000133b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000133c0: 2020 2020 2020 6461 7465 5f66 6f72 6d61        date_forma
+000133d0: 743d 6d69 7174 762e 6461 7465 5f66 6f72  t=miqtv.date_for
+000133e0: 6d61 7473 5b27 7061 6e67 6165 6127 5d2c  mats['pangaea'],
+000133f0: 2063 6f6e 7374 5f76 616c 7565 7320 3d20   const_values = 
+00013400: 7b7d 2c20 6f76 6572 7772 6974 653d 4661  {}, overwrite=Fa
+00013410: 6c73 652c 2063 6f6c 5f73 6570 6172 6174  lse, col_separat
+00013420: 6f72 203d 2022 5c74 222c 0a20 2020 2020  or = "\t",.     
+00013430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013440: 2020 2020 2020 2020 2020 2061 7474 5f70             att_p
+00013450: 6174 685f 616e 676c 6573 5f69 6e5f 7261  ath_angles_in_ra
+00013460: 6420 3d20 4661 6c73 652c 2076 6964 656f  d = False, video
+00013470: 5361 6d70 6c65 5365 636f 6e64 733d 312c  SampleSeconds=1,
+00013480: 7265 636f 7264 7332 6265 496e 7665 7274  records2beInvert
+00013490: 6564 3d5b 5d29 3a0a 2020 2020 2020 2020  ed=[]):.        
+000134a0: 2222 2220 4372 6561 7465 7320 696e 202f  """ Creates in /
+000134b0: 696e 7465 726d 6564 6961 7465 2061 2074  intermediate a t
+000134c0: 6578 7420 6669 6c65 2077 6974 6820 6361  ext file with ca
+000134d0: 6d65 7261 2061 7474 6974 7564 6520 6461  mera attitude da
+000134e0: 7461 2066 6f72 2065 6163 6820 696d 6167  ta for each imag
+000134f0: 652e 2041 6c6c 2061 6e67 6c65 7320 6172  e. All angles ar
+00013500: 6520 6578 7065 6374 6564 2069 6e20 6465  e expected in de
+00013510: 6772 6565 732e 2055 7365 2061 7474 5f70  grees. Use att_p
+00013520: 6174 685f 616e 676c 6573 5f69 6e5f 7261  ath_angles_in_ra
+00013530: 6420 6966 206e 6563 6573 7361 7279 2e20  d if necessary. 
+00013540: 0a20 2020 2020 2020 2063 616d 6572 6132  .        camera2
+00013550: 4672 616d 6520 616e 676c 6573 3a20 726f  Frame angles: ro
+00013560: 7461 7469 6f6e 206f 6620 6361 6d65 7261  tation of camera
+00013570: 2063 6f6f 7264 696e 6174 6573 2028 782c   coordinates (x,
+00013580: 792c 7a20 3d20 746f 702c 2072 6967 6874  y,z = top, right
+00013590: 2c20 6c69 6e65 206f 6620 7369 6768 7429  , line of sight)
+000135a0: 2077 6974 6820 7265 7370 6563 7420 746f   with respect to
+000135b0: 2076 6568 6963 6c65 2063 6f6f 7264 696e   vehicle coordin
+000135c0: 6174 6573 2028 782c 792c 7a20 3d20 666f  ates (x,y,z = fo
+000135d0: 7277 6172 642c 7269 6768 742c 646f 776e  rward,right,down
+000135e0: 2920 0a20 2020 2020 2020 2069 6e20 6163  ) .        in ac
+000135f0: 636f 7264 616e 6365 2077 6974 6820 7468  cordance with th
+00013600: 6520 7961 772c 7069 7463 682c 726f 6c6c  e yaw,pitch,roll
+00013610: 2072 6f74 6174 696f 6e20 6f72 6465 7220   rotation order 
+00013620: 636f 6e76 656e 7469 6f6e 3a0a 2020 2020  convention:.    
+00013630: 2020 2020 312e 2079 6177 2061 726f 756e      1. yaw aroun
+00013640: 6420 7a2c 0a20 2020 2020 2020 2032 2e20  d z,.        2. 
+00013650: 7069 7463 6820 6172 6f75 6e64 2072 6f74  pitch around rot
+00013660: 6174 6564 2079 2c0a 2020 2020 2020 2020  ated y,.        
+00013670: 332e 2072 6f6c 6c20 6172 6f75 6e64 2072  3. roll around r
+00013680: 6f74 6174 6564 2078 0a0a 2020 2020 2020  otated x..      
+00013690: 2020 526f 7461 7469 6f6e 2064 6972 6563    Rotation direc
+000136a0: 7469 6f6e 7320 6163 636f 7264 696e 6720  tions according 
+000136b0: 746f 205c 2772 6967 6874 2d68 616e 6420  to \'right-hand 
+000136c0: 7275 6c65 5c27 2e0a 0a20 2020 2020 2020  rule\'...       
+000136d0: 2049 2e65 2e20 6361 6d65 7261 3246 7261   I.e. camera2Fra
+000136e0: 6d65 2061 6e67 6c65 7320 3d20 302c 302c  me angles = 0,0,
+000136f0: 3020 6361 6d65 7261 2069 7320 6661 6369  0 camera is faci
+00013700: 6e67 2064 6f77 6e77 6172 6420 7769 7468  ng downward with
+00013710: 2074 6f70 2073 6964 6520 746f 7761 7264   top side toward
+00013720: 7320 7665 6869 636c 6527 7320 666f 7277  s vehicle's forw
+00013730: 6172 6420 6469 7265 6374 696f 6e27 2022  ard direction' "
+00013740: 2222 0a0a 2020 2020 2020 2020 696e 745f  ""..        int_
+00013750: 6174 7475 7475 6465 5f66 696c 6520 3d20  attutude_file = 
+00013760: 7365 6c66 2e5f 5f67 6574 5f69 6e74 5f66  self.__get_int_f
+00013770: 696c 655f 7072 6566 6978 2829 202b 2027  ile_prefix() + '
+00013780: 5f69 6d61 6765 2d61 7474 6974 7564 652e  _image-attitude.
+00013790: 7478 7427 0a20 2020 2020 2020 206f 7574  txt'.        out
+000137a0: 7075 745f 6865 6164 6572 5f61 7474 203d  put_header_att =
+000137b0: 207b 2020 206d 6971 7476 2e63 6f6c 5f68   {   miqtv.col_h
+000137c0: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
+000137d0: 2769 6d67 275d 3a20 206d 6971 7476 2e63  'img']:  miqtv.c
+000137e0: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
+000137f0: 7427 5d5b 2769 6d67 275d 2c0a 2020 2020  t']['img'],.    
+00013800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013810: 2020 2020 2020 2020 2020 2020 6d69 7174              miqt
+00013820: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
+00013830: 7269 7174 275d 5b27 7574 6327 5d3a 6d69  riqt']['utc']:mi
+00013840: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
+00013850: 6d61 7269 7174 275d 5b27 7574 6327 5d2c  mariqt']['utc'],
+00013860: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013880: 206d 6971 7476 2e63 6f6c 5f68 6561 6465   miqtv.col_heade
+00013890: 725b 276d 6172 6971 7427 5d5b 2779 6177  r['mariqt']['yaw
+000138a0: 275d 3a6d 6971 7476 2e63 6f6c 5f68 6561  ']:miqtv.col_hea
+000138b0: 6465 725b 276d 6172 6971 7427 5d5b 2779  der['mariqt']['y
+000138c0: 6177 275d 2c0a 2020 2020 2020 2020 2020  aw'],.          
+000138d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000138e0: 2020 2020 2020 6d69 7174 762e 636f 6c5f        miqtv.col_
+000138f0: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
+00013900: 5b27 7069 7463 6827 5d3a 6d69 7174 762e  ['pitch']:miqtv.
+00013910: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
+00013920: 7174 275d 5b27 7069 7463 6827 5d2c 0a20  qt']['pitch'],. 
+00013930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013940: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00013950: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
+00013960: 276d 6172 6971 7427 5d5b 2772 6f6c 6c27  'mariqt']['roll'
+00013970: 5d3a 6d69 7174 762e 636f 6c5f 6865 6164  ]:miqtv.col_head
+00013980: 6572 5b27 6d61 7269 7174 275d 5b27 726f  er['mariqt']['ro
+00013990: 6c6c 275d 2c0a 2020 2020 2020 2020 2020  ll'],.          
+000139a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000139b0: 2020 7d0a 0a20 2020 2020 2020 2069 6e74    }..        int
+000139c0: 5f70 6f73 655f 6669 6c65 203d 2073 656c  _pose_file = sel
+000139d0: 662e 5f5f 6765 745f 696e 745f 6669 6c65  f.__get_int_file
+000139e0: 5f70 7265 6669 7828 2920 2b20 275f 696d  _prefix() + '_im
+000139f0: 6167 652d 6361 6d65 7261 2d70 6f73 652e  age-camera-pose.
+00013a00: 7478 7427 0a20 2020 2020 2020 206f 7574  txt'.        out
+00013a10: 7075 745f 6865 6164 6572 5f70 6f73 6520  put_header_pose 
+00013a20: 3d20 7b20 206d 6971 7476 2e63 6f6c 5f68  = {  miqtv.col_h
+00013a30: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
+00013a40: 2769 6d67 275d 3a6d 6971 7476 2e63 6f6c  'img']:miqtv.col
+00013a50: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
+00013a60: 5d5b 2769 6d67 275d 2c0a 2020 2020 2020  ]['img'],.      
+00013a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013a80: 2020 2020 2020 2020 2020 6d69 7174 762e            miqtv.
+00013a90: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
+00013aa0: 7174 275d 5b27 7574 6327 5d3a 6d69 7174  qt']['utc']:miqt
+00013ab0: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
+00013ac0: 7269 7174 275d 5b27 7574 6327 5d2c 0a20  riqt']['utc'],. 
+00013ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013ae0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00013af0: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
+00013b00: 276d 6172 6971 7427 5d5b 2770 6f73 6527  'mariqt']['pose'
+00013b10: 5d3a 6d69 7174 762e 636f 6c5f 6865 6164  ]:miqtv.col_head
+00013b20: 6572 5b27 6d61 7269 7174 275d 5b27 706f  er['mariqt']['po
+00013b30: 7365 275d 2c0a 2020 2020 2020 2020 2020  se'],.          
+00013b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013b50: 2020 7d0a 0a20 2020 2020 2020 2069 6620    }..        if 
+00013b60: 6f73 2e70 6174 682e 6578 6973 7473 2869  os.path.exists(i
+00013b70: 6e74 5f61 7474 7574 7564 655f 6669 6c65  nt_attutude_file
+00013b80: 2920 616e 6420 6e6f 7420 6f76 6572 7772  ) and not overwr
+00013b90: 6974 653a 0a20 2020 2020 2020 2020 2020  ite:.           
+00013ba0: 2073 656c 662e 6164 645f 6974 656d 5f69   self.add_item_i
+00013bb0: 6e66 6f5f 7461 625f 6669 6c65 2869 6e74  nfo_tab_file(int
+00013bc0: 5f61 7474 7574 7564 655f 6669 6c65 2c22  _attutude_file,"
+00013bd0: 5c74 222c 6f75 7470 7574 5f68 6561 6465  \t",output_heade
+00013be0: 725f 6174 7429 0a20 2020 2020 2020 2020  r_att).         
+00013bf0: 2020 2065 7874 7261 5f6d 7367 203d 2022     extra_msg = "
+00013c00: 220a 2020 2020 2020 2020 2020 2020 6966  ".            if
+00013c10: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
+00013c20: 696e 745f 706f 7365 5f66 696c 6529 3a0a  int_pose_file):.
+00013c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013c40: 7365 6c66 2e61 6464 5f69 7465 6d5f 696e  self.add_item_in
+00013c50: 666f 5f74 6162 5f66 696c 6528 696e 745f  fo_tab_file(int_
+00013c60: 706f 7365 5f66 696c 652c 225c 7422 2c6f  pose_file,"\t",o
+00013c70: 7574 7075 745f 6865 6164 6572 5f70 6f73  utput_header_pos
+00013c80: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+00013c90: 2020 2065 7874 7261 5f6d 7367 203d 2022     extra_msg = "
+00013ca0: 2c20 2220 2b20 696e 745f 706f 7365 5f66  , " + int_pose_f
+00013cb0: 696c 650a 2020 2020 2020 2020 2020 2020  ile.            
+00013cc0: 7265 7475 726e 2054 7275 652c 2022 4f75  return True, "Ou
+00013cd0: 7470 7574 2066 696c 6520 6578 6973 7473  tput file exists
+00013ce0: 3a20 222b 696e 745f 6174 7475 7475 6465  : "+int_attutude
+00013cf0: 5f66 696c 6520 2b20 6578 7472 615f 6d73  _file + extra_ms
+00013d00: 670a 0a20 2020 2020 2020 2069 6620 6e6f  g..        if no
+00013d10: 7420 6f73 2e70 6174 682e 6578 6973 7473  t os.path.exists
+00013d20: 2861 7474 5f70 6174 6829 3a0a 2020 2020  (att_path):.    
+00013d30: 2020 2020 2020 2020 7265 7475 726e 2046          return F
+00013d40: 616c 7365 2c20 2241 7474 6974 7564 6520  alse, "Attitude 
+00013d50: 6669 6c65 206e 6f74 2066 6f75 6e64 3a20  file not found: 
+00013d60: 222b 6174 745f 7061 7468 0a0a 2020 2020  "+att_path..    
+00013d70: 2020 2020 6966 206e 6f74 206f 732e 7061      if not os.pa
+00013d80: 7468 2e65 7869 7374 7328 7365 6c66 2e69  th.exists(self.i
+00013d90: 6d61 6765 7344 6972 293a 0a20 2020 2020  magesDir):.     
+00013da0: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
+00013db0: 6c73 652c 2022 496d 6167 6520 666f 6c64  lse, "Image fold
+00013dc0: 6572 206e 6f74 2066 6f75 6e64 3a20 222b  er not found: "+
+00013dd0: 2073 656c 662e 696d 6167 6573 4469 720a   self.imagesDir.
+00013de0: 0a20 2020 2020 2020 2073 203d 206d 6971  .        s = miq
+00013df0: 7463 2e50 7269 6e74 4c6f 6164 696e 674d  tc.PrintLoadingM
+00013e00: 7367 2822 4372 6561 7469 6e67 2069 7465  sg("Creating ite
+00013e10: 6d73 2720 6174 7469 7475 6465 2064 6174  ms' attitude dat
+00013e20: 6122 290a 0a20 2020 2020 2020 2023 206c  a")..        # l
+00013e30: 6f61 6420 6672 616d 6520 6174 7469 7475  oad frame attitu
+00013e40: 6465 2064 6174 6120 6672 6f6d 2066 696c  de data from fil
+00013e50: 650a 2020 2020 2020 2020 6174 745f 6461  e.        att_da
+00013e60: 7461 2c20 7061 7273 654d 7367 203d 206d  ta, parseMsg = m
+00013e70: 6971 746e 2e72 6561 6441 6c6c 4174 7469  iqtn.readAllAtti
+00013e80: 7475 6465 7346 726f 6d46 696c 6550 6174  tudesFromFilePat
+00013e90: 6828 6174 745f 7061 7468 2c20 6672 616d  h(att_path, fram
+00013ea0: 655f 6174 745f 6865 6164 6572 2c20 6461  e_att_header, da
+00013eb0: 7465 5f66 6f72 6d61 742c 636f 6c5f 7365  te_format,col_se
+00013ec0: 7061 7261 746f 723d 636f 6c5f 7365 7061  parator=col_sepa
+00013ed0: 7261 746f 722c 636f 6e73 745f 7661 6c75  rator,const_valu
+00013ee0: 6573 3d63 6f6e 7374 5f76 616c 7565 732c  es=const_values,
+00013ef0: 616e 676c 6573 496e 5261 643d 6174 745f  anglesInRad=att_
+00013f00: 7061 7468 5f61 6e67 6c65 735f 696e 5f72  path_angles_in_r
+00013f10: 6164 290a 2020 2020 2020 2020 6966 2070  ad).        if p
+00013f20: 6172 7365 4d73 6720 213d 2022 223a 0a20  arseMsg != "":. 
+00013f30: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00013f40: 7072 6f76 2e6c 6f67 2870 6172 7365 4d73  prov.log(parseMs
+00013f50: 672c 646f 6e74 5368 6f77 3d54 7275 6529  g,dontShow=True)
+00013f60: 0a20 2020 2020 2020 2020 2020 2070 6172  .            par
+00013f70: 7365 4d73 6720 3d20 225c 6e22 202b 2070  seMsg = "\n" + p
+00013f80: 6172 7365 4d73 670a 0a20 2020 2020 2020  arseMsg..       
+00013f90: 2023 2066 696e 6420 666f 7220 6561 6368   # find for each
+00013fa0: 2069 6d61 6765 2074 6865 2072 6573 7065   image the respe
+00013fb0: 6374 6976 6520 6e61 7669 6761 7469 6f6e  ctive navigation
+00013fc0: 2064 6174 610a 2020 2020 2020 2020 732e   data.        s.
+00013fd0: 7374 6f70 2829 0a20 2020 2020 2020 2073  stop().        s
+00013fe0: 7563 6365 7373 2c20 696d 6167 655f 6474  uccess, image_dt
+00013ff0: 732c 206d 7367 203d 2073 656c 662e 6669  s, msg = self.fi
+00014000: 6e64 4e61 7644 6174 6146 6f72 496d 6167  ndNavDataForImag
+00014010: 6528 6174 745f 6461 7461 2c76 6964 656f  e(att_data,video
+00014020: 5361 6d70 6c65 5365 636f 6e64 7329 0a20  SampleSeconds). 
+00014030: 2020 2020 2020 2069 6620 6e6f 7420 7375         if not su
+00014040: 6363 6573 733a 0a20 2020 2020 2020 2020  ccess:.         
+00014050: 2020 2072 6574 7572 6e20 4661 6c73 652c     return False,
+00014060: 206d 7367 202b 2070 6172 7365 4d73 670a   msg + parseMsg.
+00014070: 2020 2020 2020 2020 7320 3d20 6d69 7174          s = miqt
+00014080: 632e 5072 696e 744c 6f61 6469 6e67 4d73  c.PrintLoadingMs
+00014090: 6728 2243 7265 6174 696e 6720 6974 656d  g("Creating item
+000140a0: 7327 2061 7474 6974 7564 6520 6461 7461  s' attitude data
+000140b0: 2229 0a0a 2020 2020 2020 2020 2320 696e  ")..        # in
+000140c0: 7665 7274 2076 616c 7565 7320 2869 6620  vert values (if 
+000140d0: 6e65 6564 6564 2920 6265 666f 7265 206c  needed) before l
+000140e0: 6576 6572 6172 6d20 636f 6d70 656e 7361  everarm compensa
+000140f0: 7469 6f6e 0a20 2020 2020 2020 2069 6620  tion.        if 
+00014100: 7265 636f 7264 7332 6265 496e 7665 7274  records2beInvert
+00014110: 6564 2021 3d20 5b5d 3a0a 2020 2020 2020  ed != []:.      
+00014120: 2020 2020 2020 666f 7220 6669 6c65 2069        for file i
+00014130: 6e20 696d 6167 655f 6474 733a 0a20 2020  n image_dts:.   
+00014140: 2020 2020 2020 2020 2020 2020 2061 7474               att
+00014150: 6974 7564 6573 203d 2069 6d61 6765 5f64  itudes = image_d
+00014160: 7473 5b66 696c 655d 0a20 2020 2020 2020  ts[file].       
+00014170: 2020 2020 2020 2020 2066 6f72 2069 2069           for i i
+00014180: 6e20 7261 6e67 6528 6c65 6e28 6174 7469  n range(len(atti
+00014190: 7475 6465 7329 293a 0a20 2020 2020 2020  tudes)):.       
+000141a0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000141b0: 2779 6177 2720 696e 2020 7265 636f 7264  'yaw' in  record
+000141c0: 7332 6265 496e 7665 7274 6564 3a0a 2020  s2beInverted:.  
+000141d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000141e0: 2020 2020 2020 6174 7469 7475 6465 735b        attitudes[
+000141f0: 695d 2e79 6177 202a 3d20 2d31 0a20 2020  i].yaw *= -1.   
+00014200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014210: 2069 6620 2770 6974 6368 2720 696e 2020   if 'pitch' in  
+00014220: 7265 636f 7264 7332 6265 496e 7665 7274  records2beInvert
+00014230: 6564 3a0a 2020 2020 2020 2020 2020 2020  ed:.            
+00014240: 2020 2020 2020 2020 2020 2020 6174 7469              atti
+00014250: 7475 6465 735b 695d 2e70 6974 6368 202a  tudes[i].pitch *
+00014260: 3d20 2d31 0a20 2020 2020 2020 2020 2020  = -1.           
+00014270: 2020 2020 2020 2020 2069 6620 2772 6f6c           if 'rol
+00014280: 6c27 2069 6e20 2072 6563 6f72 6473 3262  l' in  records2b
+00014290: 6549 6e76 6572 7465 643a 0a20 2020 2020  eInverted:.     
 000142a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000142b0: 2020 2020 7265 732e 7772 6974 6528 225c      res.write("\
-000142c0: 7422 2b73 7472 2876 616c 2929 0a20 2020  t"+str(val)).   
-000142d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000142e0: 2076 616c 203d 2074 696d 6570 6f69 6e74   val = timepoint
-000142f0: 2e70 6974 6368 0a20 2020 2020 2020 2020  .pitch.         
-00014300: 2020 2020 2020 2020 2020 2069 6620 2770             if 'p
-00014310: 6974 6368 2720 696e 2072 6563 6f72 6473  itch' in records
-00014320: 3262 6549 6e76 6572 7465 643a 0a20 2020  2beInverted:.   
-00014330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014340: 2020 2020 2076 616c 202a 3d20 2d31 0a20       val *= -1. 
-00014350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014360: 2020 2072 6573 2e77 7269 7465 2822 5c74     res.write("\t
-00014370: 222b 7374 7228 7661 6c29 290a 2020 2020  "+str(val)).    
-00014380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014390: 7661 6c20 3d20 7469 6d65 706f 696e 742e  val = timepoint.
-000143a0: 726f 6c6c 0a20 2020 2020 2020 2020 2020  roll.           
-000143b0: 2020 2020 2020 2020 2069 6620 2772 6f6c           if 'rol
-000143c0: 6c27 2069 6e20 7265 636f 7264 7332 6265  l' in records2be
-000143d0: 496e 7665 7274 6564 3a0a 2020 2020 2020  Inverted:.      
-000143e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000143f0: 2020 7661 6c20 2a3d 202d 310a 2020 2020    val *= -1.    
-00014400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014410: 7265 732e 7772 6974 6528 225c 7422 2b73  res.write("\t"+s
-00014420: 7472 2876 616c 2929 0a20 2020 2020 2020  tr(val)).       
-00014430: 2020 2020 2020 2020 2020 2020 2072 6573               res
-00014440: 2e77 7269 7465 2822 5c6e 2229 0a20 2020  .write("\n").   
-00014450: 2020 2020 2020 2020 2072 6573 2e63 6c6f           res.clo
-00014460: 7365 2829 0a0a 2020 2020 2020 2020 2020  se()..          
-00014470: 2020 7365 6c66 2e70 726f 762e 6164 6441    self.prov.addA
-00014480: 7267 756d 656e 7428 2269 6e70 7574 4174  rgument("inputAt
-00014490: 7469 7475 6465 4669 6c65 222c 6174 745f  titudeFile",att_
-000144a0: 7061 7468 2c6f 7665 7277 7269 7465 3d54  path,overwrite=T
-000144b0: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
-000144c0: 2073 656c 662e 7072 6f76 2e6c 6f67 2822   self.prov.log("
-000144d0: 7061 7273 6564 2066 726f 6d20 696e 7075  parsed from inpu
-000144e0: 7441 7474 6974 7564 6546 696c 653a 2022  tAttitudeFile: "
-000144f0: 202b 2073 7472 2866 7261 6d65 5f61 7474   + str(frame_att
-00014500: 5f68 6561 6465 7229 2c64 6f6e 7453 686f  _header),dontSho
-00014510: 773d 5472 7565 290a 2020 2020 2020 2020  w=True).        
-00014520: 2020 2020 7365 6c66 2e61 6464 5f69 7465      self.add_ite
-00014530: 6d5f 696e 666f 5f74 6162 5f66 696c 6528  m_info_tab_file(
-00014540: 696e 745f 6174 7475 7475 6465 5f66 696c  int_attutude_fil
-00014550: 652c 225c 7422 2c6f 7574 7075 745f 6865  e,"\t",output_he
-00014560: 6164 6572 5f61 7474 290a 0a20 2020 2020  ader_att)..     
-00014570: 2020 2020 2020 2023 2057 7269 7465 2074         # Write t
-00014580: 6f20 706f 7365 2074 7874 2066 696c 650a  o pose txt file.
-00014590: 2020 2020 2020 2020 2020 2020 2320 6865              # he
-000145a0: 6164 6572 0a20 2020 2020 2020 2020 2020  ader.           
-000145b0: 2072 6573 203d 206f 7065 6e28 696e 745f   res = open(int_
-000145c0: 706f 7365 5f66 696c 652c 2022 7722 290a  pose_file, "w").
-000145d0: 2020 2020 2020 2020 2020 2020 7265 732e              res.
-000145e0: 7772 6974 6528 6d69 7174 762e 636f 6c5f  write(miqtv.col_
-000145f0: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
-00014600: 5b27 696d 6727 5d2b 225c 7422 2b6d 6971  ['img']+"\t"+miq
-00014610: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
-00014620: 6172 6971 7427 5d5b 2775 7463 275d 290a  ariqt']['utc']).
-00014630: 2020 2020 2020 2020 2020 2020 7265 732e              res.
-00014640: 7772 6974 6528 225c 7422 2b6d 6971 7476  write("\t"+miqtv
-00014650: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
-00014660: 6971 7427 5d5b 2770 6f73 6527 5d29 0a20  iqt']['pose']). 
-00014670: 2020 2020 2020 2020 2020 2072 6573 2e77             res.w
-00014680: 7269 7465 2822 5c6e 2229 0a20 2020 2020  rite("\n").     
-00014690: 2020 2020 2020 2023 2064 6174 6120 6c69         # data li
-000146a0: 6e65 730a 2020 2020 2020 2020 2020 2020  nes.            
-000146b0: 6920 3d20 300a 2020 2020 2020 2020 2020  i = 0.          
-000146c0: 2020 666f 7220 6669 6c65 2069 6e20 696d    for file in im
-000146d0: 6167 655f 6474 733a 0a20 2020 2020 2020  age_dts:.       
-000146e0: 2020 2020 2020 2020 2066 6f72 2074 696d           for tim
-000146f0: 6570 6f69 6e74 2069 6e20 696d 6167 655f  epoint in image_
-00014700: 6474 735b 6669 6c65 5d3a 0a20 2020 2020  dts[file]:.     
-00014710: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00014720: 6620 525f 6361 6d32 7574 6d5f 6c69 7374  f R_cam2utm_list
-00014730: 5b69 5d20 3d3d 2022 223a 0a20 2020 2020  [i] == "":.     
-00014740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014750: 2020 2069 202b 3d20 310a 2020 2020 2020     i += 1.      
-00014760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014770: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
-00014780: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00014790: 6573 2e77 7269 7465 2866 696c 652b 225c  es.write(file+"\
-000147a0: 7422 2b74 696d 6570 6f69 6e74 2e64 6174  t"+timepoint.dat
-000147b0: 6554 696d 6528 292e 7374 7266 7469 6d65  eTime().strftime
-000147c0: 286d 6971 7476 2e64 6174 655f 666f 726d  (miqtv.date_form
-000147d0: 6174 735b 276d 6172 6971 7427 5d29 2920  ats['mariqt'])) 
-000147e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000147f0: 2020 2020 2065 6e74 7279 203d 2073 7472       entry = str
-00014800: 287b 2770 6f73 652d 6162 736f 6c75 7465  ({'pose-absolute
-00014810: 2d6f 7269 656e 7461 7469 6f6e 2d75 746d  -orientation-utm
-00014820: 2d6d 6174 7269 7827 3a52 5f63 616d 3275  -matrix':R_cam2u
-00014830: 746d 5f6c 6973 745b 695d 7d29 2e72 6570  tm_list[i]}).rep
-00014840: 6c61 6365 2827 5c6e 272c 2727 290a 2020  lace('\n','').  
-00014850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014860: 2020 7265 732e 7772 6974 6528 225c 7422    res.write("\t"
-00014870: 2b65 6e74 7279 290a 2020 2020 2020 2020  +entry).        
-00014880: 2020 2020 2020 2020 2020 2020 6920 2b3d              i +=
-00014890: 2031 0a20 2020 2020 2020 2020 2020 2020   1.             
-000148a0: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
-000148b0: 2822 5c6e 2229 0a20 2020 2020 2020 2020  ("\n").         
-000148c0: 2020 2072 6573 2e63 6c6f 7365 2829 0a20     res.close(). 
-000148d0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000148e0: 6164 645f 6974 656d 5f69 6e66 6f5f 7461  add_item_info_ta
-000148f0: 625f 6669 6c65 2869 6e74 5f70 6f73 655f  b_file(int_pose_
-00014900: 6669 6c65 2c22 5c74 222c 6f75 7470 7574  file,"\t",output
-00014910: 5f68 6561 6465 725f 706f 7365 290a 2020  _header_pose).  
-00014920: 2020 2020 2020 2020 2020 732e 7374 6f70            s.stop
-00014930: 2829 0a20 2020 2020 2020 2020 2020 2072  ().            r
-00014940: 6574 7572 6e20 5472 7565 2c20 2241 7474  eturn True, "Att
-00014950: 6974 7564 6520 6461 7461 2063 7265 6174  itude data creat
-00014960: 6564 2220 2b20 7061 7273 654d 7367 0a20  ed" + parseMsg. 
-00014970: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00014980: 2020 2020 2020 2020 2073 2e73 746f 7028           s.stop(
-00014990: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-000149a0: 7475 726e 2046 616c 7365 2c20 224e 6f20  turn False, "No 
-000149b0: 696d 6167 6520 6174 7469 7475 6465 7320  image attitudes 
-000149c0: 666f 756e 6422 202b 2070 6172 7365 4d73  found" + parseMs
-000149d0: 670a 2020 2020 2020 2020 0a20 2020 2020  g.        .     
-000149e0: 2020 200a 2020 2020 6465 6620 6372 6561     .    def crea
-000149f0: 7465 496d 6167 6541 7474 6974 7564 6546  teImageAttitudeF
-00014a00: 696c 6528 7365 6c66 2c20 6174 745f 7061  ile(self, att_pa
-00014a10: 7468 3a73 7472 2c20 6672 616d 655f 6174  th:str, frame_at
-00014a20: 745f 6865 6164 6572 3a64 6963 742c 2063  t_header:dict, c
-00014a30: 616d 6572 6132 4672 616d 655f 7961 773a  amera2Frame_yaw:
-00014a40: 666c 6f61 742c 6361 6d65 7261 3246 7261  float,camera2Fra
-00014a50: 6d65 5f70 6974 6368 3a66 6c6f 6174 2c63  me_pitch:float,c
-00014a60: 616d 6572 6132 4672 616d 655f 726f 6c6c  amera2Frame_roll
-00014a70: 3a66 6c6f 6174 2c0a 2020 2020 2020 2020  :float,.        
-00014a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014a90: 2020 2020 2020 2020 6461 7465 5f66 6f72          date_for
-00014aa0: 6d61 743d 6d69 7174 762e 6461 7465 5f66  mat=miqtv.date_f
-00014ab0: 6f72 6d61 7473 5b27 7061 6e67 6165 6127  ormats['pangaea'
-00014ac0: 5d2c 2063 6f6e 7374 5f76 616c 7565 7320  ], const_values 
-00014ad0: 3d20 7b7d 2c20 6f76 6572 7772 6974 653d  = {}, overwrite=
-00014ae0: 4661 6c73 652c 2063 6f6c 5f73 6570 6172  False, col_separ
-00014af0: 6174 6f72 203d 2022 5c74 222c 0a20 2020  ator = "\t",.   
-00014b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014b10: 2020 2020 2020 2020 2020 2020 2061 7474               att
-00014b20: 5f70 6174 685f 616e 676c 6573 5f69 6e5f  _path_angles_in_
-00014b30: 7261 6420 3d20 4661 6c73 652c 2076 6964  rad = False, vid
-00014b40: 656f 5361 6d70 6c65 5365 636f 6e64 733d  eoSampleSeconds=
-00014b50: 312c 7265 636f 7264 7332 6265 496e 7665  1,records2beInve
-00014b60: 7274 6564 3d5b 5d29 3a0a 2020 2020 2020  rted=[]):.      
-00014b70: 2020 2222 2220 4465 7072 6563 6174 6465    """ Deprecatde
-00014b80: 202d 2075 7365 2063 7265 6174 655f 696d   - use create_im
-00014b90: 6167 655f 6174 7469 7475 6465 5f66 696c  age_attitude_fil
-00014ba0: 6520 2222 220a 2020 2020 2020 2020 7265  e """.        re
-00014bb0: 7475 726e 2073 656c 662e 6372 6561 7465  turn self.create
-00014bc0: 5f69 6d61 6765 5f61 7474 6974 7564 655f  _image_attitude_
-00014bd0: 6669 6c65 2861 7474 5f70 6174 682c 2066  file(att_path, f
-00014be0: 7261 6d65 5f61 7474 5f68 6561 6465 722c  rame_att_header,
-00014bf0: 2063 616d 6572 6132 4672 616d 655f 7961   camera2Frame_ya
-00014c00: 772c 2063 616d 6572 6132 4672 616d 655f  w, camera2Frame_
-00014c10: 7069 7463 682c 2063 616d 6572 6132 4672  pitch, camera2Fr
-00014c20: 616d 655f 726f 6c6c 2c20 0a20 2020 2020  ame_roll, .     
-00014c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014c50: 2020 2020 2020 2020 2020 6461 7465 5f66            date_f
-00014c60: 6f72 6d61 742c 2063 6f6e 7374 5f76 616c  ormat, const_val
-00014c70: 7565 732c 206f 7665 7277 7269 7465 2c20  ues, overwrite, 
-00014c80: 636f 6c5f 7365 7061 7261 746f 722c 2061  col_separator, a
-00014c90: 7474 5f70 6174 685f 616e 676c 6573 5f69  tt_path_angles_i
-00014ca0: 6e5f 7261 642c 2076 6964 656f 5361 6d70  n_rad, videoSamp
-00014cb0: 6c65 5365 636f 6e64 732c 0a20 2020 2020  leSeconds,.     
-00014cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014ce0: 2020 2020 2020 2020 2020 7265 636f 7264            record
-00014cf0: 7332 6265 496e 7665 7274 6564 290a 2020  s2beInverted).  
-00014d00: 2020 2020 2020 0a0a 2020 2020 6465 6620        ..    def 
-00014d10: 6765 745f 525f 6361 6d53 7464 3275 746d  get_R_camStd2utm
-00014d20: 2873 656c 662c 525f 6361 6d32 6672 616d  (self,R_cam2fram
-00014d30: 653a 6e70 2e61 7272 6179 2c52 5f66 7261  e:np.array,R_fra
-00014d40: 6d65 326e 6564 3a6e 702e 6172 7261 7929  me2ned:np.array)
-00014d50: 3a0a 2020 2020 2020 2020 2222 2220 7265  :.        """ re
-00014d60: 7472 756e 2072 6f74 6174 696f 6e20 6d61  trun rotation ma
-00014d70: 7472 6978 2052 2074 7261 6e66 6f72 6d69  trix R tranformi
-00014d80: 6e67 2066 726f 6d20 6361 6d53 7464 3a20  ng from camStd: 
-00014d90: 2878 2c79 2c7a 203d 2072 6967 6874 2c62  (x,y,z = right,b
-00014da0: 7574 746f 6d2c 6c69 6e65 206f 6620 7369  uttom,line of si
-00014db0: 6768 7429 2074 6f20 7574 6d20 2878 2c79  ght) to utm (x,y
-00014dc0: 2c7a 203d 2065 6173 7469 6e67 2c6e 6f72  ,z = easting,nor
-00014dd0: 7468 696e 672c 7570 2920 2222 220a 2020  thing,up) """.  
-00014de0: 2020 2020 2020 525f 6361 6d69 4644 4f32        R_camiFDO2
-00014df0: 6361 6d53 7464 203d 206d 6971 7467 2e52  camStd = miqtg.R
-00014e00: 5f59 6177 5069 7463 6852 6f6c 6c28 3930  _YawPitchRoll(90
-00014e10: 2c30 2c30 2920 2320 696e 2069 4644 4f20  ,0,0) # in iFDO 
-00014e20: 6361 6d3a 2028 782c 792c 7a20 3d20 746f  cam: (x,y,z = to
-00014e30: 702c 7269 6768 742c 6c69 6e65 206f 6620  p,right,line of 
-00014e40: 7369 6768 7429 2062 7574 2066 6f72 2070  sight) but for p
-00014e50: 6f73 6520 7468 6520 2773 7461 6e64 6172  ose the 'standar
-00014e60: 6427 2063 616d 5374 643a 2028 782c 792c  d' camStd: (x,y,
-00014e70: 7a20 3d20 7269 6768 742c 6275 7474 6f6d  z = right,buttom
-00014e80: 2c6c 696e 6520 6f66 2073 6967 6874 2920  ,line of sight) 
-00014e90: 6973 2065 7870 6563 7465 640a 2020 2020  is expected.    
-00014ea0: 2020 2020 525f 6361 6d53 7464 3266 7261      R_camStd2fra
-00014eb0: 6d65 203d 2052 5f63 616d 3266 7261 6d65  me = R_cam2frame
-00014ec0: 2e64 6f74 2852 5f63 616d 6946 444f 3263  .dot(R_camiFDO2c
-00014ed0: 616d 5374 6429 0a20 2020 2020 2020 2052  amStd).        R
-00014ee0: 5f63 616d 5374 6432 6e65 6420 3d20 525f  _camStd2ned = R_
-00014ef0: 6672 616d 6532 6e65 642e 646f 7428 525f  frame2ned.dot(R_
-00014f00: 6361 6d53 7464 3266 7261 6d65 290a 2020  camStd2frame).  
-00014f10: 2020 2020 2020 525f 6e65 6432 7574 6d20        R_ned2utm 
-00014f20: 3d20 6d69 7174 672e 525f 5859 5a28 3138  = miqtg.R_XYZ(18
-00014f30: 302c 302c 3930 2920 2320 7769 7468 2075  0,0,90) # with u
-00014f40: 746d 2078 2c79 2c7a 203d 2065 6173 7469  tm x,y,z = easti
-00014f50: 6e67 2c6e 6f72 7468 696e 672c 7570 0a20  ng,northing,up. 
-00014f60: 2020 2020 2020 2052 5f63 616d 5374 6432         R_camStd2
-00014f70: 7574 6d20 3d20 525f 6e65 6432 7574 6d2e  utm = R_ned2utm.
-00014f80: 646f 7428 525f 6361 6d53 7464 326e 6564  dot(R_camStd2ned
-00014f90: 292e 726f 756e 6428 3529 0a20 2020 2020  ).round(5).     
-00014fa0: 2020 2072 6574 7572 6e20 525f 6361 6d53     return R_camS
-00014fb0: 7464 3275 746d 0a0a 0a20 2020 2064 6566  td2utm...    def
-00014fc0: 2066 696e 644e 6176 4461 7461 466f 7249   findNavDataForI
-00014fd0: 6d61 6765 2873 656c 662c 6461 7461 3a6d  mage(self,data:m
-00014fe0: 6971 7467 2e4e 756d 4461 7461 5469 6d65  iqtg.NumDataTime
-00014ff0: 5374 616d 7065 642c 7669 6465 6f53 616d  Stamped,videoSam
-00015000: 706c 6553 6563 6f6e 6473 3d31 293a 0a20  pleSeconds=1):. 
-00015010: 2020 2020 2020 2022 2222 2063 7265 6174         """ creat
-00015020: 6573 2061 2064 6963 7420 2869 6d61 6765  es a dict (image
-00015030: 5f64 7473 2920 7769 7468 2066 696c 6520  _dts) with file 
-00015040: 6e61 6d65 2061 7320 6b65 7920 616e 6420  name as key and 
-00015050: 6120 6c69 7374 206f 6620 6461 7461 2065  a list of data e
-00015060: 6c65 6d65 6e74 7320 6173 2076 616c 7565  lements as value
-00015070: 2e20 0a20 2020 2020 2020 2020 2020 2049  . .            I
-00015080: 6e20 6361 7365 206f 6620 7068 6f74 6f73  n case of photos
-00015090: 2074 6865 206c 6973 7420 6861 7320 6f6e   the list has on
-000150a0: 6c79 2061 2073 696e 676c 6520 656e 7472  ly a single entr
-000150b0: 792c 2066 6f72 2076 6964 656f 7320 6974  y, for videos it
-000150c0: 2068 6173 2076 6964 656f 2064 7572 6174   has video durat
-000150d0: 696f 6e20 5b73 6563 5d20 2f20 7669 6465  ion [sec] / vide
-000150e0: 6f53 616d 706c 6553 6563 6f6e 6473 2065  oSampleSeconds e
-000150f0: 6e74 7269 6573 2e0a 2020 2020 2020 2020  ntries..        
-00015100: 2020 2020 5265 7475 726e 7320 7375 6363      Returns succ
-00015110: 6573 732c 2069 6d61 6765 5f64 7473 2c20  ess, image_dts, 
-00015120: 6d73 6720 2222 220a 0a20 2020 2020 2020  msg """..       
-00015130: 2069 6620 7669 6465 6f53 616d 706c 6553   if videoSampleS
-00015140: 6563 6f6e 6473 203c 3d20 303a 0a20 2020  econds <= 0:.   
-00015150: 2020 2020 2020 2020 2072 6169 7365 2045           raise E
-00015160: 7863 6570 7469 6f6e 2822 6669 6e64 4e61  xception("findNa
-00015170: 7644 6174 6146 6f72 496d 6167 653a 2076  vDataForImage: v
-00015180: 6964 656f 5361 6d70 6c65 5365 636f 6e64  ideoSampleSecond
-00015190: 7320 6d75 7374 2062 6520 6772 6561 7465  s must be greate
-000151a0: 7220 3022 290a 0a20 2020 2020 2020 2023  r 0")..        #
-000151b0: 2063 7265 6174 6520 736f 7274 6564 2074   create sorted t
-000151c0: 696d 6520 706f 696e 7473 0a20 2020 2020  ime points.     
-000151d0: 2020 2074 696d 655f 706f 696e 7473 203d     time_points =
-000151e0: 206c 6973 7428 6461 7461 2e6b 6579 7328   list(data.keys(
-000151f0: 2929 0a20 2020 2020 2020 2074 696d 655f  )).        time_
-00015200: 706f 696e 7473 2e73 6f72 7428 290a 2020  points.sort().  
-00015210: 2020 2020 2020 756e 6d61 7463 6865 6454        unmatchedT
-00015220: 696d 6550 6f69 6e74 7320 3d20 5b5d 0a20  imePoints = []. 
-00015230: 2020 2020 2020 2069 6d61 6765 5f64 7473         image_dts
-00015240: 203d 207b 7d0a 2020 2020 2020 2020 7374   = {}.        st
-00015250: 6172 7453 6561 7263 6849 6e64 6578 203d  artSearchIndex =
-00015260: 2030 0a20 2020 2020 2020 2069 6d61 6765   0.        image
-00015270: 7349 6e52 6177 203d 2020 7365 6c66 2e69  sInRaw =  self.i
-00015280: 6d61 6765 7349 6e49 6d61 6765 7344 6972  magesInImagesDir
-00015290: 2829 0a20 2020 2020 2020 2069 6d61 6765  ().        image
-000152a0: 7349 6e52 6177 536f 7274 6564 4c69 7374  sInRawSortedList
-000152b0: 203d 2073 656c 662e 696d 6167 6573 496e   = self.imagesIn
-000152c0: 496d 6167 6573 4469 7253 6f72 7465 644c  ImagesDirSortedL
-000152d0: 6973 7428 290a 2020 2020 2020 2020 7072  ist().        pr
-000152e0: 6f67 203d 206d 6971 7463 2e50 7269 6e74  og = miqtc.Print
-000152f0: 4b6e 6f77 6e50 726f 6772 6573 734d 7367  KnownProgressMsg
-00015300: 2822 496e 7465 7270 6f6c 6174 696e 6720  ("Interpolating 
-00015310: 6e61 7669 6761 7469 6f6e 2066 6f72 2069  navigation for i
-00015320: 6d61 6765 222c 206c 656e 2869 6d61 6765  mage", len(image
-00015330: 7349 6e52 6177 292c 6d6f 6475 6c6f 3d31  sInRaw),modulo=1
-00015340: 290a 2020 2020 2020 2020 666f 7220 6669  ).        for fi
-00015350: 6c65 2069 6e20 696d 6167 6573 496e 5261  le in imagesInRa
-00015360: 7753 6f72 7465 644c 6973 743a 0a20 2020  wSortedList:.   
-00015370: 2020 2020 2020 2020 2070 726f 672e 7072           prog.pr
-00015380: 6f67 7265 7373 2829 0a20 2020 2020 2020  ogress().       
-00015390: 2020 2020 2066 696c 655f 6e61 6d65 203d       file_name =
-000153a0: 206f 732e 7061 7468 2e62 6173 656e 616d   os.path.basenam
-000153b0: 6528 6669 6c65 290a 0a20 2020 2020 2020  e(file)..       
-000153c0: 2020 2020 2064 745f 696d 6167 6520 3d20       dt_image = 
-000153d0: 6d69 7174 632e 7061 7273 6546 696c 6544  miqtc.parseFileD
-000153e0: 6174 6554 696d 6541 7355 5443 2866 696c  ateTimeAsUTC(fil
-000153f0: 655f 6e61 6d65 290a 2020 2020 2020 2020  e_name).        
-00015400: 2020 2020 6474 5f69 6d61 6765 5f74 7320      dt_image_ts 
-00015410: 3d20 696e 7428 6474 5f69 6d61 6765 2e74  = int(dt_image.t
-00015420: 696d 6573 7461 6d70 2829 202a 2031 3030  imestamp() * 100
-00015430: 3029 0a0a 2020 2020 2020 2020 2020 2020  0)..            
-00015440: 7275 6e54 696d 6520 3d20 696d 6167 6573  runTime = images
-00015450: 496e 5261 775b 6669 6c65 5d5b 315d 2023  InRaw[file][1] #
-00015460: 202d 3120 666f 7220 7068 6f74 6f73 0a20   -1 for photos. 
-00015470: 2020 2020 2020 2020 2020 2023 2076 6964             # vid
-00015480: 656f 0a20 2020 2020 2020 2020 2020 2069  eo.            i
-00015490: 6620 696d 6167 6573 496e 5261 775b 6669  f imagesInRaw[fi
-000154a0: 6c65 5d5b 325d 2069 6e20 6d69 7174 762e  le][2] in miqtv.
-000154b0: 7669 6465 6f5f 7479 7065 7320 616e 6420  video_types and 
-000154c0: 7275 6e54 696d 6520 3c3d 2030 3a20 2320  runTime <= 0: # 
-000154d0: 6578 740a 2020 2020 2020 2020 2020 2020  ext.            
-000154e0: 2020 2020 7072 696e 7428 2243 6175 7469      print("Cauti
-000154f0: 6f6e 2120 436f 756c 6420 6e6f 7420 7265  on! Could not re
-00015500: 6164 2076 6964 656f 2072 756e 2074 696d  ad video run tim
-00015510: 6520 6672 6f6d 2066 696c 6522 2c66 696c  e from file",fil
-00015520: 6529 2023 2054 4f44 4f20 646f 6573 2074  e) # TODO does t
-00015530: 6869 7320 6861 7070 656e 3f20 4861 6e64  his happen? Hand
-00015540: 6c65 2062 6574 7465 723f 0a0a 2020 2020  le better?..    
-00015550: 2020 2020 2020 2020 7361 6d70 6c65 5469          sampleTi
-00015560: 6d65 5365 6373 203d 2030 0a20 2020 2020  meSecs = 0.     
-00015570: 2020 2020 2020 2070 6f73 5f6c 6973 7420         pos_list 
-00015580: 3d20 5b5d 0a20 2020 2020 2020 2020 2020  = [].           
-00015590: 2067 6f20 3d20 5472 7565 0a20 2020 2020   go = True.     
-000155a0: 2020 2020 2020 2077 6869 6c65 2067 6f3a         while go:
-000155b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000155c0: 2074 7279 3a20 2020 2020 2020 2020 2020   try:           
-000155d0: 2020 2020 2020 2020 200a 2020 2020 2020           .      
-000155e0: 2020 2020 2020 2020 2020 2020 2020 706f                po
-000155f0: 732c 2073 7461 7274 5365 6172 6368 496e  s, startSearchIn
-00015600: 6465 7820 3d20 6461 7461 2e69 6e74 6572  dex = data.inter
-00015610: 706f 6c61 7465 4174 5469 6d65 2864 745f  polateAtTime(dt_
-00015620: 696d 6167 655f 7473 202b 2073 616d 706c  image_ts + sampl
-00015630: 6554 696d 6553 6563 7320 2a20 3130 3030  eTimeSecs * 1000
-00015640: 2c74 696d 655f 706f 696e 7473 2c73 7461  ,time_points,sta
-00015650: 7274 5365 6172 6368 496e 6465 7829 0a20  rtSearchIndex). 
-00015660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015670: 2020 200a 2020 2020 2020 2020 2020 2020     .            
-00015680: 2020 2020 2020 2020 2320 696e 7465 7270          # interp
-00015690: 6f6c 6174 6541 7454 696d 6520 7265 7475  olateAtTime retu
-000156a0: 726e 7320 4e6f 6e65 2076 616c 7565 7320  rns None values 
-000156b0: 6966 2074 696d 6520 6f75 7420 6f66 2072  if time out of r
-000156c0: 616e 6765 0a20 2020 2020 2020 2020 2020  ange.           
-000156d0: 2020 2020 2020 2020 2069 6620 706f 732e           if pos.
-000156e0: 636f 7461 696e 734e 6f6e 6556 616c 7565  cotainsNoneValue
-000156f0: 7349 6e52 6571 7569 7265 6446 6965 6c64  sInRequiredField
-00015700: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
-00015710: 2020 2020 2020 2020 2020 2020 2075 6e6d               unm
-00015720: 6174 6368 6564 5469 6d65 506f 696e 7473  atchedTimePoints
-00015730: 2e61 7070 656e 6428 2864 745f 696d 6167  .append((dt_imag
-00015740: 655f 7473 202b 2073 616d 706c 6554 696d  e_ts + sampleTim
-00015750: 6553 6563 7320 2a20 3130 3030 292f 3130  eSecs * 1000)/10
-00015760: 3030 290a 2020 2020 2020 2020 2020 2020  00).            
-00015770: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00015780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015790: 2020 2020 2020 706f 735f 6c69 7374 2e61        pos_list.a
-000157a0: 7070 656e 6428 706f 7329 0a20 2020 2020  ppend(pos).     
-000157b0: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-000157c0: 7420 4578 6365 7074 696f 6e20 6173 2065  t Exception as e
-000157d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000157e0: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-000157f0: 7365 2c20 696d 6167 655f 6474 732c 2022  se, image_dts, "
-00015800: 436f 756c 6420 6e6f 7420 6669 6e64 2069  Could not find i
-00015810: 6d61 6765 2074 696d 6520 222b 2064 6174  mage time "+ dat
-00015820: 6574 696d 652e 6461 7465 7469 6d65 2e75  etime.datetime.u
-00015830: 7463 6672 6f6d 7469 6d65 7374 616d 7028  tcfromtimestamp(
-00015840: 2864 745f 696d 6167 655f 7473 202b 2073  (dt_image_ts + s
-00015850: 616d 706c 6554 696d 6553 6563 7320 2a20  ampleTimeSecs * 
-00015860: 3130 3030 292f 3130 3030 292e 7374 7266  1000)/1000).strf
-00015870: 7469 6d65 286d 6971 7476 2e64 6174 655f  time(miqtv.date_
-00015880: 666f 726d 6174 735b 276d 6172 6971 7427  formats['mariqt'
-00015890: 5d29 202b 2220 696e 2022 2b73 7472 2864  ]) +" in "+str(d
-000158a0: 6174 612e 6c65 6e28 2929 2b22 2064 6174  ata.len())+" dat
-000158b0: 6120 706f 7369 7469 6f6e 7322 202b 2073  a positions" + s
-000158c0: 7472 2865 2e61 7267 7329 0a20 2020 2020  tr(e.args).     
-000158d0: 2020 2020 2020 2020 2020 2073 616d 706c             sampl
-000158e0: 6554 696d 6553 6563 7320 2b3d 2076 6964  eTimeSecs += vid
-000158f0: 656f 5361 6d70 6c65 5365 636f 6e64 730a  eoSampleSeconds.
-00015900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015910: 6966 2073 616d 706c 6554 696d 6553 6563  if sampleTimeSec
-00015920: 7320 3e20 7275 6e54 696d 653a 0a20 2020  s > runTime:.   
-00015930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015940: 2067 6f20 3d20 4661 6c73 650a 2020 2020   go = False.    
-00015950: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-00015960: 2020 2020 2069 6d61 6765 5f64 7473 5b66       image_dts[f
-00015970: 696c 655f 6e61 6d65 5d20 3d20 706f 735f  ile_name] = pos_
-00015980: 6c69 7374 0a20 2020 2020 2020 2070 726f  list.        pro
-00015990: 672e 636c 6561 7228 290a 2020 2020 2020  g.clear().      
-000159a0: 2020 7265 7475 726e 4d73 6720 3d20 2222    returnMsg = ""
-000159b0: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
-000159c0: 756e 6d61 7463 6865 6454 696d 6550 6f69  unmatchedTimePoi
-000159d0: 6e74 7329 2021 3d20 303a 0a20 2020 2020  nts) != 0:.     
-000159e0: 2020 2020 2020 2075 6e6d 6174 6368 6564         unmatched
-000159f0: 5469 6d65 506f 696e 7473 2e73 6f72 7428  TimePoints.sort(
-00015a00: 290a 2020 2020 2020 2020 2020 2020 756e  ).            un
-00015a10: 6d61 7463 6865 6454 696d 6550 6f69 6e74  matchedTimePoint
-00015a20: 7320 3d20 5b64 6174 6574 696d 652e 6461  s = [datetime.da
-00015a30: 7465 7469 6d65 2e75 7463 6672 6f6d 7469  tetime.utcfromti
-00015a40: 6d65 7374 616d 7028 7473 292e 7374 7266  mestamp(ts).strf
-00015a50: 7469 6d65 286d 6971 7476 2e64 6174 655f  time(miqtv.date_
-00015a60: 666f 726d 6174 735b 276d 6172 6971 7427  formats['mariqt'
-00015a70: 5d29 2066 6f72 2074 7320 696e 2075 6e6d  ]) for ts in unm
-00015a80: 6174 6368 6564 5469 6d65 506f 696e 7473  atchedTimePoints
-00015a90: 5d0a 2020 2020 2020 2020 2020 2020 7265  ].            re
-00015aa0: 7475 726e 4d73 6720 3d20 2243 6175 7469  turnMsg = "Cauti
-00015ab0: 6f6e 2120 4e61 7669 6761 7469 6f6e 206e  on! Navigation n
-00015ac0: 6f74 2066 6f75 6e64 2066 6f72 2074 6865  ot found for the
-00015ad0: 2066 6f6c 6c6f 7769 6e67 2069 6d61 6765   following image
-00015ae0: 2074 696d 6520 706f 696e 7473 2e20 446f   time points. Do
-00015af0: 7562 6c65 2063 6865 636b 206f 7220 7072  uble check or pr
-00015b00: 6f76 6964 6520 6174 206c 6561 7374 2073  ovide at least s
-00015b10: 7461 7469 6320 6465 6661 756c 7420 6e61  tatic default na
-00015b20: 7669 6761 7469 6f6e 2069 6e20 6865 6164  vigation in head
-00015b30: 6572 2066 6965 6c64 732e 220a 2020 2020  er fields.".    
-00015b40: 2020 2020 2020 2020 7265 7475 726e 4d73          returnMs
-00015b50: 6720 2b3d 2022 5c6e 2220 2b20 225c 6e22  g += "\n" + "\n"
-00015b60: 2e6a 6f69 6e28 756e 6d61 7463 6865 6454  .join(unmatchedT
-00015b70: 696d 6550 6f69 6e74 7329 0a20 2020 2020  imePoints).     
-00015b80: 2020 2072 6574 7572 6e20 5472 7565 2c20     return True, 
-00015b90: 696d 6167 655f 6474 732c 2072 6574 7572  image_dts, retur
-00015ba0: 6e4d 7367 0a0a 0a20 2020 2064 6566 2063  nMsg...    def c
-00015bb0: 7265 6174 655f 696d 6167 655f 6e61 7669  reate_image_navi
-00015bc0: 6761 7469 6f6e 5f66 696c 6528 7365 6c66  gation_file(self
-00015bd0: 2c20 6e61 765f 7061 7468 3a20 7374 722c  , nav_path: str,
-00015be0: 206e 6176 5f68 6561 6465 723d 6d69 7174   nav_header=miqt
-00015bf0: 762e 706f 735f 6865 6164 6572 5b27 7061  v.pos_header['pa
-00015c00: 6e67 6165 6127 5d2c 2064 6174 655f 666f  ngaea'], date_fo
-00015c10: 726d 6174 3d6d 6971 7476 2e64 6174 655f  rmat=miqtv.date_
-00015c20: 666f 726d 6174 735b 2770 616e 6761 6561  formats['pangaea
-00015c30: 275d 2c20 6f76 6572 7772 6974 653d 4661  '], overwrite=Fa
-00015c40: 6c73 652c 2063 6f6c 5f73 6570 6172 6174  lse, col_separat
-00015c50: 6f72 203d 2022 5c74 222c 2076 6964 656f  or = "\t", video
-00015c60: 5361 6d70 6c65 5365 636f 6e64 733d 312c  SampleSeconds=1,
-00015c70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015c90: 2020 2020 206f 6666 7365 745f 783d 302c       offset_x=0,
-00015ca0: 206f 6666 7365 745f 793d 302c 206f 6666   offset_y=0, off
-00015cb0: 7365 745f 7a3d 302c 616e 676c 6573 5f69  set_z=0,angles_i
-00015cc0: 6e5f 7261 6420 3d20 4661 6c73 652c 2072  n_rad = False, r
-00015cd0: 6563 6f72 6473 3262 6549 6e76 6572 7465  ecords2beInverte
-00015ce0: 643d 5b5d 293a 0a20 2020 2020 2020 2022  d=[]):.        "
-00015cf0: 2222 2043 7265 6174 6573 2069 6e20 2f69  "" Creates in /i
-00015d00: 6e74 6572 6d65 6469 6174 6520 6120 7465  ntermediate a te
-00015d10: 7874 2066 696c 6520 7769 7468 2034 2e35  xt file with 4.5
-00015d20: 4420 6e61 7669 6761 7469 6f6e 2064 6174  D navigation dat
-00015d30: 6120 666f 7220 6561 6368 2069 6d61 6765  a for each image
-00015d40: 2c20 692e 652e 2061 2073 696e 676c 6520  , i.e. a single 
-00015d50: 726f 7720 7065 7220 7068 6f74 6f2c 2076  row per photo, v
-00015d60: 6964 656f 2064 7572 6174 696f 6e20 5b73  ideo duration [s
-00015d70: 6563 5d20 2f20 7669 6465 6f53 616d 706c  ec] / videoSampl
-00015d80: 6553 6563 6f6e 6473 2072 6f77 7320 7065  eSeconds rows pe
-00015d90: 7220 7669 6465 6f2e 0a20 2020 2020 2020  r video..       
-00015da0: 2020 2020 206e 6176 5f68 6561 6465 7220       nav_header 
-00015db0: 6d75 7374 2062 6520 6469 6374 2063 6f6e  must be dict con
-00015dc0: 7461 696e 696e 6720 7468 6520 6b65 7973  taining the keys
-00015dd0: 2027 7574 6327 2c27 6c61 7427 2c27 6c6f   'utc','lat','lo
-00015de0: 6e27 2c27 6465 7027 286f 7220 2761 6c74  n','dep'(or 'alt
-00015df0: 2729 2c20 6f70 7469 6f6e 616c 3a20 2768  '), optional: 'h
-00015e00: 6774 272c 2775 6e63 6572 7427 2077 6974  gt','uncert' wit
-00015e10: 6820 7468 6520 7265 7370 6563 7469 7665  h the respective
-00015e20: 2063 6f6c 756d 6e20 6865 6164 6572 7320   column headers 
-00015e30: 6173 2076 616c 7565 7320 0a20 2020 2020  as values .     
-00015e40: 2020 2020 2020 2069 6620 6f6e 6520 6f66         if one of
-00015e50: 2074 6865 2076 6568 6963 6c65 2078 2c79   the vehicle x,y
-00015e60: 2c7a 206f 6666 7365 7473 205b 6d5d 2069  ,z offsets [m] i
-00015e70: 7320 6e6f 7420 3020 616e 6420 6e61 765f  s not 0 and nav_
-00015e80: 6865 6164 6572 2061 6c73 6f20 636f 6e74  header also cont
-00015e90: 6169 6e73 2027 7961 7727 2c27 7069 7463  ains 'yaw','pitc
-00015ea0: 6827 2c27 726f 6c6c 2720 6c65 7665 7261  h','roll' levera
-00015eb0: 726d 206f 6666 7365 7473 2061 7265 2063  rm offsets are c
-00015ec0: 6f6d 7065 6e73 6174 6564 2066 6f72 2022  ompensated for "
-00015ed0: 2222 0a0a 2020 2020 2020 2020 6966 2073  ""..        if s
-00015ee0: 656c 662e 696e 7465 726d 6564 6961 7465  elf.intermediate
-00015ef0: 4e61 7646 696c 6545 7869 7374 7328 2920  NavFileExists() 
-00015f00: 616e 6420 6e6f 7420 6f76 6572 7772 6974  and not overwrit
-00015f10: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-00015f20: 6574 7572 6e20 5472 7565 2c20 224f 7574  eturn True, "Out
-00015f30: 7075 7420 6669 6c65 2065 7869 7374 733a  put file exists:
-00015f40: 2022 2b73 656c 662e 6765 745f 696e 745f   "+self.get_int_
-00015f50: 6e61 765f 6669 6c65 2829 0a0a 2020 2020  nav_file()..    
-00015f60: 2020 2020 6966 206e 6f74 206f 732e 7061      if not os.pa
-00015f70: 7468 2e65 7869 7374 7328 6e61 765f 7061  th.exists(nav_pa
-00015f80: 7468 293a 0a20 2020 2020 2020 2020 2020  th):.           
-00015f90: 2072 6574 7572 6e20 4661 6c73 652c 2022   return False, "
-00015fa0: 4e61 7669 6761 7469 6f6e 2066 696c 6520  Navigation file 
-00015fb0: 6e6f 7420 666f 756e 643a 2022 2b6e 6176  not found: "+nav
-00015fc0: 5f70 6174 680a 0a20 2020 2020 2020 2069  _path..        i
-00015fd0: 6620 6e6f 7420 6f73 2e70 6174 682e 6578  f not os.path.ex
-00015fe0: 6973 7473 2873 656c 662e 696d 6167 6573  ists(self.images
-00015ff0: 4469 7229 3a0a 2020 2020 2020 2020 2020  Dir):.          
-00016000: 2020 7265 7475 726e 2046 616c 7365 2c20    return False, 
-00016010: 2249 6d61 6765 2066 6f6c 6465 7220 6e6f  "Image folder no
-00016020: 7420 666f 756e 643a 2022 2b20 7365 6c66  t found: "+ self
-00016030: 2e69 6d61 6765 7344 6972 0a0a 2020 2020  .imagesDir..    
-00016040: 2020 2020 7320 3d20 6d69 7174 632e 5072      s = miqtc.Pr
-00016050: 696e 744c 6f61 6469 6e67 4d73 6728 2243  intLoadingMsg("C
-00016060: 7265 6174 696e 6720 6974 656d 7327 206e  reating items' n
-00016070: 6176 6967 6174 696f 6e20 6461 7461 2229  avigation data")
-00016080: 0a20 2020 2020 2020 2072 6574 7572 6e4d  .        returnM
-00016090: 7367 203d 2022 220a 2020 2020 2020 2020  sg = "".        
-000160a0: 636f 6d70 656e 7361 744f 6666 7365 7473  compensatOffsets
-000160b0: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
-000160c0: 2069 6620 286f 6666 7365 745f 7821 3d30   if (offset_x!=0
-000160d0: 206f 7220 6f66 6673 6574 5f79 213d 3020   or offset_y!=0 
-000160e0: 6f72 206f 6666 7365 745f 7a21 3d30 2920  or offset_z!=0) 
-000160f0: 616e 6420 2779 6177 2720 696e 206e 6176  and 'yaw' in nav
-00016100: 5f68 6561 6465 7220 616e 6420 2770 6974  _header and 'pit
-00016110: 6368 2720 696e 206e 6176 5f68 6561 6465  ch' in nav_heade
-00016120: 7220 616e 6420 2772 6f6c 6c27 2069 6e20  r and 'roll' in 
-00016130: 6e61 765f 6865 6164 6572 3a0a 2020 2020  nav_header:.    
-00016140: 2020 2020 2020 2020 636f 6d70 656e 7361          compensa
-00016150: 744f 6666 7365 7473 203d 2054 7275 650a  tOffsets = True.
-00016160: 0a20 2020 2020 2020 2023 2063 6865 636b  .        # check
-00016170: 2069 6620 666f 7220 6d69 7373 696e 6720   if for missing 
-00016180: 6669 656c 6473 2074 6865 7265 2061 7265  fields there are
-00016190: 2063 6f6e 7374 2076 616c 7565 7320 696e   const values in
-000161a0: 2068 6561 6465 720a 2020 2020 2020 2020   header.        
-000161b0: 636f 6e73 745f 7661 6c75 6573 203d 207b  const_values = {
-000161c0: 7d0a 2020 2020 2020 2020 666f 7220 6e61  }.        for na
-000161d0: 7646 6965 6c64 2069 6e20 6d69 7174 762e  vField in miqtv.
-000161e0: 706f 735f 6865 6164 6572 5b27 6d61 7269  pos_header['mari
-000161f0: 7174 275d 3a0a 2020 2020 2020 2020 2020  qt']:.          
-00016200: 2020 7265 7370 6563 7469 7665 4865 6164    respectiveHead
-00016210: 6572 4669 656c 6420 3d20 6d69 7174 762e  erField = miqtv.
-00016220: 636f 6c5f 6865 6164 6572 5b22 6d61 7269  col_header["mari
-00016230: 7174 225d 5b6e 6176 4669 656c 645d 0a20  qt"][navField]. 
-00016240: 2020 2020 2020 2020 2020 2069 6620 6e61             if na
-00016250: 7646 6965 6c64 206e 6f74 2069 6e20 6e61  vField not in na
-00016260: 765f 6865 6164 6572 2061 6e64 2028 7265  v_header and (re
-00016270: 7370 6563 7469 7665 4865 6164 6572 4669  spectiveHeaderFi
-00016280: 656c 6420 696e 2073 656c 662e 6966 646f  eld in self.ifdo
-00016290: 5f74 6d70 5b73 656c 662e 696d 6167 6553  _tmp[self.imageS
-000162a0: 6574 4865 6164 6572 4b65 795d 2061 6e64  etHeaderKey] and
-000162b0: 2073 656c 662e 6669 6e64 546d 7046 6965   self.findTmpFie
-000162c0: 6c64 3228 7265 7370 6563 7469 7665 4865  ld2(respectiveHe
-000162d0: 6164 6572 4669 656c 6429 2021 3d20 2222  aderField) != ""
-000162e0: 293a 200a 2020 2020 2020 2020 2020 2020  ): .            
-000162f0: 2020 2020 636f 6e73 745f 7661 6c75 6573      const_values
-00016300: 5b6e 6176 4669 656c 645d 203d 2073 656c  [navField] = sel
-00016310: 662e 6669 6e64 546d 7046 6965 6c64 2872  f.findTmpField(r
-00016320: 6573 7065 6374 6976 6548 6561 6465 7246  espectiveHeaderF
-00016330: 6965 6c64 290a 0a20 2020 2020 2020 2023  ield)..        #
-00016340: 204c 6f61 6420 6e61 7669 6761 7469 6f6e   Load navigation
-00016350: 2064 6174 610a 2020 2020 2020 2020 6e61   data.        na
-00016360: 765f 6461 7461 2c20 7061 7273 654d 7367  v_data, parseMsg
-00016370: 203d 206d 6971 746e 2e72 6561 6441 6c6c   = miqtn.readAll
-00016380: 506f 7369 7469 6f6e 7346 726f 6d46 696c  PositionsFromFil
-00016390: 6550 6174 6828 6e61 765f 7061 7468 2c20  ePath(nav_path, 
-000163a0: 6e61 765f 6865 6164 6572 2c20 6461 7465  nav_header, date
-000163b0: 5f66 6f72 6d61 742c 636f 6c5f 7365 7061  _format,col_sepa
-000163c0: 7261 746f 723d 636f 6c5f 7365 7061 7261  rator=col_separa
-000163d0: 746f 722c 636f 6e73 745f 7661 6c75 6573  tor,const_values
-000163e0: 3d63 6f6e 7374 5f76 616c 7565 7329 0a20  =const_values). 
-000163f0: 2020 2020 2020 2069 6620 7061 7273 654d         if parseM
-00016400: 7367 2021 3d20 2222 3a0a 2020 2020 2020  sg != "":.      
-00016410: 2020 2020 2020 7365 6c66 2e70 726f 762e        self.prov.
-00016420: 6c6f 6728 7061 7273 654d 7367 2c64 6f6e  log(parseMsg,don
-00016430: 7453 686f 773d 5472 7565 290a 2020 2020  tShow=True).    
-00016440: 2020 2020 2020 2020 7265 7475 726e 4d73          returnMs
-00016450: 6720 3d20 225c 6e22 202b 2070 6172 7365  g = "\n" + parse
-00016460: 4d73 670a 0a20 2020 2020 2020 2023 2066  Msg..        # f
-00016470: 696e 6420 666f 7220 6561 6368 2069 6d61  ind for each ima
-00016480: 6765 2074 6865 2072 6573 7065 6374 6976  ge the respectiv
-00016490: 6520 6e61 7669 6761 7469 6f6e 2064 6174  e navigation dat
-000164a0: 610a 2020 2020 2020 2020 732e 7374 6f70  a.        s.stop
-000164b0: 2829 0a20 2020 2020 2020 2073 7563 6365  ().        succe
-000164c0: 7373 2c20 696d 6167 655f 6474 732c 206d  ss, image_dts, m
-000164d0: 7367 203d 2073 656c 662e 6669 6e64 4e61  sg = self.findNa
-000164e0: 7644 6174 6146 6f72 496d 6167 6528 6e61  vDataForImage(na
-000164f0: 765f 6461 7461 2c76 6964 656f 5361 6d70  v_data,videoSamp
-00016500: 6c65 5365 636f 6e64 7329 0a20 2020 2020  leSeconds).     
-00016510: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
-00016520: 286d 7367 2c64 6f6e 7453 686f 773d 5472  (msg,dontShow=Tr
-00016530: 7565 290a 2020 2020 2020 2020 6966 206d  ue).        if m
-00016540: 7367 2021 3d20 2222 3a0a 2020 2020 2020  sg != "":.      
-00016550: 2020 2020 2020 7265 7475 726e 4d73 6720        returnMsg 
-00016560: 2b3d 2022 5c6e 2220 2b20 6d73 670a 2020  += "\n" + msg.  
-00016570: 2020 2020 2020 6966 206e 6f74 2073 7563        if not suc
-00016580: 6365 7373 3a0a 2020 2020 2020 2020 2020  cess:.          
-00016590: 2020 7265 7475 726e 2046 616c 7365 2c20    return False, 
-000165a0: 7265 7475 726e 4d73 670a 2020 2020 2020  returnMsg.      
-000165b0: 2020 7320 3d20 6d69 7174 632e 5072 696e    s = miqtc.Prin
-000165c0: 744c 6f61 6469 6e67 4d73 6728 2243 7265  tLoadingMsg("Cre
-000165d0: 6174 696e 6720 6974 656d 7327 206e 6176  ating items' nav
-000165e0: 6967 6174 696f 6e20 6461 7461 2229 0a0a  igation data")..
-000165f0: 2020 2020 2020 2020 2320 636f 6d70 656e          # compen
-00016600: 7361 7465 206c 6576 6572 6172 6d20 6f66  sate leverarm of
-00016610: 6673 6574 730a 2020 2020 2020 2020 6966  fsets.        if
-00016620: 2063 6f6d 7065 6e73 6174 4f66 6673 6574   compensatOffset
-00016630: 733a 0a0a 2020 2020 2020 2020 2020 2020  s:..            
-00016640: 2320 6c6f 6164 2066 7261 6d65 2061 7474  # load frame att
-00016650: 6974 7564 6520 6461 7461 2066 726f 6d20  itude data from 
-00016660: 6669 6c65 0a20 2020 2020 2020 2020 2020  file.           
-00016670: 2061 7474 5f64 6174 612c 2070 6172 7365   att_data, parse
-00016680: 4d73 6720 3d20 6d69 7174 6e2e 7265 6164  Msg = miqtn.read
-00016690: 416c 6c41 7474 6974 7564 6573 4672 6f6d  AllAttitudesFrom
-000166a0: 4669 6c65 5061 7468 286e 6176 5f70 6174  FilePath(nav_pat
-000166b0: 682c 206e 6176 5f68 6561 6465 722c 2064  h, nav_header, d
-000166c0: 6174 655f 666f 726d 6174 2c63 6f6c 5f73  ate_format,col_s
-000166d0: 6570 6172 6174 6f72 3d63 6f6c 5f73 6570  eparator=col_sep
-000166e0: 6172 6174 6f72 2c63 6f6e 7374 5f76 616c  arator,const_val
-000166f0: 7565 733d 636f 6e73 745f 7661 6c75 6573  ues=const_values
-00016700: 2c61 6e67 6c65 7349 6e52 6164 3d61 6e67  ,anglesInRad=ang
-00016710: 6c65 735f 696e 5f72 6164 290a 2020 2020  les_in_rad).    
-00016720: 2020 2020 2020 2020 6966 2070 6172 7365          if parse
-00016730: 4d73 6720 213d 2022 223a 0a20 2020 2020  Msg != "":.     
-00016740: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00016750: 7072 6f76 2e6c 6f67 2870 6172 7365 4d73  prov.log(parseMs
-00016760: 672c 646f 6e74 5368 6f77 3d54 7275 6529  g,dontShow=True)
-00016770: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016780: 2072 6574 7572 6e4d 7367 202b 3d20 225c   returnMsg += "\
-00016790: 6e22 202b 2070 6172 7365 4d73 670a 0a20  n" + parseMsg.. 
-000167a0: 2020 2020 2020 2020 2020 2023 2066 696e             # fin
-000167b0: 6420 666f 7220 6561 6368 2069 6d61 6765  d for each image
-000167c0: 2074 6865 2072 6573 7065 6374 6976 6520   the respective 
-000167d0: 6e61 7669 6761 7469 6f6e 2064 6174 610a  navigation data.
-000167e0: 2020 2020 2020 2020 2020 2020 7375 6363              succ
-000167f0: 6573 732c 2069 6d61 6765 5f64 7473 5f61  ess, image_dts_a
-00016800: 7474 2c20 6d73 6720 3d20 7365 6c66 2e66  tt, msg = self.f
-00016810: 696e 644e 6176 4461 7461 466f 7249 6d61  indNavDataForIma
-00016820: 6765 2861 7474 5f64 6174 612c 7669 6465  ge(att_data,vide
-00016830: 6f53 616d 706c 6553 6563 6f6e 6473 290a  oSampleSeconds).
-00016840: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00016850: 2e70 726f 762e 6c6f 6728 6d73 672c 646f  .prov.log(msg,do
-00016860: 6e74 5368 6f77 3d54 7275 6529 0a20 2020  ntShow=True).   
-00016870: 2020 2020 2020 2020 2069 6620 6d73 6720           if msg 
-00016880: 213d 2022 223a 0a20 2020 2020 2020 2020  != "":.         
-00016890: 2020 2020 2020 2072 6574 7572 6e4d 7367         returnMsg
-000168a0: 202b 3d20 225c 6e22 202b 206d 7367 0a20   += "\n" + msg. 
-000168b0: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-000168c0: 7420 7375 6363 6573 733a 0a20 2020 2020  t success:.     
-000168d0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-000168e0: 6e20 4661 6c73 652c 2072 6574 7572 6e4d  n False, returnM
-000168f0: 7367 0a0a 2020 2020 2020 2020 2020 2020  sg..            
-00016900: 2320 636f 6d70 656e 7361 7465 0a20 2020  # compensate.   
-00016910: 2020 2020 2020 2020 2066 6f72 2066 696c           for fil
-00016920: 6520 696e 2069 6d61 6765 5f64 7473 3a0a  e in image_dts:.
-00016930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016940: 706f 7369 7469 6f6e 7320 3d20 696d 6167  positions = imag
-00016950: 655f 6474 735b 6669 6c65 5d0a 2020 2020  e_dts[file].    
-00016960: 2020 2020 2020 2020 2020 2020 6174 7469              atti
-00016970: 7475 6465 7320 3d20 696d 6167 655f 6474  tudes = image_dt
-00016980: 735f 6174 745b 6669 6c65 5d0a 2020 2020  s_att[file].    
-00016990: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-000169a0: 6920 696e 2072 616e 6765 286c 656e 2870  i in range(len(p
-000169b0: 6f73 6974 696f 6e73 2929 3a0a 2020 2020  ositions)):.    
-000169c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000169d0: 6c61 7420 3d20 706f 7369 7469 6f6e 735b  lat = positions[
-000169e0: 695d 2e6c 6174 0a20 2020 2020 2020 2020  i].lat.         
-000169f0: 2020 2020 2020 2020 2020 206c 6f6e 203d             lon =
-00016a00: 2070 6f73 6974 696f 6e73 5b69 5d2e 6c6f   positions[i].lo
-00016a10: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
-00016a20: 2020 2020 2020 6465 7020 3d20 706f 7369        dep = posi
-00016a30: 7469 6f6e 735b 695d 2e64 6570 0a20 2020  tions[i].dep.   
-00016a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016a50: 2069 6620 2761 6c74 2720 696e 206e 6176   if 'alt' in nav
-00016a60: 5f68 6561 6465 7220 616e 6420 6e6f 7420  _header and not 
-00016a70: 2764 6570 2720 696e 206e 6176 5f68 6561  'dep' in nav_hea
-00016a80: 6465 723a 0a20 2020 2020 2020 2020 2020  der:.           
-00016a90: 2020 2020 2020 2020 2020 2020 2064 6570               dep
-00016aa0: 202a 3d20 2d31 0a20 2020 2020 2020 2020   *= -1.         
-00016ab0: 2020 2020 2020 2020 2020 2079 6177 203d             yaw =
-00016ac0: 2061 7474 6974 7564 6573 5b69 5d2e 7961   attitudes[i].ya
-00016ad0: 770a 2020 2020 2020 2020 2020 2020 2020  w.              
-00016ae0: 2020 2020 2020 7069 7463 6820 3d20 6174        pitch = at
-00016af0: 7469 7475 6465 735b 695d 2e70 6974 6368  titudes[i].pitch
-00016b00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016b10: 2020 2020 2072 6f6c 6c20 3d20 6174 7469       roll = atti
-00016b20: 7475 6465 735b 695d 2e72 6f6c 6c0a 2020  tudes[i].roll.  
-00016b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016b40: 2020 6966 2079 6177 2069 7320 4e6f 6e65    if yaw is None
-00016b50: 206f 7220 7069 7463 6820 6973 204e 6f6e   or pitch is Non
-00016b60: 6520 6f72 2072 6f6c 6c20 6973 204e 6f6e  e or roll is Non
-00016b70: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00016b80: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
-00016b90: 6e75 650a 2020 2020 2020 2020 2020 2020  nue.            
-00016ba0: 2020 2020 2020 2020 6e65 775f 6c61 742c          new_lat,
-00016bb0: 6e65 775f 6c6f 6e2c 6e65 775f 6465 7020  new_lon,new_dep 
-00016bc0: 3d20 6d69 7174 672e 6164 644c 6576 6572  = miqtg.addLever
-00016bd0: 6172 6d73 324c 6174 6c6f 6e28 6c61 742c  arms2Latlon(lat,
-00016be0: 6c6f 6e2c 6465 702c 6f66 6673 6574 5f78  lon,dep,offset_x
-00016bf0: 2c6f 6666 7365 745f 792c 6f66 6673 6574  ,offset_y,offset
-00016c00: 5f7a 2c79 6177 2c70 6974 6368 2c72 6f6c  _z,yaw,pitch,rol
-00016c10: 6c29 0a20 2020 2020 2020 2020 2020 2020  l).             
-00016c20: 2020 2020 2020 2070 6f73 6974 696f 6e73         positions
-00016c30: 5b69 5d2e 6c61 7420 3d20 6e65 775f 6c61  [i].lat = new_la
-00016c40: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
-00016c50: 2020 2020 2020 706f 7369 7469 6f6e 735b        positions[
-00016c60: 695d 2e6c 6f6e 203d 206e 6577 5f6c 6f6e  i].lon = new_lon
-00016c70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016c80: 2020 2020 2070 6f73 6974 696f 6e73 5b69       positions[i
-00016c90: 5d2e 6465 7020 3d20 6e65 775f 6465 700a  ].dep = new_dep.
-00016ca0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00016cb0: 662e 7072 6f76 2e6c 6f67 2822 6170 706c  f.prov.log("appl
-00016cc0: 6965 6420 6c65 7665 7220 6172 6d20 636f  ied lever arm co
-00016cd0: 6d70 656e 7361 7469 6f6e 2078 2c79 2c7a  mpensation x,y,z
-00016ce0: 203d 2022 202b 2073 7472 286f 6666 7365   = " + str(offse
-00016cf0: 745f 7829 202b 2022 2c22 202b 2073 7472  t_x) + "," + str
-00016d00: 286f 6666 7365 745f 7929 202b 2022 2c22  (offset_y) + ","
-00016d10: 202b 2073 7472 286f 6666 7365 745f 7a29   + str(offset_z)
-00016d20: 2c64 6f6e 7453 686f 773d 5472 7565 290a  ,dontShow=True).
-00016d30: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
-00016d40: 696d 6167 655f 6474 7329 203e 2030 3a0a  image_dts) > 0:.
-00016d50: 2020 2020 2020 2020 2020 2020 2320 4368              # Ch
-00016d60: 6563 6b20 7768 6574 6865 7220 6465 7074  eck whether dept
-00016d70: 6820 616e 6420 6865 6967 6874 2061 7265  h and height are
-00016d80: 2073 6574 0a20 2020 2020 2020 2020 2020   set.           
-00016d90: 206c 6174 5f69 6465 6e74 6963 616c 2c20   lat_identical, 
-00016da0: 6c6f 6e5f 6964 656e 7469 6361 6c2c 2064  lon_identical, d
-00016db0: 6570 5f69 6465 6e74 6963 616c 2c20 6867  ep_identical, hg
-00016dc0: 745f 6964 656e 7469 6361 6c2c 2064 6570  t_identical, dep
-00016dd0: 5f6e 6f74 5f7a 6572 6f2c 2068 6774 5f6e  _not_zero, hgt_n
-00016de0: 6f74 5f7a 6572 6f2c 756e 6365 7274 5f6e  ot_zero,uncert_n
-00016df0: 6f74 5f7a 6572 6f20 3d20 6e61 765f 6461  ot_zero = nav_da
-00016e00: 7461 2e63 6865 636b 506f 7369 7469 6f6e  ta.checkPosition
-00016e10: 7343 6f6e 7465 6e74 2829 0a0a 2020 2020  sContent()..    
-00016e20: 2020 2020 2020 2020 2320 5772 6974 6520          # Write 
-00016e30: 746f 206e 6176 6967 6174 696f 6e20 7478  to navigation tx
-00016e40: 7420 6669 6c65 0a20 2020 2020 2020 2020  t file.         
-00016e50: 2020 2023 2068 6561 6465 720a 2020 2020     # header.    
-00016e60: 2020 2020 2020 2020 7265 7320 3d20 6f70          res = op
-00016e70: 656e 2873 656c 662e 6765 745f 696e 745f  en(self.get_int_
-00016e80: 6e61 765f 6669 6c65 2829 2c20 2277 2229  nav_file(), "w")
-00016e90: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-00016ea0: 2e77 7269 7465 286d 6971 7476 2e63 6f6c  .write(miqtv.col
-00016eb0: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
-00016ec0: 5d5b 2769 6d67 275d 2b22 5c74 222b 6d69  ]['img']+"\t"+mi
-00016ed0: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
-00016ee0: 6d61 7269 7174 275d 5b27 7574 6327 5d29  mariqt']['utc'])
-00016ef0: 0a0a 2020 2020 2020 2020 2020 2020 6861  ..            ha
-00016f00: 735f 616c 7420 3d20 5472 7565 2069 6620  s_alt = True if 
-00016f10: 6465 705f 6e6f 745f 7a65 726f 2061 6e64  dep_not_zero and
-00016f20: 2028 2027 6465 7027 2069 6e20 6e61 765f   ( 'dep' in nav_
-00016f30: 6865 6164 6572 206f 7220 2761 6c74 2720  header or 'alt' 
-00016f40: 696e 206e 6176 5f68 6561 6465 7220 2920  in nav_header ) 
-00016f50: 656c 7365 2046 616c 7365 0a0a 2020 2020  else False..    
-00016f60: 2020 2020 2020 2020 6966 2027 6c61 7427          if 'lat'
-00016f70: 2069 6e20 6e61 765f 6865 6164 6572 3a0a   in nav_header:.
-00016f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016f90: 7265 732e 7772 6974 6528 225c 7422 2b6d  res.write("\t"+m
-00016fa0: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
-00016fb0: 276d 6172 6971 7427 5d5b 276c 6174 275d  'mariqt']['lat']
-00016fc0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00016fd0: 2027 6c6f 6e27 2069 6e20 6e61 765f 6865   'lon' in nav_he
-00016fe0: 6164 6572 3a0a 2020 2020 2020 2020 2020  ader:.          
-00016ff0: 2020 2020 2020 7265 732e 7772 6974 6528        res.write(
-00017000: 225c 7422 2b6d 6971 7476 2e63 6f6c 5f68  "\t"+miqtv.col_h
-00017010: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
-00017020: 276c 6f6e 275d 290a 2020 2020 2020 2020  'lon']).        
-00017030: 2020 2020 6966 2068 6173 5f61 6c74 3a0a      if has_alt:.
-00017040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017050: 7265 732e 7772 6974 6528 225c 7422 2b6d  res.write("\t"+m
-00017060: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
-00017070: 276d 6172 6971 7427 5d5b 2761 6c74 275d  'mariqt']['alt']
-00017080: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00017090: 2068 6774 5f6e 6f74 5f7a 6572 6f20 616e   hgt_not_zero an
-000170a0: 6420 2768 6774 2720 696e 206e 6176 5f68  d 'hgt' in nav_h
-000170b0: 6561 6465 723a 0a20 2020 2020 2020 2020  eader:.         
-000170c0: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
-000170d0: 2822 5c74 222b 6d69 7174 762e 636f 6c5f  ("\t"+miqtv.col_
-000170e0: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
-000170f0: 5b27 6867 7427 5d29 0a20 2020 2020 2020  ['hgt']).       
-00017100: 2020 2020 2069 6620 756e 6365 7274 5f6e       if uncert_n
-00017110: 6f74 5f7a 6572 6f20 616e 6420 2775 6e63  ot_zero and 'unc
-00017120: 6572 7427 2069 6e20 6e61 765f 6865 6164  ert' in nav_head
-00017130: 6572 3a0a 2020 2020 2020 2020 2020 2020  er:.            
-00017140: 2020 2020 7265 732e 7772 6974 6528 225c      res.write("\
-00017150: 7422 2b6d 6971 7476 2e63 6f6c 5f68 6561  t"+miqtv.col_hea
-00017160: 6465 725b 276d 6172 6971 7427 5d5b 2775  der['mariqt']['u
-00017170: 6e63 6572 7427 5d29 0a20 2020 2020 2020  ncert']).       
-00017180: 2020 2020 2072 6573 2e77 7269 7465 2822       res.write("
-00017190: 5c6e 2229 0a20 2020 2020 2020 2020 2020  \n").           
-000171a0: 2023 2064 6174 6120 6c69 6e65 730a 2020   # data lines.  
-000171b0: 2020 2020 2020 2020 2020 666f 7220 6669            for fi
-000171c0: 6c65 2069 6e20 696d 6167 655f 6474 733a  le in image_dts:
-000171d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000171e0: 2066 6f72 2074 696d 6570 6f69 6e74 2069   for timepoint i
-000171f0: 6e20 696d 6167 655f 6474 735b 6669 6c65  n image_dts[file
-00017200: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
-00017210: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
-00017220: 2866 696c 652b 225c 7422 2b74 696d 6570  (file+"\t"+timep
-00017230: 6f69 6e74 2e64 6174 6554 696d 6528 292e  oint.dateTime().
-00017240: 7374 7266 7469 6d65 286d 6971 7476 2e64  strftime(miqtv.d
-00017250: 6174 655f 666f 726d 6174 735b 276d 6172  ate_formats['mar
-00017260: 6971 7427 5d29 2920 0a20 2020 2020 2020  iqt'])) .       
-00017270: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00017280: 276c 6174 2720 696e 206e 6176 5f68 6561  'lat' in nav_hea
-00017290: 6465 723a 0a20 2020 2020 2020 2020 2020  der:.           
-000172a0: 2020 2020 2020 2020 2020 2020 2076 616c               val
-000172b0: 203d 2074 696d 6570 6f69 6e74 2e6c 6174   = timepoint.lat
-000172c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000172d0: 2020 2020 2020 2020 2069 6620 276c 6174           if 'lat
-000172e0: 2720 696e 2072 6563 6f72 6473 3262 6549  ' in records2beI
-000172f0: 6e76 6572 7465 643a 0a20 2020 2020 2020  nverted:.       
-00017300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017310: 2020 2020 2076 616c 202a 3d20 2d31 0a20       val *= -1. 
+000142b0: 2020 2061 7474 6974 7564 6573 5b69 5d2e     attitudes[i].
+000142c0: 726f 6c6c 202a 3d20 2d31 0a0a 0a20 2020  roll *= -1...   
+000142d0: 2020 2020 2023 2061 6464 2063 616d 6572       # add camer
+000142e0: 6132 4672 616d 6520 616e 676c 6573 0a20  a2Frame angles. 
+000142f0: 2020 2020 2020 2052 5f63 616d 3266 7261         R_cam2fra
+00014300: 6d65 203d 206d 6971 7467 2e52 5f59 6177  me = miqtg.R_Yaw
+00014310: 5069 7463 6852 6f6c 6c28 6361 6d65 7261  PitchRoll(camera
+00014320: 3246 7261 6d65 5f79 6177 2c63 616d 6572  2Frame_yaw,camer
+00014330: 6132 4672 616d 655f 7069 7463 682c 6361  a2Frame_pitch,ca
+00014340: 6d65 7261 3246 7261 6d65 5f72 6f6c 6c29  mera2Frame_roll)
+00014350: 0a20 2020 2020 2020 2052 5f63 616d 3275  .        R_cam2u
+00014360: 746d 5f6c 6973 7420 3d20 5b5d 0a20 2020  tm_list = [].   
+00014370: 2020 2020 2066 6f72 2066 696c 6520 696e       for file in
+00014380: 2069 6d61 6765 5f64 7473 3a0a 2020 2020   image_dts:.    
+00014390: 2020 2020 2020 2020 666f 7220 7469 6d65          for time
+000143a0: 706f 696e 7420 696e 2069 6d61 6765 5f64  point in image_d
+000143b0: 7473 5b66 696c 655d 3a0a 2020 2020 2020  ts[file]:.      
+000143c0: 2020 2020 2020 2020 2020 6174 7469 7475            attitu
+000143d0: 6465 203d 2074 696d 6570 6f69 6e74 0a20  de = timepoint. 
+000143e0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000143f0: 6620 6174 7469 7475 6465 2e79 6177 2069  f attitude.yaw i
+00014400: 7320 4e6f 6e65 206f 7220 6174 7469 7475  s None or attitu
+00014410: 6465 2e70 6974 6368 2069 7320 4e6f 6e65  de.pitch is None
+00014420: 206f 7220 6174 7469 7475 6465 2e72 6f6c   or attitude.rol
+00014430: 6c20 6973 204e 6f6e 653a 0a20 2020 2020  l is None:.     
+00014440: 2020 2020 2020 2020 2020 2020 2020 2052                 R
+00014450: 5f63 616d 3275 746d 5f6c 6973 742e 6170  _cam2utm_list.ap
+00014460: 7065 6e64 2822 2229 0a20 2020 2020 2020  pend("").       
+00014470: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+00014480: 7469 6e75 650a 2020 2020 2020 2020 2020  tinue.          
+00014490: 2020 2020 2020 525f 6672 616d 6532 6e65        R_frame2ne
+000144a0: 6420 3d20 6d69 7174 672e 525f 5961 7750  d = miqtg.R_YawP
+000144b0: 6974 6368 526f 6c6c 2861 7474 6974 7564  itchRoll(attitud
+000144c0: 652e 7961 772c 6174 7469 7475 6465 2e70  e.yaw,attitude.p
+000144d0: 6974 6368 2c61 7474 6974 7564 652e 726f  itch,attitude.ro
+000144e0: 6c6c 290a 2020 2020 2020 2020 2020 2020  ll).            
+000144f0: 2020 2020 525f 6361 6d32 6e65 6420 3d20      R_cam2ned = 
+00014500: 525f 6672 616d 6532 6e65 642e 646f 7428  R_frame2ned.dot(
+00014510: 525f 6361 6d32 6672 616d 6529 0a20 2020  R_cam2frame).   
+00014520: 2020 2020 2020 2020 2020 2020 2079 6177               yaw
+00014530: 2c70 6974 6368 2c72 6f6c 6c20 3d20 6d69  ,pitch,roll = mi
+00014540: 7174 672e 7961 7750 6974 6368 526f 6c6c  qtg.yawPitchRoll
+00014550: 2852 5f63 616d 326e 6564 290a 2020 2020  (R_cam2ned).    
+00014560: 2020 2020 2020 2020 2020 2020 6174 7469              atti
+00014570: 7475 6465 2e79 6177 203d 2079 6177 0a20  tude.yaw = yaw. 
+00014580: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00014590: 7474 6974 7564 652e 7069 7463 6820 3d20  ttitude.pitch = 
+000145a0: 7069 7463 680a 2020 2020 2020 2020 2020  pitch.          
+000145b0: 2020 2020 2020 6174 7469 7475 6465 2e72        attitude.r
+000145c0: 6f6c 6c20 3d20 726f 6c6c 0a0a 2020 2020  oll = roll..    
+000145d0: 2020 2020 2020 2020 2020 2020 525f 6361              R_ca
+000145e0: 6d53 7464 3275 746d 203d 2073 656c 662e  mStd2utm = self.
+000145f0: 6765 745f 525f 6361 6d53 7464 3275 746d  get_R_camStd2utm
+00014600: 2852 5f63 616d 3266 7261 6d65 2c52 5f66  (R_cam2frame,R_f
+00014610: 7261 6d65 326e 6564 290a 2020 2020 2020  rame2ned).      
+00014620: 2020 2020 2020 2020 2020 525f 6361 6d32            R_cam2
+00014630: 7574 6d5f 6c69 7374 2e61 7070 656e 6428  utm_list.append(
+00014640: 525f 6361 6d53 7464 3275 746d 2e66 6c61  R_camStd2utm.fla
+00014650: 7474 656e 2829 2e74 6f6c 6973 7428 2929  tten().tolist())
+00014660: 0a0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
+00014670: 726f 762e 6c6f 6728 2261 7070 6c69 6564  rov.log("applied
+00014680: 2066 7261 6d65 2074 6f20 6361 6d65 7261   frame to camera
+00014690: 2072 6f74 6174 696f 6e20 7961 772c 7069   rotation yaw,pi
+000146a0: 7463 682c 726f 6c6c 203d 2022 202b 2073  tch,roll = " + s
+000146b0: 7472 2863 616d 6572 6132 4672 616d 655f  tr(camera2Frame_
+000146c0: 7961 7729 202b 2022 2c22 202b 2073 7472  yaw) + "," + str
+000146d0: 2863 616d 6572 6132 4672 616d 655f 7069  (camera2Frame_pi
+000146e0: 7463 6829 202b 2022 2c22 202b 2073 7472  tch) + "," + str
+000146f0: 2863 616d 6572 6132 4672 616d 655f 726f  (camera2Frame_ro
+00014700: 6c6c 292c 646f 6e74 5368 6f77 3d54 7275  ll),dontShow=Tru
+00014710: 6529 0a0a 2020 2020 2020 2020 6966 206c  e)..        if l
+00014720: 656e 2869 6d61 6765 5f64 7473 2920 3e20  en(image_dts) > 
+00014730: 303a 0a0a 2020 2020 2020 2020 2020 2020  0:..            
+00014740: 2320 5772 6974 6520 746f 206e 6176 6967  # Write to navig
+00014750: 6174 696f 6e20 7478 7420 6669 6c65 0a20  ation txt file. 
+00014760: 2020 2020 2020 2020 2020 2023 2068 6561             # hea
+00014770: 6465 720a 2020 2020 2020 2020 2020 2020  der.            
+00014780: 7265 7320 3d20 6f70 656e 2869 6e74 5f61  res = open(int_a
+00014790: 7474 7574 7564 655f 6669 6c65 2c20 2277  ttutude_file, "w
+000147a0: 2229 0a20 2020 2020 2020 2020 2020 2072  ").            r
+000147b0: 6573 2e77 7269 7465 286d 6971 7476 2e63  es.write(miqtv.c
+000147c0: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
+000147d0: 7427 5d5b 2769 6d67 275d 2b22 5c74 222b  t']['img']+"\t"+
+000147e0: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
+000147f0: 5b27 6d61 7269 7174 275d 5b27 7574 6327  ['mariqt']['utc'
+00014800: 5d29 0a20 2020 2020 2020 2020 2020 2072  ]).            r
+00014810: 6573 2e77 7269 7465 2822 5c74 222b 6d69  es.write("\t"+mi
+00014820: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
+00014830: 6d61 7269 7174 275d 5b27 7961 7727 5d29  mariqt']['yaw'])
+00014840: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+00014850: 2e77 7269 7465 2822 5c74 222b 6d69 7174  .write("\t"+miqt
+00014860: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
+00014870: 7269 7174 275d 5b27 7069 7463 6827 5d29  riqt']['pitch'])
+00014880: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+00014890: 2e77 7269 7465 2822 5c74 222b 6d69 7174  .write("\t"+miqt
+000148a0: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
+000148b0: 7269 7174 275d 5b27 726f 6c6c 275d 290a  riqt']['roll']).
+000148c0: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+000148d0: 2e77 7269 7465 2822 5c6e 2229 0a20 2020  .write("\n").   
+000148e0: 2020 2020 2020 2020 2023 2064 6174 6120           # data 
+000148f0: 6c69 6e65 730a 2020 2020 2020 2020 2020  lines.          
+00014900: 2020 666f 7220 6669 6c65 2069 6e20 696d    for file in im
+00014910: 6167 655f 6474 733a 0a20 2020 2020 2020  age_dts:.       
+00014920: 2020 2020 2020 2020 2066 6f72 2074 696d           for tim
+00014930: 6570 6f69 6e74 2069 6e20 696d 6167 655f  epoint in image_
+00014940: 6474 735b 6669 6c65 5d3a 0a20 2020 2020  dts[file]:.     
+00014950: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00014960: 6573 2e77 7269 7465 2866 696c 652b 225c  es.write(file+"\
+00014970: 7422 2b74 696d 6570 6f69 6e74 2e64 6174  t"+timepoint.dat
+00014980: 6554 696d 6528 292e 7374 7266 7469 6d65  eTime().strftime
+00014990: 286d 6971 7476 2e64 6174 655f 666f 726d  (miqtv.date_form
+000149a0: 6174 735b 276d 6172 6971 7427 5d29 2920  ats['mariqt'])) 
+000149b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000149c0: 2020 2020 2076 616c 203d 2074 696d 6570       val = timep
+000149d0: 6f69 6e74 2e79 6177 0a20 2020 2020 2020  oint.yaw.       
+000149e0: 2020 2020 2020 2020 2020 2020 2072 6573               res
+000149f0: 2e77 7269 7465 2822 5c74 222b 7374 7228  .write("\t"+str(
+00014a00: 7661 6c29 290a 2020 2020 2020 2020 2020  val)).          
+00014a10: 2020 2020 2020 2020 2020 7661 6c20 3d20            val = 
+00014a20: 7469 6d65 706f 696e 742e 7069 7463 680a  timepoint.pitch.
+00014a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014a40: 2020 2020 7265 732e 7772 6974 6528 225c      res.write("\
+00014a50: 7422 2b73 7472 2876 616c 2929 0a20 2020  t"+str(val)).   
+00014a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014a70: 2076 616c 203d 2074 696d 6570 6f69 6e74   val = timepoint
+00014a80: 2e72 6f6c 6c0a 2020 2020 2020 2020 2020  .roll.          
+00014a90: 2020 2020 2020 2020 2020 7265 732e 7772            res.wr
+00014aa0: 6974 6528 225c 7422 2b73 7472 2876 616c  ite("\t"+str(val
+00014ab0: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
+00014ac0: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
+00014ad0: 2822 5c6e 2229 0a20 2020 2020 2020 2020  ("\n").         
+00014ae0: 2020 2072 6573 2e63 6c6f 7365 2829 0a0a     res.close()..
+00014af0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00014b00: 2e70 726f 762e 6164 6441 7267 756d 656e  .prov.addArgumen
+00014b10: 7428 2269 6e70 7574 4174 7469 7475 6465  t("inputAttitude
+00014b20: 4669 6c65 222c 6174 745f 7061 7468 2c6f  File",att_path,o
+00014b30: 7665 7277 7269 7465 3d54 7275 6529 0a20  verwrite=True). 
+00014b40: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00014b50: 7072 6f76 2e6c 6f67 2822 7061 7273 6564  prov.log("parsed
+00014b60: 2066 726f 6d20 696e 7075 7441 7474 6974   from inputAttit
+00014b70: 7564 6546 696c 653a 2022 202b 2073 7472  udeFile: " + str
+00014b80: 2866 7261 6d65 5f61 7474 5f68 6561 6465  (frame_att_heade
+00014b90: 7229 2c64 6f6e 7453 686f 773d 5472 7565  r),dontShow=True
+00014ba0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00014bb0: 6c66 2e61 6464 5f69 7465 6d5f 696e 666f  lf.add_item_info
+00014bc0: 5f74 6162 5f66 696c 6528 696e 745f 6174  _tab_file(int_at
+00014bd0: 7475 7475 6465 5f66 696c 652c 225c 7422  tutude_file,"\t"
+00014be0: 2c6f 7574 7075 745f 6865 6164 6572 5f61  ,output_header_a
+00014bf0: 7474 290a 0a20 2020 2020 2020 2020 2020  tt)..           
+00014c00: 2023 2057 7269 7465 2074 6f20 706f 7365   # Write to pose
+00014c10: 2074 7874 2066 696c 650a 2020 2020 2020   txt file.      
+00014c20: 2020 2020 2020 2320 6865 6164 6572 0a20        # header. 
+00014c30: 2020 2020 2020 2020 2020 2072 6573 203d             res =
+00014c40: 206f 7065 6e28 696e 745f 706f 7365 5f66   open(int_pose_f
+00014c50: 696c 652c 2022 7722 290a 2020 2020 2020  ile, "w").      
+00014c60: 2020 2020 2020 7265 732e 7772 6974 6528        res.write(
+00014c70: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
+00014c80: 5b27 6d61 7269 7174 275d 5b27 696d 6727  ['mariqt']['img'
+00014c90: 5d2b 225c 7422 2b6d 6971 7476 2e63 6f6c  ]+"\t"+miqtv.col
+00014ca0: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
+00014cb0: 5d5b 2775 7463 275d 290a 2020 2020 2020  ]['utc']).      
+00014cc0: 2020 2020 2020 7265 732e 7772 6974 6528        res.write(
+00014cd0: 225c 7422 2b6d 6971 7476 2e63 6f6c 5f68  "\t"+miqtv.col_h
+00014ce0: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
+00014cf0: 2770 6f73 6527 5d29 0a20 2020 2020 2020  'pose']).       
+00014d00: 2020 2020 2072 6573 2e77 7269 7465 2822       res.write("
+00014d10: 5c6e 2229 0a20 2020 2020 2020 2020 2020  \n").           
+00014d20: 2023 2064 6174 6120 6c69 6e65 730a 2020   # data lines.  
+00014d30: 2020 2020 2020 2020 2020 6920 3d20 300a            i = 0.
+00014d40: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00014d50: 6669 6c65 2069 6e20 696d 6167 655f 6474  file in image_dt
+00014d60: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+00014d70: 2020 2066 6f72 2074 696d 6570 6f69 6e74     for timepoint
+00014d80: 2069 6e20 696d 6167 655f 6474 735b 6669   in image_dts[fi
+00014d90: 6c65 5d3a 0a20 2020 2020 2020 2020 2020  le]:.           
+00014da0: 2020 2020 2020 2020 2069 6620 525f 6361           if R_ca
+00014db0: 6d32 7574 6d5f 6c69 7374 5b69 5d20 3d3d  m2utm_list[i] ==
+00014dc0: 2022 223a 0a20 2020 2020 2020 2020 2020   "":.           
+00014dd0: 2020 2020 2020 2020 2020 2020 2069 202b               i +
+00014de0: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
+00014df0: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+00014e00: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
+00014e10: 2020 2020 2020 2020 2072 6573 2e77 7269           res.wri
+00014e20: 7465 2866 696c 652b 225c 7422 2b74 696d  te(file+"\t"+tim
+00014e30: 6570 6f69 6e74 2e64 6174 6554 696d 6528  epoint.dateTime(
+00014e40: 292e 7374 7266 7469 6d65 286d 6971 7476  ).strftime(miqtv
+00014e50: 2e64 6174 655f 666f 726d 6174 735b 276d  .date_formats['m
+00014e60: 6172 6971 7427 5d29 2920 0a20 2020 2020  ariqt'])) .     
+00014e70: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00014e80: 6e74 7279 203d 2073 7472 287b 2770 6f73  ntry = str({'pos
+00014e90: 652d 6162 736f 6c75 7465 2d6f 7269 656e  e-absolute-orien
+00014ea0: 7461 7469 6f6e 2d75 746d 2d6d 6174 7269  tation-utm-matri
+00014eb0: 7827 3a52 5f63 616d 3275 746d 5f6c 6973  x':R_cam2utm_lis
+00014ec0: 745b 695d 7d29 2e72 6570 6c61 6365 2827  t[i]}).replace('
+00014ed0: 5c6e 272c 2727 290a 2020 2020 2020 2020  \n','').        
+00014ee0: 2020 2020 2020 2020 2020 2020 7265 732e              res.
+00014ef0: 7772 6974 6528 225c 7422 2b65 6e74 7279  write("\t"+entry
+00014f00: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00014f10: 2020 2020 2020 6920 2b3d 2031 0a20 2020        i += 1.   
+00014f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014f30: 2072 6573 2e77 7269 7465 2822 5c6e 2229   res.write("\n")
+00014f40: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+00014f50: 2e63 6c6f 7365 2829 0a20 2020 2020 2020  .close().       
+00014f60: 2020 2020 2073 656c 662e 6164 645f 6974       self.add_it
+00014f70: 656d 5f69 6e66 6f5f 7461 625f 6669 6c65  em_info_tab_file
+00014f80: 2869 6e74 5f70 6f73 655f 6669 6c65 2c22  (int_pose_file,"
+00014f90: 5c74 222c 6f75 7470 7574 5f68 6561 6465  \t",output_heade
+00014fa0: 725f 706f 7365 290a 2020 2020 2020 2020  r_pose).        
+00014fb0: 2020 2020 732e 7374 6f70 2829 0a20 2020      s.stop().   
+00014fc0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00014fd0: 5472 7565 2c20 2241 7474 6974 7564 6520  True, "Attitude 
+00014fe0: 6461 7461 2063 7265 6174 6564 2220 2b20  data created" + 
+00014ff0: 7061 7273 654d 7367 0a20 2020 2020 2020  parseMsg.       
+00015000: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00015010: 2020 2073 2e73 746f 7028 290a 2020 2020     s.stop().    
+00015020: 2020 2020 2020 2020 7265 7475 726e 2046          return F
+00015030: 616c 7365 2c20 224e 6f20 696d 6167 6520  alse, "No image 
+00015040: 6174 7469 7475 6465 7320 666f 756e 6422  attitudes found"
+00015050: 202b 2070 6172 7365 4d73 670a 2020 2020   + parseMsg.    
+00015060: 2020 2020 0a20 2020 2020 2020 200a 2020      .        .  
+00015070: 2020 6465 6620 6372 6561 7465 496d 6167    def createImag
+00015080: 6541 7474 6974 7564 6546 696c 6528 7365  eAttitudeFile(se
+00015090: 6c66 2c20 6174 745f 7061 7468 3a73 7472  lf, att_path:str
+000150a0: 2c20 6672 616d 655f 6174 745f 6865 6164  , frame_att_head
+000150b0: 6572 3a64 6963 742c 2063 616d 6572 6132  er:dict, camera2
+000150c0: 4672 616d 655f 7961 773a 666c 6f61 742c  Frame_yaw:float,
+000150d0: 6361 6d65 7261 3246 7261 6d65 5f70 6974  camera2Frame_pit
+000150e0: 6368 3a66 6c6f 6174 2c63 616d 6572 6132  ch:float,camera2
+000150f0: 4672 616d 655f 726f 6c6c 3a66 6c6f 6174  Frame_roll:float
+00015100: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00015110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015120: 2020 6461 7465 5f66 6f72 6d61 743d 6d69    date_format=mi
+00015130: 7174 762e 6461 7465 5f66 6f72 6d61 7473  qtv.date_formats
+00015140: 5b27 7061 6e67 6165 6127 5d2c 2063 6f6e  ['pangaea'], con
+00015150: 7374 5f76 616c 7565 7320 3d20 7b7d 2c20  st_values = {}, 
+00015160: 6f76 6572 7772 6974 653d 4661 6c73 652c  overwrite=False,
+00015170: 2063 6f6c 5f73 6570 6172 6174 6f72 203d   col_separator =
+00015180: 2022 5c74 222c 0a20 2020 2020 2020 2020   "\t",.         
+00015190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000151a0: 2020 2020 2020 2061 7474 5f70 6174 685f         att_path_
+000151b0: 616e 676c 6573 5f69 6e5f 7261 6420 3d20  angles_in_rad = 
+000151c0: 4661 6c73 652c 2076 6964 656f 5361 6d70  False, videoSamp
+000151d0: 6c65 5365 636f 6e64 733d 312c 7265 636f  leSeconds=1,reco
+000151e0: 7264 7332 6265 496e 7665 7274 6564 3d5b  rds2beInverted=[
+000151f0: 5d29 3a0a 2020 2020 2020 2020 2222 2220  ]):.        """ 
+00015200: 4465 7072 6563 6174 6465 202d 2075 7365  Deprecatde - use
+00015210: 2063 7265 6174 655f 696d 6167 655f 6174   create_image_at
+00015220: 7469 7475 6465 5f66 696c 6520 2222 220a  titude_file """.
+00015230: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00015240: 656c 662e 6372 6561 7465 5f69 6d61 6765  elf.create_image
+00015250: 5f61 7474 6974 7564 655f 6669 6c65 2861  _attitude_file(a
+00015260: 7474 5f70 6174 682c 2066 7261 6d65 5f61  tt_path, frame_a
+00015270: 7474 5f68 6561 6465 722c 2063 616d 6572  tt_header, camer
+00015280: 6132 4672 616d 655f 7961 772c 2063 616d  a2Frame_yaw, cam
+00015290: 6572 6132 4672 616d 655f 7069 7463 682c  era2Frame_pitch,
+000152a0: 2063 616d 6572 6132 4672 616d 655f 726f   camera2Frame_ro
+000152b0: 6c6c 2c20 0a20 2020 2020 2020 2020 2020  ll, .           
+000152c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000152d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000152e0: 2020 2020 6461 7465 5f66 6f72 6d61 742c      date_format,
+000152f0: 2063 6f6e 7374 5f76 616c 7565 732c 206f   const_values, o
+00015300: 7665 7277 7269 7465 2c20 636f 6c5f 7365  verwrite, col_se
+00015310: 7061 7261 746f 722c 2061 7474 5f70 6174  parator, att_pat
+00015320: 685f 616e 676c 6573 5f69 6e5f 7261 642c  h_angles_in_rad,
+00015330: 2076 6964 656f 5361 6d70 6c65 5365 636f   videoSampleSeco
+00015340: 6e64 732c 0a20 2020 2020 2020 2020 2020  nds,.           
+00015350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015370: 2020 2020 7265 636f 7264 7332 6265 496e      records2beIn
+00015380: 7665 7274 6564 290a 2020 2020 2020 2020  verted).        
+00015390: 0a0a 2020 2020 6465 6620 6765 745f 525f  ..    def get_R_
+000153a0: 6361 6d53 7464 3275 746d 2873 656c 662c  camStd2utm(self,
+000153b0: 525f 6361 6d32 6672 616d 653a 6e70 2e61  R_cam2frame:np.a
+000153c0: 7272 6179 2c52 5f66 7261 6d65 326e 6564  rray,R_frame2ned
+000153d0: 3a6e 702e 6172 7261 7929 3a0a 2020 2020  :np.array):.    
+000153e0: 2020 2020 2222 2220 7265 7472 756e 2072      """ retrun r
+000153f0: 6f74 6174 696f 6e20 6d61 7472 6978 2052  otation matrix R
+00015400: 2074 7261 6e66 6f72 6d69 6e67 2066 726f   tranforming fro
+00015410: 6d20 6361 6d53 7464 3a20 2878 2c79 2c7a  m camStd: (x,y,z
+00015420: 203d 2072 6967 6874 2c62 7574 746f 6d2c   = right,buttom,
+00015430: 6c69 6e65 206f 6620 7369 6768 7429 2074  line of sight) t
+00015440: 6f20 7574 6d20 2878 2c79 2c7a 203d 2065  o utm (x,y,z = e
+00015450: 6173 7469 6e67 2c6e 6f72 7468 696e 672c  asting,northing,
+00015460: 7570 2920 2222 220a 2020 2020 2020 2020  up) """.        
+00015470: 525f 6361 6d69 4644 4f32 6361 6d53 7464  R_camiFDO2camStd
+00015480: 203d 206d 6971 7467 2e52 5f59 6177 5069   = miqtg.R_YawPi
+00015490: 7463 6852 6f6c 6c28 3930 2c30 2c30 2920  tchRoll(90,0,0) 
+000154a0: 2320 696e 2069 4644 4f20 6361 6d3a 2028  # in iFDO cam: (
+000154b0: 782c 792c 7a20 3d20 746f 702c 7269 6768  x,y,z = top,righ
+000154c0: 742c 6c69 6e65 206f 6620 7369 6768 7429  t,line of sight)
+000154d0: 2062 7574 2066 6f72 2070 6f73 6520 7468   but for pose th
+000154e0: 6520 2773 7461 6e64 6172 6427 2063 616d  e 'standard' cam
+000154f0: 5374 643a 2028 782c 792c 7a20 3d20 7269  Std: (x,y,z = ri
+00015500: 6768 742c 6275 7474 6f6d 2c6c 696e 6520  ght,buttom,line 
+00015510: 6f66 2073 6967 6874 2920 6973 2065 7870  of sight) is exp
+00015520: 6563 7465 640a 2020 2020 2020 2020 525f  ected.        R_
+00015530: 6361 6d53 7464 3266 7261 6d65 203d 2052  camStd2frame = R
+00015540: 5f63 616d 3266 7261 6d65 2e64 6f74 2852  _cam2frame.dot(R
+00015550: 5f63 616d 6946 444f 3263 616d 5374 6429  _camiFDO2camStd)
+00015560: 0a20 2020 2020 2020 2052 5f63 616d 5374  .        R_camSt
+00015570: 6432 6e65 6420 3d20 525f 6672 616d 6532  d2ned = R_frame2
+00015580: 6e65 642e 646f 7428 525f 6361 6d53 7464  ned.dot(R_camStd
+00015590: 3266 7261 6d65 290a 2020 2020 2020 2020  2frame).        
+000155a0: 525f 6e65 6432 7574 6d20 3d20 6d69 7174  R_ned2utm = miqt
+000155b0: 672e 525f 5859 5a28 3138 302c 302c 3930  g.R_XYZ(180,0,90
+000155c0: 2920 2320 7769 7468 2075 746d 2078 2c79  ) # with utm x,y
+000155d0: 2c7a 203d 2065 6173 7469 6e67 2c6e 6f72  ,z = easting,nor
+000155e0: 7468 696e 672c 7570 0a20 2020 2020 2020  thing,up.       
+000155f0: 2052 5f63 616d 5374 6432 7574 6d20 3d20   R_camStd2utm = 
+00015600: 525f 6e65 6432 7574 6d2e 646f 7428 525f  R_ned2utm.dot(R_
+00015610: 6361 6d53 7464 326e 6564 292e 726f 756e  camStd2ned).roun
+00015620: 6428 3529 0a20 2020 2020 2020 2072 6574  d(5).        ret
+00015630: 7572 6e20 525f 6361 6d53 7464 3275 746d  urn R_camStd2utm
+00015640: 0a0a 0a20 2020 2064 6566 2066 696e 644e  ...    def findN
+00015650: 6176 4461 7461 466f 7249 6d61 6765 2873  avDataForImage(s
+00015660: 656c 662c 6461 7461 3a6d 6971 7467 2e4e  elf,data:miqtg.N
+00015670: 756d 4461 7461 5469 6d65 5374 616d 7065  umDataTimeStampe
+00015680: 642c 7669 6465 6f53 616d 706c 6553 6563  d,videoSampleSec
+00015690: 6f6e 6473 3d31 293a 0a20 2020 2020 2020  onds=1):.       
+000156a0: 2022 2222 2063 7265 6174 6573 2061 2064   """ creates a d
+000156b0: 6963 7420 2869 6d61 6765 5f64 7473 2920  ict (image_dts) 
+000156c0: 7769 7468 2066 696c 6520 6e61 6d65 2061  with file name a
+000156d0: 7320 6b65 7920 616e 6420 6120 6c69 7374  s key and a list
+000156e0: 206f 6620 6461 7461 2065 6c65 6d65 6e74   of data element
+000156f0: 7320 6173 2076 616c 7565 2e20 0a20 2020  s as value. .   
+00015700: 2020 2020 2020 2020 2049 6e20 6361 7365           In case
+00015710: 206f 6620 7068 6f74 6f73 2074 6865 206c   of photos the l
+00015720: 6973 7420 6861 7320 6f6e 6c79 2061 2073  ist has only a s
+00015730: 696e 676c 6520 656e 7472 792c 2066 6f72  ingle entry, for
+00015740: 2076 6964 656f 7320 6974 2068 6173 2076   videos it has v
+00015750: 6964 656f 2064 7572 6174 696f 6e20 5b73  ideo duration [s
+00015760: 6563 5d20 2f20 7669 6465 6f53 616d 706c  ec] / videoSampl
+00015770: 6553 6563 6f6e 6473 2065 6e74 7269 6573  eSeconds entries
+00015780: 2e0a 2020 2020 2020 2020 2020 2020 5265  ..            Re
+00015790: 7475 726e 7320 7375 6363 6573 732c 2069  turns success, i
+000157a0: 6d61 6765 5f64 7473 2c20 6d73 6720 2222  mage_dts, msg ""
+000157b0: 220a 0a20 2020 2020 2020 2069 6620 7669  "..        if vi
+000157c0: 6465 6f53 616d 706c 6553 6563 6f6e 6473  deoSampleSeconds
+000157d0: 203c 3d20 303a 0a20 2020 2020 2020 2020   <= 0:.         
+000157e0: 2020 2072 6169 7365 2045 7863 6570 7469     raise Excepti
+000157f0: 6f6e 2822 6669 6e64 4e61 7644 6174 6146  on("findNavDataF
+00015800: 6f72 496d 6167 653a 2076 6964 656f 5361  orImage: videoSa
+00015810: 6d70 6c65 5365 636f 6e64 7320 6d75 7374  mpleSeconds must
+00015820: 2062 6520 6772 6561 7465 7220 3022 290a   be greater 0").
+00015830: 0a20 2020 2020 2020 2023 2063 7265 6174  .        # creat
+00015840: 6520 736f 7274 6564 2074 696d 6520 706f  e sorted time po
+00015850: 696e 7473 0a20 2020 2020 2020 2074 696d  ints.        tim
+00015860: 655f 706f 696e 7473 203d 206c 6973 7428  e_points = list(
+00015870: 6461 7461 2e6b 6579 7328 2929 0a20 2020  data.keys()).   
+00015880: 2020 2020 2074 696d 655f 706f 696e 7473       time_points
+00015890: 2e73 6f72 7428 290a 2020 2020 2020 2020  .sort().        
+000158a0: 756e 6d61 7463 6865 6454 696d 6550 6f69  unmatchedTimePoi
+000158b0: 6e74 7320 3d20 5b5d 0a20 2020 2020 2020  nts = [].       
+000158c0: 2069 6d61 6765 5f64 7473 203d 207b 7d0a   image_dts = {}.
+000158d0: 2020 2020 2020 2020 7374 6172 7453 6561          startSea
+000158e0: 7263 6849 6e64 6578 203d 2030 0a20 2020  rchIndex = 0.   
+000158f0: 2020 2020 2069 6d61 6765 7349 6e52 6177       imagesInRaw
+00015900: 203d 2020 7365 6c66 2e69 6d61 6765 7349   =  self.imagesI
+00015910: 6e49 6d61 6765 7344 6972 2829 0a20 2020  nImagesDir().   
+00015920: 2020 2020 2069 6d61 6765 7349 6e52 6177       imagesInRaw
+00015930: 536f 7274 6564 4c69 7374 203d 2073 656c  SortedList = sel
+00015940: 662e 696d 6167 6573 496e 496d 6167 6573  f.imagesInImages
+00015950: 4469 7253 6f72 7465 644c 6973 7428 290a  DirSortedList().
+00015960: 2020 2020 2020 2020 7072 6f67 203d 206d          prog = m
+00015970: 6971 7463 2e50 7269 6e74 4b6e 6f77 6e50  iqtc.PrintKnownP
+00015980: 726f 6772 6573 734d 7367 2822 496e 7465  rogressMsg("Inte
+00015990: 7270 6f6c 6174 696e 6720 6e61 7669 6761  rpolating naviga
+000159a0: 7469 6f6e 2066 6f72 2069 6d61 6765 222c  tion for image",
+000159b0: 206c 656e 2869 6d61 6765 7349 6e52 6177   len(imagesInRaw
+000159c0: 292c 6d6f 6475 6c6f 3d31 290a 2020 2020  ),modulo=1).    
+000159d0: 2020 2020 666f 7220 6669 6c65 2069 6e20      for file in 
+000159e0: 696d 6167 6573 496e 5261 7753 6f72 7465  imagesInRawSorte
+000159f0: 644c 6973 743a 0a20 2020 2020 2020 2020  dList:.         
+00015a00: 2020 2070 726f 672e 7072 6f67 7265 7373     prog.progress
+00015a10: 2829 0a20 2020 2020 2020 2020 2020 2066  ().            f
+00015a20: 696c 655f 6e61 6d65 203d 206f 732e 7061  ile_name = os.pa
+00015a30: 7468 2e62 6173 656e 616d 6528 6669 6c65  th.basename(file
+00015a40: 290a 0a20 2020 2020 2020 2020 2020 2064  )..            d
+00015a50: 745f 696d 6167 6520 3d20 6d69 7174 632e  t_image = miqtc.
+00015a60: 7061 7273 6546 696c 6544 6174 6554 696d  parseFileDateTim
+00015a70: 6541 7355 5443 2866 696c 655f 6e61 6d65  eAsUTC(file_name
+00015a80: 290a 2020 2020 2020 2020 2020 2020 6474  ).            dt
+00015a90: 5f69 6d61 6765 5f74 7320 3d20 696e 7428  _image_ts = int(
+00015aa0: 6474 5f69 6d61 6765 2e74 696d 6573 7461  dt_image.timesta
+00015ab0: 6d70 2829 202a 2031 3030 3029 0a0a 2020  mp() * 1000)..  
+00015ac0: 2020 2020 2020 2020 2020 7275 6e54 696d            runTim
+00015ad0: 6520 3d20 696d 6167 6573 496e 5261 775b  e = imagesInRaw[
+00015ae0: 6669 6c65 5d5b 315d 2023 202d 3120 666f  file][1] # -1 fo
+00015af0: 7220 7068 6f74 6f73 0a20 2020 2020 2020  r photos.       
+00015b00: 2020 2020 2023 2076 6964 656f 0a20 2020       # video.   
+00015b10: 2020 2020 2020 2020 2069 6620 696d 6167           if imag
+00015b20: 6573 496e 5261 775b 6669 6c65 5d5b 325d  esInRaw[file][2]
+00015b30: 2069 6e20 6d69 7174 762e 7669 6465 6f5f   in miqtv.video_
+00015b40: 7479 7065 7320 616e 6420 7275 6e54 696d  types and runTim
+00015b50: 6520 3c3d 2030 3a20 2320 6578 740a 2020  e <= 0: # ext.  
+00015b60: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00015b70: 696e 7428 2243 6175 7469 6f6e 2120 436f  int("Caution! Co
+00015b80: 756c 6420 6e6f 7420 7265 6164 2076 6964  uld not read vid
+00015b90: 656f 2072 756e 2074 696d 6520 6672 6f6d  eo run time from
+00015ba0: 2066 696c 6522 2c66 696c 6529 2023 2054   file",file) # T
+00015bb0: 4f44 4f20 646f 6573 2074 6869 7320 6861  ODO does this ha
+00015bc0: 7070 656e 3f20 4861 6e64 6c65 2062 6574  ppen? Handle bet
+00015bd0: 7465 723f 0a0a 2020 2020 2020 2020 2020  ter?..          
+00015be0: 2020 7361 6d70 6c65 5469 6d65 5365 6373    sampleTimeSecs
+00015bf0: 203d 2030 0a20 2020 2020 2020 2020 2020   = 0.           
+00015c00: 2070 6f73 5f6c 6973 7420 3d20 5b5d 0a20   pos_list = []. 
+00015c10: 2020 2020 2020 2020 2020 2067 6f20 3d20             go = 
+00015c20: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
+00015c30: 2077 6869 6c65 2067 6f3a 0a20 2020 2020   while go:.     
+00015c40: 2020 2020 2020 2020 2020 2074 7279 3a20             try: 
+00015c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015c60: 2020 200a 2020 2020 2020 2020 2020 2020     .            
+00015c70: 2020 2020 2020 2020 706f 732c 2073 7461          pos, sta
+00015c80: 7274 5365 6172 6368 496e 6465 7820 3d20  rtSearchIndex = 
+00015c90: 6461 7461 2e69 6e74 6572 706f 6c61 7465  data.interpolate
+00015ca0: 4174 5469 6d65 2864 745f 696d 6167 655f  AtTime(dt_image_
+00015cb0: 7473 202b 2073 616d 706c 6554 696d 6553  ts + sampleTimeS
+00015cc0: 6563 7320 2a20 3130 3030 2c74 696d 655f  ecs * 1000,time_
+00015cd0: 706f 696e 7473 2c73 7461 7274 5365 6172  points,startSear
+00015ce0: 6368 496e 6465 7829 0a20 2020 2020 2020  chIndex).       
+00015cf0: 2020 2020 2020 2020 2020 2020 200a 2020               .  
+00015d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015d10: 2020 2320 696e 7465 7270 6f6c 6174 6541    # interpolateA
+00015d20: 7454 696d 6520 7265 7475 726e 7320 4e6f  tTime returns No
+00015d30: 6e65 2076 616c 7565 7320 6966 2074 696d  ne values if tim
+00015d40: 6520 6f75 7420 6f66 2072 616e 6765 0a20  e out of range. 
+00015d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015d60: 2020 2069 6620 706f 732e 636f 7461 696e     if pos.cotain
+00015d70: 734e 6f6e 6556 616c 7565 7349 6e52 6571  sNoneValuesInReq
+00015d80: 7569 7265 6446 6965 6c64 7328 293a 0a20  uiredFields():. 
+00015d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015da0: 2020 2020 2020 2075 6e6d 6174 6368 6564         unmatched
+00015db0: 5469 6d65 506f 696e 7473 2e61 7070 656e  TimePoints.appen
+00015dc0: 6428 2864 745f 696d 6167 655f 7473 202b  d((dt_image_ts +
+00015dd0: 2073 616d 706c 6554 696d 6553 6563 7320   sampleTimeSecs 
+00015de0: 2a20 3130 3030 292f 3130 3030 290a 2020  * 1000)/1000).  
+00015df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015e00: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00015e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015e20: 706f 735f 6c69 7374 2e61 7070 656e 6428  pos_list.append(
+00015e30: 706f 7329 0a20 2020 2020 2020 2020 2020  pos).           
+00015e40: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
+00015e50: 7074 696f 6e20 6173 2065 3a0a 2020 2020  ption as e:.    
+00015e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015e70: 7265 7475 726e 2046 616c 7365 2c20 696d  return False, im
+00015e80: 6167 655f 6474 732c 2022 436f 756c 6420  age_dts, "Could 
+00015e90: 6e6f 7420 6669 6e64 2069 6d61 6765 2074  not find image t
+00015ea0: 696d 6520 222b 2064 6174 6574 696d 652e  ime "+ datetime.
+00015eb0: 6461 7465 7469 6d65 2e75 7463 6672 6f6d  datetime.utcfrom
+00015ec0: 7469 6d65 7374 616d 7028 2864 745f 696d  timestamp((dt_im
+00015ed0: 6167 655f 7473 202b 2073 616d 706c 6554  age_ts + sampleT
+00015ee0: 696d 6553 6563 7320 2a20 3130 3030 292f  imeSecs * 1000)/
+00015ef0: 3130 3030 292e 7374 7266 7469 6d65 286d  1000).strftime(m
+00015f00: 6971 7476 2e64 6174 655f 666f 726d 6174  iqtv.date_format
+00015f10: 735b 276d 6172 6971 7427 5d29 202b 2220  s['mariqt']) +" 
+00015f20: 696e 2022 2b73 7472 2864 6174 612e 6c65  in "+str(data.le
+00015f30: 6e28 2929 2b22 2064 6174 6120 706f 7369  n())+" data posi
+00015f40: 7469 6f6e 7322 202b 2073 7472 2865 2e61  tions" + str(e.a
+00015f50: 7267 7329 0a20 2020 2020 2020 2020 2020  rgs).           
+00015f60: 2020 2020 2073 616d 706c 6554 696d 6553       sampleTimeS
+00015f70: 6563 7320 2b3d 2076 6964 656f 5361 6d70  ecs += videoSamp
+00015f80: 6c65 5365 636f 6e64 730a 2020 2020 2020  leSeconds.      
+00015f90: 2020 2020 2020 2020 2020 6966 2073 616d            if sam
+00015fa0: 706c 6554 696d 6553 6563 7320 3e20 7275  pleTimeSecs > ru
+00015fb0: 6e54 696d 653a 0a20 2020 2020 2020 2020  nTime:.         
+00015fc0: 2020 2020 2020 2020 2020 2067 6f20 3d20             go = 
+00015fd0: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
+00015fe0: 2020 0a20 2020 2020 2020 2020 2020 2069    .            i
+00015ff0: 6d61 6765 5f64 7473 5b66 696c 655f 6e61  mage_dts[file_na
+00016000: 6d65 5d20 3d20 706f 735f 6c69 7374 0a20  me] = pos_list. 
+00016010: 2020 2020 2020 2070 726f 672e 636c 6561         prog.clea
+00016020: 7228 290a 2020 2020 2020 2020 7265 7475  r().        retu
+00016030: 726e 4d73 6720 3d20 2222 0a20 2020 2020  rnMsg = "".     
+00016040: 2020 2069 6620 6c65 6e28 756e 6d61 7463     if len(unmatc
+00016050: 6865 6454 696d 6550 6f69 6e74 7329 2021  hedTimePoints) !
+00016060: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
+00016070: 2075 6e6d 6174 6368 6564 5469 6d65 506f   unmatchedTimePo
+00016080: 696e 7473 2e73 6f72 7428 290a 2020 2020  ints.sort().    
+00016090: 2020 2020 2020 2020 756e 6d61 7463 6865          unmatche
+000160a0: 6454 696d 6550 6f69 6e74 7320 3d20 5b64  dTimePoints = [d
+000160b0: 6174 6574 696d 652e 6461 7465 7469 6d65  atetime.datetime
+000160c0: 2e75 7463 6672 6f6d 7469 6d65 7374 616d  .utcfromtimestam
+000160d0: 7028 7473 292e 7374 7266 7469 6d65 286d  p(ts).strftime(m
+000160e0: 6971 7476 2e64 6174 655f 666f 726d 6174  iqtv.date_format
+000160f0: 735b 276d 6172 6971 7427 5d29 2066 6f72  s['mariqt']) for
+00016100: 2074 7320 696e 2075 6e6d 6174 6368 6564   ts in unmatched
+00016110: 5469 6d65 506f 696e 7473 5d0a 2020 2020  TimePoints].    
+00016120: 2020 2020 2020 2020 7265 7475 726e 4d73          returnMs
+00016130: 6720 3d20 2243 6175 7469 6f6e 2120 4e61  g = "Caution! Na
+00016140: 7669 6761 7469 6f6e 206e 6f74 2066 6f75  vigation not fou
+00016150: 6e64 2066 6f72 2074 6865 2066 6f6c 6c6f  nd for the follo
+00016160: 7769 6e67 2069 6d61 6765 2074 696d 6520  wing image time 
+00016170: 706f 696e 7473 2e20 446f 7562 6c65 2063  points. Double c
+00016180: 6865 636b 206f 7220 7072 6f76 6964 6520  heck or provide 
+00016190: 6174 206c 6561 7374 2073 7461 7469 6320  at least static 
+000161a0: 6465 6661 756c 7420 6e61 7669 6761 7469  default navigati
+000161b0: 6f6e 2069 6e20 6865 6164 6572 2066 6965  on in header fie
+000161c0: 6c64 732e 220a 2020 2020 2020 2020 2020  lds.".          
+000161d0: 2020 7265 7475 726e 4d73 6720 2b3d 2022    returnMsg += "
+000161e0: 5c6e 2220 2b20 225c 6e22 2e6a 6f69 6e28  \n" + "\n".join(
+000161f0: 756e 6d61 7463 6865 6454 696d 6550 6f69  unmatchedTimePoi
+00016200: 6e74 7329 0a20 2020 2020 2020 2072 6574  nts).        ret
+00016210: 7572 6e20 5472 7565 2c20 696d 6167 655f  urn True, image_
+00016220: 6474 732c 2072 6574 7572 6e4d 7367 0a0a  dts, returnMsg..
+00016230: 0a20 2020 2064 6566 2063 7265 6174 655f  .    def create_
+00016240: 696d 6167 655f 6e61 7669 6761 7469 6f6e  image_navigation
+00016250: 5f66 696c 6528 7365 6c66 2c20 6e61 765f  _file(self, nav_
+00016260: 7061 7468 3a20 7374 722c 206e 6176 5f68  path: str, nav_h
+00016270: 6561 6465 723d 6d69 7174 762e 706f 735f  eader=miqtv.pos_
+00016280: 6865 6164 6572 5b27 7061 6e67 6165 6127  header['pangaea'
+00016290: 5d2c 2064 6174 655f 666f 726d 6174 3d6d  ], date_format=m
+000162a0: 6971 7476 2e64 6174 655f 666f 726d 6174  iqtv.date_format
+000162b0: 735b 2770 616e 6761 6561 275d 2c20 6f76  s['pangaea'], ov
+000162c0: 6572 7772 6974 653d 4661 6c73 652c 2063  erwrite=False, c
+000162d0: 6f6c 5f73 6570 6172 6174 6f72 203d 2022  ol_separator = "
+000162e0: 5c74 222c 2076 6964 656f 5361 6d70 6c65  \t", videoSample
+000162f0: 5365 636f 6e64 733d 312c 0a20 2020 2020  Seconds=1,.     
+00016300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016310: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+00016320: 6666 7365 745f 783d 302c 206f 6666 7365  ffset_x=0, offse
+00016330: 745f 793d 302c 206f 6666 7365 745f 7a3d  t_y=0, offset_z=
+00016340: 302c 616e 676c 6573 5f69 6e5f 7261 6420  0,angles_in_rad 
+00016350: 3d20 4661 6c73 652c 2072 6563 6f72 6473  = False, records
+00016360: 3262 6549 6e76 6572 7465 643d 5b5d 293a  2beInverted=[]):
+00016370: 0a20 2020 2020 2020 2022 2222 2043 7265  .        """ Cre
+00016380: 6174 6573 2069 6e20 2f69 6e74 6572 6d65  ates in /interme
+00016390: 6469 6174 6520 6120 7465 7874 2066 696c  diate a text fil
+000163a0: 6520 7769 7468 2034 2e35 4420 6e61 7669  e with 4.5D navi
+000163b0: 6761 7469 6f6e 2064 6174 6120 666f 7220  gation data for 
+000163c0: 6561 6368 2069 6d61 6765 2c20 692e 652e  each image, i.e.
+000163d0: 2061 2073 696e 676c 6520 726f 7720 7065   a single row pe
+000163e0: 7220 7068 6f74 6f2c 2076 6964 656f 2064  r photo, video d
+000163f0: 7572 6174 696f 6e20 5b73 6563 5d20 2f20  uration [sec] / 
+00016400: 7669 6465 6f53 616d 706c 6553 6563 6f6e  videoSampleSecon
+00016410: 6473 2072 6f77 7320 7065 7220 7669 6465  ds rows per vide
+00016420: 6f2e 0a20 2020 2020 2020 2020 2020 206e  o..            n
+00016430: 6176 5f68 6561 6465 7220 6d75 7374 2062  av_header must b
+00016440: 6520 6469 6374 2063 6f6e 7461 696e 696e  e dict containin
+00016450: 6720 7468 6520 6b65 7973 2027 7574 6327  g the keys 'utc'
+00016460: 2c27 6c61 7427 2c27 6c6f 6e27 2c27 6465  ,'lat','lon','de
+00016470: 7027 286f 7220 2761 6c74 2729 2c20 6f70  p'(or 'alt'), op
+00016480: 7469 6f6e 616c 3a20 2768 6774 272c 2775  tional: 'hgt','u
+00016490: 6e63 6572 7427 2077 6974 6820 7468 6520  ncert' with the 
+000164a0: 7265 7370 6563 7469 7665 2063 6f6c 756d  respective colum
+000164b0: 6e20 6865 6164 6572 7320 6173 2076 616c  n headers as val
+000164c0: 7565 7320 0a20 2020 2020 2020 2020 2020  ues .           
+000164d0: 2069 6620 6f6e 6520 6f66 2074 6865 2076   if one of the v
+000164e0: 6568 6963 6c65 2078 2c79 2c7a 206f 6666  ehicle x,y,z off
+000164f0: 7365 7473 205b 6d5d 2069 7320 6e6f 7420  sets [m] is not 
+00016500: 3020 616e 6420 6e61 765f 6865 6164 6572  0 and nav_header
+00016510: 2061 6c73 6f20 636f 6e74 6169 6e73 2027   also contains '
+00016520: 7961 7727 2c27 7069 7463 6827 2c27 726f  yaw','pitch','ro
+00016530: 6c6c 2720 6c65 7665 7261 726d 206f 6666  ll' leverarm off
+00016540: 7365 7473 2061 7265 2063 6f6d 7065 6e73  sets are compens
+00016550: 6174 6564 2066 6f72 2022 2222 0a0a 2020  ated for """..  
+00016560: 2020 2020 2020 6966 2073 656c 662e 696e        if self.in
+00016570: 7465 726d 6564 6961 7465 4e61 7646 696c  termediateNavFil
+00016580: 6545 7869 7374 7328 2920 616e 6420 6e6f  eExists() and no
+00016590: 7420 6f76 6572 7772 6974 653a 0a20 2020  t overwrite:.   
+000165a0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+000165b0: 5472 7565 2c20 224f 7574 7075 7420 6669  True, "Output fi
+000165c0: 6c65 2065 7869 7374 733a 2022 2b73 656c  le exists: "+sel
+000165d0: 662e 6765 745f 696e 745f 6e61 765f 6669  f.get_int_nav_fi
+000165e0: 6c65 2829 0a0a 2020 2020 2020 2020 6966  le()..        if
+000165f0: 206e 6f74 206f 732e 7061 7468 2e65 7869   not os.path.exi
+00016600: 7374 7328 6e61 765f 7061 7468 293a 0a20  sts(nav_path):. 
+00016610: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00016620: 6e20 4661 6c73 652c 2022 4e61 7669 6761  n False, "Naviga
+00016630: 7469 6f6e 2066 696c 6520 6e6f 7420 666f  tion file not fo
+00016640: 756e 643a 2022 2b6e 6176 5f70 6174 680a  und: "+nav_path.
+00016650: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+00016660: 6f73 2e70 6174 682e 6578 6973 7473 2873  os.path.exists(s
+00016670: 656c 662e 696d 6167 6573 4469 7229 3a0a  elf.imagesDir):.
+00016680: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00016690: 726e 2046 616c 7365 2c20 2249 6d61 6765  rn False, "Image
+000166a0: 2066 6f6c 6465 7220 6e6f 7420 666f 756e   folder not foun
+000166b0: 643a 2022 2b20 7365 6c66 2e69 6d61 6765  d: "+ self.image
+000166c0: 7344 6972 0a0a 2020 2020 2020 2020 7320  sDir..        s 
+000166d0: 3d20 6d69 7174 632e 5072 696e 744c 6f61  = miqtc.PrintLoa
+000166e0: 6469 6e67 4d73 6728 2243 7265 6174 696e  dingMsg("Creatin
+000166f0: 6720 6974 656d 7327 206e 6176 6967 6174  g items' navigat
+00016700: 696f 6e20 6461 7461 2229 0a20 2020 2020  ion data").     
+00016710: 2020 2072 6574 7572 6e4d 7367 203d 2022     returnMsg = "
+00016720: 220a 2020 2020 2020 2020 636f 6d70 656e  ".        compen
+00016730: 7361 744f 6666 7365 7473 203d 2046 616c  satOffsets = Fal
+00016740: 7365 0a20 2020 2020 2020 2069 6620 286f  se.        if (o
+00016750: 6666 7365 745f 7821 3d30 206f 7220 6f66  ffset_x!=0 or of
+00016760: 6673 6574 5f79 213d 3020 6f72 206f 6666  fset_y!=0 or off
+00016770: 7365 745f 7a21 3d30 2920 616e 6420 2779  set_z!=0) and 'y
+00016780: 6177 2720 696e 206e 6176 5f68 6561 6465  aw' in nav_heade
+00016790: 7220 616e 6420 2770 6974 6368 2720 696e  r and 'pitch' in
+000167a0: 206e 6176 5f68 6561 6465 7220 616e 6420   nav_header and 
+000167b0: 2772 6f6c 6c27 2069 6e20 6e61 765f 6865  'roll' in nav_he
+000167c0: 6164 6572 3a0a 2020 2020 2020 2020 2020  ader:.          
+000167d0: 2020 636f 6d70 656e 7361 744f 6666 7365    compensatOffse
+000167e0: 7473 203d 2054 7275 650a 0a20 2020 2020  ts = True..     
+000167f0: 2020 2023 2063 6865 636b 2069 6620 666f     # check if fo
+00016800: 7220 6d69 7373 696e 6720 6669 656c 6473  r missing fields
+00016810: 2074 6865 7265 2061 7265 2063 6f6e 7374   there are const
+00016820: 2076 616c 7565 7320 696e 2068 6561 6465   values in heade
+00016830: 720a 2020 2020 2020 2020 636f 6e73 745f  r.        const_
+00016840: 7661 6c75 6573 203d 207b 7d0a 2020 2020  values = {}.    
+00016850: 2020 2020 666f 7220 6e61 7646 6965 6c64      for navField
+00016860: 2069 6e20 6d69 7174 762e 706f 735f 6865   in miqtv.pos_he
+00016870: 6164 6572 5b27 6d61 7269 7174 275d 3a0a  ader['mariqt']:.
+00016880: 2020 2020 2020 2020 2020 2020 7265 7370              resp
+00016890: 6563 7469 7665 4865 6164 6572 4669 656c  ectiveHeaderFiel
+000168a0: 6420 3d20 6d69 7174 762e 636f 6c5f 6865  d = miqtv.col_he
+000168b0: 6164 6572 5b22 6d61 7269 7174 225d 5b6e  ader["mariqt"][n
+000168c0: 6176 4669 656c 645d 0a20 2020 2020 2020  avField].       
+000168d0: 2020 2020 2069 6620 6e61 7646 6965 6c64       if navField
+000168e0: 206e 6f74 2069 6e20 6e61 765f 6865 6164   not in nav_head
+000168f0: 6572 2061 6e64 2028 7265 7370 6563 7469  er and (respecti
+00016900: 7665 4865 6164 6572 4669 656c 6420 696e  veHeaderField in
+00016910: 2073 656c 662e 6966 646f 5f74 6d70 5b73   self.ifdo_tmp[s
+00016920: 656c 662e 696d 6167 6553 6574 4865 6164  elf.imageSetHead
+00016930: 6572 4b65 795d 2061 6e64 2073 656c 662e  erKey] and self.
+00016940: 6669 6e64 546d 7046 6965 6c64 3228 7265  findTmpField2(re
+00016950: 7370 6563 7469 7665 4865 6164 6572 4669  spectiveHeaderFi
+00016960: 656c 6429 2021 3d20 2222 293a 200a 2020  eld) != ""): .  
+00016970: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00016980: 6e73 745f 7661 6c75 6573 5b6e 6176 4669  nst_values[navFi
+00016990: 656c 645d 203d 2073 656c 662e 6669 6e64  eld] = self.find
+000169a0: 546d 7046 6965 6c64 2872 6573 7065 6374  TmpField(respect
+000169b0: 6976 6548 6561 6465 7246 6965 6c64 290a  iveHeaderField).
+000169c0: 0a20 2020 2020 2020 2020 2320 6861 6e64  .         # hand
+000169d0: 6c65 2061 6c74 2076 7320 6465 700a 2020  le alt vs dep.  
+000169e0: 2020 2020 2020 6966 2027 616c 7427 2069        if 'alt' i
+000169f0: 6e20 6e61 765f 6865 6164 6572 2061 6e64  n nav_header and
+00016a00: 2027 6465 7027 2069 6e20 6e61 765f 6865   'dep' in nav_he
+00016a10: 6164 6572 3a0a 2020 2020 2020 2020 2020  ader:.          
+00016a20: 2020 7261 6973 6520 6d69 7174 632e 4966    raise miqtc.If
+00016a30: 646f 4578 6365 7074 696f 6e28 2227 616c  doException("'al
+00016a40: 7427 2061 6e64 2027 6465 7027 2070 726f  t' and 'dep' pro
+00016a50: 7669 6465 642e 2052 6564 756e 6461 6e74  vided. Redundant
+00016a60: 2c20 616c 7420 3d20 2d20 6465 702e 2050  , alt = - dep. P
+00016a70: 726f 7669 6465 6420 6f6e 6c79 206f 6e65  rovided only one
+00016a80: 206f 6620 626f 7468 2e22 290a 2020 2020   of both.").    
+00016a90: 2020 2020 0a20 2020 2020 2020 2023 204c      .        # L
+00016aa0: 6f61 6420 6e61 7669 6761 7469 6f6e 2064  oad navigation d
+00016ab0: 6174 6120 2869 6620 2761 6c74 2720 696e  ata (if 'alt' in
+00016ac0: 7374 6561 6420 6f66 2027 6465 7027 2c20  stead of 'dep', 
+00016ad0: 6974 7320 6175 746f 6d61 7469 6361 6c6c  its automaticall
+00016ae0: 7920 696e 7665 7274 6564 290a 2020 2020  y inverted).    
+00016af0: 2020 2020 6e61 765f 6461 7461 2c20 7061      nav_data, pa
+00016b00: 7273 654d 7367 203d 206d 6971 746e 2e72  rseMsg = miqtn.r
+00016b10: 6561 6441 6c6c 506f 7369 7469 6f6e 7346  eadAllPositionsF
+00016b20: 726f 6d46 696c 6550 6174 6828 6e61 765f  romFilePath(nav_
+00016b30: 7061 7468 2c20 6e61 765f 6865 6164 6572  path, nav_header
+00016b40: 2c20 6461 7465 5f66 6f72 6d61 742c 636f  , date_format,co
+00016b50: 6c5f 7365 7061 7261 746f 723d 636f 6c5f  l_separator=col_
+00016b60: 7365 7061 7261 746f 722c 636f 6e73 745f  separator,const_
+00016b70: 7661 6c75 6573 3d63 6f6e 7374 5f76 616c  values=const_val
+00016b80: 7565 7329 0a20 2020 2020 2020 2069 6620  ues).        if 
+00016b90: 7061 7273 654d 7367 2021 3d20 2222 3a0a  parseMsg != "":.
+00016ba0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00016bb0: 2e70 726f 762e 6c6f 6728 7061 7273 654d  .prov.log(parseM
+00016bc0: 7367 2c64 6f6e 7453 686f 773d 5472 7565  sg,dontShow=True
+00016bd0: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+00016be0: 7475 726e 4d73 6720 3d20 225c 6e22 202b  turnMsg = "\n" +
+00016bf0: 2070 6172 7365 4d73 670a 0a20 2020 2020   parseMsg..     
+00016c00: 2020 2023 2066 696e 6420 666f 7220 6561     # find for ea
+00016c10: 6368 2069 6d61 6765 2074 6865 2072 6573  ch image the res
+00016c20: 7065 6374 6976 6520 6e61 7669 6761 7469  pective navigati
+00016c30: 6f6e 2064 6174 610a 2020 2020 2020 2020  on data.        
+00016c40: 732e 7374 6f70 2829 0a20 2020 2020 2020  s.stop().       
+00016c50: 2073 7563 6365 7373 2c20 696d 6167 655f   success, image_
+00016c60: 6474 732c 206d 7367 203d 2073 656c 662e  dts, msg = self.
+00016c70: 6669 6e64 4e61 7644 6174 6146 6f72 496d  findNavDataForIm
+00016c80: 6167 6528 6e61 765f 6461 7461 2c76 6964  age(nav_data,vid
+00016c90: 656f 5361 6d70 6c65 5365 636f 6e64 7329  eoSampleSeconds)
+00016ca0: 0a20 2020 2020 2020 2073 656c 662e 7072  .        self.pr
+00016cb0: 6f76 2e6c 6f67 286d 7367 2c64 6f6e 7453  ov.log(msg,dontS
+00016cc0: 686f 773d 5472 7565 290a 2020 2020 2020  how=True).      
+00016cd0: 2020 6966 206d 7367 2021 3d20 2222 3a0a    if msg != "":.
+00016ce0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00016cf0: 726e 4d73 6720 2b3d 2022 5c6e 2220 2b20  rnMsg += "\n" + 
+00016d00: 6d73 670a 2020 2020 2020 2020 6966 206e  msg.        if n
+00016d10: 6f74 2073 7563 6365 7373 3a0a 2020 2020  ot success:.    
+00016d20: 2020 2020 2020 2020 7265 7475 726e 2046          return F
+00016d30: 616c 7365 2c20 7265 7475 726e 4d73 670a  alse, returnMsg.
+00016d40: 2020 2020 2020 2020 7320 3d20 6d69 7174          s = miqt
+00016d50: 632e 5072 696e 744c 6f61 6469 6e67 4d73  c.PrintLoadingMs
+00016d60: 6728 2243 7265 6174 696e 6720 6974 656d  g("Creating item
+00016d70: 7327 206e 6176 6967 6174 696f 6e20 6461  s' navigation da
+00016d80: 7461 2229 0a0a 2020 2020 2020 2020 2320  ta")..        # 
+00016d90: 696e 7665 7274 2076 616c 7565 7320 2869  invert values (i
+00016da0: 6620 6e65 6564 6564 2920 6265 666f 7265  f needed) before
+00016db0: 206c 6576 6572 6172 6d20 636f 6d70 656e   leverarm compen
+00016dc0: 7361 7469 6f6e 0a20 2020 2020 2020 2069  sation.        i
+00016dd0: 6620 7265 636f 7264 7332 6265 496e 7665  f records2beInve
+00016de0: 7274 6564 2021 3d20 5b5d 3a0a 2020 2020  rted != []:.    
+00016df0: 2020 2020 2020 2020 666f 7220 6669 6c65          for file
+00016e00: 2069 6e20 696d 6167 655f 6474 733a 0a20   in image_dts:. 
+00016e10: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00016e20: 6f73 6974 696f 6e73 203d 2069 6d61 6765  ositions = image
+00016e30: 5f64 7473 5b66 696c 655d 0a20 2020 2020  _dts[file].     
+00016e40: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
+00016e50: 2069 6e20 7261 6e67 6528 6c65 6e28 706f   in range(len(po
+00016e60: 7369 7469 6f6e 7329 293a 0a20 2020 2020  sitions)):.     
+00016e70: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00016e80: 6620 276c 6174 2720 696e 2072 6563 6f72  f 'lat' in recor
+00016e90: 6473 3262 6549 6e76 6572 7465 643a 0a20  ds2beInverted:. 
+00016ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016eb0: 2020 2020 2020 2070 6f73 6974 696f 6e73         positions
+00016ec0: 5b69 5d2e 6c61 7420 2a3d 202d 310a 2020  [i].lat *= -1.  
+00016ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016ee0: 2020 6966 2027 6c6f 6e27 2069 6e20 7265    if 'lon' in re
+00016ef0: 636f 7264 7332 6265 496e 7665 7274 6564  cords2beInverted
+00016f00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00016f10: 2020 2020 2020 2020 2020 706f 7369 7469            positi
+00016f20: 6f6e 735b 695d 2e6c 6f6e 202a 3d20 2d31  ons[i].lon *= -1
+00016f30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016f40: 2020 2020 2069 6620 2827 6465 7027 2069       if ('dep' i
+00016f50: 6e20 7265 636f 7264 7332 6265 496e 7665  n records2beInve
+00016f60: 7274 6564 2061 6e64 2027 6465 7027 2069  rted and 'dep' i
+00016f70: 6e20 6e61 765f 6865 6164 6572 2920 6f72  n nav_header) or
+00016f80: 2028 2761 6c74 2720 696e 2072 6563 6f72   ('alt' in recor
+00016f90: 6473 3262 6549 6e76 6572 7465 6420 616e  ds2beInverted an
+00016fa0: 6420 2761 6c74 2720 696e 206e 6176 5f68  d 'alt' in nav_h
+00016fb0: 6561 6465 7229 3a0a 2020 2020 2020 2020  eader):.        
+00016fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016fd0: 706f 7369 7469 6f6e 735b 695d 2e64 6570  positions[i].dep
+00016fe0: 202a 3d20 2d31 0a20 2020 2020 2020 2020   *= -1.         
+00016ff0: 2020 2020 2020 2020 2020 2069 6620 2768             if 'h
+00017000: 6774 2720 696e 2072 6563 6f72 6473 3262  gt' in records2b
+00017010: 6549 6e76 6572 7465 643a 0a20 2020 2020  eInverted:.     
+00017020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017030: 2020 2070 6f73 6974 696f 6e73 5b69 5d2e     positions[i].
+00017040: 6867 7420 2a3d 202d 310a 0a0a 2020 2020  hgt *= -1...    
+00017050: 2020 2020 2320 636f 6d70 656e 7361 7465      # compensate
+00017060: 206c 6576 6572 6172 6d20 6f66 6673 6574   leverarm offset
+00017070: 730a 2020 2020 2020 2020 6966 2063 6f6d  s.        if com
+00017080: 7065 6e73 6174 4f66 6673 6574 733a 0a0a  pensatOffsets:..
+00017090: 2020 2020 2020 2020 2020 2020 2320 6c6f              # lo
+000170a0: 6164 2066 7261 6d65 2061 7474 6974 7564  ad frame attitud
+000170b0: 6520 6461 7461 2066 726f 6d20 6669 6c65  e data from file
+000170c0: 0a20 2020 2020 2020 2020 2020 2061 7474  .            att
+000170d0: 5f64 6174 612c 2070 6172 7365 4d73 6720  _data, parseMsg 
+000170e0: 3d20 6d69 7174 6e2e 7265 6164 416c 6c41  = miqtn.readAllA
+000170f0: 7474 6974 7564 6573 4672 6f6d 4669 6c65  ttitudesFromFile
+00017100: 5061 7468 286e 6176 5f70 6174 682c 206e  Path(nav_path, n
+00017110: 6176 5f68 6561 6465 722c 2064 6174 655f  av_header, date_
+00017120: 666f 726d 6174 2c63 6f6c 5f73 6570 6172  format,col_separ
+00017130: 6174 6f72 3d63 6f6c 5f73 6570 6172 6174  ator=col_separat
+00017140: 6f72 2c63 6f6e 7374 5f76 616c 7565 733d  or,const_values=
+00017150: 636f 6e73 745f 7661 6c75 6573 2c61 6e67  const_values,ang
+00017160: 6c65 7349 6e52 6164 3d61 6e67 6c65 735f  lesInRad=angles_
+00017170: 696e 5f72 6164 290a 2020 2020 2020 2020  in_rad).        
+00017180: 2020 2020 6966 2070 6172 7365 4d73 6720      if parseMsg 
+00017190: 213d 2022 223a 0a20 2020 2020 2020 2020  != "":.         
+000171a0: 2020 2020 2020 2073 656c 662e 7072 6f76         self.prov
+000171b0: 2e6c 6f67 2870 6172 7365 4d73 672c 646f  .log(parseMsg,do
+000171c0: 6e74 5368 6f77 3d54 7275 6529 0a20 2020  ntShow=True).   
+000171d0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+000171e0: 7572 6e4d 7367 202b 3d20 225c 6e22 202b  urnMsg += "\n" +
+000171f0: 2070 6172 7365 4d73 670a 0a20 2020 2020   parseMsg..     
+00017200: 2020 2020 2020 2069 6620 7265 636f 7264         if record
+00017210: 7332 6265 496e 7665 7274 6564 2021 3d20  s2beInverted != 
+00017220: 5b5d 3a0a 2020 2020 2020 2020 2020 2020  []:.            
+00017230: 2020 2020 666f 7220 6669 6c65 2069 6e20      for file in 
+00017240: 696d 6167 655f 6474 733a 0a20 2020 2020  image_dts:.     
+00017250: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00017260: 7474 6974 7564 6573 203d 2069 6d61 6765  ttitudes = image
+00017270: 5f64 7473 5f61 7474 5b66 696c 655d 0a20  _dts_att[file]. 
+00017280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017290: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
+000172a0: 6528 6c65 6e28 706f 7369 7469 6f6e 7329  e(len(positions)
+000172b0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+000172c0: 2020 2020 2020 2020 2020 2069 6620 2779             if 'y
+000172d0: 6177 2720 696e 2020 7265 636f 7264 7332  aw' in  records2
+000172e0: 6265 496e 7665 7274 6564 3a0a 2020 2020  beInverted:.    
+000172f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017300: 2020 2020 2020 2020 6174 7469 7475 6465          attitude
+00017310: 735b 695d 2e79 6177 202a 3d20 2d31 0a20  s[i].yaw *= -1. 
 00017320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017330: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
-00017340: 2822 5c74 222b 7374 7228 7661 6c29 290a  ("\t"+str(val)).
-00017350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017360: 2020 2020 6966 2027 6c6f 6e27 2069 6e20      if 'lon' in 
-00017370: 6e61 765f 6865 6164 6572 3a0a 2020 2020  nav_header:.    
-00017380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017390: 2020 2020 7661 6c20 3d20 7469 6d65 706f      val = timepo
-000173a0: 696e 742e 6c6f 6e0a 2020 2020 2020 2020  int.lon.        
-000173b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000173c0: 6966 2027 6c6f 6e27 2069 6e20 7265 636f  if 'lon' in reco
-000173d0: 7264 7332 6265 496e 7665 7274 6564 3a0a  rds2beInverted:.
-000173e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000173f0: 2020 2020 2020 2020 2020 2020 7661 6c20              val 
-00017400: 2a3d 202d 310a 2020 2020 2020 2020 2020  *= -1.          
-00017410: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00017420: 732e 7772 6974 6528 225c 7422 2b73 7472  s.write("\t"+str
-00017430: 2876 616c 2929 0a20 2020 2020 2020 2020  (val)).         
-00017440: 2020 2020 2020 2020 2020 2069 6620 6861             if ha
-00017450: 735f 616c 743a 0a20 2020 2020 2020 2020  s_alt:.         
-00017460: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-00017470: 616c 203d 2074 696d 6570 6f69 6e74 2e64  al = timepoint.d
-00017480: 6570 0a20 2020 2020 2020 2020 2020 2020  ep.             
-00017490: 2020 2020 2020 2020 2020 2069 6620 2764             if 'd
-000174a0: 6570 2720 696e 206e 6176 5f68 6561 6465  ep' in nav_heade
-000174b0: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
-000174c0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-000174d0: 616c 202a 3d20 2d31 0a20 2020 2020 2020  al *= -1.       
-000174e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000174f0: 2020 2020 2069 6620 2764 6570 2720 696e       if 'dep' in
-00017500: 2072 6563 6f72 6473 3262 6549 6e76 6572   records2beInver
-00017510: 7465 643a 0a20 2020 2020 2020 2020 2020  ted:.           
-00017520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017530: 2020 2020 2076 616c 202a 3d20 2d31 0a20       val *= -1. 
-00017540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017550: 2020 2020 2020 2065 6c69 6620 2027 616c         elif  'al
-00017560: 7427 2069 6e20 6e61 765f 6865 6164 6572  t' in nav_header
-00017570: 2061 6e64 2027 616c 7427 2069 6e20 7265   and 'alt' in re
-00017580: 636f 7264 7332 6265 496e 7665 7274 6564  cords2beInverted
-00017590: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000175a0: 2020 2020 2020 2020 2020 2020 2020 7661                va
-000175b0: 6c20 2a3d 202d 310a 2020 2020 2020 2020  l *= -1.        
-000175c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000175d0: 7265 732e 7772 6974 6528 225c 7422 2b73  res.write("\t"+s
-000175e0: 7472 2876 616c 2929 0a20 2020 2020 2020  tr(val)).       
-000175f0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00017600: 6867 745f 6e6f 745f 7a65 726f 2061 6e64  hgt_not_zero and
-00017610: 2027 6867 7427 2069 6e20 6e61 765f 6865   'hgt' in nav_he
-00017620: 6164 6572 3a0a 2020 2020 2020 2020 2020  ader:.          
-00017630: 2020 2020 2020 2020 2020 2020 2020 7661                va
-00017640: 6c20 3d20 7469 6d65 706f 696e 742e 6867  l = timepoint.hg
-00017650: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
-00017660: 2020 2020 2020 2020 2020 6966 2027 6867            if 'hg
-00017670: 7427 2069 6e20 7265 636f 7264 7332 6265  t' in records2be
-00017680: 496e 7665 7274 6564 3a0a 2020 2020 2020  Inverted:.      
-00017690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000176a0: 2020 2020 2020 7661 6c20 2a3d 202d 310a        val *= -1.
-000176b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000176c0: 2020 2020 2020 2020 7265 732e 7772 6974          res.writ
-000176d0: 6528 225c 7422 2b73 7472 2876 616c 2929  e("\t"+str(val))
-000176e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000176f0: 2020 2020 2069 6620 756e 6365 7274 5f6e       if uncert_n
-00017700: 6f74 5f7a 6572 6f20 616e 6420 2775 6e63  ot_zero and 'unc
-00017710: 6572 7427 2069 6e20 6e61 765f 6865 6164  ert' in nav_head
-00017720: 6572 3a0a 2020 2020 2020 2020 2020 2020  er:.            
-00017730: 2020 2020 2020 2020 2020 2020 7661 6c20              val 
-00017740: 3d20 7469 6d65 706f 696e 742e 756e 6365  = timepoint.unce
-00017750: 7274 0a20 2020 2020 2020 2020 2020 2020  rt.             
-00017760: 2020 2020 2020 2020 2020 2069 6620 2775             if 'u
-00017770: 6e63 6572 7427 2069 6e20 7265 636f 7264  ncert' in record
-00017780: 7332 6265 496e 7665 7274 6564 3a0a 2020  s2beInverted:.  
-00017790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000177a0: 2020 2020 2020 2020 2020 7661 6c20 2a3d            val *=
-000177b0: 202d 310a 2020 2020 2020 2020 2020 2020   -1.            
-000177c0: 2020 2020 2020 2020 2020 2020 7265 732e              res.
-000177d0: 7772 6974 6528 225c 7422 2b73 7472 2876  write("\t"+str(v
-000177e0: 616c 2929 0a20 2020 2020 2020 2020 2020  al)).           
-000177f0: 2020 2020 2020 2020 2072 6573 2e77 7269           res.wri
-00017800: 7465 2822 5c6e 2229 0a20 2020 2020 2020  te("\n").       
-00017810: 2020 2020 2072 6573 2e63 6c6f 7365 2829       res.close()
-00017820: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-00017830: 5772 6974 6520 746f 2067 656f 6a73 6f6e  Write to geojson
-00017840: 2066 696c 650a 2020 2020 2020 2020 2020   file.          
-00017850: 2020 6765 6f6a 736f 6e20 3d20 7b27 7479    geojson = {'ty
-00017860: 7065 273a 2027 4665 6174 7572 6543 6f6c  pe': 'FeatureCol
-00017870: 6c65 6374 696f 6e27 2c20 276e 616d 6527  lection', 'name'
-00017880: 3a20 7365 6c66 2e64 6972 2e65 7665 6e74  : self.dir.event
-00017890: 2829 2b22 5f22 2b73 656c 662e 6469 722e  ()+"_"+self.dir.
-000178a0: 7365 6e73 6f72 2829 2b22 5f69 6d61 6765  sensor()+"_image
-000178b0: 2d6e 6176 6967 6174 696f 6e22 2c20 2766  -navigation", 'f
-000178c0: 6561 7475 7265 7327 3a20 5b5d 7d0a 2020  eatures': []}.  
-000178d0: 2020 2020 2020 2020 2020 666f 7220 6669            for fi
-000178e0: 6c65 2069 6e20 696d 6167 655f 6474 733a  le in image_dts:
-000178f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017900: 2023 2070 686f 746f 0a20 2020 2020 2020   # photo.       
-00017910: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
-00017920: 696d 6167 655f 6474 735b 6669 6c65 5d29  image_dts[file])
-00017930: 203d 3d20 313a 0a20 2020 2020 2020 2020   == 1:.         
-00017940: 2020 2020 2020 2020 2020 2069 6620 6465             if de
-00017950: 705f 6e6f 745f 7a65 726f 3a0a 2020 2020  p_not_zero:.    
-00017960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017970: 2020 2020 6765 6f6d 6574 7279 203d 2020      geometry =  
-00017980: 7b27 7479 7065 273a 2022 506f 696e 7422  {'type': "Point"
-00017990: 2c20 2763 6f6f 7264 696e 6174 6573 273a  , 'coordinates':
-000179a0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-000179b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000179c0: 2020 2020 2020 2020 2020 5b66 6c6f 6174            [float
-000179d0: 2869 6d61 6765 5f64 7473 5b66 696c 655d  (image_dts[file]
-000179e0: 5b30 5d2e 6c6f 6e29 2c20 666c 6f61 7428  [0].lon), float(
-000179f0: 696d 6167 655f 6474 735b 6669 6c65 5d5b  image_dts[file][
-00017a00: 305d 2e6c 6174 292c 2066 6c6f 6174 2869  0].lat), float(i
-00017a10: 6d61 6765 5f64 7473 5b66 696c 655d 5b30  mage_dts[file][0
-00017a20: 5d2e 6465 7029 5d0a 2020 2020 2020 2020  ].dep)].        
-00017a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017a40: 2020 2020 2020 2020 2020 2020 7d0a 2020              }.  
-00017a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017a60: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00017a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017a80: 6765 6f6d 6574 7279 203d 2020 7b27 7479  geometry =  {'ty
-00017a90: 7065 273a 2022 506f 696e 7422 2c20 2763  pe': "Point", 'c
-00017aa0: 6f6f 7264 696e 6174 6573 273a 200a 2020  oordinates': .  
-00017ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017ad0: 2020 2020 2020 5b66 6c6f 6174 2869 6d61        [float(ima
-00017ae0: 6765 5f64 7473 5b66 696c 655d 5b30 5d2e  ge_dts[file][0].
-00017af0: 6c6f 6e29 2c20 666c 6f61 7428 696d 6167  lon), float(imag
-00017b00: 655f 6474 735b 6669 6c65 5d5b 305d 2e6c  e_dts[file][0].l
-00017b10: 6174 295d 0a20 2020 2020 2020 2020 2020  at)].           
-00017b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017b30: 2020 2020 2020 2020 207d 0a20 2020 2020           }.     
-00017b40: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00017b50: 6620 5472 7565 2069 6e20 5b6d 6174 682e  f True in [math.
-00017b60: 6973 6e61 6e28 7829 2066 6f72 2078 2069  isnan(x) for x i
-00017b70: 6e20 6765 6f6d 6574 7279 5b27 636f 6f72  n geometry['coor
-00017b80: 6469 6e61 7465 7327 5d5d 3a0a 2020 2020  dinates']]:.    
-00017b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017ba0: 2020 2020 636f 6e74 696e 7565 0a0a 2020      continue..  
-00017bb0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00017bc0: 7669 6465 6f0a 2020 2020 2020 2020 2020  video.          
-00017bd0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00017be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017bf0: 6966 2064 6570 5f6e 6f74 5f7a 6572 6f3a  if dep_not_zero:
-00017c00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017c10: 2020 2020 2020 2020 2067 656f 6d65 7472           geometr
-00017c20: 7920 3d20 207b 2774 7970 6527 3a20 224d  y =  {'type': "M
-00017c30: 756c 7469 506f 696e 7422 2c20 2763 6f6f  ultiPoint", 'coo
-00017c40: 7264 696e 6174 6573 273a 0a20 2020 2020  rdinates':.     
-00017c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017c70: 2020 205b 5b66 6c6f 6174 2864 2e6c 6f6e     [[float(d.lon
-00017c80: 292c 2066 6c6f 6174 2864 2e6c 6174 292c  ), float(d.lat),
-00017c90: 2066 6c6f 6174 2864 2e64 6570 295d 2066   float(d.dep)] f
-00017ca0: 6f72 2064 2069 6e20 696d 6167 655f 6474  or d in image_dt
-00017cb0: 735b 6669 6c65 5d5d 0a20 2020 2020 2020  s[file]].       
-00017cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017cd0: 2020 2020 2020 2020 2020 2020 207d 0a20               }. 
-00017ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017cf0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00017d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017d10: 2067 656f 6d65 7472 7920 3d20 207b 2774   geometry =  {'t
-00017d20: 7970 6527 3a20 224d 756c 7469 506f 696e  ype': "MultiPoin
-00017d30: 7422 2c20 2763 6f6f 7264 696e 6174 6573  t", 'coordinates
-00017d40: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
-00017d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017d60: 2020 2020 2020 2020 2020 205b 5b66 6c6f             [[flo
-00017d70: 6174 2864 2e6c 6f6e 292c 2066 6c6f 6174  at(d.lon), float
-00017d80: 2864 2e6c 6174 295d 2066 6f72 2064 2069  (d.lat)] for d i
-00017d90: 6e20 696d 6167 655f 6474 735b 6669 6c65  n image_dts[file
-00017da0: 5d5d 0a20 2020 2020 2020 2020 2020 2020  ]].             
-00017db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017dc0: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
-00017dd0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00017de0: 5472 7565 2069 6e20 5b6d 6174 682e 6973  True in [math.is
-00017df0: 6e61 6e28 7829 2066 6f72 2078 2069 6e20  nan(x) for x in 
-00017e00: 5b69 7465 6d20 666f 7220 7375 626c 6973  [item for sublis
-00017e10: 7420 696e 2067 656f 6d65 7472 795b 2763  t in geometry['c
-00017e20: 6f6f 7264 696e 6174 6573 275d 2066 6f72  oordinates'] for
-00017e30: 2069 7465 6d20 696e 2073 7562 6c69 7374   item in sublist
-00017e40: 5d5d 3a0a 2020 2020 2020 2020 2020 2020  ]]:.            
-00017e50: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-00017e60: 696e 7565 0a0a 2020 2020 2020 2020 2020  inue..          
-00017e70: 2020 2020 2020 6765 6f6a 736f 6e5b 2766        geojson['f
-00017e80: 6561 7475 7265 7327 5d2e 6170 7065 6e64  eatures'].append
-00017e90: 287b 2774 7970 6527 3a20 2746 6561 7475  ({'type': 'Featu
-00017ea0: 7265 272c 2027 7072 6f70 6572 7469 6573  re', 'properties
-00017eb0: 273a 207b 2769 6427 3a20 6669 6c65 7d2c  ': {'id': file},
-00017ec0: 2027 6765 6f6d 6574 7279 273a 2067 656f   'geometry': geo
-00017ed0: 6d65 7472 7920 7d29 0a20 2020 2020 2020  metry }).       
-00017ee0: 2020 2020 2020 2020 200a 2020 2020 2020           .      
-00017ef0: 2020 2020 2020 6f20 3d20 6f70 656e 2873        o = open(s
-00017f00: 656c 662e 6765 745f 696e 745f 6e61 765f  elf.get_int_nav_
-00017f10: 6669 6c65 2829 2e72 6570 6c61 6365 2822  file().replace("
-00017f20: 2e74 7874 222c 2022 2e67 656f 6a73 6f6e  .txt", ".geojson
-00017f30: 2229 2c0a 2020 2020 2020 2020 2020 2020  "),.            
-00017f40: 2020 2020 2020 2020 2022 7722 2c20 6572           "w", er
-00017f50: 726f 7273 3d22 6967 6e6f 7265 222c 2065  rors="ignore", e
-00017f60: 6e63 6f64 696e 673d 2775 7466 2d38 2729  ncoding='utf-8')
-00017f70: 0a20 2020 2020 2020 2020 2020 206a 736f  .            jso
-00017f80: 6e2e 6475 6d70 2867 656f 6a73 6f6e 2c20  n.dump(geojson, 
-00017f90: 6f2c 2065 6e73 7572 655f 6173 6369 693d  o, ensure_ascii=
-00017fa0: 4661 6c73 652c 2069 6e64 656e 743d 3429  False, indent=4)
-00017fb0: 0a20 2020 2020 2020 2020 2020 206f 2e63  .            o.c
-00017fc0: 6c6f 7365 2829 0a0a 2020 2020 2020 2020  lose()..        
-00017fd0: 2020 2020 7365 6c66 2e70 726f 762e 6164      self.prov.ad
-00017fe0: 6441 7267 756d 656e 7428 2269 6e70 7574  dArgument("input
-00017ff0: 4e61 7669 6761 7469 6f6e 4669 6c65 222c  NavigationFile",
-00018000: 6e61 765f 7061 7468 2c6f 7665 7277 7269  nav_path,overwri
-00018010: 7465 3d54 7275 6529 0a20 2020 2020 2020  te=True).       
-00018020: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
-00018030: 6f67 2822 7061 7273 6564 2066 726f 6d20  og("parsed from 
-00018040: 696e 7075 744e 6176 6967 6174 696f 6e46  inputNavigationF
-00018050: 696c 653a 2022 202b 2073 7472 286e 6176  ile: " + str(nav
-00018060: 5f68 6561 6465 7229 2c64 6f6e 7453 686f  _header),dontSho
-00018070: 773d 5472 7565 290a 2020 2020 2020 2020  w=True).        
-00018080: 2020 2020 732e 7374 6f70 2829 0a20 2020      s.stop().   
-00018090: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-000180a0: 5472 7565 2c20 224e 6176 6967 6174 696f  True, "Navigatio
-000180b0: 6e20 6461 7461 2063 7265 6174 6564 2220  n data created" 
-000180c0: 2b20 7265 7475 726e 4d73 670a 2020 2020  + returnMsg.    
-000180d0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-000180e0: 2020 2020 2020 732e 7374 6f70 2829 0a20        s.stop(). 
-000180f0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00018100: 6e20 4661 6c73 652c 2022 4e6f 2069 6d61  n False, "No ima
-00018110: 6765 2063 6f6f 7264 696e 6174 6573 2066  ge coordinates f
-00018120: 6f75 6e64 2220 2b20 7265 7475 726e 4d73  ound" + returnMs
-00018130: 670a 0a20 2020 2064 6566 2063 7265 6174  g..    def creat
-00018140: 6549 6d61 6765 4e61 7669 6761 7469 6f6e  eImageNavigation
-00018150: 4669 6c65 2873 656c 662c 206e 6176 5f70  File(self, nav_p
-00018160: 6174 683a 2073 7472 2c20 6e61 765f 6865  ath: str, nav_he
-00018170: 6164 6572 3d6d 6971 7476 2e70 6f73 5f68  ader=miqtv.pos_h
-00018180: 6561 6465 725b 2770 616e 6761 6561 275d  eader['pangaea']
-00018190: 2c20 6461 7465 5f66 6f72 6d61 743d 6d69  , date_format=mi
-000181a0: 7174 762e 6461 7465 5f66 6f72 6d61 7473  qtv.date_formats
-000181b0: 5b27 7061 6e67 6165 6127 5d2c 206f 7665  ['pangaea'], ove
-000181c0: 7277 7269 7465 3d46 616c 7365 2c20 636f  rwrite=False, co
-000181d0: 6c5f 7365 7061 7261 746f 7220 3d20 225c  l_separator = "\
-000181e0: 7422 2c20 7669 6465 6f53 616d 706c 6553  t", videoSampleS
-000181f0: 6563 6f6e 6473 3d31 2c0a 2020 2020 2020  econds=1,.      
-00018200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018210: 2020 2020 2020 2020 2020 2020 2020 6f66                of
-00018220: 6673 6574 5f78 3d30 2c20 6f66 6673 6574  fset_x=0, offset
-00018230: 5f79 3d30 2c20 6f66 6673 6574 5f7a 3d30  _y=0, offset_z=0
-00018240: 2c61 6e67 6c65 735f 696e 5f72 6164 203d  ,angles_in_rad =
-00018250: 2046 616c 7365 2c20 7265 636f 7264 7332   False, records2
-00018260: 6265 496e 7665 7274 6564 3d5b 5d29 3a0a  beInverted=[]):.
-00018270: 2020 2020 2020 2020 2222 2220 4465 7072          """ Depr
-00018280: 6563 6174 6564 202d 2075 7365 2063 7265  ecated - use cre
-00018290: 6174 655f 696d 6167 655f 6e61 7669 6761  ate_image_naviga
-000182a0: 7469 6f6e 5f66 696c 6520 2222 220a 2020  tion_file """.  
-000182b0: 2020 2020 2020 7365 6c66 2e63 7265 6174        self.creat
-000182c0: 655f 696d 6167 655f 6e61 7669 6761 7469  e_image_navigati
-000182d0: 6f6e 5f66 696c 6528 6e61 765f 7061 7468  on_file(nav_path
-000182e0: 2c20 6e61 765f 6865 6164 6572 2c20 6461  , nav_header, da
-000182f0: 7465 5f66 6f72 6d61 742c 206f 7665 7277  te_format, overw
-00018300: 7269 7465 2c20 636f 6c5f 7365 7061 7261  rite, col_separa
-00018310: 746f 722c 2076 6964 656f 5361 6d70 6c65  tor, videoSample
-00018320: 5365 636f 6e64 732c 206f 6666 7365 745f  Seconds, offset_
-00018330: 782c 206f 6666 7365 745f 792c 206f 6666  x, offset_y, off
-00018340: 7365 745f 7a2c 2061 6e67 6c65 735f 696e  set_z, angles_in
-00018350: 5f72 6164 2c20 7265 636f 7264 7332 6265  _rad, records2be
-00018360: 496e 7665 7274 6564 290a 0a0a 2020 2020  Inverted)...    
-00018370: 6465 6620 6372 6561 7465 5f69 6d61 6765  def create_image
-00018380: 5f73 6861 3235 365f 6669 6c65 2873 656c  _sha256_file(sel
-00018390: 662c 7265 5265 6164 416c 6c3d 5472 7565  f,reReadAll=True
-000183a0: 293a 0a20 2020 2020 2020 2022 2222 2043  ):.        """ C
-000183b0: 7265 6174 6573 2069 6e20 2f69 6e74 6572  reates in /inter
-000183c0: 6d65 6469 6174 6520 6120 7465 7874 2066  mediate a text f
-000183d0: 696c 6520 636f 6e74 6169 6e69 6e67 2070  ile containing p
-000183e0: 6572 2069 6d61 6765 2069 7473 2053 4841  er image its SHA
-000183f0: 3235 3620 6861 7368 2e0a 2020 2020 2020  256 hash..      
-00018400: 2020 2020 2020 4966 2072 6552 6561 6441        If reReadA
-00018410: 6c6c 2069 7320 5472 7565 2061 6c6c 2069  ll is True all i
-00018420: 6d61 6765 7327 2068 6173 6865 7320 6172  mages' hashes ar
-00018430: 6520 6465 7465 726d 696e 6564 2e20 4f74  e determined. Ot
-00018440: 6865 7277 6973 6520 6f6e 6c79 2066 6f72  herwise only for
-00018450: 2074 686f 7365 2066 696c 6573 0a20 2020   those files.   
-00018460: 2020 2020 2020 2020 2077 6869 6368 2061           which a
-00018470: 7265 206e 6f74 2079 6574 2069 6e20 7468  re not yet in th
-00018480: 6520 696e 7465 726d 6564 6961 7465 2066  e intermediate f
-00018490: 696c 6520 636f 6e74 6169 6e69 6e67 2074  ile containing t
-000184a0: 6865 2069 6d61 6765 2068 6173 6865 7320  he image hashes 
-000184b0: 2022 2222 0a20 2020 2020 2020 2068 6173   """.        has
-000184c0: 6865 7320 3d20 7b7d 0a20 2020 2020 2020  hes = {}.       
-000184d0: 2069 6620 6f73 2e70 6174 682e 6578 6973   if os.path.exis
-000184e0: 7473 2873 656c 662e 6765 745f 696e 745f  ts(self.get_int_
-000184f0: 6861 7368 5f66 696c 6528 2929 3a0a 2020  hash_file()):.  
-00018500: 2020 2020 2020 2020 2020 6861 7368 6573            hashes
-00018510: 203d 206d 6971 7466 2e74 6162 4669 6c65   = miqtf.tabFile
-00018520: 4461 7461 2873 656c 662e 6765 745f 696e  Data(self.get_in
-00018530: 745f 6861 7368 5f66 696c 6528 292c 205b  t_hash_file(), [
-00018540: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
-00018550: 5b27 6d61 7269 7174 275d 5b27 696d 6727  ['mariqt']['img'
-00018560: 5d2c 206d 6971 7476 2e63 6f6c 5f68 6561  ], miqtv.col_hea
-00018570: 6465 725b 276d 6172 6971 7427 5d5b 2768  der['mariqt']['h
-00018580: 6173 6827 5d5d 2c20 6b65 795f 636f 6c3d  ash']], key_col=
-00018590: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
-000185a0: 5b27 6d61 7269 7174 275d 5b27 696d 6727  ['mariqt']['img'
-000185b0: 5d29 0a0a 2020 2020 2020 2020 696d 6167  ])..        imag
-000185c0: 6573 496e 5261 7720 3d20 7365 6c66 2e69  esInRaw = self.i
-000185d0: 6d61 6765 7349 6e49 6d61 6765 7344 6972  magesInImagesDir
-000185e0: 2829 0a20 2020 2020 2020 2069 6620 6c65  ().        if le
-000185f0: 6e28 696d 6167 6573 496e 5261 7729 203e  n(imagesInRaw) >
-00018600: 2030 3a0a 0a20 2020 2020 2020 2020 2020   0:..           
-00018610: 2061 6464 6564 5f68 6173 6865 7320 3d20   added_hashes = 
-00018620: 300a 2020 2020 2020 2020 2020 2020 7072  0.            pr
-00018630: 6f67 203d 206d 6971 7463 2e50 7269 6e74  og = miqtc.Print
-00018640: 4b6e 6f77 6e50 726f 6772 6573 734d 7367  KnownProgressMsg
-00018650: 2822 4368 6563 6b69 6e67 2068 6173 6865  ("Checking hashe
-00018660: 7322 2c20 6c65 6e28 696d 6167 6573 496e  s", len(imagesIn
-00018670: 5261 7729 2c6d 6f64 756c 6f3d 3529 0a20  Raw),modulo=5). 
-00018680: 2020 2020 2020 2020 2020 2066 6f72 2066             for f
-00018690: 696c 6520 696e 2069 6d61 6765 7349 6e52  ile in imagesInR
-000186a0: 6177 3a0a 2020 2020 2020 2020 2020 2020  aw:.            
-000186b0: 2020 2020 7072 6f67 2e70 726f 6772 6573      prog.progres
-000186c0: 7328 290a 0a20 2020 2020 2020 2020 2020  s()..           
-000186d0: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
-000186e0: 2e5f 5f61 6c6c 5555 4944 7343 6865 636b  .__allUUIDsCheck
-000186f0: 6564 2061 6e64 206e 6f74 206d 6971 7469  ed and not miqti
-00018700: 2e69 6d61 6765 436f 6e74 6169 6e73 5661  .imageContainsVa
-00018710: 6c69 6455 5549 4428 6669 6c65 295b 305d  lidUUID(file)[0]
-00018720: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00018730: 2020 2020 2020 2320 7265 6d6f 7665 2066        # remove f
-00018740: 726f 6d20 7575 6964 2066 696c 650a 2020  rom uuid file.  
-00018750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018760: 2020 6966 206f 732e 7061 7468 2e65 7869    if os.path.exi
-00018770: 7374 7328 7365 6c66 2e67 6574 5f69 6e74  sts(self.get_int
-00018780: 5f75 7569 645f 6669 6c65 2829 293a 0a20  _uuid_file()):. 
-00018790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000187a0: 2020 2020 2020 2072 6573 203d 206f 7065         res = ope
-000187b0: 6e28 7365 6c66 2e67 6574 5f69 6e74 5f75  n(self.get_int_u
-000187c0: 7569 645f 6669 6c65 2829 2c20 2272 2229  uid_file(), "r")
-000187d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000187e0: 2020 2020 2020 2020 206c 696e 6573 203d           lines =
-000187f0: 2072 6573 2e72 6561 646c 696e 6573 2829   res.readlines()
-00018800: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018810: 2020 2020 2020 2020 2072 6573 2e63 6c6f           res.clo
-00018820: 7365 2829 0a20 2020 2020 2020 2020 2020  se().           
-00018830: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00018840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018850: 2020 2020 2020 206c 696e 6573 203d 205b         lines = [
-00018860: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00018870: 2020 2020 2020 6920 3d20 300a 2020 2020        i = 0.    
-00018880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018890: 6c69 6e65 4e72 203d 2069 0a20 2020 2020  lineNr = i.     
-000188a0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-000188b0: 6f72 206c 696e 6520 696e 206c 696e 6573  or line in lines
-000188c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000188d0: 2020 2020 2020 2020 2020 6966 206f 732e            if os.
-000188e0: 7061 7468 2e62 6173 656e 616d 6528 6669  path.basename(fi
-000188f0: 6c65 2920 696e 206c 696e 653a 0a20 2020  le) in line:.   
-00018900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018910: 2020 2020 2020 2020 206c 696e 654e 7220           lineNr 
-00018920: 3d20 690a 2020 2020 2020 2020 2020 2020  = i.            
-00018930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018940: 6272 6561 6b0a 2020 2020 2020 2020 2020  break.          
-00018950: 2020 2020 2020 2020 2020 2020 2020 6920                i 
-00018960: 2b3d 2031 0a20 2020 2020 2020 2020 2020  += 1.           
-00018970: 2020 2020 2020 2020 2069 6620 6c69 6e65           if line
-00018980: 4e72 2021 3d20 303a 0a20 2020 2020 2020  Nr != 0:.       
-00018990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000189a0: 2064 656c 206c 696e 6573 5b6c 696e 654e   del lines[lineN
-000189b0: 725d 0a20 2020 2020 2020 2020 2020 2020  r].             
-000189c0: 2020 2020 2020 2020 2020 2072 6573 203d             res =
-000189d0: 206f 7065 6e28 7365 6c66 2e67 6574 5f69   open(self.get_i
-000189e0: 6e74 5f75 7569 645f 6669 6c65 2829 2c20  nt_uuid_file(), 
-000189f0: 2277 2229 0a20 2020 2020 2020 2020 2020  "w").           
-00018a00: 2020 2020 2020 2020 2020 2020 2072 6573               res
-00018a10: 2e77 7269 7465 6c69 6e65 7328 6c69 6e65  .writelines(line
-00018a20: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
-00018a30: 2020 2020 2020 2020 2020 2072 6573 2e63             res.c
-00018a40: 6c6f 7365 2829 0a20 2020 2020 2020 2020  lose().         
-00018a50: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00018a60: 2045 7863 6570 7469 6f6e 2820 2246 696c   Exception( "Fil
-00018a70: 6520 2220 2b20 6669 6c65 202b 2022 2064  e " + file + " d
-00018a80: 6f65 7320 6e6f 7420 636f 7461 696e 2061  oes not cotain a
-00018a90: 2076 616c 6964 2055 5549 442e 2052 756e   valid UUID. Run
-00018aa0: 2063 7265 6174 655f 7575 6964 5f66 696c   create_uuid_fil
-00018ab0: 6528 2920 6669 7273 7421 2229 0a0a 2020  e() first!")..  
-00018ac0: 2020 2020 2020 2020 2020 2020 2020 6669                fi
-00018ad0: 6c65 5f6e 616d 6520 3d20 6f73 2e70 6174  le_name = os.pat
-00018ae0: 682e 6261 7365 6e61 6d65 2866 696c 6529  h.basename(file)
-00018af0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018b00: 2069 6620 6e6f 7420 7265 5265 6164 416c   if not reReadAl
-00018b10: 6c20 616e 6420 6669 6c65 5f6e 616d 6520  l and file_name 
-00018b20: 696e 2068 6173 6865 733a 0a20 2020 2020  in hashes:.     
-00018b30: 2020 2020 2020 2020 2020 2020 2020 2068                 h
-00018b40: 6173 6865 735b 6669 6c65 5f6e 616d 655d  ashes[file_name]
-00018b50: 203d 2068 6173 6865 735b 6669 6c65 5f6e   = hashes[file_n
-00018b60: 616d 655d 5b6d 6971 7476 2e63 6f6c 5f68  ame][miqtv.col_h
-00018b70: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
-00018b80: 2768 6173 6827 5d5d 0a20 2020 2020 2020  'hash']].       
-00018b90: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00018ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018bb0: 2020 2068 6173 6865 735b 6669 6c65 5f6e     hashes[file_n
-00018bc0: 616d 655d 203d 206d 6971 7463 2e73 6861  ame] = miqtc.sha
-00018bd0: 3235 3648 6173 6846 696c 6528 6669 6c65  256HashFile(file
-00018be0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00018bf0: 2020 2020 2020 6164 6465 645f 6861 7368        added_hash
-00018c00: 6573 202b 3d20 310a 2020 2020 2020 2020  es += 1.        
-00018c10: 2020 2020 7072 6f67 2e63 6c65 6172 2829      prog.clear()
-00018c20: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00018c30: 2072 6552 6561 6441 6c6c 206f 7220 6164   reReadAll or ad
-00018c40: 6465 645f 6861 7368 6573 203e 2030 3a0a  ded_hashes > 0:.
-00018c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018c60: 6861 7368 5f66 696c 6520 3d20 6f70 656e  hash_file = open
-00018c70: 2873 656c 662e 6765 745f 696e 745f 6861  (self.get_int_ha
-00018c80: 7368 5f66 696c 6528 292c 2022 7722 290a  sh_file(), "w").
-00018c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018ca0: 6861 7368 5f66 696c 652e 7772 6974 6528  hash_file.write(
-00018cb0: 206d 6971 7476 2e63 6f6c 5f68 6561 6465   miqtv.col_heade
-00018cc0: 725b 276d 6172 6971 7427 5d5b 2769 6d67  r['mariqt']['img
-00018cd0: 275d 2b22 5c74 222b 6d69 7174 762e 636f  ']+"\t"+miqtv.co
-00018ce0: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
-00018cf0: 275d 5b27 6861 7368 275d 2b22 5c6e 2229  ']['hash']+"\n")
-00018d00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018d10: 2066 6f72 2066 696c 655f 6e61 6d65 2069   for file_name i
-00018d20: 6e20 6861 7368 6573 3a0a 2020 2020 2020  n hashes:.      
-00018d30: 2020 2020 2020 2020 2020 2020 2020 6861                ha
-00018d40: 7368 5f66 696c 652e 7772 6974 6528 6669  sh_file.write(fi
-00018d50: 6c65 5f6e 616d 652b 225c 7422 2b68 6173  le_name+"\t"+has
-00018d60: 6865 735b 6669 6c65 5f6e 616d 655d 2b22  hes[file_name]+"
-00018d70: 5c6e 2229 0a0a 2020 2020 2020 2020 2020  \n")..          
-00018d80: 2020 2020 2020 6861 7368 5f66 696c 652e        hash_file.
-00018d90: 636c 6f73 6528 290a 2020 2020 2020 2020  close().        
-00018da0: 2020 2020 2020 2020 7265 7475 726e 2054          return T
-00018db0: 7275 652c 2022 4164 6465 6420 222b 7374  rue, "Added "+st
-00018dc0: 7228 6164 6465 645f 6861 7368 6573 292b  r(added_hashes)+
-00018dd0: 2220 6861 7368 6573 2074 6f20 6861 7368  " hashes to hash
-00018de0: 2066 696c 6522 0a20 2020 2020 2020 2020   file".         
-00018df0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00018e00: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00018e10: 5472 7565 2c20 2241 6c6c 2068 6173 6865  True, "All hashe
-00018e20: 7320 6578 6973 7422 0a0a 2020 2020 2020  s exist"..      
-00018e30: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00018e40: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-00018e50: 2c20 224e 6f20 696d 6167 6573 2066 6f75  , "No images fou
-00018e60: 6e64 2074 6f20 6861 7368 220a 2020 2020  nd to hash".    
-00018e70: 2020 2020 0a20 2020 2064 6566 2063 7265      .    def cre
-00018e80: 6174 6549 6d61 6765 5348 4132 3536 4669  ateImageSHA256Fi
-00018e90: 6c65 2873 656c 662c 7265 5265 6164 416c  le(self,reReadAl
-00018ea0: 6c3d 5472 7565 293a 0a20 2020 2020 2020  l=True):.       
-00018eb0: 2022 2222 2044 6570 7265 6361 7465 6420   """ Deprecated 
-00018ec0: 2d20 7573 6520 6372 6561 7465 5f69 6d61  - use create_ima
-00018ed0: 6765 5f73 6861 3235 365f 6669 6c65 2022  ge_sha256_file "
-00018ee0: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
-00018ef0: 6e20 7365 6c66 2e63 7265 6174 655f 696d  n self.create_im
-00018f00: 6167 655f 7368 6132 3536 5f66 696c 6528  age_sha256_file(
-00018f10: 7265 5265 6164 416c 6c29 0a0a 0a20 2020  reReadAll)...   
-00018f20: 2064 6566 2063 7265 6174 655f 7374 6172   def create_star
-00018f30: 745f 7469 6d65 5f66 696c 6528 7365 6c66  t_time_file(self
-00018f40: 293a 0a20 2020 2020 2020 2022 2222 2043  ):.        """ C
-00018f50: 7265 6174 6573 2069 6e20 2f69 6e74 6572  reates in /inter
-00018f60: 6d65 6469 6174 6520 6120 7465 7874 2066  mediate a text f
-00018f70: 696c 6520 636f 6e74 6169 6e69 6e67 2070  ile containing p
-00018f80: 6572 2069 6d61 6765 2069 7473 2073 7461  er image its sta
-00018f90: 7274 2074 696d 6520 7061 7273 6564 2066  rt time parsed f
-00018fa0: 726f 6d20 7468 6520 6669 6c65 206e 616d  rom the file nam
-00018fb0: 6520 2222 220a 0a20 2020 2020 2020 2073  e """..        s
-00018fc0: 203d 206d 6971 7463 2e50 7269 6e74 4c6f   = miqtc.PrintLo
-00018fd0: 6164 696e 674d 7367 2822 4372 6561 7469  adingMsg("Creati
-00018fe0: 6e67 2069 6e74 6572 6d65 6469 6174 6520  ng intermediate 
-00018ff0: 7374 6172 7474 696d 6520 6669 6c65 2022  starttime file "
-00019000: 290a 2020 2020 2020 2020 696d 6167 6573  ).        images
-00019010: 496e 5261 7720 3d20 7365 6c66 2e69 6d61  InRaw = self.ima
-00019020: 6765 7349 6e49 6d61 6765 7344 6972 536f  gesInImagesDirSo
-00019030: 7274 6564 4c69 7374 2829 0a20 2020 2020  rtedList().     
-00019040: 2020 2069 6620 6c65 6e28 696d 6167 6573     if len(images
-00019050: 496e 5261 7729 203e 2030 3a0a 0a20 2020  InRaw) > 0:..   
-00019060: 2020 2020 2020 2020 206f 203d 206f 7065           o = ope
-00019070: 6e28 7365 6c66 2e67 6574 5f69 6e74 5f73  n(self.get_int_s
-00019080: 7461 7274 5469 6d65 735f 6669 6c65 2829  tartTimes_file()
-00019090: 2c20 2277 2229 0a20 2020 2020 2020 2020  , "w").         
-000190a0: 2020 206f 2e77 7269 7465 286d 6971 7476     o.write(miqtv
-000190b0: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
-000190c0: 6971 7427 5d5b 2769 6d67 275d 202b 0a20  iqt']['img'] +. 
-000190d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000190e0: 2020 2022 5c74 222b 6d69 7174 762e 636f     "\t"+miqtv.co
-000190f0: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
-00019100: 275d 5b27 7574 6327 5d2b 225c 6e22 290a  ']['utc']+"\n").
-00019110: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00019120: 2066 696c 6520 696e 2069 6d61 6765 7349   file in imagesI
-00019130: 6e52 6177 3a0a 2020 2020 2020 2020 2020  nRaw:.          
-00019140: 2020 2020 2020 6669 6c65 5f6e 616d 6520        file_name 
-00019150: 3d20 6f73 2e70 6174 682e 6261 7365 6e61  = os.path.basena
-00019160: 6d65 2866 696c 6529 0a0a 2020 2020 2020  me(file)..      
-00019170: 2020 2020 2020 2020 2020 6474 203d 206d            dt = m
-00019180: 6971 7463 2e70 6172 7365 4669 6c65 4461  iqtc.parseFileDa
-00019190: 7465 5469 6d65 4173 5554 4328 6669 6c65  teTimeAsUTC(file
-000191a0: 5f6e 616d 6529 0a20 2020 2020 2020 2020  _name).         
-000191b0: 2020 2020 2020 206f 2e77 7269 7465 2866         o.write(f
-000191c0: 696c 655f 6e61 6d65 2b22 5c74 2220 2b20  ile_name+"\t" + 
-000191d0: 6474 2e73 7472 6674 696d 6528 6d69 7174  dt.strftime(miqt
-000191e0: 762e 6461 7465 5f66 6f72 6d61 7473 5b27  v.date_formats['
-000191f0: 6d61 7269 7174 275d 292b 225c 6e22 290a  mariqt'])+"\n").
-00019200: 0a20 2020 2020 2020 2020 2020 206f 2e63  .            o.c
-00019210: 6c6f 7365 2829 0a20 2020 2020 2020 2020  lose().         
-00019220: 2020 2073 2e73 746f 7028 290a 2020 2020     s.stop().    
-00019230: 2020 2020 2020 2020 7265 7475 726e 2054          return T
-00019240: 7275 652c 2022 4372 6561 7465 6420 7374  rue, "Created st
-00019250: 6172 7420 7469 6d65 2066 696c 6522 0a20  art time file". 
-00019260: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00019270: 2020 2020 2020 2020 2073 2e73 746f 7028           s.stop(
-00019280: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-00019290: 7475 726e 2046 616c 7365 2c20 224e 6f20  turn False, "No 
-000192a0: 696d 6167 6573 2066 6f75 6e64 2074 6f20  images found to 
-000192b0: 7265 6164 2073 7461 7274 2074 696d 6573  read start times
-000192c0: 220a 2020 2020 2020 2020 0a20 2020 2064  ".        .    d
-000192d0: 6566 2063 7265 6174 6553 7461 7274 5469  ef createStartTi
-000192e0: 6d65 4669 6c65 2873 656c 6629 3a0a 2020  meFile(self):.  
-000192f0: 2020 2020 2020 2222 2220 4465 7072 6563        """ Deprec
-00019300: 6174 6564 202d 2075 7365 2063 7265 6174  ated - use creat
-00019310: 655f 7374 6172 745f 7469 6d65 5f66 696c  e_start_time_fil
-00019320: 6520 2222 220a 2020 2020 2020 2020 7265  e """.        re
-00019330: 7475 726e 2073 656c 662e 6372 6561 7465  turn self.create
-00019340: 5f73 7461 7274 5f74 696d 655f 6669 6c65  _start_time_file
-00019350: 2829 0a0a 0a20 2020 2064 6566 2063 7265  ()...    def cre
-00019360: 6174 6541 6371 7569 7369 7469 6f6e 5365  ateAcquisitionSe
-00019370: 7474 696e 6773 4558 4946 4669 6c65 2873  ttingsEXIFFile(s
-00019380: 656c 662c 6f76 6572 7269 6465 3d46 616c  elf,override=Fal
-00019390: 7365 293a 0a20 2020 2020 2020 2022 2222  se):.        """
-000193a0: 2043 7265 6174 6573 2069 6e20 2f69 6e74   Creates in /int
-000193b0: 6572 6d65 6469 6174 6520 6120 7465 7874  ermediate a text
-000193c0: 2066 696c 6520 636f 6e74 6169 6e69 6e67   file containing
-000193d0: 2070 6572 2069 6d61 6765 2061 2064 6963   per image a dic
-000193e0: 7420 6f66 2065 7869 6620 7461 6773 2061  t of exif tags a
-000193f0: 6e64 2074 6865 6972 2076 616c 7565 7320  nd their values 
-00019400: 7061 7273 6564 2066 726f 6d20 7468 6520  parsed from the 
-00019410: 696d 6167 6520 2222 220a 0a20 2020 2020  image """..     
-00019420: 2020 2069 6e74 5f61 6371 7569 7369 7469     int_acquisiti
-00019430: 6f6e 5365 7474 696e 675f 6669 6c65 203d  onSetting_file =
-00019440: 2073 656c 662e 5f5f 6765 745f 696e 745f   self.__get_int_
-00019450: 6669 6c65 5f70 7265 6669 7828 2920 2b20  file_prefix() + 
-00019460: 275f 696d 6167 652d 6163 7175 6973 6974  '_image-acquisit
-00019470: 696f 6e2d 7365 7474 696e 6773 2e74 7874  ion-settings.txt
-00019480: 270a 2020 2020 2020 2020 6865 6164 6572  '.        header
-00019490: 203d 207b 2020 6d69 7174 762e 636f 6c5f   = {  miqtv.col_
-000194a0: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
-000194b0: 5b27 696d 6727 5d3a 2020 6d69 7174 762e  ['img']:  miqtv.
-000194c0: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
-000194d0: 7174 275d 5b27 696d 6727 5d2c 0a20 2020  qt']['img'],.   
-000194e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000194f0: 206d 6971 7476 2e63 6f6c 5f68 6561 6465   miqtv.col_heade
-00019500: 725b 276d 6172 6971 7427 5d5b 2761 6371  r['mariqt']['acq
-00019510: 7569 275d 3a6d 6971 7476 2e63 6f6c 5f68  ui']:miqtv.col_h
-00019520: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
-00019530: 2761 6371 7569 275d 7d0a 2020 2020 2020  'acqui']}.      
-00019540: 2020 6966 206f 732e 7061 7468 2e65 7869    if os.path.exi
-00019550: 7374 7328 696e 745f 6163 7175 6973 6974  sts(int_acquisit
-00019560: 696f 6e53 6574 7469 6e67 5f66 696c 6529  ionSetting_file)
-00019570: 2061 6e64 206e 6f74 206f 7665 7272 6964   and not overrid
-00019580: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
-00019590: 656c 662e 6164 645f 6974 656d 5f69 6e66  elf.add_item_inf
-000195a0: 6f5f 7461 625f 6669 6c65 2869 6e74 5f61  o_tab_file(int_a
-000195b0: 6371 7569 7369 7469 6f6e 5365 7474 696e  cquisitionSettin
-000195c0: 675f 6669 6c65 2c22 5c74 222c 6865 6164  g_file,"\t",head
-000195d0: 6572 290a 2020 2020 2020 2020 2020 2020  er).            
-000195e0: 7265 7475 726e 2054 7275 652c 2022 5265  return True, "Re
-000195f0: 7375 6c74 2066 696c 6520 6578 6973 7473  sult file exists
-00019600: 220a 0a20 2020 2020 2020 2069 6d61 6765  "..        image
-00019610: 7349 6e52 6177 203d 2073 656c 662e 696d  sInRaw = self.im
-00019620: 6167 6573 496e 496d 6167 6573 4469 7253  agesInImagesDirS
-00019630: 6f72 7465 644c 6973 7428 290a 2020 2020  ortedList().    
-00019640: 2020 2020 6966 206c 656e 2869 6d61 6765      if len(image
-00019650: 7349 6e52 6177 2920 3e20 303a 0a0a 2020  sInRaw) > 0:..  
-00019660: 2020 2020 2020 2020 2020 6f20 3d20 6f70            o = op
-00019670: 656e 2869 6e74 5f61 6371 7569 7369 7469  en(int_acquisiti
-00019680: 6f6e 5365 7474 696e 675f 6669 6c65 2c20  onSetting_file, 
-00019690: 2277 2229 0a20 2020 2020 2020 2020 2020  "w").           
-000196a0: 206f 2e77 7269 7465 286d 6971 7476 2e63   o.write(miqtv.c
-000196b0: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
-000196c0: 7427 5d5b 2769 6d67 275d 202b 2022 5c74  t']['img'] + "\t
-000196d0: 222b 6d69 7174 762e 636f 6c5f 6865 6164  "+miqtv.col_head
-000196e0: 6572 5b27 6d61 7269 7174 275d 5b27 6163  er['mariqt']['ac
-000196f0: 7175 6927 5d2b 225c 6e22 290a 200a 2020  qui']+"\n"). .  
-00019700: 2020 2020 2020 2020 2020 696d 6167 6573            images
-00019710: 4578 6966 7320 3d20 6d69 7174 692e 6765  Exifs = miqti.ge
-00019720: 7449 6d61 6765 7341 6c6c 4578 6966 5661  tImagesAllExifVa
-00019730: 6c75 6573 2869 6d61 6765 7349 6e52 6177  lues(imagesInRaw
-00019740: 2c73 656c 662e 7072 6f76 290a 2020 2020  ,self.prov).    
-00019750: 2020 2020 2020 2020 666f 7220 6669 6c65          for file
-00019760: 2069 6e20 696d 6167 6573 4578 6966 733a   in imagesExifs:
-00019770: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019780: 2066 696c 655f 6e61 6d65 203d 206f 732e   file_name = os.
-00019790: 7061 7468 2e62 6173 656e 616d 6528 6669  path.basename(fi
-000197a0: 6c65 290a 2020 2020 2020 2020 2020 2020  le).            
-000197b0: 2020 2020 6f2e 7772 6974 6528 6669 6c65      o.write(file
-000197c0: 5f6e 616d 652b 225c 7422 2b73 7472 2869  _name+"\t"+str(i
-000197d0: 6d61 6765 7345 7869 6673 5b66 696c 655d  magesExifs[file]
-000197e0: 292b 225c 6e22 290a 0a20 2020 2020 2020  )+"\n")..       
-000197f0: 2020 2020 206f 2e63 6c6f 7365 2829 0a0a       o.close()..
-00019800: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00019810: 2e61 6464 5f69 7465 6d5f 696e 666f 5f74  .add_item_info_t
-00019820: 6162 5f66 696c 6528 696e 745f 6163 7175  ab_file(int_acqu
-00019830: 6973 6974 696f 6e53 6574 7469 6e67 5f66  isitionSetting_f
-00019840: 696c 652c 225c 7422 2c68 6561 6465 7229  ile,"\t",header)
-00019850: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00019860: 7572 6e20 5472 7565 2c20 2243 7265 6174  urn True, "Creat
-00019870: 6564 2061 6371 7569 7369 7469 6f6e 2073  ed acquisition s
-00019880: 6574 7469 6e67 7320 6669 6c65 220a 2020  ettings file".  
-00019890: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-000198a0: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-000198b0: 616c 7365 2c20 224e 6f20 696d 6167 6573  alse, "No images
-000198c0: 2066 6f75 6e64 220a 0a0a 2020 2020 6465   found"...    de
-000198d0: 6620 696d 6167 6573 496e 496d 6167 6573  f imagesInImages
-000198e0: 4469 7228 7365 6c66 293a 0a20 2020 2020  Dir(self):.     
-000198f0: 2020 2072 6574 7572 6e20 636f 7079 2e64     return copy.d
-00019900: 6565 7063 6f70 7928 7365 6c66 2e5f 696d  eepcopy(self._im
-00019910: 6167 6573 496e 496d 6167 6573 4469 7229  agesInImagesDir)
-00019920: 0a0a 2020 2020 6465 6620 696d 6167 6573  ..    def images
-00019930: 496e 496d 6167 6573 4469 7253 6f72 7465  InImagesDirSorte
-00019940: 644c 6973 7428 7365 6c66 293a 0a20 2020  dList(self):.   
-00019950: 2020 2020 2072 6574 7572 6e20 636f 7079       return copy
-00019960: 2e64 6565 7063 6f70 7928 7365 6c66 2e5f  .deepcopy(self._
-00019970: 696d 6167 6573 496e 496d 6167 6573 4469  imagesInImagesDi
-00019980: 7253 6f72 7465 644c 6973 7429 0a0a 0a20  rSortedList)... 
-00019990: 2020 2064 6566 2070 6172 7365 4974 656d     def parseItem
-000199a0: 4461 7461 6672 6f6d 5461 6246 696c 6544  DatafromTabFileD
-000199b0: 6174 6128 7365 6c66 2c20 6974 656d 733a  ata(self, items:
-000199c0: 2064 6963 742c 2066 696c 653a 2073 7472   dict, file: str
-000199d0: 2c20 636f 6c73 3a20 6c69 7374 2c20 6f70  , cols: list, op
-000199e0: 7469 6f6e 616c 3a20 6c69 7374 203d 205b  tional: list = [
-000199f0: 5d2c 2064 6174 6574 696d 655f 666f 726d  ], datetime_form
-00019a00: 6174 3a73 7472 3d6d 6971 7476 2e64 6174  at:str=miqtv.dat
-00019a10: 655f 666f 726d 6174 735b 276d 6172 6971  e_formats['mariq
-00019a20: 7427 5d29 3a0a 2020 2020 2020 2020 2222  t']):.        ""
-00019a30: 2220 7061 7273 6573 2064 6174 6120 6672  " parses data fr
-00019a40: 6f6d 2063 6f6c 756d 6e73 2069 6e20 636f  om columns in co
-00019a50: 6c73 2061 6e64 2077 7269 7465 7320 696e  ls and writes in
-00019a60: 666f 2074 6f20 6974 656d 732e 2043 6f6c  fo to items. Col
-00019a70: 756d 6e20 2769 6d61 6765 2d66 696c 656e  umn 'image-filen
-00019a80: 616d 6527 206d 7573 7420 6265 2069 6e20  ame' must be in 
-00019a90: 6669 6c65 2061 6e64 2064 6f65 7320 6e6f  file and does no
-00019aa0: 7420 6e65 6564 2074 6f20 6265 2070 6173  t need to be pas
-00019ab0: 7365 6420 696e 2063 6f6c 732e 200a 2020  sed in cols. .  
-00019ac0: 2020 2020 2020 2020 2020 4669 6c65 206d            File m
-00019ad0: 7573 7420 6265 2074 6162 2073 6570 6172  ust be tab separ
-00019ae0: 6174 6564 2061 6e64 2063 6f6c 756d 6e73  ated and columns
-00019af0: 206e 616d 6573 206d 7573 7420 6571 7561   names must equa
-00019b00: 6c20 6974 656d 2066 6965 6c64 206e 616d  l item field nam
-00019b10: 6573 2222 220a 2020 2020 2020 2020 746d  es""".        tm
-00019b20: 705f 6461 7461 203d 206d 6971 7466 2e74  p_data = miqtf.t
-00019b30: 6162 4669 6c65 4461 7461 2866 696c 652c  abFileData(file,
-00019b40: 2063 6f6c 732b 5b27 696d 6167 652d 6669   cols+['image-fi
-00019b50: 6c65 6e61 6d65 275d 2b6f 7074 696f 6e61  lename']+optiona
-00019b60: 6c2c 206b 6579 5f63 6f6c 3d27 696d 6167  l, key_col='imag
-00019b70: 652d 6669 6c65 6e61 6d65 272c 206f 7074  e-filename', opt
-00019b80: 696f 6e61 6c3d 6f70 7469 6f6e 616c 2c63  ional=optional,c
-00019b90: 6f6e 7665 7274 3d54 7275 6529 0a20 2020  onvert=True).   
-00019ba0: 2020 2020 2073 656c 662e 7772 6974 6550       self.writeP
-00019bb0: 6172 7365 6444 6174 6154 6f49 7465 6d73  arsedDataToItems
-00019bc0: 2874 6d70 5f64 6174 612c 6974 656d 732c  (tmp_data,items,
-00019bd0: 7365 6c66 2e69 6664 6f5f 746d 705b 6d69  self.ifdo_tmp[mi
-00019be0: 7174 762e 696d 6167 655f 7365 745f 6865  qtv.image_set_he
-00019bf0: 6164 6572 5f6b 6579 5d2c 2064 6174 6574  ader_key], datet
-00019c00: 696d 655f 666f 726d 6174 3d64 6174 6574  ime_format=datet
-00019c10: 696d 655f 666f 726d 6174 290a 0a0a 2020  ime_format)...  
-00019c20: 2020 6465 6620 7072 6173 6549 7465 6d44    def praseItemD
-00019c30: 6174 6146 726f 6d46 696c 6528 7365 6c66  ataFromFile(self
-00019c40: 2c69 7465 6d73 3a64 6963 742c 6669 6c65  ,items:dict,file
-00019c50: 3a73 7472 2c73 6570 6172 6174 6f72 3a73  :str,separator:s
-00019c60: 7472 2c68 6561 6465 723a 6469 6374 2c20  tr,header:dict, 
-00019c70: 6461 7465 7469 6d65 5f66 6f72 6d61 743a  datetime_format:
-00019c80: 7374 723d 6d69 7174 762e 6461 7465 5f66  str=miqtv.date_f
-00019c90: 6f72 6d61 7473 5b27 6d61 7269 7174 275d  ormats['mariqt']
-00019ca0: 293a 0a20 2020 2020 2020 2022 2222 2070  ):.        """ p
-00019cb0: 6172 7365 7320 6461 7461 2066 726f 6d20  arses data from 
-00019cc0: 6672 6f6d 2066 696c 6520 746f 2069 7465  from file to ite
-00019cd0: 6d73 2e20 6865 6164 6572 2064 6963 7420  ms. header dict 
-00019ce0: 6d75 7374 2062 6520 6f66 2073 7472 7563  must be of struc
-00019cf0: 7475 7265 3a20 7b3c 6974 656d 2d66 6965  ture: {<item-fie
-00019d00: 6c64 2d6e 616d 653e 3a3c 636f 6c75 6d6e  ld-name>:<column
-00019d10: 2d6e 616d 653e 7d0a 2020 2020 2020 2020  -name>}.        
-00019d20: 2020 2020 616e 6420 6d75 7374 2063 6f6e      and must con
-00019d30: 7461 696e 2065 6e74 7279 2027 696d 6167  tain entry 'imag
-00019d40: 652d 6669 6c65 6e61 6d65 2720 2222 220a  e-filename' """.
-00019d50: 2020 2020 2020 2020 6966 206e 6f74 2027          if not '
-00019d60: 696d 6167 652d 6669 6c65 6e61 6d65 2720  image-filename' 
-00019d70: 696e 2068 6561 6465 723a 0a20 2020 2020  in header:.     
-00019d80: 2020 2020 2020 2072 6169 7365 2045 7863         raise Exc
-00019d90: 6570 7469 6f6e 2822 6865 6164 6572 2064  eption("header d
-00019da0: 6f65 7320 6e6f 7420 636f 6e74 6169 6e20  oes not contain 
-00019db0: 2769 6d61 6765 2d66 696c 656e 616d 6527  'image-filename'
-00019dc0: 2229 0a20 2020 2020 2020 200a 2020 2020  ").        .    
-00019dd0: 2020 2020 746d 705f 6461 7461 203d 206d      tmp_data = m
-00019de0: 6971 7466 2e74 6162 4669 6c65 4461 7461  iqtf.tabFileData
-00019df0: 2866 696c 652c 2068 6561 6465 722c 636f  (file, header,co
-00019e00: 6c5f 7365 7061 7261 746f 723d 7365 7061  l_separator=sepa
-00019e10: 7261 746f 722c 206b 6579 5f63 6f6c 3d27  rator, key_col='
-00019e20: 696d 6167 652d 6669 6c65 6e61 6d65 272c  image-filename',
-00019e30: 636f 6e76 6572 743d 5472 7565 290a 2020  convert=True).  
-00019e40: 2020 2020 2020 7365 6c66 2e77 7269 7465        self.write
-00019e50: 5061 7273 6564 4461 7461 546f 4974 656d  ParsedDataToItem
-00019e60: 7328 746d 705f 6461 7461 2c69 7465 6d73  s(tmp_data,items
-00019e70: 2c73 656c 662e 6966 646f 5f74 6d70 5b6d  ,self.ifdo_tmp[m
-00019e80: 6971 7476 2e69 6d61 6765 5f73 6574 5f68  iqtv.image_set_h
-00019e90: 6561 6465 725f 6b65 795d 2c20 6461 7465  eader_key], date
-00019ea0: 7469 6d65 5f66 6f72 6d61 743d 6461 7465  time_format=date
-00019eb0: 7469 6d65 5f66 6f72 6d61 7429 0a0a 0a20  time_format)... 
-00019ec0: 2020 2064 6566 2077 7269 7465 5061 7273     def writePars
-00019ed0: 6564 4461 7461 546f 4974 656d 7328 7365  edDataToItems(se
-00019ee0: 6c66 2c64 6174 613a 6469 6374 2c69 7465  lf,data:dict,ite
-00019ef0: 6d73 3a64 6963 742c 6865 6164 6572 3a64  ms:dict,header:d
-00019f00: 6963 742c 2064 6174 6574 696d 655f 666f  ict, datetime_fo
-00019f10: 726d 6174 3a73 7472 3d6d 6971 7476 2e64  rmat:str=miqtv.d
-00019f20: 6174 655f 666f 726d 6174 735b 276d 6172  ate_formats['mar
-00019f30: 6971 7427 5d29 3a0a 0a20 2020 2020 2020  iqt']):..       
-00019f40: 2023 2065 7661 6c20 7374 7269 6e67 7320   # eval strings 
-00019f50: 6173 2064 6963 7420 6f72 206c 6973 740a  as dict or list.
-00019f60: 2020 2020 2020 2020 6d69 7174 632e 7265          miqtc.re
-00019f70: 6375 7273 6976 6545 7661 6c28 6461 7461  cursiveEval(data
-00019f80: 290a 0a20 2020 2020 2020 2023 2070 6f74  )..        # pot
-00019f90: 656e 7461 696c 6c79 2072 656d 6f76 6520  entailly remove 
-00019fa0: 636f 6e73 7420 6461 7461 2066 726f 6d20  const data from 
-00019fb0: 6974 656d 7320 616e 6420 7075 7420 696e  items and put in
-00019fc0: 2068 6561 6465 720a 2020 2020 2020 2020   header.        
-00019fd0: 7365 6c66 2e65 7874 7261 6374 436f 6e73  self.extractCons
-00019fe0: 7444 6174 6156 616c 7565 7328 6461 7461  tDataValues(data
-00019ff0: 2c68 6561 6465 7229 0a0a 2020 2020 2020  ,header)..      
-0001a000: 2020 6461 7461 203d 206d 6971 7463 2e72    data = miqtc.r
-0001a010: 6563 7572 7369 7665 6c79 5265 6d6f 7665  ecursivelyRemove
-0001a020: 456d 7074 7946 6965 6c64 7328 6461 7461  EmptyFields(data
-0001a030: 2c63 6f6e 7465 6e74 3262 6552 656d 6f76  ,content2beRemov
-0001a040: 6564 3d4e 6f6e 6529 0a0a 2020 2020 2020  ed=None)..      
-0001a050: 2020 2320 6164 6420 2769 6d61 6765 2d66    # add 'image-f
-0001a060: 696c 656e 616d 6527 2066 6965 6c64 0a20  ilename' field. 
-0001a070: 2020 2020 2020 2066 6f72 2069 6d67 2c20         for img, 
-0001a080: 656e 7472 7920 696e 2064 6174 612e 6974  entry in data.it
-0001a090: 656d 7328 293a 0a0a 2020 2020 2020 2020  ems():..        
-0001a0a0: 2020 2020 2320 6c69 7374 0a20 2020 2020      # list.     
-0001a0b0: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-0001a0c0: 616e 6365 2865 6e74 7279 2c6c 6973 7429  ance(entry,list)
-0001a0d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001a0e0: 2020 666f 7220 6c69 7374 4974 656d 2069    for listItem i
-0001a0f0: 6e20 656e 7472 793a 0a20 2020 2020 2020  n entry:.       
-0001a100: 2020 2020 2020 2020 2020 2020 206c 6973               lis
-0001a110: 7449 7465 6d5b 2769 6d61 6765 2d66 696c  tItem['image-fil
-0001a120: 656e 616d 6527 5d20 3d20 696d 670a 2020  ename'] = img.  
-0001a130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a140: 2020 2320 636f 7665 7274 2064 6174 6574    # covert datet
-0001a150: 696d 6520 7374 7269 6e67 0a20 2020 2020  ime string.     
-0001a160: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001a170: 6620 2769 6d61 6765 2d64 6174 6574 696d  f 'image-datetim
-0001a180: 6527 2069 6e20 6c69 7374 4974 656d 3a0a  e' in listItem:.
-0001a190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a1a0: 2020 2020 2020 2020 6474 203d 2064 6174          dt = dat
-0001a1b0: 6574 696d 652e 6461 7465 7469 6d65 2e73  etime.datetime.s
-0001a1c0: 7472 7074 696d 6528 6c69 7374 4974 656d  trptime(listItem
-0001a1d0: 5b27 696d 6167 652d 6461 7465 7469 6d65  ['image-datetime
-0001a1e0: 275d 2c20 6461 7465 7469 6d65 5f66 6f72  '], datetime_for
-0001a1f0: 6d61 7429 0a20 2020 2020 2020 2020 2020  mat).           
-0001a200: 2020 2020 2020 2020 2020 2020 206c 6973               lis
-0001a210: 7449 7465 6d5b 2769 6d61 6765 2d64 6174  tItem['image-dat
-0001a220: 6574 696d 6527 5d20 3d20 6474 2e73 7472  etime'] = dt.str
-0001a230: 6674 696d 6528 6d69 7174 762e 6461 7465  ftime(miqtv.date
-0001a240: 5f66 6f72 6d61 7473 5b27 6d61 7269 7174  _formats['mariqt
-0001a250: 275d 290a 2020 2020 2020 2020 2020 2020  ']).            
-0001a260: 656c 6966 2069 7369 6e73 7461 6e63 6528  elif isinstance(
-0001a270: 656e 7472 792c 6469 6374 293a 0a20 2020  entry,dict):.   
-0001a280: 2020 2020 2020 2020 2020 2020 2065 6e74               ent
-0001a290: 7279 5b27 696d 6167 652d 6669 6c65 6e61  ry['image-filena
-0001a2a0: 6d65 275d 203d 2069 6d67 0a20 2020 2020  me'] = img.     
-0001a2b0: 2020 2020 2020 2020 2020 2023 2063 6f76             # cov
-0001a2c0: 6572 7420 6461 7465 7469 6d65 2073 7472  ert datetime str
-0001a2d0: 696e 670a 2020 2020 2020 2020 2020 2020  ing.            
-0001a2e0: 2020 2020 6966 2027 696d 6167 652d 6461      if 'image-da
-0001a2f0: 7465 7469 6d65 2720 696e 2065 6e74 7279  tetime' in entry
-0001a300: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001a310: 2020 2020 2020 6474 203d 2064 6174 6574        dt = datet
-0001a320: 696d 652e 6461 7465 7469 6d65 2e73 7472  ime.datetime.str
-0001a330: 7074 696d 6528 656e 7472 795b 2769 6d61  ptime(entry['ima
-0001a340: 6765 2d64 6174 6574 696d 6527 5d2c 2064  ge-datetime'], d
-0001a350: 6174 6574 696d 655f 666f 726d 6174 290a  atetime_format).
-0001a360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a370: 2020 2020 656e 7472 795b 2769 6d61 6765      entry['image
-0001a380: 2d64 6174 6574 696d 6527 5d20 3d20 6474  -datetime'] = dt
-0001a390: 2e73 7472 6674 696d 6528 6d69 7174 762e  .strftime(miqtv.
+00017330: 2020 2020 2020 2069 6620 2770 6974 6368         if 'pitch
+00017340: 2720 696e 2020 7265 636f 7264 7332 6265  ' in  records2be
+00017350: 496e 7665 7274 6564 3a0a 2020 2020 2020  Inverted:.      
+00017360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017370: 2020 2020 2020 6174 7469 7475 6465 735b        attitudes[
+00017380: 695d 2e70 6974 6368 202a 3d20 2d31 0a20  i].pitch *= -1. 
+00017390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000173a0: 2020 2020 2020 2069 6620 2772 6f6c 6c27         if 'roll'
+000173b0: 2069 6e20 2072 6563 6f72 6473 3262 6549   in  records2beI
+000173c0: 6e76 6572 7465 643a 0a20 2020 2020 2020  nverted:.       
+000173d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000173e0: 2020 2020 2061 7474 6974 7564 6573 5b69       attitudes[i
+000173f0: 5d2e 726f 6c6c 202a 3d20 2d31 0a0a 2020  ].roll *= -1..  
+00017400: 2020 2020 2020 2020 2020 2320 6669 6e64            # find
+00017410: 2066 6f72 2065 6163 6820 696d 6167 6520   for each image 
+00017420: 7468 6520 7265 7370 6563 7469 7665 206e  the respective n
+00017430: 6176 6967 6174 696f 6e20 6461 7461 0a20  avigation data. 
+00017440: 2020 2020 2020 2020 2020 2073 7563 6365             succe
+00017450: 7373 2c20 696d 6167 655f 6474 735f 6174  ss, image_dts_at
+00017460: 742c 206d 7367 203d 2073 656c 662e 6669  t, msg = self.fi
+00017470: 6e64 4e61 7644 6174 6146 6f72 496d 6167  ndNavDataForImag
+00017480: 6528 6174 745f 6461 7461 2c76 6964 656f  e(att_data,video
+00017490: 5361 6d70 6c65 5365 636f 6e64 7329 0a20  SampleSeconds). 
+000174a0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000174b0: 7072 6f76 2e6c 6f67 286d 7367 2c64 6f6e  prov.log(msg,don
+000174c0: 7453 686f 773d 5472 7565 290a 2020 2020  tShow=True).    
+000174d0: 2020 2020 2020 2020 6966 206d 7367 2021          if msg !
+000174e0: 3d20 2222 3a0a 2020 2020 2020 2020 2020  = "":.          
+000174f0: 2020 2020 2020 7265 7475 726e 4d73 6720        returnMsg 
+00017500: 2b3d 2022 5c6e 2220 2b20 6d73 670a 2020  += "\n" + msg.  
+00017510: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+00017520: 2073 7563 6365 7373 3a0a 2020 2020 2020   success:.      
+00017530: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00017540: 2046 616c 7365 2c20 7265 7475 726e 4d73   False, returnMs
+00017550: 670a 0a20 2020 2020 2020 2020 2020 2023  g..            #
+00017560: 2063 6f6d 7065 6e73 6174 650a 2020 2020   compensate.    
+00017570: 2020 2020 2020 2020 666f 7220 6669 6c65          for file
+00017580: 2069 6e20 696d 6167 655f 6474 733a 0a20   in image_dts:. 
+00017590: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000175a0: 6f73 6974 696f 6e73 203d 2069 6d61 6765  ositions = image
+000175b0: 5f64 7473 5b66 696c 655d 0a20 2020 2020  _dts[file].     
+000175c0: 2020 2020 2020 2020 2020 2061 7474 6974             attit
+000175d0: 7564 6573 203d 2069 6d61 6765 5f64 7473  udes = image_dts
+000175e0: 5f61 7474 5b66 696c 655d 0a20 2020 2020  _att[file].     
+000175f0: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
+00017600: 2069 6e20 7261 6e67 6528 6c65 6e28 706f   in range(len(po
+00017610: 7369 7469 6f6e 7329 293a 0a20 2020 2020  sitions)):.     
+00017620: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+00017630: 6174 203d 2070 6f73 6974 696f 6e73 5b69  at = positions[i
+00017640: 5d2e 6c61 740a 2020 2020 2020 2020 2020  ].lat.          
+00017650: 2020 2020 2020 2020 2020 6c6f 6e20 3d20            lon = 
+00017660: 706f 7369 7469 6f6e 735b 695d 2e6c 6f6e  positions[i].lon
+00017670: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017680: 2020 2020 2064 6570 203d 2070 6f73 6974       dep = posit
+00017690: 696f 6e73 5b69 5d2e 6465 700a 2020 2020  ions[i].dep.    
+000176a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000176b0: 7961 7720 3d20 6174 7469 7475 6465 735b  yaw = attitudes[
+000176c0: 695d 2e79 6177 0a20 2020 2020 2020 2020  i].yaw.         
+000176d0: 2020 2020 2020 2020 2020 2070 6974 6368             pitch
+000176e0: 203d 2061 7474 6974 7564 6573 5b69 5d2e   = attitudes[i].
+000176f0: 7069 7463 680a 2020 2020 2020 2020 2020  pitch.          
+00017700: 2020 2020 2020 2020 2020 726f 6c6c 203d            roll =
+00017710: 2061 7474 6974 7564 6573 5b69 5d2e 726f   attitudes[i].ro
+00017720: 6c6c 0a20 2020 2020 2020 2020 2020 2020  ll.             
+00017730: 2020 2020 2020 2069 6620 7961 7720 6973         if yaw is
+00017740: 204e 6f6e 6520 6f72 2070 6974 6368 2069   None or pitch i
+00017750: 7320 4e6f 6e65 206f 7220 726f 6c6c 2069  s None or roll i
+00017760: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+00017770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017780: 636f 6e74 696e 7565 0a20 2020 2020 2020  continue.       
+00017790: 2020 2020 2020 2020 2020 2020 206e 6577               new
+000177a0: 5f6c 6174 2c6e 6577 5f6c 6f6e 2c6e 6577  _lat,new_lon,new
+000177b0: 5f64 6570 203d 206d 6971 7467 2e61 6464  _dep = miqtg.add
+000177c0: 4c65 7665 7261 726d 7332 4c61 746c 6f6e  Leverarms2Latlon
+000177d0: 286c 6174 2c6c 6f6e 2c64 6570 2c6f 6666  (lat,lon,dep,off
+000177e0: 7365 745f 782c 6f66 6673 6574 5f79 2c6f  set_x,offset_y,o
+000177f0: 6666 7365 745f 7a2c 7961 772c 7069 7463  ffset_z,yaw,pitc
+00017800: 682c 726f 6c6c 290a 2020 2020 2020 2020  h,roll).        
+00017810: 2020 2020 2020 2020 2020 2020 706f 7369              posi
+00017820: 7469 6f6e 735b 695d 2e6c 6174 203d 206e  tions[i].lat = n
+00017830: 6577 5f6c 6174 0a20 2020 2020 2020 2020  ew_lat.         
+00017840: 2020 2020 2020 2020 2020 2070 6f73 6974             posit
+00017850: 696f 6e73 5b69 5d2e 6c6f 6e20 3d20 6e65  ions[i].lon = ne
+00017860: 775f 6c6f 6e0a 2020 2020 2020 2020 2020  w_lon.          
+00017870: 2020 2020 2020 2020 2020 706f 7369 7469            positi
+00017880: 6f6e 735b 695d 2e64 6570 203d 206e 6577  ons[i].dep = new
+00017890: 5f64 6570 0a0a 2020 2020 2020 2020 2020  _dep..          
+000178a0: 2020 7365 6c66 2e70 726f 762e 6c6f 6728    self.prov.log(
+000178b0: 2261 7070 6c69 6564 206c 6576 6572 2061  "applied lever a
+000178c0: 726d 2063 6f6d 7065 6e73 6174 696f 6e20  rm compensation 
+000178d0: 782c 792c 7a20 3d20 2220 2b20 7374 7228  x,y,z = " + str(
+000178e0: 6f66 6673 6574 5f78 2920 2b20 222c 2220  offset_x) + "," 
+000178f0: 2b20 7374 7228 6f66 6673 6574 5f79 2920  + str(offset_y) 
+00017900: 2b20 222c 2220 2b20 7374 7228 6f66 6673  + "," + str(offs
+00017910: 6574 5f7a 292c 646f 6e74 5368 6f77 3d54  et_z),dontShow=T
+00017920: 7275 6529 0a0a 2020 2020 2020 2020 6966  rue)..        if
+00017930: 206c 656e 2869 6d61 6765 5f64 7473 2920   len(image_dts) 
+00017940: 3e20 303a 0a20 2020 2020 2020 2020 2020  > 0:.           
+00017950: 2023 2043 6865 636b 2077 6865 7468 6572   # Check whether
+00017960: 2064 6570 7468 2061 6e64 2068 6569 6768   depth and heigh
+00017970: 7420 6172 6520 7365 740a 2020 2020 2020  t are set.      
+00017980: 2020 2020 2020 6c61 745f 6964 656e 7469        lat_identi
+00017990: 6361 6c2c 206c 6f6e 5f69 6465 6e74 6963  cal, lon_identic
+000179a0: 616c 2c20 6465 705f 6964 656e 7469 6361  al, dep_identica
+000179b0: 6c2c 2068 6774 5f69 6465 6e74 6963 616c  l, hgt_identical
+000179c0: 2c20 6465 705f 6e6f 745f 7a65 726f 2c20  , dep_not_zero, 
+000179d0: 6867 745f 6e6f 745f 7a65 726f 2c75 6e63  hgt_not_zero,unc
+000179e0: 6572 745f 6e6f 745f 7a65 726f 203d 206e  ert_not_zero = n
+000179f0: 6176 5f64 6174 612e 6368 6563 6b50 6f73  av_data.checkPos
+00017a00: 6974 696f 6e73 436f 6e74 656e 7428 290a  itionsContent().
+00017a10: 0a20 2020 2020 2020 2020 2020 2023 2057  .            # W
+00017a20: 7269 7465 2074 6f20 6e61 7669 6761 7469  rite to navigati
+00017a30: 6f6e 2074 7874 2066 696c 650a 2020 2020  on txt file.    
+00017a40: 2020 2020 2020 2020 2320 6865 6164 6572          # header
+00017a50: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+00017a60: 203d 206f 7065 6e28 7365 6c66 2e67 6574   = open(self.get
+00017a70: 5f69 6e74 5f6e 6176 5f66 696c 6528 292c  _int_nav_file(),
+00017a80: 2022 7722 290a 2020 2020 2020 2020 2020   "w").          
+00017a90: 2020 7265 732e 7772 6974 6528 6d69 7174    res.write(miqt
+00017aa0: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
+00017ab0: 7269 7174 275d 5b27 696d 6727 5d2b 225c  riqt']['img']+"\
+00017ac0: 7422 2b6d 6971 7476 2e63 6f6c 5f68 6561  t"+miqtv.col_hea
+00017ad0: 6465 725b 276d 6172 6971 7427 5d5b 2775  der['mariqt']['u
+00017ae0: 7463 275d 290a 0a20 2020 2020 2020 2020  tc'])..         
+00017af0: 2020 2068 6173 5f61 6c74 203d 2054 7275     has_alt = Tru
+00017b00: 6520 6966 2064 6570 5f6e 6f74 5f7a 6572  e if dep_not_zer
+00017b10: 6f20 616e 6420 2820 2764 6570 2720 696e  o and ( 'dep' in
+00017b20: 206e 6176 5f68 6561 6465 7220 6f72 2027   nav_header or '
+00017b30: 616c 7427 2069 6e20 6e61 765f 6865 6164  alt' in nav_head
+00017b40: 6572 2029 2065 6c73 6520 4661 6c73 650a  er ) else False.
+00017b50: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00017b60: 276c 6174 2720 696e 206e 6176 5f68 6561  'lat' in nav_hea
+00017b70: 6465 723a 0a20 2020 2020 2020 2020 2020  der:.           
+00017b80: 2020 2020 2072 6573 2e77 7269 7465 2822       res.write("
+00017b90: 5c74 222b 6d69 7174 762e 636f 6c5f 6865  \t"+miqtv.col_he
+00017ba0: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
+00017bb0: 6c61 7427 5d29 0a20 2020 2020 2020 2020  lat']).         
+00017bc0: 2020 2069 6620 276c 6f6e 2720 696e 206e     if 'lon' in n
+00017bd0: 6176 5f68 6561 6465 723a 0a20 2020 2020  av_header:.     
+00017be0: 2020 2020 2020 2020 2020 2072 6573 2e77             res.w
+00017bf0: 7269 7465 2822 5c74 222b 6d69 7174 762e  rite("\t"+miqtv.
+00017c00: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
+00017c10: 7174 275d 5b27 6c6f 6e27 5d29 0a20 2020  qt']['lon']).   
+00017c20: 2020 2020 2020 2020 2069 6620 6861 735f           if has_
+00017c30: 616c 743a 0a20 2020 2020 2020 2020 2020  alt:.           
+00017c40: 2020 2020 2072 6573 2e77 7269 7465 2822       res.write("
+00017c50: 5c74 222b 6d69 7174 762e 636f 6c5f 6865  \t"+miqtv.col_he
+00017c60: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
+00017c70: 616c 7427 5d29 0a20 2020 2020 2020 2020  alt']).         
+00017c80: 2020 2069 6620 6867 745f 6e6f 745f 7a65     if hgt_not_ze
+00017c90: 726f 2061 6e64 2027 6867 7427 2069 6e20  ro and 'hgt' in 
+00017ca0: 6e61 765f 6865 6164 6572 3a0a 2020 2020  nav_header:.    
+00017cb0: 2020 2020 2020 2020 2020 2020 7265 732e              res.
+00017cc0: 7772 6974 6528 225c 7422 2b6d 6971 7476  write("\t"+miqtv
+00017cd0: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
+00017ce0: 6971 7427 5d5b 2768 6774 275d 290a 2020  iqt']['hgt']).  
+00017cf0: 2020 2020 2020 2020 2020 6966 2075 6e63            if unc
+00017d00: 6572 745f 6e6f 745f 7a65 726f 2061 6e64  ert_not_zero and
+00017d10: 2027 756e 6365 7274 2720 696e 206e 6176   'uncert' in nav
+00017d20: 5f68 6561 6465 723a 0a20 2020 2020 2020  _header:.       
+00017d30: 2020 2020 2020 2020 2072 6573 2e77 7269           res.wri
+00017d40: 7465 2822 5c74 222b 6d69 7174 762e 636f  te("\t"+miqtv.co
+00017d50: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
+00017d60: 275d 5b27 756e 6365 7274 275d 290a 2020  ']['uncert']).  
+00017d70: 2020 2020 2020 2020 2020 7265 732e 7772            res.wr
+00017d80: 6974 6528 225c 6e22 290a 2020 2020 2020  ite("\n").      
+00017d90: 2020 2020 2020 2320 6461 7461 206c 696e        # data lin
+00017da0: 6573 0a20 2020 2020 2020 2020 2020 2066  es.            f
+00017db0: 6f72 2066 696c 6520 696e 2069 6d61 6765  or file in image
+00017dc0: 5f64 7473 3a0a 2020 2020 2020 2020 2020  _dts:.          
+00017dd0: 2020 2020 2020 666f 7220 7469 6d65 706f        for timepo
+00017de0: 696e 7420 696e 2069 6d61 6765 5f64 7473  int in image_dts
+00017df0: 5b66 696c 655d 3a0a 2020 2020 2020 2020  [file]:.        
+00017e00: 2020 2020 2020 2020 2020 2020 7265 732e              res.
+00017e10: 7772 6974 6528 6669 6c65 2b22 5c74 222b  write(file+"\t"+
+00017e20: 7469 6d65 706f 696e 742e 6461 7465 5469  timepoint.dateTi
+00017e30: 6d65 2829 2e73 7472 6674 696d 6528 6d69  me().strftime(mi
+00017e40: 7174 762e 6461 7465 5f66 6f72 6d61 7473  qtv.date_formats
+00017e50: 5b27 6d61 7269 7174 275d 2929 200a 2020  ['mariqt'])) .  
+00017e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017e70: 2020 6966 2027 6c61 7427 2069 6e20 6e61    if 'lat' in na
+00017e80: 765f 6865 6164 6572 3a0a 2020 2020 2020  v_header:.      
+00017e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017ea0: 2020 7661 6c20 3d20 7469 6d65 706f 696e    val = timepoin
+00017eb0: 742e 6c61 740a 2020 2020 2020 2020 2020  t.lat.          
+00017ec0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00017ed0: 732e 7772 6974 6528 225c 7422 2b73 7472  s.write("\t"+str
+00017ee0: 2876 616c 2929 0a20 2020 2020 2020 2020  (val)).         
+00017ef0: 2020 2020 2020 2020 2020 2069 6620 276c             if 'l
+00017f00: 6f6e 2720 696e 206e 6176 5f68 6561 6465  on' in nav_heade
+00017f10: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
+00017f20: 2020 2020 2020 2020 2020 2076 616c 203d             val =
+00017f30: 2074 696d 6570 6f69 6e74 2e6c 6f6e 0a20   timepoint.lon. 
+00017f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017f50: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
+00017f60: 2822 5c74 222b 7374 7228 7661 6c29 290a  ("\t"+str(val)).
+00017f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017f80: 2020 2020 6966 2068 6173 5f61 6c74 3a0a      if has_alt:.
+00017f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017fa0: 2020 2020 2020 2020 7661 6c20 3d20 7469          val = ti
+00017fb0: 6d65 706f 696e 742e 6465 700a 2020 2020  mepoint.dep.    
+00017fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017fd0: 2020 2020 2320 6465 7020 746f 2061 6c74      # dep to alt
+00017fe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017ff0: 2020 2020 2020 2020 2076 616c 202a 3d20           val *= 
+00018000: 2d31 0a20 2020 2020 2020 2020 2020 2020  -1.             
+00018010: 2020 2020 2020 2020 2020 2072 6573 2e77             res.w
+00018020: 7269 7465 2822 5c74 222b 7374 7228 7661  rite("\t"+str(va
+00018030: 6c29 290a 2020 2020 2020 2020 2020 2020  l)).            
+00018040: 2020 2020 2020 2020 6966 2068 6774 5f6e          if hgt_n
+00018050: 6f74 5f7a 6572 6f20 616e 6420 2768 6774  ot_zero and 'hgt
+00018060: 2720 696e 206e 6176 5f68 6561 6465 723a  ' in nav_header:
+00018070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018080: 2020 2020 2020 2020 2076 616c 203d 2074           val = t
+00018090: 696d 6570 6f69 6e74 2e68 6774 0a20 2020  imepoint.hgt.   
+000180a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000180b0: 2020 2020 2072 6573 2e77 7269 7465 2822       res.write("
+000180c0: 5c74 222b 7374 7228 7661 6c29 290a 2020  \t"+str(val)).  
+000180d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000180e0: 2020 6966 2075 6e63 6572 745f 6e6f 745f    if uncert_not_
+000180f0: 7a65 726f 2061 6e64 2027 756e 6365 7274  zero and 'uncert
+00018100: 2720 696e 206e 6176 5f68 6561 6465 723a  ' in nav_header:
+00018110: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018120: 2020 2020 2020 2020 2076 616c 203d 2074           val = t
+00018130: 696d 6570 6f69 6e74 2e75 6e63 6572 740a  imepoint.uncert.
+00018140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018150: 2020 2020 2020 2020 7265 732e 7772 6974          res.writ
+00018160: 6528 225c 7422 2b73 7472 2876 616c 2929  e("\t"+str(val))
+00018170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018180: 2020 2020 2072 6573 2e77 7269 7465 2822       res.write("
+00018190: 5c6e 2229 0a20 2020 2020 2020 2020 2020  \n").           
+000181a0: 2072 6573 2e63 6c6f 7365 2829 0a0a 2020   res.close()..  
+000181b0: 2020 2020 2020 2020 2020 2320 5772 6974            # Writ
+000181c0: 6520 746f 2067 656f 6a73 6f6e 2066 696c  e to geojson fil
+000181d0: 650a 2020 2020 2020 2020 2020 2020 6765  e.            ge
+000181e0: 6f6a 736f 6e20 3d20 7b27 7479 7065 273a  ojson = {'type':
+000181f0: 2027 4665 6174 7572 6543 6f6c 6c65 6374   'FeatureCollect
+00018200: 696f 6e27 2c20 276e 616d 6527 3a20 7365  ion', 'name': se
+00018210: 6c66 2e64 6972 2e65 7665 6e74 2829 2b22  lf.dir.event()+"
+00018220: 5f22 2b73 656c 662e 6469 722e 7365 6e73  _"+self.dir.sens
+00018230: 6f72 2829 2b22 5f69 6d61 6765 2d6e 6176  or()+"_image-nav
+00018240: 6967 6174 696f 6e22 2c20 2766 6561 7475  igation", 'featu
+00018250: 7265 7327 3a20 5b5d 7d0a 2020 2020 2020  res': []}.      
+00018260: 2020 2020 2020 666f 7220 6669 6c65 2069        for file i
+00018270: 6e20 696d 6167 655f 6474 733a 0a20 2020  n image_dts:.   
+00018280: 2020 2020 2020 2020 2020 2020 2023 2070               # p
+00018290: 686f 746f 0a20 2020 2020 2020 2020 2020  hoto.           
+000182a0: 2020 2020 2069 6620 6c65 6e28 696d 6167       if len(imag
+000182b0: 655f 6474 735b 6669 6c65 5d29 203d 3d20  e_dts[file]) == 
+000182c0: 313a 0a20 2020 2020 2020 2020 2020 2020  1:.             
+000182d0: 2020 2020 2020 2069 6620 6465 705f 6e6f         if dep_no
+000182e0: 745f 7a65 726f 3a0a 2020 2020 2020 2020  t_zero:.        
+000182f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018300: 6765 6f6d 6574 7279 203d 2020 7b27 7479  geometry =  {'ty
+00018310: 7065 273a 2022 506f 696e 7422 2c20 2763  pe': "Point", 'c
+00018320: 6f6f 7264 696e 6174 6573 273a 200a 2020  oordinates': .  
+00018330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018350: 2020 2020 2020 5b66 6c6f 6174 2869 6d61        [float(ima
+00018360: 6765 5f64 7473 5b66 696c 655d 5b30 5d2e  ge_dts[file][0].
+00018370: 6c6f 6e29 2c20 666c 6f61 7428 696d 6167  lon), float(imag
+00018380: 655f 6474 735b 6669 6c65 5d5b 305d 2e6c  e_dts[file][0].l
+00018390: 6174 292c 2066 6c6f 6174 2869 6d61 6765  at), float(image
+000183a0: 5f64 7473 5b66 696c 655d 5b30 5d2e 6465  _dts[file][0].de
+000183b0: 7029 5d0a 2020 2020 2020 2020 2020 2020  p)].            
+000183c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000183d0: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
+000183e0: 2020 2020 2020 2020 2020 2020 2020 656c                el
+000183f0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00018400: 2020 2020 2020 2020 2020 2020 6765 6f6d              geom
+00018410: 6574 7279 203d 2020 7b27 7479 7065 273a  etry =  {'type':
+00018420: 2022 506f 696e 7422 2c20 2763 6f6f 7264   "Point", 'coord
+00018430: 696e 6174 6573 273a 200a 2020 2020 2020  inates': .      
+00018440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018460: 2020 5b66 6c6f 6174 2869 6d61 6765 5f64    [float(image_d
+00018470: 7473 5b66 696c 655d 5b30 5d2e 6c6f 6e29  ts[file][0].lon)
+00018480: 2c20 666c 6f61 7428 696d 6167 655f 6474  , float(image_dt
+00018490: 735b 6669 6c65 5d5b 305d 2e6c 6174 295d  s[file][0].lat)]
+000184a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000184b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000184c0: 2020 2020 207d 0a20 2020 2020 2020 2020       }.         
+000184d0: 2020 2020 2020 2020 2020 2069 6620 5472             if Tr
+000184e0: 7565 2069 6e20 5b6d 6174 682e 6973 6e61  ue in [math.isna
+000184f0: 6e28 7829 2066 6f72 2078 2069 6e20 6765  n(x) for x in ge
+00018500: 6f6d 6574 7279 5b27 636f 6f72 6469 6e61  ometry['coordina
+00018510: 7465 7327 5d5d 3a0a 2020 2020 2020 2020  tes']]:.        
+00018520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018530: 636f 6e74 696e 7565 0a0a 2020 2020 2020  continue..      
+00018540: 2020 2020 2020 2020 2020 2320 7669 6465            # vide
+00018550: 6f0a 2020 2020 2020 2020 2020 2020 2020  o.              
+00018560: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00018570: 2020 2020 2020 2020 2020 2020 6966 2064              if d
+00018580: 6570 5f6e 6f74 5f7a 6572 6f3a 0a20 2020  ep_not_zero:.   
+00018590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000185a0: 2020 2020 2067 656f 6d65 7472 7920 3d20       geometry = 
+000185b0: 207b 2774 7970 6527 3a20 224d 756c 7469   {'type': "Multi
+000185c0: 506f 696e 7422 2c20 2763 6f6f 7264 696e  Point", 'coordin
+000185d0: 6174 6573 273a 0a20 2020 2020 2020 2020  ates':.         
+000185e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000185f0: 2020 2020 2020 2020 2020 2020 2020 205b                 [
+00018600: 5b66 6c6f 6174 2864 2e6c 6f6e 292c 2066  [float(d.lon), f
+00018610: 6c6f 6174 2864 2e6c 6174 292c 2066 6c6f  loat(d.lat), flo
+00018620: 6174 2864 2e64 6570 295d 2066 6f72 2064  at(d.dep)] for d
+00018630: 2069 6e20 696d 6167 655f 6474 735b 6669   in image_dts[fi
+00018640: 6c65 5d5d 0a20 2020 2020 2020 2020 2020  le]].           
+00018650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018660: 2020 2020 2020 2020 207d 0a20 2020 2020           }.     
+00018670: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00018680: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00018690: 2020 2020 2020 2020 2020 2020 2067 656f               geo
+000186a0: 6d65 7472 7920 3d20 207b 2774 7970 6527  metry =  {'type'
+000186b0: 3a20 224d 756c 7469 506f 696e 7422 2c20  : "MultiPoint", 
+000186c0: 2763 6f6f 7264 696e 6174 6573 273a 0a20  'coordinates':. 
+000186d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000186e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000186f0: 2020 2020 2020 205b 5b66 6c6f 6174 2864         [[float(d
+00018700: 2e6c 6f6e 292c 2066 6c6f 6174 2864 2e6c  .lon), float(d.l
+00018710: 6174 295d 2066 6f72 2064 2069 6e20 696d  at)] for d in im
+00018720: 6167 655f 6474 735b 6669 6c65 5d5d 0a20  age_dts[file]]. 
+00018730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018750: 2020 207d 0a20 2020 2020 2020 2020 2020     }.           
+00018760: 2020 2020 2020 2020 2069 6620 5472 7565           if True
+00018770: 2069 6e20 5b6d 6174 682e 6973 6e61 6e28   in [math.isnan(
+00018780: 7829 2066 6f72 2078 2069 6e20 5b69 7465  x) for x in [ite
+00018790: 6d20 666f 7220 7375 626c 6973 7420 696e  m for sublist in
+000187a0: 2067 656f 6d65 7472 795b 2763 6f6f 7264   geometry['coord
+000187b0: 696e 6174 6573 275d 2066 6f72 2069 7465  inates'] for ite
+000187c0: 6d20 696e 2073 7562 6c69 7374 5d5d 3a0a  m in sublist]]:.
+000187d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000187e0: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
+000187f0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00018800: 2020 6765 6f6a 736f 6e5b 2766 6561 7475    geojson['featu
+00018810: 7265 7327 5d2e 6170 7065 6e64 287b 2774  res'].append({'t
+00018820: 7970 6527 3a20 2746 6561 7475 7265 272c  ype': 'Feature',
+00018830: 2027 7072 6f70 6572 7469 6573 273a 207b   'properties': {
+00018840: 2769 6427 3a20 6669 6c65 7d2c 2027 6765  'id': file}, 'ge
+00018850: 6f6d 6574 7279 273a 2067 656f 6d65 7472  ometry': geometr
+00018860: 7920 7d29 0a20 2020 2020 2020 2020 2020  y }).           
+00018870: 2020 2020 200a 2020 2020 2020 2020 2020       .          
+00018880: 2020 6f20 3d20 6f70 656e 2873 656c 662e    o = open(self.
+00018890: 6765 745f 696e 745f 6e61 765f 6669 6c65  get_int_nav_file
+000188a0: 2829 2e72 6570 6c61 6365 2822 2e74 7874  ().replace(".txt
+000188b0: 222c 2022 2e67 656f 6a73 6f6e 2229 2c0a  ", ".geojson"),.
+000188c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000188d0: 2020 2020 2022 7722 2c20 6572 726f 7273       "w", errors
+000188e0: 3d22 6967 6e6f 7265 222c 2065 6e63 6f64  ="ignore", encod
+000188f0: 696e 673d 2775 7466 2d38 2729 0a20 2020  ing='utf-8').   
+00018900: 2020 2020 2020 2020 206a 736f 6e2e 6475           json.du
+00018910: 6d70 2867 656f 6a73 6f6e 2c20 6f2c 2065  mp(geojson, o, e
+00018920: 6e73 7572 655f 6173 6369 693d 4661 6c73  nsure_ascii=Fals
+00018930: 652c 2069 6e64 656e 743d 3429 0a20 2020  e, indent=4).   
+00018940: 2020 2020 2020 2020 206f 2e63 6c6f 7365           o.close
+00018950: 2829 0a0a 2020 2020 2020 2020 2020 2020  ()..            
+00018960: 7365 6c66 2e70 726f 762e 6164 6441 7267  self.prov.addArg
+00018970: 756d 656e 7428 2269 6e70 7574 4e61 7669  ument("inputNavi
+00018980: 6761 7469 6f6e 4669 6c65 222c 6e61 765f  gationFile",nav_
+00018990: 7061 7468 2c6f 7665 7277 7269 7465 3d54  path,overwrite=T
+000189a0: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
+000189b0: 2073 656c 662e 7072 6f76 2e6c 6f67 2822   self.prov.log("
+000189c0: 7061 7273 6564 2066 726f 6d20 696e 7075  parsed from inpu
+000189d0: 744e 6176 6967 6174 696f 6e46 696c 653a  tNavigationFile:
+000189e0: 2022 202b 2073 7472 286e 6176 5f68 6561   " + str(nav_hea
+000189f0: 6465 7229 2c64 6f6e 7453 686f 773d 5472  der),dontShow=Tr
+00018a00: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
+00018a10: 732e 7374 6f70 2829 0a20 2020 2020 2020  s.stop().       
+00018a20: 2020 2020 2072 6574 7572 6e20 5472 7565       return True
+00018a30: 2c20 224e 6176 6967 6174 696f 6e20 6461  , "Navigation da
+00018a40: 7461 2063 7265 6174 6564 2220 2b20 7265  ta created" + re
+00018a50: 7475 726e 4d73 670a 2020 2020 2020 2020  turnMsg.        
+00018a60: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00018a70: 2020 732e 7374 6f70 2829 0a20 2020 2020    s.stop().     
+00018a80: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
+00018a90: 6c73 652c 2022 4e6f 2069 6d61 6765 2063  lse, "No image c
+00018aa0: 6f6f 7264 696e 6174 6573 2066 6f75 6e64  oordinates found
+00018ab0: 2220 2b20 7265 7475 726e 4d73 670a 0a20  " + returnMsg.. 
+00018ac0: 2020 2064 6566 2063 7265 6174 6549 6d61     def createIma
+00018ad0: 6765 4e61 7669 6761 7469 6f6e 4669 6c65  geNavigationFile
+00018ae0: 2873 656c 662c 206e 6176 5f70 6174 683a  (self, nav_path:
+00018af0: 2073 7472 2c20 6e61 765f 6865 6164 6572   str, nav_header
+00018b00: 3d6d 6971 7476 2e70 6f73 5f68 6561 6465  =miqtv.pos_heade
+00018b10: 725b 2770 616e 6761 6561 275d 2c20 6461  r['pangaea'], da
+00018b20: 7465 5f66 6f72 6d61 743d 6d69 7174 762e  te_format=miqtv.
+00018b30: 6461 7465 5f66 6f72 6d61 7473 5b27 7061  date_formats['pa
+00018b40: 6e67 6165 6127 5d2c 206f 7665 7277 7269  ngaea'], overwri
+00018b50: 7465 3d46 616c 7365 2c20 636f 6c5f 7365  te=False, col_se
+00018b60: 7061 7261 746f 7220 3d20 225c 7422 2c20  parator = "\t", 
+00018b70: 7669 6465 6f53 616d 706c 6553 6563 6f6e  videoSampleSecon
+00018b80: 6473 3d31 2c0a 2020 2020 2020 2020 2020  ds=1,.          
+00018b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018ba0: 2020 2020 2020 2020 2020 6f66 6673 6574            offset
+00018bb0: 5f78 3d30 2c20 6f66 6673 6574 5f79 3d30  _x=0, offset_y=0
+00018bc0: 2c20 6f66 6673 6574 5f7a 3d30 2c61 6e67  , offset_z=0,ang
+00018bd0: 6c65 735f 696e 5f72 6164 203d 2046 616c  les_in_rad = Fal
+00018be0: 7365 2c20 7265 636f 7264 7332 6265 496e  se, records2beIn
+00018bf0: 7665 7274 6564 3d5b 5d29 3a0a 2020 2020  verted=[]):.    
+00018c00: 2020 2020 2222 2220 4465 7072 6563 6174      """ Deprecat
+00018c10: 6564 202d 2075 7365 2063 7265 6174 655f  ed - use create_
+00018c20: 696d 6167 655f 6e61 7669 6761 7469 6f6e  image_navigation
+00018c30: 5f66 696c 6520 2222 220a 2020 2020 2020  _file """.      
+00018c40: 2020 7265 7475 726e 2073 656c 662e 6372    return self.cr
+00018c50: 6561 7465 5f69 6d61 6765 5f6e 6176 6967  eate_image_navig
+00018c60: 6174 696f 6e5f 6669 6c65 286e 6176 5f70  ation_file(nav_p
+00018c70: 6174 682c 206e 6176 5f68 6561 6465 722c  ath, nav_header,
+00018c80: 2064 6174 655f 666f 726d 6174 2c20 6f76   date_format, ov
+00018c90: 6572 7772 6974 652c 2063 6f6c 5f73 6570  erwrite, col_sep
+00018ca0: 6172 6174 6f72 2c20 7669 6465 6f53 616d  arator, videoSam
+00018cb0: 706c 6553 6563 6f6e 6473 2c20 6f66 6673  pleSeconds, offs
+00018cc0: 6574 5f78 2c20 6f66 6673 6574 5f79 2c20  et_x, offset_y, 
+00018cd0: 6f66 6673 6574 5f7a 2c20 616e 676c 6573  offset_z, angles
+00018ce0: 5f69 6e5f 7261 642c 2072 6563 6f72 6473  _in_rad, records
+00018cf0: 3262 6549 6e76 6572 7465 6429 0a0a 0a20  2beInverted)... 
+00018d00: 2020 2064 6566 2063 7265 6174 655f 696d     def create_im
+00018d10: 6167 655f 7368 6132 3536 5f66 696c 6528  age_sha256_file(
+00018d20: 7365 6c66 2c72 6552 6561 6441 6c6c 3d54  self,reReadAll=T
+00018d30: 7275 6529 3a0a 2020 2020 2020 2020 2222  rue):.        ""
+00018d40: 2220 4372 6561 7465 7320 696e 202f 696e  " Creates in /in
+00018d50: 7465 726d 6564 6961 7465 2061 2074 6578  termediate a tex
+00018d60: 7420 6669 6c65 2063 6f6e 7461 696e 696e  t file containin
+00018d70: 6720 7065 7220 696d 6167 6520 6974 7320  g per image its 
+00018d80: 5348 4132 3536 2068 6173 682e 0a20 2020  SHA256 hash..   
+00018d90: 2020 2020 2020 2020 2049 6620 7265 5265           If reRe
+00018da0: 6164 416c 6c20 6973 2054 7275 6520 616c  adAll is True al
+00018db0: 6c20 696d 6167 6573 2720 6861 7368 6573  l images' hashes
+00018dc0: 2061 7265 2064 6574 6572 6d69 6e65 642e   are determined.
+00018dd0: 204f 7468 6572 7769 7365 206f 6e6c 7920   Otherwise only 
+00018de0: 666f 7220 7468 6f73 6520 6669 6c65 730a  for those files.
+00018df0: 2020 2020 2020 2020 2020 2020 7768 6963              whic
+00018e00: 6820 6172 6520 6e6f 7420 7965 7420 696e  h are not yet in
+00018e10: 2074 6865 2069 6e74 6572 6d65 6469 6174   the intermediat
+00018e20: 6520 6669 6c65 2063 6f6e 7461 696e 696e  e file containin
+00018e30: 6720 7468 6520 696d 6167 6520 6861 7368  g the image hash
+00018e40: 6573 2020 2222 220a 2020 2020 2020 2020  es  """.        
+00018e50: 6861 7368 6573 203d 207b 7d0a 2020 2020  hashes = {}.    
+00018e60: 2020 2020 6966 206f 732e 7061 7468 2e65      if os.path.e
+00018e70: 7869 7374 7328 7365 6c66 2e67 6574 5f69  xists(self.get_i
+00018e80: 6e74 5f68 6173 685f 6669 6c65 2829 293a  nt_hash_file()):
+00018e90: 0a20 2020 2020 2020 2020 2020 2068 6173  .            has
+00018ea0: 6865 7320 3d20 6d69 7174 662e 7461 6246  hes = miqtf.tabF
+00018eb0: 696c 6544 6174 6128 7365 6c66 2e67 6574  ileData(self.get
+00018ec0: 5f69 6e74 5f68 6173 685f 6669 6c65 2829  _int_hash_file()
+00018ed0: 2c20 5b6d 6971 7476 2e63 6f6c 5f68 6561  , [miqtv.col_hea
+00018ee0: 6465 725b 276d 6172 6971 7427 5d5b 2769  der['mariqt']['i
+00018ef0: 6d67 275d 2c20 6d69 7174 762e 636f 6c5f  mg'], miqtv.col_
+00018f00: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
+00018f10: 5b27 6861 7368 275d 5d2c 206b 6579 5f63  ['hash']], key_c
+00018f20: 6f6c 3d6d 6971 7476 2e63 6f6c 5f68 6561  ol=miqtv.col_hea
+00018f30: 6465 725b 276d 6172 6971 7427 5d5b 2769  der['mariqt']['i
+00018f40: 6d67 275d 290a 0a20 2020 2020 2020 2069  mg'])..        i
+00018f50: 6d61 6765 7349 6e52 6177 203d 2073 656c  magesInRaw = sel
+00018f60: 662e 696d 6167 6573 496e 496d 6167 6573  f.imagesInImages
+00018f70: 4469 7228 290a 2020 2020 2020 2020 6966  Dir().        if
+00018f80: 206c 656e 2869 6d61 6765 7349 6e52 6177   len(imagesInRaw
+00018f90: 2920 3e20 303a 0a0a 2020 2020 2020 2020  ) > 0:..        
+00018fa0: 2020 2020 6164 6465 645f 6861 7368 6573      added_hashes
+00018fb0: 203d 2030 0a20 2020 2020 2020 2020 2020   = 0.           
+00018fc0: 2070 726f 6720 3d20 6d69 7174 632e 5072   prog = miqtc.Pr
+00018fd0: 696e 744b 6e6f 776e 5072 6f67 7265 7373  intKnownProgress
+00018fe0: 4d73 6728 2243 6865 636b 696e 6720 6861  Msg("Checking ha
+00018ff0: 7368 6573 222c 206c 656e 2869 6d61 6765  shes", len(image
+00019000: 7349 6e52 6177 292c 6d6f 6475 6c6f 3d35  sInRaw),modulo=5
+00019010: 290a 2020 2020 2020 2020 2020 2020 666f  ).            fo
+00019020: 7220 6669 6c65 2069 6e20 696d 6167 6573  r file in images
+00019030: 496e 5261 773a 0a20 2020 2020 2020 2020  InRaw:.         
+00019040: 2020 2020 2020 2070 726f 672e 7072 6f67         prog.prog
+00019050: 7265 7373 2829 0a0a 2020 2020 2020 2020  ress()..        
+00019060: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
+00019070: 656c 662e 5f5f 616c 6c55 5549 4473 4368  elf.__allUUIDsCh
+00019080: 6563 6b65 6420 616e 6420 6e6f 7420 6d69  ecked and not mi
+00019090: 7174 692e 696d 6167 6543 6f6e 7461 696e  qti.imageContain
+000190a0: 7356 616c 6964 5555 4944 2866 696c 6529  sValidUUID(file)
+000190b0: 5b30 5d3a 0a20 2020 2020 2020 2020 2020  [0]:.           
+000190c0: 2020 2020 2020 2020 2023 2072 656d 6f76           # remov
+000190d0: 6520 6672 6f6d 2075 7569 6420 6669 6c65  e from uuid file
+000190e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000190f0: 2020 2020 2069 6620 6f73 2e70 6174 682e       if os.path.
+00019100: 6578 6973 7473 2873 656c 662e 6765 745f  exists(self.get_
+00019110: 696e 745f 7575 6964 5f66 696c 6528 2929  int_uuid_file())
+00019120: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00019130: 2020 2020 2020 2020 2020 7265 7320 3d20            res = 
+00019140: 6f70 656e 2873 656c 662e 6765 745f 696e  open(self.get_in
+00019150: 745f 7575 6964 5f66 696c 6528 292c 2022  t_uuid_file(), "
+00019160: 7222 290a 2020 2020 2020 2020 2020 2020  r").            
+00019170: 2020 2020 2020 2020 2020 2020 6c69 6e65              line
+00019180: 7320 3d20 7265 732e 7265 6164 6c69 6e65  s = res.readline
+00019190: 7328 290a 2020 2020 2020 2020 2020 2020  s().            
+000191a0: 2020 2020 2020 2020 2020 2020 7265 732e              res.
+000191b0: 636c 6f73 6528 290a 2020 2020 2020 2020  close().        
+000191c0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+000191d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000191e0: 2020 2020 2020 2020 2020 6c69 6e65 7320            lines 
+000191f0: 3d20 5b5d 0a20 2020 2020 2020 2020 2020  = [].           
+00019200: 2020 2020 2020 2020 2069 203d 2030 0a20           i = 0. 
+00019210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019220: 2020 206c 696e 654e 7220 3d20 690a 2020     lineNr = i.  
+00019230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019240: 2020 666f 7220 6c69 6e65 2069 6e20 6c69    for line in li
+00019250: 6e65 733a 0a20 2020 2020 2020 2020 2020  nes:.           
+00019260: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00019270: 6f73 2e70 6174 682e 6261 7365 6e61 6d65  os.path.basename
+00019280: 2866 696c 6529 2069 6e20 6c69 6e65 3a0a  (file) in line:.
+00019290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000192a0: 2020 2020 2020 2020 2020 2020 6c69 6e65              line
+000192b0: 4e72 203d 2069 0a20 2020 2020 2020 2020  Nr = i.         
+000192c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000192d0: 2020 2062 7265 616b 0a20 2020 2020 2020     break.       
+000192e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000192f0: 2069 202b 3d20 310a 2020 2020 2020 2020   i += 1.        
+00019300: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+00019310: 696e 654e 7220 213d 2030 3a0a 2020 2020  ineNr != 0:.    
+00019320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019330: 2020 2020 6465 6c20 6c69 6e65 735b 6c69      del lines[li
+00019340: 6e65 4e72 5d0a 2020 2020 2020 2020 2020  neNr].          
+00019350: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00019360: 7320 3d20 6f70 656e 2873 656c 662e 6765  s = open(self.ge
+00019370: 745f 696e 745f 7575 6964 5f66 696c 6528  t_int_uuid_file(
+00019380: 292c 2022 7722 290a 2020 2020 2020 2020  ), "w").        
+00019390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000193a0: 7265 732e 7772 6974 656c 696e 6573 286c  res.writelines(l
+000193b0: 696e 6573 290a 2020 2020 2020 2020 2020  ines).          
+000193c0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+000193d0: 732e 636c 6f73 6528 290a 2020 2020 2020  s.close().      
+000193e0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+000193f0: 6973 6520 4578 6365 7074 696f 6e28 2022  ise Exception( "
+00019400: 4669 6c65 2022 202b 2066 696c 6520 2b20  File " + file + 
+00019410: 2220 646f 6573 206e 6f74 2063 6f74 6169  " does not cotai
+00019420: 6e20 6120 7661 6c69 6420 5555 4944 2e20  n a valid UUID. 
+00019430: 5275 6e20 6372 6561 7465 5f75 7569 645f  Run create_uuid_
+00019440: 6669 6c65 2829 2066 6972 7374 2122 290a  file() first!").
+00019450: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019460: 2066 696c 655f 6e61 6d65 203d 206f 732e   file_name = os.
+00019470: 7061 7468 2e62 6173 656e 616d 6528 6669  path.basename(fi
+00019480: 6c65 290a 2020 2020 2020 2020 2020 2020  le).            
+00019490: 2020 2020 6966 206e 6f74 2072 6552 6561      if not reRea
+000194a0: 6441 6c6c 2061 6e64 2066 696c 655f 6e61  dAll and file_na
+000194b0: 6d65 2069 6e20 6861 7368 6573 3a0a 2020  me in hashes:.  
+000194c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000194d0: 2020 6861 7368 6573 5b66 696c 655f 6e61    hashes[file_na
+000194e0: 6d65 5d20 3d20 6861 7368 6573 5b66 696c  me] = hashes[fil
+000194f0: 655f 6e61 6d65 5d5b 6d69 7174 762e 636f  e_name][miqtv.co
+00019500: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
+00019510: 275d 5b27 6861 7368 275d 5d0a 2020 2020  ']['hash']].    
+00019520: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00019530: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00019540: 2020 2020 2020 6861 7368 6573 5b66 696c        hashes[fil
+00019550: 655f 6e61 6d65 5d20 3d20 6d69 7174 632e  e_name] = miqtc.
+00019560: 7368 6132 3536 4861 7368 4669 6c65 2866  sha256HashFile(f
+00019570: 696c 6529 0a20 2020 2020 2020 2020 2020  ile).           
+00019580: 2020 2020 2020 2020 2061 6464 6564 5f68           added_h
+00019590: 6173 6865 7320 2b3d 2031 0a20 2020 2020  ashes += 1.     
+000195a0: 2020 2020 2020 2070 726f 672e 636c 6561         prog.clea
+000195b0: 7228 290a 0a20 2020 2020 2020 2020 2020  r()..           
+000195c0: 2069 6620 7265 5265 6164 416c 6c20 6f72   if reReadAll or
+000195d0: 2061 6464 6564 5f68 6173 6865 7320 3e20   added_hashes > 
+000195e0: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
+000195f0: 2020 2068 6173 685f 6669 6c65 203d 206f     hash_file = o
+00019600: 7065 6e28 7365 6c66 2e67 6574 5f69 6e74  pen(self.get_int
+00019610: 5f68 6173 685f 6669 6c65 2829 2c20 2277  _hash_file(), "w
+00019620: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+00019630: 2020 2068 6173 685f 6669 6c65 2e77 7269     hash_file.wri
+00019640: 7465 2820 6d69 7174 762e 636f 6c5f 6865  te( miqtv.col_he
+00019650: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
+00019660: 696d 6727 5d2b 225c 7422 2b6d 6971 7476  img']+"\t"+miqtv
+00019670: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
+00019680: 6971 7427 5d5b 2768 6173 6827 5d2b 225c  iqt']['hash']+"\
+00019690: 6e22 290a 2020 2020 2020 2020 2020 2020  n").            
+000196a0: 2020 2020 666f 7220 6669 6c65 5f6e 616d      for file_nam
+000196b0: 6520 696e 2068 6173 6865 733a 0a20 2020  e in hashes:.   
+000196c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000196d0: 2068 6173 685f 6669 6c65 2e77 7269 7465   hash_file.write
+000196e0: 2866 696c 655f 6e61 6d65 2b22 5c74 222b  (file_name+"\t"+
+000196f0: 6861 7368 6573 5b66 696c 655f 6e61 6d65  hashes[file_name
+00019700: 5d2b 225c 6e22 290a 0a20 2020 2020 2020  ]+"\n")..       
+00019710: 2020 2020 2020 2020 2068 6173 685f 6669           hash_fi
+00019720: 6c65 2e63 6c6f 7365 2829 0a20 2020 2020  le.close().     
+00019730: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00019740: 6e20 5472 7565 2c20 2241 6464 6564 2022  n True, "Added "
+00019750: 2b73 7472 2861 6464 6564 5f68 6173 6865  +str(added_hashe
+00019760: 7329 2b22 2068 6173 6865 7320 746f 2068  s)+" hashes to h
+00019770: 6173 6820 6669 6c65 220a 2020 2020 2020  ash file".      
+00019780: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00019790: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+000197a0: 726e 2054 7275 652c 2022 416c 6c20 6861  rn True, "All ha
+000197b0: 7368 6573 2065 7869 7374 220a 0a20 2020  shes exist"..   
+000197c0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+000197d0: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
+000197e0: 6c73 652c 2022 4e6f 2069 6d61 6765 7320  lse, "No images 
+000197f0: 666f 756e 6420 746f 2068 6173 6822 0a20  found to hash". 
+00019800: 2020 2020 2020 200a 2020 2020 6465 6620         .    def 
+00019810: 6372 6561 7465 496d 6167 6553 4841 3235  createImageSHA25
+00019820: 3646 696c 6528 7365 6c66 2c72 6552 6561  6File(self,reRea
+00019830: 6441 6c6c 3d54 7275 6529 3a0a 2020 2020  dAll=True):.    
+00019840: 2020 2020 2222 2220 4465 7072 6563 6174      """ Deprecat
+00019850: 6564 202d 2075 7365 2063 7265 6174 655f  ed - use create_
+00019860: 696d 6167 655f 7368 6132 3536 5f66 696c  image_sha256_fil
+00019870: 6520 2222 220a 2020 2020 2020 2020 7265  e """.        re
+00019880: 7475 726e 2073 656c 662e 6372 6561 7465  turn self.create
+00019890: 5f69 6d61 6765 5f73 6861 3235 365f 6669  _image_sha256_fi
+000198a0: 6c65 2872 6552 6561 6441 6c6c 290a 0a0a  le(reReadAll)...
+000198b0: 2020 2020 6465 6620 6372 6561 7465 5f73      def create_s
+000198c0: 7461 7274 5f74 696d 655f 6669 6c65 2873  tart_time_file(s
+000198d0: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
+000198e0: 2220 4372 6561 7465 7320 696e 202f 696e  " Creates in /in
+000198f0: 7465 726d 6564 6961 7465 2061 2074 6578  termediate a tex
+00019900: 7420 6669 6c65 2063 6f6e 7461 696e 696e  t file containin
+00019910: 6720 7065 7220 696d 6167 6520 6974 7320  g per image its 
+00019920: 7374 6172 7420 7469 6d65 2070 6172 7365  start time parse
+00019930: 6420 6672 6f6d 2074 6865 2066 696c 6520  d from the file 
+00019940: 6e61 6d65 2022 2222 0a0a 2020 2020 2020  name """..      
+00019950: 2020 7320 3d20 6d69 7174 632e 5072 696e    s = miqtc.Prin
+00019960: 744c 6f61 6469 6e67 4d73 6728 2243 7265  tLoadingMsg("Cre
+00019970: 6174 696e 6720 696e 7465 726d 6564 6961  ating intermedia
+00019980: 7465 2073 7461 7274 7469 6d65 2066 696c  te starttime fil
+00019990: 6520 2229 0a20 2020 2020 2020 2069 6d61  e ").        ima
+000199a0: 6765 7349 6e52 6177 203d 2073 656c 662e  gesInRaw = self.
+000199b0: 696d 6167 6573 496e 496d 6167 6573 4469  imagesInImagesDi
+000199c0: 7253 6f72 7465 644c 6973 7428 290a 2020  rSortedList().  
+000199d0: 2020 2020 2020 6966 206c 656e 2869 6d61        if len(ima
+000199e0: 6765 7349 6e52 6177 2920 3e20 303a 0a0a  gesInRaw) > 0:..
+000199f0: 2020 2020 2020 2020 2020 2020 6f20 3d20              o = 
+00019a00: 6f70 656e 2873 656c 662e 6765 745f 696e  open(self.get_in
+00019a10: 745f 7374 6172 7454 696d 6573 5f66 696c  t_startTimes_fil
+00019a20: 6528 292c 2022 7722 290a 2020 2020 2020  e(), "w").      
+00019a30: 2020 2020 2020 6f2e 7772 6974 6528 6d69        o.write(mi
+00019a40: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
+00019a50: 6d61 7269 7174 275d 5b27 696d 6727 5d20  mariqt']['img'] 
+00019a60: 2b0a 2020 2020 2020 2020 2020 2020 2020  +.              
+00019a70: 2020 2020 2020 225c 7422 2b6d 6971 7476        "\t"+miqtv
+00019a80: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
+00019a90: 6971 7427 5d5b 2775 7463 275d 2b22 5c6e  iqt']['utc']+"\n
+00019aa0: 2229 0a0a 2020 2020 2020 2020 2020 2020  ")..            
+00019ab0: 666f 7220 6669 6c65 2069 6e20 696d 6167  for file in imag
+00019ac0: 6573 496e 5261 773a 0a20 2020 2020 2020  esInRaw:.       
+00019ad0: 2020 2020 2020 2020 2066 696c 655f 6e61           file_na
+00019ae0: 6d65 203d 206f 732e 7061 7468 2e62 6173  me = os.path.bas
+00019af0: 656e 616d 6528 6669 6c65 290a 0a20 2020  ename(file)..   
+00019b00: 2020 2020 2020 2020 2020 2020 2064 7420               dt 
+00019b10: 3d20 6d69 7174 632e 7061 7273 6546 696c  = miqtc.parseFil
+00019b20: 6544 6174 6554 696d 6541 7355 5443 2866  eDateTimeAsUTC(f
+00019b30: 696c 655f 6e61 6d65 290a 2020 2020 2020  ile_name).      
+00019b40: 2020 2020 2020 2020 2020 6f2e 7772 6974            o.writ
+00019b50: 6528 6669 6c65 5f6e 616d 652b 225c 7422  e(file_name+"\t"
+00019b60: 202b 2064 742e 7374 7266 7469 6d65 286d   + dt.strftime(m
+00019b70: 6971 7476 2e64 6174 655f 666f 726d 6174  iqtv.date_format
+00019b80: 735b 276d 6172 6971 7427 5d29 2b22 5c6e  s['mariqt'])+"\n
+00019b90: 2229 0a0a 2020 2020 2020 2020 2020 2020  ")..            
+00019ba0: 6f2e 636c 6f73 6528 290a 2020 2020 2020  o.close().      
+00019bb0: 2020 2020 2020 732e 7374 6f70 2829 0a20        s.stop(). 
+00019bc0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00019bd0: 6e20 5472 7565 2c20 2243 7265 6174 6564  n True, "Created
+00019be0: 2073 7461 7274 2074 696d 6520 6669 6c65   start time file
+00019bf0: 220a 2020 2020 2020 2020 656c 7365 3a0a  ".        else:.
+00019c00: 2020 2020 2020 2020 2020 2020 732e 7374              s.st
+00019c10: 6f70 2829 0a20 2020 2020 2020 2020 2020  op().           
+00019c20: 2072 6574 7572 6e20 4661 6c73 652c 2022   return False, "
+00019c30: 4e6f 2069 6d61 6765 7320 666f 756e 6420  No images found 
+00019c40: 746f 2072 6561 6420 7374 6172 7420 7469  to read start ti
+00019c50: 6d65 7322 0a20 2020 2020 2020 200a 2020  mes".        .  
+00019c60: 2020 6465 6620 6372 6561 7465 5374 6172    def createStar
+00019c70: 7454 696d 6546 696c 6528 7365 6c66 293a  tTimeFile(self):
+00019c80: 0a20 2020 2020 2020 2022 2222 2044 6570  .        """ Dep
+00019c90: 7265 6361 7465 6420 2d20 7573 6520 6372  recated - use cr
+00019ca0: 6561 7465 5f73 7461 7274 5f74 696d 655f  eate_start_time_
+00019cb0: 6669 6c65 2022 2222 0a20 2020 2020 2020  file """.       
+00019cc0: 2072 6574 7572 6e20 7365 6c66 2e63 7265   return self.cre
+00019cd0: 6174 655f 7374 6172 745f 7469 6d65 5f66  ate_start_time_f
+00019ce0: 696c 6528 290a 0a0a 2020 2020 6465 6620  ile()...    def 
+00019cf0: 6372 6561 7465 4163 7175 6973 6974 696f  createAcquisitio
+00019d00: 6e53 6574 7469 6e67 7345 5849 4646 696c  nSettingsEXIFFil
+00019d10: 6528 7365 6c66 2c6f 7665 7272 6964 653d  e(self,override=
+00019d20: 4661 6c73 6529 3a0a 2020 2020 2020 2020  False):.        
+00019d30: 2222 2220 4372 6561 7465 7320 696e 202f  """ Creates in /
+00019d40: 696e 7465 726d 6564 6961 7465 2061 2074  intermediate a t
+00019d50: 6578 7420 6669 6c65 2063 6f6e 7461 696e  ext file contain
+00019d60: 696e 6720 7065 7220 696d 6167 6520 6120  ing per image a 
+00019d70: 6469 6374 206f 6620 6578 6966 2074 6167  dict of exif tag
+00019d80: 7320 616e 6420 7468 6569 7220 7661 6c75  s and their valu
+00019d90: 6573 2070 6172 7365 6420 6672 6f6d 2074  es parsed from t
+00019da0: 6865 2069 6d61 6765 2022 2222 0a0a 2020  he image """..  
+00019db0: 2020 2020 2020 696e 745f 6163 7175 6973        int_acquis
+00019dc0: 6974 696f 6e53 6574 7469 6e67 5f66 696c  itionSetting_fil
+00019dd0: 6520 3d20 7365 6c66 2e5f 5f67 6574 5f69  e = self.__get_i
+00019de0: 6e74 5f66 696c 655f 7072 6566 6978 2829  nt_file_prefix()
+00019df0: 202b 2027 5f69 6d61 6765 2d61 6371 7569   + '_image-acqui
+00019e00: 7369 7469 6f6e 2d73 6574 7469 6e67 732e  sition-settings.
+00019e10: 7478 7427 0a20 2020 2020 2020 2068 6561  txt'.        hea
+00019e20: 6465 7220 3d20 7b20 206d 6971 7476 2e63  der = {  miqtv.c
+00019e30: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
+00019e40: 7427 5d5b 2769 6d67 275d 3a20 206d 6971  t']['img']:  miq
+00019e50: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
+00019e60: 6172 6971 7427 5d5b 2769 6d67 275d 2c0a  ariqt']['img'],.
+00019e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019e80: 2020 2020 6d69 7174 762e 636f 6c5f 6865      miqtv.col_he
+00019e90: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
+00019ea0: 6163 7175 6927 5d3a 6d69 7174 762e 636f  acqui']:miqtv.co
+00019eb0: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
+00019ec0: 275d 5b27 6163 7175 6927 5d7d 0a20 2020  ']['acqui']}.   
+00019ed0: 2020 2020 2069 6620 6f73 2e70 6174 682e       if os.path.
+00019ee0: 6578 6973 7473 2869 6e74 5f61 6371 7569  exists(int_acqui
+00019ef0: 7369 7469 6f6e 5365 7474 696e 675f 6669  sitionSetting_fi
+00019f00: 6c65 2920 616e 6420 6e6f 7420 6f76 6572  le) and not over
+00019f10: 7269 6465 3a0a 2020 2020 2020 2020 2020  ride:.          
+00019f20: 2020 7365 6c66 2e61 6464 5f69 7465 6d5f    self.add_item_
+00019f30: 696e 666f 5f74 6162 5f66 696c 6528 696e  info_tab_file(in
+00019f40: 745f 6163 7175 6973 6974 696f 6e53 6574  t_acquisitionSet
+00019f50: 7469 6e67 5f66 696c 652c 225c 7422 2c68  ting_file,"\t",h
+00019f60: 6561 6465 7229 0a20 2020 2020 2020 2020  eader).         
+00019f70: 2020 2072 6574 7572 6e20 5472 7565 2c20     return True, 
+00019f80: 2252 6573 756c 7420 6669 6c65 2065 7869  "Result file exi
+00019f90: 7374 7322 0a0a 2020 2020 2020 2020 696d  sts"..        im
+00019fa0: 6167 6573 496e 5261 7720 3d20 7365 6c66  agesInRaw = self
+00019fb0: 2e69 6d61 6765 7349 6e49 6d61 6765 7344  .imagesInImagesD
+00019fc0: 6972 536f 7274 6564 4c69 7374 2829 0a20  irSortedList(). 
+00019fd0: 2020 2020 2020 2069 6620 6c65 6e28 696d         if len(im
+00019fe0: 6167 6573 496e 5261 7729 203e 2030 3a0a  agesInRaw) > 0:.
+00019ff0: 0a20 2020 2020 2020 2020 2020 206f 203d  .            o =
+0001a000: 206f 7065 6e28 696e 745f 6163 7175 6973   open(int_acquis
+0001a010: 6974 696f 6e53 6574 7469 6e67 5f66 696c  itionSetting_fil
+0001a020: 652c 2022 7722 290a 2020 2020 2020 2020  e, "w").        
+0001a030: 2020 2020 6f2e 7772 6974 6528 6d69 7174      o.write(miqt
+0001a040: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
+0001a050: 7269 7174 275d 5b27 696d 6727 5d20 2b20  riqt']['img'] + 
+0001a060: 225c 7422 2b6d 6971 7476 2e63 6f6c 5f68  "\t"+miqtv.col_h
+0001a070: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
+0001a080: 2761 6371 7569 275d 2b22 5c6e 2229 0a20  'acqui']+"\n"). 
+0001a090: 0a20 2020 2020 2020 2020 2020 2069 6d61  .            ima
+0001a0a0: 6765 7345 7869 6673 203d 206d 6971 7469  gesExifs = miqti
+0001a0b0: 2e67 6574 496d 6167 6573 416c 6c45 7869  .getImagesAllExi
+0001a0c0: 6656 616c 7565 7328 696d 6167 6573 496e  fValues(imagesIn
+0001a0d0: 5261 772c 7365 6c66 2e70 726f 7629 0a20  Raw,self.prov). 
+0001a0e0: 2020 2020 2020 2020 2020 2066 6f72 2066             for f
+0001a0f0: 696c 6520 696e 2069 6d61 6765 7345 7869  ile in imagesExi
+0001a100: 6673 3a0a 2020 2020 2020 2020 2020 2020  fs:.            
+0001a110: 2020 2020 6669 6c65 5f6e 616d 6520 3d20      file_name = 
+0001a120: 6f73 2e70 6174 682e 6261 7365 6e61 6d65  os.path.basename
+0001a130: 2866 696c 6529 0a20 2020 2020 2020 2020  (file).         
+0001a140: 2020 2020 2020 206f 2e77 7269 7465 2866         o.write(f
+0001a150: 696c 655f 6e61 6d65 2b22 5c74 222b 7374  ile_name+"\t"+st
+0001a160: 7228 696d 6167 6573 4578 6966 735b 6669  r(imagesExifs[fi
+0001a170: 6c65 5d29 2b22 5c6e 2229 0a0a 2020 2020  le])+"\n")..    
+0001a180: 2020 2020 2020 2020 6f2e 636c 6f73 6528          o.close(
+0001a190: 290a 0a20 2020 2020 2020 2020 2020 2073  )..            s
+0001a1a0: 656c 662e 6164 645f 6974 656d 5f69 6e66  elf.add_item_inf
+0001a1b0: 6f5f 7461 625f 6669 6c65 2869 6e74 5f61  o_tab_file(int_a
+0001a1c0: 6371 7569 7369 7469 6f6e 5365 7474 696e  cquisitionSettin
+0001a1d0: 675f 6669 6c65 2c22 5c74 222c 6865 6164  g_file,"\t",head
+0001a1e0: 6572 290a 2020 2020 2020 2020 2020 2020  er).            
+0001a1f0: 7265 7475 726e 2054 7275 652c 2022 4372  return True, "Cr
+0001a200: 6561 7465 6420 6163 7175 6973 6974 696f  eated acquisitio
+0001a210: 6e20 7365 7474 696e 6773 2066 696c 6522  n settings file"
+0001a220: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+0001a230: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0001a240: 6e20 4661 6c73 652c 2022 4e6f 2069 6d61  n False, "No ima
+0001a250: 6765 7320 666f 756e 6422 0a0a 0a20 2020  ges found"...   
+0001a260: 2064 6566 2069 6d61 6765 7349 6e49 6d61   def imagesInIma
+0001a270: 6765 7344 6972 2873 656c 6629 3a0a 2020  gesDir(self):.  
+0001a280: 2020 2020 2020 7265 7475 726e 2063 6f70        return cop
+0001a290: 792e 6465 6570 636f 7079 2873 656c 662e  y.deepcopy(self.
+0001a2a0: 5f69 6d61 6765 7349 6e49 6d61 6765 7344  _imagesInImagesD
+0001a2b0: 6972 290a 0a20 2020 2064 6566 2069 6d61  ir)..    def ima
+0001a2c0: 6765 7349 6e49 6d61 6765 7344 6972 536f  gesInImagesDirSo
+0001a2d0: 7274 6564 4c69 7374 2873 656c 6629 3a0a  rtedList(self):.
+0001a2e0: 2020 2020 2020 2020 7265 7475 726e 2063          return c
+0001a2f0: 6f70 792e 6465 6570 636f 7079 2873 656c  opy.deepcopy(sel
+0001a300: 662e 5f69 6d61 6765 7349 6e49 6d61 6765  f._imagesInImage
+0001a310: 7344 6972 536f 7274 6564 4c69 7374 290a  sDirSortedList).
+0001a320: 0a0a 2020 2020 6465 6620 7061 7273 6549  ..    def parseI
+0001a330: 7465 6d44 6174 6166 726f 6d54 6162 4669  temDatafromTabFi
+0001a340: 6c65 4461 7461 2873 656c 662c 2069 7465  leData(self, ite
+0001a350: 6d73 3a20 6469 6374 2c20 6669 6c65 3a20  ms: dict, file: 
+0001a360: 7374 722c 2063 6f6c 733a 206c 6973 742c  str, cols: list,
+0001a370: 206f 7074 696f 6e61 6c3a 206c 6973 7420   optional: list 
+0001a380: 3d20 5b5d 2c20 6461 7465 7469 6d65 5f66  = [], datetime_f
+0001a390: 6f72 6d61 743a 7374 723d 6d69 7174 762e  ormat:str=miqtv.
 0001a3a0: 6461 7465 5f66 6f72 6d61 7473 5b27 6d61  date_formats['ma
-0001a3b0: 7269 7174 275d 290a 2020 2020 2020 2020  riqt']).        
-0001a3c0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0001a3d0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-0001a3e0: 6d69 7174 632e 4966 646f 4578 6365 7074  miqtc.IfdoExcept
-0001a3f0: 696f 6e28 2264 6174 6120 656e 7472 6965  ion("data entrie
-0001a400: 7320 6d75 7374 2062 6520 6469 6374 206f  s must be dict o
-0001a410: 7220 6c69 7374 2069 6620 6469 6374 7322  r list if dicts"
-0001a420: 290a 0a20 2020 2020 2020 206d 6971 7463  )..        miqtc
-0001a430: 2e72 6563 7572 7369 7665 6c79 5570 6461  .recursivelyUpda
-0001a440: 7465 4469 6374 7328 6974 656d 732c 6461  teDicts(items,da
-0001a450: 7461 290a 0a0a 2020 2020 4073 7461 7469  ta)...    @stati
-0001a460: 636d 6574 686f 640a 2020 2020 6465 6620  cmethod.    def 
-0001a470: 6578 7472 6163 7443 6f6e 7374 4461 7461  extractConstData
-0001a480: 5661 6c75 6573 2864 6174 613a 6469 6374  Values(data:dict
-0001a490: 2c68 6561 6465 723a 6469 6374 293a 0a20  ,header:dict):. 
-0001a4a0: 2020 2020 2020 2022 2222 2052 656d 6f76         """ Remov
-0001a4b0: 6573 2066 6965 6c64 7320 7468 6174 2061  es fields that a
-0001a4c0: 7265 2063 6f6e 7374 616e 7420 666f 7220  re constant for 
-0001a4d0: 616c 6c20 656e 7472 6965 7320 6672 6f6d  all entries from
-0001a4e0: 2064 6174 6120 6469 6374 2061 6e64 2070   data dict and p
-0001a4f0: 7574 2074 6865 6d20 696e 2068 6561 6465  ut them in heade
-0001a500: 7220 6469 6374 2e20 0a20 2020 2020 2020  r dict. .       
-0001a510: 2020 2020 2045 6163 6820 656e 7472 7920       Each entry 
-0001a520: 6f66 2064 6174 6120 6d75 7374 2062 6520  of data must be 
-0001a530: 6120 6469 6374 2077 6974 6820 7468 6520  a dict with the 
-0001a540: 7361 6d65 2073 6574 206f 6620 6b65 7973  same set of keys
-0001a550: 2e20 2222 220a 2020 2020 0a20 2020 2020  . """.    .     
-0001a560: 2020 2066 6965 6c64 7354 6f49 676e 6f72     fieldsToIgnor
-0001a570: 6520 3d20 5b27 696d 6167 652d 6461 7465  e = ['image-date
-0001a580: 7469 6d65 275d 0a20 2020 2020 2020 2063  time'].        c
-0001a590: 6f6e 7374 4461 7461 203d 207b 7d0a 2020  onstData = {}.  
-0001a5a0: 2020 2020 2020 6669 7273 7449 6d61 6765        firstImage
-0001a5b0: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
-0001a5c0: 666f 7220 696d 6167 652c 696d 6167 655f  for image,image_
-0001a5d0: 6461 7461 2069 6e20 6461 7461 2e69 7465  data in data.ite
-0001a5e0: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
-0001a5f0: 2020 0a20 2020 2020 2020 2020 2020 2069    .            i
-0001a600: 6620 6e6f 7420 6973 696e 7374 616e 6365  f not isinstance
-0001a610: 2869 6d61 6765 5f64 6174 612c 6c69 7374  (image_data,list
-0001a620: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0001a630: 2020 2069 6d61 6765 5f64 6174 6120 3d20     image_data = 
-0001a640: 5b69 6d61 6765 5f64 6174 615d 0a0a 2020  [image_data]..  
-0001a650: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-0001a660: 2066 6972 7374 496d 6167 6520 616e 6420   firstImage and 
-0001a670: 636f 6e73 7444 6174 6120 3d3d 207b 7d3a  constData == {}:
-0001a680: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a690: 2062 7265 616b 0a20 2020 2020 2020 2020   break.         
-0001a6a0: 2020 200a 2020 2020 2020 2020 2020 2020     .            
-0001a6b0: 6669 7273 7454 696d 6550 6f69 6e74 203d  firstTimePoint =
-0001a6c0: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
-0001a6d0: 2020 666f 7220 696d 6167 655f 7470 5f64    for image_tp_d
-0001a6e0: 6174 6120 696e 2069 6d61 6765 5f64 6174  ata in image_dat
-0001a6f0: 613a 0a20 2020 2020 2020 2020 2020 2020  a:.             
-0001a700: 2020 2023 2076 6572 7920 6669 7273 7420     # very first 
-0001a710: 6461 7461 2066 6f72 2063 6f6d 7061 7269  data for compari
-0001a720: 736f 6e0a 2020 2020 2020 2020 2020 2020  son.            
-0001a730: 2020 2020 6966 2066 6972 7374 496d 6167      if firstImag
-0001a740: 6520 616e 6420 6669 7273 7454 696d 6550  e and firstTimeP
-0001a750: 6f69 6e74 3a0a 2020 2020 2020 2020 2020  oint:.          
-0001a760: 2020 2020 2020 2020 2020 636f 6e73 7444            constD
-0001a770: 6174 6120 3d20 636f 7079 2e64 6565 7063  ata = copy.deepc
-0001a780: 6f70 7928 696d 6167 655f 7470 5f64 6174  opy(image_tp_dat
-0001a790: 6129 0a20 2020 2020 2020 2020 2020 2020  a).             
-0001a7a0: 2020 2020 2020 2066 6f72 2066 6965 6c64         for field
-0001a7b0: 2069 6e20 6669 656c 6473 546f 4967 6e6f   in fieldsToIgno
-0001a7c0: 7265 3a0a 2020 2020 2020 2020 2020 2020  re:.            
-0001a7d0: 2020 2020 2020 2020 2020 2020 6966 2066              if f
-0001a7e0: 6965 6c64 2069 6e20 636f 6e73 7444 6174  ield in constDat
-0001a7f0: 613a 0a20 2020 2020 2020 2020 2020 2020  a:.             
-0001a800: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0001a810: 656c 2063 6f6e 7374 4461 7461 5b66 6965  el constData[fie
-0001a820: 6c64 5d0a 2020 2020 2020 2020 2020 2020  ld].            
-0001a830: 2020 2020 2020 2020 6669 7273 7454 696d          firstTim
-0001a840: 6550 6f69 6e74 203d 2046 616c 7365 0a20  ePoint = False. 
-0001a850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a860: 2020 2063 6f6e 7469 6e75 650a 0a20 2020     continue..   
-0001a870: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-0001a880: 7374 4461 7461 203d 206d 6971 7463 2e66  stData = miqtc.f
-0001a890: 696e 6443 6f6d 6d6f 6e44 6963 7445 6c65  indCommonDictEle
-0001a8a0: 6d65 6e74 7328 696d 6167 655f 7470 5f64  ments(image_tp_d
-0001a8b0: 6174 612c 636f 6e73 7444 6174 6129 0a0a  ata,constData)..
-0001a8c0: 2020 2020 2020 2020 2020 2020 6669 7273              firs
-0001a8d0: 7449 6d61 6765 203d 2046 616c 7365 0a0a  tImage = False..
-0001a8e0: 2020 2020 2020 2020 2320 544f 444f 2063          # TODO c
-0001a8f0: 6865 636b 2077 6974 6869 6e20 696d 6167  heck within imag
-0001a900: 6520 7469 6d65 7320 2d3e 2074 6f20 696d  e times -> to im
-0001a910: 6167 6520 6465 6661 756c 742e 2028 7472  age default. (tr
-0001a920: 6963 6b79 2073 696e 6365 2077 6520 646f  icky since we do
-0001a930: 6e27 7420 6861 7665 2074 6865 2064 6166  n't have the daf
-0001a940: 6175 6c74 2069 6e64 6578 2068 6572 652e  ault index here.
-0001a950: 204f 6e6c 7920 6120 7375 6273 6574 206d   Only a subset m
-0001a960: 6967 6874 2062 6520 7570 6461 7465 2068  ight be update h
-0001a970: 6572 6529 0a20 2020 2020 2020 2023 2063  ere).        # c
-0001a980: 6865 636b 2077 6974 6869 6e20 696d 6167  heck within imag
-0001a990: 6520 6974 656d 7320 2d3e 2068 6561 6465  e items -> heade
-0001a9a0: 720a 2020 2020 2020 2020 6865 6164 6572  r.        header
-0001a9b0: 5570 6461 7465 203d 2063 6f70 792e 6465  Update = copy.de
-0001a9c0: 6570 636f 7079 2863 6f6e 7374 4461 7461  epcopy(constData
-0001a9d0: 290a 2020 2020 2020 2020 6865 6164 6572  ).        header
-0001a9e0: 5570 6461 7465 6454 6573 7420 3d20 636f  UpdatedTest = co
-0001a9f0: 7079 2e64 6565 7063 6f70 7928 6865 6164  py.deepcopy(head
-0001aa00: 6572 290a 2020 2020 2020 2020 6d69 7174  er).        miqt
-0001aa10: 632e 7265 6375 7273 6976 656c 7955 7064  c.recursivelyUpd
-0001aa20: 6174 6544 6963 7473 2868 6561 6465 7255  ateDicts(headerU
-0001aa30: 7064 6174 6564 5465 7374 2c68 6561 6465  pdatedTest,heade
-0001aa40: 7255 7064 6174 6529 0a20 2020 2020 2020  rUpdate).       
-0001aa50: 2075 7064 6174 6544 6966 6620 3d20 4465   updateDiff = De
-0001aa60: 6570 4469 6666 2868 6561 6465 722c 6865  epDiff(header,he
-0001aa70: 6164 6572 5570 6461 7465 6454 6573 7429  aderUpdatedTest)
-0001aa80: 0a20 2020 2020 2020 2023 2063 6865 636b  .        # check
-0001aa90: 2069 6620 6865 6164 6572 5570 6461 7465   if headerUpdate
-0001aaa0: 2077 6f75 6c64 206f 7665 7277 7269 7465   would overwrite
-0001aab0: 2061 6e79 7468 696e 6720 6672 6f6d 2063   anything from c
-0001aac0: 7572 7265 6e74 2068 6561 6465 7220 2873  urrent header (s
-0001aad0: 686f 756c 6420 6e6f 7420 6861 7070 656e  hould not happen
-0001aae0: 292c 2069 6620 736f 2064 6f6e 7420 7265  ), if so dont re
-0001aaf0: 6d6f 7665 2066 726f 6d20 6974 656d 730a  move from items.
-0001ab00: 2020 2020 2020 2020 6966 206e 6f74 2027          if not '
-0001ab10: 7661 6c75 6573 5f63 6861 6e67 6564 2720  values_changed' 
-0001ab20: 696e 2075 7064 6174 6544 6966 6620 616e  in updateDiff an
-0001ab30: 6420 6e6f 7420 2774 7970 655f 6368 616e  d not 'type_chan
-0001ab40: 6765 7327 2069 6e20 7570 6461 7465 4469  ges' in updateDi
-0001ab50: 6666 2061 6e64 206e 6f74 2027 6469 6374  ff and not 'dict
-0001ab60: 696f 6e61 7279 5f69 7465 6d5f 7265 6d6f  ionary_item_remo
-0001ab70: 7665 6427 2069 6e20 7570 6461 7465 4469  ved' in updateDi
-0001ab80: 6666 3a0a 2020 2020 2020 2020 2020 2020  ff:.            
-0001ab90: 6865 6164 6572 2e63 6c65 6172 2829 0a20  header.clear(). 
-0001aba0: 2020 2020 2020 2020 2020 2068 6561 6465             heade
-0001abb0: 722e 7570 6461 7465 2868 6561 6465 7255  r.update(headerU
-0001abc0: 7064 6174 6564 5465 7374 290a 0a20 2020  pdatedTest)..   
-0001abd0: 2020 2020 2020 2020 2023 2072 656d 6f76           # remov
-0001abe0: 6520 636f 6e73 7420 7661 6c75 6573 2066  e const values f
-0001abf0: 726f 6d20 6461 7461 0a20 2020 2020 2020  rom data.       
-0001ac00: 2020 2020 206d 6971 7463 2e72 6563 7572       miqtc.recur
-0001ac10: 7369 7665 4d61 6b65 4e6f 6e65 4469 6374  siveMakeNoneDict
-0001ac20: 4669 656c 6473 456d 7074 7953 7472 2863  FieldsEmptyStr(c
-0001ac30: 6f6e 7374 4461 7461 290a 2020 2020 2020  onstData).      
-0001ac40: 2020 2020 2020 666f 7220 696d 6167 652c        for image,
-0001ac50: 696d 6167 655f 6461 7461 2069 6e20 6461  image_data in da
-0001ac60: 7461 2e69 7465 6d73 2829 3a0a 2020 2020  ta.items():.    
-0001ac70: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-0001ac80: 6f74 2069 7369 6e73 7461 6e63 6528 696d  ot isinstance(im
-0001ac90: 6167 655f 6461 7461 2c6c 6973 7429 3a0a  age_data,list):.
-0001aca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001acb0: 2020 2020 696d 6167 655f 6461 7461 203d      image_data =
-0001acc0: 205b 696d 6167 655f 6461 7461 5d0a 2020   [image_data].  
-0001acd0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-0001ace0: 7220 696d 6167 655f 7470 5f64 6174 6120  r image_tp_data 
-0001acf0: 696e 2069 6d61 6765 5f64 6174 613a 0a20  in image_data:. 
-0001ad00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ad10: 2020 206d 6971 7463 2e72 6563 7572 7369     miqtc.recursi
-0001ad20: 7665 6c79 5570 6461 7465 4469 6374 7328  velyUpdateDicts(
-0001ad30: 696d 6167 655f 7470 5f64 6174 612c 636f  image_tp_data,co
-0001ad40: 6e73 7444 6174 6129 2020 2020 2020 2020  nstData)        
-0001ad50: 2020 0a0a 2020 2020 2020 2020 656c 7365    ..        else
-0001ad60: 3a0a 2020 2020 2020 2020 2020 2020 7061  :.            pa
-0001ad70: 7373 0a20 2020 2020 2020 2020 2020 2023  ss.            #
-0001ad80: 2054 4f44 4f20 6c6f 673f 0a20 2020 2020   TODO log?.     
-0001ad90: 0a0a 2020 2020 6465 6620 696e 7465 726d  ..    def interm
-0001ada0: 6564 6961 7465 4e61 7646 696c 6545 7869  ediateNavFileExi
-0001adb0: 7374 7328 7365 6c66 293a 0a20 2020 2020  sts(self):.     
-0001adc0: 2020 2069 6620 6f73 2e70 6174 682e 6578     if os.path.ex
-0001add0: 6973 7473 2873 656c 662e 6765 745f 696e  ists(self.get_in
-0001ade0: 745f 6e61 765f 6669 6c65 2829 293a 0a20  t_nav_file()):. 
-0001adf0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0001ae00: 6e20 5472 7565 0a20 2020 2020 2020 2065  n True.        e
-0001ae10: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0001ae20: 2072 6574 7572 6e20 4661 6c73 650a 0a0a   return False...
-0001ae30: 2020 2020 6465 6620 6865 6164 6572 4669      def headerFi
-0001ae40: 656c 6446 696c 6c65 6428 7365 6c66 2c66  eldFilled(self,f
-0001ae50: 6965 6c64 3a73 7472 293a 0a20 2020 2020  ield:str):.     
-0001ae60: 2020 2069 6620 7365 6c66 2e66 696e 6454     if self.findT
-0001ae70: 6d70 4669 656c 6432 2866 6965 6c64 2920  mpField2(field) 
-0001ae80: 3d3d 2022 223a 0a20 2020 2020 2020 2020  == "":.         
-0001ae90: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
-0001aea0: 2020 2020 2020 2020 7265 7475 726e 2054          return T
-0001aeb0: 7275 650a 0a20 2020 2064 6566 2063 6f6e  rue..    def con
-0001aec0: 7665 7274 546f 4465 6661 756c 7444 6174  vertToDefaultDat
-0001aed0: 6554 696d 6546 6f72 6d61 7428 7365 6c66  eTimeFormat(self
-0001aee0: 2c69 6664 6f29 3a0a 2020 2020 2020 2020  ,ifdo):.        
-0001aef0: 2222 2220 4368 6563 6b73 2069 6620 616c  """ Checks if al
-0001af00: 6c20 6974 656d 7327 2027 696d 6167 652d  l items' 'image-
-0001af10: 6461 7465 7469 6d65 2720 6669 656c 6473  datetime' fields
-0001af20: 206d 6174 6368 2064 6566 6175 6c74 2064   match default d
-0001af30: 6174 6574 696d 6520 666f 726d 6174 206f  atetime format o
-0001af40: 7220 6120 6375 7374 6f6d 206f 6e65 2064  r a custom one d
-0001af50: 6566 696e 6564 2069 6e20 2769 6d61 6765  efined in 'image
-0001af60: 2d64 6174 6574 696d 652d 666f 726d 6174  -datetime-format
-0001af70: 270a 2020 2020 2020 2020 2020 2020 616e  '.            an
-0001af80: 6420 636f 6e76 6572 7473 2074 6f20 6465  d converts to de
-0001af90: 6661 756c 7420 666f 726d 6174 2e20 5468  fault format. Th
-0001afa0: 726f 7773 2065 7863 6570 7469 6f6e 2069  rows exception i
-0001afb0: 6620 6461 7465 7469 6d65 2063 616e 6e6f  f datetime canno
-0001afc0: 7420 6265 2070 6172 7365 6420 2222 220a  t be parsed """.
-0001afd0: 2020 2020 2020 2020 6375 7374 6f6d 4461          customDa
-0001afe0: 7465 5469 6d65 466f 726d 6174 466f 756e  teTimeFormatFoun
-0001aff0: 6420 3d20 4661 6c73 650a 2020 2020 2020  d = False.      
-0001b000: 2020 6865 6164 6572 4375 7374 6f6d 4461    headerCustomDa
-0001b010: 7465 5469 6d65 466f 726d 6174 203d 2066  teTimeFormat = f
-0001b020: 696e 6446 6965 6c64 2869 6664 6f5b 7365  indField(ifdo[se
-0001b030: 6c66 2e69 6d61 6765 5365 7448 6561 6465  lf.imageSetHeade
-0001b040: 724b 6579 5d2c 2769 6d61 6765 2d64 6174  rKey],'image-dat
-0001b050: 6574 696d 652d 666f 726d 6174 2729 0a20  etime-format'). 
-0001b060: 2020 2020 2020 2069 6620 6865 6164 6572         if header
-0001b070: 4375 7374 6f6d 4461 7465 5469 6d65 466f  CustomDateTimeFo
-0001b080: 726d 6174 2021 3d20 2222 3a0a 2020 2020  rmat != "":.    
-0001b090: 2020 2020 2020 2020 6966 646f 5b73 656c          ifdo[sel
-0001b0a0: 662e 696d 6167 6553 6574 4865 6164 6572  f.imageSetHeader
-0001b0b0: 4b65 795d 5b27 696d 6167 652d 6461 7465  Key]['image-date
-0001b0c0: 7469 6d65 2d66 6f72 6d61 7427 5d20 3d20  time-format'] = 
-0001b0d0: 2222 2023 2072 656d 6f76 6520 6375 7374  "" # remove cust
-0001b0e0: 6f6d 2066 6f72 6d61 740a 2020 2020 2020  om format.      
-0001b0f0: 2020 2020 2020 6375 7374 6f6d 4461 7465        customDate
-0001b100: 5469 6d65 466f 726d 6174 466f 756e 6420  TimeFormatFound 
-0001b110: 3d20 5472 7565 0a20 2020 2020 2020 2070  = True.        p
-0001b120: 726f 6720 3d20 6d69 7174 632e 5072 696e  rog = miqtc.Prin
-0001b130: 744b 6e6f 776e 5072 6f67 7265 7373 4d73  tKnownProgressMs
-0001b140: 6728 2243 6865 636b 696e 6720 6461 7465  g("Checking date
-0001b150: 7469 6d65 2066 6f72 6d61 7422 2c20 6c65  time format", le
-0001b160: 6e28 6966 646f 5b73 656c 662e 696d 6167  n(ifdo[self.imag
-0001b170: 6553 6574 4974 656d 734b 6579 5d29 2c6d  eSetItemsKey]),m
-0001b180: 6f64 756c 6f3d 3129 0a20 2020 2020 2020  odulo=1).       
-0001b190: 2066 6f72 2066 696c 652c 6974 656d 2069   for file,item i
-0001b1a0: 6e20 6966 646f 5b73 656c 662e 696d 6167  n ifdo[self.imag
-0001b1b0: 6553 6574 4974 656d 734b 6579 5d2e 6974  eSetItemsKey].it
-0001b1c0: 656d 7328 293a 0a20 2020 2020 2020 2020  ems():.         
-0001b1d0: 2020 2070 726f 672e 7072 6f67 7265 7373     prog.progress
-0001b1e0: 2829 0a20 2020 2020 2020 2020 2020 2069  ().            i
-0001b1f0: 6620 6e6f 7420 6973 696e 7374 616e 6365  f not isinstance
-0001b200: 2869 7465 6d2c 6c69 7374 293a 0a20 2020  (item,list):.   
-0001b210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b220: 2069 7465 6d20 3d20 5b69 7465 6d5d 0a20   item = [item]. 
-0001b230: 2020 2020 2020 2020 2020 2073 7562 4974             subIt
-0001b240: 656d 4465 6661 756c 7420 3d20 6974 656d  emDefault = item
-0001b250: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
-0001b260: 6974 656d 4375 7374 6f6d 4461 7465 5469  itemCustomDateTi
-0001b270: 6d65 466f 726d 6174 203d 2022 220a 2020  meFormat = "".  
-0001b280: 2020 2020 2020 2020 2020 6966 2027 696d            if 'im
-0001b290: 6167 652d 6461 7465 7469 6d65 2d66 6f72  age-datetime-for
-0001b2a0: 6d61 7427 2069 6e20 7375 6249 7465 6d44  mat' in subItemD
-0001b2b0: 6566 6175 6c74 3a0a 2020 2020 2020 2020  efault:.        
-0001b2c0: 2020 2020 2020 2020 6974 656d 4375 7374          itemCust
-0001b2d0: 6f6d 4461 7465 5469 6d65 466f 726d 6174  omDateTimeFormat
-0001b2e0: 203d 2073 7562 4974 656d 4465 6661 756c   = subItemDefaul
-0001b2f0: 745b 2769 6d61 6765 2d64 6174 6574 696d  t['image-datetim
-0001b300: 652d 666f 726d 6174 275d 0a20 2020 2020  e-format'].     
-0001b310: 2020 2020 2020 2020 2020 2073 7562 4974             subIt
-0001b320: 656d 4465 6661 756c 745b 2769 6d61 6765  emDefault['image
-0001b330: 2d64 6174 6574 696d 652d 666f 726d 6174  -datetime-format
-0001b340: 275d 203d 2022 2220 2320 7265 6d6f 7665  '] = "" # remove
-0001b350: 2063 7573 746f 6d20 666f 726d 6174 0a20   custom format. 
-0001b360: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0001b370: 7573 746f 6d44 6174 6554 696d 6546 6f72  ustomDateTimeFor
-0001b380: 6d61 7446 6f75 6e64 203d 2054 7275 650a  matFound = True.
-0001b390: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0001b3a0: 7375 6249 7465 6d20 696e 2069 7465 6d3a  subItem in item:
-0001b3b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b3c0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-0001b3d0: 2020 2020 2020 2020 2020 666f 726d 6174            format
-0001b3e0: 203d 206d 6971 7476 2e64 6174 655f 666f   = miqtv.date_fo
-0001b3f0: 726d 6174 735b 276d 6172 6971 7427 5d0a  rmats['mariqt'].
-0001b400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b410: 2020 2020 6461 7465 7469 6d65 2e64 6174      datetime.dat
-0001b420: 6574 696d 652e 7374 7270 7469 6d65 2873  etime.strptime(s
-0001b430: 7562 4974 656d 5b27 696d 6167 652d 6461  ubItem['image-da
-0001b440: 7465 7469 6d65 275d 2c66 6f72 6d61 7429  tetime'],format)
-0001b450: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b460: 2065 7863 6570 743a 0a20 2020 2020 2020   except:.       
-0001b470: 2020 2020 2020 2020 2020 2020 2074 7279               try
-0001b480: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001b490: 2020 2020 2020 2020 2020 666f 726d 6174            format
-0001b4a0: 203d 2068 6561 6465 7243 7573 746f 6d44   = headerCustomD
-0001b4b0: 6174 6554 696d 6546 6f72 6d61 740a 2020  ateTimeFormat.  
-0001b4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b4d0: 2020 2020 2020 6474 203d 2064 6174 6574        dt = datet
-0001b4e0: 696d 652e 6461 7465 7469 6d65 2e73 7472  ime.datetime.str
-0001b4f0: 7074 696d 6528 7375 6249 7465 6d5b 2769  ptime(subItem['i
-0001b500: 6d61 6765 2d64 6174 6574 696d 6527 5d2c  mage-datetime'],
-0001b510: 666f 726d 6174 290a 2020 2020 2020 2020  format).        
-0001b520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b530: 7375 6249 7465 6d5b 2769 6d61 6765 2d64  subItem['image-d
-0001b540: 6174 6574 696d 6527 5d20 3d20 6461 7465  atetime'] = date
-0001b550: 7469 6d65 2e64 6174 6574 696d 652e 7374  time.datetime.st
-0001b560: 7266 7469 6d65 2864 742c 6d69 7174 762e  rftime(dt,miqtv.
-0001b570: 6461 7465 5f66 6f72 6d61 7473 5b27 6d61  date_formats['ma
-0001b580: 7269 7174 275d 290a 2020 2020 2020 2020  riqt']).        
-0001b590: 2020 2020 2020 2020 2020 2020 6578 6365              exce
-0001b5a0: 7074 3a0a 2020 2020 2020 2020 2020 2020  pt:.            
-0001b5b0: 2020 2020 2020 2020 2020 2020 7472 793a              try:
-0001b5c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b5d0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-0001b5e0: 6d61 7420 3d20 6974 656d 4375 7374 6f6d  mat = itemCustom
-0001b5f0: 4461 7465 5469 6d65 466f 726d 6174 0a20  DateTimeFormat. 
-0001b600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b610: 2020 2020 2020 2020 2020 2064 7420 3d20             dt = 
-0001b620: 6461 7465 7469 6d65 2e64 6174 6574 696d  datetime.datetim
-0001b630: 652e 7374 7270 7469 6d65 2873 7562 4974  e.strptime(subIt
-0001b640: 656d 5b27 696d 6167 652d 6461 7465 7469  em['image-dateti
-0001b650: 6d65 275d 2c66 6f72 6d61 7429 0a20 2020  me'],format).   
-0001b660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b670: 2020 2020 2020 2020 2073 7562 4974 656d           subItem
-0001b680: 5b27 696d 6167 652d 6461 7465 7469 6d65  ['image-datetime
-0001b690: 275d 203d 2064 6174 6574 696d 652e 6461  '] = datetime.da
-0001b6a0: 7465 7469 6d65 2e73 7472 6674 696d 6528  tetime.strftime(
-0001b6b0: 6474 2c6d 6971 7476 2e64 6174 655f 666f  dt,miqtv.date_fo
-0001b6c0: 726d 6174 735b 276d 6172 6971 7427 5d29  rmats['mariqt'])
-0001b6d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b6e0: 2020 2020 2020 2020 2065 7863 6570 743a           except:
-0001b6f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b700: 2020 2020 2020 2020 2020 2020 2070 726f               pro
-0001b710: 672e 636c 6561 7228 290a 2020 2020 2020  g.clear().      
-0001b720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b730: 2020 2020 2020 7261 6973 6520 6d69 7174        raise miqt
-0001b740: 632e 4966 646f 4578 6365 7074 696f 6e28  c.IfdoException(
-0001b750: 2749 6e76 616c 6964 2064 6174 6574 696d  'Invalid datetim
-0001b760: 6520 7661 6c75 6527 2c73 7562 4974 656d  e value',subItem
-0001b770: 5b27 696d 6167 652d 6461 7465 7469 6d65  ['image-datetime
-0001b780: 275d 2c20 2264 6f65 7320 6e6f 7420 6d61  '], "does not ma
-0001b790: 7463 6820 666f 726d 6174 2064 6566 6175  tch format defau
-0001b7a0: 6c74 206f 7220 6375 7374 6f6d 2066 6f72  lt or custom for
-0001b7b0: 6d61 7422 290a 2020 2020 2020 2020 6966  mat").        if
-0001b7c0: 2063 7573 746f 6d44 6174 6554 696d 6546   customDateTimeF
-0001b7d0: 6f72 6d61 7446 6f75 6e64 3a0a 2020 2020  ormatFound:.    
-0001b7e0: 2020 2020 2020 2020 7365 6c66 2e70 726f          self.pro
-0001b7f0: 762e 6c6f 6728 2243 7573 746f 6d20 6461  v.log("Custom da
-0001b800: 7465 7469 6d65 2066 6f72 6d61 7473 2066  tetime formats f
-0001b810: 6f75 6e64 2e20 5468 6579 2077 696c 6c20  ound. They will 
-0001b820: 6265 2072 6570 6c61 6365 6420 6279 2074  be replaced by t
-0001b830: 6865 2064 6566 6175 6c74 2066 6f72 6d61  he default forma
-0001b840: 742e 2229 2020 200a 2020 2020 2020 2020  t.")   .        
-0001b850: 7072 6f67 2e63 6c65 6172 2829 2020 2020  prog.clear()    
-0001b860: 0a0a 0a20 2020 2064 6566 205f 5f69 6e69  ...    def __ini
-0001b870: 7449 6e74 6572 6d65 6469 6174 6546 696c  tIntermediateFil
-0001b880: 6573 2873 656c 6629 3a0a 2020 2020 2020  es(self):.      
-0001b890: 2020 7365 6c66 2e69 6e74 6572 6d65 6469    self.intermedi
-0001b8a0: 6174 6546 696c 6573 4465 665f 636f 7265  ateFilesDef_core
-0001b8b0: 203d 207b 0a20 2020 2020 2020 2020 2020   = {.           
-0001b8c0: 2027 6861 7368 6573 273a 207b 0a20 2020   'hashes': {.   
-0001b8d0: 2020 2020 2020 2020 2020 2020 2027 6372               'cr
-0001b8e0: 6561 7469 6f6e 4663 7427 3a20 2763 7265  eationFct': 'cre
-0001b8f0: 6174 655f 696d 6167 655f 7368 6132 3536  ate_image_sha256
-0001b900: 5f66 696c 6528 2927 2c0a 2020 2020 2020  _file()',.      
-0001b910: 2020 2020 2020 2020 2020 2773 7566 6669            'suffi
-0001b920: 7827 3a20 275f 696d 6167 652d 6861 7368  x': '_image-hash
-0001b930: 6573 2e74 7874 272c 0a20 2020 2020 2020  es.txt',.       
-0001b940: 2020 2020 2020 2020 2027 636f 6c73 273a           'cols':
-0001b950: 205b 6d69 7174 762e 636f 6c5f 6865 6164   [miqtv.col_head
-0001b960: 6572 5b27 6d61 7269 7174 275d 5b27 6861  er['mariqt']['ha
-0001b970: 7368 275d 5d2c 0a20 2020 2020 2020 2020  sh']],.         
-0001b980: 2020 2020 2020 2027 6f70 7469 6f6e 616c         'optional
-0001b990: 273a 205b 5d7d 2c0a 2020 2020 2020 2020  ': []},.        
-0001b9a0: 2020 2020 2775 7569 6473 273a 207b 0a20      'uuids': {. 
-0001b9b0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-0001b9c0: 6372 6561 7469 6f6e 4663 7427 3a20 2763  creationFct': 'c
-0001b9d0: 7265 6174 655f 7575 6964 5f66 696c 6528  reate_uuid_file(
-0001b9e0: 2927 2c0a 2020 2020 2020 2020 2020 2020  )',.            
-0001b9f0: 2020 2020 2773 7566 6669 7827 3a20 275f      'suffix': '_
-0001ba00: 696d 6167 652d 7575 6964 732e 7478 7427  image-uuids.txt'
-0001ba10: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001ba20: 2020 2763 6f6c 7327 3a20 5b6d 6971 7476    'cols': [miqtv
-0001ba30: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
-0001ba40: 6971 7427 5d5b 2775 7569 6427 5d5d 2c0a  iqt']['uuid']],.
-0001ba50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ba60: 276f 7074 696f 6e61 6c27 3a20 5b5d 7d2c  'optional': []},
-0001ba70: 0a20 2020 2020 2020 2020 2020 2027 6461  .            'da
-0001ba80: 7465 7469 6d65 273a 207b 0a20 2020 2020  tetime': {.     
-0001ba90: 2020 2020 2020 2020 2020 2027 6372 6561             'crea
-0001baa0: 7469 6f6e 4663 7427 3a20 2763 7265 6174  tionFct': 'creat
-0001bab0: 655f 7374 6172 745f 7469 6d65 5f66 696c  e_start_time_fil
-0001bac0: 6528 2927 2c0a 2020 2020 2020 2020 2020  e()',.          
-0001bad0: 2020 2020 2020 2773 7566 6669 7827 3a20        'suffix': 
-0001bae0: 275f 696d 6167 652d 7374 6172 742d 7469  '_image-start-ti
-0001baf0: 6d65 732e 7478 7427 2c0a 2020 2020 2020  mes.txt',.      
-0001bb00: 2020 2020 2020 2020 2020 2763 6f6c 7327            'cols'
-0001bb10: 3a20 5b6d 6971 7476 2e63 6f6c 5f68 6561  : [miqtv.col_hea
-0001bb20: 6465 725b 276d 6172 6971 7427 5d5b 2775  der['mariqt']['u
-0001bb30: 7463 275d 5d2c 0a20 2020 2020 2020 2020  tc']],.         
-0001bb40: 2020 2020 2020 2027 6f70 7469 6f6e 616c         'optional
-0001bb50: 273a 205b 5d7d 2c0a 2020 2020 2020 2020  ': []},.        
-0001bb60: 2020 2020 276e 6176 6967 6174 696f 6e27      'navigation'
-0001bb70: 3a20 7b0a 2020 2020 2020 2020 2020 2020  : {.            
-0001bb80: 2020 2020 2763 7265 6174 696f 6e46 6374      'creationFct
-0001bb90: 273a 2027 6372 6561 7465 5f69 6d61 6765  ': 'create_image
-0001bba0: 5f6e 6176 6967 6174 696f 6e5f 6669 6c65  _navigation_file
-0001bbb0: 2829 272c 0a20 2020 2020 2020 2020 2020  ()',.           
-0001bbc0: 2020 2020 2027 7375 6666 6978 273a 2027       'suffix': '
-0001bbd0: 5f69 6d61 6765 2d6e 6176 6967 6174 696f  _image-navigatio
-0001bbe0: 6e2e 7478 7427 2c0a 2020 2020 2020 2020  n.txt',.        
-0001bbf0: 2020 2020 2020 2020 2763 6f6c 7327 3a20          'cols': 
-0001bc00: 5b6d 6971 7476 2e63 6f6c 5f68 6561 6465  [miqtv.col_heade
-0001bc10: 725b 276d 6172 6971 7427 5d5b 2775 7463  r['mariqt']['utc
-0001bc20: 275d 5d2c 0a20 2020 2020 2020 2020 2020  ']],.           
-0001bc30: 2020 2020 2027 6f70 7469 6f6e 616c 273a       'optional':
-0001bc40: 205b 6d69 7174 762e 636f 6c5f 6865 6164   [miqtv.col_head
-0001bc50: 6572 5b27 6d61 7269 7174 275d 5b27 6c6f  er['mariqt']['lo
-0001bc60: 6e27 5d2c 206d 6971 7476 2e63 6f6c 5f68  n'], miqtv.col_h
-0001bc70: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
-0001bc80: 276c 6174 275d 2c20 6d69 7174 762e 636f  'lat'], miqtv.co
-0001bc90: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
-0001bca0: 275d 5b27 616c 7427 5d2c 206d 6971 7476  ']['alt'], miqtv
-0001bcb0: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
-0001bcc0: 6971 7427 5d5b 2768 6774 275d 2c20 6d69  iqt']['hgt'], mi
-0001bcd0: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
-0001bce0: 6d61 7269 7174 275d 5b27 756e 6365 7274  mariqt']['uncert
-0001bcf0: 275d 5d7d 2c0a 2020 2020 2020 2020 7d0a  ']]},.        }.
-0001bd00: 0a20 2020 2020 2020 2073 656c 662e 6e6f  .        self.no
-0001bd10: 6e43 6f72 6546 6965 6c64 496e 7465 726d  nCoreFieldInterm
-0001bd20: 6564 6961 7465 4974 656d 496e 666f 4669  ediateItemInfoFi
-0001bd30: 6c65 7320 3d20 5b5d 0a0a 2020 2020 6465  les = []..    de
-0001bd40: 6620 5f5f 6765 745f 696e 745f 6669 6c65  f __get_int_file
-0001bd50: 5f70 7265 6669 7828 7365 6c66 293a 0a20  _prefix(self):. 
-0001bd60: 2020 2020 2020 2022 2222 2064 6570 656e         """ depen
-0001bd70: 6473 206f 6e20 2769 6d61 6765 2d65 7665  ds on 'image-eve
-0001bd80: 6e74 2720 616e 6420 2769 6d61 6765 2d73  nt' and 'image-s
-0001bd90: 656e 736f 7227 2073 6f20 6974 2063 616e  ensor' so it can
-0001bda0: 2063 6861 6e67 6520 6475 7269 6e67 2075   change during u
-0001bdb0: 7061 7465 2022 2222 0a20 2020 2020 2020  pate """.       
-0001bdc0: 2072 6574 7572 6e20 6f73 2e70 6174 682e   return os.path.
-0001bdd0: 6a6f 696e 2873 656c 662e 6469 722e 746f  join(self.dir.to
-0001bde0: 2873 656c 662e 6469 722e 6474 2e69 6e74  (self.dir.dt.int
-0001bdf0: 6572 6d65 6469 6174 6529 2c20 7365 6c66  ermediate), self
-0001be00: 2e66 696e 6454 6d70 4669 656c 6428 2769  .findTmpField('i
-0001be10: 6d61 6765 2d73 6574 2d6e 616d 6527 2929  mage-set-name'))
-0001be20: 0a0a 2020 2020 6465 6620 6765 745f 696e  ..    def get_in
-0001be30: 745f 6861 7368 5f66 696c 6528 7365 6c66  t_hash_file(self
-0001be40: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
-0001be50: 6e20 7365 6c66 2e5f 5f67 6574 5f69 6e74  n self.__get_int
-0001be60: 5f66 696c 655f 7072 6566 6978 2829 202b  _file_prefix() +
-0001be70: 2073 656c 662e 696e 7465 726d 6564 6961   self.intermedia
-0001be80: 7465 4669 6c65 7344 6566 5f63 6f72 655b  teFilesDef_core[
-0001be90: 2768 6173 6865 7327 5d5b 2773 7566 6669  'hashes']['suffi
-0001bea0: 7827 5d0a 0a20 2020 2064 6566 2067 6574  x']..    def get
-0001beb0: 5f69 6e74 5f75 7569 645f 6669 6c65 2873  _int_uuid_file(s
-0001bec0: 656c 6629 3a0a 2020 2020 2020 2020 7265  elf):.        re
-0001bed0: 7475 726e 2073 656c 662e 5f5f 6765 745f  turn self.__get_
-0001bee0: 696e 745f 6669 6c65 5f70 7265 6669 7828  int_file_prefix(
-0001bef0: 2920 2b20 7365 6c66 2e69 6e74 6572 6d65  ) + self.interme
-0001bf00: 6469 6174 6546 696c 6573 4465 665f 636f  diateFilesDef_co
-0001bf10: 7265 5b27 7575 6964 7327 5d5b 2773 7566  re['uuids']['suf
-0001bf20: 6669 7827 5d0a 0a20 2020 2064 6566 2067  fix']..    def g
-0001bf30: 6574 5f69 6e74 5f73 7461 7274 5469 6d65  et_int_startTime
-0001bf40: 735f 6669 6c65 2873 656c 6629 3a0a 2020  s_file(self):.  
-0001bf50: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0001bf60: 662e 5f5f 6765 745f 696e 745f 6669 6c65  f.__get_int_file
-0001bf70: 5f70 7265 6669 7828 2920 2b20 7365 6c66  _prefix() + self
-0001bf80: 2e69 6e74 6572 6d65 6469 6174 6546 696c  .intermediateFil
-0001bf90: 6573 4465 665f 636f 7265 5b27 6461 7465  esDef_core['date
-0001bfa0: 7469 6d65 275d 5b27 7375 6666 6978 275d  time']['suffix']
-0001bfb0: 0a0a 2020 2020 6465 6620 6765 745f 696e  ..    def get_in
-0001bfc0: 745f 6e61 765f 6669 6c65 2873 656c 6629  t_nav_file(self)
-0001bfd0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-0001bfe0: 2073 656c 662e 5f5f 6765 745f 696e 745f   self.__get_int_
-0001bff0: 6669 6c65 5f70 7265 6669 7828 2920 2b20  file_prefix() + 
-0001c000: 7365 6c66 2e69 6e74 6572 6d65 6469 6174  self.intermediat
-0001c010: 6546 696c 6573 4465 665f 636f 7265 5b27  eFilesDef_core['
-0001c020: 6e61 7669 6761 7469 6f6e 275d 5b27 7375  navigation']['su
-0001c030: 6666 6978 275d 0a0a                      ffix']..
+0001a3b0: 7269 7174 275d 293a 0a20 2020 2020 2020  riqt']):.       
+0001a3c0: 2022 2222 2070 6172 7365 7320 6461 7461   """ parses data
+0001a3d0: 2066 726f 6d20 636f 6c75 6d6e 7320 696e   from columns in
+0001a3e0: 2063 6f6c 7320 616e 6420 7772 6974 6573   cols and writes
+0001a3f0: 2069 6e66 6f20 746f 2069 7465 6d73 2e20   info to items. 
+0001a400: 436f 6c75 6d6e 2027 696d 6167 652d 6669  Column 'image-fi
+0001a410: 6c65 6e61 6d65 2720 6d75 7374 2062 6520  lename' must be 
+0001a420: 696e 2066 696c 6520 616e 6420 646f 6573  in file and does
+0001a430: 206e 6f74 206e 6565 6420 746f 2062 6520   not need to be 
+0001a440: 7061 7373 6564 2069 6e20 636f 6c73 2e20  passed in cols. 
+0001a450: 0a20 2020 2020 2020 2020 2020 2046 696c  .            Fil
+0001a460: 6520 6d75 7374 2062 6520 7461 6220 7365  e must be tab se
+0001a470: 7061 7261 7465 6420 616e 6420 636f 6c75  parated and colu
+0001a480: 6d6e 7320 6e61 6d65 7320 6d75 7374 2065  mns names must e
+0001a490: 7175 616c 2069 7465 6d20 6669 656c 6420  qual item field 
+0001a4a0: 6e61 6d65 7322 2222 0a20 2020 2020 2020  names""".       
+0001a4b0: 2074 6d70 5f64 6174 6120 3d20 6d69 7174   tmp_data = miqt
+0001a4c0: 662e 7461 6246 696c 6544 6174 6128 6669  f.tabFileData(fi
+0001a4d0: 6c65 2c20 636f 6c73 2b5b 2769 6d61 6765  le, cols+['image
+0001a4e0: 2d66 696c 656e 616d 6527 5d2b 6f70 7469  -filename']+opti
+0001a4f0: 6f6e 616c 2c20 6b65 795f 636f 6c3d 2769  onal, key_col='i
+0001a500: 6d61 6765 2d66 696c 656e 616d 6527 2c20  mage-filename', 
+0001a510: 6f70 7469 6f6e 616c 3d6f 7074 696f 6e61  optional=optiona
+0001a520: 6c2c 636f 6e76 6572 743d 5472 7565 290a  l,convert=True).
+0001a530: 2020 2020 2020 2020 7365 6c66 2e77 7269          self.wri
+0001a540: 7465 5061 7273 6564 4461 7461 546f 4974  teParsedDataToIt
+0001a550: 656d 7328 746d 705f 6461 7461 2c69 7465  ems(tmp_data,ite
+0001a560: 6d73 2c73 656c 662e 6966 646f 5f74 6d70  ms,self.ifdo_tmp
+0001a570: 5b6d 6971 7476 2e69 6d61 6765 5f73 6574  [miqtv.image_set
+0001a580: 5f68 6561 6465 725f 6b65 795d 2c20 6461  _header_key], da
+0001a590: 7465 7469 6d65 5f66 6f72 6d61 743d 6461  tetime_format=da
+0001a5a0: 7465 7469 6d65 5f66 6f72 6d61 7429 0a0a  tetime_format)..
+0001a5b0: 0a20 2020 2064 6566 2070 7261 7365 4974  .    def praseIt
+0001a5c0: 656d 4461 7461 4672 6f6d 4669 6c65 2873  emDataFromFile(s
+0001a5d0: 656c 662c 6974 656d 733a 6469 6374 2c66  elf,items:dict,f
+0001a5e0: 696c 653a 7374 722c 7365 7061 7261 746f  ile:str,separato
+0001a5f0: 723a 7374 722c 6865 6164 6572 3a64 6963  r:str,header:dic
+0001a600: 742c 2064 6174 6574 696d 655f 666f 726d  t, datetime_form
+0001a610: 6174 3a73 7472 3d6d 6971 7476 2e64 6174  at:str=miqtv.dat
+0001a620: 655f 666f 726d 6174 735b 276d 6172 6971  e_formats['mariq
+0001a630: 7427 5d29 3a0a 2020 2020 2020 2020 2222  t']):.        ""
+0001a640: 2220 7061 7273 6573 2064 6174 6120 6672  " parses data fr
+0001a650: 6f6d 2066 726f 6d20 6669 6c65 2074 6f20  om from file to 
+0001a660: 6974 656d 732e 2068 6561 6465 7220 6469  items. header di
+0001a670: 6374 206d 7573 7420 6265 206f 6620 7374  ct must be of st
+0001a680: 7275 6374 7572 653a 207b 3c69 7465 6d2d  ructure: {<item-
+0001a690: 6669 656c 642d 6e61 6d65 3e3a 3c63 6f6c  field-name>:<col
+0001a6a0: 756d 6e2d 6e61 6d65 3e7d 0a20 2020 2020  umn-name>}.     
+0001a6b0: 2020 2020 2020 2061 6e64 206d 7573 7420         and must 
+0001a6c0: 636f 6e74 6169 6e20 656e 7472 7920 2769  contain entry 'i
+0001a6d0: 6d61 6765 2d66 696c 656e 616d 6527 2022  mage-filename' "
+0001a6e0: 2222 0a20 2020 2020 2020 2069 6620 6e6f  "".        if no
+0001a6f0: 7420 2769 6d61 6765 2d66 696c 656e 616d  t 'image-filenam
+0001a700: 6527 2069 6e20 6865 6164 6572 3a0a 2020  e' in header:.  
+0001a710: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0001a720: 4578 6365 7074 696f 6e28 2268 6561 6465  Exception("heade
+0001a730: 7220 646f 6573 206e 6f74 2063 6f6e 7461  r does not conta
+0001a740: 696e 2027 696d 6167 652d 6669 6c65 6e61  in 'image-filena
+0001a750: 6d65 2722 290a 2020 2020 2020 2020 0a20  me'").        . 
+0001a760: 2020 2020 2020 2074 6d70 5f64 6174 6120         tmp_data 
+0001a770: 3d20 6d69 7174 662e 7461 6246 696c 6544  = miqtf.tabFileD
+0001a780: 6174 6128 6669 6c65 2c20 6865 6164 6572  ata(file, header
+0001a790: 2c63 6f6c 5f73 6570 6172 6174 6f72 3d73  ,col_separator=s
+0001a7a0: 6570 6172 6174 6f72 2c20 6b65 795f 636f  eparator, key_co
+0001a7b0: 6c3d 2769 6d61 6765 2d66 696c 656e 616d  l='image-filenam
+0001a7c0: 6527 2c63 6f6e 7665 7274 3d54 7275 6529  e',convert=True)
+0001a7d0: 0a20 2020 2020 2020 2073 656c 662e 7772  .        self.wr
+0001a7e0: 6974 6550 6172 7365 6444 6174 6154 6f49  iteParsedDataToI
+0001a7f0: 7465 6d73 2874 6d70 5f64 6174 612c 6974  tems(tmp_data,it
+0001a800: 656d 732c 7365 6c66 2e69 6664 6f5f 746d  ems,self.ifdo_tm
+0001a810: 705b 6d69 7174 762e 696d 6167 655f 7365  p[miqtv.image_se
+0001a820: 745f 6865 6164 6572 5f6b 6579 5d2c 2064  t_header_key], d
+0001a830: 6174 6574 696d 655f 666f 726d 6174 3d64  atetime_format=d
+0001a840: 6174 6574 696d 655f 666f 726d 6174 290a  atetime_format).
+0001a850: 0a0a 2020 2020 6465 6620 7772 6974 6550  ..    def writeP
+0001a860: 6172 7365 6444 6174 6154 6f49 7465 6d73  arsedDataToItems
+0001a870: 2873 656c 662c 6461 7461 3a64 6963 742c  (self,data:dict,
+0001a880: 6974 656d 733a 6469 6374 2c68 6561 6465  items:dict,heade
+0001a890: 723a 6469 6374 2c20 6461 7465 7469 6d65  r:dict, datetime
+0001a8a0: 5f66 6f72 6d61 743a 7374 723d 6d69 7174  _format:str=miqt
+0001a8b0: 762e 6461 7465 5f66 6f72 6d61 7473 5b27  v.date_formats['
+0001a8c0: 6d61 7269 7174 275d 293a 0a0a 2020 2020  mariqt']):..    
+0001a8d0: 2020 2020 2320 6576 616c 2073 7472 696e      # eval strin
+0001a8e0: 6773 2061 7320 6469 6374 206f 7220 6c69  gs as dict or li
+0001a8f0: 7374 0a20 2020 2020 2020 206d 6971 7463  st.        miqtc
+0001a900: 2e72 6563 7572 7369 7665 4576 616c 2864  .recursiveEval(d
+0001a910: 6174 6129 0a0a 2020 2020 2020 2020 2320  ata)..        # 
+0001a920: 706f 7465 6e74 6169 6c6c 7920 7265 6d6f  potentailly remo
+0001a930: 7665 2063 6f6e 7374 2064 6174 6120 6672  ve const data fr
+0001a940: 6f6d 2069 7465 6d73 2061 6e64 2070 7574  om items and put
+0001a950: 2069 6e20 6865 6164 6572 0a20 2020 2020   in header.     
+0001a960: 2020 2073 656c 662e 6578 7472 6163 7443     self.extractC
+0001a970: 6f6e 7374 4461 7461 5661 6c75 6573 2864  onstDataValues(d
+0001a980: 6174 612c 6865 6164 6572 290a 0a20 2020  ata,header)..   
+0001a990: 2020 2020 2064 6174 6120 3d20 6d69 7174       data = miqt
+0001a9a0: 632e 7265 6375 7273 6976 656c 7952 656d  c.recursivelyRem
+0001a9b0: 6f76 6545 6d70 7479 4669 656c 6473 2864  oveEmptyFields(d
+0001a9c0: 6174 612c 636f 6e74 656e 7432 6265 5265  ata,content2beRe
+0001a9d0: 6d6f 7665 643d 4e6f 6e65 290a 0a20 2020  moved=None)..   
+0001a9e0: 2020 2020 2023 2061 6464 2027 696d 6167       # add 'imag
+0001a9f0: 652d 6669 6c65 6e61 6d65 2720 6669 656c  e-filename' fiel
+0001aa00: 640a 2020 2020 2020 2020 666f 7220 696d  d.        for im
+0001aa10: 672c 2065 6e74 7279 2069 6e20 6461 7461  g, entry in data
+0001aa20: 2e69 7465 6d73 2829 3a0a 0a20 2020 2020  .items():..     
+0001aa30: 2020 2020 2020 2023 206c 6973 740a 2020         # list.  
+0001aa40: 2020 2020 2020 2020 2020 6966 2069 7369            if isi
+0001aa50: 6e73 7461 6e63 6528 656e 7472 792c 6c69  nstance(entry,li
+0001aa60: 7374 293a 0a20 2020 2020 2020 2020 2020  st):.           
+0001aa70: 2020 2020 2066 6f72 206c 6973 7449 7465       for listIte
+0001aa80: 6d20 696e 2065 6e74 7279 3a0a 2020 2020  m in entry:.    
+0001aa90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aaa0: 6c69 7374 4974 656d 5b27 696d 6167 652d  listItem['image-
+0001aab0: 6669 6c65 6e61 6d65 275d 203d 2069 6d67  filename'] = img
+0001aac0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001aad0: 2020 2020 2023 2063 6f76 6572 7420 6461       # covert da
+0001aae0: 7465 7469 6d65 2073 7472 696e 670a 2020  tetime string.  
+0001aaf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ab00: 2020 6966 2027 696d 6167 652d 6461 7465    if 'image-date
+0001ab10: 7469 6d65 2720 696e 206c 6973 7449 7465  time' in listIte
+0001ab20: 6d3a 0a20 2020 2020 2020 2020 2020 2020  m:.             
+0001ab30: 2020 2020 2020 2020 2020 2064 7420 3d20             dt = 
+0001ab40: 6461 7465 7469 6d65 2e64 6174 6574 696d  datetime.datetim
+0001ab50: 652e 7374 7270 7469 6d65 286c 6973 7449  e.strptime(listI
+0001ab60: 7465 6d5b 2769 6d61 6765 2d64 6174 6574  tem['image-datet
+0001ab70: 696d 6527 5d2c 2064 6174 6574 696d 655f  ime'], datetime_
+0001ab80: 666f 726d 6174 290a 2020 2020 2020 2020  format).        
+0001ab90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aba0: 6c69 7374 4974 656d 5b27 696d 6167 652d  listItem['image-
+0001abb0: 6461 7465 7469 6d65 275d 203d 2064 742e  datetime'] = dt.
+0001abc0: 7374 7266 7469 6d65 286d 6971 7476 2e64  strftime(miqtv.d
+0001abd0: 6174 655f 666f 726d 6174 735b 276d 6172  ate_formats['mar
+0001abe0: 6971 7427 5d29 0a20 2020 2020 2020 2020  iqt']).         
+0001abf0: 2020 2065 6c69 6620 6973 696e 7374 616e     elif isinstan
+0001ac00: 6365 2865 6e74 7279 2c64 6963 7429 3a0a  ce(entry,dict):.
+0001ac10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ac20: 656e 7472 795b 2769 6d61 6765 2d66 696c  entry['image-fil
+0001ac30: 656e 616d 6527 5d20 3d20 696d 670a 2020  ename'] = img.  
+0001ac40: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0001ac50: 636f 7665 7274 2064 6174 6574 696d 6520  covert datetime 
+0001ac60: 7374 7269 6e67 0a20 2020 2020 2020 2020  string.         
+0001ac70: 2020 2020 2020 2069 6620 2769 6d61 6765         if 'image
+0001ac80: 2d64 6174 6574 696d 6527 2069 6e20 656e  -datetime' in en
+0001ac90: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+0001aca0: 2020 2020 2020 2020 2064 7420 3d20 6461           dt = da
+0001acb0: 7465 7469 6d65 2e64 6174 6574 696d 652e  tetime.datetime.
+0001acc0: 7374 7270 7469 6d65 2865 6e74 7279 5b27  strptime(entry['
+0001acd0: 696d 6167 652d 6461 7465 7469 6d65 275d  image-datetime']
+0001ace0: 2c20 6461 7465 7469 6d65 5f66 6f72 6d61  , datetime_forma
+0001acf0: 7429 0a20 2020 2020 2020 2020 2020 2020  t).             
+0001ad00: 2020 2020 2020 2065 6e74 7279 5b27 696d         entry['im
+0001ad10: 6167 652d 6461 7465 7469 6d65 275d 203d  age-datetime'] =
+0001ad20: 2064 742e 7374 7266 7469 6d65 286d 6971   dt.strftime(miq
+0001ad30: 7476 2e64 6174 655f 666f 726d 6174 735b  tv.date_formats[
+0001ad40: 276d 6172 6971 7427 5d29 0a20 2020 2020  'mariqt']).     
+0001ad50: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0001ad60: 2020 2020 2020 2020 2020 2020 2072 6169               rai
+0001ad70: 7365 206d 6971 7463 2e49 6664 6f45 7863  se miqtc.IfdoExc
+0001ad80: 6570 7469 6f6e 2822 6461 7461 2065 6e74  eption("data ent
+0001ad90: 7269 6573 206d 7573 7420 6265 2064 6963  ries must be dic
+0001ada0: 7420 6f72 206c 6973 7420 6966 2064 6963  t or list if dic
+0001adb0: 7473 2229 0a0a 2020 2020 2020 2020 6d69  ts")..        mi
+0001adc0: 7174 632e 7265 6375 7273 6976 656c 7955  qtc.recursivelyU
+0001add0: 7064 6174 6544 6963 7473 2869 7465 6d73  pdateDicts(items
+0001ade0: 2c64 6174 6129 0a0a 0a20 2020 2040 7374  ,data)...    @st
+0001adf0: 6174 6963 6d65 7468 6f64 0a20 2020 2064  aticmethod.    d
+0001ae00: 6566 2065 7874 7261 6374 436f 6e73 7444  ef extractConstD
+0001ae10: 6174 6156 616c 7565 7328 6461 7461 3a64  ataValues(data:d
+0001ae20: 6963 742c 6865 6164 6572 3a64 6963 7429  ict,header:dict)
+0001ae30: 3a0a 2020 2020 2020 2020 2222 2220 5265  :.        """ Re
+0001ae40: 6d6f 7665 7320 6669 656c 6473 2074 6861  moves fields tha
+0001ae50: 7420 6172 6520 636f 6e73 7461 6e74 2066  t are constant f
+0001ae60: 6f72 2061 6c6c 2065 6e74 7269 6573 2066  or all entries f
+0001ae70: 726f 6d20 6461 7461 2064 6963 7420 616e  rom data dict an
+0001ae80: 6420 7075 7420 7468 656d 2069 6e20 6865  d put them in he
+0001ae90: 6164 6572 2064 6963 742e 200a 2020 2020  ader dict. .    
+0001aea0: 2020 2020 2020 2020 4561 6368 2065 6e74          Each ent
+0001aeb0: 7279 206f 6620 6461 7461 206d 7573 7420  ry of data must 
+0001aec0: 6265 2061 2064 6963 7420 7769 7468 2074  be a dict with t
+0001aed0: 6865 2073 616d 6520 7365 7420 6f66 206b  he same set of k
+0001aee0: 6579 732e 2022 2222 0a20 2020 200a 2020  eys. """.    .  
+0001aef0: 2020 2020 2020 6669 656c 6473 546f 4967        fieldsToIg
+0001af00: 6e6f 7265 203d 205b 2769 6d61 6765 2d64  nore = ['image-d
+0001af10: 6174 6574 696d 6527 5d0a 2020 2020 2020  atetime'].      
+0001af20: 2020 636f 6e73 7444 6174 6120 3d20 7b7d    constData = {}
+0001af30: 0a20 2020 2020 2020 2066 6972 7374 496d  .        firstIm
+0001af40: 6167 6520 3d20 5472 7565 0a20 2020 2020  age = True.     
+0001af50: 2020 2066 6f72 2069 6d61 6765 2c69 6d61     for image,ima
+0001af60: 6765 5f64 6174 6120 696e 2064 6174 612e  ge_data in data.
+0001af70: 6974 656d 7328 293a 0a20 2020 2020 2020  items():.       
+0001af80: 2020 2020 200a 2020 2020 2020 2020 2020       .          
+0001af90: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
+0001afa0: 6e63 6528 696d 6167 655f 6461 7461 2c6c  nce(image_data,l
+0001afb0: 6973 7429 3a0a 2020 2020 2020 2020 2020  ist):.          
+0001afc0: 2020 2020 2020 696d 6167 655f 6461 7461        image_data
+0001afd0: 203d 205b 696d 6167 655f 6461 7461 5d0a   = [image_data].
+0001afe0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0001aff0: 6e6f 7420 6669 7273 7449 6d61 6765 2061  not firstImage a
+0001b000: 6e64 2063 6f6e 7374 4461 7461 203d 3d20  nd constData == 
+0001b010: 7b7d 3a0a 2020 2020 2020 2020 2020 2020  {}:.            
+0001b020: 2020 2020 6272 6561 6b0a 2020 2020 2020      break.      
+0001b030: 2020 2020 2020 0a20 2020 2020 2020 2020        .         
+0001b040: 2020 2066 6972 7374 5469 6d65 506f 696e     firstTimePoin
+0001b050: 7420 3d20 5472 7565 0a20 2020 2020 2020  t = True.       
+0001b060: 2020 2020 2066 6f72 2069 6d61 6765 5f74       for image_t
+0001b070: 705f 6461 7461 2069 6e20 696d 6167 655f  p_data in image_
+0001b080: 6461 7461 3a0a 2020 2020 2020 2020 2020  data:.          
+0001b090: 2020 2020 2020 2320 7665 7279 2066 6972        # very fir
+0001b0a0: 7374 2064 6174 6120 666f 7220 636f 6d70  st data for comp
+0001b0b0: 6172 6973 6f6e 0a20 2020 2020 2020 2020  arison.         
+0001b0c0: 2020 2020 2020 2069 6620 6669 7273 7449         if firstI
+0001b0d0: 6d61 6765 2061 6e64 2066 6972 7374 5469  mage and firstTi
+0001b0e0: 6d65 506f 696e 743a 0a20 2020 2020 2020  mePoint:.       
+0001b0f0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+0001b100: 7374 4461 7461 203d 2063 6f70 792e 6465  stData = copy.de
+0001b110: 6570 636f 7079 2869 6d61 6765 5f74 705f  epcopy(image_tp_
+0001b120: 6461 7461 290a 2020 2020 2020 2020 2020  data).          
+0001b130: 2020 2020 2020 2020 2020 666f 7220 6669            for fi
+0001b140: 656c 6420 696e 2066 6965 6c64 7354 6f49  eld in fieldsToI
+0001b150: 676e 6f72 653a 0a20 2020 2020 2020 2020  gnore:.         
+0001b160: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001b170: 6620 6669 656c 6420 696e 2063 6f6e 7374  f field in const
+0001b180: 4461 7461 3a0a 2020 2020 2020 2020 2020  Data:.          
+0001b190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b1a0: 2020 6465 6c20 636f 6e73 7444 6174 615b    del constData[
+0001b1b0: 6669 656c 645d 0a20 2020 2020 2020 2020  field].         
+0001b1c0: 2020 2020 2020 2020 2020 2066 6972 7374             first
+0001b1d0: 5469 6d65 506f 696e 7420 3d20 4661 6c73  TimePoint = Fals
+0001b1e0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+0001b1f0: 2020 2020 2020 636f 6e74 696e 7565 0a0a        continue..
+0001b200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b210: 636f 6e73 7444 6174 6120 3d20 6d69 7174  constData = miqt
+0001b220: 632e 6669 6e64 436f 6d6d 6f6e 4469 6374  c.findCommonDict
+0001b230: 456c 656d 656e 7473 2869 6d61 6765 5f74  Elements(image_t
+0001b240: 705f 6461 7461 2c63 6f6e 7374 4461 7461  p_data,constData
+0001b250: 290a 0a20 2020 2020 2020 2020 2020 2066  )..            f
+0001b260: 6972 7374 496d 6167 6520 3d20 4661 6c73  irstImage = Fals
+0001b270: 650a 0a20 2020 2020 2020 2023 2054 4f44  e..        # TOD
+0001b280: 4f20 6368 6563 6b20 7769 7468 696e 2069  O check within i
+0001b290: 6d61 6765 2074 696d 6573 202d 3e20 746f  mage times -> to
+0001b2a0: 2069 6d61 6765 2064 6566 6175 6c74 2e20   image default. 
+0001b2b0: 2874 7269 636b 7920 7369 6e63 6520 7765  (tricky since we
+0001b2c0: 2064 6f6e 2774 2068 6176 6520 7468 6520   don't have the 
+0001b2d0: 6461 6661 756c 7420 696e 6465 7820 6865  dafault index he
+0001b2e0: 7265 2e20 4f6e 6c79 2061 2073 7562 7365  re. Only a subse
+0001b2f0: 7420 6d69 6768 7420 6265 2075 7064 6174  t might be updat
+0001b300: 6520 6865 7265 290a 2020 2020 2020 2020  e here).        
+0001b310: 2320 6368 6563 6b20 7769 7468 696e 2069  # check within i
+0001b320: 6d61 6765 2069 7465 6d73 202d 3e20 6865  mage items -> he
+0001b330: 6164 6572 0a20 2020 2020 2020 2068 6561  ader.        hea
+0001b340: 6465 7255 7064 6174 6520 3d20 636f 7079  derUpdate = copy
+0001b350: 2e64 6565 7063 6f70 7928 636f 6e73 7444  .deepcopy(constD
+0001b360: 6174 6129 0a20 2020 2020 2020 2068 6561  ata).        hea
+0001b370: 6465 7255 7064 6174 6564 5465 7374 203d  derUpdatedTest =
+0001b380: 2063 6f70 792e 6465 6570 636f 7079 2868   copy.deepcopy(h
+0001b390: 6561 6465 7229 0a20 2020 2020 2020 206d  eader).        m
+0001b3a0: 6971 7463 2e72 6563 7572 7369 7665 6c79  iqtc.recursively
+0001b3b0: 5570 6461 7465 4469 6374 7328 6865 6164  UpdateDicts(head
+0001b3c0: 6572 5570 6461 7465 6454 6573 742c 6865  erUpdatedTest,he
+0001b3d0: 6164 6572 5570 6461 7465 290a 2020 2020  aderUpdate).    
+0001b3e0: 2020 2020 7570 6461 7465 4469 6666 203d      updateDiff =
+0001b3f0: 2044 6565 7044 6966 6628 6865 6164 6572   DeepDiff(header
+0001b400: 2c68 6561 6465 7255 7064 6174 6564 5465  ,headerUpdatedTe
+0001b410: 7374 290a 2020 2020 2020 2020 2320 6368  st).        # ch
+0001b420: 6563 6b20 6966 2068 6561 6465 7255 7064  eck if headerUpd
+0001b430: 6174 6520 776f 756c 6420 6f76 6572 7772  ate would overwr
+0001b440: 6974 6520 616e 7974 6869 6e67 2066 726f  ite anything fro
+0001b450: 6d20 6375 7272 656e 7420 6865 6164 6572  m current header
+0001b460: 2028 7368 6f75 6c64 206e 6f74 2068 6170   (should not hap
+0001b470: 7065 6e29 2c20 6966 2073 6f20 646f 6e74  pen), if so dont
+0001b480: 2072 656d 6f76 6520 6672 6f6d 2069 7465   remove from ite
+0001b490: 6d73 0a20 2020 2020 2020 2069 6620 6e6f  ms.        if no
+0001b4a0: 7420 2776 616c 7565 735f 6368 616e 6765  t 'values_change
+0001b4b0: 6427 2069 6e20 7570 6461 7465 4469 6666  d' in updateDiff
+0001b4c0: 2061 6e64 206e 6f74 2027 7479 7065 5f63   and not 'type_c
+0001b4d0: 6861 6e67 6573 2720 696e 2075 7064 6174  hanges' in updat
+0001b4e0: 6544 6966 6620 616e 6420 6e6f 7420 2764  eDiff and not 'd
+0001b4f0: 6963 7469 6f6e 6172 795f 6974 656d 5f72  ictionary_item_r
+0001b500: 656d 6f76 6564 2720 696e 2075 7064 6174  emoved' in updat
+0001b510: 6544 6966 663a 0a20 2020 2020 2020 2020  eDiff:.         
+0001b520: 2020 2068 6561 6465 722e 636c 6561 7228     header.clear(
+0001b530: 290a 2020 2020 2020 2020 2020 2020 6865  ).            he
+0001b540: 6164 6572 2e75 7064 6174 6528 6865 6164  ader.update(head
+0001b550: 6572 5570 6461 7465 6454 6573 7429 0a0a  erUpdatedTest)..
+0001b560: 2020 2020 2020 2020 2020 2020 2320 7265              # re
+0001b570: 6d6f 7665 2063 6f6e 7374 2076 616c 7565  move const value
+0001b580: 7320 6672 6f6d 2064 6174 610a 2020 2020  s from data.    
+0001b590: 2020 2020 2020 2020 6d69 7174 632e 7265          miqtc.re
+0001b5a0: 6375 7273 6976 654d 616b 654e 6f6e 6544  cursiveMakeNoneD
+0001b5b0: 6963 7446 6965 6c64 7345 6d70 7479 5374  ictFieldsEmptySt
+0001b5c0: 7228 636f 6e73 7444 6174 6129 0a20 2020  r(constData).   
+0001b5d0: 2020 2020 2020 2020 2066 6f72 2069 6d61           for ima
+0001b5e0: 6765 2c69 6d61 6765 5f64 6174 6120 696e  ge,image_data in
+0001b5f0: 2064 6174 612e 6974 656d 7328 293a 0a20   data.items():. 
+0001b600: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001b610: 6620 6e6f 7420 6973 696e 7374 616e 6365  f not isinstance
+0001b620: 2869 6d61 6765 5f64 6174 612c 6c69 7374  (image_data,list
+0001b630: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0001b640: 2020 2020 2020 2069 6d61 6765 5f64 6174         image_dat
+0001b650: 6120 3d20 5b69 6d61 6765 5f64 6174 615d  a = [image_data]
+0001b660: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b670: 2066 6f72 2069 6d61 6765 5f74 705f 6461   for image_tp_da
+0001b680: 7461 2069 6e20 696d 6167 655f 6461 7461  ta in image_data
+0001b690: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001b6a0: 2020 2020 2020 6d69 7174 632e 7265 6375        miqtc.recu
+0001b6b0: 7273 6976 656c 7955 7064 6174 6544 6963  rsivelyUpdateDic
+0001b6c0: 7473 2869 6d61 6765 5f74 705f 6461 7461  ts(image_tp_data
+0001b6d0: 2c63 6f6e 7374 4461 7461 2920 2020 2020  ,constData)     
+0001b6e0: 2020 2020 200a 0a20 2020 2020 2020 2065       ..        e
+0001b6f0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0001b700: 2070 6173 730a 2020 2020 2020 2020 2020   pass.          
+0001b710: 2020 2320 544f 444f 206c 6f67 3f0a 2020    # TODO log?.  
+0001b720: 2020 200a 0a20 2020 2064 6566 2069 6e74     ..    def int
+0001b730: 6572 6d65 6469 6174 654e 6176 4669 6c65  ermediateNavFile
+0001b740: 4578 6973 7473 2873 656c 6629 3a0a 2020  Exists(self):.  
+0001b750: 2020 2020 2020 6966 206f 732e 7061 7468        if os.path
+0001b760: 2e65 7869 7374 7328 7365 6c66 2e67 6574  .exists(self.get
+0001b770: 5f69 6e74 5f6e 6176 5f66 696c 6528 2929  _int_nav_file())
+0001b780: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0001b790: 7475 726e 2054 7275 650a 2020 2020 2020  turn True.      
+0001b7a0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0001b7b0: 2020 2020 7265 7475 726e 2046 616c 7365      return False
+0001b7c0: 0a0a 0a20 2020 2064 6566 2068 6561 6465  ...    def heade
+0001b7d0: 7246 6965 6c64 4669 6c6c 6564 2873 656c  rFieldFilled(sel
+0001b7e0: 662c 6669 656c 643a 7374 7229 3a0a 2020  f,field:str):.  
+0001b7f0: 2020 2020 2020 6966 2073 656c 662e 6669        if self.fi
+0001b800: 6e64 546d 7046 6965 6c64 3228 6669 656c  ndTmpField2(fiel
+0001b810: 6429 203d 3d20 2222 3a0a 2020 2020 2020  d) == "":.      
+0001b820: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+0001b830: 7365 0a20 2020 2020 2020 2072 6574 7572  se.        retur
+0001b840: 6e20 5472 7565 0a0a 2020 2020 6465 6620  n True..    def 
+0001b850: 636f 6e76 6572 7454 6f44 6566 6175 6c74  convertToDefault
+0001b860: 4461 7465 5469 6d65 466f 726d 6174 2873  DateTimeFormat(s
+0001b870: 656c 662c 6966 646f 293a 0a20 2020 2020  elf,ifdo):.     
+0001b880: 2020 2022 2222 2043 6865 636b 7320 6966     """ Checks if
+0001b890: 2061 6c6c 2069 7465 6d73 2720 2769 6d61   all items' 'ima
+0001b8a0: 6765 2d64 6174 6574 696d 6527 2066 6965  ge-datetime' fie
+0001b8b0: 6c64 7320 6d61 7463 6820 6465 6661 756c  lds match defaul
+0001b8c0: 7420 6461 7465 7469 6d65 2066 6f72 6d61  t datetime forma
+0001b8d0: 7420 6f72 2061 2063 7573 746f 6d20 6f6e  t or a custom on
+0001b8e0: 6520 6465 6669 6e65 6420 696e 2027 696d  e defined in 'im
+0001b8f0: 6167 652d 6461 7465 7469 6d65 2d66 6f72  age-datetime-for
+0001b900: 6d61 7427 0a20 2020 2020 2020 2020 2020  mat'.           
+0001b910: 2061 6e64 2063 6f6e 7665 7274 7320 746f   and converts to
+0001b920: 2064 6566 6175 6c74 2066 6f72 6d61 742e   default format.
+0001b930: 2054 6872 6f77 7320 6578 6365 7074 696f   Throws exceptio
+0001b940: 6e20 6966 2064 6174 6574 696d 6520 6361  n if datetime ca
+0001b950: 6e6e 6f74 2062 6520 7061 7273 6564 2022  nnot be parsed "
+0001b960: 2222 0a20 2020 2020 2020 2063 7573 746f  "".        custo
+0001b970: 6d44 6174 6554 696d 6546 6f72 6d61 7446  mDateTimeFormatF
+0001b980: 6f75 6e64 203d 2046 616c 7365 0a20 2020  ound = False.   
+0001b990: 2020 2020 2068 6561 6465 7243 7573 746f       headerCusto
+0001b9a0: 6d44 6174 6554 696d 6546 6f72 6d61 7420  mDateTimeFormat 
+0001b9b0: 3d20 6669 6e64 4669 656c 6428 6966 646f  = findField(ifdo
+0001b9c0: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
+0001b9d0: 6164 6572 4b65 795d 2c27 696d 6167 652d  aderKey],'image-
+0001b9e0: 6461 7465 7469 6d65 2d66 6f72 6d61 7427  datetime-format'
+0001b9f0: 290a 2020 2020 2020 2020 6966 2068 6561  ).        if hea
+0001ba00: 6465 7243 7573 746f 6d44 6174 6554 696d  derCustomDateTim
+0001ba10: 6546 6f72 6d61 7420 213d 2022 223a 0a20  eFormat != "":. 
+0001ba20: 2020 2020 2020 2020 2020 2069 6664 6f5b             ifdo[
+0001ba30: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
+0001ba40: 6465 724b 6579 5d5b 2769 6d61 6765 2d64  derKey]['image-d
+0001ba50: 6174 6574 696d 652d 666f 726d 6174 275d  atetime-format']
+0001ba60: 203d 2022 2220 2320 7265 6d6f 7665 2063   = "" # remove c
+0001ba70: 7573 746f 6d20 666f 726d 6174 0a20 2020  ustom format.   
+0001ba80: 2020 2020 2020 2020 2063 7573 746f 6d44           customD
+0001ba90: 6174 6554 696d 6546 6f72 6d61 7446 6f75  ateTimeFormatFou
+0001baa0: 6e64 203d 2054 7275 650a 2020 2020 2020  nd = True.      
+0001bab0: 2020 7072 6f67 203d 206d 6971 7463 2e50    prog = miqtc.P
+0001bac0: 7269 6e74 4b6e 6f77 6e50 726f 6772 6573  rintKnownProgres
+0001bad0: 734d 7367 2822 4368 6563 6b69 6e67 2064  sMsg("Checking d
+0001bae0: 6174 6574 696d 6520 666f 726d 6174 222c  atetime format",
+0001baf0: 206c 656e 2869 6664 6f5b 7365 6c66 2e69   len(ifdo[self.i
+0001bb00: 6d61 6765 5365 7449 7465 6d73 4b65 795d  mageSetItemsKey]
+0001bb10: 292c 6d6f 6475 6c6f 3d31 290a 2020 2020  ),modulo=1).    
+0001bb20: 2020 2020 666f 7220 6669 6c65 2c69 7465      for file,ite
+0001bb30: 6d20 696e 2069 6664 6f5b 7365 6c66 2e69  m in ifdo[self.i
+0001bb40: 6d61 6765 5365 7449 7465 6d73 4b65 795d  mageSetItemsKey]
+0001bb50: 2e69 7465 6d73 2829 3a0a 2020 2020 2020  .items():.      
+0001bb60: 2020 2020 2020 7072 6f67 2e70 726f 6772        prog.progr
+0001bb70: 6573 7328 290a 2020 2020 2020 2020 2020  ess().          
+0001bb80: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
+0001bb90: 6e63 6528 6974 656d 2c6c 6973 7429 3a0a  nce(item,list):.
+0001bba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bbb0: 2020 2020 6974 656d 203d 205b 6974 656d      item = [item
+0001bbc0: 5d0a 2020 2020 2020 2020 2020 2020 7375  ].            su
+0001bbd0: 6249 7465 6d44 6566 6175 6c74 203d 2069  bItemDefault = i
+0001bbe0: 7465 6d5b 305d 0a20 2020 2020 2020 2020  tem[0].         
+0001bbf0: 2020 2069 7465 6d43 7573 746f 6d44 6174     itemCustomDat
+0001bc00: 6554 696d 6546 6f72 6d61 7420 3d20 2222  eTimeFormat = ""
+0001bc10: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0001bc20: 2769 6d61 6765 2d64 6174 6574 696d 652d  'image-datetime-
+0001bc30: 666f 726d 6174 2720 696e 2073 7562 4974  format' in subIt
+0001bc40: 656d 4465 6661 756c 743a 0a20 2020 2020  emDefault:.     
+0001bc50: 2020 2020 2020 2020 2020 2069 7465 6d43             itemC
+0001bc60: 7573 746f 6d44 6174 6554 696d 6546 6f72  ustomDateTimeFor
+0001bc70: 6d61 7420 3d20 7375 6249 7465 6d44 6566  mat = subItemDef
+0001bc80: 6175 6c74 5b27 696d 6167 652d 6461 7465  ault['image-date
+0001bc90: 7469 6d65 2d66 6f72 6d61 7427 5d0a 2020  time-format'].  
+0001bca0: 2020 2020 2020 2020 2020 2020 2020 7375                su
+0001bcb0: 6249 7465 6d44 6566 6175 6c74 5b27 696d  bItemDefault['im
+0001bcc0: 6167 652d 6461 7465 7469 6d65 2d66 6f72  age-datetime-for
+0001bcd0: 6d61 7427 5d20 3d20 2222 2023 2072 656d  mat'] = "" # rem
+0001bce0: 6f76 6520 6375 7374 6f6d 2066 6f72 6d61  ove custom forma
+0001bcf0: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
+0001bd00: 2020 6375 7374 6f6d 4461 7465 5469 6d65    customDateTime
+0001bd10: 466f 726d 6174 466f 756e 6420 3d20 5472  FormatFound = Tr
+0001bd20: 7565 0a20 2020 2020 2020 2020 2020 2066  ue.            f
+0001bd30: 6f72 2073 7562 4974 656d 2069 6e20 6974  or subItem in it
+0001bd40: 656d 3a0a 2020 2020 2020 2020 2020 2020  em:.            
+0001bd50: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+0001bd60: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0001bd70: 6d61 7420 3d20 6d69 7174 762e 6461 7465  mat = miqtv.date
+0001bd80: 5f66 6f72 6d61 7473 5b27 6d61 7269 7174  _formats['mariqt
+0001bd90: 275d 0a20 2020 2020 2020 2020 2020 2020  '].             
+0001bda0: 2020 2020 2020 2064 6174 6574 696d 652e         datetime.
+0001bdb0: 6461 7465 7469 6d65 2e73 7472 7074 696d  datetime.strptim
+0001bdc0: 6528 7375 6249 7465 6d5b 2769 6d61 6765  e(subItem['image
+0001bdd0: 2d64 6174 6574 696d 6527 5d2c 666f 726d  -datetime'],form
+0001bde0: 6174 290a 2020 2020 2020 2020 2020 2020  at).            
+0001bdf0: 2020 2020 6578 6365 7074 3a0a 2020 2020      except:.    
+0001be00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001be10: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+0001be20: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0001be30: 6d61 7420 3d20 6865 6164 6572 4375 7374  mat = headerCust
+0001be40: 6f6d 4461 7465 5469 6d65 466f 726d 6174  omDateTimeFormat
+0001be50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001be60: 2020 2020 2020 2020 2064 7420 3d20 6461           dt = da
+0001be70: 7465 7469 6d65 2e64 6174 6574 696d 652e  tetime.datetime.
+0001be80: 7374 7270 7469 6d65 2873 7562 4974 656d  strptime(subItem
+0001be90: 5b27 696d 6167 652d 6461 7465 7469 6d65  ['image-datetime
+0001bea0: 275d 2c66 6f72 6d61 7429 0a20 2020 2020  '],format).     
+0001beb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bec0: 2020 2073 7562 4974 656d 5b27 696d 6167     subItem['imag
+0001bed0: 652d 6461 7465 7469 6d65 275d 203d 2064  e-datetime'] = d
+0001bee0: 6174 6574 696d 652e 6461 7465 7469 6d65  atetime.datetime
+0001bef0: 2e73 7472 6674 696d 6528 6474 2c6d 6971  .strftime(dt,miq
+0001bf00: 7476 2e64 6174 655f 666f 726d 6174 735b  tv.date_formats[
+0001bf10: 276d 6172 6971 7427 5d29 0a20 2020 2020  'mariqt']).     
+0001bf20: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0001bf30: 7863 6570 743a 0a20 2020 2020 2020 2020  xcept:.         
+0001bf40: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0001bf50: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+0001bf60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bf70: 666f 726d 6174 203d 2069 7465 6d43 7573  format = itemCus
+0001bf80: 746f 6d44 6174 6554 696d 6546 6f72 6d61  tomDateTimeForma
+0001bf90: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
+0001bfa0: 2020 2020 2020 2020 2020 2020 2020 6474                dt
+0001bfb0: 203d 2064 6174 6574 696d 652e 6461 7465   = datetime.date
+0001bfc0: 7469 6d65 2e73 7472 7074 696d 6528 7375  time.strptime(su
+0001bfd0: 6249 7465 6d5b 2769 6d61 6765 2d64 6174  bItem['image-dat
+0001bfe0: 6574 696d 6527 5d2c 666f 726d 6174 290a  etime'],format).
+0001bff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c000: 2020 2020 2020 2020 2020 2020 7375 6249              subI
+0001c010: 7465 6d5b 2769 6d61 6765 2d64 6174 6574  tem['image-datet
+0001c020: 696d 6527 5d20 3d20 6461 7465 7469 6d65  ime'] = datetime
+0001c030: 2e64 6174 6574 696d 652e 7374 7266 7469  .datetime.strfti
+0001c040: 6d65 2864 742c 6d69 7174 762e 6461 7465  me(dt,miqtv.date
+0001c050: 5f66 6f72 6d61 7473 5b27 6d61 7269 7174  _formats['mariqt
+0001c060: 275d 290a 2020 2020 2020 2020 2020 2020  ']).            
+0001c070: 2020 2020 2020 2020 2020 2020 6578 6365              exce
+0001c080: 7074 3a0a 2020 2020 2020 2020 2020 2020  pt:.            
+0001c090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c0a0: 7072 6f67 2e63 6c65 6172 2829 0a20 2020  prog.clear().   
+0001c0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c0c0: 2020 2020 2020 2020 2072 6169 7365 206d           raise m
+0001c0d0: 6971 7463 2e49 6664 6f45 7863 6570 7469  iqtc.IfdoExcepti
+0001c0e0: 6f6e 2827 496e 7661 6c69 6420 6461 7465  on('Invalid date
+0001c0f0: 7469 6d65 2076 616c 7565 272c 7375 6249  time value',subI
+0001c100: 7465 6d5b 2769 6d61 6765 2d64 6174 6574  tem['image-datet
+0001c110: 696d 6527 5d2c 2022 646f 6573 206e 6f74  ime'], "does not
+0001c120: 206d 6174 6368 2066 6f72 6d61 7420 6465   match format de
+0001c130: 6661 756c 7420 6f72 2063 7573 746f 6d20  fault or custom 
+0001c140: 666f 726d 6174 2229 0a20 2020 2020 2020  format").       
+0001c150: 2069 6620 6375 7374 6f6d 4461 7465 5469   if customDateTi
+0001c160: 6d65 466f 726d 6174 466f 756e 643a 0a20  meFormatFound:. 
+0001c170: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0001c180: 7072 6f76 2e6c 6f67 2822 4375 7374 6f6d  prov.log("Custom
+0001c190: 2064 6174 6574 696d 6520 666f 726d 6174   datetime format
+0001c1a0: 7320 666f 756e 642e 2054 6865 7920 7769  s found. They wi
+0001c1b0: 6c6c 2062 6520 7265 706c 6163 6564 2062  ll be replaced b
+0001c1c0: 7920 7468 6520 6465 6661 756c 7420 666f  y the default fo
+0001c1d0: 726d 6174 2e22 2920 2020 0a20 2020 2020  rmat.")   .     
+0001c1e0: 2020 2070 726f 672e 636c 6561 7228 2920     prog.clear() 
+0001c1f0: 2020 200a 0a0a 2020 2020 6465 6620 5f5f     ...    def __
+0001c200: 696e 6974 496e 7465 726d 6564 6961 7465  initIntermediate
+0001c210: 4669 6c65 7328 7365 6c66 293a 0a20 2020  Files(self):.   
+0001c220: 2020 2020 2073 656c 662e 696e 7465 726d       self.interm
+0001c230: 6564 6961 7465 4669 6c65 7344 6566 5f63  ediateFilesDef_c
+0001c240: 6f72 6520 3d20 7b0a 2020 2020 2020 2020  ore = {.        
+0001c250: 2020 2020 2768 6173 6865 7327 3a20 7b0a      'hashes': {.
+0001c260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c270: 2763 7265 6174 696f 6e46 6374 273a 2027  'creationFct': '
+0001c280: 6372 6561 7465 5f69 6d61 6765 5f73 6861  create_image_sha
+0001c290: 3235 365f 6669 6c65 2829 272c 0a20 2020  256_file()',.   
+0001c2a0: 2020 2020 2020 2020 2020 2020 2027 7375               'su
+0001c2b0: 6666 6978 273a 2027 5f69 6d61 6765 2d68  ffix': '_image-h
+0001c2c0: 6173 6865 732e 7478 7427 2c0a 2020 2020  ashes.txt',.    
+0001c2d0: 2020 2020 2020 2020 2020 2020 2763 6f6c              'col
+0001c2e0: 7327 3a20 5b6d 6971 7476 2e63 6f6c 5f68  s': [miqtv.col_h
+0001c2f0: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
+0001c300: 2768 6173 6827 5d5d 2c0a 2020 2020 2020  'hash']],.      
+0001c310: 2020 2020 2020 2020 2020 276f 7074 696f            'optio
+0001c320: 6e61 6c27 3a20 5b5d 7d2c 0a20 2020 2020  nal': []},.     
+0001c330: 2020 2020 2020 2027 7575 6964 7327 3a20         'uuids': 
+0001c340: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
+0001c350: 2020 2763 7265 6174 696f 6e46 6374 273a    'creationFct':
+0001c360: 2027 6372 6561 7465 5f75 7569 645f 6669   'create_uuid_fi
+0001c370: 6c65 2829 272c 0a20 2020 2020 2020 2020  le()',.         
+0001c380: 2020 2020 2020 2027 7375 6666 6978 273a         'suffix':
+0001c390: 2027 5f69 6d61 6765 2d75 7569 6473 2e74   '_image-uuids.t
+0001c3a0: 7874 272c 0a20 2020 2020 2020 2020 2020  xt',.           
+0001c3b0: 2020 2020 2027 636f 6c73 273a 205b 6d69       'cols': [mi
+0001c3c0: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
+0001c3d0: 6d61 7269 7174 275d 5b27 7575 6964 275d  mariqt']['uuid']
+0001c3e0: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
+0001c3f0: 2020 2027 6f70 7469 6f6e 616c 273a 205b     'optional': [
+0001c400: 5d7d 2c0a 2020 2020 2020 2020 2020 2020  ]},.            
+0001c410: 2764 6174 6574 696d 6527 3a20 7b0a 2020  'datetime': {.  
+0001c420: 2020 2020 2020 2020 2020 2020 2020 2763                'c
+0001c430: 7265 6174 696f 6e46 6374 273a 2027 6372  reationFct': 'cr
+0001c440: 6561 7465 5f73 7461 7274 5f74 696d 655f  eate_start_time_
+0001c450: 6669 6c65 2829 272c 0a20 2020 2020 2020  file()',.       
+0001c460: 2020 2020 2020 2020 2027 7375 6666 6978           'suffix
+0001c470: 273a 2027 5f69 6d61 6765 2d73 7461 7274  ': '_image-start
+0001c480: 2d74 696d 6573 2e74 7874 272c 0a20 2020  -times.txt',.   
+0001c490: 2020 2020 2020 2020 2020 2020 2027 636f               'co
+0001c4a0: 6c73 273a 205b 6d69 7174 762e 636f 6c5f  ls': [miqtv.col_
+0001c4b0: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
+0001c4c0: 5b27 7574 6327 5d5d 2c0a 2020 2020 2020  ['utc']],.      
+0001c4d0: 2020 2020 2020 2020 2020 276f 7074 696f            'optio
+0001c4e0: 6e61 6c27 3a20 5b5d 7d2c 0a20 2020 2020  nal': []},.     
+0001c4f0: 2020 2020 2020 2027 6e61 7669 6761 7469         'navigati
+0001c500: 6f6e 273a 207b 0a20 2020 2020 2020 2020  on': {.         
+0001c510: 2020 2020 2020 2027 6372 6561 7469 6f6e         'creation
+0001c520: 4663 7427 3a20 2763 7265 6174 655f 696d  Fct': 'create_im
+0001c530: 6167 655f 6e61 7669 6761 7469 6f6e 5f66  age_navigation_f
+0001c540: 696c 6528 2927 2c0a 2020 2020 2020 2020  ile()',.        
+0001c550: 2020 2020 2020 2020 2773 7566 6669 7827          'suffix'
+0001c560: 3a20 275f 696d 6167 652d 6e61 7669 6761  : '_image-naviga
+0001c570: 7469 6f6e 2e74 7874 272c 0a20 2020 2020  tion.txt',.     
+0001c580: 2020 2020 2020 2020 2020 2027 636f 6c73             'cols
+0001c590: 273a 205b 6d69 7174 762e 636f 6c5f 6865  ': [miqtv.col_he
+0001c5a0: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
+0001c5b0: 7574 6327 5d5d 2c0a 2020 2020 2020 2020  utc']],.        
+0001c5c0: 2020 2020 2020 2020 276f 7074 696f 6e61          'optiona
+0001c5d0: 6c27 3a20 5b6d 6971 7476 2e63 6f6c 5f68  l': [miqtv.col_h
+0001c5e0: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
+0001c5f0: 276c 6f6e 275d 2c20 6d69 7174 762e 636f  'lon'], miqtv.co
+0001c600: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
+0001c610: 275d 5b27 6c61 7427 5d2c 206d 6971 7476  ']['lat'], miqtv
+0001c620: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
+0001c630: 6971 7427 5d5b 2761 6c74 275d 2c20 6d69  iqt']['alt'], mi
+0001c640: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
+0001c650: 6d61 7269 7174 275d 5b27 6867 7427 5d2c  mariqt']['hgt'],
+0001c660: 206d 6971 7476 2e63 6f6c 5f68 6561 6465   miqtv.col_heade
+0001c670: 725b 276d 6172 6971 7427 5d5b 2775 6e63  r['mariqt']['unc
+0001c680: 6572 7427 5d5d 7d2c 0a20 2020 2020 2020  ert']]},.       
+0001c690: 207d 0a0a 2020 2020 2020 2020 7365 6c66   }..        self
+0001c6a0: 2e6e 6f6e 436f 7265 4669 656c 6449 6e74  .nonCoreFieldInt
+0001c6b0: 6572 6d65 6469 6174 6549 7465 6d49 6e66  ermediateItemInf
+0001c6c0: 6f46 696c 6573 203d 205b 5d0a 0a20 2020  oFiles = []..   
+0001c6d0: 2064 6566 205f 5f67 6574 5f69 6e74 5f66   def __get_int_f
+0001c6e0: 696c 655f 7072 6566 6978 2873 656c 6629  ile_prefix(self)
+0001c6f0: 3a0a 2020 2020 2020 2020 2222 2220 6465  :.        """ de
+0001c700: 7065 6e64 7320 6f6e 2027 696d 6167 652d  pends on 'image-
+0001c710: 6576 656e 7427 2061 6e64 2027 696d 6167  event' and 'imag
+0001c720: 652d 7365 6e73 6f72 2720 736f 2069 7420  e-sensor' so it 
+0001c730: 6361 6e20 6368 616e 6765 2064 7572 696e  can change durin
+0001c740: 6720 7570 6174 6520 2222 220a 2020 2020  g upate """.    
+0001c750: 2020 2020 7265 7475 726e 206f 732e 7061      return os.pa
+0001c760: 7468 2e6a 6f69 6e28 7365 6c66 2e64 6972  th.join(self.dir
+0001c770: 2e74 6f28 7365 6c66 2e64 6972 2e64 742e  .to(self.dir.dt.
+0001c780: 696e 7465 726d 6564 6961 7465 292c 2073  intermediate), s
+0001c790: 656c 662e 6669 6e64 546d 7046 6965 6c64  elf.findTmpField
+0001c7a0: 2827 696d 6167 652d 7365 742d 6e61 6d65  ('image-set-name
+0001c7b0: 2729 290a 0a20 2020 2064 6566 2067 6574  '))..    def get
+0001c7c0: 5f69 6e74 5f68 6173 685f 6669 6c65 2873  _int_hash_file(s
+0001c7d0: 656c 6629 3a0a 2020 2020 2020 2020 7265  elf):.        re
+0001c7e0: 7475 726e 2073 656c 662e 5f5f 6765 745f  turn self.__get_
+0001c7f0: 696e 745f 6669 6c65 5f70 7265 6669 7828  int_file_prefix(
+0001c800: 2920 2b20 7365 6c66 2e69 6e74 6572 6d65  ) + self.interme
+0001c810: 6469 6174 6546 696c 6573 4465 665f 636f  diateFilesDef_co
+0001c820: 7265 5b27 6861 7368 6573 275d 5b27 7375  re['hashes']['su
+0001c830: 6666 6978 275d 0a0a 2020 2020 6465 6620  ffix']..    def 
+0001c840: 6765 745f 696e 745f 7575 6964 5f66 696c  get_int_uuid_fil
+0001c850: 6528 7365 6c66 293a 0a20 2020 2020 2020  e(self):.       
+0001c860: 2072 6574 7572 6e20 7365 6c66 2e5f 5f67   return self.__g
+0001c870: 6574 5f69 6e74 5f66 696c 655f 7072 6566  et_int_file_pref
+0001c880: 6978 2829 202b 2073 656c 662e 696e 7465  ix() + self.inte
+0001c890: 726d 6564 6961 7465 4669 6c65 7344 6566  rmediateFilesDef
+0001c8a0: 5f63 6f72 655b 2775 7569 6473 275d 5b27  _core['uuids']['
+0001c8b0: 7375 6666 6978 275d 0a0a 2020 2020 6465  suffix']..    de
+0001c8c0: 6620 6765 745f 696e 745f 7374 6172 7454  f get_int_startT
+0001c8d0: 696d 6573 5f66 696c 6528 7365 6c66 293a  imes_file(self):
+0001c8e0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0001c8f0: 7365 6c66 2e5f 5f67 6574 5f69 6e74 5f66  self.__get_int_f
+0001c900: 696c 655f 7072 6566 6978 2829 202b 2073  ile_prefix() + s
+0001c910: 656c 662e 696e 7465 726d 6564 6961 7465  elf.intermediate
+0001c920: 4669 6c65 7344 6566 5f63 6f72 655b 2764  FilesDef_core['d
+0001c930: 6174 6574 696d 6527 5d5b 2773 7566 6669  atetime']['suffi
+0001c940: 7827 5d0a 0a20 2020 2064 6566 2067 6574  x']..    def get
+0001c950: 5f69 6e74 5f6e 6176 5f66 696c 6528 7365  _int_nav_file(se
+0001c960: 6c66 293a 0a20 2020 2020 2020 2072 6574  lf):.        ret
+0001c970: 7572 6e20 7365 6c66 2e5f 5f67 6574 5f69  urn self.__get_i
+0001c980: 6e74 5f66 696c 655f 7072 6566 6978 2829  nt_file_prefix()
+0001c990: 202b 2073 656c 662e 696e 7465 726d 6564   + self.intermed
+0001c9a0: 6961 7465 4669 6c65 7344 6566 5f63 6f72  iateFilesDef_cor
+0001c9b0: 655b 276e 6176 6967 6174 696f 6e27 5d5b  e['navigation'][
+0001c9c0: 2773 7566 6669 7827 5d0a 0a              'suffix']..
```

## Comparing `mariqt-0.5.4.dist-info/LICENSE` & `mariqt-0.5.5.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `mariqt-0.5.4.dist-info/METADATA` & `mariqt-0.5.5.dist-info/METADATA`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: mariqt
-Version: 0.5.4
+Version: 0.5.5
 Summary: The MareHub & Marine Imaging Community Image QA/QC and curation toolbox
 Author: Timm Schoening
 Author-email: tschoening@geomar.de
 Classifier: Programming Language :: Python :: 3
 Classifier: License :: OSI Approved :: GNU General Public License v3 (GPLv3)
 Classifier: Operating System :: OS Independent
 License-File: LICENSE
```

## Comparing `mariqt-0.5.4.dist-info/RECORD` & `mariqt-0.5.5.dist-info/RECORD`

 * *Files 12% similar despite different names*

```diff
@@ -1,31 +1,31 @@
 mariqt/converters.py,sha256=kYxAx41oKGLgywxYnnE5qqxDXzror4YvRKg_F5HgXpA,5876
 mariqt/core.py,sha256=gIMyi8GQ4c-0EJkalBVnn3_dLdrCMuVXmmPNhdPcMV4,14710
 mariqt/directories.py,sha256=ZRJmUxFO5oD4JCECorwr3DYQel-U57GsrgfLutzT2hU,8485
 mariqt/equipment.py,sha256=WgZ2NfRqbHFHNpbcnTfRk8waOCQn9fDgdr4JTZR9wPk,465
 mariqt/files.py,sha256=V-7J_ekTjWbZ7tyGE7SayZxQwf658KNtl_rUyStnzV8,16621
-mariqt/geo.py,sha256=BeQQ6oEGXqBFAeEQbVoJXMdDQRpJafTq9MjmhMNPiWA,27845
+mariqt/geo.py,sha256=K89tqXN4Ntu2qBzii68WVB86kGqTxpJvHzWARlR3k60,28565
 mariqt/image.py,sha256=j41GAzx22_fuqeIXVRwwfVnNz19cUHxeImZiOOpQAbA,23207
 mariqt/misc.py,sha256=BF_ItP_gnkS1Z6zb9P7O4cRi3XMgJR-Bm2OmzX7AK9M,3090
-mariqt/navigation.py,sha256=kYKHzibCKJNtXlDaIqzqZ7rmvjzFvpCUnFfz6yR7QJI,40059
+mariqt/navigation.py,sha256=d_SkjrlxDP3xGkFYLDrDkdbLmcbfpOJUpoFm_-ZeXVo,40159
 mariqt/provenance.py,sha256=daR6sIK6tSFaBsanKvIuFyjR78NNOTzd4N3AdQRxdFw,7345
 mariqt/reports.py,sha256=YP03HvFe0BG0y4efvQhRpeGifijqqPpCB_gg4qX-MVw,22316
 mariqt/settings.py,sha256=bqjUJnTiKwFsbGP4cRQiwHQhsTi4191pb36R8GSKp58,4376
 mariqt/tests.py,sha256=BWJy4ejhsSINzhR_88HGfYeXVnPKbdMwDE-u2qLl6C0,8323
 mariqt/variables.py,sha256=TtGb3UVwJnE5tmDEOxuZlCFofebgEWiKr7Soh_DFk5g,9613
-mariqt/version.py,sha256=gnTFnLc3UfVFZDdUQkPOzXDRxlG10U4PVgdajQWe9do,21
+mariqt/version.py,sha256=nrKeY2xA6SXRPdgHDxi2HLkFNpXRuW6MkqwC0reZpy8,21
 mariqt/resources/fair-marine-images/docs/schemas/annotation-v2.0.0.json,sha256=HyHwLO2Wc6KWE3YBctExeEHtDNz4HQldPkczvTdpFp0,6175
 mariqt/resources/fair-marine-images/docs/schemas/ifdo-v2.0.0.json,sha256=qKNwXPjk7NSpYI3PYGEItxsoyPUDTzJUNaJlqloWIHA,42461
 mariqt/resources/fair-marine-images/docs/schemas/provenance-v0.1.0.json,sha256=krwoig3eWpFjG61HIsdX7N-7QXFJ3v9mRZ63vham7rM,3218
 mariqt/sources/dship.py,sha256=5PxhsraSImnSchTG0h0HlLHorJQZPSDSOzspRGhD6bg,12135
-mariqt/sources/dship_settings.py,sha256=VoLc-YMD4Elwz0YpCFMy8mz0QQnKI0AJHPUHzQX9kJg,4586
+mariqt/sources/dship_settings.py,sha256=2vAlW0oh4iHwRCkBQnbCZ4yhXNzVi7aKPnqNrN5RwI0,4684
 mariqt/sources/elements.py,sha256=5Cgchy_MJq4CiLVi2xqpxlOGqL5-PKl426XnzoCIEVI,2177
-mariqt/sources/ifdo.py,sha256=OI__5TmaN_RKcP7uhk4Yj9-VX1pIORiV5NN0UTfQOe4,114744
+mariqt/sources/ifdo.py,sha256=m38NKMRm6CmvoKQ5BxxJTyXHCGylRkDiF2jo_sS1dI4,117195
 mariqt/sources/ofop.py,sha256=mSMZLvWszr_Yfd7rDf_4V4jIz3DMQh7Qe7eHLUnMOK8,5533
 mariqt/sources/svgs.py,sha256=T089b6F0wYLbUZQ8XhvCqqNmZqrvyTpx3kqRojlg_pM,650149
 mariqt/sources/underway.py,sha256=mIweaYmKbxPvmZHSFd3k5JY4mnFZ-7X3u_MdCPNjQL0,3728
-mariqt-0.5.4.dist-info/AUTHORS.md,sha256=_mki0OpAav0xO0ztc3R5aVhIpmexyqWmY1mAXBoOxMU,162
-mariqt-0.5.4.dist-info/LICENSE,sha256=-MKfBTtig35o5_D2OxsbEq-rOcOx7S4Wd3WsEedeV8o,35140
-mariqt-0.5.4.dist-info/METADATA,sha256=kJ4Y6r99gRwILFz8BGjPAi1cvAEuW_dzSH9gnK2d-cE,1133
-mariqt-0.5.4.dist-info/WHEEL,sha256=a-zpFRIJzOq5QfuhBzbhiA1eHTzNCJn8OdRvhdNX0Rk,110
-mariqt-0.5.4.dist-info/top_level.txt,sha256=tdkmp0KxobBWy4IKaBeGYtc2HjD0OpeWrGNe21Q8Tfo,7
-mariqt-0.5.4.dist-info/RECORD,,
+mariqt-0.5.5.dist-info/AUTHORS.md,sha256=_mki0OpAav0xO0ztc3R5aVhIpmexyqWmY1mAXBoOxMU,162
+mariqt-0.5.5.dist-info/LICENSE,sha256=-MKfBTtig35o5_D2OxsbEq-rOcOx7S4Wd3WsEedeV8o,35140
+mariqt-0.5.5.dist-info/METADATA,sha256=ODt3-tf9vfHIIy6lrn2KWAXcp5x6BCx-S76sd65Wc-I,1133
+mariqt-0.5.5.dist-info/WHEEL,sha256=a-zpFRIJzOq5QfuhBzbhiA1eHTzNCJn8OdRvhdNX0Rk,110
+mariqt-0.5.5.dist-info/top_level.txt,sha256=tdkmp0KxobBWy4IKaBeGYtc2HjD0OpeWrGNe21Q8Tfo,7
+mariqt-0.5.5.dist-info/RECORD,,
```

